(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var zh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function W5(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Cg={exports:{}},gu={};var Ix;function K5(){if(Ix)return gu;Ix=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,o){var l=null;if(o!==void 0&&(l=""+o),i.key!==void 0&&(l=""+i.key),"key"in i){o={};for(var u in i)u!=="key"&&(o[u]=i[u])}else o=i;return i=o.ref,{$$typeof:t,type:r,key:l,ref:i!==void 0?i:null,props:o}}return gu.Fragment=e,gu.jsx=n,gu.jsxs=n,gu}var Dx;function Y5(){return Dx||(Dx=1,Cg.exports=K5()),Cg.exports}var d=Y5(),Tg={exports:{}},tt={};var kx;function X5(){if(kx)return tt;kx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),_=Symbol.iterator;function b(B){return B===null||typeof B!="object"?null:(B=_&&B[_]||B["@@iterator"],typeof B=="function"?B:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,E={};function C(B,$,te){this.props=B,this.context=$,this.refs=E,this.updater=te||S}C.prototype.isReactComponent={},C.prototype.setState=function(B,$){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,$,"setState")},C.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function T(){}T.prototype=C.prototype;function A(B,$,te){this.props=B,this.context=$,this.refs=E,this.updater=te||S}var U=A.prototype=new T;U.constructor=A,x(U,C.prototype),U.isPureReactComponent=!0;var F=Array.isArray;function H(){}var O={H:null,A:null,T:null,S:null},D=Object.prototype.hasOwnProperty;function P(B,$,te){var ae=te.ref;return{$$typeof:t,type:B,key:$,ref:ae!==void 0?ae:null,props:te}}function L(B,$){return P(B.type,$,B.props)}function q(B){return typeof B=="object"&&B!==null&&B.$$typeof===t}function j(B){var $={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(te){return $[te]})}var M=/\/+/g;function R(B,$){return typeof B=="object"&&B!==null&&B.key!=null?j(""+B.key):$.toString(36)}function K(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(H,H):(B.status="pending",B.then(function($){B.status==="pending"&&(B.status="fulfilled",B.value=$)},function($){B.status==="pending"&&(B.status="rejected",B.reason=$)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function Q(B,$,te,ae,ne){var de=typeof B;(de==="undefined"||de==="boolean")&&(B=null);var Se=!1;if(B===null)Se=!0;else switch(de){case"bigint":case"string":case"number":Se=!0;break;case"object":switch(B.$$typeof){case t:case e:Se=!0;break;case p:return Se=B._init,Q(Se(B._payload),$,te,ae,ne)}}if(Se)return ne=ne(B),Se=ae===""?"."+R(B,0):ae,F(ne)?(te="",Se!=null&&(te=Se.replace(M,"$&/")+"/"),Q(ne,$,te,"",function(pe){return pe})):ne!=null&&(q(ne)&&(ne=L(ne,te+(ne.key==null||B&&B.key===ne.key?"":(""+ne.key).replace(M,"$&/")+"/")+Se)),$.push(ne)),1;Se=0;var Te=ae===""?".":ae+":";if(F(B))for(var Ee=0;Ee<B.length;Ee++)ae=B[Ee],de=Te+R(ae,Ee),Se+=Q(ae,$,te,de,ne);else if(Ee=b(B),typeof Ee=="function")for(B=Ee.call(B),Ee=0;!(ae=B.next()).done;)ae=ae.value,de=Te+R(ae,Ee++),Se+=Q(ae,$,te,de,ne);else if(de==="object"){if(typeof B.then=="function")return Q(K(B),$,te,ae,ne);throw $=String(B),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return Se}function G(B,$,te){if(B==null)return B;var ae=[],ne=0;return Q(B,ae,"","",function(de){return $.call(te,de,ne++)}),ae}function X(B){if(B._status===-1){var $=B._result;$=$(),$.then(function(te){(B._status===0||B._status===-1)&&(B._status=1,B._result=te)},function(te){(B._status===0||B._status===-1)&&(B._status=2,B._result=te)}),B._status===-1&&(B._status=0,B._result=$)}if(B._status===1)return B._result.default;throw B._result}var J=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)},re={map:G,forEach:function(B,$,te){G(B,function(){$.apply(this,arguments)},te)},count:function(B){var $=0;return G(B,function(){$++}),$},toArray:function(B){return G(B,function($){return $})||[]},only:function(B){if(!q(B))throw Error("React.Children.only expected to receive a single React element child.");return B}};return tt.Activity=g,tt.Children=re,tt.Component=C,tt.Fragment=n,tt.Profiler=i,tt.PureComponent=A,tt.StrictMode=r,tt.Suspense=h,tt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,tt.__COMPILER_RUNTIME={__proto__:null,c:function(B){return O.H.useMemoCache(B)}},tt.cache=function(B){return function(){return B.apply(null,arguments)}},tt.cacheSignal=function(){return null},tt.cloneElement=function(B,$,te){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var ae=x({},B.props),ne=B.key;if($!=null)for(de in $.key!==void 0&&(ne=""+$.key),$)!D.call($,de)||de==="key"||de==="__self"||de==="__source"||de==="ref"&&$.ref===void 0||(ae[de]=$[de]);var de=arguments.length-2;if(de===1)ae.children=te;else if(1<de){for(var Se=Array(de),Te=0;Te<de;Te++)Se[Te]=arguments[Te+2];ae.children=Se}return P(B.type,ne,ae)},tt.createContext=function(B){return B={$$typeof:l,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:o,_context:B},B},tt.createElement=function(B,$,te){var ae,ne={},de=null;if($!=null)for(ae in $.key!==void 0&&(de=""+$.key),$)D.call($,ae)&&ae!=="key"&&ae!=="__self"&&ae!=="__source"&&(ne[ae]=$[ae]);var Se=arguments.length-2;if(Se===1)ne.children=te;else if(1<Se){for(var Te=Array(Se),Ee=0;Ee<Se;Ee++)Te[Ee]=arguments[Ee+2];ne.children=Te}if(B&&B.defaultProps)for(ae in Se=B.defaultProps,Se)ne[ae]===void 0&&(ne[ae]=Se[ae]);return P(B,de,ne)},tt.createRef=function(){return{current:null}},tt.forwardRef=function(B){return{$$typeof:u,render:B}},tt.isValidElement=q,tt.lazy=function(B){return{$$typeof:p,_payload:{_status:-1,_result:B},_init:X}},tt.memo=function(B,$){return{$$typeof:f,type:B,compare:$===void 0?null:$}},tt.startTransition=function(B){var $=O.T,te={};O.T=te;try{var ae=B(),ne=O.S;ne!==null&&ne(te,ae),typeof ae=="object"&&ae!==null&&typeof ae.then=="function"&&ae.then(H,J)}catch(de){J(de)}finally{$!==null&&te.types!==null&&($.types=te.types),O.T=$}},tt.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},tt.use=function(B){return O.H.use(B)},tt.useActionState=function(B,$,te){return O.H.useActionState(B,$,te)},tt.useCallback=function(B,$){return O.H.useCallback(B,$)},tt.useContext=function(B){return O.H.useContext(B)},tt.useDebugValue=function(){},tt.useDeferredValue=function(B,$){return O.H.useDeferredValue(B,$)},tt.useEffect=function(B,$){return O.H.useEffect(B,$)},tt.useEffectEvent=function(B){return O.H.useEffectEvent(B)},tt.useId=function(){return O.H.useId()},tt.useImperativeHandle=function(B,$,te){return O.H.useImperativeHandle(B,$,te)},tt.useInsertionEffect=function(B,$){return O.H.useInsertionEffect(B,$)},tt.useLayoutEffect=function(B,$){return O.H.useLayoutEffect(B,$)},tt.useMemo=function(B,$){return O.H.useMemo(B,$)},tt.useOptimistic=function(B,$){return O.H.useOptimistic(B,$)},tt.useReducer=function(B,$,te){return O.H.useReducer(B,$,te)},tt.useRef=function(B){return O.H.useRef(B)},tt.useState=function(B){return O.H.useState(B)},tt.useSyncExternalStore=function(B,$,te){return O.H.useSyncExternalStore(B,$,te)},tt.useTransition=function(){return O.H.useTransition()},tt.version="19.2.3",tt}var Ox;function Ly(){return Ox||(Ox=1,Tg.exports=X5()),Tg.exports}var k=Ly(),Ag={exports:{}},yu={},jg={exports:{}},Rg={};var Mx;function Z5(){return Mx||(Mx=1,(function(t){function e(Q,G){var X=Q.length;Q.push(G);e:for(;0<X;){var J=X-1>>>1,re=Q[J];if(0<i(re,G))Q[J]=G,Q[X]=re,X=J;else break e}}function n(Q){return Q.length===0?null:Q[0]}function r(Q){if(Q.length===0)return null;var G=Q[0],X=Q.pop();if(X!==G){Q[0]=X;e:for(var J=0,re=Q.length,B=re>>>1;J<B;){var $=2*(J+1)-1,te=Q[$],ae=$+1,ne=Q[ae];if(0>i(te,X))ae<re&&0>i(ne,te)?(Q[J]=ne,Q[ae]=X,J=ae):(Q[J]=te,Q[$]=X,J=$);else if(ae<re&&0>i(ne,X))Q[J]=ne,Q[ae]=X,J=ae;else break e}}return G}function i(Q,G){var X=Q.sortIndex-G.sortIndex;return X!==0?X:Q.id-G.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,u=l.now();t.unstable_now=function(){return l.now()-u}}var h=[],f=[],p=1,g=null,_=3,b=!1,S=!1,x=!1,E=!1,C=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function U(Q){for(var G=n(f);G!==null;){if(G.callback===null)r(f);else if(G.startTime<=Q)r(f),G.sortIndex=G.expirationTime,e(h,G);else break;G=n(f)}}function F(Q){if(x=!1,U(Q),!S)if(n(h)!==null)S=!0,H||(H=!0,j());else{var G=n(f);G!==null&&K(F,G.startTime-Q)}}var H=!1,O=-1,D=5,P=-1;function L(){return E?!0:!(t.unstable_now()-P<D)}function q(){if(E=!1,H){var Q=t.unstable_now();P=Q;var G=!0;try{e:{S=!1,x&&(x=!1,T(O),O=-1),b=!0;var X=_;try{t:{for(U(Q),g=n(h);g!==null&&!(g.expirationTime>Q&&L());){var J=g.callback;if(typeof J=="function"){g.callback=null,_=g.priorityLevel;var re=J(g.expirationTime<=Q);if(Q=t.unstable_now(),typeof re=="function"){g.callback=re,U(Q),G=!0;break t}g===n(h)&&r(h),U(Q)}else r(h);g=n(h)}if(g!==null)G=!0;else{var B=n(f);B!==null&&K(F,B.startTime-Q),G=!1}}break e}finally{g=null,_=X,b=!1}G=void 0}}finally{G?j():H=!1}}}var j;if(typeof A=="function")j=function(){A(q)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,R=M.port2;M.port1.onmessage=q,j=function(){R.postMessage(null)}}else j=function(){C(q,0)};function K(Q,G){O=C(function(){Q(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Q){Q.callback=null},t.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<Q?Math.floor(1e3/Q):5},t.unstable_getCurrentPriorityLevel=function(){return _},t.unstable_next=function(Q){switch(_){case 1:case 2:case 3:var G=3;break;default:G=_}var X=_;_=G;try{return Q()}finally{_=X}},t.unstable_requestPaint=function(){E=!0},t.unstable_runWithPriority=function(Q,G){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var X=_;_=Q;try{return G()}finally{_=X}},t.unstable_scheduleCallback=function(Q,G,X){var J=t.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?J+X:J):X=J,Q){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=X+re,Q={id:p++,callback:G,priorityLevel:Q,startTime:X,expirationTime:re,sortIndex:-1},X>J?(Q.sortIndex=X,e(f,Q),n(h)===null&&Q===n(f)&&(x?(T(O),O=-1):x=!0,K(F,X-J))):(Q.sortIndex=re,e(h,Q),S||b||(S=!0,H||(H=!0,j()))),Q},t.unstable_shouldYield=L,t.unstable_wrapCallback=function(Q){var G=_;return function(){var X=_;_=G;try{return Q.apply(this,arguments)}finally{_=X}}}})(Rg)),Rg}var Nx;function J5(){return Nx||(Nx=1,jg.exports=Z5()),jg.exports}var Ig={exports:{}},Wn={};var Px;function e2(){if(Px)return Wn;Px=1;var t=Ly();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(h,f,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:f,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Wn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Wn.createPortal=function(h,f){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(h,f,null,p)},Wn.flushSync=function(h){var f=l.T,p=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=f,r.p=p,r.d.f()}},Wn.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,r.d.C(h,f))},Wn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Wn.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var p=f.as,g=u(p,f.crossOrigin),_=typeof f.integrity=="string"?f.integrity:void 0,b=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;p==="style"?r.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:g,integrity:_,fetchPriority:b}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:_,fetchPriority:b,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Wn.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var p=u(f.as,f.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&r.d.M(h)},Wn.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var p=f.as,g=u(p,f.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Wn.preloadModule=function(h,f){if(typeof h=="string")if(f){var p=u(f.as,f.crossOrigin);r.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else r.d.m(h)},Wn.requestFormReset=function(h){r.d.r(h)},Wn.unstable_batchedUpdates=function(h,f){return h(f)},Wn.useFormState=function(h,f,p){return l.H.useFormState(h,f,p)},Wn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Wn.version="19.2.3",Wn}var zx;function t2(){if(zx)return Ig.exports;zx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ig.exports=e2(),Ig.exports}var Bx;function n2(){if(Bx)return yu;Bx=1;var t=J5(),e=Ly(),n=t2();function r(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function l(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function u(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function f(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(r(188));return a!==s?null:s}for(var c=s,m=a;;){var v=c.return;if(v===null)break;var w=v.alternate;if(w===null){if(m=v.return,m!==null){c=m;continue}break}if(v.child===w.child){for(w=v.child;w;){if(w===c)return h(v),s;if(w===m)return h(v),a;w=w.sibling}throw Error(r(188))}if(c.return!==m.return)c=v,m=w;else{for(var N=!1,W=v.child;W;){if(W===c){N=!0,c=v,m=w;break}if(W===m){N=!0,m=v,c=w;break}W=W.sibling}if(!N){for(W=w.child;W;){if(W===c){N=!0,c=w,m=v;break}if(W===m){N=!0,m=w,c=v;break}W=W.sibling}if(!N)throw Error(r(189))}}if(c.alternate!==m)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?s:a}function p(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=p(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,_=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),A=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),L=Symbol.for("react.memo_cache_sentinel"),q=Symbol.iterator;function j(s){return s===null||typeof s!="object"?null:(s=q&&s[q]||s["@@iterator"],typeof s=="function"?s:null)}var M=Symbol.for("react.client.reference");function R(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===M?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case x:return"Fragment";case C:return"Profiler";case E:return"StrictMode";case F:return"Suspense";case H:return"SuspenseList";case P:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case S:return"Portal";case A:return s.displayName||"Context";case T:return(s._context.displayName||"Context")+".Consumer";case U:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case O:return a=s.displayName||null,a!==null?a:R(s.type)||"Memo";case D:a=s._payload,s=s._init;try{return R(s(a))}catch{}}return null}var K=Array.isArray,Q=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X={pending:!1,data:null,method:null,action:null},J=[],re=-1;function B(s){return{current:s}}function $(s){0>re||(s.current=J[re],J[re]=null,re--)}function te(s,a){re++,J[re]=s.current,s.current=a}var ae=B(null),ne=B(null),de=B(null),Se=B(null);function Te(s,a){switch(te(de,a),te(ne,s),te(ae,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?Jv(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=Jv(a),s=ex(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}$(ae),te(ae,s)}function Ee(){$(ae),$(ne),$(de)}function pe(s){s.memoizedState!==null&&te(Se,s);var a=ae.current,c=ex(a,s.type);a!==c&&(te(ne,s),te(ae,c))}function Fe(s){ne.current===s&&($(ae),$(ne)),Se.current===s&&($(Se),hu._currentValue=X)}var He,Ne;function z(s){if(He===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);He=a&&a[1]||"",Ne=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+He+s+Ne}var be=!1;function ge(s,a){if(!s||be)return"";be=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(a){var Ie=function(){throw Error()};if(Object.defineProperty(Ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ie,[])}catch(ve){var ye=ve}Reflect.construct(s,[],Ie)}else{try{Ie.call()}catch(ve){ye=ve}s.call(Ie.prototype)}}else{try{throw Error()}catch(ve){ye=ve}(Ie=s())&&typeof Ie.catch=="function"&&Ie.catch(function(){})}}catch(ve){if(ve&&ye&&typeof ve.stack=="string")return[ve.stack,ye.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=m.DetermineComponentFrameRoot(),N=w[0],W=w[1];if(N&&W){var se=N.split(`
`),me=W.split(`
`);for(v=m=0;m<se.length&&!se[m].includes("DetermineComponentFrameRoot");)m++;for(;v<me.length&&!me[v].includes("DetermineComponentFrameRoot");)v++;if(m===se.length||v===me.length)for(m=se.length-1,v=me.length-1;1<=m&&0<=v&&se[m]!==me[v];)v--;for(;1<=m&&0<=v;m--,v--)if(se[m]!==me[v]){if(m!==1||v!==1)do if(m--,v--,0>v||se[m]!==me[v]){var Ce=`
`+se[m].replace(" at new "," at ");return s.displayName&&Ce.includes("<anonymous>")&&(Ce=Ce.replace("<anonymous>",s.displayName)),Ce}while(1<=m&&0<=v);break}}}finally{be=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?z(c):""}function ee(s,a){switch(s.tag){case 26:case 27:case 5:return z(s.type);case 16:return z("Lazy");case 13:return s.child!==a&&a!==null?z("Suspense Fallback"):z("Suspense");case 19:return z("SuspenseList");case 0:case 15:return ge(s.type,!1);case 11:return ge(s.type.render,!1);case 1:return ge(s.type,!0);case 31:return z("Activity");default:return""}}function Z(s){try{var a="",c=null;do a+=ee(s,c),c=s,s=s.return;while(s);return a}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var ie=Object.prototype.hasOwnProperty,we=t.unstable_scheduleCallback,xe=t.unstable_cancelCallback,oe=t.unstable_shouldYield,je=t.unstable_requestPaint,Pe=t.unstable_now,Oe=t.unstable_getCurrentPriorityLevel,Ge=t.unstable_ImmediatePriority,xt=t.unstable_UserBlockingPriority,st=t.unstable_NormalPriority,Hn=t.unstable_LowPriority,ds=t.unstable_IdlePriority,Jn=t.log,hs=t.unstable_setDisableYieldValue,bt=null,Jt=null;function Qn(s){if(typeof Jn=="function"&&hs(s),Jt&&typeof Jt.setStrictMode=="function")try{Jt.setStrictMode(bt,s)}catch{}}var Et=Math.clz32?Math.clz32:Lo,Ba=Math.log,Ci=Math.LN2;function Lo(s){return s>>>=0,s===0?32:31-(Ba(s)/Ci|0)|0}var jr=256,fs=262144,Lt=4194304;function er(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function ms(s,a,c){var m=s.pendingLanes;if(m===0)return 0;var v=0,w=s.suspendedLanes,N=s.pingedLanes;s=s.warmLanes;var W=m&134217727;return W!==0?(m=W&~w,m!==0?v=er(m):(N&=W,N!==0?v=er(N):c||(c=W&~s,c!==0&&(v=er(c))))):(W=m&~w,W!==0?v=er(W):N!==0?v=er(N):c||(c=m&~s,c!==0&&(v=er(c)))),v===0?0:a!==0&&a!==v&&(a&w)===0&&(w=v&-v,c=a&-a,w>=c||w===32&&(c&4194048)!==0)?a:v}function Hr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function Rm(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function md(){var s=Lt;return Lt<<=1,(Lt&62914560)===0&&(Lt=4194304),s}function ps(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function La(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Im(s,a,c,m,v,w){var N=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var W=s.entanglements,se=s.expirationTimes,me=s.hiddenUpdates;for(c=N&~c;0<c;){var Ce=31-Et(c),Ie=1<<Ce;W[Ce]=0,se[Ce]=-1;var ye=me[Ce];if(ye!==null)for(me[Ce]=null,Ce=0;Ce<ye.length;Ce++){var ve=ye[Ce];ve!==null&&(ve.lane&=-536870913)}c&=~Ie}m!==0&&Ua(s,m,0),w!==0&&v===0&&s.tag!==0&&(s.suspendedLanes|=w&~(N&~a))}function Ua(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var m=31-Et(a);s.entangledLanes|=a,s.entanglements[m]=s.entanglements[m]|1073741824|c&261930}function yc(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var m=31-Et(c),v=1<<m;v&a|s[m]&a&&(s[m]|=a),c&=~v}}function _c(s,a){var c=a&-a;return c=(c&42)!==0?1:Fa(c),(c&(s.suspendedLanes|a))!==0?0:c}function Fa(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Gs(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function pd(){var s=G.p;return s!==0?s:(s=window.event,s===void 0?32:Sx(s.type))}function Qr(s,a){var c=G.p;try{return G.p=s,a()}finally{G.p=c}}var Wr=Math.random().toString(36).slice(2),cn="__reactFiber$"+Wr,jn="__reactProps$"+Wr,gs="__reactContainer$"+Wr,Uo="__reactEvents$"+Wr,Dm="__reactListeners$"+Wr,gd="__reactHandles$"+Wr,yd="__reactResources$"+Wr,ys="__reactMarker$"+Wr;function Fo(s){delete s[cn],delete s[jn],delete s[Uo],delete s[Dm],delete s[gd]}function _s(s){var a=s[cn];if(a)return a;for(var c=s.parentNode;c;){if(a=c[gs]||c[cn]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=ox(s);s!==null;){if(c=s[cn])return c;s=ox(s)}return a}s=c,c=s.parentNode}return null}function Rr(s){if(s=s[cn]||s[gs]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function gr(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(r(33))}function bs(s){var a=s[yd];return a||(a=s[yd]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function un(s){s[ys]=!0}var bc=new Set,vc={};function vs(s,a){xs(s,a),xs(s+"Capture",a)}function xs(s,a){for(vc[s]=a,s=0;s<a.length;s++)bc.add(a[s])}var xc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),wc={},Sc={};function _d(s){return ie.call(Sc,s)?!0:ie.call(wc,s)?!1:xc.test(s)?Sc[s]=!0:(wc[s]=!0,!1)}function Vo(s,a,c){if(_d(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var m=a.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function yr(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function dn(s,a,c,m){if(m===null)s.removeAttribute(c);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+m)}}function Rn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Ti(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ec(s,a,c){var m=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var v=m.get,w=m.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return v.call(this)},set:function(N){c=""+N,w.call(this,N)}}),Object.defineProperty(s,a,{enumerable:m.enumerable}),{getValue:function(){return c},setValue:function(N){c=""+N},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function Rt(s){if(!s._valueTracker){var a=Ti(s)?"checked":"value";s._valueTracker=Ec(s,a,""+s[a])}}function Va(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),m="";return s&&(m=Ti(s)?s.checked?"true":"false":s.value),s=m,s!==c?(a.setValue(s),!0):!1}function ws(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var $a=/[\n"\\]/g;function ir(s){return s.replace($a,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function $o(s,a,c,m,v,w,N,W){s.name="",N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?s.type=N:s.removeAttribute("type"),a!=null?N==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+Rn(a)):s.value!==""+Rn(a)&&(s.value=""+Rn(a)):N!=="submit"&&N!=="reset"||s.removeAttribute("value"),a!=null?Cc(s,N,Rn(a)):c!=null?Cc(s,N,Rn(c)):m!=null&&s.removeAttribute("value"),v==null&&w!=null&&(s.defaultChecked=!!w),v!=null&&(s.checked=v&&typeof v!="function"&&typeof v!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?s.name=""+Rn(W):s.removeAttribute("name")}function bd(s,a,c,m,v,w,N,W){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(s.type=w),a!=null||c!=null){if(!(w!=="submit"&&w!=="reset"||a!=null)){Rt(s);return}c=c!=null?""+Rn(c):"",a=a!=null?""+Rn(a):c,W||a===s.value||(s.value=a),s.defaultValue=a}m=m??v,m=typeof m!="function"&&typeof m!="symbol"&&!!m,s.checked=W?s.checked:!!m,s.defaultChecked=!!m,N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"&&(s.name=N),Rt(s)}function Cc(s,a,c){a==="number"&&ws(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function Ai(s,a,c,m){if(s=s.options,a){a={};for(var v=0;v<c.length;v++)a["$"+c[v]]=!0;for(c=0;c<s.length;c++)v=a.hasOwnProperty("$"+s[c].value),s[c].selected!==v&&(s[c].selected=v),v&&m&&(s[c].defaultSelected=!0)}else{for(c=""+Rn(c),a=null,v=0;v<s.length;v++){if(s[v].value===c){s[v].selected=!0,m&&(s[v].defaultSelected=!0);return}a!==null||s[v].disabled||(a=s[v])}a!==null&&(a.selected=!0)}}function vd(s,a,c){if(a!=null&&(a=""+Rn(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+Rn(c):""}function ji(s,a,c,m){if(a==null){if(m!=null){if(c!=null)throw Error(r(92));if(K(m)){if(1<m.length)throw Error(r(93));m=m[0]}c=m}c==null&&(c=""),a=c}c=Rn(a),s.defaultValue=c,m=s.textContent,m===c&&m!==""&&m!==null&&(s.value=m),Rt(s)}function ar(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var xd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tc(s,a,c){var m=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?m?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":m?s.setProperty(a,c):typeof c!="number"||c===0||xd.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Ac(s,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(s=s.style,c!=null){for(var m in c)!c.hasOwnProperty(m)||a!=null&&a.hasOwnProperty(m)||(m.indexOf("--")===0?s.setProperty(m,""):m==="float"?s.cssFloat="":s[m]="");for(var v in a)m=a[v],a.hasOwnProperty(v)&&c[v]!==m&&Tc(s,v,m)}else for(var w in a)a.hasOwnProperty(w)&&Tc(s,w,a[w])}function qo(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ri=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Go(s){return Ri.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Kr(){}var jc=null;function Ir(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Ii=null,Ss=null;function qa(s){var a=Rr(s);if(a&&(s=a.stateNode)){var c=s[jn]||null;e:switch(s=a.stateNode,a.type){case"input":if($o(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+ir(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var m=c[a];if(m!==s&&m.form===s.form){var v=m[jn]||null;if(!v)throw Error(r(90));$o(m,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(a=0;a<c.length;a++)m=c[a],m.form===s.form&&Va(m)}break e;case"textarea":vd(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Ai(s,!!c.multiple,a,!1)}}}var Ho=!1;function Di(s,a,c){if(Ho)return s(a,c);Ho=!0;try{var m=s(a);return m}finally{if(Ho=!1,(Ii!==null||Ss!==null)&&(ph(),Ii&&(a=Ii,s=Ss,Ss=Ii=null,qa(a),s)))for(a=0;a<s.length;a++)qa(s[a])}}function Yr(s,a){var c=s.stateNode;if(c===null)return null;var m=c[jn]||null;if(m===null)return null;c=m[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(s=s.type,m=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!m;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var Dr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ga=!1;if(Dr)try{var kt={};Object.defineProperty(kt,"passive",{get:function(){Ga=!0}}),window.addEventListener("test",kt,kt),window.removeEventListener("test",kt,kt)}catch{Ga=!1}var Es=null,Rc=null,Ha=null;function Ic(){if(Ha)return Ha;var s,a=Rc,c=a.length,m,v="value"in Es?Es.value:Es.textContent,w=v.length;for(s=0;s<c&&a[s]===v[s];s++);var N=c-s;for(m=1;m<=N&&a[c-m]===v[w-m];m++);return Ha=v.slice(s,1<m?1-m:void 0)}function Qa(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Hs(){return!0}function Xr(){return!1}function Mn(s){function a(c,m,v,w,N){this._reactName=c,this._targetInst=v,this.type=m,this.nativeEvent=w,this.target=N,this.currentTarget=null;for(var W in s)s.hasOwnProperty(W)&&(c=s[W],this[W]=c?c(w):w[W]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Hs:Xr,this.isPropagationStopped=Xr,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Hs)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Hs)},persist:function(){},isPersistent:Hs}),a}var Qs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cs=Mn(Qs),ki=g({},Qs,{view:0,detail:0}),Dc=Mn(ki),Oi,Qo,Ts,Wo=g({},ki,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mi,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Ts&&(Ts&&s.type==="mousemove"?(Oi=s.screenX-Ts.screenX,Qo=s.screenY-Ts.screenY):Qo=Oi=0,Ts=s),Oi)},movementY:function(s){return"movementY"in s?s.movementY:Qo}}),kc=Mn(Wo),Wa=g({},Wo,{dataTransfer:0}),Sd=Mn(Wa),Ed=g({},ki,{relatedTarget:0}),Ka=Mn(Ed),Oc=g({},Qs,{animationName:0,elapsedTime:0,pseudoElement:0}),Cd=Mn(Oc),Ko=g({},Qs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Td=Mn(Ko),Ad=g({},Qs,{data:0}),As=Mn(Ad),jd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Id={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Dd(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=Id[s])?!!a[s]:!1}function Mi(){return Dd}var tr=g({},ki,{key:function(s){if(s.key){var a=jd[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=Qa(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Rd[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mi,charCode:function(s){return s.type==="keypress"?Qa(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Qa(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),kd=Mn(tr),Od=g({},Wo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ws=Mn(Od),y=g({},ki,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mi}),I=Mn(y),V=g({},Qs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Y=Mn(V),he=g({},Wo,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),_e=Mn(he),ze=g({},Qs,{newState:0,oldState:0}),it=Mn(ze),rn=[9,13,27,32],Ct=Dr&&"CompositionEvent"in window,Qt=null;Dr&&"documentMode"in document&&(Qt=document.documentMode);var kr=Dr&&"TextEvent"in window&&!Qt,js=Dr&&(!Ct||Qt&&8<Qt&&11>=Qt),Zr=" ",Jr=!1;function Ya(s,a){switch(s){case"keyup":return rn.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yo(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Xo=!1;function _A(s,a){switch(s){case"compositionend":return Yo(a);case"keypress":return a.which!==32?null:(Jr=!0,Zr);case"textInput":return s=a.data,s===Zr&&Jr?null:s;default:return null}}function bA(s,a){if(Xo)return s==="compositionend"||!Ct&&Ya(s,a)?(s=Ic(),Ha=Rc=Es=null,Xo=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return js&&a.locale!=="ko"?null:a.data;default:return null}}var vA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function u_(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!vA[s.type]:a==="textarea"}function d_(s,a,c,m){Ii?Ss?Ss.push(m):Ss=[m]:Ii=m,a=wh(a,"onChange"),0<a.length&&(c=new Cs("onChange","change",null,c,m),s.push({event:c,listeners:a}))}var Mc=null,Nc=null;function xA(s){Qv(s,0)}function Md(s){var a=gr(s);if(Va(a))return s}function h_(s,a){if(s==="change")return a}var f_=!1;if(Dr){var km;if(Dr){var Om="oninput"in document;if(!Om){var m_=document.createElement("div");m_.setAttribute("oninput","return;"),Om=typeof m_.oninput=="function"}km=Om}else km=!1;f_=km&&(!document.documentMode||9<document.documentMode)}function p_(){Mc&&(Mc.detachEvent("onpropertychange",g_),Nc=Mc=null)}function g_(s){if(s.propertyName==="value"&&Md(Nc)){var a=[];d_(a,Nc,s,Ir(s)),Di(xA,a)}}function wA(s,a,c){s==="focusin"?(p_(),Mc=a,Nc=c,Mc.attachEvent("onpropertychange",g_)):s==="focusout"&&p_()}function SA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Md(Nc)}function EA(s,a){if(s==="click")return Md(a)}function CA(s,a){if(s==="input"||s==="change")return Md(a)}function TA(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var _r=typeof Object.is=="function"?Object.is:TA;function Pc(s,a){if(_r(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),m=Object.keys(a);if(c.length!==m.length)return!1;for(m=0;m<c.length;m++){var v=c[m];if(!ie.call(a,v)||!_r(s[v],a[v]))return!1}return!0}function y_(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function __(s,a){var c=y_(s);s=0;for(var m;c;){if(c.nodeType===3){if(m=s+c.textContent.length,s<=a&&m>=a)return{node:c,offset:a-s};s=m}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=y_(c)}}function b_(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?b_(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function v_(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=ws(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=ws(s.document)}return a}function Mm(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var AA=Dr&&"documentMode"in document&&11>=document.documentMode,Zo=null,Nm=null,zc=null,Pm=!1;function x_(s,a,c){var m=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Pm||Zo==null||Zo!==ws(m)||(m=Zo,"selectionStart"in m&&Mm(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),zc&&Pc(zc,m)||(zc=m,m=wh(Nm,"onSelect"),0<m.length&&(a=new Cs("onSelect","select",null,a,c),s.push({event:a,listeners:m}),a.target=Zo)))}function Xa(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var Jo={animationend:Xa("Animation","AnimationEnd"),animationiteration:Xa("Animation","AnimationIteration"),animationstart:Xa("Animation","AnimationStart"),transitionrun:Xa("Transition","TransitionRun"),transitionstart:Xa("Transition","TransitionStart"),transitioncancel:Xa("Transition","TransitionCancel"),transitionend:Xa("Transition","TransitionEnd")},zm={},w_={};Dr&&(w_=document.createElement("div").style,"AnimationEvent"in window||(delete Jo.animationend.animation,delete Jo.animationiteration.animation,delete Jo.animationstart.animation),"TransitionEvent"in window||delete Jo.transitionend.transition);function Za(s){if(zm[s])return zm[s];if(!Jo[s])return s;var a=Jo[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in w_)return zm[s]=a[c];return s}var S_=Za("animationend"),E_=Za("animationiteration"),C_=Za("animationstart"),jA=Za("transitionrun"),RA=Za("transitionstart"),IA=Za("transitioncancel"),T_=Za("transitionend"),A_=new Map,Bm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Bm.push("scrollEnd");function es(s,a){A_.set(s,a),vs(a,[s])}var Nd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Or=[],el=0,Lm=0;function Pd(){for(var s=el,a=Lm=el=0;a<s;){var c=Or[a];Or[a++]=null;var m=Or[a];Or[a++]=null;var v=Or[a];Or[a++]=null;var w=Or[a];if(Or[a++]=null,m!==null&&v!==null){var N=m.pending;N===null?v.next=v:(v.next=N.next,N.next=v),m.pending=v}w!==0&&j_(c,v,w)}}function zd(s,a,c,m){Or[el++]=s,Or[el++]=a,Or[el++]=c,Or[el++]=m,Lm|=m,s.lanes|=m,s=s.alternate,s!==null&&(s.lanes|=m)}function Um(s,a,c,m){return zd(s,a,c,m),Bd(s)}function Ja(s,a){return zd(s,null,null,a),Bd(s)}function j_(s,a,c){s.lanes|=c;var m=s.alternate;m!==null&&(m.lanes|=c);for(var v=!1,w=s.return;w!==null;)w.childLanes|=c,m=w.alternate,m!==null&&(m.childLanes|=c),w.tag===22&&(s=w.stateNode,s===null||s._visibility&1||(v=!0)),s=w,w=w.return;return s.tag===3?(w=s.stateNode,v&&a!==null&&(v=31-Et(c),s=w.hiddenUpdates,m=s[v],m===null?s[v]=[a]:m.push(a),a.lane=c|536870912),w):null}function Bd(s){if(50<iu)throw iu=0,Kp=null,Error(r(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var tl={};function DA(s,a,c,m){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function br(s,a,c,m){return new DA(s,a,c,m)}function Fm(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Ks(s,a){var c=s.alternate;return c===null?(c=br(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function R_(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Ld(s,a,c,m,v,w){var N=0;if(m=s,typeof s=="function")Fm(s)&&(N=1);else if(typeof s=="string")N=P5(s,c,ae.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case P:return s=br(31,c,a,v),s.elementType=P,s.lanes=w,s;case x:return eo(c.children,v,w,a);case E:N=8,v|=24;break;case C:return s=br(12,c,a,v|2),s.elementType=C,s.lanes=w,s;case F:return s=br(13,c,a,v),s.elementType=F,s.lanes=w,s;case H:return s=br(19,c,a,v),s.elementType=H,s.lanes=w,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case A:N=10;break e;case T:N=9;break e;case U:N=11;break e;case O:N=14;break e;case D:N=16,m=null;break e}N=29,c=Error(r(130,s===null?"null":typeof s,"")),m=null}return a=br(N,c,a,v),a.elementType=s,a.type=m,a.lanes=w,a}function eo(s,a,c,m){return s=br(7,s,m,a),s.lanes=c,s}function Vm(s,a,c){return s=br(6,s,null,a),s.lanes=c,s}function I_(s){var a=br(18,null,null,0);return a.stateNode=s,a}function $m(s,a,c){return a=br(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var D_=new WeakMap;function Mr(s,a){if(typeof s=="object"&&s!==null){var c=D_.get(s);return c!==void 0?c:(a={value:s,source:a,stack:Z(a)},D_.set(s,a),a)}return{value:s,source:a,stack:Z(a)}}var nl=[],rl=0,Ud=null,Bc=0,Nr=[],Pr=0,Ni=null,Rs=1,Is="";function Ys(s,a){nl[rl++]=Bc,nl[rl++]=Ud,Ud=s,Bc=a}function k_(s,a,c){Nr[Pr++]=Rs,Nr[Pr++]=Is,Nr[Pr++]=Ni,Ni=s;var m=Rs;s=Is;var v=32-Et(m)-1;m&=~(1<<v),c+=1;var w=32-Et(a)+v;if(30<w){var N=v-v%5;w=(m&(1<<N)-1).toString(32),m>>=N,v-=N,Rs=1<<32-Et(a)+v|c<<v|m,Is=w+s}else Rs=1<<w|c<<v|m,Is=s}function qm(s){s.return!==null&&(Ys(s,1),k_(s,1,0))}function Gm(s){for(;s===Ud;)Ud=nl[--rl],nl[rl]=null,Bc=nl[--rl],nl[rl]=null;for(;s===Ni;)Ni=Nr[--Pr],Nr[Pr]=null,Is=Nr[--Pr],Nr[Pr]=null,Rs=Nr[--Pr],Nr[Pr]=null}function O_(s,a){Nr[Pr++]=Rs,Nr[Pr++]=Is,Nr[Pr++]=Ni,Rs=a.id,Is=a.overflow,Ni=s}var Nn=null,Ft=null,yt=!1,Pi=null,zr=!1,Hm=Error(r(519));function zi(s){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Lc(Mr(a,s)),Hm}function M_(s){var a=s.stateNode,c=s.type,m=s.memoizedProps;switch(a[cn]=s,a[jn]=m,c){case"dialog":ut("cancel",a),ut("close",a);break;case"iframe":case"object":case"embed":ut("load",a);break;case"video":case"audio":for(c=0;c<ou.length;c++)ut(ou[c],a);break;case"source":ut("error",a);break;case"img":case"image":case"link":ut("error",a),ut("load",a);break;case"details":ut("toggle",a);break;case"input":ut("invalid",a),bd(a,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":ut("invalid",a);break;case"textarea":ut("invalid",a),ji(a,m.value,m.defaultValue,m.children)}c=m.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||m.suppressHydrationWarning===!0||Xv(a.textContent,c)?(m.popover!=null&&(ut("beforetoggle",a),ut("toggle",a)),m.onScroll!=null&&ut("scroll",a),m.onScrollEnd!=null&&ut("scrollend",a),m.onClick!=null&&(a.onclick=Kr),a=!0):a=!1,a||zi(s,!0)}function N_(s){for(Nn=s.return;Nn;)switch(Nn.tag){case 5:case 31:case 13:zr=!1;return;case 27:case 3:zr=!0;return;default:Nn=Nn.return}}function sl(s){if(s!==Nn)return!1;if(!yt)return N_(s),yt=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||ug(s.type,s.memoizedProps)),c=!c),c&&Ft&&zi(s),N_(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));Ft=ax(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));Ft=ax(s)}else a===27?(a=Ft,Xi(s.type)?(s=pg,pg=null,Ft=s):Ft=a):Ft=Nn?Lr(s.stateNode.nextSibling):null;return!0}function to(){Ft=Nn=null,yt=!1}function Qm(){var s=Pi;return s!==null&&(ur===null?ur=s:ur.push.apply(ur,s),Pi=null),s}function Lc(s){Pi===null?Pi=[s]:Pi.push(s)}var Wm=B(null),no=null,Xs=null;function Bi(s,a,c){te(Wm,a._currentValue),a._currentValue=c}function Zs(s){s._currentValue=Wm.current,$(Wm)}function Km(s,a,c){for(;s!==null;){var m=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,m!==null&&(m.childLanes|=a)):m!==null&&(m.childLanes&a)!==a&&(m.childLanes|=a),s===c)break;s=s.return}}function Ym(s,a,c,m){var v=s.child;for(v!==null&&(v.return=s);v!==null;){var w=v.dependencies;if(w!==null){var N=v.child;w=w.firstContext;e:for(;w!==null;){var W=w;w=v;for(var se=0;se<a.length;se++)if(W.context===a[se]){w.lanes|=c,W=w.alternate,W!==null&&(W.lanes|=c),Km(w.return,c,s),m||(N=null);break e}w=W.next}}else if(v.tag===18){if(N=v.return,N===null)throw Error(r(341));N.lanes|=c,w=N.alternate,w!==null&&(w.lanes|=c),Km(N,c,s),N=null}else N=v.child;if(N!==null)N.return=v;else for(N=v;N!==null;){if(N===s){N=null;break}if(v=N.sibling,v!==null){v.return=N.return,N=v;break}N=N.return}v=N}}function il(s,a,c,m){s=null;for(var v=a,w=!1;v!==null;){if(!w){if((v.flags&524288)!==0)w=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var N=v.alternate;if(N===null)throw Error(r(387));if(N=N.memoizedProps,N!==null){var W=v.type;_r(v.pendingProps.value,N.value)||(s!==null?s.push(W):s=[W])}}else if(v===Se.current){if(N=v.alternate,N===null)throw Error(r(387));N.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(s!==null?s.push(hu):s=[hu])}v=v.return}s!==null&&Ym(a,s,c,m),a.flags|=262144}function Fd(s){for(s=s.firstContext;s!==null;){if(!_r(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function ro(s){no=s,Xs=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Pn(s){return P_(no,s)}function Vd(s,a){return no===null&&ro(s),P_(s,a)}function P_(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},Xs===null){if(s===null)throw Error(r(308));Xs=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else Xs=Xs.next=a;return c}var kA=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,m){s.push(m)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},OA=t.unstable_scheduleCallback,MA=t.unstable_NormalPriority,hn={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xm(){return{controller:new kA,data:new Map,refCount:0}}function Uc(s){s.refCount--,s.refCount===0&&OA(MA,function(){s.controller.abort()})}var Fc=null,Zm=0,al=0,ol=null;function NA(s,a){if(Fc===null){var c=Fc=[];Zm=0,al=tg(),ol={status:"pending",value:void 0,then:function(m){c.push(m)}}}return Zm++,a.then(z_,z_),a}function z_(){if(--Zm===0&&Fc!==null){ol!==null&&(ol.status="fulfilled");var s=Fc;Fc=null,al=0,ol=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function PA(s,a){var c=[],m={status:"pending",value:null,reason:null,then:function(v){c.push(v)}};return s.then(function(){m.status="fulfilled",m.value=a;for(var v=0;v<c.length;v++)(0,c[v])(a)},function(v){for(m.status="rejected",m.reason=v,v=0;v<c.length;v++)(0,c[v])(void 0)}),m}var B_=Q.S;Q.S=function(s,a){xv=Pe(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&NA(s,a),B_!==null&&B_(s,a)};var so=B(null);function Jm(){var s=so.current;return s!==null?s:zt.pooledCache}function $d(s,a){a===null?te(so,so.current):te(so,a.pool)}function L_(){var s=Jm();return s===null?null:{parent:hn._currentValue,pool:s}}var ll=Error(r(460)),ep=Error(r(474)),qd=Error(r(542)),Gd={then:function(){}};function U_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function F_(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(Kr,Kr),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,$_(s),s;default:if(typeof a.status=="string")a.then(Kr,Kr);else{if(s=zt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=a,s.status="pending",s.then(function(m){if(a.status==="pending"){var v=a;v.status="fulfilled",v.value=m}},function(m){if(a.status==="pending"){var v=a;v.status="rejected",v.reason=m}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,$_(s),s}throw ao=a,ll}}function io(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(ao=c,ll):c}}var ao=null;function V_(){if(ao===null)throw Error(r(459));var s=ao;return ao=null,s}function $_(s){if(s===ll||s===qd)throw Error(r(483))}var cl=null,Vc=0;function Hd(s){var a=Vc;return Vc+=1,cl===null&&(cl=[]),F_(cl,s,a)}function $c(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function Qd(s,a){throw a.$$typeof===_?Error(r(525)):(s=Object.prototype.toString.call(a),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function q_(s){function a(ue,le){if(s){var fe=ue.deletions;fe===null?(ue.deletions=[le],ue.flags|=16):fe.push(le)}}function c(ue,le){if(!s)return null;for(;le!==null;)a(ue,le),le=le.sibling;return null}function m(ue){for(var le=new Map;ue!==null;)ue.key!==null?le.set(ue.key,ue):le.set(ue.index,ue),ue=ue.sibling;return le}function v(ue,le){return ue=Ks(ue,le),ue.index=0,ue.sibling=null,ue}function w(ue,le,fe){return ue.index=fe,s?(fe=ue.alternate,fe!==null?(fe=fe.index,fe<le?(ue.flags|=67108866,le):fe):(ue.flags|=67108866,le)):(ue.flags|=1048576,le)}function N(ue){return s&&ue.alternate===null&&(ue.flags|=67108866),ue}function W(ue,le,fe,Ae){return le===null||le.tag!==6?(le=Vm(fe,ue.mode,Ae),le.return=ue,le):(le=v(le,fe),le.return=ue,le)}function se(ue,le,fe,Ae){var Qe=fe.type;return Qe===x?Ce(ue,le,fe.props.children,Ae,fe.key):le!==null&&(le.elementType===Qe||typeof Qe=="object"&&Qe!==null&&Qe.$$typeof===D&&io(Qe)===le.type)?(le=v(le,fe.props),$c(le,fe),le.return=ue,le):(le=Ld(fe.type,fe.key,fe.props,null,ue.mode,Ae),$c(le,fe),le.return=ue,le)}function me(ue,le,fe,Ae){return le===null||le.tag!==4||le.stateNode.containerInfo!==fe.containerInfo||le.stateNode.implementation!==fe.implementation?(le=$m(fe,ue.mode,Ae),le.return=ue,le):(le=v(le,fe.children||[]),le.return=ue,le)}function Ce(ue,le,fe,Ae,Qe){return le===null||le.tag!==7?(le=eo(fe,ue.mode,Ae,Qe),le.return=ue,le):(le=v(le,fe),le.return=ue,le)}function Ie(ue,le,fe){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=Vm(""+le,ue.mode,fe),le.return=ue,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case b:return fe=Ld(le.type,le.key,le.props,null,ue.mode,fe),$c(fe,le),fe.return=ue,fe;case S:return le=$m(le,ue.mode,fe),le.return=ue,le;case D:return le=io(le),Ie(ue,le,fe)}if(K(le)||j(le))return le=eo(le,ue.mode,fe,null),le.return=ue,le;if(typeof le.then=="function")return Ie(ue,Hd(le),fe);if(le.$$typeof===A)return Ie(ue,Vd(ue,le),fe);Qd(ue,le)}return null}function ye(ue,le,fe,Ae){var Qe=le!==null?le.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return Qe!==null?null:W(ue,le,""+fe,Ae);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case b:return fe.key===Qe?se(ue,le,fe,Ae):null;case S:return fe.key===Qe?me(ue,le,fe,Ae):null;case D:return fe=io(fe),ye(ue,le,fe,Ae)}if(K(fe)||j(fe))return Qe!==null?null:Ce(ue,le,fe,Ae,null);if(typeof fe.then=="function")return ye(ue,le,Hd(fe),Ae);if(fe.$$typeof===A)return ye(ue,le,Vd(ue,fe),Ae);Qd(ue,fe)}return null}function ve(ue,le,fe,Ae,Qe){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return ue=ue.get(fe)||null,W(le,ue,""+Ae,Qe);if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case b:return ue=ue.get(Ae.key===null?fe:Ae.key)||null,se(le,ue,Ae,Qe);case S:return ue=ue.get(Ae.key===null?fe:Ae.key)||null,me(le,ue,Ae,Qe);case D:return Ae=io(Ae),ve(ue,le,fe,Ae,Qe)}if(K(Ae)||j(Ae))return ue=ue.get(fe)||null,Ce(le,ue,Ae,Qe,null);if(typeof Ae.then=="function")return ve(ue,le,fe,Hd(Ae),Qe);if(Ae.$$typeof===A)return ve(ue,le,fe,Vd(le,Ae),Qe);Qd(le,Ae)}return null}function Ve(ue,le,fe,Ae){for(var Qe=null,wt=null,qe=le,ot=le=0,ft=null;qe!==null&&ot<fe.length;ot++){qe.index>ot?(ft=qe,qe=null):ft=qe.sibling;var St=ye(ue,qe,fe[ot],Ae);if(St===null){qe===null&&(qe=ft);break}s&&qe&&St.alternate===null&&a(ue,qe),le=w(St,le,ot),wt===null?Qe=St:wt.sibling=St,wt=St,qe=ft}if(ot===fe.length)return c(ue,qe),yt&&Ys(ue,ot),Qe;if(qe===null){for(;ot<fe.length;ot++)qe=Ie(ue,fe[ot],Ae),qe!==null&&(le=w(qe,le,ot),wt===null?Qe=qe:wt.sibling=qe,wt=qe);return yt&&Ys(ue,ot),Qe}for(qe=m(qe);ot<fe.length;ot++)ft=ve(qe,ue,ot,fe[ot],Ae),ft!==null&&(s&&ft.alternate!==null&&qe.delete(ft.key===null?ot:ft.key),le=w(ft,le,ot),wt===null?Qe=ft:wt.sibling=ft,wt=ft);return s&&qe.forEach(function(na){return a(ue,na)}),yt&&Ys(ue,ot),Qe}function Ke(ue,le,fe,Ae){if(fe==null)throw Error(r(151));for(var Qe=null,wt=null,qe=le,ot=le=0,ft=null,St=fe.next();qe!==null&&!St.done;ot++,St=fe.next()){qe.index>ot?(ft=qe,qe=null):ft=qe.sibling;var na=ye(ue,qe,St.value,Ae);if(na===null){qe===null&&(qe=ft);break}s&&qe&&na.alternate===null&&a(ue,qe),le=w(na,le,ot),wt===null?Qe=na:wt.sibling=na,wt=na,qe=ft}if(St.done)return c(ue,qe),yt&&Ys(ue,ot),Qe;if(qe===null){for(;!St.done;ot++,St=fe.next())St=Ie(ue,St.value,Ae),St!==null&&(le=w(St,le,ot),wt===null?Qe=St:wt.sibling=St,wt=St);return yt&&Ys(ue,ot),Qe}for(qe=m(qe);!St.done;ot++,St=fe.next())St=ve(qe,ue,ot,St.value,Ae),St!==null&&(s&&St.alternate!==null&&qe.delete(St.key===null?ot:St.key),le=w(St,le,ot),wt===null?Qe=St:wt.sibling=St,wt=St);return s&&qe.forEach(function(Q5){return a(ue,Q5)}),yt&&Ys(ue,ot),Qe}function Nt(ue,le,fe,Ae){if(typeof fe=="object"&&fe!==null&&fe.type===x&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case b:e:{for(var Qe=fe.key;le!==null;){if(le.key===Qe){if(Qe=fe.type,Qe===x){if(le.tag===7){c(ue,le.sibling),Ae=v(le,fe.props.children),Ae.return=ue,ue=Ae;break e}}else if(le.elementType===Qe||typeof Qe=="object"&&Qe!==null&&Qe.$$typeof===D&&io(Qe)===le.type){c(ue,le.sibling),Ae=v(le,fe.props),$c(Ae,fe),Ae.return=ue,ue=Ae;break e}c(ue,le);break}else a(ue,le);le=le.sibling}fe.type===x?(Ae=eo(fe.props.children,ue.mode,Ae,fe.key),Ae.return=ue,ue=Ae):(Ae=Ld(fe.type,fe.key,fe.props,null,ue.mode,Ae),$c(Ae,fe),Ae.return=ue,ue=Ae)}return N(ue);case S:e:{for(Qe=fe.key;le!==null;){if(le.key===Qe)if(le.tag===4&&le.stateNode.containerInfo===fe.containerInfo&&le.stateNode.implementation===fe.implementation){c(ue,le.sibling),Ae=v(le,fe.children||[]),Ae.return=ue,ue=Ae;break e}else{c(ue,le);break}else a(ue,le);le=le.sibling}Ae=$m(fe,ue.mode,Ae),Ae.return=ue,ue=Ae}return N(ue);case D:return fe=io(fe),Nt(ue,le,fe,Ae)}if(K(fe))return Ve(ue,le,fe,Ae);if(j(fe)){if(Qe=j(fe),typeof Qe!="function")throw Error(r(150));return fe=Qe.call(fe),Ke(ue,le,fe,Ae)}if(typeof fe.then=="function")return Nt(ue,le,Hd(fe),Ae);if(fe.$$typeof===A)return Nt(ue,le,Vd(ue,fe),Ae);Qd(ue,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint"?(fe=""+fe,le!==null&&le.tag===6?(c(ue,le.sibling),Ae=v(le,fe),Ae.return=ue,ue=Ae):(c(ue,le),Ae=Vm(fe,ue.mode,Ae),Ae.return=ue,ue=Ae),N(ue)):c(ue,le)}return function(ue,le,fe,Ae){try{Vc=0;var Qe=Nt(ue,le,fe,Ae);return cl=null,Qe}catch(qe){if(qe===ll||qe===qd)throw qe;var wt=br(29,qe,null,ue.mode);return wt.lanes=Ae,wt.return=ue,wt}}}var oo=q_(!0),G_=q_(!1),Li=!1;function tp(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function np(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Ui(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Fi(s,a,c){var m=s.updateQueue;if(m===null)return null;if(m=m.shared,(Tt&2)!==0){var v=m.pending;return v===null?a.next=a:(a.next=v.next,v.next=a),m.pending=a,a=Bd(s),j_(s,null,c),a}return zd(s,m,a,c),Bd(s)}function qc(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var m=a.lanes;m&=s.pendingLanes,c|=m,a.lanes=c,yc(s,c)}}function rp(s,a){var c=s.updateQueue,m=s.alternate;if(m!==null&&(m=m.updateQueue,c===m)){var v=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var N={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};w===null?v=w=N:w=w.next=N,c=c.next}while(c!==null);w===null?v=w=a:w=w.next=a}else v=w=a;c={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:w,shared:m.shared,callbacks:m.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var sp=!1;function Gc(){if(sp){var s=ol;if(s!==null)throw s}}function Hc(s,a,c,m){sp=!1;var v=s.updateQueue;Li=!1;var w=v.firstBaseUpdate,N=v.lastBaseUpdate,W=v.shared.pending;if(W!==null){v.shared.pending=null;var se=W,me=se.next;se.next=null,N===null?w=me:N.next=me,N=se;var Ce=s.alternate;Ce!==null&&(Ce=Ce.updateQueue,W=Ce.lastBaseUpdate,W!==N&&(W===null?Ce.firstBaseUpdate=me:W.next=me,Ce.lastBaseUpdate=se))}if(w!==null){var Ie=v.baseState;N=0,Ce=me=se=null,W=w;do{var ye=W.lane&-536870913,ve=ye!==W.lane;if(ve?(ht&ye)===ye:(m&ye)===ye){ye!==0&&ye===al&&(sp=!0),Ce!==null&&(Ce=Ce.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var Ve=s,Ke=W;ye=a;var Nt=c;switch(Ke.tag){case 1:if(Ve=Ke.payload,typeof Ve=="function"){Ie=Ve.call(Nt,Ie,ye);break e}Ie=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=Ke.payload,ye=typeof Ve=="function"?Ve.call(Nt,Ie,ye):Ve,ye==null)break e;Ie=g({},Ie,ye);break e;case 2:Li=!0}}ye=W.callback,ye!==null&&(s.flags|=64,ve&&(s.flags|=8192),ve=v.callbacks,ve===null?v.callbacks=[ye]:ve.push(ye))}else ve={lane:ye,tag:W.tag,payload:W.payload,callback:W.callback,next:null},Ce===null?(me=Ce=ve,se=Ie):Ce=Ce.next=ve,N|=ye;if(W=W.next,W===null){if(W=v.shared.pending,W===null)break;ve=W,W=ve.next,ve.next=null,v.lastBaseUpdate=ve,v.shared.pending=null}}while(!0);Ce===null&&(se=Ie),v.baseState=se,v.firstBaseUpdate=me,v.lastBaseUpdate=Ce,w===null&&(v.shared.lanes=0),Hi|=N,s.lanes=N,s.memoizedState=Ie}}function H_(s,a){if(typeof s!="function")throw Error(r(191,s));s.call(a)}function Q_(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)H_(c[s],a)}var ul=B(null),Wd=B(0);function W_(s,a){s=oi,te(Wd,s),te(ul,a),oi=s|a.baseLanes}function ip(){te(Wd,oi),te(ul,ul.current)}function ap(){oi=Wd.current,$(ul),$(Wd)}var vr=B(null),Br=null;function Vi(s){var a=s.alternate;te(sn,sn.current&1),te(vr,s),Br===null&&(a===null||ul.current!==null||a.memoizedState!==null)&&(Br=s)}function op(s){te(sn,sn.current),te(vr,s),Br===null&&(Br=s)}function K_(s){s.tag===22?(te(sn,sn.current),te(vr,s),Br===null&&(Br=s)):$i()}function $i(){te(sn,sn.current),te(vr,vr.current)}function xr(s){$(vr),Br===s&&(Br=null),$(sn)}var sn=B(0);function Kd(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||fg(c)||mg(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Js=0,at=null,Ot=null,fn=null,Yd=!1,dl=!1,lo=!1,Xd=0,Qc=0,hl=null,zA=0;function en(){throw Error(r(321))}function lp(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!_r(s[c],a[c]))return!1;return!0}function cp(s,a,c,m,v,w){return Js=w,at=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Q.H=s===null||s.memoizedState===null?kb:Ep,lo=!1,w=c(m,v),lo=!1,dl&&(w=X_(a,c,m,v)),Y_(s),w}function Y_(s){Q.H=Yc;var a=Ot!==null&&Ot.next!==null;if(Js=0,fn=Ot=at=null,Yd=!1,Qc=0,hl=null,a)throw Error(r(300));s===null||mn||(s=s.dependencies,s!==null&&Fd(s)&&(mn=!0))}function X_(s,a,c,m){at=s;var v=0;do{if(dl&&(hl=null),Qc=0,dl=!1,25<=v)throw Error(r(301));if(v+=1,fn=Ot=null,s.updateQueue!=null){var w=s.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}Q.H=Ob,w=a(c,m)}while(dl);return w}function BA(){var s=Q.H,a=s.useState()[0];return a=typeof a.then=="function"?Wc(a):a,s=s.useState()[0],(Ot!==null?Ot.memoizedState:null)!==s&&(at.flags|=1024),a}function up(){var s=Xd!==0;return Xd=0,s}function dp(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function hp(s){if(Yd){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}Yd=!1}Js=0,fn=Ot=at=null,dl=!1,Qc=Xd=0,hl=null}function nr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return fn===null?at.memoizedState=fn=s:fn=fn.next=s,fn}function an(){if(Ot===null){var s=at.alternate;s=s!==null?s.memoizedState:null}else s=Ot.next;var a=fn===null?at.memoizedState:fn.next;if(a!==null)fn=a,Ot=s;else{if(s===null)throw at.alternate===null?Error(r(467)):Error(r(310));Ot=s,s={memoizedState:Ot.memoizedState,baseState:Ot.baseState,baseQueue:Ot.baseQueue,queue:Ot.queue,next:null},fn===null?at.memoizedState=fn=s:fn=fn.next=s}return fn}function Zd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Wc(s){var a=Qc;return Qc+=1,hl===null&&(hl=[]),s=F_(hl,s,a),a=at,(fn===null?a.memoizedState:fn.next)===null&&(a=a.alternate,Q.H=a===null||a.memoizedState===null?kb:Ep),s}function Jd(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Wc(s);if(s.$$typeof===A)return Pn(s)}throw Error(r(438,String(s)))}function fp(s){var a=null,c=at.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var m=at.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(a={data:m.data.map(function(v){return v.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=Zd(),at.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),m=0;m<s;m++)c[m]=L;return a.index++,c}function ei(s,a){return typeof a=="function"?a(s):a}function eh(s){var a=an();return mp(a,Ot,s)}function mp(s,a,c){var m=s.queue;if(m===null)throw Error(r(311));m.lastRenderedReducer=c;var v=s.baseQueue,w=m.pending;if(w!==null){if(v!==null){var N=v.next;v.next=w.next,w.next=N}a.baseQueue=v=w,m.pending=null}if(w=s.baseState,v===null)s.memoizedState=w;else{a=v.next;var W=N=null,se=null,me=a,Ce=!1;do{var Ie=me.lane&-536870913;if(Ie!==me.lane?(ht&Ie)===Ie:(Js&Ie)===Ie){var ye=me.revertLane;if(ye===0)se!==null&&(se=se.next={lane:0,revertLane:0,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null}),Ie===al&&(Ce=!0);else if((Js&ye)===ye){me=me.next,ye===al&&(Ce=!0);continue}else Ie={lane:0,revertLane:me.revertLane,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},se===null?(W=se=Ie,N=w):se=se.next=Ie,at.lanes|=ye,Hi|=ye;Ie=me.action,lo&&c(w,Ie),w=me.hasEagerState?me.eagerState:c(w,Ie)}else ye={lane:Ie,revertLane:me.revertLane,gesture:me.gesture,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},se===null?(W=se=ye,N=w):se=se.next=ye,at.lanes|=Ie,Hi|=Ie;me=me.next}while(me!==null&&me!==a);if(se===null?N=w:se.next=W,!_r(w,s.memoizedState)&&(mn=!0,Ce&&(c=ol,c!==null)))throw c;s.memoizedState=w,s.baseState=N,s.baseQueue=se,m.lastRenderedState=w}return v===null&&(m.lanes=0),[s.memoizedState,m.dispatch]}function pp(s){var a=an(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var m=c.dispatch,v=c.pending,w=a.memoizedState;if(v!==null){c.pending=null;var N=v=v.next;do w=s(w,N.action),N=N.next;while(N!==v);_r(w,a.memoizedState)||(mn=!0),a.memoizedState=w,a.baseQueue===null&&(a.baseState=w),c.lastRenderedState=w}return[w,m]}function Z_(s,a,c){var m=at,v=an(),w=yt;if(w){if(c===void 0)throw Error(r(407));c=c()}else c=a();var N=!_r((Ot||v).memoizedState,c);if(N&&(v.memoizedState=c,mn=!0),v=v.queue,_p(tb.bind(null,m,v,s),[s]),v.getSnapshot!==a||N||fn!==null&&fn.memoizedState.tag&1){if(m.flags|=2048,fl(9,{destroy:void 0},eb.bind(null,m,v,c,a),null),zt===null)throw Error(r(349));w||(Js&127)!==0||J_(m,a,c)}return c}function J_(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=at.updateQueue,a===null?(a=Zd(),at.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function eb(s,a,c,m){a.value=c,a.getSnapshot=m,nb(a)&&rb(s)}function tb(s,a,c){return c(function(){nb(a)&&rb(s)})}function nb(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!_r(s,c)}catch{return!0}}function rb(s){var a=Ja(s,2);a!==null&&dr(a,s,2)}function gp(s){var a=nr();if(typeof s=="function"){var c=s;if(s=c(),lo){Qn(!0);try{c()}finally{Qn(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:s},a}function sb(s,a,c,m){return s.baseState=c,mp(s,Ot,typeof m=="function"?m:ei)}function LA(s,a,c,m,v){if(rh(s))throw Error(r(485));if(s=a.action,s!==null){var w={payload:v,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(N){w.listeners.push(N)}};Q.T!==null?c(!0):w.isTransition=!1,m(w),c=a.pending,c===null?(w.next=a.pending=w,ib(a,w)):(w.next=c.next,a.pending=c.next=w)}}function ib(s,a){var c=a.action,m=a.payload,v=s.state;if(a.isTransition){var w=Q.T,N={};Q.T=N;try{var W=c(v,m),se=Q.S;se!==null&&se(N,W),ab(s,a,W)}catch(me){yp(s,a,me)}finally{w!==null&&N.types!==null&&(w.types=N.types),Q.T=w}}else try{w=c(v,m),ab(s,a,w)}catch(me){yp(s,a,me)}}function ab(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(m){ob(s,a,m)},function(m){return yp(s,a,m)}):ob(s,a,c)}function ob(s,a,c){a.status="fulfilled",a.value=c,lb(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,ib(s,c)))}function yp(s,a,c){var m=s.pending;if(s.pending=null,m!==null){m=m.next;do a.status="rejected",a.reason=c,lb(a),a=a.next;while(a!==m)}s.action=null}function lb(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function cb(s,a){return a}function ub(s,a){if(yt){var c=zt.formState;if(c!==null){e:{var m=at;if(yt){if(Ft){t:{for(var v=Ft,w=zr;v.nodeType!==8;){if(!w){v=null;break t}if(v=Lr(v.nextSibling),v===null){v=null;break t}}w=v.data,v=w==="F!"||w==="F"?v:null}if(v){Ft=Lr(v.nextSibling),m=v.data==="F!";break e}}zi(m)}m=!1}m&&(a=c[0])}}return c=nr(),c.memoizedState=c.baseState=a,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cb,lastRenderedState:a},c.queue=m,c=Rb.bind(null,at,m),m.dispatch=c,m=gp(!1),w=Sp.bind(null,at,!1,m.queue),m=nr(),v={state:a,dispatch:null,action:s,pending:null},m.queue=v,c=LA.bind(null,at,v,w,c),v.dispatch=c,m.memoizedState=s,[a,c,!1]}function db(s){var a=an();return hb(a,Ot,s)}function hb(s,a,c){if(a=mp(s,a,cb)[0],s=eh(ei)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var m=Wc(a)}catch(N){throw N===ll?qd:N}else m=a;a=an();var v=a.queue,w=v.dispatch;return c!==a.memoizedState&&(at.flags|=2048,fl(9,{destroy:void 0},UA.bind(null,v,c),null)),[m,w,s]}function UA(s,a){s.action=a}function fb(s){var a=an(),c=Ot;if(c!==null)return hb(a,c,s);an(),a=a.memoizedState,c=an();var m=c.queue.dispatch;return c.memoizedState=s,[a,m,!1]}function fl(s,a,c,m){return s={tag:s,create:c,deps:m,inst:a,next:null},a=at.updateQueue,a===null&&(a=Zd(),at.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(m=c.next,c.next=s,s.next=m,a.lastEffect=s),s}function mb(){return an().memoizedState}function th(s,a,c,m){var v=nr();at.flags|=s,v.memoizedState=fl(1|a,{destroy:void 0},c,m===void 0?null:m)}function nh(s,a,c,m){var v=an();m=m===void 0?null:m;var w=v.memoizedState.inst;Ot!==null&&m!==null&&lp(m,Ot.memoizedState.deps)?v.memoizedState=fl(a,w,c,m):(at.flags|=s,v.memoizedState=fl(1|a,w,c,m))}function pb(s,a){th(8390656,8,s,a)}function _p(s,a){nh(2048,8,s,a)}function FA(s){at.flags|=4;var a=at.updateQueue;if(a===null)a=Zd(),at.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function gb(s){var a=an().memoizedState;return FA({ref:a,nextImpl:s}),function(){if((Tt&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function yb(s,a){return nh(4,2,s,a)}function _b(s,a){return nh(4,4,s,a)}function bb(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function vb(s,a,c){c=c!=null?c.concat([s]):null,nh(4,4,bb.bind(null,a,s),c)}function bp(){}function xb(s,a){var c=an();a=a===void 0?null:a;var m=c.memoizedState;return a!==null&&lp(a,m[1])?m[0]:(c.memoizedState=[s,a],s)}function wb(s,a){var c=an();a=a===void 0?null:a;var m=c.memoizedState;if(a!==null&&lp(a,m[1]))return m[0];if(m=s(),lo){Qn(!0);try{s()}finally{Qn(!1)}}return c.memoizedState=[m,a],m}function vp(s,a,c){return c===void 0||(Js&1073741824)!==0&&(ht&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=Sv(),at.lanes|=s,Hi|=s,c)}function Sb(s,a,c,m){return _r(c,a)?c:ul.current!==null?(s=vp(s,c,m),_r(s,a)||(mn=!0),s):(Js&42)===0||(Js&1073741824)!==0&&(ht&261930)===0?(mn=!0,s.memoizedState=c):(s=Sv(),at.lanes|=s,Hi|=s,a)}function Eb(s,a,c,m,v){var w=G.p;G.p=w!==0&&8>w?w:8;var N=Q.T,W={};Q.T=W,Sp(s,!1,a,c);try{var se=v(),me=Q.S;if(me!==null&&me(W,se),se!==null&&typeof se=="object"&&typeof se.then=="function"){var Ce=PA(se,m);Kc(s,a,Ce,Er(s))}else Kc(s,a,m,Er(s))}catch(Ie){Kc(s,a,{then:function(){},status:"rejected",reason:Ie},Er())}finally{G.p=w,N!==null&&W.types!==null&&(N.types=W.types),Q.T=N}}function VA(){}function xp(s,a,c,m){if(s.tag!==5)throw Error(r(476));var v=Cb(s).queue;Eb(s,v,a,X,c===null?VA:function(){return Tb(s),c(m)})}function Cb(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:X,baseState:X,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:X},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function Tb(s){var a=Cb(s);a.next===null&&(a=s.alternate.memoizedState),Kc(s,a.next.queue,{},Er())}function wp(){return Pn(hu)}function Ab(){return an().memoizedState}function jb(){return an().memoizedState}function $A(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=Er();s=Ui(c);var m=Fi(a,s,c);m!==null&&(dr(m,a,c),qc(m,a,c)),a={cache:Xm()},s.payload=a;return}a=a.return}}function qA(s,a,c){var m=Er();c={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},rh(s)?Ib(a,c):(c=Um(s,a,c,m),c!==null&&(dr(c,s,m),Db(c,a,m)))}function Rb(s,a,c){var m=Er();Kc(s,a,c,m)}function Kc(s,a,c,m){var v={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(rh(s))Ib(a,v);else{var w=s.alternate;if(s.lanes===0&&(w===null||w.lanes===0)&&(w=a.lastRenderedReducer,w!==null))try{var N=a.lastRenderedState,W=w(N,c);if(v.hasEagerState=!0,v.eagerState=W,_r(W,N))return zd(s,a,v,0),zt===null&&Pd(),!1}catch{}if(c=Um(s,a,v,m),c!==null)return dr(c,s,m),Db(c,a,m),!0}return!1}function Sp(s,a,c,m){if(m={lane:2,revertLane:tg(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},rh(s)){if(a)throw Error(r(479))}else a=Um(s,c,m,2),a!==null&&dr(a,s,2)}function rh(s){var a=s.alternate;return s===at||a!==null&&a===at}function Ib(s,a){dl=Yd=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function Db(s,a,c){if((c&4194048)!==0){var m=a.lanes;m&=s.pendingLanes,c|=m,a.lanes=c,yc(s,c)}}var Yc={readContext:Pn,use:Jd,useCallback:en,useContext:en,useEffect:en,useImperativeHandle:en,useLayoutEffect:en,useInsertionEffect:en,useMemo:en,useReducer:en,useRef:en,useState:en,useDebugValue:en,useDeferredValue:en,useTransition:en,useSyncExternalStore:en,useId:en,useHostTransitionStatus:en,useFormState:en,useActionState:en,useOptimistic:en,useMemoCache:en,useCacheRefresh:en};Yc.useEffectEvent=en;var kb={readContext:Pn,use:Jd,useCallback:function(s,a){return nr().memoizedState=[s,a===void 0?null:a],s},useContext:Pn,useEffect:pb,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,th(4194308,4,bb.bind(null,a,s),c)},useLayoutEffect:function(s,a){return th(4194308,4,s,a)},useInsertionEffect:function(s,a){th(4,2,s,a)},useMemo:function(s,a){var c=nr();a=a===void 0?null:a;var m=s();if(lo){Qn(!0);try{s()}finally{Qn(!1)}}return c.memoizedState=[m,a],m},useReducer:function(s,a,c){var m=nr();if(c!==void 0){var v=c(a);if(lo){Qn(!0);try{c(a)}finally{Qn(!1)}}}else v=a;return m.memoizedState=m.baseState=v,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:v},m.queue=s,s=s.dispatch=qA.bind(null,at,s),[m.memoizedState,s]},useRef:function(s){var a=nr();return s={current:s},a.memoizedState=s},useState:function(s){s=gp(s);var a=s.queue,c=Rb.bind(null,at,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:bp,useDeferredValue:function(s,a){var c=nr();return vp(c,s,a)},useTransition:function(){var s=gp(!1);return s=Eb.bind(null,at,s.queue,!0,!1),nr().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var m=at,v=nr();if(yt){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),zt===null)throw Error(r(349));(ht&127)!==0||J_(m,a,c)}v.memoizedState=c;var w={value:c,getSnapshot:a};return v.queue=w,pb(tb.bind(null,m,w,s),[s]),m.flags|=2048,fl(9,{destroy:void 0},eb.bind(null,m,w,c,a),null),c},useId:function(){var s=nr(),a=zt.identifierPrefix;if(yt){var c=Is,m=Rs;c=(m&~(1<<32-Et(m)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Xd++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=zA++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:wp,useFormState:ub,useActionState:ub,useOptimistic:function(s){var a=nr();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=Sp.bind(null,at,!0,c),c.dispatch=a,[s,a]},useMemoCache:fp,useCacheRefresh:function(){return nr().memoizedState=$A.bind(null,at)},useEffectEvent:function(s){var a=nr(),c={impl:s};return a.memoizedState=c,function(){if((Tt&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},Ep={readContext:Pn,use:Jd,useCallback:xb,useContext:Pn,useEffect:_p,useImperativeHandle:vb,useInsertionEffect:yb,useLayoutEffect:_b,useMemo:wb,useReducer:eh,useRef:mb,useState:function(){return eh(ei)},useDebugValue:bp,useDeferredValue:function(s,a){var c=an();return Sb(c,Ot.memoizedState,s,a)},useTransition:function(){var s=eh(ei)[0],a=an().memoizedState;return[typeof s=="boolean"?s:Wc(s),a]},useSyncExternalStore:Z_,useId:Ab,useHostTransitionStatus:wp,useFormState:db,useActionState:db,useOptimistic:function(s,a){var c=an();return sb(c,Ot,s,a)},useMemoCache:fp,useCacheRefresh:jb};Ep.useEffectEvent=gb;var Ob={readContext:Pn,use:Jd,useCallback:xb,useContext:Pn,useEffect:_p,useImperativeHandle:vb,useInsertionEffect:yb,useLayoutEffect:_b,useMemo:wb,useReducer:pp,useRef:mb,useState:function(){return pp(ei)},useDebugValue:bp,useDeferredValue:function(s,a){var c=an();return Ot===null?vp(c,s,a):Sb(c,Ot.memoizedState,s,a)},useTransition:function(){var s=pp(ei)[0],a=an().memoizedState;return[typeof s=="boolean"?s:Wc(s),a]},useSyncExternalStore:Z_,useId:Ab,useHostTransitionStatus:wp,useFormState:fb,useActionState:fb,useOptimistic:function(s,a){var c=an();return Ot!==null?sb(c,Ot,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:fp,useCacheRefresh:jb};Ob.useEffectEvent=gb;function Cp(s,a,c,m){a=s.memoizedState,c=c(m,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var Tp={enqueueSetState:function(s,a,c){s=s._reactInternals;var m=Er(),v=Ui(m);v.payload=a,c!=null&&(v.callback=c),a=Fi(s,v,m),a!==null&&(dr(a,s,m),qc(a,s,m))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var m=Er(),v=Ui(m);v.tag=1,v.payload=a,c!=null&&(v.callback=c),a=Fi(s,v,m),a!==null&&(dr(a,s,m),qc(a,s,m))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=Er(),m=Ui(c);m.tag=2,a!=null&&(m.callback=a),a=Fi(s,m,c),a!==null&&(dr(a,s,c),qc(a,s,c))}};function Mb(s,a,c,m,v,w,N){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(m,w,N):a.prototype&&a.prototype.isPureReactComponent?!Pc(c,m)||!Pc(v,w):!0}function Nb(s,a,c,m){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,m),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,m),a.state!==s&&Tp.enqueueReplaceState(a,a.state,null)}function co(s,a){var c=a;if("ref"in a){c={};for(var m in a)m!=="ref"&&(c[m]=a[m])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var v in s)c[v]===void 0&&(c[v]=s[v])}return c}function Pb(s){Nd(s)}function zb(s){console.error(s)}function Bb(s){Nd(s)}function sh(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(m){setTimeout(function(){throw m})}}function Lb(s,a,c){try{var m=s.onCaughtError;m(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function Ap(s,a,c){return c=Ui(c),c.tag=3,c.payload={element:null},c.callback=function(){sh(s,a)},c}function Ub(s){return s=Ui(s),s.tag=3,s}function Fb(s,a,c,m){var v=c.type.getDerivedStateFromError;if(typeof v=="function"){var w=m.value;s.payload=function(){return v(w)},s.callback=function(){Lb(a,c,m)}}var N=c.stateNode;N!==null&&typeof N.componentDidCatch=="function"&&(s.callback=function(){Lb(a,c,m),typeof v!="function"&&(Qi===null?Qi=new Set([this]):Qi.add(this));var W=m.stack;this.componentDidCatch(m.value,{componentStack:W!==null?W:""})})}function GA(s,a,c,m,v){if(c.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(a=c.alternate,a!==null&&il(a,c,v,!0),c=vr.current,c!==null){switch(c.tag){case 31:case 13:return Br===null?gh():c.alternate===null&&tn===0&&(tn=3),c.flags&=-257,c.flags|=65536,c.lanes=v,m===Gd?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([m]):a.add(m),Zp(s,m,v)),!1;case 22:return c.flags|=65536,m===Gd?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([m])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([m]):c.add(m)),Zp(s,m,v)),!1}throw Error(r(435,c.tag))}return Zp(s,m,v),gh(),!1}if(yt)return a=vr.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=v,m!==Hm&&(s=Error(r(422),{cause:m}),Lc(Mr(s,c)))):(m!==Hm&&(a=Error(r(423),{cause:m}),Lc(Mr(a,c))),s=s.current.alternate,s.flags|=65536,v&=-v,s.lanes|=v,m=Mr(m,c),v=Ap(s.stateNode,m,v),rp(s,v),tn!==4&&(tn=2)),!1;var w=Error(r(520),{cause:m});if(w=Mr(w,c),su===null?su=[w]:su.push(w),tn!==4&&(tn=2),a===null)return!0;m=Mr(m,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=v&-v,c.lanes|=s,s=Ap(c.stateNode,m,s),rp(c,s),!1;case 1:if(a=c.type,w=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Qi===null||!Qi.has(w))))return c.flags|=65536,v&=-v,c.lanes|=v,v=Ub(v),Fb(v,s,c,m),rp(c,v),!1}c=c.return}while(c!==null);return!1}var jp=Error(r(461)),mn=!1;function zn(s,a,c,m){a.child=s===null?G_(a,null,c,m):oo(a,s.child,c,m)}function Vb(s,a,c,m,v){c=c.render;var w=a.ref;if("ref"in m){var N={};for(var W in m)W!=="ref"&&(N[W]=m[W])}else N=m;return ro(a),m=cp(s,a,c,N,w,v),W=up(),s!==null&&!mn?(dp(s,a,v),ti(s,a,v)):(yt&&W&&qm(a),a.flags|=1,zn(s,a,m,v),a.child)}function $b(s,a,c,m,v){if(s===null){var w=c.type;return typeof w=="function"&&!Fm(w)&&w.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=w,qb(s,a,w,m,v)):(s=Ld(c.type,null,m,a,a.mode,v),s.ref=a.ref,s.return=a,a.child=s)}if(w=s.child,!Pp(s,v)){var N=w.memoizedProps;if(c=c.compare,c=c!==null?c:Pc,c(N,m)&&s.ref===a.ref)return ti(s,a,v)}return a.flags|=1,s=Ks(w,m),s.ref=a.ref,s.return=a,a.child=s}function qb(s,a,c,m,v){if(s!==null){var w=s.memoizedProps;if(Pc(w,m)&&s.ref===a.ref)if(mn=!1,a.pendingProps=m=w,Pp(s,v))(s.flags&131072)!==0&&(mn=!0);else return a.lanes=s.lanes,ti(s,a,v)}return Rp(s,a,c,m,v)}function Gb(s,a,c,m){var v=m.children,w=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((a.flags&128)!==0){if(w=w!==null?w.baseLanes|c:c,s!==null){for(m=a.child=s.child,v=0;m!==null;)v=v|m.lanes|m.childLanes,m=m.sibling;m=v&~w}else m=0,a.child=null;return Hb(s,a,w,c,m)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&$d(a,w!==null?w.cachePool:null),w!==null?W_(a,w):ip(),K_(a);else return m=a.lanes=536870912,Hb(s,a,w!==null?w.baseLanes|c:c,c,m)}else w!==null?($d(a,w.cachePool),W_(a,w),$i(),a.memoizedState=null):(s!==null&&$d(a,null),ip(),$i());return zn(s,a,v,c),a.child}function Xc(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Hb(s,a,c,m,v){var w=Jm();return w=w===null?null:{parent:hn._currentValue,pool:w},a.memoizedState={baseLanes:c,cachePool:w},s!==null&&$d(a,null),ip(),K_(a),s!==null&&il(s,a,m,!0),a.childLanes=v,null}function ih(s,a){return a=oh({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function Qb(s,a,c){return oo(a,s.child,null,c),s=ih(a,a.pendingProps),s.flags|=2,xr(a),a.memoizedState=null,s}function HA(s,a,c){var m=a.pendingProps,v=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(yt){if(m.mode==="hidden")return s=ih(a,m),a.lanes=536870912,Xc(null,s);if(op(a),(s=Ft)?(s=ix(s,zr),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Ni!==null?{id:Rs,overflow:Is}:null,retryLane:536870912,hydrationErrors:null},c=I_(s),c.return=a,a.child=c,Nn=a,Ft=null)):s=null,s===null)throw zi(a);return a.lanes=536870912,null}return ih(a,m)}var w=s.memoizedState;if(w!==null){var N=w.dehydrated;if(op(a),v)if(a.flags&256)a.flags&=-257,a=Qb(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(r(558));else if(mn||il(s,a,c,!1),v=(c&s.childLanes)!==0,mn||v){if(m=zt,m!==null&&(N=_c(m,c),N!==0&&N!==w.retryLane))throw w.retryLane=N,Ja(s,N),dr(m,s,N),jp;gh(),a=Qb(s,a,c)}else s=w.treeContext,Ft=Lr(N.nextSibling),Nn=a,yt=!0,Pi=null,zr=!1,s!==null&&O_(a,s),a=ih(a,m),a.flags|=4096;return a}return s=Ks(s.child,{mode:m.mode,children:m.children}),s.ref=a.ref,a.child=s,s.return=a,s}function ah(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function Rp(s,a,c,m,v){return ro(a),c=cp(s,a,c,m,void 0,v),m=up(),s!==null&&!mn?(dp(s,a,v),ti(s,a,v)):(yt&&m&&qm(a),a.flags|=1,zn(s,a,c,v),a.child)}function Wb(s,a,c,m,v,w){return ro(a),a.updateQueue=null,c=X_(a,m,c,v),Y_(s),m=up(),s!==null&&!mn?(dp(s,a,w),ti(s,a,w)):(yt&&m&&qm(a),a.flags|=1,zn(s,a,c,w),a.child)}function Kb(s,a,c,m,v){if(ro(a),a.stateNode===null){var w=tl,N=c.contextType;typeof N=="object"&&N!==null&&(w=Pn(N)),w=new c(m,w),a.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=Tp,a.stateNode=w,w._reactInternals=a,w=a.stateNode,w.props=m,w.state=a.memoizedState,w.refs={},tp(a),N=c.contextType,w.context=typeof N=="object"&&N!==null?Pn(N):tl,w.state=a.memoizedState,N=c.getDerivedStateFromProps,typeof N=="function"&&(Cp(a,c,N,m),w.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(N=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),N!==w.state&&Tp.enqueueReplaceState(w,w.state,null),Hc(a,m,w,v),Gc(),w.state=a.memoizedState),typeof w.componentDidMount=="function"&&(a.flags|=4194308),m=!0}else if(s===null){w=a.stateNode;var W=a.memoizedProps,se=co(c,W);w.props=se;var me=w.context,Ce=c.contextType;N=tl,typeof Ce=="object"&&Ce!==null&&(N=Pn(Ce));var Ie=c.getDerivedStateFromProps;Ce=typeof Ie=="function"||typeof w.getSnapshotBeforeUpdate=="function",W=a.pendingProps!==W,Ce||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(W||me!==N)&&Nb(a,w,m,N),Li=!1;var ye=a.memoizedState;w.state=ye,Hc(a,m,w,v),Gc(),me=a.memoizedState,W||ye!==me||Li?(typeof Ie=="function"&&(Cp(a,c,Ie,m),me=a.memoizedState),(se=Li||Mb(a,c,se,m,ye,me,N))?(Ce||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(a.flags|=4194308)):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=m,a.memoizedState=me),w.props=m,w.state=me,w.context=N,m=se):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),m=!1)}else{w=a.stateNode,np(s,a),N=a.memoizedProps,Ce=co(c,N),w.props=Ce,Ie=a.pendingProps,ye=w.context,me=c.contextType,se=tl,typeof me=="object"&&me!==null&&(se=Pn(me)),W=c.getDerivedStateFromProps,(me=typeof W=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(N!==Ie||ye!==se)&&Nb(a,w,m,se),Li=!1,ye=a.memoizedState,w.state=ye,Hc(a,m,w,v),Gc();var ve=a.memoizedState;N!==Ie||ye!==ve||Li||s!==null&&s.dependencies!==null&&Fd(s.dependencies)?(typeof W=="function"&&(Cp(a,c,W,m),ve=a.memoizedState),(Ce=Li||Mb(a,c,Ce,m,ye,ve,se)||s!==null&&s.dependencies!==null&&Fd(s.dependencies))?(me||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(m,ve,se),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(m,ve,se)),typeof w.componentDidUpdate=="function"&&(a.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof w.componentDidUpdate!="function"||N===s.memoizedProps&&ye===s.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||N===s.memoizedProps&&ye===s.memoizedState||(a.flags|=1024),a.memoizedProps=m,a.memoizedState=ve),w.props=m,w.state=ve,w.context=se,m=Ce):(typeof w.componentDidUpdate!="function"||N===s.memoizedProps&&ye===s.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||N===s.memoizedProps&&ye===s.memoizedState||(a.flags|=1024),m=!1)}return w=m,ah(s,a),m=(a.flags&128)!==0,w||m?(w=a.stateNode,c=m&&typeof c.getDerivedStateFromError!="function"?null:w.render(),a.flags|=1,s!==null&&m?(a.child=oo(a,s.child,null,v),a.child=oo(a,null,c,v)):zn(s,a,c,v),a.memoizedState=w.state,s=a.child):s=ti(s,a,v),s}function Yb(s,a,c,m){return to(),a.flags|=256,zn(s,a,c,m),a.child}var Ip={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Dp(s){return{baseLanes:s,cachePool:L_()}}function kp(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=Sr),s}function Xb(s,a,c){var m=a.pendingProps,v=!1,w=(a.flags&128)!==0,N;if((N=w)||(N=s!==null&&s.memoizedState===null?!1:(sn.current&2)!==0),N&&(v=!0,a.flags&=-129),N=(a.flags&32)!==0,a.flags&=-33,s===null){if(yt){if(v?Vi(a):$i(),(s=Ft)?(s=ix(s,zr),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Ni!==null?{id:Rs,overflow:Is}:null,retryLane:536870912,hydrationErrors:null},c=I_(s),c.return=a,a.child=c,Nn=a,Ft=null)):s=null,s===null)throw zi(a);return mg(s)?a.lanes=32:a.lanes=536870912,null}var W=m.children;return m=m.fallback,v?($i(),v=a.mode,W=oh({mode:"hidden",children:W},v),m=eo(m,v,c,null),W.return=a,m.return=a,W.sibling=m,a.child=W,m=a.child,m.memoizedState=Dp(c),m.childLanes=kp(s,N,c),a.memoizedState=Ip,Xc(null,m)):(Vi(a),Op(a,W))}var se=s.memoizedState;if(se!==null&&(W=se.dehydrated,W!==null)){if(w)a.flags&256?(Vi(a),a.flags&=-257,a=Mp(s,a,c)):a.memoizedState!==null?($i(),a.child=s.child,a.flags|=128,a=null):($i(),W=m.fallback,v=a.mode,m=oh({mode:"visible",children:m.children},v),W=eo(W,v,c,null),W.flags|=2,m.return=a,W.return=a,m.sibling=W,a.child=m,oo(a,s.child,null,c),m=a.child,m.memoizedState=Dp(c),m.childLanes=kp(s,N,c),a.memoizedState=Ip,a=Xc(null,m));else if(Vi(a),mg(W)){if(N=W.nextSibling&&W.nextSibling.dataset,N)var me=N.dgst;N=me,m=Error(r(419)),m.stack="",m.digest=N,Lc({value:m,source:null,stack:null}),a=Mp(s,a,c)}else if(mn||il(s,a,c,!1),N=(c&s.childLanes)!==0,mn||N){if(N=zt,N!==null&&(m=_c(N,c),m!==0&&m!==se.retryLane))throw se.retryLane=m,Ja(s,m),dr(N,s,m),jp;fg(W)||gh(),a=Mp(s,a,c)}else fg(W)?(a.flags|=192,a.child=s.child,a=null):(s=se.treeContext,Ft=Lr(W.nextSibling),Nn=a,yt=!0,Pi=null,zr=!1,s!==null&&O_(a,s),a=Op(a,m.children),a.flags|=4096);return a}return v?($i(),W=m.fallback,v=a.mode,se=s.child,me=se.sibling,m=Ks(se,{mode:"hidden",children:m.children}),m.subtreeFlags=se.subtreeFlags&65011712,me!==null?W=Ks(me,W):(W=eo(W,v,c,null),W.flags|=2),W.return=a,m.return=a,m.sibling=W,a.child=m,Xc(null,m),m=a.child,W=s.child.memoizedState,W===null?W=Dp(c):(v=W.cachePool,v!==null?(se=hn._currentValue,v=v.parent!==se?{parent:se,pool:se}:v):v=L_(),W={baseLanes:W.baseLanes|c,cachePool:v}),m.memoizedState=W,m.childLanes=kp(s,N,c),a.memoizedState=Ip,Xc(s.child,m)):(Vi(a),c=s.child,s=c.sibling,c=Ks(c,{mode:"visible",children:m.children}),c.return=a,c.sibling=null,s!==null&&(N=a.deletions,N===null?(a.deletions=[s],a.flags|=16):N.push(s)),a.child=c,a.memoizedState=null,c)}function Op(s,a){return a=oh({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function oh(s,a){return s=br(22,s,null,a),s.lanes=0,s}function Mp(s,a,c){return oo(a,s.child,null,c),s=Op(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function Zb(s,a,c){s.lanes|=a;var m=s.alternate;m!==null&&(m.lanes|=a),Km(s.return,a,c)}function Np(s,a,c,m,v,w){var N=s.memoizedState;N===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:m,tail:c,tailMode:v,treeForkCount:w}:(N.isBackwards=a,N.rendering=null,N.renderingStartTime=0,N.last=m,N.tail=c,N.tailMode=v,N.treeForkCount=w)}function Jb(s,a,c){var m=a.pendingProps,v=m.revealOrder,w=m.tail;m=m.children;var N=sn.current,W=(N&2)!==0;if(W?(N=N&1|2,a.flags|=128):N&=1,te(sn,N),zn(s,a,m,c),m=yt?Bc:0,!W&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Zb(s,c,a);else if(s.tag===19)Zb(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(v){case"forwards":for(c=a.child,v=null;c!==null;)s=c.alternate,s!==null&&Kd(s)===null&&(v=c),c=c.sibling;c=v,c===null?(v=a.child,a.child=null):(v=c.sibling,c.sibling=null),Np(a,!1,v,c,w,m);break;case"backwards":case"unstable_legacy-backwards":for(c=null,v=a.child,a.child=null;v!==null;){if(s=v.alternate,s!==null&&Kd(s)===null){a.child=v;break}s=v.sibling,v.sibling=c,c=v,v=s}Np(a,!0,c,null,w,m);break;case"together":Np(a,!1,null,null,void 0,m);break;default:a.memoizedState=null}return a.child}function ti(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),Hi|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(il(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(r(153));if(a.child!==null){for(s=a.child,c=Ks(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=Ks(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Pp(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&Fd(s)))}function QA(s,a,c){switch(a.tag){case 3:Te(a,a.stateNode.containerInfo),Bi(a,hn,s.memoizedState.cache),to();break;case 27:case 5:pe(a);break;case 4:Te(a,a.stateNode.containerInfo);break;case 10:Bi(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,op(a),null;break;case 13:var m=a.memoizedState;if(m!==null)return m.dehydrated!==null?(Vi(a),a.flags|=128,null):(c&a.child.childLanes)!==0?Xb(s,a,c):(Vi(a),s=ti(s,a,c),s!==null?s.sibling:null);Vi(a);break;case 19:var v=(s.flags&128)!==0;if(m=(c&a.childLanes)!==0,m||(il(s,a,c,!1),m=(c&a.childLanes)!==0),v){if(m)return Jb(s,a,c);a.flags|=128}if(v=a.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),te(sn,sn.current),m)break;return null;case 22:return a.lanes=0,Gb(s,a,c,a.pendingProps);case 24:Bi(a,hn,s.memoizedState.cache)}return ti(s,a,c)}function ev(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)mn=!0;else{if(!Pp(s,c)&&(a.flags&128)===0)return mn=!1,QA(s,a,c);mn=(s.flags&131072)!==0}else mn=!1,yt&&(a.flags&1048576)!==0&&k_(a,Bc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var m=a.pendingProps;if(s=io(a.elementType),a.type=s,typeof s=="function")Fm(s)?(m=co(s,m),a.tag=1,a=Kb(null,a,s,m,c)):(a.tag=0,a=Rp(null,a,s,m,c));else{if(s!=null){var v=s.$$typeof;if(v===U){a.tag=11,a=Vb(null,a,s,m,c);break e}else if(v===O){a.tag=14,a=$b(null,a,s,m,c);break e}}throw a=R(s)||s,Error(r(306,a,""))}}return a;case 0:return Rp(s,a,a.type,a.pendingProps,c);case 1:return m=a.type,v=co(m,a.pendingProps),Kb(s,a,m,v,c);case 3:e:{if(Te(a,a.stateNode.containerInfo),s===null)throw Error(r(387));m=a.pendingProps;var w=a.memoizedState;v=w.element,np(s,a),Hc(a,m,null,c);var N=a.memoizedState;if(m=N.cache,Bi(a,hn,m),m!==w.cache&&Ym(a,[hn],c,!0),Gc(),m=N.element,w.isDehydrated)if(w={element:m,isDehydrated:!1,cache:N.cache},a.updateQueue.baseState=w,a.memoizedState=w,a.flags&256){a=Yb(s,a,m,c);break e}else if(m!==v){v=Mr(Error(r(424)),a),Lc(v),a=Yb(s,a,m,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,Ft=Lr(s.firstChild),Nn=a,yt=!0,Pi=null,zr=!0,c=G_(a,null,m,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(to(),m===v){a=ti(s,a,c);break e}zn(s,a,m,c)}a=a.child}return a;case 26:return ah(s,a),s===null?(c=dx(a.type,null,a.pendingProps,null))?a.memoizedState=c:yt||(c=a.type,s=a.pendingProps,m=Sh(de.current).createElement(c),m[cn]=a,m[jn]=s,Bn(m,c,s),un(m),a.stateNode=m):a.memoizedState=dx(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return pe(a),s===null&&yt&&(m=a.stateNode=lx(a.type,a.pendingProps,de.current),Nn=a,zr=!0,v=Ft,Xi(a.type)?(pg=v,Ft=Lr(m.firstChild)):Ft=v),zn(s,a,a.pendingProps.children,c),ah(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&yt&&((v=m=Ft)&&(m=S5(m,a.type,a.pendingProps,zr),m!==null?(a.stateNode=m,Nn=a,Ft=Lr(m.firstChild),zr=!1,v=!0):v=!1),v||zi(a)),pe(a),v=a.type,w=a.pendingProps,N=s!==null?s.memoizedProps:null,m=w.children,ug(v,w)?m=null:N!==null&&ug(v,N)&&(a.flags|=32),a.memoizedState!==null&&(v=cp(s,a,BA,null,null,c),hu._currentValue=v),ah(s,a),zn(s,a,m,c),a.child;case 6:return s===null&&yt&&((s=c=Ft)&&(c=E5(c,a.pendingProps,zr),c!==null?(a.stateNode=c,Nn=a,Ft=null,s=!0):s=!1),s||zi(a)),null;case 13:return Xb(s,a,c);case 4:return Te(a,a.stateNode.containerInfo),m=a.pendingProps,s===null?a.child=oo(a,null,m,c):zn(s,a,m,c),a.child;case 11:return Vb(s,a,a.type,a.pendingProps,c);case 7:return zn(s,a,a.pendingProps,c),a.child;case 8:return zn(s,a,a.pendingProps.children,c),a.child;case 12:return zn(s,a,a.pendingProps.children,c),a.child;case 10:return m=a.pendingProps,Bi(a,a.type,m.value),zn(s,a,m.children,c),a.child;case 9:return v=a.type._context,m=a.pendingProps.children,ro(a),v=Pn(v),m=m(v),a.flags|=1,zn(s,a,m,c),a.child;case 14:return $b(s,a,a.type,a.pendingProps,c);case 15:return qb(s,a,a.type,a.pendingProps,c);case 19:return Jb(s,a,c);case 31:return HA(s,a,c);case 22:return Gb(s,a,c,a.pendingProps);case 24:return ro(a),m=Pn(hn),s===null?(v=Jm(),v===null&&(v=zt,w=Xm(),v.pooledCache=w,w.refCount++,w!==null&&(v.pooledCacheLanes|=c),v=w),a.memoizedState={parent:m,cache:v},tp(a),Bi(a,hn,v)):((s.lanes&c)!==0&&(np(s,a),Hc(a,null,null,c),Gc()),v=s.memoizedState,w=a.memoizedState,v.parent!==m?(v={parent:m,cache:m},a.memoizedState=v,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=v),Bi(a,hn,m)):(m=w.cache,Bi(a,hn,m),m!==v.cache&&Ym(a,[hn],c,!0))),zn(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function ni(s){s.flags|=4}function zp(s,a,c,m,v){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(v&335544128)===v)if(s.stateNode.complete)s.flags|=8192;else if(Av())s.flags|=8192;else throw ao=Gd,ep}else s.flags&=-16777217}function tv(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!gx(a))if(Av())s.flags|=8192;else throw ao=Gd,ep}function lh(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?md():536870912,s.lanes|=a,yl|=a)}function Zc(s,a){if(!yt)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var m=null;c!==null;)c.alternate!==null&&(m=c),c=c.sibling;m===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:m.sibling=null}}function Vt(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,m=0;if(a)for(var v=s.child;v!==null;)c|=v.lanes|v.childLanes,m|=v.subtreeFlags&65011712,m|=v.flags&65011712,v.return=s,v=v.sibling;else for(v=s.child;v!==null;)c|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=s,v=v.sibling;return s.subtreeFlags|=m,s.childLanes=c,a}function WA(s,a,c){var m=a.pendingProps;switch(Gm(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vt(a),null;case 1:return Vt(a),null;case 3:return c=a.stateNode,m=null,s!==null&&(m=s.memoizedState.cache),a.memoizedState.cache!==m&&(a.flags|=2048),Zs(hn),Ee(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(sl(a)?ni(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Qm())),Vt(a),null;case 26:var v=a.type,w=a.memoizedState;return s===null?(ni(a),w!==null?(Vt(a),tv(a,w)):(Vt(a),zp(a,v,null,m,c))):w?w!==s.memoizedState?(ni(a),Vt(a),tv(a,w)):(Vt(a),a.flags&=-16777217):(s=s.memoizedProps,s!==m&&ni(a),Vt(a),zp(a,v,s,m,c)),null;case 27:if(Fe(a),c=de.current,v=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&ni(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return Vt(a),null}s=ae.current,sl(a)?M_(a):(s=lx(v,m,c),a.stateNode=s,ni(a))}return Vt(a),null;case 5:if(Fe(a),v=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&ni(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return Vt(a),null}if(w=ae.current,sl(a))M_(a);else{var N=Sh(de.current);switch(w){case 1:w=N.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:w=N.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":w=N.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":w=N.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":w=N.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof m.is=="string"?N.createElement("select",{is:m.is}):N.createElement("select"),m.multiple?w.multiple=!0:m.size&&(w.size=m.size);break;default:w=typeof m.is=="string"?N.createElement(v,{is:m.is}):N.createElement(v)}}w[cn]=a,w[jn]=m;e:for(N=a.child;N!==null;){if(N.tag===5||N.tag===6)w.appendChild(N.stateNode);else if(N.tag!==4&&N.tag!==27&&N.child!==null){N.child.return=N,N=N.child;continue}if(N===a)break e;for(;N.sibling===null;){if(N.return===null||N.return===a)break e;N=N.return}N.sibling.return=N.return,N=N.sibling}a.stateNode=w;e:switch(Bn(w,v,m),v){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&ni(a)}}return Vt(a),zp(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==m&&ni(a);else{if(typeof m!="string"&&a.stateNode===null)throw Error(r(166));if(s=de.current,sl(a)){if(s=a.stateNode,c=a.memoizedProps,m=null,v=Nn,v!==null)switch(v.tag){case 27:case 5:m=v.memoizedProps}s[cn]=a,s=!!(s.nodeValue===c||m!==null&&m.suppressHydrationWarning===!0||Xv(s.nodeValue,c)),s||zi(a,!0)}else s=Sh(s).createTextNode(m),s[cn]=a,a.stateNode=s}return Vt(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(m=sl(a),c!==null){if(s===null){if(!m)throw Error(r(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[cn]=a}else to(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Vt(a),s=!1}else c=Qm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(xr(a),a):(xr(a),null);if((a.flags&128)!==0)throw Error(r(558))}return Vt(a),null;case 13:if(m=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(v=sl(a),m!==null&&m.dehydrated!==null){if(s===null){if(!v)throw Error(r(318));if(v=a.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[cn]=a}else to(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Vt(a),v=!1}else v=Qm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=v),v=!0;if(!v)return a.flags&256?(xr(a),a):(xr(a),null)}return xr(a),(a.flags&128)!==0?(a.lanes=c,a):(c=m!==null,s=s!==null&&s.memoizedState!==null,c&&(m=a.child,v=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(v=m.alternate.memoizedState.cachePool.pool),w=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(w=m.memoizedState.cachePool.pool),w!==v&&(m.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),lh(a,a.updateQueue),Vt(a),null);case 4:return Ee(),s===null&&ig(a.stateNode.containerInfo),Vt(a),null;case 10:return Zs(a.type),Vt(a),null;case 19:if($(sn),m=a.memoizedState,m===null)return Vt(a),null;if(v=(a.flags&128)!==0,w=m.rendering,w===null)if(v)Zc(m,!1);else{if(tn!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(w=Kd(s),w!==null){for(a.flags|=128,Zc(m,!1),s=w.updateQueue,a.updateQueue=s,lh(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)R_(c,s),c=c.sibling;return te(sn,sn.current&1|2),yt&&Ys(a,m.treeForkCount),a.child}s=s.sibling}m.tail!==null&&Pe()>fh&&(a.flags|=128,v=!0,Zc(m,!1),a.lanes=4194304)}else{if(!v)if(s=Kd(w),s!==null){if(a.flags|=128,v=!0,s=s.updateQueue,a.updateQueue=s,lh(a,s),Zc(m,!0),m.tail===null&&m.tailMode==="hidden"&&!w.alternate&&!yt)return Vt(a),null}else 2*Pe()-m.renderingStartTime>fh&&c!==536870912&&(a.flags|=128,v=!0,Zc(m,!1),a.lanes=4194304);m.isBackwards?(w.sibling=a.child,a.child=w):(s=m.last,s!==null?s.sibling=w:a.child=w,m.last=w)}return m.tail!==null?(s=m.tail,m.rendering=s,m.tail=s.sibling,m.renderingStartTime=Pe(),s.sibling=null,c=sn.current,te(sn,v?c&1|2:c&1),yt&&Ys(a,m.treeForkCount),s):(Vt(a),null);case 22:case 23:return xr(a),ap(),m=a.memoizedState!==null,s!==null?s.memoizedState!==null!==m&&(a.flags|=8192):m&&(a.flags|=8192),m?(c&536870912)!==0&&(a.flags&128)===0&&(Vt(a),a.subtreeFlags&6&&(a.flags|=8192)):Vt(a),c=a.updateQueue,c!==null&&lh(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),m=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),m!==c&&(a.flags|=2048),s!==null&&$(so),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),Zs(hn),Vt(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function KA(s,a){switch(Gm(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return Zs(hn),Ee(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Fe(a),null;case 31:if(a.memoizedState!==null){if(xr(a),a.alternate===null)throw Error(r(340));to()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(xr(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(r(340));to()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return $(sn),null;case 4:return Ee(),null;case 10:return Zs(a.type),null;case 22:case 23:return xr(a),ap(),s!==null&&$(so),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return Zs(hn),null;case 25:return null;default:return null}}function nv(s,a){switch(Gm(a),a.tag){case 3:Zs(hn),Ee();break;case 26:case 27:case 5:Fe(a);break;case 4:Ee();break;case 31:a.memoizedState!==null&&xr(a);break;case 13:xr(a);break;case 19:$(sn);break;case 10:Zs(a.type);break;case 22:case 23:xr(a),ap(),s!==null&&$(so);break;case 24:Zs(hn)}}function Jc(s,a){try{var c=a.updateQueue,m=c!==null?c.lastEffect:null;if(m!==null){var v=m.next;c=v;do{if((c.tag&s)===s){m=void 0;var w=c.create,N=c.inst;m=w(),N.destroy=m}c=c.next}while(c!==v)}}catch(W){Dt(a,a.return,W)}}function qi(s,a,c){try{var m=a.updateQueue,v=m!==null?m.lastEffect:null;if(v!==null){var w=v.next;m=w;do{if((m.tag&s)===s){var N=m.inst,W=N.destroy;if(W!==void 0){N.destroy=void 0,v=a;var se=c,me=W;try{me()}catch(Ce){Dt(v,se,Ce)}}}m=m.next}while(m!==w)}}catch(Ce){Dt(a,a.return,Ce)}}function rv(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{Q_(a,c)}catch(m){Dt(s,s.return,m)}}}function sv(s,a,c){c.props=co(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(m){Dt(s,a,m)}}function eu(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var m=s.stateNode;break;case 30:m=s.stateNode;break;default:m=s.stateNode}typeof c=="function"?s.refCleanup=c(m):c.current=m}}catch(v){Dt(s,a,v)}}function Ds(s,a){var c=s.ref,m=s.refCleanup;if(c!==null)if(typeof m=="function")try{m()}catch(v){Dt(s,a,v)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(v){Dt(s,a,v)}else c.current=null}function iv(s){var a=s.type,c=s.memoizedProps,m=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&m.focus();break e;case"img":c.src?m.src=c.src:c.srcSet&&(m.srcset=c.srcSet)}}catch(v){Dt(s,s.return,v)}}function Bp(s,a,c){try{var m=s.stateNode;y5(m,s.type,c,a),m[jn]=a}catch(v){Dt(s,s.return,v)}}function av(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Xi(s.type)||s.tag===4}function Lp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||av(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Xi(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Up(s,a,c){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=Kr));else if(m!==4&&(m===27&&Xi(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Up(s,a,c),s=s.sibling;s!==null;)Up(s,a,c),s=s.sibling}function ch(s,a,c){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(m!==4&&(m===27&&Xi(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(ch(s,a,c),s=s.sibling;s!==null;)ch(s,a,c),s=s.sibling}function ov(s){var a=s.stateNode,c=s.memoizedProps;try{for(var m=s.type,v=a.attributes;v.length;)a.removeAttributeNode(v[0]);Bn(a,m,c),a[cn]=s,a[jn]=c}catch(w){Dt(s,s.return,w)}}var ri=!1,pn=!1,Fp=!1,lv=typeof WeakSet=="function"?WeakSet:Set,In=null;function YA(s,a){if(s=s.containerInfo,lg=Ih,s=v_(s),Mm(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var m=c.getSelection&&c.getSelection();if(m&&m.rangeCount!==0){c=m.anchorNode;var v=m.anchorOffset,w=m.focusNode;m=m.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var N=0,W=-1,se=-1,me=0,Ce=0,Ie=s,ye=null;t:for(;;){for(var ve;Ie!==c||v!==0&&Ie.nodeType!==3||(W=N+v),Ie!==w||m!==0&&Ie.nodeType!==3||(se=N+m),Ie.nodeType===3&&(N+=Ie.nodeValue.length),(ve=Ie.firstChild)!==null;)ye=Ie,Ie=ve;for(;;){if(Ie===s)break t;if(ye===c&&++me===v&&(W=N),ye===w&&++Ce===m&&(se=N),(ve=Ie.nextSibling)!==null)break;Ie=ye,ye=Ie.parentNode}Ie=ve}c=W===-1||se===-1?null:{start:W,end:se}}else c=null}c=c||{start:0,end:0}}else c=null;for(cg={focusedElem:s,selectionRange:c},Ih=!1,In=a;In!==null;)if(a=In,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,In=s;else for(;In!==null;){switch(a=In,w=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)v=s[c],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&w!==null){s=void 0,c=a,v=w.memoizedProps,w=w.memoizedState,m=c.stateNode;try{var Ve=co(c.type,v);s=m.getSnapshotBeforeUpdate(Ve,w),m.__reactInternalSnapshotBeforeUpdate=s}catch(Ke){Dt(c,c.return,Ke)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)hg(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":hg(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=a.sibling,s!==null){s.return=a.return,In=s;break}In=a.return}}function cv(s,a,c){var m=c.flags;switch(c.tag){case 0:case 11:case 15:ii(s,c),m&4&&Jc(5,c);break;case 1:if(ii(s,c),m&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(N){Dt(c,c.return,N)}else{var v=co(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(v,a,s.__reactInternalSnapshotBeforeUpdate)}catch(N){Dt(c,c.return,N)}}m&64&&rv(c),m&512&&eu(c,c.return);break;case 3:if(ii(s,c),m&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{Q_(s,a)}catch(N){Dt(c,c.return,N)}}break;case 27:a===null&&m&4&&ov(c);case 26:case 5:ii(s,c),a===null&&m&4&&iv(c),m&512&&eu(c,c.return);break;case 12:ii(s,c);break;case 31:ii(s,c),m&4&&hv(s,c);break;case 13:ii(s,c),m&4&&fv(s,c),m&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=i5.bind(null,c),C5(s,c))));break;case 22:if(m=c.memoizedState!==null||ri,!m){a=a!==null&&a.memoizedState!==null||pn,v=ri;var w=pn;ri=m,(pn=a)&&!w?ai(s,c,(c.subtreeFlags&8772)!==0):ii(s,c),ri=v,pn=w}break;case 30:break;default:ii(s,c)}}function uv(s){var a=s.alternate;a!==null&&(s.alternate=null,uv(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Fo(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Wt=null,or=!1;function si(s,a,c){for(c=c.child;c!==null;)dv(s,a,c),c=c.sibling}function dv(s,a,c){if(Jt&&typeof Jt.onCommitFiberUnmount=="function")try{Jt.onCommitFiberUnmount(bt,c)}catch{}switch(c.tag){case 26:pn||Ds(c,a),si(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:pn||Ds(c,a);var m=Wt,v=or;Xi(c.type)&&(Wt=c.stateNode,or=!1),si(s,a,c),cu(c.stateNode),Wt=m,or=v;break;case 5:pn||Ds(c,a);case 6:if(m=Wt,v=or,Wt=null,si(s,a,c),Wt=m,or=v,Wt!==null)if(or)try{(Wt.nodeType===9?Wt.body:Wt.nodeName==="HTML"?Wt.ownerDocument.body:Wt).removeChild(c.stateNode)}catch(w){Dt(c,a,w)}else try{Wt.removeChild(c.stateNode)}catch(w){Dt(c,a,w)}break;case 18:Wt!==null&&(or?(s=Wt,rx(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Cl(s)):rx(Wt,c.stateNode));break;case 4:m=Wt,v=or,Wt=c.stateNode.containerInfo,or=!0,si(s,a,c),Wt=m,or=v;break;case 0:case 11:case 14:case 15:qi(2,c,a),pn||qi(4,c,a),si(s,a,c);break;case 1:pn||(Ds(c,a),m=c.stateNode,typeof m.componentWillUnmount=="function"&&sv(c,a,m)),si(s,a,c);break;case 21:si(s,a,c);break;case 22:pn=(m=pn)||c.memoizedState!==null,si(s,a,c),pn=m;break;default:si(s,a,c)}}function hv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Cl(s)}catch(c){Dt(a,a.return,c)}}}function fv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Cl(s)}catch(c){Dt(a,a.return,c)}}function XA(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new lv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new lv),a;default:throw Error(r(435,s.tag))}}function uh(s,a){var c=XA(s);a.forEach(function(m){if(!c.has(m)){c.add(m);var v=a5.bind(null,s,m);m.then(v,v)}})}function lr(s,a){var c=a.deletions;if(c!==null)for(var m=0;m<c.length;m++){var v=c[m],w=s,N=a,W=N;e:for(;W!==null;){switch(W.tag){case 27:if(Xi(W.type)){Wt=W.stateNode,or=!1;break e}break;case 5:Wt=W.stateNode,or=!1;break e;case 3:case 4:Wt=W.stateNode.containerInfo,or=!0;break e}W=W.return}if(Wt===null)throw Error(r(160));dv(w,N,v),Wt=null,or=!1,w=v.alternate,w!==null&&(w.return=null),v.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)mv(a,s),a=a.sibling}var ts=null;function mv(s,a){var c=s.alternate,m=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:lr(a,s),cr(s),m&4&&(qi(3,s,s.return),Jc(3,s),qi(5,s,s.return));break;case 1:lr(a,s),cr(s),m&512&&(pn||c===null||Ds(c,c.return)),m&64&&ri&&(s=s.updateQueue,s!==null&&(m=s.callbacks,m!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?m:c.concat(m))));break;case 26:var v=ts;if(lr(a,s),cr(s),m&512&&(pn||c===null||Ds(c,c.return)),m&4){var w=c!==null?c.memoizedState:null;if(m=s.memoizedState,c===null)if(m===null)if(s.stateNode===null){e:{m=s.type,c=s.memoizedProps,v=v.ownerDocument||v;t:switch(m){case"title":w=v.getElementsByTagName("title")[0],(!w||w[ys]||w[cn]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=v.createElement(m),v.head.insertBefore(w,v.querySelector("head > title"))),Bn(w,m,c),w[cn]=s,un(w),m=w;break e;case"link":var N=mx("link","href",v).get(m+(c.href||""));if(N){for(var W=0;W<N.length;W++)if(w=N[W],w.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&w.getAttribute("rel")===(c.rel==null?null:c.rel)&&w.getAttribute("title")===(c.title==null?null:c.title)&&w.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){N.splice(W,1);break t}}w=v.createElement(m),Bn(w,m,c),v.head.appendChild(w);break;case"meta":if(N=mx("meta","content",v).get(m+(c.content||""))){for(W=0;W<N.length;W++)if(w=N[W],w.getAttribute("content")===(c.content==null?null:""+c.content)&&w.getAttribute("name")===(c.name==null?null:c.name)&&w.getAttribute("property")===(c.property==null?null:c.property)&&w.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&w.getAttribute("charset")===(c.charSet==null?null:c.charSet)){N.splice(W,1);break t}}w=v.createElement(m),Bn(w,m,c),v.head.appendChild(w);break;default:throw Error(r(468,m))}w[cn]=s,un(w),m=w}s.stateNode=m}else px(v,s.type,s.stateNode);else s.stateNode=fx(v,m,s.memoizedProps);else w!==m?(w===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):w.count--,m===null?px(v,s.type,s.stateNode):fx(v,m,s.memoizedProps)):m===null&&s.stateNode!==null&&Bp(s,s.memoizedProps,c.memoizedProps)}break;case 27:lr(a,s),cr(s),m&512&&(pn||c===null||Ds(c,c.return)),c!==null&&m&4&&Bp(s,s.memoizedProps,c.memoizedProps);break;case 5:if(lr(a,s),cr(s),m&512&&(pn||c===null||Ds(c,c.return)),s.flags&32){v=s.stateNode;try{ar(v,"")}catch(Ve){Dt(s,s.return,Ve)}}m&4&&s.stateNode!=null&&(v=s.memoizedProps,Bp(s,v,c!==null?c.memoizedProps:v)),m&1024&&(Fp=!0);break;case 6:if(lr(a,s),cr(s),m&4){if(s.stateNode===null)throw Error(r(162));m=s.memoizedProps,c=s.stateNode;try{c.nodeValue=m}catch(Ve){Dt(s,s.return,Ve)}}break;case 3:if(Th=null,v=ts,ts=Eh(a.containerInfo),lr(a,s),ts=v,cr(s),m&4&&c!==null&&c.memoizedState.isDehydrated)try{Cl(a.containerInfo)}catch(Ve){Dt(s,s.return,Ve)}Fp&&(Fp=!1,pv(s));break;case 4:m=ts,ts=Eh(s.stateNode.containerInfo),lr(a,s),cr(s),ts=m;break;case 12:lr(a,s),cr(s);break;case 31:lr(a,s),cr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,uh(s,m)));break;case 13:lr(a,s),cr(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(hh=Pe()),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,uh(s,m)));break;case 22:v=s.memoizedState!==null;var se=c!==null&&c.memoizedState!==null,me=ri,Ce=pn;if(ri=me||v,pn=Ce||se,lr(a,s),pn=Ce,ri=me,cr(s),m&8192)e:for(a=s.stateNode,a._visibility=v?a._visibility&-2:a._visibility|1,v&&(c===null||se||ri||pn||uo(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){se=c=a;try{if(w=se.stateNode,v)N=w.style,typeof N.setProperty=="function"?N.setProperty("display","none","important"):N.display="none";else{W=se.stateNode;var Ie=se.memoizedProps.style,ye=Ie!=null&&Ie.hasOwnProperty("display")?Ie.display:null;W.style.display=ye==null||typeof ye=="boolean"?"":(""+ye).trim()}}catch(Ve){Dt(se,se.return,Ve)}}}else if(a.tag===6){if(c===null){se=a;try{se.stateNode.nodeValue=v?"":se.memoizedProps}catch(Ve){Dt(se,se.return,Ve)}}}else if(a.tag===18){if(c===null){se=a;try{var ve=se.stateNode;v?sx(ve,!0):sx(se.stateNode,!1)}catch(Ve){Dt(se,se.return,Ve)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}m&4&&(m=s.updateQueue,m!==null&&(c=m.retryQueue,c!==null&&(m.retryQueue=null,uh(s,c))));break;case 19:lr(a,s),cr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,uh(s,m)));break;case 30:break;case 21:break;default:lr(a,s),cr(s)}}function cr(s){var a=s.flags;if(a&2){try{for(var c,m=s.return;m!==null;){if(av(m)){c=m;break}m=m.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var v=c.stateNode,w=Lp(s);ch(s,w,v);break;case 5:var N=c.stateNode;c.flags&32&&(ar(N,""),c.flags&=-33);var W=Lp(s);ch(s,W,N);break;case 3:case 4:var se=c.stateNode.containerInfo,me=Lp(s);Up(s,me,se);break;default:throw Error(r(161))}}catch(Ce){Dt(s,s.return,Ce)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function pv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;pv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function ii(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)cv(s,a.alternate,a),a=a.sibling}function uo(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:qi(4,a,a.return),uo(a);break;case 1:Ds(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&sv(a,a.return,c),uo(a);break;case 27:cu(a.stateNode);case 26:case 5:Ds(a,a.return),uo(a);break;case 22:a.memoizedState===null&&uo(a);break;case 30:uo(a);break;default:uo(a)}s=s.sibling}}function ai(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var m=a.alternate,v=s,w=a,N=w.flags;switch(w.tag){case 0:case 11:case 15:ai(v,w,c),Jc(4,w);break;case 1:if(ai(v,w,c),m=w,v=m.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(me){Dt(m,m.return,me)}if(m=w,v=m.updateQueue,v!==null){var W=m.stateNode;try{var se=v.shared.hiddenCallbacks;if(se!==null)for(v.shared.hiddenCallbacks=null,v=0;v<se.length;v++)H_(se[v],W)}catch(me){Dt(m,m.return,me)}}c&&N&64&&rv(w),eu(w,w.return);break;case 27:ov(w);case 26:case 5:ai(v,w,c),c&&m===null&&N&4&&iv(w),eu(w,w.return);break;case 12:ai(v,w,c);break;case 31:ai(v,w,c),c&&N&4&&hv(v,w);break;case 13:ai(v,w,c),c&&N&4&&fv(v,w);break;case 22:w.memoizedState===null&&ai(v,w,c),eu(w,w.return);break;case 30:break;default:ai(v,w,c)}a=a.sibling}}function Vp(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Uc(c))}function $p(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Uc(s))}function ns(s,a,c,m){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)gv(s,a,c,m),a=a.sibling}function gv(s,a,c,m){var v=a.flags;switch(a.tag){case 0:case 11:case 15:ns(s,a,c,m),v&2048&&Jc(9,a);break;case 1:ns(s,a,c,m);break;case 3:ns(s,a,c,m),v&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Uc(s)));break;case 12:if(v&2048){ns(s,a,c,m),s=a.stateNode;try{var w=a.memoizedProps,N=w.id,W=w.onPostCommit;typeof W=="function"&&W(N,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(se){Dt(a,a.return,se)}}else ns(s,a,c,m);break;case 31:ns(s,a,c,m);break;case 13:ns(s,a,c,m);break;case 23:break;case 22:w=a.stateNode,N=a.alternate,a.memoizedState!==null?w._visibility&2?ns(s,a,c,m):tu(s,a):w._visibility&2?ns(s,a,c,m):(w._visibility|=2,ml(s,a,c,m,(a.subtreeFlags&10256)!==0||!1)),v&2048&&Vp(N,a);break;case 24:ns(s,a,c,m),v&2048&&$p(a.alternate,a);break;default:ns(s,a,c,m)}}function ml(s,a,c,m,v){for(v=v&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var w=s,N=a,W=c,se=m,me=N.flags;switch(N.tag){case 0:case 11:case 15:ml(w,N,W,se,v),Jc(8,N);break;case 23:break;case 22:var Ce=N.stateNode;N.memoizedState!==null?Ce._visibility&2?ml(w,N,W,se,v):tu(w,N):(Ce._visibility|=2,ml(w,N,W,se,v)),v&&me&2048&&Vp(N.alternate,N);break;case 24:ml(w,N,W,se,v),v&&me&2048&&$p(N.alternate,N);break;default:ml(w,N,W,se,v)}a=a.sibling}}function tu(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,m=a,v=m.flags;switch(m.tag){case 22:tu(c,m),v&2048&&Vp(m.alternate,m);break;case 24:tu(c,m),v&2048&&$p(m.alternate,m);break;default:tu(c,m)}a=a.sibling}}var nu=8192;function pl(s,a,c){if(s.subtreeFlags&nu)for(s=s.child;s!==null;)yv(s,a,c),s=s.sibling}function yv(s,a,c){switch(s.tag){case 26:pl(s,a,c),s.flags&nu&&s.memoizedState!==null&&z5(c,ts,s.memoizedState,s.memoizedProps);break;case 5:pl(s,a,c);break;case 3:case 4:var m=ts;ts=Eh(s.stateNode.containerInfo),pl(s,a,c),ts=m;break;case 22:s.memoizedState===null&&(m=s.alternate,m!==null&&m.memoizedState!==null?(m=nu,nu=16777216,pl(s,a,c),nu=m):pl(s,a,c));break;default:pl(s,a,c)}}function _v(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function ru(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];In=m,vv(m,s)}_v(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)bv(s),s=s.sibling}function bv(s){switch(s.tag){case 0:case 11:case 15:ru(s),s.flags&2048&&qi(9,s,s.return);break;case 3:ru(s);break;case 12:ru(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,dh(s)):ru(s);break;default:ru(s)}}function dh(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];In=m,vv(m,s)}_v(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:qi(8,a,a.return),dh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,dh(a));break;default:dh(a)}s=s.sibling}}function vv(s,a){for(;In!==null;){var c=In;switch(c.tag){case 0:case 11:case 15:qi(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var m=c.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Uc(c.memoizedState.cache)}if(m=c.child,m!==null)m.return=c,In=m;else e:for(c=s;In!==null;){m=In;var v=m.sibling,w=m.return;if(uv(m),m===c){In=null;break e}if(v!==null){v.return=w,In=v;break e}In=w}}}var ZA={getCacheForType:function(s){var a=Pn(hn),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return Pn(hn).controller.signal}},JA=typeof WeakMap=="function"?WeakMap:Map,Tt=0,zt=null,ct=null,ht=0,It=0,wr=null,Gi=!1,gl=!1,qp=!1,oi=0,tn=0,Hi=0,ho=0,Gp=0,Sr=0,yl=0,su=null,ur=null,Hp=!1,hh=0,xv=0,fh=1/0,mh=null,Qi=null,xn=0,Wi=null,_l=null,li=0,Qp=0,Wp=null,wv=null,iu=0,Kp=null;function Er(){return(Tt&2)!==0&&ht!==0?ht&-ht:Q.T!==null?tg():pd()}function Sv(){if(Sr===0)if((ht&536870912)===0||yt){var s=fs;fs<<=1,(fs&3932160)===0&&(fs=262144),Sr=s}else Sr=536870912;return s=vr.current,s!==null&&(s.flags|=32),Sr}function dr(s,a,c){(s===zt&&(It===2||It===9)||s.cancelPendingCommit!==null)&&(bl(s,0),Ki(s,ht,Sr,!1)),La(s,c),((Tt&2)===0||s!==zt)&&(s===zt&&((Tt&2)===0&&(ho|=c),tn===4&&Ki(s,ht,Sr,!1)),ks(s))}function Ev(s,a,c){if((Tt&6)!==0)throw Error(r(327));var m=!c&&(a&127)===0&&(a&s.expiredLanes)===0||Hr(s,a),v=m?n5(s,a):Xp(s,a,!0),w=m;do{if(v===0){gl&&!m&&Ki(s,a,0,!1);break}else{if(c=s.current.alternate,w&&!e5(c)){v=Xp(s,a,!1),w=!1;continue}if(v===2){if(w=a,s.errorRecoveryDisabledLanes&w)var N=0;else N=s.pendingLanes&-536870913,N=N!==0?N:N&536870912?536870912:0;if(N!==0){a=N;e:{var W=s;v=su;var se=W.current.memoizedState.isDehydrated;if(se&&(bl(W,N).flags|=256),N=Xp(W,N,!1),N!==2){if(qp&&!se){W.errorRecoveryDisabledLanes|=w,ho|=w,v=4;break e}w=ur,ur=v,w!==null&&(ur===null?ur=w:ur.push.apply(ur,w))}v=N}if(w=!1,v!==2)continue}}if(v===1){bl(s,0),Ki(s,a,0,!0);break}e:{switch(m=s,w=v,w){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:Ki(m,a,Sr,!Gi);break e;case 2:ur=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(v=hh+300-Pe(),10<v)){if(Ki(m,a,Sr,!Gi),ms(m,0,!0)!==0)break e;li=a,m.timeoutHandle=tx(Cv.bind(null,m,c,ur,mh,Hp,a,Sr,ho,yl,Gi,w,"Throttled",-0,0),v);break e}Cv(m,c,ur,mh,Hp,a,Sr,ho,yl,Gi,w,null,-0,0)}}break}while(!0);ks(s)}function Cv(s,a,c,m,v,w,N,W,se,me,Ce,Ie,ye,ve){if(s.timeoutHandle=-1,Ie=a.subtreeFlags,Ie&8192||(Ie&16785408)===16785408){Ie={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Kr},yv(a,w,Ie);var Ve=(w&62914560)===w?hh-Pe():(w&4194048)===w?xv-Pe():0;if(Ve=B5(Ie,Ve),Ve!==null){li=w,s.cancelPendingCommit=Ve(Ov.bind(null,s,a,w,c,m,v,N,W,se,Ce,Ie,null,ye,ve)),Ki(s,w,N,!me);return}}Ov(s,a,w,c,m,v,N,W,se)}function e5(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var m=0;m<c.length;m++){var v=c[m],w=v.getSnapshot;v=v.value;try{if(!_r(w(),v))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Ki(s,a,c,m){a&=~Gp,a&=~ho,s.suspendedLanes|=a,s.pingedLanes&=~a,m&&(s.warmLanes|=a),m=s.expirationTimes;for(var v=a;0<v;){var w=31-Et(v),N=1<<w;m[w]=-1,v&=~N}c!==0&&Ua(s,c,a)}function ph(){return(Tt&6)===0?(au(0),!1):!0}function Yp(){if(ct!==null){if(It===0)var s=ct.return;else s=ct,Xs=no=null,hp(s),cl=null,Vc=0,s=ct;for(;s!==null;)nv(s.alternate,s),s=s.return;ct=null}}function bl(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,v5(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),li=0,Yp(),zt=s,ct=c=Ks(s.current,null),ht=a,It=0,wr=null,Gi=!1,gl=Hr(s,a),qp=!1,yl=Sr=Gp=ho=Hi=tn=0,ur=su=null,Hp=!1,(a&8)!==0&&(a|=a&32);var m=s.entangledLanes;if(m!==0)for(s=s.entanglements,m&=a;0<m;){var v=31-Et(m),w=1<<v;a|=s[v],m&=~w}return oi=a,Pd(),c}function Tv(s,a){at=null,Q.H=Yc,a===ll||a===qd?(a=V_(),It=3):a===ep?(a=V_(),It=4):It=a===jp?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,wr=a,ct===null&&(tn=1,sh(s,Mr(a,s.current)))}function Av(){var s=vr.current;return s===null?!0:(ht&4194048)===ht?Br===null:(ht&62914560)===ht||(ht&536870912)!==0?s===Br:!1}function jv(){var s=Q.H;return Q.H=Yc,s===null?Yc:s}function Rv(){var s=Q.A;return Q.A=ZA,s}function gh(){tn=4,Gi||(ht&4194048)!==ht&&vr.current!==null||(gl=!0),(Hi&134217727)===0&&(ho&134217727)===0||zt===null||Ki(zt,ht,Sr,!1)}function Xp(s,a,c){var m=Tt;Tt|=2;var v=jv(),w=Rv();(zt!==s||ht!==a)&&(mh=null,bl(s,a)),a=!1;var N=tn;e:do try{if(It!==0&&ct!==null){var W=ct,se=wr;switch(It){case 8:Yp(),N=6;break e;case 3:case 2:case 9:case 6:vr.current===null&&(a=!0);var me=It;if(It=0,wr=null,vl(s,W,se,me),c&&gl){N=0;break e}break;default:me=It,It=0,wr=null,vl(s,W,se,me)}}t5(),N=tn;break}catch(Ce){Tv(s,Ce)}while(!0);return a&&s.shellSuspendCounter++,Xs=no=null,Tt=m,Q.H=v,Q.A=w,ct===null&&(zt=null,ht=0,Pd()),N}function t5(){for(;ct!==null;)Iv(ct)}function n5(s,a){var c=Tt;Tt|=2;var m=jv(),v=Rv();zt!==s||ht!==a?(mh=null,fh=Pe()+500,bl(s,a)):gl=Hr(s,a);e:do try{if(It!==0&&ct!==null){a=ct;var w=wr;t:switch(It){case 1:It=0,wr=null,vl(s,a,w,1);break;case 2:case 9:if(U_(w)){It=0,wr=null,Dv(a);break}a=function(){It!==2&&It!==9||zt!==s||(It=7),ks(s)},w.then(a,a);break e;case 3:It=7;break e;case 4:It=5;break e;case 7:U_(w)?(It=0,wr=null,Dv(a)):(It=0,wr=null,vl(s,a,w,7));break;case 5:var N=null;switch(ct.tag){case 26:N=ct.memoizedState;case 5:case 27:var W=ct;if(N?gx(N):W.stateNode.complete){It=0,wr=null;var se=W.sibling;if(se!==null)ct=se;else{var me=W.return;me!==null?(ct=me,yh(me)):ct=null}break t}}It=0,wr=null,vl(s,a,w,5);break;case 6:It=0,wr=null,vl(s,a,w,6);break;case 8:Yp(),tn=6;break e;default:throw Error(r(462))}}r5();break}catch(Ce){Tv(s,Ce)}while(!0);return Xs=no=null,Q.H=m,Q.A=v,Tt=c,ct!==null?0:(zt=null,ht=0,Pd(),tn)}function r5(){for(;ct!==null&&!oe();)Iv(ct)}function Iv(s){var a=ev(s.alternate,s,oi);s.memoizedProps=s.pendingProps,a===null?yh(s):ct=a}function Dv(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=Wb(c,a,a.pendingProps,a.type,void 0,ht);break;case 11:a=Wb(c,a,a.pendingProps,a.type.render,a.ref,ht);break;case 5:hp(a);default:nv(c,a),a=ct=R_(a,oi),a=ev(c,a,oi)}s.memoizedProps=s.pendingProps,a===null?yh(s):ct=a}function vl(s,a,c,m){Xs=no=null,hp(a),cl=null,Vc=0;var v=a.return;try{if(GA(s,v,a,c,ht)){tn=1,sh(s,Mr(c,s.current)),ct=null;return}}catch(w){if(v!==null)throw ct=v,w;tn=1,sh(s,Mr(c,s.current)),ct=null;return}a.flags&32768?(yt||m===1?s=!0:gl||(ht&536870912)!==0?s=!1:(Gi=s=!0,(m===2||m===9||m===3||m===6)&&(m=vr.current,m!==null&&m.tag===13&&(m.flags|=16384))),kv(a,s)):yh(a)}function yh(s){var a=s;do{if((a.flags&32768)!==0){kv(a,Gi);return}s=a.return;var c=WA(a.alternate,a,oi);if(c!==null){ct=c;return}if(a=a.sibling,a!==null){ct=a;return}ct=a=s}while(a!==null);tn===0&&(tn=5)}function kv(s,a){do{var c=KA(s.alternate,s);if(c!==null){c.flags&=32767,ct=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){ct=s;return}ct=s=c}while(s!==null);tn=6,ct=null}function Ov(s,a,c,m,v,w,N,W,se){s.cancelPendingCommit=null;do _h();while(xn!==0);if((Tt&6)!==0)throw Error(r(327));if(a!==null){if(a===s.current)throw Error(r(177));if(w=a.lanes|a.childLanes,w|=Lm,Im(s,c,w,N,W,se),s===zt&&(ct=zt=null,ht=0),_l=a,Wi=s,li=c,Qp=w,Wp=v,wv=m,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,o5(st,function(){return Bv(),null})):(s.callbackNode=null,s.callbackPriority=0),m=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||m){m=Q.T,Q.T=null,v=G.p,G.p=2,N=Tt,Tt|=4;try{YA(s,a,c)}finally{Tt=N,G.p=v,Q.T=m}}xn=1,Mv(),Nv(),Pv()}}function Mv(){if(xn===1){xn=0;var s=Wi,a=_l,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=Q.T,Q.T=null;var m=G.p;G.p=2;var v=Tt;Tt|=4;try{mv(a,s);var w=cg,N=v_(s.containerInfo),W=w.focusedElem,se=w.selectionRange;if(N!==W&&W&&W.ownerDocument&&b_(W.ownerDocument.documentElement,W)){if(se!==null&&Mm(W)){var me=se.start,Ce=se.end;if(Ce===void 0&&(Ce=me),"selectionStart"in W)W.selectionStart=me,W.selectionEnd=Math.min(Ce,W.value.length);else{var Ie=W.ownerDocument||document,ye=Ie&&Ie.defaultView||window;if(ye.getSelection){var ve=ye.getSelection(),Ve=W.textContent.length,Ke=Math.min(se.start,Ve),Nt=se.end===void 0?Ke:Math.min(se.end,Ve);!ve.extend&&Ke>Nt&&(N=Nt,Nt=Ke,Ke=N);var ue=__(W,Ke),le=__(W,Nt);if(ue&&le&&(ve.rangeCount!==1||ve.anchorNode!==ue.node||ve.anchorOffset!==ue.offset||ve.focusNode!==le.node||ve.focusOffset!==le.offset)){var fe=Ie.createRange();fe.setStart(ue.node,ue.offset),ve.removeAllRanges(),Ke>Nt?(ve.addRange(fe),ve.extend(le.node,le.offset)):(fe.setEnd(le.node,le.offset),ve.addRange(fe))}}}}for(Ie=[],ve=W;ve=ve.parentNode;)ve.nodeType===1&&Ie.push({element:ve,left:ve.scrollLeft,top:ve.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<Ie.length;W++){var Ae=Ie[W];Ae.element.scrollLeft=Ae.left,Ae.element.scrollTop=Ae.top}}Ih=!!lg,cg=lg=null}finally{Tt=v,G.p=m,Q.T=c}}s.current=a,xn=2}}function Nv(){if(xn===2){xn=0;var s=Wi,a=_l,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=Q.T,Q.T=null;var m=G.p;G.p=2;var v=Tt;Tt|=4;try{cv(s,a.alternate,a)}finally{Tt=v,G.p=m,Q.T=c}}xn=3}}function Pv(){if(xn===4||xn===3){xn=0,je();var s=Wi,a=_l,c=li,m=wv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?xn=5:(xn=0,_l=Wi=null,zv(s,s.pendingLanes));var v=s.pendingLanes;if(v===0&&(Qi=null),Gs(c),a=a.stateNode,Jt&&typeof Jt.onCommitFiberRoot=="function")try{Jt.onCommitFiberRoot(bt,a,void 0,(a.current.flags&128)===128)}catch{}if(m!==null){a=Q.T,v=G.p,G.p=2,Q.T=null;try{for(var w=s.onRecoverableError,N=0;N<m.length;N++){var W=m[N];w(W.value,{componentStack:W.stack})}}finally{Q.T=a,G.p=v}}(li&3)!==0&&_h(),ks(s),v=s.pendingLanes,(c&261930)!==0&&(v&42)!==0?s===Kp?iu++:(iu=0,Kp=s):iu=0,au(0)}}function zv(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Uc(a)))}function _h(){return Mv(),Nv(),Pv(),Bv()}function Bv(){if(xn!==5)return!1;var s=Wi,a=Qp;Qp=0;var c=Gs(li),m=Q.T,v=G.p;try{G.p=32>c?32:c,Q.T=null,c=Wp,Wp=null;var w=Wi,N=li;if(xn=0,_l=Wi=null,li=0,(Tt&6)!==0)throw Error(r(331));var W=Tt;if(Tt|=4,bv(w.current),gv(w,w.current,N,c),Tt=W,au(0,!1),Jt&&typeof Jt.onPostCommitFiberRoot=="function")try{Jt.onPostCommitFiberRoot(bt,w)}catch{}return!0}finally{G.p=v,Q.T=m,zv(s,a)}}function Lv(s,a,c){a=Mr(c,a),a=Ap(s.stateNode,a,2),s=Fi(s,a,2),s!==null&&(La(s,2),ks(s))}function Dt(s,a,c){if(s.tag===3)Lv(s,s,c);else for(;a!==null;){if(a.tag===3){Lv(a,s,c);break}else if(a.tag===1){var m=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Qi===null||!Qi.has(m))){s=Mr(c,s),c=Ub(2),m=Fi(a,c,2),m!==null&&(Fb(c,m,a,s),La(m,2),ks(m));break}}a=a.return}}function Zp(s,a,c){var m=s.pingCache;if(m===null){m=s.pingCache=new JA;var v=new Set;m.set(a,v)}else v=m.get(a),v===void 0&&(v=new Set,m.set(a,v));v.has(c)||(qp=!0,v.add(c),s=s5.bind(null,s,a,c),a.then(s,s))}function s5(s,a,c){var m=s.pingCache;m!==null&&m.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,zt===s&&(ht&c)===c&&(tn===4||tn===3&&(ht&62914560)===ht&&300>Pe()-hh?(Tt&2)===0&&bl(s,0):Gp|=c,yl===ht&&(yl=0)),ks(s)}function Uv(s,a){a===0&&(a=md()),s=Ja(s,a),s!==null&&(La(s,a),ks(s))}function i5(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),Uv(s,c)}function a5(s,a){var c=0;switch(s.tag){case 31:case 13:var m=s.stateNode,v=s.memoizedState;v!==null&&(c=v.retryLane);break;case 19:m=s.stateNode;break;case 22:m=s.stateNode._retryCache;break;default:throw Error(r(314))}m!==null&&m.delete(a),Uv(s,c)}function o5(s,a){return we(s,a)}var bh=null,xl=null,Jp=!1,vh=!1,eg=!1,Yi=0;function ks(s){s!==xl&&s.next===null&&(xl===null?bh=xl=s:xl=xl.next=s),vh=!0,Jp||(Jp=!0,c5())}function au(s,a){if(!eg&&vh){eg=!0;do for(var c=!1,m=bh;m!==null;){if(s!==0){var v=m.pendingLanes;if(v===0)var w=0;else{var N=m.suspendedLanes,W=m.pingedLanes;w=(1<<31-Et(42|s)+1)-1,w&=v&~(N&~W),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(c=!0,qv(m,w))}else w=ht,w=ms(m,m===zt?w:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(w&3)===0||Hr(m,w)||(c=!0,qv(m,w));m=m.next}while(c);eg=!1}}function l5(){Fv()}function Fv(){vh=Jp=!1;var s=0;Yi!==0&&b5()&&(s=Yi);for(var a=Pe(),c=null,m=bh;m!==null;){var v=m.next,w=Vv(m,a);w===0?(m.next=null,c===null?bh=v:c.next=v,v===null&&(xl=c)):(c=m,(s!==0||(w&3)!==0)&&(vh=!0)),m=v}xn!==0&&xn!==5||au(s),Yi!==0&&(Yi=0)}function Vv(s,a){for(var c=s.suspendedLanes,m=s.pingedLanes,v=s.expirationTimes,w=s.pendingLanes&-62914561;0<w;){var N=31-Et(w),W=1<<N,se=v[N];se===-1?((W&c)===0||(W&m)!==0)&&(v[N]=Rm(W,a)):se<=a&&(s.expiredLanes|=W),w&=~W}if(a=zt,c=ht,c=ms(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m=s.callbackNode,c===0||s===a&&(It===2||It===9)||s.cancelPendingCommit!==null)return m!==null&&m!==null&&xe(m),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Hr(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(m!==null&&xe(m),Gs(c)){case 2:case 8:c=xt;break;case 32:c=st;break;case 268435456:c=ds;break;default:c=st}return m=$v.bind(null,s),c=we(c,m),s.callbackPriority=a,s.callbackNode=c,a}return m!==null&&m!==null&&xe(m),s.callbackPriority=2,s.callbackNode=null,2}function $v(s,a){if(xn!==0&&xn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(_h()&&s.callbackNode!==c)return null;var m=ht;return m=ms(s,s===zt?m:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m===0?null:(Ev(s,m,a),Vv(s,Pe()),s.callbackNode!=null&&s.callbackNode===c?$v.bind(null,s):null)}function qv(s,a){if(_h())return null;Ev(s,a,!0)}function c5(){x5(function(){(Tt&6)!==0?we(Ge,l5):Fv()})}function tg(){if(Yi===0){var s=al;s===0&&(s=jr,jr<<=1,(jr&261888)===0&&(jr=256)),Yi=s}return Yi}function Gv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Go(""+s)}function Hv(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function u5(s,a,c,m,v){if(a==="submit"&&c&&c.stateNode===v){var w=Gv((v[jn]||null).action),N=m.submitter;N&&(a=(a=N[jn]||null)?Gv(a.formAction):N.getAttribute("formAction"),a!==null&&(w=a,N=null));var W=new Cs("action","action",null,m,v);s.push({event:W,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(Yi!==0){var se=N?Hv(v,N):new FormData(v);xp(c,{pending:!0,data:se,method:v.method,action:w},null,se)}}else typeof w=="function"&&(W.preventDefault(),se=N?Hv(v,N):new FormData(v),xp(c,{pending:!0,data:se,method:v.method,action:w},w,se))},currentTarget:v}]})}}for(var ng=0;ng<Bm.length;ng++){var rg=Bm[ng],d5=rg.toLowerCase(),h5=rg[0].toUpperCase()+rg.slice(1);es(d5,"on"+h5)}es(S_,"onAnimationEnd"),es(E_,"onAnimationIteration"),es(C_,"onAnimationStart"),es("dblclick","onDoubleClick"),es("focusin","onFocus"),es("focusout","onBlur"),es(jA,"onTransitionRun"),es(RA,"onTransitionStart"),es(IA,"onTransitionCancel"),es(T_,"onTransitionEnd"),xs("onMouseEnter",["mouseout","mouseover"]),xs("onMouseLeave",["mouseout","mouseover"]),xs("onPointerEnter",["pointerout","pointerover"]),xs("onPointerLeave",["pointerout","pointerover"]),vs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vs("onBeforeInput",["compositionend","keypress","textInput","paste"]),vs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ou="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),f5=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ou));function Qv(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var m=s[c],v=m.event;m=m.listeners;e:{var w=void 0;if(a)for(var N=m.length-1;0<=N;N--){var W=m[N],se=W.instance,me=W.currentTarget;if(W=W.listener,se!==w&&v.isPropagationStopped())break e;w=W,v.currentTarget=me;try{w(v)}catch(Ce){Nd(Ce)}v.currentTarget=null,w=se}else for(N=0;N<m.length;N++){if(W=m[N],se=W.instance,me=W.currentTarget,W=W.listener,se!==w&&v.isPropagationStopped())break e;w=W,v.currentTarget=me;try{w(v)}catch(Ce){Nd(Ce)}v.currentTarget=null,w=se}}}}function ut(s,a){var c=a[Uo];c===void 0&&(c=a[Uo]=new Set);var m=s+"__bubble";c.has(m)||(Wv(a,s,2,!1),c.add(m))}function sg(s,a,c){var m=0;a&&(m|=4),Wv(c,s,m,a)}var xh="_reactListening"+Math.random().toString(36).slice(2);function ig(s){if(!s[xh]){s[xh]=!0,bc.forEach(function(c){c!=="selectionchange"&&(f5.has(c)||sg(c,!1,s),sg(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[xh]||(a[xh]=!0,sg("selectionchange",!1,a))}}function Wv(s,a,c,m){switch(Sx(a)){case 2:var v=F5;break;case 8:v=V5;break;default:v=vg}c=v.bind(null,a,c,s),v=void 0,!Ga||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(v=!0),m?v!==void 0?s.addEventListener(a,c,{capture:!0,passive:v}):s.addEventListener(a,c,!0):v!==void 0?s.addEventListener(a,c,{passive:v}):s.addEventListener(a,c,!1)}function ag(s,a,c,m,v){var w=m;if((a&1)===0&&(a&2)===0&&m!==null)e:for(;;){if(m===null)return;var N=m.tag;if(N===3||N===4){var W=m.stateNode.containerInfo;if(W===v)break;if(N===4)for(N=m.return;N!==null;){var se=N.tag;if((se===3||se===4)&&N.stateNode.containerInfo===v)return;N=N.return}for(;W!==null;){if(N=_s(W),N===null)return;if(se=N.tag,se===5||se===6||se===26||se===27){m=w=N;continue e}W=W.parentNode}}m=m.return}Di(function(){var me=w,Ce=Ir(c),Ie=[];e:{var ye=A_.get(s);if(ye!==void 0){var ve=Cs,Ve=s;switch(s){case"keypress":if(Qa(c)===0)break e;case"keydown":case"keyup":ve=kd;break;case"focusin":Ve="focus",ve=Ka;break;case"focusout":Ve="blur",ve=Ka;break;case"beforeblur":case"afterblur":ve=Ka;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ve=kc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ve=Sd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ve=I;break;case S_:case E_:case C_:ve=Cd;break;case T_:ve=Y;break;case"scroll":case"scrollend":ve=Dc;break;case"wheel":ve=_e;break;case"copy":case"cut":case"paste":ve=Td;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ve=Ws;break;case"toggle":case"beforetoggle":ve=it}var Ke=(a&4)!==0,Nt=!Ke&&(s==="scroll"||s==="scrollend"),ue=Ke?ye!==null?ye+"Capture":null:ye;Ke=[];for(var le=me,fe;le!==null;){var Ae=le;if(fe=Ae.stateNode,Ae=Ae.tag,Ae!==5&&Ae!==26&&Ae!==27||fe===null||ue===null||(Ae=Yr(le,ue),Ae!=null&&Ke.push(lu(le,Ae,fe))),Nt)break;le=le.return}0<Ke.length&&(ye=new ve(ye,Ve,null,c,Ce),Ie.push({event:ye,listeners:Ke}))}}if((a&7)===0){e:{if(ye=s==="mouseover"||s==="pointerover",ve=s==="mouseout"||s==="pointerout",ye&&c!==jc&&(Ve=c.relatedTarget||c.fromElement)&&(_s(Ve)||Ve[gs]))break e;if((ve||ye)&&(ye=Ce.window===Ce?Ce:(ye=Ce.ownerDocument)?ye.defaultView||ye.parentWindow:window,ve?(Ve=c.relatedTarget||c.toElement,ve=me,Ve=Ve?_s(Ve):null,Ve!==null&&(Nt=o(Ve),Ke=Ve.tag,Ve!==Nt||Ke!==5&&Ke!==27&&Ke!==6)&&(Ve=null)):(ve=null,Ve=me),ve!==Ve)){if(Ke=kc,Ae="onMouseLeave",ue="onMouseEnter",le="mouse",(s==="pointerout"||s==="pointerover")&&(Ke=Ws,Ae="onPointerLeave",ue="onPointerEnter",le="pointer"),Nt=ve==null?ye:gr(ve),fe=Ve==null?ye:gr(Ve),ye=new Ke(Ae,le+"leave",ve,c,Ce),ye.target=Nt,ye.relatedTarget=fe,Ae=null,_s(Ce)===me&&(Ke=new Ke(ue,le+"enter",Ve,c,Ce),Ke.target=fe,Ke.relatedTarget=Nt,Ae=Ke),Nt=Ae,ve&&Ve)t:{for(Ke=m5,ue=ve,le=Ve,fe=0,Ae=ue;Ae;Ae=Ke(Ae))fe++;Ae=0;for(var Qe=le;Qe;Qe=Ke(Qe))Ae++;for(;0<fe-Ae;)ue=Ke(ue),fe--;for(;0<Ae-fe;)le=Ke(le),Ae--;for(;fe--;){if(ue===le||le!==null&&ue===le.alternate){Ke=ue;break t}ue=Ke(ue),le=Ke(le)}Ke=null}else Ke=null;ve!==null&&Kv(Ie,ye,ve,Ke,!1),Ve!==null&&Nt!==null&&Kv(Ie,Nt,Ve,Ke,!0)}}e:{if(ye=me?gr(me):window,ve=ye.nodeName&&ye.nodeName.toLowerCase(),ve==="select"||ve==="input"&&ye.type==="file")var wt=h_;else if(u_(ye))if(f_)wt=CA;else{wt=SA;var qe=wA}else ve=ye.nodeName,!ve||ve.toLowerCase()!=="input"||ye.type!=="checkbox"&&ye.type!=="radio"?me&&qo(me.elementType)&&(wt=h_):wt=EA;if(wt&&(wt=wt(s,me))){d_(Ie,wt,c,Ce);break e}qe&&qe(s,ye,me),s==="focusout"&&me&&ye.type==="number"&&me.memoizedProps.value!=null&&Cc(ye,"number",ye.value)}switch(qe=me?gr(me):window,s){case"focusin":(u_(qe)||qe.contentEditable==="true")&&(Zo=qe,Nm=me,zc=null);break;case"focusout":zc=Nm=Zo=null;break;case"mousedown":Pm=!0;break;case"contextmenu":case"mouseup":case"dragend":Pm=!1,x_(Ie,c,Ce);break;case"selectionchange":if(AA)break;case"keydown":case"keyup":x_(Ie,c,Ce)}var ot;if(Ct)e:{switch(s){case"compositionstart":var ft="onCompositionStart";break e;case"compositionend":ft="onCompositionEnd";break e;case"compositionupdate":ft="onCompositionUpdate";break e}ft=void 0}else Xo?Ya(s,c)&&(ft="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(ft="onCompositionStart");ft&&(js&&c.locale!=="ko"&&(Xo||ft!=="onCompositionStart"?ft==="onCompositionEnd"&&Xo&&(ot=Ic()):(Es=Ce,Rc="value"in Es?Es.value:Es.textContent,Xo=!0)),qe=wh(me,ft),0<qe.length&&(ft=new As(ft,s,null,c,Ce),Ie.push({event:ft,listeners:qe}),ot?ft.data=ot:(ot=Yo(c),ot!==null&&(ft.data=ot)))),(ot=kr?_A(s,c):bA(s,c))&&(ft=wh(me,"onBeforeInput"),0<ft.length&&(qe=new As("onBeforeInput","beforeinput",null,c,Ce),Ie.push({event:qe,listeners:ft}),qe.data=ot)),u5(Ie,s,me,c,Ce)}Qv(Ie,a)})}function lu(s,a,c){return{instance:s,listener:a,currentTarget:c}}function wh(s,a){for(var c=a+"Capture",m=[];s!==null;){var v=s,w=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||w===null||(v=Yr(s,c),v!=null&&m.unshift(lu(s,v,w)),v=Yr(s,a),v!=null&&m.push(lu(s,v,w))),s.tag===3)return m;s=s.return}return[]}function m5(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Kv(s,a,c,m,v){for(var w=a._reactName,N=[];c!==null&&c!==m;){var W=c,se=W.alternate,me=W.stateNode;if(W=W.tag,se!==null&&se===m)break;W!==5&&W!==26&&W!==27||me===null||(se=me,v?(me=Yr(c,w),me!=null&&N.unshift(lu(c,me,se))):v||(me=Yr(c,w),me!=null&&N.push(lu(c,me,se)))),c=c.return}N.length!==0&&s.push({event:a,listeners:N})}var p5=/\r\n?/g,g5=/\u0000|\uFFFD/g;function Yv(s){return(typeof s=="string"?s:""+s).replace(p5,`
`).replace(g5,"")}function Xv(s,a){return a=Yv(a),Yv(s)===a}function Mt(s,a,c,m,v,w){switch(c){case"children":typeof m=="string"?a==="body"||a==="textarea"&&m===""||ar(s,m):(typeof m=="number"||typeof m=="bigint")&&a!=="body"&&ar(s,""+m);break;case"className":yr(s,"class",m);break;case"tabIndex":yr(s,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":yr(s,c,m);break;case"style":Ac(s,m,w);break;case"data":if(a!=="object"){yr(s,"data",m);break}case"src":case"href":if(m===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(c);break}m=Go(""+m),s.setAttribute(c,m);break;case"action":case"formAction":if(typeof m=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(c==="formAction"?(a!=="input"&&Mt(s,a,"name",v.name,v,null),Mt(s,a,"formEncType",v.formEncType,v,null),Mt(s,a,"formMethod",v.formMethod,v,null),Mt(s,a,"formTarget",v.formTarget,v,null)):(Mt(s,a,"encType",v.encType,v,null),Mt(s,a,"method",v.method,v,null),Mt(s,a,"target",v.target,v,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(c);break}m=Go(""+m),s.setAttribute(c,m);break;case"onClick":m!=null&&(s.onclick=Kr);break;case"onScroll":m!=null&&ut("scroll",s);break;case"onScrollEnd":m!=null&&ut("scrollend",s);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(c=m.__html,c!=null){if(v.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"multiple":s.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":s.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){s.removeAttribute("xlink:href");break}c=Go(""+m),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,""+m):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":m===!0?s.setAttribute(c,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,m):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?s.setAttribute(c,m):s.removeAttribute(c);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?s.removeAttribute(c):s.setAttribute(c,m);break;case"popover":ut("beforetoggle",s),ut("toggle",s),Vo(s,"popover",m);break;case"xlinkActuate":dn(s,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":dn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":dn(s,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":dn(s,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":dn(s,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":dn(s,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":dn(s,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":dn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":dn(s,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":Vo(s,"is",m);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=wd.get(c)||c,Vo(s,c,m))}}function og(s,a,c,m,v,w){switch(c){case"style":Ac(s,m,w);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(c=m.__html,c!=null){if(v.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"children":typeof m=="string"?ar(s,m):(typeof m=="number"||typeof m=="bigint")&&ar(s,""+m);break;case"onScroll":m!=null&&ut("scroll",s);break;case"onScrollEnd":m!=null&&ut("scrollend",s);break;case"onClick":m!=null&&(s.onclick=Kr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!vc.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(v=c.endsWith("Capture"),a=c.slice(2,v?c.length-7:void 0),w=s[jn]||null,w=w!=null?w[c]:null,typeof w=="function"&&s.removeEventListener(a,w,v),typeof m=="function")){typeof w!="function"&&w!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,m,v);break e}c in s?s[c]=m:m===!0?s.setAttribute(c,""):Vo(s,c,m)}}}function Bn(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ut("error",s),ut("load",s);var m=!1,v=!1,w;for(w in c)if(c.hasOwnProperty(w)){var N=c[w];if(N!=null)switch(w){case"src":m=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Mt(s,a,w,N,c,null)}}v&&Mt(s,a,"srcSet",c.srcSet,c,null),m&&Mt(s,a,"src",c.src,c,null);return;case"input":ut("invalid",s);var W=w=N=v=null,se=null,me=null;for(m in c)if(c.hasOwnProperty(m)){var Ce=c[m];if(Ce!=null)switch(m){case"name":v=Ce;break;case"type":N=Ce;break;case"checked":se=Ce;break;case"defaultChecked":me=Ce;break;case"value":w=Ce;break;case"defaultValue":W=Ce;break;case"children":case"dangerouslySetInnerHTML":if(Ce!=null)throw Error(r(137,a));break;default:Mt(s,a,m,Ce,c,null)}}bd(s,w,W,se,me,N,v,!1);return;case"select":ut("invalid",s),m=N=w=null;for(v in c)if(c.hasOwnProperty(v)&&(W=c[v],W!=null))switch(v){case"value":w=W;break;case"defaultValue":N=W;break;case"multiple":m=W;default:Mt(s,a,v,W,c,null)}a=w,c=N,s.multiple=!!m,a!=null?Ai(s,!!m,a,!1):c!=null&&Ai(s,!!m,c,!0);return;case"textarea":ut("invalid",s),w=v=m=null;for(N in c)if(c.hasOwnProperty(N)&&(W=c[N],W!=null))switch(N){case"value":m=W;break;case"defaultValue":v=W;break;case"children":w=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(r(91));break;default:Mt(s,a,N,W,c,null)}ji(s,m,v,w);return;case"option":for(se in c)c.hasOwnProperty(se)&&(m=c[se],m!=null)&&(se==="selected"?s.selected=m&&typeof m!="function"&&typeof m!="symbol":Mt(s,a,se,m,c,null));return;case"dialog":ut("beforetoggle",s),ut("toggle",s),ut("cancel",s),ut("close",s);break;case"iframe":case"object":ut("load",s);break;case"video":case"audio":for(m=0;m<ou.length;m++)ut(ou[m],s);break;case"image":ut("error",s),ut("load",s);break;case"details":ut("toggle",s);break;case"embed":case"source":case"link":ut("error",s),ut("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(me in c)if(c.hasOwnProperty(me)&&(m=c[me],m!=null))switch(me){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Mt(s,a,me,m,c,null)}return;default:if(qo(a)){for(Ce in c)c.hasOwnProperty(Ce)&&(m=c[Ce],m!==void 0&&og(s,a,Ce,m,c,void 0));return}}for(W in c)c.hasOwnProperty(W)&&(m=c[W],m!=null&&Mt(s,a,W,m,c,null))}function y5(s,a,c,m){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,w=null,N=null,W=null,se=null,me=null,Ce=null;for(ve in c){var Ie=c[ve];if(c.hasOwnProperty(ve)&&Ie!=null)switch(ve){case"checked":break;case"value":break;case"defaultValue":se=Ie;default:m.hasOwnProperty(ve)||Mt(s,a,ve,null,m,Ie)}}for(var ye in m){var ve=m[ye];if(Ie=c[ye],m.hasOwnProperty(ye)&&(ve!=null||Ie!=null))switch(ye){case"type":w=ve;break;case"name":v=ve;break;case"checked":me=ve;break;case"defaultChecked":Ce=ve;break;case"value":N=ve;break;case"defaultValue":W=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(r(137,a));break;default:ve!==Ie&&Mt(s,a,ye,ve,m,Ie)}}$o(s,N,W,se,me,Ce,w,v);return;case"select":ve=N=W=ye=null;for(w in c)if(se=c[w],c.hasOwnProperty(w)&&se!=null)switch(w){case"value":break;case"multiple":ve=se;default:m.hasOwnProperty(w)||Mt(s,a,w,null,m,se)}for(v in m)if(w=m[v],se=c[v],m.hasOwnProperty(v)&&(w!=null||se!=null))switch(v){case"value":ye=w;break;case"defaultValue":W=w;break;case"multiple":N=w;default:w!==se&&Mt(s,a,v,w,m,se)}a=W,c=N,m=ve,ye!=null?Ai(s,!!c,ye,!1):!!m!=!!c&&(a!=null?Ai(s,!!c,a,!0):Ai(s,!!c,c?[]:"",!1));return;case"textarea":ve=ye=null;for(W in c)if(v=c[W],c.hasOwnProperty(W)&&v!=null&&!m.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:Mt(s,a,W,null,m,v)}for(N in m)if(v=m[N],w=c[N],m.hasOwnProperty(N)&&(v!=null||w!=null))switch(N){case"value":ye=v;break;case"defaultValue":ve=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==w&&Mt(s,a,N,v,m,w)}vd(s,ye,ve);return;case"option":for(var Ve in c)ye=c[Ve],c.hasOwnProperty(Ve)&&ye!=null&&!m.hasOwnProperty(Ve)&&(Ve==="selected"?s.selected=!1:Mt(s,a,Ve,null,m,ye));for(se in m)ye=m[se],ve=c[se],m.hasOwnProperty(se)&&ye!==ve&&(ye!=null||ve!=null)&&(se==="selected"?s.selected=ye&&typeof ye!="function"&&typeof ye!="symbol":Mt(s,a,se,ye,m,ve));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ke in c)ye=c[Ke],c.hasOwnProperty(Ke)&&ye!=null&&!m.hasOwnProperty(Ke)&&Mt(s,a,Ke,null,m,ye);for(me in m)if(ye=m[me],ve=c[me],m.hasOwnProperty(me)&&ye!==ve&&(ye!=null||ve!=null))switch(me){case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(r(137,a));break;default:Mt(s,a,me,ye,m,ve)}return;default:if(qo(a)){for(var Nt in c)ye=c[Nt],c.hasOwnProperty(Nt)&&ye!==void 0&&!m.hasOwnProperty(Nt)&&og(s,a,Nt,void 0,m,ye);for(Ce in m)ye=m[Ce],ve=c[Ce],!m.hasOwnProperty(Ce)||ye===ve||ye===void 0&&ve===void 0||og(s,a,Ce,ye,m,ve);return}}for(var ue in c)ye=c[ue],c.hasOwnProperty(ue)&&ye!=null&&!m.hasOwnProperty(ue)&&Mt(s,a,ue,null,m,ye);for(Ie in m)ye=m[Ie],ve=c[Ie],!m.hasOwnProperty(Ie)||ye===ve||ye==null&&ve==null||Mt(s,a,Ie,ye,m,ve)}function Zv(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function _5(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),m=0;m<c.length;m++){var v=c[m],w=v.transferSize,N=v.initiatorType,W=v.duration;if(w&&W&&Zv(N)){for(N=0,W=v.responseEnd,m+=1;m<c.length;m++){var se=c[m],me=se.startTime;if(me>W)break;var Ce=se.transferSize,Ie=se.initiatorType;Ce&&Zv(Ie)&&(se=se.responseEnd,N+=Ce*(se<W?1:(W-me)/(se-me)))}if(--m,a+=8*(w+N)/(v.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var lg=null,cg=null;function Sh(s){return s.nodeType===9?s:s.ownerDocument}function Jv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ex(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function ug(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var dg=null;function b5(){var s=window.event;return s&&s.type==="popstate"?s===dg?!1:(dg=s,!0):(dg=null,!1)}var tx=typeof setTimeout=="function"?setTimeout:void 0,v5=typeof clearTimeout=="function"?clearTimeout:void 0,nx=typeof Promise=="function"?Promise:void 0,x5=typeof queueMicrotask=="function"?queueMicrotask:typeof nx<"u"?function(s){return nx.resolve(null).then(s).catch(w5)}:tx;function w5(s){setTimeout(function(){throw s})}function Xi(s){return s==="head"}function rx(s,a){var c=a,m=0;do{var v=c.nextSibling;if(s.removeChild(c),v&&v.nodeType===8)if(c=v.data,c==="/$"||c==="/&"){if(m===0){s.removeChild(v),Cl(a);return}m--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")m++;else if(c==="html")cu(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,cu(c);for(var w=c.firstChild;w;){var N=w.nextSibling,W=w.nodeName;w[ys]||W==="SCRIPT"||W==="STYLE"||W==="LINK"&&w.rel.toLowerCase()==="stylesheet"||c.removeChild(w),w=N}}else c==="body"&&cu(s.ownerDocument.body);c=v}while(c);Cl(a)}function sx(s,a){var c=s;s=0;do{var m=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=m}while(c)}function hg(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":hg(c),Fo(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function S5(s,a,c,m){for(;s.nodeType===1;){var v=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!m&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(m){if(!s[ys])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(w=s.getAttribute("rel"),w==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(w!==v.rel||s.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||s.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||s.getAttribute("title")!==(v.title==null?null:v.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(w=s.getAttribute("src"),(w!==(v.src==null?null:v.src)||s.getAttribute("type")!==(v.type==null?null:v.type)||s.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&w&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var w=v.name==null?null:""+v.name;if(v.type==="hidden"&&s.getAttribute("name")===w)return s}else return s;if(s=Lr(s.nextSibling),s===null)break}return null}function E5(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=Lr(s.nextSibling),s===null))return null;return s}function ix(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=Lr(s.nextSibling),s===null))return null;return s}function fg(s){return s.data==="$?"||s.data==="$~"}function mg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function C5(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var m=function(){a(),c.removeEventListener("DOMContentLoaded",m)};c.addEventListener("DOMContentLoaded",m),s._reactRetry=m}}function Lr(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var pg=null;function ax(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return Lr(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function ox(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function lx(s,a,c){switch(a=Sh(c),s){case"html":if(s=a.documentElement,!s)throw Error(r(452));return s;case"head":if(s=a.head,!s)throw Error(r(453));return s;case"body":if(s=a.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function cu(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);Fo(s)}var Ur=new Map,cx=new Set;function Eh(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var ci=G.d;G.d={f:T5,r:A5,D:j5,C:R5,L:I5,m:D5,X:O5,S:k5,M:M5};function T5(){var s=ci.f(),a=ph();return s||a}function A5(s){var a=Rr(s);a!==null&&a.tag===5&&a.type==="form"?Tb(a):ci.r(s)}var wl=typeof document>"u"?null:document;function ux(s,a,c){var m=wl;if(m&&typeof a=="string"&&a){var v=ir(a);v='link[rel="'+s+'"][href="'+v+'"]',typeof c=="string"&&(v+='[crossorigin="'+c+'"]'),cx.has(v)||(cx.add(v),s={rel:s,crossOrigin:c,href:a},m.querySelector(v)===null&&(a=m.createElement("link"),Bn(a,"link",s),un(a),m.head.appendChild(a)))}}function j5(s){ci.D(s),ux("dns-prefetch",s,null)}function R5(s,a){ci.C(s,a),ux("preconnect",s,a)}function I5(s,a,c){ci.L(s,a,c);var m=wl;if(m&&s&&a){var v='link[rel="preload"][as="'+ir(a)+'"]';a==="image"&&c&&c.imageSrcSet?(v+='[imagesrcset="'+ir(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(v+='[imagesizes="'+ir(c.imageSizes)+'"]')):v+='[href="'+ir(s)+'"]';var w=v;switch(a){case"style":w=Sl(s);break;case"script":w=El(s)}Ur.has(w)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),Ur.set(w,s),m.querySelector(v)!==null||a==="style"&&m.querySelector(uu(w))||a==="script"&&m.querySelector(du(w))||(a=m.createElement("link"),Bn(a,"link",s),un(a),m.head.appendChild(a)))}}function D5(s,a){ci.m(s,a);var c=wl;if(c&&s){var m=a&&typeof a.as=="string"?a.as:"script",v='link[rel="modulepreload"][as="'+ir(m)+'"][href="'+ir(s)+'"]',w=v;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=El(s)}if(!Ur.has(w)&&(s=g({rel:"modulepreload",href:s},a),Ur.set(w,s),c.querySelector(v)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(du(w)))return}m=c.createElement("link"),Bn(m,"link",s),un(m),c.head.appendChild(m)}}}function k5(s,a,c){ci.S(s,a,c);var m=wl;if(m&&s){var v=bs(m).hoistableStyles,w=Sl(s);a=a||"default";var N=v.get(w);if(!N){var W={loading:0,preload:null};if(N=m.querySelector(uu(w)))W.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=Ur.get(w))&&gg(s,c);var se=N=m.createElement("link");un(se),Bn(se,"link",s),se._p=new Promise(function(me,Ce){se.onload=me,se.onerror=Ce}),se.addEventListener("load",function(){W.loading|=1}),se.addEventListener("error",function(){W.loading|=2}),W.loading|=4,Ch(N,a,m)}N={type:"stylesheet",instance:N,count:1,state:W},v.set(w,N)}}}function O5(s,a){ci.X(s,a);var c=wl;if(c&&s){var m=bs(c).hoistableScripts,v=El(s),w=m.get(v);w||(w=c.querySelector(du(v)),w||(s=g({src:s,async:!0},a),(a=Ur.get(v))&&yg(s,a),w=c.createElement("script"),un(w),Bn(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},m.set(v,w))}}function M5(s,a){ci.M(s,a);var c=wl;if(c&&s){var m=bs(c).hoistableScripts,v=El(s),w=m.get(v);w||(w=c.querySelector(du(v)),w||(s=g({src:s,async:!0,type:"module"},a),(a=Ur.get(v))&&yg(s,a),w=c.createElement("script"),un(w),Bn(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},m.set(v,w))}}function dx(s,a,c,m){var v=(v=de.current)?Eh(v):null;if(!v)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=Sl(c.href),c=bs(v).hoistableStyles,m=c.get(a),m||(m={type:"style",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=Sl(c.href);var w=bs(v).hoistableStyles,N=w.get(s);if(N||(v=v.ownerDocument||v,N={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(s,N),(w=v.querySelector(uu(s)))&&!w._p&&(N.instance=w,N.state.loading=5),Ur.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Ur.set(s,c),w||N5(v,s,c,N.state))),a&&m===null)throw Error(r(528,""));return N}if(a&&m!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=El(c),c=bs(v).hoistableScripts,m=c.get(a),m||(m={type:"script",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function Sl(s){return'href="'+ir(s)+'"'}function uu(s){return'link[rel="stylesheet"]['+s+"]"}function hx(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function N5(s,a,c,m){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?m.loading=1:(a=s.createElement("link"),m.preload=a,a.addEventListener("load",function(){return m.loading|=1}),a.addEventListener("error",function(){return m.loading|=2}),Bn(a,"link",c),un(a),s.head.appendChild(a))}function El(s){return'[src="'+ir(s)+'"]'}function du(s){return"script[async]"+s}function fx(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var m=s.querySelector('style[data-href~="'+ir(c.href)+'"]');if(m)return a.instance=m,un(m),m;var v=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return m=(s.ownerDocument||s).createElement("style"),un(m),Bn(m,"style",v),Ch(m,c.precedence,s),a.instance=m;case"stylesheet":v=Sl(c.href);var w=s.querySelector(uu(v));if(w)return a.state.loading|=4,a.instance=w,un(w),w;m=hx(c),(v=Ur.get(v))&&gg(m,v),w=(s.ownerDocument||s).createElement("link"),un(w);var N=w;return N._p=new Promise(function(W,se){N.onload=W,N.onerror=se}),Bn(w,"link",m),a.state.loading|=4,Ch(w,c.precedence,s),a.instance=w;case"script":return w=El(c.src),(v=s.querySelector(du(w)))?(a.instance=v,un(v),v):(m=c,(v=Ur.get(w))&&(m=g({},c),yg(m,v)),s=s.ownerDocument||s,v=s.createElement("script"),un(v),Bn(v,"link",m),s.head.appendChild(v),a.instance=v);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(m=a.instance,a.state.loading|=4,Ch(m,c.precedence,s));return a.instance}function Ch(s,a,c){for(var m=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=m.length?m[m.length-1]:null,w=v,N=0;N<m.length;N++){var W=m[N];if(W.dataset.precedence===a)w=W;else if(w!==v)break}w?w.parentNode.insertBefore(s,w.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function gg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function yg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var Th=null;function mx(s,a,c){if(Th===null){var m=new Map,v=Th=new Map;v.set(c,m)}else v=Th,m=v.get(c),m||(m=new Map,v.set(c,m));if(m.has(s))return m;for(m.set(s,null),c=c.getElementsByTagName(s),v=0;v<c.length;v++){var w=c[v];if(!(w[ys]||w[cn]||s==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var N=w.getAttribute(a)||"";N=s+N;var W=m.get(N);W?W.push(w):m.set(N,[w])}}return m}function px(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function P5(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function gx(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function z5(s,a,c,m){if(c.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var v=Sl(m.href),w=a.querySelector(uu(v));if(w){a=w._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=Ah.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=w,un(w);return}w=a.ownerDocument||a,m=hx(m),(v=Ur.get(v))&&gg(m,v),w=w.createElement("link"),un(w);var N=w;N._p=new Promise(function(W,se){N.onload=W,N.onerror=se}),Bn(w,"link",m),c.instance=w}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Ah.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var _g=0;function B5(s,a){return s.stylesheets&&s.count===0&&Rh(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var m=setTimeout(function(){if(s.stylesheets&&Rh(s,s.stylesheets),s.unsuspend){var w=s.unsuspend;s.unsuspend=null,w()}},6e4+a);0<s.imgBytes&&_g===0&&(_g=62500*_5());var v=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Rh(s,s.stylesheets),s.unsuspend)){var w=s.unsuspend;s.unsuspend=null,w()}},(s.imgBytes>_g?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(m),clearTimeout(v)}}:null}function Ah(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Rh(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var jh=null;function Rh(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,jh=new Map,a.forEach(L5,s),jh=null,Ah.call(s))}function L5(s,a){if(!(a.state.loading&4)){var c=jh.get(s);if(c)var m=c.get(null);else{c=new Map,jh.set(s,c);for(var v=s.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<v.length;w++){var N=v[w];(N.nodeName==="LINK"||N.getAttribute("media")!=="not all")&&(c.set(N.dataset.precedence,N),m=N)}m&&c.set(null,m)}v=a.instance,N=v.getAttribute("data-precedence"),w=c.get(N)||m,w===m&&c.set(null,v),c.set(N,v),this.count++,m=Ah.bind(this),v.addEventListener("load",m),v.addEventListener("error",m),w?w.parentNode.insertBefore(v,w.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(v,s.firstChild)),a.state.loading|=4}}var hu={$$typeof:A,Provider:null,Consumer:null,_currentValue:X,_currentValue2:X,_threadCount:0};function U5(s,a,c,m,v,w,N,W,se){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ps(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ps(0),this.hiddenUpdates=ps(null),this.identifierPrefix=m,this.onUncaughtError=v,this.onCaughtError=w,this.onRecoverableError=N,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=se,this.incompleteTransitions=new Map}function yx(s,a,c,m,v,w,N,W,se,me,Ce,Ie){return s=new U5(s,a,c,N,se,me,Ce,Ie,W),a=1,w===!0&&(a|=24),w=br(3,null,null,a),s.current=w,w.stateNode=s,a=Xm(),a.refCount++,s.pooledCache=a,a.refCount++,w.memoizedState={element:m,isDehydrated:c,cache:a},tp(w),s}function _x(s){return s?(s=tl,s):tl}function bx(s,a,c,m,v,w){v=_x(v),m.context===null?m.context=v:m.pendingContext=v,m=Ui(a),m.payload={element:c},w=w===void 0?null:w,w!==null&&(m.callback=w),c=Fi(s,m,a),c!==null&&(dr(c,s,a),qc(c,s,a))}function vx(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function bg(s,a){vx(s,a),(s=s.alternate)&&vx(s,a)}function xx(s){if(s.tag===13||s.tag===31){var a=Ja(s,67108864);a!==null&&dr(a,s,67108864),bg(s,67108864)}}function wx(s){if(s.tag===13||s.tag===31){var a=Er();a=Fa(a);var c=Ja(s,a);c!==null&&dr(c,s,a),bg(s,a)}}var Ih=!0;function F5(s,a,c,m){var v=Q.T;Q.T=null;var w=G.p;try{G.p=2,vg(s,a,c,m)}finally{G.p=w,Q.T=v}}function V5(s,a,c,m){var v=Q.T;Q.T=null;var w=G.p;try{G.p=8,vg(s,a,c,m)}finally{G.p=w,Q.T=v}}function vg(s,a,c,m){if(Ih){var v=xg(m);if(v===null)ag(s,a,m,Dh,c),Ex(s,m);else if(q5(v,s,a,c,m))m.stopPropagation();else if(Ex(s,m),a&4&&-1<$5.indexOf(s)){for(;v!==null;){var w=Rr(v);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var N=er(w.pendingLanes);if(N!==0){var W=w;for(W.pendingLanes|=2,W.entangledLanes|=2;N;){var se=1<<31-Et(N);W.entanglements[1]|=se,N&=~se}ks(w),(Tt&6)===0&&(fh=Pe()+500,au(0))}}break;case 31:case 13:W=Ja(w,2),W!==null&&dr(W,w,2),ph(),bg(w,2)}if(w=xg(m),w===null&&ag(s,a,m,Dh,c),w===v)break;v=w}v!==null&&m.stopPropagation()}else ag(s,a,m,null,c)}}function xg(s){return s=Ir(s),wg(s)}var Dh=null;function wg(s){if(Dh=null,s=_s(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=l(a),s!==null)return s;s=null}else if(c===31){if(s=u(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return Dh=s,null}function Sx(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Oe()){case Ge:return 2;case xt:return 8;case st:case Hn:return 32;case ds:return 268435456;default:return 32}default:return 32}}var Sg=!1,Zi=null,Ji=null,ea=null,fu=new Map,mu=new Map,ta=[],$5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ex(s,a){switch(s){case"focusin":case"focusout":Zi=null;break;case"dragenter":case"dragleave":Ji=null;break;case"mouseover":case"mouseout":ea=null;break;case"pointerover":case"pointerout":fu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":mu.delete(a.pointerId)}}function pu(s,a,c,m,v,w){return s===null||s.nativeEvent!==w?(s={blockedOn:a,domEventName:c,eventSystemFlags:m,nativeEvent:w,targetContainers:[v]},a!==null&&(a=Rr(a),a!==null&&xx(a)),s):(s.eventSystemFlags|=m,a=s.targetContainers,v!==null&&a.indexOf(v)===-1&&a.push(v),s)}function q5(s,a,c,m,v){switch(a){case"focusin":return Zi=pu(Zi,s,a,c,m,v),!0;case"dragenter":return Ji=pu(Ji,s,a,c,m,v),!0;case"mouseover":return ea=pu(ea,s,a,c,m,v),!0;case"pointerover":var w=v.pointerId;return fu.set(w,pu(fu.get(w)||null,s,a,c,m,v)),!0;case"gotpointercapture":return w=v.pointerId,mu.set(w,pu(mu.get(w)||null,s,a,c,m,v)),!0}return!1}function Cx(s){var a=_s(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){s.blockedOn=a,Qr(s.priority,function(){wx(c)});return}}else if(a===31){if(a=u(c),a!==null){s.blockedOn=a,Qr(s.priority,function(){wx(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function kh(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=xg(s.nativeEvent);if(c===null){c=s.nativeEvent;var m=new c.constructor(c.type,c);jc=m,c.target.dispatchEvent(m),jc=null}else return a=Rr(c),a!==null&&xx(a),s.blockedOn=c,!1;a.shift()}return!0}function Tx(s,a,c){kh(s)&&c.delete(a)}function G5(){Sg=!1,Zi!==null&&kh(Zi)&&(Zi=null),Ji!==null&&kh(Ji)&&(Ji=null),ea!==null&&kh(ea)&&(ea=null),fu.forEach(Tx),mu.forEach(Tx)}function Oh(s,a){s.blockedOn===a&&(s.blockedOn=null,Sg||(Sg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,G5)))}var Mh=null;function Ax(s){Mh!==s&&(Mh=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Mh===s&&(Mh=null);for(var a=0;a<s.length;a+=3){var c=s[a],m=s[a+1],v=s[a+2];if(typeof m!="function"){if(wg(m||c)===null)continue;break}var w=Rr(c);w!==null&&(s.splice(a,3),a-=3,xp(w,{pending:!0,data:v,method:c.method,action:m},m,v))}}))}function Cl(s){function a(se){return Oh(se,s)}Zi!==null&&Oh(Zi,s),Ji!==null&&Oh(Ji,s),ea!==null&&Oh(ea,s),fu.forEach(a),mu.forEach(a);for(var c=0;c<ta.length;c++){var m=ta[c];m.blockedOn===s&&(m.blockedOn=null)}for(;0<ta.length&&(c=ta[0],c.blockedOn===null);)Cx(c),c.blockedOn===null&&ta.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(m=0;m<c.length;m+=3){var v=c[m],w=c[m+1],N=v[jn]||null;if(typeof w=="function")N||Ax(c);else if(N){var W=null;if(w&&w.hasAttribute("formAction")){if(v=w,N=w[jn]||null)W=N.formAction;else if(wg(v)!==null)continue}else W=N.action;typeof W=="function"?c[m+1]=W:(c.splice(m,3),m-=3),Ax(c)}}}function jx(){function s(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(N){return v=N})},focusReset:"manual",scroll:"manual"})}function a(){v!==null&&(v(),v=null),m||setTimeout(c,20)}function c(){if(!m&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,v=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){m=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),v!==null&&(v(),v=null)}}}function Eg(s){this._internalRoot=s}Nh.prototype.render=Eg.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,m=Er();bx(c,m,s,a,null,null)},Nh.prototype.unmount=Eg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;bx(s.current,2,null,s,null,null),ph(),a[gs]=null}};function Nh(s){this._internalRoot=s}Nh.prototype.unstable_scheduleHydration=function(s){if(s){var a=pd();s={blockedOn:null,target:s,priority:a};for(var c=0;c<ta.length&&a!==0&&a<ta[c].priority;c++);ta.splice(c,0,s),c===0&&Cx(s)}};var Rx=e.version;if(Rx!=="19.2.3")throw Error(r(527,Rx,"19.2.3"));G.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=f(a),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var H5={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Q,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ph=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ph.isDisabled&&Ph.supportsFiber)try{bt=Ph.inject(H5),Jt=Ph}catch{}}return yu.createRoot=function(s,a){if(!i(s))throw Error(r(299));var c=!1,m="",v=Pb,w=zb,N=Bb;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onUncaughtError!==void 0&&(v=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(N=a.onRecoverableError)),a=yx(s,1,!1,null,null,c,m,null,v,w,N,jx),s[gs]=a.current,ig(s),new Eg(a)},yu.hydrateRoot=function(s,a,c){if(!i(s))throw Error(r(299));var m=!1,v="",w=Pb,N=zb,W=Bb,se=null;return c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(v=c.identifierPrefix),c.onUncaughtError!==void 0&&(w=c.onUncaughtError),c.onCaughtError!==void 0&&(N=c.onCaughtError),c.onRecoverableError!==void 0&&(W=c.onRecoverableError),c.formState!==void 0&&(se=c.formState)),a=yx(s,1,!0,a,c??null,m,v,se,w,N,W,jx),a.context=_x(null),c=a.current,m=Er(),m=Fa(m),v=Ui(m),v.callback=null,Fi(c,v,m),c=m,a.current.lanes=c,La(a,c),ks(a),s[gs]=a.current,ig(s),new Nh(a)},yu.version="19.2.3",yu}var Lx;function r2(){if(Lx)return Ag.exports;Lx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ag.exports=n2(),Ag.exports}var s2=r2();var Ux="popstate";function i2(t={}){function e(r,i){let{pathname:o,search:l,hash:u}=r.location;return ey("",{pathname:o,search:l,hash:u},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:Du(i)}return o2(e,n,null,t)}function Yt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Tr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function a2(){return Math.random().toString(36).substring(2,10)}function Fx(t,e){return{usr:t.state,key:t.key,idx:e}}function ey(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?ec(e):e,state:n,key:e&&e.key||r||a2()}}function Du({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function ec(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function o2(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,l=i.history,u="POP",h=null,f=p();f==null&&(f=0,l.replaceState({...l.state,idx:f},""));function p(){return(l.state||{idx:null}).idx}function g(){u="POP";let E=p(),C=E==null?null:E-f;f=E,h&&h({action:u,location:x.location,delta:C})}function _(E,C){u="PUSH";let T=ey(x.location,E,C);f=p()+1;let A=Fx(T,f),U=x.createHref(T);try{l.pushState(A,"",U)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;i.location.assign(U)}o&&h&&h({action:u,location:x.location,delta:1})}function b(E,C){u="REPLACE";let T=ey(x.location,E,C);f=p();let A=Fx(T,f),U=x.createHref(T);l.replaceState(A,"",U),o&&h&&h({action:u,location:x.location,delta:0})}function S(E){return l2(E)}let x={get action(){return u},get location(){return t(i,l)},listen(E){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(Ux,g),h=E,()=>{i.removeEventListener(Ux,g),h=null}},createHref(E){return e(i,E)},createURL:S,encodeLocation(E){let C=S(E);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:_,replace:b,go(E){return l.go(E)}};return x}function l2(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Yt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Du(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function dS(t,e,n="/"){return c2(t,e,n,!1)}function c2(t,e,n,r){let i=typeof e=="string"?ec(e):e,o=pi(i.pathname||"/",n);if(o==null)return null;let l=hS(t);u2(l);let u=null;for(let h=0;u==null&&h<l.length;++h){let f=x2(o);u=b2(l[h],f,r)}return u}function hS(t,e=[],n=[],r="",i=!1){let o=(l,u,h=i,f)=>{let p={relativePath:f===void 0?l.path||"":f,caseSensitive:l.caseSensitive===!0,childrenIndex:u,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;Yt(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=fi([r,p.relativePath]),_=n.concat(p);l.children&&l.children.length>0&&(Yt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),hS(l.children,e,_,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:y2(g,l.index),routesMeta:_})};return t.forEach((l,u)=>{if(l.path===""||!l.path?.includes("?"))o(l,u);else for(let h of fS(l.path))o(l,u,!0,h)}),e}function fS(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let l=fS(r.join("/")),u=[];return u.push(...l.map(h=>h===""?o:[o,h].join("/"))),i&&u.push(...l),u.map(h=>t.startsWith("/")&&h===""?"/":h)}function u2(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:_2(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var d2=/^:[\w-]+$/,h2=3,f2=2,m2=1,p2=10,g2=-2,Vx=t=>t==="*";function y2(t,e){let n=t.split("/"),r=n.length;return n.some(Vx)&&(r+=g2),e&&(r+=f2),n.filter(i=>!Vx(i)).reduce((i,o)=>i+(d2.test(o)?h2:o===""?m2:p2),r)}function _2(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function b2(t,e,n=!1){let{routesMeta:r}=t,i={},o="/",l=[];for(let u=0;u<r.length;++u){let h=r[u],f=u===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=of({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},p),_=h.route;if(!g&&f&&n&&!r[r.length-1].route.index&&(g=of({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(i,g.params),l.push({params:i,pathname:fi([o,g.pathname]),pathnameBase:C2(fi([o,g.pathnameBase])),route:_}),g.pathnameBase!=="/"&&(o=fi([o,g.pathnameBase]))}return l}function of(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=v2(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],l=o.replace(/(.)\/+$/,"$1"),u=i.slice(1);return{params:r.reduce((f,{paramName:p,isOptional:g},_)=>{if(p==="*"){let S=u[_]||"";l=o.slice(0,o.length-S.length).replace(/(.)\/+$/,"$1")}const b=u[_];return g&&!b?f[p]=void 0:f[p]=(b||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:l,pattern:t}}function v2(t,e=!1,n=!0){Tr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,u,h)=>(r.push({paramName:u,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function x2(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Tr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function pi(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var mS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,w2=t=>mS.test(t);function S2(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?ec(t):t,o;if(n)if(w2(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),Tr(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${n}`)}n.startsWith("/")?o=$x(n.substring(1),"/"):o=$x(n,e)}else o=e;return{pathname:o,search:T2(r),hash:A2(i)}}function $x(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Dg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function E2(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Uy(t){let e=E2(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Fy(t,e,n,r=!1){let i;typeof t=="string"?i=ec(t):(i={...t},Yt(!i.pathname||!i.pathname.includes("?"),Dg("?","pathname","search",i)),Yt(!i.pathname||!i.pathname.includes("#"),Dg("#","pathname","hash",i)),Yt(!i.search||!i.search.includes("#"),Dg("#","search","hash",i)));let o=t===""||i.pathname==="",l=o?"/":i.pathname,u;if(l==null)u=n;else{let g=e.length-1;if(!r&&l.startsWith("..")){let _=l.split("/");for(;_[0]==="..";)_.shift(),g-=1;i.pathname=_.join("/")}u=g>=0?e[g]:"/"}let h=S2(i,u),f=l&&l!=="/"&&l.endsWith("/"),p=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(f||p)&&(h.pathname+="/"),h}var fi=t=>t.join("/").replace(/\/\/+/g,"/"),C2=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),T2=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,A2=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,j2=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function R2(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function I2(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var pS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function gS(t,e){let n=t;if(typeof n!="string"||!mS.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(pS)try{let o=new URL(window.location.href),l=n.startsWith("//")?new URL(o.protocol+n):new URL(n),u=pi(l.pathname,e);l.origin===o.origin&&u!=null?n=u+l.search+l.hash:i=!0}catch{Tr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var yS=["POST","PUT","PATCH","DELETE"];new Set(yS);var D2=["GET",...yS];new Set(D2);var tc=k.createContext(null);tc.displayName="DataRouter";var Lf=k.createContext(null);Lf.displayName="DataRouterState";var k2=k.createContext(!1),_S=k.createContext({isTransitioning:!1});_S.displayName="ViewTransition";var O2=k.createContext(new Map);O2.displayName="Fetchers";var M2=k.createContext(null);M2.displayName="Await";var Ar=k.createContext(null);Ar.displayName="Navigation";var Wu=k.createContext(null);Wu.displayName="Location";var qr=k.createContext({outlet:null,matches:[],isDataRoute:!1});qr.displayName="Route";var Vy=k.createContext(null);Vy.displayName="RouteError";var bS="REACT_ROUTER_ERROR",N2="REDIRECT",P2="ROUTE_ERROR_RESPONSE";function z2(t){if(t.startsWith(`${bS}:${N2}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function B2(t){if(t.startsWith(`${bS}:${P2}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new j2(e.status,e.statusText,e.data)}catch{}}function L2(t,{relative:e}={}){Yt(nc(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=k.useContext(Ar),{hash:i,pathname:o,search:l}=Yu(t,{relative:e}),u=o;return n!=="/"&&(u=o==="/"?n:fi([n,o])),r.createHref({pathname:u,search:l,hash:i})}function nc(){return k.useContext(Wu)!=null}function On(){return Yt(nc(),"useLocation() may be used only in the context of a <Router> component."),k.useContext(Wu).location}var vS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function xS(t){k.useContext(Ar).static||k.useLayoutEffect(t)}function Ku(){let{isDataRoute:t}=k.useContext(qr);return t?tj():U2()}function U2(){Yt(nc(),"useNavigate() may be used only in the context of a <Router> component.");let t=k.useContext(tc),{basename:e,navigator:n}=k.useContext(Ar),{matches:r}=k.useContext(qr),{pathname:i}=On(),o=JSON.stringify(Uy(r)),l=k.useRef(!1);return xS(()=>{l.current=!0}),k.useCallback((h,f={})=>{if(Tr(l.current,vS),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=Fy(h,JSON.parse(o),i,f.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:fi([e,p.pathname])),(f.replace?n.replace:n.push)(p,f.state,f)},[e,n,o,i,t])}var F2=k.createContext(null);function V2(t){let e=k.useContext(qr).outlet;return k.useMemo(()=>e&&k.createElement(F2.Provider,{value:t},e),[e,t])}function $2(){let{matches:t}=k.useContext(qr),e=t[t.length-1];return e?e.params:{}}function Yu(t,{relative:e}={}){let{matches:n}=k.useContext(qr),{pathname:r}=On(),i=JSON.stringify(Uy(n));return k.useMemo(()=>Fy(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function q2(t,e){return wS(t,e)}function wS(t,e,n,r,i){Yt(nc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=k.useContext(Ar),{matches:l}=k.useContext(qr),u=l[l.length-1],h=u?u.params:{},f=u?u.pathname:"/",p=u?u.pathnameBase:"/",g=u&&u.route;{let T=g&&g.path||"";ES(f,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let _=On(),b;if(e){let T=typeof e=="string"?ec(e):e;Yt(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),b=T}else b=_;let S=b.pathname||"/",x=S;if(p!=="/"){let T=p.replace(/^\//,"").split("/");x="/"+S.replace(/^\//,"").split("/").slice(T.length).join("/")}let E=dS(t,{pathname:x});Tr(g||E!=null,`No routes matched location "${b.pathname}${b.search}${b.hash}" `),Tr(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${b.pathname}${b.search}${b.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=K2(E&&E.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:fi([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:fi([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),l,n,r,i);return e&&C?k.createElement(Wu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...b},navigationType:"POP"}},C):C}function G2(){let t=ej(),e=R2(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=k.createElement(k.Fragment,null,k.createElement("p",null," Hey developer "),k.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",k.createElement("code",{style:o},"ErrorBoundary")," or"," ",k.createElement("code",{style:o},"errorElement")," prop on your route.")),k.createElement(k.Fragment,null,k.createElement("h2",null,"Unexpected Application Error!"),k.createElement("h3",{style:{fontStyle:"italic"}},e),n?k.createElement("pre",{style:i},n):null,l)}var H2=k.createElement(G2,null),SS=class extends k.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=B2(t.digest);n&&(t=n)}let e=t!==void 0?k.createElement(qr.Provider,{value:this.props.routeContext},k.createElement(Vy.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?k.createElement(Q2,{error:t},e):e}};SS.contextType=k2;var kg=new WeakMap;function Q2({children:t,error:e}){let{basename:n}=k.useContext(Ar);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=z2(e.digest);if(r){let i=kg.get(e);if(i)throw i;let o=gS(r.location,n);if(pS&&!kg.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw kg.set(e,l),l}return k.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function W2({routeContext:t,match:e,children:n}){let r=k.useContext(tc);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),k.createElement(qr.Provider,{value:t},n)}function K2(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=n?.errors;if(l!=null){let p=o.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Yt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let u=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:_,errors:b}=n,S=g.route.loader&&!_.hasOwnProperty(g.route.id)&&(!b||b[g.route.id]===void 0);if(g.route.lazy||S){u=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let f=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:I2(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,_)=>{let b,S=!1,x=null,E=null;n&&(b=l&&g.route.id?l[g.route.id]:void 0,x=g.route.errorElement||H2,u&&(h<0&&_===0?(ES("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,E=null):h===_&&(S=!0,E=g.route.hydrateFallbackElement||null)));let C=e.concat(o.slice(0,_+1)),T=()=>{let A;return b?A=x:S?A=E:g.route.Component?A=k.createElement(g.route.Component,null):g.route.element?A=g.route.element:A=p,k.createElement(W2,{match:g,routeContext:{outlet:p,matches:C,isDataRoute:n!=null},children:A})};return n&&(g.route.ErrorBoundary||g.route.errorElement||_===0)?k.createElement(SS,{location:n.location,revalidation:n.revalidation,component:x,error:b,children:T(),routeContext:{outlet:null,matches:C,isDataRoute:!0},onError:f}):T()},null)}function $y(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Y2(t){let e=k.useContext(tc);return Yt(e,$y(t)),e}function X2(t){let e=k.useContext(Lf);return Yt(e,$y(t)),e}function Z2(t){let e=k.useContext(qr);return Yt(e,$y(t)),e}function qy(t){let e=Z2(t),n=e.matches[e.matches.length-1];return Yt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function J2(){return qy("useRouteId")}function ej(){let t=k.useContext(Vy),e=X2("useRouteError"),n=qy("useRouteError");return t!==void 0?t:e.errors?.[n]}function tj(){let{router:t}=Y2("useNavigate"),e=qy("useNavigate"),n=k.useRef(!1);return xS(()=>{n.current=!0}),k.useCallback(async(i,o={})=>{Tr(n.current,vS),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...o}))},[t,e])}var qx={};function ES(t,e,n){!e&&!qx[t]&&(qx[t]=!0,Tr(!1,n))}k.memo(nj);function nj({routes:t,future:e,state:n,onError:r}){return wS(t,void 0,n,r,e)}function Uf({to:t,replace:e,state:n,relative:r}){Yt(nc(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=k.useContext(Ar);Tr(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=k.useContext(qr),{pathname:l}=On(),u=Ku(),h=Fy(t,Uy(o),l,r==="path"),f=JSON.stringify(h);return k.useEffect(()=>{u(JSON.parse(f),{replace:e,state:n,relative:r})},[u,f,r,e,n]),null}function Ff(t){return V2(t.context)}function wn(t){Yt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function rj({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:o=!1,unstable_useTransitions:l}){Yt(!nc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=t.replace(/^\/*/,"/"),h=k.useMemo(()=>({basename:u,navigator:i,static:o,unstable_useTransitions:l,future:{}}),[u,i,o,l]);typeof n=="string"&&(n=ec(n));let{pathname:f="/",search:p="",hash:g="",state:_=null,key:b="default"}=n,S=k.useMemo(()=>{let x=pi(f,u);return x==null?null:{location:{pathname:x,search:p,hash:g,state:_,key:b},navigationType:r}},[u,f,p,g,_,b,r]);return Tr(S!=null,`<Router basename="${u}"> is not able to match the URL "${f}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:k.createElement(Ar.Provider,{value:h},k.createElement(Wu.Provider,{children:e,value:S}))}function sj({children:t,location:e}){return q2(ty(t),e)}function ty(t,e=[]){let n=[];return k.Children.forEach(t,(r,i)=>{if(!k.isValidElement(r))return;let o=[...e,i];if(r.type===k.Fragment){n.push.apply(n,ty(r.props.children,o));return}Yt(r.type===wn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Yt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=ty(r.props.children,o)),n.push(l)}),n}var Wh="get",Kh="application/x-www-form-urlencoded";function Vf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function ij(t){return Vf(t)&&t.tagName.toLowerCase()==="button"}function aj(t){return Vf(t)&&t.tagName.toLowerCase()==="form"}function oj(t){return Vf(t)&&t.tagName.toLowerCase()==="input"}function lj(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function cj(t,e){return t.button===0&&(!e||e==="_self")&&!lj(t)}function ny(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function uj(t,e){let n=ny(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(o=>{n.append(i,o)})}),n}var Bh=null;function dj(){if(Bh===null)try{new FormData(document.createElement("form"),0),Bh=!1}catch{Bh=!0}return Bh}var hj=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Og(t){return t!=null&&!hj.has(t)?(Tr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Kh}"`),null):t}function fj(t,e){let n,r,i,o,l;if(aj(t)){let u=t.getAttribute("action");r=u?pi(u,e):null,n=t.getAttribute("method")||Wh,i=Og(t.getAttribute("enctype"))||Kh,o=new FormData(t)}else if(ij(t)||oj(t)&&(t.type==="submit"||t.type==="image")){let u=t.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||u.getAttribute("action");if(r=h?pi(h,e):null,n=t.getAttribute("formmethod")||u.getAttribute("method")||Wh,i=Og(t.getAttribute("formenctype"))||Og(u.getAttribute("enctype"))||Kh,o=new FormData(u,t),!dj()){let{name:f,type:p,value:g}=t;if(p==="image"){let _=f?`${f}.`:"";o.append(`${_}x`,"0"),o.append(`${_}y`,"0")}else f&&o.append(f,g)}}else{if(Vf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Wh,r=null,i=Kh,l=t}return o&&i==="text/plain"&&(l=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Gy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function mj(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&pi(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function pj(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function gj(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function yj(t,e,n){let r=await Promise.all(t.map(async i=>{let o=e.routes[i.route.id];if(o){let l=await pj(o,n);return l.links?l.links():[]}return[]}));return xj(r.flat(1).filter(gj).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Gx(t,e,n,r,i,o){let l=(h,f)=>n[f]?h.route.id!==n[f].route.id:!0,u=(h,f)=>n[f].pathname!==h.pathname||n[f].route.path?.endsWith("*")&&n[f].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,f)=>l(h,f)||u(h,f)):o==="data"?e.filter((h,f)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,f)||u(h,f))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function _j(t,e,{includeHydrateFallback:n}={}){return bj(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function bj(t){return[...new Set(t)]}function vj(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function xj(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let o=JSON.stringify(vj(i));return n.has(o)||(n.add(o),r.push({key:o,link:i})),r},[])}function CS(){let t=k.useContext(tc);return Gy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function wj(){let t=k.useContext(Lf);return Gy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Hy=k.createContext(void 0);Hy.displayName="FrameworkContext";function TS(){let t=k.useContext(Hy);return Gy(t,"You must render this element inside a <HydratedRouter> element"),t}function Sj(t,e){let n=k.useContext(Hy),[r,i]=k.useState(!1),[o,l]=k.useState(!1),{onFocus:u,onBlur:h,onMouseEnter:f,onMouseLeave:p,onTouchStart:g}=e,_=k.useRef(null);k.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=C=>{C.forEach(T=>{l(T.isIntersecting)})},E=new IntersectionObserver(x,{threshold:.5});return _.current&&E.observe(_.current),()=>{E.disconnect()}}},[t]),k.useEffect(()=>{if(r){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[r]);let b=()=>{i(!0)},S=()=>{i(!1),l(!1)};return n?t!=="intent"?[o,_,{}]:[o,_,{onFocus:_u(u,b),onBlur:_u(h,S),onMouseEnter:_u(f,b),onMouseLeave:_u(p,S),onTouchStart:_u(g,b)}]:[!1,_,{}]}function _u(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function Ej({page:t,...e}){let{router:n}=CS(),r=k.useMemo(()=>dS(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?k.createElement(Tj,{page:t,matches:r,...e}):null}function Cj(t){let{manifest:e,routeModules:n}=TS(),[r,i]=k.useState([]);return k.useEffect(()=>{let o=!1;return yj(t,e,n).then(l=>{o||i(l)}),()=>{o=!0}},[t,e,n]),r}function Tj({page:t,matches:e,...n}){let r=On(),{manifest:i,routeModules:o}=TS(),{basename:l}=CS(),{loaderData:u,matches:h}=wj(),f=k.useMemo(()=>Gx(t,e,h,i,r,"data"),[t,e,h,i,r]),p=k.useMemo(()=>Gx(t,e,h,i,r,"assets"),[t,e,h,i,r]),g=k.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let S=new Set,x=!1;if(e.forEach(C=>{let T=i.routes[C.route.id];!T||!T.hasLoader||(!f.some(A=>A.route.id===C.route.id)&&C.route.id in u&&o[C.route.id]?.shouldRevalidate||T.hasClientLoader?x=!0:S.add(C.route.id))}),S.size===0)return[];let E=mj(t,l,"data");return x&&S.size>0&&E.searchParams.set("_routes",e.filter(C=>S.has(C.route.id)).map(C=>C.route.id).join(",")),[E.pathname+E.search]},[l,u,r,i,f,e,t,o]),_=k.useMemo(()=>_j(p,i),[p,i]),b=Cj(p);return k.createElement(k.Fragment,null,g.map(S=>k.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...n})),_.map(S=>k.createElement("link",{key:S,rel:"modulepreload",href:S,...n})),b.map(({key:S,link:x})=>k.createElement("link",{key:S,nonce:n.nonce,...x})))}function Aj(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var jj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{jj&&(window.__reactRouterVersion="7.11.0")}catch{}function Rj({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=k.useRef();i.current==null&&(i.current=i2({window:r,v5Compat:!0}));let o=i.current,[l,u]=k.useState({action:o.action,location:o.location}),h=k.useCallback(f=>{n===!1?u(f):k.startTransition(()=>u(f))},[n]);return k.useLayoutEffect(()=>o.listen(h),[o,h]),k.createElement(rj,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:n})}var AS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Cn=k.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:o,replace:l,state:u,target:h,to:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:_,...b},S){let{basename:x,unstable_useTransitions:E}=k.useContext(Ar),C=typeof f=="string"&&AS.test(f),T=gS(f,x);f=T.to;let A=L2(f,{relative:i}),[U,F,H]=Sj(r,b),O=Oj(f,{replace:l,state:u,target:h,preventScrollReset:p,relative:i,viewTransition:g,unstable_defaultShouldRevalidate:_,unstable_useTransitions:E});function D(L){e&&e(L),L.defaultPrevented||O(L)}let P=k.createElement("a",{...b,...H,href:T.absoluteURL||A,onClick:T.isExternal||o?e:D,ref:Aj(S,F),target:h,"data-discover":!C&&n==="render"?"true":void 0});return U&&!C?k.createElement(k.Fragment,null,P,k.createElement(Ej,{page:A})):P});Cn.displayName="Link";var Ij=k.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:o,to:l,viewTransition:u,children:h,...f},p){let g=Yu(l,{relative:f.relative}),_=On(),b=k.useContext(Lf),{navigator:S,basename:x}=k.useContext(Ar),E=b!=null&&Bj(g)&&u===!0,C=S.encodeLocation?S.encodeLocation(g).pathname:g.pathname,T=_.pathname,A=b&&b.navigation&&b.navigation.location?b.navigation.location.pathname:null;n||(T=T.toLowerCase(),A=A?A.toLowerCase():null,C=C.toLowerCase()),A&&x&&(A=pi(A,x)||A);const U=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let F=T===C||!i&&T.startsWith(C)&&T.charAt(U)==="/",H=A!=null&&(A===C||!i&&A.startsWith(C)&&A.charAt(C.length)==="/"),O={isActive:F,isPending:H,isTransitioning:E},D=F?e:void 0,P;typeof r=="function"?P=r(O):P=[r,F?"active":null,H?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let L=typeof o=="function"?o(O):o;return k.createElement(Cn,{...f,"aria-current":D,className:P,ref:p,style:L,to:l,viewTransition:u},typeof h=="function"?h(O):h)});Ij.displayName="NavLink";var Dj=k.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:o,method:l=Wh,action:u,onSubmit:h,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:_,...b},S)=>{let{unstable_useTransitions:x}=k.useContext(Ar),E=Pj(),C=zj(u,{relative:f}),T=l.toLowerCase()==="get"?"get":"post",A=typeof u=="string"&&AS.test(u),U=F=>{if(h&&h(F),F.defaultPrevented)return;F.preventDefault();let H=F.nativeEvent.submitter,O=H?.getAttribute("formmethod")||l,D=()=>E(H||F.currentTarget,{fetcherKey:e,method:O,navigate:n,replace:i,state:o,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:_});x&&n!==!1?k.startTransition(()=>D()):D()};return k.createElement("form",{ref:S,method:T,action:C,onSubmit:r?h:U,...b,"data-discover":!A&&t==="render"?"true":void 0})});Dj.displayName="Form";function kj(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function jS(t){let e=k.useContext(tc);return Yt(e,kj(t)),e}function Oj(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:u,unstable_useTransitions:h}={}){let f=Ku(),p=On(),g=Yu(t,{relative:o});return k.useCallback(_=>{if(cj(_,e)){_.preventDefault();let b=n!==void 0?n:Du(p)===Du(g),S=()=>f(t,{replace:b,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:u});h?k.startTransition(()=>S()):S()}},[p,f,g,n,r,e,t,i,o,l,u,h])}function RS(t){Tr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=k.useRef(ny(t)),n=k.useRef(!1),r=On(),i=k.useMemo(()=>uj(r.search,n.current?null:e.current),[r.search]),o=Ku(),l=k.useCallback((u,h)=>{const f=ny(typeof u=="function"?u(new URLSearchParams(i)):u);n.current=!0,o("?"+f,h)},[o,i]);return[i,l]}var Mj=0,Nj=()=>`__${String(++Mj)}__`;function Pj(){let{router:t}=jS("useSubmit"),{basename:e}=k.useContext(Ar),n=J2(),r=t.fetch,i=t.navigate;return k.useCallback(async(o,l={})=>{let{action:u,method:h,encType:f,formData:p,body:g}=fj(o,e);if(l.navigate===!1){let _=l.fetcherKey||Nj();await r(_,n,l.action||u,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||f,flushSync:l.flushSync})}else await i(l.action||u,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||f,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[r,i,e,n])}function zj(t,{relative:e}={}){let{basename:n}=k.useContext(Ar),r=k.useContext(qr);Yt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...Yu(t||".",{relative:e})},l=On();if(t==null){o.search=l.search;let u=new URLSearchParams(o.search),h=u.getAll("index");if(h.some(p=>p==="")){u.delete("index"),h.filter(g=>g).forEach(g=>u.append("index",g));let p=u.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:fi([n,o.pathname])),Du(o)}function Bj(t,{relative:e}={}){let n=k.useContext(_S);Yt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=jS("useViewTransitionState"),i=Yu(t,{relative:e});if(!n.isTransitioning)return!1;let o=pi(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=pi(n.nextLocation.pathname,r)||n.nextLocation.pathname;return of(i.pathname,l)!=null||of(i.pathname,o)!=null}var rc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Lj={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Uj=class{#e=Lj;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},yo=new Uj;function Fj(t){setTimeout(t,0)}var wo=typeof window>"u"||"Deno"in globalThis;function rr(){}function Vj(t,e){return typeof t=="function"?t(e):t}function ry(t){return typeof t=="number"&&t>=0&&t!==1/0}function IS(t,e){return Math.max(t+(e||0)-Date.now(),0)}function ma(t,e){return typeof t=="function"?t(e):t}function Fr(t,e){return typeof t=="function"?t(e):t}function Hx(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:o,queryKey:l,stale:u}=t;if(l){if(r){if(e.queryHash!==Qy(l,e.options))return!1}else if(!ku(e.queryKey,l))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof u=="boolean"&&e.isStale()!==u||i&&i!==e.state.fetchStatus||o&&!o(e))}function Qx(t,e){const{exact:n,status:r,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(So(e.options.mutationKey)!==So(o))return!1}else if(!ku(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function Qy(t,e){return(e?.queryKeyHashFn||So)(t)}function So(t){return JSON.stringify(t,(e,n)=>sy(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function ku(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>ku(t[n],e[n])):!1}var $j=Object.prototype.hasOwnProperty;function DS(t,e){if(t===e)return t;const n=Wx(t)&&Wx(e);if(!n&&!(sy(t)&&sy(e)))return e;const i=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),l=o.length,u=n?new Array(l):{};let h=0;for(let f=0;f<l;f++){const p=n?f:o[f],g=t[p],_=e[p];if(g===_){u[p]=g,(n?f<i:$j.call(t,p))&&h++;continue}if(g===null||_===null||typeof g!="object"||typeof _!="object"){u[p]=_;continue}const b=DS(g,_);u[p]=b,b===g&&h++}return i===l&&h===i?t:u}function lf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Wx(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function sy(t){if(!Kx(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Kx(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Kx(t){return Object.prototype.toString.call(t)==="[object Object]"}function qj(t){return new Promise(e=>{yo.setTimeout(e,t)})}function iy(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?DS(t,e):e}function Gj(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function Hj(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Wy=Symbol();function kS(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Wy?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function OS(t,e){return typeof t=="function"?t(...e):!!t}var Qj=class extends rc{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!wo&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Ky=new Qj;function ay(){let t,e;const n=new Promise((i,o)=>{t=i,e=o});n.status="pending",n.catch(()=>{});function r(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},n.reject=i=>{r({status:"rejected",reason:i}),e(i)},n}var Wj=Fj;function Kj(){let t=[],e=0,n=u=>{u()},r=u=>{u()},i=Wj;const o=u=>{e?t.push(u):i(()=>{n(u)})},l=()=>{const u=t;t=[],u.length&&i(()=>{r(()=>{u.forEach(h=>{n(h)})})})};return{batch:u=>{let h;e++;try{h=u()}finally{e--,e||l()}return h},batchCalls:u=>(...h)=>{o(()=>{u(...h)})},schedule:o,setNotifyFunction:u=>{n=u},setBatchNotifyFunction:u=>{r=u},setScheduler:u=>{i=u}}}var En=Kj(),Yj=class extends rc{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!wo&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},cf=new Yj;function Xj(t){return Math.min(1e3*2**t,3e4)}function MS(t){return(t??"online")==="online"?cf.isOnline():!0}var oy=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function NS(t){let e=!1,n=0,r;const i=ay(),o=()=>i.status!=="pending",l=x=>{if(!o()){const E=new oy(x);_(E),t.onCancel?.(E)}},u=()=>{e=!0},h=()=>{e=!1},f=()=>Ky.isFocused()&&(t.networkMode==="always"||cf.isOnline())&&t.canRun(),p=()=>MS(t.networkMode)&&t.canRun(),g=x=>{o()||(r?.(),i.resolve(x))},_=x=>{o()||(r?.(),i.reject(x))},b=()=>new Promise(x=>{r=E=>{(o()||f())&&x(E)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),S=()=>{if(o())return;let x;const E=n===0?t.initialPromise:void 0;try{x=E??t.fn()}catch(C){x=Promise.reject(C)}Promise.resolve(x).then(g).catch(C=>{if(o())return;const T=t.retry??(wo?0:3),A=t.retryDelay??Xj,U=typeof A=="function"?A(n,C):A,F=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,C);if(e||!F){_(C);return}n++,t.onFail?.(n,C),qj(U).then(()=>f()?void 0:b()).then(()=>{e?_(C):S()})})};return{promise:i,status:()=>i.status,cancel:l,continue:()=>(r?.(),i),cancelRetry:u,continueRetry:h,canStart:p,start:()=>(p()?S():b().then(S),i)}}var PS=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ry(this.gcTime)&&(this.#e=yo.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(wo?1/0:300*1e3))}clearGcTimeout(){this.#e&&(yo.clearTimeout(this.#e),this.#e=void 0)}},Zj=class extends PS{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=Xx(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=Xx(this.options);n.data!==void 0&&(this.setState(Yx(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=iy(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(rr).catch(rr):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Fr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Wy||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ma(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!IS(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(f=>f.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,i=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=kS(this.options,n),p=(()=>{const g={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},u=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return i(h),h})();this.options.behavior?.onFetch(u,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==u.fetchOptions?.meta)&&this.#i({type:"fetch",meta:u.fetchOptions?.meta}),this.#r=NS({initialPromise:n?.initialPromise,fn:u.fetchFn,onCancel:h=>{h instanceof oy&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,f)=>{this.#i({type:"failed",failureCount:h,error:f})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof oy){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#i({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...zS(r.data,this.options),fetchMeta:e.meta??null};case"success":const i={...r,...Yx(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),En.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function zS(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:MS(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Yx(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Xx(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Jj=class extends rc{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=ay(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Zx(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ly(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ly(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Fr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!lf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&Jx(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Fr(this.options.enabled,this.#t)!==Fr(e.enabled,this.#t)||ma(this.options.staleTime,this.#t)!==ma(e.staleTime,this.#t))&&this.#g();const i=this.#y();r&&(this.#t!==n||Fr(this.options.enabled,this.#t)!==Fr(e.enabled,this.#t)||i!==this.#l)&&this.#_(i)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return tR(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(rr)),e}#g(){this.#v();const t=ma(this.options.staleTime,this.#t);if(wo||this.#s.isStale||!ry(t))return;const n=IS(this.#s.dataUpdatedAt,t)+1;this.#c=yo.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(wo||Fr(this.options.enabled,this.#t)===!1||!ry(this.#l)||this.#l===0)&&(this.#u=yo.setInterval(()=>{(this.options.refetchIntervalInBackground||Ky.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(yo.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(yo.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,i=this.#s,o=this.#r,l=this.#a,h=t!==n?t.state:this.#n,{state:f}=t;let p={...f},g=!1,_;if(e._optimisticResults){const D=this.hasListeners(),P=!D&&Zx(t,e),L=D&&Jx(t,n,e,r);(P||L)&&(p={...p,...zS(f.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:b,errorUpdatedAt:S,status:x}=p;_=p.data;let E=!1;if(e.placeholderData!==void 0&&_===void 0&&x==="pending"){let D;i?.isPlaceholderData&&e.placeholderData===l?.placeholderData?(D=i.data,E=!0):D=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,D!==void 0&&(x="success",_=iy(i?.data,D,e),g=!0)}if(e.select&&_!==void 0&&!E)if(i&&_===o?.data&&e.select===this.#p)_=this.#h;else try{this.#p=e.select,_=e.select(_),_=iy(i?.data,_,e),this.#h=_,this.#i=null}catch(D){this.#i=D}this.#i&&(b=this.#i,_=this.#h,S=Date.now(),x="error");const C=p.fetchStatus==="fetching",T=x==="pending",A=x==="error",U=T&&C,F=_!==void 0,O={status:x,fetchStatus:p.fetchStatus,isPending:T,isSuccess:x==="success",isError:A,isInitialLoading:U,isLoading:U,data:_,dataUpdatedAt:p.dataUpdatedAt,error:b,errorUpdatedAt:S,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:C,isRefetching:C&&!T,isLoadingError:A&&!F,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:A&&F,isStale:Yy(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Fr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const D=q=>{O.status==="error"?q.reject(O.error):O.data!==void 0&&q.resolve(O.data)},P=()=>{const q=this.#o=O.promise=ay();D(q)},L=this.#o;switch(L.status){case"pending":t.queryHash===n.queryHash&&D(L);break;case"fulfilled":(O.status==="error"||O.data!==L.value)&&P();break;case"rejected":(O.status!=="error"||O.error!==L.reason)&&P();break}}return O}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),lf(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#m.size)return!0;const o=new Set(i??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(l=>{const u=l;return this.#s[u]!==t[u]&&o.has(u)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){En.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function eR(t,e){return Fr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Zx(t,e){return eR(t,e)||t.state.data!==void 0&&ly(t,e,e.refetchOnMount)}function ly(t,e,n){if(Fr(e.enabled,t)!==!1&&ma(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&Yy(t,e)}return!1}function Jx(t,e,n,r){return(t!==e||Fr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&Yy(t,n)}function Yy(t,e){return Fr(e.enabled,t)!==!1&&t.isStaleByTime(ma(e.staleTime,t))}function tR(t,e){return!lf(t.getCurrentResult(),e)}function ew(t){return{onFetch:(e,n)=>{const r=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],l=e.state.data?.pageParams||[];let u={pages:[],pageParams:[]},h=0;const f=async()=>{let p=!1;const g=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},_=kS(e.options,e.fetchOptions),b=async(S,x,E)=>{if(p)return Promise.reject();if(x==null&&S.pages.length)return Promise.resolve(S);const T=(()=>{const H={client:e.client,queryKey:e.queryKey,pageParam:x,direction:E?"backward":"forward",meta:e.options.meta};return g(H),H})(),A=await _(T),{maxPages:U}=e.options,F=E?Hj:Gj;return{pages:F(S.pages,A,U),pageParams:F(S.pageParams,x,U)}};if(i&&o.length){const S=i==="backward",x=S?nR:tw,E={pages:o,pageParams:l},C=x(r,E);u=await b(E,C,S)}else{const S=t??o.length;do{const x=h===0?l[0]??r.initialPageParam:tw(r,u);if(h>0&&x==null)break;u=await b(u,x),h++}while(h<S)}return u};e.options.persister?e.fetchFn=()=>e.options.persister?.(f,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=f}}}function tw(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function nR(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var rR=class extends PS{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||BS(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=NS({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(l,u)=>{this.#r({type:"failed",failureCount:l,error:u})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",o=!this.#s.canStart();try{if(i)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const u=await this.options.onMutate?.(e,r);u!==this.state.context&&this.#r({type:"pending",context:u,variables:e,isPaused:o})}const l=await this.#s.start();return await this.#n.config.onSuccess?.(l,e,this.state.context,this,r),await this.options.onSuccess?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(l,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(l,null,e,this.state.context,r),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#n.config.onError?.(l,e,this.state.context,this,r),await this.options.onError?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,l,e,this.state.context,r),l}finally{this.#r({type:"error",error:l})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),En.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function BS(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var sR=class extends rc{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new rR({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Lh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Lh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Lh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Lh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){En.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Qx(e,n))}findAll(t={}){return this.getAll().filter(e=>Qx(t,e))}notify(t){En.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return En.batch(()=>Promise.all(t.map(e=>e.continue().catch(rr))))}};function Lh(t){return t.options.scope?.id}var iR=class extends rc{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),lf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&So(n.mutationKey)!==So(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??BS();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){En.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,i),this.#s.onSettled?.(e.data,null,n,r,i)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,i),this.#s.onSettled?.(void 0,e.error,n,r,i))}this.listeners.forEach(n=>{n(this.#t)})})}},aR=class extends rc{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,i=e.queryHash??Qy(r,e);let o=this.get(i);return o||(o=new Zj({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){En.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Hx(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>Hx(t,n)):e}notify(t){En.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){En.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){En.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},oR=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new aR,this.#t=t.mutationCache||new sR,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=Ky.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=cf.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(ma(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,l=Vj(e,o);if(l!==void 0)return this.#e.build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return En.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;En.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return En.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=En.batch(()=>this.#e.findAll(t).map(i=>i.cancel(n)));return Promise.all(r).then(rr).catch(rr)}invalidateQueries(t,e={}){return En.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=En.batch(()=>this.#e.findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let o=i.fetch(void 0,n);return n.throwOnError||(o=o.catch(rr)),i.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(rr)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(ma(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(rr).catch(rr)}fetchInfiniteQuery(t){return t.behavior=ew(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(rr).catch(rr)}ensureInfiniteQueryData(t){return t.behavior=ew(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return cf.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(So(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{ku(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(So(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{ku(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Qy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Wy&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},LS=k.createContext(void 0),Ht=t=>{const e=k.useContext(LS);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},lR=({client:t,children:e})=>(k.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),d.jsx(LS.Provider,{value:t,children:e})),US=k.createContext(!1),cR=()=>k.useContext(US);US.Provider;function uR(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var dR=k.createContext(uR()),hR=()=>k.useContext(dR),fR=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},mR=t=>{k.useEffect(()=>{t.clearReset()},[t])},pR=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||OS(n,[t.error,r])),gR=t=>{if(t.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...i)=>n(r(...i)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},yR=(t,e)=>t.isLoading&&t.isFetching&&!e,_R=(t,e)=>t?.suspense&&e.isPending,nw=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function bR(t,e,n){const r=cR(),i=hR(),o=Ht(),l=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=r?"isRestoring":"optimistic",gR(l),fR(l,i),mR(i);const u=!o.getQueryCache().get(l.queryHash),[h]=k.useState(()=>new e(o,l)),f=h.getOptimisticResult(l),p=!r&&t.subscribed!==!1;if(k.useSyncExternalStore(k.useCallback(g=>{const _=p?h.subscribe(En.batchCalls(g)):rr;return h.updateResult(),_},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),k.useEffect(()=>{h.setOptions(l)},[l,h]),_R(l,f))throw nw(l,h,i);if(pR({result:f,errorResetBoundary:i,throwOnError:l.throwOnError,query:o.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw f.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(l,f),l.experimental_prefetchInRender&&!wo&&yR(f,r)&&(u?nw(l,h,i):o.getQueryCache().get(l.queryHash)?.promise)?.catch(rr).finally(()=>{h.updateResult()}),l.notifyOnChangeProps?f:h.trackResult(f)}function Ro(t,e){return bR(t,Jj)}function Gn(t,e){const n=Ht(),[r]=k.useState(()=>new iR(n,t));k.useEffect(()=>{r.setOptions(t)},[r,t]);const i=k.useSyncExternalStore(k.useCallback(l=>r.subscribe(En.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=k.useCallback((l,u)=>{r.mutate(l,u).catch(rr)},[r]);if(i.error&&OS(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}const vR={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},FS=k.createContext(vR);function xR({children:t}){const[e,n]=k.useState(new Map),r=k.useCallback((h,f)=>{n(p=>new Map(p).set(h,f))},[]),i=k.useCallback(h=>{n(f=>{const p=new Map(f);return p.delete(h),p})},[]),o=e.size>0,l=e.size>0&&Array.from(e.values()).pop()||"Loading...",u={isLoading:o,loadingMessage:l,addLoadingHold:r,removeLoadingHold:i};return d.jsx(FS.Provider,{value:u,children:t})}function sr(){const t=k.useContext(FS);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const wR=()=>{};var rw={};const VS=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},SR=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],l=t[n++],u=t[n++],h=((i&7)<<18|(o&63)<<12|(l&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|l&63)}}return e.join("")},$S={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],l=i+1<t.length,u=l?t[i+1]:0,h=i+2<t.length,f=h?t[i+2]:0,p=o>>2,g=(o&3)<<4|u>>4;let _=(u&15)<<2|f>>6,b=f&63;h||(b=64,l||(_=64)),r.push(n[p],n[g],n[_],n[b])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(VS(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):SR(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],u=i<t.length?n[t.charAt(i)]:0;++i;const f=i<t.length?n[t.charAt(i)]:64;++i;const g=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||u==null||f==null||g==null)throw new ER;const _=o<<2|u>>4;if(r.push(_),f!==64){const b=u<<4&240|f>>2;if(r.push(b),g!==64){const S=f<<6&192|g;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class ER extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const CR=function(t){const e=VS(t);return $S.encodeByteArray(e,!0)},uf=function(t){return CR(t).replace(/\./g,"")},qS=function(t){try{return $S.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function TR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const AR=()=>TR().__FIREBASE_DEFAULTS__,jR=()=>{if(typeof process>"u"||typeof rw>"u")return;const t=rw.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},RR=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&qS(t[1]);return e&&JSON.parse(e)},$f=()=>{try{return wR()||AR()||jR()||RR()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},GS=t=>$f()?.emulatorHosts?.[t],IR=t=>{const e=GS(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},HS=()=>$f()?.config,QS=t=>$f()?.[`_${t}`];class DR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function sc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function WS(t){return(await fetch(t,{credentials:"include"})).ok}function kR(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[uf(JSON.stringify(n)),uf(JSON.stringify(l)),""].join(".")}const Cu={};function OR(){const t={prod:[],emulator:[]};for(const e of Object.keys(Cu))Cu[e]?t.emulator.push(e):t.prod.push(e);return t}function MR(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let sw=!1;function KS(t,e){if(typeof window>"u"||typeof document>"u"||!sc(window.location.host)||Cu[t]===e||Cu[t]||sw)return;Cu[t]=e;function n(_){return`__firebase__banner__${_}`}const r="__firebase__banner",o=OR().prod.length>0;function l(){const _=document.getElementById(r);_&&_.remove()}function u(_){_.style.display="flex",_.style.background="#7faaf0",_.style.position="fixed",_.style.bottom="5px",_.style.left="5px",_.style.padding=".5em",_.style.borderRadius="5px",_.style.alignItems="center"}function h(_,b){_.setAttribute("width","24"),_.setAttribute("id",b),_.setAttribute("height","24"),_.setAttribute("viewBox","0 0 24 24"),_.setAttribute("fill","none"),_.style.marginLeft="-6px"}function f(){const _=document.createElement("span");return _.style.cursor="pointer",_.style.marginLeft="16px",_.style.fontSize="24px",_.innerHTML=" &times;",_.onclick=()=>{sw=!0,l()},_}function p(_,b){_.setAttribute("id",b),_.innerText="Learn more",_.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",_.setAttribute("target","__blank"),_.style.paddingLeft="5px",_.style.textDecoration="underline"}function g(){const _=MR(r),b=n("text"),S=document.getElementById(b)||document.createElement("span"),x=n("learnmore"),E=document.getElementById(x)||document.createElement("a"),C=n("preprendIcon"),T=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(_.created){const A=_.element;u(A),p(E,x);const U=f();h(T,C),A.append(T,S,E,U),document.body.appendChild(A)}o?(S.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function Zn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function NR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Zn())}function PR(){const t=$f()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function zR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function BR(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function LR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function UR(){const t=Zn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function FR(){return!PR()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function VR(){try{return typeof indexedDB=="object"}catch{return!1}}function $R(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(n){e(n)}})}const qR="FirebaseError";class Si extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=qR,Object.setPrototypeOf(this,Si.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xu.prototype.create)}}class Xu{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],l=o?GR(o,r):"Error",u=`${this.serviceName}: ${l} (${i}).`;return new Si(i,u,r)}}function GR(t,e){return t.replace(HR,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const HR=/\{\$([^}]+)}/g;function QR(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function gi(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],l=e[i];if(iw(o)&&iw(l)){if(!gi(o,l))return!1}else if(o!==l)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function iw(t){return t!==null&&typeof t=="object"}function Zu(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function bu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function vu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function WR(t,e){const n=new KR(t,e);return n.subscribe.bind(n)}class KR{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");YR(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=Mg),i.error===void 0&&(i.error=Mg),i.complete===void 0&&(i.complete=Mg);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function YR(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Mg(){}function bn(t){return t&&t._delegate?t._delegate:t}class Eo{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const po="[DEFAULT]";class XR{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new DR;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(JR(e))try{this.getOrInitializeService({instanceIdentifier:po})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=po){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=po){return this.instances.has(e)}getOptions(e=po){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&l.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:ZR(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=po){return this.component?this.component.multipleInstances?e:po:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ZR(t){return t===po?void 0:t}function JR(t){return t.instantiationMode==="EAGER"}class eI{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new XR(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var mt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(mt||(mt={}));const tI={debug:mt.DEBUG,verbose:mt.VERBOSE,info:mt.INFO,warn:mt.WARN,error:mt.ERROR,silent:mt.SILENT},nI=mt.INFO,rI={[mt.DEBUG]:"log",[mt.VERBOSE]:"log",[mt.INFO]:"info",[mt.WARN]:"warn",[mt.ERROR]:"error"},sI=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=rI[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Xy{constructor(e){this.name=e,this._logLevel=nI,this._logHandler=sI,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in mt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?tI[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,mt.DEBUG,...e),this._logHandler(this,mt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,mt.VERBOSE,...e),this._logHandler(this,mt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,mt.INFO,...e),this._logHandler(this,mt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,mt.WARN,...e),this._logHandler(this,mt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,mt.ERROR,...e),this._logHandler(this,mt.ERROR,...e)}}const iI=(t,e)=>e.some(n=>t instanceof n);let aw,ow;function aI(){return aw||(aw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function oI(){return ow||(ow=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const YS=new WeakMap,cy=new WeakMap,XS=new WeakMap,Ng=new WeakMap,Zy=new WeakMap;function lI(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(pa(t.result)),i()},l=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&YS.set(n,t)}).catch(()=>{}),Zy.set(e,t),e}function cI(t){if(cy.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),i()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});cy.set(t,e)}let uy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return cy.get(t);if(e==="objectStoreNames")return t.objectStoreNames||XS.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return pa(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function uI(t){uy=t(uy)}function dI(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Pg(this),e,...n);return XS.set(r,e.sort?e.sort():[e]),pa(r)}:oI().includes(t)?function(...e){return t.apply(Pg(this),e),pa(YS.get(this))}:function(...e){return pa(t.apply(Pg(this),e))}}function hI(t){return typeof t=="function"?dI(t):(t instanceof IDBTransaction&&cI(t),iI(t,aI())?new Proxy(t,uy):t)}function pa(t){if(t instanceof IDBRequest)return lI(t);if(Ng.has(t))return Ng.get(t);const e=hI(t);return e!==t&&(Ng.set(t,e),Zy.set(e,t)),e}const Pg=t=>Zy.get(t);function fI(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(t,e),u=pa(l);return r&&l.addEventListener("upgradeneeded",h=>{r(pa(l.result),h.oldVersion,h.newVersion,pa(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const mI=["get","getKey","getAll","getAllKeys","count"],pI=["put","add","delete","clear"],zg=new Map;function lw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(zg.get(e))return zg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=pI.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||mI.includes(n)))return;const o=async function(l,...u){const h=this.transaction(l,i?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(u.shift())),(await Promise.all([f[n](...u),i&&h.done]))[0]};return zg.set(e,o),o}uI(t=>({...t,get:(e,n,r)=>lw(e,n)||t.get(e,n,r),has:(e,n)=>!!lw(e,n)||t.has(e,n)}));class gI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(yI(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function yI(t){return t.getComponent()?.type==="VERSION"}const dy="@firebase/app",cw="0.14.6";const yi=new Xy("@firebase/app"),_I="@firebase/app-compat",bI="@firebase/analytics-compat",vI="@firebase/analytics",xI="@firebase/app-check-compat",wI="@firebase/app-check",SI="@firebase/auth",EI="@firebase/auth-compat",CI="@firebase/database",TI="@firebase/data-connect",AI="@firebase/database-compat",jI="@firebase/functions",RI="@firebase/functions-compat",II="@firebase/installations",DI="@firebase/installations-compat",kI="@firebase/messaging",OI="@firebase/messaging-compat",MI="@firebase/performance",NI="@firebase/performance-compat",PI="@firebase/remote-config",zI="@firebase/remote-config-compat",BI="@firebase/storage",LI="@firebase/storage-compat",UI="@firebase/firestore",FI="@firebase/ai",VI="@firebase/firestore-compat",$I="firebase",qI="12.6.0";const hy="[DEFAULT]",GI={[dy]:"fire-core",[_I]:"fire-core-compat",[vI]:"fire-analytics",[bI]:"fire-analytics-compat",[wI]:"fire-app-check",[xI]:"fire-app-check-compat",[SI]:"fire-auth",[EI]:"fire-auth-compat",[CI]:"fire-rtdb",[TI]:"fire-data-connect",[AI]:"fire-rtdb-compat",[jI]:"fire-fn",[RI]:"fire-fn-compat",[II]:"fire-iid",[DI]:"fire-iid-compat",[kI]:"fire-fcm",[OI]:"fire-fcm-compat",[MI]:"fire-perf",[NI]:"fire-perf-compat",[PI]:"fire-rc",[zI]:"fire-rc-compat",[BI]:"fire-gcs",[LI]:"fire-gcs-compat",[UI]:"fire-fst",[VI]:"fire-fst-compat",[FI]:"fire-vertex","fire-js":"fire-js",[$I]:"fire-js-all"};const df=new Map,HI=new Map,fy=new Map;function uw(t,e){try{t.container.addComponent(e)}catch(n){yi.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Fl(t){const e=t.name;if(fy.has(e))return yi.debug(`There were multiple attempts to register component ${e}.`),!1;fy.set(e,t);for(const n of df.values())uw(n,t);for(const n of HI.values())uw(n,t);return!0}function Jy(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function rs(t){return t==null?!1:t.settings!==void 0}const QI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ga=new Xu("app","Firebase",QI);class WI{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Eo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ga.create("app-deleted",{appName:this._name})}}const ic=qI;function ZS(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:hy,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw ga.create("bad-app-name",{appName:String(i)});if(n||(n=HS()),!n)throw ga.create("no-options");const o=df.get(i);if(o){if(gi(n,o.options)&&gi(r,o.config))return o;throw ga.create("duplicate-app",{appName:i})}const l=new eI(i);for(const h of fy.values())l.addComponent(h);const u=new WI(n,r,l);return df.set(i,u),u}function JS(t=hy){const e=df.get(t);if(!e&&t===hy&&HS())return ZS();if(!e)throw ga.create("no-app",{appName:t});return e}function ya(t,e,n){let r=GI[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${e}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),yi.warn(l.join(" "));return}Fl(new Eo(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const KI="firebase-heartbeat-database",YI=1,Ou="firebase-heartbeat-store";let Bg=null;function eE(){return Bg||(Bg=fI(KI,YI,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Ou)}catch(n){console.warn(n)}}}}).catch(t=>{throw ga.create("idb-open",{originalErrorMessage:t.message})})),Bg}async function XI(t){try{const n=(await eE()).transaction(Ou),r=await n.objectStore(Ou).get(tE(t));return await n.done,r}catch(e){if(e instanceof Si)yi.warn(e.message);else{const n=ga.create("idb-get",{originalErrorMessage:e?.message});yi.warn(n.message)}}}async function dw(t,e){try{const r=(await eE()).transaction(Ou,"readwrite");await r.objectStore(Ou).put(e,tE(t)),await r.done}catch(n){if(n instanceof Si)yi.warn(n.message);else{const r=ga.create("idb-set",{originalErrorMessage:n?.message});yi.warn(r.message)}}}function tE(t){return`${t.name}!${t.options.appId}`}const ZI=1024,JI=30;class eD{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new nD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=hw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>JI){const i=rD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){yi.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=hw(),{heartbeatsToSend:n,unsentEntries:r}=tD(this._heartbeatsCache.heartbeats),i=uf(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return yi.warn(e),""}}}function hw(){return new Date().toISOString().substring(0,10)}function tD(t,e=ZI){const n=[];let r=t.slice();for(const i of t){const o=n.find(l=>l.agent===i.agent);if(o){if(o.dates.push(i.date),fw(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),fw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class nD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return VR()?$R().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await XI(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return dw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return dw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function fw(t){return uf(JSON.stringify({version:2,heartbeats:t})).length}function rD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function sD(t){Fl(new Eo("platform-logger",e=>new gI(e),"PRIVATE")),Fl(new Eo("heartbeat",e=>new eD(e),"PRIVATE")),ya(dy,cw,t),ya(dy,cw,"esm2020"),ya("fire-js","")}sD("");function nE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const iD=nE,rE=new Xu("auth","Firebase",nE());const hf=new Xy("@firebase/auth");function aD(t,...e){hf.logLevel<=mt.WARN&&hf.warn(`Auth (${ic}): ${t}`,...e)}function Yh(t,...e){hf.logLevel<=mt.ERROR&&hf.error(`Auth (${ic}): ${t}`,...e)}function os(t,...e){throw e0(t,...e)}function Ps(t,...e){return e0(t,...e)}function sE(t,e,n){const r={...iD(),[e]:n};return new Xu("auth","Firebase",r).create(e,{appName:t.name})}function _a(t){return sE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function e0(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return rE.create(t,...e)}function Ye(t,e,...n){if(!t)throw e0(e,...n)}function di(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Yh(e),new Error(e)}function _i(t,e){t||di(e)}function my(){return typeof self<"u"&&self.location?.href||""}function oD(){return mw()==="http:"||mw()==="https:"}function mw(){return typeof self<"u"&&self.location?.protocol||null}function lD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(oD()||BR()||"connection"in navigator)?navigator.onLine:!0}function cD(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class Ju{constructor(e,n){this.shortDelay=e,this.longDelay=n,_i(n>e,"Short delay should be less than long delay!"),this.isMobile=NR()||LR()}get(){return lD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function t0(t,e){_i(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class iE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;di("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;di("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;di("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const uD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const dD=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],hD=new Ju(3e4,6e4);function Io(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ia(t,e,n,r,i={}){return aE(t,i,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const u=Zu({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const f={method:e,headers:h,...o};return zR()||(f.referrerPolicy="no-referrer"),t.emulatorConfig&&sc(t.emulatorConfig.host)&&(f.credentials="include"),iE.fetch()(await oE(t,t.config.apiHost,n,u),f)})}async function aE(t,e,n){t._canInitEmulator=!1;const r={...uD,...e};try{const i=new mD(t),o=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Uh(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const u=o.ok?l.errorMessage:l.error.message,[h,f]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Uh(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Uh(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw Uh(t,"user-disabled",l);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw sE(t,p,f);os(t,p)}}catch(i){if(i instanceof Si)throw i;os(t,"network-request-failed",{message:String(i)})}}async function qf(t,e,n,r,i={}){const o=await Ia(t,e,n,r,i);return"mfaPendingCredential"in o&&os(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function oE(t,e,n,r){const i=`${e}${n}?${r}`,o=t,l=o.config.emulator?t0(t.config,i):`${t.config.apiScheme}://${i}`;return dD.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function fD(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class mD{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Ps(this.auth,"network-request-failed")),hD.get())})}}function Uh(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Ps(t,e,r);return i.customData._tokenResponse=n,i}function pw(t){return t!==void 0&&t.enterprise!==void 0}class pD{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return fD(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function gD(t,e){return Ia(t,"GET","/v2/recaptchaConfig",Io(t,e))}async function yD(t,e){return Ia(t,"POST","/v1/accounts:delete",e)}async function ff(t,e){return Ia(t,"POST","/v1/accounts:lookup",e)}function Tu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function _D(t,e=!1){const n=bn(t),r=await n.getIdToken(e),i=n0(r);Ye(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,l=o?.sign_in_provider;return{claims:i,token:r,authTime:Tu(Lg(i.auth_time)),issuedAtTime:Tu(Lg(i.iat)),expirationTime:Tu(Lg(i.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Lg(t){return Number(t)*1e3}function n0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Yh("JWT malformed, contained fewer than 3 sections"),null;try{const i=qS(n);return i?JSON.parse(i):(Yh("Failed to decode base64 JWT payload"),null)}catch(i){return Yh("Caught error parsing JWT payload as JSON",i?.toString()),null}}function gw(t){const e=n0(t);return Ye(e,"internal-error"),Ye(typeof e.exp<"u","internal-error"),Ye(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Mu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Si&&bD(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function bD({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class vD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class py{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Tu(this.lastLoginAt),this.creationTime=Tu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function mf(t){const e=t.auth,n=await t.getIdToken(),r=await Mu(t,ff(e,{idToken:n}));Ye(r?.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=i.providerUserInfo?.length?lE(i.providerUserInfo):[],l=wD(t.providerData,o),u=t.isAnonymous,h=!(t.email&&i.passwordHash)&&!l?.length,f=u?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new py(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(t,p)}async function xD(t){const e=bn(t);await mf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function wD(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function lE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function SD(t,e){const n=await aE(t,{},async()=>{const r=Zu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=t.config,l=await oE(t,i,"/v1/token",`key=${o}`),u=await t._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:u,body:r};return t.emulatorConfig&&sc(t.emulatorConfig.host)&&(h.credentials="include"),iE.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function ED(t,e){return Ia(t,"POST","/v2/accounts:revokeToken",Io(t,e))}class Nl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ye(e.idToken,"internal-error"),Ye(typeof e.idToken<"u","internal-error"),Ye(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):gw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ye(e.length!==0,"internal-error");const n=gw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ye(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:o}=await SD(e,n);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:o}=n,l=new Nl;return r&&(Ye(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),i&&(Ye(typeof i=="string","internal-error",{appName:e}),l.accessToken=i),o&&(Ye(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Nl,this.toJSON())}_performRefresh(){return di("not implemented")}}function ra(t,e){Ye(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class ss{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new vD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new py(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Mu(this,this.stsTokenManager.getToken(this.auth,e));return Ye(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return _D(this,e)}reload(){return xD(this)}_assign(e){this!==e&&(Ye(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new ss({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ye(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await mf(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(rs(this.auth.app))return Promise.reject(_a(this.auth));const e=await this.getIdToken();return await Mu(this,yD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,u=n.tenantId??void 0,h=n._redirectEventId??void 0,f=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:_,isAnonymous:b,providerData:S,stsTokenManager:x}=n;Ye(g&&x,e,"internal-error");const E=Nl.fromJSON(this.name,x);Ye(typeof g=="string",e,"internal-error"),ra(r,e.name),ra(i,e.name),Ye(typeof _=="boolean",e,"internal-error"),Ye(typeof b=="boolean",e,"internal-error"),ra(o,e.name),ra(l,e.name),ra(u,e.name),ra(h,e.name),ra(f,e.name),ra(p,e.name);const C=new ss({uid:g,auth:e,email:i,emailVerified:_,displayName:r,isAnonymous:b,photoURL:l,phoneNumber:o,tenantId:u,stsTokenManager:E,createdAt:f,lastLoginAt:p});return S&&Array.isArray(S)&&(C.providerData=S.map(T=>({...T}))),h&&(C._redirectEventId=h),C}static async _fromIdTokenResponse(e,n,r=!1){const i=new Nl;i.updateFromServerResponse(n);const o=new ss({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await mf(o),o}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];Ye(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?lE(i.providerUserInfo):[],l=!(i.email&&i.passwordHash)&&!o?.length,u=new Nl;u.updateFromIdToken(r);const h=new ss({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:l}),f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new py(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,f),h}}const yw=new Map;function hi(t){_i(t instanceof Function,"Expected a class definition");let e=yw.get(t);return e?(_i(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,yw.set(t,e),e)}class cE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}cE.type="NONE";const _w=cE;function Xh(t,e,n){return`firebase:${t}:${e}:${n}`}class Pl{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=Xh(this.userKey,i.apiKey,o),this.fullPersistenceKey=Xh("persistence",i.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await ff(this.auth,{idToken:e}).catch(()=>{});return n?ss._fromGetAccountInfoResponse(this.auth,n,e):null}return ss._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Pl(hi(_w),e,r);const i=(await Promise.all(n.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let o=i[0]||hi(_w);const l=Xh(r,e.config.apiKey,e.name);let u=null;for(const f of n)try{const p=await f._get(l);if(p){let g;if(typeof p=="string"){const _=await ff(e,{idToken:p}).catch(()=>{});if(!_)break;g=await ss._fromGetAccountInfoResponse(e,_,p)}else g=ss._fromJSON(e,p);f!==o&&(u=g),o=f;break}}catch{}const h=i.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Pl(o,e,r):(o=h[0],u&&await o._set(l,u.toJSON()),await Promise.all(n.map(async f=>{if(f!==o)try{await f._remove(l)}catch{}})),new Pl(o,e,r))}}function bw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(fE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(uE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(pE(e))return"Blackberry";if(gE(e))return"Webos";if(dE(e))return"Safari";if((e.includes("chrome/")||hE(e))&&!e.includes("edge/"))return"Chrome";if(mE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function uE(t=Zn()){return/firefox\//i.test(t)}function dE(t=Zn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function hE(t=Zn()){return/crios\//i.test(t)}function fE(t=Zn()){return/iemobile/i.test(t)}function mE(t=Zn()){return/android/i.test(t)}function pE(t=Zn()){return/blackberry/i.test(t)}function gE(t=Zn()){return/webos/i.test(t)}function r0(t=Zn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function CD(t=Zn()){return r0(t)&&!!window.navigator?.standalone}function TD(){return UR()&&document.documentMode===10}function yE(t=Zn()){return r0(t)||mE(t)||gE(t)||pE(t)||/windows phone/i.test(t)||fE(t)}function _E(t,e=[]){let n;switch(t){case"Browser":n=bw(Zn());break;case"Worker":n=`${bw(Zn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${ic}/${r}`}class AD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,u)=>{try{const h=e(o);l(h)}catch(h){u(h)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function jD(t,e={}){return Ia(t,"GET","/v2/passwordPolicy",Io(t,e))}const RD=6;class ID{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??RD,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class DD{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new vw(this),this.idTokenSubscription=new vw(this),this.beforeStateQueue=new AD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=rE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=hi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Pl.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await ff(this,{idToken:e}),r=await ss._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(rs(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===l)&&u?.user&&(r=u.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ye(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await mf(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=cD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(rs(this.app))return Promise.reject(_a(this));const n=e?bn(e):null;return n&&Ye(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ye(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return rs(this.app)?Promise.reject(_a(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return rs(this.app)?Promise.reject(_a(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(hi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await jD(this),n=new ID(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Xu("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await ED(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&hi(e)||this._popupRedirectResolver;Ye(n,this,"argument-error"),this.redirectPersistenceManager=await Pl.create(this,[hi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ye(u,this,"internal-error"),u.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,i);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ye(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=_E(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(rs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&aD(`Error while retrieving App Check token: ${e.error}`),e?.token}}function ac(t){return bn(t)}class vw{constructor(e){this.auth=e,this.observer=null,this.addObserver=WR(n=>this.observer=n)}get next(){return Ye(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Gf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function kD(t){Gf=t}function bE(t){return Gf.loadJS(t)}function OD(){return Gf.recaptchaEnterpriseScript}function MD(){return Gf.gapiScript}function ND(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class PD{constructor(){this.enterprise=new zD}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class zD{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const BD="recaptcha-enterprise",vE="NO_RECAPTCHA";class LD{constructor(e){this.type=BD,this.auth=ac(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,u)=>{gD(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const f=new pD(h);return o.tenantId==null?o._agentRecaptchaConfig=f:o._tenantRecaptchaConfigs[o.tenantId]=f,l(f.siteKey)}}).catch(h=>{u(h)})})}function i(o,l,u){const h=window.grecaptcha;pw(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(f=>{l(f)}).catch(()=>{l(vE)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new PD().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(u=>{if(!n&&pw(window.grecaptcha))i(u,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=OD();h.length!==0&&(h+=u),bE(h).then(()=>{i(u,o,l)}).catch(f=>{l(f)})}}).catch(u=>{l(u)})})}}async function xw(t,e,n,r=!1,i=!1){const o=new LD(t);let l;if(i)l=vE;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const u={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const h=u.phoneEnrollmentInfo.phoneNumber,f=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:f,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const h=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return r?Object.assign(u,{captchaResp:l}):Object.assign(u,{captchaResponse:l}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function ww(t,e,n,r,i){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await xw(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await xw(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function UD(t,e){const n=Jy(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),o=n.getOptions();if(gi(o,e??{}))return i;os(i,"already-initialized")}return n.initialize({options:e})}function FD(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(hi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function VD(t,e,n){const r=ac(t);Ye(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=xE(e),{host:l,port:u}=$D(e),h=u===null?"":`:${u}`,f={url:`${o}//${l}${h}/`},p=Object.freeze({host:l,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Ye(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ye(gi(f,r.config.emulator)&&gi(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=f,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,sc(l)?(WS(`${o}//${l}${h}`),KS("Auth",!0)):qD()}function xE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function $D(t){const e=xE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:Sw(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:Sw(l)}}}function Sw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function qD(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class s0{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return di("not implemented")}_getIdTokenResponse(e){return di("not implemented")}_linkToIdToken(e,n){return di("not implemented")}_getReauthenticationResolver(e){return di("not implemented")}}async function GD(t,e){return Ia(t,"POST","/v1/accounts:signUp",e)}async function HD(t,e){return qf(t,"POST","/v1/accounts:signInWithPassword",Io(t,e))}async function QD(t,e){return qf(t,"POST","/v1/accounts:signInWithEmailLink",Io(t,e))}async function WD(t,e){return qf(t,"POST","/v1/accounts:signInWithEmailLink",Io(t,e))}class Nu extends s0{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Nu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Nu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ww(e,n,"signInWithPassword",HD);case"emailLink":return QD(e,{email:this._email,oobCode:this._password});default:os(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ww(e,r,"signUpPassword",GD);case"emailLink":return WD(e,{idToken:n,email:this._email,oobCode:this._password});default:os(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function zl(t,e){return qf(t,"POST","/v1/accounts:signInWithIdp",Io(t,e))}const KD="http://localhost";class Co extends s0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Co(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):os("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...o}=n;if(!r||!i)return null;const l=new Co(r,i);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return zl(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,zl(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,zl(e,n)}buildRequest(){const e={requestUri:KD,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Zu(n)}return e}}function YD(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function XD(t){const e=bu(vu(t)).link,n=e?bu(vu(e)).deep_link_id:null,r=bu(vu(t)).deep_link_id;return(r?bu(vu(r)).link:null)||r||n||e||t}class i0{constructor(e){const n=bu(vu(e)),r=n.apiKey??null,i=n.oobCode??null,o=YD(n.mode??null);Ye(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=XD(e);try{return new i0(n)}catch{return null}}}class oc{constructor(){this.providerId=oc.PROVIDER_ID}static credential(e,n){return Nu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=i0.parseLink(n);return Ye(r,"argument-error"),Nu._fromEmailAndCode(e,r.code,r.tenantId)}}oc.PROVIDER_ID="password";oc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";oc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class wE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ed extends wE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class aa extends ed{constructor(){super("facebook.com")}static credential(e){return Co._fromParams({providerId:aa.PROVIDER_ID,signInMethod:aa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return aa.credentialFromTaggedObject(e)}static credentialFromError(e){return aa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return aa.credential(e.oauthAccessToken)}catch{return null}}}aa.FACEBOOK_SIGN_IN_METHOD="facebook.com";aa.PROVIDER_ID="facebook.com";class oa extends ed{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Co._fromParams({providerId:oa.PROVIDER_ID,signInMethod:oa.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return oa.credentialFromTaggedObject(e)}static credentialFromError(e){return oa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return oa.credential(n,r)}catch{return null}}}oa.GOOGLE_SIGN_IN_METHOD="google.com";oa.PROVIDER_ID="google.com";class la extends ed{constructor(){super("github.com")}static credential(e){return Co._fromParams({providerId:la.PROVIDER_ID,signInMethod:la.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return la.credentialFromTaggedObject(e)}static credentialFromError(e){return la.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return la.credential(e.oauthAccessToken)}catch{return null}}}la.GITHUB_SIGN_IN_METHOD="github.com";la.PROVIDER_ID="github.com";class ca extends ed{constructor(){super("twitter.com")}static credential(e,n){return Co._fromParams({providerId:ca.PROVIDER_ID,signInMethod:ca.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ca.credentialFromTaggedObject(e)}static credentialFromError(e){return ca.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return ca.credential(n,r)}catch{return null}}}ca.TWITTER_SIGN_IN_METHOD="twitter.com";ca.PROVIDER_ID="twitter.com";class Vl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const o=await ss._fromIdTokenResponse(e,r,i),l=Ew(r);return new Vl({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=Ew(r);return new Vl({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function Ew(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class pf extends Si{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,pf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new pf(e,n,r,i)}}function SE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?pf._fromErrorAndOperation(t,o,e,r):o})}async function ZD(t,e,n=!1){const r=await Mu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Vl._forOperation(t,"link",r)}async function JD(t,e,n=!1){const{auth:r}=t;if(rs(r.app))return Promise.reject(_a(r));const i="reauthenticate";try{const o=await Mu(t,SE(r,i,e,t),n);Ye(o.idToken,r,"internal-error");const l=n0(o.idToken);Ye(l,r,"internal-error");const{sub:u}=l;return Ye(t.uid===u,r,"user-mismatch"),Vl._forOperation(t,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&os(r,"user-mismatch"),o}}async function EE(t,e,n=!1){if(rs(t.app))return Promise.reject(_a(t));const r="signIn",i=await SE(t,r,e),o=await Vl._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(o.user),o}async function ek(t,e){return EE(ac(t),e)}async function tk(t){const e=ac(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function nk(t,e,n){return rs(t.app)?Promise.reject(_a(t)):ek(bn(t),oc.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&tk(t),r})}function rk(t,e,n,r){return bn(t).onIdTokenChanged(e,n,r)}function sk(t,e,n){return bn(t).beforeAuthStateChanged(e,n)}function ik(t,e,n,r){return bn(t).onAuthStateChanged(e,n,r)}function ak(t){return bn(t).signOut()}const gf="__sak";class CE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(gf,"1"),this.storage.removeItem(gf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const ok=1e3,lk=10;class TE extends CE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=yE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,u,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);TD()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,lk):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},ok)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}TE.type="LOCAL";const ck=TE;class AE extends CE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}AE.type="SESSION";const jE=AE;function uk(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class Hf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new Hf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:o}=n.data,l=this.handlersMap[i];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const u=Array.from(l).map(async f=>f(n.origin,o)),h=await uk(u);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Hf.receivers=[];function a0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class dk{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,l;return new Promise((u,h)=>{const f=a0("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:i,onMessage(g){const _=g;if(_.data.eventId===f)switch(_.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(_.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),i.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:f,data:n},[i.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function zs(){return window}function hk(t){zs().location.href=t}function RE(){return typeof zs().WorkerGlobalScope<"u"&&typeof zs().importScripts=="function"}async function fk(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function mk(){return navigator?.serviceWorker?.controller||null}function pk(){return RE()?self:null}const IE="firebaseLocalStorageDb",gk=1,yf="firebaseLocalStorage",DE="fbase_key";class td{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Qf(t,e){return t.transaction([yf],e?"readwrite":"readonly").objectStore(yf)}function yk(){const t=indexedDB.deleteDatabase(IE);return new td(t).toPromise()}function gy(){const t=indexedDB.open(IE,gk);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(yf,{keyPath:DE})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(yf)?e(r):(r.close(),await yk(),e(await gy()))})})}async function Cw(t,e,n){const r=Qf(t,!0).put({[DE]:e,value:n});return new td(r).toPromise()}async function _k(t,e){const n=Qf(t,!1).get(e),r=await new td(n).toPromise();return r===void 0?null:r.value}function Tw(t,e){const n=Qf(t,!0).delete(e);return new td(n).toPromise()}const bk=800,vk=3;class kE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await gy(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>vk)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return RE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Hf._getInstance(pk()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await fk(),!this.activeServiceWorker)return;this.sender=new dk(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||mk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await gy();return await Cw(e,gf,"1"),await Tw(e,gf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Cw(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>_k(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Tw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=Qf(i,!1).getAll();return new td(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),bk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}kE.type="LOCAL";const xk=kE;new Ju(3e4,6e4);function wk(t,e){return e?hi(e):(Ye(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class o0 extends s0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return zl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return zl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return zl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function Sk(t){return EE(t.auth,new o0(t),t.bypassAuthState)}function Ek(t){const{auth:e,user:n}=t;return Ye(n,e,"internal-error"),JD(n,new o0(t),t.bypassAuthState)}async function Ck(t){const{auth:e,user:n}=t;return Ye(n,e,"internal-error"),ZD(n,new o0(t),t.bypassAuthState)}class OE{constructor(e,n,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:o,error:l,type:u}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Sk;case"linkViaPopup":case"linkViaRedirect":return Ck;case"reauthViaPopup":case"reauthViaRedirect":return Ek;default:os(this.auth,"internal-error")}}resolve(e){_i(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){_i(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Tk=new Ju(2e3,1e4);class Ml extends OE{constructor(e,n,r,i,o){super(e,n,i,o),this.provider=r,this.authWindow=null,this.pollId=null,Ml.currentPopupAction&&Ml.currentPopupAction.cancel(),Ml.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ye(e,this.auth,"internal-error"),e}async onExecution(){_i(this.filter.length===1,"Popup operations only handle one event");const e=a0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Ps(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ps(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ml.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ps(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Tk.get())};e()}}Ml.currentPopupAction=null;const Ak="pendingRedirect",Zh=new Map;class jk extends OE{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Zh.get(this.auth._key());if(!e){try{const r=await Rk(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Zh.set(this.auth._key(),e)}return this.bypassAuthState||Zh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Rk(t,e){const n=kk(e),r=Dk(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function Ik(t,e){Zh.set(t._key(),e)}function Dk(t){return hi(t._redirectPersistence)}function kk(t){return Xh(Ak,t.config.apiKey,t.name)}async function Ok(t,e,n=!1){if(rs(t.app))return Promise.reject(_a(t));const r=ac(t),i=wk(r,e),l=await new jk(r,i,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const Mk=600*1e3;class Nk{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Pk(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!ME(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Ps(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Mk&&this.cachedEventUids.clear(),this.cachedEventUids.has(Aw(e))}saveEventToCache(e){this.cachedEventUids.add(Aw(e)),this.lastProcessedEventTime=Date.now()}}function Aw(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function ME({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function Pk(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ME(t);default:return!1}}async function zk(t,e={}){return Ia(t,"GET","/v1/projects",e)}const Bk=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Lk=/^https?/;async function Uk(t){if(t.config.emulator)return;const{authorizedDomains:e}=await zk(t);for(const n of e)try{if(Fk(n))return}catch{}os(t,"unauthorized-domain")}function Fk(t){const e=my(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!Lk.test(n))return!1;if(Bk.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Vk=new Ju(3e4,6e4);function jw(){const t=zs().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function $k(t){return new Promise((e,n)=>{function r(){jw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{jw(),n(Ps(t,"network-request-failed"))},timeout:Vk.get()})}if(zs().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(zs().gapi?.load)r();else{const i=ND("iframefcb");return zs()[i]=()=>{gapi.load?r():n(Ps(t,"network-request-failed"))},bE(`${MD()}?onload=${i}`).catch(o=>n(o))}}).catch(e=>{throw Jh=null,e})}let Jh=null;function qk(t){return Jh=Jh||$k(t),Jh}const Gk=new Ju(5e3,15e3),Hk="__/auth/iframe",Qk="emulator/auth/iframe",Wk={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Kk=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Yk(t){const e=t.config;Ye(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?t0(e,Qk):`https://${t.config.authDomain}/${Hk}`,r={apiKey:e.apiKey,appName:t.name,v:ic},i=Kk.get(t.config.apiHost);i&&(r.eid=i);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${Zu(r).slice(1)}`}async function Xk(t){const e=await qk(t),n=zs().gapi;return Ye(n,t,"internal-error"),e.open({where:document.body,url:Yk(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Wk,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const l=Ps(t,"network-request-failed"),u=zs().setTimeout(()=>{o(l)},Gk.get());function h(){zs().clearTimeout(u),i(r)}r.ping(h).then(h,()=>{o(l)})}))}const Zk={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Jk=500,eO=600,tO="_blank",nO="http://localhost";class Rw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function rO(t,e,n,r=Jk,i=eO){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let u="";const h={...Zk,width:r.toString(),height:i.toString(),top:o,left:l},f=Zn().toLowerCase();n&&(u=hE(f)?tO:n),uE(f)&&(e=e||nO,h.scrollbars="yes");const p=Object.entries(h).reduce((_,[b,S])=>`${_}${b}=${S},`,"");if(CD(f)&&u!=="_self")return sO(e||"",u),new Rw(null);const g=window.open(e||"",u,p);Ye(g,t,"popup-blocked");try{g.focus()}catch{}return new Rw(g)}function sO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const iO="__/auth/handler",aO="emulator/auth/handler",oO=encodeURIComponent("fac");async function Iw(t,e,n,r,i,o){Ye(t.config.authDomain,t,"auth-domain-config-required"),Ye(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:ic,eventId:i};if(e instanceof wE){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",QR(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))l[p]=g}if(e instanceof ed){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(l.scopes=p.join(","))}t.tenantId&&(l.tid=t.tenantId);const u=l;for(const p of Object.keys(u))u[p]===void 0&&delete u[p];const h=await t._getAppCheckToken(),f=h?`#${oO}=${encodeURIComponent(h)}`:"";return`${lO(t)}?${Zu(u).slice(1)}${f}`}function lO({config:t}){return t.emulator?t0(t,aO):`https://${t.authDomain}/${iO}`}const Ug="webStorageSupport";class cO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=jE,this._completeRedirectFn=Ok,this._overrideRedirectResult=Ik}async _openPopup(e,n,r,i){_i(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Iw(e,n,r,my(),i);return rO(e,o,a0())}async _openRedirect(e,n,r,i){await this._originValidation(e);const o=await Iw(e,n,r,my(),i);return hk(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:o}=this.eventManagers[n];return i?Promise.resolve(i):(_i(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await Xk(e),r=new Nk(e);return n.register("authEvent",i=>(Ye(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Ug,{type:Ug},i=>{const o=i?.[0]?.[Ug];o!==void 0&&n(!!o),os(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=Uk(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return yE()||dE()||r0()}}const uO=cO;var Dw="@firebase/auth",kw="1.12.0";class dO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ye(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function hO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function fO(t){Fl(new Eo("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:u}=r.options;Ye(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:u,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_E(t)},f=new DD(r,i,o,h);return FD(f,n),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Fl(new Eo("auth-internal",e=>{const n=ac(e.getProvider("auth").getImmediate());return(r=>new dO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ya(Dw,kw,hO(t)),ya(Dw,kw,"esm2020")}const mO=300,pO=QS("authIdTokenMaxAge")||mO;let Ow=null;const gO=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>pO)return;const i=n?.token;Ow!==i&&(Ow=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function yO(t=JS()){const e=Jy(t,"auth");if(e.isInitialized())return e.getImmediate();const n=UD(t,{popupRedirectResolver:uO,persistence:[xk,ck,jE]}),r=QS("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=gO(o.toString());sk(n,l,()=>l(n.currentUser)),rk(n,u=>l(u))}}const i=GS("auth");return i&&VD(n,`http://${i}`),n}function _O(){return document.getElementsByTagName("head")?.[0]??document}kD({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const o=Ps("internal-error");o.customData=i,n(o)},r.type="text/javascript",r.charset="UTF-8",_O().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});fO("Browser");var bO="firebase",vO="12.7.0";ya(bO,vO,"app");const xO={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},Wf=ZS(xO);function Da(){const t=yO(Wf);async function e(){return!1}async function n(h,f){return nk(t,h,f)}function r(){return ak(t)}function i(h){ik(t,f=>{h(f)})}function o(){return t.currentUser}function l(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:i,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:l}}const lc=300*1e3,wO=1800*1e3,Ue=new oR({defaultOptions:{queries:{staleTime:lc,gcTime:wO,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Ue.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const ke={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};function SO({children:t}){return d.jsx(lR,{client:Ue,children:t})}var Mw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ba,NE;(function(){var t;function e(O,D){function P(){}P.prototype=D.prototype,O.F=D.prototype,O.prototype=new P,O.prototype.constructor=O,O.D=function(L,q,j){for(var M=Array(arguments.length-2),R=2;R<arguments.length;R++)M[R-2]=arguments[R];return D.prototype[q].apply(L,M)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(O,D,P){P||(P=0);const L=Array(16);if(typeof D=="string")for(var q=0;q<16;++q)L[q]=D.charCodeAt(P++)|D.charCodeAt(P++)<<8|D.charCodeAt(P++)<<16|D.charCodeAt(P++)<<24;else for(q=0;q<16;++q)L[q]=D[P++]|D[P++]<<8|D[P++]<<16|D[P++]<<24;D=O.g[0],P=O.g[1],q=O.g[2];let j=O.g[3],M;M=D+(j^P&(q^j))+L[0]+3614090360&4294967295,D=P+(M<<7&4294967295|M>>>25),M=j+(q^D&(P^q))+L[1]+3905402710&4294967295,j=D+(M<<12&4294967295|M>>>20),M=q+(P^j&(D^P))+L[2]+606105819&4294967295,q=j+(M<<17&4294967295|M>>>15),M=P+(D^q&(j^D))+L[3]+3250441966&4294967295,P=q+(M<<22&4294967295|M>>>10),M=D+(j^P&(q^j))+L[4]+4118548399&4294967295,D=P+(M<<7&4294967295|M>>>25),M=j+(q^D&(P^q))+L[5]+1200080426&4294967295,j=D+(M<<12&4294967295|M>>>20),M=q+(P^j&(D^P))+L[6]+2821735955&4294967295,q=j+(M<<17&4294967295|M>>>15),M=P+(D^q&(j^D))+L[7]+4249261313&4294967295,P=q+(M<<22&4294967295|M>>>10),M=D+(j^P&(q^j))+L[8]+1770035416&4294967295,D=P+(M<<7&4294967295|M>>>25),M=j+(q^D&(P^q))+L[9]+2336552879&4294967295,j=D+(M<<12&4294967295|M>>>20),M=q+(P^j&(D^P))+L[10]+4294925233&4294967295,q=j+(M<<17&4294967295|M>>>15),M=P+(D^q&(j^D))+L[11]+2304563134&4294967295,P=q+(M<<22&4294967295|M>>>10),M=D+(j^P&(q^j))+L[12]+1804603682&4294967295,D=P+(M<<7&4294967295|M>>>25),M=j+(q^D&(P^q))+L[13]+4254626195&4294967295,j=D+(M<<12&4294967295|M>>>20),M=q+(P^j&(D^P))+L[14]+2792965006&4294967295,q=j+(M<<17&4294967295|M>>>15),M=P+(D^q&(j^D))+L[15]+1236535329&4294967295,P=q+(M<<22&4294967295|M>>>10),M=D+(q^j&(P^q))+L[1]+4129170786&4294967295,D=P+(M<<5&4294967295|M>>>27),M=j+(P^q&(D^P))+L[6]+3225465664&4294967295,j=D+(M<<9&4294967295|M>>>23),M=q+(D^P&(j^D))+L[11]+643717713&4294967295,q=j+(M<<14&4294967295|M>>>18),M=P+(j^D&(q^j))+L[0]+3921069994&4294967295,P=q+(M<<20&4294967295|M>>>12),M=D+(q^j&(P^q))+L[5]+3593408605&4294967295,D=P+(M<<5&4294967295|M>>>27),M=j+(P^q&(D^P))+L[10]+38016083&4294967295,j=D+(M<<9&4294967295|M>>>23),M=q+(D^P&(j^D))+L[15]+3634488961&4294967295,q=j+(M<<14&4294967295|M>>>18),M=P+(j^D&(q^j))+L[4]+3889429448&4294967295,P=q+(M<<20&4294967295|M>>>12),M=D+(q^j&(P^q))+L[9]+568446438&4294967295,D=P+(M<<5&4294967295|M>>>27),M=j+(P^q&(D^P))+L[14]+3275163606&4294967295,j=D+(M<<9&4294967295|M>>>23),M=q+(D^P&(j^D))+L[3]+4107603335&4294967295,q=j+(M<<14&4294967295|M>>>18),M=P+(j^D&(q^j))+L[8]+1163531501&4294967295,P=q+(M<<20&4294967295|M>>>12),M=D+(q^j&(P^q))+L[13]+2850285829&4294967295,D=P+(M<<5&4294967295|M>>>27),M=j+(P^q&(D^P))+L[2]+4243563512&4294967295,j=D+(M<<9&4294967295|M>>>23),M=q+(D^P&(j^D))+L[7]+1735328473&4294967295,q=j+(M<<14&4294967295|M>>>18),M=P+(j^D&(q^j))+L[12]+2368359562&4294967295,P=q+(M<<20&4294967295|M>>>12),M=D+(P^q^j)+L[5]+4294588738&4294967295,D=P+(M<<4&4294967295|M>>>28),M=j+(D^P^q)+L[8]+2272392833&4294967295,j=D+(M<<11&4294967295|M>>>21),M=q+(j^D^P)+L[11]+1839030562&4294967295,q=j+(M<<16&4294967295|M>>>16),M=P+(q^j^D)+L[14]+4259657740&4294967295,P=q+(M<<23&4294967295|M>>>9),M=D+(P^q^j)+L[1]+2763975236&4294967295,D=P+(M<<4&4294967295|M>>>28),M=j+(D^P^q)+L[4]+1272893353&4294967295,j=D+(M<<11&4294967295|M>>>21),M=q+(j^D^P)+L[7]+4139469664&4294967295,q=j+(M<<16&4294967295|M>>>16),M=P+(q^j^D)+L[10]+3200236656&4294967295,P=q+(M<<23&4294967295|M>>>9),M=D+(P^q^j)+L[13]+681279174&4294967295,D=P+(M<<4&4294967295|M>>>28),M=j+(D^P^q)+L[0]+3936430074&4294967295,j=D+(M<<11&4294967295|M>>>21),M=q+(j^D^P)+L[3]+3572445317&4294967295,q=j+(M<<16&4294967295|M>>>16),M=P+(q^j^D)+L[6]+76029189&4294967295,P=q+(M<<23&4294967295|M>>>9),M=D+(P^q^j)+L[9]+3654602809&4294967295,D=P+(M<<4&4294967295|M>>>28),M=j+(D^P^q)+L[12]+3873151461&4294967295,j=D+(M<<11&4294967295|M>>>21),M=q+(j^D^P)+L[15]+530742520&4294967295,q=j+(M<<16&4294967295|M>>>16),M=P+(q^j^D)+L[2]+3299628645&4294967295,P=q+(M<<23&4294967295|M>>>9),M=D+(q^(P|~j))+L[0]+4096336452&4294967295,D=P+(M<<6&4294967295|M>>>26),M=j+(P^(D|~q))+L[7]+1126891415&4294967295,j=D+(M<<10&4294967295|M>>>22),M=q+(D^(j|~P))+L[14]+2878612391&4294967295,q=j+(M<<15&4294967295|M>>>17),M=P+(j^(q|~D))+L[5]+4237533241&4294967295,P=q+(M<<21&4294967295|M>>>11),M=D+(q^(P|~j))+L[12]+1700485571&4294967295,D=P+(M<<6&4294967295|M>>>26),M=j+(P^(D|~q))+L[3]+2399980690&4294967295,j=D+(M<<10&4294967295|M>>>22),M=q+(D^(j|~P))+L[10]+4293915773&4294967295,q=j+(M<<15&4294967295|M>>>17),M=P+(j^(q|~D))+L[1]+2240044497&4294967295,P=q+(M<<21&4294967295|M>>>11),M=D+(q^(P|~j))+L[8]+1873313359&4294967295,D=P+(M<<6&4294967295|M>>>26),M=j+(P^(D|~q))+L[15]+4264355552&4294967295,j=D+(M<<10&4294967295|M>>>22),M=q+(D^(j|~P))+L[6]+2734768916&4294967295,q=j+(M<<15&4294967295|M>>>17),M=P+(j^(q|~D))+L[13]+1309151649&4294967295,P=q+(M<<21&4294967295|M>>>11),M=D+(q^(P|~j))+L[4]+4149444226&4294967295,D=P+(M<<6&4294967295|M>>>26),M=j+(P^(D|~q))+L[11]+3174756917&4294967295,j=D+(M<<10&4294967295|M>>>22),M=q+(D^(j|~P))+L[2]+718787259&4294967295,q=j+(M<<15&4294967295|M>>>17),M=P+(j^(q|~D))+L[9]+3951481745&4294967295,O.g[0]=O.g[0]+D&4294967295,O.g[1]=O.g[1]+(q+(M<<21&4294967295|M>>>11))&4294967295,O.g[2]=O.g[2]+q&4294967295,O.g[3]=O.g[3]+j&4294967295}r.prototype.v=function(O,D){D===void 0&&(D=O.length);const P=D-this.blockSize,L=this.C;let q=this.h,j=0;for(;j<D;){if(q==0)for(;j<=P;)i(this,O,j),j+=this.blockSize;if(typeof O=="string"){for(;j<D;)if(L[q++]=O.charCodeAt(j++),q==this.blockSize){i(this,L),q=0;break}}else for(;j<D;)if(L[q++]=O[j++],q==this.blockSize){i(this,L),q=0;break}}this.h=q,this.o+=D},r.prototype.A=function(){var O=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);O[0]=128;for(var D=1;D<O.length-8;++D)O[D]=0;D=this.o*8;for(var P=O.length-8;P<O.length;++P)O[P]=D&255,D/=256;for(this.v(O),O=Array(16),D=0,P=0;P<4;++P)for(let L=0;L<32;L+=8)O[D++]=this.g[P]>>>L&255;return O};function o(O,D){var P=u;return Object.prototype.hasOwnProperty.call(P,O)?P[O]:P[O]=D(O)}function l(O,D){this.h=D;const P=[];let L=!0;for(let q=O.length-1;q>=0;q--){const j=O[q]|0;L&&j==D||(P[q]=j,L=!1)}this.g=P}var u={};function h(O){return-128<=O&&O<128?o(O,function(D){return new l([D|0],D<0?-1:0)}):new l([O|0],O<0?-1:0)}function f(O){if(isNaN(O)||!isFinite(O))return g;if(O<0)return E(f(-O));const D=[];let P=1;for(let L=0;O>=P;L++)D[L]=O/P|0,P*=4294967296;return new l(D,0)}function p(O,D){if(O.length==0)throw Error("number format error: empty string");if(D=D||10,D<2||36<D)throw Error("radix out of range: "+D);if(O.charAt(0)=="-")return E(p(O.substring(1),D));if(O.indexOf("-")>=0)throw Error('number format error: interior "-" character');const P=f(Math.pow(D,8));let L=g;for(let j=0;j<O.length;j+=8){var q=Math.min(8,O.length-j);const M=parseInt(O.substring(j,j+q),D);q<8?(q=f(Math.pow(D,q)),L=L.j(q).add(f(M))):(L=L.j(P),L=L.add(f(M)))}return L}var g=h(0),_=h(1),b=h(16777216);t=l.prototype,t.m=function(){if(x(this))return-E(this).m();let O=0,D=1;for(let P=0;P<this.g.length;P++){const L=this.i(P);O+=(L>=0?L:4294967296+L)*D,D*=4294967296}return O},t.toString=function(O){if(O=O||10,O<2||36<O)throw Error("radix out of range: "+O);if(S(this))return"0";if(x(this))return"-"+E(this).toString(O);const D=f(Math.pow(O,6));var P=this;let L="";for(;;){const q=U(P,D).g;P=C(P,q.j(D));let j=((P.g.length>0?P.g[0]:P.h)>>>0).toString(O);if(P=q,S(P))return j+L;for(;j.length<6;)j="0"+j;L=j+L}},t.i=function(O){return O<0?0:O<this.g.length?this.g[O]:this.h};function S(O){if(O.h!=0)return!1;for(let D=0;D<O.g.length;D++)if(O.g[D]!=0)return!1;return!0}function x(O){return O.h==-1}t.l=function(O){return O=C(this,O),x(O)?-1:S(O)?0:1};function E(O){const D=O.g.length,P=[];for(let L=0;L<D;L++)P[L]=~O.g[L];return new l(P,~O.h).add(_)}t.abs=function(){return x(this)?E(this):this},t.add=function(O){const D=Math.max(this.g.length,O.g.length),P=[];let L=0;for(let q=0;q<=D;q++){let j=L+(this.i(q)&65535)+(O.i(q)&65535),M=(j>>>16)+(this.i(q)>>>16)+(O.i(q)>>>16);L=M>>>16,j&=65535,M&=65535,P[q]=M<<16|j}return new l(P,P[P.length-1]&-2147483648?-1:0)};function C(O,D){return O.add(E(D))}t.j=function(O){if(S(this)||S(O))return g;if(x(this))return x(O)?E(this).j(E(O)):E(E(this).j(O));if(x(O))return E(this.j(E(O)));if(this.l(b)<0&&O.l(b)<0)return f(this.m()*O.m());const D=this.g.length+O.g.length,P=[];for(var L=0;L<2*D;L++)P[L]=0;for(L=0;L<this.g.length;L++)for(let q=0;q<O.g.length;q++){const j=this.i(L)>>>16,M=this.i(L)&65535,R=O.i(q)>>>16,K=O.i(q)&65535;P[2*L+2*q]+=M*K,T(P,2*L+2*q),P[2*L+2*q+1]+=j*K,T(P,2*L+2*q+1),P[2*L+2*q+1]+=M*R,T(P,2*L+2*q+1),P[2*L+2*q+2]+=j*R,T(P,2*L+2*q+2)}for(O=0;O<D;O++)P[O]=P[2*O+1]<<16|P[2*O];for(O=D;O<2*D;O++)P[O]=0;return new l(P,0)};function T(O,D){for(;(O[D]&65535)!=O[D];)O[D+1]+=O[D]>>>16,O[D]&=65535,D++}function A(O,D){this.g=O,this.h=D}function U(O,D){if(S(D))throw Error("division by zero");if(S(O))return new A(g,g);if(x(O))return D=U(E(O),D),new A(E(D.g),E(D.h));if(x(D))return D=U(O,E(D)),new A(E(D.g),D.h);if(O.g.length>30){if(x(O)||x(D))throw Error("slowDivide_ only works with positive integers.");for(var P=_,L=D;L.l(O)<=0;)P=F(P),L=F(L);var q=H(P,1),j=H(L,1);for(L=H(L,2),P=H(P,2);!S(L);){var M=j.add(L);M.l(O)<=0&&(q=q.add(P),j=M),L=H(L,1),P=H(P,1)}return D=C(O,q.j(D)),new A(q,D)}for(q=g;O.l(D)>=0;){for(P=Math.max(1,Math.floor(O.m()/D.m())),L=Math.ceil(Math.log(P)/Math.LN2),L=L<=48?1:Math.pow(2,L-48),j=f(P),M=j.j(D);x(M)||M.l(O)>0;)P-=L,j=f(P),M=j.j(D);S(j)&&(j=_),q=q.add(j),O=C(O,M)}return new A(q,O)}t.B=function(O){return U(this,O).h},t.and=function(O){const D=Math.max(this.g.length,O.g.length),P=[];for(let L=0;L<D;L++)P[L]=this.i(L)&O.i(L);return new l(P,this.h&O.h)},t.or=function(O){const D=Math.max(this.g.length,O.g.length),P=[];for(let L=0;L<D;L++)P[L]=this.i(L)|O.i(L);return new l(P,this.h|O.h)},t.xor=function(O){const D=Math.max(this.g.length,O.g.length),P=[];for(let L=0;L<D;L++)P[L]=this.i(L)^O.i(L);return new l(P,this.h^O.h)};function F(O){const D=O.g.length+1,P=[];for(let L=0;L<D;L++)P[L]=O.i(L)<<1|O.i(L-1)>>>31;return new l(P,O.h)}function H(O,D){const P=D>>5;D%=32;const L=O.g.length-P,q=[];for(let j=0;j<L;j++)q[j]=D>0?O.i(j+P)>>>D|O.i(j+P+1)<<32-D:O.i(j+P);return new l(q,O.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,NE=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=f,l.fromString=p,ba=l}).apply(typeof Mw<"u"?Mw:typeof self<"u"?self:typeof window<"u"?window:{});var Fh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var PE,xu,zE,ef,yy,BE,LE,UE;(function(){var t,e=Object.defineProperty;function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Fh=="object"&&Fh];for(var I=0;I<y.length;++I){var V=y[I];if(V&&V.Math==Math)return V}throw Error("Cannot find global object")}var r=n(this);function i(y,I){if(I)e:{var V=r;y=y.split(".");for(var Y=0;Y<y.length-1;Y++){var he=y[Y];if(!(he in V))break e;V=V[he]}y=y[y.length-1],Y=V[y],I=I(Y),I!=Y&&I!=null&&e(V,y,{configurable:!0,writable:!0,value:I})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(I){var V=[],Y;for(Y in I)Object.prototype.hasOwnProperty.call(I,Y)&&V.push([Y,I[Y]]);return V}});var o=o||{},l=this||self;function u(y){var I=typeof y;return I=="object"&&y!=null||I=="function"}function h(y,I,V){return y.call.apply(y.bind,arguments)}function f(y,I,V){return f=h,f.apply(null,arguments)}function p(y,I){var V=Array.prototype.slice.call(arguments,1);return function(){var Y=V.slice();return Y.push.apply(Y,arguments),y.apply(this,Y)}}function g(y,I){function V(){}V.prototype=I.prototype,y.Z=I.prototype,y.prototype=new V,y.prototype.constructor=y,y.Ob=function(Y,he,_e){for(var ze=Array(arguments.length-2),it=2;it<arguments.length;it++)ze[it-2]=arguments[it];return I.prototype[he].apply(Y,ze)}}var _=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function b(y){const I=y.length;if(I>0){const V=Array(I);for(let Y=0;Y<I;Y++)V[Y]=y[Y];return V}return[]}function S(y,I){for(let Y=1;Y<arguments.length;Y++){const he=arguments[Y];var V=typeof he;if(V=V!="object"?V:he?Array.isArray(he)?"array":V:"null",V=="array"||V=="object"&&typeof he.length=="number"){V=y.length||0;const _e=he.length||0;y.length=V+_e;for(let ze=0;ze<_e;ze++)y[V+ze]=he[ze]}else y.push(he)}}class x{constructor(I,V){this.i=I,this.j=V,this.h=0,this.g=null}get(){let I;return this.h>0?(this.h--,I=this.g,this.g=I.next,I.next=null):I=this.i(),I}}function E(y){l.setTimeout(()=>{throw y},0)}function C(){var y=O;let I=null;return y.g&&(I=y.g,y.g=y.g.next,y.g||(y.h=null),I.next=null),I}class T{constructor(){this.h=this.g=null}add(I,V){const Y=A.get();Y.set(I,V),this.h?this.h.next=Y:this.g=Y,this.h=Y}}var A=new x(()=>new U,y=>y.reset());class U{constructor(){this.next=this.g=this.h=null}set(I,V){this.h=I,this.g=V,this.next=null}reset(){this.next=this.g=this.h=null}}let F,H=!1,O=new T,D=()=>{const y=Promise.resolve(void 0);F=()=>{y.then(P)}};function P(){for(var y;y=C();){try{y.h.call(y.g)}catch(V){E(V)}var I=A;I.j(y),I.h<100&&(I.h++,y.next=I.g,I.g=y)}H=!1}function L(){this.u=this.u,this.C=this.C}L.prototype.u=!1,L.prototype.dispose=function(){this.u||(this.u=!0,this.N())},L.prototype[Symbol.dispose]=function(){this.dispose()},L.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function q(y,I){this.type=y,this.g=this.target=I,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var j=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var y=!1,I=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const V=()=>{};l.addEventListener("test",V,I),l.removeEventListener("test",V,I)}catch{}return y})();function M(y){return/^[\s\xa0]*$/.test(y)}function R(y,I){q.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,I)}g(R,q),R.prototype.init=function(y,I){const V=this.type=y.type,Y=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=I,I=y.relatedTarget,I||(V=="mouseover"?I=y.fromElement:V=="mouseout"&&(I=y.toElement)),this.relatedTarget=I,Y?(this.clientX=Y.clientX!==void 0?Y.clientX:Y.pageX,this.clientY=Y.clientY!==void 0?Y.clientY:Y.pageY,this.screenX=Y.screenX||0,this.screenY=Y.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&R.Z.h.call(this)},R.prototype.h=function(){R.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var K="closure_listenable_"+(Math.random()*1e6|0),Q=0;function G(y,I,V,Y,he){this.listener=y,this.proxy=null,this.src=I,this.type=V,this.capture=!!Y,this.ha=he,this.key=++Q,this.da=this.fa=!1}function X(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function J(y,I,V){for(const Y in y)I.call(V,y[Y],Y,y)}function re(y,I){for(const V in y)I.call(void 0,y[V],V,y)}function B(y){const I={};for(const V in y)I[V]=y[V];return I}const $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(y,I){let V,Y;for(let he=1;he<arguments.length;he++){Y=arguments[he];for(V in Y)y[V]=Y[V];for(let _e=0;_e<$.length;_e++)V=$[_e],Object.prototype.hasOwnProperty.call(Y,V)&&(y[V]=Y[V])}}function ae(y){this.src=y,this.g={},this.h=0}ae.prototype.add=function(y,I,V,Y,he){const _e=y.toString();y=this.g[_e],y||(y=this.g[_e]=[],this.h++);const ze=de(y,I,Y,he);return ze>-1?(I=y[ze],V||(I.fa=!1)):(I=new G(I,this.src,_e,!!Y,he),I.fa=V,y.push(I)),I};function ne(y,I){const V=I.type;if(V in y.g){var Y=y.g[V],he=Array.prototype.indexOf.call(Y,I,void 0),_e;(_e=he>=0)&&Array.prototype.splice.call(Y,he,1),_e&&(X(I),y.g[V].length==0&&(delete y.g[V],y.h--))}}function de(y,I,V,Y){for(let he=0;he<y.length;++he){const _e=y[he];if(!_e.da&&_e.listener==I&&_e.capture==!!V&&_e.ha==Y)return he}return-1}var Se="closure_lm_"+(Math.random()*1e6|0),Te={};function Ee(y,I,V,Y,he){if(Array.isArray(I)){for(let _e=0;_e<I.length;_e++)Ee(y,I[_e],V,Y,he);return null}return V=Z(V),y&&y[K]?y.J(I,V,u(Y)?!!Y.capture:!1,he):pe(y,I,V,!1,Y,he)}function pe(y,I,V,Y,he,_e){if(!I)throw Error("Invalid event type");const ze=u(he)?!!he.capture:!!he;let it=ge(y);if(it||(y[Se]=it=new ae(y)),V=it.add(I,V,Y,ze,_e),V.proxy)return V;if(Y=Fe(),V.proxy=Y,Y.src=y,Y.listener=V,y.addEventListener)j||(he=ze),he===void 0&&(he=!1),y.addEventListener(I.toString(),Y,he);else if(y.attachEvent)y.attachEvent(z(I.toString()),Y);else if(y.addListener&&y.removeListener)y.addListener(Y);else throw Error("addEventListener and attachEvent are unavailable.");return V}function Fe(){function y(V){return I.call(y.src,y.listener,V)}const I=be;return y}function He(y,I,V,Y,he){if(Array.isArray(I))for(var _e=0;_e<I.length;_e++)He(y,I[_e],V,Y,he);else Y=u(Y)?!!Y.capture:!!Y,V=Z(V),y&&y[K]?(y=y.i,_e=String(I).toString(),_e in y.g&&(I=y.g[_e],V=de(I,V,Y,he),V>-1&&(X(I[V]),Array.prototype.splice.call(I,V,1),I.length==0&&(delete y.g[_e],y.h--)))):y&&(y=ge(y))&&(I=y.g[I.toString()],y=-1,I&&(y=de(I,V,Y,he)),(V=y>-1?I[y]:null)&&Ne(V))}function Ne(y){if(typeof y!="number"&&y&&!y.da){var I=y.src;if(I&&I[K])ne(I.i,y);else{var V=y.type,Y=y.proxy;I.removeEventListener?I.removeEventListener(V,Y,y.capture):I.detachEvent?I.detachEvent(z(V),Y):I.addListener&&I.removeListener&&I.removeListener(Y),(V=ge(I))?(ne(V,y),V.h==0&&(V.src=null,I[Se]=null)):X(y)}}}function z(y){return y in Te?Te[y]:Te[y]="on"+y}function be(y,I){if(y.da)y=!0;else{I=new R(I,this);const V=y.listener,Y=y.ha||y.src;y.fa&&Ne(y),y=V.call(Y,I)}return y}function ge(y){return y=y[Se],y instanceof ae?y:null}var ee="__closure_events_fn_"+(Math.random()*1e9>>>0);function Z(y){return typeof y=="function"?y:(y[ee]||(y[ee]=function(I){return y.handleEvent(I)}),y[ee])}function ie(){L.call(this),this.i=new ae(this),this.M=this,this.G=null}g(ie,L),ie.prototype[K]=!0,ie.prototype.removeEventListener=function(y,I,V,Y){He(this,y,I,V,Y)};function we(y,I){var V,Y=y.G;if(Y)for(V=[];Y;Y=Y.G)V.push(Y);if(y=y.M,Y=I.type||I,typeof I=="string")I=new q(I,y);else if(I instanceof q)I.target=I.target||y;else{var he=I;I=new q(Y,y),te(I,he)}he=!0;let _e,ze;if(V)for(ze=V.length-1;ze>=0;ze--)_e=I.g=V[ze],he=xe(_e,Y,!0,I)&&he;if(_e=I.g=y,he=xe(_e,Y,!0,I)&&he,he=xe(_e,Y,!1,I)&&he,V)for(ze=0;ze<V.length;ze++)_e=I.g=V[ze],he=xe(_e,Y,!1,I)&&he}ie.prototype.N=function(){if(ie.Z.N.call(this),this.i){var y=this.i;for(const I in y.g){const V=y.g[I];for(let Y=0;Y<V.length;Y++)X(V[Y]);delete y.g[I],y.h--}}this.G=null},ie.prototype.J=function(y,I,V,Y){return this.i.add(String(y),I,!1,V,Y)},ie.prototype.K=function(y,I,V,Y){return this.i.add(String(y),I,!0,V,Y)};function xe(y,I,V,Y){if(I=y.i.g[String(I)],!I)return!0;I=I.concat();let he=!0;for(let _e=0;_e<I.length;++_e){const ze=I[_e];if(ze&&!ze.da&&ze.capture==V){const it=ze.listener,rn=ze.ha||ze.src;ze.fa&&ne(y.i,ze),he=it.call(rn,Y)!==!1&&he}}return he&&!Y.defaultPrevented}function oe(y,I){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=f(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(I)>2147483647?-1:l.setTimeout(y,I||0)}function je(y){y.g=oe(()=>{y.g=null,y.i&&(y.i=!1,je(y))},y.l);const I=y.h;y.h=null,y.m.apply(null,I)}class Pe extends L{constructor(I,V){super(),this.m=I,this.l=V,this.h=null,this.i=!1,this.g=null}j(I){this.h=arguments,this.g?this.i=!0:je(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Oe(y){L.call(this),this.h=y,this.g={}}g(Oe,L);var Ge=[];function xt(y){J(y.g,function(I,V){this.g.hasOwnProperty(V)&&Ne(I)},y),y.g={}}Oe.prototype.N=function(){Oe.Z.N.call(this),xt(this)},Oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var st=l.JSON.stringify,Hn=l.JSON.parse,ds=class{stringify(y){return l.JSON.stringify(y,void 0)}parse(y){return l.JSON.parse(y,void 0)}};function Jn(){}function hs(){}var bt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Jt(){q.call(this,"d")}g(Jt,q);function Qn(){q.call(this,"c")}g(Qn,q);var Et={},Ba=null;function Ci(){return Ba=Ba||new ie}Et.Ia="serverreachability";function Lo(y){q.call(this,Et.Ia,y)}g(Lo,q);function jr(y){const I=Ci();we(I,new Lo(I))}Et.STAT_EVENT="statevent";function fs(y,I){q.call(this,Et.STAT_EVENT,y),this.stat=I}g(fs,q);function Lt(y){const I=Ci();we(I,new fs(I,y))}Et.Ja="timingevent";function er(y,I){q.call(this,Et.Ja,y),this.size=I}g(er,q);function ms(y,I){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){y()},I)}function Hr(){this.g=!0}Hr.prototype.ua=function(){this.g=!1};function Rm(y,I,V,Y,he,_e){y.info(function(){if(y.g)if(_e){var ze="",it=_e.split("&");for(let Ct=0;Ct<it.length;Ct++){var rn=it[Ct].split("=");if(rn.length>1){const Qt=rn[0];rn=rn[1];const kr=Qt.split("_");ze=kr.length>=2&&kr[1]=="type"?ze+(Qt+"="+rn+"&"):ze+(Qt+"=redacted&")}}}else ze=null;else ze=_e;return"XMLHTTP REQ ("+Y+") [attempt "+he+"]: "+I+`
`+V+`
`+ze})}function md(y,I,V,Y,he,_e,ze){y.info(function(){return"XMLHTTP RESP ("+Y+") [ attempt "+he+"]: "+I+`
`+V+`
`+_e+" "+ze})}function ps(y,I,V,Y){y.info(function(){return"XMLHTTP TEXT ("+I+"): "+Im(y,V)+(Y?" "+Y:"")})}function La(y,I){y.info(function(){return"TIMEOUT: "+I})}Hr.prototype.info=function(){};function Im(y,I){if(!y.g)return I;if(!I)return null;try{const _e=JSON.parse(I);if(_e){for(y=0;y<_e.length;y++)if(Array.isArray(_e[y])){var V=_e[y];if(!(V.length<2)){var Y=V[1];if(Array.isArray(Y)&&!(Y.length<1)){var he=Y[0];if(he!="noop"&&he!="stop"&&he!="close")for(let ze=1;ze<Y.length;ze++)Y[ze]=""}}}}return st(_e)}catch{return I}}var Ua={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},yc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},_c;function Fa(){}g(Fa,Jn),Fa.prototype.g=function(){return new XMLHttpRequest},_c=new Fa;function Gs(y){return encodeURIComponent(String(y))}function pd(y){var I=1;y=y.split(":");const V=[];for(;I>0&&y.length;)V.push(y.shift()),I--;return y.length&&V.push(y.join(":")),V}function Qr(y,I,V,Y){this.j=y,this.i=I,this.l=V,this.S=Y||1,this.V=new Oe(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Wr}function Wr(){this.i=null,this.g="",this.h=!1}var cn={},jn={};function gs(y,I,V){y.M=1,y.A=Va(dn(I)),y.u=V,y.R=!0,Uo(y,null)}function Uo(y,I){y.F=Date.now(),ys(y),y.B=dn(y.A);var V=y.B,Y=y.S;Array.isArray(Y)||(Y=[String(Y)]),qo(V.i,"t",Y),y.C=0,V=y.j.L,y.h=new Wr,y.g=Id(y.j,V?I:null,!y.u),y.P>0&&(y.O=new Pe(f(y.Y,y,y.g),y.P)),I=y.V,V=y.g,Y=y.ba;var he="readystatechange";Array.isArray(he)||(he&&(Ge[0]=he.toString()),he=Ge);for(let _e=0;_e<he.length;_e++){const ze=Ee(V,he[_e],Y||I.handleEvent,!1,I.h||I);if(!ze)break;I.g[ze.key]=ze}I=y.J?B(y.J):{},y.u?(y.v||(y.v="POST"),I["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,I)):(y.v="GET",y.g.ea(y.B,y.v,null,I)),jr(),Rm(y.i,y.v,y.B,y.l,y.S,y.u)}Qr.prototype.ba=function(y){y=y.target;const I=this.O;I&&Xr(y)==3?I.j():this.Y(y)},Qr.prototype.Y=function(y){try{if(y==this.g)e:{const it=Xr(this.g),rn=this.g.ya(),Ct=this.g.ca();if(!(it<3)&&(it!=3||this.g&&(this.h.h||this.g.la()||Mn(this.g)))){this.K||it!=4||rn==7||(rn==8||Ct<=0?jr(3):jr(2)),_s(this);var I=this.g.ca();this.X=I;var V=Dm(this);if(this.o=I==200,md(this.i,this.v,this.B,this.l,this.S,it,I),this.o){if(this.U&&!this.L){t:{if(this.g){var Y,he=this.g;if((Y=he.g?he.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(Y)){var _e=Y;break t}}_e=null}if(y=_e)ps(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,bs(this,y);else{this.o=!1,this.m=3,Lt(12),gr(this),Rr(this);break e}}if(this.R){y=!0;let Qt;for(;!this.K&&this.C<V.length;)if(Qt=yd(this,V),Qt==jn){it==4&&(this.m=4,Lt(14),y=!1),ps(this.i,this.l,null,"[Incomplete Response]");break}else if(Qt==cn){this.m=4,Lt(15),ps(this.i,this.l,V,"[Invalid Chunk]"),y=!1;break}else ps(this.i,this.l,Qt,null),bs(this,Qt);if(gd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),it!=4||V.length!=0||this.h.h||(this.m=1,Lt(16),y=!1),this.o=this.o&&y,!y)ps(this.i,this.l,V,"[Invalid Chunked Response]"),gr(this),Rr(this);else if(V.length>0&&!this.W){this.W=!0;var ze=this.j;ze.g==this&&ze.aa&&!ze.P&&(ze.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),Oc(ze),ze.P=!0,Lt(11))}}else ps(this.i,this.l,V,null),bs(this,V);it==4&&gr(this),this.o&&!this.K&&(it==4?Td(this.j,this):(this.o=!1,ys(this)))}else Qs(this.g),I==400&&V.indexOf("Unknown SID")>0?(this.m=3,Lt(12)):(this.m=0,Lt(13)),gr(this),Rr(this)}}}catch{}};function Dm(y){if(!gd(y))return y.g.la();const I=Mn(y.g);if(I==="")return"";let V="";const Y=I.length,he=Xr(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return gr(y),Rr(y),"";y.h.i=new l.TextDecoder}for(let _e=0;_e<Y;_e++)y.h.h=!0,V+=y.h.i.decode(I[_e],{stream:!(he&&_e==Y-1)});return I.length=0,y.h.g+=V,y.C=0,y.h.g}function gd(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function yd(y,I){var V=y.C,Y=I.indexOf(`
`,V);return Y==-1?jn:(V=Number(I.substring(V,Y)),isNaN(V)?cn:(Y+=1,Y+V>I.length?jn:(I=I.slice(Y,Y+V),y.C=Y+V,I)))}Qr.prototype.cancel=function(){this.K=!0,gr(this)};function ys(y){y.T=Date.now()+y.H,Fo(y,y.H)}function Fo(y,I){if(y.D!=null)throw Error("WatchDog timer not null");y.D=ms(f(y.aa,y),I)}function _s(y){y.D&&(l.clearTimeout(y.D),y.D=null)}Qr.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(La(this.i,this.B),this.M!=2&&(jr(),Lt(17)),gr(this),this.m=2,Rr(this)):Fo(this,this.T-y)};function Rr(y){y.j.I==0||y.K||Td(y.j,y)}function gr(y){_s(y);var I=y.O;I&&typeof I.dispose=="function"&&I.dispose(),y.O=null,xt(y.V),y.g&&(I=y.g,y.g=null,I.abort(),I.dispose())}function bs(y,I){try{var V=y.j;if(V.I!=0&&(V.g==y||xs(V.h,y))){if(!y.L&&xs(V.h,y)&&V.I==3){try{var Y=V.Ba.g.parse(I)}catch{Y=null}if(Array.isArray(Y)&&Y.length==3){var he=Y;if(he[0]==0){e:if(!V.v){if(V.g)if(V.g.F+3e3<y.F)Ko(V),Oi(V);else break e;Ka(V),Lt(18)}}else V.xa=he[1],0<V.xa-V.K&&he[2]<37500&&V.F&&V.A==0&&!V.C&&(V.C=ms(f(V.Va,V),6e3));vs(V.h)<=1&&V.ta&&(V.ta=void 0)}else As(V,11)}else if((y.L||V.g==y)&&Ko(V),!M(I))for(he=V.Ba.g.parse(I),I=0;I<he.length;I++){let Ct=he[I];const Qt=Ct[0];if(!(Qt<=V.K))if(V.K=Qt,Ct=Ct[1],V.I==2)if(Ct[0]=="c"){V.M=Ct[1],V.ba=Ct[2];const kr=Ct[3];kr!=null&&(V.ka=kr,V.j.info("VER="+V.ka));const js=Ct[4];js!=null&&(V.za=js,V.j.info("SVER="+V.za));const Zr=Ct[5];Zr!=null&&typeof Zr=="number"&&Zr>0&&(Y=1.5*Zr,V.O=Y,V.j.info("backChannelRequestTimeoutMs_="+Y)),Y=V;const Jr=y.g;if(Jr){const Ya=Jr.g?Jr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ya){var _e=Y.h;_e.g||Ya.indexOf("spdy")==-1&&Ya.indexOf("quic")==-1&&Ya.indexOf("h2")==-1||(_e.j=_e.l,_e.g=new Set,_e.h&&(xc(_e,_e.h),_e.h=null))}if(Y.G){const Yo=Jr.g?Jr.g.getResponseHeader("X-HTTP-Session-Id"):null;Yo&&(Y.wa=Yo,Rt(Y.J,Y.G,Yo))}}V.I=3,V.l&&V.l.ra(),V.aa&&(V.T=Date.now()-y.F,V.j.info("Handshake RTT: "+V.T+"ms")),Y=V;var ze=y;if(Y.na=Rd(Y,Y.L?Y.ba:null,Y.W),ze.L){wc(Y.h,ze);var it=ze,rn=Y.O;rn&&(it.H=rn),it.D&&(_s(it),ys(it)),Y.g=ze}else Ed(Y);V.i.length>0&&Ts(V)}else Ct[0]!="stop"&&Ct[0]!="close"||As(V,7);else V.I==3&&(Ct[0]=="stop"||Ct[0]=="close"?Ct[0]=="stop"?As(V,7):Dc(V):Ct[0]!="noop"&&V.l&&V.l.qa(Ct),V.A=0)}}jr(4)}catch{}}var un=class{constructor(y,I){this.g=y,this.map=I}};function bc(y){this.l=y||10,l.PerformanceNavigationTiming?(y=l.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function vc(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function vs(y){return y.h?1:y.g?y.g.size:0}function xs(y,I){return y.h?y.h==I:y.g?y.g.has(I):!1}function xc(y,I){y.g?y.g.add(I):y.h=I}function wc(y,I){y.h&&y.h==I?y.h=null:y.g&&y.g.has(I)&&y.g.delete(I)}bc.prototype.cancel=function(){if(this.i=Sc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function Sc(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let I=y.i;for(const V of y.g.values())I=I.concat(V.G);return I}return b(y.i)}var _d=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Vo(y,I){if(y){y=y.split("&");for(let V=0;V<y.length;V++){const Y=y[V].indexOf("=");let he,_e=null;Y>=0?(he=y[V].substring(0,Y),_e=y[V].substring(Y+1)):he=y[V],I(he,_e?decodeURIComponent(_e.replace(/\+/g," ")):"")}}}function yr(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let I;y instanceof yr?(this.l=y.l,Rn(this,y.j),this.o=y.o,this.g=y.g,Ti(this,y.u),this.h=y.h,Ec(this,wd(y.i)),this.m=y.m):y&&(I=String(y).match(_d))?(this.l=!1,Rn(this,I[1]||"",!0),this.o=ws(I[2]||""),this.g=ws(I[3]||"",!0),Ti(this,I[4]),this.h=ws(I[5]||"",!0),Ec(this,I[6]||"",!0),this.m=ws(I[7]||"")):(this.l=!1,this.i=new ji(null,this.l))}yr.prototype.toString=function(){const y=[];var I=this.j;I&&y.push($a(I,$o,!0),":");var V=this.g;return(V||I=="file")&&(y.push("//"),(I=this.o)&&y.push($a(I,$o,!0),"@"),y.push(Gs(V).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),V=this.u,V!=null&&y.push(":",String(V))),(V=this.h)&&(this.g&&V.charAt(0)!="/"&&y.push("/"),y.push($a(V,V.charAt(0)=="/"?Cc:bd,!0))),(V=this.i.toString())&&y.push("?",V),(V=this.m)&&y.push("#",$a(V,vd)),y.join("")},yr.prototype.resolve=function(y){const I=dn(this);let V=!!y.j;V?Rn(I,y.j):V=!!y.o,V?I.o=y.o:V=!!y.g,V?I.g=y.g:V=y.u!=null;var Y=y.h;if(V)Ti(I,y.u);else if(V=!!y.h){if(Y.charAt(0)!="/")if(this.g&&!this.h)Y="/"+Y;else{var he=I.h.lastIndexOf("/");he!=-1&&(Y=I.h.slice(0,he+1)+Y)}if(he=Y,he==".."||he==".")Y="";else if(he.indexOf("./")!=-1||he.indexOf("/.")!=-1){Y=he.lastIndexOf("/",0)==0,he=he.split("/");const _e=[];for(let ze=0;ze<he.length;){const it=he[ze++];it=="."?Y&&ze==he.length&&_e.push(""):it==".."?((_e.length>1||_e.length==1&&_e[0]!="")&&_e.pop(),Y&&ze==he.length&&_e.push("")):(_e.push(it),Y=!0)}Y=_e.join("/")}else Y=he}return V?I.h=Y:V=y.i.toString()!=="",V?Ec(I,wd(y.i)):V=!!y.m,V&&(I.m=y.m),I};function dn(y){return new yr(y)}function Rn(y,I,V){y.j=V?ws(I,!0):I,y.j&&(y.j=y.j.replace(/:$/,""))}function Ti(y,I){if(I){if(I=Number(I),isNaN(I)||I<0)throw Error("Bad port number "+I);y.u=I}else y.u=null}function Ec(y,I,V){I instanceof ji?(y.i=I,Go(y.i,y.l)):(V||(I=$a(I,Ai)),y.i=new ji(I,y.l))}function Rt(y,I,V){y.i.set(I,V)}function Va(y){return Rt(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function ws(y,I){return y?I?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function $a(y,I,V){return typeof y=="string"?(y=encodeURI(y).replace(I,ir),V&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function ir(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var $o=/[#\/\?@]/g,bd=/[#\?:]/g,Cc=/[#\?]/g,Ai=/[#\?@]/g,vd=/#/g;function ji(y,I){this.h=this.g=null,this.i=y||null,this.j=!!I}function ar(y){y.g||(y.g=new Map,y.h=0,y.i&&Vo(y.i,function(I,V){y.add(decodeURIComponent(I.replace(/\+/g," ")),V)}))}t=ji.prototype,t.add=function(y,I){ar(this),this.i=null,y=Ri(this,y);let V=this.g.get(y);return V||this.g.set(y,V=[]),V.push(I),this.h+=1,this};function xd(y,I){ar(y),I=Ri(y,I),y.g.has(I)&&(y.i=null,y.h-=y.g.get(I).length,y.g.delete(I))}function Tc(y,I){return ar(y),I=Ri(y,I),y.g.has(I)}t.forEach=function(y,I){ar(this),this.g.forEach(function(V,Y){V.forEach(function(he){y.call(I,he,Y,this)},this)},this)};function Ac(y,I){ar(y);let V=[];if(typeof I=="string")Tc(y,I)&&(V=V.concat(y.g.get(Ri(y,I))));else for(y=Array.from(y.g.values()),I=0;I<y.length;I++)V=V.concat(y[I]);return V}t.set=function(y,I){return ar(this),this.i=null,y=Ri(this,y),Tc(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[I]),this.h+=1,this},t.get=function(y,I){return y?(y=Ac(this,y),y.length>0?String(y[0]):I):I};function qo(y,I,V){xd(y,I),V.length>0&&(y.i=null,y.g.set(Ri(y,I),b(V)),y.h+=V.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],I=Array.from(this.g.keys());for(let Y=0;Y<I.length;Y++){var V=I[Y];const he=Gs(V);V=Ac(this,V);for(let _e=0;_e<V.length;_e++){let ze=he;V[_e]!==""&&(ze+="="+Gs(V[_e])),y.push(ze)}}return this.i=y.join("&")};function wd(y){const I=new ji;return I.i=y.i,y.g&&(I.g=new Map(y.g),I.h=y.h),I}function Ri(y,I){return I=String(I),y.j&&(I=I.toLowerCase()),I}function Go(y,I){I&&!y.j&&(ar(y),y.i=null,y.g.forEach(function(V,Y){const he=Y.toLowerCase();Y!=he&&(xd(this,Y),qo(this,he,V))},y)),y.j=I}function Kr(y,I){const V=new Hr;if(l.Image){const Y=new Image;Y.onload=p(Ir,V,"TestLoadImage: loaded",!0,I,Y),Y.onerror=p(Ir,V,"TestLoadImage: error",!1,I,Y),Y.onabort=p(Ir,V,"TestLoadImage: abort",!1,I,Y),Y.ontimeout=p(Ir,V,"TestLoadImage: timeout",!1,I,Y),l.setTimeout(function(){Y.ontimeout&&Y.ontimeout()},1e4),Y.src=y}else I(!1)}function jc(y,I){const V=new Hr,Y=new AbortController,he=setTimeout(()=>{Y.abort(),Ir(V,"TestPingServer: timeout",!1,I)},1e4);fetch(y,{signal:Y.signal}).then(_e=>{clearTimeout(he),_e.ok?Ir(V,"TestPingServer: ok",!0,I):Ir(V,"TestPingServer: server error",!1,I)}).catch(()=>{clearTimeout(he),Ir(V,"TestPingServer: error",!1,I)})}function Ir(y,I,V,Y,he){try{he&&(he.onload=null,he.onerror=null,he.onabort=null,he.ontimeout=null),Y(V)}catch{}}function Ii(){this.g=new ds}function Ss(y){this.i=y.Sb||null,this.h=y.ab||!1}g(Ss,Jn),Ss.prototype.g=function(){return new qa(this.i,this.h)};function qa(y,I){ie.call(this),this.H=y,this.o=I,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(qa,ie),t=qa.prototype,t.open=function(y,I){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=I,this.readyState=1,Yr(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const I={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(I.body=y),(this.H||l).fetch(new Request(this.D,I)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Di(this)),this.readyState=0},t.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,Yr(this)),this.g&&(this.readyState=3,Yr(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ho(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ho(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}t.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var I=y.value?y.value:new Uint8Array(0);(I=this.B.decode(I,{stream:!y.done}))&&(this.response=this.responseText+=I)}y.done?Di(this):Yr(this),this.readyState==3&&Ho(this)}},t.Oa=function(y){this.g&&(this.response=this.responseText=y,Di(this))},t.Na=function(y){this.g&&(this.response=y,Di(this))},t.ga=function(){this.g&&Di(this)};function Di(y){y.readyState=4,y.l=null,y.j=null,y.B=null,Yr(y)}t.setRequestHeader=function(y,I){this.A.append(y,I)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],I=this.h.entries();for(var V=I.next();!V.done;)V=V.value,y.push(V[0]+": "+V[1]),V=I.next();return y.join(`\r
`)};function Yr(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(qa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Dr(y){let I="";return J(y,function(V,Y){I+=Y,I+=":",I+=V,I+=`\r
`}),I}function Ga(y,I,V){e:{for(Y in V){var Y=!1;break e}Y=!0}Y||(V=Dr(V),typeof y=="string"?V!=null&&Gs(V):Rt(y,I,V))}function kt(y){ie.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(kt,ie);var Es=/^https?$/i,Rc=["POST","PUT"];t=kt.prototype,t.Fa=function(y){this.H=y},t.ea=function(y,I,V,Y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);I=I?I.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():_c.g(),this.g.onreadystatechange=_(f(this.Ca,this));try{this.B=!0,this.g.open(I,String(y),!0),this.B=!1}catch(_e){Ha(this,_e);return}if(y=V||"",V=new Map(this.headers),Y)if(Object.getPrototypeOf(Y)===Object.prototype)for(var he in Y)V.set(he,Y[he]);else if(typeof Y.keys=="function"&&typeof Y.get=="function")for(const _e of Y.keys())V.set(_e,Y.get(_e));else throw Error("Unknown input type for opt_headers: "+String(Y));Y=Array.from(V.keys()).find(_e=>_e.toLowerCase()=="content-type"),he=l.FormData&&y instanceof l.FormData,!(Array.prototype.indexOf.call(Rc,I,void 0)>=0)||Y||he||V.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[_e,ze]of V)this.g.setRequestHeader(_e,ze);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(_e){Ha(this,_e)}};function Ha(y,I){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=I,y.o=5,Ic(y),Hs(y)}function Ic(y){y.A||(y.A=!0,we(y,"complete"),we(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,we(this,"complete"),we(this,"abort"),Hs(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Hs(this,!0)),kt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Qa(this):this.Xa())},t.Xa=function(){Qa(this)};function Qa(y){if(y.h&&typeof o<"u"){if(y.v&&Xr(y)==4)setTimeout(y.Ca.bind(y),0);else if(we(y,"readystatechange"),Xr(y)==4){y.h=!1;try{const _e=y.ca();e:switch(_e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var I=!0;break e;default:I=!1}var V;if(!(V=I)){var Y;if(Y=_e===0){let ze=String(y.D).match(_d)[1]||null;!ze&&l.self&&l.self.location&&(ze=l.self.location.protocol.slice(0,-1)),Y=!Es.test(ze?ze.toLowerCase():"")}V=Y}if(V)we(y,"complete"),we(y,"success");else{y.o=6;try{var he=Xr(y)>2?y.g.statusText:""}catch{he=""}y.l=he+" ["+y.ca()+"]",Ic(y)}}finally{Hs(y)}}}}function Hs(y,I){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const V=y.g;y.g=null,I||we(y,"ready");try{V.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Xr(y){return y.g?y.g.readyState:0}t.ca=function(){try{return Xr(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(y){if(this.g){var I=this.g.responseText;return y&&I.indexOf(y)==0&&(I=I.substring(y.length)),Hn(I)}};function Mn(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function Qs(y){const I={};y=(y.g&&Xr(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let Y=0;Y<y.length;Y++){if(M(y[Y]))continue;var V=pd(y[Y]);const he=V[0];if(V=V[1],typeof V!="string")continue;V=V.trim();const _e=I[he]||[];I[he]=_e,_e.push(V)}re(I,function(Y){return Y.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Cs(y,I,V){return V&&V.internalChannelParams&&V.internalChannelParams[y]||I}function ki(y){this.za=0,this.i=[],this.j=new Hr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Cs("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Cs("baseRetryDelayMs",5e3,y),this.Za=Cs("retryDelaySeedMs",1e4,y),this.Ta=Cs("forwardChannelMaxRetries",2,y),this.va=Cs("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new bc(y&&y.concurrentRequestLimit),this.Ba=new Ii,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=ki.prototype,t.ka=8,t.I=1,t.connect=function(y,I,V,Y){Lt(0),this.W=y,this.H=I||{},V&&Y!==void 0&&(this.H.OSID=V,this.H.OAID=Y),this.F=this.X,this.J=Rd(this,null,this.W),Ts(this)};function Dc(y){if(Qo(y),y.I==3){var I=y.V++,V=dn(y.J);if(Rt(V,"SID",y.M),Rt(V,"RID",I),Rt(V,"TYPE","terminate"),Wa(y,V),I=new Qr(y,y.j,I),I.M=2,I.A=Va(dn(V)),V=!1,l.navigator&&l.navigator.sendBeacon)try{V=l.navigator.sendBeacon(I.A.toString(),"")}catch{}!V&&l.Image&&(new Image().src=I.A,V=!0),V||(I.g=Id(I.j,null),I.g.ea(I.A)),I.F=Date.now(),ys(I)}jd(y)}function Oi(y){y.g&&(Oc(y),y.g.cancel(),y.g=null)}function Qo(y){Oi(y),y.v&&(l.clearTimeout(y.v),y.v=null),Ko(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&l.clearTimeout(y.m),y.m=null)}function Ts(y){if(!vc(y.h)&&!y.m){y.m=!0;var I=y.Ea;F||D(),H||(F(),H=!0),O.add(I,y),y.D=0}}function Wo(y,I){return vs(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=I.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=ms(f(y.Ea,y,I),Ad(y,y.D)),y.D++,!0)}t.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const he=new Qr(this,this.j,y);let _e=this.o;if(this.U&&(_e?(_e=B(_e),te(_e,this.U)):_e=this.U),this.u!==null||this.R||(he.J=_e,_e=null),this.S)e:{for(var I=0,V=0;V<this.i.length;V++){t:{var Y=this.i[V];if("__data__"in Y.map&&(Y=Y.map.__data__,typeof Y=="string")){Y=Y.length;break t}Y=void 0}if(Y===void 0)break;if(I+=Y,I>4096){I=V;break e}if(I===4096||V===this.i.length-1){I=V+1;break e}}I=1e3}else I=1e3;I=Sd(this,he,I),V=dn(this.J),Rt(V,"RID",y),Rt(V,"CVER",22),this.G&&Rt(V,"X-HTTP-Session-Id",this.G),Wa(this,V),_e&&(this.R?I="headers="+Gs(Dr(_e))+"&"+I:this.u&&Ga(V,this.u,_e)),xc(this.h,he),this.Ra&&Rt(V,"TYPE","init"),this.S?(Rt(V,"$req",I),Rt(V,"SID","null"),he.U=!0,gs(he,V,null)):gs(he,V,I),this.I=2}}else this.I==3&&(y?kc(this,y):this.i.length==0||vc(this.h)||kc(this))};function kc(y,I){var V;I?V=I.l:V=y.V++;const Y=dn(y.J);Rt(Y,"SID",y.M),Rt(Y,"RID",V),Rt(Y,"AID",y.K),Wa(y,Y),y.u&&y.o&&Ga(Y,y.u,y.o),V=new Qr(y,y.j,V,y.D+1),y.u===null&&(V.J=y.o),I&&(y.i=I.G.concat(y.i)),I=Sd(y,V,1e3),V.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),xc(y.h,V),gs(V,Y,I)}function Wa(y,I){y.H&&J(y.H,function(V,Y){Rt(I,Y,V)}),y.l&&J({},function(V,Y){Rt(I,Y,V)})}function Sd(y,I,V){V=Math.min(y.i.length,V);const Y=y.l?f(y.l.Ka,y.l,y):null;e:{var he=y.i;let it=-1;for(;;){const rn=["count="+V];it==-1?V>0?(it=he[0].g,rn.push("ofs="+it)):it=0:rn.push("ofs="+it);let Ct=!0;for(let Qt=0;Qt<V;Qt++){var _e=he[Qt].g;const kr=he[Qt].map;if(_e-=it,_e<0)it=Math.max(0,he[Qt].g-100),Ct=!1;else try{_e="req"+_e+"_"||"";try{var ze=kr instanceof Map?kr:Object.entries(kr);for(const[js,Zr]of ze){let Jr=Zr;u(Zr)&&(Jr=st(Zr)),rn.push(_e+js+"="+encodeURIComponent(Jr))}}catch(js){throw rn.push(_e+"type="+encodeURIComponent("_badmap")),js}}catch{Y&&Y(kr)}}if(Ct){ze=rn.join("&");break e}}ze=void 0}return y=y.i.splice(0,V),I.G=y,ze}function Ed(y){if(!y.g&&!y.v){y.Y=1;var I=y.Da;F||D(),H||(F(),H=!0),O.add(I,y),y.A=0}}function Ka(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=ms(f(y.Da,y),Ad(y,y.A)),y.A++,!0)}t.Da=function(){if(this.v=null,Cd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=ms(f(this.Wa,this),y)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Lt(10),Oi(this),Cd(this))};function Oc(y){y.B!=null&&(l.clearTimeout(y.B),y.B=null)}function Cd(y){y.g=new Qr(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var I=dn(y.na);Rt(I,"RID","rpc"),Rt(I,"SID",y.M),Rt(I,"AID",y.K),Rt(I,"CI",y.F?"0":"1"),!y.F&&y.ia&&Rt(I,"TO",y.ia),Rt(I,"TYPE","xmlhttp"),Wa(y,I),y.u&&y.o&&Ga(I,y.u,y.o),y.O&&(y.g.H=y.O);var V=y.g;y=y.ba,V.M=1,V.A=Va(dn(I)),V.u=null,V.R=!0,Uo(V,y)}t.Va=function(){this.C!=null&&(this.C=null,Oi(this),Ka(this),Lt(19))};function Ko(y){y.C!=null&&(l.clearTimeout(y.C),y.C=null)}function Td(y,I){var V=null;if(y.g==I){Ko(y),Oc(y),y.g=null;var Y=2}else if(xs(y.h,I))V=I.G,wc(y.h,I),Y=1;else return;if(y.I!=0){if(I.o)if(Y==1){V=I.u?I.u.length:0,I=Date.now()-I.F;var he=y.D;Y=Ci(),we(Y,new er(Y,V)),Ts(y)}else Ed(y);else if(he=I.m,he==3||he==0&&I.X>0||!(Y==1&&Wo(y,I)||Y==2&&Ka(y)))switch(V&&V.length>0&&(I=y.h,I.i=I.i.concat(V)),he){case 1:As(y,5);break;case 4:As(y,10);break;case 3:As(y,6);break;default:As(y,2)}}}function Ad(y,I){let V=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(V*=2),V*I}function As(y,I){if(y.j.info("Error code "+I),I==2){var V=f(y.bb,y),Y=y.Ua;const he=!Y;Y=new yr(Y||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Rn(Y,"https"),Va(Y),he?Kr(Y.toString(),V):jc(Y.toString(),V)}else Lt(2);y.I=0,y.l&&y.l.pa(I),jd(y),Qo(y)}t.bb=function(y){y?(this.j.info("Successfully pinged google.com"),Lt(2)):(this.j.info("Failed to ping google.com"),Lt(1))};function jd(y){if(y.I=0,y.ja=[],y.l){const I=Sc(y.h);(I.length!=0||y.i.length!=0)&&(S(y.ja,I),S(y.ja,y.i),y.h.i.length=0,b(y.i),y.i.length=0),y.l.oa()}}function Rd(y,I,V){var Y=V instanceof yr?dn(V):new yr(V);if(Y.g!="")I&&(Y.g=I+"."+Y.g),Ti(Y,Y.u);else{var he=l.location;Y=he.protocol,I=I?I+"."+he.hostname:he.hostname,he=+he.port;const _e=new yr(null);Y&&Rn(_e,Y),I&&(_e.g=I),he&&Ti(_e,he),V&&(_e.h=V),Y=_e}return V=y.G,I=y.wa,V&&I&&Rt(Y,V,I),Rt(Y,"VER",y.ka),Wa(y,Y),Y}function Id(y,I,V){if(I&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return I=y.Aa&&!y.ma?new kt(new Ss({ab:V})):new kt(y.ma),I.Fa(y.L),I}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Dd(){}t=Dd.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Mi(){}Mi.prototype.g=function(y,I){return new tr(y,I)};function tr(y,I){ie.call(this),this.g=new ki(I),this.l=y,this.h=I&&I.messageUrlParams||null,y=I&&I.messageHeaders||null,I&&I.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=I&&I.initMessageHeaders||null,I&&I.messageContentType&&(y?y["X-WebChannel-Content-Type"]=I.messageContentType:y={"X-WebChannel-Content-Type":I.messageContentType}),I&&I.sa&&(y?y["X-WebChannel-Client-Profile"]=I.sa:y={"X-WebChannel-Client-Profile":I.sa}),this.g.U=y,(y=I&&I.Qb)&&!M(y)&&(this.g.u=y),this.A=I&&I.supportsCrossDomainXhr||!1,this.v=I&&I.sendRawJson||!1,(I=I&&I.httpSessionIdParam)&&!M(I)&&(this.g.G=I,y=this.h,y!==null&&I in y&&(y=this.h,I in y&&delete y[I])),this.j=new Ws(this)}g(tr,ie),tr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tr.prototype.close=function(){Dc(this.g)},tr.prototype.o=function(y){var I=this.g;if(typeof y=="string"){var V={};V.__data__=y,y=V}else this.v&&(V={},V.__data__=st(y),y=V);I.i.push(new un(I.Ya++,y)),I.I==3&&Ts(I)},tr.prototype.N=function(){this.g.l=null,delete this.j,Dc(this.g),delete this.g,tr.Z.N.call(this)};function kd(y){Jt.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var I=y.__sm__;if(I){e:{for(const V in I){y=V;break e}y=void 0}(this.i=y)&&(y=this.i,I=I!==null&&y in I?I[y]:void 0),this.data=I}else this.data=y}g(kd,Jt);function Od(){Qn.call(this),this.status=1}g(Od,Qn);function Ws(y){this.g=y}g(Ws,Dd),Ws.prototype.ra=function(){we(this.g,"a")},Ws.prototype.qa=function(y){we(this.g,new kd(y))},Ws.prototype.pa=function(y){we(this.g,new Od)},Ws.prototype.oa=function(){we(this.g,"b")},Mi.prototype.createWebChannel=Mi.prototype.g,tr.prototype.send=tr.prototype.o,tr.prototype.open=tr.prototype.m,tr.prototype.close=tr.prototype.close,UE=function(){return new Mi},LE=function(){return Ci()},BE=Et,yy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ua.NO_ERROR=0,Ua.TIMEOUT=8,Ua.HTTP_ERROR=6,ef=Ua,yc.COMPLETE="complete",zE=yc,hs.EventType=bt,bt.OPEN="a",bt.CLOSE="b",bt.ERROR="c",bt.MESSAGE="d",ie.prototype.listen=ie.prototype.J,xu=hs,kt.prototype.listenOnce=kt.prototype.K,kt.prototype.getLastError=kt.prototype.Ha,kt.prototype.getLastErrorCode=kt.prototype.ya,kt.prototype.getStatus=kt.prototype.ca,kt.prototype.getResponseJson=kt.prototype.La,kt.prototype.getResponseText=kt.prototype.la,kt.prototype.send=kt.prototype.ea,kt.prototype.setWithCredentials=kt.prototype.Fa,PE=kt}).apply(typeof Fh<"u"?Fh:typeof self<"u"?self:typeof window<"u"?window:{});const Nw="@firebase/firestore",Pw="4.9.3";class Yn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Yn.UNAUTHENTICATED=new Yn(null),Yn.GOOGLE_CREDENTIALS=new Yn("google-credentials-uid"),Yn.FIRST_PARTY=new Yn("first-party-uid"),Yn.MOCK_USER=new Yn("mock-user");let cc="12.7.0";const To=new Xy("@firebase/firestore");function Il(){return To.logLevel}function Le(t,...e){if(To.logLevel<=mt.DEBUG){const n=e.map(l0);To.debug(`Firestore (${cc}): ${t}`,...n)}}function bi(t,...e){if(To.logLevel<=mt.ERROR){const n=e.map(l0);To.error(`Firestore (${cc}): ${t}`,...n)}}function $l(t,...e){if(To.logLevel<=mt.WARN){const n=e.map(l0);To.warn(`Firestore (${cc}): ${t}`,...n)}}function l0(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Xe(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,FE(t,r,n)}function FE(t,e,n){let r=`FIRESTORE (${cc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw bi(r),new Error(r)}function jt(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||FE(e,i,r)}function rt(t,e){return t}const Re={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Be extends Si{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class mi{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class VE{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class EO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Yn.UNAUTHENTICATED)))}shutdown(){}}class CO{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class TO{constructor(e){this.t=e,this.currentUser=Yn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){jt(this.o===void 0,42304);let r=this.i;const i=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new mi;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new mi,e.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await i(this.currentUser)}))},u=h=>{Le("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(Le("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new mi)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Le("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(jt(typeof r.accessToken=="string",31837,{l:r}),new VE(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return jt(e===null||typeof e=="string",2055,{h:e}),new Yn(e)}}class AO{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Yn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class jO{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new AO(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Yn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class zw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class RO{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,rs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){jt(this.o===void 0,3512);const r=o=>{o.error!=null&&Le("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Le("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const i=o=>{Le("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>i(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):Le("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new zw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(jt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new zw(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function IO(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class c0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=IO(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%62))}return r}}function pt(t,e){return t<e?-1:t>e?1:0}function _y(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),o=e.charAt(r);if(i!==o)return Fg(i)===Fg(o)?pt(i,o):Fg(i)?1:-1}return pt(t.length,e.length)}const DO=55296,kO=57343;function Fg(t){const e=t.charCodeAt(0);return e>=DO&&e<=kO}function ql(t,e,n){return t.length===e.length&&t.every(((r,i)=>n(r,e[i])))}const Bw="__name__";class Ms{constructor(e,n,r){n===void 0?n=0:n>e.length&&Xe(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Xe(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Ms.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Ms?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=Ms.compareSegments(e.get(i),n.get(i));if(o!==0)return o}return pt(e.length,n.length)}static compareSegments(e,n){const r=Ms.isNumericId(e),i=Ms.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?Ms.extractNumericId(e).compare(Ms.extractNumericId(n)):_y(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ba.fromString(e.substring(4,e.length-2))}}class Ut extends Ms{construct(e,n,r){return new Ut(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Be(Re.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((i=>i.length>0)))}return new Ut(n)}static emptyPath(){return new Ut([])}}const OO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Un extends Ms{construct(e,n,r){return new Un(e,n,r)}static isValidIdentifier(e){return OO.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Un.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Bw}static keyField(){return new Un([Bw])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new Be(Re.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;i<e.length;){const u=e[i];if(u==="\\"){if(i+1===e.length)throw new Be(Re.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Be(Re.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else u==="`"?(l=!l,i++):u!=="."||l?(r+=u,i++):(o(),i++)}if(o(),l)throw new Be(Re.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Un(n)}static emptyPath(){return new Un([])}}class We{constructor(e){this.path=e}static fromPath(e){return new We(Ut.fromString(e))}static fromName(e){return new We(Ut.fromString(e).popFirst(5))}static empty(){return new We(Ut.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ut.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ut.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new We(new Ut(e.slice()))}}function $E(t,e,n){if(!n)throw new Be(Re.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function MO(t,e,n,r){if(e===!0&&r===!0)throw new Be(Re.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Lw(t){if(!We.isDocumentKey(t))throw new Be(Re.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Uw(t){if(We.isDocumentKey(t))throw new Be(Re.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function qE(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Kf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Xe(12329,{type:typeof t})}function ls(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Be(Re.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Kf(t);throw new Be(Re.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function _n(t,e){const n={typeString:t};return e&&(n.value=e),n}function nd(t,e){if(!qE(t))throw new Be(Re.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(i&&typeof l!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Be(Re.INVALID_ARGUMENT,n);return!0}const Fw=-62135596800,Vw=1e6;class qt{static now(){return qt.fromMillis(Date.now())}static fromDate(e){return qt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Vw);return new qt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Be(Re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Be(Re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Fw)throw new Be(Re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Be(Re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Vw}_compareTo(e){return this.seconds===e.seconds?pt(this.nanoseconds,e.nanoseconds):pt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:qt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(nd(e,qt._jsonSchema))return new qt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Fw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}qt._jsonSchemaVersion="firestore/timestamp/1.0",qt._jsonSchema={type:_n("string",qt._jsonSchemaVersion),seconds:_n("number"),nanoseconds:_n("number")};class et{static fromTimestamp(e){return new et(e)}static min(){return new et(new qt(0,0))}static max(){return new et(new qt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Pu=-1;function NO(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=et.fromTimestamp(r===1e9?new qt(n+1,0):new qt(n,r));return new xa(i,We.empty(),e)}function PO(t){return new xa(t.readTime,t.key,Pu)}class xa{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new xa(et.min(),We.empty(),Pu)}static max(){return new xa(et.max(),We.empty(),Pu)}}function zO(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=We.comparator(t.documentKey,e.documentKey),n!==0?n:pt(t.largestBatchId,e.largestBatchId))}const BO="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class LO{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function uc(t){if(t.code!==Re.FAILED_PRECONDITION||t.message!==BO)throw t;Le("LocalStore","Unexpectedly lost primary lease")}class De{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Xe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new De(((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof De?n:De.resolve(n)}catch(n){return De.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):De.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):De.reject(n)}static resolve(e){return new De(((n,r)=>{n(e)}))}static reject(e){return new De(((n,r)=>{r(e)}))}static waitFor(e){return new De(((n,r)=>{let i=0,o=0,l=!1;e.forEach((u=>{++i,u.next((()=>{++o,l&&o===i&&n()}),(h=>r(h)))})),l=!0,o===i&&n()}))}static or(e){let n=De.resolve(!1);for(const r of e)n=n.next((i=>i?De.resolve(i):r()));return n}static forEach(e,n){const r=[];return e.forEach(((i,o)=>{r.push(n.call(this,i,o))})),this.waitFor(r)}static mapArray(e,n){return new De(((r,i)=>{const o=e.length,l=new Array(o);let u=0;for(let h=0;h<o;h++){const f=h;n(e[f]).next((p=>{l[f]=p,++u,u===o&&r(l)}),(p=>i(p)))}}))}static doWhile(e,n){return new De(((r,i)=>{const o=()=>{e()===!0?n().next((()=>{o()}),i):r()};o()}))}}function UO(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function dc(t){return t.name==="IndexedDbTransactionError"}class Yf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Yf.ce=-1;const u0=-1;function Xf(t){return t==null}function _f(t){return t===0&&1/t==-1/0}function FO(t){return typeof t=="number"&&Number.isInteger(t)&&!_f(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const GE="";function VO(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=$w(e)),e=$O(t.get(n),e);return $w(e)}function $O(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case GE:n+="";break;default:n+=o}}return n}function $w(t){return t+GE+""}function qw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ka(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function HE(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Zt{constructor(e,n){this.comparator=e,this.root=n||Ln.EMPTY}insert(e,n){return new Zt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Ln.BLACK,null,null))}remove(e){return new Zt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ln.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Vh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Vh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Vh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Vh(this.root,e,this.comparator,!0)}}class Vh{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ln{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Ln.RED,this.left=i??Ln.EMPTY,this.right=o??Ln.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new Ln(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ln.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Ln.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ln.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ln.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Xe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Xe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Xe(27949);return e+(this.isRed()?0:1)}}Ln.EMPTY=null,Ln.RED=!0,Ln.BLACK=!1;Ln.EMPTY=new class{constructor(){this.size=0}get key(){throw Xe(57766)}get value(){throw Xe(16141)}get color(){throw Xe(16727)}get left(){throw Xe(29726)}get right(){throw Xe(36894)}copy(e,n,r,i,o){return this}insert(e,n,r){return new Ln(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Tn{constructor(e){this.comparator=e,this.data=new Zt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Gw(this.data.getIterator())}getIteratorFrom(e){return new Gw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof Tn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new Tn(this.comparator);return n.data=e,n}}class Gw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Cr{constructor(e){this.fields=e,e.sort(Un.comparator)}static empty(){return new Cr([])}unionWith(e){let n=new Tn(Un.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Cr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ql(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class QE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class $n{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new QE("Invalid base64 string: "+o):o}})(e);return new $n(n)}static fromUint8Array(e){const n=(function(i){let o="";for(let l=0;l<i.length;++l)o+=String.fromCharCode(i[l]);return o})(e);return new $n(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return pt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$n.EMPTY_BYTE_STRING=new $n("");const qO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function wa(t){if(jt(!!t,39018),typeof t=="string"){let e=0;const n=qO.exec(t);if(jt(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:on(t.seconds),nanos:on(t.nanos)}}function on(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Sa(t){return typeof t=="string"?$n.fromBase64String(t):$n.fromUint8Array(t)}const WE="server_timestamp",KE="__type__",YE="__previous_value__",XE="__local_write_time__";function d0(t){return(t?.mapValue?.fields||{})[KE]?.stringValue===WE}function Zf(t){const e=t.mapValue.fields[YE];return d0(e)?Zf(e):e}function zu(t){const e=wa(t.mapValue.fields[XE].timestampValue);return new qt(e.seconds,e.nanos)}class GO{constructor(e,n,r,i,o,l,u,h,f,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=p}}const bf="(default)";class Bu{constructor(e,n){this.projectId=e,this.database=n||bf}static empty(){return new Bu("","")}get isDefaultDatabase(){return this.database===bf}isEqual(e){return e instanceof Bu&&e.projectId===this.projectId&&e.database===this.database}}const ZE="__type__",HO="__max__",$h={mapValue:{}},JE="__vector__",vf="value";function Ea(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?d0(t)?4:WO(t)?9007199254740991:QO(t)?10:11:Xe(28295,{value:t})}function Vs(t,e){if(t===e)return!0;const n=Ea(t);if(n!==Ea(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return zu(t).isEqual(zu(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const l=wa(i.timestampValue),u=wa(o.timestampValue);return l.seconds===u.seconds&&l.nanos===u.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(i,o){return Sa(i.bytesValue).isEqual(Sa(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(i,o){return on(i.geoPointValue.latitude)===on(o.geoPointValue.latitude)&&on(i.geoPointValue.longitude)===on(o.geoPointValue.longitude)})(t,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return on(i.integerValue)===on(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const l=on(i.doubleValue),u=on(o.doubleValue);return l===u?_f(l)===_f(u):isNaN(l)&&isNaN(u)}return!1})(t,e);case 9:return ql(t.arrayValue.values||[],e.arrayValue.values||[],Vs);case 10:case 11:return(function(i,o){const l=i.mapValue.fields||{},u=o.mapValue.fields||{};if(qw(l)!==qw(u))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(u[h]===void 0||!Vs(l[h],u[h])))return!1;return!0})(t,e);default:return Xe(52216,{left:t})}}function Lu(t,e){return(t.values||[]).find((n=>Vs(n,e)))!==void 0}function Gl(t,e){if(t===e)return 0;const n=Ea(t),r=Ea(e);if(n!==r)return pt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return pt(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const u=on(o.integerValue||o.doubleValue),h=on(l.integerValue||l.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(t,e);case 3:return Hw(t.timestampValue,e.timestampValue);case 4:return Hw(zu(t),zu(e));case 5:return _y(t.stringValue,e.stringValue);case 6:return(function(o,l){const u=Sa(o),h=Sa(l);return u.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const u=o.split("/"),h=l.split("/");for(let f=0;f<u.length&&f<h.length;f++){const p=pt(u[f],h[f]);if(p!==0)return p}return pt(u.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const u=pt(on(o.latitude),on(l.latitude));return u!==0?u:pt(on(o.longitude),on(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return Qw(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const u=o.fields||{},h=l.fields||{},f=u[vf]?.arrayValue,p=h[vf]?.arrayValue,g=pt(f?.values?.length||0,p?.values?.length||0);return g!==0?g:Qw(f,p)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===$h.mapValue&&l===$h.mapValue)return 0;if(o===$h.mapValue)return 1;if(l===$h.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),f=l.fields||{},p=Object.keys(f);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const _=_y(h[g],p[g]);if(_!==0)return _;const b=Gl(u[h[g]],f[p[g]]);if(b!==0)return b}return pt(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Xe(23264,{he:n})}}function Hw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return pt(t,e);const n=wa(t),r=wa(e),i=pt(n.seconds,r.seconds);return i!==0?i:pt(n.nanos,r.nanos)}function Qw(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=Gl(n[i],r[i]);if(o)return o}return pt(n.length,r.length)}function Hl(t){return by(t)}function by(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=wa(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return Sa(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return We.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=by(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const l of r)o?o=!1:i+=",",i+=`${l}:${by(n.fields[l])}`;return i+"}"})(t.mapValue):Xe(61005,{value:t})}function tf(t){switch(Ea(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Zf(t);return e?16+tf(e):16;case 5:return 2*t.stringValue.length;case 6:return Sa(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,o)=>i+tf(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let i=0;return ka(r.fields,((o,l)=>{i+=o.length+tf(l)})),i})(t.mapValue);default:throw Xe(13486,{value:t})}}function Ww(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function vy(t){return!!t&&"integerValue"in t}function h0(t){return!!t&&"arrayValue"in t}function Kw(t){return!!t&&"nullValue"in t}function Yw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function nf(t){return!!t&&"mapValue"in t}function QO(t){return(t?.mapValue?.fields||{})[ZE]?.stringValue===JE}function Au(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return ka(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Au(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Au(t.arrayValue.values[n]);return e}return{...t}}function WO(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===HO}class fr{constructor(e){this.value=e}static empty(){return new fr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!nf(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Au(n)}setAll(e){let n=Un.emptyPath(),r={},i=[];e.forEach(((l,u)=>{if(!n.isImmediateParentOf(u)){const h=this.getFieldsMap(n);this.applyChanges(h,r,i),r={},i=[],n=u.popLast()}l?r[u.lastSegment()]=Au(l):i.push(u.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());nf(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Vs(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];nf(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){ka(n,((i,o)=>e[i]=o));for(const i of r)delete e[i]}clone(){return new fr(Au(this.value))}}function eC(t){const e=[];return ka(t.fields,((n,r)=>{const i=new Un([n]);if(nf(r)){const o=eC(r.mapValue).fields;if(o.length===0)e.push(i);else for(const l of o)e.push(i.child(l))}else e.push(i)})),new Cr(e)}class Xn{constructor(e,n,r,i,o,l,u){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=l,this.documentState=u}static newInvalidDocument(e){return new Xn(e,0,et.min(),et.min(),et.min(),fr.empty(),0)}static newFoundDocument(e,n,r,i){return new Xn(e,1,n,et.min(),r,i,0)}static newNoDocument(e,n){return new Xn(e,2,n,et.min(),et.min(),fr.empty(),0)}static newUnknownDocument(e,n){return new Xn(e,3,n,et.min(),et.min(),fr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(et.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=fr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=fr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=et.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Xn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Xn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class xf{constructor(e,n){this.position=e,this.inclusive=n}}function Xw(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],l=t.position[i];if(o.field.isKeyField()?r=We.comparator(We.fromName(l.referenceValue),n.key):r=Gl(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Zw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Vs(t.position[n],e.position[n]))return!1;return!0}class wf{constructor(e,n="asc"){this.field=e,this.dir=n}}function KO(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class tC{}class yn extends tC{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new XO(e,n,r):n==="array-contains"?new eM(e,r):n==="in"?new tM(e,r):n==="not-in"?new nM(e,r):n==="array-contains-any"?new rM(e,r):new yn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new ZO(e,r):new JO(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Gl(n,this.value)):n!==null&&Ea(this.value)===Ea(n)&&this.matchesComparison(Gl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Xe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class cs extends tC{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new cs(e,n)}matches(e){return nC(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function nC(t){return t.op==="and"}function rC(t){return YO(t)&&nC(t)}function YO(t){for(const e of t.filters)if(e instanceof cs)return!1;return!0}function xy(t){if(t instanceof yn)return t.field.canonicalString()+t.op.toString()+Hl(t.value);if(rC(t))return t.filters.map((e=>xy(e))).join(",");{const e=t.filters.map((n=>xy(n))).join(",");return`${t.op}(${e})`}}function sC(t,e){return t instanceof yn?(function(r,i){return i instanceof yn&&r.op===i.op&&r.field.isEqual(i.field)&&Vs(r.value,i.value)})(t,e):t instanceof cs?(function(r,i){return i instanceof cs&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((o,l,u)=>o&&sC(l,i.filters[u])),!0):!1})(t,e):void Xe(19439)}function iC(t){return t instanceof yn?(function(n){return`${n.field.canonicalString()} ${n.op} ${Hl(n.value)}`})(t):t instanceof cs?(function(n){return n.op.toString()+" {"+n.getFilters().map(iC).join(" ,")+"}"})(t):"Filter"}class XO extends yn{constructor(e,n,r){super(e,n,r),this.key=We.fromName(r.referenceValue)}matches(e){const n=We.comparator(e.key,this.key);return this.matchesComparison(n)}}class ZO extends yn{constructor(e,n){super(e,"in",n),this.keys=aC("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class JO extends yn{constructor(e,n){super(e,"not-in",n),this.keys=aC("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function aC(t,e){return(e.arrayValue?.values||[]).map((n=>We.fromName(n.referenceValue)))}class eM extends yn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return h0(n)&&Lu(n.arrayValue,this.value)}}class tM extends yn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Lu(this.value.arrayValue,n)}}class nM extends yn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Lu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Lu(this.value.arrayValue,n)}}class rM extends yn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!h0(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Lu(this.value.arrayValue,r)))}}class sM{constructor(e,n=null,r=[],i=[],o=null,l=null,u=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=l,this.endAt=u,this.Te=null}}function Jw(t,e=null,n=[],r=[],i=null,o=null,l=null){return new sM(t,e,n,r,i,o,l)}function f0(t){const e=rt(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>xy(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Xf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>Hl(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>Hl(r))).join(",")),e.Te=n}return e.Te}function m0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!KO(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!sC(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Zw(t.startAt,e.startAt)&&Zw(t.endAt,e.endAt)}function wy(t){return We.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class rd{constructor(e,n=null,r=[],i=[],o=null,l="F",u=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=l,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function iM(t,e,n,r,i,o,l,u){return new rd(t,e,n,r,i,o,l,u)}function p0(t){return new rd(t)}function e1(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function oC(t){return t.collectionGroup!==null}function ju(t){const e=rt(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let u=new Tn(Un.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(u=u.add(f.field))}))})),u})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new wf(o,r))})),n.has(Un.keyField().canonicalString())||e.Ie.push(new wf(Un.keyField(),r))}return e.Ie}function Bs(t){const e=rt(t);return e.Ee||(e.Ee=aM(e,ju(t))),e.Ee}function aM(t,e){if(t.limitType==="F")return Jw(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((i=>{const o=i.dir==="desc"?"asc":"desc";return new wf(i.field,o)}));const n=t.endAt?new xf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new xf(t.startAt.position,t.startAt.inclusive):null;return Jw(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Sy(t,e){const n=t.filters.concat([e]);return new rd(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Ey(t,e,n){return new rd(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Jf(t,e){return m0(Bs(t),Bs(e))&&t.limitType===e.limitType}function lC(t){return`${f0(Bs(t))}|lt:${t.limitType}`}function Dl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((i=>iC(i))).join(", ")}]`),Xf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((i=>Hl(i))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((i=>Hl(i))).join(",")),`Target(${r})`})(Bs(t))}; limitType=${t.limitType})`}function em(t,e){return e.isFoundDocument()&&(function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):We.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,i){for(const o of ju(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0})(t,e)&&(function(r,i){return!(r.startAt&&!(function(l,u,h){const f=Xw(l,u,h);return l.inclusive?f<=0:f<0})(r.startAt,ju(r),i)||r.endAt&&!(function(l,u,h){const f=Xw(l,u,h);return l.inclusive?f>=0:f>0})(r.endAt,ju(r),i))})(t,e)}function oM(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function cC(t){return(e,n)=>{let r=!1;for(const i of ju(t)){const o=lM(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function lM(t,e,n){const r=t.field.isKeyField()?We.comparator(e.key,n.key):(function(o,l,u){const h=l.data.field(o),f=u.data.field(o);return h!==null&&f!==null?Gl(h,f):Xe(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Xe(19790,{direction:t.dir})}}class Do{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ka(this.inner,((n,r)=>{for(const[i,o]of r)e(i,o)}))}isEmpty(){return HE(this.inner)}size(){return this.innerSize}}const cM=new Zt(We.comparator);function vi(){return cM}const uC=new Zt(We.comparator);function wu(...t){let e=uC;for(const n of t)e=e.insert(n.key,n);return e}function dC(t){let e=uC;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function _o(){return Ru()}function hC(){return Ru()}function Ru(){return new Do((t=>t.toString()),((t,e)=>t.isEqual(e)))}const uM=new Zt(We.comparator),dM=new Tn(We.comparator);function gt(...t){let e=dM;for(const n of t)e=e.add(n);return e}const hM=new Tn(pt);function fM(){return hM}function g0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_f(e)?"-0":e}}function fC(t){return{integerValue:""+t}}function mM(t,e){return FO(e)?fC(e):g0(t,e)}class tm{constructor(){this._=void 0}}function pM(t,e,n){return t instanceof Sf?(function(i,o){const l={fields:{[KE]:{stringValue:WE},[XE]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&d0(o)&&(o=Zf(o)),o&&(l.fields[YE]=o),{mapValue:l}})(n,e):t instanceof Ql?pC(t,e):t instanceof Wl?gC(t,e):(function(i,o){const l=mC(i,o),u=t1(l)+t1(i.Ae);return vy(l)&&vy(i.Ae)?fC(u):g0(i.serializer,u)})(t,e)}function gM(t,e,n){return t instanceof Ql?pC(t,e):t instanceof Wl?gC(t,e):n}function mC(t,e){return t instanceof Ef?(function(r){return vy(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class Sf extends tm{}class Ql extends tm{constructor(e){super(),this.elements=e}}function pC(t,e){const n=yC(e);for(const r of t.elements)n.some((i=>Vs(i,r)))||n.push(r);return{arrayValue:{values:n}}}class Wl extends tm{constructor(e){super(),this.elements=e}}function gC(t,e){let n=yC(e);for(const r of t.elements)n=n.filter((i=>!Vs(i,r)));return{arrayValue:{values:n}}}class Ef extends tm{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function t1(t){return on(t.integerValue||t.doubleValue)}function yC(t){return h0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class _C{constructor(e,n){this.field=e,this.transform=n}}function yM(t,e){return t.field.isEqual(e.field)&&(function(r,i){return r instanceof Ql&&i instanceof Ql||r instanceof Wl&&i instanceof Wl?ql(r.elements,i.elements,Vs):r instanceof Ef&&i instanceof Ef?Vs(r.Ae,i.Ae):r instanceof Sf&&i instanceof Sf})(t.transform,e.transform)}class _M{constructor(e,n){this.version=e,this.transformResults=n}}class mr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new mr}static exists(e){return new mr(void 0,e)}static updateTime(e){return new mr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rf(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class nm{}function bC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new rm(t.key,mr.none()):new sd(t.key,t.data,mr.none());{const n=t.data,r=fr.empty();let i=new Tn(Un.comparator);for(let o of e.fields)if(!i.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),i=i.add(o)}return new Oa(t.key,r,new Cr(i.toArray()),mr.none())}}function bM(t,e,n){t instanceof sd?(function(i,o,l){const u=i.value.clone(),h=r1(i.fieldTransforms,o,l.transformResults);u.setAll(h),o.convertToFoundDocument(l.version,u).setHasCommittedMutations()})(t,e,n):t instanceof Oa?(function(i,o,l){if(!rf(i.precondition,o))return void o.convertToUnknownDocument(l.version);const u=r1(i.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(vC(i)),h.setAll(u),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(i,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function Iu(t,e,n,r){return t instanceof sd?(function(o,l,u,h){if(!rf(o.precondition,l))return u;const f=o.value.clone(),p=s1(o.fieldTransforms,h,l);return f.setAll(p),l.convertToFoundDocument(l.version,f).setHasLocalMutations(),null})(t,e,n,r):t instanceof Oa?(function(o,l,u,h){if(!rf(o.precondition,l))return u;const f=s1(o.fieldTransforms,h,l),p=l.data;return p.setAll(vC(o)),p.setAll(f),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,l,u){return rf(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):u})(t,e,n)}function vM(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=mC(r.transform,i||null);o!=null&&(n===null&&(n=fr.empty()),n.set(r.field,o))}return n||null}function n1(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ql(r,i,((o,l)=>yM(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class sd extends nm{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Oa extends nm{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function vC(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function r1(t,e,n){const r=new Map;jt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const o=t[i],l=o.transform,u=e.data.field(o.field);r.set(o.field,gM(l,u,n[i]))}return r}function s1(t,e,n){const r=new Map;for(const i of t){const o=i.transform,l=n.data.field(i.field);r.set(i.field,pM(o,l,e))}return r}class rm extends nm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class xM extends nm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class wM{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&bM(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Iu(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Iu(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=hC();return this.mutations.forEach((i=>{const o=e.get(i.key),l=o.overlayedDocument;let u=this.applyToLocalView(l,o.mutatedFields);u=n.has(i.key)?null:u;const h=bC(l,u);h!==null&&r.set(i.key,h),l.isValidDocument()||l.convertToNoDocument(et.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),gt())}isEqual(e){return this.batchId===e.batchId&&ql(this.mutations,e.mutations,((n,r)=>n1(n,r)))&&ql(this.baseMutations,e.baseMutations,((n,r)=>n1(n,r)))}}class y0{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){jt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return uM})();const o=e.mutations;for(let l=0;l<o.length;l++)i=i.insert(o[l].key,r[l].version);return new y0(e,n,r,i)}}class SM{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class EM{constructor(e,n){this.count=e,this.unchangedNames=n}}var gn,_t;function CM(t){switch(t){case Re.OK:return Xe(64938);case Re.CANCELLED:case Re.UNKNOWN:case Re.DEADLINE_EXCEEDED:case Re.RESOURCE_EXHAUSTED:case Re.INTERNAL:case Re.UNAVAILABLE:case Re.UNAUTHENTICATED:return!1;case Re.INVALID_ARGUMENT:case Re.NOT_FOUND:case Re.ALREADY_EXISTS:case Re.PERMISSION_DENIED:case Re.FAILED_PRECONDITION:case Re.ABORTED:case Re.OUT_OF_RANGE:case Re.UNIMPLEMENTED:case Re.DATA_LOSS:return!0;default:return Xe(15467,{code:t})}}function xC(t){if(t===void 0)return bi("GRPC error has no .code"),Re.UNKNOWN;switch(t){case gn.OK:return Re.OK;case gn.CANCELLED:return Re.CANCELLED;case gn.UNKNOWN:return Re.UNKNOWN;case gn.DEADLINE_EXCEEDED:return Re.DEADLINE_EXCEEDED;case gn.RESOURCE_EXHAUSTED:return Re.RESOURCE_EXHAUSTED;case gn.INTERNAL:return Re.INTERNAL;case gn.UNAVAILABLE:return Re.UNAVAILABLE;case gn.UNAUTHENTICATED:return Re.UNAUTHENTICATED;case gn.INVALID_ARGUMENT:return Re.INVALID_ARGUMENT;case gn.NOT_FOUND:return Re.NOT_FOUND;case gn.ALREADY_EXISTS:return Re.ALREADY_EXISTS;case gn.PERMISSION_DENIED:return Re.PERMISSION_DENIED;case gn.FAILED_PRECONDITION:return Re.FAILED_PRECONDITION;case gn.ABORTED:return Re.ABORTED;case gn.OUT_OF_RANGE:return Re.OUT_OF_RANGE;case gn.UNIMPLEMENTED:return Re.UNIMPLEMENTED;case gn.DATA_LOSS:return Re.DATA_LOSS;default:return Xe(39323,{code:t})}}(_t=gn||(gn={}))[_t.OK=0]="OK",_t[_t.CANCELLED=1]="CANCELLED",_t[_t.UNKNOWN=2]="UNKNOWN",_t[_t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_t[_t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_t[_t.NOT_FOUND=5]="NOT_FOUND",_t[_t.ALREADY_EXISTS=6]="ALREADY_EXISTS",_t[_t.PERMISSION_DENIED=7]="PERMISSION_DENIED",_t[_t.UNAUTHENTICATED=16]="UNAUTHENTICATED",_t[_t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_t[_t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_t[_t.ABORTED=10]="ABORTED",_t[_t.OUT_OF_RANGE=11]="OUT_OF_RANGE",_t[_t.UNIMPLEMENTED=12]="UNIMPLEMENTED",_t[_t.INTERNAL=13]="INTERNAL",_t[_t.UNAVAILABLE=14]="UNAVAILABLE",_t[_t.DATA_LOSS=15]="DATA_LOSS";function TM(){return new TextEncoder}const AM=new ba([4294967295,4294967295],0);function i1(t){const e=TM().encode(t),n=new NE;return n.update(e),new Uint8Array(n.digest())}function a1(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new ba([n,r],0),new ba([i,o],0)]}class _0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Su(`Invalid padding: ${n}`);if(r<0)throw new Su(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Su(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Su(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=ba.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(ba.fromNumber(r)));return i.compare(AM)===1&&(i=new ba([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=i1(e),[r,i]=a1(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new _0(o,i,n);return r.forEach((u=>l.insert(u))),l}insert(e){if(this.ge===0)return;const n=i1(e),[r,i]=a1(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Su extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class sm{constructor(e,n,r,i,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,id.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new sm(et.min(),i,new Zt(pt),vi(),gt())}}class id{constructor(e,n,r,i,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new id(r,n,gt(),gt(),gt())}}class sf{constructor(e,n,r,i){this.be=e,this.removedTargetIds=n,this.key=r,this.De=i}}class wC{constructor(e,n){this.targetId=e,this.Ce=n}}class SC{constructor(e,n,r=$n.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class o1{constructor(){this.ve=0,this.Fe=l1(),this.Me=$n.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=gt(),n=gt(),r=gt();return this.Fe.forEach(((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Xe(38017,{changeType:o})}})),new id(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=l1()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,jt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class jM{constructor(e){this.Ge=e,this.ze=new Map,this.je=vi(),this.Je=qh(),this.He=qh(),this.Ye=new Zt(pt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Xe(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,i)=>{this.rt(i)&&n(i)}))}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const o=i.target;if(wy(o))if(r===0){const l=new We(o.path);this.et(n,l,Xn.newNoDocument(l,et.min()))}else jt(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const u=this.ut(e),h=u?this.ct(u,e,l):1;if(h!==0){this.it(n);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,f)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let l,u;try{l=Sa(r).toUint8Array()}catch(h){if(h instanceof QE)return $l("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new _0(l,i,o)}catch(h){return $l(h instanceof Su?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach((o=>{const l=this.Ge.ht(),u=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(n,o,null),i++)})),i}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const u=this.ot(l);if(u){if(o.current&&wy(u.target)){const h=new We(u.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Xn.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=gt();this.He.forEach(((o,l)=>{let u=!0;l.forEachWhile((h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const i=new sm(e,n,this.Ye,this.je,r);return this.je=vi(),this.Je=qh(),this.He=qh(),this.Ye=new Zt(pt),i}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.Qe(n,1):i.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new o1,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new Tn(pt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new Tn(pt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Le("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new o1),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function qh(){return new Zt(We.comparator)}function l1(){return new Zt(We.comparator)}const RM={asc:"ASCENDING",desc:"DESCENDING"},IM={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},DM={and:"AND",or:"OR"};class kM{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Cy(t,e){return t.useProto3Json||Xf(e)?e:{value:e}}function Cf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function EC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function OM(t,e){return Cf(t,e.toTimestamp())}function Ls(t){return jt(!!t,49232),et.fromTimestamp((function(n){const r=wa(n);return new qt(r.seconds,r.nanos)})(t))}function b0(t,e){return Ty(t,e).canonicalString()}function Ty(t,e){const n=(function(i){return new Ut(["projects",i.projectId,"databases",i.database])})(t).child("documents");return e===void 0?n:n.child(e)}function CC(t){const e=Ut.fromString(t);return jt(IC(e),10190,{key:e.toString()}),e}function Ay(t,e){return b0(t.databaseId,e.path)}function Vg(t,e){const n=CC(e);if(n.get(1)!==t.databaseId.projectId)throw new Be(Re.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Be(Re.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new We(AC(n))}function TC(t,e){return b0(t.databaseId,e)}function MM(t){const e=CC(t);return e.length===4?Ut.emptyPath():AC(e)}function jy(t){return new Ut(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function AC(t){return jt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function c1(t,e,n){return{name:Ay(t,e),fields:n.value.mapValue.fields}}function NM(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:Xe(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(f,p){return f.useProto3Json?(jt(p===void 0||typeof p=="string",58123),$n.fromBase64String(p||"")):(jt(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),$n.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,u=l&&(function(f){const p=f.code===void 0?Re.UNKNOWN:xC(f.code);return new Be(p,f.message||"")})(l);n=new SC(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Vg(t,r.document.name),o=Ls(r.document.updateTime),l=r.document.createTime?Ls(r.document.createTime):et.min(),u=new fr({mapValue:{fields:r.document.fields}}),h=Xn.newFoundDocument(i,o,l,u),f=r.targetIds||[],p=r.removedTargetIds||[];n=new sf(f,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Vg(t,r.document),o=r.readTime?Ls(r.readTime):et.min(),l=Xn.newNoDocument(i,o),u=r.removedTargetIds||[];n=new sf([],u,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Vg(t,r.document),o=r.removedTargetIds||[];n=new sf([],o,i,null)}else{if(!("filter"in e))return Xe(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,l=new EM(i,o),u=r.targetId;n=new wC(u,l)}}return n}function PM(t,e){let n;if(e instanceof sd)n={update:c1(t,e.key,e.value)};else if(e instanceof rm)n={delete:Ay(t,e.key)};else if(e instanceof Oa)n={update:c1(t,e.key,e.data),updateMask:GM(e.fieldMask)};else{if(!(e instanceof xM))return Xe(16599,{Vt:e.type});n={verify:Ay(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const u=l.transform;if(u instanceof Sf)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Ql)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Wl)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Ef)return{fieldPath:l.field.canonicalString(),increment:u.Ae};throw Xe(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:OM(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Xe(27497)})(t,e.precondition)),n}function zM(t,e){return t&&t.length>0?(jt(e!==void 0,14353),t.map((n=>(function(i,o){let l=i.updateTime?Ls(i.updateTime):Ls(o);return l.isEqual(et.min())&&(l=Ls(o)),new _M(l,i.transformResults||[])})(n,e)))):[]}function BM(t,e){return{documents:[TC(t,e.path)]}}function LM(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=TC(t,i);const o=(function(f){if(f.length!==0)return RC(cs.create(f,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(f){if(f.length!==0)return f.map((p=>(function(_){return{field:kl(_.field),direction:VM(_.dir)}})(p)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const u=Cy(t,e.limit);return u!==null&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:n,parent:i}}function UM(t){let e=MM(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){jt(r===1,65062);const p=n.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const _=jC(g);return _ instanceof cs&&rC(_)?_.getFilters():[_]})(n.where));let l=[];n.orderBy&&(l=(function(g){return g.map((_=>(function(S){return new wf(Ol(S.field),(function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(_)))})(n.orderBy));let u=null;n.limit&&(u=(function(g){let _;return _=typeof g=="object"?g.value:g,Xf(_)?null:_})(n.limit));let h=null;n.startAt&&(h=(function(g){const _=!!g.before,b=g.values||[];return new xf(b,_)})(n.startAt));let f=null;return n.endAt&&(f=(function(g){const _=!g.before,b=g.values||[];return new xf(b,_)})(n.endAt)),iM(e,i,l,o,u,"F",h,f)}function FM(t,e){const n=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Xe(28987,{purpose:i})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function jC(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Ol(n.unaryFilter.field);return yn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Ol(n.unaryFilter.field);return yn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Ol(n.unaryFilter.field);return yn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Ol(n.unaryFilter.field);return yn.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Xe(61313);default:return Xe(60726)}})(t):t.fieldFilter!==void 0?(function(n){return yn.create(Ol(n.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Xe(58110);default:return Xe(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return cs.create(n.compositeFilter.filters.map((r=>jC(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Xe(1026)}})(n.compositeFilter.op))})(t):Xe(30097,{filter:t})}function VM(t){return RM[t]}function $M(t){return IM[t]}function qM(t){return DM[t]}function kl(t){return{fieldPath:t.canonicalString()}}function Ol(t){return Un.fromServerFormat(t.fieldPath)}function RC(t){return t instanceof yn?(function(n){if(n.op==="=="){if(Yw(n.value))return{unaryFilter:{field:kl(n.field),op:"IS_NAN"}};if(Kw(n.value))return{unaryFilter:{field:kl(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Yw(n.value))return{unaryFilter:{field:kl(n.field),op:"IS_NOT_NAN"}};if(Kw(n.value))return{unaryFilter:{field:kl(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:kl(n.field),op:$M(n.op),value:n.value}}})(t):t instanceof cs?(function(n){const r=n.getFilters().map((i=>RC(i)));return r.length===1?r[0]:{compositeFilter:{op:qM(n.op),filters:r}}})(t):Xe(54877,{filter:t})}function GM(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function IC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class ua{constructor(e,n,r,i,o=et.min(),l=et.min(),u=$n.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new ua(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ua(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ua(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ua(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class HM{constructor(e){this.yt=e}}function QM(t){const e=UM({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Ey(e,e.limit,"L"):e}class WM{constructor(){this.Cn=new KM}addToCollectionParentIndex(e,n){return this.Cn.add(n),De.resolve()}getCollectionParents(e,n){return De.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return De.resolve()}deleteFieldIndex(e,n){return De.resolve()}deleteAllFieldIndexes(e){return De.resolve()}createTargetIndexes(e,n){return De.resolve()}getDocumentsMatchingTarget(e,n){return De.resolve(null)}getIndexType(e,n){return De.resolve(0)}getFieldIndexes(e,n){return De.resolve([])}getNextCollectionGroupToUpdate(e){return De.resolve(null)}getMinOffset(e,n){return De.resolve(xa.min())}getMinOffsetFromCollectionGroup(e,n){return De.resolve(xa.min())}updateCollectionGroup(e,n,r){return De.resolve()}updateIndexEntries(e,n){return De.resolve()}}class KM{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new Tn(Ut.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Tn(Ut.comparator)).toArray()}}const u1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},DC=41943040;class hr{static withCacheSize(e){return new hr(e,hr.DEFAULT_COLLECTION_PERCENTILE,hr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}hr.DEFAULT_COLLECTION_PERCENTILE=10,hr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hr.DEFAULT=new hr(DC,hr.DEFAULT_COLLECTION_PERCENTILE,hr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hr.DISABLED=new hr(-1,0,0);class Kl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Kl(0)}static cr(){return new Kl(-1)}}const d1="LruGarbageCollector",YM=1048576;function h1([t,e],[n,r]){const i=pt(t,n);return i===0?pt(e,r):i}class XM{constructor(e){this.Ir=e,this.buffer=new Tn(h1),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();h1(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class ZM{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Le(d1,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){dc(n)?Le(d1,"Ignoring IndexedDB error during garbage collection: ",n):await uc(n)}await this.Vr(3e5)}))}}class JM{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return De.resolve(Yf.ce);const r=new XM(n);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Le("LruGarbageCollector","Garbage collection skipped; disabled"),De.resolve(u1)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Le("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),u1):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,o,l,u,h,f;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Le("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,l=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,u=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(f=Date.now(),Il()<=mt.DEBUG&&Le("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-p}ms
	Determined least recently used ${i} in `+(u-l)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${g} documents in `+(f-h)+`ms
Total Duration: ${f-p}ms`),De.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:g}))))}}function eN(t,e){return new JM(t,e)}class tN{constructor(){this.changes=new Do((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Xn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?De.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class nN{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class rN{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,n)))).next((i=>(r!==null&&Iu(r.mutation,i,Cr.empty(),qt.now()),i)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,gt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=gt()){const i=_o();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,r).next((o=>{let l=wu();return o.forEach(((u,h)=>{l=l.insert(u,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=_o();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,gt())))}populateOverlays(e,n,r){const i=[];return r.forEach((o=>{n.has(o)||i.push(o)})),this.documentOverlayCache.getOverlays(e,i).next((o=>{o.forEach(((l,u)=>{n.set(l,u)}))}))}computeViews(e,n,r,i){let o=vi();const l=Ru(),u=(function(){return Ru()})();return n.forEach(((h,f)=>{const p=r.get(f.key);i.has(f.key)&&(p===void 0||p.mutation instanceof Oa)?o=o.insert(f.key,f):p!==void 0?(l.set(f.key,p.mutation.getFieldMask()),Iu(p.mutation,f,p.mutation.getFieldMask(),qt.now())):l.set(f.key,Cr.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((f,p)=>l.set(f,p))),n.forEach(((f,p)=>u.set(f,new nN(p,l.get(f)??null)))),u)))}recalculateAndSaveOverlays(e,n){const r=Ru();let i=new Zt(((l,u)=>l-u)),o=gt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const u of l)u.keys().forEach((h=>{const f=n.get(h);if(f===null)return;let p=r.get(h)||Cr.empty();p=u.applyToLocalView(f,p),r.set(h,p);const g=(i.get(u.batchId)||gt()).add(h);i=i.insert(u.batchId,g)}))})).next((()=>{const l=[],u=i.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),f=h.key,p=h.value,g=hC();p.forEach((_=>{if(!o.has(_)){const b=bC(n.get(_),r.get(_));b!==null&&g.set(_,b),o=o.add(_)}})),l.push(this.documentOverlayCache.saveOverlays(e,f,g))}return De.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,i){return(function(l){return We.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):oC(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next((o=>{const l=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):De.resolve(_o());let u=Pu,h=o;return l.next((f=>De.forEach(f,((p,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),o.get(p)?De.resolve():this.remoteDocumentCache.getEntry(e,p).next((_=>{h=h.insert(p,_)}))))).next((()=>this.populateOverlays(e,f,o))).next((()=>this.computeViews(e,h,f,gt()))).next((p=>({batchId:u,changes:dC(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new We(n)).next((r=>{let i=wu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let l=wu();return this.indexManager.getCollectionParents(e,o).next((u=>De.forEach(u,(h=>{const f=(function(g,_){return new rd(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next((p=>{p.forEach(((g,_)=>{l=l.insert(g,_)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i)))).next((l=>{o.forEach(((h,f)=>{const p=f.getKey();l.get(p)===null&&(l=l.insert(p,Xn.newInvalidDocument(p)))}));let u=wu();return l.forEach(((h,f)=>{const p=o.get(h);p!==void 0&&Iu(p.mutation,f,Cr.empty(),qt.now()),em(n,f)&&(u=u.insert(h,f))})),u}))}}class sN{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return De.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(i){return{id:i.id,version:i.version,createTime:Ls(i.createTime)}})(n)),De.resolve()}getNamedQuery(e,n){return De.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(i){return{name:i.name,query:QM(i.bundledQuery),readTime:Ls(i.readTime)}})(n)),De.resolve()}}class iN{constructor(){this.overlays=new Zt(We.comparator),this.qr=new Map}getOverlay(e,n){return De.resolve(this.overlays.get(n))}getOverlays(e,n){const r=_o();return De.forEach(n,(i=>this.getOverlay(e,i).next((o=>{o!==null&&r.set(i,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((i,o)=>{this.St(e,n,o)})),De.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),De.resolve()}getOverlaysForCollection(e,n,r){const i=_o(),o=n.length+1,l=new We(n.child("")),u=this.overlays.getIteratorFrom(l);for(;u.hasNext();){const h=u.getNext().value,f=h.getKey();if(!n.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return De.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new Zt(((f,p)=>f-p));const l=this.overlays.getIterator();for(;l.hasNext();){const f=l.getNext().value;if(f.getKey().getCollectionGroup()===n&&f.largestBatchId>r){let p=o.get(f.largestBatchId);p===null&&(p=_o(),o=o.insert(f.largestBatchId,p)),p.set(f.getKey(),f)}}const u=_o(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,p)=>u.set(f,p))),!(u.size()>=i)););return De.resolve(u)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const l=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new SM(n,r));let o=this.qr.get(n);o===void 0&&(o=gt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class aN{constructor(){this.sessionToken=$n.EMPTY_BYTE_STRING}getSessionToken(e){return De.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,De.resolve()}}class v0{constructor(){this.Qr=new Tn(Dn.$r),this.Ur=new Tn(Dn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Dn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new Dn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new We(new Ut([])),r=new Dn(n,e),i=new Dn(n,e+1),o=[];return this.Ur.forEachInRange([r,i],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new We(new Ut([])),r=new Dn(n,e),i=new Dn(n,e+1);let o=gt();return this.Ur.forEachInRange([r,i],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new Dn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Dn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return We.comparator(e.key,n.key)||pt(e.Yr,n.Yr)}static Kr(e,n){return pt(e.Yr,n.Yr)||We.comparator(e.key,n.key)}}class oN{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new Tn(Dn.$r)}checkEmpty(e){return De.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new wM(o,n,r,i);this.mutationQueue.push(l);for(const u of i)this.Zr=this.Zr.add(new Dn(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return De.resolve(l)}lookupMutationBatch(e,n){return De.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),o=i<0?0:i;return De.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return De.resolve(this.mutationQueue.length===0?u0:this.tr-1)}getAllMutationBatches(e){return De.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Dn(n,0),i=new Dn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],(l=>{const u=this.Xr(l.Yr);o.push(u)})),De.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Tn(pt);return n.forEach((i=>{const o=new Dn(i,0),l=new Dn(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(u=>{r=r.add(u.Yr)}))})),De.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;We.isDocumentKey(o)||(o=o.child(""));const l=new Dn(new We(o),0);let u=new Tn(pt);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(u=u.add(h.Yr)),!0)}),l),De.resolve(this.ti(u))}ti(e){const n=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&n.push(i)})),n}removeMutationBatch(e,n){jt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return De.forEach(n.mutations,(i=>{const o=new Dn(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new Dn(n,0),i=this.Zr.firstAfterOrEqual(r);return De.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,De.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class lN{constructor(e){this.ri=e,this.docs=(function(){return new Zt(We.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return De.resolve(r?r.document.mutableCopy():Xn.newInvalidDocument(n))}getEntries(e,n){let r=vi();return n.forEach((i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Xn.newInvalidDocument(i))})),De.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=vi();const l=n.path,u=new We(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:f,value:{document:p}}=h.getNext();if(!l.isPrefixOf(f.path))break;f.path.length>l.length+1||zO(PO(p),r)<=0||(i.has(p.key)||em(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return De.resolve(o)}getAllFromCollectionGroup(e,n,r,i){Xe(9500)}ii(e,n){return De.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new cN(this)}getSize(e){return De.resolve(this.size)}}class cN extends tN{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),De.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class uN{constructor(e){this.persistence=e,this.si=new Do((n=>f0(n)),m0),this.lastRemoteSnapshotVersion=et.min(),this.highestTargetId=0,this.oi=0,this._i=new v0,this.targetCount=0,this.ai=Kl.ur()}forEachTarget(e,n){return this.si.forEach(((r,i)=>n(i))),De.resolve()}getLastRemoteSnapshotVersion(e){return De.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return De.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),De.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),De.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Kl(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,De.resolve()}updateTargetData(e,n){return this.Pr(n),De.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,De.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.si.forEach(((l,u)=>{u.sequenceNumber<=n&&r.get(u.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)})),De.waitFor(o).next((()=>i))}getTargetCount(e){return De.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return De.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),De.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach((l=>{o.push(i.markPotentiallyOrphaned(e,l))})),De.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),De.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return De.resolve(r)}containsKey(e,n){return De.resolve(this._i.containsKey(n))}}class kC{constructor(e,n){this.ui={},this.overlays={},this.ci=new Yf(0),this.li=!1,this.li=!0,this.hi=new aN,this.referenceDelegate=e(this),this.Pi=new uN(this),this.indexManager=new WM,this.remoteDocumentCache=(function(i){return new lN(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new HM(n),this.Ii=new sN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new iN,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new oN(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Le("MemoryPersistence","Starting transaction:",e);const i=new dN(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((o=>this.referenceDelegate.di(i).next((()=>o)))).toPromise().then((o=>(i.raiseOnCommittedEvent(),o)))}Ai(e,n){return De.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class dN extends LO{constructor(e){super(),this.currentSequenceNumber=e}}class x0{constructor(e){this.persistence=e,this.Ri=new v0,this.Vi=null}static mi(e){return new x0(e)}get fi(){if(this.Vi)return this.Vi;throw Xe(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),De.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),De.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),De.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((i=>{i.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return De.forEach(this.fi,(r=>{const i=We.fromPath(r);return this.gi(e,i).next((o=>{o||n.removeEntry(i,et.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return De.or([()=>De.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Tf{constructor(e,n){this.persistence=e,this.pi=new Do((r=>VO(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=eN(this,n)}static mi(e,n){return new Tf(e,n)}Ei(){}di(e){return De.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((i=>r+i))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return De.forEach(this.pi,((r,i)=>this.br(e,r,i).next((o=>o?De.resolve():n(i)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,(l=>this.br(e,l,n).next((u=>{u||(r++,o.removeEntry(l,et.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),De.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),De.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),De.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),De.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=tf(e.data.value)),n}br(e,n,r){return De.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return De.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class w0{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=gt(),i=gt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new w0(e,n.fromCache,r,i)}}class hN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class fN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return FR()?8:UO(Zn())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,i,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new hN;return this.Ss(e,n,l).next((u=>{if(o.result=u,this.Vs)return this.bs(e,n,l,u.size)}))})).next((()=>o.result))}bs(e,n,r,i){return r.documentReadCount<this.fs?(Il()<=mt.DEBUG&&Le("QueryEngine","SDK will not create cache indexes for query:",Dl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),De.resolve()):(Il()<=mt.DEBUG&&Le("QueryEngine","Query:",Dl(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Il()<=mt.DEBUG&&Le("QueryEngine","The SDK decides to create cache indexes for query:",Dl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Bs(n))):De.resolve())}ys(e,n){if(e1(n))return De.resolve(null);let r=Bs(n);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(n.limit!==null&&i===1&&(n=Ey(n,null,"F"),r=Bs(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=gt(...o);return this.ps.getDocuments(e,l).next((u=>this.indexManager.getMinOffset(e,r).next((h=>{const f=this.Ds(n,u);return this.Cs(n,f,l,h.readTime)?this.ys(e,Ey(n,null,"F")):this.vs(e,f,n,h)}))))})))))}ws(e,n,r,i){return e1(n)||i.isEqual(et.min())?De.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,i)?De.resolve(null):(Il()<=mt.DEBUG&&Le("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Dl(n)),this.vs(e,l,n,NO(i,Pu)).next((u=>u)))}))}Ds(e,n){let r=new Tn(cC(e));return n.forEach(((i,o)=>{em(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,n,r){return Il()<=mt.DEBUG&&Le("QueryEngine","Using full collection scan to execute query:",Dl(n)),this.ps.getDocumentsMatchingQuery(e,n,xa.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const S0="LocalStore",mN=3e8;class pN{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new Zt(pt),this.xs=new Do((o=>f0(o)),m0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function gN(t,e,n,r){return new pN(t,e,n,r)}async function OC(t,e){const n=rt(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next((o=>(i=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],u=[];let h=gt();for(const f of i){l.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}for(const f of o){u.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((f=>({Ls:f,removedBatchIds:l,addedBatchIds:u})))}))}))}function yN(t,e){const n=rt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,f,p){const g=f.batch,_=g.keys();let b=De.resolve();return _.forEach((S=>{b=b.next((()=>p.getEntry(h,S))).next((x=>{const E=f.docVersions.get(S);jt(E!==null,48541),x.version.compareTo(E)<0&&(g.applyToRemoteDocument(x,f),x.isValidDocument()&&(x.setReadTime(f.commitVersion),p.addEntry(x)))}))})),b.next((()=>u.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=gt();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,i)))}))}function MC(t){const e=rt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function _N(t,e){const n=rt(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const u=[];e.targetChanges.forEach(((p,g)=>{const _=i.get(g);if(!_)return;u.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let b=_.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?b=b.withResumeToken($n.EMPTY_BYTE_STRING,et.min()).withLastLimboFreeSnapshotVersion(et.min()):p.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(p.resumeToken,r)),i=i.insert(g,b),(function(x,E,C){return x.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=mN?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(_,b,p)&&u.push(n.Pi.updateTargetData(o,b))}));let h=vi(),f=gt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),u.push(bN(o,l,e.documentUpdates).next((p=>{h=p.ks,f=p.qs}))),!r.isEqual(et.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));u.push(p)}return De.waitFor(u).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,f))).next((()=>h))})).then((o=>(n.Ms=i,o)))}function bN(t,e,n){let r=gt(),i=gt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=vi();return n.forEach(((u,h)=>{const f=o.get(u);h.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(u)),h.isNoDocument()&&h.version.isEqual(et.min())?(e.removeEntry(u,h.readTime),l=l.insert(u,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),l=l.insert(u,h)):Le(S0,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",h.version)})),{ks:l,qs:i}}))}function vN(t,e){const n=rt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=u0),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function xN(t,e){const n=rt(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return n.Pi.getTargetData(r,e).next((o=>o?(i=o,De.resolve(i)):n.Pi.allocateTargetId(r).next((l=>(i=new ua(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=n.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function Ry(t,e,n){const r=rt(t),i=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!dc(l))throw l;Le(S0,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function f1(t,e,n){const r=rt(t);let i=et.min(),o=gt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,f,p){const g=rt(h),_=g.xs.get(p);return _!==void 0?De.resolve(g.Ms.get(_)):g.Pi.getTargetData(f,p)})(r,l,Bs(e)).next((u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,u.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?i:et.min(),n?o:gt()))).next((u=>(wN(r,oM(e),u),{documents:u,Qs:o})))))}function wN(t,e,n){let r=t.Os.get(e)||et.min();n.forEach(((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class m1{constructor(){this.activeTargetIds=fM()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class SN{constructor(){this.Mo=new m1,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new m1,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class EN{Oo(e){}shutdown(){}}const p1="ConnectivityMonitor";class g1{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Le(p1,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Le(p1,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Gh=null;function Iy(){return Gh===null?Gh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Gh++,"0x"+Gh.toString(16)}const $g="RestConnection",CN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class TN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===bf?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,o){const l=Iy(),u=this.zo(e,n.toUriEncodedString());Le($g,`Sending RPC '${e}' ${l}:`,u,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);const{host:f}=new URL(u),p=sc(f);return this.Jo(e,u,h,r,p).then((g=>(Le($g,`Received RPC '${e}' ${l}: `,g),g)),(g=>{throw $l($g,`RPC '${e}' ${l} failed with error: `,g,"url: ",u,"request:",r),g}))}Ho(e,n,r,i,o,l){return this.Go(e,n,r,i,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+cc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((i,o)=>e[o]=i)),r&&r.headers.forEach(((i,o)=>e[o]=i))}zo(e,n){const r=CN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class AN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Kn="WebChannelConnection";class jN extends TN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,o){const l=Iy();return new Promise(((u,h)=>{const f=new PE;f.setWithCredentials(!0),f.listenOnce(zE.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case ef.NO_ERROR:const g=f.getResponseJson();Le(Kn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),u(g);break;case ef.TIMEOUT:Le(Kn,`RPC '${e}' ${l} timed out`),h(new Be(Re.DEADLINE_EXCEEDED,"Request time out"));break;case ef.HTTP_ERROR:const _=f.getStatus();if(Le(Kn,`RPC '${e}' ${l} failed with status:`,_,"response text:",f.getResponseText()),_>0){let b=f.getResponseJson();Array.isArray(b)&&(b=b[0]);const S=b?.error;if(S&&S.status&&S.message){const x=(function(C){const T=C.toLowerCase().replace(/_/g,"-");return Object.values(Re).indexOf(T)>=0?T:Re.UNKNOWN})(S.status);h(new Be(x,S.message))}else h(new Be(Re.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new Be(Re.UNAVAILABLE,"Connection failed."));break;default:Xe(9055,{l_:e,streamId:l,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{Le(Kn,`RPC '${e}' ${l} completed.`)}}));const p=JSON.stringify(i);Le(Kn,`RPC '${e}' ${l} sending request:`,i),f.send(n,"POST",p,r,15)}))}T_(e,n,r){const i=Iy(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=UE(),u=LE(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");Le(Kn,`Creating RPC '${e}' stream ${i}: ${p}`,h);const g=l.createWebChannel(p,h);this.I_(g);let _=!1,b=!1;const S=new AN({Yo:E=>{b?Le(Kn,`Not sending because RPC '${e}' stream ${i} is closed:`,E):(_||(Le(Kn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),_=!0),Le(Kn,`RPC '${e}' stream ${i} sending:`,E),g.send(E))},Zo:()=>g.close()}),x=(E,C,T)=>{E.listen(C,(A=>{try{T(A)}catch(U){setTimeout((()=>{throw U}),0)}}))};return x(g,xu.EventType.OPEN,(()=>{b||(Le(Kn,`RPC '${e}' stream ${i} transport opened.`),S.o_())})),x(g,xu.EventType.CLOSE,(()=>{b||(b=!0,Le(Kn,`RPC '${e}' stream ${i} transport closed`),S.a_(),this.E_(g))})),x(g,xu.EventType.ERROR,(E=>{b||(b=!0,$l(Kn,`RPC '${e}' stream ${i} transport errored. Name:`,E.name,"Message:",E.message),S.a_(new Be(Re.UNAVAILABLE,"The operation could not be completed")))})),x(g,xu.EventType.MESSAGE,(E=>{if(!b){const C=E.data[0];jt(!!C,16349);const T=C,A=T?.error||T[0]?.error;if(A){Le(Kn,`RPC '${e}' stream ${i} received error:`,A);const U=A.status;let F=(function(D){const P=gn[D];if(P!==void 0)return xC(P)})(U),H=A.message;F===void 0&&(F=Re.INTERNAL,H="Unknown error status: "+U+" with message "+A.message),b=!0,S.a_(new Be(F,H)),g.close()}else Le(Kn,`RPC '${e}' stream ${i} received:`,C),S.u_(C)}})),x(u,BE.STAT_EVENT,(E=>{E.stat===yy.PROXY?Le(Kn,`RPC '${e}' stream ${i} detected buffering proxy`):E.stat===yy.NOPROXY&&Le(Kn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{S.__()}),0),S}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function qg(){return typeof document<"u"?document:null}function im(t){return new kM(t,!0)}class NC{constructor(e,n,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&Le("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const y1="PersistentStream";class PC{constructor(e,n,r,i,o,l,u,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new NC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===Re.RESOURCE_EXHAUSTED?(bi(n.toString()),bi("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===Re.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===n&&this.G_(r,i)}),(r=>{e((()=>{const i=new Be(Re.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Le(y1,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Le(y1,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class RN extends PC{constructor(e,n,r,i,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=NM(this.serializer,e),r=(function(o){if(!("targetChange"in o))return et.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?et.min():l.readTime?Ls(l.readTime):et.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=jy(this.serializer),n.addTarget=(function(o,l){let u;const h=l.target;if(u=wy(h)?{documents:BM(o,h)}:{query:LM(o,h).ft},u.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){u.resumeToken=EC(o,l.resumeToken);const f=Cy(o,l.expectedCount);f!==null&&(u.expectedCount=f)}else if(l.snapshotVersion.compareTo(et.min())>0){u.readTime=Cf(o,l.snapshotVersion.toTimestamp());const f=Cy(o,l.expectedCount);f!==null&&(u.expectedCount=f)}return u})(this.serializer,e);const r=FM(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=jy(this.serializer),n.removeTarget=e,this.q_(n)}}class IN extends PC{constructor(e,n,r,i,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return jt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,jt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){jt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=zM(e.writeResults,e.commitTime),r=Ls(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=jy(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>PM(this.serializer,r)))};this.q_(n)}}class DN{}class kN extends DN{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Be(Re.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,Ty(n,r),i,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===Re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Be(Re.UNKNOWN,o.toString())}))}Ho(e,n,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,u])=>this.connection.Ho(e,Ty(n,r),i,l,u,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===Re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Be(Re.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class ON{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(bi(n),this.aa=!1):Le("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Ao="RemoteStore";class MN{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{ko(this)&&(Le(Ao,"Restarting streams for network reachability change."),await(async function(h){const f=rt(h);f.Ea.add(4),await ad(f),f.Ra.set("Unknown"),f.Ea.delete(4),await am(f)})(this))}))})),this.Ra=new ON(r,i)}}async function am(t){if(ko(t))for(const e of t.da)await e(!0)}async function ad(t){for(const e of t.da)await e(!1)}function zC(t,e){const n=rt(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),A0(n)?T0(n):hc(n).O_()&&C0(n,e))}function E0(t,e){const n=rt(t),r=hc(n);n.Ia.delete(e),r.O_()&&BC(n,e),n.Ia.size===0&&(r.O_()?r.L_():ko(n)&&n.Ra.set("Unknown"))}function C0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(et.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}hc(t).Y_(e)}function BC(t,e){t.Va.Ue(e),hc(t).Z_(e)}function T0(t){t.Va=new jM({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),hc(t).start(),t.Ra.ua()}function A0(t){return ko(t)&&!hc(t).x_()&&t.Ia.size>0}function ko(t){return rt(t).Ea.size===0}function LC(t){t.Va=void 0}async function NN(t){t.Ra.set("Online")}async function PN(t){t.Ia.forEach(((e,n)=>{C0(t,e)}))}async function zN(t,e){LC(t),A0(t)?(t.Ra.ha(e),T0(t)):t.Ra.set("Unknown")}async function BN(t,e,n){if(t.Ra.set("Online"),e instanceof SC&&e.state===2&&e.cause)try{await(async function(i,o){const l=o.cause;for(const u of o.targetIds)i.Ia.has(u)&&(await i.remoteSyncer.rejectListen(u,l),i.Ia.delete(u),i.Va.removeTarget(u))})(t,e)}catch(r){Le(Ao,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Af(t,r)}else if(e instanceof sf?t.Va.Ze(e):e instanceof wC?t.Va.st(e):t.Va.tt(e),!n.isEqual(et.min()))try{const r=await MC(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const u=o.Va.Tt(l);return u.targetChanges.forEach(((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(f);p&&o.Ia.set(f,p.withResumeToken(h.resumeToken,l))}})),u.targetMismatches.forEach(((h,f)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken($n.EMPTY_BYTE_STRING,p.snapshotVersion)),BC(o,h);const g=new ua(p.target,h,f,p.sequenceNumber);C0(o,g)})),o.remoteSyncer.applyRemoteEvent(u)})(t,n)}catch(r){Le(Ao,"Failed to raise snapshot:",r),await Af(t,r)}}async function Af(t,e,n){if(!dc(e))throw e;t.Ea.add(1),await ad(t),t.Ra.set("Offline"),n||(n=()=>MC(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Le(Ao,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await am(t)}))}function UC(t,e){return e().catch((n=>Af(t,n,e)))}async function om(t){const e=rt(t),n=Ca(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:u0;for(;LN(e);)try{const i=await vN(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,UN(e,i)}catch(i){await Af(e,i)}FC(e)&&VC(e)}function LN(t){return ko(t)&&t.Ta.length<10}function UN(t,e){t.Ta.push(e);const n=Ca(t);n.O_()&&n.X_&&n.ea(e.mutations)}function FC(t){return ko(t)&&!Ca(t).x_()&&t.Ta.length>0}function VC(t){Ca(t).start()}async function FN(t){Ca(t).ra()}async function VN(t){const e=Ca(t);for(const n of t.Ta)e.ea(n.mutations)}async function $N(t,e,n){const r=t.Ta.shift(),i=y0.from(r,e,n);await UC(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await om(t)}async function qN(t,e){e&&Ca(t).X_&&await(async function(r,i){if((function(l){return CM(l)&&l!==Re.ABORTED})(i.code)){const o=r.Ta.shift();Ca(r).B_(),await UC(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i))),await om(r)}})(t,e),FC(t)&&VC(t)}async function _1(t,e){const n=rt(t);n.asyncQueue.verifyOperationInProgress(),Le(Ao,"RemoteStore received new credentials");const r=ko(n);n.Ea.add(3),await ad(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await am(n)}async function GN(t,e){const n=rt(t);e?(n.Ea.delete(2),await am(n)):e||(n.Ea.add(2),await ad(n),n.Ra.set("Unknown"))}function hc(t){return t.ma||(t.ma=(function(n,r,i){const o=rt(n);return o.sa(),new RN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:NN.bind(null,t),t_:PN.bind(null,t),r_:zN.bind(null,t),H_:BN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),A0(t)?T0(t):t.Ra.set("Unknown")):(await t.ma.stop(),LC(t))}))),t.ma}function Ca(t){return t.fa||(t.fa=(function(n,r,i){const o=rt(n);return o.sa(),new IN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:FN.bind(null,t),r_:qN.bind(null,t),ta:VN.bind(null,t),na:$N.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await om(t)):(await t.fa.stop(),t.Ta.length>0&&(Le(Ao,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class j0{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new mi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const l=Date.now()+r,u=new j0(e,n,l,i,o);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Be(Re.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function R0(t,e){if(bi("AsyncQueue",`${e}: ${t}`),dc(t))return new Be(Re.UNAVAILABLE,`${e}: ${t}`);throw t}class Bl{static emptySet(e){return new Bl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||We.comparator(n.key,r.key):(n,r)=>We.comparator(n.key,r.key),this.keyedMap=wu(),this.sortedSet=new Zt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Bl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Bl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class b1{constructor(){this.ga=new Zt(We.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Xe(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class Yl{constructor(e,n,r,i,o,l,u,h,f){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,n,r,i,o){const l=[];return n.forEach((u=>{l.push({type:0,doc:u})})),new Yl(e,n,Bl.emptySet(n),l,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Jf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}class HN{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class QN{constructor(){this.queries=v1(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=rt(n),o=i.queries;i.queries=v1(),o.forEach(((l,u)=>{for(const h of u.Sa)h.onError(r)}))})(this,new Be(Re.ABORTED,"Firestore shutting down"))}}function v1(){return new Do((t=>lC(t)),Jf)}async function $C(t,e){const n=rt(t);let r=3;const i=e.query;let o=n.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new HN,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(i,!0);break;case 1:o.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(l){const u=R0(l,`Initialization of query '${Dl(e.query)}' failed`);return void e.onError(u)}n.queries.set(i,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&I0(n)}async function qC(t,e){const n=rt(t),r=e.query;let i=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function WN(t,e){const n=rt(t);let r=!1;for(const i of e){const o=i.query,l=n.queries.get(o);if(l){for(const u of l.Sa)u.Fa(i)&&(r=!0);l.wa=i}}r&&I0(n)}function KN(t,e,n){const r=rt(t),i=r.queries.get(e);if(i)for(const o of i.Sa)o.onError(n);r.queries.delete(e)}function I0(t){t.Ca.forEach((e=>{e.next()}))}var Dy,x1;(x1=Dy||(Dy={})).Ma="default",x1.Cache="cache";class GC{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Yl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Yl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Dy.Cache}}class HC{constructor(e){this.key=e}}class QC{constructor(e){this.key=e}}class YN{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=gt(),this.mutatedKeys=gt(),this.eu=cC(e),this.tu=new Bl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new b1,i=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=i,u=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((p,g)=>{const _=i.get(p),b=em(this.query,g)?g:null,S=!!_&&this.mutatedKeys.has(_.key),x=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let E=!1;_&&b?_.data.isEqual(b.data)?S!==x&&(r.track({type:3,doc:b}),E=!0):this.su(_,b)||(r.track({type:2,doc:b}),E=!0,(h&&this.eu(b,h)>0||f&&this.eu(b,f)<0)&&(u=!0)):!_&&b?(r.track({type:0,doc:b}),E=!0):_&&!b&&(r.track({type:1,doc:_}),E=!0,(h||f)&&(u=!0)),E&&(b?(l=l.add(b),o=x?o.add(p):o.delete(p)):(l=l.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const p=this.query.limitType==="F"?l.last():l.first();l=l.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:l,iu:r,Cs:u,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((p,g)=>(function(b,S){const x=E=>{switch(E){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xe(20277,{Rt:E})}};return x(b)-x(S)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),i=i??!1;const u=n&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,f=h!==this.Za;return this.Za=h,l.length!==0||f?{snapshot:new Yl(this.query,e.tu,o,l,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new b1,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=gt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new QC(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new HC(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=gt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Yl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const D0="SyncEngine";class XN{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class ZN{constructor(e){this.key=e,this.hu=!1}}class JN{constructor(e,n,r,i,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new Do((u=>lC(u)),Jf),this.Iu=new Map,this.Eu=new Set,this.du=new Zt(We.comparator),this.Au=new Map,this.Ru=new v0,this.Vu={},this.mu=new Map,this.fu=Kl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function e4(t,e,n=!0){const r=JC(t);let i;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await WC(r,e,n,!0),i}async function t4(t,e){const n=JC(t);await WC(n,e,!0,!1)}async function WC(t,e,n,r){const i=await xN(t.localStore,Bs(e)),o=i.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let u;return r&&(u=await n4(t,e,o,l==="current",i.resumeToken)),t.isPrimaryClient&&n&&zC(t.remoteStore,i),u}async function n4(t,e,n,r,i){t.pu=(g,_,b)=>(async function(x,E,C,T){let A=E.view.ru(C);A.Cs&&(A=await f1(x.localStore,E.query,!1).then((({documents:O})=>E.view.ru(O,A))));const U=T&&T.targetChanges.get(E.targetId),F=T&&T.targetMismatches.get(E.targetId)!=null,H=E.view.applyChanges(A,x.isPrimaryClient,U,F);return S1(x,E.targetId,H.au),H.snapshot})(t,g,_,b);const o=await f1(t.localStore,e,!0),l=new YN(e,o.Qs),u=l.ru(o.documents),h=id.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),f=l.applyChanges(u,t.isPrimaryClient,h);S1(t,n,f.au);const p=new XN(e,n,l);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),f.snapshot}async function r4(t,e,n){const r=rt(t),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter((l=>!Jf(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Ry(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&E0(r.remoteStore,i.targetId),ky(r,i.targetId)})).catch(uc)):(ky(r,i.targetId),await Ry(r.localStore,i.targetId,!0))}async function s4(t,e){const n=rt(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),E0(n.remoteStore,r.targetId))}async function i4(t,e,n){const r=h4(t);try{const i=await(function(l,u){const h=rt(l),f=qt.now(),p=u.reduce(((b,S)=>b.add(S.key)),gt());let g,_;return h.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let S=vi(),x=gt();return h.Ns.getEntries(b,p).next((E=>{S=E,S.forEach(((C,T)=>{T.isValidDocument()||(x=x.add(C))}))})).next((()=>h.localDocuments.getOverlayedDocuments(b,S))).next((E=>{g=E;const C=[];for(const T of u){const A=vM(T,g.get(T.key).overlayedDocument);A!=null&&C.push(new Oa(T.key,A,eC(A.value.mapValue),mr.exists(!0)))}return h.mutationQueue.addMutationBatch(b,f,C,u)})).next((E=>{_=E;const C=E.applyToLocalDocumentSet(g,x);return h.documentOverlayCache.saveOverlays(b,E.batchId,C)}))})).then((()=>({batchId:_.batchId,changes:dC(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(l,u,h){let f=l.Vu[l.currentUser.toKey()];f||(f=new Zt(pt)),f=f.insert(u,h),l.Vu[l.currentUser.toKey()]=f})(r,i.batchId,n),await od(r,i.changes),await om(r.remoteStore)}catch(i){const o=R0(i,"Failed to persist write");n.reject(o)}}async function KC(t,e){const n=rt(t);try{const r=await _N(n.localStore,e);e.targetChanges.forEach(((i,o)=>{const l=n.Au.get(o);l&&(jt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?l.hu=!0:i.modifiedDocuments.size>0?jt(l.hu,14607):i.removedDocuments.size>0&&(jt(l.hu,42227),l.hu=!1))})),await od(n,r,e)}catch(r){await uc(r)}}function w1(t,e,n){const r=rt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach(((o,l)=>{const u=l.view.va(e);u.snapshot&&i.push(u.snapshot)})),(function(l,u){const h=rt(l);h.onlineState=u;let f=!1;h.queries.forEach(((p,g)=>{for(const _ of g.Sa)_.va(u)&&(f=!0)})),f&&I0(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function a4(t,e,n){const r=rt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),o=i&&i.key;if(o){let l=new Zt(We.comparator);l=l.insert(o,Xn.newNoDocument(o,et.min()));const u=gt().add(o),h=new sm(et.min(),new Map,new Zt(pt),l,u);await KC(r,h),r.du=r.du.remove(o),r.Au.delete(e),k0(r)}else await Ry(r.localStore,e,!1).then((()=>ky(r,e,n))).catch(uc)}async function o4(t,e){const n=rt(t),r=e.batch.batchId;try{const i=await yN(n.localStore,e);XC(n,r,null),YC(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await od(n,i)}catch(i){await uc(i)}}async function l4(t,e,n){const r=rt(t);try{const i=await(function(l,u){const h=rt(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let p;return h.mutationQueue.lookupMutationBatch(f,u).next((g=>(jt(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(f,g)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,p,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,p))).next((()=>h.localDocuments.getDocuments(f,p)))}))})(r.localStore,e);XC(r,e,n),YC(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await od(r,i)}catch(i){await uc(i)}}function YC(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function XC(t,e,n){const r=rt(t);let i=r.Vu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function ky(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||ZC(t,r)}))}function ZC(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(E0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),k0(t))}function S1(t,e,n){for(const r of n)r instanceof HC?(t.Ru.addReference(r.key,e),c4(t,r)):r instanceof QC?(Le(D0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||ZC(t,r.key)):Xe(19791,{wu:r})}function c4(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Le(D0,"New document in limbo: "+n),t.Eu.add(r),k0(t))}function k0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new We(Ut.fromString(e)),r=t.fu.next();t.Au.set(r,new ZN(n)),t.du=t.du.insert(n,r),zC(t.remoteStore,new ua(Bs(p0(n.path)),r,"TargetPurposeLimboResolution",Yf.ce))}}async function od(t,e,n){const r=rt(t),i=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,h)=>{l.push(r.pu(h,e,n).then((f=>{if((f||n)&&r.isPrimaryClient){const p=f?!f.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(f){i.push(f);const p=w0.As(h.targetId,f);o.push(p)}})))})),await Promise.all(l),r.Pu.H_(i),await(async function(h,f){const p=rt(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>De.forEach(f,(_=>De.forEach(_.Es,(b=>p.persistence.referenceDelegate.addReference(g,_.targetId,b))).next((()=>De.forEach(_.ds,(b=>p.persistence.referenceDelegate.removeReference(g,_.targetId,b)))))))))}catch(g){if(!dc(g))throw g;Le(S0,"Failed to update sequence numbers: "+g)}for(const g of f){const _=g.targetId;if(!g.fromCache){const b=p.Ms.get(_),S=b.snapshotVersion,x=b.withLastLimboFreeSnapshotVersion(S);p.Ms=p.Ms.insert(_,x)}}})(r.localStore,o))}async function u4(t,e){const n=rt(t);if(!n.currentUser.isEqual(e)){Le(D0,"User change. New user:",e.toKey());const r=await OC(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new Be(Re.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await od(n,r.Ls)}}function d4(t,e){const n=rt(t),r=n.Au.get(e);if(r&&r.hu)return gt().add(r.key);{let i=gt();const o=n.Iu.get(e);if(!o)return i;for(const l of o){const u=n.Tu.get(l);i=i.unionWith(u.view.nu)}return i}}function JC(t){const e=rt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=KC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=d4.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=a4.bind(null,e),e.Pu.H_=WN.bind(null,e.eventManager),e.Pu.yu=KN.bind(null,e.eventManager),e}function h4(t){const e=rt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=o4.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=l4.bind(null,e),e}class jf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=im(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return gN(this.persistence,new fN,e.initialUser,this.serializer)}Cu(e){return new kC(x0.mi,this.serializer)}Du(e){return new SN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}jf.provider={build:()=>new jf};class f4 extends jf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){jt(this.persistence.referenceDelegate instanceof Tf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new ZM(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?hr.withCacheSize(this.cacheSizeBytes):hr.DEFAULT;return new kC((r=>Tf.mi(r,n)),this.serializer)}}class Oy{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>w1(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=u4.bind(null,this.syncEngine),await GN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new QN})()}createDatastore(e){const n=im(e.databaseInfo.databaseId),r=(function(o){return new jN(o)})(e.databaseInfo);return(function(o,l,u,h){return new kN(o,l,u,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,i,o,l,u){return new MN(r,i,o,l,u)})(this.localStore,this.datastore,e.asyncQueue,(n=>w1(this.syncEngine,n,0)),(function(){return g1.v()?new g1:new EN})())}createSyncEngine(e,n){return(function(i,o,l,u,h,f,p){const g=new JN(i,o,l,u,h,f);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=rt(n);Le(Ao,"RemoteStore shutting down."),r.Ea.add(5),await ad(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Oy.provider={build:()=>new Oy};class eT{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):bi("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const Ta="FirestoreClient";class m4{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Yn.UNAUTHENTICATED,this.clientId=c0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{Le(Ta,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(Le(Ta,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new mi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=R0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Gg(t,e){t.asyncQueue.verifyOperationInProgress(),Le(Ta,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async i=>{r.isEqual(i)||(await OC(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function E1(t,e){t.asyncQueue.verifyOperationInProgress();const n=await p4(t);Le(Ta,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>_1(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,i)=>_1(e.remoteStore,i))),t._onlineComponents=e}async function p4(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Le(Ta,"Using user provided OfflineComponentProvider");try{await Gg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(i){return i.name==="FirebaseError"?i.code===Re.FAILED_PRECONDITION||i.code===Re.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(n))throw n;$l("Error using user provided cache. Falling back to memory cache: "+n),await Gg(t,new jf)}}else Le(Ta,"Using default OfflineComponentProvider"),await Gg(t,new f4(void 0));return t._offlineComponents}async function tT(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Le(Ta,"Using user provided OnlineComponentProvider"),await E1(t,t._uninitializedComponentsProvider._online)):(Le(Ta,"Using default OnlineComponentProvider"),await E1(t,new Oy))),t._onlineComponents}function g4(t){return tT(t).then((e=>e.syncEngine))}async function nT(t){const e=await tT(t),n=e.eventManager;return n.onListen=e4.bind(null,e.syncEngine),n.onUnlisten=r4.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=t4.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=s4.bind(null,e.syncEngine),n}function y4(t,e,n={}){const r=new mi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,u,h,f){const p=new eT({next:_=>{p.Nu(),l.enqueueAndForget((()=>qC(o,g)));const b=_.docs.has(u);!b&&_.fromCache?f.reject(new Be(Re.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&_.fromCache&&h&&h.source==="server"?f.reject(new Be(Re.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(_)},error:_=>f.reject(_)}),g=new GC(p0(u.path),p,{includeMetadataChanges:!0,qa:!0});return $C(o,g)})(await nT(t),t.asyncQueue,e,n,r))),r.promise}function _4(t,e,n={}){const r=new mi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,u,h,f){const p=new eT({next:_=>{p.Nu(),l.enqueueAndForget((()=>qC(o,g))),_.fromCache&&h.source==="server"?f.reject(new Be(Re.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(_)},error:_=>f.reject(_)}),g=new GC(u,p,{includeMetadataChanges:!0,qa:!0});return $C(o,g)})(await nT(t),t.asyncQueue,e,n,r))),r.promise}function rT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const C1=new Map;const sT="firestore.googleapis.com",T1=!0;class A1{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Be(Re.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=sT,this.ssl=T1}else this.host=e.host,this.ssl=e.ssl??T1;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=DC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<YM)throw new Be(Re.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}MO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=rT(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Be(Re.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Be(Re.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Be(Re.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lm{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new A1({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Be(Re.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Be(Re.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new A1(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new EO;switch(r.type){case"firstParty":return new jO(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Be(Re.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=C1.get(n);r&&(Le("ComponentProvider","Removing Datastore"),C1.delete(n),r.terminate())})(this),Promise.resolve()}}function b4(t,e,n,r={}){t=ls(t,lm);const i=sc(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},u=`${e}:${n}`;i&&(WS(`https://${u}`),KS("Firestore",!0)),o.host!==sT&&o.host!==u&&$l("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:i,emulatorOptions:r};if(!gi(h,l)&&(t._setSettings(h),r.mockUserToken)){let f,p;if(typeof r.mockUserToken=="string")f=r.mockUserToken,p=Yn.MOCK_USER;else{f=kR(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Be(Re.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Yn(g)}t._authCredentials=new CO(new VE(f,p))}}class fc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new fc(this.firestore,e,this._query)}}class ln{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new va(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ln(this.firestore,e,this._key)}toJSON(){return{type:ln._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(nd(n,ln._jsonSchema))return new ln(e,r||null,new We(Ut.fromString(n.referencePath)))}}ln._jsonSchemaVersion="firestore/documentReference/1.0",ln._jsonSchema={type:_n("string",ln._jsonSchemaVersion),referencePath:_n("string")};class va extends fc{constructor(e,n,r){super(e,n,p0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ln(this.firestore,null,new We(e))}withConverter(e){return new va(this.firestore,e,this._path)}}function O0(t,e,...n){if(t=bn(t),$E("collection","path",e),t instanceof lm){const r=Ut.fromString(e,...n);return Uw(r),new va(t,null,r)}{if(!(t instanceof ln||t instanceof va))throw new Be(Re.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ut.fromString(e,...n));return Uw(r),new va(t.firestore,null,r)}}function Oo(t,e,...n){if(t=bn(t),arguments.length===1&&(e=c0.newId()),$E("doc","path",e),t instanceof lm){const r=Ut.fromString(e,...n);return Lw(r),new ln(t,null,new We(r))}{if(!(t instanceof ln||t instanceof va))throw new Be(Re.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ut.fromString(e,...n));return Lw(r),new ln(t.firestore,t instanceof va?t.converter:null,new We(r))}}const j1="AsyncQueue";class R1{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new NC(this,"async_queue_retry"),this._c=()=>{const r=qg();r&&Le(j1,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=qg();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=qg();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new mi;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!dc(e))throw e;Le(j1,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,bi("INTERNAL UNHANDLED ERROR: ",I1(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=j0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(i),i}uc(){this.nc&&Xe(47125,{Pc:I1(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function I1(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Mo extends lm{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new R1,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new R1(e),this._firestoreClient=void 0,await e}}}function M0(t,e){const n=typeof t=="object"?t:JS(),r=typeof t=="string"?t:bf,i=Jy(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=IR("firestore");o&&b4(i,...o)}return i}function cm(t){if(t._terminated)throw new Be(Re.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||v4(t),t._firestoreClient}function v4(t){const e=t._freezeSettings(),n=(function(i,o,l,u){return new GO(i,o,l,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,rT(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new m4(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(i){const o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(t._componentsProvider))}class $r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $r($n.fromBase64String(e))}catch(n){throw new Be(Re.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new $r($n.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:$r._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(nd(e,$r._jsonSchema))return $r.fromBase64String(e.bytes)}}$r._jsonSchemaVersion="firestore/bytes/1.0",$r._jsonSchema={type:_n("string",$r._jsonSchemaVersion),bytes:_n("string")};class ld{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Be(Re.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Un(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class cd{constructor(e){this._methodName=e}}class Us{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Be(Re.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Be(Re.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return pt(this._lat,e._lat)||pt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Us._jsonSchemaVersion}}static fromJSON(e){if(nd(e,Us._jsonSchema))return new Us(e.latitude,e.longitude)}}Us._jsonSchemaVersion="firestore/geoPoint/1.0",Us._jsonSchema={type:_n("string",Us._jsonSchemaVersion),latitude:_n("number"),longitude:_n("number")};class Fs{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Fs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(nd(e,Fs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Fs(e.vectorValues);throw new Be(Re.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Fs._jsonSchemaVersion="firestore/vectorValue/1.0",Fs._jsonSchema={type:_n("string",Fs._jsonSchemaVersion),vectorValues:_n("object")};const x4=/^__.*__$/;class w4{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Oa(e,this.data,this.fieldMask,n,this.fieldTransforms):new sd(e,this.data,n,this.fieldTransforms)}}class iT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Oa(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function aT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xe(40011,{Ac:t})}}class um{constructor(e,n,r,i,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new um({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Rf(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(aT(this.Ac)&&x4.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class S4{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||im(e)}Cc(e,n,r,i=!1){return new um({Ac:e,methodName:n,Dc:r,path:Un.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function dm(t){const e=t._freezeSettings(),n=im(t._databaseId);return new S4(t._databaseId,!!e.ignoreUndefinedProperties,n)}function oT(t,e,n,r,i,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,i);z0("Data must be an object, but it was:",l,r);const u=dT(r,l);let h,f;if(o.merge)h=new Cr(l.fieldMask),f=l.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const _=My(e,g,n);if(!l.contains(_))throw new Be(Re.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);fT(p,_)||p.push(_)}h=new Cr(p),f=l.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,f=l.fieldTransforms;return new w4(new fr(u),h,f)}class hm extends cd{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof hm}}function lT(t,e,n){return new um({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class N0 extends cd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=lT(this,e,!0),r=this.vc.map((o=>No(o,n))),i=new Ql(r);return new _C(e.path,i)}isEqual(e){return e instanceof N0&&gi(this.vc,e.vc)}}class P0 extends cd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=lT(this,e,!0),r=this.vc.map((o=>No(o,n))),i=new Wl(r);return new _C(e.path,i)}isEqual(e){return e instanceof P0&&gi(this.vc,e.vc)}}function cT(t,e,n,r){const i=t.Cc(1,e,n);z0("Data must be an object, but it was:",i,r);const o=[],l=fr.empty();ka(r,((h,f)=>{const p=B0(e,h,n);f=bn(f);const g=i.yc(p);if(f instanceof hm)o.push(p);else{const _=No(f,g);_!=null&&(o.push(p),l.set(p,_))}}));const u=new Cr(o);return new iT(l,u,i.fieldTransforms)}function uT(t,e,n,r,i,o){const l=t.Cc(1,e,n),u=[My(e,r,n)],h=[i];if(o.length%2!=0)throw new Be(Re.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<o.length;_+=2)u.push(My(e,o[_])),h.push(o[_+1]);const f=[],p=fr.empty();for(let _=u.length-1;_>=0;--_)if(!fT(f,u[_])){const b=u[_];let S=h[_];S=bn(S);const x=l.yc(b);if(S instanceof hm)f.push(b);else{const E=No(S,x);E!=null&&(f.push(b),p.set(b,E))}}const g=new Cr(f);return new iT(p,g,l.fieldTransforms)}function E4(t,e,n,r=!1){return No(n,t.Cc(r?4:3,e))}function No(t,e){if(hT(t=bn(t)))return z0("Unsupported field value:",e,t),dT(t,e);if(t instanceof cd)return(function(r,i){if(!aT(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const o=[];let l=0;for(const u of r){let h=No(u,i.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,i){if((r=bn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return mM(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=qt.fromDate(r);return{timestampValue:Cf(i.serializer,o)}}if(r instanceof qt){const o=new qt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Cf(i.serializer,o)}}if(r instanceof Us)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof $r)return{bytesValue:EC(i.serializer,r._byteString)};if(r instanceof ln){const o=i.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw i.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:b0(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Fs)return(function(l,u){return{mapValue:{fields:{[ZE]:{stringValue:JE},[vf]:{arrayValue:{values:l.toArray().map((f=>{if(typeof f!="number")throw u.Sc("VectorValues must only contain numeric values.");return g0(u.serializer,f)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Kf(r)}`)})(t,e)}function dT(t,e){const n={};return HE(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ka(t,((r,i)=>{const o=No(i,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function hT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof qt||t instanceof Us||t instanceof $r||t instanceof ln||t instanceof cd||t instanceof Fs)}function z0(t,e,n){if(!hT(n)||!qE(n)){const r=Kf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function My(t,e,n){if((e=bn(e))instanceof ld)return e._internalPath;if(typeof e=="string")return B0(t,e);throw Rf("Field path arguments must be of type string or ",t,!1,void 0,n)}const C4=new RegExp("[~\\*/\\[\\]]");function B0(t,e,n){if(e.search(C4)>=0)throw Rf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new ld(...e.split("."))._internalPath}catch{throw Rf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Rf(t,e,n,r,i){const o=r&&!r.isEmpty(),l=i!==void 0;let u=`Function ${e}() called with invalid data`;n&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${i}`),h+=")"),new Be(Re.INVALID_ARGUMENT,u+t+h)}function fT(t,e){return t.some((n=>n.isEqual(e)))}class mT{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new ln(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new T4(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(L0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class T4 extends mT{data(){return super.data()}}function L0(t,e){return typeof e=="string"?B0(t,e):e instanceof ld?e._internalPath:e._delegate._internalPath}function A4(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Be(Re.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class U0{}class j4 extends U0{}function R4(t,e,...n){let r=[];e instanceof U0&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof F0)).length,u=o.filter((h=>h instanceof fm)).length;if(l>1||l>0&&u>0)throw new Be(Re.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)t=i._apply(t);return t}class fm extends j4{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new fm(e,n,r)}_apply(e){const n=this._parse(e);return pT(e._query,n),new fc(e.firestore,e.converter,Sy(e._query,n))}_parse(e){const n=dm(e.firestore);return(function(o,l,u,h,f,p,g){let _;if(f.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Be(Re.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){k1(g,p);const S=[];for(const x of g)S.push(D1(h,o,x));_={arrayValue:{values:S}}}else _=D1(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||k1(g,p),_=E4(u,l,g,p==="in"||p==="not-in");return yn.create(f,p,_)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function I4(t,e,n){const r=e,i=L0("where",t);return fm._create(i,r,n)}class F0 extends U0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new F0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:cs.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(i,o){let l=i;const u=o.getFlattenedFilters();for(const h of u)pT(l,h),l=Sy(l,h)})(e._query,n),new fc(e.firestore,e.converter,Sy(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function D1(t,e,n){if(typeof(n=bn(n))=="string"){if(n==="")throw new Be(Re.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!oC(e)&&n.indexOf("/")!==-1)throw new Be(Re.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ut.fromString(n));if(!We.isDocumentKey(r))throw new Be(Re.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ww(t,new We(r))}if(n instanceof ln)return Ww(t,n._key);throw new Be(Re.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Kf(n)}.`)}function k1(t,e){if(!Array.isArray(t)||t.length===0)throw new Be(Re.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function pT(t,e){const n=(function(i,o){for(const l of i)for(const u of l.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null})(t.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Be(Re.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Be(Re.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class D4{convertValue(e,n="none"){switch(Ea(e)){case 0:return null;case 1:return e.booleanValue;case 2:return on(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Sa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Xe(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return ka(e,((i,o)=>{r[i]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[vf].arrayValue?.values?.map((r=>on(r.doubleValue)));return new Fs(n)}convertGeoPoint(e){return new Us(on(e.latitude),on(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Zf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(zu(e));default:return null}}convertTimestamp(e){const n=wa(e);return new qt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ut.fromString(e);jt(IC(r),9688,{name:e});const i=new Bu(r.get(1),r.get(3)),o=new We(r.popFirst(5));return i.isEqual(n)||bi(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function gT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Eu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class vo extends mT{constructor(e,n,r,i,o,l){super(e,n,r,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new af(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(L0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Be(Re.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=vo._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}vo._jsonSchemaVersion="firestore/documentSnapshot/1.0",vo._jsonSchema={type:_n("string",vo._jsonSchemaVersion),bundleSource:_n("string","DocumentSnapshot"),bundleName:_n("string"),bundle:_n("string")};class af extends vo{data(e={}){return super.data(e)}}class Ll{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Eu(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new af(this._firestore,this._userDataWriter,r.key,r,new Eu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Be(Re.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((u=>{const h=new af(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Eu(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new af(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Eu(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,p=-1;return u.type!==0&&(f=l.indexOf(u.doc.key),l=l.delete(u.doc.key)),u.type!==1&&(l=l.add(u.doc),p=l.indexOf(u.doc.key)),{type:k4(u.type),doc:h,oldIndex:f,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Be(Re.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Ll._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=c0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function k4(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xe(61501,{type:t})}}function O4(t){t=ls(t,ln);const e=ls(t.firestore,Mo);return y4(cm(e),t._key).then((n=>P4(e,t,n)))}Ll._jsonSchemaVersion="firestore/querySnapshot/1.0",Ll._jsonSchema={type:_n("string",Ll._jsonSchemaVersion),bundleSource:_n("string","QuerySnapshot"),bundleName:_n("string"),bundle:_n("string")};class yT extends D4{constructor(e){super(),this.firestore=e}convertBytes(e){return new $r(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new ln(this.firestore,null,n)}}function V0(t){t=ls(t,fc);const e=ls(t.firestore,Mo),n=cm(e),r=new yT(e);return A4(t._query),_4(n,t._query).then((i=>new Ll(e,r,t,i)))}function M4(t,e,n){t=ls(t,ln);const r=ls(t.firestore,Mo),i=gT(t.converter,e,n);return mm(r,[oT(dm(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,mr.none())])}function _T(t,e,n,...r){t=ls(t,ln);const i=ls(t.firestore,Mo),o=dm(i);let l;return l=typeof(e=bn(e))=="string"||e instanceof ld?uT(o,"updateDoc",t._key,e,n,r):cT(o,"updateDoc",t._key,e),mm(i,[l.toMutation(t._key,mr.exists(!0))])}function N4(t){return mm(ls(t.firestore,Mo),[new rm(t._key,mr.none())])}function mm(t,e){return(function(r,i){const o=new mi;return r.asyncQueue.enqueueAndForget((async()=>i4(await g4(r),i,o))),o.promise})(cm(t),e)}function P4(t,e,n){const r=n.docs.get(e._key),i=new yT(t);return new vo(t,i,e._key,r,new Eu(n.hasPendingWrites,n.fromCache),e.converter)}class z4{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=dm(e)}set(e,n,r){this._verifyNotCommitted();const i=Hg(e,this._firestore),o=gT(i.converter,n,r),l=oT(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(l.toMutation(i._key,mr.none())),this}update(e,n,r,...i){this._verifyNotCommitted();const o=Hg(e,this._firestore);let l;return l=typeof(n=bn(n))=="string"||n instanceof ld?uT(this._dataReader,"WriteBatch.update",o._key,n,r,i):cT(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,mr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Hg(e,this._firestore);return this._mutations=this._mutations.concat(new rm(n._key,mr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Be(Re.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Hg(t,e){if((t=bn(t)).firestore!==e)throw new Be(Re.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Uu(...t){return new N0("arrayUnion",t)}function O1(...t){return new P0("arrayRemove",t)}function bT(t){return cm(t=ls(t,Mo)),new z4(t,(e=>mm(t,e)))}(function(e,n=!0){(function(i){cc=i})(ic),Fl(new Eo("firestore",((r,{instanceIdentifier:i,options:o})=>{const l=r.getProvider("app").getImmediate(),u=new Mo(new TO(r.getProvider("auth-internal")),new RO(l,r.getProvider("app-check-internal")),(function(f,p){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new Be(Re.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bu(f.options.projectId,p)})(l,i),l);return o={useFetchStreams:n,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),ya(Nw,Pw,e),ya(Nw,Pw,"esm2020")})();function Po(){return M0(Wf)}const Sn={showGroupTotals:!1};function zo(t,e,n,r=1,i,o){let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const p=e.replace("months/","").split("_");if(p.length>=2){const g=p[p.length-1];l=`months/${p[p.length-2]}/${g}`}}const u=i===!1?" [NOT FOUND]":"",h=`  ${n}`;console.log(`[Firebase] ${t}(${r}): ${l}${u}${h}`)}async function At(t,e,n){const r=Oo(Po(),t,e),i=`${t}/${e}`,o=await O4(r),l=o.exists(),u=l?o.data():null;return zo("READ",i,n,1,l),{exists:l,data:u,ref:r}}async function kn(t,e,n){const r=Po(),i=O0(r,t);let o;if(n&&n.length>0){const f=n.map(p=>I4(p.field,p.op,p.value));o=R4(i,...f)}else o=i;const l=await V0(o),u=l.docs.map(f=>({id:f.id,data:f.data()}));let h=t;if(n&&n.length>0){const f=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${f}`}return zo("QUERY",h,e,l.docs.length,void 0),{docs:u}}async function qn(t,e,n,r,i){const o=Oo(Po(),t,e),l=`${t}/${e}`;return zo("WRITE",l,r,1,void 0),M4(o,n,i??{})}async function pm(t,e){const r=Po();for(let i=0;i<t.length;i+=500){const o=t.slice(i,i+500),l=bT(r);for(const{collectionPath:u,docId:h,data:f}of o){const p=Oo(r,u,h);l.set(p,f)}zo("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0);try{await l.commit()}catch(u){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,u),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(i/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),u}}}async function If(t,e,n,r){const i=Oo(Po(),t,e),o=`${t}/${e}`;return zo("UPDATE",o,r,1,void 0),_T(i,n)}async function Ny(t,e,n){const r=Oo(Po(),t,e),i=`${t}/${e}`;return zo("DELETE",i,n),N4(r)}async function vT(t,e,n){const i=Po();for(let o=0;o<t.length;o+=500){const l=t.slice(o,o+500),u=bT(i);for(const{collectionPath:h,docId:f}of l){const p=Oo(i,h,f);u.delete(p)}zo("BATCH_DELETE",`${l.length} docs`,e,l.length),await u.commit(),n?.(o+l.length)}}const go={mobile:640,tablet:768,wide:1200},B4=go.mobile,Fu=["January","February","March","April","May","June","July","August","September","October","November","December"],Df=3,kf=3,Xt="ungrouped_accounts",nn="ungrouped_categories";function L4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??Xt,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function U4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget!==void 0?r.on_budget:null,is_active:r.is_active!==void 0?r.is_active:null}}),e[Xt]||(e[Xt]={name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}),e}function F4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??nn,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0,is_hidden:r.is_hidden??!1}}),e}function V4(t=[]){const e=t.map(r=>({id:r.id,name:r.name,sort_order:r.sort_order??0}));return e.some(r=>r.id===nn)||e.push({id:nn,name:"Uncategorized",sort_order:0}),e.sort((r,i)=>r.sort_order-i.sort_order),e}function $4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}async function $0(t){const{exists:e,data:n}=await At("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=L4(n.accounts),i=U4(n.account_groups),o=F4(n.categories),l=V4(n.category_groups),u=n.total_available??0,h=$4(n.month_map),f=n.is_needs_recalculation??!1;return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:i,categories:o,category_groups:l,total_available:u,is_needs_recalculation:f,month_map:h},accounts:r,accountGroups:i,categories:o,categoryGroups:l,isNeedsRecalculation:f,monthMap:h}}function q4(t,e){const{initialDataLoadComplete:n}=Ze(),r=!!t&&e?.enabled!==!1&&n;return Ro({queryKey:t?ke.budget(t):["budget","none"],queryFn:()=>$0(t),enabled:r,staleTime:lc})}function us(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function Xl(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function xT(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function vt(t,e){return`${t}${e.toString().padStart(2,"0")}`}function Py(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function gm(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1;if(t===r&&e===i){const o=n.getDate();return`${r}-${String(i).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function ym(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}function Me(t){return Math.round((t+Number.EPSILON)*100)/100}function dt(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function Aa(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>Aa(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=Aa(r));return e}return t}function G4(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??vt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function Gr(t,e,n,r){const i=us(t,e,n);return(await Ue.fetchQuery({queryKey:ke.month(t,e,n),queryFn:async()=>{const{exists:l,data:u}=await At("months",i,r?.description??`reading month ${e}/${n}`);return!l||!u?null:{month:G4(u,t,e,n)}},staleTime:lc}))?.month??null}async function H4(t,e,n){const r=vt(e,n);return(await kn("months","getFutureMonths: querying months after specified month",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">",value:r}])).docs.map(l=>({id:l.id,...l.data})).sort((l,u)=>l.year!==u.year?l.year-u.year:l.month-u.month)}function Q4(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}function W4(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let i=kf;i>0;i--){let o=e,l=n-i;for(;l<1;)l+=12,o-=1;r.push(vt(o,l))}r.push(vt(e,n));for(let i=1;i<=Df;i++){let o=e,l=n+i;for(;l>12;)l-=12,o+=1;r.push(vt(o,l))}return r}function K4(t,e){const n=ke.budget(t),r=Ue.getQueryData(n);if(!r?.monthMap)return!1;for(const[i,o]of Object.entries(r.monthMap))if(i>=e&&!o.needs_recalculation)return!1;return!0}function Y4(t,e,n){const r=ke.budget(t),i=Ue.getQueryData(r);i&&Ue.setQueryData(r,{...i,isNeedsRecalculation:!0,monthMap:n,budget:{...i.budget,is_needs_recalculation:!0,month_map:n}})}function X4(t,e,n){const r=ke.budget(t),i=Ue.getQueryData(r);i&&Ue.setQueryData(r,{...i,monthMap:e,budget:{...i.budget,month_map:e}})}function Z4(t,e,n,r){const i=vt(e,n),o=ke.budget(t),l=Ue.getQueryData(o);if(!l)return console.warn(`[removeMonthFromMap] Budget ${t} not found in cache`),{};const u=l.monthMap||{},{[i]:h,...f}=u,p=f;return Ue.setQueryData(o,{...l,monthMap:p,budget:{...l.budget,month_map:p}}),r&&r({type:"budget",budgetId:t}),p}async function J4(t,e,n,r){const{bypassDateLimit:i=!1}={},o=new Date,l=o.getFullYear(),u=o.getMonth()+1,h=(e-l)*12+(n-u);if(!i&&h>Df){const D=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${Df}). This likely indicates a bug in month navigation.`;throw console.error(D),new Error(D)}if(!i&&h<-kf){const D=`[createMonth] Refusing to create month ${e}/${n} - it's ${Math.abs(h)} months in the past (max allowed: ${kf}). Existing months can still be viewed, but new months cannot be created this far back.`;throw console.error(D),new Error(D)}const{exists:f,data:p}=await At("budgets",t,"validating budget exists before creating month");if(!f||!p){Ue.removeQueries({queryKey:ke.budget(t)});const D=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(D),new Error(D)}const g=o.toISOString(),_=us(t,e,n);let b=0,S={},x={};if(n>1||e>new Date().getFullYear()-10){const{year:D,month:P}=Xl(e,n),L=us(t,D,P);try{const{exists:q,data:j}=await At("months",L,"fetching previous month to create start balances for new month");if(q&&j){const M={budget_id:t,year_month_ordinal:j.year_month_ordinal??vt(D,P),year:j.year??D,month:j.month??P,income:j.income||[],total_income:j.total_income??0,previous_month_income:j.previous_month_income??0,expenses:j.expenses||[],total_expenses:j.total_expenses??0,transfers:j.transfers||[],adjustments:j.adjustments||[],account_balances:j.account_balances||[],category_balances:j.category_balances||[],are_allocations_finalized:j.are_allocations_finalized??!1,created_at:j.created_at,updated_at:j.updated_at};b=M.total_income;const{categoryEndBalances:R,accountEndBalances:K}=Q4(M);S=R,x=K}}catch(q){if(q instanceof Error&&q.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${D}/${P}, starting with zero balances`);else throw q}}const E=Object.entries(S).map(([D,P])=>({category_id:D,start_balance:P,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:P})),C=Object.entries(x).map(([D,P])=>({account_id:D,start_balance:P,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:P})),T={budget_id:t,year_month_ordinal:vt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:b,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:C,category_balances:E,are_allocations_finalized:!1,created_at:g,updated_at:g},A={budget_id:t,year_month_ordinal:vt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:b,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:C,category_balances:E,are_allocations_finalized:!1,created_at:g,updated_at:g};await qn("months",_,A,"creating new month document (first time viewing this month)"),Ue.setQueryData(ke.month(t,e,n),{month:T});const U=vt(e,n),H={...p.month_map||{},[U]:{needs_recalculation:!1}},O=H;return X4(t,O),await If("budgets",t,{month_map:O,updated_at:g},`adding month ${e}/${n} to budget month_map`),T}function e6(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??vt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function q0(t,e,n){const r=us(t,e,n);try{const{exists:i,data:o}=await At("months",r,`loading month ${e}/${n}`);return!i||!o?null:e6(o,t,e,n)}catch(i){if(i instanceof Error&&i.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw i}}async function t6(t,e,n,r){const i=await q0(t,e,n);if(i)return i;let o=!1;if(r){const l=r.getQueryData(ke.budget(t));l?.monthMap&&(o=vt(e,n)in l.monthMap)}else{const{exists:l,data:u}=await At("budgets",t,"checking month_map before creating month");if(l&&u?.month_map){const h=vt(e,n),f=u.month_map;o=h in f}}if(o)return J4(t,e,n);throw new Error(`Month ${e}/${n} does not exist in budget. Cannot create months that are not in month_map.`)}function n6(t,e,n,r){const i=Ht(),{initialDataLoadComplete:o}=Ze(),l=t?ke.month(t,e,n):["month","none"],u=!!t&&r?.enabled!==!1&&o;return Ro({queryKey:l,queryFn:async()=>({month:await t6(t,e,n,i)}),enabled:u,staleTime:lc})}async function G0(t){const{exists:e,data:n}=await At("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function H0(t,e){const{initialDataLoadComplete:n}=Ze(),r=!!t&&e?.enabled!==!1&&n;return Ro({queryKey:t?ke.payees(t):["payees","none"],queryFn:()=>G0(t),enabled:r,staleTime:lc})}async function r6(t,e){const{exists:n,data:r}=await At("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const i={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await qn("users",t,i,"creating new user document (first login)"),i}function s6(t,e,n){return Ro({queryKey:t?ke.user(t):["user","none"],queryFn:()=>r6(t,e),enabled:!!t&&n?.enabled!==!1})}async function i6(t,e){const n=await kn("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],i=[];for(const o of n.docs){const l=o.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):i.push({budgetId:o.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}return{budgets:r,pendingInvites:i}}function a6(t,e,n){return Ro({queryKey:t?ke.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?i6(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function o6(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function l6(){const t=await kn("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=o6(n.data.items),i=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:i})})}return{items:e}}function c6(t){return Ro({queryKey:ke.feedback(),queryFn:l6,enabled:t?.enabled!==!1})}const Kt="__NO_CATEGORY__",jo="No Category";function lt(t){return t===Kt}const $t="__NO_ACCOUNT__",ja="No Account";function nt(t){return t===$t}const Q0={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function W0(t,e){const n=t.income||[],r=t.expenses||[],i=Me(n.reduce((g,_)=>g+_.amount,0)),o=Me(r.reduce((g,_)=>g+_.amount,0)),l=u6(t),{transfersMap:u,adjustmentsMap:h}=d6(t),f=h6(t.category_balances,e.categoryEndBalances,l,u,h),p=f6(t,e.accountEndBalances);return{...t,total_income:i,total_expenses:o,previous_month_income:e.totalIncome,category_balances:f,account_balances:p,updated_at:new Date().toISOString()}}function u6(t){const e={};for(const n of t.transfers||[])lt(n.from_category_id)||(e[n.from_category_id]=(e[n.from_category_id]||0)-n.amount),lt(n.to_category_id)||(e[n.to_category_id]=(e[n.to_category_id]||0)+n.amount);for(const n of t.adjustments||[])lt(n.category_id)||(e[n.category_id]=(e[n.category_id]||0)+n.amount);for(const n of Object.keys(e))e[n]=Me(e[n]);return e}function d6(t){const e={},n={};for(const r of t.transfers||[])lt(r.from_category_id)||(e[r.from_category_id]=(e[r.from_category_id]||0)-r.amount),lt(r.to_category_id)||(e[r.to_category_id]=(e[r.to_category_id]||0)+r.amount);for(const r of t.adjustments||[])lt(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(e))e[r]=Me(e[r]);for(const r of Object.keys(n))n[r]=Me(n[r]);return{transfersMap:e,adjustmentsMap:n}}function h6(t,e,n,r,i){const o=new Map;for(const h of t)lt(h.category_id)||o.set(h.category_id,h);const l=new Set;for(const h of t)lt(h.category_id)||l.add(h.category_id);for(const h of Object.keys(e))lt(h)||l.add(h);for(const h of Object.keys(n))lt(h)||l.add(h);const u=[];for(const h of l){const f=o.get(h),p=Me(e[h]??0),g=Me(f?.allocated??0),_=Me(f?.spent??0),b=Me(r[h]??0),S=Me(i[h]??0);u.push({category_id:h,start_balance:p,allocated:g,spent:_,transfers:b,adjustments:S,end_balance:Me(p+g+_+b+S)})}return u}function f6(t,e){const n=new Set;for(const i of t.income||[])nt(i.account_id)||n.add(i.account_id);for(const i of t.expenses||[])nt(i.account_id)||n.add(i.account_id);for(const i of t.transfers||[])nt(i.from_account_id)||n.add(i.from_account_id),nt(i.to_account_id)||n.add(i.to_account_id);for(const i of t.adjustments||[])nt(i.account_id)||n.add(i.account_id);for(const i of Object.keys(e))nt(i)||n.add(i);for(const i of t.account_balances||[])nt(i.account_id)||n.add(i.account_id);const r=[];for(const i of n){const o=Me(e[i]??0),l=Me((t.income||[]).filter(b=>b.account_id===i).reduce((b,S)=>b+S.amount,0)),u=Me((t.expenses||[]).filter(b=>b.account_id===i).reduce((b,S)=>b+S.amount,0)),h=Me((t.transfers||[]).filter(b=>b.from_account_id===i).reduce((b,S)=>b-S.amount,0)),f=Me((t.transfers||[]).filter(b=>b.to_account_id===i).reduce((b,S)=>b+S.amount,0)),p=Me(f+h),g=Me((t.adjustments||[]).filter(b=>b.account_id===i).reduce((b,S)=>b+S.amount,0)),_=Me(l+u+p+g);r.push({account_id:i,start_balance:o,income:l,expenses:u,transfers:p,adjustments:g,net_change:_,end_balance:Me(o+_)})}return r}function Vu(t){const e={},n={};for(const r of t.category_balances||[])lt(r.category_id)||(e[r.category_id]=Me(r.end_balance));for(const r of t.account_balances||[])nt(r.account_id)||(n[r.account_id]=Me(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:Me(t.total_income)}}const m6=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function p6(t){return{year:parseInt(t.slice(0,4),10),month:parseInt(t.slice(4,6),10)}}function wT(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}function ST(t){return Object.entries(t).filter(([,e])=>e.needs_recalculation).map(([e])=>e).sort()}function g6(t){return Object.keys(t).sort()}async function y6(t,e){const{year:n,month:r}=p6(e),i=us(t,n,r),{exists:o,data:l}=await At("months",i,`[recalc] fetching month ${n}/${r}`);return!o||!l?null:{id:i,budget_id:t,year_month_ordinal:l.year_month_ordinal??vt(n,r),year:l.year??n,month:l.month??r,income:l.income||[],total_income:l.total_income??0,previous_month_income:l.previous_month_income??0,expenses:l.expenses||[],total_expenses:l.total_expenses??0,transfers:l.transfers||[],adjustments:l.adjustments||[],account_balances:l.account_balances||[],category_balances:l.category_balances||[],are_allocations_finalized:l.are_allocations_finalized??!1,created_at:l.created_at,updated_at:l.updated_at}}async function _6(t,e,n){n?.(0,e.length);const r=await Promise.all(e.map(i=>y6(t,i)));return n?.(e.length,e.length),r.filter(i=>i!==null)}function K0(t){const e={};for(const n of Object.keys(t))e[n]={needs_recalculation:!1};return e}function Y0(t,e,n){const r=Object.entries(t).reduce((o,[,l])=>{const u=l.account_group_id?n[l.account_group_id]:void 0,h=u&&u.on_budget!==null?u.on_budget:l.on_budget!==!1,f=u&&u.is_active!==null?u.is_active:l.is_active!==!1;return h&&f?o+(l.balance??0):o},0),i=Object.values(e).reduce((o,l)=>{const u=l.balance??0;return o+(u>0?u:0)},0);return Me(r-i)}async function ET(t,e,n,r){const{exists:i,data:o}=await At("budgets",t,"[recalc] reading budget for balance update");if(!i||!o)return;const l={...o.accounts};for(const[p,g]of Object.entries(e))l[p]&&(l[p]={...l[p],balance:Me(g)});const u={...o.categories};for(const[p,g]of Object.entries(n))u[p]&&(u[p]={...u[p],balance:Me(g)});const h=K0(r),f=Y0(l,u,o.account_groups||{});await qn("budgets",t,{...o,accounts:l,categories:u,total_available:f,is_needs_recalculation:!1,month_map:h,updated_at:new Date().toISOString()},"[recalc] saving balances and clearing flags"),v6(t,l,u,f,h)}function b6(t,e){const n=Ue.getQueryData(ke.budget(t));n&&Ue.setQueryData(ke.budget(t),{...n,isNeedsRecalculation:!1,monthMap:e,budget:{...n.budget,is_needs_recalculation:!1,month_map:e}})}function v6(t,e,n,r,i){const o=Ue.getQueryData(ke.budget(t));if(o){const l={};for(const[h,f]of Object.entries(o.accounts)){const p=e[h];l[h]=p?{...f,balance:p.balance??f.balance}:f}const u={};for(const[h,f]of Object.entries(o.categories)){const p=n[h];u[h]=p?{...f,balance:p.balance??f.balance}:f}Ue.setQueryData(ke.budget(t),{...o,accounts:l,categories:u,isNeedsRecalculation:!1,monthMap:i,budget:{...o.budget,accounts:e,categories:n,total_available:r,is_needs_recalculation:!1,month_map:i}})}}async function M1(t,e){const{exists:n,data:r}=await At("budgets",t,"[recalc] reading budget to clear flags");if(!n||!r)return;const i=K0(e);await qn("budgets",t,{...r,total_available:Y0(r.accounts||{},r.categories||{},r.account_groups||{}),is_needs_recalculation:!1,month_map:i,updated_at:new Date().toISOString()},"[recalc] clearing flags"),b6(t,i)}const Qg=new Map;async function x6(t,e={}){const n=Qg.get(t);if(n)return n;const r=w6(t,e);Qg.set(t,r);try{return await r}finally{Qg.delete(t)}}async function w6(t,e={}){const{onProgress:n}=e;n?.({phase:"reading-budget",monthsProcessed:0,totalMonths:0,percentComplete:5});const{exists:r,data:i}=await At("budgets",t,"[recalc] reading budget for month_map");if(!r||!i)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const o=wT(i.month_map),l=ST(o);if(l.length===0&&!i.is_needs_recalculation)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const u=g6(o),h=l.length>0?l[0]:null;if(!h)return await M1(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const f=u.indexOf(h),p=f>0,g=p?u.slice(f-1):u.slice(f),_=p?g.length-1:g.length;n?.({phase:"fetching-months",monthsFetched:0,totalMonthsToFetch:g.length,monthsProcessed:0,totalMonths:_,percentComplete:10});const b=await _6(t,g,(O,D)=>{n?.({phase:"fetching-months",monthsFetched:O,totalMonthsToFetch:D,monthsProcessed:0,totalMonths:_,percentComplete:O===0?10:30})});if(b.length===0)return await M1(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const S=p?1:0,x=b.length-1,E=x-S+1;let C=Q0;p&&b.length>0&&(C=Vu(b[0]));const T=[];let A=0;for(let O=S;O<=x;O++){const D=b[O],P=`${m6[D.month-1]} ${D.year}`;n?.({phase:"recalculating",currentMonth:P,monthsProcessed:A,totalMonths:E,percentComplete:Math.round(30+A/E*40)});const L=W0(D,C);T.push(L),C=Vu(L),A++}n?.({phase:"saving",monthsProcessed:A,totalMonths:E,percentComplete:75});const U=T.map(O=>({collectionPath:"months",docId:us(t,O.year,O.month),data:O}));await pm(U,`[recalc] batch write ${T.length} months`);for(const O of T)Ue.setQueryData(ke.month(t,O.year,O.month),{month:O});n?.({phase:"saving",monthsProcessed:A,totalMonths:E,percentComplete:92});const F=C.accountEndBalances,H=C.categoryEndBalances;return await ET(t,F,H,o),n?.({phase:"complete",monthsProcessed:A,totalMonths:E,percentComplete:100}),{monthsRecalculated:A,budgetUpdated:!0,finalAccountBalances:F}}async function S6(t,e,n){const r=vt(e,n);if(K4(t,r))return{markedCount:0,budgetUpdated:!1};const{exists:i,data:o}=await At("budgets",t,"reading budget for month_map update");if(!i||!o)return console.warn(`[markMonthsNeedRecalculation] Budget ${t} not found`),{markedCount:0,budgetUpdated:!1};const u={...o.month_map||{}},h=W4();for(const _ of h)u[_]||(u[_]={needs_recalculation:!1});let f=0;for(const _ of h)_>=r&&(u[_]?.needs_recalculation||(u[_]={needs_recalculation:!0},f++));const p=o.is_needs_recalculation===!0;if(f===0&&p)return{markedCount:0,budgetUpdated:!1};const g=u;return Y4(t,r,g),await If("budgets",t,{is_needs_recalculation:!0,month_map:g,updated_at:new Date().toISOString()},`marking budget and ${f} future months as needing recalculation`),{markedCount:f,budgetUpdated:!0}}async function E6(t,e){return Ue.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await At("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function zy(t,e,n){const r=await Gr(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function C6(t,e,n,r){const i={};e.forEach(_=>{i[_]=0});const o=await zy(t,n,r);if(o?.category_balances){for(const _ of o.category_balances)e.includes(_.category_id)&&(i[_.category_id]=_.end_balance);return i}const l={};e.forEach(_=>{l[_]=0});const u=[];o&&u.push(o);let h=n,f=r,p=!1;const g=120;for(let _=0;_<g&&!p;_++){const b=Xl(h,f);h=b.year,f=b.month;const S=await zy(t,h,f);if(!S)p=!0;else if(S.category_balances){p=!0;for(const x of S.category_balances)e.includes(x.category_id)&&(l[x.category_id]=x.end_balance)}else u.push(S)}u.reverse(),Object.assign(i,l);for(const _ of u){if(_.are_allocations_finalized&&_.category_balances)for(const b of _.category_balances)e.includes(b.category_id)&&(i[b.category_id]=(i[b.category_id]||0)+b.allocated);if(_.expenses)for(const b of _.expenses)e.includes(b.category_id)&&(i[b.category_id]=(i[b.category_id]||0)-b.amount)}return i}async function T6(t,e,n,r,i){const o={...n};let l=r,u=i;const h=24;for(let f=0;f<h;f++){const p=xT(l,u);l=p.year,u=p.month;const g=await zy(t,l,u);if(!g)break;if(g.are_allocations_finalized&&g.category_balances)for(const _ of g.category_balances)e.includes(_.category_id)&&(o[_.category_id]=(o[_.category_id]||0)+_.allocated);if(g.expenses)for(const _ of g.expenses)e.includes(_.category_id)&&(o[_.category_id]=(o[_.category_id]||0)-_.amount)}return o}async function N1(t,e,n,r){const i=await C6(t,e,n,r),o=await T6(t,e,i,n,r);return{current:i,total:o}}async function CT(t,e,n){const r=us(t,e.year,e.month);await qn("months",r,e,`writeMonthData: ${n}`)}async function TT(t,e,n){await S6(t,e,n)}async function AT(t){const{budgetId:e,month:n,description:r,cascadeRecalculation:i=!0}=t;await CT(e,n,r||`${n.year}/${n.month}`),Ue.setQueryData(ke.month(e,n.year,n.month),{month:n}),i&&await TT(e,n.year,n.month)}function A6(){const t=Ht();return{writeData:Gn({mutationFn:async({budgetId:n,month:r,description:i,cascadeRecalculation:o=!0})=>(await CT(n,r,i||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,cascadeRecalculation:o}),onMutate:async({budgetId:n,month:r})=>{const i=ke.month(n,r.year,r.month);await t.cancelQueries({queryKey:i});const o=t.getQueryData(i);return t.setQueryData(i,{month:r}),{oldMonthQueryData:o,monthKey:i}},onSuccess:async({budgetId:n,year:r,month:i,cascadeRecalculation:o})=>{o&&await TT(n,r,i)},onError:(n,r,i)=>{i?.oldMonthQueryData&&t.setQueryData(i.monthKey,i.oldMonthQueryData)}})}}function j6(t,e,n,r){const i={};t.category_balances&&t.category_balances.forEach(h=>{i[h.category_id]=h});const o=t.expenses??[],l={};for(const h of t.transfers||[])lt(h.from_category_id)||(l[h.from_category_id]=(l[h.from_category_id]||0)-h.amount),lt(h.to_category_id)||(l[h.to_category_id]=(l[h.to_category_id]||0)+h.amount);const u={};for(const h of t.adjustments||[])lt(h.category_id)||(u[h.category_id]=(u[h.category_id]||0)+h.amount);return e.map(h=>{const f=i[h],p=Me(f?.start_balance??0),g=Me(n[h]??0),_=Me(o.filter(x=>x.category_id===h).reduce((x,E)=>x+E.amount,0)),b=Me(l[h]??0),S=Me(u[h]??0);return{category_id:h,start_balance:p,allocated:g,spent:_,transfers:b,adjustments:S,end_balance:Me(p+g+_+b+S)}})}function R6(){const{writeData:t}=A6();return{saveDraftAllocations:async(n,r,i,o)=>{const l=await Gr(n,r,i);if(!l)throw new Error(`Month not found: ${r}/${i}`);const u=l.category_balances.map(f=>({...f,allocated:o[f.category_id]??f.allocated})),h={...l,category_balances:u,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:h,cascadeRecalculation:!1}),{updatedMonth:h}},isPending:t.isPending,isError:t.isError,error:t.error}}const I6={success:{bgColor:"rgba(46, 213, 115, 0.95)",color:"white",icon:""},error:{bgColor:"rgba(255, 71, 87, 0.95)",color:"white",icon:""},warning:{bgColor:"rgba(255, 165, 2, 0.95)",color:"white",icon:""},info:{bgColor:"rgba(30, 144, 255, 0.95)",color:"white",icon:""}};function D6({item:t,onDismiss:e}){const[n,r]=k.useState(!1);if(k.useEffect(()=>{if(t){if(r(!0),t.autoDismissMs&&t.autoDismissMs>0){const o=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),200)},t.autoDismissMs);return()=>clearTimeout(o)}}else r(!1)},[t,e]),!t||!n)return null;const i=I6[t.type];return d.jsxs("div",{style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",left:"1.5rem",maxWidth:"600px",margin:"0 auto",background:i.bgColor,color:i.color,padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:n?"fadeInUp 0.2s ease-out":"fadeOut 0.2s ease-out",cursor:"pointer"},onClick:()=>{r(!1),setTimeout(()=>e(t.id),200)},children:[d.jsx("span",{children:i.icon}),d.jsx("span",{style:{flex:1},children:t.message}),d.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:""})]})}class k6{items=[];listeners=new Set;nextId=1;add(e){const n=`banner-${this.nextId++}`,r={...e,id:n};return this.items.push(r),this.notify(),n}remove(e){this.items=this.items.filter(n=>n.id!==e),this.notify()}getCurrent(){return this.items[0]||null}subscribe(e){return this.listeners.add(e),e(this.getCurrent()),()=>{this.listeners.delete(e)}}notify(){const e=this.getCurrent();this.listeners.forEach(n=>n(e))}}const xo=new k6;async function _m(t){const{budgetId:e,updates:n,description:r}=t,i={...n,updated_at:new Date().toISOString()},o=Aa(i);await qn("budgets",e,o,r,{merge:!0});const l=Ue.getQueryData(ke.budget(e));l&&Ue.setQueryData(ke.budget(e),{...l,budget:{...l.budget,...n}})}function bm(t){const e=t.income||[],n=t.expenses||[],r=Me(e.reduce((u,h)=>u+h.amount,0)),i=Me(n.reduce((u,h)=>u+h.amount,0)),o=O6(t),l=M6(t);return{...t,total_income:r,total_expenses:i,account_balances:o,category_balances:l}}function O6(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],i=t.adjustments||[],o=t.account_balances||[],l=new Map;for(const f of o)nt(f.account_id)||l.set(f.account_id,f);const u=new Set;for(const f of e)nt(f.account_id)||u.add(f.account_id);for(const f of n)nt(f.account_id)||u.add(f.account_id);for(const f of r)nt(f.from_account_id)||u.add(f.from_account_id),nt(f.to_account_id)||u.add(f.to_account_id);for(const f of i)nt(f.account_id)||u.add(f.account_id);for(const f of o)nt(f.account_id)||u.add(f.account_id);const h=[];for(const f of u){const p=l.get(f),g=Me(p?.start_balance??0),_=Me(e.filter(A=>A.account_id===f).reduce((A,U)=>A+U.amount,0)),b=Me(n.filter(A=>A.account_id===f).reduce((A,U)=>A+U.amount,0)),S=Me(r.filter(A=>A.from_account_id===f).reduce((A,U)=>A-U.amount,0)),x=Me(r.filter(A=>A.to_account_id===f).reduce((A,U)=>A+U.amount,0)),E=Me(x+S),C=Me(i.filter(A=>A.account_id===f).reduce((A,U)=>A+U.amount,0)),T=Me(_+b+E+C);h.push({account_id:f,start_balance:g,income:_,expenses:b,transfers:E,adjustments:C,net_change:T,end_balance:Me(g+T)})}return h}function M6(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],i=t.category_balances||[],o=new Map;for(const g of i)lt(g.category_id)||o.set(g.category_id,g);const l=new Map;for(const g of e){if(lt(g.category_id))continue;const _=l.get(g.category_id)||0;l.set(g.category_id,_+g.amount)}const u=new Map;for(const g of n){if(!lt(g.from_category_id)){const _=u.get(g.from_category_id)||0;u.set(g.from_category_id,_-g.amount)}if(!lt(g.to_category_id)){const _=u.get(g.to_category_id)||0;u.set(g.to_category_id,_+g.amount)}}const h=new Map;for(const g of r)if(!lt(g.category_id)){const _=h.get(g.category_id)||0;h.set(g.category_id,_+g.amount)}const f=new Set;for(const g of i)lt(g.category_id)||f.add(g.category_id);for(const g of e)lt(g.category_id)||f.add(g.category_id);for(const g of n)lt(g.from_category_id)||f.add(g.from_category_id),lt(g.to_category_id)||f.add(g.to_category_id);for(const g of r)lt(g.category_id)||f.add(g.category_id);const p=[];for(const g of f){const _=o.get(g),b=Me(l.get(g)??0),S=Me(u.get(g)??0),x=Me(h.get(g)??0);if(_){const E=Me(_.start_balance),C=Me(_.allocated);p.push({category_id:g,start_balance:E,allocated:C,spent:b,transfers:S,adjustments:x,end_balance:Me(E+C+b+S+x)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:b,transfers:S,adjustments:x,end_balance:Me(b+S+x)})}return p}function N6(t,e){const n={};Object.keys(e).forEach(l=>{n[l]=0});const r=Ue.getQueryData(ke.budget(t));if(!r)return n;const i=r.budget.month_map||{},o=Object.keys(i).sort();for(const l of o){const u=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),f=ke.month(t,u,h),p=Ue.getQueryData(f);if(!p?.month)continue;const g=p.month;for(const _ of g.account_balances||[])_.account_id&&!nt(_.account_id)&&n[_.account_id]===0&&(n[_.account_id]=_.start_balance??0)}for(const l of o){const u=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),f=ke.month(t,u,h),p=Ue.getQueryData(f);if(!p?.month)continue;const g=p.month;for(const _ of g.income||[])_.account_id&&!nt(_.account_id)&&n[_.account_id]!==void 0&&(n[_.account_id]+=_.amount);for(const _ of g.expenses||[])_.account_id&&!nt(_.account_id)&&n[_.account_id]!==void 0&&(n[_.account_id]+=_.amount);for(const _ of g.transfers||[])_.to_account_id&&!nt(_.to_account_id)&&n[_.to_account_id]!==void 0&&(n[_.to_account_id]+=_.amount),_.from_account_id&&!nt(_.from_account_id)&&n[_.from_account_id]!==void 0&&(n[_.from_account_id]-=_.amount);for(const _ of g.adjustments||[])_.account_id&&!nt(_.account_id)&&n[_.account_id]!==void 0&&(n[_.account_id]+=_.amount)}for(const l of Object.keys(n))n[l]=Me(n[l]);return n}function jT(t){const e=Ue.getQueryData(ke.budget(t));if(!e){console.warn("[recalculateBudgetAccountBalancesFromCache] Budget not in cache");return}const n=N6(t,e.accounts),r={};for(const[o,l]of Object.entries(e.accounts))r[o]={...l,balance:n[o]??l.balance};const i=Y0(r,e.categories,e.accountGroups);Ue.setQueryData(ke.budget(t),{...e,accounts:r,budget:{...e.budget,accounts:r,total_available:i}})}const P6=300*1e3;function vn(){const{removeChange:t,getChanges:e,clearChanges:n,hasChanges:r,setIsSaving:i,setLastSaveTime:o,setSaveError:l}=mc(),u=k.useRef(null),h=k.useRef(!1),f=k.useCallback(async(S,x,E,C)=>{const T=ke.month(S,x,E),A=Ue.getQueryData(T);if(!A?.month)throw new Error(`Month ${x}/${E} not found in cache`);await AT({budgetId:S,month:A.month,description:`${C}: ${x}/${E}`,cascadeRecalculation:!1})},[]),p=k.useCallback(async(S,x)=>{const E=ke.budget(S),C=Ue.getQueryData(E);if(!C)throw new Error(`Budget ${S} not found in cache`);await _m({budgetId:S,updates:{name:C.budget.name,user_ids:C.budget.user_ids,accepted_user_ids:C.budget.accepted_user_ids,owner_id:C.budget.owner_id,owner_email:C.budget.owner_email,accounts:C.budget.accounts,account_groups:C.budget.account_groups,categories:C.budget.categories,category_groups:C.budget.category_groups,total_available:C.budget.total_available,is_needs_recalculation:C.budget.is_needs_recalculation,month_map:C.budget.month_map},description:`${x}: budget`})},[]),g=k.useCallback(async(S,x)=>{const E=ke.payees(S),C=Ue.getQueryData(E);if(!C)throw new Error(`Payees for budget ${S} not found in cache`);await qn("payees",S,{budget_id:S,payees:C,updated_at:new Date().toISOString()},`${x}: payees`)},[]),_=k.useCallback(async(S="periodic save")=>{if(h.current||!r())return;h.current=!0,i(!0),l(null);const x=e(),E=[];try{const C=[],T=new Set,A=new Set;for(const U of x)U.type==="month"&&U.year!==void 0&&U.month!==void 0?C.push({budgetId:U.budgetId,year:U.year,month:U.month}):U.type==="budget"?T.add(U.budgetId):U.type==="payees"&&A.add(U.budgetId);for(const{budgetId:U,year:F,month:H}of C){const O=ke.month(U,F,H),D=Ue.getQueryData(O);if(D?.month){const P=bm(D.month);Ue.setQueryData(O,{month:P})}}for(const{budgetId:U,year:F,month:H}of C)try{await f(U,F,H,S)}catch(O){const D=`Failed to save month ${F}/${H}: ${O instanceof Error?O.message:String(O)}`;E.push(D),console.error("[useBackgroundSave]",D,O)}for(const U of T)try{jT(U)}catch(F){console.warn("[useBackgroundSave] Failed to recalculate budget account balances from cache:",F)}for(const U of T)try{await p(U,S)}catch(F){const H=`Failed to save budget: ${F instanceof Error?F.message:String(F)}`;E.push(H),console.error("[useBackgroundSave]",H,F)}for(const U of A)try{await g(U,S)}catch(F){const H=`Failed to save payees: ${F instanceof Error?F.message:String(F)}`;E.push(H),console.error("[useBackgroundSave]",H,F)}if(E.length===0)n(),o(Date.now()),xo.add({type:"success",message:"All changes saved successfully",autoDismissMs:2e3});else throw new Error(E.join("; "))}catch(C){const T=C instanceof Error?C.message:String(C);throw l(T),xo.add({type:"error",message:`Failed to save changes: ${T}`,autoDismissMs:0}),C}finally{h.current=!1,i(!1)}},[r,e,n,f,p,g,i,o,l]),b=k.useCallback(async(S,x,E,C)=>{try{i(!0),l(null),x==="month"&&E!==void 0&&C!==void 0?(await f(S,E,C,"immediate save (current viewing document)"),t({type:"month",budgetId:S,year:E,month:C}),o(Date.now())):x==="budget"&&(await p(S,"immediate save (current viewing document)"),t({type:"budget",budgetId:S}),o(Date.now()))}catch(T){const A=T instanceof Error?T.message:String(T);throw l(A),xo.add({type:"error",message:`Failed to save current document: ${A}`,autoDismissMs:0}),T}finally{i(!1)}},[f,p,t,i,o,l]);return k.useEffect(()=>(u.current&&clearInterval(u.current),u.current=setInterval(()=>{r()&&_("periodic save (5-minute timer)").catch(x=>{console.error("[useBackgroundSave] Periodic save failed:",x)})},P6),()=>{u.current&&clearInterval(u.current)}),[r,_]),{saveAllChanges:_,saveCurrentDocument:b}}async function z6(t,e,n,r){const i=ke.month(t,e,n),o=r.getQueryData(i);if(!o?.month)throw new Error(`Month ${e}/${n} not found in cache`);const l=o.month,u=await B6(t,e,n,r),h=W0(l,u);return r.setQueryData(i,{month:h}),h}async function B6(t,e,n,r){const{year:i,month:o}=Xl(e,n),l=ke.month(t,i,o),u=r.getQueryData(l);if(u?.month)return Vu(u.month);try{const h=await q0(t,i,o);if(h)return r.setQueryData(l,{month:h}),Vu(h)}catch(h){console.warn(`[useLocalRecalculation] Could not fetch previous month ${i}/${o}:`,h)}return Q0}const L6={trackChange:()=>{},clearChanges:()=>{},removeChange:()=>{},getChanges:()=>[],hasChanges:()=>!1,isSaving:!1,setIsSaving:()=>{},lastSaveTime:null,setLastSaveTime:()=>{},saveError:null,setSaveError:()=>{},clearSaveError:()=>{},syncError:null,setSyncError:()=>{}},RT=k.createContext(L6);function U6({children:t}){const[e,n]=k.useState(new Map),[r,i]=k.useState(!1),[o,l]=k.useState(null),[u,h]=k.useState(null),[f,p]=k.useState(null),g=k.useCallback(H=>{i(H)},[]),_=k.useCallback(H=>{l(H)},[]),b=k.useCallback(H=>{h(H)},[]),S=k.useCallback(H=>H.type==="month"&&H.year!==void 0&&H.month!==void 0?`${H.type}:${H.budgetId}:${H.year}:${H.month}`:`${H.type}:${H.budgetId}`,[]),x=k.useCallback(H=>{n(O=>{const D=new Map(O),P=S(H);return D.set(P,{...H,timestamp:Date.now()}),D})},[S]),E=k.useCallback(()=>{n(new Map)},[]),C=k.useCallback(H=>{n(O=>{const D=new Map(O),P=S(H);return D.delete(P),D})},[S]),T=k.useCallback(()=>Array.from(e.values()),[e]),A=k.useCallback(()=>e.size>0,[e]),U=k.useCallback(()=>{h(null)},[]),F={trackChange:x,clearChanges:E,removeChange:C,getChanges:T,hasChanges:A,isSaving:r,lastSaveTime:o,saveError:u,clearSaveError:U,setIsSaving:g,setLastSaveTime:_,setSaveError:b,syncError:f,setSyncError:p};return d.jsx(RT.Provider,{value:F,children:t})}function mc(){const t=k.useContext(RT);if(!t)throw new Error("useSync must be used within a SyncProvider");return t}async function F6(t,e,n,r){const i=Ue.getQueryData(ke.budget(t));if(!i){console.warn("[mutationHelpers] Budget not in cache, skipping local recalculation");return}const o=i.budget.month_map,l=vt(e,n),u=[];for(const[h]of Object.entries(o))if(h>=l){const f=parseInt(h.substring(0,4),10),p=parseInt(h.substring(4,6),10);u.push({year:f,month:p})}u.sort((h,f)=>h.year!==f.year?h.year-f.year:h.month-f.month);for(const{year:h,month:f}of u)try{await z6(t,h,f,Ue),r&&r({type:"month",budgetId:t,year:h,month:f})}catch(p){console.warn(`[mutationHelpers] Failed to recalculate month ${h}/${f} locally:`,p)}}function pr(){const{trackChange:t}=mc();return{updateMonthCacheAndTrack:(r,i,o,l)=>{Ue.setQueryData(ke.month(r,i,o),{month:l}),t({type:"month",budgetId:r,year:i,month:o})},recalculateMonthAndCascade:async(r,i,o)=>{const l=ke.month(r,i,o),u=Ue.getQueryData(l);if(u?.month){const h=bm(u.month);Ue.setQueryData(l,{month:h})}await F6(r,i,o,t);try{jT(r),t({type:"budget",budgetId:r})}catch(h){console.warn("[mutationHelpers] Failed to recalculate budget account balances from cache:",h),t({type:"budget",budgetId:r})}},trackChange:t}}function V6(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=vn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{finalizeAllocations:async o=>{const{budgetId:l,year:u,month:h,allocations:f,onProgress:p}=o;p?.({phase:"saving",message:"Saving allocations..."});const g=await Gr(l,u,h);if(!g)throw new Error(`Month not found: ${u}/${h}`);const _=g.category_balances?.map(C=>C.category_id)??[],b=_.length>0?_:Object.keys(f),S=b.length>0?j6(g,b,f):g.category_balances,x={...g,category_balances:S,are_allocations_finalized:!0,updated_at:new Date().toISOString()};n(l,u,h,x),p?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,u,h)}catch(C){console.warn("[useFinalizeAllocations] Failed to recalculate month and cascade:",C)}if(t.type==="month"&&t.year===u&&t.month===h)try{await e(l,"month",u,h)}catch(C){console.warn("[useFinalizeAllocations] Failed to save current document immediately:",C)}return p?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:x}},isPending:!1,isError:!1,error:null}}function IT(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=vn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{deleteAllocations:async o=>{const{budgetId:l,year:u,month:h,onProgress:f}=o;f?.({phase:"saving",message:"Deleting allocations..."});const p=await Gr(l,u,h);if(!p)throw new Error(`Month not found: ${u}/${h}`);const g=p.category_balances.map(S=>({...S,allocated:0,end_balance:S.start_balance-S.spent})),_={...p,category_balances:g,are_allocations_finalized:!1,updated_at:new Date().toISOString()};n(l,u,h,_),f?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,u,h)}catch(S){console.warn("[useDeleteAllocations] Failed to recalculate month and cascade:",S)}if(t.type==="month"&&t.year===u&&t.month===h)try{await e(l,"month",u,h)}catch(S){console.warn("[useDeleteAllocations] Failed to save current document immediately:",S)}return f?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:_}},isPending:!1,isError:!1,error:null}}async function vm(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const i=[...n,r].sort((o,l)=>o.toLowerCase().localeCompare(l.toLowerCase()));return await qn("payees",t,{budget_id:t,payees:i,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),i}function $6(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function q6(){const t=Ht(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=vn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=pr(),l=Gn({onMutate:async h=>{const{budgetId:f,year:p,month:g}=h,_=ke.month(f,p,g);await t.cancelQueries({queryKey:_});const b=t.getQueryData(_),S=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=$6(h,S);if(b?.month){const C={...b.month,income:[...b.month.income||[],x],updated_at:new Date().toISOString()};r(f,p,g,C)}try{await i(f,p,g)}catch(C){console.warn("[useAddIncome] Failed to recalculate month and cascade:",C)}if(h.payee?.trim()){const C=t.getQueryData(ke.payees(f))||[],T=await vm(f,h.payee,C);T&&(t.setQueryData(ke.payees(f),T),o({type:"payees",budgetId:f}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(f,"month",p,g)}catch(C){console.warn("[useAddIncome] Failed to save current document immediately:",C)}return{previousData:b,incomeId:S,newIncome:x}},mutationFn:async h=>{const{budgetId:f,year:p,month:g}=h,_=ke.month(f,p,g),b=t.getQueryData(_);if(!b?.month)throw new Error("No month data in cache after optimistic update");const S=b.month,x=S.income?.[S.income.length-1];if(!x)throw new Error("Could not find new income in updated month");return{updatedMonth:S,newIncome:x}},onError:(h,f,p)=>{if(p?.previousData){const{budgetId:g,year:_,month:b}=f;t.setQueryData(ke.month(g,_,b),p.previousData)}}});return{addIncome:async(h,f,p,g,_,b,S,x)=>l.mutateAsync({budgetId:h,year:f,month:p,amount:g,accountId:_,date:b,payee:S,description:x}),isPending:l.isPending,isError:l.isError,error:l.error}}function G6(t,e,n,r,i,o){if(!t)return!0;const l=t.payee||void 0,u=i?.trim()||void 0,h=t.description||void 0,f=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||u!==l||f!==h}function H6(){const t=Ht(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=vn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=pr();return{updateIncome:async(u,h,f,p,g,_,b,S,x)=>{const E=await Gr(u,h,f);if(!E)throw new Error(`Month not found: ${h}/${f}`);const C=(E.income||[]).find(H=>H.id===p);if(!G6(C,g,_,b,S,x))return{updatedMonth:E,noOp:!0};const T={id:p,amount:g,account_id:_,date:b,created_at:(E.income||[]).find(H=>H.id===p)?.created_at||new Date().toISOString()};S?.trim()&&(T.payee=S.trim()),x&&(T.description=x);const A=(E.income||[]).map(H=>H.id===p?T:H),U={...E,income:A,updated_at:new Date().toISOString()};r(u,h,f,U);try{await i(u,h,f)}catch(H){console.warn("[useUpdateIncome] Failed to recalculate month and cascade:",H)}if(S?.trim()){const H=t.getQueryData(ke.payees(u))||[],O=await vm(u,S,H);O&&(t.setQueryData(ke.payees(u),O),o({type:"payees",budgetId:u}))}if(e.type==="month"&&e.year===h&&e.month===f)try{await n(u,"month",h,f)}catch(H){console.warn("[useUpdateIncome] Failed to save current document immediately:",H)}return{updatedMonth:U}},isPending:!1,isError:!1,error:null}}function Q6(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=vn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{deleteIncome:async(o,l,u,h)=>{const f=await Gr(o,l,u);if(!f)throw new Error(`Month not found: ${l}/${u}`);const p=(f.income||[]).filter(b=>b.id!==h),g={...f,income:p,updated_at:new Date().toISOString()};n(o,l,u,g);try{await r(o,l,u)}catch(b){console.warn("[useDeleteIncome] Failed to recalculate month and cascade:",b)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(b){console.warn("[useDeleteIncome] Failed to save current document immediately:",b)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function W6(t,e){const n={id:e,amount:t.amount,category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function K6(){const t=Ht(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=vn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=pr(),l=Gn({onMutate:async h=>{const{budgetId:f,year:p,month:g}=h,_=ke.month(f,p,g);await t.cancelQueries({queryKey:_});const b=t.getQueryData(_),S=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=W6(h,S);if(b?.month){const C={...b.month,expenses:[...b.month.expenses||[],x],updated_at:new Date().toISOString()};r(f,p,g,C)}try{await i(f,p,g)}catch(C){console.warn("[useAddExpense] Failed to recalculate month and cascade:",C)}if(h.payee?.trim()){const C=t.getQueryData(ke.payees(f))||[],T=await vm(f,h.payee,C);T&&(t.setQueryData(ke.payees(f),T),o({type:"payees",budgetId:f}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(f,"month",p,g)}catch(C){console.warn("[useAddExpense] Failed to save current document immediately:",C)}return{previousData:b,expenseId:S,newExpense:x}},mutationFn:async h=>{const{budgetId:f,year:p,month:g}=h,_=ke.month(f,p,g),b=t.getQueryData(_);if(!b?.month)throw new Error("No month data in cache after optimistic update");const S=b.month,x=S.expenses?.[S.expenses.length-1];if(!x)throw new Error("Could not find new expense in updated month");return{updatedMonth:S,newExpense:x}},onError:(h,f,p)=>{if(p?.previousData){const{budgetId:g,year:_,month:b}=f;t.setQueryData(ke.month(g,_,b),p.previousData)}}});return{addExpense:async(h,f,p,g,_,b,S,x,E,C)=>l.mutateAsync({budgetId:h,year:f,month:p,amount:g,categoryId:_,accountId:b,date:S,payee:x,description:E,cleared:C}),isPending:l.isPending,isError:l.isError,error:l.error}}function Y6(t,e,n,r,i,o,l,u){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||i!==t.date||f!==h||g!==p||u!==t.cleared}function X6(){const t=Ht(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=vn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=pr();return{updateExpense:async(l,u,h,f,p,g,_,b,S,x,E)=>{const C=await Gr(l,u,h);if(!C)throw new Error(`Month not found: ${u}/${h}`);const T=(C.expenses||[]).find(O=>O.id===f);if(!Y6(T,p,g,_,b,S,x,E))return{updatedMonth:C,noOp:!0};const A={id:f,amount:p,category_id:g,account_id:_,date:b,created_at:C.expenses?.find(O=>O.id===f)?.created_at||new Date().toISOString()};S?.trim()&&(A.payee=S.trim()),x&&(A.description=x),E!==void 0&&(A.cleared=E);const U=(C.expenses||[]).map(O=>O.id===f?A:O),F={...C,expenses:U,updated_at:new Date().toISOString()};r(l,u,h,F);try{await i(l,u,h)}catch(O){console.warn("[useUpdateExpense] Failed to recalculate month and cascade:",O)}if(S?.trim()){const O=t.getQueryData(ke.payees(l))||[],D=await vm(l,S,O);D&&t.setQueryData(ke.payees(l),D)}if(e.type==="month"&&e.year===u&&e.month===h)try{await n(l,"month",u,h)}catch(O){console.warn("[useUpdateExpense] Failed to save current document immediately:",O)}return{updatedMonth:F}},isPending:!1,isError:!1,error:null}}function Z6(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=vn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{deleteExpense:async(o,l,u,h)=>{const f=await Gr(o,l,u);if(!f)throw new Error(`Month not found: ${l}/${u}`);const p=(f.expenses||[]).filter(b=>b.id!==h),g={...f,expenses:p,updated_at:new Date().toISOString()};n(o,l,u,g);try{await r(o,l,u)}catch(b){console.warn("[useDeleteExpense] Failed to recalculate month and cascade:",b)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(b){console.warn("[useDeleteExpense] Failed to save current document immediately:",b)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function J6(t,e){const n={id:e,amount:t.amount,from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function e3(){const t=Ht(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=vn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=pr(),o=Gn({onMutate:async u=>{const{budgetId:h,year:f,month:p}=u,g=ke.month(h,f,p);await t.cancelQueries({queryKey:g});const _=t.getQueryData(g),b=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,S=J6(u,b);if(_?.month){const E={..._.month,transfers:[..._.month.transfers||[],S],updated_at:new Date().toISOString()};r(h,f,p,E)}try{await i(h,f,p)}catch(E){console.warn("[useAddTransfer] Failed to recalculate month and cascade:",E)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(E){console.warn("[useAddTransfer] Failed to save current document immediately:",E)}return{previousData:_,transferId:b,newTransfer:S}},mutationFn:async u=>{const{budgetId:h,year:f,month:p}=u,g=ke.month(h,f,p),_=t.getQueryData(g);if(!_?.month)throw new Error("No month data in cache after optimistic update");const b=_.month,S=b.transfers?.[b.transfers.length-1];if(!S)throw new Error("Could not find new transfer in updated month");return{updatedMonth:b,newTransfer:S}},onError:(u,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:_}=h;t.setQueryData(ke.month(p,g,_),f.previousData)}}});return{addTransfer:async(u,h,f,p,g,_,b,S,x,E,C)=>o.mutateAsync({budgetId:u,year:h,month:f,amount:p,fromAccountId:g,toAccountId:_,fromCategoryId:b,toCategoryId:S,date:x,description:E,cleared:C}),isPending:o.isPending,isError:o.isError,error:o.error}}function t3(t,e,n,r,i,o,l,u,h){if(!t)return!0;const f=t.description||void 0,p=u||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||i!==t.from_category_id||o!==t.to_category_id||l!==t.date||p!==f||h!==t.cleared}function n3(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=vn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{updateTransfer:async(o,l,u,h,f,p,g,_,b,S,x,E)=>{const C=await Gr(o,l,u);if(!C)throw new Error(`Month not found: ${l}/${u}`);const T=(C.transfers||[]).find(O=>O.id===h);if(!t3(T,f,p,g,_,b,S,x,E))return{updatedMonth:C,noOp:!0};const A={id:h,amount:f,from_account_id:p,to_account_id:g,from_category_id:_,to_category_id:b,date:S,created_at:C.transfers?.find(O=>O.id===h)?.created_at||new Date().toISOString()};x&&(A.description=x),E!==void 0&&(A.cleared=E);const U=(C.transfers||[]).map(O=>O.id===h?A:O),F={...C,transfers:U,updated_at:new Date().toISOString()};n(o,l,u,F);try{await r(o,l,u)}catch(O){console.warn("[useUpdateTransfer] Failed to recalculate month and cascade:",O)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(O){console.warn("[useUpdateTransfer] Failed to save current document immediately:",O)}return{updatedMonth:F}},isPending:!1,isError:!1,error:null}}function r3(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=vn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{deleteTransfer:async(o,l,u,h)=>{const f=await Gr(o,l,u);if(!f)throw new Error(`Month not found: ${l}/${u}`);const p=(f.transfers||[]).filter(b=>b.id!==h),g={...f,transfers:p,updated_at:new Date().toISOString()};n(o,l,u,g);try{await r(o,l,u)}catch(b){console.warn("[useDeleteTransfer] Failed to recalculate month and cascade:",b)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(b){console.warn("[useDeleteTransfer] Failed to save current document immediately:",b)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function s3(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function i3(){const t=Ht(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=vn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=pr(),o=Gn({onMutate:async u=>{const{budgetId:h,year:f,month:p}=u,g=ke.month(h,f,p);await t.cancelQueries({queryKey:g});const _=t.getQueryData(g),b=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,S=s3(u,b);if(_?.month){const E={..._.month,adjustments:[..._.month.adjustments||[],S],updated_at:new Date().toISOString()};r(h,f,p,E)}try{await i(h,f,p)}catch(E){console.warn("[useAddAdjustment] Failed to recalculate month and cascade:",E)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(E){console.warn("[useAddAdjustment] Failed to save current document immediately:",E)}return{previousData:_,adjustmentId:b,newAdjustment:S}},mutationFn:async u=>{const{budgetId:h,year:f,month:p}=u,g=ke.month(h,f,p),_=t.getQueryData(g);if(!_?.month)throw new Error("No month data in cache after optimistic update");const b=_.month,S=b.adjustments?.[b.adjustments.length-1];if(!S)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:b,newAdjustment:S}},onError:(u,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:_}=h;t.setQueryData(ke.month(p,g,_),f.previousData)}}});return{addAdjustment:async(u,h,f,p,g,_,b,S,x,E)=>o.mutateAsync({budgetId:u,year:h,month:f,amount:p,accountId:g,categoryId:_,date:b,payee:S,description:x,cleared:E}),isPending:o.isPending,isError:o.isError,error:o.error}}function a3(t,e,n,r,i,o,l,u){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||i!==t.date||f!==h||g!==p||u!==t.cleared}function o3(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=vn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{updateAdjustment:async(o,l,u,h,f,p,g,_,b,S,x)=>{const E=await Gr(o,l,u);if(!E)throw new Error(`Month not found: ${l}/${u}`);const C=(E.adjustments||[]).find(H=>H.id===h);if(!a3(C,f,p,g,_,b,S,x))return{updatedMonth:E,noOp:!0};const T={id:h,amount:f,account_id:p,category_id:g,date:_,created_at:E.adjustments?.find(H=>H.id===h)?.created_at||new Date().toISOString()};b?.trim()&&(T.payee=b.trim()),S&&(T.description=S),x!==void 0&&(T.cleared=x);const A=(E.adjustments||[]).map(H=>H.id===h?T:H),U={...E,adjustments:A,updated_at:new Date().toISOString()};n(o,l,u,U);try{await r(o,l,u)}catch(H){console.warn("[useUpdateAdjustment] Failed to recalculate month and cascade:",H)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(H){console.warn("[useUpdateAdjustment] Failed to save current document immediately:",H)}return{updatedMonth:U}},isPending:!1,isError:!1,error:null}}function l3(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=vn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{deleteAdjustment:async(o,l,u,h)=>{const f=await Gr(o,l,u);if(!f)throw new Error(`Month not found: ${l}/${u}`);const p=(f.adjustments||[]).filter(b=>b.id!==h),g={...f,adjustments:p,updated_at:new Date().toISOString()};n(o,l,u,g);try{await r(o,l,u)}catch(b){console.warn("[useDeleteAdjustment] Failed to recalculate month and cascade:",b)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(b){console.warn("[useDeleteAdjustment] Failed to save current document immediately:",b)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function c3(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??vt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function u3(t){const e=new Date,n=e.getFullYear(),r=e.getMonth()+1;let i=n,o=r-3;for(;o<=0;)o+=12,i-=1;const l=vt(i,o);return(await kn("months","useInitialDataLoad: loading initial months",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:l}])).docs.map(f=>{const p=f.data,g=p.year,_=p.month;return c3(p,t,g,_)}).sort((f,p)=>f.year!==p.year?f.year-p.year:f.month-p.month)}async function d3(t){const[e,n,r]=await Promise.all([$0(t),G0(t),u3(t)]);return{budget:e,payees:n,months:r}}function h3(t,e){return Ro({queryKey:t?["initialDataLoad",t]:["initialDataLoad","none"],queryFn:()=>d3(t),enabled:!!t&&e?.enabled!==!1,staleTime:1/0})}const f3={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",currentViewingDocument:{type:null},setCurrentViewingDocument:()=>{},setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,initialDataLoadComplete:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},DT=k.createContext(f3);function m3({children:t}){const n=Da().get_current_firebase_user(),[r,i]=k.useState(null),[o,l]=k.useState(new Date().getFullYear()),[u,h]=k.useState(new Date().getMonth()+1),[f,p]=k.useState("categories"),[g,_]=k.useState("categories"),[b,S]=k.useState("budget"),[x,E]=k.useState("Budget"),C=k.useCallback(de=>{E(Se=>Se===de?Se:de)},[]),[T,A]=k.useState({type:null}),[U,F]=k.useState(!1),[H,O]=k.useState(!1),D=s6(n?.uid||null,n?.email||null),P=D.data&&D.data.budget_ids.length===0,L=a6(n?.uid||null,D.data||null,{enabled:!!n?.uid&&!!D.data&&P}),q=h3(r,{enabled:!!r&&U}),[j,M]=k.useState(!1);k.useEffect(()=>{if(!q.data){M(!1);return}const{budget:de,payees:Se,months:Te}=q.data,Ee=Date.now();Ue.setQueryData(ke.budget(r),de,{updatedAt:Ee}),Ue.setQueryData(ke.payees(r),Se,{updatedAt:Ee});for(const pe of Te)Ue.setQueryData(ke.month(r,pe.year,pe.month),{month:pe},{updatedAt:Ee});M(!0)},[q.data,r]),k.useEffect(()=>{r||M(!1)},[r]);const R=D.data?.permission_flags?.is_admin===!0,K=D.data?.permission_flags?.is_test===!0,Q=L.data?.pendingInvites||[],G=L.data?.budgets||[],X=Q.length>0;k.useEffect(()=>{if(!n||U||D.isLoading)return;const de=D.data;if(!(!de&&!D.isError))if(de&&de.budget_ids.length>0)i(de.budget_ids[0]),O(!1),F(!0);else{if(L.isLoading)return;const Se=L.data;O(!(Se?.pendingInvites&&Se.pendingInvites.length>0)),F(!0)}},[n,U,D.data,D.isLoading,D.isError,L.data,L.isLoading]);const J=k.useCallback(()=>{u===1?(l(de=>de-1),h(12)):h(de=>de-1)},[u]),re=k.useCallback(()=>{u===12?(l(de=>de+1),h(1)):h(de=>de+1)},[u]),B=k.useCallback(async de=>{(de?.force||!L.data)&&await L.refetch()},[L]),$=k.useCallback(de=>{i(de),O(!1)},[]),te=k.useCallback(async de=>{if(!n)return null;try{const Se=await E6(de,n.uid);return Se&&Se.isInvited&&!Se.hasAccepted?{budgetId:de,budgetName:Se.budgetName,ownerEmail:Se.ownerEmail}:null}catch(Se){return console.error("[BudgetContext] Error checking budget invite:",Se),null}},[n]),ae=k.useCallback(()=>{Ue.clear()},[]),ne={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:u,lastActiveTab:f,lastSettingsTab:g,lastAdminTab:b,currentViewingDocument:T,setCurrentViewingDocument:A,setSelectedBudgetId:i,setCurrentYear:l,setCurrentMonthNumber:h,setLastActiveTab:p,setLastSettingsTab:_,setLastAdminTab:S,pageTitle:x,setPageTitle:C,isInitialized:U,needsFirstBudget:H,initialDataLoadComplete:j,goToPreviousMonth:J,goToNextMonth:re,pendingInvites:Q,hasPendingInvites:X,accessibleBudgets:G,isAdmin:R,isTest:K,loadAccessibleBudgets:B,switchToBudget:$,checkBudgetInvite:te,clearCache:ae};return d.jsx(DT.Provider,{value:ne,children:t})}function Ze(){const t=k.useContext(DT);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const p3=function(){},g3={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:p3},ud=k.createContext(g3);function qs(t=B4){const[e,n]=k.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return k.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function i(l){n(l.matches)}i(r),r.addEventListener("change",i);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",i),window.removeEventListener("resize",o)}},[t]),e}function kT(){const[t,e]=k.useState(()=>typeof window>"u"?1200:window.innerWidth);return k.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=go.wide,isMedium:t>=go.tablet&&t<go.wide,isNarrowMedium:t>=go.mobile&&t<go.tablet,isMobile:t<go.mobile}}function An(){const{selectedBudgetId:t,currentUserId:e}=Ze(),n=q4(t),r=n.data,i=r?.budget||null,o=k.useMemo(()=>r?.accounts||{},[r?.accounts]),l=k.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),u=k.useMemo(()=>r?.categories||{},[r?.categories]),h=k.useMemo(()=>r?.categoryGroups||[],[r?.categoryGroups]),f=i?.owner_id===e,p=k.useMemo(()=>i?.user_ids||[],[i?.user_ids]),g=k.useMemo(()=>i?.accepted_user_ids||[],[i?.accepted_user_ids]),_=i?.total_available??0,b=k.useMemo(()=>r?.monthMap||{},[r?.monthMap]),S=k.useCallback(U=>{if(!t)return;const F=Ue.getQueryData(ke.budget(t));F&&Ue.setQueryData(ke.budget(t),{...F,accounts:U})},[t]),x=k.useCallback(U=>{if(!t)return;const F=Ue.getQueryData(ke.budget(t));F&&Ue.setQueryData(ke.budget(t),{...F,accountGroups:U})},[t]),E=k.useCallback(U=>{if(!t)return;const F=Ue.getQueryData(ke.budget(t));F&&Ue.setQueryData(ke.budget(t),{...F,categories:U})},[t]),C=k.useCallback(U=>{if(!t)return;const F=Ue.getQueryData(ke.budget(t));F&&Ue.setQueryData(ke.budget(t),{...F,categoryGroups:U})},[t]),T=k.useCallback(async()=>{t&&await Ue.invalidateQueries({queryKey:ke.budget(t)})},[t]),A=k.useCallback(()=>Object.entries(o).filter(([,U])=>{const F=U.account_group_id?l[U.account_group_id]:void 0,H=F&&F.on_budget!==null?F.on_budget:U.on_budget!==!1,O=F&&F.is_active!==null?F.is_active:U.is_active!==!1;return H&&O}).reduce((U,[,F])=>U+F.balance,0),[o,l]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:i,accounts:o,accountGroups:l,categories:u,categoryGroups:h,isOwner:f,budgetUserIds:p,acceptedUserIds:g,totalAvailable:_,monthMap:b,setAccountsOptimistic:S,setAccountGroupsOptimistic:x,setCategoriesOptimistic:E,setCategoryGroupsOptimistic:C,refreshBudget:T,getOnBudgetTotal:A}}function Ei(t,e,n){const{addLoadingHold:r,removeLoadingHold:i}=sr(),o=Ht(),l=n6(t,e,n,{enabled:!!t});k.useEffect(()=>{const T=t?ke.month(t,e,n):null;return!(T?o.getQueryData(T):null)&&l.isLoading?r("month-query","Loading month data..."):i("month-query"),()=>i("month-query")},[l.isLoading,t,e,n,o,r,i]);const u=l.data?.month||null,h=k.useMemo(()=>u?.income||[],[u?.income]),f=k.useMemo(()=>u?.expenses||[],[u?.expenses]),p=k.useMemo(()=>u?.transfers||[],[u?.transfers]),g=k.useMemo(()=>u?.adjustments||[],[u?.adjustments]),_=k.useMemo(()=>u?.category_balances||[],[u?.category_balances]),b=k.useMemo(()=>u?.account_balances||[],[u?.account_balances]),S=u?.total_income||0,x=u?.total_expenses||0,E=u?.are_allocations_finalized||!1,C=u?.previous_month_income??0;return{isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,month:u,income:h,expenses:f,transfers:p,adjustments:g,categoryBalances:_,accountBalances:b,totalIncome:S,totalExpenses:x,areAllocationsFinalized:E,previousMonthIncome:C}}function xm(){const{trackChange:t}=mc();return{updateBudgetCacheAndTrack:(n,r)=>{Ue.setQueryData(ke.budget(n),r),t({type:"budget",budgetId:n})}}}function OT(){const t=Ht(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=vn(),{updateBudgetCacheAndTrack:r}=xm(),i=Gn({onMutate:async l=>{const{budgetId:u,accounts:h}=l,f=ke.budget(u);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const _={...p,accounts:h};r(u,_)}if(e.type==="budget")try{await n(u,"budget")}catch(_){console.warn("[useUpdateAccounts] Failed to save current document immediately:",_)}return{previousData:p}},mutationFn:async l=>{const{accounts:u}=l;return{accounts:u}},onError:(l,u,h)=>{h?.previousData&&t.setQueryData(ke.budget(u.budgetId),h.previousData)}});return{updateAccounts:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function y3(){const t=Ht(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=vn(),{updateBudgetCacheAndTrack:r}=xm(),i=Gn({onMutate:async l=>{const{budgetId:u,accountGroups:h}=l,f=ke.budget(u);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const _={...p,accountGroups:h};r(u,_)}if(e.type==="budget")try{await n(u,"budget")}catch(_){console.warn("[useUpdateAccountGroups] Failed to save current document immediately:",_)}return{previousData:p}},mutationFn:async l=>{const{accountGroups:u}=l;return{accountGroups:u}},onError:(l,u,h)=>{h?.previousData&&t.setQueryData(ke.budget(u.budgetId),h.previousData)}});return{updateAccountGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function MT(){const t=Ht(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=vn(),{updateBudgetCacheAndTrack:r}=xm(),i=Gn({onMutate:async l=>{const{budgetId:u,categories:h}=l,f=ke.budget(u);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const _={...p,categories:h};r(u,_)}if(e.type==="budget")try{await n(u,"budget")}catch(_){console.warn("[useUpdateCategories] Failed to save current document immediately:",_)}return{previousData:p}},mutationFn:async l=>{const{categories:u}=l;return{categories:u}},onError:(l,u,h)=>{h?.previousData&&t.setQueryData(ke.budget(u.budgetId),h.previousData)}});return{updateCategories:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function _3(){const t=Ht(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=vn(),{updateBudgetCacheAndTrack:r}=xm(),i=Gn({onMutate:async l=>{const{budgetId:u,categoryGroups:h}=l,f=ke.budget(u);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const _={...p,categoryGroups:h};r(u,_)}if(e.type==="budget")try{await n(u,"budget")}catch(_){console.warn("[useUpdateCategoryGroups] Failed to save current document immediately:",_)}return{previousData:p}},mutationFn:async l=>{const{categoryGroups:u}=l;return{categoryGroups:u}},onError:(l,u,h)=>{h?.previousData&&t.setQueryData(ke.budget(u.budgetId),h.previousData)}});return{updateCategoryGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function b3(){const t=Ht(),e=Gn({onMutate:async r=>{const{budgetId:i,newName:o}=r,l=ke.budget(i);await t.cancelQueries({queryKey:l});const u=t.getQueryData(l);return u&&t.setQueryData(l,{...u,budget:{...u.budget,name:o.trim()}}),{previousData:u}},mutationFn:async r=>{const{budgetId:i,newName:o}=r,l=o.trim();return await _m({budgetId:i,updates:{name:l},description:`renaming budget to "${l}"`}),{newName:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.budget(i.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function v3({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:i,saveAccounts:o,saveAccountGroups:l,setError:u}){const h=k.useCallback(async(p,g,_)=>{const b=e[p];if(!b)return;const S=_==="ungrouped"?Xt:_,x=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===_),E={};Object.entries(e).forEach(([T,A])=>{T!==p&&(E[T]={...A})});let C;if(g==="__group_end__"||x.length===0||!x.find(([T])=>T===g))C=(x.length>0?Math.max(...x.filter(([A])=>A!==p).map(([,A])=>A.sort_order)):-1)+1;else{const T=x.find(([A])=>A===g);if(T){const[,A]=T;C=A.sort_order,Object.entries(E).forEach(([U,F])=>{(F.account_group_id||"ungrouped")===_&&F.sort_order>=C&&(E[U]={...F,sort_order:F.sort_order+1})})}else C=0}if(E[p]={...b,account_group_id:S,sort_order:C},r(E),!!t)try{await o(E)}catch(T){u(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,u]),f=k.useCallback(async(p,g)=>{if(p===g)return;const _=Object.entries(n).sort(([,C],[,T])=>C.sort_order-T.sort_order),b=_.findIndex(([C])=>C===p),S=[..._],[x]=S.splice(b,1);if(g==="__end__")S.push(x);else{const C=S.findIndex(([T])=>T===g);S.splice(C,0,x)}const E={};if(S.forEach(([C,T],A)=>{E[C]={...T,sort_order:A}}),i(E),!!t)try{await l(E)}catch(C){u(C instanceof Error?C.message:"Failed to save new order")}},[t,n,i,l,u]);return{reorderAccountsInGroup:h,reorderGroups:f}}function x3(){const{selectedBudgetId:t}=Ze(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o}=An(),{updateAccounts:l}=OT(),{updateAccountGroups:u}=y3(),[h,f]=k.useState(null),p=k.useCallback(async L=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accounts:L})},[t,l]),g=k.useCallback(async L=>{if(!t)throw new Error("No budget selected");await u.mutateAsync({budgetId:t,accountGroups:L})},[t,u]),_=k.useCallback(async(L,q)=>{if(!t)throw new Error("No budget selected");await Promise.all([l.mutateAsync({budgetId:t,accounts:L}),u.mutateAsync({budgetId:t,accountGroups:q})])},[t,l,u]),b=k.useMemo(()=>Object.entries(n).filter(([,L])=>!L.is_hidden).reduce((L,[q,j])=>{const M=j.account_group_id||Xt;return L[M]||(L[M]=[]),L[M].push({...j,id:q}),L},{}),[n]),S=k.useMemo(()=>Object.entries(n).filter(([,L])=>L.is_hidden).map(([L,q])=>({...q,id:L})).sort((L,q)=>L.sort_order-q.sort_order),[n]),x=k.useMemo(()=>Object.entries(r).sort(([,L],[,q])=>L.sort_order-q.sort_order).map(([L,q])=>({...q,id:L})),[r]),E=k.useCallback((L,q)=>{if(!e)return;const j=q||Xt,M=Object.values(n).filter(X=>X.account_group_id===j),R=M.length>0?Math.max(...M.map(X=>X.sort_order)):-1,K=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,Q={nickname:L.nickname,description:"",balance:0,account_group_id:j,sort_order:R+1,is_income_account:L.is_income_account??!1,is_income_default:L.is_income_default??!1,is_outgo_account:L.is_outgo_account??!1,is_outgo_default:L.is_outgo_default??!1,on_budget:L.on_budget!==!1,is_active:L.is_active!==!1,is_hidden:L.is_hidden??!1},G={...n};L.is_income_default&&Object.keys(G).forEach(X=>{G[X]={...G[X],is_income_default:!1}}),L.is_outgo_default&&Object.keys(G).forEach(X=>{G[X]={...G[X],is_outgo_default:!1}}),G[K]=Q,i(G),p(G).catch(X=>f(X instanceof Error?X.message:"Failed to create account."))},[e,n,i,p]),C=k.useCallback((L,q)=>{if(!e)return;const j=n[L];if(!j)return;const M=j.account_group_id||Xt,R=q.account_group_id||Xt;let K=j.sort_order;if(M!==R){const G=Object.values(n).filter(X=>X.account_group_id===R);K=G.length>0?Math.max(...G.map(X=>X.sort_order))+1:0}const Q={};Object.entries(n).forEach(([G,X])=>{G===L?Q[G]={...X,nickname:q.nickname,account_group_id:R,sort_order:K,is_income_account:q.is_income_account??!1,is_income_default:q.is_income_default??!1,is_outgo_account:q.is_outgo_account??!1,is_outgo_default:q.is_outgo_default??!1,on_budget:q.on_budget!==!1,is_active:q.is_active!==!1,is_hidden:q.is_hidden??!1}:(Q[G]={...X},q.is_income_default&&!j.is_income_default&&(Q[G].is_income_default=!1),q.is_outgo_default&&!j.is_outgo_default&&(Q[G].is_outgo_default=!1))}),i(Q),p(Q).catch(G=>f(G instanceof Error?G.message:"Failed to save account."))},[e,n,i,p]),T=k.useCallback(L=>{if(!confirm("Are you sure you want to delete this account?")||!e)return;const{[L]:q,...j}=n;i(j),p(j).catch(M=>f(M instanceof Error?M.message:"Failed to delete account."))},[e,n,i,p]),A=k.useCallback(async(L,q)=>{const j=n[L];if(!j)return;const M=j.account_group_id||Xt,R=Object.entries(n).filter(([,re])=>re.account_group_id===M).sort(([,re],[,B])=>re.sort_order-B.sort_order),K=R.findIndex(([re])=>re===L),Q=q==="up"?K-1:K+1;if(Q<0||Q>=R.length)return;const[G,X]=R[Q],J={};if(Object.entries(n).forEach(([re,B])=>{re===L?J[re]={...B,sort_order:X.sort_order}:re===G?J[re]={...B,sort_order:j.sort_order}:J[re]={...B}}),i(J),!!e)try{await p(J)}catch(re){i(n),f(re instanceof Error?re.message:"Failed to move account")}},[e,n,i,p]),U=k.useCallback(L=>{if(!e)return;const q=Object.values(r).map(Q=>Q.sort_order),j=q.length>0?Math.max(...q):-1,M=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,R={name:L.name,sort_order:j+1,expected_balance:L.expected_balance,on_budget:L.on_budget??null,is_active:L.is_active??null},K={...r,[M]:R};o(K),g(K).catch(Q=>f(Q instanceof Error?Q.message:"Failed to create account type."))},[e,r,o,g]),F=k.useCallback((L,q)=>{if(!e)return;const j={...r,[L]:{...r[L],name:q.name,expected_balance:q.expected_balance,on_budget:q.on_budget??null,is_active:q.is_active??null}};o(j),g(j).catch(M=>f(M instanceof Error?M.message:"Failed to update account type."))},[e,r,o,g]),H=k.useCallback(L=>{if(L===Xt){alert("Cannot delete the default Ungrouped account type.");return}if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e)return;const q={};Object.entries(n).forEach(([R,K])=>{q[R]=K.account_group_id===L?{...K,account_group_id:Xt}:K});const{[L]:j,...M}=r;i(q),o(M),_(q,M).catch(R=>f(R instanceof Error?R.message:"Failed to delete account type."))},[e,n,r,i,o,_]),O=k.useCallback(async(L,q)=>{const j=Object.entries(r).sort(([,G],[,X])=>G.sort_order-X.sort_order),M=j.findIndex(([G])=>G===L),R=q==="up"?M-1:M+1;if(R<0||R>=j.length)return;const[K]=j.splice(M,1);j.splice(R,0,K);const Q={};if(j.forEach(([G,X],J)=>{Q[G]={...X,sort_order:J}}),o(Q),!!e)try{await g(Q)}catch(G){o(r),f(G instanceof Error?G.message:"Failed to move account type")}},[e,r,o,g]),{reorderAccountsInGroup:D,reorderGroups:P}=v3({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o,saveAccounts:p,saveAccountGroups:g,setError:f});return{accounts:n,accountGroups:r,accountsByGroup:b,hiddenAccounts:S,sortedGroups:x,currentBudget:e,error:h,setError:f,handleCreateAccount:E,handleUpdateAccount:C,handleDeleteAccount:T,handleMoveAccount:A,handleCreateGroup:U,handleUpdateGroup:F,handleDeleteGroup:H,handleMoveGroup:O,reorderAccountsInGroup:D,reorderGroups:P}}function P1(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,i])=>{if(i.default_monthly_type==="percentage")return;const o=t.category_balances?.find(l=>l.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():i.default_monthly_amount!==void 0&&i.default_monthly_amount>0?n[r]=i.default_monthly_amount.toString():n[r]=""}),n}function w3(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Ze(),{categories:o,getOnBudgetTotal:l,totalAvailable:u}=An(),{month:h,isLoading:f,previousMonthIncome:p,areAllocationsFinalized:g}=Ei(n,r,i),_=k.useMemo(()=>h?.income?h.income.reduce((B,$)=>B+$.amount,0):0,[h]),{saveDraftAllocations:b}=R6(),{finalizeAllocations:S}=V6(),{deleteAllocations:x}=IT(),E=k.useMemo(()=>P1(h,o),[h,o]),[C,T]=k.useState(E),[A,U]=k.useState(!1),[F,H]=k.useState(null),O=k.useRef(null);k.useMemo(()=>Object.values(o).reduce((B,$)=>B+($.balance??0),0),[o]),k.useEffect(()=>{if(!h)return;const B=`${h.year}-${h.month}`;O.current!==B&&(U(!1),T(P1(h,o)),O.current=B)},[h,o]);const D=k.useCallback((B,$)=>{if($.default_monthly_type==="percentage"&&$.default_monthly_amount!==void 0)return Me($.default_monthly_amount/100*p);const te=C[B],ae=parseFloat(te||"0");return isNaN(ae)?0:Me(ae)},[C,p]),P=k.useMemo(()=>Object.entries(o).reduce((B,[$,te])=>{const ae=D($,te),ne=te.balance??0;if(ne<0){const de=Math.abs(ne),Se=Math.max(0,ae-de);return B+Se}return B+ae},0),[o,D]),L=l(),q=g?(h?.category_balances||[]).reduce((B,$)=>{const te=o[$.category_id]?.balance??0,ae=$.allocated,ne=te-ae;if(ne<0){const de=Math.abs(ne);return B+Math.max(0,ae-de)}return B+ae},0):0,j=A?u+q:u,M=k.useMemo(()=>A?j-P:j-P+q,[j,P,q,A]),R=k.useCallback((B,$)=>{T(te=>({...te,[B]:$}))},[]),K=k.useCallback(()=>{if(!h)return;const B={};Object.entries(o).forEach(([$,te])=>{if(te.default_monthly_type==="percentage")return;const ae=h.category_balances?.find(ne=>ne.category_id===$);ae&&ae.allocated>0?B[$]=ae.allocated.toString():te.default_monthly_amount!==void 0&&te.default_monthly_amount>0?B[$]=te.default_monthly_amount.toString():B[$]=""}),T(B),U(!1)},[h,o]),Q=k.useCallback(()=>{const B={};return Object.entries(o).forEach(([$,te])=>{const ae=D($,te);ae>0&&(B[$]=ae)}),B},[o,D]),G=k.useCallback(async()=>{if(n){H(null),t("allocations-save","Saving allocations...");try{await b(n,r,i,Q()),U(!1)}catch(B){H(B instanceof Error?B.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,r,i,b,Q,t,e]),X=k.useCallback(async()=>{if(n){H(null),t("allocations-finalize","Applying allocations...");try{await S({budgetId:n,year:r,month:i,allocations:Q(),onProgress:B=>{t("allocations-finalize",B.message)}}),U(!1)}catch(B){H(B instanceof Error?B.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,r,i,S,Q,t,e]),J=k.useCallback(async()=>{if(n){H(null),t("allocations-delete","Deleting allocations...");try{await x({budgetId:n,year:r,month:i,onProgress:$=>{t("allocations-delete",$.message)}});const B={};Object.entries(o).forEach(([$,te])=>{te.default_monthly_type!=="percentage"&&(te.default_monthly_amount!==void 0&&te.default_monthly_amount>0?B[$]=te.default_monthly_amount.toString():B[$]="")}),T(B),U(!1)}catch(B){H(B instanceof Error?B.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,r,i,x,o,t,e]),re=P-q;return{localAllocations:C,isEditingAppliedAllocations:A,error:F,monthLoading:f,onBudgetTotal:L,availableNow:j,currentDraftTotal:P,draftChangeAmount:re,availableAfterApply:M,previousMonthIncome:p,currentMonthIncome:_,allocationsFinalized:g,getAllocationAmount:D,handleAllocationChange:R,resetAllocationsToSaved:K,handleSaveAllocations:G,handleFinalizeAllocations:X,handleDeleteAllocations:J,setIsEditingAppliedAllocations:U,setError:H}}function S3({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:i}){const o=k.useMemo(()=>{const _={};return Object.entries(e).forEach(([b,S])=>{_[b]={current:S.balance??0,total:S.balance??0}}),_},[e]),[l,u]=k.useState(!1),[h,f]=k.useState(null),p=k.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const _=Object.keys(e),{total:b}=await N1(t,_,n,r),S={};Object.entries(e).forEach(([E,C])=>{const T=C.balance,A=b[E]??0;Math.abs(T-A)>.01&&(S[E]={stored:T,calculated:A})});const x=Object.keys(S).length>0?S:null;return f(x),x},[t,e,n,r]),g=k.useCallback(async()=>{if(!(!t||Object.keys(e).length===0)){u(!0);try{const _=Object.keys(e),{total:b}=await N1(t,_,n,r),S={};Object.entries(e).forEach(([x,E])=>{S[x]={...E,balance:b[x]??0}}),await i(S),f(null)}finally{u(!1)}}},[t,e,i,n,r]);return{categoryBalances:o,loadingBalances:l,categoryBalanceMismatch:h,checkCategoryBalanceMismatch:p,recalculateAndSaveCategoryBalances:g}}function E3({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:i,saveCategories:o,saveCategoryGroups:l,setError:u}){const[h,f]=k.useState(null),[p,g]=k.useState(null),[_,b]=k.useState(null),[S,x]=k.useState(null);function E(L,q){f("category"),g(q),L.dataTransfer.effectAllowed="move"}function C(L,q,j){L.preventDefault(),h==="category"&&(q!==p&&b(q),x(j))}function T(L,q){L.preventDefault(),h==="category"?(x(q),b(null)):h==="group"&&q!==p&&b(q)}function A(){b(null)}function U(){x(null)}function F(){f(null),g(null),b(null),x(null)}async function H(L,q,j){if(L.preventDefault(),L.stopPropagation(),!p||h!=="category"){F();return}const M=t[p];if(!M)return;const R=j==="ungrouped"?nn:j,K=Object.entries(t).filter(([,X])=>(X.category_group_id||"ungrouped")===j),Q={};Object.entries(t).forEach(([X,J])=>{X!==p&&(Q[X]=J)});let G;if(q==="__group_end__"||K.length===0||!K.find(([X])=>X===q))G=(K.length>0?Math.max(...K.filter(([J])=>J!==p).map(([,J])=>J.sort_order)):-1)+1;else{const X=K.find(([J])=>J===q);X?(G=X[1].sort_order,Object.entries(Q).forEach(([J,re])=>{(re.category_group_id||"ungrouped")===j&&re.sort_order>=G&&(Q[J]={...re,sort_order:re.sort_order+1})})):G=0}if(Q[p]={...M,category_group_id:R,sort_order:G},r(Q),F(),!!n)try{await o(Q)}catch(X){u(X instanceof Error?X.message:"Failed to save changes")}}async function O(L,q){L.preventDefault(),h==="category"?await H(L,"__group_end__",q):h==="group"&&await P(L,q)}function D(L,q){L.stopPropagation(),f("group"),g(q),L.dataTransfer.effectAllowed="move"}async function P(L,q){if(L.preventDefault(),!p||h!=="group"||p===q){F();return}const j=e.findIndex(Q=>Q.id===p),M=[...e],[R]=M.splice(j,1);if(q==="__end__")M.push(R);else{const Q=M.findIndex(G=>G.id===q);M.splice(Q,0,R)}const K=M.map((Q,G)=>({...Q,sort_order:G}));if(i(K),F(),!!n)try{await l(K)}catch(Q){u(Q instanceof Error?Q.message:"Failed to save new order")}}return{dragType:h,draggedId:p,dragOverId:_,dragOverGroupId:S,setDragOverId:b,setDragOverGroupId:x,handleCategoryDragStart:E,handleCategoryDragOver:C,handleDragOverGroup:T,handleDragLeave:A,handleDragLeaveGroup:U,handleDragEnd:F,handleCategoryDrop:H,handleDropOnGroup:O,handleGroupDragStart:D,handleGroupDrop:P}}function C3(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ze(),{budget:r,categories:i,categoryGroups:o,isLoading:l,setCategoriesOptimistic:u,setCategoryGroupsOptimistic:h,getOnBudgetTotal:f}=An(),{updateCategories:p}=MT(),{updateCategoryGroups:g}=_3(),[_,b]=k.useState(null),S=k.useCallback(async X=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:X})},[t,p]),x=k.useCallback(async X=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:X})},[t,g]),E=k.useCallback(async(X,J)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:X}),g.mutateAsync({budgetId:t,categoryGroups:J})])},[t,p,g]),{categoryBalances:C,loadingBalances:T,categoryBalanceMismatch:A,checkCategoryBalanceMismatch:U,recalculateAndSaveCategoryBalances:F}=S3({budgetId:t,categories:i,currentYear:e,currentMonth:n,updateCategoriesWithBalances:S}),H=E3({categories:i,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:u,setCategoryGroupsOptimistic:h,saveCategories:S,saveCategoryGroups:x,setError:b});async function O(X,J){if(!r)return;const re=J||nn,B=Object.values(i).filter(de=>de.category_group_id===re),$=B.length>0?Math.max(...B.map(de=>de.sort_order)):-1,te=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,ae={name:X.name,description:X.description??"",category_group_id:re,sort_order:$+1,default_monthly_amount:X.default_monthly_amount??0,default_monthly_type:X.default_monthly_type??"fixed",balance:0,is_hidden:X.is_hidden??!1},ne={...i,[te]:ae};u(ne);try{await S(ne)}catch(de){u(i),b(de instanceof Error?de.message:"Failed to create category")}}async function D(X,J){if(r)try{const re=i[X];if(!re)return;const B=re.category_group_id||nn,$=J.category_group_id||nn;let te=re.sort_order;if(B!==$){const ne=Object.values(i).filter(de=>de.category_group_id===$).filter((de,Se,Te)=>i[X]!==Te[Se]);te=ne.length>0?Math.max(...ne.map(de=>de.sort_order))+1:0}const ae={...i,[X]:{...re,name:J.name,description:J.description??"",category_group_id:$,sort_order:te,default_monthly_amount:J.default_monthly_amount??0,default_monthly_type:J.default_monthly_type??"fixed",is_hidden:J.is_hidden??!1}};u(ae),await S(ae)}catch(re){b(re instanceof Error?re.message:"Failed to update category")}}async function P(X){if(confirm("Are you sure you want to delete this category?")&&r)try{const{[X]:J,...re}=i;u(re),await S(re)}catch(J){b(J instanceof Error?J.message:"Failed to delete category")}}async function L(X,J){const re=i[X];if(!re)return;const B=re.category_group_id||nn,$=Object.entries(i).filter(([,Te])=>Te.category_group_id===B).sort((Te,Ee)=>Te[1].sort_order-Ee[1].sort_order),te=$.findIndex(([Te])=>Te===X),ae=J==="up"?te-1:te+1;if(ae<0||ae>=$.length)return;const[ne,de]=$[ae],Se={};if(Object.entries(i).forEach(([Te,Ee])=>{Te===X?Se[Te]={...Ee,sort_order:de.sort_order}:Te===ne?Se[Te]={...Ee,sort_order:re.sort_order}:Se[Te]=Ee}),u(Se),!!r)try{await S(Se)}catch(Te){u(i),b(Te instanceof Error?Te.message:"Failed to move category")}}async function q(X){if(r)try{const J=o.length>0?Math.max(...o.map($=>$.sort_order)):-1,re={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:X.name,sort_order:J+1},B=[...o,re];h(B),await x(B)}catch(J){b(J instanceof Error?J.message:"Failed to create group")}}async function j(X,J){if(r)try{const re=o.map(B=>B.id===X?{...B,name:J.name}:B);h(re),await x(re)}catch(re){b(re instanceof Error?re.message:"Failed to update group")}}async function M(X){if(X===nn){alert("Cannot delete the default Uncategorized category group.");return}if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const J={};Object.entries(i).forEach(([B,$])=>{J[B]=$.category_group_id===X?{...$,category_group_id:nn}:$});const re=o.filter(B=>B.id!==X);u(J),h(re),await E(J,re)}catch(J){b(J instanceof Error?J.message:"Failed to delete group")}}async function R(X,J){const re=[...o].sort((ne,de)=>ne.sort_order-de.sort_order),B=re.findIndex(ne=>ne.id===X),$=J==="up"?B-1:B+1;if($<0||$>=re.length)return;const[te]=re.splice(B,1);re.splice($,0,te);const ae=re.map((ne,de)=>({...ne,sort_order:de}));if(h(ae),!!r)try{await x(ae)}catch(ne){h(o),b(ne instanceof Error?ne.message:"Failed to move group")}}const K=Object.entries(i).filter(([,X])=>!X.is_hidden).reduce((X,[J,re])=>{const B=re.category_group_id||nn;return X[B]||(X[B]=[]),X[B].push([J,re]),X},{}),Q=Object.entries(i).filter(([,X])=>X.is_hidden).map(([X,J])=>[X,J]).sort((X,J)=>X[1].sort_order-J[1].sort_order),G=[...o].sort((X,J)=>X.sort_order-J.sort_order);return{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:K,hiddenCategories:Q,sortedGroups:G,categoryBalances:C,isLoading:l,loadingBalances:T,error:_,setError:b,getOnBudgetTotal:f,categoryBalanceMismatch:A,checkCategoryBalanceMismatch:U,recalculateAndSaveCategoryBalances:F,handleCreateCategory:O,handleUpdateCategory:D,handleDeleteCategory:P,handleMoveCategory:L,handleCreateGroup:q,handleUpdateGroup:j,handleDeleteGroup:M,handleMoveGroup:R,dragType:H.dragType,draggedId:H.draggedId,dragOverId:H.dragOverId,dragOverGroupId:H.dragOverGroupId,setDragOverId:H.setDragOverId,setDragOverGroupId:H.setDragOverGroupId,handleCategoryDragStart:H.handleCategoryDragStart,handleCategoryDragOver:H.handleCategoryDragOver,handleDragOverGroup:H.handleDragOverGroup,handleDragLeave:H.handleDragLeave,handleDragLeaveGroup:H.handleDragLeaveGroup,handleDragEnd:H.handleDragEnd,handleCategoryDrop:H.handleCategoryDrop,handleDropOnGroup:H.handleDropOnGroup,handleGroupDragStart:H.handleGroupDragStart,handleGroupDrop:H.handleGroupDrop}}function T3(t){switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return t.totalMonthsToFetch?`Loading ${t.totalMonthsToFetch} months...`:"Loading months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating balances...";case"saving":return t.totalMonths?`Saving ${t.totalMonths} months...`:"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating..."}}function dd({budgetId:t,year:e,month:n,monthMap:r,checkAnyMonth:i=!1,requireMonthLoaded:o=!1,currentMonth:l,additionalCondition:u=!0,onProgress:h,onError:f,logPrefix:p="[AutoRecalc]"}){const[g,_]=k.useState(null),b=k.useRef(!1),S=k.useRef(null),x=k.useRef(null),E=On(),C=k.useRef(null),{addLoadingHold:T,removeLoadingHold:A}=sr();return k.useEffect(()=>{if(!t||!u||o&&!l)return;let U;const F=E.pathname;if(i){C.current!==F&&(S.current=null,C.current=F);const D=ST(r);if(D.length===0||b.current||(U=`any-${D[0]}`,S.current===U))return}else{if(e===void 0||n===void 0){console.warn(`${p} year and month are required when checkAnyMonth is false`);return}const D=vt(e,n),P=r[D]?.needs_recalculation===!0;if(U=`${e}-${n}`,(C.current!==F||x.current!==U)&&(S.current=null,C.current=F,x.current=U),S.current===U)return;if(!P||b.current){S.current=U;return}`${e}${String(n).padStart(2,"0")}`}b.current=!0,S.current=U;const H=`recalc-${t}`;T(H,"Recalculating balances..."),x6(t,{onProgress:D=>{_(D);const P=T3(D);T(H,P),h?.(D)}}).then(()=>{Ue.invalidateQueries({queryKey:["month",t]})}).catch(D=>{const P=D instanceof Error?D:new Error(String(D));f?f(P):console.error(`${p} Recalculation failed:`,P)}).finally(()=>{b.current=!1,_(null),A(H)})},[t,e,n,r,i,o,l,u,h,f,p,E.pathname,T,A]),{recalcProgress:g,isRecalculating:g!==null}}function A3(){const t=On(),{saveAllChanges:e}=vn(),{hasChanges:n}=mc(),r=k.useRef(null);k.useEffect(()=>{const i=t.pathname;if(r.current===null){r.current=i;return}r.current!==i&&n()&&queueMicrotask(()=>{e("navigation save (page change)").catch(o=>{console.error("[useNavigationSave] Failed to save on navigation:",o)})}),r.current=i},[t.pathname,n,e])}const z1=300*1e3;function j3(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??vt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}function B1(t,e){return e?t?new Date(e)>new Date(t):!0:!1}async function R3(t,e){const n=[],r=new Date,i=r.getFullYear(),o=r.getMonth()+1;let l=i,u=o-3;for(;u<=0;)u+=12,l-=1;const h=vt(l,u),[f,p,g]=await Promise.all([Ue.fetchQuery({queryKey:ke.budget(t),queryFn:()=>$0(t),staleTime:0}).catch(()=>null),Ue.fetchQuery({queryKey:ke.payees(t),queryFn:()=>G0(t),staleTime:0}).catch(()=>null),kn("months","useSyncCheck: checking for remote changes",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:h}]).catch(()=>({docs:[]}))]);if(f){const b=Ue.getQueryData(ke.budget(t));if(b){const S=b.budget?.updated_at;B1(S,f.budget.updated_at)&&(e.some(E=>E.type==="budget"&&E.budgetId===t)?n.push("Budget document has been updated remotely (you have unsaved local changes)"):Ue.setQueryData(ke.budget(t),f))}}p!==null&&Ue.getQueryData(ke.payees(t));const _=g.docs.map(b=>{const S=b.data,x=S.year,E=S.month;return j3(S,t,x,E)});for(const b of _){const S=Ue.getQueryData(ke.month(t,b.year,b.month));S?.month&&B1(S.month.updated_at,b.updated_at)&&(e.some(E=>E.type==="month"&&E.budgetId===t&&E.year===b.year&&E.month===b.month)?n.push(`Month ${b.year}/${b.month} has been updated remotely (you have unsaved local changes)`):Ue.setQueryData(ke.month(t,b.year,b.month),{month:b}))}return n}function I3(t,e){const{setSyncError:n,getChanges:r}=mc(),i=k.useRef(null),o=k.useRef(null),l=k.useRef(0),u=k.useRef(!1);k.useEffect(()=>{if(!t||!e||u.current)return;u.current=!0;const h=async()=>{try{const f=r(),p=await R3(t,f);if(p.length>0){const g=`Sync conflict detected: ${p.join("; ")}`;n(g),xo.add({type:"error",message:g,autoDismissMs:0})}else n(null)}catch(f){console.error("[useSyncCheck] Sync check failed:",f);const p=`Failed to check for sync conflicts: ${f instanceof Error?f.message:String(f)}`;n(p),xo.add({type:"error",message:p,autoDismissMs:0})}};return o.current=setTimeout(()=>{h(),l.current=Date.now(),i.current=setInterval(()=>{h(),l.current=Date.now()},z1)},z1),()=>{o.current&&clearTimeout(o.current),i.current&&clearInterval(i.current),u.current=!1}},[t,e,n,r])}function D3(t,e,n){const r=Ht(),i=k.useRef(null),o=k.useRef(null);k.useEffect(()=>{if(i.current===null||o.current===null){i.current=e,o.current=n;return}if(i.current===e&&o.current===n)return;if(!t){i.current=e,o.current=n;return}const l=vt(i.current,o.current),f=vt(e,n)>l?xT(e,n):Xl(e,n),p=ke.month(t,f.year,f.month);if(!r.getQueryData(p)){const _=r.getQueryData(ke.budget(t)),b=vt(f.year,f.month);_?.monthMap&&b in _.monthMap&&r.prefetchQuery({queryKey:p,queryFn:async()=>{const x=await q0(t,f.year,f.month);return x?{month:x}:null},staleTime:lc}).catch(x=>{console.warn(`[useMonthPrefetch] Failed to prefetch month ${f.year}/${f.month}:`,x)})}i.current=e,o.current=n},[t,e,n,r])}function Ra(){Ue.removeQueries({queryKey:["budget"]}),Ue.removeQueries({queryKey:["month"]}),Ue.removeQueries({queryKey:["accessibleBudgets"]}),Ue.removeQueries({queryKey:["payees"]}),Ue.removeQueries({queryKey:["user"]}),console.log("[Migration] All caches cleared")}async function wm(t){try{const e=await t();return Ra(),e}catch(e){throw Ra(),e}}const NT=k.createContext(null),L1={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function k3({children:t}){const[e,n]=k.useState(L1),r=k.useCallback(()=>({setStage:u=>{n(h=>({...h,stage:u}))},setProgress:u=>{n(h=>({...h,progress:u}))},setCurrentItem:u=>{n(h=>({...h,currentItem:u}))},setDetails:u=>{n(h=>({...h,details:u}))},updateItemProgress:(u,h,f)=>{const p=h>0?Math.round(u/h*100):0;n(g=>({...g,progress:p,currentItem:f||`Item ${u} of ${h}`,details:`${u} / ${h} complete`}))}}),[]),i=k.useCallback(async(u,h)=>{n({isOpen:!0,migrationName:u,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const f=r();try{const p=await h(f);return Ra(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){Ra();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(_=>({..._,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=k.useCallback(()=>{n(u=>u.isComplete?L1:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),u))},[]),l={state:e,runMigrationWithProgress:i,closeModal:o};return d.jsx(NT.Provider,{value:l,children:t})}function PT(){const t=k.useContext(NT);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function O3(t){return(await kn("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function zT(t,e){return(await kn("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(i=>({id:i.id,data:i.data,budgetId:i.data.budget_id,year:i.data.year,month:i.data.month})).sort((i,o)=>i.year!==o.year?i.year-o.year:i.month-o.month)}async function Ma(t){const e=await O3(t),n=await kn("months",`${t}: batch reading all months`),r=new Map;for(const i of n.docs){const o=i.data.budget_id,l={id:i.id,data:i.data,budgetId:o,year:i.data.year,month:i.data.month};r.has(o)||r.set(o,[]),r.get(o).push(l)}for(const i of r.values())i.sort((o,l)=>o.year!==l.year?o.year-l.year:o.month-l.month);return{budgets:e,monthsByBudget:r}}async function hd(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"months",docId:us(r.budgetId,r.year,r.month),data:Aa({...r.data,updated_at:new Date().toISOString()})}));await pm(n,`${e}: batch writing ${t.length} months`)}async function BT(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"budgets",docId:r.budgetId,data:Aa({...r.data,updated_at:new Date().toISOString()})}));await pm(n,`${e}: batch writing ${t.length} budgets`)}async function LT(t,e,n){if(e.length===0)return;let r=Q0;const i=[];for(const p of e){const g=W0(p,r);i.push(g),r=Vu(g)}const o=i.map(p=>({budgetId:t,year:p.year,month:p.month,data:p}));await hd(o,n);const l=r.accountEndBalances,u=r.categoryEndBalances,{exists:h,data:f}=await At("budgets",t,`${n}: reading budget for final update`);if(h&&f){const p=wT(f.month_map||{}),g=K0(p),_={...u},b=f.categories||{};for(const S of Object.keys(b))S in _||(_[S]=0);await ET(t,l,_,g)}}async function M3(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,i]of n){i.sort((u,h)=>u.year!==h.year?u.year-h.year:u.month-h.month),await hd(i,e);const l=(await zT(r,e)).map(u=>u.data);await LT(r,l,e)}}async function N3(){const t=M0(Wf),e=O0(t,"budgets"),n=await V0(e);let r=0;return n.forEach(i=>{const o=i.data(),u=(o.account_groups||{})[Xt]!==void 0,f=(Array.isArray(o.category_groups)?o.category_groups:[]).some(p=>p&&p.id===nn);(!u||!f)&&r++}),{totalBudgets:n.size,budgetsNeedingUpdate:r}}async function P3(t){const e={budgetsProcessed:0,budgetsUpdated:0,errors:[]};t.setStage("Reading all budgets..."),t.setProgress(null);const n=M0(Wf),r=O0(n,"budgets"),i=await V0(r);t.setDetails(`Found ${i.size} budget(s) to process`);const o=[];t.setStage("Scanning budgets...");let l=0;if(i.forEach(u=>{l++,t.updateItemProgress(l,i.size,`Budget: ${u.data().name||u.id}`);const h=u.data(),f={};let p=!1;const g=h.account_groups||{};g[Xt]||(f.account_groups={...g,[Xt]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},p=!0);const _=Array.isArray(h.category_groups)?h.category_groups:[];_.some(S=>S&&S.id===nn)||(f.category_groups=[..._,{id:nn,name:"Uncategorized",sort_order:0}],p=!0),p&&o.push({id:u.id,name:h.name||u.id,updates:f}),e.budgetsProcessed++}),o.length>0){t.setStage(`Updating ${o.length} budget(s)...`),t.setProgress(null);for(let u=0;u<o.length;u++){const h=o[u];t.updateItemProgress(u+1,o.length,`Updating: ${h.name}`);try{const f=Oo(n,"budgets",h.id);await _T(f,{...h.updates,updated_at:new Date().toISOString()}),e.budgetsUpdated++}catch(f){const p=`Failed to update budget ${h.id}: ${f instanceof Error?f.message:String(f)}`;e.errors.push(p),console.error("[runEnsureUngroupedGroupsMigration]",p,f)}}}else t.setStage("No updates needed"),t.setProgress(null);return t.setStage("Complete"),t.setProgress(100),e}function z3(){const[t,e]=k.useState(null),[n,r]=k.useState(null),[i,o]=k.useState(!1),[l,u]=k.useState(!1),{runMigrationWithProgress:h}=PT();return{status:t,result:n,isScanning:i,isRunning:l,scanStatus:async()=>{o(!0),e(null),r(null);try{const g=await N3();e(g)}catch(g){console.error("[useEnsureUngroupedGroups] Scan failed:",g)}finally{o(!1)}},runMigration:async()=>{u(!0),r(null);try{const g=await h("Ensure Ungrouped Groups Migration",_=>P3(_));r(g)}catch(g){console.error("[useEnsureUngroupedGroups] Migration failed:",g),r({budgetsProcessed:0,budgetsUpdated:0,errors:[g instanceof Error?g.message:String(g)]})}finally{u(!1)}}}}async function B3(t){const{exists:e,data:n}=await At("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r={...n.accounts};for(const o of Object.keys(r))r[o]&&typeof r[o]=="object"&&(r[o]={...r[o],balance:0});const i={...n.categories};for(const o of Object.keys(i))i[o]&&typeof i[o]=="object"&&(i[o]={...i[o],balance:0});await qn("budgets",t,{...n,accounts:r,categories:i,month_map:{},total_available:0,is_needs_recalculation:!1,updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} balances to zero`)}function L3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,u]=k.useState(null),[h,f]=k.useState(null),[p,g]=k.useState(null);async function _(){if(t){r(!0);try{const S=await kn("months","delete all months: scanning for all months"),x=[],E=new Set;for(const C of S.docs){const{budget_id:T,year:A,month:U}=C.data;E.add(T),x.push({docId:C.id,budgetId:T,year:A,month:U})}x.sort((C,T)=>C.budgetId!==T.budgetId?C.budgetId.localeCompare(T.budgetId):C.year!==T.year?C.year-T.year:C.month-T.month),u({monthsToDelete:x,monthsCount:x.length,budgetCount:E.size})}catch{}finally{r(!1)}}}async function b(){if(!t||!l||l.monthsToDelete.length===0)return;o(!0),f(null);const S=l.monthsToDelete.length,x=new Set,E=[];for(const F of l.monthsToDelete)x.add(F.budgetId);g({phase:"deleting",deleted:0,total:S,currentMonth:null,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:0});const C=l.monthsToDelete.map(F=>({collectionPath:"months",docId:F.docId}));let T=0;try{await vT(C,"delete all months: batch deleting all month documents",F=>{T=F,g({phase:"deleting",deleted:F,total:S,currentMonth:`Batch ${Math.ceil(F/500)} of ${Math.ceil(S/500)}`,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:Math.round(F/S*70)})}),T=S}catch(F){E.push(`Batch delete failed: ${F instanceof Error?F.message:"Unknown error"}`)}const A=Array.from(x);let U=0;for(const F of A){g({phase:"resetting-budgets",deleted:T,total:S,currentMonth:`Budget ${U+1}/${A.length}`,budgetsRecalculated:U,totalBudgets:A.length,percentComplete:70+Math.round(U/A.length*25)});try{await B3(F),U++}catch{U++}}g({phase:"clearing-cache",deleted:T,total:S,currentMonth:null,budgetsRecalculated:U,totalBudgets:A.length,percentComplete:95}),Ra(),g({phase:"complete",deleted:T,total:S,currentMonth:null,budgetsRecalculated:U,totalBudgets:A.length,percentComplete:100}),f({deleted:T,errors:E,budgetsRecalculated:U}),o(!1),g(null),E.length===0&&(u({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:l,isScanning:n,scanStatus:_,isDeleting:i,deleteResult:h,deleteProgress:p,deleteAllMonths:b}}const Wg="sample@sample.com",fo="budget_1767746876726_xuj7nzl4l";function U3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,u]=k.useState(null),[h,f]=k.useState(null),[p,g]=k.useState(null);async function _(){if(t){r(!0);try{let x=(await kn("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:Wg}])).docs;if(x.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const F=await At("budgets",fo,"delete sample user budget: checking fallback budget ID");F.exists&&F.data&&(console.log("delete sample user budget: found fallback budget",fo),x=[{id:fo,data:F.data}])}const E=[];let C=0,T=!1;for(const F of x){const H=F.id,O=F.data.name,P=(await kn("months",`delete sample user budget: counting months for budget ${H}`,[{field:"budget_id",op:"==",value:H}])).docs.length;C+=P,E.push({budgetId:H,budgetName:O,monthCount:P}),(await kn("payees",`delete sample user budget: checking payees for budget ${H}`,[{field:"budget_id",op:"==",value:H}])).docs.length>0&&(T=!0)}const A=[],U=await kn("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:Wg}]);U.docs.length>0&&U.docs[0].data.budget_ids?.includes(fo)&&(E.some(D=>D.budgetId===fo)||(console.log("delete sample user budget: found stale budget reference in sample user document",fo),A.push(fo))),u({budgets:E,totalBudgets:E.length,totalMonths:C,hasPayees:T,staleBudgetIds:A})}catch(S){console.error("Error scanning for sample user budgets:",S)}finally{r(!1)}}}async function b(){if(!t||!l||l.budgets.length===0&&l.staleBudgetIds.length===0)return;o(!0),f(null);const S=[];let x=0,E=0,C=0;const T=l.totalMonths,A=l.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:A,percentComplete:0});for(const F of l.budgets)try{const O=(await kn("months",`delete sample user budget: fetching month IDs for budget ${F.budgetId}`)).docs.filter(D=>D.data.budget_id===F.budgetId).map(D=>({collectionPath:"months",docId:D.id}));O.length>0&&(await vT(O,`delete sample user budget: deleting ${O.length} months for budget ${F.budgetId}`,D=>{x=D,g({phase:"deleting-months",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:Math.round(x/Math.max(T,1)*60)})}),x=O.length)}catch(H){S.push(`Failed to delete months for budget ${F.budgetId}: ${H instanceof Error?H.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:60});for(const F of l.budgets)try{await Ny("payees",F.budgetId,`delete sample user budget: deleting payees for budget ${F.budgetId}`),C++}catch{}g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:70});for(const F of l.budgets)try{await Ny("budgets",F.budgetId,`delete sample user budget: deleting budget ${F.budgetId}`),E++,g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:70+Math.round(E/A*10)})}catch(H){S.push(`Failed to delete budget ${F.budgetId}: ${H instanceof Error?H.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:80});const U=[...l.budgets.map(F=>F.budgetId),...l.staleBudgetIds];try{const F=await kn("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:Wg}]);if(F.docs.length>0){const H=F.docs[0],O=H.id,D=H.data,P=(D.budget_ids||[]).filter(L=>!U.includes(L));await qn("users",O,{...D,budget_ids:P,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${U.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(F){S.push(`Failed to update sample user document: ${F instanceof Error?F.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:95}),Ra(),g({phase:"complete",monthsDeleted:x,totalMonths:T,budgetsDeleted:E,totalBudgets:A,percentComplete:100}),f({budgetsDeleted:E,monthsDeleted:x,payeesDeleted:C,errors:S}),o(!1),g(null),S.length===0&&(u({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:l,isScanning:n,scanStatus:_,isDeleting:i,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:b}}function U1(t){if(!t)return 0;let e=0;for(const n of t)dt(n.start_balance??0)&&e++,dt(n.end_balance??0)&&e++,dt(n.allocated??0)&&e++,dt(n.spent??0)&&e++,dt(n.income??0)&&e++,dt(n.expenses??0)&&e++,dt(n.net_change??0)&&e++;return e}function F1(t){if(!t)return 0;let e=0;for(const n of t)dt(n.amount??0)&&e++;return e}async function V1(){const t=await kn("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,i=0;for(const g of t.docs){const _=g.data;let b=!1;dt(_.total_available??0)&&(i++,b=!0);const S=_.accounts;if(S&&typeof S=="object")for(const E of Object.values(S))dt(E.balance??0)&&(n++,b=!0);const x=_.categories;if(x&&typeof x=="object")for(const E of Object.values(x))dt(E.balance??0)&&(r++,b=!0),dt(E.default_monthly_amount??0)&&(r++,b=!0);b&&e++}const o=await kn("months","precision cleanup: scanning all months");let l=0,u=0,h=0,f=0,p=0;for(const g of o.docs){const _=g.data;let b=!1;(dt(_.total_income??0)||dt(_.total_expenses??0)||dt(_.previous_month_income??0))&&(b=!0);const S=F1(_.income);S>0&&(u+=S,b=!0);const x=F1(_.expenses);x>0&&(h+=x,b=!0);const E=U1(_.category_balances);E>0&&(f+=E,b=!0);const C=U1(_.account_balances);C>0&&(p+=C,b=!0),b&&l++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:i,totalMonths:o.docs.length,monthsWithPrecisionIssues:l,incomeValuesWithPrecisionIssues:u,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:f,accountBalancesWithPrecisionIssues:p}}function $1(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=Me(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=Me(e.end_balance)),e.allocated!==void 0&&(e.allocated=Me(e.allocated)),e.spent!==void 0&&(e.spent=Me(e.spent)),e.income!==void 0&&(e.income=Me(e.income)),e.expenses!==void 0&&(e.expenses=Me(e.expenses)),e.transfers!==void 0&&(e.transfers=Me(e.transfers)),e.adjustments!==void 0&&(e.adjustments=Me(e.adjustments)),e.net_change!==void 0&&(e.net_change=Me(e.net_change)),e}function F3(t,e){let n=!1;dt(t.total_available??0)&&(t.total_available=Me(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,l]of Object.entries(r)){const u=l;dt(u.balance??0)&&(r[o].balance=Me(u.balance??0),e.accountsFixed++,n=!0)}const i=t.categories;if(i&&typeof i=="object")for(const[o,l]of Object.entries(i)){const u=l;dt(u.balance??0)&&(i[o].balance=Me(u.balance??0),e.categoriesFixed++,n=!0),dt(u.default_monthly_amount??0)&&(i[o].default_monthly_amount=Me(u.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function V3(t,e){let n=!1;if(dt(t.total_income??0)&&(t.total_income=Me(t.total_income??0),n=!0),dt(t.total_expenses??0)&&(t.total_expenses=Me(t.total_expenses??0),n=!0),dt(t.previous_month_income??0)&&(t.previous_month_income=Me(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const i of t.income)dt(i.amount??0)?(r.push({...i,amount:Me(i.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(i);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const i of t.expenses)dt(i.amount??0)?(r.push({...i,amount:Me(i.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(i);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const i of t.category_balances)dt(i.start_balance??0)||dt(i.end_balance??0)||dt(i.allocated??0)||dt(i.spent??0)||dt(i.transfers??0)||dt(i.adjustments??0)?(r.push($1(i)),e.categoryBalancesFixed++,n=!0):r.push(i);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const i of t.account_balances)dt(i.start_balance??0)||dt(i.end_balance??0)||dt(i.income??0)||dt(i.expenses??0)||dt(i.transfers??0)||dt(i.adjustments??0)||dt(i.net_change??0)?(r.push($1(i)),e.accountBalancesFixed++,n=!0):r.push(i);t.account_balances=r}return{fixed:n,data:t}}function $3(t,e,n){const r={...t.data},{fixed:i,data:o}=F3(r,n),l=i?{budgetId:t.id,data:o}:null;i&&n.budgetsProcessed++;const u=[];let h=!1;for(const f of e){const p={...f.data},{fixed:g,data:_}=V3(p,n);g&&(n.monthsProcessed++,h=!0),u.push(_)}return{budgetUpdate:l,fixedMonths:u,hasMonthFixes:h}}async function q3(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await Ma("precision cleanup"),r=[],i=[];for(const o of e)try{const l=n.get(o.id)||[],{budgetUpdate:u,fixedMonths:h,hasMonthFixes:f}=$3(o,l,t);u&&r.push(u),(f||h.length>0)&&i.push({budgetId:o.id,months:h})}catch(l){t.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}if(r.length>0)try{await BT(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:l}of i)try{await LT(o,l,"precision cleanup")}catch(u){t.errors.push(`Budget ${o} recalc: ${u instanceof Error?u.message:String(u)}`)}return t}function G3({currentUser:t,onComplete:e}){const[n,r]=k.useState(null),[i,o]=k.useState(!1),[l,u]=k.useState(!1),[h,f]=k.useState(null),[p,g]=k.useState(null),_=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,b=_>0,S=k.useCallback(async()=>{if(t){o(!0),g(null);try{const E=await V1();r(E),f(null)}catch(E){g(E instanceof Error?E.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),x=k.useCallback(async()=>{if(!(!t||!b)){u(!0),g(null);try{const E=await wm(()=>q3());f(E);const C=await V1();r(C),e?.()}catch(E){g(E instanceof Error?E.message:"Failed to run precision cleanup")}finally{u(!1)}}},[t,b,e]);return{status:n,isScanning:i,isRunning:l,result:h,error:p,totalIssues:_,hasIssues:b,hasData:n!==null,scan:S,runCleanup:x}}const H3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],Q3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function Sm(t){return!t||nt(t)?!0:H3.includes(t)}function Em(t){return!t||lt(t)?!0:Q3.includes(t)}function UT(t){return Sm(t.account_id)||Em(t.category_id)}function W3(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:Sm(t.account_id)?$t:t.account_id,category_id:Em(t.category_id)?Kt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function K3(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],i=[],o=[];let l=0,u=0;for(const f of n)UT(f)?(Sm(f.account_id)&&!nt(f.account_id)&&l++,Em(f.category_id)&&!lt(f.category_id)&&u++,o.push(W3(f))):i.push(f);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:bm({...e,expenses:i,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:l,invalidCategoriesFixed:u}}}async function Y3(){const{budgets:t,monthsByBudget:e}=await Ma("expense-to-adjustment-scan");let n=0,r=0,i=0,o=0;for(const l of t){const u=e.get(l.id)||[];n+=u.length;for(const h of u){const p=h.data.expenses||[];for(const g of p)UT(g)&&(r++,Sm(g.account_id)&&!nt(g.account_id)&&i++,Em(g.category_id)&&!lt(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:i,invalidCategoriesToFix:o}}async function X3(){const{budgets:t,monthsByBudget:e}=await Ma("expense-to-adjustment-migration"),n=[];let r=0,i=0,o=0;const l=[];for(const u of t){const h=e.get(u.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:_}=K3(f);p&&g&&(n.push({budgetId:u.id,year:f.year,month:f.month,data:g}),r+=_.expensesMigrated,i+=_.invalidAccountsFixed,o+=_.invalidCategoriesFixed)}catch(p){l.push(`Month ${f.year}/${f.month} in budget ${u.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await hd(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:i,invalidCategoriesFixed:o,errors:l}}function Z3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,u]=k.useState(null),[h,f]=k.useState(null);async function p(){if(t){r(!0);try{const b=await Y3();u(b)}catch(b){console.error("Failed to scan for expense to adjustment migration:",b)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const b=await wm(()=>X3());f(b),e?.()}catch(b){f({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[b instanceof Error?b.message:"Unknown error"]})}finally{o(!1)}}}const _=l!==null&&l.expensesToMigrate>0;return{status:l,isScanning:n,scanStatus:p,hasItemsToMigrate:_,isRunning:i,result:h,runMigration:g}}function FT(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const i=t.accounts;if(i)for(const o of Object.keys(i))n.add(o);return{categoryIds:e,accountIds:n}}function da(t,e){return!t||lt(t)?!1:!e.has(t)}function Ns(t,e){return!t||nt(t)?!1:!e.has(t)}function J3(t,e){const n=t.data;let r=0,i=0,o=0,l=0,u=0,h=0,f=!1;const p=(n.expenses||[]).map(x=>{const E={...x};let C=!1;return da(x.category_id,e.categoryIds)&&(E.category_id=Kt,r++,C=!0),Ns(x.account_id,e.accountIds)&&(E.account_id=$t,i++,C=!0),C&&(o++,f=!0),E}),g=(n.income||[]).map(x=>{const E={...x};let C=!1;return Ns(x.account_id,e.accountIds)&&(E.account_id=$t,i++,C=!0),C&&(l++,f=!0),E}),_=(n.transfers||[]).map(x=>{const E={...x};let C=!1;return da(x.from_category_id,e.categoryIds)&&(E.from_category_id=Kt,r++,C=!0),da(x.to_category_id,e.categoryIds)&&(E.to_category_id=Kt,r++,C=!0),Ns(x.from_account_id,e.accountIds)&&(E.from_account_id=$t,i++,C=!0),Ns(x.to_account_id,e.accountIds)&&(E.to_account_id=$t,i++,C=!0),C&&(u++,f=!0),E}),b=(n.adjustments||[]).map(x=>{const E={...x};let C=!1;return da(x.category_id,e.categoryIds)&&(E.category_id=Kt,r++,C=!0),Ns(x.account_id,e.accountIds)&&(E.account_id=$t,i++,C=!0),C&&(h++,f=!0),E});return f?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:_,adjustments:b,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:u,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function eP(){const{budgets:t,monthsByBudget:e}=await Ma("orphaned-id-scan");let n=0,r=0,i=0,o=0,l=0,u=0,h=0;for(const f of t){const p=FT(f.data),g=e.get(f.id)||[];n+=g.length;for(const _ of g){const b=_.data;for(const S of b.expenses||[]){let x=!1;da(S.category_id,p.categoryIds)&&(r++,x=!0),Ns(S.account_id,p.accountIds)&&(i++,x=!0),x&&o++}for(const S of b.income||[])Ns(S.account_id,p.accountIds)&&(i++,l++);for(const S of b.transfers||[]){let x=!1;da(S.from_category_id,p.categoryIds)&&(r++,x=!0),da(S.to_category_id,p.categoryIds)&&(r++,x=!0),Ns(S.from_account_id,p.accountIds)&&(i++,x=!0),Ns(S.to_account_id,p.accountIds)&&(i++,x=!0),x&&u++}for(const S of b.adjustments||[]){let x=!1;da(S.category_id,p.categoryIds)&&(r++,x=!0),Ns(S.account_id,p.accountIds)&&(i++,x=!0),x&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:u,affectedAdjustments:h}}async function tP(){const{budgets:t,monthsByBudget:e}=await Ma("orphaned-id-cleanup"),n=[];let r=0,i=0;const o=[];for(const l of t){const u=FT(l.data),h=e.get(l.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:_}=J3(f,u);p&&g&&(n.push({budgetId:l.id,year:f.year,month:f.month,data:g}),r+=_.categoryIdsFixed,i+=_.accountIdsFixed)}catch(p){o.push(`Month ${f.year}/${f.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await hd(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:i,errors:o}}function nP({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,u]=k.useState(null),[h,f]=k.useState(null);async function p(){if(t){r(!0);try{const b=await eP();u(b)}catch(b){console.error("Failed to scan for orphaned IDs:",b)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const b=await wm(()=>tP());f(b),e?.()}catch(b){f({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[b instanceof Error?b.message:"Unknown error"]})}finally{o(!1)}}}const _=l!==null&&(l.orphanedCategoryIds>0||l.orphanedAccountIds>0);return{status:l,isScanning:n,scanStatus:p,hasItemsToFix:_,isRunning:i,result:h,runMigration:g}}function rP(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,i=lt(t.category_id)&&lt(e.category_id),o=!nt(t.account_id)&&!nt(e.account_id),l=t.account_id!==e.account_id;if(i&&o&&l)return{negative:n,positive:r,type:"account"};const u=nt(t.account_id)&&nt(e.account_id),h=!lt(t.category_id)&&!lt(e.category_id),f=t.category_id!==e.category_id;return u&&h&&f?{negative:n,positive:r,type:"category"}:null}function VT(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let i=r+1;i<t.length;i++){if(n.has(t[i].id))continue;const o=rP(t[r],t[i]);if(o){e.push(o),n.add(t[r].id),n.add(t[i].id);break}}return e}function sP(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Kt,to_category_id:Kt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:$t,to_account_id:$t,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function iP(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],i=VT(n);if(i.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=i.map(sP),l=new Set;for(const f of i)l.add(f.negative.id),l.add(f.positive.id);const u=n.filter(f=>!l.has(f.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:u,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:i.length,adjustmentsRemoved:l.size}}}async function aP(){const{budgets:t,monthsByBudget:e}=await Ma("adjustments-to-transfers-scan");let n=0,r=0,i=0,o=0;for(const l of t){const u=e.get(l.id)||[];n+=u.length;for(const h of u){const p=h.data.adjustments||[],g=VT(p);r+=g.length;for(const _ of g)_.type==="account"?i++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:i,categoryTransferPairs:o}}async function oP(){const{budgets:t,monthsByBudget:e}=await Ma("adjustments-to-transfers-migration"),n=[];let r=0,i=0;const o=[];for(const l of t){const u=e.get(l.id)||[];for(const h of u)try{const{needsUpdate:f,updatedMonth:p,stats:g}=iP(h);f&&p&&(n.push({budgetId:l.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,i+=g.adjustmentsRemoved)}catch(f){o.push(`Month ${h.year}/${h.month} in budget ${l.id}: ${f instanceof Error?f.message:String(f)}`)}}return n.length>0&&await hd(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:i,errors:o}}function lP({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,u]=k.useState(null),[h,f]=k.useState(null);async function p(){if(t){r(!0);try{const b=await aP();u(b)}catch(b){console.error("Failed to scan for adjustment pairs:",b)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const b=await wm(()=>oP());f(b),e?.()}catch(b){f({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[b instanceof Error?b.message:"Unknown error"]})}finally{o(!1)}}}const _=l!==null&&l.pairsFound>0;return{status:l,isScanning:n,scanStatus:p,hasPairsToConvert:_,isRunning:i,result:h,runMigration:g}}function cP(t){const e=[];let n="",r=!1;for(let i=0;i<t.length;i++){const o=t[i];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function uP(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function dP(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),i=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(i)||n<1||n>12||r<1||r>31?null:{year:i,month:n,day:r}}function hP(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function fP(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function mP(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const i=cP(r);if(i.length<5)continue;const[o,l,u,h,f,p,g]=i;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const _=dP(o);if(!_)continue;const b=fP(l,u),S=uP(f),x=hP(g||"");n.push({recordType:b,date:o,year:_.year,month:_.month,day:_.day,payee:l,category:u,account:h,amount:S,description:p||"",cleared:x,rawLine:r})}return n}function pP(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function gP(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function yP(t){const e=nt(t.account_id)||!t.account_id||t.account_id.trim()==="",n=lt(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function _P(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const i=nt(t.from_account_id),o=nt(t.to_account_id),l=lt(t.from_category_id),u=lt(t.to_category_id);return i&&o&&l&&u?"All from/to account and category IDs are NO_* (must involve at least one real entity)":i&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":l&&u&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function Hh(t,e,n,r,i){return t.filter(o=>{const[l,u,h]=e.split("-").map(Number);return o.year!==l||o.month!==u||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||i&&o.description&&o.description.toLowerCase().includes(i.toLowerCase()),!0)})}async function bP(t){const e=[];let n=0,r=0,i=0,o=0;const l=t?mP(t):[],{budgets:u,monthsByBudget:h}=await Ma("account-category-validation");for(const f of u){const p=h.get(f.id)||[];for(const g of p){const _=g.data,b=`${_.year}-${String(_.month).padStart(2,"0")}`,S=_.income||[];n+=S.length;for(const T of S){const A=pP(T);A&&e.push({budgetId:f.id,monthKey:b,transactionType:"income",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:Hh(l,T.date,T.amount,T.payee,T.description)})}const x=_.expenses||[];r+=x.length;for(const T of x){const A=gP(T);A&&e.push({budgetId:f.id,monthKey:b,transactionType:"expense",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Hh(l,T.date,T.amount,T.payee,T.description)})}const E=_.adjustments||[];i+=E.length;for(const T of E){const A=yP(T);A&&e.push({budgetId:f.id,monthKey:b,transactionType:"adjustment",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Hh(l,T.date,T.amount,void 0,T.description)})}const C=_.transfers||[];o+=C.length;for(const T of C){const A=_P(T);A&&e.push({budgetId:f.id,monthKey:b,transactionType:"transfer",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:Hh(l,T.date,T.amount,void 0,T.description)})}}}return e.sort((f,p)=>{const g=f.monthKey.localeCompare(p.monthKey);return g!==0?g:f.transactionType.localeCompare(p.transactionType)}),{totalBudgets:u.length,totalMonths:Array.from(h.values()).reduce((f,p)=>f+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:i,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function vP(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,i]of n){e.push("",`## ${r.toUpperCase()} (${i.length} violations)`,"");for(const o of i){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const l of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${l.rawLine}`,`        Type: ${l.recordType}, Date: ${l.date}, Payee: ${l.payee}`,`        Category: ${l.category}, Account: ${l.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function xP({currentUser:t}){const[e,n]=k.useState(!1),[r,i]=k.useState(null),[o,l]=k.useState(null);async function u(h){if(t){n(!0),i(null),l(null);try{const f=await bP(h);i(f),l(vP(f))}catch(f){console.error("Failed to scan transactions:",f),l(`Error scanning: ${f instanceof Error?f.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:u,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}function Qh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Kg={exports:{}};var q1;function wP(){return q1||(q1=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,o){function l(f,p){if(!i[f]){if(!r[f]){var g=typeof Qh=="function"&&Qh;if(!p&&g)return g(f,!0);if(u)return u(f,!0);var _=new Error("Cannot find module '"+f+"'");throw _.code="MODULE_NOT_FOUND",_}var b=i[f]={exports:{}};r[f][0].call(b.exports,function(S){var x=r[f][1][S];return l(x||S)},b,b.exports,n,r,i,o)}return i[f].exports}for(var u=typeof Qh=="function"&&Qh,h=0;h<o.length;h++)l(o[h]);return l})({1:[function(n,r,i){var o=n("./utils"),l=n("./support"),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(h){for(var f,p,g,_,b,S,x,E=[],C=0,T=h.length,A=T,U=o.getTypeOf(h)!=="string";C<h.length;)A=T-C,g=U?(f=h[C++],p=C<T?h[C++]:0,C<T?h[C++]:0):(f=h.charCodeAt(C++),p=C<T?h.charCodeAt(C++):0,C<T?h.charCodeAt(C++):0),_=f>>2,b=(3&f)<<4|p>>4,S=1<A?(15&p)<<2|g>>6:64,x=2<A?63&g:64,E.push(u.charAt(_)+u.charAt(b)+u.charAt(S)+u.charAt(x));return E.join("")},i.decode=function(h){var f,p,g,_,b,S,x=0,E=0,C="data:";if(h.substr(0,C.length)===C)throw new Error("Invalid base64 input, it looks like a data url.");var T,A=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===u.charAt(64)&&A--,h.charAt(h.length-2)===u.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=l.uint8array?new Uint8Array(0|A):new Array(0|A);x<h.length;)f=u.indexOf(h.charAt(x++))<<2|(_=u.indexOf(h.charAt(x++)))>>4,p=(15&_)<<4|(b=u.indexOf(h.charAt(x++)))>>2,g=(3&b)<<6|(S=u.indexOf(h.charAt(x++))),T[E++]=f,b!==64&&(T[E++]=p),S!==64&&(T[E++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var o=n("./external"),l=n("./stream/DataWorker"),u=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function f(p,g,_,b,S){this.compressedSize=p,this.uncompressedSize=g,this.crc32=_,this.compression=b,this.compressedContent=S}f.prototype={getContentWorker:function(){var p=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},f.createWorkerFrom=function(p,g,_){return p.pipe(new u).pipe(new h("uncompressedSize")).pipe(g.compressWorker(_)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=f},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var o=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var o=n("./utils"),l=(function(){for(var u,h=[],f=0;f<256;f++){u=f;for(var p=0;p<8;p++)u=1&u?3988292384^u>>>1:u>>>1;h[f]=u}return h})();r.exports=function(u,h){return u!==void 0&&u.length?o.getTypeOf(u)!=="string"?(function(f,p,g,_){var b=l,S=_+g;f^=-1;for(var x=_;x<S;x++)f=f>>>8^b[255&(f^p[x])];return-1^f})(0|h,u,u.length,0):(function(f,p,g,_){var b=l,S=_+g;f^=-1;for(var x=_;x<S;x++)f=f>>>8^b[255&(f^p.charCodeAt(x))];return-1^f})(0|h,u,u.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=n("pako"),u=n("./utils"),h=n("./stream/GenericWorker"),f=o?"uint8array":"array";function p(g,_){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=_,this.meta={}}i.magic="\b\0",u.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(u.transformTo(f,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(_){g.push({data:_,meta:g.meta})}},i.compressWorker=function(g){return new p("Deflate",g)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function o(b,S){var x,E="";for(x=0;x<S;x++)E+=String.fromCharCode(255&b),b>>>=8;return E}function l(b,S,x,E,C,T){var A,U,F=b.file,H=b.compression,O=T!==f.utf8encode,D=u.transformTo("string",T(F.name)),P=u.transformTo("string",f.utf8encode(F.name)),L=F.comment,q=u.transformTo("string",T(L)),j=u.transformTo("string",f.utf8encode(L)),M=P.length!==F.name.length,R=j.length!==L.length,K="",Q="",G="",X=F.dir,J=F.date,re={crc32:0,compressedSize:0,uncompressedSize:0};S&&!x||(re.crc32=b.crc32,re.compressedSize=b.compressedSize,re.uncompressedSize=b.uncompressedSize);var B=0;S&&(B|=8),O||!M&&!R||(B|=2048);var $=0,te=0;X&&($|=16),C==="UNIX"?(te=798,$|=(function(ne,de){var Se=ne;return ne||(Se=de?16893:33204),(65535&Se)<<16})(F.unixPermissions,X)):(te=20,$|=(function(ne){return 63&(ne||0)})(F.dosPermissions)),A=J.getUTCHours(),A<<=6,A|=J.getUTCMinutes(),A<<=5,A|=J.getUTCSeconds()/2,U=J.getUTCFullYear()-1980,U<<=4,U|=J.getUTCMonth()+1,U<<=5,U|=J.getUTCDate(),M&&(Q=o(1,1)+o(p(D),4)+P,K+="up"+o(Q.length,2)+Q),R&&(G=o(1,1)+o(p(q),4)+j,K+="uc"+o(G.length,2)+G);var ae="";return ae+=`
\0`,ae+=o(B,2),ae+=H.magic,ae+=o(A,2),ae+=o(U,2),ae+=o(re.crc32,4),ae+=o(re.compressedSize,4),ae+=o(re.uncompressedSize,4),ae+=o(D.length,2),ae+=o(K.length,2),{fileRecord:g.LOCAL_FILE_HEADER+ae+D+K,dirRecord:g.CENTRAL_FILE_HEADER+o(te,2)+ae+o(q.length,2)+"\0\0\0\0"+o($,4)+o(E,4)+D+K+q}}var u=n("../utils"),h=n("../stream/GenericWorker"),f=n("../utf8"),p=n("../crc32"),g=n("../signature");function _(b,S,x,E){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=S,this.zipPlatform=x,this.encodeFileName=E,this.streamFiles=b,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}u.inherits(_,h),_.prototype.push=function(b){var S=b.meta.percent||0,x=this.entriesCount,E=this._sources.length;this.accumulate?this.contentBuffer.push(b):(this.bytesWritten+=b.data.length,h.prototype.push.call(this,{data:b.data,meta:{currentFile:this.currentFile,percent:x?(S+100*(x-E-1))/x:100}}))},_.prototype.openedSource=function(b){this.currentSourceOffset=this.bytesWritten,this.currentFile=b.file.name;var S=this.streamFiles&&!b.file.dir;if(S){var x=l(b,S,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(b){this.accumulate=!1;var S=this.streamFiles&&!b.file.dir,x=l(b,S,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),S)this.push({data:(function(E){return g.DATA_DESCRIPTOR+o(E.crc32,4)+o(E.compressedSize,4)+o(E.uncompressedSize,4)})(b),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var b=this.bytesWritten,S=0;S<this.dirRecords.length;S++)this.push({data:this.dirRecords[S],meta:{percent:100}});var x=this.bytesWritten-b,E=(function(C,T,A,U,F){var H=u.transformTo("string",F(U));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(C,2)+o(C,2)+o(T,4)+o(A,4)+o(H.length,2)+H})(this.dirRecords.length,x,b,this.zipComment,this.encodeFileName);this.push({data:E,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(b){this._sources.push(b);var S=this;return b.on("data",function(x){S.processChunk(x)}),b.on("end",function(){S.closedSource(S.previous.streamInfo),S._sources.length?S.prepareNextSource():S.end()}),b.on("error",function(x){S.error(x)}),this},_.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(b){var S=this._sources;if(!h.prototype.error.call(this,b))return!1;for(var x=0;x<S.length;x++)try{S[x].error(b)}catch{}return!0},_.prototype.lock=function(){h.prototype.lock.call(this);for(var b=this._sources,S=0;S<b.length;S++)b[S].lock()},r.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var o=n("../compressions"),l=n("./ZipFileWorker");i.generateWorker=function(u,h,f){var p=new l(h.streamFiles,f,h.platform,h.encodeFileName),g=0;try{u.forEach(function(_,b){g++;var S=(function(T,A){var U=T||A,F=o[U];if(!F)throw new Error(U+" is not a valid compression method !");return F})(b.options.compression,h.compression),x=b.options.compressionOptions||h.compressionOptions||{},E=b.dir,C=b.date;b._compressWorker(S,x).withStreamInfo("file",{name:_,dir:E,date:C,comment:b.comment||"",unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(_){p.error(_)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var u in this)typeof this[u]!="function"&&(l[u]=this[u]);return l}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(l,u){return new o().loadAsync(l,u)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var o=n("./utils"),l=n("./external"),u=n("./utf8"),h=n("./zipEntries"),f=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(_){return new l.Promise(function(b,S){var x=_.decompressed.getContentWorker().pipe(new f);x.on("error",function(E){S(E)}).on("end",function(){x.streamInfo.crc32!==_.decompressed.crc32?S(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}r.exports=function(_,b){var S=this;return b=o.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:u.utf8decode}),p.isNode&&p.isStream(_)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",_,!0,b.optimizedBinaryString,b.base64).then(function(x){var E=new h(b);return E.load(x),E}).then(function(x){var E=[l.Promise.resolve(x)],C=x.files;if(b.checkCRC32)for(var T=0;T<C.length;T++)E.push(g(C[T]));return l.Promise.all(E)}).then(function(x){for(var E=x.shift(),C=E.files,T=0;T<C.length;T++){var A=C[T],U=A.fileNameStr,F=o.resolve(A.fileNameStr);S.file(F,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:b.createFolders}),A.dir||(S.file(F).unsafeOriginalName=U)}return E.zipComment.length&&(S.comment=E.zipComment),S})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var o=n("../utils"),l=n("../stream/GenericWorker");function u(h,f){l.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(f)}o.inherits(u,l),u.prototype._bindStream=function(h){var f=this;(this._stream=h).pause(),h.on("data",function(p){f.push({data:p,meta:{percent:0}})}).on("error",function(p){f.isPaused?this.generatedError=p:f.error(p)}).on("end",function(){f.isPaused?f._upstreamEnded=!0:f.end()})},u.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=u},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var o=n("readable-stream").Readable;function l(u,h,f){o.call(this,h),this._helper=u;var p=this;u.on("data",function(g,_){p.push(g)||p._helper.pause(),f&&f(_)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},r.exports=l},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,i){function o(F,H,O){var D,P=u.getTypeOf(H),L=u.extend(O||{},p);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(F=C(F)),L.createFolders&&(D=E(F))&&T.call(this,D,!0);var q=P==="string"&&L.binary===!1&&L.base64===!1;O&&O.binary!==void 0||(L.binary=!q),(H instanceof g&&H.uncompressedSize===0||L.dir||!H||H.length===0)&&(L.base64=!1,L.binary=!0,H="",L.compression="STORE",P="string");var j=null;j=H instanceof g||H instanceof h?H:S.isNode&&S.isStream(H)?new x(F,H):u.prepareContent(F,H,L.binary,L.optimizedBinaryString,L.base64);var M=new _(F,j,L);this.files[F]=M}var l=n("./utf8"),u=n("./utils"),h=n("./stream/GenericWorker"),f=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),_=n("./zipObject"),b=n("./generate"),S=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),E=function(F){F.slice(-1)==="/"&&(F=F.substring(0,F.length-1));var H=F.lastIndexOf("/");return 0<H?F.substring(0,H):""},C=function(F){return F.slice(-1)!=="/"&&(F+="/"),F},T=function(F,H){return H=H!==void 0?H:p.createFolders,F=C(F),this.files[F]||o.call(this,F,null,{dir:!0,createFolders:H}),this.files[F]};function A(F){return Object.prototype.toString.call(F)==="[object RegExp]"}var U={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(F){var H,O,D;for(H in this.files)D=this.files[H],(O=H.slice(this.root.length,H.length))&&H.slice(0,this.root.length)===this.root&&F(O,D)},filter:function(F){var H=[];return this.forEach(function(O,D){F(O,D)&&H.push(D)}),H},file:function(F,H,O){if(arguments.length!==1)return F=this.root+F,o.call(this,F,H,O),this;if(A(F)){var D=F;return this.filter(function(L,q){return!q.dir&&D.test(L)})}var P=this.files[this.root+F];return P&&!P.dir?P:null},folder:function(F){if(!F)return this;if(A(F))return this.filter(function(P,L){return L.dir&&F.test(P)});var H=this.root+F,O=T.call(this,H),D=this.clone();return D.root=O.name,D},remove:function(F){F=this.root+F;var H=this.files[F];if(H||(F.slice(-1)!=="/"&&(F+="/"),H=this.files[F]),H&&!H.dir)delete this.files[F];else for(var O=this.filter(function(P,L){return L.name.slice(0,F.length)===F}),D=0;D<O.length;D++)delete this.files[O[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(F){var H,O={};try{if((O=u.extend(F||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");u.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var D=O.comment||this.comment||"";H=b.generateWorker(this,O,D)}catch(P){(H=new h("error")).error(P)}return new f(H,O.type||"string",O.mimeType)},generateAsync:function(F,H){return this.generateInternalStream(F).accumulate(H)},generateNodeStream:function(F,H){return(F=F||{}).type||(F.type="nodebuffer"),this.generateInternalStream(F).toNodejsStream(H)}};r.exports=U},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var o=n("./DataReader");function l(u){o.call(this,u);for(var h=0;h<this.data.length;h++)u[h]=255&u[h]}n("../utils").inherits(l,o),l.prototype.byteAt=function(u){return this.data[this.zero+u]},l.prototype.lastIndexOfSignature=function(u){for(var h=u.charCodeAt(0),f=u.charCodeAt(1),p=u.charCodeAt(2),g=u.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===h&&this.data[_+1]===f&&this.data[_+2]===p&&this.data[_+3]===g)return _-this.zero;return-1},l.prototype.readAndCheckSignature=function(u){var h=u.charCodeAt(0),f=u.charCodeAt(1),p=u.charCodeAt(2),g=u.charCodeAt(3),_=this.readData(4);return h===_[0]&&f===_[1]&&p===_[2]&&g===_[3]},l.prototype.readData=function(u){if(this.checkOffset(u),u===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+u);return this.index+=u,h},r.exports=l},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var o=n("../utils");function l(u){this.data=u,this.length=u.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(u){this.checkIndex(this.index+u)},checkIndex:function(u){if(this.length<this.zero+u||u<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+u+"). Corrupted zip ?")},setIndex:function(u){this.checkIndex(u),this.index=u},skip:function(u){this.setIndex(this.index+u)},byteAt:function(){},readInt:function(u){var h,f=0;for(this.checkOffset(u),h=this.index+u-1;h>=this.index;h--)f=(f<<8)+this.byteAt(h);return this.index+=u,f},readString:function(u){return o.transformTo("string",this.readData(u))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var u=this.readInt(4);return new Date(Date.UTC(1980+(u>>25&127),(u>>21&15)-1,u>>16&31,u>>11&31,u>>5&63,(31&u)<<1))}},r.exports=l},{"../utils":32}],19:[function(n,r,i){var o=n("./Uint8ArrayReader");function l(u){o.call(this,u)}n("../utils").inherits(l,o),l.prototype.readData=function(u){this.checkOffset(u);var h=this.data.slice(this.zero+this.index,this.zero+this.index+u);return this.index+=u,h},r.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var o=n("./DataReader");function l(u){o.call(this,u)}n("../utils").inherits(l,o),l.prototype.byteAt=function(u){return this.data.charCodeAt(this.zero+u)},l.prototype.lastIndexOfSignature=function(u){return this.data.lastIndexOf(u)-this.zero},l.prototype.readAndCheckSignature=function(u){return u===this.readData(4)},l.prototype.readData=function(u){this.checkOffset(u);var h=this.data.slice(this.zero+this.index,this.zero+this.index+u);return this.index+=u,h},r.exports=l},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var o=n("./ArrayReader");function l(u){o.call(this,u)}n("../utils").inherits(l,o),l.prototype.readData=function(u){if(this.checkOffset(u),u===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+u);return this.index+=u,h},r.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var o=n("../utils"),l=n("../support"),u=n("./ArrayReader"),h=n("./StringReader"),f=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var _=o.getTypeOf(g);return o.checkSupport(_),_!=="string"||l.uint8array?_==="nodebuffer"?new f(g):l.uint8array?new p(o.transformTo("uint8array",g)):new u(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var o=n("./GenericWorker"),l=n("../utils");function u(h){o.call(this,"ConvertWorker to "+h),this.destType=h}l.inherits(u,o),u.prototype.processChunk=function(h){this.push({data:l.transformTo(this.destType,h.data),meta:h.meta})},r.exports=u},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var o=n("./GenericWorker"),l=n("../crc32");function u(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(u,o),u.prototype.processChunk=function(h){this.streamInfo.crc32=l(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=u},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function u(h){l.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(u,l),u.prototype.processChunk=function(h){if(h){var f=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=f+h.data.length}l.prototype.processChunk.call(this,h)},r.exports=u},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function u(h){l.call(this,"DataWorker");var f=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){f.dataIsReady=!0,f.data=p,f.max=p&&p.length||0,f.type=o.getTypeOf(p),f.isPaused||f._tickAndRepeat()},function(p){f.error(p)})}o.inherits(u,l),u.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},u.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},u.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,f=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,f);break;case"uint8array":h=this.data.subarray(this.index,f);break;case"array":case"nodebuffer":h=this.data.slice(this.index,f)}return this.index=f,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=u},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,u){return this._listeners[l].push(u),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,u){if(this._listeners[l])for(var h=0;h<this._listeners[l].length;h++)this._listeners[l][h].call(this,u)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var u=this;return l.on("data",function(h){u.processChunk(h)}),l.on("end",function(){u.end()}),l.on("error",function(h){u.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,u){return this.extraStreamInfo[l]=u,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},r.exports=o},{}],29:[function(n,r,i){var o=n("../utils"),l=n("./ConvertWorker"),u=n("./GenericWorker"),h=n("../base64"),f=n("../support"),p=n("../external"),g=null;if(f.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(S,x){return new p.Promise(function(E,C){var T=[],A=S._internalType,U=S._outputType,F=S._mimeType;S.on("data",function(H,O){T.push(H),x&&x(O)}).on("error",function(H){T=[],C(H)}).on("end",function(){try{var H=(function(O,D,P){switch(O){case"blob":return o.newBlob(o.transformTo("arraybuffer",D),P);case"base64":return h.encode(D);default:return o.transformTo(O,D)}})(U,(function(O,D){var P,L=0,q=null,j=0;for(P=0;P<D.length;P++)j+=D[P].length;switch(O){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(q=new Uint8Array(j),P=0;P<D.length;P++)q.set(D[P],L),L+=D[P].length;return q;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+O+"'")}})(A,T),F);E(H)}catch(O){C(O)}T=[]}).resume()})}function b(S,x,E){var C=x;switch(x){case"blob":case"arraybuffer":C="uint8array";break;case"base64":C="string"}try{this._internalType=C,this._outputType=x,this._mimeType=E,o.checkSupport(C),this._worker=S.pipe(new l(C)),S.lock()}catch(T){this._worker=new u("error"),this._worker.error(T)}}b.prototype={accumulate:function(S){return _(this,S)},on:function(S,x){var E=this;return S==="data"?this._worker.on(S,function(C){x.call(E,C.data,C.meta)}):this._worker.on(S,function(){o.delay(x,arguments,E)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(S){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},S)}},r.exports=b},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),i.blob=l.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var o=n("./utils"),l=n("./support"),u=n("./nodejsUtils"),h=n("./stream/GenericWorker"),f=new Array(256),p=0;p<256;p++)f[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;f[254]=f[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function _(){h.call(this,"utf-8 encode")}i.utf8encode=function(b){return l.nodebuffer?u.newBufferFrom(b,"utf-8"):(function(S){var x,E,C,T,A,U=S.length,F=0;for(T=0;T<U;T++)(64512&(E=S.charCodeAt(T)))==55296&&T+1<U&&(64512&(C=S.charCodeAt(T+1)))==56320&&(E=65536+(E-55296<<10)+(C-56320),T++),F+=E<128?1:E<2048?2:E<65536?3:4;for(x=l.uint8array?new Uint8Array(F):new Array(F),T=A=0;A<F;T++)(64512&(E=S.charCodeAt(T)))==55296&&T+1<U&&(64512&(C=S.charCodeAt(T+1)))==56320&&(E=65536+(E-55296<<10)+(C-56320),T++),E<128?x[A++]=E:(E<2048?x[A++]=192|E>>>6:(E<65536?x[A++]=224|E>>>12:(x[A++]=240|E>>>18,x[A++]=128|E>>>12&63),x[A++]=128|E>>>6&63),x[A++]=128|63&E);return x})(b)},i.utf8decode=function(b){return l.nodebuffer?o.transformTo("nodebuffer",b).toString("utf-8"):(function(S){var x,E,C,T,A=S.length,U=new Array(2*A);for(x=E=0;x<A;)if((C=S[x++])<128)U[E++]=C;else if(4<(T=f[C]))U[E++]=65533,x+=T-1;else{for(C&=T===2?31:T===3?15:7;1<T&&x<A;)C=C<<6|63&S[x++],T--;1<T?U[E++]=65533:C<65536?U[E++]=C:(C-=65536,U[E++]=55296|C>>10&1023,U[E++]=56320|1023&C)}return U.length!==E&&(U.subarray?U=U.subarray(0,E):U.length=E),o.applyFromCharCode(U)})(b=o.transformTo(l.uint8array?"uint8array":"array",b))},o.inherits(g,h),g.prototype.processChunk=function(b){var S=o.transformTo(l.uint8array?"uint8array":"array",b.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var x=S;(S=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),S.set(x,this.leftOver.length)}else S=this.leftOver.concat(S);this.leftOver=null}var E=(function(T,A){var U;for((A=A||T.length)>T.length&&(A=T.length),U=A-1;0<=U&&(192&T[U])==128;)U--;return U<0||U===0?A:U+f[T[U]]>A?U:A})(S),C=S;E!==S.length&&(l.uint8array?(C=S.subarray(0,E),this.leftOver=S.subarray(E,S.length)):(C=S.slice(0,E),this.leftOver=S.slice(E,S.length))),this.push({data:i.utf8decode(C),meta:b.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,o.inherits(_,h),_.prototype.processChunk=function(b){this.push({data:i.utf8encode(b.data),meta:b.meta})},i.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var o=n("./support"),l=n("./base64"),u=n("./nodejsUtils"),h=n("./external");function f(x){return x}function p(x,E){for(var C=0;C<x.length;++C)E[C]=255&x.charCodeAt(C);return E}n("setimmediate"),i.newBlob=function(x,E){i.checkSupport("blob");try{return new Blob([x],{type:E})}catch{try{var C=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return C.append(x),C.getBlob(E)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(x,E,C){var T=[],A=0,U=x.length;if(U<=C)return String.fromCharCode.apply(null,x);for(;A<U;)E==="array"||E==="nodebuffer"?T.push(String.fromCharCode.apply(null,x.slice(A,Math.min(A+C,U)))):T.push(String.fromCharCode.apply(null,x.subarray(A,Math.min(A+C,U)))),A+=C;return T.join("")},stringifyByChar:function(x){for(var E="",C=0;C<x.length;C++)E+=String.fromCharCode(x[C]);return E},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,u.allocBuffer(1)).length===1}catch{return!1}})()}};function _(x){var E=65536,C=i.getTypeOf(x),T=!0;if(C==="uint8array"?T=g.applyCanBeUsed.uint8array:C==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<E;)try{return g.stringifyByChunk(x,C,E)}catch{E=Math.floor(E/2)}return g.stringifyByChar(x)}function b(x,E){for(var C=0;C<x.length;C++)E[C]=x[C];return E}i.applyFromCharCode=_;var S={};S.string={string:f,array:function(x){return p(x,new Array(x.length))},arraybuffer:function(x){return S.string.uint8array(x).buffer},uint8array:function(x){return p(x,new Uint8Array(x.length))},nodebuffer:function(x){return p(x,u.allocBuffer(x.length))}},S.array={string:_,array:f,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return u.newBufferFrom(x)}},S.arraybuffer={string:function(x){return _(new Uint8Array(x))},array:function(x){return b(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:f,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return u.newBufferFrom(new Uint8Array(x))}},S.uint8array={string:_,array:function(x){return b(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:f,nodebuffer:function(x){return u.newBufferFrom(x)}},S.nodebuffer={string:_,array:function(x){return b(x,new Array(x.length))},arraybuffer:function(x){return S.nodebuffer.uint8array(x).buffer},uint8array:function(x){return b(x,new Uint8Array(x.length))},nodebuffer:f},i.transformTo=function(x,E){if(E=E||"",!x)return E;i.checkSupport(x);var C=i.getTypeOf(E);return S[C][x](E)},i.resolve=function(x){for(var E=x.split("/"),C=[],T=0;T<E.length;T++){var A=E[T];A==="."||A===""&&T!==0&&T!==E.length-1||(A===".."?C.pop():C.push(A))}return C.join("/")},i.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":o.nodebuffer&&u.isBuffer(x)?"nodebuffer":o.uint8array&&x instanceof Uint8Array?"uint8array":o.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(x){if(!o[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(x){var E,C,T="";for(C=0;C<(x||"").length;C++)T+="\\x"+((E=x.charCodeAt(C))<16?"0":"")+E.toString(16).toUpperCase();return T},i.delay=function(x,E,C){setImmediate(function(){x.apply(C||null,E||[])})},i.inherits=function(x,E){function C(){}C.prototype=E.prototype,x.prototype=new C},i.extend=function(){var x,E,C={};for(x=0;x<arguments.length;x++)for(E in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],E)&&C[E]===void 0&&(C[E]=arguments[x][E]);return C},i.prepareContent=function(x,E,C,T,A){return h.Promise.resolve(E).then(function(U){return o.blob&&(U instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(U))!==-1)&&typeof FileReader<"u"?new h.Promise(function(F,H){var O=new FileReader;O.onload=function(D){F(D.target.result)},O.onerror=function(D){H(D.target.error)},O.readAsArrayBuffer(U)}):U}).then(function(U){var F=i.getTypeOf(U);return F?(F==="arraybuffer"?U=i.transformTo("uint8array",U):F==="string"&&(A?U=l.decode(U):C&&T!==!0&&(U=(function(H){return p(H,o.uint8array?new Uint8Array(H.length):new Array(H.length))})(U))),U):h.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),u=n("./signature"),h=n("./zipEntry"),f=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(_)+", expected "+l.pretty(g)+")")}},isSignature:function(g,_){var b=this.reader.index;this.reader.setIndex(g);var S=this.reader.readString(4)===_;return this.reader.setIndex(b),S},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),_=f.uint8array?"uint8array":"array",b=l.transformTo(_,g);this.zipComment=this.loadOptions.decodeFileName(b)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,_,b,S=this.zip64EndOfCentralSize-44;0<S;)g=this.reader.readInt(2),_=this.reader.readInt(4),b=this.reader.readData(_),this.zip64ExtensibleData[g]={id:g,length:_,value:b}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,_;for(g=0;g<this.files.length;g++)_=this.files[g],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(u.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(u.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(u.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,u.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var _=g;if(this.checkSignature(u.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(u.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(u.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,u.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(u.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(u.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var b=this.centralDirOffset+this.centralDirSize;this.zip64&&(b+=20,b+=12+this.zip64EndOfCentralSize);var S=_-b;if(0<S)this.isSignature(_,u.CENTRAL_FILE_HEADER)||(this.reader.zero=S);else if(S<0)throw new Error("Corrupted zip: missing "+Math.abs(S)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),u=n("./compressedObject"),h=n("./crc32"),f=n("./utf8"),p=n("./compressions"),g=n("./support");function _(b,S){this.options=b,this.loadOptions=S}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(b){var S,x;if(b.skip(22),this.fileNameLength=b.readInt(2),x=b.readInt(2),this.fileName=b.readData(this.fileNameLength),b.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((S=(function(E){for(var C in p)if(Object.prototype.hasOwnProperty.call(p,C)&&p[C].magic===E)return p[C];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new u(this.compressedSize,this.uncompressedSize,this.crc32,S,b.readData(this.compressedSize))},readCentralPart:function(b){this.versionMadeBy=b.readInt(2),b.skip(2),this.bitFlag=b.readInt(2),this.compressionMethod=b.readString(2),this.date=b.readDate(),this.crc32=b.readInt(4),this.compressedSize=b.readInt(4),this.uncompressedSize=b.readInt(4);var S=b.readInt(2);if(this.extraFieldsLength=b.readInt(2),this.fileCommentLength=b.readInt(2),this.diskNumberStart=b.readInt(2),this.internalFileAttributes=b.readInt(2),this.externalFileAttributes=b.readInt(4),this.localHeaderOffset=b.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");b.skip(S),this.readExtraFields(b),this.parseZIP64ExtraField(b),this.fileComment=b.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var b=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),b==0&&(this.dosPermissions=63&this.externalFileAttributes),b==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var b=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(b){var S,x,E,C=b.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});b.index+4<C;)S=b.readInt(2),x=b.readInt(2),E=b.readData(x),this.extraFields[S]={id:S,length:x,value:E};b.setIndex(C)},handleUTF8:function(){var b=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=f.utf8decode(this.fileName),this.fileCommentStr=f.utf8decode(this.fileComment);else{var S=this.findExtraFieldUnicodePath();if(S!==null)this.fileNameStr=S;else{var x=l.transformTo(b,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var E=this.findExtraFieldUnicodeComment();if(E!==null)this.fileCommentStr=E;else{var C=l.transformTo(b,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(C)}}},findExtraFieldUnicodePath:function(){var b=this.extraFields[28789];if(b){var S=o(b.value);return S.readInt(1)!==1||h(this.fileName)!==S.readInt(4)?null:f.utf8decode(S.readData(b.length-5))}return null},findExtraFieldUnicodeComment:function(){var b=this.extraFields[25461];if(b){var S=o(b.value);return S.readInt(1)!==1||h(this.fileComment)!==S.readInt(4)?null:f.utf8decode(S.readData(b.length-5))}return null}},r.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function o(S,x,E){this.name=S,this.dir=E.dir,this.date=E.date,this.comment=E.comment,this.unixPermissions=E.unixPermissions,this.dosPermissions=E.dosPermissions,this._data=x,this._dataBinary=E.binary,this.options={compression:E.compression,compressionOptions:E.compressionOptions}}var l=n("./stream/StreamHelper"),u=n("./stream/DataWorker"),h=n("./utf8"),f=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(S){var x=null,E="string";try{if(!S)throw new Error("No output type specified.");var C=(E=S.toLowerCase())==="string"||E==="text";E!=="binarystring"&&E!=="text"||(E="string"),x=this._decompressWorker();var T=!this._dataBinary;T&&!C&&(x=x.pipe(new h.Utf8EncodeWorker)),!T&&C&&(x=x.pipe(new h.Utf8DecodeWorker))}catch(A){(x=new p("error")).error(A)}return new l(x,E,"")},async:function(S,x){return this.internalStream(S).accumulate(x)},nodeStream:function(S,x){return this.internalStream(S||"nodebuffer").toNodejsStream(x)},_compressWorker:function(S,x){if(this._data instanceof f&&this._data.compression.magic===S.magic)return this._data.getCompressedWorker();var E=this._decompressWorker();return this._dataBinary||(E=E.pipe(new h.Utf8EncodeWorker)),f.createWorkerFrom(E,S,x)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof p?this._data:new u(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},b=0;b<g.length;b++)o.prototype[g[b]]=_;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(o){var l,u,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var f=0,p=new h(S),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=f=++f%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){S(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(S,0)};else{var _=new o.MessageChannel;_.port1.onmessage=S,l=function(){_.port2.postMessage(0)}}var b=[];function S(){var x,E;u=!0;for(var C=b.length;C;){for(E=b,b=[],x=-1;++x<C;)E[x]();C=b.length}u=!1}r.exports=function(x){b.push(x)!==1||u||l()}}).call(this,typeof zh<"u"?zh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var o=n("immediate");function l(){}var u={},h=["REJECTED"],f=["FULFILLED"],p=["PENDING"];function g(C){if(typeof C!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,C!==l&&x(this,C)}function _(C,T,A){this.promise=C,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function b(C,T,A){o(function(){var U;try{U=T(A)}catch(F){return u.reject(C,F)}U===C?u.reject(C,new TypeError("Cannot resolve promise with itself")):u.resolve(C,U)})}function S(C){var T=C&&C.then;if(C&&(typeof C=="object"||typeof C=="function")&&typeof T=="function")return function(){T.apply(C,arguments)}}function x(C,T){var A=!1;function U(O){A||(A=!0,u.reject(C,O))}function F(O){A||(A=!0,u.resolve(C,O))}var H=E(function(){T(F,U)});H.status==="error"&&U(H.value)}function E(C,T){var A={};try{A.value=C(T),A.status="success"}catch(U){A.status="error",A.value=U}return A}(r.exports=g).prototype.finally=function(C){if(typeof C!="function")return this;var T=this.constructor;return this.then(function(A){return T.resolve(C()).then(function(){return A})},function(A){return T.resolve(C()).then(function(){throw A})})},g.prototype.catch=function(C){return this.then(null,C)},g.prototype.then=function(C,T){if(typeof C!="function"&&this.state===f||typeof T!="function"&&this.state===h)return this;var A=new this.constructor(l);return this.state!==p?b(A,this.state===f?C:T,this.outcome):this.queue.push(new _(A,C,T)),A},_.prototype.callFulfilled=function(C){u.resolve(this.promise,C)},_.prototype.otherCallFulfilled=function(C){b(this.promise,this.onFulfilled,C)},_.prototype.callRejected=function(C){u.reject(this.promise,C)},_.prototype.otherCallRejected=function(C){b(this.promise,this.onRejected,C)},u.resolve=function(C,T){var A=E(S,T);if(A.status==="error")return u.reject(C,A.value);var U=A.value;if(U)x(C,U);else{C.state=f,C.outcome=T;for(var F=-1,H=C.queue.length;++F<H;)C.queue[F].callFulfilled(T)}return C},u.reject=function(C,T){C.state=h,C.outcome=T;for(var A=-1,U=C.queue.length;++A<U;)C.queue[A].callRejected(T);return C},g.resolve=function(C){return C instanceof this?C:u.resolve(new this(l),C)},g.reject=function(C){var T=new this(l);return u.reject(T,C)},g.all=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=C.length,U=!1;if(!A)return this.resolve([]);for(var F=new Array(A),H=0,O=-1,D=new this(l);++O<A;)P(C[O],O);return D;function P(L,q){T.resolve(L).then(function(j){F[q]=j,++H!==A||U||(U=!0,u.resolve(D,F))},function(j){U||(U=!0,u.reject(D,j))})}},g.race=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=C.length,U=!1;if(!A)return this.resolve([]);for(var F=-1,H=new this(l);++F<A;)O=C[F],T.resolve(O).then(function(D){U||(U=!0,u.resolve(H,D))},function(D){U||(U=!0,u.reject(H,D))});var O;return H}},{immediate:36}],38:[function(n,r,i){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var o=n("./zlib/deflate"),l=n("./utils/common"),u=n("./utils/strings"),h=n("./zlib/messages"),f=n("./zlib/zstream"),p=Object.prototype.toString,g=0,_=-1,b=0,S=8;function x(C){if(!(this instanceof x))return new x(C);this.options=l.assign({level:_,method:S,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},C||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var A=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(A!==g)throw new Error(h[A]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var U;if(U=typeof T.dictionary=="string"?u.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(A=o.deflateSetDictionary(this.strm,U))!==g)throw new Error(h[A]);this._dict_set=!0}}function E(C,T){var A=new x(T);if(A.push(C,!0),A.err)throw A.msg||h[A.err];return A.result}x.prototype.push=function(C,T){var A,U,F=this.strm,H=this.options.chunkSize;if(this.ended)return!1;U=T===~~T?T:T===!0?4:0,typeof C=="string"?F.input=u.string2buf(C):p.call(C)==="[object ArrayBuffer]"?F.input=new Uint8Array(C):F.input=C,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new l.Buf8(H),F.next_out=0,F.avail_out=H),(A=o.deflate(F,U))!==1&&A!==g)return this.onEnd(A),!(this.ended=!0);F.avail_out!==0&&(F.avail_in!==0||U!==4&&U!==2)||(this.options.to==="string"?this.onData(u.buf2binstring(l.shrinkBuf(F.output,F.next_out))):this.onData(l.shrinkBuf(F.output,F.next_out)))}while((0<F.avail_in||F.avail_out===0)&&A!==1);return U===4?(A=o.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===g):U!==2||(this.onEnd(g),!(F.avail_out=0))},x.prototype.onData=function(C){this.chunks.push(C)},x.prototype.onEnd=function(C){C===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},i.Deflate=x,i.deflate=E,i.deflateRaw=function(C,T){return(T=T||{}).raw=!0,E(C,T)},i.gzip=function(C,T){return(T=T||{}).gzip=!0,E(C,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var o=n("./zlib/inflate"),l=n("./utils/common"),u=n("./utils/strings"),h=n("./zlib/constants"),f=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),_=Object.prototype.toString;function b(x){if(!(this instanceof b))return new b(x);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},x||{});var E=this.options;E.raw&&0<=E.windowBits&&E.windowBits<16&&(E.windowBits=-E.windowBits,E.windowBits===0&&(E.windowBits=-15)),!(0<=E.windowBits&&E.windowBits<16)||x&&x.windowBits||(E.windowBits+=32),15<E.windowBits&&E.windowBits<48&&(15&E.windowBits)==0&&(E.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var C=o.inflateInit2(this.strm,E.windowBits);if(C!==h.Z_OK)throw new Error(f[C]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function S(x,E){var C=new b(E);if(C.push(x,!0),C.err)throw C.msg||f[C.err];return C.result}b.prototype.push=function(x,E){var C,T,A,U,F,H,O=this.strm,D=this.options.chunkSize,P=this.options.dictionary,L=!1;if(this.ended)return!1;T=E===~~E?E:E===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof x=="string"?O.input=u.binstring2buf(x):_.call(x)==="[object ArrayBuffer]"?O.input=new Uint8Array(x):O.input=x,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new l.Buf8(D),O.next_out=0,O.avail_out=D),(C=o.inflate(O,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&P&&(H=typeof P=="string"?u.string2buf(P):_.call(P)==="[object ArrayBuffer]"?new Uint8Array(P):P,C=o.inflateSetDictionary(this.strm,H)),C===h.Z_BUF_ERROR&&L===!0&&(C=h.Z_OK,L=!1),C!==h.Z_STREAM_END&&C!==h.Z_OK)return this.onEnd(C),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&C!==h.Z_STREAM_END&&(O.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=u.utf8border(O.output,O.next_out),U=O.next_out-A,F=u.buf2string(O.output,A),O.next_out=U,O.avail_out=D-U,U&&l.arraySet(O.output,O.output,A,U,0),this.onData(F)):this.onData(l.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(L=!0)}while((0<O.avail_in||O.avail_out===0)&&C!==h.Z_STREAM_END);return C===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(C=o.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(O.avail_out=0))},b.prototype.onData=function(x){this.chunks.push(x)},b.prototype.onEnd=function(x){x===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},i.Inflate=b,i.inflate=S,i.inflateRaw=function(x,E){return(E=E||{}).raw=!0,S(x,E)},i.ungzip=S},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(h){for(var f=Array.prototype.slice.call(arguments,1);f.length;){var p=f.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},i.shrinkBuf=function(h,f){return h.length===f?h:h.subarray?h.subarray(0,f):(h.length=f,h)};var l={arraySet:function(h,f,p,g,_){if(f.subarray&&h.subarray)h.set(f.subarray(p,p+g),_);else for(var b=0;b<g;b++)h[_+b]=f[p+b]},flattenChunks:function(h){var f,p,g,_,b,S;for(f=g=0,p=h.length;f<p;f++)g+=h[f].length;for(S=new Uint8Array(g),f=_=0,p=h.length;f<p;f++)b=h[f],S.set(b,_),_+=b.length;return S}},u={arraySet:function(h,f,p,g,_){for(var b=0;b<g;b++)h[_+b]=f[p+b]},flattenChunks:function(h){return[].concat.apply([],h)}};i.setTyped=function(h){h?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,l)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,u))},i.setTyped(o)},{}],42:[function(n,r,i){var o=n("./common"),l=!0,u=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{u=!1}for(var h=new o.Buf8(256),f=0;f<256;f++)h[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;function p(g,_){if(_<65537&&(g.subarray&&u||!g.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(g,_));for(var b="",S=0;S<_;S++)b+=String.fromCharCode(g[S]);return b}h[254]=h[254]=1,i.string2buf=function(g){var _,b,S,x,E,C=g.length,T=0;for(x=0;x<C;x++)(64512&(b=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(S=g.charCodeAt(x+1)))==56320&&(b=65536+(b-55296<<10)+(S-56320),x++),T+=b<128?1:b<2048?2:b<65536?3:4;for(_=new o.Buf8(T),x=E=0;E<T;x++)(64512&(b=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(S=g.charCodeAt(x+1)))==56320&&(b=65536+(b-55296<<10)+(S-56320),x++),b<128?_[E++]=b:(b<2048?_[E++]=192|b>>>6:(b<65536?_[E++]=224|b>>>12:(_[E++]=240|b>>>18,_[E++]=128|b>>>12&63),_[E++]=128|b>>>6&63),_[E++]=128|63&b);return _},i.buf2binstring=function(g){return p(g,g.length)},i.binstring2buf=function(g){for(var _=new o.Buf8(g.length),b=0,S=_.length;b<S;b++)_[b]=g.charCodeAt(b);return _},i.buf2string=function(g,_){var b,S,x,E,C=_||g.length,T=new Array(2*C);for(b=S=0;b<C;)if((x=g[b++])<128)T[S++]=x;else if(4<(E=h[x]))T[S++]=65533,b+=E-1;else{for(x&=E===2?31:E===3?15:7;1<E&&b<C;)x=x<<6|63&g[b++],E--;1<E?T[S++]=65533:x<65536?T[S++]=x:(x-=65536,T[S++]=55296|x>>10&1023,T[S++]=56320|1023&x)}return p(T,S)},i.utf8border=function(g,_){var b;for((_=_||g.length)>g.length&&(_=g.length),b=_-1;0<=b&&(192&g[b])==128;)b--;return b<0||b===0?_:b+h[g[b]]>_?b:_}},{"./common":41}],43:[function(n,r,i){r.exports=function(o,l,u,h){for(var f=65535&o|0,p=o>>>16&65535|0,g=0;u!==0;){for(u-=g=2e3<u?2e3:u;p=p+(f=f+l[h++]|0)|0,--g;);f%=65521,p%=65521}return f|p<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var o=(function(){for(var l,u=[],h=0;h<256;h++){l=h;for(var f=0;f<8;f++)l=1&l?3988292384^l>>>1:l>>>1;u[h]=l}return u})();r.exports=function(l,u,h,f){var p=o,g=f+h;l^=-1;for(var _=f;_<g;_++)l=l>>>8^p[255&(l^u[_])];return-1^l}},{}],46:[function(n,r,i){var o,l=n("../utils/common"),u=n("./trees"),h=n("./adler32"),f=n("./crc32"),p=n("./messages"),g=0,_=4,b=0,S=-2,x=-1,E=4,C=2,T=8,A=9,U=286,F=30,H=19,O=2*U+1,D=15,P=3,L=258,q=L+P+1,j=42,M=113,R=1,K=2,Q=3,G=4;function X(z,be){return z.msg=p[be],be}function J(z){return(z<<1)-(4<z?9:0)}function re(z){for(var be=z.length;0<=--be;)z[be]=0}function B(z){var be=z.state,ge=be.pending;ge>z.avail_out&&(ge=z.avail_out),ge!==0&&(l.arraySet(z.output,be.pending_buf,be.pending_out,ge,z.next_out),z.next_out+=ge,be.pending_out+=ge,z.total_out+=ge,z.avail_out-=ge,be.pending-=ge,be.pending===0&&(be.pending_out=0))}function $(z,be){u._tr_flush_block(z,0<=z.block_start?z.block_start:-1,z.strstart-z.block_start,be),z.block_start=z.strstart,B(z.strm)}function te(z,be){z.pending_buf[z.pending++]=be}function ae(z,be){z.pending_buf[z.pending++]=be>>>8&255,z.pending_buf[z.pending++]=255&be}function ne(z,be){var ge,ee,Z=z.max_chain_length,ie=z.strstart,we=z.prev_length,xe=z.nice_match,oe=z.strstart>z.w_size-q?z.strstart-(z.w_size-q):0,je=z.window,Pe=z.w_mask,Oe=z.prev,Ge=z.strstart+L,xt=je[ie+we-1],st=je[ie+we];z.prev_length>=z.good_match&&(Z>>=2),xe>z.lookahead&&(xe=z.lookahead);do if(je[(ge=be)+we]===st&&je[ge+we-1]===xt&&je[ge]===je[ie]&&je[++ge]===je[ie+1]){ie+=2,ge++;do;while(je[++ie]===je[++ge]&&je[++ie]===je[++ge]&&je[++ie]===je[++ge]&&je[++ie]===je[++ge]&&je[++ie]===je[++ge]&&je[++ie]===je[++ge]&&je[++ie]===je[++ge]&&je[++ie]===je[++ge]&&ie<Ge);if(ee=L-(Ge-ie),ie=Ge-L,we<ee){if(z.match_start=be,xe<=(we=ee))break;xt=je[ie+we-1],st=je[ie+we]}}while((be=Oe[be&Pe])>oe&&--Z!=0);return we<=z.lookahead?we:z.lookahead}function de(z){var be,ge,ee,Z,ie,we,xe,oe,je,Pe,Oe=z.w_size;do{if(Z=z.window_size-z.lookahead-z.strstart,z.strstart>=Oe+(Oe-q)){for(l.arraySet(z.window,z.window,Oe,Oe,0),z.match_start-=Oe,z.strstart-=Oe,z.block_start-=Oe,be=ge=z.hash_size;ee=z.head[--be],z.head[be]=Oe<=ee?ee-Oe:0,--ge;);for(be=ge=Oe;ee=z.prev[--be],z.prev[be]=Oe<=ee?ee-Oe:0,--ge;);Z+=Oe}if(z.strm.avail_in===0)break;if(we=z.strm,xe=z.window,oe=z.strstart+z.lookahead,je=Z,Pe=void 0,Pe=we.avail_in,je<Pe&&(Pe=je),ge=Pe===0?0:(we.avail_in-=Pe,l.arraySet(xe,we.input,we.next_in,Pe,oe),we.state.wrap===1?we.adler=h(we.adler,xe,Pe,oe):we.state.wrap===2&&(we.adler=f(we.adler,xe,Pe,oe)),we.next_in+=Pe,we.total_in+=Pe,Pe),z.lookahead+=ge,z.lookahead+z.insert>=P)for(ie=z.strstart-z.insert,z.ins_h=z.window[ie],z.ins_h=(z.ins_h<<z.hash_shift^z.window[ie+1])&z.hash_mask;z.insert&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[ie+P-1])&z.hash_mask,z.prev[ie&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=ie,ie++,z.insert--,!(z.lookahead+z.insert<P)););}while(z.lookahead<q&&z.strm.avail_in!==0)}function Se(z,be){for(var ge,ee;;){if(z.lookahead<q){if(de(z),z.lookahead<q&&be===g)return R;if(z.lookahead===0)break}if(ge=0,z.lookahead>=P&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+P-1])&z.hash_mask,ge=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),ge!==0&&z.strstart-ge<=z.w_size-q&&(z.match_length=ne(z,ge)),z.match_length>=P)if(ee=u._tr_tally(z,z.strstart-z.match_start,z.match_length-P),z.lookahead-=z.match_length,z.match_length<=z.max_lazy_match&&z.lookahead>=P){for(z.match_length--;z.strstart++,z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+P-1])&z.hash_mask,ge=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart,--z.match_length!=0;);z.strstart++}else z.strstart+=z.match_length,z.match_length=0,z.ins_h=z.window[z.strstart],z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+1])&z.hash_mask;else ee=u._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++;if(ee&&($(z,!1),z.strm.avail_out===0))return R}return z.insert=z.strstart<P-1?z.strstart:P-1,be===_?($(z,!0),z.strm.avail_out===0?Q:G):z.last_lit&&($(z,!1),z.strm.avail_out===0)?R:K}function Te(z,be){for(var ge,ee,Z;;){if(z.lookahead<q){if(de(z),z.lookahead<q&&be===g)return R;if(z.lookahead===0)break}if(ge=0,z.lookahead>=P&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+P-1])&z.hash_mask,ge=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),z.prev_length=z.match_length,z.prev_match=z.match_start,z.match_length=P-1,ge!==0&&z.prev_length<z.max_lazy_match&&z.strstart-ge<=z.w_size-q&&(z.match_length=ne(z,ge),z.match_length<=5&&(z.strategy===1||z.match_length===P&&4096<z.strstart-z.match_start)&&(z.match_length=P-1)),z.prev_length>=P&&z.match_length<=z.prev_length){for(Z=z.strstart+z.lookahead-P,ee=u._tr_tally(z,z.strstart-1-z.prev_match,z.prev_length-P),z.lookahead-=z.prev_length-1,z.prev_length-=2;++z.strstart<=Z&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+P-1])&z.hash_mask,ge=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),--z.prev_length!=0;);if(z.match_available=0,z.match_length=P-1,z.strstart++,ee&&($(z,!1),z.strm.avail_out===0))return R}else if(z.match_available){if((ee=u._tr_tally(z,0,z.window[z.strstart-1]))&&$(z,!1),z.strstart++,z.lookahead--,z.strm.avail_out===0)return R}else z.match_available=1,z.strstart++,z.lookahead--}return z.match_available&&(ee=u._tr_tally(z,0,z.window[z.strstart-1]),z.match_available=0),z.insert=z.strstart<P-1?z.strstart:P-1,be===_?($(z,!0),z.strm.avail_out===0?Q:G):z.last_lit&&($(z,!1),z.strm.avail_out===0)?R:K}function Ee(z,be,ge,ee,Z){this.good_length=z,this.max_lazy=be,this.nice_length=ge,this.max_chain=ee,this.func=Z}function pe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*O),this.dyn_dtree=new l.Buf16(2*(2*F+1)),this.bl_tree=new l.Buf16(2*(2*H+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(D+1),this.heap=new l.Buf16(2*U+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*U+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Fe(z){var be;return z&&z.state?(z.total_in=z.total_out=0,z.data_type=C,(be=z.state).pending=0,be.pending_out=0,be.wrap<0&&(be.wrap=-be.wrap),be.status=be.wrap?j:M,z.adler=be.wrap===2?0:1,be.last_flush=g,u._tr_init(be),b):X(z,S)}function He(z){var be=Fe(z);return be===b&&(function(ge){ge.window_size=2*ge.w_size,re(ge.head),ge.max_lazy_match=o[ge.level].max_lazy,ge.good_match=o[ge.level].good_length,ge.nice_match=o[ge.level].nice_length,ge.max_chain_length=o[ge.level].max_chain,ge.strstart=0,ge.block_start=0,ge.lookahead=0,ge.insert=0,ge.match_length=ge.prev_length=P-1,ge.match_available=0,ge.ins_h=0})(z.state),be}function Ne(z,be,ge,ee,Z,ie){if(!z)return S;var we=1;if(be===x&&(be=6),ee<0?(we=0,ee=-ee):15<ee&&(we=2,ee-=16),Z<1||A<Z||ge!==T||ee<8||15<ee||be<0||9<be||ie<0||E<ie)return X(z,S);ee===8&&(ee=9);var xe=new pe;return(z.state=xe).strm=z,xe.wrap=we,xe.gzhead=null,xe.w_bits=ee,xe.w_size=1<<xe.w_bits,xe.w_mask=xe.w_size-1,xe.hash_bits=Z+7,xe.hash_size=1<<xe.hash_bits,xe.hash_mask=xe.hash_size-1,xe.hash_shift=~~((xe.hash_bits+P-1)/P),xe.window=new l.Buf8(2*xe.w_size),xe.head=new l.Buf16(xe.hash_size),xe.prev=new l.Buf16(xe.w_size),xe.lit_bufsize=1<<Z+6,xe.pending_buf_size=4*xe.lit_bufsize,xe.pending_buf=new l.Buf8(xe.pending_buf_size),xe.d_buf=1*xe.lit_bufsize,xe.l_buf=3*xe.lit_bufsize,xe.level=be,xe.strategy=ie,xe.method=ge,He(z)}o=[new Ee(0,0,0,0,function(z,be){var ge=65535;for(ge>z.pending_buf_size-5&&(ge=z.pending_buf_size-5);;){if(z.lookahead<=1){if(de(z),z.lookahead===0&&be===g)return R;if(z.lookahead===0)break}z.strstart+=z.lookahead,z.lookahead=0;var ee=z.block_start+ge;if((z.strstart===0||z.strstart>=ee)&&(z.lookahead=z.strstart-ee,z.strstart=ee,$(z,!1),z.strm.avail_out===0)||z.strstart-z.block_start>=z.w_size-q&&($(z,!1),z.strm.avail_out===0))return R}return z.insert=0,be===_?($(z,!0),z.strm.avail_out===0?Q:G):(z.strstart>z.block_start&&($(z,!1),z.strm.avail_out),R)}),new Ee(4,4,8,4,Se),new Ee(4,5,16,8,Se),new Ee(4,6,32,32,Se),new Ee(4,4,16,16,Te),new Ee(8,16,32,32,Te),new Ee(8,16,128,128,Te),new Ee(8,32,128,256,Te),new Ee(32,128,258,1024,Te),new Ee(32,258,258,4096,Te)],i.deflateInit=function(z,be){return Ne(z,be,T,15,8,0)},i.deflateInit2=Ne,i.deflateReset=He,i.deflateResetKeep=Fe,i.deflateSetHeader=function(z,be){return z&&z.state?z.state.wrap!==2?S:(z.state.gzhead=be,b):S},i.deflate=function(z,be){var ge,ee,Z,ie;if(!z||!z.state||5<be||be<0)return z?X(z,S):S;if(ee=z.state,!z.output||!z.input&&z.avail_in!==0||ee.status===666&&be!==_)return X(z,z.avail_out===0?-5:S);if(ee.strm=z,ge=ee.last_flush,ee.last_flush=be,ee.status===j)if(ee.wrap===2)z.adler=0,te(ee,31),te(ee,139),te(ee,8),ee.gzhead?(te(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),te(ee,255&ee.gzhead.time),te(ee,ee.gzhead.time>>8&255),te(ee,ee.gzhead.time>>16&255),te(ee,ee.gzhead.time>>24&255),te(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),te(ee,255&ee.gzhead.os),ee.gzhead.extra&&ee.gzhead.extra.length&&(te(ee,255&ee.gzhead.extra.length),te(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(z.adler=f(z.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=69):(te(ee,0),te(ee,0),te(ee,0),te(ee,0),te(ee,0),te(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),te(ee,3),ee.status=M);else{var we=T+(ee.w_bits-8<<4)<<8;we|=(2<=ee.strategy||ee.level<2?0:ee.level<6?1:ee.level===6?2:3)<<6,ee.strstart!==0&&(we|=32),we+=31-we%31,ee.status=M,ae(ee,we),ee.strstart!==0&&(ae(ee,z.adler>>>16),ae(ee,65535&z.adler)),z.adler=1}if(ee.status===69)if(ee.gzhead.extra){for(Z=ee.pending;ee.gzindex<(65535&ee.gzhead.extra.length)&&(ee.pending!==ee.pending_buf_size||(ee.gzhead.hcrc&&ee.pending>Z&&(z.adler=f(z.adler,ee.pending_buf,ee.pending-Z,Z)),B(z),Z=ee.pending,ee.pending!==ee.pending_buf_size));)te(ee,255&ee.gzhead.extra[ee.gzindex]),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>Z&&(z.adler=f(z.adler,ee.pending_buf,ee.pending-Z,Z)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=73)}else ee.status=73;if(ee.status===73)if(ee.gzhead.name){Z=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>Z&&(z.adler=f(z.adler,ee.pending_buf,ee.pending-Z,Z)),B(z),Z=ee.pending,ee.pending===ee.pending_buf_size)){ie=1;break}ie=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0,te(ee,ie)}while(ie!==0);ee.gzhead.hcrc&&ee.pending>Z&&(z.adler=f(z.adler,ee.pending_buf,ee.pending-Z,Z)),ie===0&&(ee.gzindex=0,ee.status=91)}else ee.status=91;if(ee.status===91)if(ee.gzhead.comment){Z=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>Z&&(z.adler=f(z.adler,ee.pending_buf,ee.pending-Z,Z)),B(z),Z=ee.pending,ee.pending===ee.pending_buf_size)){ie=1;break}ie=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0,te(ee,ie)}while(ie!==0);ee.gzhead.hcrc&&ee.pending>Z&&(z.adler=f(z.adler,ee.pending_buf,ee.pending-Z,Z)),ie===0&&(ee.status=103)}else ee.status=103;if(ee.status===103&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&B(z),ee.pending+2<=ee.pending_buf_size&&(te(ee,255&z.adler),te(ee,z.adler>>8&255),z.adler=0,ee.status=M)):ee.status=M),ee.pending!==0){if(B(z),z.avail_out===0)return ee.last_flush=-1,b}else if(z.avail_in===0&&J(be)<=J(ge)&&be!==_)return X(z,-5);if(ee.status===666&&z.avail_in!==0)return X(z,-5);if(z.avail_in!==0||ee.lookahead!==0||be!==g&&ee.status!==666){var xe=ee.strategy===2?(function(oe,je){for(var Pe;;){if(oe.lookahead===0&&(de(oe),oe.lookahead===0)){if(je===g)return R;break}if(oe.match_length=0,Pe=u._tr_tally(oe,0,oe.window[oe.strstart]),oe.lookahead--,oe.strstart++,Pe&&($(oe,!1),oe.strm.avail_out===0))return R}return oe.insert=0,je===_?($(oe,!0),oe.strm.avail_out===0?Q:G):oe.last_lit&&($(oe,!1),oe.strm.avail_out===0)?R:K})(ee,be):ee.strategy===3?(function(oe,je){for(var Pe,Oe,Ge,xt,st=oe.window;;){if(oe.lookahead<=L){if(de(oe),oe.lookahead<=L&&je===g)return R;if(oe.lookahead===0)break}if(oe.match_length=0,oe.lookahead>=P&&0<oe.strstart&&(Oe=st[Ge=oe.strstart-1])===st[++Ge]&&Oe===st[++Ge]&&Oe===st[++Ge]){xt=oe.strstart+L;do;while(Oe===st[++Ge]&&Oe===st[++Ge]&&Oe===st[++Ge]&&Oe===st[++Ge]&&Oe===st[++Ge]&&Oe===st[++Ge]&&Oe===st[++Ge]&&Oe===st[++Ge]&&Ge<xt);oe.match_length=L-(xt-Ge),oe.match_length>oe.lookahead&&(oe.match_length=oe.lookahead)}if(oe.match_length>=P?(Pe=u._tr_tally(oe,1,oe.match_length-P),oe.lookahead-=oe.match_length,oe.strstart+=oe.match_length,oe.match_length=0):(Pe=u._tr_tally(oe,0,oe.window[oe.strstart]),oe.lookahead--,oe.strstart++),Pe&&($(oe,!1),oe.strm.avail_out===0))return R}return oe.insert=0,je===_?($(oe,!0),oe.strm.avail_out===0?Q:G):oe.last_lit&&($(oe,!1),oe.strm.avail_out===0)?R:K})(ee,be):o[ee.level].func(ee,be);if(xe!==Q&&xe!==G||(ee.status=666),xe===R||xe===Q)return z.avail_out===0&&(ee.last_flush=-1),b;if(xe===K&&(be===1?u._tr_align(ee):be!==5&&(u._tr_stored_block(ee,0,0,!1),be===3&&(re(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),B(z),z.avail_out===0))return ee.last_flush=-1,b}return be!==_?b:ee.wrap<=0?1:(ee.wrap===2?(te(ee,255&z.adler),te(ee,z.adler>>8&255),te(ee,z.adler>>16&255),te(ee,z.adler>>24&255),te(ee,255&z.total_in),te(ee,z.total_in>>8&255),te(ee,z.total_in>>16&255),te(ee,z.total_in>>24&255)):(ae(ee,z.adler>>>16),ae(ee,65535&z.adler)),B(z),0<ee.wrap&&(ee.wrap=-ee.wrap),ee.pending!==0?b:1)},i.deflateEnd=function(z){var be;return z&&z.state?(be=z.state.status)!==j&&be!==69&&be!==73&&be!==91&&be!==103&&be!==M&&be!==666?X(z,S):(z.state=null,be===M?X(z,-3):b):S},i.deflateSetDictionary=function(z,be){var ge,ee,Z,ie,we,xe,oe,je,Pe=be.length;if(!z||!z.state||(ie=(ge=z.state).wrap)===2||ie===1&&ge.status!==j||ge.lookahead)return S;for(ie===1&&(z.adler=h(z.adler,be,Pe,0)),ge.wrap=0,Pe>=ge.w_size&&(ie===0&&(re(ge.head),ge.strstart=0,ge.block_start=0,ge.insert=0),je=new l.Buf8(ge.w_size),l.arraySet(je,be,Pe-ge.w_size,ge.w_size,0),be=je,Pe=ge.w_size),we=z.avail_in,xe=z.next_in,oe=z.input,z.avail_in=Pe,z.next_in=0,z.input=be,de(ge);ge.lookahead>=P;){for(ee=ge.strstart,Z=ge.lookahead-(P-1);ge.ins_h=(ge.ins_h<<ge.hash_shift^ge.window[ee+P-1])&ge.hash_mask,ge.prev[ee&ge.w_mask]=ge.head[ge.ins_h],ge.head[ge.ins_h]=ee,ee++,--Z;);ge.strstart=ee,ge.lookahead=P-1,de(ge)}return ge.strstart+=ge.lookahead,ge.block_start=ge.strstart,ge.insert=ge.lookahead,ge.lookahead=0,ge.match_length=ge.prev_length=P-1,ge.match_available=0,z.next_in=xe,z.input=oe,z.avail_in=we,ge.wrap=ie,b},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(o,l){var u,h,f,p,g,_,b,S,x,E,C,T,A,U,F,H,O,D,P,L,q,j,M,R,K;u=o.state,h=o.next_in,R=o.input,f=h+(o.avail_in-5),p=o.next_out,K=o.output,g=p-(l-o.avail_out),_=p+(o.avail_out-257),b=u.dmax,S=u.wsize,x=u.whave,E=u.wnext,C=u.window,T=u.hold,A=u.bits,U=u.lencode,F=u.distcode,H=(1<<u.lenbits)-1,O=(1<<u.distbits)-1;e:do{A<15&&(T+=R[h++]<<A,A+=8,T+=R[h++]<<A,A+=8),D=U[T&H];t:for(;;){if(T>>>=P=D>>>24,A-=P,(P=D>>>16&255)===0)K[p++]=65535&D;else{if(!(16&P)){if((64&P)==0){D=U[(65535&D)+(T&(1<<P)-1)];continue t}if(32&P){u.mode=12;break e}o.msg="invalid literal/length code",u.mode=30;break e}L=65535&D,(P&=15)&&(A<P&&(T+=R[h++]<<A,A+=8),L+=T&(1<<P)-1,T>>>=P,A-=P),A<15&&(T+=R[h++]<<A,A+=8,T+=R[h++]<<A,A+=8),D=F[T&O];n:for(;;){if(T>>>=P=D>>>24,A-=P,!(16&(P=D>>>16&255))){if((64&P)==0){D=F[(65535&D)+(T&(1<<P)-1)];continue n}o.msg="invalid distance code",u.mode=30;break e}if(q=65535&D,A<(P&=15)&&(T+=R[h++]<<A,(A+=8)<P&&(T+=R[h++]<<A,A+=8)),b<(q+=T&(1<<P)-1)){o.msg="invalid distance too far back",u.mode=30;break e}if(T>>>=P,A-=P,(P=p-g)<q){if(x<(P=q-P)&&u.sane){o.msg="invalid distance too far back",u.mode=30;break e}if(M=C,(j=0)===E){if(j+=S-P,P<L){for(L-=P;K[p++]=C[j++],--P;);j=p-q,M=K}}else if(E<P){if(j+=S+E-P,(P-=E)<L){for(L-=P;K[p++]=C[j++],--P;);if(j=0,E<L){for(L-=P=E;K[p++]=C[j++],--P;);j=p-q,M=K}}}else if(j+=E-P,P<L){for(L-=P;K[p++]=C[j++],--P;);j=p-q,M=K}for(;2<L;)K[p++]=M[j++],K[p++]=M[j++],K[p++]=M[j++],L-=3;L&&(K[p++]=M[j++],1<L&&(K[p++]=M[j++]))}else{for(j=p-q;K[p++]=K[j++],K[p++]=K[j++],K[p++]=K[j++],2<(L-=3););L&&(K[p++]=K[j++],1<L&&(K[p++]=K[j++]))}break}}break}}while(h<f&&p<_);h-=L=A>>3,T&=(1<<(A-=L<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<f?f-h+5:5-(h-f),o.avail_out=p<_?_-p+257:257-(p-_),u.hold=T,u.bits=A}},{}],49:[function(n,r,i){var o=n("../utils/common"),l=n("./adler32"),u=n("./crc32"),h=n("./inffast"),f=n("./inftrees"),p=1,g=2,_=0,b=-2,S=1,x=852,E=592;function C(j){return(j>>>24&255)+(j>>>8&65280)+((65280&j)<<8)+((255&j)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(j){var M;return j&&j.state?(M=j.state,j.total_in=j.total_out=M.total=0,j.msg="",M.wrap&&(j.adler=1&M.wrap),M.mode=S,M.last=0,M.havedict=0,M.dmax=32768,M.head=null,M.hold=0,M.bits=0,M.lencode=M.lendyn=new o.Buf32(x),M.distcode=M.distdyn=new o.Buf32(E),M.sane=1,M.back=-1,_):b}function U(j){var M;return j&&j.state?((M=j.state).wsize=0,M.whave=0,M.wnext=0,A(j)):b}function F(j,M){var R,K;return j&&j.state?(K=j.state,M<0?(R=0,M=-M):(R=1+(M>>4),M<48&&(M&=15)),M&&(M<8||15<M)?b:(K.window!==null&&K.wbits!==M&&(K.window=null),K.wrap=R,K.wbits=M,U(j))):b}function H(j,M){var R,K;return j?(K=new T,(j.state=K).window=null,(R=F(j,M))!==_&&(j.state=null),R):b}var O,D,P=!0;function L(j){if(P){var M;for(O=new o.Buf32(512),D=new o.Buf32(32),M=0;M<144;)j.lens[M++]=8;for(;M<256;)j.lens[M++]=9;for(;M<280;)j.lens[M++]=7;for(;M<288;)j.lens[M++]=8;for(f(p,j.lens,0,288,O,0,j.work,{bits:9}),M=0;M<32;)j.lens[M++]=5;f(g,j.lens,0,32,D,0,j.work,{bits:5}),P=!1}j.lencode=O,j.lenbits=9,j.distcode=D,j.distbits=5}function q(j,M,R,K){var Q,G=j.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new o.Buf8(G.wsize)),K>=G.wsize?(o.arraySet(G.window,M,R-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(K<(Q=G.wsize-G.wnext)&&(Q=K),o.arraySet(G.window,M,R-K,Q,G.wnext),(K-=Q)?(o.arraySet(G.window,M,R-K,K,0),G.wnext=K,G.whave=G.wsize):(G.wnext+=Q,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=Q))),0}i.inflateReset=U,i.inflateReset2=F,i.inflateResetKeep=A,i.inflateInit=function(j){return H(j,15)},i.inflateInit2=H,i.inflate=function(j,M){var R,K,Q,G,X,J,re,B,$,te,ae,ne,de,Se,Te,Ee,pe,Fe,He,Ne,z,be,ge,ee,Z=0,ie=new o.Buf8(4),we=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!j||!j.state||!j.output||!j.input&&j.avail_in!==0)return b;(R=j.state).mode===12&&(R.mode=13),X=j.next_out,Q=j.output,re=j.avail_out,G=j.next_in,K=j.input,J=j.avail_in,B=R.hold,$=R.bits,te=J,ae=re,be=_;e:for(;;)switch(R.mode){case S:if(R.wrap===0){R.mode=13;break}for(;$<16;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}if(2&R.wrap&&B===35615){ie[R.check=0]=255&B,ie[1]=B>>>8&255,R.check=u(R.check,ie,2,0),$=B=0,R.mode=2;break}if(R.flags=0,R.head&&(R.head.done=!1),!(1&R.wrap)||(((255&B)<<8)+(B>>8))%31){j.msg="incorrect header check",R.mode=30;break}if((15&B)!=8){j.msg="unknown compression method",R.mode=30;break}if($-=4,z=8+(15&(B>>>=4)),R.wbits===0)R.wbits=z;else if(z>R.wbits){j.msg="invalid window size",R.mode=30;break}R.dmax=1<<z,j.adler=R.check=1,R.mode=512&B?10:12,$=B=0;break;case 2:for(;$<16;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}if(R.flags=B,(255&R.flags)!=8){j.msg="unknown compression method",R.mode=30;break}if(57344&R.flags){j.msg="unknown header flags set",R.mode=30;break}R.head&&(R.head.text=B>>8&1),512&R.flags&&(ie[0]=255&B,ie[1]=B>>>8&255,R.check=u(R.check,ie,2,0)),$=B=0,R.mode=3;case 3:for(;$<32;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}R.head&&(R.head.time=B),512&R.flags&&(ie[0]=255&B,ie[1]=B>>>8&255,ie[2]=B>>>16&255,ie[3]=B>>>24&255,R.check=u(R.check,ie,4,0)),$=B=0,R.mode=4;case 4:for(;$<16;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}R.head&&(R.head.xflags=255&B,R.head.os=B>>8),512&R.flags&&(ie[0]=255&B,ie[1]=B>>>8&255,R.check=u(R.check,ie,2,0)),$=B=0,R.mode=5;case 5:if(1024&R.flags){for(;$<16;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}R.length=B,R.head&&(R.head.extra_len=B),512&R.flags&&(ie[0]=255&B,ie[1]=B>>>8&255,R.check=u(R.check,ie,2,0)),$=B=0}else R.head&&(R.head.extra=null);R.mode=6;case 6:if(1024&R.flags&&(J<(ne=R.length)&&(ne=J),ne&&(R.head&&(z=R.head.extra_len-R.length,R.head.extra||(R.head.extra=new Array(R.head.extra_len)),o.arraySet(R.head.extra,K,G,ne,z)),512&R.flags&&(R.check=u(R.check,K,ne,G)),J-=ne,G+=ne,R.length-=ne),R.length))break e;R.length=0,R.mode=7;case 7:if(2048&R.flags){if(J===0)break e;for(ne=0;z=K[G+ne++],R.head&&z&&R.length<65536&&(R.head.name+=String.fromCharCode(z)),z&&ne<J;);if(512&R.flags&&(R.check=u(R.check,K,ne,G)),J-=ne,G+=ne,z)break e}else R.head&&(R.head.name=null);R.length=0,R.mode=8;case 8:if(4096&R.flags){if(J===0)break e;for(ne=0;z=K[G+ne++],R.head&&z&&R.length<65536&&(R.head.comment+=String.fromCharCode(z)),z&&ne<J;);if(512&R.flags&&(R.check=u(R.check,K,ne,G)),J-=ne,G+=ne,z)break e}else R.head&&(R.head.comment=null);R.mode=9;case 9:if(512&R.flags){for(;$<16;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}if(B!==(65535&R.check)){j.msg="header crc mismatch",R.mode=30;break}$=B=0}R.head&&(R.head.hcrc=R.flags>>9&1,R.head.done=!0),j.adler=R.check=0,R.mode=12;break;case 10:for(;$<32;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}j.adler=R.check=C(B),$=B=0,R.mode=11;case 11:if(R.havedict===0)return j.next_out=X,j.avail_out=re,j.next_in=G,j.avail_in=J,R.hold=B,R.bits=$,2;j.adler=R.check=1,R.mode=12;case 12:if(M===5||M===6)break e;case 13:if(R.last){B>>>=7&$,$-=7&$,R.mode=27;break}for(;$<3;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}switch(R.last=1&B,$-=1,3&(B>>>=1)){case 0:R.mode=14;break;case 1:if(L(R),R.mode=20,M!==6)break;B>>>=2,$-=2;break e;case 2:R.mode=17;break;case 3:j.msg="invalid block type",R.mode=30}B>>>=2,$-=2;break;case 14:for(B>>>=7&$,$-=7&$;$<32;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}if((65535&B)!=(B>>>16^65535)){j.msg="invalid stored block lengths",R.mode=30;break}if(R.length=65535&B,$=B=0,R.mode=15,M===6)break e;case 15:R.mode=16;case 16:if(ne=R.length){if(J<ne&&(ne=J),re<ne&&(ne=re),ne===0)break e;o.arraySet(Q,K,G,ne,X),J-=ne,G+=ne,re-=ne,X+=ne,R.length-=ne;break}R.mode=12;break;case 17:for(;$<14;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}if(R.nlen=257+(31&B),B>>>=5,$-=5,R.ndist=1+(31&B),B>>>=5,$-=5,R.ncode=4+(15&B),B>>>=4,$-=4,286<R.nlen||30<R.ndist){j.msg="too many length or distance symbols",R.mode=30;break}R.have=0,R.mode=18;case 18:for(;R.have<R.ncode;){for(;$<3;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}R.lens[we[R.have++]]=7&B,B>>>=3,$-=3}for(;R.have<19;)R.lens[we[R.have++]]=0;if(R.lencode=R.lendyn,R.lenbits=7,ge={bits:R.lenbits},be=f(0,R.lens,0,19,R.lencode,0,R.work,ge),R.lenbits=ge.bits,be){j.msg="invalid code lengths set",R.mode=30;break}R.have=0,R.mode=19;case 19:for(;R.have<R.nlen+R.ndist;){for(;Ee=(Z=R.lencode[B&(1<<R.lenbits)-1])>>>16&255,pe=65535&Z,!((Te=Z>>>24)<=$);){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}if(pe<16)B>>>=Te,$-=Te,R.lens[R.have++]=pe;else{if(pe===16){for(ee=Te+2;$<ee;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}if(B>>>=Te,$-=Te,R.have===0){j.msg="invalid bit length repeat",R.mode=30;break}z=R.lens[R.have-1],ne=3+(3&B),B>>>=2,$-=2}else if(pe===17){for(ee=Te+3;$<ee;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}$-=Te,z=0,ne=3+(7&(B>>>=Te)),B>>>=3,$-=3}else{for(ee=Te+7;$<ee;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}$-=Te,z=0,ne=11+(127&(B>>>=Te)),B>>>=7,$-=7}if(R.have+ne>R.nlen+R.ndist){j.msg="invalid bit length repeat",R.mode=30;break}for(;ne--;)R.lens[R.have++]=z}}if(R.mode===30)break;if(R.lens[256]===0){j.msg="invalid code -- missing end-of-block",R.mode=30;break}if(R.lenbits=9,ge={bits:R.lenbits},be=f(p,R.lens,0,R.nlen,R.lencode,0,R.work,ge),R.lenbits=ge.bits,be){j.msg="invalid literal/lengths set",R.mode=30;break}if(R.distbits=6,R.distcode=R.distdyn,ge={bits:R.distbits},be=f(g,R.lens,R.nlen,R.ndist,R.distcode,0,R.work,ge),R.distbits=ge.bits,be){j.msg="invalid distances set",R.mode=30;break}if(R.mode=20,M===6)break e;case 20:R.mode=21;case 21:if(6<=J&&258<=re){j.next_out=X,j.avail_out=re,j.next_in=G,j.avail_in=J,R.hold=B,R.bits=$,h(j,ae),X=j.next_out,Q=j.output,re=j.avail_out,G=j.next_in,K=j.input,J=j.avail_in,B=R.hold,$=R.bits,R.mode===12&&(R.back=-1);break}for(R.back=0;Ee=(Z=R.lencode[B&(1<<R.lenbits)-1])>>>16&255,pe=65535&Z,!((Te=Z>>>24)<=$);){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}if(Ee&&(240&Ee)==0){for(Fe=Te,He=Ee,Ne=pe;Ee=(Z=R.lencode[Ne+((B&(1<<Fe+He)-1)>>Fe)])>>>16&255,pe=65535&Z,!(Fe+(Te=Z>>>24)<=$);){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}B>>>=Fe,$-=Fe,R.back+=Fe}if(B>>>=Te,$-=Te,R.back+=Te,R.length=pe,Ee===0){R.mode=26;break}if(32&Ee){R.back=-1,R.mode=12;break}if(64&Ee){j.msg="invalid literal/length code",R.mode=30;break}R.extra=15&Ee,R.mode=22;case 22:if(R.extra){for(ee=R.extra;$<ee;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}R.length+=B&(1<<R.extra)-1,B>>>=R.extra,$-=R.extra,R.back+=R.extra}R.was=R.length,R.mode=23;case 23:for(;Ee=(Z=R.distcode[B&(1<<R.distbits)-1])>>>16&255,pe=65535&Z,!((Te=Z>>>24)<=$);){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}if((240&Ee)==0){for(Fe=Te,He=Ee,Ne=pe;Ee=(Z=R.distcode[Ne+((B&(1<<Fe+He)-1)>>Fe)])>>>16&255,pe=65535&Z,!(Fe+(Te=Z>>>24)<=$);){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}B>>>=Fe,$-=Fe,R.back+=Fe}if(B>>>=Te,$-=Te,R.back+=Te,64&Ee){j.msg="invalid distance code",R.mode=30;break}R.offset=pe,R.extra=15&Ee,R.mode=24;case 24:if(R.extra){for(ee=R.extra;$<ee;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}R.offset+=B&(1<<R.extra)-1,B>>>=R.extra,$-=R.extra,R.back+=R.extra}if(R.offset>R.dmax){j.msg="invalid distance too far back",R.mode=30;break}R.mode=25;case 25:if(re===0)break e;if(ne=ae-re,R.offset>ne){if((ne=R.offset-ne)>R.whave&&R.sane){j.msg="invalid distance too far back",R.mode=30;break}de=ne>R.wnext?(ne-=R.wnext,R.wsize-ne):R.wnext-ne,ne>R.length&&(ne=R.length),Se=R.window}else Se=Q,de=X-R.offset,ne=R.length;for(re<ne&&(ne=re),re-=ne,R.length-=ne;Q[X++]=Se[de++],--ne;);R.length===0&&(R.mode=21);break;case 26:if(re===0)break e;Q[X++]=R.length,re--,R.mode=21;break;case 27:if(R.wrap){for(;$<32;){if(J===0)break e;J--,B|=K[G++]<<$,$+=8}if(ae-=re,j.total_out+=ae,R.total+=ae,ae&&(j.adler=R.check=R.flags?u(R.check,Q,ae,X-ae):l(R.check,Q,ae,X-ae)),ae=re,(R.flags?B:C(B))!==R.check){j.msg="incorrect data check",R.mode=30;break}$=B=0}R.mode=28;case 28:if(R.wrap&&R.flags){for(;$<32;){if(J===0)break e;J--,B+=K[G++]<<$,$+=8}if(B!==(4294967295&R.total)){j.msg="incorrect length check",R.mode=30;break}$=B=0}R.mode=29;case 29:be=1;break e;case 30:be=-3;break e;case 31:return-4;default:return b}return j.next_out=X,j.avail_out=re,j.next_in=G,j.avail_in=J,R.hold=B,R.bits=$,(R.wsize||ae!==j.avail_out&&R.mode<30&&(R.mode<27||M!==4))&&q(j,j.output,j.next_out,ae-j.avail_out)?(R.mode=31,-4):(te-=j.avail_in,ae-=j.avail_out,j.total_in+=te,j.total_out+=ae,R.total+=ae,R.wrap&&ae&&(j.adler=R.check=R.flags?u(R.check,Q,ae,j.next_out-ae):l(R.check,Q,ae,j.next_out-ae)),j.data_type=R.bits+(R.last?64:0)+(R.mode===12?128:0)+(R.mode===20||R.mode===15?256:0),(te==0&&ae===0||M===4)&&be===_&&(be=-5),be)},i.inflateEnd=function(j){if(!j||!j.state)return b;var M=j.state;return M.window&&(M.window=null),j.state=null,_},i.inflateGetHeader=function(j,M){var R;return j&&j.state?(2&(R=j.state).wrap)==0?b:((R.head=M).done=!1,_):b},i.inflateSetDictionary=function(j,M){var R,K=M.length;return j&&j.state?(R=j.state).wrap!==0&&R.mode!==11?b:R.mode===11&&l(1,M,K,0)!==R.check?-3:q(j,M,K,K)?(R.mode=31,-4):(R.havedict=1,_):b},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var o=n("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,_,b,S,x,E,C){var T,A,U,F,H,O,D,P,L,q=C.bits,j=0,M=0,R=0,K=0,Q=0,G=0,X=0,J=0,re=0,B=0,$=null,te=0,ae=new o.Buf16(16),ne=new o.Buf16(16),de=null,Se=0;for(j=0;j<=15;j++)ae[j]=0;for(M=0;M<b;M++)ae[g[_+M]]++;for(Q=q,K=15;1<=K&&ae[K]===0;K--);if(K<Q&&(Q=K),K===0)return S[x++]=20971520,S[x++]=20971520,C.bits=1,0;for(R=1;R<K&&ae[R]===0;R++);for(Q<R&&(Q=R),j=J=1;j<=15;j++)if(J<<=1,(J-=ae[j])<0)return-1;if(0<J&&(p===0||K!==1))return-1;for(ne[1]=0,j=1;j<15;j++)ne[j+1]=ne[j]+ae[j];for(M=0;M<b;M++)g[_+M]!==0&&(E[ne[g[_+M]]++]=M);if(O=p===0?($=de=E,19):p===1?($=l,te-=257,de=u,Se-=257,256):($=h,de=f,-1),j=R,H=x,X=M=B=0,U=-1,F=(re=1<<(G=Q))-1,p===1&&852<re||p===2&&592<re)return 1;for(;;){for(D=j-X,L=E[M]<O?(P=0,E[M]):E[M]>O?(P=de[Se+E[M]],$[te+E[M]]):(P=96,0),T=1<<j-X,R=A=1<<G;S[H+(B>>X)+(A-=T)]=D<<24|P<<16|L|0,A!==0;);for(T=1<<j-1;B&T;)T>>=1;if(T!==0?(B&=T-1,B+=T):B=0,M++,--ae[j]==0){if(j===K)break;j=g[_+E[M]]}if(Q<j&&(B&F)!==U){for(X===0&&(X=Q),H+=R,J=1<<(G=j-X);G+X<K&&!((J-=ae[G+X])<=0);)G++,J<<=1;if(re+=1<<G,p===1&&852<re||p===2&&592<re)return 1;S[U=B&F]=Q<<24|G<<16|H-x|0}}return B!==0&&(S[H+B]=j-X<<24|64<<16|0),C.bits=Q,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var o=n("../utils/common"),l=0,u=1;function h(Z){for(var ie=Z.length;0<=--ie;)Z[ie]=0}var f=0,p=29,g=256,_=g+1+p,b=30,S=19,x=2*_+1,E=15,C=16,T=7,A=256,U=16,F=17,H=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(_+2));h(q);var j=new Array(2*b);h(j);var M=new Array(512);h(M);var R=new Array(256);h(R);var K=new Array(p);h(K);var Q,G,X,J=new Array(b);function re(Z,ie,we,xe,oe){this.static_tree=Z,this.extra_bits=ie,this.extra_base=we,this.elems=xe,this.max_length=oe,this.has_stree=Z&&Z.length}function B(Z,ie){this.dyn_tree=Z,this.max_code=0,this.stat_desc=ie}function $(Z){return Z<256?M[Z]:M[256+(Z>>>7)]}function te(Z,ie){Z.pending_buf[Z.pending++]=255&ie,Z.pending_buf[Z.pending++]=ie>>>8&255}function ae(Z,ie,we){Z.bi_valid>C-we?(Z.bi_buf|=ie<<Z.bi_valid&65535,te(Z,Z.bi_buf),Z.bi_buf=ie>>C-Z.bi_valid,Z.bi_valid+=we-C):(Z.bi_buf|=ie<<Z.bi_valid&65535,Z.bi_valid+=we)}function ne(Z,ie,we){ae(Z,we[2*ie],we[2*ie+1])}function de(Z,ie){for(var we=0;we|=1&Z,Z>>>=1,we<<=1,0<--ie;);return we>>>1}function Se(Z,ie,we){var xe,oe,je=new Array(E+1),Pe=0;for(xe=1;xe<=E;xe++)je[xe]=Pe=Pe+we[xe-1]<<1;for(oe=0;oe<=ie;oe++){var Oe=Z[2*oe+1];Oe!==0&&(Z[2*oe]=de(je[Oe]++,Oe))}}function Te(Z){var ie;for(ie=0;ie<_;ie++)Z.dyn_ltree[2*ie]=0;for(ie=0;ie<b;ie++)Z.dyn_dtree[2*ie]=0;for(ie=0;ie<S;ie++)Z.bl_tree[2*ie]=0;Z.dyn_ltree[2*A]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0}function Ee(Z){8<Z.bi_valid?te(Z,Z.bi_buf):0<Z.bi_valid&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0}function pe(Z,ie,we,xe){var oe=2*ie,je=2*we;return Z[oe]<Z[je]||Z[oe]===Z[je]&&xe[ie]<=xe[we]}function Fe(Z,ie,we){for(var xe=Z.heap[we],oe=we<<1;oe<=Z.heap_len&&(oe<Z.heap_len&&pe(ie,Z.heap[oe+1],Z.heap[oe],Z.depth)&&oe++,!pe(ie,xe,Z.heap[oe],Z.depth));)Z.heap[we]=Z.heap[oe],we=oe,oe<<=1;Z.heap[we]=xe}function He(Z,ie,we){var xe,oe,je,Pe,Oe=0;if(Z.last_lit!==0)for(;xe=Z.pending_buf[Z.d_buf+2*Oe]<<8|Z.pending_buf[Z.d_buf+2*Oe+1],oe=Z.pending_buf[Z.l_buf+Oe],Oe++,xe===0?ne(Z,oe,ie):(ne(Z,(je=R[oe])+g+1,ie),(Pe=O[je])!==0&&ae(Z,oe-=K[je],Pe),ne(Z,je=$(--xe),we),(Pe=D[je])!==0&&ae(Z,xe-=J[je],Pe)),Oe<Z.last_lit;);ne(Z,A,ie)}function Ne(Z,ie){var we,xe,oe,je=ie.dyn_tree,Pe=ie.stat_desc.static_tree,Oe=ie.stat_desc.has_stree,Ge=ie.stat_desc.elems,xt=-1;for(Z.heap_len=0,Z.heap_max=x,we=0;we<Ge;we++)je[2*we]!==0?(Z.heap[++Z.heap_len]=xt=we,Z.depth[we]=0):je[2*we+1]=0;for(;Z.heap_len<2;)je[2*(oe=Z.heap[++Z.heap_len]=xt<2?++xt:0)]=1,Z.depth[oe]=0,Z.opt_len--,Oe&&(Z.static_len-=Pe[2*oe+1]);for(ie.max_code=xt,we=Z.heap_len>>1;1<=we;we--)Fe(Z,je,we);for(oe=Ge;we=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],Fe(Z,je,1),xe=Z.heap[1],Z.heap[--Z.heap_max]=we,Z.heap[--Z.heap_max]=xe,je[2*oe]=je[2*we]+je[2*xe],Z.depth[oe]=(Z.depth[we]>=Z.depth[xe]?Z.depth[we]:Z.depth[xe])+1,je[2*we+1]=je[2*xe+1]=oe,Z.heap[1]=oe++,Fe(Z,je,1),2<=Z.heap_len;);Z.heap[--Z.heap_max]=Z.heap[1],(function(st,Hn){var ds,Jn,hs,bt,Jt,Qn,Et=Hn.dyn_tree,Ba=Hn.max_code,Ci=Hn.stat_desc.static_tree,Lo=Hn.stat_desc.has_stree,jr=Hn.stat_desc.extra_bits,fs=Hn.stat_desc.extra_base,Lt=Hn.stat_desc.max_length,er=0;for(bt=0;bt<=E;bt++)st.bl_count[bt]=0;for(Et[2*st.heap[st.heap_max]+1]=0,ds=st.heap_max+1;ds<x;ds++)Lt<(bt=Et[2*Et[2*(Jn=st.heap[ds])+1]+1]+1)&&(bt=Lt,er++),Et[2*Jn+1]=bt,Ba<Jn||(st.bl_count[bt]++,Jt=0,fs<=Jn&&(Jt=jr[Jn-fs]),Qn=Et[2*Jn],st.opt_len+=Qn*(bt+Jt),Lo&&(st.static_len+=Qn*(Ci[2*Jn+1]+Jt)));if(er!==0){do{for(bt=Lt-1;st.bl_count[bt]===0;)bt--;st.bl_count[bt]--,st.bl_count[bt+1]+=2,st.bl_count[Lt]--,er-=2}while(0<er);for(bt=Lt;bt!==0;bt--)for(Jn=st.bl_count[bt];Jn!==0;)Ba<(hs=st.heap[--ds])||(Et[2*hs+1]!==bt&&(st.opt_len+=(bt-Et[2*hs+1])*Et[2*hs],Et[2*hs+1]=bt),Jn--)}})(Z,ie),Se(je,xt,Z.bl_count)}function z(Z,ie,we){var xe,oe,je=-1,Pe=ie[1],Oe=0,Ge=7,xt=4;for(Pe===0&&(Ge=138,xt=3),ie[2*(we+1)+1]=65535,xe=0;xe<=we;xe++)oe=Pe,Pe=ie[2*(xe+1)+1],++Oe<Ge&&oe===Pe||(Oe<xt?Z.bl_tree[2*oe]+=Oe:oe!==0?(oe!==je&&Z.bl_tree[2*oe]++,Z.bl_tree[2*U]++):Oe<=10?Z.bl_tree[2*F]++:Z.bl_tree[2*H]++,je=oe,xt=(Oe=0)===Pe?(Ge=138,3):oe===Pe?(Ge=6,3):(Ge=7,4))}function be(Z,ie,we){var xe,oe,je=-1,Pe=ie[1],Oe=0,Ge=7,xt=4;for(Pe===0&&(Ge=138,xt=3),xe=0;xe<=we;xe++)if(oe=Pe,Pe=ie[2*(xe+1)+1],!(++Oe<Ge&&oe===Pe)){if(Oe<xt)for(;ne(Z,oe,Z.bl_tree),--Oe!=0;);else oe!==0?(oe!==je&&(ne(Z,oe,Z.bl_tree),Oe--),ne(Z,U,Z.bl_tree),ae(Z,Oe-3,2)):Oe<=10?(ne(Z,F,Z.bl_tree),ae(Z,Oe-3,3)):(ne(Z,H,Z.bl_tree),ae(Z,Oe-11,7));je=oe,xt=(Oe=0)===Pe?(Ge=138,3):oe===Pe?(Ge=6,3):(Ge=7,4)}}h(J);var ge=!1;function ee(Z,ie,we,xe){ae(Z,(f<<1)+(xe?1:0),3),(function(oe,je,Pe,Oe){Ee(oe),te(oe,Pe),te(oe,~Pe),o.arraySet(oe.pending_buf,oe.window,je,Pe,oe.pending),oe.pending+=Pe})(Z,ie,we)}i._tr_init=function(Z){ge||((function(){var ie,we,xe,oe,je,Pe=new Array(E+1);for(oe=xe=0;oe<p-1;oe++)for(K[oe]=xe,ie=0;ie<1<<O[oe];ie++)R[xe++]=oe;for(R[xe-1]=oe,oe=je=0;oe<16;oe++)for(J[oe]=je,ie=0;ie<1<<D[oe];ie++)M[je++]=oe;for(je>>=7;oe<b;oe++)for(J[oe]=je<<7,ie=0;ie<1<<D[oe]-7;ie++)M[256+je++]=oe;for(we=0;we<=E;we++)Pe[we]=0;for(ie=0;ie<=143;)q[2*ie+1]=8,ie++,Pe[8]++;for(;ie<=255;)q[2*ie+1]=9,ie++,Pe[9]++;for(;ie<=279;)q[2*ie+1]=7,ie++,Pe[7]++;for(;ie<=287;)q[2*ie+1]=8,ie++,Pe[8]++;for(Se(q,_+1,Pe),ie=0;ie<b;ie++)j[2*ie+1]=5,j[2*ie]=de(ie,5);Q=new re(q,O,g+1,_,E),G=new re(j,D,0,b,E),X=new re(new Array(0),P,0,S,T)})(),ge=!0),Z.l_desc=new B(Z.dyn_ltree,Q),Z.d_desc=new B(Z.dyn_dtree,G),Z.bl_desc=new B(Z.bl_tree,X),Z.bi_buf=0,Z.bi_valid=0,Te(Z)},i._tr_stored_block=ee,i._tr_flush_block=function(Z,ie,we,xe){var oe,je,Pe=0;0<Z.level?(Z.strm.data_type===2&&(Z.strm.data_type=(function(Oe){var Ge,xt=4093624447;for(Ge=0;Ge<=31;Ge++,xt>>>=1)if(1&xt&&Oe.dyn_ltree[2*Ge]!==0)return l;if(Oe.dyn_ltree[18]!==0||Oe.dyn_ltree[20]!==0||Oe.dyn_ltree[26]!==0)return u;for(Ge=32;Ge<g;Ge++)if(Oe.dyn_ltree[2*Ge]!==0)return u;return l})(Z)),Ne(Z,Z.l_desc),Ne(Z,Z.d_desc),Pe=(function(Oe){var Ge;for(z(Oe,Oe.dyn_ltree,Oe.l_desc.max_code),z(Oe,Oe.dyn_dtree,Oe.d_desc.max_code),Ne(Oe,Oe.bl_desc),Ge=S-1;3<=Ge&&Oe.bl_tree[2*L[Ge]+1]===0;Ge--);return Oe.opt_len+=3*(Ge+1)+5+5+4,Ge})(Z),oe=Z.opt_len+3+7>>>3,(je=Z.static_len+3+7>>>3)<=oe&&(oe=je)):oe=je=we+5,we+4<=oe&&ie!==-1?ee(Z,ie,we,xe):Z.strategy===4||je===oe?(ae(Z,2+(xe?1:0),3),He(Z,q,j)):(ae(Z,4+(xe?1:0),3),(function(Oe,Ge,xt,st){var Hn;for(ae(Oe,Ge-257,5),ae(Oe,xt-1,5),ae(Oe,st-4,4),Hn=0;Hn<st;Hn++)ae(Oe,Oe.bl_tree[2*L[Hn]+1],3);be(Oe,Oe.dyn_ltree,Ge-1),be(Oe,Oe.dyn_dtree,xt-1)})(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,Pe+1),He(Z,Z.dyn_ltree,Z.dyn_dtree)),Te(Z),xe&&Ee(Z)},i._tr_tally=function(Z,ie,we){return Z.pending_buf[Z.d_buf+2*Z.last_lit]=ie>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&ie,Z.pending_buf[Z.l_buf+Z.last_lit]=255&we,Z.last_lit++,ie===0?Z.dyn_ltree[2*we]++:(Z.matches++,ie--,Z.dyn_ltree[2*(R[we]+g+1)]++,Z.dyn_dtree[2*$(ie)]++),Z.last_lit===Z.lit_bufsize-1},i._tr_align=function(Z){ae(Z,2,3),ne(Z,A,q),(function(ie){ie.bi_valid===16?(te(ie,ie.bi_buf),ie.bi_buf=0,ie.bi_valid=0):8<=ie.bi_valid&&(ie.pending_buf[ie.pending++]=255&ie.bi_buf,ie.bi_buf>>=8,ie.bi_valid-=8)})(Z)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(o){(function(l,u){if(!l.setImmediate){var h,f,p,g,_=1,b={},S=!1,x=l.document,E=Object.getPrototypeOf&&Object.getPrototypeOf(l);E=E&&E.setTimeout?E:l,h={}.toString.call(l.process)==="[object process]"?function(U){process.nextTick(function(){T(U)})}:(function(){if(l.postMessage&&!l.importScripts){var U=!0,F=l.onmessage;return l.onmessage=function(){U=!1},l.postMessage("","*"),l.onmessage=F,U}})()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",A,!1):l.attachEvent("onmessage",A),function(U){l.postMessage(g+U,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(U){T(U.data)},function(U){p.port2.postMessage(U)}):x&&"onreadystatechange"in x.createElement("script")?(f=x.documentElement,function(U){var F=x.createElement("script");F.onreadystatechange=function(){T(U),F.onreadystatechange=null,f.removeChild(F),F=null},f.appendChild(F)}):function(U){setTimeout(T,0,U)},E.setImmediate=function(U){typeof U!="function"&&(U=new Function(""+U));for(var F=new Array(arguments.length-1),H=0;H<F.length;H++)F[H]=arguments[H+1];var O={callback:U,args:F};return b[_]=O,h(_),_++},E.clearImmediate=C}function C(U){delete b[U]}function T(U){if(S)setTimeout(T,0,U);else{var F=b[U];if(F){S=!0;try{(function(H){var O=H.callback,D=H.args;switch(D.length){case 0:O();break;case 1:O(D[0]);break;case 2:O(D[0],D[1]);break;case 3:O(D[0],D[1],D[2]);break;default:O.apply(u,D)}})(F)}finally{C(U),S=!1}}}}function A(U){U.source===l&&typeof U.data=="string"&&U.data.indexOf(g)===0&&T(+U.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof zh<"u"?zh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Kg)),Kg.exports}var SP=wP();const Cm=W5(SP);function EP({currentUser:t,budgetId:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(null),[l,u]=k.useState(null);async function h(){if(!t){u("Must be logged in to download budget");return}if(!e){u("No budget selected");return}r(!0),u(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:f,data:p}=await At("budgets",e,`downloading budget ${e}`);if(!f||!p){u(`Budget ${e} not found`);return}const g=await zT(e,"download-budget");let _=null;try{const{exists:j,data:M}=await At("payees",e,`downloading payees for budget ${e}`);j&&M&&(_=M)}catch(j){console.warn(`Could not read payees for budget ${e}:`,j)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const b=new Cm,S=new Date,x=S.toISOString().split("T")[0],E=`budget_${e}`,{accounts:C,account_groups:T,categories:A,category_groups:U,...F}=p;b.file(`${E}/budget.json`,JSON.stringify(F,null,2)),b.file(`${E}/accounts.json`,JSON.stringify(C||{},null,2)),b.file(`${E}/account_groups.json`,JSON.stringify(T||{},null,2)),b.file(`${E}/categories.json`,JSON.stringify(A||{},null,2)),b.file(`${E}/category_groups.json`,JSON.stringify(U||[],null,2)),_&&b.file(`${E}/payees.json`,JSON.stringify(_,null,2));let H=0;for(const j of g){const M=j.data,R=`${E}/months/month_${M.year}_${String(M.month).padStart(2,"0")}`,K={};if(M.are_allocations_finalized&&M.category_balances)for(const Q of M.category_balances)Q.allocated!==void 0&&(K[Q.category_id]=Q.allocated);b.file(`${R}/metadata.json`,JSON.stringify({budget_id:M.budget_id,year_month_ordinal:M.year_month_ordinal,year:M.year,month:M.month,total_income:M.total_income,previous_month_income:M.previous_month_income,total_expenses:M.total_expenses,are_allocations_finalized:M.are_allocations_finalized,created_at:M.created_at,updated_at:M.updated_at,...M.are_allocations_finalized&&{allocations:K},downloaded_at:S.toISOString()},null,2)),b.file(`${R}/income.json`,JSON.stringify(M.income||[],null,2)),b.file(`${R}/expenses.json`,JSON.stringify(M.expenses||[],null,2)),b.file(`${R}/transfers.json`,JSON.stringify(M.transfers||[],null,2)),b.file(`${R}/adjustments.json`,JSON.stringify(M.adjustments||[],null,2)),b.file(`${R}/account_balances.json`,JSON.stringify(M.account_balances||[],null,2)),b.file(`${R}/category_balances.json`,JSON.stringify(M.category_balances||[],null,2)),H++,o({phase:"processing",current:H,total:g.length,percentComplete:20+Math.round(H/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const O=await b.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const P=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),L=URL.createObjectURL(O),q=document.createElement("a");q.href=L,q.download=`${x}_${P}_${e}.zip`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(L)}catch(f){u(f instanceof Error?f.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:i,error:l,downloadBudget:h}}async function CP(t){const n=await new Cm().loadAsync(t),r=new Set,i=new Set;for(const[o]of Object.entries(n.files)){const l=o.match(/^budget_([^/]+)\//);if(l){const u=l[1];r.add(u),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&i.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:i.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function TP(t,e,n){const i=`${`${e}/months/`}${n}/`,o=`${i}metadata.json`,l=t.files[o];if(!l)return null;const u=await l.async("string"),h=JSON.parse(u),{downloaded_at:f,allocations:p,...g}=h,_=async E=>{const C=`${i}${E}`,T=t.files[C];if(T){const A=await T.async("string");return JSON.parse(A)}return[]},b={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await _("income.json"),expenses:await _("expenses.json"),transfers:await _("transfers.json"),adjustments:await _("adjustments.json"),account_balances:[],category_balances:[]},S=Aa(b);let x=bm(S);if(h.are_allocations_finalized&&p!==void 0){const E=new Map;for(const A of x.category_balances)E.set(A.category_id,A);const C=[],T=new Set;for(const A of x.category_balances){const U=p[A.category_id];if(U!==void 0){const F=Me(U);C.push({...A,allocated:F,end_balance:Me(A.start_balance+F+A.spent+A.transfers+A.adjustments)})}else C.push(A);T.add(A.category_id)}for(const[A,U]of Object.entries(p))if(!T.has(A)){const F=Me(U);C.push({category_id:A,start_balance:0,allocated:F,spent:0,transfers:0,adjustments:0,end_balance:F})}x={...x,category_balances:C}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:x}}async function AP(t,e){const n=`budget_${e}`,r=async H=>{const O=t.files[H];if(O){const D=await O.async("string");return JSON.parse(D)}return null},i=`${n}/budget.json`,o=`${n}/accounts.json`,l=`${n}/account_groups.json`,u=`${n}/categories.json`,h=`${n}/category_groups.json`,f=await r(i);if(!f)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(l)||{},_=await r(u)||{},b=await r(h)||[],S=Aa({...f,accounts:p,account_groups:g,categories:_,category_groups:b}),x={budgetId:e,data:S},E=`${n}/payees.json`,C=await r(E);let T=null;if(C){const H={...C,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:Aa(H)}}const A=`${n}/months/`,U=new Set;for(const H of Object.keys(t.files))if(H.startsWith(A)&&H.includes("/metadata.json")){const O=H.split("/months/")[1].split("/")[0];U.add(O)}const F=[];for(const H of U){const O=await TP(t,n,H);O&&F.push(O)}return{budgetUpdate:x,monthUpdates:F,payeeWrite:T}}function jP({currentUser:t}){const[e,n]=k.useState(!1),[r,i]=k.useState(!1),[o,l]=k.useState(null),[u,h]=k.useState(null),[f,p]=k.useState(null),[g,_]=k.useState(null);async function b(x){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),l(null),_(null);try{const E=await CP(x);l(E)}catch(E){p(E instanceof Error?E.message:"Failed to parse zip file")}finally{n(!1)}}async function S(x){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}i(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const E=[];let C=0,T=0,A=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const F=await new Cm().loadAsync(x);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const H=[],O=[],D=[];for(let P=0;P<o.budgetsToRestore.length;P++){const L=o.budgetsToRestore[P];try{const{budgetUpdate:q,monthUpdates:j,payeeWrite:M}=await AP(F,L);H.push(q),O.push(...j),M&&D.push(M),h({phase:"uploading",current:P+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((P+1)/o.budgetsToRestore.length*50)})}catch(q){E.push(`Budget ${L}: ${q instanceof Error?q.message:String(q)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),H.length>0)try{console.log(`[Upload] Writing ${H.length} budget(s)...`),await BT(H,"upload-budget"),C=H.length,console.log(`[Upload] Successfully wrote ${C} budget(s)`)}catch(P){const L=`Failed to write budgets: ${P instanceof Error?P.message:String(P)}`;throw console.error(`[Upload] ${L}`,P),E.push(L),P}if(D.length>0)try{console.log(`[Upload] Writing ${D.length} payee doc(s)...`),await pm(D,"upload-budget: writing payees"),A=D.length,console.log(`[Upload] Successfully wrote ${A} payee doc(s)`)}catch(P){const L=`Failed to write payees: ${P instanceof Error?P.message:String(P)}`;throw console.error(`[Upload] ${L}`,P),E.push(L),P}if(O.length>0)try{console.log(`[Upload] Writing ${O.length} month(s) and recalculating...`),await M3(O,"upload-budget"),T=O.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(P){const L=`Failed to write months: ${P instanceof Error?P.message:String(P)}`;throw console.error(`[Upload] ${L}`,P),E.push(L),P}h({phase:"complete",current:1,total:1,percentComplete:100}),_({success:E.length===0,budgetsRestored:C,monthsRestored:T,payeesRestored:A,errors:E}),console.log("[Upload] Clearing all caches after upload..."),Ra()}catch(U){const F=U instanceof Error?U.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",U),console.error("[Upload] Error details:",{errorMessage:F,budgetsRestored:C,monthsRestored:T,payeesRestored:A,errorsSoFar:E}),p(F),_({success:!1,budgetsRestored:C,monthsRestored:T,payeesRestored:A,errors:[...E,F]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),Ra()}finally{i(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:u,error:f,result:g,scanZipFile:b,uploadBudget:S}}function G1({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:i,editName:o,isRenaming:l,onAccept:u,onSwitch:h,onStartEdit:f,onCancelEdit:p,onEditNameChange:g,onSaveEdit:_}){const b=e&&t.isOwner;return d.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:i?d.jsxs("form",{onSubmit:_,children:[d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:d.jsx("input",{type:"text",value:o,onChange:S=>g(S.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[d.jsx("button",{type:"submit",disabled:l||!o.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:l||!o.trim()?.7:1,fontSize:"0.8rem"},children:l?"Saving...":"Save"}),d.jsx("button",{type:"button",onClick:p,disabled:l,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontWeight:500,opacity:l?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[d.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[d.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&d.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&d.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&d.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),b&&d.jsx("button",{onClick:f,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),d.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?d.jsx("button",{onClick:u,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:d.jsx("button",{onClick:h,disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}const ce={primary:"#646cff",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},is={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},Of="1px solid color-mix(in srgb, currentColor 20%, transparent)",Mf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},fd={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},RP={...fd,padding:"0.6rem 0.875rem",gap:"0.5rem"},IP={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},DP={display:"flex",flexDirection:"column",gap:"0.5rem"},kP={fontSize:"0.9rem",fontWeight:500},Na={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},OP={...Na,cursor:"pointer"},X0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},$T={...X0,background:ce.primary,color:"white",border:"none"},MP={...$T,padding:"0.75rem 1.5rem",borderRadius:"8px"},NP={...X0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},PP={...X0,background:"transparent",border:`1px solid ${ce.errorBorder}`,color:ce.error},zP={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s"},BP={display:"flex",gap:"0.5rem"},LP={display:"flex",gap:"0.25rem"},qT={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.9rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"2rem",minHeight:"2rem",transition:"opacity 0.15s, border-color 0.15s"},UP={...qT,borderColor:ce.errorBorder,color:ce.error},Zl={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},Z0={display:"flex",flexDirection:"column",gap:"2px"},FP={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},GT={opacity:.4,cursor:"grab"},HT={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",transition:"opacity 0.15s"},VP={position:"relative",height:"2rem",marginTop:"-0.25rem"},$P={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",transition:"opacity 0.15s"},qP={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},GP={background:ce.errorBg,border:`1px solid ${ce.errorBorder}`,color:ce.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},HP={background:"transparent",border:"none",color:ce.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},QT={opacity:.7,marginBottom:"1.5rem"},Tm={margin:0,fontSize:"0.85rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6},J0={fontWeight:500,fontSize:"1.1rem"},Jl={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"},By={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function WT({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in By?n:"bug",i=By[r];return d.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:i.bgColor,color:i.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:i.label})}function QP({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:u,onToggleDone:h,onTypeClick:f}){return d.jsxs("div",{onDragOver:p=>{p.stopPropagation(),i(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),u(p)},style:{position:"relative"},children:[d.jsx("div",{style:{...HT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),d.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:l,style:{...fd,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[d.jsx("span",{style:{...GT},children:""}),d.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ce.primary,flexShrink:0}}),d.jsx(WT,{type:t.feedback_type,onClick:f})]}),d.jsxs("div",{style:{marginLeft:"3.25rem"},children:[d.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),d.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",Py(t.created_at)]})]})]})]})}function WP({item:t,onToggleDone:e,onTypeClick:n}){return d.jsxs("div",{style:{...fd,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[d.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ce.primary,flexShrink:0}}),d.jsx(WT,{type:t.feedback_type,onClick:n})]}),d.jsxs("div",{style:{marginLeft:"2rem"},children:[d.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),d.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",Py(t.created_at)]}),t.completed_at&&d.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:ce.success},children:[" Completed: ",Py(t.completed_at)]})]})]})}function Fn({noMargin:t}={}){return d.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function KT(){const{state:t,closeModal:e}=PT();if(!t.isOpen)return null;const n=t.isComplete;return d.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:d.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:r=>r.stopPropagation(),children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[d.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&d.jsx(Fn,{noMargin:!0}),t.migrationName]}),n&&d.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),d.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"#ef4444":t.isComplete?"#22c55e":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),d.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?d.jsx("div",{style:{background:t.error?"#ef4444":t.isComplete?"#22c55e":"#646cff",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):d.jsx("div",{style:{background:t.error?"#ef4444":"#646cff",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&d.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&d.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&d.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"#ef4444"},children:t.error}),t.isComplete&&d.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"rgba(239, 68, 68, 0.2)":"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&d.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),d.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function Bo({message:t,children:e,onDismiss:n,style:r}){return d.jsxs("div",{style:{...GP,...r},children:[d.jsx("span",{children:e??t}),n&&d.jsx("button",{onClick:n,style:HP,children:""})]})}const KP={primary:$T,"primary-large":MP,secondary:NP,danger:PP,small:zP},YP={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:ce.warning,color:"#1a1a1a",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",animation:"tooltipFadeIn 0.15s ease-out"},XP={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${ce.warning}`};function $e({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:i,style:o,actionName:l,disabledReason:u,onClick:h,...f}){const p=KP[t],g=i||e,[_,b]=k.useState(!1);function S(C){h?.(C)}function x(C){g&&u&&(C.preventDefault(),C.stopPropagation(),b(!0),setTimeout(()=>b(!1),3e3))}const E=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return d.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:x,children:[_&&u&&d.jsxs("div",{style:YP,children:[u,d.jsx("div",{style:XP})]}),d.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...E,...o},onClick:S,...f,children:e?n:r})]})}function YT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const u=r.indexOf(n);return{match:!0,score:u===0||/\s/.test(r[u-1])?100:90}}let i=0,o=0,l=0;for(let u=0;u<r.length&&i<n.length;u++)r[u]===n[i]?(i++,l++,o+=l*2):l=0;return i===n.length?{match:!0,score:o}:{match:!1,score:0}}function XT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function ZT(t){const e=XT(t),n=[];let r="__initial__";return e.forEach(i=>{i.groupId!==r&&(r=i.groupId,n.push({groupId:i.groupId,groupName:i.groupName,groupSortOrder:i.groupSortOrder,items:[]})),n[n.length-1].items.push(i)}),n}function JT(t,e,n){return e.trim()?t.map(i=>{const o=n(i);let l=0,u=!1;for(const h of o){const f=YT(e,h);f.match&&(u=!0,l=Math.max(l,f.score))}return{item:i,score:l,hasMatch:u}}).filter(({hasMatch:i})=>i).sort((i,o)=>o.score!==i.score?o.score-i.score:!i.item.groupId&&o.item.groupId?1:i.item.groupId&&!o.item.groupId?-1:i.item.groupSortOrder!==o.item.groupSortOrder?i.item.groupSortOrder-o.item.groupSortOrder:i.item.sortOrder-o.item.sortOrder).map(({item:i})=>i):XT(t)}const e_={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},$u={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function H1({id:t,value:e,onChange:n,payees:r,placeholder:i="Enter payee name",autoFocus:o}){const[l,u]=k.useState(!1),[h,f]=k.useState(-1),p=k.useRef(null),g=k.useRef(null),_=e.trim()?r.map(x=>({payee:x,...YT(e,x)})).filter(x=>x.match).sort((x,E)=>E.score-x.score).slice(0,8).map(x=>x.payee):[];k.useEffect(()=>{function x(E){p.current&&!p.current.contains(E.target)&&u(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function b(x){!l||_.length===0||(x.key==="ArrowDown"?(x.preventDefault(),f(E=>Math.min(E+1,_.length-1))):x.key==="ArrowUp"?(x.preventDefault(),f(E=>Math.max(E-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(_[h]),u(!1),f(-1)):x.key==="Escape"&&(u(!1),f(-1)))}function S(x){n(x),u(!1),f(-1),g.current?.focus()}return d.jsxs("div",{ref:p,style:{position:"relative"},children:[d.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),u(!0),f(-1)},onFocus:()=>u(!0),onKeyDown:b,placeholder:i,autoComplete:"off",autoFocus:o,style:Na}),l&&_.length>0&&d.jsx("div",{style:{...e_,maxHeight:"200px",overflowY:"auto"},children:_.map((x,E)=>d.jsx("div",{onClick:()=>S(x),style:{...$u,background:E===h?`color-mix(in srgb, ${ce.primary} 20%, transparent)`:"transparent",borderBottom:E<_.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>f(E),children:x},x))})]})}function eA({id:t,value:e,onChange:n,categories:r,categoryGroups:i,placeholder:o="Search categories...",required:l,showNoCategoryOption:u=!1,showHiddenCategories:h=!1}){const f=Object.fromEntries(i.map(G=>[G.id,G.name])),p=Object.fromEntries(i.map(G=>[G.id,G.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,G])=>!G.is_hidden)),_=Object.entries(g).map(([G,X])=>({id:G,name:X.name,groupId:X.category_group_id,groupName:X.category_group_id&&f[X.category_group_id]||null,sortOrder:X.sort_order,groupSortOrder:X.category_group_id?p[X.category_group_id]??999:999})),b=e===Kt,S=b?null:e?r[e]:null,x=b?"":S?.name||"",[E,C]=k.useState(x),[T,A]=k.useState(!1),[U,F]=k.useState(-1),H=k.useRef(null),O=k.useRef(null);k.useEffect(()=>{if(e===Kt)C("");else if(e){const G=r[e];C(G?.name||"")}},[e,r]);const D=JT(_,E,G=>[G.name]),P=ZT(D);k.useEffect(()=>{function G(X){if(H.current&&!H.current.contains(X.target))if(A(!1),e===Kt)C("");else{const J=e?r[e]:null;C(J?.name||"")}}return document.addEventListener("mousedown",G),()=>document.removeEventListener("mousedown",G)},[e,r]);function L(G){if(G.key==="ArrowDown")G.preventDefault(),T?F(X=>Math.min(X+1,D.length-1)):(A(!0),F(0));else if(G.key==="ArrowUp")G.preventDefault(),F(X=>Math.max(X-1,0));else if(G.key==="Enter")G.preventDefault(),T&&U>=0&&D[U]&&q(D[U]);else if(G.key==="Escape")if(A(!1),F(-1),e===Kt)C("");else{const X=e?r[e]:null;C(X?.name||"")}else if(G.key==="Tab")if(T&&U>=0&&D[U])q(D[U]);else if(A(!1),F(-1),e===Kt)C("");else{const X=e?r[e]:null;C(X?.name||"")}}function q(G){n(G.id),C(G.id===Kt?"":G.name),A(!1),F(-1)}function j(){n(Kt),C(""),A(!1),F(-1)}function M(G){const X=G.target.value;C(X),A(!0),F(X.trim()?0:-1),X!==x&&(u&&X.trim()===""?n(Kt):n(""))}function R(){A(!0),u&&(e===Kt||E.trim()==="")?F(-1):D.length>0&&F(0)}let K=-1;const Q=()=>++K;return d.jsxs("div",{ref:H,style:{position:"relative"},children:[d.jsx("input",{ref:O,id:t,type:"text",value:E,onChange:M,onFocus:R,onKeyDown:L,placeholder:o,autoComplete:"off",required:l&&!u,style:{...Na,borderColor:l&&!e?ce.error:void 0}}),T&&d.jsxs("div",{style:{...e_,maxHeight:"250px",overflowY:"auto"},children:[u&&d.jsx("div",{onClick:j,onMouseEnter:()=>F(-1),style:{...$u,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:U===-1?`color-mix(in srgb, ${ce.primary} 20%, transparent)`:"transparent"},children:jo}),P.map((G,X)=>d.jsxs("div",{children:[G.groupName&&d.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:G.groupName}),G.items.map(J=>{const re=Q();return d.jsx("div",{onClick:()=>q(J),style:{...$u,paddingLeft:G.groupName?"1.2rem":"0.8rem",background:re===U?`color-mix(in srgb, ${ce.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>F(re),children:J.name},J.id)})]},`group-${X}`)),D.length===0&&E.trim()&&!u&&d.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function tA({id:t,value:e,onChange:n,accounts:r,accountGroups:i,placeholder:o="Search accounts...",required:l,showNoAccountOption:u=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,K])=>!K.is_hidden)).map(([K,Q])=>({id:K,name:Q.nickname,groupId:Q.account_group_id,groupName:Q.account_group_id&&i[Q.account_group_id]?.name||null,sortOrder:Q.sort_order,groupSortOrder:Q.account_group_id?i[Q.account_group_id]?.sort_order??999:999})),g=e===$t,_=g?null:r.find(([K])=>K===e)?.[1],b=g?"":_?.nickname||"",[S,x]=k.useState(b),[E,C]=k.useState(!1),[T,A]=k.useState(-1),U=k.useRef(null),F=k.useRef(null);k.useEffect(()=>{if(e===$t)x("");else if(e){const K=r.find(([Q])=>Q===e)?.[1];x(K?.nickname||"")}},[e,r]);const H=JT(p,S,K=>[K.name]),O=ZT(H);k.useEffect(()=>{function K(Q){if(U.current&&!U.current.contains(Q.target))if(C(!1),e===$t)x("");else{const G=r.find(([X])=>X===e)?.[1];x(G?.nickname||"")}}return document.addEventListener("mousedown",K),()=>document.removeEventListener("mousedown",K)},[e,r]);function D(K){if(K.key==="ArrowDown")K.preventDefault(),E?A(Q=>Math.min(Q+1,H.length-1)):(C(!0),A(0));else if(K.key==="ArrowUp")K.preventDefault(),A(Q=>Math.max(Q-1,0));else if(K.key==="Enter")K.preventDefault(),E&&T>=0&&H[T]&&P(H[T]);else if(K.key==="Escape")if(C(!1),A(-1),e===$t)x("");else{const Q=r.find(([G])=>G===e)?.[1];x(Q?.nickname||"")}else if(K.key==="Tab")if(E&&T>=0&&H[T])P(H[T]);else if(C(!1),A(-1),e===$t)x("");else{const Q=r.find(([G])=>G===e)?.[1];x(Q?.nickname||"")}}function P(K){n(K.id),x(K.id===$t?"":K.name),C(!1),A(-1)}function L(){n($t),x(""),C(!1),A(-1)}function q(K){const Q=K.target.value;x(Q),C(!0),A(Q.trim()?0:-1),Q!==b&&(u&&Q.trim()===""?n($t):n(""))}function j(){C(!0),u&&(e===$t||S.trim()==="")?A(-1):H.length>0&&A(0)}let M=-1;const R=()=>++M;return d.jsxs("div",{ref:U,style:{position:"relative"},children:[d.jsx("input",{ref:F,id:t,type:"text",value:S,onChange:q,onFocus:j,onKeyDown:D,placeholder:o,autoComplete:"off",required:l&&!u,style:{...Na,borderColor:l&&!e?ce.error:void 0}}),E&&d.jsxs("div",{style:{...e_,maxHeight:"250px",overflowY:"auto"},children:[u&&d.jsx("div",{onClick:L,onMouseEnter:()=>A(-1),style:{...$u,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${ce.primary} 20%, transparent)`:"transparent"},children:ja}),O.map((K,Q)=>d.jsxs("div",{children:[K.groupName&&d.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:K.groupName}),K.items.map(G=>{const X=R();return d.jsx("div",{onClick:()=>P(G),style:{...$u,paddingLeft:K.groupName?"1.2rem":"0.8rem",background:X===T?`color-mix(in srgb, ${ce.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>A(X),children:G.name},G.id)})]},`group-${Q}`)),H.length===0&&S.trim()&&!u&&d.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function xi({children:t,onSubmit:e,actionName:n}){function r(i){e(i)}return d.jsx("form",{onSubmit:r,style:IP,children:t})}function Pt({label:t,htmlFor:e,children:n,hint:r,style:i}){return d.jsxs("div",{style:{...DP,...i},children:[d.jsx("label",{htmlFor:e,style:kP,children:t}),n,r&&d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function wi(t){return d.jsx("input",{style:Na,...t})}function ZP(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function Nf({value:t,onChange:e,style:n,autoFocus:r,...i}){const o=k.useRef(null),l=k.useRef(null),u=ZP(t);k.useEffect(()=>{r&&l.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function f(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return d.jsxs("div",{style:{position:"relative"},children:[d.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...i}),d.jsx("div",{ref:l,tabIndex:0,onClick:h,onKeyDown:f,style:{...Na,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:u||"Select date"})]})}function qu({children:t,...e}){return d.jsx("select",{style:OP,...e,children:t})}function t_({minHeight:t="6rem",style:e,...n}){return d.jsx("textarea",{style:{...Na,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function Pa({children:t}){return d.jsx("div",{style:FP,children:t})}function Yg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",i=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return i!==void 0?`$${o}.${i.slice(0,2)}`:o?`$${o}`:""}function JP(t){return t.replace(/[$,]/g,"")}function bo({id:t,value:e,onChange:n,placeholder:r="$0.00",required:i,autoFocus:o,style:l}){const[u,h]=k.useState(()=>Yg(e)),f=k.useRef(null);k.useEffect(()=>{const g=Yg(e);JP(u)!==e&&h(g)},[e]);function p(g){const _=g.target.value;if(!_||_==="$"){h(""),n("");return}const S=_.replace(/[^\d.]/g,"").split(".");let x=S[0];S.length>1&&(x+="."+S.slice(1).join("").slice(0,2));const E=Yg(x);h(E),n(x)}return d.jsx("input",{ref:f,id:t,type:"text",inputMode:"decimal",value:u,onChange:p,placeholder:r,required:i,autoFocus:o,style:{...Na,...l}})}function Am({children:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:u,onEdit:h,onDelete:f,onMoveUp:p,onMoveDown:g,canMoveUp:_=!0,canMoveDown:b=!0,itemName:S}){const x=qs(),E=p||g;return d.jsxs("div",{onDragOver:C=>{C.stopPropagation(),i(C)},onDragLeave:C=>{C.stopPropagation(),o()},onDrop:C=>{C.stopPropagation(),u(C)},style:{position:"relative"},children:[d.jsx("div",{style:{...HT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),d.jsxs("div",{style:{...x?RP:fd,opacity:e?.5:1},children:[d.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:x?"0.5rem":"0.75rem",minWidth:0},children:[d.jsx("span",{draggable:!0,onDragStart:C=>{r(C)},onDragEnd:()=>{l()},style:{...GT,fontSize:x?"0.9rem":void 0,cursor:"grab",padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder",children:""}),d.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis"},children:t})]}),d.jsxs("div",{style:x?LP:BP,children:[x?d.jsxs(d.Fragment,{children:[d.jsx("button",{onClick:()=>{h()},style:qT,title:"Edit","aria-label":"Edit",children:""}),d.jsx("button",{onClick:()=>{f()},style:UP,title:"Delete","aria-label":"Delete",children:""})]}):d.jsxs(d.Fragment,{children:[d.jsx($e,{variant:"secondary",actionName:`Edit ${S||"Item"}`,onClick:h,children:"Edit"}),d.jsx($e,{variant:"danger",actionName:`Delete ${S||"Item"}`,onClick:f,children:"Delete"})]}),E&&d.jsxs("div",{style:Z0,children:[d.jsx("button",{onClick:C=>{C.stopPropagation(),p?.()},disabled:!_,style:{...Zl,opacity:_?.6:.2,cursor:_?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),d.jsx("button",{onClick:C=>{C.stopPropagation(),g?.()},disabled:!b,style:{...Zl,opacity:b?.6:.2,cursor:b?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})]})}function n_({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:i="Move to end"}){return d.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:VP,children:[d.jsx("div",{style:{...$P,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&d.jsx("span",{style:qP,children:i})]})}function Je(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function as(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function za(t){return t===0?"$0.00":`${t>0?"+":"-"}${Je(t)}`}function Gt(t){return`${t>=0?"+":"-"}${Je(t)}`}function Bt(t){return t===0?ce.zero:t>0?ce.success:ce.danger}function Vn(t){return t===0?ce.zero:t>0?ce.success:ce.debt}function pc(t){return t===0?ce.zero:t<0?ce.error:ce.success}function gc(t){return t===0?ce.zero:t>0?ce.success:ce.error}async function ez(t,e){const{exists:n,data:r}=await At("feedback",t,`VALIDATION-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function nA(t){const{docId:e,items:n,description:r}=t;await qn("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function tz(t,e,n,r){const{exists:i}=await At("feedback",t,"checking if user has existing feedback document");i?await qn("feedback",t,{items:Uu(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await qn("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}function rA(){const t=Ht(),e=Gn({onMutate:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:u,currentPath:h}=r,f=o||i,p=ke.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),_=`feedback_optimistic_${Date.now()}`,b={id:_,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:u,doc_id:f,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,b]}),{previousData:g,optimisticId:_}},mutationFn:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:u,currentPath:h}=r,f=o||i,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:u};return await tz(f,p,o,"submitting new feedback"),{feedbackItem:p,docId:f}},onSuccess:(r,i,o)=>{if(!o?.optimisticId)return;const l=t.getQueryData(ke.feedback());l&&t.setQueryData(ke.feedback(),{items:l.items.map(u=>u.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:i.userEmail}:u)})},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function nz(){const t=Ht(),e=Gn({onMutate:async r=>{const{item:i}=r,o=ke.feedback(),l=!i.is_done,u=l?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(f=>f.id===i.id?{...f,is_done:l,completed_at:u}:f)}),{previousData:h}},mutationFn:async r=>{const{item:i}=r,o=!i.is_done,l=o?new Date().toISOString():null,u=await ez(i.doc_id,"toggle feedback");let h=!1;const f=u.items.map(p=>p.id===i.id?(h=!0,{...p,is_done:o,completed_at:l}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:i.id,inDocument:i.doc_id,availableIds:u.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${i.id}, Doc ID: ${i.doc_id}`);return await nA({docId:i.doc_id,items:f,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:i.id,isDone:o,completedAt:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function rz(){const t=Ht(),e=Gn({onMutate:async r=>{const{docId:i,items:o}=r,l=ke.feedback();await t.cancelQueries({queryKey:l});const u=t.getQueryData(l),h=new Map;return o.forEach(f=>{h.set(f.id,f.sort_order)}),u&&t.setQueryData(l,{items:u.items.map(f=>f.doc_id===i&&h.has(f.id)?{...f,sort_order:h.get(f.id)}:f)}),{previousData:u}},mutationFn:async r=>{const{docId:i,items:o}=r;return await nA({docId:i,items:o,description:"saving reordered feedback items"}),{docId:i,items:o}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function $s({isOpen:t,onClose:e,title:n,children:r,width:i="28rem"}){if(!t)return null;function o(){e()}return d.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:d.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:i,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:l=>l.stopPropagation(),children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[d.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),d.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const sz=2e3,iz={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function az(){const[t,e]=k.useState(!1),[n,r]=k.useState(""),[i,o]=k.useState("bug"),[l,u]=k.useState(!1),h=k.useContext(ud),p=Da().get_current_firebase_user(),g=On(),{submitFeedback:_}=rA();if(k.useEffect(()=>{if(l){const x=setTimeout(()=>u(!1),sz);return()=>clearTimeout(x)}},[l]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function S(x){x.preventDefault(),!(!n.trim()||!h.username||!p)&&(_.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:i,currentPath:g.pathname}),r(""),o("bug"),e(!1),u(!0))}return d.jsxs(d.Fragment,{children:[l&&d.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[d.jsx("span",{children:""}),d.jsx("span",{children:"Feedback submitted!"})]}),d.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:ce.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:x=>{x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),d.jsx($s,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:d.jsxs("form",{onSubmit:S,children:[d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(x=>{const E=iz[x],C=i===x;return d.jsxs("button",{type:"button",onClick:()=>{E.label,o(x)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${E.color}`,borderRadius:"0.5rem",background:C?E.bgColor:"transparent",color:C?E.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:C?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:C?1:.5,boxShadow:C?`0 0 12px ${E.bgColor}`:"none",position:"relative"},children:[E.label,C&&d.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},x)})}),d.jsx(t_,{value:n,onChange:x=>r(x.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),d.jsxs(Pa,{children:[d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),d.jsx($e,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function Vr({children:t,labelStyle:e,...n}){return d.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[d.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:ce.primary},...n}),t]})}function r_({title:t,count:e,children:n,defaultExpanded:r=!1}){const[i,o]=k.useState(r);return d.jsxs("div",{style:{marginTop:"2rem"},children:[d.jsxs("button",{onClick:()=>o(!i),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[d.jsx("span",{style:{transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),i&&n]})}const oz=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},lz=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Pf(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,i=e.filter(E=>!E.hidden),o=i.length,l=oz(o),u=lz(o),h=Math.floor(100/u),f=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",_=r==="segmented",b=E=>{const C="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return _?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:E?C:T,cursor:"pointer",fontWeight:E?600:400,fontSize:"0.95rem",color:"inherit",opacity:E?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:E?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:E?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:E?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:E?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:E?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},S=(E,C)=>d.jsxs(d.Fragment,{children:[d.jsx("span",{children:E.label}),E.checkmark&&d.jsx("span",{style:{color:ce.success,fontWeight:600},children:""}),p&&C&&d.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),x=()=>_?`
        .${f} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${f} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${f} > button,
        .${f} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${f} > button:last-child,
        .${f} > a:last-child {
          margin-right: 0;
        }
        .${f} > button::before,
        .${f} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 #242424, 1px 0 0 #242424;
        }
        .${f} > button:nth-child(1),
        .${f} > a:nth-child(1) {
          z-index: 4;
        }
        .${f} > button:nth-child(2),
        .${f} > a:nth-child(2) {
          z-index: 3;
        }
        .${f} > button:nth-child(3),
        .${f} > a:nth-child(3) {
          z-index: 2;
        }
        .${f} > button:nth-child(4),
        .${f} > a:nth-child(4) {
          z-index: 1;
        }
        .${f} > button.tab-active,
        .${f} > a.tab-active {
          z-index: 10;
        }
        .${f} > button.tab-active::before,
        .${f} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${f} > button:not(.tab-active):hover,
        .${f} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${f} > button:not(.tab-active):hover::before,
        .${f} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${f} {
            padding-left: 0;
            padding-right: 0;
          }
          .${f} > button,
          .${f} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${f} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${l}px) {
        .${f} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return d.jsxs(d.Fragment,{children:[d.jsx("style",{children:`
        ${x()}
        .${f} > button,
        .${f} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${f} > button:hover,
        .${f} > button:focus,
        .${f} > a:hover,
        .${f} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${_?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),d.jsx("div",{className:f,children:i.map(E=>{const C=n===E.id;return t.mode==="link"?d.jsx(Cn,{to:`${t.linkPrefix}/${E.id}`,onClick:()=>(`${E.label}`,void 0),style:b(C),className:C?"tab-active":"",children:S(E,C)},E.id):d.jsx("button",{onClick:()=>{`${E.label}`,t.onTabChange(E.id)},style:b(C),className:C?"tab-active":"",children:S(E,C)},E.id)})})]})}function sA({items:t}){const[e,n]=k.useState(!1),r=k.useRef(null),o=On().pathname;k.useEffect(()=>{function u(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[e]),k.useEffect(()=>{function u(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[e]);const l=t.filter(u=>u.hidden?!1:u.to?u.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):u.to==="/account"||u.to==="/"?o!==u.to:!o.startsWith(u.to):!0);return d.jsxs("div",{ref:r,style:{position:"relative"},children:[d.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&d.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:l.map((u,h)=>{if(u.divider)return d.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const f=d.jsxs(d.Fragment,{children:[u.icon&&d.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:u.icon}),d.jsx("span",{children:u.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return u.to?d.jsx(Cn,{to:u.to,style:p,onMouseEnter:_=>Object.assign(_.currentTarget.style,g),onMouseLeave:_=>_.currentTarget.style.background="transparent",onClick:()=>{`${u.label}`,n(!1)},children:f},h):d.jsx("button",{onClick:()=>{`${u.label}`,u.onClick?.(),n(!1)},style:p,onMouseEnter:_=>Object.assign(_.currentTarget.style,g),onMouseLeave:_=>_.currentTarget.style.background="transparent",children:f},h)})})]})}function cz({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Ze(),i=On(),l=[...i.pathname==="/budget"||i.pathname.startsWith("/budget/")&&!i.pathname.startsWith("/budget/settings")&&!i.pathname.startsWith("/budget/admin")&&!i.pathname.startsWith("/budget/analytics")&&!i.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return d.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[d.jsx("div",{style:{flex:"0 0 auto"},children:e?d.jsx(Cn,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):d.jsx(Cn,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:d.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),d.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),d.jsx("div",{style:{flex:"0 0 auto"},children:n?d.jsx("div",{style:{width:"1.5rem"}}):d.jsx(sA,{items:l})})]})}function iA({children:t,style:e}){return d.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function Gu({message:t,linkText:e,linkTo:n}){return d.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${ce.warning} 12%, transparent)`,border:`2px solid ${ce.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[d.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),d.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[d.jsx("p",{style:{margin:0,fontWeight:500,color:ce.warning,fontSize:"0.95rem"},children:t}),d.jsxs(Cn,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:ce.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}function ha({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:i=!1,onDownloadBackup:o,isDownloading:l=!1}){const[u,h]=k.useState(!1),f=k.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=k.useCallback(()=>{n(u?"downloaded":"already-have")},[u,n]),g=k.useCallback(()=>{n("cancelled"),e()},[n,e]);return d.jsxs($s,{isOpen:t,onClose:g,title:" Backup Recommended",children:[d.jsx("div",{style:{background:i?"color-mix(in srgb, #ef4444 15%, transparent)":"color-mix(in srgb, #f59e0b 15%, transparent)",border:`1px solid ${i?"color-mix(in srgb, #ef4444 40%, transparent)":"color-mix(in srgb, #f59e0b 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:i?"#fca5a5":"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:i?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",d.jsx("strong",{children:r})]}),d.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx($e,{variant:"secondary",onClick:f,disabled:l,actionName:"Download Backup Before Migration",style:{width:"100%"},children:l?d.jsxs(d.Fragment,{children:[d.jsx(Fn,{noMargin:!0})," Downloading Backup..."]}):u?" Backup Downloaded":" Download Backup Now"})}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),d.jsx($e,{variant:i?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:l,children:u?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function fa({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,i]=k.useState(!1),[o,l]=k.useState(!1),[u,h]=k.useState(null),f=k.useCallback(b=>{h(()=>b),i(!0)},[]),p=k.useCallback(b=>{b!=="cancelled"&&u&&u(),h(null),i(!1)},[u]),g=k.useCallback(()=>{h(null),i(!1)},[]),_=k.useCallback(async()=>{if(n){l(!0);try{await n()}finally{l(!1)}}},[n]);return{promptBeforeAction:f,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?_:void 0,isDownloading:o}}}const uz={onetime:{borderColor:"color-mix(in srgb, #a855f7 30%, transparent)",iconBg:"color-mix(in srgb, #a855f7 15%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, #3b82f6 30%, transparent)",iconBg:"color-mix(in srgb, #3b82f6 15%, transparent)"},utility:{borderColor:"color-mix(in srgb, #22c55e 30%, transparent)",iconBg:"color-mix(in srgb, #22c55e 15%, transparent)"}};function s_({title:t,icon:e,description:n,type:r,children:i,onValidateAll:o,isValidating:l=!1,isAnyRunning:u=!1}){const h=uz[r],f=l||u,p=()=>{o&&!f&&o()};return d.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[d.jsxs("div",{style:{padding:"1rem 1.25rem",borderBottom:`1px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1},children:[d.jsx("span",{style:{fontSize:"1.5rem",background:h.iconBg,padding:"0.5rem",borderRadius:"8px",lineHeight:1},children:e}),d.jsxs("div",{children:[d.jsx("h3",{style:{margin:"0 0 0.25rem 0",fontSize:"1.1rem"},children:t}),d.jsx("p",{style:{margin:0,opacity:.7,fontSize:"0.85rem"},children:n})]})]}),o&&d.jsx("button",{onClick:p,disabled:f,style:{background:"color-mix(in srgb, #3b82f6 20%, transparent)",color:"#60a5fa",border:"1px solid color-mix(in srgb, #3b82f6 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:f?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:f?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:l?d.jsxs(d.Fragment,{children:[d.jsx(Fn,{noMargin:!0})," Validating..."]}):" Validate All"})]}),d.jsx("div",{style:{padding:"0.5rem"},children:i})]})}const dz={unknown:{color:"#9ca3af",icon:"",text:"Unknown"},clean:{color:"#22c55e",icon:"",text:"Clean"},"needs-action":{color:"#f59e0b",icon:"",text:"Needs Action"},running:{color:"#60a5fa",icon:"",text:"Running"},complete:{color:"#22c55e",icon:"",text:"Complete"},error:{color:"#ef4444",icon:"",text:"Error"}};function jm({name:t,description:e,status:n,statusText:r,onCheck:i,isChecking:o,onRun:l,isRunning:u=!1,actionText:h="Run",disabled:f=!1,itemCount:p,details:g,isDestructive:_=!1}){const[b,S]=k.useState(!1),x=dz[n],E=r||x.text,C=f||u||o,T=()=>{i()},A=()=>{l&&l()},U=()=>{g&&S(!b)};return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${x.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:u||o?d.jsx(Fn,{noMargin:!0}):x.icon}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),d.jsxs("div",{style:{color:x.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[E,p!==void 0&&p>0&&d.jsx("span",{style:{background:`color-mix(in srgb, ${x.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[d.jsx("button",{onClick:T,disabled:C,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",opacity:C?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?d.jsx(Fn,{noMargin:!0}):""}),l&&n==="needs-action"&&d.jsx("button",{onClick:A,disabled:C,style:{background:_?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:C?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:u?d.jsx(Fn,{noMargin:!0}):h}),g&&d.jsx("button",{onClick:U,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:b?"Collapse details":"Expand details",children:b?"":""})]})]}),b&&g&&d.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function hz({name:t,description:e,onAction:n,actionText:r,actionIcon:i,isRunning:o=!1,disabled:l=!1,progress:u,error:h,isDestructive:f=!1}){const p=l||o,g=()=>{n()};return d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&d.jsx("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.25rem"},children:h})]}),u!==void 0&&o&&d.jsxs("div",{style:{width:"100px",flexShrink:0},children:[d.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:d.jsx("div",{style:{background:f?"#ef4444":"#646cff",height:"100%",width:`${u}%`,transition:"width 0.3s"}})}),d.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[u,"%"]})]}),d.jsx("button",{onClick:g,disabled:p,style:{background:f?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?d.jsxs(d.Fragment,{children:[d.jsx(Fn,{noMargin:!0})," Running..."]}):d.jsxs(d.Fragment,{children:[i&&d.jsx("span",{children:i}),r]})})]})})}function fz({status:t,hasData:e,needsMigration:n,totalBudgetsToUpdate:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0&&l.budgetsUpdated>0)return`Updated ${l.budgetsUpdated} budget(s)`;if(l&&l.budgetsUpdated===0)return"Complete (all budgets already have ungrouped groups)"},_=()=>l?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Migration complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&d.jsxs("li",{children:[l.budgetsProcessed," budget(s) processed"]}),l.budgetsUpdated>0&&d.jsxs("li",{children:[l.budgetsUpdated," budget(s) had ungrouped groups added"]}),l.budgetsUpdated===0&&d.jsx("li",{children:"All budgets already have ungrouped groups"})]}),l.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[d.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((b,S)=>d.jsx("li",{children:b},S)),l.errors.length>3&&d.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Budgets to update:"}),d.jsx("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:d.jsxs("li",{children:[t.budgetsNeedingUpdate," budget(s) missing ungrouped groups"]})}),d.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s)."]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All budgets have ungrouped groups.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for budgets missing ungrouped groups."});return d.jsx(jm,{name:"Ensure Ungrouped Groups",description:"Ensures all budgets have the default ungrouped groups for accounts and categories. This prevents errors when accounts or categories don't have a group assigned.",status:p(),statusText:g(),onCheck:u,isChecking:i,onRun:h,isRunning:o,actionText:`Update ${r} budget(s)`,disabled:f,itemCount:n?r:void 0,details:_(),isDestructive:!1})}function mz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,ensureUngroupedGroups:r}){const i=r.isRunning,o=fa({migrationName:"Ensure Ungrouped Groups",isDestructive:!1,onDownloadBackup:e});return d.jsxs(d.Fragment,{children:[d.jsx(s_,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:i,children:d.jsx(fz,{status:r.status,hasData:r.hasData,needsMigration:r.needsMigration,totalBudgetsToUpdate:r.totalBudgetsToUpdate,isChecking:r.isScanning,isRunning:r.isRunning,result:r.result,onCheck:r.scanStatus,onRun:()=>o.promptBeforeAction(r.runMigration),disabled:t})}),d.jsx(ha,{...o.promptProps,isDownloading:n})]})}const aA={unknown:{color:"#9ca3af",icon:""},clean:{color:"#22c55e",icon:""},"needs-action":{color:"#f59e0b",icon:""},running:{color:"#60a5fa",icon:""},complete:{color:"#22c55e",icon:""},error:{color:"#ef4444",icon:""}};function pz({check:t,disabled:e}){const n=aA[t.status],r=e||t.isRunning||t.isChecking;return d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[d.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?d.jsx(Fn,{noMargin:!0}):n.icon}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&d.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),d.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),d.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[d.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?d.jsx(Fn,{noMargin:!0}):""}),t.canFix&&t.onFix&&d.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?d.jsx(Fn,{noMargin:!0}):"Fix"})]})]})}function gz({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:i,totalIssues:o,isScanning:l,isRunning:u,disabled:h,onRunOrphaned:f,onRunExpense:p,onRunTransfers:g}){const[_,b]=k.useState(!1),x=u?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?i?"needs-action":"clean":"unknown",E=aA[x],C=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(U=>U.transactionType==="income").length>0&&d.jsxs("span",{children:["Income: ",t.status.violations.filter(U=>U.transactionType==="income").length," "]}),t.status.violations.filter(U=>U.transactionType==="expense").length>0&&d.jsxs("span",{children:["Expenses: ",t.status.violations.filter(U=>U.transactionType==="expense").length," "]}),t.status.violations.filter(U=>U.transactionType==="adjustment").length>0&&d.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(U=>U.transactionType==="adjustment").length," "]}),t.status.violations.filter(U=>U.transactionType==="transfer").length>0&&d.jsxs("span",{children:["Transfers: ",t.status.violations.filter(U=>U.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:Xg(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:f,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&d.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&d.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:Xg(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:Xg(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&d.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&d.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||u||l,A=()=>{C.forEach(U=>U.onCheck())};return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${E.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:u||l?d.jsx(Fn,{noMargin:!0}):E.icon}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),d.jsxs("div",{style:{color:E.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[x==="unknown"?"Unknown":x==="clean"?"Clean":x==="running"?"Running":"Needs Action",o>0&&d.jsx("span",{style:{background:`color-mix(in srgb, ${E.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[d.jsx("button",{onClick:A,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:l?d.jsx(Fn,{noMargin:!0}):""}),d.jsx("button",{onClick:()=>b(!_),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:_?"Collapse":"Expand",children:_?"":""})]})]}),_&&d.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:C.map(U=>d.jsx(pz,{check:U,disabled:h},U.id))})]})}function Xg(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function yz({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const b=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return b>0?`Fixed ${b}`:"Complete"}},_=()=>{if(l){const b=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&d.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsFixed>0&&d.jsxs("li",{children:[l.accountsFixed," account balance(s) fixed"]}),l.categoriesFixed>0&&d.jsxs("li",{children:[l.categoriesFixed," category value(s) fixed"]}),l.totalAvailableFixed>0&&d.jsxs("li",{children:[l.totalAvailableFixed," total_available value(s) fixed"]}),l.monthsProcessed>0&&d.jsxs("li",{children:[l.monthsProcessed," month(s) updated"]}),l.incomeValuesFixed>0&&d.jsxs("li",{children:[l.incomeValuesFixed," income amount(s) fixed"]}),l.expenseValuesFixed>0&&d.jsxs("li",{children:[l.expenseValuesFixed," expense amount(s) fixed"]}),l.categoryBalancesFixed>0&&d.jsxs("li",{children:[l.categoryBalancesFixed," category balance(s) fixed"]}),l.accountBalancesFixed>0&&d.jsxs("li",{children:[l.accountBalancesFixed," account balance(s) fixed"]}),b===0&&d.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[d.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((S,x)=>d.jsx("li",{children:S},x)),l.errors.length>3&&d.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Precision issues found:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&d.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&d.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&d.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&d.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),d.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return d.jsx(jm,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:u,isChecking:i,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:f,itemCount:n?r:void 0,details:_(),isDestructive:!0})}function _z({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,precisionCleanup:u}){const h=r.isScanning||i.isScanning||o.isScanning||l.isScanning||u.isScanning,f=i.isRunning||o.isRunning||l.isRunning||u.isRunning,p=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),u.scan()])},g=fa({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),_=fa({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),b=fa({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),S=fa({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),x=r.hasViolations||i.hasItemsToFix||o.hasItemsToMigrate||l.hasPairsToConvert,E=(r.violationCount||0)+(i.totalOrphaned||0)+(o.totalToMigrate||0)+(l.totalPairs||0);return d.jsxs(d.Fragment,{children:[d.jsxs(s_,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:p,isValidating:h,isAnyRunning:f,children:[d.jsx(gz,{accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,needsAction:x,totalIssues:E,isScanning:r.isScanning||i.isScanning||o.isScanning||l.isScanning,isRunning:i.isRunning||o.isRunning||l.isRunning,disabled:t,onRunOrphaned:()=>g.promptBeforeAction(i.runMigration),onRunExpense:()=>_.promptBeforeAction(o.runMigration),onRunTransfers:()=>b.promptBeforeAction(l.runMigration)}),d.jsx(yz,{status:u.status,hasData:u.hasData,hasIssues:u.hasIssues,totalIssues:u.totalIssues,isChecking:u.isScanning,isRunning:u.isRunning,result:u.result,onCheck:u.scan,onRun:()=>S.promptBeforeAction(u.runCleanup),disabled:t})]}),d.jsx(ha,{...g.promptProps,isDownloading:n}),d.jsx(ha,{..._.promptProps,isDownloading:n}),d.jsx(ha,{...b.promptProps,isDownloading:n}),d.jsx(ha,{...S.promptProps,isDownloading:n})]})}function bz({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:i,isUploading:o,uploadStatus:l,uploadProgress:u,uploadError:h,uploadResult:f,onScan:p,onUpload:g,disabled:_}){const b=k.useRef(null),[S,x]=k.useState(null),[E,C]=k.useState(!1),T=async q=>{const j=q.target.files?.[0];j&&(x(j),await p(j))},A=l!==null,U=A&&(l.budgetsFound>0||l.monthsFound>0),F=_||t||i||o,H=f?.success?"#22c55e":U?"#f59e0b":A?"#22c55e":"#9ca3af",O=f?.success?"":o||i||t?"":U?"":A?"":"",D=f?.success?"Uploaded":o?"Uploading":i?"Scanning":t?"Downloading":U?`${l.budgetsFound} budget(s), ${l.monthsFound} month(s) ready`:A?"Nothing to upload":"Select file",P=t?e?.percentComplete:u?.percentComplete,L=n||h;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${H} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||i||t?d.jsx(Fn,{noMargin:!0}):O}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),d.jsx("div",{style:{color:H,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:D}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[d.jsx("button",{onClick:()=>{r()},disabled:F,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:F?"not-allowed":"pointer",fontSize:"0.8rem",opacity:F?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?d.jsx(Fn,{noMargin:!0}):""}),d.jsx("input",{ref:b,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),d.jsx("button",{onClick:()=>b.current?.click(),disabled:F,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:F?"not-allowed":"pointer",fontSize:"0.8rem",opacity:F?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:i?d.jsx(Fn,{noMargin:!0}):""}),U&&S&&d.jsx("button",{onClick:async()=>{await g(S)},disabled:F,style:{background:"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:F?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:F?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?d.jsx(Fn,{noMargin:!0}):"Upload"}),(A||f||L)&&d.jsx("button",{onClick:()=>C(!E),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:E?"Collapse":"Expand",children:E?"":""})]})]}),(t||o)&&P!==void 0&&d.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[d.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:d.jsx("div",{style:{width:`${P}%`,height:"100%",background:"#646cff",transition:"width 0.3s ease"}})}),d.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:u?.phase,": ",P,"%"]})]}),E&&(A||f||L)&&d.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[L&&d.jsxs("div",{style:{marginBottom:"0.75rem",color:"#ef4444"},children:[" Error: ",L]}),f&&d.jsx("div",{style:{marginBottom:l?"0.75rem":0,color:f.success?"#22c55e":"#ef4444"},children:f.success?d.jsxs(d.Fragment,{children:[" Restored ",f.budgetsRestored," budget(s), ",f.monthsRestored," month(s), ",f.payeesRestored," payee doc(s)"]}):d.jsxs(d.Fragment,{children:[" Upload failed: ",f.errors.join(", ")]})}),l&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:[d.jsx("strong",{children:"Found in zip:"})," ",l.budgetsFound," budget(s), ",l.monthsFound," month(s), ",l.payeesFound," payee doc(s)"]}),l.budgetsToRestore.length>0&&d.jsxs("div",{children:[d.jsx("strong",{children:"Budgets to restore:"})," ",l.budgetsToRestore.join(", ")]})]})]})]})}function vz({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:i,deleteResult:o,onCheck:l,onDelete:u,disabled:h}){const[f,p]=k.useState(!1),g=()=>i?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",_=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,b=()=>{p(!0)},S=()=>{p(!1),u()},x=()=>o?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[d.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&d.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[d.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((E,C)=>d.jsx("li",{children:E},C)),o.errors.length>3&&d.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?d.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"#ef4444"},children:" DESTRUCTIVE ACTION"}),d.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),d.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return d.jsxs(d.Fragment,{children:[d.jsx(jm,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:_(),onCheck:l,isChecking:r,onRun:e>0?b:void 0,isRunning:i,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:x(),isDestructive:!0}),d.jsxs($s,{isOpen:f,onClose:()=>p(!1),title:" Delete All Months?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",d.jsxs("strong",{style:{color:"#ef4444"},children:[e," month(s)"]})," across"," ",d.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget(s)"]}),"."]}),d.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[d.jsx("li",{children:"All account balances  $0"}),d.jsx("li",{children:"All category balances  $0"}),d.jsx("li",{children:"Month history cleared"})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),d.jsxs($e,{variant:"danger",actionName:"Confirm Delete All Months",onClick:S,children:[" Delete All ",e," Months"]})]})]})]})}function xz({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:i,isDeleting:o,deleteResult:l,onCheck:u,onDelete:h,disabled:f}){const[p,g]=k.useState(!1),_=t?.staleBudgetIds??[],b=_.length>0,S=()=>o?"running":e?l&&l.errors.length===0?"complete":n===0&&!b?"clean":"needs-action":"unknown",x=()=>l&&l.errors.length===0?`Deleted ${l.budgetsDeleted}`:n===0&&!b?"Clean":b?`${_.length} stale ref(s)`:`${n} budget(s)`,E=()=>{g(!0)},C=()=>{g(!1),h()},T=()=>l?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Deletion complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsDeleted>0&&d.jsxs("li",{children:[l.budgetsDeleted," budget(s) deleted"]}),l.monthsDeleted>0&&d.jsxs("li",{children:[l.monthsDeleted," month(s) deleted"]}),l.payeesDeleted>0&&d.jsxs("li",{children:[l.payeesDeleted," payee doc(s) deleted"]})]}),l.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[d.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((U,F)=>d.jsx("li",{children:U},F)),l.errors.length>3&&d.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n===0&&!b?d.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):b?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Found stale budget references:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[_.slice(0,3).map(U=>d.jsx("li",{style:{opacity:.8},children:U},U)),_.length>3&&d.jsxs("li",{style:{opacity:.6},children:["...and ",_.length-3," more"]})]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Sample user budget found:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[d.jsxs("li",{children:[n," budget(s)"]}),d.jsxs("li",{children:[r," month(s)"]})]}),d.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),A=n>0||b;return d.jsxs(d.Fragment,{children:[d.jsx(jm,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:S(),statusText:x(),onCheck:u,isChecking:i,onRun:A?E:void 0,isRunning:o,actionText:"Delete",disabled:f,itemCount:A?n||_.length:void 0,details:T(),isDestructive:!0}),d.jsxs($s,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, #f59e0b 15%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",d.jsxs("strong",{style:{color:"#f59e0b"},children:[n," budget(s)"]})," and"," ",d.jsxs("strong",{style:{color:"#f59e0b"},children:[r," month(s)"]}),"."]}),b&&d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",d.jsxs("strong",{style:{color:"#f59e0b"},children:[_.length," stale reference(s)"]})," from the user document."]}),d.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[d.jsx("li",{children:"Budget document deleted"}),d.jsx("li",{children:"All month documents deleted"}),d.jsx("li",{children:"Payees document deleted"}),d.jsx("li",{children:"User will see onboarding flow"})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),d.jsx($e,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:C,children:" Delete Sample User Data"})]})]})]})}function wz({onClearCache:t,disabled:e}){const[n,r]=k.useState(!1),i=()=>{r(!0)},o=()=>{r(!1),t()};return d.jsxs(d.Fragment,{children:[d.jsx(hz,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:i,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),d.jsxs($s,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[d.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data and reload the page. The app will fetch fresh data from Firestore for everything."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),d.jsx($e,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function Sz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,deleteAllMonths:i,deleteSampleUserBudget:o,onClearCache:l}){const u=r.isDownloading||r.isUploading||i.isDeleting||o.isDeleting,h=fa({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),f=fa({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),p=fa({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e});return d.jsxs(d.Fragment,{children:[d.jsxs(s_,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:u,children:[d.jsx(bz,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async g=>{p.promptBeforeAction(()=>{r.uploadBudget(g).catch(_=>console.error("Upload failed:",_))})},disabled:t}),d.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[d.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),d.jsx(vz,{status:i.status,hasData:i.hasData,monthsCount:i.monthsCount,budgetCount:i.budgetCount,isChecking:i.isScanning,isDeleting:i.isDeleting,deleteResult:i.deleteResult,deleteProgress:i.deleteProgress,onCheck:i.scanStatus,onDelete:()=>h.promptBeforeAction(i.deleteAllMonths),disabled:t}),d.jsx(xz,{status:o.status,hasData:o.hasData,totalBudgets:o.totalBudgets,totalMonths:o.totalMonths,isChecking:o.isScanning,isDeleting:o.isDeleting,deleteResult:o.deleteResult,deleteProgress:o.deleteProgress,onCheck:o.scanStatus,onDelete:()=>f.promptBeforeAction(o.deleteSampleUserBudget),disabled:t}),d.jsx(wz,{onClearCache:l,disabled:t})]})]}),d.jsx(ha,{...h.promptProps,isDownloading:n}),d.jsx(ha,{...f.promptProps,isDownloading:n}),d.jsx(ha,{...p.promptProps,isDownloading:n})]})}function i_({message:t="Loading...",spinnerColor:e=ce.primary,children:n,spinnerSize:r=4}){return d.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[d.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),d.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,d.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function oA({percent:t,gradient:e="linear-gradient(90deg, #646cff, #8b5cf6)",width:n=300}){return d.jsx("div",{style:{width:`${n}px`,height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden"},children:d.jsx("div",{style:{width:`${t}%`,height:"100%",background:e,borderRadius:"4px",transition:"width 0.3s ease-out"}})})}function zf({value:t,label:e,color:n="#646cff"}){return d.jsxs("div",{style:{textAlign:"center"},children:[d.jsx("p",{style:{color:n,fontSize:"1.5rem",fontWeight:700,margin:0},children:t}),d.jsx("p",{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.8rem",margin:"0.25rem 0 0",textTransform:"uppercase",letterSpacing:"0.05em"},children:e})]})}function lA({percent:t}){return d.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:"0.9rem",margin:0},children:[t,"% complete"]})}function Ez(){return d.jsxs("div",{style:Mf,children:[d.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:d.jsx(Cn,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:d.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),d.jsx("h1",{children:"Tarron Lane Homepage"}),d.jsx("nav",{children:d.jsxs("ul",{children:[d.jsx("li",{children:d.jsx(Cn,{to:"/sql-test",children:"SQL Test"})}),d.jsx("li",{children:d.jsx(Cn,{to:"/budget",children:"Budget"})}),d.jsx("li",{children:d.jsx(Cn,{to:"/account",children:"Account"})})]})})]})}function Cz(){const t=k.useContext(ud),e=Da(),[n,r]=k.useState(!1),i=On(),o=Ku(),l=i.state?.from||"/";k.useEffect(()=>{t.is_logged_in&&l!=="/"&&o(l,{replace:!0})},[t.is_logged_in,l,o]);function u(){r(!0),e.logout_firebase_user().then(function(){Ue.clear(),window.location.href="/"})}return d.jsxs("div",{style:Mf,children:[d.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsx(Cn,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),d.jsxs(Cn,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[d.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),d.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),d.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:d.jsx(sA,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),d.jsx("h1",{children:"Account"}),t.is_logged_in?n?d.jsx("p",{children:"Logging Out..."}):d.jsxs(d.Fragment,{children:[d.jsxs("p",{children:["You are logged in as ",t.username]}),d.jsx("button",{onClick:u,style:{marginTop:"1rem"},children:"Logout"})]}):d.jsx(Tz,{})]})}function Tz(){const t=Da(),[e,n]=k.useState(""),[r,i]=k.useState(""),[o,l]=k.useState(!1),[u,h]=k.useState(!1),[f,p]=k.useState("");function g(S){n(S.target.value)}function _(S){i(S.target.value)}function b(S){S.preventDefault(),h(!0),p(""),Ue.clear(),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return d.jsxs("form",{onSubmit:b,children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"username",children:"Email: "}),d.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"password",children:"Password: "}),d.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[d.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:_,style:{paddingRight:"2rem"}}),d.jsx("button",{type:"button",onClick:()=>l(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),u?d.jsx("p",{children:"Logging in..."}):d.jsx("button",{children:"Login"}),f&&d.jsx("p",{style:{color:"red"},children:f})]})}const Az={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"},jz={balances:"categories",transactions:"income"};function Rz({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const r=Az[t],i=k.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),o=k.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"}],[n]),l=k.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),u=f=>{e(jz[f])},h=r==="balances"?o:l;return d.jsxs("div",{children:[d.jsx(Pf,{mode:"button",tabs:i,activeTab:r,onTabChange:u,variant:"segmented"}),d.jsx(Pf,{mode:"button",tabs:h,activeTab:t,onTabChange:f=>e(f),variant:"secondary"})]})}function Iz({isOpen:t,onClose:e,onProceed:n,results:r}){const[i,o]=k.useState("from_current"),l=!r||r.status==="confirming",u=r&&!["confirming","done","error"].includes(r.status),h=l||r?.status==="done"||r?.status==="error";function f(){h&&(e(),o("from_current"))}function p(){n(i)}return d.jsx($s,{isOpen:t,onClose:f,title:"Recalculate Balances",width:"540px",children:d.jsxs("div",{style:{padding:"0.5rem 0"},children:[l&&d.jsxs(d.Fragment,{children:[d.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.95rem",lineHeight:1.5},children:"Choose what to recalculate:"}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[d.jsx(W1,{selected:i==="from_current",onClick:()=>o("from_current"),title:"From current month forward",description:"Recalculate from this month onward. Use for quick fixes."}),d.jsx(W1,{selected:i==="all_months",onClick:()=>o("all_months"),title:"All months from beginning",description:"Recalculate entire history. Use after migrations or data repairs.",recommended:!0})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[d.jsx(Tl,{status:"waiting",label:"Find all months to process"}),d.jsx(Tl,{status:"waiting",label:"Process months"}),d.jsx(Tl,{status:"waiting",label:"Update budget totals"})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Recalculation",onClick:e,children:"Cancel"}),d.jsx($e,{actionName:"Proceed with Recalculation",onClick:p,children:"Proceed"})]})]}),!l&&d.jsxs(d.Fragment,{children:[d.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Recalculating category balances and account balances..."}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[d.jsx(Tl,{status:r?.status==="pending"?"waiting":"complete",label:"Find all months to process",detail:r&&r.status!=="pending"?`Found ${r.monthsFound||0} month${r.monthsFound!==1?"s":""}`:void 0}),d.jsx(Tl,{status:Q1(r?.status,["pending","finding_months"],"processing_months"),label:"Process months",detail:r?.status==="processing_months"?`Processing: ${r.currentMonthLabel} (${(r.currentMonthIndex||0)+1}/${r.monthsFound||0})`:r?.monthsProcessed!==void 0?`Processed ${r.monthsProcessed} month${r.monthsProcessed!==1?"s":""}`:void 0}),d.jsx(Tl,{status:r?.status==="error"?"error":Q1(r?.status,["pending","finding_months","processing_months"],"updating_budget"),label:"Update budget totals",detail:r?.status==="error"?r.error:void 0,isError:r?.status==="error"})]}),r?.status==="done"&&d.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:`color-mix(in srgb, ${ce.success} 10%, transparent)`,border:`1px solid ${ce.success}`,borderRadius:"8px",textAlign:"center"},children:[d.jsx("p",{style:{margin:0,fontWeight:600,color:ce.success},children:" Recalculation complete!"}),d.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",opacity:.8},children:[r.monthsProcessed," month",r.monthsProcessed!==1?"s":""," processed",d.jsx("br",{}),"Total Income: ",Je(r.totalIncomeRecalculated||0),d.jsx("br",{}),"Total Expenses: ",Je(r.totalExpensesRecalculated||0)]})]}),(r?.status==="done"||r?.status==="error")&&d.jsx("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"center"},children:d.jsx($e,{actionName:"Close Recalculation Modal",onClick:e,children:"Done"})}),u&&d.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"Please wait, do not close this window..."})]})]})})}function Q1(t,e,n){return!t||e.includes(t)?t===n?"active":"waiting":t===n?"active":"complete"}function Tl({status:t,label:e,detail:n,isError:r}){const i=t==="waiting"?"":t==="active"?"":t==="error"?"":"";return d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[d.jsx("span",{style:{fontSize:"1.1rem",width:"1.5rem",textAlign:"center"},children:i}),d.jsxs("div",{style:{flex:1},children:[d.jsx("p",{style:{margin:0,fontWeight:500},children:e}),n&&d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:r?1:.6,color:r?ce.error:"inherit"},children:n})]})]})}function W1({selected:t,onClick:e,title:n,description:r,recommended:i}){return d.jsxs("button",{type:"button",onClick:e,style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem 1rem",background:t?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",border:t?"2px solid #646cff":"2px solid transparent",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.15s ease"},children:[d.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",border:t?"6px solid #646cff":"2px solid rgba(128,128,128,0.5)",flexShrink:0,marginTop:"2px",background:t?"white":"transparent"}}),d.jsxs("div",{style:{flex:1},children:[d.jsxs("p",{style:{margin:0,fontWeight:600,fontSize:"0.95rem"},children:[n,i&&d.jsx("span",{style:{marginLeft:"0.5rem",padding:"0.15rem 0.5rem",background:ce.success,color:"white",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,verticalAlign:"middle"},children:"RECOMMENDED"})]}),d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:r})]})]})}function Zg(t){return t==="no_category"||t==="NO_CATEGORY"}function Dz(t,e){const n={};for(const r of t)Zg(r.from_category_id)||(n[r.from_category_id]=(n[r.from_category_id]||0)-r.amount),Zg(r.to_category_id)||(n[r.to_category_id]=(n[r.to_category_id]||0)+r.amount);for(const r of e)Zg(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(n))n[r]=Me(n[r]);return n}async function kz(t,e,n,r,i,o,l){const u=us(t,e.year,e.month),{exists:h,data:f}=await At("months",u,"recalculate: reading full month data");if(!h||!f)return null;const p=f.income||[],g=f.expenses||[],_=f.transfers||[],b=f.adjustments||[],S=f.are_allocations_finalized||!1,x=Me(p.reduce((D,P)=>D+P.amount,0)),E=Me(g.reduce((D,P)=>D+P.amount,0)),C={};if(f.category_balances)for(const D of f.category_balances)C[D.category_id]={allocated:D.allocated??0};const T=Dz(_,b),A=n.map(D=>{const P=Me(i[D]??0);let L=0;S&&C[D]&&(L=Me(C[D].allocated));let q=0;g.length>0&&(q=Me(g.filter(Q=>Q.category_id===D).reduce((Q,G)=>Q+G.amount,0)));const j=T[D]??0,M=Me(_.filter(Q=>Q.from_category_id===D||Q.to_category_id===D).reduce((Q,G)=>G.from_category_id===D?Q-G.amount:G.to_category_id===D?Q+G.amount:Q,0)),R=Me(b.filter(Q=>Q.category_id===D).reduce((Q,G)=>Q+G.amount,0)),K=Me(P+L+q+j);return{category_id:D,start_balance:P,allocated:L,spent:q,transfers:M,adjustments:R,end_balance:K}});A.forEach(D=>{i[D.category_id]=D.end_balance});const U=Object.keys(r),F={},H=U.map(D=>{const P=Me(p.filter(G=>G.account_id===D).reduce((G,X)=>G+X.amount,0)),L=Me(g.filter(G=>G.account_id===D).reduce((G,X)=>G+X.amount,0)),q=Me(_.filter(G=>G.from_account_id===D).reduce((G,X)=>G-X.amount,0)),j=Me(_.filter(G=>G.to_account_id===D).reduce((G,X)=>G+X.amount,0)),M=Me(b.filter(G=>G.account_id===D).reduce((G,X)=>G+X.amount,0)),R=Me(P+L+q+j+M);F[D]=R;const K=Me(o[D]??0),Q=Me(q+j);return{account_id:D,start_balance:K,income:P,expenses:L,transfers:Q,adjustments:M,net_change:R,end_balance:Me(K+R)}});for(const D of H)o[D.account_id]=D.end_balance;return{updatedMonth:{budget_id:t,year_month_ordinal:vt(e.year,e.month),year:e.year,month:e.month,income:p,total_income:x,previous_month_income:l,expenses:g,total_expenses:E,transfers:_,adjustments:b,account_balances:H,category_balances:A,are_allocations_finalized:S,created_at:f.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},totalIncome:x,totalExpenses:E,accountNetChanges:F}}function a_({isDisabled:t,onCloseMenu:e}){const{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Ze(),{categories:o,accounts:l}=An(),{updateAccounts:u}=OT(),{updateCategories:h}=MT(),[f,p]=k.useState(!1),[g,_]=k.useState(!1),[b,S]=k.useState(null);function x(){_(!0),S({status:"confirming"})}async function E(T){if(n){p(!0),S({status:"pending"});try{S({status:"finding_months"});let A;if(T==="all_months")A=(await kn("months","recalculate: querying all months for full recalculation",[{field:"budget_id",op:"==",value:n}])).docs.map(M=>({year:M.data.year,month:M.data.month})).sort((M,R)=>M.year!==R.year?M.year-R.year:M.month-R.month);else{const j=new Date,M=r||j.getFullYear(),R=i||j.getMonth()+1,{year:K,month:Q}=Xl(M,R);A=await H4(n,K,Q)}const U=Object.keys(o);S({status:"finding_months",monthsFound:A.length}),await new Promise(j=>setTimeout(j,100));const F={},H={};if(T==="from_current"){const j=new Date,M=r||j.getFullYear(),R=i||j.getMonth()+1,{year:K,month:Q}=Xl(M,R),G=us(n,K,Q),{exists:X,data:J}=await At("months",G,"recalculate: reading previous month for starting balances");if(X&&J?.category_balances)for(const re of J.category_balances)F[re.category_id]=re.end_balance??0;if(X&&J?.account_balances)for(const re of J.account_balances)H[re.account_id]=re.end_balance??0}U.forEach(j=>{F[j]===void 0&&(F[j]=0)}),Object.keys(l).forEach(j=>{H[j]===void 0&&(H[j]=0)});let O=0,D=0,P=0;for(let j=0;j<A.length;j++){const M=A[j],R=`${Fu[M.month-1]} ${M.year}`;S({status:"processing_months",monthsFound:A.length,currentMonthIndex:j,currentMonthLabel:R});const K=await kz(n,M,U,l,F,H,P);K&&(O+=K.totalIncome,D+=K.totalExpenses,P=K.totalIncome,await AT({budgetId:n,month:K.updatedMonth,description:"recalculate all months"}),await new Promise(Q=>setTimeout(Q,50)))}const L={};Object.entries(l).forEach(([j,M])=>{L[j]={...M,balance:H[j]??0}}),await u.mutateAsync({budgetId:n,accounts:L}),S({status:"updating_budget",monthsFound:A.length,monthsProcessed:A.length,totalIncomeRecalculated:O,totalExpensesRecalculated:D});const q={};Object.entries(o).forEach(([j,M])=>{q[j]={...M,balance:F[j]??0}}),await h.mutateAsync({budgetId:n,categories:q});for(const j of A)Ue.invalidateQueries({queryKey:ke.month(n,j.year,j.month)});S({status:"done",monthsFound:A.length,monthsProcessed:A.length,totalIncomeRecalculated:O,totalExpensesRecalculated:D})}catch(A){console.error("Recalculate error:",A),S({status:"error",error:A instanceof Error?A.message:"Failed to recalculate"})}finally{p(!1)}}}function C(){_(!1),S(null),e?.()}return d.jsxs(d.Fragment,{children:[d.jsxs("button",{onClick:x,disabled:t||f,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.5rem",cursor:t||f?"not-allowed":"pointer",opacity:t||f?.5:1,fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center"},title:"Recalculate balances from this month forward",children:[f?"":""," Recalculate"]}),d.jsx(Iz,{isOpen:g,onClose:C,onProceed:E,results:b})]})}function K1({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:i}){const[o,l]=k.useState(!1),u=n||e,h=t==="prev"?"":"",f=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(l(!0),setTimeout(()=>l(!1),2e3)):i())};return d.jsxs("div",{style:{position:"relative"},children:[d.jsx("button",{onClick:p,onMouseEnter:()=>e&&l(!0),onMouseLeave:()=>l(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:u?"not-allowed":"pointer",fontSize:"1.25rem",opacity:u?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:f,children:h}),o&&e&&d.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:ce.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r})]})}function Oz({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:i,maxOrdinal:o,minAllowed:l,maxAllowed:u,onYearChange:h,onMonthChange:f,onGo:p}){const g=t>l.year,_=t<u.year,b=Number(vt(t,e)),S=b>=i&&b<=o;return d.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[d.jsx("button",{onClick:()=>h(t-1),disabled:!g,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:g?"pointer":"not-allowed",fontSize:"0.8rem",opacity:g?1:.3},title:g?"Previous year":"Cannot go further back",children:""}),d.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),d.jsx("button",{onClick:()=>h(t+1),disabled:!_,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:_?"pointer":"not-allowed",fontSize:"0.8rem",opacity:_?1:.3},title:_?"Next year":"Cannot go further ahead",children:""})]}),d.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:Fu.map((x,E)=>{const C=E+1,T=C===e,A=t===n&&C===r,U=Number(vt(t,C)),F=U<i,H=U>o,O=F||H;let D=x;return F?D="Too far in the past":H&&(D="Too far in the future"),d.jsx("button",{onClick:()=>f(C),disabled:O,style:{background:T?ce.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:A?`1px solid ${ce.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:O?"not-allowed":"pointer",fontSize:"0.7rem",color:T?"#fff":"inherit",opacity:O?.3:1,transition:"background 0.15s"},title:D,children:x.slice(0,3)},C)})}),d.jsxs("button",{onClick:p,disabled:!S,style:{width:"100%",background:S?ce.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:S?"pointer":"not-allowed",fontSize:"0.85rem",color:S?"#fff":"inherit",fontWeight:500,opacity:S?1:.5},children:["Go to ",Fu[e-1]," ",t]})]})}function Mz({isOpen:t,onClose:e,year:n,month:r,isDeleting:i,onConfirm:o}){return d.jsxs($s,{isOpen:t,onClose:e,title:" Delete Month?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsxs("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",Fu[r-1]," ",n,"!"]})}),d.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),d.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:i,children:"Cancel"}),d.jsx($e,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:i,children:i?"Deleting...":" Delete Month"})]})]})}function Nz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Df;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function Pz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-kf;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function zz(t){return Object.keys(t).sort()[0]}function Bz(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function Lz(t){const e=Pz(),n=zz(t);if(!n)return e;const r=vt(e.year,e.month);return n<r?Bz(n):e}function Y1(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function Uz(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function Fz({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=sr(),{currentYear:r,currentMonthNumber:i,isAdmin:o,selectedBudgetId:l,setCurrentYear:u,setCurrentMonthNumber:h}=Ze(),{budget:f,monthMap:p}=An(),{month:g}=Ei(l,r,i),_=Y1(r,i),b=Uz(r,i),S=Lz(p),x=Nz(),E=Number(vt(S.year,S.month)),C=Number(vt(x.year,x.month)),T=Number(vt(_.year,_.month)),A=Number(vt(b.year,b.month)),U=T<E,F=A>C,[H,O]=k.useState(!1),[D,P]=k.useState(!1),[L,q]=k.useState(r),[j,M]=k.useState(i),[R,K]=k.useState(!1),[Q,G]=k.useState(!1),X=k.useRef(null),J=(()=>{if(!p||Object.keys(p).length===0)return!1;const ne=vt(r,i),de=Math.max(...Object.keys(p).map(Number));return Number(ne)===de})(),{trackChange:re}=mc();async function B(){if(l){G(!0);try{const ne=us(l,r,i);Z4(l,r,i,re),await Ny("months",ne,`deleting month ${r}/${i}`),`${r}${i}`,Ue.removeQueries({queryKey:ke.month(l,r,i)});const de=Y1(r,i);K(!1),O(!1),window.location.href=`/budget/${de.year}/${de.month}/categories`}catch(ne){console.error("Failed to delete month:",ne),alert(`Failed to delete month: ${ne instanceof Error?ne.message:"Unknown error"}`)}finally{G(!1)}}}k.useEffect(()=>{if(!H)return;function ne(de){X.current&&!X.current.contains(de.target)&&(O(!1),P(!1))}return document.addEventListener("mousedown",ne),()=>document.removeEventListener("mousedown",ne)},[H]);function $(){D||(q(r),M(i)),P(!D)}function te(){u(L),h(j),P(!1),O(!1)}async function ae(){if(!g||!f)return;const ne=new Date,Se=`${ne.toISOString().split("T")[0]}_month_${r}_${String(i).padStart(2,"0")}`,Te=new Cm,Ee=[{name:`${Se}_income.json`,data:g.income||[]},{name:`${Se}_expenses.json`,data:g.expenses||[]},{name:`${Se}_transfers.json`,data:g.transfers||[]},{name:`${Se}_adjustments.json`,data:g.adjustments||[]},{name:`${Se}_account_balances.json`,data:g.account_balances||[]},{name:`${Se}_category_balances.json`,data:g.category_balances||[]}],pe={budget_id:f.id,budget_name:f.name,year_month_ordinal:g.year_month_ordinal,year:g.year,month:g.month,total_income:g.total_income,previous_month_income:g.previous_month_income,total_expenses:g.total_expenses,are_allocations_finalized:g.are_allocations_finalized,created_at:g.created_at,updated_at:g.updated_at,downloaded_at:ne.toISOString()};Ee.push({name:`${Se}_metadata.json`,data:pe});for(const z of Ee)Te.file(z.name,JSON.stringify(z.data,null,2));const Fe=await Te.generateAsync({type:"blob"}),He=URL.createObjectURL(Fe),Ne=document.createElement("a");Ne.href=He,Ne.download=`${Se}.zip`,document.body.appendChild(Ne),Ne.click(),document.body.removeChild(Ne),URL.revokeObjectURL(He),O(!1)}return d.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[d.jsx(K1,{direction:"prev",isDisabled:U,isLoading:n,disabledReason:"Cannot create months more than 3 months into the past",onNavigate:t}),d.jsxs("div",{ref:X,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[d.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[Fu[i-1]," ",r]}),d.jsx("button",{onClick:()=>O(!H),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:H?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&d.jsxs(d.Fragment,{children:[d.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),d.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[d.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:ce.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),d.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),H&&d.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[d.jsx(a_,{isDisabled:n,onCloseMenu:()=>O(!1)}),d.jsx("button",{onClick:$,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),D&&d.jsx(Oz,{pickerYear:L,pickerMonth:j,currentYear:r,currentMonthNumber:i,minOrdinal:E,maxOrdinal:C,minAllowed:S,maxAllowed:x,onYearChange:q,onMonthChange:M,onGo:te}),o&&g&&d.jsx("button",{onClick:()=>{ae()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&g&&J&&d.jsx("button",{onClick:()=>K(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"#ef4444",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),d.jsx(K1,{direction:"next",isDisabled:F,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),d.jsx(Mz,{isOpen:R,onClose:()=>K(!1),year:r,month:i,isDeleting:Q,onConfirm:B})]})}const o_={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},Vz={...o_,background:ce.primary,border:"none",color:"white"},$z={...o_,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},qz={...o_,background:"transparent",border:`1px solid ${ce.errorBorder}`,color:ce.error},X1=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${ce.error} 15%, transparent)`:`color-mix(in srgb, ${ce.success} 15%, transparent)`,border:`1px solid ${t?ce.errorBorder:"rgba(74, 222, 128, 0.4)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?ce.error:ce.success,transition:"all 0.15s ease",flexShrink:0});function l_({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:u,config:h,onSubmit:f,onCancel:p,onDelete:g,extraContent:_}){const{isWide:b}=kT(),{showCategory:S=!1,showCleared:x=!1,showSignToggle:E=!1,accountLabel:C="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:A="Optional note",submitLabel:U}=h,F=new Date().toISOString().split("T")[0],[H,O]=k.useState(o?.date||u||F),[D,P]=k.useState(o?.payee||""),[L,q]=k.useState(o?.categoryId||(h.showNoCategoryOption?Kt:"")),[j,M]=k.useState(o?.accountId||l||(h.showNoAccountOption?$t:t[0]?t[0][0]:"")),R=o?.amount!==void 0?Math.abs(o.amount):void 0,[K,Q]=k.useState(R?.toString()||""),[G,X]=k.useState(o?.description||""),[J,re]=k.useState(o?.cleared||!1),[B,$]=k.useState(()=>E?o?.amount!==void 0?o.amount<0:!1:!0),[te,ae]=k.useState(!1),ne={},de=[];t.forEach(([xe,oe])=>{oe.account_group_id?(ne[oe.account_group_id]||(ne[oe.account_group_id]=[]),ne[oe.account_group_id].push([xe,oe])):de.push([xe,oe])});function Se(xe){xe.preventDefault();const oe=parseFloat(K);if(isNaN(oe)||oe<=0||S&&!L||!j||!H)return;if(L===Kt&&j===$t){ae(!0);return}ae(!1);const Oe=E&&B?-oe:oe;f({date:H,payee:D.trim()||void 0,categoryId:S?L:void 0,accountId:j,amount:Oe,description:G.trim()||void 0,cleared:x?J:void 0})}!(L===Kt&&j===$t)&&te&&ae(!1);const Fe=h.showNoAccountOption?d.jsx(tA,{id:"txn-account",value:j,onChange:M,accounts:t,accountGroups:e,placeholder:ja,required:!0,showNoAccountOption:!0}):d.jsxs(qu,{id:"txn-account",value:j,onChange:xe=>M(xe.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([xe,oe])=>{const je=ne[xe];return je?.length?d.jsx("optgroup",{label:oe.name,children:je.map(([Pe,Oe])=>d.jsx("option",{value:Pe,children:Oe.nickname},Pe))},xe):null}),de.length>0&&d.jsx("optgroup",{label:"Other",children:de.map(([xe,oe])=>d.jsx("option",{value:xe,children:oe.nickname},xe))})]}),He=S&&n&&r?d.jsx(Pt,{label:"Category",htmlFor:"txn-category",children:d.jsx(eA,{id:"txn-category",value:L,onChange:q,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?jo:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,Ne=x?d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[d.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),d.jsx(Vr,{id:"txn-cleared",checked:J,onChange:xe=>re(xe.target.checked)})]}):null,z=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),d.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[d.jsx("button",{type:"submit",title:U,style:Vz,children:""}),d.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:$z,children:""}),g&&d.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:qz,children:""})]})]}),be=te?d.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ce.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,ge=d.jsxs(Pa,{children:[d.jsx($e,{type:"submit",actionName:U,children:U}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&d.jsx($e,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),ee=S&&n&&r,Z={fontSize:"0.85rem",padding:"0.5rem"};if(!b)return d.jsxs(xi,{actionName:U,onSubmit:Se,children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[d.jsx(Pt,{label:"Date",htmlFor:"txn-date",children:d.jsx(Nf,{id:"txn-date",value:H,onChange:xe=>O(xe.target.value),required:!0,autoFocus:!0})}),d.jsx(Pt,{label:E?B?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:E?d.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[d.jsx("button",{type:"button",onClick:()=>$(!B),style:X1(B),title:B?"Click to make this a refund (+)":"Click to make this an expense (-)",children:B?"":"+"}),d.jsx("div",{style:{flex:1},children:d.jsx(bo,{id:"txn-amount",value:K,onChange:Q,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:B?ce.error:ce.success}})})]}):d.jsx(bo,{id:"txn-amount",value:K,onChange:Q,placeholder:"$0.00",required:!0})})]}),d.jsx(Pt,{label:"Payee",htmlFor:"txn-payee",children:d.jsx(H1,{id:"txn-payee",value:D,onChange:P,payees:i,placeholder:T})}),He,d.jsx(Pt,{label:C,htmlFor:"txn-account",children:Fe}),d.jsx(Pt,{label:"Description (optional)",htmlFor:"txn-description",children:d.jsx(wi,{id:"txn-description",value:G,onChange:xe=>X(xe.target.value),placeholder:A})}),x&&d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx(Vr,{id:"txn-cleared-stacked",checked:J,onChange:xe=>re(xe.target.checked)}),d.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),be,_]}),ge]});const ie=E?"8.25rem":"6rem",we=ee?x?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${ie} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${ie} minmax(10rem, 2fr) auto`:x?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${ie} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${ie} minmax(12rem, 2fr) auto`;return d.jsxs(xi,{actionName:U,onSubmit:Se,children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:we,gap:"1rem",alignItems:"end"},children:[d.jsx(Pt,{label:"Date",htmlFor:"txn-date",children:d.jsx(Nf,{id:"txn-date",value:H,onChange:xe=>O(xe.target.value),required:!0,style:Z,autoFocus:!0})}),d.jsx(Pt,{label:"Payee",htmlFor:"txn-payee",children:d.jsx(H1,{id:"txn-payee",value:D,onChange:P,payees:i,placeholder:T})}),He,d.jsx(Pt,{label:C,htmlFor:"txn-account",children:Fe}),d.jsx(Pt,{label:E?B?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:E?d.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[d.jsx("button",{type:"button",onClick:()=>$(!B),style:X1(B),title:B?"Click to make this a refund (+)":"Click to make this an expense (-)",children:B?"":"+"}),d.jsx("div",{style:{flex:1},children:d.jsx(bo,{id:"txn-amount",value:K,onChange:Q,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:B?ce.error:ce.success}})})]}):d.jsx(bo,{id:"txn-amount",value:K,onChange:Q,placeholder:"$0.00",required:!0})}),d.jsx(Pt,{label:"Description",htmlFor:"txn-description",children:d.jsx(wi,{id:"txn-description",value:G,onChange:xe=>X(xe.target.value),placeholder:A,style:Z})}),Ne,z]}),be,_]})}function Z1({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:i,defaultDate:o,onSubmit:l,onCancel:u,onDelete:h,submitLabel:f}){function p(g){l(g.amount,g.accountId,g.date,g.payee,g.description)}return d.jsx(l_,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:i,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:f},onSubmit:p,onCancel:u,onDelete:h})}function Gz({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:i,isMobile:o,isEvenRow:l}){const u=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,f=l?"transparent":"rgba(255,255,255,0.04)";if(o)return d.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:f,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:u}),d.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),d.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsxs("span",{style:{fontWeight:600,color:ce.success,fontFamily:"monospace"},children:["+",Je(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",background:f,display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{display:"contents"},children:[d.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:u})}),d.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),d.jsx("div",{style:{...p,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),d.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:ce.success,fontFamily:"monospace"},children:["+",Je(t.amount)]}),d.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Al={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Hz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ze(),{accounts:o,accountGroups:l}=An(),{month:u,isLoading:h}=Ei(t,e,n),{addIncome:f}=q6(),{updateIncome:p}=H6(),{deleteIncome:g}=Q6(),_=qs(),[b,S]=k.useState(null),[x,E]=k.useState(!1),[C,T]=k.useState(null),F=H0(t,{enabled:x||C!==null}).data||[];function H(G){const X=G.account_group_id?l[G.account_group_id]:void 0;return X&&X.is_active!==null?X.is_active:G.is_active!==!1}function O(G){const X=G.account_group_id?l[G.account_group_id]:void 0;return X&&X.on_budget!==null?X.on_budget:G.on_budget!==!1}const D=Object.entries(o).filter(([,G])=>H(G)&&O(G)),P=D.filter(([,G])=>G.is_income_account),L=P.length>0?P:D,q=D.find(([,G])=>G.is_income_default),j=q?q[0]:void 0,M=u?.income.reduce((G,X)=>G+X.amount,0)||0;function R(G,X,J,re,B){if(!t)return;S(null),E(!1);const{year:$,month:te}=ym(J);($!==e||te!==n)&&(r($),i(te)),f(t,$,te,G,X,J,re,B).catch(ae=>{S(ae instanceof Error?ae.message:"Failed to add income")})}function K(G,X,J,re,B,$){t&&(S(null),T(null),p(t,e,n,G,X,J,re,B,$).catch(te=>{S(te instanceof Error?te.message:"Failed to update income")}))}function Q(G){t&&confirm("Are you sure you want to delete this income entry?")&&(S(null),g(t,e,n,G).catch(X=>{S(X instanceof Error?X.message:"Failed to delete income")}))}return d.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[b&&d.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ce.error},children:b}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:_?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:_?"block":"grid",gridTemplateColumns:_?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Income:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:Bt(M),fontWeight:600},children:Je(M)})]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!x&&d.jsx($e,{actionName:"Open Add Income Form",onClick:()=>E(!0),disabled:L.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!_&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Al,children:"Date"}),d.jsx("div",{style:Al,children:"Payee"}),d.jsx("div",{style:Al,children:"Account"}),d.jsx("div",{style:{...Al,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:Al,children:"Description"}),d.jsx("div",{style:Al})]})]}),d.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),L.length===0&&d.jsx(Gu,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),x&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(Z1,{accounts:L,accountGroups:l,payees:F,defaultAccountId:j,defaultDate:gm(e,n),onSubmit:R,onCancel:()=>E(!1),submitLabel:"Add Income",isMobile:_})}),u?.income.slice().sort((G,X)=>(G.date||"").localeCompare(X.date||"")).map((G,X)=>C===G.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(Z1,{accounts:L,accountGroups:l,payees:F,initialData:G,onSubmit:(J,re,B,$,te)=>K(G.id,J,re,B,$,te),onCancel:()=>T(null),onDelete:()=>Q(G.id),submitLabel:"Save",isMobile:_})},G.id):d.jsx(Gz,{income:G,accountName:nt(G.account_id)?ja:o[G.account_id]?.nickname||"Unknown Account",accountGroupName:nt(G.account_id)?void 0:o[G.account_id]?.account_group_id?l[o[G.account_id].account_group_id]?.name:void 0,onEdit:()=>{G.payee||`${G.amount}`,T(G.id)},onDelete:()=>Q(G.id),isMobile:_,isEvenRow:X%2===0},G.id)),(!u?.income||u.income.length===0)&&!x&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function J1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:u,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function _(b){h(b.amount,b.categoryId,b.accountId,b.date,b.payee,b.description,b.cleared)}return d.jsx(l_,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:u,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:_,onCancel:f,onDelete:p})}function Qz({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:u}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=u?"transparent":"rgba(255,255,255,0.04)";if(l)return d.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),d.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:ce.success},title:"Cleared",children:""})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),d.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",f]})]})]}),d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsx("span",{style:{fontWeight:600,color:Bt(t.amount),fontFamily:"monospace"},children:Gt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",background:p,display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{display:"contents"},children:[d.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:h})}),d.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),d.jsx("div",{style:{...g,justifyContent:"center"},children:d.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...g,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),d.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:Bt(t.amount),fontFamily:"monospace"},children:Gt(t.amount)}),d.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?ce.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const sa={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Wz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ze(),{accounts:o,accountGroups:l,categories:u,categoryGroups:h}=An(),{month:f,isLoading:p}=Ei(t,e,n),{addExpense:g}=K6(),{updateExpense:_}=X6(),{deleteExpense:b}=Z6(),S=qs(),[x,E]=k.useState(null),[C,T]=k.useState(!1),[A,U]=k.useState(null),O=H0(t,{enabled:C||A!==null}).data||[];function D(J){const re=J.account_group_id?l[J.account_group_id]:void 0;return re&&re.is_active!==null?re.is_active:J.is_active!==!1}function P(J){const re=J.account_group_id?l[J.account_group_id]:void 0;return re&&re.on_budget!==null?re.on_budget:J.on_budget!==!1}const L=Object.entries(o).filter(([,J])=>D(J)&&P(J)),q=L.filter(([,J])=>J.is_outgo_account),j=q.length>0?q:L,M=L.find(([,J])=>J.is_outgo_default),R=M?M[0]:void 0,K=f?.expenses?.reduce((J,re)=>J+re.amount,0)||0;function Q(J,re,B,$,te,ae,ne){if(!t)return;E(null),T(!1);const{year:de,month:Se}=ym($);(de!==e||Se!==n)&&(r(de),i(Se)),g(t,de,Se,J,re,B,$,te,ae,ne).catch(Te=>{E(Te instanceof Error?Te.message:"Failed to add expense")})}function G(J,re,B,$,te,ae,ne,de){t&&(E(null),U(null),_(t,e,n,J,re,B,$,te,ae,ne,de).catch(Se=>{E(Se instanceof Error?Se.message:"Failed to update expense")}))}function X(J){t&&confirm("Are you sure you want to delete this expense?")&&(E(null),b(t,e,n,J).catch(re=>{E(re instanceof Error?re.message:"Failed to delete expense")}))}return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&d.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ce.error},children:x}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:S?"block":"grid",gridTemplateColumns:S?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:Bt(K),fontWeight:600},children:Gt(K)})]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&d.jsx($e,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:j.length===0||Object.keys(u).length===0,disabledReason:j.length===0&&Object.keys(u).length===0?"Create accounts and categories first":j.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!S&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:sa,children:"Date"}),d.jsx("div",{style:sa,children:"Payee"}),d.jsx("div",{style:{...sa,textAlign:"center"},children:"Category"}),d.jsx("div",{style:sa,children:"Account"}),d.jsx("div",{style:{...sa,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:sa,children:"Description"}),d.jsx("div",{style:{...sa,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:sa})]})]}),j.length===0&&d.jsx(Gu,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(u).length===0&&d.jsx(Gu,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),C&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(J1,{accounts:j,accountGroups:l,categories:u,categoryGroups:h,payees:O,defaultAccountId:R,defaultDate:gm(e,n),onSubmit:Q,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:S})}),f?.expenses?.slice().sort((J,re)=>(J.date||"").localeCompare(re.date||"")).map((J,re)=>A===J.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(J1,{accounts:j,accountGroups:l,categories:u,categoryGroups:h,payees:O,initialData:J,onSubmit:(B,$,te,ae,ne,de,Se)=>G(J.id,B,$,te,ae,ne,de,Se),onCancel:()=>U(null),onDelete:()=>X(J.id),submitLabel:"Save",isMobile:S})},J.id):d.jsx(Qz,{expense:J,categoryName:lt(J.category_id)?jo:u[J.category_id]?.name||"Unknown Category",accountName:nt(J.account_id)?ja:o[J.account_id]?.nickname||"Unknown Account",accountGroupName:nt(J.account_id)?void 0:o[J.account_id]?.account_group_id?l[o[J.account_id].account_group_id]?.name:void 0,onEdit:()=>{J.payee||`${J.amount}`,U(J.id)},onDelete:()=>X(J.id),isMobile:S,isEvenRow:re%2===0},J.id)),(!f?.expenses||f.expenses.length===0)&&!C&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const Kz={background:ce.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},Yz={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},Xz={background:"transparent",border:`1px solid ${ce.errorBorder}`,color:ce.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function eS({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:i,defaultDate:o,onSubmit:l,onCancel:u,onDelete:h,submitLabel:f}){const{isWide:p}=kT(),g=new Date().toISOString().split("T")[0],[_,b]=k.useState(i?.date||o||g),[S,x]=k.useState(i?.amount?.toString()||""),[E,C]=k.useState(i?.from_account_id||$t),[T,A]=k.useState(i?.to_account_id||$t),[U,F]=k.useState(i?.from_category_id||Kt),[H,O]=k.useState(i?.to_category_id||Kt),[D,P]=k.useState(i?.description||""),[L,q]=k.useState(i?.cleared||!1),[j,M]=k.useState(null),R=U===Kt,K=H===Kt,Q=E===$t,G=T===$t;function X(){return R&&K&&(Q&&G)?'A transfer must move between real categories or real accounts  not all "No" options.':Q!==G?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':R!==K?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}X()===null&&j!==null&&M(null);function re(Te){Te.preventDefault();const Ee=parseFloat(S);if(isNaN(Ee)||Ee<=0||!E||!T||!U||!H||!_)return;const pe=X();if(pe){M(pe);return}M(null),l(Ee,E,T,U,H,_,D.trim()||void 0,L)}const B=j?d.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ce.error,marginTop:"0.5rem"},children:j}):null,$=(Te,Ee,pe,Fe)=>d.jsx(Pt,{label:Fe,htmlFor:Te,children:d.jsx(tA,{id:Te,value:Ee,onChange:pe,accounts:t,accountGroups:e,placeholder:ja,required:!0,showNoAccountOption:!0})}),te=(Te,Ee,pe,Fe)=>d.jsx(Pt,{label:Fe,htmlFor:Te,children:d.jsx(eA,{id:Te,value:Ee,onChange:pe,categories:n,categoryGroups:r,placeholder:jo,required:!0,showNoCategoryOption:!0})}),ae=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[d.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),d.jsx(Vr,{id:"transfer-cleared",checked:L,onChange:Te=>q(Te.target.checked)})]}),ne=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),d.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[d.jsx("button",{type:"submit",title:f,style:Kz,children:""}),d.jsx("button",{type:"button",onClick:()=>{u()},title:"Cancel",style:Yz,children:""}),h&&d.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:Xz,children:""})]})]}),de=d.jsxs(Pa,{children:[d.jsx($e,{type:"submit",actionName:f,children:f}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:u,children:"Cancel"}),h&&d.jsx($e,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),Se={fontSize:"0.85rem",padding:"0.5rem"};return p?d.jsx(xi,{actionName:f,onSubmit:re,children:d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[d.jsx(Pt,{label:"Date",htmlFor:"transfer-date",children:d.jsx(Nf,{id:"transfer-date",value:_,onChange:Te=>b(Te.target.value),required:!0,style:Se,autoFocus:!0})}),d.jsx(Pt,{label:"Amount",htmlFor:"transfer-amount",children:d.jsx(bo,{id:"transfer-amount",value:S,onChange:x,placeholder:"$0.00",required:!0})}),te("from-category",U,F,"From Category"),$("from-account",E,C,"From Account"),d.jsx(Pt,{label:"Description",htmlFor:"transfer-description",children:d.jsx(wi,{id:"transfer-description",value:D,onChange:Te=>P(Te.target.value),placeholder:"e.g., Transfer",style:Se})})]}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),d.jsx("div",{}),te("to-category",H,O,"To Category"),$("to-account",T,A,"To Account"),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[ae,ne]})]}),B]})}):d.jsxs(xi,{actionName:f,onSubmit:re,children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[d.jsx(Pt,{label:"Date",htmlFor:"transfer-date",children:d.jsx(Nf,{id:"transfer-date",value:_,onChange:Te=>b(Te.target.value),required:!0,autoFocus:!0})}),d.jsx(Pt,{label:"Amount",htmlFor:"transfer-amount",children:d.jsx(bo,{id:"transfer-amount",value:S,onChange:x,placeholder:"$0.00",required:!0})})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[te("from-category",U,F,"From Cat."),$("from-account",E,C,"From Acct.")]}),d.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[te("to-category",H,O,"To Cat."),$("to-account",T,A,"To Acct.")]})]}),d.jsx(Pt,{label:"Description (optional)",htmlFor:"transfer-description",children:d.jsx(wi,{id:"transfer-description",value:D,onChange:Te=>P(Te.target.value),placeholder:"e.g., Transfer to savings"})}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx(Vr,{id:"transfer-cleared-stacked",checked:L,onChange:Te=>q(Te.target.checked)}),d.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),B]}),de]})}function Zz({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:i,fromAccountGroupName:o,toAccountGroupName:l,isFromCategoryNo:u,isToCategoryNo:h,isFromAccountNo:f,isToAccountNo:p,onEdit:g,onDelete:_,isMobile:b,isEvenRow:S}){const x=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",E=S?"transparent":"rgba(255,255,255,0.04)";if(b)return d.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:E,cursor:"pointer",transition:"background 0.15s"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:x}),d.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Je(t.amount)}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:ce.success},title:"Cleared",children:""})]})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx("span",{style:u?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),f?d.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):d.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&d.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),d.jsx("span",{children:r})]})]}),d.jsx("span",{style:{opacity:.5},children:""}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?d.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:i}):d.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[l&&d.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:l}),d.jsx("span",{children:i})]})]})]}),t.description&&d.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const C={padding:"0.6rem 0.5rem",background:E,display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{display:"contents"},children:[d.jsx("div",{style:{...C,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:x})}),d.jsx("div",{style:{...C,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Je(t.amount)}),d.jsx("div",{style:{...C,justifyContent:"center"},children:d.jsx("span",{style:u?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...C,overflow:"hidden"},children:f?d.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&d.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),d.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),d.jsx("div",{style:{...C,justifyContent:"center",fontSize:"1rem"},children:d.jsx("span",{style:{opacity:.5},children:""})}),d.jsx("div",{style:{...C,justifyContent:"center"},children:d.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),d.jsx("div",{style:{...C,overflow:"hidden"},children:p?d.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:i}):d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[l&&d.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),d.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i})]})}),d.jsx("div",{style:{...C,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsx("div",{style:{...C,justifyContent:"center",color:t.cleared?ce.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...C,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:_,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Os={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Jz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ze(),{accounts:o,accountGroups:l,categories:u,categoryGroups:h}=An(),{month:f,isLoading:p}=Ei(t,e,n),{addTransfer:g}=e3(),{updateTransfer:_}=n3(),{deleteTransfer:b}=r3(),S=qs(),[x,E]=k.useState(null),[C,T]=k.useState(!1),[A,U]=k.useState(null);function F(j){const M=j.account_group_id?l[j.account_group_id]:void 0;return M&&M.is_active!==null?M.is_active:j.is_active!==!1}function H(j){const M=j.account_group_id?l[j.account_group_id]:void 0;return M&&M.on_budget!==null?M.on_budget:j.on_budget!==!1}const O=Object.entries(o).filter(([,j])=>F(j)&&H(j));function D(j,M,R,K,Q,G,X,J){if(!t)return;E(null),T(!1);const{year:re,month:B}=ym(G);(re!==e||B!==n)&&(r(re),i(B)),g(t,re,B,j,M,R,K,Q,G,X,J).catch($=>{E($ instanceof Error?$.message:"Failed to add transfer")})}function P(j,M,R,K,Q,G,X,J,re){t&&(E(null),U(null),_(t,e,n,j,M,R,K,Q,G,X,J,re).catch(B=>{E(B instanceof Error?B.message:"Failed to update transfer")}))}function L(j){t&&confirm("Are you sure you want to delete this transfer?")&&(E(null),b(t,e,n,j).catch(M=>{E(M instanceof Error?M.message:"Failed to delete transfer")}))}const q=O.length>=1&&Object.keys(u).length>=1;return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&d.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ce.error},children:x}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:S?"block":"grid",gridTemplateColumns:S?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&d.jsx($e,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!q,disabledReason:O.length===0&&Object.keys(u).length===0?"Create accounts and categories first":O.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!S&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Os,children:"Date"}),d.jsx("div",{style:{...Os,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:{...Os,textAlign:"center"},children:"From Cat"}),d.jsx("div",{style:Os,children:"From Acct"}),d.jsx("div",{style:Os}),d.jsx("div",{style:{...Os,textAlign:"center"},children:"To Cat"}),d.jsx("div",{style:Os,children:"To Acct"}),d.jsx("div",{style:Os,children:"Description"}),d.jsx("div",{style:{...Os,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:Os})]})]}),!q&&d.jsx(Gu,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(eS,{accounts:O,accountGroups:l,categories:u,categoryGroups:h,defaultDate:gm(e,n),onSubmit:D,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),f?.transfers?.slice().sort((j,M)=>(j.date||"").localeCompare(M.date||"")).map((j,M)=>A===j.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(eS,{accounts:O,accountGroups:l,categories:u,categoryGroups:h,initialData:j,onSubmit:(R,K,Q,G,X,J,re,B)=>P(j.id,R,K,Q,G,X,J,re,B),onCancel:()=>U(null),onDelete:()=>L(j.id),submitLabel:"Save"})},j.id):d.jsx(Zz,{transfer:j,fromCategoryName:lt(j.from_category_id)?jo:u[j.from_category_id]?.name||"Unknown",toCategoryName:lt(j.to_category_id)?jo:u[j.to_category_id]?.name||"Unknown",fromAccountName:nt(j.from_account_id)?ja:o[j.from_account_id]?.nickname||"Unknown",toAccountName:nt(j.to_account_id)?ja:o[j.to_account_id]?.nickname||"Unknown",fromAccountGroupName:nt(j.from_account_id)?void 0:o[j.from_account_id]?.account_group_id?l[o[j.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:nt(j.to_account_id)?void 0:o[j.to_account_id]?.account_group_id?l[o[j.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:lt(j.from_category_id),isToCategoryNo:lt(j.to_category_id),isFromAccountNo:nt(j.from_account_id),isToAccountNo:nt(j.to_account_id),onEdit:()=>{j.description||`${j.amount}`,U(j.id)},onDelete:()=>L(j.id),isMobile:S,isEvenRow:M%2===0},j.id)),(!f?.transfers||f.transfers.length===0)&&!C&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function tS({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:u,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function _(b){h(b.amount,b.accountId,b.categoryId,b.date,b.payee,b.description,b.cleared)}return d.jsx(l_,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:u,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:_,onCancel:f,onDelete:p})}function eB({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:u}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=u?"transparent":"rgba(255,255,255,0.04)";if(l)return d.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:ce.success},title:"Cleared",children:""})]}),d.jsx("span",{style:{fontWeight:600,color:Bt(t.amount),fontFamily:"monospace"},children:Gt(t.amount)})]}),d.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[d.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),d.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:f})]})]});const g={padding:"0.6rem 0.5rem",background:p,display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{display:"contents"},children:[d.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:h})}),d.jsx("div",{style:{...g,justifyContent:"center"},children:d.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...g,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),d.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:Bt(t.amount),fontFamily:"monospace"},children:Gt(t.amount)}),d.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?ce.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const mo={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function tB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ze(),{accounts:o,accountGroups:l,categories:u,categoryGroups:h}=An(),{month:f,isLoading:p}=Ei(t,e,n),{addAdjustment:g}=i3(),{updateAdjustment:_}=o3(),{deleteAdjustment:b}=l3(),S=qs(),[x,E]=k.useState(null),[C,T]=k.useState(!1),[A,U]=k.useState(null),O=H0(t,{enabled:C||A!==null}).data||[];function D(R){const K=R.account_group_id?l[R.account_group_id]:void 0;return K&&K.is_active!==null?K.is_active:R.is_active!==!1}function P(R){const K=R.account_group_id?l[R.account_group_id]:void 0;return K&&K.on_budget!==null?K.on_budget:R.on_budget!==!1}const L=Object.entries(o).filter(([,R])=>D(R)&&P(R));function q(R,K,Q,G,X,J,re){if(!t)return;E(null),T(!1);const{year:B,month:$}=ym(G);(B!==e||$!==n)&&(r(B),i($)),g(t,B,$,R,K,Q,G,X,J,re).catch(te=>{E(te instanceof Error?te.message:"Failed to add adjustment")})}function j(R,K,Q,G,X,J,re,B){t&&(E(null),U(null),_(t,e,n,R,K,Q,G,X,J,re,B).catch($=>{E($ instanceof Error?$.message:"Failed to update adjustment")}))}function M(R){t&&confirm("Are you sure you want to delete this adjustment?")&&(E(null),b(t,e,n,R).catch(K=>{E(K instanceof Error?K.message:"Failed to delete adjustment")}))}return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&d.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ce.error},children:x}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:S?"block":"grid",gridTemplateColumns:S?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&d.jsx($e,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(u).length===0&&L.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!S&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:mo,children:"Date"}),d.jsx("div",{style:{...mo,textAlign:"center"},children:"Category"}),d.jsx("div",{style:mo,children:"Account"}),d.jsx("div",{style:{...mo,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:mo,children:"Description"}),d.jsx("div",{style:{...mo,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:mo})]})]}),L.length===0&&Object.keys(u).length===0&&d.jsx(Gu,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(tS,{accounts:L,accountGroups:l,categories:u,categoryGroups:h,payees:O,defaultDate:gm(e,n),onSubmit:q,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),f?.adjustments?.slice().sort((R,K)=>(R.date||"").localeCompare(K.date||"")).map((R,K)=>A===R.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(tS,{accounts:L,accountGroups:l,categories:u,categoryGroups:h,payees:O,initialData:R,onSubmit:(Q,G,X,J,re,B,$)=>j(R.id,Q,G,X,J,re,B,$),onCancel:()=>U(null),onDelete:()=>M(R.id),submitLabel:"Save"})},R.id):d.jsx(eB,{adjustment:R,categoryName:lt(R.category_id)?jo:u[R.category_id]?.name||"Unknown Category",accountName:nt(R.account_id)?ja:o[R.account_id]?.nickname||"Unknown Account",accountGroupName:nt(R.account_id)?void 0:o[R.account_id]?.account_group_id?l[o[R.account_id].account_group_id]?.name:void 0,onEdit:()=>{R.description||`${R.amount}`,U(R.id)},onDelete:()=>M(R.id),isMobile:S,isEvenRow:K%2===0},R.id)),(!f?.adjustments||f.adjustments.length===0)&&!C&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function nB({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:i}=sr(),{selectedBudgetId:o,currentYear:l,currentMonthNumber:u}=Ze(),{deleteAllocations:h}=IT(),[f,p]=k.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:l,month:u}),e(),n?.()}catch(_){p(_ instanceof Error?_.message:"Failed to delete allocations")}finally{i("allocations-delete")}}};return d.jsxs($s,{isOpen:t,onClose:e,title:"Delete Allocations",children:[f&&d.jsx(Bo,{message:f,onDismiss:()=>p(null)}),d.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),d.jsx($e,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function cA({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:i,draftChangeAmount:o,availableAfterApply:l,currentDraftTotal:u}){const h=t&&u!==void 0?u:i.allocated;return d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?d.jsx("span",{style:{color:Bt(n),fontWeight:600},children:Je(n)}):d.jsxs("span",{style:{color:ce.success,fontWeight:600},children:["+",Je(r)]})]}),d.jsxs("span",{children:[t&&d.jsx("span",{style:{opacity:.6},children:" "}),d.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),d.jsxs("span",{style:{color:gc(t?h:i.allocated),fontWeight:600,...t?is:{}},children:[t?"":"+",Je(t?h:i.allocated)]}),e&&o!==0&&d.jsxs("span",{style:{fontSize:"0.85em",color:o>0?ce.warning:ce.success,marginLeft:"0.25rem"},children:["(",Gt(o),")"]})]}),!t&&d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Spent: "}),d.jsx("span",{style:{color:pc(i.spent),fontWeight:600},children:za(i.spent)})]}),d.jsxs("span",{children:[t&&d.jsx("span",{style:{opacity:.6},children:"= "}),d.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?d.jsx("span",{style:{color:Bt(l),fontWeight:600,...is},children:Je(l)}):d.jsx("span",{style:{color:Bt(i.allocated+i.spent),fontWeight:600},children:Je(i.allocated+i.spent)})]})]})}function rB({totals:t}){return d.jsxs(d.Fragment,{children:[d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Start: "}),d.jsx("span",{style:{color:Bt(t.start),fontWeight:600},children:Je(t.start)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Inc: "}),d.jsxs("span",{style:{color:ce.success,fontWeight:600},children:["+",Je(t.income)]})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Exp: "}),d.jsx("span",{style:{color:pc(t.expenses),fontWeight:600},children:za(t.expenses)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"End: "}),d.jsx("span",{style:{color:Bt(t.end),fontWeight:600},children:Je(t.end)})]})]})}function c_({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:i,onEdit:o,onCancel:l,onDelete:u}){return d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&d.jsxs(d.Fragment,{children:[d.jsx($e,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),d.jsx($e,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&d.jsx($e,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&d.jsxs(d.Fragment,{children:[d.jsx($e,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),d.jsx($e,{actionName:"Cancel Edit Allocations",onClick:l,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),d.jsx($e,{actionName:"Open Delete Allocations Modal",onClick:u,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:ce.error},children:""})]})]})}function nS(t){return t===0?ce.zero:t>0?ce.success:ce.error}function sB({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,projectedAllTime:l}){const u=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=u?t.default_monthly_amount/100*r:0,f=u?h.toFixed(2):n,p=i&&!u,g=i?l:t.balance??0,_=t.balance??0,b=_<0,S=b?Math.abs(_):0,x=u?h:parseFloat(n)||0,E=b?Math.min(x,S):0,C=b?Math.max(0,x-S):0,T=b&&x>0&&C>0;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx("span",{style:{fontWeight:500},children:t.name})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),d.jsx("span",{style:{color:Vn(e.start_balance)},children:as(e.start_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?d.jsxs(d.Fragment,{children:[d.jsx("input",{type:"text",inputMode:"decimal",value:f?`$${f}`:"",onChange:A=>{const U=A.target.value.replace(/[^\d.]/g,"");o(U)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),b&&x>0&&d.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[d.jsxs("span",{style:{color:ce.debt,display:"block"},children:[Je(E),"  debt"]}),T&&d.jsxs("span",{style:{color:ce.success,display:"block"},children:[Je(C),"  balance"]})]})]}):d.jsx("span",{style:{color:gc(e.allocated)},children:Gt(e.allocated)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),d.jsx("span",{style:{color:pc(e.spent)},children:za(e.spent)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),d.jsx("span",{style:{color:Vn(e.end_balance),...i&&!u?is:{}},children:as(e.end_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:i?"Proj. All-Time":"All-Time"}),d.jsx("span",{style:{color:Vn(g),...i&&!u?is:{}},children:as(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&d.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&d.jsxs("span",{style:{color:nS(e.transfers)},children:[Gt(e.transfers)," transfers"]}),e.adjustments!==0&&d.jsxs("span",{style:{color:nS(e.adjustments)},children:[Gt(e.adjustments)," adjust"]})]}),i&&u&&d.jsx("div",{style:{marginTop:"0.5rem"},children:d.jsxs("span",{style:{fontSize:"0.8rem"},children:[d.jsxs("span",{style:{opacity:.6},children:[Je(r),"  "]}),d.jsxs("span",{style:{color:ce.success},children:[t.default_monthly_amount,"%"]}),d.jsx("span",{style:{opacity:.6},children:" = "}),d.jsx("span",{style:{color:ce.success},children:Je(h)})]})})]})}function Bf(t){return t===0?ce.zero:t>0?ce.success:ce.error}function rS({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:i,savedAllocations:o,previousMonthIncome:l,isDraftMode:u,onAllocationChange:h,isMobile:f,isUngrouped:p,getAllocationAmount:g}){const _={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Of,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},b=n.allocated+n.spent+n.transfers+n.adjustments,S=e.reduce((x,[E,C])=>{const T=C.balance??0;if(u){const A=g(E,C),U=o[E]??0,F=A-U;return x+T+F}return x+T},0);return d.jsxs("div",{style:{display:"contents"},children:[!f&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{..._,paddingLeft:"0.5rem",opacity:p?.7:1},children:[d.jsx("span",{children:t}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),d.jsx("div",{style:{..._,justifyContent:"flex-end",color:Vn(n.start)},children:Sn.showGroupTotals}),d.jsx("div",{style:{..._,justifyContent:u?"center":"flex-end",color:gc(n.allocated)},children:Sn.showGroupTotals}),d.jsx("div",{style:{..._,justifyContent:"flex-end",color:pc(n.spent)},children:Sn.showGroupTotals}),d.jsx("div",{style:{..._,justifyContent:"flex-end",color:Bf(n.transfers)},children:Sn.showGroupTotals}),d.jsx("div",{style:{..._,justifyContent:"flex-end",color:Bf(n.adjustments)},children:Sn.showGroupTotals}),d.jsx("div",{style:{..._,justifyContent:"flex-end",color:Vn(b)},children:Sn.showGroupTotals}),d.jsx("div",{style:{..._,justifyContent:"flex-end",color:Vn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:Sn.showGroupTotals}),d.jsx("div",{style:{..._,justifyContent:"flex-end",color:Vn(S)},children:Sn.showGroupTotals})]}),!u&&f&&d.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Of,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:p?.7:1},children:[t,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Sn.showGroupTotals]}),e.map(([x,E],C)=>{const T=r(x);if(!T)return null;const A=E.balance??0;let U=A;if(u){const F=g(x,E),H=o[x]??0,O=F-H;U=A+O}return f?d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(sB,{category:E,balance:T,localAllocation:i[x]||"",previousMonthIncome:l,isDraftMode:u,onAllocationChange:F=>h(x,F),projectedAllTime:U})},x):d.jsx(iB,{category:E,balance:T,localAllocation:i[x]||"",previousMonthIncome:l,isDraftMode:u,onAllocationChange:F=>h(x,F),allTimeBalance:U,isEvenRow:C%2===0},x)})]})}function iB({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,allTimeBalance:l,isEvenRow:u}){const h=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,f=h?t.default_monthly_amount/100*r:0,p=h?f.toFixed(2):n,g=t.balance??0,_=g<0,b=_?Math.abs(g):0,S=h?f:parseFloat(n)||0,x=_?Math.min(S,b):0,E=_?Math.max(0,S-b):0,C=_&&S>0&&E>0,T=u?"transparent":"rgba(255,255,255,0.04)",A={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",background:T,display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},U=e.allocated+e.spent+e.transfers+e.adjustments;return d.jsxs("div",{style:{display:"contents"},children:[d.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",background:T,display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),d.jsx("div",{style:{...A,justifyContent:"flex-end",color:Vn(e.start_balance)},children:as(e.start_balance)}),i?d.jsx("div",{style:{...A,justifyContent:"center",flexDirection:"column",gap:"0.1rem",paddingTop:"0.35rem",paddingBottom:"0.35rem"},children:h?d.jsxs("span",{style:{fontSize:"0.85rem"},children:[d.jsxs("span",{style:{color:ce.success},children:[t.default_monthly_amount,"%"]}),d.jsx("span",{style:{opacity:.5},children:" = "}),d.jsx("span",{style:{color:ce.success},children:Je(f)})]}):d.jsxs(d.Fragment,{children:[d.jsx("input",{type:"text",inputMode:"decimal",value:p?`$${p}`:"",onChange:F=>{const H=F.target.value.replace(/[^\d.]/g,"");o(H)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),_&&S>0&&d.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[d.jsxs("span",{style:{color:ce.debt},children:[Je(x),"  debt"]}),C&&d.jsxs("span",{style:{color:ce.success},children:[Je(E),"  bal"]})]})]})}):(()=>{const F=e.start_balance<0,H=F?Math.abs(e.start_balance):0,O=F?Math.min(e.allocated,H):0,D=F?Math.max(0,e.allocated-H):0,P=F&&e.allocated>0;return d.jsxs("div",{style:{...A,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:gc(e.allocated)},children:[d.jsxs("span",{children:["+",Je(e.allocated)]}),P&&d.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsxs("span",{style:{color:ce.debt},children:[Je(O),"  debt"]}),D>0&&d.jsxs("span",{style:{color:ce.success},children:[Je(D),"  bal"]})]})]})})(),d.jsx("div",{style:{...A,justifyContent:"flex-end",color:pc(e.spent)},children:za(e.spent)}),d.jsx("div",{style:{...A,justifyContent:"flex-end",color:Bf(e.transfers)},children:Gt(e.transfers)}),d.jsx("div",{style:{...A,justifyContent:"flex-end",color:Bf(e.adjustments)},children:Gt(e.adjustments)}),d.jsx("div",{style:{...A,justifyContent:"flex-end",color:Vn(U),...i&&!h?is:{}},children:Gt(U)}),d.jsx("div",{style:{...A,justifyContent:"flex-end",fontWeight:600,color:Vn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...i&&!h?is:{}},children:as(e.end_balance)}),d.jsx("div",{style:{...A,justifyContent:"flex-end",color:Vn(l),...i&&!h?is:{}},children:as(l)})]})}function aB(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,i])=>n||!i.is_hidden).reduce((i,[o,l])=>{const u=l.category_group_id||"ungrouped";return i[u]||(i[u]=[]),i[u].push([o,l]),i},{});return Object.keys(r).forEach(i=>{r[i].sort((o,l)=>o[1].sort_order-l[1].sort_order)}),r}function oB(t,e,n,r,i){const o={};t?.category_balances&&t.category_balances.forEach(u=>{o[u.category_id]=u});const l={};return Object.entries(e).forEach(([u,h])=>{const f=o[u],p=f?.start_balance??0,g=f?.spent??0;let _=0;n?_=i(u,h):r&&f&&(_=f.allocated);let b=0;t?.transfers&&t.transfers.forEach(x=>{x.to_category_id===u&&(b+=x.amount),x.from_category_id===u&&(b-=x.amount)});let S=0;t?.adjustments&&(S=t.adjustments.filter(x=>x.category_id===u).reduce((x,E)=>x+E.amount,0)),l[u]={category_id:u,start_balance:p,allocated:_,spent:g,transfers:b,adjustments:S,end_balance:p+_+g+b+S}}),l}function lB(t,e){const n={};t?.account_balances&&t.account_balances.forEach(i=>{n[i.account_id]=i});const r={};return Object.entries(e).forEach(([i,o])=>{const u=n[i]?.start_balance??o.balance;let h=0;t?.income&&(h=t.income.filter(b=>b.account_id===i).reduce((b,S)=>b+S.amount,0));let f=0;t?.expenses&&(f=t.expenses.filter(b=>b.account_id===i).reduce((b,S)=>b+S.amount,0));let p=0;t?.transfers&&t.transfers.forEach(b=>{b.to_account_id===i&&(p+=b.amount),b.from_account_id===i&&(p-=b.amount)});let g=0;t?.adjustments&&(g=t.adjustments.filter(b=>b.account_id===i).reduce((b,S)=>b+S.amount,0));const _=h+f+p+g;r[i]={account_id:i,start_balance:u,income:h,expenses:f,transfers:p,adjustments:g,net_change:_,end_balance:u+_}}),r}function cB(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function uB(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+n.end_balance}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function sS(t){return t===0?ce.zero:t>0?ce.success:ce.error}function dB({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:i,onApply:o,onEdit:l,onCancel:u,onDelete:h}){const f={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...f,gap:"0.75rem"},children:["Grand Totals",!t&&d.jsx(c_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:i,onApply:o,onEdit:l,onCancel:u,onDelete:h})]}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:Vn(n.start)},children:as(n.start)}),d.jsxs("div",{style:{...f,justifyContent:t?"center":"flex-end",color:gc(n.allocated),...t?is:{}},children:["+",Je(n.allocated)]}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:pc(n.spent)},children:za(n.spent)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:sS(n.transfers)},children:Gt(n.transfers)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:sS(n.adjustments)},children:Gt(n.adjustments)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:Vn(p),...t?is:{}},children:Gt(p)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:Vn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...t?is:{}},children:as(n.end)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:Vn(r),...t?is:{}},children:as(r)})]})}function hB({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l,onSave:u,onApply:h,onEdit:f,onCancel:p,onDelete:g}){return d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[d.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),d.jsx(cA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l}),d.jsx(c_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:u,onApply:h,onEdit:f,onCancel:p,onDelete:g})]})}const ui={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function fB(t){if(!t)return"";switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}}function mB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ze(),{categories:r,categoryGroups:i,monthMap:o}=An(),{month:l}=Ei(t,e,n),u=qs(),[h,f]=k.useState(null);dd({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:$=>f($),logPrefix:"[MonthCategories]"});const[p,g]=k.useState(!1),{localAllocations:_,isEditingAppliedAllocations:b,error:S,availableNow:x,currentDraftTotal:E,draftChangeAmount:C,availableAfterApply:T,previousMonthIncome:A,currentMonthIncome:U,allocationsFinalized:F,getAllocationAmount:H,handleAllocationChange:O,resetAllocationsToSaved:D,handleSaveAllocations:P,handleFinalizeAllocations:L,setIsEditingAppliedAllocations:q,setError:j}=w3(),M=[...i].sort(($,te)=>$.sort_order-te.sort_order),R=k.useMemo(()=>aB(r),[r]),K=!F||b,Q=k.useMemo(()=>oB(l,r,K,F,H),[l,r,K,F,H]),G=$=>Q[$],X=k.useMemo(()=>uB(Q),[Q]),J=k.useMemo(()=>{const $={};if(l?.category_balances)for(const te of l.category_balances)$[te.category_id]=te.allocated;return $},[l]),re=k.useMemo(()=>Object.entries(r).reduce(($,[te,ae])=>{const ne=ae.balance??0;if(K){const de=H(te,ae),Se=J[te]??0,Te=de-Se;return $+ne+Te}return $+ne},0),[r,K,H,J]),B={onSave:P,onApply:L,onEdit:()=>q(!0),onCancel:D,onDelete:()=>g(!0)};return d.jsxs(d.Fragment,{children:[h&&d.jsxs(i_,{message:fB(h),spinnerColor:"#22c55e",children:[d.jsx(oA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),d.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&d.jsx(zf,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&d.jsx(zf,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),d.jsx(lA,{percent:h.percentComplete})]}),S&&d.jsx(Bo,{message:S,onDismiss:()=>j(null)}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:u?"1fr":K?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:u?"block":"grid",gridTemplateColumns:u?void 0:"subgrid"},children:[K&&d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:u?"column":"row",flexWrap:"wrap",alignItems:u?"stretch":"center",gap:u?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:u?"0.5rem":"0.25rem"},children:[d.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:u?void 0:1,alignItems:"center"},children:d.jsx(cA,{isDraftMode:K,isEditingAppliedAllocations:b,availableNow:x,currentMonthIncome:U,balanceTotals:X,draftChangeAmount:C,availableAfterApply:T,currentDraftTotal:E})}),d.jsx(c_,{isDraftMode:K,isEditingAppliedAllocations:b,allocationsFinalized:F,...B})]}),!u&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:ui,children:"Category"}),d.jsx("div",{style:{...ui,textAlign:"right"},children:"Start"}),d.jsx("div",{style:{...ui,textAlign:K?"center":"right"},children:"Allocated"}),d.jsx("div",{style:{...ui,textAlign:"right"},children:"Spent"}),d.jsx("div",{style:{...ui,textAlign:"right"},children:"Transfers"}),d.jsx("div",{style:{...ui,textAlign:"right"},children:"Adjust"}),d.jsx("div",{style:{...ui,textAlign:"right"},children:"Net Change"}),d.jsx("div",{style:{...ui,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),d.jsx("div",{style:{...ui,textAlign:"right"},children:"All-Time"})]}),!u&&d.jsx(dB,{isDraftMode:K,allocationsFinalized:F,balanceTotals:X,grandAllTime:re,...B}),!K&&u&&d.jsx(hB,{allocationsFinalized:F,availableNow:x,currentMonthIncome:U,balanceTotals:X,draftChangeAmount:C,availableAfterApply:T,currentDraftTotal:E,...B})]}),Object.keys(r).length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",d.jsx(Cn,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),M.map($=>{const te=R[$.id]||[];if(te.length===0)return null;const ae=te.reduce((ne,[de])=>{const Se=G(de);return Se?{start:ne.start+Se.start_balance,allocated:ne.allocated+Se.allocated,spent:ne.spent+Se.spent,transfers:ne.transfers+Se.transfers,adjustments:ne.adjustments+Se.adjustments,end:ne.end+Se.end_balance}:ne},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return d.jsx(rS,{name:$.name,categories:te,groupTotals:ae,getCategoryBalance:G,localAllocations:_,savedAllocations:J,previousMonthIncome:A,isDraftMode:K,onAllocationChange:O,isMobile:u,getAllocationAmount:H},$.id)}),R[nn]?.length>0&&(()=>{const $=R[nn],te=$.reduce((ae,[ne])=>{const de=G(ne);return de?{start:ae.start+de.start_balance,allocated:ae.allocated+de.allocated,spent:ae.spent+de.spent,transfers:ae.transfers+de.transfers,adjustments:ae.adjustments+de.adjustments,end:ae.end+de.end_balance}:ae},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return d.jsx(rS,{name:"Uncategorized",categories:$,groupTotals:te,getCategoryBalance:G,localAllocations:_,savedAllocations:J,previousMonthIncome:A,isDraftMode:K,onAllocationChange:O,isMobile:u,isUngrouped:!0,getAllocationAmount:H},nn)})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),d.jsx(nB,{isOpen:p,onClose:()=>g(!1),onDeleted:()=>q(!1)})]})}function uA(t){return t===0?ce.zero:t>0?ce.success:ce.error}function dA(t){return t===0?ce.zero:t<0?ce.error:ce.success}function Ul(t){return t===0?ce.zero:t>0?ce.success:ce.error}function iS({name:t,accounts:e,groupTotals:n,accountBalances:r,isMobile:i,isUngrouped:o}){const l={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Of,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return d.jsxs("div",{style:{display:"contents"},children:[!i&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...l,opacity:o?.7:1},children:[d.jsx("span",{children:t}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),d.jsx("div",{style:{...l,justifyContent:"flex-end",color:Bt(n.start)},children:Sn.showGroupTotals}),d.jsx("div",{style:{...l,justifyContent:"flex-end",color:uA(n.income)},children:Sn.showGroupTotals}),d.jsx("div",{style:{...l,justifyContent:"flex-end",color:dA(n.expenses)},children:Sn.showGroupTotals}),d.jsx("div",{style:{...l,justifyContent:"flex-end",color:Ul(n.transfers)},children:Sn.showGroupTotals}),d.jsx("div",{style:{...l,justifyContent:"flex-end",color:Ul(n.adjustments)},children:Sn.showGroupTotals}),d.jsx("div",{style:{...l,justifyContent:"flex-end",color:Ul(n.netChange)},children:Sn.showGroupTotals}),d.jsx("div",{style:{...l,justifyContent:"flex-end",color:Bt(n.end)},children:Sn.showGroupTotals})]}),i&&d.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Of,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:o?.7:1},children:[t,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Sn.showGroupTotals]}),e.map(([u,h],f)=>{const p=r[u];return p?i?d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(gB,{account:h,balance:p})},u):d.jsx(pB,{account:h,balance:p,isEvenRow:f%2===0},u):null})]})}function pB({account:t,balance:e,isEvenRow:n}){const i={padding:"0.5rem 0.5rem",background:n?"transparent":"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{display:"contents"},children:[d.jsx("div",{style:{...i,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),d.jsx("div",{style:{...i,justifyContent:"flex-end",color:Bt(e.start_balance)},children:Je(e.start_balance)}),d.jsxs("div",{style:{...i,justifyContent:"flex-end",color:uA(e.income)},children:["+",Je(e.income)]}),d.jsx("div",{style:{...i,justifyContent:"flex-end",color:dA(e.expenses)},children:za(e.expenses)}),d.jsx("div",{style:{...i,justifyContent:"flex-end",color:Ul(e.transfers)},children:Gt(e.transfers)}),d.jsx("div",{style:{...i,justifyContent:"flex-end",color:Ul(e.adjustments)},children:Gt(e.adjustments)}),d.jsx("div",{style:{...i,justifyContent:"flex-end",color:Ul(e.net_change)},children:Gt(e.net_change)}),d.jsx("div",{style:{...i,justifyContent:"flex-end",fontWeight:600,color:Bt(e.end_balance)},children:Je(e.end_balance)})]})}function gB({account:t,balance:e}){return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx("span",{style:{fontWeight:500},children:t.nickname})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),d.jsx("span",{children:Je(e.start_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),d.jsx("span",{style:{color:Bt(e.net_change)},children:Gt(e.net_change)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),d.jsx("span",{style:{color:Bt(e.end_balance)},children:Je(e.end_balance)})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&d.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&d.jsxs("span",{children:[Gt(e.income)," income"]}),e.expenses!==0&&d.jsxs("span",{children:[za(e.expenses)," expenses"]}),e.transfers!==0&&d.jsxs("span",{children:[Gt(e.transfers)," transfers"]}),e.adjustments!==0&&d.jsxs("span",{children:[Gt(e.adjustments)," adjust"]})]})]})}const ia={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function yB(t){return t===0?ce.zero:t>0?ce.success:ce.error}function _B(t){return t===0?ce.zero:t<0?ce.error:ce.success}function Jg(t){return t===0?ce.zero:t>0?ce.success:ce.error}function bB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ze(),{accounts:r,accountGroups:i,monthMap:o}=An(),{month:l}=Ei(t,e,n),u=qs(),[h,f]=k.useState(null);dd({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:T=>f(T),logPrefix:"[MonthAccounts]"});const p=k.useMemo(()=>Object.entries(i).map(([T,A])=>({id:T,...A})).sort((T,A)=>T.sort_order-A.sort_order),[i]),g=k.useMemo(()=>{const T={};return Object.entries(r).filter(([,A])=>!A.is_hidden).forEach(([A,U])=>{const F=U.account_group_id||Xt;T[F]||(T[F]=[]),T[F].push([A,U])}),Object.keys(T).forEach(A=>{T[A].sort((U,F)=>U[1].sort_order-F[1].sort_order)}),T},[r]),_=k.useMemo(()=>lB(l,r),[l,r]),b=k.useMemo(()=>cB(_),[_]),S=b.income+b.expenses,E={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600},C=()=>{if(!h)return"";switch(h.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return h.currentMonth?`Recalculating ${h.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}};return d.jsxs(d.Fragment,{children:[h&&d.jsxs(i_,{message:C(),spinnerColor:"#22c55e",children:[d.jsx(oA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),d.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&d.jsx(zf,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&d.jsx(zf,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),d.jsx(lA,{percent:h.percentComplete})]}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:u?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:u?"block":"grid",gridTemplateColumns:u?void 0:"subgrid"},children:[!u&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:ia,children:"Account"}),d.jsx("div",{style:{...ia,textAlign:"right"},children:"Start"}),d.jsx("div",{style:{...ia,textAlign:"right"},children:"Income"}),d.jsx("div",{style:{...ia,textAlign:"right"},children:"Expenses"}),d.jsx("div",{style:{...ia,textAlign:"right"},children:"Transfers"}),d.jsx("div",{style:{...ia,textAlign:"right"},children:"Adjust"}),d.jsx("div",{style:{...ia,textAlign:"right"},children:"Net Change"}),d.jsx("div",{style:{...ia,textAlign:"right"},children:"End"})]}),u?d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[d.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),d.jsx(rB,{totals:b})]}):d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{...E},children:"Grand Totals"}),d.jsx("div",{style:{...E,justifyContent:"flex-end",color:Bt(b.start)},children:Je(b.start)}),d.jsxs("div",{style:{...E,justifyContent:"flex-end",color:yB(b.income)},children:["+",Je(b.income)]}),d.jsx("div",{style:{...E,justifyContent:"flex-end",color:_B(b.expenses)},children:za(b.expenses)}),d.jsx("div",{style:{...E,justifyContent:"flex-end",color:Jg(b.transfers)},children:Gt(b.transfers)}),d.jsx("div",{style:{...E,justifyContent:"flex-end",color:Jg(b.adjustments)},children:Gt(b.adjustments)}),d.jsx("div",{style:{...E,justifyContent:"flex-end",color:Jg(S)},children:Gt(S)}),d.jsx("div",{style:{...E,justifyContent:"flex-end",color:Bt(b.end)},children:Je(b.end)})]})]}),Object.keys(r).length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",d.jsx(Cn,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),p.map(T=>{const A=g[T.id]||[];if(A.length===0)return null;const U=A.reduce((F,[H])=>{const O=_[H];return O?{start:F.start+O.start_balance,income:F.income+O.income,expenses:F.expenses+O.expenses,transfers:F.transfers+O.transfers,adjustments:F.adjustments+O.adjustments,netChange:F.netChange+O.net_change,end:F.end+O.end_balance}:F},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return d.jsx(iS,{name:T.name,accounts:A,groupTotals:U,accountBalances:_,isMobile:u},T.id)}),g[Xt]?.length>0&&(()=>{const T=g[Xt],A=T.reduce((U,[F])=>{const H=_[F];return H?{start:U.start+H.start_balance,income:U.income+H.income,expenses:U.expenses+H.expenses,transfers:U.transfers+H.transfers,adjustments:U.adjustments+H.adjustments,netChange:U.netChange+H.net_change,end:U.end+H.end_balance}:U},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return d.jsx(iS,{name:"Ungrouped",accounts:T,groupTotals:A,accountBalances:_,isMobile:u,isUngrouped:!0},Xt)})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const vB=["income","categories","accounts","spend","transfers","adjustments"];function aS(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&vB.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function xB(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function oS(){const t=$2(),e=Ku(),[n,r]=RS(),{addLoadingHold:i,removeLoadingHold:o}=sr(),{selectedBudgetId:l,setSelectedBudgetId:u,currentYear:h,currentMonthNumber:f,lastActiveTab:p,setCurrentYear:g,setCurrentMonthNumber:_,setLastActiveTab:b,setPageTitle:S,goToPreviousMonth:x,goToNextMonth:E,hasPendingInvites:C,needsFirstBudget:T,initialDataLoadComplete:A}=Ze(),{budget:U,isLoading:F,monthMap:H}=An(),O=!F,[D,P]=k.useState(!1);k.useEffect(()=>(!O||!A?i("budget-data","Loading budget data..."):o("budget-data"),()=>o("budget-data")),[O,A,i,o]);const L=k.useRef(!1),q=n.get("error"),[j,M]=k.useState(q);k.useEffect(()=>{q&&(n.delete("error"),r(n,{replace:!0}))},[q,n,r]);const[R,K]=k.useState(()=>{const{tab:te}=aS(t);return te??p}),Q=te=>{K(te),b(te)};k.useEffect(()=>{if(L.current)return;const{year:te,month:ae}=aS(t);te&&g(te),ae&&_(ae),L.current=!0},[t,g,_]),k.useEffect(()=>{if(!L.current)return;const te=`/budget/${h}/${f}/${R}`,ae=`/budget/${t.year}/${t.month}/${t.tab}`;te!==ae&&e(te,{replace:!0})},[h,f,R,e,t]);const{month:G,error:X,isLoading:J}=Ei(O?l:null,h,f);k.useEffect(()=>{if(!X||D)return;const te=X.message||"";if(te.includes("Budget")&&te.includes("does not exist")){queueMicrotask(()=>{u(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(te.includes("months in the past")||te.includes("Refusing to create month"))&&queueMicrotask(()=>{i("month-redirect","Redirecting to current month..."),P(!0);const{year:ae,month:ne}=xB();M(`Cannot create month ${h}/${f} - it's too far in the past. Redirected to current month.`),g(ae),_(ne)})},[X,D,h,f,g,_,i,u,e]),k.useEffect(()=>{D&&G&&!J&&queueMicrotask(()=>{P(!1),o("month-redirect")})},[D,G,J,o]),k.useLayoutEffect(()=>{S(U?.name||"Budget")},[U?.name,S]);const{setCurrentViewingDocument:re}=Ze();if(k.useEffect(()=>(U&&h&&f&&re({type:"month",year:h,month:f}),()=>{re({type:null})}),[U,h,f,re]),k.useEffect(()=>{if(O&&!D){if(!U&&!l){e("/budget/my-budgets",{replace:!0});return}if(!U&&C){e("/budget/my-budgets",{replace:!0});return}if(T){e("/budget/my-budgets",{replace:!0});return}}},[O,D,U,l,C,T,e]),D3(l,h,f),dd({budgetId:l,year:h,month:f,monthMap:H,additionalCondition:O&&!!U,logPrefix:"[Budget]"}),!O||!A||D||!U)return null;function B(){M(null),x()}function $(){M(null),E()}return d.jsxs(d.Fragment,{children:[j&&d.jsx(Bo,{message:j,onDismiss:()=>M(null)}),d.jsx(Fz,{onPreviousMonth:B,onNextMonth:$}),d.jsx(Rz,{activeTab:R,setActiveTab:Q,allocationsFinalized:G?.are_allocations_finalized}),R==="income"&&d.jsx(Hz,{},`${h}-${f}`),R==="categories"&&d.jsx(mB,{},`${h}-${f}`),R==="accounts"&&d.jsx(bB,{},`${h}-${f}`),R==="spend"&&d.jsx(Wz,{},`${h}-${f}`),R==="transfers"&&d.jsx(Jz,{},`${h}-${f}`),R==="adjustments"&&d.jsx(tB,{},`${h}-${f}`)]})}function wB(){const{setPageTitle:t}=Ze();return k.useLayoutEffect(()=>{t("Analytics")},[t]),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[d.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),d.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),d.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),d.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),d.jsx(Cn,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:ce.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function SB(){const t=Ht();return{createBudget:Gn({mutationFn:async({name:n,userId:r,userEmail:i})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString(),u={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:i,accounts:{},account_groups:{[Xt]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},categories:{},category_groups:[{id:nn,name:"Uncategorized",sort_order:0}],total_available:0,is_needs_recalculation:!1,month_map:{},created_at:l,updated_at:l};return await qn("budgets",o,u,"creating new budget document"),await qn("users",r,{uid:r,email:i,budget_ids:Uu(o),updated_at:l},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...u}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:ke.user(r)}),t.invalidateQueries({queryKey:ke.accessibleBudgets(r)})}})}}function EB(){const t=Ht();return{acceptInvite:Gn({mutationFn:async({budgetId:n,userId:r})=>{const i=new Date().toISOString(),{exists:o,data:l}=await At("budgets",n,"validating user was invited to this budget");if(!o||!l)throw new Error("Budget not found");if(!l.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(l.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await qn("users",r,{uid:r,budget_ids:Uu(n),updated_at:i},"adding accepted budget to user's budget list",{merge:!0}),await qn("budgets",n,{accepted_user_ids:Uu(r),updated_at:i},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:ke.user(r)}),t.invalidateQueries({queryKey:ke.accessibleBudgets(r)}),t.invalidateQueries({queryKey:ke.budget(n.budgetId)})}})}}function CB(){const t=Ht(),e=Gn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=ke.budget(i);await t.cancelQueries({queryKey:l});const u=t.getQueryData(l);return u&&t.setQueryData(l,{...u,budget:{...u.budget,user_ids:[...u.budget.user_ids,o]}}),{previousData:u}},mutationFn:async r=>{const{budgetId:i,userId:o}=r,{exists:l,data:u}=await At("budgets",i,"validating user is not already invited");if(!l||!u)throw new Error("Budget not found");if(u.user_ids?.includes(o))throw new Error("User is already invited");return await _m({budgetId:i,updates:{user_ids:Uu(o)},description:"adding user to budget's invited users list"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.budget(i.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function TB(){const t=Ht(),e=Gn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=ke.budget(i);await t.cancelQueries({queryKey:l});const u=t.getQueryData(l);return u&&t.setQueryData(l,{...u,budget:{...u.budget,user_ids:u.budget.user_ids.filter(h=>h!==o),accepted_user_ids:u.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:u}},mutationFn:async r=>{const{budgetId:i,userId:o}=r;return await _m({budgetId:i,updates:{user_ids:O1(o),accepted_user_ids:O1(o)},description:"removing user from budget's access lists"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.budget(i.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function AB({message:t,onDismiss:e}){return d.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:t}),d.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function jB({message:t,onDismiss:e}){return d.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:t}),d.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function RB({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:i,onCheckInvite:o,onAcceptInvite:l,onCancel:u}){return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Join Budget by ID"]}),d.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?d.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[d.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[d.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&d.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[d.jsx("button",{onClick:l,disabled:i===r.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:1},children:i===r.budgetId?"Accepting...":"Accept Invitation"}),d.jsx("button",{onClick:u,disabled:i===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:.8},children:"Cancel"})]})]}):d.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[d.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),d.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function IB({currentUserId:t}){return d.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[d.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),d.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function DB(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:i,loadAccessibleBudgets:o,switchToBudget:l,checkBudgetInvite:u,isInitialized:h,setPageTitle:f,needsFirstBudget:p}=Ze(),{requireUserEmail:g}=Da(),_=k.useRef(!1),[b,S]=RS(),x=b.get("context");k.useEffect(()=>{x&&(b.delete("context"),S(b,{replace:!0}))},[x,b,S]);const E=x==="budget-not-found",C=p&&i.length===0;k.useLayoutEffect(()=>{f("My Budgets")},[f]),k.useEffect(()=>{h&&!_.current&&(_.current=!0,o())},[h,o]);const{budget:T,isLoading:A}=An(),{renameBudget:U}=b3(),{acceptInvite:F}=EB(),{createBudget:H}=SB(),[O,D]=k.useState(null),[P,L]=k.useState(null),[q,j]=k.useState(null),[M,R]=k.useState(null),[K,Q]=k.useState(null),[G,X]=k.useState(""),[J,re]=k.useState(!1),[B,$]=k.useState(""),[te,ae]=k.useState(!1),[ne,de]=k.useState(null),[Se,Te]=k.useState(""),[Ee,pe]=k.useState(!1);async function Fe(oe){if(oe!==T?.id){D(oe),j(null),R(null);try{await l(oe),R("Switched to budget successfully!"),await o({force:!0})}catch(je){j(je instanceof Error?je.message:"Failed to switch budget")}finally{D(null)}}}async function He(oe){if(r){L(oe),j(null),R(null);try{await F.mutateAsync({budgetId:oe,userId:r}),R("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(je){j(je instanceof Error?je.message:"Failed to accept invitation")}finally{L(null)}}}async function Ne(oe){if(oe.preventDefault(),!!B.trim()){ae(!0),j(null),de(null);try{const je=await u(B.trim());je?de(je):j("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(je){j(je instanceof Error?je.message:"Failed to check invitation")}finally{ae(!1)}}}async function z(){if(!(!ne||!r)){ne.budgetName,L(ne.budgetId),j(null);try{await F.mutateAsync({budgetId:ne.budgetId,userId:r}),R(`Successfully joined "${ne.budgetName}"!`),de(null),$(""),await o({force:!0})}catch(oe){j(oe instanceof Error?oe.message:"Failed to accept invitation")}finally{L(null)}}}function be(oe,je){X(je),Q(oe)}async function ge(oe){if(oe.preventDefault(),!(!G.trim()||!K||!n)){G.trim(),re(!0),j(null),R(null);try{await U.mutateAsync({budgetId:n,newName:G.trim()}),R("Budget renamed successfully!"),Q(null),await o({force:!0})}catch(je){j(je instanceof Error?je.message:"Failed to rename budget")}finally{re(!1)}}}async function ee(oe){if(oe.preventDefault(),!!r){Se.trim(),pe(!0),j(null),R(null);try{const je=await H.mutateAsync({name:Se.trim()||"My Budget",userId:r,userEmail:g()});await l(je.budgetId),R("Budget created successfully!"),Te(""),await o({force:!0})}catch(je){j(je instanceof Error?je.message:"Failed to create budget")}finally{pe(!1)}}}const Z=i.filter(oe=>!oe.isPending),ie=i.filter(oe=>oe.isPending);if(k.useEffect(()=>(A||!h?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[A,h,t,e]),A||!h)return null;let we="My Budgets",xe="Switch between budgets, accept invitations, or create a new budget.";return E?(we="Budget Not Found",xe="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):C&&(we="Welcome!",xe="Get started by creating your first budget or accepting an invitation."),d.jsxs("div",{children:[d.jsx("h1",{children:we}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:xe}),q&&d.jsx(AB,{message:q,onDismiss:()=>j(null)}),M&&d.jsx(jB,{message:M,onDismiss:()=>R(null)}),ie.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Pending Invitations (",ie.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:ie.map(oe=>d.jsx(G1,{budget:oe,isCurrent:!1,isAccepting:P===oe.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>He(oe.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},oe.id))})]}),Z.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Your Budgets (",Z.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:Z.map(oe=>d.jsx(G1,{budget:oe,isCurrent:oe.id===n,isAccepting:!1,isSwitching:O===oe.id,isEditing:K===oe.id,editName:K===oe.id?G:"",isRenaming:J,onAccept:()=>{},onSwitch:()=>Fe(oe.id),onStartEdit:()=>be(oe.id,oe.name),onCancelEdit:()=>{Q(null),X("")},onEditNameChange:X,onSaveEdit:ge},oe.id))})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Create New Budget"]}),d.jsxs("form",{onSubmit:ee,children:[d.jsxs("div",{style:{marginBottom:"1rem"},children:[d.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),d.jsx("input",{type:"text",value:Se,onChange:oe=>Te(oe.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),d.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),d.jsx("button",{type:"submit",disabled:Ee,style:{background:ce.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:Ee?"not-allowed":"pointer",fontWeight:500,opacity:Ee?.7:1,fontSize:"0.9rem"},children:Ee?"Creating...":"Create Budget"})]})]}),d.jsx(RB,{budgetIdInput:B,setBudgetIdInput:$,isCheckingManual:te,manualInvite:ne,isAccepting:P,onCheckInvite:Ne,onAcceptInvite:z,onCancel:()=>{de(null),$("")}}),r&&d.jsx(IB,{currentUserId:r})]})}const kB=["accounts","categories","users"];function OB(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:i,selectedBudgetId:o,setCurrentViewingDocument:l}=Ze();k.useLayoutEffect(()=>{i("Budget Settings")},[i]),k.useEffect(()=>(o&&l({type:"budget"}),()=>{l({type:null})}),[o,l]);const{isOwner:u,isLoading:h}=An();k.useEffect(()=>(h?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[h,t,e]);const f=On(),p=f.pathname==="/budget/settings",g=k.useMemo(()=>{const E=f.pathname;return E.includes("/settings/accounts")?"accounts":E.includes("/settings/categories")?"categories":E.includes("/settings/users")?"users":"categories"},[f.pathname]),_=g==="users";k.useEffect(()=>{p||r(g)},[g,p,r]);function b(){return!kB.includes(n)||n==="users"&&!u?"categories":n}const S=k.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!u}],[u]);return h?null:!u&&_?d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(Cn,{to:"/budget/settings/categories",children:"Go to Categories "})})]}):d.jsxs("div",{children:[d.jsx(Pf,{mode:"link",linkPrefix:"/budget/settings",tabs:S,activeTab:p?b():g}),p?d.jsx(Uf,{to:`/budget/settings/${b()}`,replace:!0}):d.jsx(iA,{children:d.jsx(Ff,{})})]})}function Hu({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:i,showGroupSelector:o=!1,showIncomeSettings:l=!1,hasExistingIncomeDefault:u=!1,hasExistingOutgoDefault:h=!1,currentGroupId:f}){const[p,g]=k.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),_=p.account_group_id||f,b=_?i.find(A=>A.id===_):null,S=b?.is_active!==null,x=b?.on_budget!==null;function E(A){A.preventDefault(),p.nickname.trim()&&e(p)}function C(A){g({...p,is_income_account:A,is_income_default:A?p.is_income_default:!1})}function T(A){g({...p,is_outgo_account:A,is_outgo_default:A?p.is_outgo_default:!1})}return d.jsxs(xi,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:E,children:[d.jsx(Pt,{label:"Account Nickname",htmlFor:"account-nickname",children:d.jsx(wi,{id:"account-nickname",type:"text",value:p.nickname,onChange:A=>g({...p,nickname:A.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&d.jsx(Pt,{label:"Account Type",htmlFor:"account-group",children:d.jsxs(qu,{id:"account-group",value:p.account_group_id||Xt,onChange:A=>g({...p,account_group_id:A.target.value===Xt?null:A.target.value}),children:[d.jsx("option",{value:Xt,children:"Ungrouped"}),i.map(A=>d.jsx("option",{value:A.id,children:A.name},A.id))]})}),l&&d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Vr,{id:"is-active",checked:S?b.is_active:p.is_active!==!1,onChange:A=>g({...p,is_active:A.target.checked}),disabled:S,children:d.jsx("span",{style:{opacity:S?.5:1},children:"Active account"})}),S&&d.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ce.warning},children:['Set by account type "',b.name,'"']})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Vr,{id:"on-budget",checked:x?b.on_budget:p.on_budget!==!1,onChange:A=>g({...p,on_budget:A.target.checked}),disabled:x,children:d.jsx("span",{style:{opacity:x?.5:1},children:"On budget (affects budget totals)"})}),x&&d.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ce.warning},children:['Set by account type "',b.name,'"']})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Vr,{id:"is-hidden",checked:p.is_hidden||!1,onChange:A=>g({...p,is_hidden:A.target.checked}),children:"Hidden account"}),d.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),d.jsx(Vr,{id:"is-income-account",checked:p.is_income_account||!1,onChange:A=>C(A.target.checked),children:"Show in income deposit list"}),p.is_income_account&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[d.jsx(Vr,{id:"is-income-default",checked:p.is_income_default||!1,onChange:A=>g({...p,is_income_default:A.target.checked}),disabled:u&&!t?.is_income_default,children:"Default account for new income"}),u&&!t?.is_income_default&&d.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),d.jsx(Vr,{id:"is-outgo-account",checked:p.is_outgo_account||!1,onChange:A=>T(A.target.checked),children:"Show in expense account list"}),p.is_outgo_account&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[d.jsx(Vr,{id:"is-outgo-default",checked:p.is_outgo_default||!1,onChange:A=>g({...p,is_outgo_default:A.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&d.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),d.jsxs(Pa,{children:[d.jsx($e,{type:"submit",actionName:r,children:r}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"})]})]})}function lS({label:t,value:e,onChange:n,trueLabel:r,falseLabel:i,undefinedLabel:o}){function l(){n(e===void 0?!0:e===!0?!1:void 0)}const u=e===!0?r:e===!1?i:o,h=e===!0?ce.success:e===!1?ce.warning:"inherit",f=e===!0?"":e===!1?"":"";return d.jsxs("button",{type:"button",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[d.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:f}),d.jsxs("span",{style:{flex:1},children:[d.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",d.jsx("span",{style:{fontWeight:500,color:h},children:u})]}),d.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function hA({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=k.useState(t||{name:"",expected_balance:"positive"});function l(u){u.preventDefault(),i.name.trim()&&e(i)}return d.jsxs(xi,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:l,children:[d.jsx(Pt,{label:"Account Type Name",htmlFor:"group-name",children:d.jsx(wi,{id:"group-name",type:"text",value:i.name,onChange:u=>o({...i,name:u.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),d.jsx(Pt,{label:"Expected Balance",htmlFor:"expected-balance",children:d.jsxs(qu,{id:"expected-balance",value:i.expected_balance,onChange:u=>o({...i,expected_balance:u.target.value}),children:[d.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),d.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),d.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",d.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),d.jsx(lS,{label:"Active status",value:i.is_active,onChange:u=>o({...i,is_active:u}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),d.jsx(lS,{label:"Budget status",value:i.on_budget,onChange:u=>o({...i,on_budget:u}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),d.jsxs(Pa,{children:[d.jsx($e,{type:"submit",actionName:r,children:r}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function jl({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${ce.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${ce.success} 40%, transparent)`,color:ce.success,opacity:1},warning:{background:`color-mix(in srgb, ${ce.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${ce.warning} 35%, transparent)`,color:ce.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${ce.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ce.success} 25%, transparent)`,color:ce.success,opacity:.7},expense:{background:`color-mix(in srgb, ${ce.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ce.warning} 25%, transparent)`,color:ce.warning,opacity:.7}}[n];return d.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[d.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function fA({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(l=>l.id===t.account_group_id):null,i=r&&r.is_active!==null?r.is_active:t.is_active!==!1,o=r&&r.on_budget!==null?r.on_budget:t.on_budget!==!1;if(!i){const l=r&&r.is_active!==null;n.push(d.jsx(jl,{icon:"",label:l?"Inactive (type)":"Inactive",variant:"warning",title:l?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const l=r&&r.on_budget!==null;n.push(d.jsx(jl,{icon:"",label:l?"Off Budget (type)":"Off Budget",variant:"warning",title:l?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(d.jsx(jl,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(d.jsx(jl,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(d.jsx(jl,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(d.jsx(jl,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:d.jsx(d.Fragment,{children:n})}function MB({group:t}){const e=[];return t.is_active===!1?e.push(d.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ce.warning} 20%, transparent)`,color:ce.warning,whiteSpace:"nowrap"},title:"All accounts in this type are inactive",children:"All Inactive"},"inactive")):t.is_active===!0&&e.push(d.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ce.success} 20%, transparent)`,color:ce.success,whiteSpace:"nowrap"},title:"All accounts in this type are active",children:"All Active"},"active")),t.on_budget===!1?e.push(d.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ce.warning} 20%, transparent)`,color:ce.warning,whiteSpace:"nowrap"},title:"All accounts in this type are off budget",children:"All Off Budget"},"off-budget")):t.on_budget===!0&&e.push(d.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ce.success} 20%, transparent)`,color:ce.success,whiteSpace:"nowrap"},title:"All accounts in this type are on budget",children:"All On Budget"},"on-budget")),e.length===0?null:d.jsx(d.Fragment,{children:e})}function mA({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r}){return d.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[d.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&d.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function NB({group:t,accountCount:e,groupTotal:n,canMoveUp:r,canMoveDown:i,isMobile:o,createForGroupId:l,onEdit:u,onDelete:h,onMoveUp:f,onMoveDown:p,onAddAccount:g}){return d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:o?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:o?"wrap":"nowrap"},children:[d.jsxs("h3",{style:{...Tm,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0,flexWrap:"wrap"},children:[!o&&d.jsx("span",{style:{cursor:"grab",opacity:.4},children:""}),d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:t.name}),d.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]}),Sn.showGroupTotals,d.jsx(MB,{group:t})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!o&&d.jsx($e,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:g,disabled:l!==null,children:"+ Account"}),d.jsx("button",{onClick:()=>{t.name,u()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),d.jsx("button",{onClick:()=>{t.name,h()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),d.jsxs("div",{style:Z0,children:[d.jsx("button",{onClick:f,disabled:!r,style:{...Zl,opacity:r?.6:.2,cursor:r?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),d.jsx("button",{onClick:p,disabled:!i,style:{...Zl,opacity:i?.6:.2,cursor:i?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})}function PB(t,e){return!e||e==="any"||t===0?!1:e==="positive"&&t<0||e==="negative"&&t>0}function zB(t,e){return!e||e==="any"||t===0?null:e==="positive"&&t<0?"Unexpected negative balance":e==="negative"&&t>0?"Unexpected positive balance (credit owed to you?)":null}function BB({group:t,groupIndex:e,totalGroups:n,accounts:r,allGroups:i,allAccounts:o,editingAccountId:l,editingGroupId:u,createForGroupId:h,setEditingAccountId:f,setEditingGroupId:p,setCreateForGroupId:g,dragType:_,draggedId:b,dragOverId:S,dragOverGroupId:x,setDragOverId:E,setDragOverGroupId:C,onAccountDragStart:T,onAccountDragOver:A,onAccountDrop:U,onGroupDragStart:F,onGroupDragOver:H,onGroupDrop:O,onDragLeave:D,onDragLeaveGroup:P,onDragEnd:L,onDropOnGroup:q,onCreateAccount:j,onUpdateAccount:M,onDeleteAccount:R,onMoveAccount:K,onUpdateGroup:Q,onDeleteGroup:G,onMoveGroup:X}){const J=qs(),re=[...r].sort((pe,Fe)=>pe.sort_order-Fe.sort_order),B=_==="group"&&b===t.id,$=_==="group"&&S===t.id,te=_==="account"&&x===t.id,ne=(b&&_==="account"?o[b]:null)&&Object.entries(o).find(([pe])=>pe===b)?.[1]&&Object.entries(o).find(([pe])=>pe===b)?.[1]?.account_group_id!==t.id,de=_==="group"&&$&&b!==t.id,Se=e>0,Te=e<n-1,Ee=re.reduce((pe,Fe)=>pe+Fe.balance,0);return d.jsxs("div",{children:[_==="group"&&!B&&d.jsxs("div",{onDragOver:pe=>{pe.preventDefault(),E(t.id)},onDragLeave:D,onDrop:pe=>O(pe,t.id),style:{position:"relative",height:de?"2.5rem":"0.5rem",marginBottom:de?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[d.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",opacity:de?1:0,transition:"opacity 0.15s",boxShadow:de?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),de&&d.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),d.jsx("div",{draggable:u!==t.id,onDragStart:pe=>F(pe,t.id),onDragOver:pe=>H(pe,t.id),onDragLeave:P,onDragEnd:L,onDrop:pe=>q(pe,t.id),style:{background:B?"color-mix(in srgb, currentColor 3%, transparent)":te&&ne?`color-mix(in srgb, ${ce.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:B?.5:1,border:te&&ne?`2px dashed ${ce.primary}`:"2px solid transparent",cursor:u===t.id?"default":"grab",transition:"all 0.15s"},children:u===t.id?d.jsx(hA,{initialData:{name:t.name,expected_balance:t.expected_balance||"positive",on_budget:t.on_budget??void 0,is_active:t.is_active??void 0},onSubmit:pe=>Q(t.id,pe),onCancel:()=>p(null),submitLabel:"Save"}):d.jsxs(d.Fragment,{children:[d.jsx(NB,{group:t,accountCount:re.length,groupTotal:Ee,canMoveUp:Se,canMoveDown:Te,isMobile:J,createForGroupId:h,onEdit:()=>p(t.id),onDelete:()=>G(t.id),onMoveUp:()=>X(t.id,"up"),onMoveDown:()=>X(t.id,"down"),onAddAccount:()=>g(t.id)}),J&&d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx($e,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>g(t.id),disabled:h!==null,children:"+ Account"})}),d.jsxs("div",{style:Jl,children:[re.map((pe,Fe)=>l===pe.id?d.jsx(Hu,{initialData:{nickname:pe.nickname,account_group_id:pe.account_group_id,is_income_account:pe.is_income_account,is_income_default:pe.is_income_default,is_outgo_account:pe.is_outgo_account,is_outgo_default:pe.is_outgo_default,on_budget:pe.on_budget,is_active:pe.is_active},onSubmit:He=>M(pe.id,He),onCancel:()=>f(null),submitLabel:"Save",accountGroups:i,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:pe.account_group_id,hasExistingIncomeDefault:Object.entries(o).some(([He,Ne])=>Ne.is_income_default&&He!==pe.id),hasExistingOutgoDefault:Object.entries(o).some(([He,Ne])=>Ne.is_outgo_default&&He!==pe.id)},pe.id):d.jsx(Am,{isDragging:_==="account"&&b===pe.id,isDragOver:S===pe.id,onDragStart:He=>{He.stopPropagation(),T(He,pe.id)},onDragOver:He=>A(He,pe.id,t.id),onDragLeave:D,onDragEnd:L,onDrop:He=>U(He,pe.id,t.id),onEdit:()=>{pe.nickname,f(pe.id)},onDelete:()=>{pe.nickname,R(pe.id)},onMoveUp:()=>K(pe.id,"up"),onMoveDown:()=>K(pe.id,"down"),canMoveUp:Fe>0,canMoveDown:Fe<re.length-1,children:d.jsxs("div",{children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("span",{style:J0,children:pe.nickname}),d.jsx(fA,{account:pe,accountGroups:i})]}),d.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:Bt(pe.balance)},children:[Je(pe.balance),PB(pe.balance,t.expected_balance)&&d.jsx("span",{title:zB(pe.balance,t.expected_balance)||"",style:{marginLeft:"0.5rem",fontSize:"0.85rem"},children:""})]})]})},pe.id)),re.length===0&&!h&&d.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No accounts in this type"}),_==="account"&&re.length>0&&d.jsx(mA,{groupId:t.id,isActive:S===`__end__${t.id}`,onDragOver:pe=>{pe.preventDefault(),pe.stopPropagation(),E(`__end__${t.id}`),C(t.id)},onDragLeave:pe=>{pe.stopPropagation(),E(null)},onDrop:pe=>{pe.stopPropagation(),U(pe,"__group_end__",t.id)}}),h===t.id&&d.jsx(Hu,{initialData:{nickname:"",account_group_id:t.id},onSubmit:pe=>j(pe,t.id),onCancel:()=>g(null),submitLabel:"Create",accountGroups:i,showIncomeSettings:!0,currentGroupId:t.id})]}),h!==t.id&&d.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:d.jsx($e,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>g(t.id),disabled:h!==null,children:"+ Add Account"})})]})})]})}function LB({accounts:t,allGroups:e,allAccounts:n,hasGroups:r,editingAccountId:i,createForGroupId:o,setEditingAccountId:l,setCreateForGroupId:u,dragType:h,draggedId:f,dragOverId:p,dragOverGroupId:g,setDragOverId:_,setDragOverGroupId:b,onAccountDragStart:S,onAccountDragOver:x,onAccountDrop:E,onDragOverGroup:C,onDropOnGroup:T,onDragLeave:A,onDragLeaveGroup:U,onDragEnd:F,onCreateAccount:H,onUpdateAccount:O,onDeleteAccount:D,onMoveAccount:P}){const L=[...t].sort((R,K)=>R.sort_order-K.sort_order),q=h==="account"&&g==="ungrouped",M=(f&&h==="account"?n[f]:null)&&Object.entries(n).find(([R])=>R===f)?.[1]&&Object.entries(n).find(([R])=>R===f)?.[1]?.account_group_id!==null;return L.length===0&&!o&&r&&h!=="account"?null:(L.reduce((R,K)=>R+K.balance,0),d.jsxs("div",{onDragOver:R=>C(R,"ungrouped"),onDragLeave:U,onDrop:R=>T(R,"ungrouped"),style:{background:q&&M?`color-mix(in srgb, ${ce.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:q&&M?`2px dashed ${ce.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[d.jsxs("h3",{style:{...Tm,margin:0,opacity:.7,display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:"Ungrouped"}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",L.length,")"]}),Sn.showGroupTotals]}),d.jsx($e,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>u("ungrouped"),disabled:o!==null,children:"+ Account"})]}),d.jsxs("div",{style:Jl,children:[L.map((R,K)=>i===R.id?d.jsx(Hu,{initialData:{nickname:R.nickname,account_group_id:R.account_group_id,is_income_account:R.is_income_account,is_income_default:R.is_income_default,is_outgo_account:R.is_outgo_account,is_outgo_default:R.is_outgo_default,on_budget:R.on_budget,is_active:R.is_active},onSubmit:Q=>O(R.id,Q),onCancel:()=>l(null),submitLabel:"Save",accountGroups:e,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:null,hasExistingIncomeDefault:Object.entries(n).some(([Q,G])=>G.is_income_default&&Q!==R.id),hasExistingOutgoDefault:Object.entries(n).some(([Q,G])=>G.is_outgo_default&&Q!==R.id)},R.id):d.jsx(Am,{isDragging:h==="account"&&f===R.id,isDragOver:p===R.id,onDragStart:Q=>S(Q,R.id),onDragOver:Q=>x(Q,R.id,"ungrouped"),onDragLeave:A,onDragEnd:F,onDrop:Q=>E(Q,R.id,"ungrouped"),onEdit:()=>{R.nickname,l(R.id)},onDelete:()=>{R.nickname,D(R.id)},onMoveUp:()=>P(R.id,"up"),onMoveDown:()=>P(R.id,"down"),canMoveUp:K>0,canMoveDown:K<L.length-1,children:d.jsxs("div",{children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("span",{style:J0,children:R.nickname}),d.jsx(fA,{account:R,accountGroups:e})]}),d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:Bt(R.balance)},children:Je(R.balance)})]})},R.id)),L.length===0&&h==="account"&&d.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to ungroup"}),h==="account"&&L.length>0&&d.jsx(mA,{groupId:"ungrouped",isActive:p==="__end__ungrouped",onDragOver:R=>{R.preventDefault(),R.stopPropagation(),_("__end__ungrouped"),b("ungrouped")},onDragLeave:R=>{R.stopPropagation(),_(null)},onDrop:R=>{R.stopPropagation(),E(R,"__group_end__","ungrouped")}}),o==="ungrouped"&&d.jsx(Hu,{initialData:{nickname:"",account_group_id:null},onSubmit:R=>H(R,"ungrouped"),onCancel:()=>u(null),submitLabel:"Create",accountGroups:e,showIncomeSettings:!0,currentGroupId:null})]}),o!=="ungrouped"&&d.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:d.jsx($e,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>u("ungrouped"),disabled:o!==null,children:"+ Add Account"})})]}))}function UB(){const{selectedBudgetId:t}=Ze(),{monthMap:e,isLoading:n}=An(),{accounts:r,accountsByGroup:i,hiddenAccounts:o,sortedGroups:l,currentBudget:u,error:h,setError:f,handleCreateAccount:p,handleUpdateAccount:g,handleDeleteAccount:_,handleMoveAccount:b,handleCreateGroup:S,handleUpdateGroup:x,handleDeleteGroup:E,handleMoveGroup:C,reorderAccountsInGroup:T,reorderGroups:A}=x3(),U=qs();dd({budgetId:t,monthMap:e,checkAnyMonth:!0,additionalCondition:!n&&!!u,logPrefix:"[Settings/Accounts]"});const[F,H]=k.useState(null),[O,D]=k.useState(null),[P,L]=k.useState(null),[q,j]=k.useState(!1),[M,R]=k.useState(null),[K,Q]=k.useState(null),[G,X]=k.useState(null),[J,re]=k.useState(null);function B(Ne,z){R("account"),Q(z),Ne.dataTransfer.effectAllowed="move"}function $(Ne,z,be){Ne.preventDefault(),M==="account"&&(z!==K&&X(z),re(be))}function te(Ne,z){Ne.preventDefault(),M==="account"?(re(z),X(null)):M==="group"&&z!==K&&X(z)}function ae(){X(null)}function ne(){re(null)}function de(){R(null),Q(null),X(null),re(null)}async function Se(Ne,z,be){if(Ne.preventDefault(),Ne.stopPropagation(),!K||M!=="account"){de();return}await T(K,z,be),de()}async function Te(Ne,z){Ne.preventDefault(),M==="account"?await Se(Ne,"__group_end__",z):M==="group"&&await pe(Ne,z)}function Ee(Ne,z){Ne.stopPropagation(),R("group"),Q(z),Ne.dataTransfer.effectAllowed="move"}async function pe(Ne,z){if(Ne.preventDefault(),!K||M!=="group"||K===z){de();return}await A(K,z),de()}const Fe=k.useMemo(()=>{const Ne=Object.values(r),z=Ne.reduce((ee,Z)=>ee+(Z.balance??0),0);let be=0,ge=0;for(const ee of Ne){const Z=l.find(we=>we.id===ee.account_group_id);ee.on_budget===!0||ee.on_budget===void 0&&Z?.on_budget!==!1?be+=ee.balance??0:ge+=ee.balance??0}return{count:Ne.length,groupCount:l.length,totalBalance:z,onBudgetTotal:be,offBudgetTotal:ge}},[r,l]);if(!u)return d.jsx("p",{children:"No budget found. Please log in."});const He=i[Xt]||[];return d.jsxs("div",{children:[h&&d.jsx(Bo,{message:h,onDismiss:()=>f(null)}),d.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),d.jsx("span",{style:{color:Bt(Fe.onBudgetTotal),fontWeight:600},children:Je(Fe.onBudgetTotal)})]}),Fe.offBudgetTotal!==0&&d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),d.jsx("span",{style:{fontWeight:600,opacity:.7},children:Je(Fe.offBudgetTotal)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:Bt(Fe.totalBalance),fontWeight:600},children:Je(Fe.totalBalance)})]}),d.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:U?"Drag to move.":"Drag between types or use  to reorder."})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:d.jsx(a_,{})})]})}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(r).length===0&&l.length===0&&d.jsx("p",{style:{opacity:.7},children:"No accounts yet. Create an account type first, then add accounts!"}),l.map((Ne,z)=>d.jsx(BB,{group:Ne,groupIndex:z,totalGroups:l.length,accounts:i[Ne.id]||[],allGroups:l,allAccounts:r,editingAccountId:F,editingGroupId:P,createForGroupId:O,setEditingAccountId:H,setEditingGroupId:L,setCreateForGroupId:D,dragType:M,draggedId:K,dragOverId:G,dragOverGroupId:J,setDragOverId:X,setDragOverGroupId:re,onAccountDragStart:B,onAccountDragOver:$,onAccountDrop:Se,onGroupDragStart:Ee,onGroupDragOver:te,onGroupDrop:pe,onDragLeave:ae,onDragLeaveGroup:ne,onDragEnd:de,onDropOnGroup:Te,onCreateAccount:p,onUpdateAccount:(be,ge)=>{g(be,ge),H(null)},onDeleteAccount:_,onMoveAccount:b,onUpdateGroup:(be,ge)=>{x(be,ge),L(null)},onDeleteGroup:E,onMoveGroup:C},Ne.id)),M==="group"&&l.length>0&&d.jsx(n_,{isActive:G==="__end__",onDragOver:Ne=>{Ne.preventDefault(),X("__end__")},onDragLeave:ae,onDrop:Ne=>pe(Ne,"__end__"),label:"Move account type to end"}),d.jsx(LB,{accounts:He,allGroups:l,allAccounts:r,hasGroups:l.length>0,editingAccountId:F,createForGroupId:O,setEditingAccountId:H,setCreateForGroupId:D,dragType:M,draggedId:K,dragOverId:G,dragOverGroupId:J,setDragOverId:X,setDragOverGroupId:re,onAccountDragStart:B,onAccountDragOver:$,onAccountDrop:Se,onDragOverGroup:te,onDropOnGroup:Te,onDragLeave:ae,onDragLeaveGroup:ne,onDragEnd:de,onCreateAccount:p,onUpdateAccount:(Ne,z)=>{g(Ne,z),H(null)},onDeleteAccount:_,onMoveAccount:b})]}),o.length>0&&d.jsx("div",{style:{marginBottom:"2rem"},children:d.jsxs(r_,{title:"Hidden Accounts",count:o.length,children:[d.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[d.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[d.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),d.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:o.map(Ne=>F===Ne.id?d.jsx(Hu,{initialData:{nickname:Ne.nickname,account_group_id:Ne.account_group_id,is_income_account:Ne.is_income_account,is_income_default:Ne.is_income_default,is_outgo_account:Ne.is_outgo_account,is_outgo_default:Ne.is_outgo_default,on_budget:Ne.on_budget,is_active:Ne.is_active,is_hidden:Ne.is_hidden},onSubmit:z=>{g(Ne.id,z),H(null)},onCancel:()=>H(null),submitLabel:"Save",accountGroups:l,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:Ne.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([z,be])=>be.is_income_default&&z!==Ne.id),hasExistingOutgoDefault:Object.entries(r).some(([z,be])=>be.is_outgo_default&&z!==Ne.id)},Ne.id):d.jsxs("div",{onClick:()=>H(Ne.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[d.jsx("span",{children:Ne.nickname}),d.jsx("span",{style:{color:Bt(Ne.balance),fontWeight:500},children:Je(Ne.balance)})]},Ne.id))})]})}),q?d.jsx(hA,{onSubmit:Ne=>{S(Ne),j(!1)},onCancel:()=>j(!1),submitLabel:"Create Account Type"}):d.jsx($e,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>j(!0),children:"+ Add Account Type"})]})}function Qu({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:i=[],showGroupSelector:o=!1}){const[l,u]=k.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[h,f]=k.useState(t?.default_monthly_amount?.toString()||""),[p,g]=k.useState(t?.default_monthly_type||"fixed"),[_,b]=k.useState(!1);function S(x){if(x.preventDefault(),!l.name.trim())return;b(!0);const E=parseFloat(h),C=!isNaN(E)&&E>0;e({...l,description:l.description?.trim()||void 0,default_monthly_amount:C?E:void 0,default_monthly_type:C?p:void 0})}return d.jsxs(xi,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:S,children:[d.jsx(Pt,{label:"Category Name",htmlFor:"category-name",children:d.jsx(wi,{id:"category-name",type:"text",value:l.name,onChange:x=>u({...l,name:x.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),d.jsx(Pt,{label:"Description (optional)",htmlFor:"category-description",children:d.jsx(t_,{id:"category-description",value:l.description||"",onChange:x=>u({...l,description:x.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&d.jsx(Pt,{label:"Category Group",htmlFor:"category-group",children:d.jsxs(qu,{id:"category-group",value:l.category_group_id||nn,onChange:x=>u({...l,category_group_id:x.target.value===nn?null:x.target.value}),children:[d.jsx("option",{value:nn,children:"Uncategorized"}),i.map(x=>d.jsx("option",{value:x.id,children:x.name},x.id))]})}),d.jsxs(Pt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[d.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[d.jsxs(qu,{id:"default-type",value:p,onChange:x=>g(x.target.value),style:{width:"auto",flex:"0 0 auto"},children:[d.jsx("option",{value:"fixed",children:"Fixed $"}),d.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),p==="fixed"?d.jsx(bo,{id:"default-amount",value:h,onChange:f,placeholder:"$0.00"}):d.jsx(wi,{id:"default-amount",type:"number",value:h,onChange:x=>f(x.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),p==="percentage"&&d.jsx("span",{style:{opacity:.6},children:"%"})]}),d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:p==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[d.jsx(Vr,{id:"is-hidden",checked:l.is_hidden||!1,onChange:x=>u({...l,is_hidden:x.target.checked}),children:"Hidden category"}),d.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),d.jsxs(Pa,{children:[d.jsx($e,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:_,children:r}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"})]})]})}function pA({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=k.useState(t||{name:""}),[l,u]=k.useState(!1);function h(f){f.preventDefault(),i.name.trim()&&(u(!0),e(i))}return d.jsxs(xi,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[d.jsx(Pt,{label:"Group Name",htmlFor:"group-name",children:d.jsx(wi,{id:"group-name",type:"text",value:i.name,onChange:f=>o({...i,name:f.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),d.jsxs(Pa,{children:[d.jsx($e,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:l,children:r}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function gA({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r}){return d.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[d.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&d.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function yA({category:t,catId:e,categoryBalances:n,loadingBalances:r}){const i=n[e]||{current:0,total:0};return d.jsxs("div",{children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[d.jsx("span",{style:J0,children:t.name}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&d.jsxs("span",{style:{fontSize:"0.75rem",opacity:.8,background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.15rem 0.4rem",borderRadius:"4px"},children:["Default: ",t.default_monthly_type==="percentage"?d.jsxs(d.Fragment,{children:[d.jsxs("span",{style:{color:ce.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{color:ce.success,fontWeight:500},children:Je(t.default_monthly_amount)}),"/mo"]})]})]}),t.description&&d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",opacity:.6,lineHeight:1.3},children:t.description}),d.jsxs("div",{style:{marginTop:"0.25rem"},children:[d.jsxs("p",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:Vn(i.current)},children:[r?"...":as(i.current),d.jsx("span",{style:{fontSize:"0.75rem",fontWeight:400,opacity:.6,marginLeft:"0.35rem"},children:"available now"})]}),d.jsxs("p",{style:{margin:"0.15rem 0 0 0",fontSize:"0.85rem",fontWeight:500,color:Vn(i.total),opacity:.75},children:[r?"...":as(i.total),d.jsx("span",{style:{fontSize:"0.7rem",fontWeight:400,opacity:.7,marginLeft:"0.35rem"},children:"total allocated"})]})]})]})}function FB({group:t,categoryCount:e,canMoveUp:n,canMoveDown:r,isMobile:i,createForGroupId:o,onEdit:l,onDelete:u,onMoveUp:h,onMoveDown:f,onAddCategory:p,onDragStart:g,onDragEnd:_}){return d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:i?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:i?"wrap":"nowrap"},children:[d.jsxs("h3",{style:{...Tm,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0},children:[!i&&d.jsx("span",{draggable:!0,onDragStart:g,onDragEnd:_,style:{cursor:"grab",opacity:.4,padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder group",children:""}),d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),d.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!i&&d.jsx($e,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:p,disabled:o!==null,children:"+ Category"}),d.jsx("button",{onClick:()=>{t.name,l()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),d.jsx("button",{onClick:()=>{t.name,u()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),d.jsxs("div",{style:Z0,children:[d.jsx("button",{onClick:h,disabled:!n,style:{...Zl,opacity:n?.6:.2,cursor:n?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),d.jsx("button",{onClick:f,disabled:!r,style:{...Zl,opacity:r?.6:.2,cursor:r?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]})}function VB({group:t,groupIndex:e,groupCategories:n,sortedGroups:r,categoryGroups:i,categoryBalances:o,loadingBalances:l,dragType:u,draggedId:h,dragOverId:f,dragOverGroupId:p,editingCategoryId:g,setEditingCategoryId:_,createForGroupId:b,setCreateForGroupId:S,editingGroupId:x,setEditingGroupId:E,handleCreateCategory:C,handleUpdateCategory:T,handleDeleteCategory:A,handleMoveCategory:U,handleUpdateGroup:F,handleDeleteGroup:H,handleMoveGroup:O,handleCategoryDragStart:D,handleCategoryDragOver:P,handleDragOverGroup:L,handleDragLeave:q,handleDragLeaveGroup:j,handleDragEnd:M,handleCategoryDrop:R,handleDropOnGroup:K,handleGroupDragStart:Q,handleGroupDrop:G,setDragOverId:X,setDragOverGroupId:J,isMobile:re,categories:B}){const $=u==="group"&&h===t.id,te=u==="group"&&f===t.id,ae=u==="category"&&p===t.id,ne=h&&u==="category"?B[h]:null,de=ne&&(ne.category_group_id||"ungrouped")!==t.id,Se=u==="group"&&te&&h!==t.id,Te=e>0,Ee=e<r.length-1;return d.jsxs("div",{children:[u==="group"&&!$&&d.jsxs("div",{onDragOver:pe=>{pe.preventDefault(),X(t.id)},onDragLeave:q,onDrop:pe=>G(pe,t.id),style:{position:"relative",height:Se?"2.5rem":"0.5rem",marginBottom:Se?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[d.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",opacity:Se?1:0,transition:"opacity 0.15s",boxShadow:Se?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),Se&&d.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),d.jsx("div",{onDragOver:pe=>L(pe,t.id),onDragLeave:j,onDrop:pe=>K(pe,t.id),style:{background:$?"color-mix(in srgb, currentColor 3%, transparent)":ae&&de?`color-mix(in srgb, ${ce.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:$?.5:1,border:ae&&de?`2px dashed ${ce.primary}`:"2px solid transparent",transition:"all 0.15s"},children:x===t.id?d.jsx(pA,{initialData:{name:t.name},onSubmit:pe=>F(t.id,pe),onCancel:()=>E(null),submitLabel:"Save"}):d.jsxs(d.Fragment,{children:[d.jsx(FB,{group:t,categoryCount:n.length,canMoveUp:Te,canMoveDown:Ee,isMobile:re,createForGroupId:b,onEdit:()=>E(t.id),onDelete:()=>H(t.id),onMoveUp:()=>O(t.id,"up"),onMoveDown:()=>O(t.id,"down"),onAddCategory:()=>S(t.id),onDragStart:pe=>Q(pe,t.id),onDragEnd:M}),re&&d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx($e,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>S(t.id),disabled:b!==null,children:"+ Category"})}),d.jsxs("div",{style:Jl,children:[n.map(([pe,Fe])=>g===pe?d.jsx(Qu,{initialData:{name:Fe.name,description:Fe.description,category_group_id:Fe.category_group_id,default_monthly_amount:Fe.default_monthly_amount,default_monthly_type:Fe.default_monthly_type,is_hidden:Fe.is_hidden},onSubmit:He=>{T(pe,He),_(null)},onCancel:()=>_(null),submitLabel:"Save",categoryGroups:i,showGroupSelector:!0},pe):d.jsx(Am,{isDragging:u==="category"&&h===pe,isDragOver:f===pe,onDragStart:He=>{He.stopPropagation(),D(He,pe)},onDragOver:He=>P(He,pe,t.id),onDragLeave:q,onDragEnd:M,onDrop:He=>R(He,pe,t.id),onEdit:()=>{Fe.name,_(pe)},onDelete:()=>{Fe.name,A(pe)},onMoveUp:()=>U(pe,"up"),onMoveDown:()=>U(pe,"down"),canMoveUp:n.findIndex(([He])=>He===pe)>0,canMoveDown:n.findIndex(([He])=>He===pe)<n.length-1,children:d.jsx(yA,{category:Fe,catId:pe,categoryBalances:o,loadingBalances:l})},pe)),n.length===0&&!b&&d.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No categories in this group"}),u==="category"&&n.length>0&&d.jsx(gA,{groupId:t.id,isActive:f===`__end__${t.id}`,onDragOver:pe=>{pe.preventDefault(),pe.stopPropagation(),X(`__end__${t.id}`),J(t.id)},onDragLeave:pe=>{pe.stopPropagation(),X(null)},onDrop:pe=>{pe.stopPropagation(),R(pe,"__group_end__",t.id)}}),b===t.id&&d.jsx(Qu,{initialData:{name:"",category_group_id:t.id},onSubmit:pe=>C(pe,t.id),onCancel:()=>S(null),submitLabel:"Create",categoryGroups:i})]}),b!==t.id&&d.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:d.jsx($e,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>S(t.id),disabled:b!==null,children:"+ Add Category"})})]})})]})}function $B({ungroupedCategories:t,categoryGroups:e,categoryBalances:n,loadingBalances:r,dragType:i,draggedId:o,dragOverId:l,dragOverGroupId:u,editingCategoryId:h,setEditingCategoryId:f,createForGroupId:p,setCreateForGroupId:g,handleCreateCategory:_,handleUpdateCategory:b,handleDeleteCategory:S,handleMoveCategory:x,handleCategoryDragStart:E,handleCategoryDragOver:C,handleDragOverGroup:T,handleDragLeaveGroup:A,handleDragLeave:U,handleDragEnd:F,handleCategoryDrop:H,handleDropOnGroup:O,setDragOverId:D,setDragOverGroupId:P,categories:L,hasGroups:q}){const j=i==="category"&&u==="ungrouped",M=o&&i==="category"?L[o]:null,R=M&&M.category_group_id!==null;return t.length===0&&!p&&q&&i!=="category"?null:d.jsxs("div",{onDragOver:K=>T(K,"ungrouped"),onDragLeave:A,onDrop:K=>O(K,"ungrouped"),style:{background:j&&R?`color-mix(in srgb, ${ce.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:j&&R?`2px dashed ${ce.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[d.jsxs("h3",{style:{...Tm,margin:0,opacity:.7},children:["Uncategorized",d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",t.length,")"]})]}),d.jsx($e,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>g("ungrouped"),disabled:p!==null,children:"+ Category"})]}),d.jsxs("div",{style:Jl,children:[t.map(([K,Q])=>h===K?d.jsx(Qu,{initialData:{name:Q.name,description:Q.description,category_group_id:Q.category_group_id,default_monthly_amount:Q.default_monthly_amount,default_monthly_type:Q.default_monthly_type,is_hidden:Q.is_hidden},onSubmit:G=>{b(K,G),f(null)},onCancel:()=>f(null),submitLabel:"Save",categoryGroups:e,showGroupSelector:!0},K):d.jsx(Am,{isDragging:i==="category"&&o===K,isDragOver:l===K,onDragStart:G=>E(G,K),onDragOver:G=>C(G,K,"ungrouped"),onDragLeave:U,onDragEnd:F,onDrop:G=>H(G,K,"ungrouped"),onEdit:()=>{Q.name,f(K)},onDelete:()=>{Q.name,S(K)},onMoveUp:()=>x(K,"up"),onMoveDown:()=>x(K,"down"),canMoveUp:t.findIndex(([G])=>G===K)>0,canMoveDown:t.findIndex(([G])=>G===K)<t.length-1,children:d.jsx(yA,{category:Q,catId:K,categoryBalances:n,loadingBalances:r})},K)),t.length===0&&i==="category"&&d.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to uncategorize"}),i==="category"&&t.length>0&&d.jsx(gA,{groupId:"ungrouped",isActive:l==="__end__ungrouped",onDragOver:K=>{K.preventDefault(),K.stopPropagation(),D("__end__ungrouped"),P("ungrouped")},onDragLeave:K=>{K.stopPropagation(),D(null)},onDrop:K=>{K.stopPropagation(),H(K,"__group_end__","ungrouped")}}),p==="ungrouped"&&d.jsx(Qu,{initialData:{name:"",category_group_id:null},onSubmit:K=>_(K,"ungrouped"),onCancel:()=>g(null),submitLabel:"Create",categoryGroups:e})]}),p!=="ungrouped"&&d.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:d.jsx($e,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>g("ungrouped"),disabled:p!==null,children:"+ Add Category"})})]})}function qB(){const{selectedBudgetId:t}=Ze(),{monthMap:e,isLoading:n}=An(),{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:l,hiddenCategories:u,sortedGroups:h,categoryBalances:f,isLoading:p,loadingBalances:g,error:_,setError:b,getOnBudgetTotal:S,handleCreateCategory:x,handleUpdateCategory:E,handleDeleteCategory:C,handleMoveCategory:T,handleCreateGroup:A,handleUpdateGroup:U,handleDeleteGroup:F,handleMoveGroup:H,dragType:O,draggedId:D,dragOverId:P,dragOverGroupId:L,setDragOverId:q,setDragOverGroupId:j,handleCategoryDragStart:M,handleCategoryDragOver:R,handleDragOverGroup:K,handleDragLeave:Q,handleDragLeaveGroup:G,handleDragEnd:X,handleCategoryDrop:J,handleDropOnGroup:re,handleGroupDragStart:B,handleGroupDrop:$}=C3();dd({budgetId:t,monthMap:e,checkAnyMonth:!0,additionalCondition:!n&&!p&&!!r,logPrefix:"[Settings/Categories]"});const te=qs(),{addLoadingHold:ae,removeLoadingHold:ne}=sr();k.useEffect(()=>(p?ae("categories","Loading categories..."):ne("categories"),()=>ne("categories")),[p,ae,ne]);const[de,Se]=k.useState(null),[Te,Ee]=k.useState(null),[pe,Fe]=k.useState(null),[He,Ne]=k.useState(!1);if(!r)return d.jsx("p",{children:"No budget found. Please log in."});const z=Object.values(f).reduce((Z,ie)=>Z+ie.current,0),be=Object.values(f).reduce((Z,ie)=>Z+ie.total,0),ge=S()-z,ee=Math.abs(be-z)>.01;return p?null:d.jsxs("div",{children:[_&&d.jsx(Bo,{message:_,onDismiss:()=>b(null)}),d.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Categories:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),d.jsx("span",{style:{color:Bt(S()),fontWeight:600},children:Je(S())})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Allocated: "}),d.jsx("span",{style:{color:gc(z),fontWeight:600},children:g?"...":Je(z)}),ee&&d.jsxs("span",{style:{opacity:.5,fontSize:"0.8rem"},children:[" (",Je(be)," total)"]})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Available: "}),d.jsx("span",{style:{color:Bt(ge),fontWeight:600},children:g?"...":Je(ge)})]}),d.jsx("span",{style:{opacity:.6},children:te?"Drag to move between groups.":"Drag categories between groups, or use  to reorder."})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:d.jsx(a_,{})})]})}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(i).length===0&&o.length===0&&d.jsx("p",{style:{opacity:.7},children:"No categories yet. Create a group first, then add categories!"}),h.map((Z,ie)=>{const we=(l[Z.id]||[]).sort((xe,oe)=>xe[1].sort_order-oe[1].sort_order);return d.jsx(VB,{group:Z,groupIndex:ie,groupCategories:we,sortedGroups:h,categoryGroups:o,categoryBalances:f,loadingBalances:g,dragType:O,draggedId:D,dragOverId:P,dragOverGroupId:L,editingCategoryId:de,setEditingCategoryId:Se,createForGroupId:Te,setCreateForGroupId:Ee,editingGroupId:pe,setEditingGroupId:Fe,handleCreateCategory:x,handleUpdateCategory:E,handleDeleteCategory:C,handleMoveCategory:T,handleUpdateGroup:U,handleDeleteGroup:F,handleMoveGroup:H,handleCategoryDragStart:M,handleCategoryDragOver:R,handleDragOverGroup:K,handleDragLeave:Q,handleDragLeaveGroup:G,handleDragEnd:X,handleCategoryDrop:J,handleDropOnGroup:re,handleGroupDragStart:B,handleGroupDrop:$,setDragOverId:q,setDragOverGroupId:j,isMobile:te,categories:i},Z.id)}),O==="group"&&h.length>0&&d.jsx(n_,{isActive:P==="__end__",onDragOver:Z=>{Z.preventDefault(),q("__end__")},onDragLeave:Q,onDrop:Z=>$(Z,"__end__"),label:"Move group to end"}),d.jsx($B,{ungroupedCategories:(l[nn]||[]).sort((Z,ie)=>Z[1].sort_order-ie[1].sort_order),categoryGroups:o,categoryBalances:f,loadingBalances:g,dragType:O,draggedId:D,dragOverId:P,dragOverGroupId:L,editingCategoryId:de,setEditingCategoryId:Se,createForGroupId:Te,setCreateForGroupId:Ee,handleCreateCategory:x,handleUpdateCategory:E,handleDeleteCategory:C,handleMoveCategory:T,handleCategoryDragStart:M,handleCategoryDragOver:R,handleDragOverGroup:K,handleDragLeaveGroup:G,handleDragLeave:Q,handleDragEnd:X,handleCategoryDrop:J,handleDropOnGroup:re,setDragOverId:q,setDragOverGroupId:j,categories:i,hasGroups:o.length>0})]}),u.length>0&&d.jsx("div",{style:{marginBottom:"2rem"},children:d.jsxs(r_,{title:"Hidden Categories",count:u.length,children:[d.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[d.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[d.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),d.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:u.map(([Z,ie])=>de===Z?d.jsx(Qu,{initialData:{name:ie.name,description:ie.description,category_group_id:ie.category_group_id,default_monthly_amount:ie.default_monthly_amount,default_monthly_type:ie.default_monthly_type,is_hidden:ie.is_hidden},onSubmit:we=>{E(Z,we),Se(null)},onCancel:()=>Se(null),submitLabel:"Save",categoryGroups:o,showGroupSelector:!0},Z):d.jsxs("div",{onClick:()=>Se(Z),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[d.jsx("span",{children:ie.name}),d.jsx("span",{style:{color:Bt(ie.balance),fontWeight:500},children:Je(ie.balance)})]},Z))})]})}),He?d.jsx(pA,{onSubmit:Z=>{A(Z),Ne(!1)},onCancel:()=>Ne(!1),submitLabel:"Create Group"}):d.jsx($e,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>Ne(!0),children:"+ Add Category Group"})]})}function GB(){const{selectedBudgetId:t,currentUserId:e}=Ze(),{budget:n,budgetUserIds:r,acceptedUserIds:i}=An(),{inviteUser:o}=CB(),{revokeUser:l}=TB(),[u,h]=k.useState(""),[f,p]=k.useState(!1),[g,_]=k.useState(null),[b,S]=k.useState(null);if(!n)return d.jsx("p",{children:"No budget found."});async function x(A){if(A.preventDefault(),!(!u.trim()||!n||!t)){p(!0),_(null),S(null);try{await o.mutateAsync({budgetId:t,userId:u.trim()}),h(""),S("Invite sent! The user can now accept the invitation from their account.")}catch(U){_(U instanceof Error?U.message:"Failed to invite user")}finally{p(!1)}}}async function E(A){if(!n||!t)return;if(A===n.owner_id){_("Cannot revoke the budget owner");return}if(A===e){_("Cannot revoke yourself from the budget");return}const U=i.includes(A);if(confirm(U?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){_(null),S(null);try{await l.mutateAsync({budgetId:t,userId:A}),S(U?"User access revoked.":"Invitation cancelled.")}catch(H){_(H instanceof Error?H.message:"Failed to revoke user")}}}const C=r.filter(A=>i.includes(A)),T=r.filter(A=>!i.includes(A));return d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),g&&d.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:g}),d.jsx("button",{onClick:()=>_(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),b&&d.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:b}),d.jsx("button",{onClick:()=>S(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",C.length,")"]}),C.length===0?d.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:C.map(A=>{const U=A===n.owner_id,F=A===e;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[d.jsx("div",{style:{flex:1,minWidth:0},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:A}),U&&d.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),F&&d.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!U&&!F&&d.jsx("button",{onClick:()=>E(A),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},A)})})]}),T.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",T.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:T.map(A=>d.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[d.jsx("div",{style:{flex:1,minWidth:0},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:A}),d.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),d.jsx("button",{onClick:()=>E(A),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},A))})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),d.jsxs("form",{onSubmit:x,style:{display:"flex",gap:"0.75rem"},children:[d.jsx("input",{type:"text",value:u,onChange:A=>h(A.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),d.jsx("button",{type:"submit",disabled:f||!u.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:f||!u.trim()?"not-allowed":"pointer",fontWeight:500,opacity:f||!u.trim()?.7:1,whiteSpace:"nowrap"},children:f?"Inviting...":"Send Invite"})]}),d.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),d.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:n.id})]})]})}const HB=["budget","feedback","migration","tests"];function QB(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:i}=Ze();k.useLayoutEffect(()=>{i("Budget Admin")},[i]);const o=On(),l=o.pathname==="/budget/admin",u=k.useMemo(()=>{const g=o.pathname;return g.includes("/admin/budget")?"budget":g.includes("/admin/feedback")?"feedback":g.includes("/admin/migration")?"migration":g.includes("/admin/tests")?"tests":"budget"},[o.pathname]),h=u==="tests";k.useEffect(()=>{l||r(u)},[u,l,r]);function f(){return!HB.includes(n)||n==="tests"&&!e?"budget":n}const p=k.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return t?!e&&h?d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(Cn,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):d.jsxs("div",{children:[d.jsx(Pf,{mode:"link",linkPrefix:"/budget/admin",tabs:p,activeTab:u}),l?d.jsx(Uf,{to:`/budget/admin/${f()}`,replace:!0}):d.jsx(Ff,{})]}):d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(Cn,{to:"/budget",children:"Go to Budget "})})]})}function WB(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{isAdmin:n}=Ze(),{budget:r,accounts:i,accountGroups:o,categories:l,categoryGroups:u,isOwner:h,isLoading:f}=An();return k.useEffect(()=>(f?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[f,t,e]),f?null:r?d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),d.jsx("strong",{children:r.name})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),d.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),d.jsx("strong",{children:r.owner_email||r.owner_id})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),d.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",d.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),d.jsx("button",{onClick:()=>{const p={...r,accounts:i,account_groups:o,categories:l,category_groups:u,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),_=URL.createObjectURL(g),b=document.createElement("a");b.href=_,b.download=`budget_${r.id}.json`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(_)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):d.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function cS({selectedType:t,onSelect:e}){return d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=By[n],i=t==="feature"?"new_feature":t,o=i===n||!i&&n==="bug";return d.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&d.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function KB(){const[t,e]=k.useState(null),[n,r]=k.useState(null),[i,o]=k.useState(null),[l,u]=k.useState(!1),[h,f]=k.useState(""),[p,g]=k.useState("bug"),[_,b]=k.useState(null),[S,x]=k.useState(null),E=k.useContext(ud),T=Da().get_current_firebase_user(),A=c6(),{submitFeedback:U}=rA(),{toggleFeedback:F}=nz(),{updateSortOrder:H}=rz(),O=A.data?.items||[],{addLoadingHold:D,removeLoadingHold:P}=sr();k.useEffect(()=>(A.isLoading?D("settings-feedback","Loading feedback..."):P("settings-feedback"),()=>P("settings-feedback")),[A.isLoading,D,P]);function L($){$.preventDefault(),!(!h.trim()||!E.username||!T)&&(U.mutate({userId:T.uid,userEmail:E.username,text:h.trim(),feedbackType:p,currentPath:"/settings/feedback"}),f(""),g("bug"),u(!1))}function q($){$.is_done?j($):b($)}async function j($){try{await F.mutateAsync({item:$})}catch(te){e(te instanceof Error?te.message:"Failed to update feedback")}}function M(){_&&(j(_),b(null))}async function R($){if(S){try{const ae=O.filter(ne=>ne.doc_id===S.doc_id).map(ne=>({id:ne.id,text:ne.text,created_at:ne.created_at,is_done:ne.is_done,completed_at:ne.completed_at,sort_order:ne.sort_order,feedback_type:ne.id===S.id?$:ne.feedback_type}));await H.mutateAsync({docId:S.doc_id,items:ae})}catch(te){e(te instanceof Error?te.message:"Failed to update feedback type")}x(null)}}const K=O.filter($=>!$.is_done).sort(($,te)=>$.sort_order-te.sort_order),Q=O.filter($=>$.is_done).sort(($,te)=>new Date(te.completed_at||0).getTime()-new Date($.completed_at||0).getTime());function G($,te){r(te),$.dataTransfer.effectAllowed="move"}function X($,te){$.preventDefault(),te!==n&&o(te)}function J(){o(null)}function re(){r(null),o(null)}async function B($,te){if($.preventDefault(),!n||n===te){re();return}const ae=K.findIndex(Ee=>Ee.id===n),ne=[...K],[de]=ne.splice(ae,1);if(te==="__end__")ne.push(de);else{const Ee=ne.findIndex(pe=>pe.id===te);ne.splice(Ee,0,de)}const Se=ne.map((Ee,pe)=>({...Ee,sort_order:pe}));re();const Te=new Map;for(const Ee of Se)Te.has(Ee.doc_id)||Te.set(Ee.doc_id,[]),Te.get(Ee.doc_id).push({id:Ee.id,text:Ee.text,created_at:Ee.created_at,is_done:Ee.is_done,completed_at:Ee.completed_at,sort_order:Ee.sort_order,feedback_type:Ee.feedback_type});for(const Ee of Q)Te.has(Ee.doc_id)||Te.set(Ee.doc_id,[]),Te.get(Ee.doc_id).push({id:Ee.id,text:Ee.text,created_at:Ee.created_at,is_done:Ee.is_done,completed_at:Ee.completed_at,sort_order:Ee.sort_order,feedback_type:Ee.feedback_type});try{for(const[Ee,pe]of Te)await H.mutateAsync({docId:Ee,items:pe})}catch(Ee){e(Ee instanceof Error?Ee.message:"Failed to save order")}}return A.isLoading?null:d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Feedback"}),d.jsx("p",{style:{...QT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."}),t&&d.jsx(Bo,{message:t,onDismiss:()=>e(null)}),d.jsxs("div",{style:Jl,children:[K.length===0&&!l&&d.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),K.map($=>d.jsx(QP,{item:$,isDragging:n===$.id,isDragOver:i===$.id,onDragStart:te=>G(te,$.id),onDragOver:te=>X(te,$.id),onDragLeave:J,onDragEnd:re,onDrop:te=>B(te,$.id),onToggleDone:()=>q($),onTypeClick:()=>x($)},$.id)),n&&K.length>0&&d.jsx(n_,{isActive:i==="__end__",onDragOver:$=>X($,"__end__"),onDragLeave:J,onDrop:$=>B($,"__end__")})]}),l?d.jsxs(xi,{actionName:"Add Feedback",onSubmit:L,children:[d.jsx(cS,{selectedType:p,onSelect:g}),d.jsx(t_,{value:h,onChange:$=>f($.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),d.jsxs(Pa,{children:[d.jsx($e,{type:"submit",actionName:"Add Feedback",disabled:!h.trim(),children:"Add Feedback"}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{u(!1),f(""),g("bug")},children:"Cancel"})]})]}):d.jsx($e,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>u(!0),children:"+ Add Feedback"}),Q.length>0&&d.jsx(r_,{title:"Completed",count:Q.length,children:d.jsx("div",{style:{...Jl,marginTop:"0.5rem"},children:Q.map($=>d.jsx(WP,{item:$,onToggleDone:()=>q($),onTypeClick:()=>x($)},$.id))})}),d.jsxs($s,{isOpen:_!==null,onClose:()=>b(null),title:"Mark as Complete",children:[d.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),_&&d.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',_.text,'"']}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>b(null),children:"Cancel"}),d.jsx($e,{variant:"primary",actionName:"Confirm Mark Complete",onClick:M,children:"Mark Complete"})]})]}),d.jsxs($s,{isOpen:S!==null,onClose:()=>x(null),title:"Change Feedback Type",children:[d.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),d.jsx(cS,{selectedType:S?.feedback_type||"bug",onSelect:R}),d.jsx($e,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>x(null),style:{width:"100%"},children:"Cancel"})]})]})}function YB(){Ue.clear(),window.location.reload()}function XB(){const e=Da().get_current_firebase_user(),{selectedBudgetId:n}=Ze(),r=z3(),i=xP({currentUser:e}),o=nP({currentUser:e}),l=Z3({currentUser:e}),u=lP({currentUser:e}),h=G3({currentUser:e}),f=EP({currentUser:e,budgetId:n}),p=jP({currentUser:e}),g=L3({currentUser:e}),_=U3({currentUser:e}),b=r.isScanning||i.isScanning||o.isScanning||l.isScanning||u.isScanning||h.isScanning||g.isScanning||_.isScanning,S=r.isRunning||o.isRunning||l.isRunning||u.isRunning||h.isRunning||g.isDeleting||_.isDeleting||f.isDownloading||p.isUploading,x=async()=>{await Promise.all([r.scanStatus(),i.scan(),o.scanStatus(),l.scanStatus(),u.scanStatus(),h.scan(),g.scanStatus(),_.scanStatus()])};return d.jsxs("div",{children:[d.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsx("h2",{style:{margin:0},children:"Data Migrations"}),d.jsxs("button",{onClick:x,disabled:b||S,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:b||S?"not-allowed":"pointer",fontWeight:500,opacity:b||S?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[d.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:b?d.jsx(Fn,{noMargin:!0}):""}),"Refresh All"]})]}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),d.jsx(mz,{disabled:!e,onDownloadBackup:f.downloadBudget,isDownloadingBackup:f.isDownloading,ensureUngroupedGroups:{status:r.status,hasData:!!r.status,needsMigration:r.status?r.status.budgetsNeedingUpdate>0:!1,totalBudgetsToUpdate:r.status?.budgetsNeedingUpdate??0,isScanning:r.isScanning,isRunning:r.isRunning,result:r.result,scanStatus:r.scanStatus,runMigration:r.runMigration}}),d.jsx(_z,{disabled:!e,onDownloadBackup:f.downloadBudget,isDownloadingBackup:f.isDownloading,accountCategoryValidation:{status:i.status,hasData:!!i.status,hasViolations:i.hasViolations,violationCount:i.violationCount,isScanning:i.isScanning,report:i.report,scan:i.scan},orphanedIdCleanup:{status:o.status,hasData:!!o.status,hasItemsToFix:o.hasItemsToFix,totalOrphaned:o.status?o.status.orphanedCategoryIds+o.status.orphanedAccountIds:0,isScanning:o.isScanning,isRunning:o.isRunning,result:o.result,scanStatus:o.scanStatus,runMigration:o.runMigration},expenseToAdjustment:{status:l.status,hasData:!!l.status,hasItemsToMigrate:l.hasItemsToMigrate,totalToMigrate:l.status?.expensesToMigrate??0,isScanning:l.isScanning,isRunning:l.isRunning,result:l.result,scanStatus:l.scanStatus,runMigration:l.runMigration},adjustmentsToTransfers:{status:u.status,hasData:!!u.status,hasPairsToConvert:u.hasPairsToConvert,totalPairs:u.status?.pairsFound??0,isScanning:u.isScanning,isRunning:u.isRunning,result:u.result,scanStatus:u.scanStatus,runMigration:u.runMigration},precisionCleanup:{status:h.status,hasData:h.hasData,hasIssues:h.hasIssues,totalIssues:h.totalIssues,isScanning:h.isScanning,isRunning:h.isRunning,result:h.result,scan:h.scan,runCleanup:h.runCleanup}}),d.jsx(Sz,{disabled:!e,onDownloadBackup:f.downloadBudget,isDownloadingBackup:f.isDownloading,budgetDownloadUpload:{isDownloading:f.isDownloading,downloadProgress:f.progress,downloadError:f.error,downloadBudget:f.downloadBudget,isScanning:p.isScanning,isUploading:p.isUploading,uploadStatus:p.status,uploadProgress:p.progress,uploadError:p.error,uploadResult:p.result,scanZipFile:p.scanZipFile,uploadBudget:p.uploadBudget},deleteAllMonths:{status:g.status,hasData:!!g.status,monthsCount:g.status?.monthsCount??0,budgetCount:g.status?.budgetCount??0,isScanning:g.isScanning,isDeleting:g.isDeleting,deleteResult:g.deleteResult,deleteProgress:g.deleteProgress,scanStatus:g.scanStatus,deleteAllMonths:g.deleteAllMonths},deleteSampleUserBudget:{status:_.status,hasData:!!_.status,totalBudgets:_.status?.totalBudgets??0,totalMonths:_.status?.totalMonths??0,isScanning:_.isScanning,isDeleting:_.isDeleting,deleteResult:_.deleteResult,deleteProgress:_.deleteProgress,scanStatus:_.scanStatus,deleteSampleUserBudget:_.deleteSampleUserBudget},onClearCache:YB}),d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:d.jsxs("p",{style:{margin:0,opacity:.7},children:[d.jsx("strong",{children:"Note:"})," These migrations will process ",d.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),d.jsx(KT,{})]})}function Rl({name:t,description:e,expectedBehavior:n,result:r,onRun:i,disabled:o,expectedToSucceed:l}){const u=r?.status==="passed"?ce.success:r?.status==="failed"?ce.danger:r?.status==="running"?ce.warning:"inherit";return d.jsxs("div",{style:{...fd,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[d.jsxs("div",{style:{flex:1},children:[d.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),d.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),d.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:l?ce.success:ce.warning},children:["Expected: ",n]})]}),d.jsx($e,{onClick:i,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&d.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${u} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${u} 30%, transparent)`,fontSize:"0.85rem",color:u},children:r.message})]})}function ZB({totalCount:t,passedCount:e,failedCount:n}){return d.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[d.jsxs("span",{children:["Total: ",d.jsx("strong",{children:t})]}),d.jsxs("span",{style:{color:ce.success},children:["Passed: ",d.jsx("strong",{children:e})]}),d.jsxs("span",{style:{color:ce.danger},children:["Failed: ",d.jsx("strong",{children:n})]})]})}const uS=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function JB(){const{currentUserId:t}=Ze(),[e,n]=k.useState([]),[r,i]=k.useState(!1);function o(b,S){n(x=>x.map(E=>E.name===b?{...E,...S}:E))}async function l(b,S,x){o(b,{status:"running",message:"Running..."});try{const E=await S();x?o(b,{status:"failed",message:` ${E}`}):o(b,{status:"passed",message:` ${E}`})}catch(E){const C=E instanceof Error?E.message:"Unknown error";x?o(b,{status:"passed",message:` Blocked as expected: ${C}`}):o(b,{status:"failed",message:` ${C}`})}}async function u(){i(!0),n(uS.map(b=>({...b,status:"pending",message:""})));for(const b of uS)await h(b.name);i(!1)}async function h(b){switch(b){case"Read unauthorized budget":await l(b,async()=>(await At("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await l(b,async()=>(await At("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await l(b,async()=>(await At("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await l(b,async()=>{if(!t)throw new Error("Not authenticated");const{data:S}=await At("users",t,"security test: reading own user to get current is_admin value"),x=S?.permission_flags?.is_admin??!1;return await If("users",t,{"permission_flags.is_admin":!x},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await l(b,async()=>{if(!t)throw new Error("Not authenticated");const{data:S}=await At("users",t,"security test: reading own user to get current is_test value"),x=S?.permission_flags?.is_test??!1;return await If("users",t,{"permission_flags.is_test":!x},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await l(b,async()=>{if(!t)throw new Error("Not authenticated");const{exists:S}=await At("users",t,"security test: reading own user document (should succeed)");if(S)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function f(b){e.find(x=>x.name===b)||n(x=>[...x,{name:b,status:"pending",message:"",expectedToFail:!0}]),i(!0),await h(b),i(!1)}const p=e.filter(b=>b.status==="passed").length,g=e.filter(b=>b.status==="failed").length,_=e.length;return d.jsxs("div",{children:[d.jsx("p",{style:QT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),d.jsx("div",{style:{marginBottom:"1.5rem"},children:d.jsx($e,{onClick:u,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&d.jsx(ZB,{totalCount:_,passedCount:p,failedCount:g}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[d.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),d.jsx(Rl,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(b=>b.name==="Read unauthorized budget"),onRun:()=>f("Read unauthorized budget"),disabled:r}),d.jsx(Rl,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(b=>b.name==="Read another user's document"),onRun:()=>f("Read another user's document"),disabled:r}),d.jsx(Rl,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(b=>b.name==="Read unauthorized budget month"),onRun:()=>f("Read unauthorized budget month"),disabled:r}),d.jsx(Rl,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(b=>b.name==="Toggle is_admin in own permission_flags"),onRun:()=>f("Toggle is_admin in own permission_flags"),disabled:r}),d.jsx(Rl,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(b=>b.name==="Toggle is_test in own permission_flags"),onRun:()=>f("Toggle is_test in own permission_flags"),disabled:r}),d.jsx(Rl,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(b=>b.name==="Read own user document"),onRun:()=>f("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&d.jsxs(Bo,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function eL({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=sr(),r=k.useContext(ud),i=On();return k.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?d.jsx(d.Fragment,{children:t}):d.jsx(Ff,{}):d.jsx(Uf,{to:"/account",state:{from:i.pathname},replace:!0}):null}function tL(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{isInitialized:n,pageTitle:r}=Ze(),{isLoading:i,error:o}=An();return k.useEffect(()=>{n?e("budget-init"):t("budget-init",i?"Fetching data from server...":"Loading budget...")},[n,i,t,e]),k.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),d.jsx("div",{style:Mf,children:d.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",o.message]})})):d.jsx("div",{style:{...Mf,paddingBottom:"5rem"},children:d.jsxs(iA,{children:[d.jsx(cz,{title:r}),n&&d.jsx(Ff,{})]})})}const nL={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function rL(){const{isLoading:t,loadingMessage:e}=sr();return t?d.jsx(i_,{message:e}):null}function sL(){const[t,e]=k.useState(null);return k.useEffect(()=>xo.subscribe(e),[]),t?d.jsx(D6,{item:t,onDismiss:n=>xo.remove(n)}):null}function iL(){const{selectedBudgetId:t,isInitialized:e}=Ze(),n=Ht(),r=t?["initialDataLoad",t]:null,i=r?n.getQueryState(r)?.status==="success":!1;return vn(),A3(),I3(t,i&&e),d.jsxs(d.Fragment,{children:[d.jsxs(sj,{children:[d.jsx(wn,{path:"/",element:d.jsx(Ez,{})}),d.jsx(wn,{path:"/account",element:d.jsx(Cz,{})}),d.jsx(wn,{path:"/budget",element:d.jsx(eL,{}),children:d.jsxs(wn,{element:d.jsx(tL,{}),children:[d.jsx(wn,{index:!0,element:d.jsx(oS,{})}),d.jsx(wn,{path:":year/:month/:tab/:view?",element:d.jsx(oS,{})}),d.jsx(wn,{path:"analytics",element:d.jsx(wB,{})}),d.jsx(wn,{path:"my-budgets",element:d.jsx(DB,{})}),d.jsxs(wn,{path:"settings",element:d.jsx(OB,{}),children:[d.jsx(wn,{index:!0,element:d.jsx(Uf,{to:"categories",replace:!0})}),d.jsx(wn,{path:"accounts",element:d.jsx(UB,{})}),d.jsx(wn,{path:"categories",element:d.jsx(qB,{})}),d.jsx(wn,{path:"users",element:d.jsx(GB,{})})]}),d.jsxs(wn,{path:"admin",element:d.jsx(QB,{}),children:[d.jsx(wn,{path:"budget",element:d.jsx(WB,{})}),d.jsx(wn,{path:"feedback",element:d.jsx(KB,{})}),d.jsx(wn,{path:"migration",element:d.jsx(XB,{})}),d.jsx(wn,{path:"tests",element:d.jsx(JB,{})})]})]})})]}),d.jsx(az,{}),d.jsx(KT,{}),d.jsx(sL,{})]})}function aL(){const[t,e]=k.useState(nL),n=Da(),r=k.useRef(!1),{addLoadingHold:i,removeLoadingHold:o}=sr();return k.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(l=>{e({is_logged_in:l!=null,is_auth_checked:!0,username:l?.email??"",set_user_context:e})}))},[n]),k.useEffect(()=>{t.is_auth_checked?o("auth"):i("auth","Authenticating...")},[t.is_auth_checked,i,o]),t.is_auth_checked?d.jsx(ud.Provider,{value:t,children:d.jsx(SO,{children:d.jsx(m3,{children:d.jsx(U6,{children:d.jsx(k3,{children:d.jsx(Rj,{children:d.jsx(iL,{})})})})})})}):null}function oL(){return d.jsxs(xR,{children:[d.jsx(rL,{}),d.jsx(aL,{})]})}s2.createRoot(document.getElementById("root")).render(d.jsx(k.StrictMode,{children:d.jsx(oL,{})}));
