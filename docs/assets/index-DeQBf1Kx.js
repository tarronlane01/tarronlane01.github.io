(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();var mg={exports:{}},ou={};var sx;function Ij(){if(sx)return ou;sx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,a,o){var u=null;if(o!==void 0&&(u=""+o),a.key!==void 0&&(u=""+a.key),"key"in a){o={};for(var h in a)h!=="key"&&(o[h]=a[h])}else o=a;return a=o.ref,{$$typeof:t,type:r,key:u,ref:a!==void 0?a:null,props:o}}return ou.Fragment=e,ou.jsx=n,ou.jsxs=n,ou}var ax;function Mj(){return ax||(ax=1,mg.exports=Ij()),mg.exports}var c=Mj(),pg={exports:{}},$e={};var ox;function kj(){if(ox)return $e;ox=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),b=Symbol.iterator;function x(V){return V===null||typeof V!="object"?null:(V=b&&V[b]||V["@@iterator"],typeof V=="function"?V:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,T={};function D(V,q,ee){this.props=V,this.context=q,this.refs=T,this.updater=ee||E}D.prototype.isReactComponent={},D.prototype.setState=function(V,q){if(typeof V!="object"&&typeof V!="function"&&V!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,V,q,"setState")},D.prototype.forceUpdate=function(V){this.updater.enqueueForceUpdate(this,V,"forceUpdate")};function j(){}j.prototype=D.prototype;function M(V,q,ee){this.props=V,this.context=q,this.refs=T,this.updater=ee||E}var K=M.prototype=new j;K.constructor=M,S(K,D.prototype),K.isPureReactComponent=!0;var H=Array.isArray;function Q(){}var P={H:null,A:null,T:null,S:null},k=Object.prototype.hasOwnProperty;function O(V,q,ee){var ne=ee.ref;return{$$typeof:t,type:V,key:q,ref:ne!==void 0?ne:null,props:ee}}function N(V,q){return O(V.type,q,V.props)}function L(V){return typeof V=="object"&&V!==null&&V.$$typeof===t}function U(V){var q={"=":"=0",":":"=2"};return"$"+V.replace(/[=:]/g,function(ee){return q[ee]})}var R=/\/+/g;function Y(V,q){return typeof V=="object"&&V!==null&&V.key!=null?U(""+V.key):q.toString(36)}function W(V){switch(V.status){case"fulfilled":return V.value;case"rejected":throw V.reason;default:switch(typeof V.status=="string"?V.then(Q,Q):(V.status="pending",V.then(function(q){V.status==="pending"&&(V.status="fulfilled",V.value=q)},function(q){V.status==="pending"&&(V.status="rejected",V.reason=q)})),V.status){case"fulfilled":return V.value;case"rejected":throw V.reason}}throw V}function B(V,q,ee,ne,te){var se=typeof V;(se==="undefined"||se==="boolean")&&(V=null);var he=!1;if(V===null)he=!0;else switch(se){case"bigint":case"string":case"number":he=!0;break;case"object":switch(V.$$typeof){case t:case e:he=!0;break;case g:return he=V._init,B(he(V._payload),q,ee,ne,te)}}if(he)return te=te(V),he=ne===""?"."+Y(V,0):ne,H(te)?(ee="",he!=null&&(ee=he.replace(R,"$&/")+"/"),B(te,q,ee,"",function(Z){return Z})):te!=null&&(L(te)&&(te=N(te,ee+(te.key==null||V&&V.key===te.key?"":(""+te.key).replace(R,"$&/")+"/")+he)),q.push(te)),1;he=0;var we=ne===""?".":ne+":";if(H(V))for(var ge=0;ge<V.length;ge++)ne=V[ge],se=we+Y(ne,ge),he+=B(ne,q,ee,se,te);else if(ge=x(V),typeof ge=="function")for(V=ge.call(V),ge=0;!(ne=V.next()).done;)ne=ne.value,se=we+Y(ne,ge++),he+=B(ne,q,ee,se,te);else if(se==="object"){if(typeof V.then=="function")return B(W(V),q,ee,ne,te);throw q=String(V),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(V).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return he}function $(V,q,ee){if(V==null)return V;var ne=[],te=0;return B(V,ne,"","",function(se){return q.call(ee,se,te++)}),ne}function G(V){if(V._status===-1){var q=V._result;q=q(),q.then(function(ee){(V._status===0||V._status===-1)&&(V._status=1,V._result=ee)},function(ee){(V._status===0||V._status===-1)&&(V._status=2,V._result=ee)}),V._status===-1&&(V._status=0,V._result=q)}if(V._status===1)return V._result.default;throw V._result}var J=typeof reportError=="function"?reportError:function(V){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof V=="object"&&V!==null&&typeof V.message=="string"?String(V.message):String(V),error:V});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",V);return}console.error(V)},re={map:$,forEach:function(V,q,ee){$(V,function(){q.apply(this,arguments)},ee)},count:function(V){var q=0;return $(V,function(){q++}),q},toArray:function(V){return $(V,function(q){return q})||[]},only:function(V){if(!L(V))throw Error("React.Children.only expected to receive a single React element child.");return V}};return $e.Activity=_,$e.Children=re,$e.Component=D,$e.Fragment=n,$e.Profiler=a,$e.PureComponent=M,$e.StrictMode=r,$e.Suspense=f,$e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=P,$e.__COMPILER_RUNTIME={__proto__:null,c:function(V){return P.H.useMemoCache(V)}},$e.cache=function(V){return function(){return V.apply(null,arguments)}},$e.cacheSignal=function(){return null},$e.cloneElement=function(V,q,ee){if(V==null)throw Error("The argument must be a React element, but you passed "+V+".");var ne=S({},V.props),te=V.key;if(q!=null)for(se in q.key!==void 0&&(te=""+q.key),q)!k.call(q,se)||se==="key"||se==="__self"||se==="__source"||se==="ref"&&q.ref===void 0||(ne[se]=q[se]);var se=arguments.length-2;if(se===1)ne.children=ee;else if(1<se){for(var he=Array(se),we=0;we<se;we++)he[we]=arguments[we+2];ne.children=he}return O(V.type,te,ne)},$e.createContext=function(V){return V={$$typeof:u,_currentValue:V,_currentValue2:V,_threadCount:0,Provider:null,Consumer:null},V.Provider=V,V.Consumer={$$typeof:o,_context:V},V},$e.createElement=function(V,q,ee){var ne,te={},se=null;if(q!=null)for(ne in q.key!==void 0&&(se=""+q.key),q)k.call(q,ne)&&ne!=="key"&&ne!=="__self"&&ne!=="__source"&&(te[ne]=q[ne]);var he=arguments.length-2;if(he===1)te.children=ee;else if(1<he){for(var we=Array(he),ge=0;ge<he;ge++)we[ge]=arguments[ge+2];te.children=we}if(V&&V.defaultProps)for(ne in he=V.defaultProps,he)te[ne]===void 0&&(te[ne]=he[ne]);return O(V,se,te)},$e.createRef=function(){return{current:null}},$e.forwardRef=function(V){return{$$typeof:h,render:V}},$e.isValidElement=L,$e.lazy=function(V){return{$$typeof:g,_payload:{_status:-1,_result:V},_init:G}},$e.memo=function(V,q){return{$$typeof:m,type:V,compare:q===void 0?null:q}},$e.startTransition=function(V){var q=P.T,ee={};P.T=ee;try{var ne=V(),te=P.S;te!==null&&te(ee,ne),typeof ne=="object"&&ne!==null&&typeof ne.then=="function"&&ne.then(Q,J)}catch(se){J(se)}finally{q!==null&&ee.types!==null&&(q.types=ee.types),P.T=q}},$e.unstable_useCacheRefresh=function(){return P.H.useCacheRefresh()},$e.use=function(V){return P.H.use(V)},$e.useActionState=function(V,q,ee){return P.H.useActionState(V,q,ee)},$e.useCallback=function(V,q){return P.H.useCallback(V,q)},$e.useContext=function(V){return P.H.useContext(V)},$e.useDebugValue=function(){},$e.useDeferredValue=function(V,q){return P.H.useDeferredValue(V,q)},$e.useEffect=function(V,q){return P.H.useEffect(V,q)},$e.useEffectEvent=function(V){return P.H.useEffectEvent(V)},$e.useId=function(){return P.H.useId()},$e.useImperativeHandle=function(V,q,ee){return P.H.useImperativeHandle(V,q,ee)},$e.useInsertionEffect=function(V,q){return P.H.useInsertionEffect(V,q)},$e.useLayoutEffect=function(V,q){return P.H.useLayoutEffect(V,q)},$e.useMemo=function(V,q){return P.H.useMemo(V,q)},$e.useOptimistic=function(V,q){return P.H.useOptimistic(V,q)},$e.useReducer=function(V,q,ee){return P.H.useReducer(V,q,ee)},$e.useRef=function(V){return P.H.useRef(V)},$e.useState=function(V){return P.H.useState(V)},$e.useSyncExternalStore=function(V,q,ee){return P.H.useSyncExternalStore(V,q,ee)},$e.useTransition=function(){return P.H.useTransition()},$e.version="19.2.3",$e}var lx;function Cy(){return lx||(lx=1,pg.exports=kj()),pg.exports}var C=Cy(),gg={exports:{}},lu={},yg={exports:{}},_g={};var cx;function Oj(){return cx||(cx=1,(function(t){function e(B,$){var G=B.length;B.push($);e:for(;0<G;){var J=G-1>>>1,re=B[J];if(0<a(re,$))B[J]=$,B[G]=re,G=J;else break e}}function n(B){return B.length===0?null:B[0]}function r(B){if(B.length===0)return null;var $=B[0],G=B.pop();if(G!==$){B[0]=G;e:for(var J=0,re=B.length,V=re>>>1;J<V;){var q=2*(J+1)-1,ee=B[q],ne=q+1,te=B[ne];if(0>a(ee,G))ne<re&&0>a(te,ee)?(B[J]=te,B[ne]=G,J=ne):(B[J]=ee,B[q]=G,J=q);else if(ne<re&&0>a(te,G))B[J]=te,B[ne]=G,J=ne;else break e}}return $}function a(B,$){var G=B.sortIndex-$.sortIndex;return G!==0?G:B.id-$.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var u=Date,h=u.now();t.unstable_now=function(){return u.now()-h}}var f=[],m=[],g=1,_=null,b=3,x=!1,E=!1,S=!1,T=!1,D=typeof setTimeout=="function"?setTimeout:null,j=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function K(B){for(var $=n(m);$!==null;){if($.callback===null)r(m);else if($.startTime<=B)r(m),$.sortIndex=$.expirationTime,e(f,$);else break;$=n(m)}}function H(B){if(S=!1,K(B),!E)if(n(f)!==null)E=!0,Q||(Q=!0,U());else{var $=n(m);$!==null&&W(H,$.startTime-B)}}var Q=!1,P=-1,k=5,O=-1;function N(){return T?!0:!(t.unstable_now()-O<k)}function L(){if(T=!1,Q){var B=t.unstable_now();O=B;var $=!0;try{e:{E=!1,S&&(S=!1,j(P),P=-1),x=!0;var G=b;try{t:{for(K(B),_=n(f);_!==null&&!(_.expirationTime>B&&N());){var J=_.callback;if(typeof J=="function"){_.callback=null,b=_.priorityLevel;var re=J(_.expirationTime<=B);if(B=t.unstable_now(),typeof re=="function"){_.callback=re,K(B),$=!0;break t}_===n(f)&&r(f),K(B)}else r(f);_=n(f)}if(_!==null)$=!0;else{var V=n(m);V!==null&&W(H,V.startTime-B),$=!1}}break e}finally{_=null,b=G,x=!1}$=void 0}}finally{$?U():Q=!1}}}var U;if(typeof M=="function")U=function(){M(L)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,Y=R.port2;R.port1.onmessage=L,U=function(){Y.postMessage(null)}}else U=function(){D(L,0)};function W(B,$){P=D(function(){B(t.unstable_now())},$)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(B){B.callback=null},t.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<B?Math.floor(1e3/B):5},t.unstable_getCurrentPriorityLevel=function(){return b},t.unstable_next=function(B){switch(b){case 1:case 2:case 3:var $=3;break;default:$=b}var G=b;b=$;try{return B()}finally{b=G}},t.unstable_requestPaint=function(){T=!0},t.unstable_runWithPriority=function(B,$){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var G=b;b=B;try{return $()}finally{b=G}},t.unstable_scheduleCallback=function(B,$,G){var J=t.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?J+G:J):G=J,B){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=G+re,B={id:g++,callback:$,priorityLevel:B,startTime:G,expirationTime:re,sortIndex:-1},G>J?(B.sortIndex=G,e(m,B),n(f)===null&&B===n(m)&&(S?(j(P),P=-1):S=!0,W(H,G-J))):(B.sortIndex=re,e(f,B),E||x||(E=!0,Q||(Q=!0,U()))),B},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(B){var $=b;return function(){var G=b;b=$;try{return B.apply(this,arguments)}finally{b=G}}}})(_g)),_g}var ux;function Nj(){return ux||(ux=1,yg.exports=Oj()),yg.exports}var bg={exports:{}},kn={};var dx;function Pj(){if(dx)return kn;dx=1;var t=Cy();function e(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)m+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(f,m,g){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:_==null?null:""+_,children:f,containerInfo:m,implementation:g}}var u=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,m){if(f==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return kn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,kn.createPortal=function(f,m){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return o(f,m,null,g)},kn.flushSync=function(f){var m=u.T,g=r.p;try{if(u.T=null,r.p=2,f)return f()}finally{u.T=m,r.p=g,r.d.f()}},kn.preconnect=function(f,m){typeof f=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,r.d.C(f,m))},kn.prefetchDNS=function(f){typeof f=="string"&&r.d.D(f)},kn.preinit=function(f,m){if(typeof f=="string"&&m&&typeof m.as=="string"){var g=m.as,_=h(g,m.crossOrigin),b=typeof m.integrity=="string"?m.integrity:void 0,x=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;g==="style"?r.d.S(f,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:_,integrity:b,fetchPriority:x}):g==="script"&&r.d.X(f,{crossOrigin:_,integrity:b,fetchPriority:x,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},kn.preinitModule=function(f,m){if(typeof f=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var g=h(m.as,m.crossOrigin);r.d.M(f,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&r.d.M(f)},kn.preload=function(f,m){if(typeof f=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var g=m.as,_=h(g,m.crossOrigin);r.d.L(f,g,{crossOrigin:_,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},kn.preloadModule=function(f,m){if(typeof f=="string")if(m){var g=h(m.as,m.crossOrigin);r.d.m(f,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else r.d.m(f)},kn.requestFormReset=function(f){r.d.r(f)},kn.unstable_batchedUpdates=function(f,m){return f(m)},kn.useFormState=function(f,m,g){return u.H.useFormState(f,m,g)},kn.useFormStatus=function(){return u.H.useHostTransitionStatus()},kn.version="19.2.3",kn}var hx;function Lj(){if(hx)return bg.exports;hx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),bg.exports=Pj(),bg.exports}var fx;function Bj(){if(fx)return lu;fx=1;var t=Nj(),e=Cy(),n=Lj();function r(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function o(i){var s=i,l=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(l=s.return),i=s.return;while(i)}return s.tag===3?l:null}function u(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function h(i){if(i.tag===31){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function f(i){if(o(i)!==i)throw Error(r(188))}function m(i){var s=i.alternate;if(!s){if(s=o(i),s===null)throw Error(r(188));return s!==i?null:i}for(var l=i,d=s;;){var y=l.return;if(y===null)break;var v=y.alternate;if(v===null){if(d=y.return,d!==null){l=d;continue}break}if(y.child===v.child){for(v=y.child;v;){if(v===l)return f(y),i;if(v===d)return f(y),s;v=v.sibling}throw Error(r(188))}if(l.return!==d.return)l=y,d=v;else{for(var A=!1,z=y.child;z;){if(z===l){A=!0,l=y,d=v;break}if(z===d){A=!0,d=y,l=v;break}z=z.sibling}if(!A){for(z=v.child;z;){if(z===l){A=!0,l=v,d=y;break}if(z===d){A=!0,d=v,l=y;break}z=z.sibling}if(!A)throw Error(r(189))}}if(l.alternate!==d)throw Error(r(190))}if(l.tag!==3)throw Error(r(188));return l.stateNode.current===l?i:s}function g(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=g(i),s!==null)return s;i=i.sibling}return null}var _=Object.assign,b=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),j=Symbol.for("react.consumer"),M=Symbol.for("react.context"),K=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),Q=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),O=Symbol.for("react.activity"),N=Symbol.for("react.memo_cache_sentinel"),L=Symbol.iterator;function U(i){return i===null||typeof i!="object"?null:(i=L&&i[L]||i["@@iterator"],typeof i=="function"?i:null)}var R=Symbol.for("react.client.reference");function Y(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===R?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case S:return"Fragment";case D:return"Profiler";case T:return"StrictMode";case H:return"Suspense";case Q:return"SuspenseList";case O:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case E:return"Portal";case M:return i.displayName||"Context";case j:return(i._context.displayName||"Context")+".Consumer";case K:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case P:return s=i.displayName||null,s!==null?s:Y(i.type)||"Memo";case k:s=i._payload,i=i._init;try{return Y(i(s))}catch{}}return null}var W=Array.isArray,B=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G={pending:!1,data:null,method:null,action:null},J=[],re=-1;function V(i){return{current:i}}function q(i){0>re||(i.current=J[re],J[re]=null,re--)}function ee(i,s){re++,J[re]=i.current,i.current=s}var ne=V(null),te=V(null),se=V(null),he=V(null);function we(i,s){switch(ee(se,s),ee(te,i),ee(ne,null),s.nodeType){case 9:case 11:i=(i=s.documentElement)&&(i=i.namespaceURI)?jv(i):0;break;default:if(i=s.tagName,s=s.namespaceURI)s=jv(s),i=Rv(s,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}q(ne),ee(ne,i)}function ge(){q(ne),q(te),q(se)}function Z(i){i.memoizedState!==null&&ee(he,i);var s=ne.current,l=Rv(s,i.type);s!==l&&(ee(te,i),ee(ne,l))}function ve(i){te.current===i&&(q(ne),q(te)),he.current===i&&(q(he),ru._currentValue=G)}var Te,dt;function Me(i){if(Te===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);Te=s&&s[1]||"",dt=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Te+i+dt}var ke=!1;function lt(i,s){if(!i||ke)return"";ke=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(s){var be=function(){throw Error()};if(Object.defineProperty(be.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(be,[])}catch(me){var de=me}Reflect.construct(i,[],be)}else{try{be.call()}catch(me){de=me}i.call(be.prototype)}}else{try{throw Error()}catch(me){de=me}(be=i())&&typeof be.catch=="function"&&be.catch(function(){})}}catch(me){if(me&&de&&typeof me.stack=="string")return[me.stack,de.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=d.DetermineComponentFrameRoot(),A=v[0],z=v[1];if(A&&z){var X=A.split(`
`),ue=z.split(`
`);for(y=d=0;d<X.length&&!X[d].includes("DetermineComponentFrameRoot");)d++;for(;y<ue.length&&!ue[y].includes("DetermineComponentFrameRoot");)y++;if(d===X.length||y===ue.length)for(d=X.length-1,y=ue.length-1;1<=d&&0<=y&&X[d]!==ue[y];)y--;for(;1<=d&&0<=y;d--,y--)if(X[d]!==ue[y]){if(d!==1||y!==1)do if(d--,y--,0>y||X[d]!==ue[y]){var pe=`
`+X[d].replace(" at new "," at ");return i.displayName&&pe.includes("<anonymous>")&&(pe=pe.replace("<anonymous>",i.displayName)),pe}while(1<=d&&0<=y);break}}}finally{ke=!1,Error.prepareStackTrace=l}return(l=i?i.displayName||i.name:"")?Me(l):""}function rr(i,s){switch(i.tag){case 26:case 27:case 5:return Me(i.type);case 16:return Me("Lazy");case 13:return i.child!==s&&s!==null?Me("Suspense Fallback"):Me("Suspense");case 19:return Me("SuspenseList");case 0:case 15:return lt(i.type,!1);case 11:return lt(i.type.render,!1);case 1:return lt(i.type,!0);case 31:return Me("Activity");default:return""}}function ii(i){try{var s="",l=null;do s+=rr(i,l),l=i,i=i.return;while(i);return s}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var Et=Object.prototype.hasOwnProperty,Ft=t.unstable_scheduleCallback,at=t.unstable_cancelCallback,ln=t.unstable_shouldYield,_s=t.unstable_requestPaint,cn=t.unstable_now,Lr=t.unstable_getCurrentPriorityLevel,ac=t.unstable_ImmediatePriority,oc=t.unstable_UserBlockingPriority,bs=t.unstable_NormalPriority,ym=t.unstable_LowPriority,rd=t.unstable_IdlePriority,id=t.log,sd=t.unstable_setDisableYieldValue,Br=null,Sn=null;function _r(i){if(typeof id=="function"&&sd(i),Sn&&typeof Sn.setStrictMode=="function")try{Sn.setStrictMode(Br,i)}catch{}}var $t=Math.clz32?Math.clz32:od,ad=Math.log,wo=Math.LN2;function od(i){return i>>>=0,i===0?32:31-(ad(i)/wo|0)|0}var si=256,Aa=262144,Kt=4194304;function ai(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function oi(i,s,l){var d=i.pendingLanes;if(d===0)return 0;var y=0,v=i.suspendedLanes,A=i.pingedLanes;i=i.warmLanes;var z=d&134217727;return z!==0?(d=z&~v,d!==0?y=ai(d):(A&=z,A!==0?y=ai(A):l||(l=z&~i,l!==0&&(y=ai(l))))):(z=d&~v,z!==0?y=ai(z):A!==0?y=ai(A):l||(l=d&~i,l!==0&&(y=ai(l)))),y===0?0:s!==0&&s!==y&&(s&v)===0&&(v=y&-y,l=s&-s,v>=l||v===32&&(l&4194048)!==0)?s:y}function zr(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function _m(i,s){switch(i){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ld(){var i=Kt;return Kt<<=1,(Kt&62914560)===0&&(Kt=4194304),i}function li(i){for(var s=[],l=0;31>l;l++)s.push(i);return s}function ja(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function bm(i,s,l,d,y,v){var A=i.pendingLanes;i.pendingLanes=l,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=l,i.entangledLanes&=l,i.errorRecoveryDisabledLanes&=l,i.shellSuspendCounter=0;var z=i.entanglements,X=i.expirationTimes,ue=i.hiddenUpdates;for(l=A&~l;0<l;){var pe=31-$t(l),be=1<<pe;z[pe]=0,X[pe]=-1;var de=ue[pe];if(de!==null)for(ue[pe]=null,pe=0;pe<de.length;pe++){var me=de[pe];me!==null&&(me.lane&=-536870913)}l&=~be}d!==0&&Ra(i,d,0),v!==0&&y===0&&i.tag!==0&&(i.suspendedLanes|=v&~(A&~s))}function Ra(i,s,l){i.pendingLanes|=s,i.suspendedLanes&=~s;var d=31-$t(s);i.entangledLanes|=s,i.entanglements[d]=i.entanglements[d]|1073741824|l&261930}function lc(i,s){var l=i.entangledLanes|=s;for(i=i.entanglements;l;){var d=31-$t(l),y=1<<d;y&s|i[d]&s&&(i[d]|=s),l&=~y}}function cc(i,s){var l=s&-s;return l=(l&42)!==0?1:Da(l),(l&(i.suspendedLanes|s))!==0?0:l}function Da(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function zi(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function cd(){var i=$.p;return i!==0?i:(i=window.event,i===void 0?32:Jv(i.type))}function Ur(i,s){var l=$.p;try{return $.p=i,s()}finally{$.p=l}}var Vr=Math.random().toString(36).slice(2),Yt="__reactFiber$"+Vr,yn="__reactProps$"+Vr,ci="__reactContainer$"+Vr,Eo="__reactEvents$"+Vr,vm="__reactListeners$"+Vr,ud="__reactHandles$"+Vr,dd="__reactResources$"+Vr,ui="__reactMarker$"+Vr;function Co(i){delete i[Yt],delete i[yn],delete i[Eo],delete i[vm],delete i[ud]}function di(i){var s=i[Yt];if(s)return s;for(var l=i.parentNode;l;){if(s=l[ci]||l[Yt]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(i=Pv(i);i!==null;){if(l=i[Yt])return l;i=Pv(i)}return s}i=l,l=i.parentNode}return null}function br(i){if(i=i[Yt]||i[ci]){var s=i.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return i}return null}function ir(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(r(33))}function hi(i){var s=i[dd];return s||(s=i[dd]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Xt(i){i[ui]=!0}var uc=new Set,dc={};function fi(i,s){mi(i,s),mi(i+"Capture",s)}function mi(i,s){for(dc[i]=s,i=0;i<s.length;i++)uc.add(s[i])}var hc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),fc={},mc={};function hd(i){return Et.call(mc,i)?!0:Et.call(fc,i)?!1:hc.test(i)?mc[i]=!0:(fc[i]=!0,!1)}function To(i,s,l){if(hd(s))if(l===null)i.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var d=s.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+l)}}function sr(i,s,l){if(l===null)i.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+l)}}function Jt(i,s,l,d){if(d===null)i.removeAttribute(l);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(l);return}i.setAttributeNS(s,l,""+d)}}function _n(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function vs(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function pc(i,s,l){var d=Object.getOwnPropertyDescriptor(i.constructor.prototype,s);if(!i.hasOwnProperty(s)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var y=d.get,v=d.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return y.call(this)},set:function(A){l=""+A,v.call(this,A)}}),Object.defineProperty(i,s,{enumerable:d.enumerable}),{getValue:function(){return l},setValue:function(A){l=""+A},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function gt(i){if(!i._valueTracker){var s=vs(i)?"checked":"value";i._valueTracker=pc(i,s,""+i[s])}}function Ia(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var l=s.getValue(),d="";return i&&(d=vs(i)?i.checked?"true":"false":i.value),i=d,i!==l?(s.setValue(i),!0):!1}function pi(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Ma=/[\n"\\]/g;function Gn(i){return i.replace(Ma,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Ao(i,s,l,d,y,v,A,z){i.name="",A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?i.type=A:i.removeAttribute("type"),s!=null?A==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+_n(s)):i.value!==""+_n(s)&&(i.value=""+_n(s)):A!=="submit"&&A!=="reset"||i.removeAttribute("value"),s!=null?gc(i,A,_n(s)):l!=null?gc(i,A,_n(l)):d!=null&&i.removeAttribute("value"),y==null&&v!=null&&(i.defaultChecked=!!v),y!=null&&(i.checked=y&&typeof y!="function"&&typeof y!="symbol"),z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?i.name=""+_n(z):i.removeAttribute("name")}function fd(i,s,l,d,y,v,A,z){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(i.type=v),s!=null||l!=null){if(!(v!=="submit"&&v!=="reset"||s!=null)){gt(i);return}l=l!=null?""+_n(l):"",s=s!=null?""+_n(s):l,z||s===i.value||(i.value=s),i.defaultValue=s}d=d??y,d=typeof d!="function"&&typeof d!="symbol"&&!!d,i.checked=z?i.checked:!!d,i.defaultChecked=!!d,A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(i.name=A),gt(i)}function gc(i,s,l){s==="number"&&pi(i.ownerDocument)===i||i.defaultValue===""+l||(i.defaultValue=""+l)}function xs(i,s,l,d){if(i=i.options,s){s={};for(var y=0;y<l.length;y++)s["$"+l[y]]=!0;for(l=0;l<i.length;l++)y=s.hasOwnProperty("$"+i[l].value),i[l].selected!==y&&(i[l].selected=y),y&&d&&(i[l].defaultSelected=!0)}else{for(l=""+_n(l),s=null,y=0;y<i.length;y++){if(i[y].value===l){i[y].selected=!0,d&&(i[y].defaultSelected=!0);return}s!==null||i[y].disabled||(s=i[y])}s!==null&&(s.selected=!0)}}function md(i,s,l){if(s!=null&&(s=""+_n(s),s!==i.value&&(i.value=s),l==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=l!=null?""+_n(l):""}function Ss(i,s,l,d){if(s==null){if(d!=null){if(l!=null)throw Error(r(92));if(W(d)){if(1<d.length)throw Error(r(93));d=d[0]}l=d}l==null&&(l=""),s=l}l=_n(s),i.defaultValue=l,d=i.textContent,d===l&&d!==""&&d!==null&&(i.value=d),gt(i)}function Qn(i,s){if(s){var l=i.firstChild;if(l&&l===i.lastChild&&l.nodeType===3){l.nodeValue=s;return}}i.textContent=s}var pd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function yc(i,s,l){var d=s.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?d?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":d?i.setProperty(s,l):typeof l!="number"||l===0||pd.has(s)?s==="float"?i.cssFloat=l:i[s]=(""+l).trim():i[s]=l+"px"}function _c(i,s,l){if(s!=null&&typeof s!="object")throw Error(r(62));if(i=i.style,l!=null){for(var d in l)!l.hasOwnProperty(d)||s!=null&&s.hasOwnProperty(d)||(d.indexOf("--")===0?i.setProperty(d,""):d==="float"?i.cssFloat="":i[d]="");for(var y in s)d=s[y],s.hasOwnProperty(y)&&l[y]!==d&&yc(i,y,d)}else for(var v in s)s.hasOwnProperty(v)&&yc(i,v,s[v])}function jo(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ws=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ro(i){return ws.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function Fr(){}var bc=null;function vr(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Es=null,gi=null;function ka(i){var s=br(i);if(s&&(i=s.stateNode)){var l=i[yn]||null;e:switch(i=s.stateNode,s.type){case"input":if(Ao(i,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),s=l.name,l.type==="radio"&&s!=null){for(l=i;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Gn(""+s)+'"][type="radio"]'),s=0;s<l.length;s++){var d=l[s];if(d!==i&&d.form===i.form){var y=d[yn]||null;if(!y)throw Error(r(90));Ao(d,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(s=0;s<l.length;s++)d=l[s],d.form===i.form&&Ia(d)}break e;case"textarea":md(i,l.value,l.defaultValue);break e;case"select":s=l.value,s!=null&&xs(i,!!l.multiple,s,!1)}}}var Do=!1;function Cs(i,s,l){if(Do)return i(s,l);Do=!0;try{var d=i(s);return d}finally{if(Do=!1,(Es!==null||gi!==null)&&(ch(),Es&&(s=Es,i=gi,gi=Es=null,ka(s),i)))for(s=0;s<i.length;s++)ka(i[s])}}function $r(i,s){var l=i.stateNode;if(l===null)return null;var d=l[yn]||null;if(d===null)return null;l=d[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(i=i.type,d=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!d;break e;default:i=!1}if(i)return null;if(l&&typeof l!="function")throw Error(r(231,s,typeof l));return l}var xr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Oa=!1;if(xr)try{var bt={};Object.defineProperty(bt,"passive",{get:function(){Oa=!0}}),window.addEventListener("test",bt,bt),window.removeEventListener("test",bt,bt)}catch{Oa=!1}var yi=null,vc=null,Na=null;function xc(){if(Na)return Na;var i,s=vc,l=s.length,d,y="value"in yi?yi.value:yi.textContent,v=y.length;for(i=0;i<l&&s[i]===y[i];i++);var A=l-i;for(d=1;d<=A&&s[l-d]===y[v-d];d++);return Na=y.slice(i,1<d?1-d:void 0)}function Pa(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function Ui(){return!0}function qr(){return!1}function wn(i){function s(l,d,y,v,A){this._reactName=l,this._targetInst=y,this.type=d,this.nativeEvent=v,this.target=A,this.currentTarget=null;for(var z in i)i.hasOwnProperty(z)&&(l=i[z],this[z]=l?l(v):v[z]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Ui:qr,this.isPropagationStopped=qr,this}return _(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Ui)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Ui)},persist:function(){},isPersistent:Ui}),s}var Vi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_i=wn(Vi),Ts=_({},Vi,{view:0,detail:0}),Sc=wn(Ts),As,Io,bi,Mo=_({},Ts,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:js,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==bi&&(bi&&i.type==="mousemove"?(As=i.screenX-bi.screenX,Io=i.screenY-bi.screenY):Io=As=0,bi=i),As)},movementY:function(i){return"movementY"in i?i.movementY:Io}}),wc=wn(Mo),La=_({},Mo,{dataTransfer:0}),yd=wn(La),_d=_({},Ts,{relatedTarget:0}),Ba=wn(_d),Ec=_({},Vi,{animationName:0,elapsedTime:0,pseudoElement:0}),bd=wn(Ec),ko=_({},Vi,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),vd=wn(ko),xd=_({},Vi,{data:0}),vi=wn(xd),Sd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ed={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cd(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=Ed[i])?!!s[i]:!1}function js(){return Cd}var Un=_({},Ts,{key:function(i){if(i.key){var s=Sd[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=Pa(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?wd[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:js,charCode:function(i){return i.type==="keypress"?Pa(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Pa(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Td=wn(Un),Ad=_({},Mo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fi=wn(Ad),p=_({},Ts,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:js}),w=wn(p),I=_({},Vi,{propertyName:0,elapsedTime:0,pseudoElement:0}),F=wn(I),le=_({},Mo,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),fe=wn(le),Ce=_({},Vi,{newState:0,oldState:0}),He=wn(Ce),qt=[9,13,27,32],ht=xr&&"CompositionEvent"in window,Mt=null;xr&&"documentMode"in document&&(Mt=document.documentMode);var Sr=xr&&"TextEvent"in window&&!Mt,xi=xr&&(!ht||Mt&&8<Mt&&11>=Mt),Hr=" ",Gr=!1;function za(i,s){switch(i){case"keyup":return qt.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Oo(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var No=!1;function tA(i,s){switch(i){case"compositionend":return Oo(s);case"keypress":return s.which!==32?null:(Gr=!0,Hr);case"textInput":return i=s.data,i===Hr&&Gr?null:i;default:return null}}function nA(i,s){if(No)return i==="compositionend"||!ht&&za(i,s)?(i=xc(),Na=vc=yi=null,No=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return xi&&s.locale!=="ko"?null:s.data;default:return null}}var rA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function z0(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!rA[i.type]:s==="textarea"}function U0(i,s,l,d){Es?gi?gi.push(d):gi=[d]:Es=d,s=gh(s,"onChange"),0<s.length&&(l=new _i("onChange","change",null,l,d),i.push({event:l,listeners:s}))}var Cc=null,Tc=null;function iA(i){Sv(i,0)}function jd(i){var s=ir(i);if(Ia(s))return i}function V0(i,s){if(i==="change")return s}var F0=!1;if(xr){var xm;if(xr){var Sm="oninput"in document;if(!Sm){var $0=document.createElement("div");$0.setAttribute("oninput","return;"),Sm=typeof $0.oninput=="function"}xm=Sm}else xm=!1;F0=xm&&(!document.documentMode||9<document.documentMode)}function q0(){Cc&&(Cc.detachEvent("onpropertychange",H0),Tc=Cc=null)}function H0(i){if(i.propertyName==="value"&&jd(Tc)){var s=[];U0(s,Tc,i,vr(i)),Cs(iA,s)}}function sA(i,s,l){i==="focusin"?(q0(),Cc=s,Tc=l,Cc.attachEvent("onpropertychange",H0)):i==="focusout"&&q0()}function aA(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return jd(Tc)}function oA(i,s){if(i==="click")return jd(s)}function lA(i,s){if(i==="input"||i==="change")return jd(s)}function cA(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var ar=typeof Object.is=="function"?Object.is:cA;function Ac(i,s){if(ar(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var l=Object.keys(i),d=Object.keys(s);if(l.length!==d.length)return!1;for(d=0;d<l.length;d++){var y=l[d];if(!Et.call(s,y)||!ar(i[y],s[y]))return!1}return!0}function G0(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Q0(i,s){var l=G0(i);i=0;for(var d;l;){if(l.nodeType===3){if(d=i+l.textContent.length,i<=s&&d>=s)return{node:l,offset:s-i};i=d}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=G0(l)}}function W0(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?W0(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function K0(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=pi(i.document);s instanceof i.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)i=s.contentWindow;else break;s=pi(i.document)}return s}function wm(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}var uA=xr&&"documentMode"in document&&11>=document.documentMode,Po=null,Em=null,jc=null,Cm=!1;function Y0(i,s,l){var d=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Cm||Po==null||Po!==pi(d)||(d=Po,"selectionStart"in d&&wm(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),jc&&Ac(jc,d)||(jc=d,d=gh(Em,"onSelect"),0<d.length&&(s=new _i("onSelect","select",null,s,l),i.push({event:s,listeners:d}),s.target=Po)))}function Ua(i,s){var l={};return l[i.toLowerCase()]=s.toLowerCase(),l["Webkit"+i]="webkit"+s,l["Moz"+i]="moz"+s,l}var Lo={animationend:Ua("Animation","AnimationEnd"),animationiteration:Ua("Animation","AnimationIteration"),animationstart:Ua("Animation","AnimationStart"),transitionrun:Ua("Transition","TransitionRun"),transitionstart:Ua("Transition","TransitionStart"),transitioncancel:Ua("Transition","TransitionCancel"),transitionend:Ua("Transition","TransitionEnd")},Tm={},X0={};xr&&(X0=document.createElement("div").style,"AnimationEvent"in window||(delete Lo.animationend.animation,delete Lo.animationiteration.animation,delete Lo.animationstart.animation),"TransitionEvent"in window||delete Lo.transitionend.transition);function Va(i){if(Tm[i])return Tm[i];if(!Lo[i])return i;var s=Lo[i],l;for(l in s)if(s.hasOwnProperty(l)&&l in X0)return Tm[i]=s[l];return i}var J0=Va("animationend"),Z0=Va("animationiteration"),e_=Va("animationstart"),dA=Va("transitionrun"),hA=Va("transitionstart"),fA=Va("transitioncancel"),t_=Va("transitionend"),n_=new Map,Am="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Am.push("scrollEnd");function Qr(i,s){n_.set(i,s),fi(s,[i])}var Rd=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},wr=[],Bo=0,jm=0;function Dd(){for(var i=Bo,s=jm=Bo=0;s<i;){var l=wr[s];wr[s++]=null;var d=wr[s];wr[s++]=null;var y=wr[s];wr[s++]=null;var v=wr[s];if(wr[s++]=null,d!==null&&y!==null){var A=d.pending;A===null?y.next=y:(y.next=A.next,A.next=y),d.pending=y}v!==0&&r_(l,y,v)}}function Id(i,s,l,d){wr[Bo++]=i,wr[Bo++]=s,wr[Bo++]=l,wr[Bo++]=d,jm|=d,i.lanes|=d,i=i.alternate,i!==null&&(i.lanes|=d)}function Rm(i,s,l,d){return Id(i,s,l,d),Md(i)}function Fa(i,s){return Id(i,null,null,s),Md(i)}function r_(i,s,l){i.lanes|=l;var d=i.alternate;d!==null&&(d.lanes|=l);for(var y=!1,v=i.return;v!==null;)v.childLanes|=l,d=v.alternate,d!==null&&(d.childLanes|=l),v.tag===22&&(i=v.stateNode,i===null||i._visibility&1||(y=!0)),i=v,v=v.return;return i.tag===3?(v=i.stateNode,y&&s!==null&&(y=31-$t(l),i=v.hiddenUpdates,d=i[y],d===null?i[y]=[s]:d.push(s),s.lane=l|536870912),v):null}function Md(i){if(50<Yc)throw Yc=0,Bp=null,Error(r(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var zo={};function mA(i,s,l,d){this.tag=i,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function or(i,s,l,d){return new mA(i,s,l,d)}function Dm(i){return i=i.prototype,!(!i||!i.isReactComponent)}function $i(i,s){var l=i.alternate;return l===null?(l=or(i.tag,s,i.key,i.mode),l.elementType=i.elementType,l.type=i.type,l.stateNode=i.stateNode,l.alternate=i,i.alternate=l):(l.pendingProps=s,l.type=i.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=i.flags&65011712,l.childLanes=i.childLanes,l.lanes=i.lanes,l.child=i.child,l.memoizedProps=i.memoizedProps,l.memoizedState=i.memoizedState,l.updateQueue=i.updateQueue,s=i.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=i.sibling,l.index=i.index,l.ref=i.ref,l.refCleanup=i.refCleanup,l}function i_(i,s){i.flags&=65011714;var l=i.alternate;return l===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,s=l.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function kd(i,s,l,d,y,v){var A=0;if(d=i,typeof i=="function")Dm(i)&&(A=1);else if(typeof i=="string")A=bj(i,l,ne.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case O:return i=or(31,l,s,y),i.elementType=O,i.lanes=v,i;case S:return $a(l.children,y,v,s);case T:A=8,y|=24;break;case D:return i=or(12,l,s,y|2),i.elementType=D,i.lanes=v,i;case H:return i=or(13,l,s,y),i.elementType=H,i.lanes=v,i;case Q:return i=or(19,l,s,y),i.elementType=Q,i.lanes=v,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case M:A=10;break e;case j:A=9;break e;case K:A=11;break e;case P:A=14;break e;case k:A=16,d=null;break e}A=29,l=Error(r(130,i===null?"null":typeof i,"")),d=null}return s=or(A,l,s,y),s.elementType=i,s.type=d,s.lanes=v,s}function $a(i,s,l,d){return i=or(7,i,d,s),i.lanes=l,i}function Im(i,s,l){return i=or(6,i,null,s),i.lanes=l,i}function s_(i){var s=or(18,null,null,0);return s.stateNode=i,s}function Mm(i,s,l){return s=or(4,i.children!==null?i.children:[],i.key,s),s.lanes=l,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}var a_=new WeakMap;function Er(i,s){if(typeof i=="object"&&i!==null){var l=a_.get(i);return l!==void 0?l:(s={value:i,source:s,stack:ii(s)},a_.set(i,s),s)}return{value:i,source:s,stack:ii(s)}}var Uo=[],Vo=0,Od=null,Rc=0,Cr=[],Tr=0,Rs=null,Si=1,wi="";function qi(i,s){Uo[Vo++]=Rc,Uo[Vo++]=Od,Od=i,Rc=s}function o_(i,s,l){Cr[Tr++]=Si,Cr[Tr++]=wi,Cr[Tr++]=Rs,Rs=i;var d=Si;i=wi;var y=32-$t(d)-1;d&=~(1<<y),l+=1;var v=32-$t(s)+y;if(30<v){var A=y-y%5;v=(d&(1<<A)-1).toString(32),d>>=A,y-=A,Si=1<<32-$t(s)+y|l<<y|d,wi=v+i}else Si=1<<v|l<<y|d,wi=i}function km(i){i.return!==null&&(qi(i,1),o_(i,1,0))}function Om(i){for(;i===Od;)Od=Uo[--Vo],Uo[Vo]=null,Rc=Uo[--Vo],Uo[Vo]=null;for(;i===Rs;)Rs=Cr[--Tr],Cr[Tr]=null,wi=Cr[--Tr],Cr[Tr]=null,Si=Cr[--Tr],Cr[Tr]=null}function l_(i,s){Cr[Tr++]=Si,Cr[Tr++]=wi,Cr[Tr++]=Rs,Si=s.id,wi=s.overflow,Rs=i}var En=null,jt=null,it=!1,Ds=null,Ar=!1,Nm=Error(r(519));function Is(i){var s=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Dc(Er(s,i)),Nm}function c_(i){var s=i.stateNode,l=i.type,d=i.memoizedProps;switch(s[Yt]=i,s[yn]=d,l){case"dialog":Xe("cancel",s),Xe("close",s);break;case"iframe":case"object":case"embed":Xe("load",s);break;case"video":case"audio":for(l=0;l<Jc.length;l++)Xe(Jc[l],s);break;case"source":Xe("error",s);break;case"img":case"image":case"link":Xe("error",s),Xe("load",s);break;case"details":Xe("toggle",s);break;case"input":Xe("invalid",s),fd(s,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":Xe("invalid",s);break;case"textarea":Xe("invalid",s),Ss(s,d.value,d.defaultValue,d.children)}l=d.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||s.textContent===""+l||d.suppressHydrationWarning===!0||Tv(s.textContent,l)?(d.popover!=null&&(Xe("beforetoggle",s),Xe("toggle",s)),d.onScroll!=null&&Xe("scroll",s),d.onScrollEnd!=null&&Xe("scrollend",s),d.onClick!=null&&(s.onclick=Fr),s=!0):s=!1,s||Is(i,!0)}function u_(i){for(En=i.return;En;)switch(En.tag){case 5:case 31:case 13:Ar=!1;return;case 27:case 3:Ar=!0;return;default:En=En.return}}function Fo(i){if(i!==En)return!1;if(!it)return u_(i),it=!0,!1;var s=i.tag,l;if((l=s!==3&&s!==27)&&((l=s===5)&&(l=i.type,l=!(l!=="form"&&l!=="button")||Zp(i.type,i.memoizedProps)),l=!l),l&&jt&&Is(i),u_(i),s===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(317));jt=Nv(i)}else if(s===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(317));jt=Nv(i)}else s===27?(s=jt,Hs(i.type)?(i=ig,ig=null,jt=i):jt=s):jt=En?Rr(i.stateNode.nextSibling):null;return!0}function qa(){jt=En=null,it=!1}function Pm(){var i=Ds;return i!==null&&(Xn===null?Xn=i:Xn.push.apply(Xn,i),Ds=null),i}function Dc(i){Ds===null?Ds=[i]:Ds.push(i)}var Lm=V(null),Ha=null,Hi=null;function Ms(i,s,l){ee(Lm,s._currentValue),s._currentValue=l}function Gi(i){i._currentValue=Lm.current,q(Lm)}function Bm(i,s,l){for(;i!==null;){var d=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,d!==null&&(d.childLanes|=s)):d!==null&&(d.childLanes&s)!==s&&(d.childLanes|=s),i===l)break;i=i.return}}function zm(i,s,l,d){var y=i.child;for(y!==null&&(y.return=i);y!==null;){var v=y.dependencies;if(v!==null){var A=y.child;v=v.firstContext;e:for(;v!==null;){var z=v;v=y;for(var X=0;X<s.length;X++)if(z.context===s[X]){v.lanes|=l,z=v.alternate,z!==null&&(z.lanes|=l),Bm(v.return,l,i),d||(A=null);break e}v=z.next}}else if(y.tag===18){if(A=y.return,A===null)throw Error(r(341));A.lanes|=l,v=A.alternate,v!==null&&(v.lanes|=l),Bm(A,l,i),A=null}else A=y.child;if(A!==null)A.return=y;else for(A=y;A!==null;){if(A===i){A=null;break}if(y=A.sibling,y!==null){y.return=A.return,A=y;break}A=A.return}y=A}}function $o(i,s,l,d){i=null;for(var y=s,v=!1;y!==null;){if(!v){if((y.flags&524288)!==0)v=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var A=y.alternate;if(A===null)throw Error(r(387));if(A=A.memoizedProps,A!==null){var z=y.type;ar(y.pendingProps.value,A.value)||(i!==null?i.push(z):i=[z])}}else if(y===he.current){if(A=y.alternate,A===null)throw Error(r(387));A.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(i!==null?i.push(ru):i=[ru])}y=y.return}i!==null&&zm(s,i,l,d),s.flags|=262144}function Nd(i){for(i=i.firstContext;i!==null;){if(!ar(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Ga(i){Ha=i,Hi=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Cn(i){return d_(Ha,i)}function Pd(i,s){return Ha===null&&Ga(i),d_(i,s)}function d_(i,s){var l=s._currentValue;if(s={context:s,memoizedValue:l,next:null},Hi===null){if(i===null)throw Error(r(308));Hi=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else Hi=Hi.next=s;return l}var pA=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(l,d){i.push(d)}};this.abort=function(){s.aborted=!0,i.forEach(function(l){return l()})}},gA=t.unstable_scheduleCallback,yA=t.unstable_NormalPriority,Zt={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Um(){return{controller:new pA,data:new Map,refCount:0}}function Ic(i){i.refCount--,i.refCount===0&&gA(yA,function(){i.controller.abort()})}var Mc=null,Vm=0,qo=0,Ho=null;function _A(i,s){if(Mc===null){var l=Mc=[];Vm=0,qo=qp(),Ho={status:"pending",value:void 0,then:function(d){l.push(d)}}}return Vm++,s.then(h_,h_),s}function h_(){if(--Vm===0&&Mc!==null){Ho!==null&&(Ho.status="fulfilled");var i=Mc;Mc=null,qo=0,Ho=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function bA(i,s){var l=[],d={status:"pending",value:null,reason:null,then:function(y){l.push(y)}};return i.then(function(){d.status="fulfilled",d.value=s;for(var y=0;y<l.length;y++)(0,l[y])(s)},function(y){for(d.status="rejected",d.reason=y,y=0;y<l.length;y++)(0,l[y])(void 0)}),d}var f_=B.S;B.S=function(i,s){Yb=cn(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&_A(i,s),f_!==null&&f_(i,s)};var Qa=V(null);function Fm(){var i=Qa.current;return i!==null?i:Ct.pooledCache}function Ld(i,s){s===null?ee(Qa,Qa.current):ee(Qa,s.pool)}function m_(){var i=Fm();return i===null?null:{parent:Zt._currentValue,pool:i}}var Go=Error(r(460)),$m=Error(r(474)),Bd=Error(r(542)),zd={then:function(){}};function p_(i){return i=i.status,i==="fulfilled"||i==="rejected"}function g_(i,s,l){switch(l=i[l],l===void 0?i.push(s):l!==s&&(s.then(Fr,Fr),s=l),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,__(i),i;default:if(typeof s.status=="string")s.then(Fr,Fr);else{if(i=Ct,i!==null&&100<i.shellSuspendCounter)throw Error(r(482));i=s,i.status="pending",i.then(function(d){if(s.status==="pending"){var y=s;y.status="fulfilled",y.value=d}},function(d){if(s.status==="pending"){var y=s;y.status="rejected",y.reason=d}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,__(i),i}throw Ka=s,Go}}function Wa(i){try{var s=i._init;return s(i._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Ka=l,Go):l}}var Ka=null;function y_(){if(Ka===null)throw Error(r(459));var i=Ka;return Ka=null,i}function __(i){if(i===Go||i===Bd)throw Error(r(483))}var Qo=null,kc=0;function Ud(i){var s=kc;return kc+=1,Qo===null&&(Qo=[]),g_(Qo,i,s)}function Oc(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function Vd(i,s){throw s.$$typeof===b?Error(r(525)):(i=Object.prototype.toString.call(s),Error(r(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function b_(i){function s(ae,ie){if(i){var ce=ae.deletions;ce===null?(ae.deletions=[ie],ae.flags|=16):ce.push(ie)}}function l(ae,ie){if(!i)return null;for(;ie!==null;)s(ae,ie),ie=ie.sibling;return null}function d(ae){for(var ie=new Map;ae!==null;)ae.key!==null?ie.set(ae.key,ae):ie.set(ae.index,ae),ae=ae.sibling;return ie}function y(ae,ie){return ae=$i(ae,ie),ae.index=0,ae.sibling=null,ae}function v(ae,ie,ce){return ae.index=ce,i?(ce=ae.alternate,ce!==null?(ce=ce.index,ce<ie?(ae.flags|=67108866,ie):ce):(ae.flags|=67108866,ie)):(ae.flags|=1048576,ie)}function A(ae){return i&&ae.alternate===null&&(ae.flags|=67108866),ae}function z(ae,ie,ce,ye){return ie===null||ie.tag!==6?(ie=Im(ce,ae.mode,ye),ie.return=ae,ie):(ie=y(ie,ce),ie.return=ae,ie)}function X(ae,ie,ce,ye){var Oe=ce.type;return Oe===S?pe(ae,ie,ce.props.children,ye,ce.key):ie!==null&&(ie.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===k&&Wa(Oe)===ie.type)?(ie=y(ie,ce.props),Oc(ie,ce),ie.return=ae,ie):(ie=kd(ce.type,ce.key,ce.props,null,ae.mode,ye),Oc(ie,ce),ie.return=ae,ie)}function ue(ae,ie,ce,ye){return ie===null||ie.tag!==4||ie.stateNode.containerInfo!==ce.containerInfo||ie.stateNode.implementation!==ce.implementation?(ie=Mm(ce,ae.mode,ye),ie.return=ae,ie):(ie=y(ie,ce.children||[]),ie.return=ae,ie)}function pe(ae,ie,ce,ye,Oe){return ie===null||ie.tag!==7?(ie=$a(ce,ae.mode,ye,Oe),ie.return=ae,ie):(ie=y(ie,ce),ie.return=ae,ie)}function be(ae,ie,ce){if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return ie=Im(""+ie,ae.mode,ce),ie.return=ae,ie;if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case x:return ce=kd(ie.type,ie.key,ie.props,null,ae.mode,ce),Oc(ce,ie),ce.return=ae,ce;case E:return ie=Mm(ie,ae.mode,ce),ie.return=ae,ie;case k:return ie=Wa(ie),be(ae,ie,ce)}if(W(ie)||U(ie))return ie=$a(ie,ae.mode,ce,null),ie.return=ae,ie;if(typeof ie.then=="function")return be(ae,Ud(ie),ce);if(ie.$$typeof===M)return be(ae,Pd(ae,ie),ce);Vd(ae,ie)}return null}function de(ae,ie,ce,ye){var Oe=ie!==null?ie.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return Oe!==null?null:z(ae,ie,""+ce,ye);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case x:return ce.key===Oe?X(ae,ie,ce,ye):null;case E:return ce.key===Oe?ue(ae,ie,ce,ye):null;case k:return ce=Wa(ce),de(ae,ie,ce,ye)}if(W(ce)||U(ce))return Oe!==null?null:pe(ae,ie,ce,ye,null);if(typeof ce.then=="function")return de(ae,ie,Ud(ce),ye);if(ce.$$typeof===M)return de(ae,ie,Pd(ae,ce),ye);Vd(ae,ce)}return null}function me(ae,ie,ce,ye,Oe){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return ae=ae.get(ce)||null,z(ie,ae,""+ye,Oe);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case x:return ae=ae.get(ye.key===null?ce:ye.key)||null,X(ie,ae,ye,Oe);case E:return ae=ae.get(ye.key===null?ce:ye.key)||null,ue(ie,ae,ye,Oe);case k:return ye=Wa(ye),me(ae,ie,ce,ye,Oe)}if(W(ye)||U(ye))return ae=ae.get(ce)||null,pe(ie,ae,ye,Oe,null);if(typeof ye.then=="function")return me(ae,ie,ce,Ud(ye),Oe);if(ye.$$typeof===M)return me(ae,ie,ce,Pd(ie,ye),Oe);Vd(ie,ye)}return null}function Re(ae,ie,ce,ye){for(var Oe=null,ct=null,De=ie,Ke=ie=0,et=null;De!==null&&Ke<ce.length;Ke++){De.index>Ke?(et=De,De=null):et=De.sibling;var ut=de(ae,De,ce[Ke],ye);if(ut===null){De===null&&(De=et);break}i&&De&&ut.alternate===null&&s(ae,De),ie=v(ut,ie,Ke),ct===null?Oe=ut:ct.sibling=ut,ct=ut,De=et}if(Ke===ce.length)return l(ae,De),it&&qi(ae,Ke),Oe;if(De===null){for(;Ke<ce.length;Ke++)De=be(ae,ce[Ke],ye),De!==null&&(ie=v(De,ie,Ke),ct===null?Oe=De:ct.sibling=De,ct=De);return it&&qi(ae,Ke),Oe}for(De=d(De);Ke<ce.length;Ke++)et=me(De,ae,Ke,ce[Ke],ye),et!==null&&(i&&et.alternate!==null&&De.delete(et.key===null?Ke:et.key),ie=v(et,ie,Ke),ct===null?Oe=et:ct.sibling=et,ct=et);return i&&De.forEach(function(Ys){return s(ae,Ys)}),it&&qi(ae,Ke),Oe}function Le(ae,ie,ce,ye){if(ce==null)throw Error(r(151));for(var Oe=null,ct=null,De=ie,Ke=ie=0,et=null,ut=ce.next();De!==null&&!ut.done;Ke++,ut=ce.next()){De.index>Ke?(et=De,De=null):et=De.sibling;var Ys=de(ae,De,ut.value,ye);if(Ys===null){De===null&&(De=et);break}i&&De&&Ys.alternate===null&&s(ae,De),ie=v(Ys,ie,Ke),ct===null?Oe=Ys:ct.sibling=Ys,ct=Ys,De=et}if(ut.done)return l(ae,De),it&&qi(ae,Ke),Oe;if(De===null){for(;!ut.done;Ke++,ut=ce.next())ut=be(ae,ut.value,ye),ut!==null&&(ie=v(ut,ie,Ke),ct===null?Oe=ut:ct.sibling=ut,ct=ut);return it&&qi(ae,Ke),Oe}for(De=d(De);!ut.done;Ke++,ut=ce.next())ut=me(De,ae,Ke,ut.value,ye),ut!==null&&(i&&ut.alternate!==null&&De.delete(ut.key===null?Ke:ut.key),ie=v(ut,ie,Ke),ct===null?Oe=ut:ct.sibling=ut,ct=ut);return i&&De.forEach(function(Dj){return s(ae,Dj)}),it&&qi(ae,Ke),Oe}function St(ae,ie,ce,ye){if(typeof ce=="object"&&ce!==null&&ce.type===S&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case x:e:{for(var Oe=ce.key;ie!==null;){if(ie.key===Oe){if(Oe=ce.type,Oe===S){if(ie.tag===7){l(ae,ie.sibling),ye=y(ie,ce.props.children),ye.return=ae,ae=ye;break e}}else if(ie.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===k&&Wa(Oe)===ie.type){l(ae,ie.sibling),ye=y(ie,ce.props),Oc(ye,ce),ye.return=ae,ae=ye;break e}l(ae,ie);break}else s(ae,ie);ie=ie.sibling}ce.type===S?(ye=$a(ce.props.children,ae.mode,ye,ce.key),ye.return=ae,ae=ye):(ye=kd(ce.type,ce.key,ce.props,null,ae.mode,ye),Oc(ye,ce),ye.return=ae,ae=ye)}return A(ae);case E:e:{for(Oe=ce.key;ie!==null;){if(ie.key===Oe)if(ie.tag===4&&ie.stateNode.containerInfo===ce.containerInfo&&ie.stateNode.implementation===ce.implementation){l(ae,ie.sibling),ye=y(ie,ce.children||[]),ye.return=ae,ae=ye;break e}else{l(ae,ie);break}else s(ae,ie);ie=ie.sibling}ye=Mm(ce,ae.mode,ye),ye.return=ae,ae=ye}return A(ae);case k:return ce=Wa(ce),St(ae,ie,ce,ye)}if(W(ce))return Re(ae,ie,ce,ye);if(U(ce)){if(Oe=U(ce),typeof Oe!="function")throw Error(r(150));return ce=Oe.call(ce),Le(ae,ie,ce,ye)}if(typeof ce.then=="function")return St(ae,ie,Ud(ce),ye);if(ce.$$typeof===M)return St(ae,ie,Pd(ae,ce),ye);Vd(ae,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint"?(ce=""+ce,ie!==null&&ie.tag===6?(l(ae,ie.sibling),ye=y(ie,ce),ye.return=ae,ae=ye):(l(ae,ie),ye=Im(ce,ae.mode,ye),ye.return=ae,ae=ye),A(ae)):l(ae,ie)}return function(ae,ie,ce,ye){try{kc=0;var Oe=St(ae,ie,ce,ye);return Qo=null,Oe}catch(De){if(De===Go||De===Bd)throw De;var ct=or(29,De,null,ae.mode);return ct.lanes=ye,ct.return=ae,ct}}}var Ya=b_(!0),v_=b_(!1),ks=!1;function qm(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Hm(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Os(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Ns(i,s,l){var d=i.updateQueue;if(d===null)return null;if(d=d.shared,(ft&2)!==0){var y=d.pending;return y===null?s.next=s:(s.next=y.next,y.next=s),d.pending=s,s=Md(i),r_(i,null,l),s}return Id(i,d,s,l),Md(i)}function Nc(i,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194048)!==0)){var d=s.lanes;d&=i.pendingLanes,l|=d,s.lanes=l,lc(i,l)}}function Gm(i,s){var l=i.updateQueue,d=i.alternate;if(d!==null&&(d=d.updateQueue,l===d)){var y=null,v=null;if(l=l.firstBaseUpdate,l!==null){do{var A={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};v===null?y=v=A:v=v.next=A,l=l.next}while(l!==null);v===null?y=v=s:v=v.next=s}else y=v=s;l={baseState:d.baseState,firstBaseUpdate:y,lastBaseUpdate:v,shared:d.shared,callbacks:d.callbacks},i.updateQueue=l;return}i=l.lastBaseUpdate,i===null?l.firstBaseUpdate=s:i.next=s,l.lastBaseUpdate=s}var Qm=!1;function Pc(){if(Qm){var i=Ho;if(i!==null)throw i}}function Lc(i,s,l,d){Qm=!1;var y=i.updateQueue;ks=!1;var v=y.firstBaseUpdate,A=y.lastBaseUpdate,z=y.shared.pending;if(z!==null){y.shared.pending=null;var X=z,ue=X.next;X.next=null,A===null?v=ue:A.next=ue,A=X;var pe=i.alternate;pe!==null&&(pe=pe.updateQueue,z=pe.lastBaseUpdate,z!==A&&(z===null?pe.firstBaseUpdate=ue:z.next=ue,pe.lastBaseUpdate=X))}if(v!==null){var be=y.baseState;A=0,pe=ue=X=null,z=v;do{var de=z.lane&-536870913,me=de!==z.lane;if(me?(Ze&de)===de:(d&de)===de){de!==0&&de===qo&&(Qm=!0),pe!==null&&(pe=pe.next={lane:0,tag:z.tag,payload:z.payload,callback:null,next:null});e:{var Re=i,Le=z;de=s;var St=l;switch(Le.tag){case 1:if(Re=Le.payload,typeof Re=="function"){be=Re.call(St,be,de);break e}be=Re;break e;case 3:Re.flags=Re.flags&-65537|128;case 0:if(Re=Le.payload,de=typeof Re=="function"?Re.call(St,be,de):Re,de==null)break e;be=_({},be,de);break e;case 2:ks=!0}}de=z.callback,de!==null&&(i.flags|=64,me&&(i.flags|=8192),me=y.callbacks,me===null?y.callbacks=[de]:me.push(de))}else me={lane:de,tag:z.tag,payload:z.payload,callback:z.callback,next:null},pe===null?(ue=pe=me,X=be):pe=pe.next=me,A|=de;if(z=z.next,z===null){if(z=y.shared.pending,z===null)break;me=z,z=me.next,me.next=null,y.lastBaseUpdate=me,y.shared.pending=null}}while(!0);pe===null&&(X=be),y.baseState=X,y.firstBaseUpdate=ue,y.lastBaseUpdate=pe,v===null&&(y.shared.lanes=0),Us|=A,i.lanes=A,i.memoizedState=be}}function x_(i,s){if(typeof i!="function")throw Error(r(191,i));i.call(s)}function S_(i,s){var l=i.callbacks;if(l!==null)for(i.callbacks=null,i=0;i<l.length;i++)x_(l[i],s)}var Wo=V(null),Fd=V(0);function w_(i,s){i=ts,ee(Fd,i),ee(Wo,s),ts=i|s.baseLanes}function Wm(){ee(Fd,ts),ee(Wo,Wo.current)}function Km(){ts=Fd.current,q(Wo),q(Fd)}var lr=V(null),jr=null;function Ps(i){var s=i.alternate;ee(Ht,Ht.current&1),ee(lr,i),jr===null&&(s===null||Wo.current!==null||s.memoizedState!==null)&&(jr=i)}function Ym(i){ee(Ht,Ht.current),ee(lr,i),jr===null&&(jr=i)}function E_(i){i.tag===22?(ee(Ht,Ht.current),ee(lr,i),jr===null&&(jr=i)):Ls()}function Ls(){ee(Ht,Ht.current),ee(lr,lr.current)}function cr(i){q(lr),jr===i&&(jr=null),q(Ht)}var Ht=V(0);function $d(i){for(var s=i;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||ng(l)||rg(l)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Qi=0,Ge=null,vt=null,en=null,qd=!1,Ko=!1,Xa=!1,Hd=0,Bc=0,Yo=null,vA=0;function Ut(){throw Error(r(321))}function Xm(i,s){if(s===null)return!1;for(var l=0;l<s.length&&l<i.length;l++)if(!ar(i[l],s[l]))return!1;return!0}function Jm(i,s,l,d,y,v){return Qi=v,Ge=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,B.H=i===null||i.memoizedState===null?ob:fp,Xa=!1,v=l(d,y),Xa=!1,Ko&&(v=T_(s,l,d,y)),C_(i),v}function C_(i){B.H=Vc;var s=vt!==null&&vt.next!==null;if(Qi=0,en=vt=Ge=null,qd=!1,Bc=0,Yo=null,s)throw Error(r(300));i===null||tn||(i=i.dependencies,i!==null&&Nd(i)&&(tn=!0))}function T_(i,s,l,d){Ge=i;var y=0;do{if(Ko&&(Yo=null),Bc=0,Ko=!1,25<=y)throw Error(r(301));if(y+=1,en=vt=null,i.updateQueue!=null){var v=i.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}B.H=lb,v=s(l,d)}while(Ko);return v}function xA(){var i=B.H,s=i.useState()[0];return s=typeof s.then=="function"?zc(s):s,i=i.useState()[0],(vt!==null?vt.memoizedState:null)!==i&&(Ge.flags|=1024),s}function Zm(){var i=Hd!==0;return Hd=0,i}function ep(i,s,l){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~l}function tp(i){if(qd){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}qd=!1}Qi=0,en=vt=Ge=null,Ko=!1,Bc=Hd=0,Yo=null}function Vn(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return en===null?Ge.memoizedState=en=i:en=en.next=i,en}function Gt(){if(vt===null){var i=Ge.alternate;i=i!==null?i.memoizedState:null}else i=vt.next;var s=en===null?Ge.memoizedState:en.next;if(s!==null)en=s,vt=i;else{if(i===null)throw Ge.alternate===null?Error(r(467)):Error(r(310));vt=i,i={memoizedState:vt.memoizedState,baseState:vt.baseState,baseQueue:vt.baseQueue,queue:vt.queue,next:null},en===null?Ge.memoizedState=en=i:en=en.next=i}return en}function Gd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function zc(i){var s=Bc;return Bc+=1,Yo===null&&(Yo=[]),i=g_(Yo,i,s),s=Ge,(en===null?s.memoizedState:en.next)===null&&(s=s.alternate,B.H=s===null||s.memoizedState===null?ob:fp),i}function Qd(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return zc(i);if(i.$$typeof===M)return Cn(i)}throw Error(r(438,String(i)))}function np(i){var s=null,l=Ge.updateQueue;if(l!==null&&(s=l.memoCache),s==null){var d=Ge.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(s={data:d.data.map(function(y){return y.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),l===null&&(l=Gd(),Ge.updateQueue=l),l.memoCache=s,l=s.data[s.index],l===void 0)for(l=s.data[s.index]=Array(i),d=0;d<i;d++)l[d]=N;return s.index++,l}function Wi(i,s){return typeof s=="function"?s(i):s}function Wd(i){var s=Gt();return rp(s,vt,i)}function rp(i,s,l){var d=i.queue;if(d===null)throw Error(r(311));d.lastRenderedReducer=l;var y=i.baseQueue,v=d.pending;if(v!==null){if(y!==null){var A=y.next;y.next=v.next,v.next=A}s.baseQueue=y=v,d.pending=null}if(v=i.baseState,y===null)i.memoizedState=v;else{s=y.next;var z=A=null,X=null,ue=s,pe=!1;do{var be=ue.lane&-536870913;if(be!==ue.lane?(Ze&be)===be:(Qi&be)===be){var de=ue.revertLane;if(de===0)X!==null&&(X=X.next={lane:0,revertLane:0,gesture:null,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),be===qo&&(pe=!0);else if((Qi&de)===de){ue=ue.next,de===qo&&(pe=!0);continue}else be={lane:0,revertLane:ue.revertLane,gesture:null,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},X===null?(z=X=be,A=v):X=X.next=be,Ge.lanes|=de,Us|=de;be=ue.action,Xa&&l(v,be),v=ue.hasEagerState?ue.eagerState:l(v,be)}else de={lane:be,revertLane:ue.revertLane,gesture:ue.gesture,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},X===null?(z=X=de,A=v):X=X.next=de,Ge.lanes|=be,Us|=be;ue=ue.next}while(ue!==null&&ue!==s);if(X===null?A=v:X.next=z,!ar(v,i.memoizedState)&&(tn=!0,pe&&(l=Ho,l!==null)))throw l;i.memoizedState=v,i.baseState=A,i.baseQueue=X,d.lastRenderedState=v}return y===null&&(d.lanes=0),[i.memoizedState,d.dispatch]}function ip(i){var s=Gt(),l=s.queue;if(l===null)throw Error(r(311));l.lastRenderedReducer=i;var d=l.dispatch,y=l.pending,v=s.memoizedState;if(y!==null){l.pending=null;var A=y=y.next;do v=i(v,A.action),A=A.next;while(A!==y);ar(v,s.memoizedState)||(tn=!0),s.memoizedState=v,s.baseQueue===null&&(s.baseState=v),l.lastRenderedState=v}return[v,d]}function A_(i,s,l){var d=Ge,y=Gt(),v=it;if(v){if(l===void 0)throw Error(r(407));l=l()}else l=s();var A=!ar((vt||y).memoizedState,l);if(A&&(y.memoizedState=l,tn=!0),y=y.queue,op(D_.bind(null,d,y,i),[i]),y.getSnapshot!==s||A||en!==null&&en.memoizedState.tag&1){if(d.flags|=2048,Xo(9,{destroy:void 0},R_.bind(null,d,y,l,s),null),Ct===null)throw Error(r(349));v||(Qi&127)!==0||j_(d,s,l)}return l}function j_(i,s,l){i.flags|=16384,i={getSnapshot:s,value:l},s=Ge.updateQueue,s===null?(s=Gd(),Ge.updateQueue=s,s.stores=[i]):(l=s.stores,l===null?s.stores=[i]:l.push(i))}function R_(i,s,l,d){s.value=l,s.getSnapshot=d,I_(s)&&M_(i)}function D_(i,s,l){return l(function(){I_(s)&&M_(i)})}function I_(i){var s=i.getSnapshot;i=i.value;try{var l=s();return!ar(i,l)}catch{return!0}}function M_(i){var s=Fa(i,2);s!==null&&Jn(s,i,2)}function sp(i){var s=Vn();if(typeof i=="function"){var l=i;if(i=l(),Xa){_r(!0);try{l()}finally{_r(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wi,lastRenderedState:i},s}function k_(i,s,l,d){return i.baseState=l,rp(i,vt,typeof d=="function"?d:Wi)}function SA(i,s,l,d,y){if(Xd(i))throw Error(r(485));if(i=s.action,i!==null){var v={payload:y,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(A){v.listeners.push(A)}};B.T!==null?l(!0):v.isTransition=!1,d(v),l=s.pending,l===null?(v.next=s.pending=v,O_(s,v)):(v.next=l.next,s.pending=l.next=v)}}function O_(i,s){var l=s.action,d=s.payload,y=i.state;if(s.isTransition){var v=B.T,A={};B.T=A;try{var z=l(y,d),X=B.S;X!==null&&X(A,z),N_(i,s,z)}catch(ue){ap(i,s,ue)}finally{v!==null&&A.types!==null&&(v.types=A.types),B.T=v}}else try{v=l(y,d),N_(i,s,v)}catch(ue){ap(i,s,ue)}}function N_(i,s,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(d){P_(i,s,d)},function(d){return ap(i,s,d)}):P_(i,s,l)}function P_(i,s,l){s.status="fulfilled",s.value=l,L_(s),i.state=l,s=i.pending,s!==null&&(l=s.next,l===s?i.pending=null:(l=l.next,s.next=l,O_(i,l)))}function ap(i,s,l){var d=i.pending;if(i.pending=null,d!==null){d=d.next;do s.status="rejected",s.reason=l,L_(s),s=s.next;while(s!==d)}i.action=null}function L_(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function B_(i,s){return s}function z_(i,s){if(it){var l=Ct.formState;if(l!==null){e:{var d=Ge;if(it){if(jt){t:{for(var y=jt,v=Ar;y.nodeType!==8;){if(!v){y=null;break t}if(y=Rr(y.nextSibling),y===null){y=null;break t}}v=y.data,y=v==="F!"||v==="F"?y:null}if(y){jt=Rr(y.nextSibling),d=y.data==="F!";break e}}Is(d)}d=!1}d&&(s=l[0])}}return l=Vn(),l.memoizedState=l.baseState=s,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:B_,lastRenderedState:s},l.queue=d,l=ib.bind(null,Ge,d),d.dispatch=l,d=sp(!1),v=hp.bind(null,Ge,!1,d.queue),d=Vn(),y={state:s,dispatch:null,action:i,pending:null},d.queue=y,l=SA.bind(null,Ge,y,v,l),y.dispatch=l,d.memoizedState=i,[s,l,!1]}function U_(i){var s=Gt();return V_(s,vt,i)}function V_(i,s,l){if(s=rp(i,s,B_)[0],i=Wd(Wi)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var d=zc(s)}catch(A){throw A===Go?Bd:A}else d=s;s=Gt();var y=s.queue,v=y.dispatch;return l!==s.memoizedState&&(Ge.flags|=2048,Xo(9,{destroy:void 0},wA.bind(null,y,l),null)),[d,v,i]}function wA(i,s){i.action=s}function F_(i){var s=Gt(),l=vt;if(l!==null)return V_(s,l,i);Gt(),s=s.memoizedState,l=Gt();var d=l.queue.dispatch;return l.memoizedState=i,[s,d,!1]}function Xo(i,s,l,d){return i={tag:i,create:l,deps:d,inst:s,next:null},s=Ge.updateQueue,s===null&&(s=Gd(),Ge.updateQueue=s),l=s.lastEffect,l===null?s.lastEffect=i.next=i:(d=l.next,l.next=i,i.next=d,s.lastEffect=i),i}function $_(){return Gt().memoizedState}function Kd(i,s,l,d){var y=Vn();Ge.flags|=i,y.memoizedState=Xo(1|s,{destroy:void 0},l,d===void 0?null:d)}function Yd(i,s,l,d){var y=Gt();d=d===void 0?null:d;var v=y.memoizedState.inst;vt!==null&&d!==null&&Xm(d,vt.memoizedState.deps)?y.memoizedState=Xo(s,v,l,d):(Ge.flags|=i,y.memoizedState=Xo(1|s,v,l,d))}function q_(i,s){Kd(8390656,8,i,s)}function op(i,s){Yd(2048,8,i,s)}function EA(i){Ge.flags|=4;var s=Ge.updateQueue;if(s===null)s=Gd(),Ge.updateQueue=s,s.events=[i];else{var l=s.events;l===null?s.events=[i]:l.push(i)}}function H_(i){var s=Gt().memoizedState;return EA({ref:s,nextImpl:i}),function(){if((ft&2)!==0)throw Error(r(440));return s.impl.apply(void 0,arguments)}}function G_(i,s){return Yd(4,2,i,s)}function Q_(i,s){return Yd(4,4,i,s)}function W_(i,s){if(typeof s=="function"){i=i();var l=s(i);return function(){typeof l=="function"?l():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function K_(i,s,l){l=l!=null?l.concat([i]):null,Yd(4,4,W_.bind(null,s,i),l)}function lp(){}function Y_(i,s){var l=Gt();s=s===void 0?null:s;var d=l.memoizedState;return s!==null&&Xm(s,d[1])?d[0]:(l.memoizedState=[i,s],i)}function X_(i,s){var l=Gt();s=s===void 0?null:s;var d=l.memoizedState;if(s!==null&&Xm(s,d[1]))return d[0];if(d=i(),Xa){_r(!0);try{i()}finally{_r(!1)}}return l.memoizedState=[d,s],d}function cp(i,s,l){return l===void 0||(Qi&1073741824)!==0&&(Ze&261930)===0?i.memoizedState=s:(i.memoizedState=l,i=Jb(),Ge.lanes|=i,Us|=i,l)}function J_(i,s,l,d){return ar(l,s)?l:Wo.current!==null?(i=cp(i,l,d),ar(i,s)||(tn=!0),i):(Qi&42)===0||(Qi&1073741824)!==0&&(Ze&261930)===0?(tn=!0,i.memoizedState=l):(i=Jb(),Ge.lanes|=i,Us|=i,s)}function Z_(i,s,l,d,y){var v=$.p;$.p=v!==0&&8>v?v:8;var A=B.T,z={};B.T=z,hp(i,!1,s,l);try{var X=y(),ue=B.S;if(ue!==null&&ue(z,X),X!==null&&typeof X=="object"&&typeof X.then=="function"){var pe=bA(X,d);Uc(i,s,pe,hr(i))}else Uc(i,s,d,hr(i))}catch(be){Uc(i,s,{then:function(){},status:"rejected",reason:be},hr())}finally{$.p=v,A!==null&&z.types!==null&&(A.types=z.types),B.T=A}}function CA(){}function up(i,s,l,d){if(i.tag!==5)throw Error(r(476));var y=eb(i).queue;Z_(i,y,s,G,l===null?CA:function(){return tb(i),l(d)})}function eb(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:G,baseState:G,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wi,lastRenderedState:G},next:null};var l={};return s.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wi,lastRenderedState:l},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function tb(i){var s=eb(i);s.next===null&&(s=i.alternate.memoizedState),Uc(i,s.next.queue,{},hr())}function dp(){return Cn(ru)}function nb(){return Gt().memoizedState}function rb(){return Gt().memoizedState}function TA(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var l=hr();i=Os(l);var d=Ns(s,i,l);d!==null&&(Jn(d,s,l),Nc(d,s,l)),s={cache:Um()},i.payload=s;return}s=s.return}}function AA(i,s,l){var d=hr();l={lane:d,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Xd(i)?sb(s,l):(l=Rm(i,s,l,d),l!==null&&(Jn(l,i,d),ab(l,s,d)))}function ib(i,s,l){var d=hr();Uc(i,s,l,d)}function Uc(i,s,l,d){var y={lane:d,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(Xd(i))sb(s,y);else{var v=i.alternate;if(i.lanes===0&&(v===null||v.lanes===0)&&(v=s.lastRenderedReducer,v!==null))try{var A=s.lastRenderedState,z=v(A,l);if(y.hasEagerState=!0,y.eagerState=z,ar(z,A))return Id(i,s,y,0),Ct===null&&Dd(),!1}catch{}if(l=Rm(i,s,y,d),l!==null)return Jn(l,i,d),ab(l,s,d),!0}return!1}function hp(i,s,l,d){if(d={lane:2,revertLane:qp(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},Xd(i)){if(s)throw Error(r(479))}else s=Rm(i,l,d,2),s!==null&&Jn(s,i,2)}function Xd(i){var s=i.alternate;return i===Ge||s!==null&&s===Ge}function sb(i,s){Ko=qd=!0;var l=i.pending;l===null?s.next=s:(s.next=l.next,l.next=s),i.pending=s}function ab(i,s,l){if((l&4194048)!==0){var d=s.lanes;d&=i.pendingLanes,l|=d,s.lanes=l,lc(i,l)}}var Vc={readContext:Cn,use:Qd,useCallback:Ut,useContext:Ut,useEffect:Ut,useImperativeHandle:Ut,useLayoutEffect:Ut,useInsertionEffect:Ut,useMemo:Ut,useReducer:Ut,useRef:Ut,useState:Ut,useDebugValue:Ut,useDeferredValue:Ut,useTransition:Ut,useSyncExternalStore:Ut,useId:Ut,useHostTransitionStatus:Ut,useFormState:Ut,useActionState:Ut,useOptimistic:Ut,useMemoCache:Ut,useCacheRefresh:Ut};Vc.useEffectEvent=Ut;var ob={readContext:Cn,use:Qd,useCallback:function(i,s){return Vn().memoizedState=[i,s===void 0?null:s],i},useContext:Cn,useEffect:q_,useImperativeHandle:function(i,s,l){l=l!=null?l.concat([i]):null,Kd(4194308,4,W_.bind(null,s,i),l)},useLayoutEffect:function(i,s){return Kd(4194308,4,i,s)},useInsertionEffect:function(i,s){Kd(4,2,i,s)},useMemo:function(i,s){var l=Vn();s=s===void 0?null:s;var d=i();if(Xa){_r(!0);try{i()}finally{_r(!1)}}return l.memoizedState=[d,s],d},useReducer:function(i,s,l){var d=Vn();if(l!==void 0){var y=l(s);if(Xa){_r(!0);try{l(s)}finally{_r(!1)}}}else y=s;return d.memoizedState=d.baseState=y,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:y},d.queue=i,i=i.dispatch=AA.bind(null,Ge,i),[d.memoizedState,i]},useRef:function(i){var s=Vn();return i={current:i},s.memoizedState=i},useState:function(i){i=sp(i);var s=i.queue,l=ib.bind(null,Ge,s);return s.dispatch=l,[i.memoizedState,l]},useDebugValue:lp,useDeferredValue:function(i,s){var l=Vn();return cp(l,i,s)},useTransition:function(){var i=sp(!1);return i=Z_.bind(null,Ge,i.queue,!0,!1),Vn().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,l){var d=Ge,y=Vn();if(it){if(l===void 0)throw Error(r(407));l=l()}else{if(l=s(),Ct===null)throw Error(r(349));(Ze&127)!==0||j_(d,s,l)}y.memoizedState=l;var v={value:l,getSnapshot:s};return y.queue=v,q_(D_.bind(null,d,v,i),[i]),d.flags|=2048,Xo(9,{destroy:void 0},R_.bind(null,d,v,l,s),null),l},useId:function(){var i=Vn(),s=Ct.identifierPrefix;if(it){var l=wi,d=Si;l=(d&~(1<<32-$t(d)-1)).toString(32)+l,s="_"+s+"R_"+l,l=Hd++,0<l&&(s+="H"+l.toString(32)),s+="_"}else l=vA++,s="_"+s+"r_"+l.toString(32)+"_";return i.memoizedState=s},useHostTransitionStatus:dp,useFormState:z_,useActionState:z_,useOptimistic:function(i){var s=Vn();s.memoizedState=s.baseState=i;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=l,s=hp.bind(null,Ge,!0,l),l.dispatch=s,[i,s]},useMemoCache:np,useCacheRefresh:function(){return Vn().memoizedState=TA.bind(null,Ge)},useEffectEvent:function(i){var s=Vn(),l={impl:i};return s.memoizedState=l,function(){if((ft&2)!==0)throw Error(r(440));return l.impl.apply(void 0,arguments)}}},fp={readContext:Cn,use:Qd,useCallback:Y_,useContext:Cn,useEffect:op,useImperativeHandle:K_,useInsertionEffect:G_,useLayoutEffect:Q_,useMemo:X_,useReducer:Wd,useRef:$_,useState:function(){return Wd(Wi)},useDebugValue:lp,useDeferredValue:function(i,s){var l=Gt();return J_(l,vt.memoizedState,i,s)},useTransition:function(){var i=Wd(Wi)[0],s=Gt().memoizedState;return[typeof i=="boolean"?i:zc(i),s]},useSyncExternalStore:A_,useId:nb,useHostTransitionStatus:dp,useFormState:U_,useActionState:U_,useOptimistic:function(i,s){var l=Gt();return k_(l,vt,i,s)},useMemoCache:np,useCacheRefresh:rb};fp.useEffectEvent=H_;var lb={readContext:Cn,use:Qd,useCallback:Y_,useContext:Cn,useEffect:op,useImperativeHandle:K_,useInsertionEffect:G_,useLayoutEffect:Q_,useMemo:X_,useReducer:ip,useRef:$_,useState:function(){return ip(Wi)},useDebugValue:lp,useDeferredValue:function(i,s){var l=Gt();return vt===null?cp(l,i,s):J_(l,vt.memoizedState,i,s)},useTransition:function(){var i=ip(Wi)[0],s=Gt().memoizedState;return[typeof i=="boolean"?i:zc(i),s]},useSyncExternalStore:A_,useId:nb,useHostTransitionStatus:dp,useFormState:F_,useActionState:F_,useOptimistic:function(i,s){var l=Gt();return vt!==null?k_(l,vt,i,s):(l.baseState=i,[i,l.queue.dispatch])},useMemoCache:np,useCacheRefresh:rb};lb.useEffectEvent=H_;function mp(i,s,l,d){s=i.memoizedState,l=l(d,s),l=l==null?s:_({},s,l),i.memoizedState=l,i.lanes===0&&(i.updateQueue.baseState=l)}var pp={enqueueSetState:function(i,s,l){i=i._reactInternals;var d=hr(),y=Os(d);y.payload=s,l!=null&&(y.callback=l),s=Ns(i,y,d),s!==null&&(Jn(s,i,d),Nc(s,i,d))},enqueueReplaceState:function(i,s,l){i=i._reactInternals;var d=hr(),y=Os(d);y.tag=1,y.payload=s,l!=null&&(y.callback=l),s=Ns(i,y,d),s!==null&&(Jn(s,i,d),Nc(s,i,d))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var l=hr(),d=Os(l);d.tag=2,s!=null&&(d.callback=s),s=Ns(i,d,l),s!==null&&(Jn(s,i,l),Nc(s,i,l))}};function cb(i,s,l,d,y,v,A){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(d,v,A):s.prototype&&s.prototype.isPureReactComponent?!Ac(l,d)||!Ac(y,v):!0}function ub(i,s,l,d){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,d),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,d),s.state!==i&&pp.enqueueReplaceState(s,s.state,null)}function Ja(i,s){var l=s;if("ref"in s){l={};for(var d in s)d!=="ref"&&(l[d]=s[d])}if(i=i.defaultProps){l===s&&(l=_({},l));for(var y in i)l[y]===void 0&&(l[y]=i[y])}return l}function db(i){Rd(i)}function hb(i){console.error(i)}function fb(i){Rd(i)}function Jd(i,s){try{var l=i.onUncaughtError;l(s.value,{componentStack:s.stack})}catch(d){setTimeout(function(){throw d})}}function mb(i,s,l){try{var d=i.onCaughtError;d(l.value,{componentStack:l.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function gp(i,s,l){return l=Os(l),l.tag=3,l.payload={element:null},l.callback=function(){Jd(i,s)},l}function pb(i){return i=Os(i),i.tag=3,i}function gb(i,s,l,d){var y=l.type.getDerivedStateFromError;if(typeof y=="function"){var v=d.value;i.payload=function(){return y(v)},i.callback=function(){mb(s,l,d)}}var A=l.stateNode;A!==null&&typeof A.componentDidCatch=="function"&&(i.callback=function(){mb(s,l,d),typeof y!="function"&&(Vs===null?Vs=new Set([this]):Vs.add(this));var z=d.stack;this.componentDidCatch(d.value,{componentStack:z!==null?z:""})})}function jA(i,s,l,d,y){if(l.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(s=l.alternate,s!==null&&$o(s,l,y,!0),l=lr.current,l!==null){switch(l.tag){case 31:case 13:return jr===null?uh():l.alternate===null&&Vt===0&&(Vt=3),l.flags&=-257,l.flags|=65536,l.lanes=y,d===zd?l.flags|=16384:(s=l.updateQueue,s===null?l.updateQueue=new Set([d]):s.add(d),Vp(i,d,y)),!1;case 22:return l.flags|=65536,d===zd?l.flags|=16384:(s=l.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([d])},l.updateQueue=s):(l=s.retryQueue,l===null?s.retryQueue=new Set([d]):l.add(d)),Vp(i,d,y)),!1}throw Error(r(435,l.tag))}return Vp(i,d,y),uh(),!1}if(it)return s=lr.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=y,d!==Nm&&(i=Error(r(422),{cause:d}),Dc(Er(i,l)))):(d!==Nm&&(s=Error(r(423),{cause:d}),Dc(Er(s,l))),i=i.current.alternate,i.flags|=65536,y&=-y,i.lanes|=y,d=Er(d,l),y=gp(i.stateNode,d,y),Gm(i,y),Vt!==4&&(Vt=2)),!1;var v=Error(r(520),{cause:d});if(v=Er(v,l),Kc===null?Kc=[v]:Kc.push(v),Vt!==4&&(Vt=2),s===null)return!0;d=Er(d,l),l=s;do{switch(l.tag){case 3:return l.flags|=65536,i=y&-y,l.lanes|=i,i=gp(l.stateNode,d,i),Gm(l,i),!1;case 1:if(s=l.type,v=l.stateNode,(l.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Vs===null||!Vs.has(v))))return l.flags|=65536,y&=-y,l.lanes|=y,y=pb(y),gb(y,i,l,d),Gm(l,y),!1}l=l.return}while(l!==null);return!1}var yp=Error(r(461)),tn=!1;function Tn(i,s,l,d){s.child=i===null?v_(s,null,l,d):Ya(s,i.child,l,d)}function yb(i,s,l,d,y){l=l.render;var v=s.ref;if("ref"in d){var A={};for(var z in d)z!=="ref"&&(A[z]=d[z])}else A=d;return Ga(s),d=Jm(i,s,l,A,v,y),z=Zm(),i!==null&&!tn?(ep(i,s,y),Ki(i,s,y)):(it&&z&&km(s),s.flags|=1,Tn(i,s,d,y),s.child)}function _b(i,s,l,d,y){if(i===null){var v=l.type;return typeof v=="function"&&!Dm(v)&&v.defaultProps===void 0&&l.compare===null?(s.tag=15,s.type=v,bb(i,s,v,d,y)):(i=kd(l.type,null,d,s,s.mode,y),i.ref=s.ref,i.return=s,s.child=i)}if(v=i.child,!Cp(i,y)){var A=v.memoizedProps;if(l=l.compare,l=l!==null?l:Ac,l(A,d)&&i.ref===s.ref)return Ki(i,s,y)}return s.flags|=1,i=$i(v,d),i.ref=s.ref,i.return=s,s.child=i}function bb(i,s,l,d,y){if(i!==null){var v=i.memoizedProps;if(Ac(v,d)&&i.ref===s.ref)if(tn=!1,s.pendingProps=d=v,Cp(i,y))(i.flags&131072)!==0&&(tn=!0);else return s.lanes=i.lanes,Ki(i,s,y)}return _p(i,s,l,d,y)}function vb(i,s,l,d){var y=d.children,v=i!==null?i.memoizedState:null;if(i===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((s.flags&128)!==0){if(v=v!==null?v.baseLanes|l:l,i!==null){for(d=s.child=i.child,y=0;d!==null;)y=y|d.lanes|d.childLanes,d=d.sibling;d=y&~v}else d=0,s.child=null;return xb(i,s,v,l,d)}if((l&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&Ld(s,v!==null?v.cachePool:null),v!==null?w_(s,v):Wm(),E_(s);else return d=s.lanes=536870912,xb(i,s,v!==null?v.baseLanes|l:l,l,d)}else v!==null?(Ld(s,v.cachePool),w_(s,v),Ls(),s.memoizedState=null):(i!==null&&Ld(s,null),Wm(),Ls());return Tn(i,s,y,l),s.child}function Fc(i,s){return i!==null&&i.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function xb(i,s,l,d,y){var v=Fm();return v=v===null?null:{parent:Zt._currentValue,pool:v},s.memoizedState={baseLanes:l,cachePool:v},i!==null&&Ld(s,null),Wm(),E_(s),i!==null&&$o(i,s,d,!0),s.childLanes=y,null}function Zd(i,s){return s=th({mode:s.mode,children:s.children},i.mode),s.ref=i.ref,i.child=s,s.return=i,s}function Sb(i,s,l){return Ya(s,i.child,null,l),i=Zd(s,s.pendingProps),i.flags|=2,cr(s),s.memoizedState=null,i}function RA(i,s,l){var d=s.pendingProps,y=(s.flags&128)!==0;if(s.flags&=-129,i===null){if(it){if(d.mode==="hidden")return i=Zd(s,d),s.lanes=536870912,Fc(null,i);if(Ym(s),(i=jt)?(i=Ov(i,Ar),i=i!==null&&i.data==="&"?i:null,i!==null&&(s.memoizedState={dehydrated:i,treeContext:Rs!==null?{id:Si,overflow:wi}:null,retryLane:536870912,hydrationErrors:null},l=s_(i),l.return=s,s.child=l,En=s,jt=null)):i=null,i===null)throw Is(s);return s.lanes=536870912,null}return Zd(s,d)}var v=i.memoizedState;if(v!==null){var A=v.dehydrated;if(Ym(s),y)if(s.flags&256)s.flags&=-257,s=Sb(i,s,l);else if(s.memoizedState!==null)s.child=i.child,s.flags|=128,s=null;else throw Error(r(558));else if(tn||$o(i,s,l,!1),y=(l&i.childLanes)!==0,tn||y){if(d=Ct,d!==null&&(A=cc(d,l),A!==0&&A!==v.retryLane))throw v.retryLane=A,Fa(i,A),Jn(d,i,A),yp;uh(),s=Sb(i,s,l)}else i=v.treeContext,jt=Rr(A.nextSibling),En=s,it=!0,Ds=null,Ar=!1,i!==null&&l_(s,i),s=Zd(s,d),s.flags|=4096;return s}return i=$i(i.child,{mode:d.mode,children:d.children}),i.ref=s.ref,s.child=i,i.return=s,i}function eh(i,s){var l=s.ref;if(l===null)i!==null&&i.ref!==null&&(s.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(r(284));(i===null||i.ref!==l)&&(s.flags|=4194816)}}function _p(i,s,l,d,y){return Ga(s),l=Jm(i,s,l,d,void 0,y),d=Zm(),i!==null&&!tn?(ep(i,s,y),Ki(i,s,y)):(it&&d&&km(s),s.flags|=1,Tn(i,s,l,y),s.child)}function wb(i,s,l,d,y,v){return Ga(s),s.updateQueue=null,l=T_(s,d,l,y),C_(i),d=Zm(),i!==null&&!tn?(ep(i,s,v),Ki(i,s,v)):(it&&d&&km(s),s.flags|=1,Tn(i,s,l,v),s.child)}function Eb(i,s,l,d,y){if(Ga(s),s.stateNode===null){var v=zo,A=l.contextType;typeof A=="object"&&A!==null&&(v=Cn(A)),v=new l(d,v),s.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=pp,s.stateNode=v,v._reactInternals=s,v=s.stateNode,v.props=d,v.state=s.memoizedState,v.refs={},qm(s),A=l.contextType,v.context=typeof A=="object"&&A!==null?Cn(A):zo,v.state=s.memoizedState,A=l.getDerivedStateFromProps,typeof A=="function"&&(mp(s,l,A,d),v.state=s.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(A=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),A!==v.state&&pp.enqueueReplaceState(v,v.state,null),Lc(s,d,v,y),Pc(),v.state=s.memoizedState),typeof v.componentDidMount=="function"&&(s.flags|=4194308),d=!0}else if(i===null){v=s.stateNode;var z=s.memoizedProps,X=Ja(l,z);v.props=X;var ue=v.context,pe=l.contextType;A=zo,typeof pe=="object"&&pe!==null&&(A=Cn(pe));var be=l.getDerivedStateFromProps;pe=typeof be=="function"||typeof v.getSnapshotBeforeUpdate=="function",z=s.pendingProps!==z,pe||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(z||ue!==A)&&ub(s,v,d,A),ks=!1;var de=s.memoizedState;v.state=de,Lc(s,d,v,y),Pc(),ue=s.memoizedState,z||de!==ue||ks?(typeof be=="function"&&(mp(s,l,be,d),ue=s.memoizedState),(X=ks||cb(s,l,X,d,de,ue,A))?(pe||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(s.flags|=4194308)):(typeof v.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=d,s.memoizedState=ue),v.props=d,v.state=ue,v.context=A,d=X):(typeof v.componentDidMount=="function"&&(s.flags|=4194308),d=!1)}else{v=s.stateNode,Hm(i,s),A=s.memoizedProps,pe=Ja(l,A),v.props=pe,be=s.pendingProps,de=v.context,ue=l.contextType,X=zo,typeof ue=="object"&&ue!==null&&(X=Cn(ue)),z=l.getDerivedStateFromProps,(ue=typeof z=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(A!==be||de!==X)&&ub(s,v,d,X),ks=!1,de=s.memoizedState,v.state=de,Lc(s,d,v,y),Pc();var me=s.memoizedState;A!==be||de!==me||ks||i!==null&&i.dependencies!==null&&Nd(i.dependencies)?(typeof z=="function"&&(mp(s,l,z,d),me=s.memoizedState),(pe=ks||cb(s,l,pe,d,de,me,X)||i!==null&&i.dependencies!==null&&Nd(i.dependencies))?(ue||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(d,me,X),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(d,me,X)),typeof v.componentDidUpdate=="function"&&(s.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof v.componentDidUpdate!="function"||A===i.memoizedProps&&de===i.memoizedState||(s.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||A===i.memoizedProps&&de===i.memoizedState||(s.flags|=1024),s.memoizedProps=d,s.memoizedState=me),v.props=d,v.state=me,v.context=X,d=pe):(typeof v.componentDidUpdate!="function"||A===i.memoizedProps&&de===i.memoizedState||(s.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||A===i.memoizedProps&&de===i.memoizedState||(s.flags|=1024),d=!1)}return v=d,eh(i,s),d=(s.flags&128)!==0,v||d?(v=s.stateNode,l=d&&typeof l.getDerivedStateFromError!="function"?null:v.render(),s.flags|=1,i!==null&&d?(s.child=Ya(s,i.child,null,y),s.child=Ya(s,null,l,y)):Tn(i,s,l,y),s.memoizedState=v.state,i=s.child):i=Ki(i,s,y),i}function Cb(i,s,l,d){return qa(),s.flags|=256,Tn(i,s,l,d),s.child}var bp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function vp(i){return{baseLanes:i,cachePool:m_()}}function xp(i,s,l){return i=i!==null?i.childLanes&~l:0,s&&(i|=dr),i}function Tb(i,s,l){var d=s.pendingProps,y=!1,v=(s.flags&128)!==0,A;if((A=v)||(A=i!==null&&i.memoizedState===null?!1:(Ht.current&2)!==0),A&&(y=!0,s.flags&=-129),A=(s.flags&32)!==0,s.flags&=-33,i===null){if(it){if(y?Ps(s):Ls(),(i=jt)?(i=Ov(i,Ar),i=i!==null&&i.data!=="&"?i:null,i!==null&&(s.memoizedState={dehydrated:i,treeContext:Rs!==null?{id:Si,overflow:wi}:null,retryLane:536870912,hydrationErrors:null},l=s_(i),l.return=s,s.child=l,En=s,jt=null)):i=null,i===null)throw Is(s);return rg(i)?s.lanes=32:s.lanes=536870912,null}var z=d.children;return d=d.fallback,y?(Ls(),y=s.mode,z=th({mode:"hidden",children:z},y),d=$a(d,y,l,null),z.return=s,d.return=s,z.sibling=d,s.child=z,d=s.child,d.memoizedState=vp(l),d.childLanes=xp(i,A,l),s.memoizedState=bp,Fc(null,d)):(Ps(s),Sp(s,z))}var X=i.memoizedState;if(X!==null&&(z=X.dehydrated,z!==null)){if(v)s.flags&256?(Ps(s),s.flags&=-257,s=wp(i,s,l)):s.memoizedState!==null?(Ls(),s.child=i.child,s.flags|=128,s=null):(Ls(),z=d.fallback,y=s.mode,d=th({mode:"visible",children:d.children},y),z=$a(z,y,l,null),z.flags|=2,d.return=s,z.return=s,d.sibling=z,s.child=d,Ya(s,i.child,null,l),d=s.child,d.memoizedState=vp(l),d.childLanes=xp(i,A,l),s.memoizedState=bp,s=Fc(null,d));else if(Ps(s),rg(z)){if(A=z.nextSibling&&z.nextSibling.dataset,A)var ue=A.dgst;A=ue,d=Error(r(419)),d.stack="",d.digest=A,Dc({value:d,source:null,stack:null}),s=wp(i,s,l)}else if(tn||$o(i,s,l,!1),A=(l&i.childLanes)!==0,tn||A){if(A=Ct,A!==null&&(d=cc(A,l),d!==0&&d!==X.retryLane))throw X.retryLane=d,Fa(i,d),Jn(A,i,d),yp;ng(z)||uh(),s=wp(i,s,l)}else ng(z)?(s.flags|=192,s.child=i.child,s=null):(i=X.treeContext,jt=Rr(z.nextSibling),En=s,it=!0,Ds=null,Ar=!1,i!==null&&l_(s,i),s=Sp(s,d.children),s.flags|=4096);return s}return y?(Ls(),z=d.fallback,y=s.mode,X=i.child,ue=X.sibling,d=$i(X,{mode:"hidden",children:d.children}),d.subtreeFlags=X.subtreeFlags&65011712,ue!==null?z=$i(ue,z):(z=$a(z,y,l,null),z.flags|=2),z.return=s,d.return=s,d.sibling=z,s.child=d,Fc(null,d),d=s.child,z=i.child.memoizedState,z===null?z=vp(l):(y=z.cachePool,y!==null?(X=Zt._currentValue,y=y.parent!==X?{parent:X,pool:X}:y):y=m_(),z={baseLanes:z.baseLanes|l,cachePool:y}),d.memoizedState=z,d.childLanes=xp(i,A,l),s.memoizedState=bp,Fc(i.child,d)):(Ps(s),l=i.child,i=l.sibling,l=$i(l,{mode:"visible",children:d.children}),l.return=s,l.sibling=null,i!==null&&(A=s.deletions,A===null?(s.deletions=[i],s.flags|=16):A.push(i)),s.child=l,s.memoizedState=null,l)}function Sp(i,s){return s=th({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function th(i,s){return i=or(22,i,null,s),i.lanes=0,i}function wp(i,s,l){return Ya(s,i.child,null,l),i=Sp(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function Ab(i,s,l){i.lanes|=s;var d=i.alternate;d!==null&&(d.lanes|=s),Bm(i.return,s,l)}function Ep(i,s,l,d,y,v){var A=i.memoizedState;A===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:d,tail:l,tailMode:y,treeForkCount:v}:(A.isBackwards=s,A.rendering=null,A.renderingStartTime=0,A.last=d,A.tail=l,A.tailMode=y,A.treeForkCount=v)}function jb(i,s,l){var d=s.pendingProps,y=d.revealOrder,v=d.tail;d=d.children;var A=Ht.current,z=(A&2)!==0;if(z?(A=A&1|2,s.flags|=128):A&=1,ee(Ht,A),Tn(i,s,d,l),d=it?Rc:0,!z&&i!==null&&(i.flags&128)!==0)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Ab(i,l,s);else if(i.tag===19)Ab(i,l,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(y){case"forwards":for(l=s.child,y=null;l!==null;)i=l.alternate,i!==null&&$d(i)===null&&(y=l),l=l.sibling;l=y,l===null?(y=s.child,s.child=null):(y=l.sibling,l.sibling=null),Ep(s,!1,y,l,v,d);break;case"backwards":case"unstable_legacy-backwards":for(l=null,y=s.child,s.child=null;y!==null;){if(i=y.alternate,i!==null&&$d(i)===null){s.child=y;break}i=y.sibling,y.sibling=l,l=y,y=i}Ep(s,!0,l,null,v,d);break;case"together":Ep(s,!1,null,null,void 0,d);break;default:s.memoizedState=null}return s.child}function Ki(i,s,l){if(i!==null&&(s.dependencies=i.dependencies),Us|=s.lanes,(l&s.childLanes)===0)if(i!==null){if($o(i,s,l,!1),(l&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(r(153));if(s.child!==null){for(i=s.child,l=$i(i,i.pendingProps),s.child=l,l.return=s;i.sibling!==null;)i=i.sibling,l=l.sibling=$i(i,i.pendingProps),l.return=s;l.sibling=null}return s.child}function Cp(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&Nd(i)))}function DA(i,s,l){switch(s.tag){case 3:we(s,s.stateNode.containerInfo),Ms(s,Zt,i.memoizedState.cache),qa();break;case 27:case 5:Z(s);break;case 4:we(s,s.stateNode.containerInfo);break;case 10:Ms(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Ym(s),null;break;case 13:var d=s.memoizedState;if(d!==null)return d.dehydrated!==null?(Ps(s),s.flags|=128,null):(l&s.child.childLanes)!==0?Tb(i,s,l):(Ps(s),i=Ki(i,s,l),i!==null?i.sibling:null);Ps(s);break;case 19:var y=(i.flags&128)!==0;if(d=(l&s.childLanes)!==0,d||($o(i,s,l,!1),d=(l&s.childLanes)!==0),y){if(d)return jb(i,s,l);s.flags|=128}if(y=s.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),ee(Ht,Ht.current),d)break;return null;case 22:return s.lanes=0,vb(i,s,l,s.pendingProps);case 24:Ms(s,Zt,i.memoizedState.cache)}return Ki(i,s,l)}function Rb(i,s,l){if(i!==null)if(i.memoizedProps!==s.pendingProps)tn=!0;else{if(!Cp(i,l)&&(s.flags&128)===0)return tn=!1,DA(i,s,l);tn=(i.flags&131072)!==0}else tn=!1,it&&(s.flags&1048576)!==0&&o_(s,Rc,s.index);switch(s.lanes=0,s.tag){case 16:e:{var d=s.pendingProps;if(i=Wa(s.elementType),s.type=i,typeof i=="function")Dm(i)?(d=Ja(i,d),s.tag=1,s=Eb(null,s,i,d,l)):(s.tag=0,s=_p(null,s,i,d,l));else{if(i!=null){var y=i.$$typeof;if(y===K){s.tag=11,s=yb(null,s,i,d,l);break e}else if(y===P){s.tag=14,s=_b(null,s,i,d,l);break e}}throw s=Y(i)||i,Error(r(306,s,""))}}return s;case 0:return _p(i,s,s.type,s.pendingProps,l);case 1:return d=s.type,y=Ja(d,s.pendingProps),Eb(i,s,d,y,l);case 3:e:{if(we(s,s.stateNode.containerInfo),i===null)throw Error(r(387));d=s.pendingProps;var v=s.memoizedState;y=v.element,Hm(i,s),Lc(s,d,null,l);var A=s.memoizedState;if(d=A.cache,Ms(s,Zt,d),d!==v.cache&&zm(s,[Zt],l,!0),Pc(),d=A.element,v.isDehydrated)if(v={element:d,isDehydrated:!1,cache:A.cache},s.updateQueue.baseState=v,s.memoizedState=v,s.flags&256){s=Cb(i,s,d,l);break e}else if(d!==y){y=Er(Error(r(424)),s),Dc(y),s=Cb(i,s,d,l);break e}else for(i=s.stateNode.containerInfo,i.nodeType===9?i=i.body:i=i.nodeName==="HTML"?i.ownerDocument.body:i,jt=Rr(i.firstChild),En=s,it=!0,Ds=null,Ar=!0,l=v_(s,null,d,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(qa(),d===y){s=Ki(i,s,l);break e}Tn(i,s,d,l)}s=s.child}return s;case 26:return eh(i,s),i===null?(l=Uv(s.type,null,s.pendingProps,null))?s.memoizedState=l:it||(l=s.type,i=s.pendingProps,d=yh(se.current).createElement(l),d[Yt]=s,d[yn]=i,An(d,l,i),Xt(d),s.stateNode=d):s.memoizedState=Uv(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return Z(s),i===null&&it&&(d=s.stateNode=Lv(s.type,s.pendingProps,se.current),En=s,Ar=!0,y=jt,Hs(s.type)?(ig=y,jt=Rr(d.firstChild)):jt=y),Tn(i,s,s.pendingProps.children,l),eh(i,s),i===null&&(s.flags|=4194304),s.child;case 5:return i===null&&it&&((y=d=jt)&&(d=aj(d,s.type,s.pendingProps,Ar),d!==null?(s.stateNode=d,En=s,jt=Rr(d.firstChild),Ar=!1,y=!0):y=!1),y||Is(s)),Z(s),y=s.type,v=s.pendingProps,A=i!==null?i.memoizedProps:null,d=v.children,Zp(y,v)?d=null:A!==null&&Zp(y,A)&&(s.flags|=32),s.memoizedState!==null&&(y=Jm(i,s,xA,null,null,l),ru._currentValue=y),eh(i,s),Tn(i,s,d,l),s.child;case 6:return i===null&&it&&((i=l=jt)&&(l=oj(l,s.pendingProps,Ar),l!==null?(s.stateNode=l,En=s,jt=null,i=!0):i=!1),i||Is(s)),null;case 13:return Tb(i,s,l);case 4:return we(s,s.stateNode.containerInfo),d=s.pendingProps,i===null?s.child=Ya(s,null,d,l):Tn(i,s,d,l),s.child;case 11:return yb(i,s,s.type,s.pendingProps,l);case 7:return Tn(i,s,s.pendingProps,l),s.child;case 8:return Tn(i,s,s.pendingProps.children,l),s.child;case 12:return Tn(i,s,s.pendingProps.children,l),s.child;case 10:return d=s.pendingProps,Ms(s,s.type,d.value),Tn(i,s,d.children,l),s.child;case 9:return y=s.type._context,d=s.pendingProps.children,Ga(s),y=Cn(y),d=d(y),s.flags|=1,Tn(i,s,d,l),s.child;case 14:return _b(i,s,s.type,s.pendingProps,l);case 15:return bb(i,s,s.type,s.pendingProps,l);case 19:return jb(i,s,l);case 31:return RA(i,s,l);case 22:return vb(i,s,l,s.pendingProps);case 24:return Ga(s),d=Cn(Zt),i===null?(y=Fm(),y===null&&(y=Ct,v=Um(),y.pooledCache=v,v.refCount++,v!==null&&(y.pooledCacheLanes|=l),y=v),s.memoizedState={parent:d,cache:y},qm(s),Ms(s,Zt,y)):((i.lanes&l)!==0&&(Hm(i,s),Lc(s,null,null,l),Pc()),y=i.memoizedState,v=s.memoizedState,y.parent!==d?(y={parent:d,cache:d},s.memoizedState=y,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=y),Ms(s,Zt,d)):(d=v.cache,Ms(s,Zt,d),d!==y.cache&&zm(s,[Zt],l,!0))),Tn(i,s,s.pendingProps.children,l),s.child;case 29:throw s.pendingProps}throw Error(r(156,s.tag))}function Yi(i){i.flags|=4}function Tp(i,s,l,d,y){if((s=(i.mode&32)!==0)&&(s=!1),s){if(i.flags|=16777216,(y&335544128)===y)if(i.stateNode.complete)i.flags|=8192;else if(nv())i.flags|=8192;else throw Ka=zd,$m}else i.flags&=-16777217}function Db(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!Hv(s))if(nv())i.flags|=8192;else throw Ka=zd,$m}function nh(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?ld():536870912,i.lanes|=s,tl|=s)}function $c(i,s){if(!it)switch(i.tailMode){case"hidden":s=i.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?i.tail=null:l.sibling=null;break;case"collapsed":l=i.tail;for(var d=null;l!==null;)l.alternate!==null&&(d=l),l=l.sibling;d===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:d.sibling=null}}function Rt(i){var s=i.alternate!==null&&i.alternate.child===i.child,l=0,d=0;if(s)for(var y=i.child;y!==null;)l|=y.lanes|y.childLanes,d|=y.subtreeFlags&65011712,d|=y.flags&65011712,y.return=i,y=y.sibling;else for(y=i.child;y!==null;)l|=y.lanes|y.childLanes,d|=y.subtreeFlags,d|=y.flags,y.return=i,y=y.sibling;return i.subtreeFlags|=d,i.childLanes=l,s}function IA(i,s,l){var d=s.pendingProps;switch(Om(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rt(s),null;case 1:return Rt(s),null;case 3:return l=s.stateNode,d=null,i!==null&&(d=i.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),Gi(Zt),ge(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(i===null||i.child===null)&&(Fo(s)?Yi(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Pm())),Rt(s),null;case 26:var y=s.type,v=s.memoizedState;return i===null?(Yi(s),v!==null?(Rt(s),Db(s,v)):(Rt(s),Tp(s,y,null,d,l))):v?v!==i.memoizedState?(Yi(s),Rt(s),Db(s,v)):(Rt(s),s.flags&=-16777217):(i=i.memoizedProps,i!==d&&Yi(s),Rt(s),Tp(s,y,i,d,l)),null;case 27:if(ve(s),l=se.current,y=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==d&&Yi(s);else{if(!d){if(s.stateNode===null)throw Error(r(166));return Rt(s),null}i=ne.current,Fo(s)?c_(s):(i=Lv(y,d,l),s.stateNode=i,Yi(s))}return Rt(s),null;case 5:if(ve(s),y=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==d&&Yi(s);else{if(!d){if(s.stateNode===null)throw Error(r(166));return Rt(s),null}if(v=ne.current,Fo(s))c_(s);else{var A=yh(se.current);switch(v){case 1:v=A.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:v=A.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":v=A.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":v=A.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":v=A.createElement("div"),v.innerHTML="<script><\/script>",v=v.removeChild(v.firstChild);break;case"select":v=typeof d.is=="string"?A.createElement("select",{is:d.is}):A.createElement("select"),d.multiple?v.multiple=!0:d.size&&(v.size=d.size);break;default:v=typeof d.is=="string"?A.createElement(y,{is:d.is}):A.createElement(y)}}v[Yt]=s,v[yn]=d;e:for(A=s.child;A!==null;){if(A.tag===5||A.tag===6)v.appendChild(A.stateNode);else if(A.tag!==4&&A.tag!==27&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===s)break e;for(;A.sibling===null;){if(A.return===null||A.return===s)break e;A=A.return}A.sibling.return=A.return,A=A.sibling}s.stateNode=v;e:switch(An(v,y,d),y){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&Yi(s)}}return Rt(s),Tp(s,s.type,i===null?null:i.memoizedProps,s.pendingProps,l),null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==d&&Yi(s);else{if(typeof d!="string"&&s.stateNode===null)throw Error(r(166));if(i=se.current,Fo(s)){if(i=s.stateNode,l=s.memoizedProps,d=null,y=En,y!==null)switch(y.tag){case 27:case 5:d=y.memoizedProps}i[Yt]=s,i=!!(i.nodeValue===l||d!==null&&d.suppressHydrationWarning===!0||Tv(i.nodeValue,l)),i||Is(s,!0)}else i=yh(i).createTextNode(d),i[Yt]=s,s.stateNode=i}return Rt(s),null;case 31:if(l=s.memoizedState,i===null||i.memoizedState!==null){if(d=Fo(s),l!==null){if(i===null){if(!d)throw Error(r(318));if(i=s.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(557));i[Yt]=s}else qa(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Rt(s),i=!1}else l=Pm(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=l),i=!0;if(!i)return s.flags&256?(cr(s),s):(cr(s),null);if((s.flags&128)!==0)throw Error(r(558))}return Rt(s),null;case 13:if(d=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(y=Fo(s),d!==null&&d.dehydrated!==null){if(i===null){if(!y)throw Error(r(318));if(y=s.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(r(317));y[Yt]=s}else qa(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Rt(s),y=!1}else y=Pm(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=y),y=!0;if(!y)return s.flags&256?(cr(s),s):(cr(s),null)}return cr(s),(s.flags&128)!==0?(s.lanes=l,s):(l=d!==null,i=i!==null&&i.memoizedState!==null,l&&(d=s.child,y=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(y=d.alternate.memoizedState.cachePool.pool),v=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(v=d.memoizedState.cachePool.pool),v!==y&&(d.flags|=2048)),l!==i&&l&&(s.child.flags|=8192),nh(s,s.updateQueue),Rt(s),null);case 4:return ge(),i===null&&Wp(s.stateNode.containerInfo),Rt(s),null;case 10:return Gi(s.type),Rt(s),null;case 19:if(q(Ht),d=s.memoizedState,d===null)return Rt(s),null;if(y=(s.flags&128)!==0,v=d.rendering,v===null)if(y)$c(d,!1);else{if(Vt!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(v=$d(i),v!==null){for(s.flags|=128,$c(d,!1),i=v.updateQueue,s.updateQueue=i,nh(s,i),s.subtreeFlags=0,i=l,l=s.child;l!==null;)i_(l,i),l=l.sibling;return ee(Ht,Ht.current&1|2),it&&qi(s,d.treeForkCount),s.child}i=i.sibling}d.tail!==null&&cn()>oh&&(s.flags|=128,y=!0,$c(d,!1),s.lanes=4194304)}else{if(!y)if(i=$d(v),i!==null){if(s.flags|=128,y=!0,i=i.updateQueue,s.updateQueue=i,nh(s,i),$c(d,!0),d.tail===null&&d.tailMode==="hidden"&&!v.alternate&&!it)return Rt(s),null}else 2*cn()-d.renderingStartTime>oh&&l!==536870912&&(s.flags|=128,y=!0,$c(d,!1),s.lanes=4194304);d.isBackwards?(v.sibling=s.child,s.child=v):(i=d.last,i!==null?i.sibling=v:s.child=v,d.last=v)}return d.tail!==null?(i=d.tail,d.rendering=i,d.tail=i.sibling,d.renderingStartTime=cn(),i.sibling=null,l=Ht.current,ee(Ht,y?l&1|2:l&1),it&&qi(s,d.treeForkCount),i):(Rt(s),null);case 22:case 23:return cr(s),Km(),d=s.memoizedState!==null,i!==null?i.memoizedState!==null!==d&&(s.flags|=8192):d&&(s.flags|=8192),d?(l&536870912)!==0&&(s.flags&128)===0&&(Rt(s),s.subtreeFlags&6&&(s.flags|=8192)):Rt(s),l=s.updateQueue,l!==null&&nh(s,l.retryQueue),l=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),d=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),d!==l&&(s.flags|=2048),i!==null&&q(Qa),null;case 24:return l=null,i!==null&&(l=i.memoizedState.cache),s.memoizedState.cache!==l&&(s.flags|=2048),Gi(Zt),Rt(s),null;case 25:return null;case 30:return null}throw Error(r(156,s.tag))}function MA(i,s){switch(Om(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Gi(Zt),ge(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return ve(s),null;case 31:if(s.memoizedState!==null){if(cr(s),s.alternate===null)throw Error(r(340));qa()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 13:if(cr(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(r(340));qa()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return q(Ht),null;case 4:return ge(),null;case 10:return Gi(s.type),null;case 22:case 23:return cr(s),Km(),i!==null&&q(Qa),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return Gi(Zt),null;case 25:return null;default:return null}}function Ib(i,s){switch(Om(s),s.tag){case 3:Gi(Zt),ge();break;case 26:case 27:case 5:ve(s);break;case 4:ge();break;case 31:s.memoizedState!==null&&cr(s);break;case 13:cr(s);break;case 19:q(Ht);break;case 10:Gi(s.type);break;case 22:case 23:cr(s),Km(),i!==null&&q(Qa);break;case 24:Gi(Zt)}}function qc(i,s){try{var l=s.updateQueue,d=l!==null?l.lastEffect:null;if(d!==null){var y=d.next;l=y;do{if((l.tag&i)===i){d=void 0;var v=l.create,A=l.inst;d=v(),A.destroy=d}l=l.next}while(l!==y)}}catch(z){_t(s,s.return,z)}}function Bs(i,s,l){try{var d=s.updateQueue,y=d!==null?d.lastEffect:null;if(y!==null){var v=y.next;d=v;do{if((d.tag&i)===i){var A=d.inst,z=A.destroy;if(z!==void 0){A.destroy=void 0,y=s;var X=l,ue=z;try{ue()}catch(pe){_t(y,X,pe)}}}d=d.next}while(d!==v)}}catch(pe){_t(s,s.return,pe)}}function Mb(i){var s=i.updateQueue;if(s!==null){var l=i.stateNode;try{S_(s,l)}catch(d){_t(i,i.return,d)}}}function kb(i,s,l){l.props=Ja(i.type,i.memoizedProps),l.state=i.memoizedState;try{l.componentWillUnmount()}catch(d){_t(i,s,d)}}function Hc(i,s){try{var l=i.ref;if(l!==null){switch(i.tag){case 26:case 27:case 5:var d=i.stateNode;break;case 30:d=i.stateNode;break;default:d=i.stateNode}typeof l=="function"?i.refCleanup=l(d):l.current=d}}catch(y){_t(i,s,y)}}function Ei(i,s){var l=i.ref,d=i.refCleanup;if(l!==null)if(typeof d=="function")try{d()}catch(y){_t(i,s,y)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(y){_t(i,s,y)}else l.current=null}function Ob(i){var s=i.type,l=i.memoizedProps,d=i.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":l.autoFocus&&d.focus();break e;case"img":l.src?d.src=l.src:l.srcSet&&(d.srcset=l.srcSet)}}catch(y){_t(i,i.return,y)}}function Ap(i,s,l){try{var d=i.stateNode;ej(d,i.type,l,s),d[yn]=s}catch(y){_t(i,i.return,y)}}function Nb(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Hs(i.type)||i.tag===4}function jp(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Nb(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Hs(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Rp(i,s,l){var d=i.tag;if(d===5||d===6)i=i.stateNode,s?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(i,s):(s=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,s.appendChild(i),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=Fr));else if(d!==4&&(d===27&&Hs(i.type)&&(l=i.stateNode,s=null),i=i.child,i!==null))for(Rp(i,s,l),i=i.sibling;i!==null;)Rp(i,s,l),i=i.sibling}function rh(i,s,l){var d=i.tag;if(d===5||d===6)i=i.stateNode,s?l.insertBefore(i,s):l.appendChild(i);else if(d!==4&&(d===27&&Hs(i.type)&&(l=i.stateNode),i=i.child,i!==null))for(rh(i,s,l),i=i.sibling;i!==null;)rh(i,s,l),i=i.sibling}function Pb(i){var s=i.stateNode,l=i.memoizedProps;try{for(var d=i.type,y=s.attributes;y.length;)s.removeAttributeNode(y[0]);An(s,d,l),s[Yt]=i,s[yn]=l}catch(v){_t(i,i.return,v)}}var Xi=!1,nn=!1,Dp=!1,Lb=typeof WeakSet=="function"?WeakSet:Set,bn=null;function kA(i,s){if(i=i.containerInfo,Xp=Eh,i=K0(i),wm(i)){if("selectionStart"in i)var l={start:i.selectionStart,end:i.selectionEnd};else e:{l=(l=i.ownerDocument)&&l.defaultView||window;var d=l.getSelection&&l.getSelection();if(d&&d.rangeCount!==0){l=d.anchorNode;var y=d.anchorOffset,v=d.focusNode;d=d.focusOffset;try{l.nodeType,v.nodeType}catch{l=null;break e}var A=0,z=-1,X=-1,ue=0,pe=0,be=i,de=null;t:for(;;){for(var me;be!==l||y!==0&&be.nodeType!==3||(z=A+y),be!==v||d!==0&&be.nodeType!==3||(X=A+d),be.nodeType===3&&(A+=be.nodeValue.length),(me=be.firstChild)!==null;)de=be,be=me;for(;;){if(be===i)break t;if(de===l&&++ue===y&&(z=A),de===v&&++pe===d&&(X=A),(me=be.nextSibling)!==null)break;be=de,de=be.parentNode}be=me}l=z===-1||X===-1?null:{start:z,end:X}}else l=null}l=l||{start:0,end:0}}else l=null;for(Jp={focusedElem:i,selectionRange:l},Eh=!1,bn=s;bn!==null;)if(s=bn,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,bn=i;else for(;bn!==null;){switch(s=bn,v=s.alternate,i=s.flags,s.tag){case 0:if((i&4)!==0&&(i=s.updateQueue,i=i!==null?i.events:null,i!==null))for(l=0;l<i.length;l++)y=i[l],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&v!==null){i=void 0,l=s,y=v.memoizedProps,v=v.memoizedState,d=l.stateNode;try{var Re=Ja(l.type,y);i=d.getSnapshotBeforeUpdate(Re,v),d.__reactInternalSnapshotBeforeUpdate=i}catch(Le){_t(l,l.return,Le)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,l=i.nodeType,l===9)tg(i);else if(l===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":tg(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(r(163))}if(i=s.sibling,i!==null){i.return=s.return,bn=i;break}bn=s.return}}function Bb(i,s,l){var d=l.flags;switch(l.tag){case 0:case 11:case 15:Zi(i,l),d&4&&qc(5,l);break;case 1:if(Zi(i,l),d&4)if(i=l.stateNode,s===null)try{i.componentDidMount()}catch(A){_t(l,l.return,A)}else{var y=Ja(l.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(y,s,i.__reactInternalSnapshotBeforeUpdate)}catch(A){_t(l,l.return,A)}}d&64&&Mb(l),d&512&&Hc(l,l.return);break;case 3:if(Zi(i,l),d&64&&(i=l.updateQueue,i!==null)){if(s=null,l.child!==null)switch(l.child.tag){case 27:case 5:s=l.child.stateNode;break;case 1:s=l.child.stateNode}try{S_(i,s)}catch(A){_t(l,l.return,A)}}break;case 27:s===null&&d&4&&Pb(l);case 26:case 5:Zi(i,l),s===null&&d&4&&Ob(l),d&512&&Hc(l,l.return);break;case 12:Zi(i,l);break;case 31:Zi(i,l),d&4&&Vb(i,l);break;case 13:Zi(i,l),d&4&&Fb(i,l),d&64&&(i=l.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(l=FA.bind(null,l),lj(i,l))));break;case 22:if(d=l.memoizedState!==null||Xi,!d){s=s!==null&&s.memoizedState!==null||nn,y=Xi;var v=nn;Xi=d,(nn=s)&&!v?es(i,l,(l.subtreeFlags&8772)!==0):Zi(i,l),Xi=y,nn=v}break;case 30:break;default:Zi(i,l)}}function zb(i){var s=i.alternate;s!==null&&(i.alternate=null,zb(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&Co(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var kt=null,Wn=!1;function Ji(i,s,l){for(l=l.child;l!==null;)Ub(i,s,l),l=l.sibling}function Ub(i,s,l){if(Sn&&typeof Sn.onCommitFiberUnmount=="function")try{Sn.onCommitFiberUnmount(Br,l)}catch{}switch(l.tag){case 26:nn||Ei(l,s),Ji(i,s,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:nn||Ei(l,s);var d=kt,y=Wn;Hs(l.type)&&(kt=l.stateNode,Wn=!1),Ji(i,s,l),eu(l.stateNode),kt=d,Wn=y;break;case 5:nn||Ei(l,s);case 6:if(d=kt,y=Wn,kt=null,Ji(i,s,l),kt=d,Wn=y,kt!==null)if(Wn)try{(kt.nodeType===9?kt.body:kt.nodeName==="HTML"?kt.ownerDocument.body:kt).removeChild(l.stateNode)}catch(v){_t(l,s,v)}else try{kt.removeChild(l.stateNode)}catch(v){_t(l,s,v)}break;case 18:kt!==null&&(Wn?(i=kt,Mv(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,l.stateNode),cl(i)):Mv(kt,l.stateNode));break;case 4:d=kt,y=Wn,kt=l.stateNode.containerInfo,Wn=!0,Ji(i,s,l),kt=d,Wn=y;break;case 0:case 11:case 14:case 15:Bs(2,l,s),nn||Bs(4,l,s),Ji(i,s,l);break;case 1:nn||(Ei(l,s),d=l.stateNode,typeof d.componentWillUnmount=="function"&&kb(l,s,d)),Ji(i,s,l);break;case 21:Ji(i,s,l);break;case 22:nn=(d=nn)||l.memoizedState!==null,Ji(i,s,l),nn=d;break;default:Ji(i,s,l)}}function Vb(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{cl(i)}catch(l){_t(s,s.return,l)}}}function Fb(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{cl(i)}catch(l){_t(s,s.return,l)}}function OA(i){switch(i.tag){case 31:case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new Lb),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new Lb),s;default:throw Error(r(435,i.tag))}}function ih(i,s){var l=OA(i);s.forEach(function(d){if(!l.has(d)){l.add(d);var y=$A.bind(null,i,d);d.then(y,y)}})}function Kn(i,s){var l=s.deletions;if(l!==null)for(var d=0;d<l.length;d++){var y=l[d],v=i,A=s,z=A;e:for(;z!==null;){switch(z.tag){case 27:if(Hs(z.type)){kt=z.stateNode,Wn=!1;break e}break;case 5:kt=z.stateNode,Wn=!1;break e;case 3:case 4:kt=z.stateNode.containerInfo,Wn=!0;break e}z=z.return}if(kt===null)throw Error(r(160));Ub(v,A,y),kt=null,Wn=!1,v=y.alternate,v!==null&&(v.return=null),y.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)$b(s,i),s=s.sibling}var Wr=null;function $b(i,s){var l=i.alternate,d=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Kn(s,i),Yn(i),d&4&&(Bs(3,i,i.return),qc(3,i),Bs(5,i,i.return));break;case 1:Kn(s,i),Yn(i),d&512&&(nn||l===null||Ei(l,l.return)),d&64&&Xi&&(i=i.updateQueue,i!==null&&(d=i.callbacks,d!==null&&(l=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=l===null?d:l.concat(d))));break;case 26:var y=Wr;if(Kn(s,i),Yn(i),d&512&&(nn||l===null||Ei(l,l.return)),d&4){var v=l!==null?l.memoizedState:null;if(d=i.memoizedState,l===null)if(d===null)if(i.stateNode===null){e:{d=i.type,l=i.memoizedProps,y=y.ownerDocument||y;t:switch(d){case"title":v=y.getElementsByTagName("title")[0],(!v||v[ui]||v[Yt]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=y.createElement(d),y.head.insertBefore(v,y.querySelector("head > title"))),An(v,d,l),v[Yt]=i,Xt(v),d=v;break e;case"link":var A=$v("link","href",y).get(d+(l.href||""));if(A){for(var z=0;z<A.length;z++)if(v=A[z],v.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&v.getAttribute("rel")===(l.rel==null?null:l.rel)&&v.getAttribute("title")===(l.title==null?null:l.title)&&v.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){A.splice(z,1);break t}}v=y.createElement(d),An(v,d,l),y.head.appendChild(v);break;case"meta":if(A=$v("meta","content",y).get(d+(l.content||""))){for(z=0;z<A.length;z++)if(v=A[z],v.getAttribute("content")===(l.content==null?null:""+l.content)&&v.getAttribute("name")===(l.name==null?null:l.name)&&v.getAttribute("property")===(l.property==null?null:l.property)&&v.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&v.getAttribute("charset")===(l.charSet==null?null:l.charSet)){A.splice(z,1);break t}}v=y.createElement(d),An(v,d,l),y.head.appendChild(v);break;default:throw Error(r(468,d))}v[Yt]=i,Xt(v),d=v}i.stateNode=d}else qv(y,i.type,i.stateNode);else i.stateNode=Fv(y,d,i.memoizedProps);else v!==d?(v===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):v.count--,d===null?qv(y,i.type,i.stateNode):Fv(y,d,i.memoizedProps)):d===null&&i.stateNode!==null&&Ap(i,i.memoizedProps,l.memoizedProps)}break;case 27:Kn(s,i),Yn(i),d&512&&(nn||l===null||Ei(l,l.return)),l!==null&&d&4&&Ap(i,i.memoizedProps,l.memoizedProps);break;case 5:if(Kn(s,i),Yn(i),d&512&&(nn||l===null||Ei(l,l.return)),i.flags&32){y=i.stateNode;try{Qn(y,"")}catch(Re){_t(i,i.return,Re)}}d&4&&i.stateNode!=null&&(y=i.memoizedProps,Ap(i,y,l!==null?l.memoizedProps:y)),d&1024&&(Dp=!0);break;case 6:if(Kn(s,i),Yn(i),d&4){if(i.stateNode===null)throw Error(r(162));d=i.memoizedProps,l=i.stateNode;try{l.nodeValue=d}catch(Re){_t(i,i.return,Re)}}break;case 3:if(vh=null,y=Wr,Wr=_h(s.containerInfo),Kn(s,i),Wr=y,Yn(i),d&4&&l!==null&&l.memoizedState.isDehydrated)try{cl(s.containerInfo)}catch(Re){_t(i,i.return,Re)}Dp&&(Dp=!1,qb(i));break;case 4:d=Wr,Wr=_h(i.stateNode.containerInfo),Kn(s,i),Yn(i),Wr=d;break;case 12:Kn(s,i),Yn(i);break;case 31:Kn(s,i),Yn(i),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,ih(i,d)));break;case 13:Kn(s,i),Yn(i),i.child.flags&8192&&i.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(ah=cn()),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,ih(i,d)));break;case 22:y=i.memoizedState!==null;var X=l!==null&&l.memoizedState!==null,ue=Xi,pe=nn;if(Xi=ue||y,nn=pe||X,Kn(s,i),nn=pe,Xi=ue,Yn(i),d&8192)e:for(s=i.stateNode,s._visibility=y?s._visibility&-2:s._visibility|1,y&&(l===null||X||Xi||nn||Za(i)),l=null,s=i;;){if(s.tag===5||s.tag===26){if(l===null){X=l=s;try{if(v=X.stateNode,y)A=v.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none";else{z=X.stateNode;var be=X.memoizedProps.style,de=be!=null&&be.hasOwnProperty("display")?be.display:null;z.style.display=de==null||typeof de=="boolean"?"":(""+de).trim()}}catch(Re){_t(X,X.return,Re)}}}else if(s.tag===6){if(l===null){X=s;try{X.stateNode.nodeValue=y?"":X.memoizedProps}catch(Re){_t(X,X.return,Re)}}}else if(s.tag===18){if(l===null){X=s;try{var me=X.stateNode;y?kv(me,!0):kv(X.stateNode,!1)}catch(Re){_t(X,X.return,Re)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;l===s&&(l=null),s=s.return}l===s&&(l=null),s.sibling.return=s.return,s=s.sibling}d&4&&(d=i.updateQueue,d!==null&&(l=d.retryQueue,l!==null&&(d.retryQueue=null,ih(i,l))));break;case 19:Kn(s,i),Yn(i),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,ih(i,d)));break;case 30:break;case 21:break;default:Kn(s,i),Yn(i)}}function Yn(i){var s=i.flags;if(s&2){try{for(var l,d=i.return;d!==null;){if(Nb(d)){l=d;break}d=d.return}if(l==null)throw Error(r(160));switch(l.tag){case 27:var y=l.stateNode,v=jp(i);rh(i,v,y);break;case 5:var A=l.stateNode;l.flags&32&&(Qn(A,""),l.flags&=-33);var z=jp(i);rh(i,z,A);break;case 3:case 4:var X=l.stateNode.containerInfo,ue=jp(i);Rp(i,ue,X);break;default:throw Error(r(161))}}catch(pe){_t(i,i.return,pe)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function qb(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;qb(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function Zi(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)Bb(i,s.alternate,s),s=s.sibling}function Za(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:Bs(4,s,s.return),Za(s);break;case 1:Ei(s,s.return);var l=s.stateNode;typeof l.componentWillUnmount=="function"&&kb(s,s.return,l),Za(s);break;case 27:eu(s.stateNode);case 26:case 5:Ei(s,s.return),Za(s);break;case 22:s.memoizedState===null&&Za(s);break;case 30:Za(s);break;default:Za(s)}i=i.sibling}}function es(i,s,l){for(l=l&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var d=s.alternate,y=i,v=s,A=v.flags;switch(v.tag){case 0:case 11:case 15:es(y,v,l),qc(4,v);break;case 1:if(es(y,v,l),d=v,y=d.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(ue){_t(d,d.return,ue)}if(d=v,y=d.updateQueue,y!==null){var z=d.stateNode;try{var X=y.shared.hiddenCallbacks;if(X!==null)for(y.shared.hiddenCallbacks=null,y=0;y<X.length;y++)x_(X[y],z)}catch(ue){_t(d,d.return,ue)}}l&&A&64&&Mb(v),Hc(v,v.return);break;case 27:Pb(v);case 26:case 5:es(y,v,l),l&&d===null&&A&4&&Ob(v),Hc(v,v.return);break;case 12:es(y,v,l);break;case 31:es(y,v,l),l&&A&4&&Vb(y,v);break;case 13:es(y,v,l),l&&A&4&&Fb(y,v);break;case 22:v.memoizedState===null&&es(y,v,l),Hc(v,v.return);break;case 30:break;default:es(y,v,l)}s=s.sibling}}function Ip(i,s){var l=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==l&&(i!=null&&i.refCount++,l!=null&&Ic(l))}function Mp(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Ic(i))}function Kr(i,s,l,d){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Hb(i,s,l,d),s=s.sibling}function Hb(i,s,l,d){var y=s.flags;switch(s.tag){case 0:case 11:case 15:Kr(i,s,l,d),y&2048&&qc(9,s);break;case 1:Kr(i,s,l,d);break;case 3:Kr(i,s,l,d),y&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Ic(i)));break;case 12:if(y&2048){Kr(i,s,l,d),i=s.stateNode;try{var v=s.memoizedProps,A=v.id,z=v.onPostCommit;typeof z=="function"&&z(A,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(X){_t(s,s.return,X)}}else Kr(i,s,l,d);break;case 31:Kr(i,s,l,d);break;case 13:Kr(i,s,l,d);break;case 23:break;case 22:v=s.stateNode,A=s.alternate,s.memoizedState!==null?v._visibility&2?Kr(i,s,l,d):Gc(i,s):v._visibility&2?Kr(i,s,l,d):(v._visibility|=2,Jo(i,s,l,d,(s.subtreeFlags&10256)!==0||!1)),y&2048&&Ip(A,s);break;case 24:Kr(i,s,l,d),y&2048&&Mp(s.alternate,s);break;default:Kr(i,s,l,d)}}function Jo(i,s,l,d,y){for(y=y&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var v=i,A=s,z=l,X=d,ue=A.flags;switch(A.tag){case 0:case 11:case 15:Jo(v,A,z,X,y),qc(8,A);break;case 23:break;case 22:var pe=A.stateNode;A.memoizedState!==null?pe._visibility&2?Jo(v,A,z,X,y):Gc(v,A):(pe._visibility|=2,Jo(v,A,z,X,y)),y&&ue&2048&&Ip(A.alternate,A);break;case 24:Jo(v,A,z,X,y),y&&ue&2048&&Mp(A.alternate,A);break;default:Jo(v,A,z,X,y)}s=s.sibling}}function Gc(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var l=i,d=s,y=d.flags;switch(d.tag){case 22:Gc(l,d),y&2048&&Ip(d.alternate,d);break;case 24:Gc(l,d),y&2048&&Mp(d.alternate,d);break;default:Gc(l,d)}s=s.sibling}}var Qc=8192;function Zo(i,s,l){if(i.subtreeFlags&Qc)for(i=i.child;i!==null;)Gb(i,s,l),i=i.sibling}function Gb(i,s,l){switch(i.tag){case 26:Zo(i,s,l),i.flags&Qc&&i.memoizedState!==null&&vj(l,Wr,i.memoizedState,i.memoizedProps);break;case 5:Zo(i,s,l);break;case 3:case 4:var d=Wr;Wr=_h(i.stateNode.containerInfo),Zo(i,s,l),Wr=d;break;case 22:i.memoizedState===null&&(d=i.alternate,d!==null&&d.memoizedState!==null?(d=Qc,Qc=16777216,Zo(i,s,l),Qc=d):Zo(i,s,l));break;default:Zo(i,s,l)}}function Qb(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function Wc(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var d=s[l];bn=d,Kb(d,i)}Qb(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Wb(i),i=i.sibling}function Wb(i){switch(i.tag){case 0:case 11:case 15:Wc(i),i.flags&2048&&Bs(9,i,i.return);break;case 3:Wc(i);break;case 12:Wc(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&2&&(i.return===null||i.return.tag!==13)?(s._visibility&=-3,sh(i)):Wc(i);break;default:Wc(i)}}function sh(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var d=s[l];bn=d,Kb(d,i)}Qb(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:Bs(8,s,s.return),sh(s);break;case 22:l=s.stateNode,l._visibility&2&&(l._visibility&=-3,sh(s));break;default:sh(s)}i=i.sibling}}function Kb(i,s){for(;bn!==null;){var l=bn;switch(l.tag){case 0:case 11:case 15:Bs(8,l,s);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var d=l.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Ic(l.memoizedState.cache)}if(d=l.child,d!==null)d.return=l,bn=d;else e:for(l=i;bn!==null;){d=bn;var y=d.sibling,v=d.return;if(zb(d),d===l){bn=null;break e}if(y!==null){y.return=v,bn=y;break e}bn=v}}}var NA={getCacheForType:function(i){var s=Cn(Zt),l=s.data.get(i);return l===void 0&&(l=i(),s.data.set(i,l)),l},cacheSignal:function(){return Cn(Zt).controller.signal}},PA=typeof WeakMap=="function"?WeakMap:Map,ft=0,Ct=null,Ye=null,Ze=0,yt=0,ur=null,zs=!1,el=!1,kp=!1,ts=0,Vt=0,Us=0,eo=0,Op=0,dr=0,tl=0,Kc=null,Xn=null,Np=!1,ah=0,Yb=0,oh=1/0,lh=null,Vs=null,un=0,Fs=null,nl=null,ns=0,Pp=0,Lp=null,Xb=null,Yc=0,Bp=null;function hr(){return(ft&2)!==0&&Ze!==0?Ze&-Ze:B.T!==null?qp():cd()}function Jb(){if(dr===0)if((Ze&536870912)===0||it){var i=Aa;Aa<<=1,(Aa&3932160)===0&&(Aa=262144),dr=i}else dr=536870912;return i=lr.current,i!==null&&(i.flags|=32),dr}function Jn(i,s,l){(i===Ct&&(yt===2||yt===9)||i.cancelPendingCommit!==null)&&(rl(i,0),$s(i,Ze,dr,!1)),ja(i,l),((ft&2)===0||i!==Ct)&&(i===Ct&&((ft&2)===0&&(eo|=l),Vt===4&&$s(i,Ze,dr,!1)),Ci(i))}function Zb(i,s,l){if((ft&6)!==0)throw Error(r(327));var d=!l&&(s&127)===0&&(s&i.expiredLanes)===0||zr(i,s),y=d?zA(i,s):Up(i,s,!0),v=d;do{if(y===0){el&&!d&&$s(i,s,0,!1);break}else{if(l=i.current.alternate,v&&!LA(l)){y=Up(i,s,!1),v=!1;continue}if(y===2){if(v=s,i.errorRecoveryDisabledLanes&v)var A=0;else A=i.pendingLanes&-536870913,A=A!==0?A:A&536870912?536870912:0;if(A!==0){s=A;e:{var z=i;y=Kc;var X=z.current.memoizedState.isDehydrated;if(X&&(rl(z,A).flags|=256),A=Up(z,A,!1),A!==2){if(kp&&!X){z.errorRecoveryDisabledLanes|=v,eo|=v,y=4;break e}v=Xn,Xn=y,v!==null&&(Xn===null?Xn=v:Xn.push.apply(Xn,v))}y=A}if(v=!1,y!==2)continue}}if(y===1){rl(i,0),$s(i,s,0,!0);break}e:{switch(d=i,v=y,v){case 0:case 1:throw Error(r(345));case 4:if((s&4194048)!==s)break;case 6:$s(d,s,dr,!zs);break e;case 2:Xn=null;break;case 3:case 5:break;default:throw Error(r(329))}if((s&62914560)===s&&(y=ah+300-cn(),10<y)){if($s(d,s,dr,!zs),oi(d,0,!0)!==0)break e;ns=s,d.timeoutHandle=Dv(ev.bind(null,d,l,Xn,lh,Np,s,dr,eo,tl,zs,v,"Throttled",-0,0),y);break e}ev(d,l,Xn,lh,Np,s,dr,eo,tl,zs,v,null,-0,0)}}break}while(!0);Ci(i)}function ev(i,s,l,d,y,v,A,z,X,ue,pe,be,de,me){if(i.timeoutHandle=-1,be=s.subtreeFlags,be&8192||(be&16785408)===16785408){be={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Fr},Gb(s,v,be);var Re=(v&62914560)===v?ah-cn():(v&4194048)===v?Yb-cn():0;if(Re=xj(be,Re),Re!==null){ns=v,i.cancelPendingCommit=Re(lv.bind(null,i,s,v,l,d,y,A,z,X,pe,be,null,de,me)),$s(i,v,A,!ue);return}}lv(i,s,v,l,d,y,A,z,X)}function LA(i){for(var s=i;;){var l=s.tag;if((l===0||l===11||l===15)&&s.flags&16384&&(l=s.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var d=0;d<l.length;d++){var y=l[d],v=y.getSnapshot;y=y.value;try{if(!ar(v(),y))return!1}catch{return!1}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function $s(i,s,l,d){s&=~Op,s&=~eo,i.suspendedLanes|=s,i.pingedLanes&=~s,d&&(i.warmLanes|=s),d=i.expirationTimes;for(var y=s;0<y;){var v=31-$t(y),A=1<<v;d[v]=-1,y&=~A}l!==0&&Ra(i,l,s)}function ch(){return(ft&6)===0?(Xc(0),!1):!0}function zp(){if(Ye!==null){if(yt===0)var i=Ye.return;else i=Ye,Hi=Ha=null,tp(i),Qo=null,kc=0,i=Ye;for(;i!==null;)Ib(i.alternate,i),i=i.return;Ye=null}}function rl(i,s){var l=i.timeoutHandle;l!==-1&&(i.timeoutHandle=-1,rj(l)),l=i.cancelPendingCommit,l!==null&&(i.cancelPendingCommit=null,l()),ns=0,zp(),Ct=i,Ye=l=$i(i.current,null),Ze=s,yt=0,ur=null,zs=!1,el=zr(i,s),kp=!1,tl=dr=Op=eo=Us=Vt=0,Xn=Kc=null,Np=!1,(s&8)!==0&&(s|=s&32);var d=i.entangledLanes;if(d!==0)for(i=i.entanglements,d&=s;0<d;){var y=31-$t(d),v=1<<y;s|=i[y],d&=~v}return ts=s,Dd(),l}function tv(i,s){Ge=null,B.H=Vc,s===Go||s===Bd?(s=y_(),yt=3):s===$m?(s=y_(),yt=4):yt=s===yp?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,ur=s,Ye===null&&(Vt=1,Jd(i,Er(s,i.current)))}function nv(){var i=lr.current;return i===null?!0:(Ze&4194048)===Ze?jr===null:(Ze&62914560)===Ze||(Ze&536870912)!==0?i===jr:!1}function rv(){var i=B.H;return B.H=Vc,i===null?Vc:i}function iv(){var i=B.A;return B.A=NA,i}function uh(){Vt=4,zs||(Ze&4194048)!==Ze&&lr.current!==null||(el=!0),(Us&134217727)===0&&(eo&134217727)===0||Ct===null||$s(Ct,Ze,dr,!1)}function Up(i,s,l){var d=ft;ft|=2;var y=rv(),v=iv();(Ct!==i||Ze!==s)&&(lh=null,rl(i,s)),s=!1;var A=Vt;e:do try{if(yt!==0&&Ye!==null){var z=Ye,X=ur;switch(yt){case 8:zp(),A=6;break e;case 3:case 2:case 9:case 6:lr.current===null&&(s=!0);var ue=yt;if(yt=0,ur=null,il(i,z,X,ue),l&&el){A=0;break e}break;default:ue=yt,yt=0,ur=null,il(i,z,X,ue)}}BA(),A=Vt;break}catch(pe){tv(i,pe)}while(!0);return s&&i.shellSuspendCounter++,Hi=Ha=null,ft=d,B.H=y,B.A=v,Ye===null&&(Ct=null,Ze=0,Dd()),A}function BA(){for(;Ye!==null;)sv(Ye)}function zA(i,s){var l=ft;ft|=2;var d=rv(),y=iv();Ct!==i||Ze!==s?(lh=null,oh=cn()+500,rl(i,s)):el=zr(i,s);e:do try{if(yt!==0&&Ye!==null){s=Ye;var v=ur;t:switch(yt){case 1:yt=0,ur=null,il(i,s,v,1);break;case 2:case 9:if(p_(v)){yt=0,ur=null,av(s);break}s=function(){yt!==2&&yt!==9||Ct!==i||(yt=7),Ci(i)},v.then(s,s);break e;case 3:yt=7;break e;case 4:yt=5;break e;case 7:p_(v)?(yt=0,ur=null,av(s)):(yt=0,ur=null,il(i,s,v,7));break;case 5:var A=null;switch(Ye.tag){case 26:A=Ye.memoizedState;case 5:case 27:var z=Ye;if(A?Hv(A):z.stateNode.complete){yt=0,ur=null;var X=z.sibling;if(X!==null)Ye=X;else{var ue=z.return;ue!==null?(Ye=ue,dh(ue)):Ye=null}break t}}yt=0,ur=null,il(i,s,v,5);break;case 6:yt=0,ur=null,il(i,s,v,6);break;case 8:zp(),Vt=6;break e;default:throw Error(r(462))}}UA();break}catch(pe){tv(i,pe)}while(!0);return Hi=Ha=null,B.H=d,B.A=y,ft=l,Ye!==null?0:(Ct=null,Ze=0,Dd(),Vt)}function UA(){for(;Ye!==null&&!ln();)sv(Ye)}function sv(i){var s=Rb(i.alternate,i,ts);i.memoizedProps=i.pendingProps,s===null?dh(i):Ye=s}function av(i){var s=i,l=s.alternate;switch(s.tag){case 15:case 0:s=wb(l,s,s.pendingProps,s.type,void 0,Ze);break;case 11:s=wb(l,s,s.pendingProps,s.type.render,s.ref,Ze);break;case 5:tp(s);default:Ib(l,s),s=Ye=i_(s,ts),s=Rb(l,s,ts)}i.memoizedProps=i.pendingProps,s===null?dh(i):Ye=s}function il(i,s,l,d){Hi=Ha=null,tp(s),Qo=null,kc=0;var y=s.return;try{if(jA(i,y,s,l,Ze)){Vt=1,Jd(i,Er(l,i.current)),Ye=null;return}}catch(v){if(y!==null)throw Ye=y,v;Vt=1,Jd(i,Er(l,i.current)),Ye=null;return}s.flags&32768?(it||d===1?i=!0:el||(Ze&536870912)!==0?i=!1:(zs=i=!0,(d===2||d===9||d===3||d===6)&&(d=lr.current,d!==null&&d.tag===13&&(d.flags|=16384))),ov(s,i)):dh(s)}function dh(i){var s=i;do{if((s.flags&32768)!==0){ov(s,zs);return}i=s.return;var l=IA(s.alternate,s,ts);if(l!==null){Ye=l;return}if(s=s.sibling,s!==null){Ye=s;return}Ye=s=i}while(s!==null);Vt===0&&(Vt=5)}function ov(i,s){do{var l=MA(i.alternate,i);if(l!==null){l.flags&=32767,Ye=l;return}if(l=i.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!s&&(i=i.sibling,i!==null)){Ye=i;return}Ye=i=l}while(i!==null);Vt=6,Ye=null}function lv(i,s,l,d,y,v,A,z,X){i.cancelPendingCommit=null;do hh();while(un!==0);if((ft&6)!==0)throw Error(r(327));if(s!==null){if(s===i.current)throw Error(r(177));if(v=s.lanes|s.childLanes,v|=jm,bm(i,l,v,A,z,X),i===Ct&&(Ye=Ct=null,Ze=0),nl=s,Fs=i,ns=l,Pp=v,Lp=y,Xb=d,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,qA(bs,function(){return fv(),null})):(i.callbackNode=null,i.callbackPriority=0),d=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||d){d=B.T,B.T=null,y=$.p,$.p=2,A=ft,ft|=4;try{kA(i,s,l)}finally{ft=A,$.p=y,B.T=d}}un=1,cv(),uv(),dv()}}function cv(){if(un===1){un=0;var i=Fs,s=nl,l=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||l){l=B.T,B.T=null;var d=$.p;$.p=2;var y=ft;ft|=4;try{$b(s,i);var v=Jp,A=K0(i.containerInfo),z=v.focusedElem,X=v.selectionRange;if(A!==z&&z&&z.ownerDocument&&W0(z.ownerDocument.documentElement,z)){if(X!==null&&wm(z)){var ue=X.start,pe=X.end;if(pe===void 0&&(pe=ue),"selectionStart"in z)z.selectionStart=ue,z.selectionEnd=Math.min(pe,z.value.length);else{var be=z.ownerDocument||document,de=be&&be.defaultView||window;if(de.getSelection){var me=de.getSelection(),Re=z.textContent.length,Le=Math.min(X.start,Re),St=X.end===void 0?Le:Math.min(X.end,Re);!me.extend&&Le>St&&(A=St,St=Le,Le=A);var ae=Q0(z,Le),ie=Q0(z,St);if(ae&&ie&&(me.rangeCount!==1||me.anchorNode!==ae.node||me.anchorOffset!==ae.offset||me.focusNode!==ie.node||me.focusOffset!==ie.offset)){var ce=be.createRange();ce.setStart(ae.node,ae.offset),me.removeAllRanges(),Le>St?(me.addRange(ce),me.extend(ie.node,ie.offset)):(ce.setEnd(ie.node,ie.offset),me.addRange(ce))}}}}for(be=[],me=z;me=me.parentNode;)me.nodeType===1&&be.push({element:me,left:me.scrollLeft,top:me.scrollTop});for(typeof z.focus=="function"&&z.focus(),z=0;z<be.length;z++){var ye=be[z];ye.element.scrollLeft=ye.left,ye.element.scrollTop=ye.top}}Eh=!!Xp,Jp=Xp=null}finally{ft=y,$.p=d,B.T=l}}i.current=s,un=2}}function uv(){if(un===2){un=0;var i=Fs,s=nl,l=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||l){l=B.T,B.T=null;var d=$.p;$.p=2;var y=ft;ft|=4;try{Bb(i,s.alternate,s)}finally{ft=y,$.p=d,B.T=l}}un=3}}function dv(){if(un===4||un===3){un=0,_s();var i=Fs,s=nl,l=ns,d=Xb;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?un=5:(un=0,nl=Fs=null,hv(i,i.pendingLanes));var y=i.pendingLanes;if(y===0&&(Vs=null),zi(l),s=s.stateNode,Sn&&typeof Sn.onCommitFiberRoot=="function")try{Sn.onCommitFiberRoot(Br,s,void 0,(s.current.flags&128)===128)}catch{}if(d!==null){s=B.T,y=$.p,$.p=2,B.T=null;try{for(var v=i.onRecoverableError,A=0;A<d.length;A++){var z=d[A];v(z.value,{componentStack:z.stack})}}finally{B.T=s,$.p=y}}(ns&3)!==0&&hh(),Ci(i),y=i.pendingLanes,(l&261930)!==0&&(y&42)!==0?i===Bp?Yc++:(Yc=0,Bp=i):Yc=0,Xc(0)}}function hv(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,Ic(s)))}function hh(){return cv(),uv(),dv(),fv()}function fv(){if(un!==5)return!1;var i=Fs,s=Pp;Pp=0;var l=zi(ns),d=B.T,y=$.p;try{$.p=32>l?32:l,B.T=null,l=Lp,Lp=null;var v=Fs,A=ns;if(un=0,nl=Fs=null,ns=0,(ft&6)!==0)throw Error(r(331));var z=ft;if(ft|=4,Wb(v.current),Hb(v,v.current,A,l),ft=z,Xc(0,!1),Sn&&typeof Sn.onPostCommitFiberRoot=="function")try{Sn.onPostCommitFiberRoot(Br,v)}catch{}return!0}finally{$.p=y,B.T=d,hv(i,s)}}function mv(i,s,l){s=Er(l,s),s=gp(i.stateNode,s,2),i=Ns(i,s,2),i!==null&&(ja(i,2),Ci(i))}function _t(i,s,l){if(i.tag===3)mv(i,i,l);else for(;s!==null;){if(s.tag===3){mv(s,i,l);break}else if(s.tag===1){var d=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Vs===null||!Vs.has(d))){i=Er(l,i),l=pb(2),d=Ns(s,l,2),d!==null&&(gb(l,d,s,i),ja(d,2),Ci(d));break}}s=s.return}}function Vp(i,s,l){var d=i.pingCache;if(d===null){d=i.pingCache=new PA;var y=new Set;d.set(s,y)}else y=d.get(s),y===void 0&&(y=new Set,d.set(s,y));y.has(l)||(kp=!0,y.add(l),i=VA.bind(null,i,s,l),s.then(i,i))}function VA(i,s,l){var d=i.pingCache;d!==null&&d.delete(s),i.pingedLanes|=i.suspendedLanes&l,i.warmLanes&=~l,Ct===i&&(Ze&l)===l&&(Vt===4||Vt===3&&(Ze&62914560)===Ze&&300>cn()-ah?(ft&2)===0&&rl(i,0):Op|=l,tl===Ze&&(tl=0)),Ci(i)}function pv(i,s){s===0&&(s=ld()),i=Fa(i,s),i!==null&&(ja(i,s),Ci(i))}function FA(i){var s=i.memoizedState,l=0;s!==null&&(l=s.retryLane),pv(i,l)}function $A(i,s){var l=0;switch(i.tag){case 31:case 13:var d=i.stateNode,y=i.memoizedState;y!==null&&(l=y.retryLane);break;case 19:d=i.stateNode;break;case 22:d=i.stateNode._retryCache;break;default:throw Error(r(314))}d!==null&&d.delete(s),pv(i,l)}function qA(i,s){return Ft(i,s)}var fh=null,sl=null,Fp=!1,mh=!1,$p=!1,qs=0;function Ci(i){i!==sl&&i.next===null&&(sl===null?fh=sl=i:sl=sl.next=i),mh=!0,Fp||(Fp=!0,GA())}function Xc(i,s){if(!$p&&mh){$p=!0;do for(var l=!1,d=fh;d!==null;){if(i!==0){var y=d.pendingLanes;if(y===0)var v=0;else{var A=d.suspendedLanes,z=d.pingedLanes;v=(1<<31-$t(42|i)+1)-1,v&=y&~(A&~z),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(l=!0,bv(d,v))}else v=Ze,v=oi(d,d===Ct?v:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(v&3)===0||zr(d,v)||(l=!0,bv(d,v));d=d.next}while(l);$p=!1}}function HA(){gv()}function gv(){mh=Fp=!1;var i=0;qs!==0&&nj()&&(i=qs);for(var s=cn(),l=null,d=fh;d!==null;){var y=d.next,v=yv(d,s);v===0?(d.next=null,l===null?fh=y:l.next=y,y===null&&(sl=l)):(l=d,(i!==0||(v&3)!==0)&&(mh=!0)),d=y}un!==0&&un!==5||Xc(i),qs!==0&&(qs=0)}function yv(i,s){for(var l=i.suspendedLanes,d=i.pingedLanes,y=i.expirationTimes,v=i.pendingLanes&-62914561;0<v;){var A=31-$t(v),z=1<<A,X=y[A];X===-1?((z&l)===0||(z&d)!==0)&&(y[A]=_m(z,s)):X<=s&&(i.expiredLanes|=z),v&=~z}if(s=Ct,l=Ze,l=oi(i,i===s?l:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),d=i.callbackNode,l===0||i===s&&(yt===2||yt===9)||i.cancelPendingCommit!==null)return d!==null&&d!==null&&at(d),i.callbackNode=null,i.callbackPriority=0;if((l&3)===0||zr(i,l)){if(s=l&-l,s===i.callbackPriority)return s;switch(d!==null&&at(d),zi(l)){case 2:case 8:l=oc;break;case 32:l=bs;break;case 268435456:l=rd;break;default:l=bs}return d=_v.bind(null,i),l=Ft(l,d),i.callbackPriority=s,i.callbackNode=l,s}return d!==null&&d!==null&&at(d),i.callbackPriority=2,i.callbackNode=null,2}function _v(i,s){if(un!==0&&un!==5)return i.callbackNode=null,i.callbackPriority=0,null;var l=i.callbackNode;if(hh()&&i.callbackNode!==l)return null;var d=Ze;return d=oi(i,i===Ct?d:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),d===0?null:(Zb(i,d,s),yv(i,cn()),i.callbackNode!=null&&i.callbackNode===l?_v.bind(null,i):null)}function bv(i,s){if(hh())return null;Zb(i,s,!0)}function GA(){ij(function(){(ft&6)!==0?Ft(ac,HA):gv()})}function qp(){if(qs===0){var i=qo;i===0&&(i=si,si<<=1,(si&261888)===0&&(si=256)),qs=i}return qs}function vv(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Ro(""+i)}function xv(i,s){var l=s.ownerDocument.createElement("input");return l.name=s.name,l.value=s.value,i.id&&l.setAttribute("form",i.id),s.parentNode.insertBefore(l,s),i=new FormData(i),l.parentNode.removeChild(l),i}function QA(i,s,l,d,y){if(s==="submit"&&l&&l.stateNode===y){var v=vv((y[yn]||null).action),A=d.submitter;A&&(s=(s=A[yn]||null)?vv(s.formAction):A.getAttribute("formAction"),s!==null&&(v=s,A=null));var z=new _i("action","action",null,d,y);i.push({event:z,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(qs!==0){var X=A?xv(y,A):new FormData(y);up(l,{pending:!0,data:X,method:y.method,action:v},null,X)}}else typeof v=="function"&&(z.preventDefault(),X=A?xv(y,A):new FormData(y),up(l,{pending:!0,data:X,method:y.method,action:v},v,X))},currentTarget:y}]})}}for(var Hp=0;Hp<Am.length;Hp++){var Gp=Am[Hp],WA=Gp.toLowerCase(),KA=Gp[0].toUpperCase()+Gp.slice(1);Qr(WA,"on"+KA)}Qr(J0,"onAnimationEnd"),Qr(Z0,"onAnimationIteration"),Qr(e_,"onAnimationStart"),Qr("dblclick","onDoubleClick"),Qr("focusin","onFocus"),Qr("focusout","onBlur"),Qr(dA,"onTransitionRun"),Qr(hA,"onTransitionStart"),Qr(fA,"onTransitionCancel"),Qr(t_,"onTransitionEnd"),mi("onMouseEnter",["mouseout","mouseover"]),mi("onMouseLeave",["mouseout","mouseover"]),mi("onPointerEnter",["pointerout","pointerover"]),mi("onPointerLeave",["pointerout","pointerover"]),fi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fi("onBeforeInput",["compositionend","keypress","textInput","paste"]),fi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),YA=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Jc));function Sv(i,s){s=(s&4)!==0;for(var l=0;l<i.length;l++){var d=i[l],y=d.event;d=d.listeners;e:{var v=void 0;if(s)for(var A=d.length-1;0<=A;A--){var z=d[A],X=z.instance,ue=z.currentTarget;if(z=z.listener,X!==v&&y.isPropagationStopped())break e;v=z,y.currentTarget=ue;try{v(y)}catch(pe){Rd(pe)}y.currentTarget=null,v=X}else for(A=0;A<d.length;A++){if(z=d[A],X=z.instance,ue=z.currentTarget,z=z.listener,X!==v&&y.isPropagationStopped())break e;v=z,y.currentTarget=ue;try{v(y)}catch(pe){Rd(pe)}y.currentTarget=null,v=X}}}}function Xe(i,s){var l=s[Eo];l===void 0&&(l=s[Eo]=new Set);var d=i+"__bubble";l.has(d)||(wv(s,i,2,!1),l.add(d))}function Qp(i,s,l){var d=0;s&&(d|=4),wv(l,i,d,s)}var ph="_reactListening"+Math.random().toString(36).slice(2);function Wp(i){if(!i[ph]){i[ph]=!0,uc.forEach(function(l){l!=="selectionchange"&&(YA.has(l)||Qp(l,!1,i),Qp(l,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[ph]||(s[ph]=!0,Qp("selectionchange",!1,s))}}function wv(i,s,l,d){switch(Jv(s)){case 2:var y=Ej;break;case 8:y=Cj;break;default:y=cg}l=y.bind(null,s,l,i),y=void 0,!Oa||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(y=!0),d?y!==void 0?i.addEventListener(s,l,{capture:!0,passive:y}):i.addEventListener(s,l,!0):y!==void 0?i.addEventListener(s,l,{passive:y}):i.addEventListener(s,l,!1)}function Kp(i,s,l,d,y){var v=d;if((s&1)===0&&(s&2)===0&&d!==null)e:for(;;){if(d===null)return;var A=d.tag;if(A===3||A===4){var z=d.stateNode.containerInfo;if(z===y)break;if(A===4)for(A=d.return;A!==null;){var X=A.tag;if((X===3||X===4)&&A.stateNode.containerInfo===y)return;A=A.return}for(;z!==null;){if(A=di(z),A===null)return;if(X=A.tag,X===5||X===6||X===26||X===27){d=v=A;continue e}z=z.parentNode}}d=d.return}Cs(function(){var ue=v,pe=vr(l),be=[];e:{var de=n_.get(i);if(de!==void 0){var me=_i,Re=i;switch(i){case"keypress":if(Pa(l)===0)break e;case"keydown":case"keyup":me=Td;break;case"focusin":Re="focus",me=Ba;break;case"focusout":Re="blur",me=Ba;break;case"beforeblur":case"afterblur":me=Ba;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":me=wc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":me=yd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":me=w;break;case J0:case Z0:case e_:me=bd;break;case t_:me=F;break;case"scroll":case"scrollend":me=Sc;break;case"wheel":me=fe;break;case"copy":case"cut":case"paste":me=vd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":me=Fi;break;case"toggle":case"beforetoggle":me=He}var Le=(s&4)!==0,St=!Le&&(i==="scroll"||i==="scrollend"),ae=Le?de!==null?de+"Capture":null:de;Le=[];for(var ie=ue,ce;ie!==null;){var ye=ie;if(ce=ye.stateNode,ye=ye.tag,ye!==5&&ye!==26&&ye!==27||ce===null||ae===null||(ye=$r(ie,ae),ye!=null&&Le.push(Zc(ie,ye,ce))),St)break;ie=ie.return}0<Le.length&&(de=new me(de,Re,null,l,pe),be.push({event:de,listeners:Le}))}}if((s&7)===0){e:{if(de=i==="mouseover"||i==="pointerover",me=i==="mouseout"||i==="pointerout",de&&l!==bc&&(Re=l.relatedTarget||l.fromElement)&&(di(Re)||Re[ci]))break e;if((me||de)&&(de=pe.window===pe?pe:(de=pe.ownerDocument)?de.defaultView||de.parentWindow:window,me?(Re=l.relatedTarget||l.toElement,me=ue,Re=Re?di(Re):null,Re!==null&&(St=o(Re),Le=Re.tag,Re!==St||Le!==5&&Le!==27&&Le!==6)&&(Re=null)):(me=null,Re=ue),me!==Re)){if(Le=wc,ye="onMouseLeave",ae="onMouseEnter",ie="mouse",(i==="pointerout"||i==="pointerover")&&(Le=Fi,ye="onPointerLeave",ae="onPointerEnter",ie="pointer"),St=me==null?de:ir(me),ce=Re==null?de:ir(Re),de=new Le(ye,ie+"leave",me,l,pe),de.target=St,de.relatedTarget=ce,ye=null,di(pe)===ue&&(Le=new Le(ae,ie+"enter",Re,l,pe),Le.target=ce,Le.relatedTarget=St,ye=Le),St=ye,me&&Re)t:{for(Le=XA,ae=me,ie=Re,ce=0,ye=ae;ye;ye=Le(ye))ce++;ye=0;for(var Oe=ie;Oe;Oe=Le(Oe))ye++;for(;0<ce-ye;)ae=Le(ae),ce--;for(;0<ye-ce;)ie=Le(ie),ye--;for(;ce--;){if(ae===ie||ie!==null&&ae===ie.alternate){Le=ae;break t}ae=Le(ae),ie=Le(ie)}Le=null}else Le=null;me!==null&&Ev(be,de,me,Le,!1),Re!==null&&St!==null&&Ev(be,St,Re,Le,!0)}}e:{if(de=ue?ir(ue):window,me=de.nodeName&&de.nodeName.toLowerCase(),me==="select"||me==="input"&&de.type==="file")var ct=V0;else if(z0(de))if(F0)ct=lA;else{ct=aA;var De=sA}else me=de.nodeName,!me||me.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?ue&&jo(ue.elementType)&&(ct=V0):ct=oA;if(ct&&(ct=ct(i,ue))){U0(be,ct,l,pe);break e}De&&De(i,de,ue),i==="focusout"&&ue&&de.type==="number"&&ue.memoizedProps.value!=null&&gc(de,"number",de.value)}switch(De=ue?ir(ue):window,i){case"focusin":(z0(De)||De.contentEditable==="true")&&(Po=De,Em=ue,jc=null);break;case"focusout":jc=Em=Po=null;break;case"mousedown":Cm=!0;break;case"contextmenu":case"mouseup":case"dragend":Cm=!1,Y0(be,l,pe);break;case"selectionchange":if(uA)break;case"keydown":case"keyup":Y0(be,l,pe)}var Ke;if(ht)e:{switch(i){case"compositionstart":var et="onCompositionStart";break e;case"compositionend":et="onCompositionEnd";break e;case"compositionupdate":et="onCompositionUpdate";break e}et=void 0}else No?za(i,l)&&(et="onCompositionEnd"):i==="keydown"&&l.keyCode===229&&(et="onCompositionStart");et&&(xi&&l.locale!=="ko"&&(No||et!=="onCompositionStart"?et==="onCompositionEnd"&&No&&(Ke=xc()):(yi=pe,vc="value"in yi?yi.value:yi.textContent,No=!0)),De=gh(ue,et),0<De.length&&(et=new vi(et,i,null,l,pe),be.push({event:et,listeners:De}),Ke?et.data=Ke:(Ke=Oo(l),Ke!==null&&(et.data=Ke)))),(Ke=Sr?tA(i,l):nA(i,l))&&(et=gh(ue,"onBeforeInput"),0<et.length&&(De=new vi("onBeforeInput","beforeinput",null,l,pe),be.push({event:De,listeners:et}),De.data=Ke)),QA(be,i,ue,l,pe)}Sv(be,s)})}function Zc(i,s,l){return{instance:i,listener:s,currentTarget:l}}function gh(i,s){for(var l=s+"Capture",d=[];i!==null;){var y=i,v=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||v===null||(y=$r(i,l),y!=null&&d.unshift(Zc(i,y,v)),y=$r(i,s),y!=null&&d.push(Zc(i,y,v))),i.tag===3)return d;i=i.return}return[]}function XA(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Ev(i,s,l,d,y){for(var v=s._reactName,A=[];l!==null&&l!==d;){var z=l,X=z.alternate,ue=z.stateNode;if(z=z.tag,X!==null&&X===d)break;z!==5&&z!==26&&z!==27||ue===null||(X=ue,y?(ue=$r(l,v),ue!=null&&A.unshift(Zc(l,ue,X))):y||(ue=$r(l,v),ue!=null&&A.push(Zc(l,ue,X)))),l=l.return}A.length!==0&&i.push({event:s,listeners:A})}var JA=/\r\n?/g,ZA=/\u0000|\uFFFD/g;function Cv(i){return(typeof i=="string"?i:""+i).replace(JA,`
`).replace(ZA,"")}function Tv(i,s){return s=Cv(s),Cv(i)===s}function xt(i,s,l,d,y,v){switch(l){case"children":typeof d=="string"?s==="body"||s==="textarea"&&d===""||Qn(i,d):(typeof d=="number"||typeof d=="bigint")&&s!=="body"&&Qn(i,""+d);break;case"className":sr(i,"class",d);break;case"tabIndex":sr(i,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":sr(i,l,d);break;case"style":_c(i,d,v);break;case"data":if(s!=="object"){sr(i,"data",d);break}case"src":case"href":if(d===""&&(s!=="a"||l!=="href")){i.removeAttribute(l);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){i.removeAttribute(l);break}d=Ro(""+d),i.setAttribute(l,d);break;case"action":case"formAction":if(typeof d=="function"){i.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(l==="formAction"?(s!=="input"&&xt(i,s,"name",y.name,y,null),xt(i,s,"formEncType",y.formEncType,y,null),xt(i,s,"formMethod",y.formMethod,y,null),xt(i,s,"formTarget",y.formTarget,y,null)):(xt(i,s,"encType",y.encType,y,null),xt(i,s,"method",y.method,y,null),xt(i,s,"target",y.target,y,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){i.removeAttribute(l);break}d=Ro(""+d),i.setAttribute(l,d);break;case"onClick":d!=null&&(i.onclick=Fr);break;case"onScroll":d!=null&&Xe("scroll",i);break;case"onScrollEnd":d!=null&&Xe("scrollend",i);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(r(61));if(l=d.__html,l!=null){if(y.children!=null)throw Error(r(60));i.innerHTML=l}}break;case"multiple":i.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":i.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){i.removeAttribute("xlink:href");break}l=Ro(""+d),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(l,""+d):i.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(l,""):i.removeAttribute(l);break;case"capture":case"download":d===!0?i.setAttribute(l,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(l,d):i.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?i.setAttribute(l,d):i.removeAttribute(l);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?i.removeAttribute(l):i.setAttribute(l,d);break;case"popover":Xe("beforetoggle",i),Xe("toggle",i),To(i,"popover",d);break;case"xlinkActuate":Jt(i,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":Jt(i,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":Jt(i,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":Jt(i,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":Jt(i,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":Jt(i,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":Jt(i,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":Jt(i,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":Jt(i,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":To(i,"is",d);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=gd.get(l)||l,To(i,l,d))}}function Yp(i,s,l,d,y,v){switch(l){case"style":_c(i,d,v);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(r(61));if(l=d.__html,l!=null){if(y.children!=null)throw Error(r(60));i.innerHTML=l}}break;case"children":typeof d=="string"?Qn(i,d):(typeof d=="number"||typeof d=="bigint")&&Qn(i,""+d);break;case"onScroll":d!=null&&Xe("scroll",i);break;case"onScrollEnd":d!=null&&Xe("scrollend",i);break;case"onClick":d!=null&&(i.onclick=Fr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!dc.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(y=l.endsWith("Capture"),s=l.slice(2,y?l.length-7:void 0),v=i[yn]||null,v=v!=null?v[l]:null,typeof v=="function"&&i.removeEventListener(s,v,y),typeof d=="function")){typeof v!="function"&&v!==null&&(l in i?i[l]=null:i.hasAttribute(l)&&i.removeAttribute(l)),i.addEventListener(s,d,y);break e}l in i?i[l]=d:d===!0?i.setAttribute(l,""):To(i,l,d)}}}function An(i,s,l){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Xe("error",i),Xe("load",i);var d=!1,y=!1,v;for(v in l)if(l.hasOwnProperty(v)){var A=l[v];if(A!=null)switch(v){case"src":d=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,s));default:xt(i,s,v,A,l,null)}}y&&xt(i,s,"srcSet",l.srcSet,l,null),d&&xt(i,s,"src",l.src,l,null);return;case"input":Xe("invalid",i);var z=v=A=y=null,X=null,ue=null;for(d in l)if(l.hasOwnProperty(d)){var pe=l[d];if(pe!=null)switch(d){case"name":y=pe;break;case"type":A=pe;break;case"checked":X=pe;break;case"defaultChecked":ue=pe;break;case"value":v=pe;break;case"defaultValue":z=pe;break;case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(r(137,s));break;default:xt(i,s,d,pe,l,null)}}fd(i,v,z,X,ue,A,y,!1);return;case"select":Xe("invalid",i),d=A=v=null;for(y in l)if(l.hasOwnProperty(y)&&(z=l[y],z!=null))switch(y){case"value":v=z;break;case"defaultValue":A=z;break;case"multiple":d=z;default:xt(i,s,y,z,l,null)}s=v,l=A,i.multiple=!!d,s!=null?xs(i,!!d,s,!1):l!=null&&xs(i,!!d,l,!0);return;case"textarea":Xe("invalid",i),v=y=d=null;for(A in l)if(l.hasOwnProperty(A)&&(z=l[A],z!=null))switch(A){case"value":d=z;break;case"defaultValue":y=z;break;case"children":v=z;break;case"dangerouslySetInnerHTML":if(z!=null)throw Error(r(91));break;default:xt(i,s,A,z,l,null)}Ss(i,d,y,v);return;case"option":for(X in l)l.hasOwnProperty(X)&&(d=l[X],d!=null)&&(X==="selected"?i.selected=d&&typeof d!="function"&&typeof d!="symbol":xt(i,s,X,d,l,null));return;case"dialog":Xe("beforetoggle",i),Xe("toggle",i),Xe("cancel",i),Xe("close",i);break;case"iframe":case"object":Xe("load",i);break;case"video":case"audio":for(d=0;d<Jc.length;d++)Xe(Jc[d],i);break;case"image":Xe("error",i),Xe("load",i);break;case"details":Xe("toggle",i);break;case"embed":case"source":case"link":Xe("error",i),Xe("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ue in l)if(l.hasOwnProperty(ue)&&(d=l[ue],d!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,s));default:xt(i,s,ue,d,l,null)}return;default:if(jo(s)){for(pe in l)l.hasOwnProperty(pe)&&(d=l[pe],d!==void 0&&Yp(i,s,pe,d,l,void 0));return}}for(z in l)l.hasOwnProperty(z)&&(d=l[z],d!=null&&xt(i,s,z,d,l,null))}function ej(i,s,l,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,v=null,A=null,z=null,X=null,ue=null,pe=null;for(me in l){var be=l[me];if(l.hasOwnProperty(me)&&be!=null)switch(me){case"checked":break;case"value":break;case"defaultValue":X=be;default:d.hasOwnProperty(me)||xt(i,s,me,null,d,be)}}for(var de in d){var me=d[de];if(be=l[de],d.hasOwnProperty(de)&&(me!=null||be!=null))switch(de){case"type":v=me;break;case"name":y=me;break;case"checked":ue=me;break;case"defaultChecked":pe=me;break;case"value":A=me;break;case"defaultValue":z=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(r(137,s));break;default:me!==be&&xt(i,s,de,me,d,be)}}Ao(i,A,z,X,ue,pe,v,y);return;case"select":me=A=z=de=null;for(v in l)if(X=l[v],l.hasOwnProperty(v)&&X!=null)switch(v){case"value":break;case"multiple":me=X;default:d.hasOwnProperty(v)||xt(i,s,v,null,d,X)}for(y in d)if(v=d[y],X=l[y],d.hasOwnProperty(y)&&(v!=null||X!=null))switch(y){case"value":de=v;break;case"defaultValue":z=v;break;case"multiple":A=v;default:v!==X&&xt(i,s,y,v,d,X)}s=z,l=A,d=me,de!=null?xs(i,!!l,de,!1):!!d!=!!l&&(s!=null?xs(i,!!l,s,!0):xs(i,!!l,l?[]:"",!1));return;case"textarea":me=de=null;for(z in l)if(y=l[z],l.hasOwnProperty(z)&&y!=null&&!d.hasOwnProperty(z))switch(z){case"value":break;case"children":break;default:xt(i,s,z,null,d,y)}for(A in d)if(y=d[A],v=l[A],d.hasOwnProperty(A)&&(y!=null||v!=null))switch(A){case"value":de=y;break;case"defaultValue":me=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(r(91));break;default:y!==v&&xt(i,s,A,y,d,v)}md(i,de,me);return;case"option":for(var Re in l)de=l[Re],l.hasOwnProperty(Re)&&de!=null&&!d.hasOwnProperty(Re)&&(Re==="selected"?i.selected=!1:xt(i,s,Re,null,d,de));for(X in d)de=d[X],me=l[X],d.hasOwnProperty(X)&&de!==me&&(de!=null||me!=null)&&(X==="selected"?i.selected=de&&typeof de!="function"&&typeof de!="symbol":xt(i,s,X,de,d,me));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Le in l)de=l[Le],l.hasOwnProperty(Le)&&de!=null&&!d.hasOwnProperty(Le)&&xt(i,s,Le,null,d,de);for(ue in d)if(de=d[ue],me=l[ue],d.hasOwnProperty(ue)&&de!==me&&(de!=null||me!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(r(137,s));break;default:xt(i,s,ue,de,d,me)}return;default:if(jo(s)){for(var St in l)de=l[St],l.hasOwnProperty(St)&&de!==void 0&&!d.hasOwnProperty(St)&&Yp(i,s,St,void 0,d,de);for(pe in d)de=d[pe],me=l[pe],!d.hasOwnProperty(pe)||de===me||de===void 0&&me===void 0||Yp(i,s,pe,de,d,me);return}}for(var ae in l)de=l[ae],l.hasOwnProperty(ae)&&de!=null&&!d.hasOwnProperty(ae)&&xt(i,s,ae,null,d,de);for(be in d)de=d[be],me=l[be],!d.hasOwnProperty(be)||de===me||de==null&&me==null||xt(i,s,be,de,d,me)}function Av(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function tj(){if(typeof performance.getEntriesByType=="function"){for(var i=0,s=0,l=performance.getEntriesByType("resource"),d=0;d<l.length;d++){var y=l[d],v=y.transferSize,A=y.initiatorType,z=y.duration;if(v&&z&&Av(A)){for(A=0,z=y.responseEnd,d+=1;d<l.length;d++){var X=l[d],ue=X.startTime;if(ue>z)break;var pe=X.transferSize,be=X.initiatorType;pe&&Av(be)&&(X=X.responseEnd,A+=pe*(X<z?1:(z-ue)/(X-ue)))}if(--d,s+=8*(v+A)/(y.duration/1e3),i++,10<i)break}}if(0<i)return s/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var Xp=null,Jp=null;function yh(i){return i.nodeType===9?i:i.ownerDocument}function jv(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Rv(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function Zp(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var eg=null;function nj(){var i=window.event;return i&&i.type==="popstate"?i===eg?!1:(eg=i,!0):(eg=null,!1)}var Dv=typeof setTimeout=="function"?setTimeout:void 0,rj=typeof clearTimeout=="function"?clearTimeout:void 0,Iv=typeof Promise=="function"?Promise:void 0,ij=typeof queueMicrotask=="function"?queueMicrotask:typeof Iv<"u"?function(i){return Iv.resolve(null).then(i).catch(sj)}:Dv;function sj(i){setTimeout(function(){throw i})}function Hs(i){return i==="head"}function Mv(i,s){var l=s,d=0;do{var y=l.nextSibling;if(i.removeChild(l),y&&y.nodeType===8)if(l=y.data,l==="/$"||l==="/&"){if(d===0){i.removeChild(y),cl(s);return}d--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")d++;else if(l==="html")eu(i.ownerDocument.documentElement);else if(l==="head"){l=i.ownerDocument.head,eu(l);for(var v=l.firstChild;v;){var A=v.nextSibling,z=v.nodeName;v[ui]||z==="SCRIPT"||z==="STYLE"||z==="LINK"&&v.rel.toLowerCase()==="stylesheet"||l.removeChild(v),v=A}}else l==="body"&&eu(i.ownerDocument.body);l=y}while(l);cl(s)}function kv(i,s){var l=i;i=0;do{var d=l.nextSibling;if(l.nodeType===1?s?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(s?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),d&&d.nodeType===8)if(l=d.data,l==="/$"){if(i===0)break;i--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||i++;l=d}while(l)}function tg(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var l=s;switch(s=s.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":tg(l),Co(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}i.removeChild(l)}}function aj(i,s,l,d){for(;i.nodeType===1;){var y=l;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!d&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(d){if(!i[ui])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(v=i.getAttribute("rel"),v==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(v!==y.rel||i.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||i.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||i.getAttribute("title")!==(y.title==null?null:y.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(v=i.getAttribute("src"),(v!==(y.src==null?null:y.src)||i.getAttribute("type")!==(y.type==null?null:y.type)||i.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&v&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var v=y.name==null?null:""+y.name;if(y.type==="hidden"&&i.getAttribute("name")===v)return i}else return i;if(i=Rr(i.nextSibling),i===null)break}return null}function oj(i,s,l){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!l||(i=Rr(i.nextSibling),i===null))return null;return i}function Ov(i,s){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!s||(i=Rr(i.nextSibling),i===null))return null;return i}function ng(i){return i.data==="$?"||i.data==="$~"}function rg(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function lj(i,s){var l=i.ownerDocument;if(i.data==="$~")i._reactRetry=s;else if(i.data!=="$?"||l.readyState!=="loading")s();else{var d=function(){s(),l.removeEventListener("DOMContentLoaded",d)};l.addEventListener("DOMContentLoaded",d),i._reactRetry=d}}function Rr(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return i}var ig=null;function Nv(i){i=i.nextSibling;for(var s=0;i;){if(i.nodeType===8){var l=i.data;if(l==="/$"||l==="/&"){if(s===0)return Rr(i.nextSibling);s--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||s++}i=i.nextSibling}return null}function Pv(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var l=i.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(s===0)return i;s--}else l!=="/$"&&l!=="/&"||s++}i=i.previousSibling}return null}function Lv(i,s,l){switch(s=yh(l),i){case"html":if(i=s.documentElement,!i)throw Error(r(452));return i;case"head":if(i=s.head,!i)throw Error(r(453));return i;case"body":if(i=s.body,!i)throw Error(r(454));return i;default:throw Error(r(451))}}function eu(i){for(var s=i.attributes;s.length;)i.removeAttributeNode(s[0]);Co(i)}var Dr=new Map,Bv=new Set;function _h(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var rs=$.d;$.d={f:cj,r:uj,D:dj,C:hj,L:fj,m:mj,X:gj,S:pj,M:yj};function cj(){var i=rs.f(),s=ch();return i||s}function uj(i){var s=br(i);s!==null&&s.tag===5&&s.type==="form"?tb(s):rs.r(i)}var al=typeof document>"u"?null:document;function zv(i,s,l){var d=al;if(d&&typeof s=="string"&&s){var y=Gn(s);y='link[rel="'+i+'"][href="'+y+'"]',typeof l=="string"&&(y+='[crossorigin="'+l+'"]'),Bv.has(y)||(Bv.add(y),i={rel:i,crossOrigin:l,href:s},d.querySelector(y)===null&&(s=d.createElement("link"),An(s,"link",i),Xt(s),d.head.appendChild(s)))}}function dj(i){rs.D(i),zv("dns-prefetch",i,null)}function hj(i,s){rs.C(i,s),zv("preconnect",i,s)}function fj(i,s,l){rs.L(i,s,l);var d=al;if(d&&i&&s){var y='link[rel="preload"][as="'+Gn(s)+'"]';s==="image"&&l&&l.imageSrcSet?(y+='[imagesrcset="'+Gn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(y+='[imagesizes="'+Gn(l.imageSizes)+'"]')):y+='[href="'+Gn(i)+'"]';var v=y;switch(s){case"style":v=ol(i);break;case"script":v=ll(i)}Dr.has(v)||(i=_({rel:"preload",href:s==="image"&&l&&l.imageSrcSet?void 0:i,as:s},l),Dr.set(v,i),d.querySelector(y)!==null||s==="style"&&d.querySelector(tu(v))||s==="script"&&d.querySelector(nu(v))||(s=d.createElement("link"),An(s,"link",i),Xt(s),d.head.appendChild(s)))}}function mj(i,s){rs.m(i,s);var l=al;if(l&&i){var d=s&&typeof s.as=="string"?s.as:"script",y='link[rel="modulepreload"][as="'+Gn(d)+'"][href="'+Gn(i)+'"]',v=y;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=ll(i)}if(!Dr.has(v)&&(i=_({rel:"modulepreload",href:i},s),Dr.set(v,i),l.querySelector(y)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(nu(v)))return}d=l.createElement("link"),An(d,"link",i),Xt(d),l.head.appendChild(d)}}}function pj(i,s,l){rs.S(i,s,l);var d=al;if(d&&i){var y=hi(d).hoistableStyles,v=ol(i);s=s||"default";var A=y.get(v);if(!A){var z={loading:0,preload:null};if(A=d.querySelector(tu(v)))z.loading=5;else{i=_({rel:"stylesheet",href:i,"data-precedence":s},l),(l=Dr.get(v))&&sg(i,l);var X=A=d.createElement("link");Xt(X),An(X,"link",i),X._p=new Promise(function(ue,pe){X.onload=ue,X.onerror=pe}),X.addEventListener("load",function(){z.loading|=1}),X.addEventListener("error",function(){z.loading|=2}),z.loading|=4,bh(A,s,d)}A={type:"stylesheet",instance:A,count:1,state:z},y.set(v,A)}}}function gj(i,s){rs.X(i,s);var l=al;if(l&&i){var d=hi(l).hoistableScripts,y=ll(i),v=d.get(y);v||(v=l.querySelector(nu(y)),v||(i=_({src:i,async:!0},s),(s=Dr.get(y))&&ag(i,s),v=l.createElement("script"),Xt(v),An(v,"link",i),l.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},d.set(y,v))}}function yj(i,s){rs.M(i,s);var l=al;if(l&&i){var d=hi(l).hoistableScripts,y=ll(i),v=d.get(y);v||(v=l.querySelector(nu(y)),v||(i=_({src:i,async:!0,type:"module"},s),(s=Dr.get(y))&&ag(i,s),v=l.createElement("script"),Xt(v),An(v,"link",i),l.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},d.set(y,v))}}function Uv(i,s,l,d){var y=(y=se.current)?_h(y):null;if(!y)throw Error(r(446));switch(i){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(s=ol(l.href),l=hi(y).hoistableStyles,d=l.get(s),d||(d={type:"style",instance:null,count:0,state:null},l.set(s,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){i=ol(l.href);var v=hi(y).hoistableStyles,A=v.get(i);if(A||(y=y.ownerDocument||y,A={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(i,A),(v=y.querySelector(tu(i)))&&!v._p&&(A.instance=v,A.state.loading=5),Dr.has(i)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Dr.set(i,l),v||_j(y,i,l,A.state))),s&&d===null)throw Error(r(528,""));return A}if(s&&d!==null)throw Error(r(529,""));return null;case"script":return s=l.async,l=l.src,typeof l=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=ll(l),l=hi(y).hoistableScripts,d=l.get(s),d||(d={type:"script",instance:null,count:0,state:null},l.set(s,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,i))}}function ol(i){return'href="'+Gn(i)+'"'}function tu(i){return'link[rel="stylesheet"]['+i+"]"}function Vv(i){return _({},i,{"data-precedence":i.precedence,precedence:null})}function _j(i,s,l,d){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?d.loading=1:(s=i.createElement("link"),d.preload=s,s.addEventListener("load",function(){return d.loading|=1}),s.addEventListener("error",function(){return d.loading|=2}),An(s,"link",l),Xt(s),i.head.appendChild(s))}function ll(i){return'[src="'+Gn(i)+'"]'}function nu(i){return"script[async]"+i}function Fv(i,s,l){if(s.count++,s.instance===null)switch(s.type){case"style":var d=i.querySelector('style[data-href~="'+Gn(l.href)+'"]');if(d)return s.instance=d,Xt(d),d;var y=_({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return d=(i.ownerDocument||i).createElement("style"),Xt(d),An(d,"style",y),bh(d,l.precedence,i),s.instance=d;case"stylesheet":y=ol(l.href);var v=i.querySelector(tu(y));if(v)return s.state.loading|=4,s.instance=v,Xt(v),v;d=Vv(l),(y=Dr.get(y))&&sg(d,y),v=(i.ownerDocument||i).createElement("link"),Xt(v);var A=v;return A._p=new Promise(function(z,X){A.onload=z,A.onerror=X}),An(v,"link",d),s.state.loading|=4,bh(v,l.precedence,i),s.instance=v;case"script":return v=ll(l.src),(y=i.querySelector(nu(v)))?(s.instance=y,Xt(y),y):(d=l,(y=Dr.get(v))&&(d=_({},l),ag(d,y)),i=i.ownerDocument||i,y=i.createElement("script"),Xt(y),An(y,"link",d),i.head.appendChild(y),s.instance=y);case"void":return null;default:throw Error(r(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(d=s.instance,s.state.loading|=4,bh(d,l.precedence,i));return s.instance}function bh(i,s,l){for(var d=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=d.length?d[d.length-1]:null,v=y,A=0;A<d.length;A++){var z=d[A];if(z.dataset.precedence===s)v=z;else if(v!==y)break}v?v.parentNode.insertBefore(i,v.nextSibling):(s=l.nodeType===9?l.head:l,s.insertBefore(i,s.firstChild))}function sg(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function ag(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var vh=null;function $v(i,s,l){if(vh===null){var d=new Map,y=vh=new Map;y.set(l,d)}else y=vh,d=y.get(l),d||(d=new Map,y.set(l,d));if(d.has(i))return d;for(d.set(i,null),l=l.getElementsByTagName(i),y=0;y<l.length;y++){var v=l[y];if(!(v[ui]||v[Yt]||i==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var A=v.getAttribute(s)||"";A=i+A;var z=d.get(A);z?z.push(v):d.set(A,[v])}}return d}function qv(i,s,l){i=i.ownerDocument||i,i.head.insertBefore(l,s==="title"?i.querySelector("head > title"):null)}function bj(i,s,l){if(l===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(i=s.disabled,typeof s.precedence=="string"&&i==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Hv(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function vj(i,s,l,d){if(l.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var y=ol(d.href),v=s.querySelector(tu(y));if(v){s=v._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(i.count++,i=xh.bind(i),s.then(i,i)),l.state.loading|=4,l.instance=v,Xt(v);return}v=s.ownerDocument||s,d=Vv(d),(y=Dr.get(y))&&sg(d,y),v=v.createElement("link"),Xt(v);var A=v;A._p=new Promise(function(z,X){A.onload=z,A.onerror=X}),An(v,"link",d),l.instance=v}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(l,s),(s=l.state.preload)&&(l.state.loading&3)===0&&(i.count++,l=xh.bind(i),s.addEventListener("load",l),s.addEventListener("error",l))}}var og=0;function xj(i,s){return i.stylesheets&&i.count===0&&wh(i,i.stylesheets),0<i.count||0<i.imgCount?function(l){var d=setTimeout(function(){if(i.stylesheets&&wh(i,i.stylesheets),i.unsuspend){var v=i.unsuspend;i.unsuspend=null,v()}},6e4+s);0<i.imgBytes&&og===0&&(og=62500*tj());var y=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&wh(i,i.stylesheets),i.unsuspend)){var v=i.unsuspend;i.unsuspend=null,v()}},(i.imgBytes>og?50:800)+s);return i.unsuspend=l,function(){i.unsuspend=null,clearTimeout(d),clearTimeout(y)}}:null}function xh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)wh(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Sh=null;function wh(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Sh=new Map,s.forEach(Sj,i),Sh=null,xh.call(i))}function Sj(i,s){if(!(s.state.loading&4)){var l=Sh.get(i);if(l)var d=l.get(null);else{l=new Map,Sh.set(i,l);for(var y=i.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<y.length;v++){var A=y[v];(A.nodeName==="LINK"||A.getAttribute("media")!=="not all")&&(l.set(A.dataset.precedence,A),d=A)}d&&l.set(null,d)}y=s.instance,A=y.getAttribute("data-precedence"),v=l.get(A)||d,v===d&&l.set(null,y),l.set(A,y),this.count++,d=xh.bind(this),y.addEventListener("load",d),y.addEventListener("error",d),v?v.parentNode.insertBefore(y,v.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(y,i.firstChild)),s.state.loading|=4}}var ru={$$typeof:M,Provider:null,Consumer:null,_currentValue:G,_currentValue2:G,_threadCount:0};function wj(i,s,l,d,y,v,A,z,X){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=li(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=li(0),this.hiddenUpdates=li(null),this.identifierPrefix=d,this.onUncaughtError=y,this.onCaughtError=v,this.onRecoverableError=A,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=X,this.incompleteTransitions=new Map}function Gv(i,s,l,d,y,v,A,z,X,ue,pe,be){return i=new wj(i,s,l,A,X,ue,pe,be,z),s=1,v===!0&&(s|=24),v=or(3,null,null,s),i.current=v,v.stateNode=i,s=Um(),s.refCount++,i.pooledCache=s,s.refCount++,v.memoizedState={element:d,isDehydrated:l,cache:s},qm(v),i}function Qv(i){return i?(i=zo,i):zo}function Wv(i,s,l,d,y,v){y=Qv(y),d.context===null?d.context=y:d.pendingContext=y,d=Os(s),d.payload={element:l},v=v===void 0?null:v,v!==null&&(d.callback=v),l=Ns(i,d,s),l!==null&&(Jn(l,i,s),Nc(l,i,s))}function Kv(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var l=i.retryLane;i.retryLane=l!==0&&l<s?l:s}}function lg(i,s){Kv(i,s),(i=i.alternate)&&Kv(i,s)}function Yv(i){if(i.tag===13||i.tag===31){var s=Fa(i,67108864);s!==null&&Jn(s,i,67108864),lg(i,67108864)}}function Xv(i){if(i.tag===13||i.tag===31){var s=hr();s=Da(s);var l=Fa(i,s);l!==null&&Jn(l,i,s),lg(i,s)}}var Eh=!0;function Ej(i,s,l,d){var y=B.T;B.T=null;var v=$.p;try{$.p=2,cg(i,s,l,d)}finally{$.p=v,B.T=y}}function Cj(i,s,l,d){var y=B.T;B.T=null;var v=$.p;try{$.p=8,cg(i,s,l,d)}finally{$.p=v,B.T=y}}function cg(i,s,l,d){if(Eh){var y=ug(d);if(y===null)Kp(i,s,d,Ch,l),Zv(i,d);else if(Aj(y,i,s,l,d))d.stopPropagation();else if(Zv(i,d),s&4&&-1<Tj.indexOf(i)){for(;y!==null;){var v=br(y);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var A=ai(v.pendingLanes);if(A!==0){var z=v;for(z.pendingLanes|=2,z.entangledLanes|=2;A;){var X=1<<31-$t(A);z.entanglements[1]|=X,A&=~X}Ci(v),(ft&6)===0&&(oh=cn()+500,Xc(0))}}break;case 31:case 13:z=Fa(v,2),z!==null&&Jn(z,v,2),ch(),lg(v,2)}if(v=ug(d),v===null&&Kp(i,s,d,Ch,l),v===y)break;y=v}y!==null&&d.stopPropagation()}else Kp(i,s,d,null,l)}}function ug(i){return i=vr(i),dg(i)}var Ch=null;function dg(i){if(Ch=null,i=di(i),i!==null){var s=o(i);if(s===null)i=null;else{var l=s.tag;if(l===13){if(i=u(s),i!==null)return i;i=null}else if(l===31){if(i=h(s),i!==null)return i;i=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return Ch=i,null}function Jv(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Lr()){case ac:return 2;case oc:return 8;case bs:case ym:return 32;case rd:return 268435456;default:return 32}default:return 32}}var hg=!1,Gs=null,Qs=null,Ws=null,iu=new Map,su=new Map,Ks=[],Tj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Zv(i,s){switch(i){case"focusin":case"focusout":Gs=null;break;case"dragenter":case"dragleave":Qs=null;break;case"mouseover":case"mouseout":Ws=null;break;case"pointerover":case"pointerout":iu.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":su.delete(s.pointerId)}}function au(i,s,l,d,y,v){return i===null||i.nativeEvent!==v?(i={blockedOn:s,domEventName:l,eventSystemFlags:d,nativeEvent:v,targetContainers:[y]},s!==null&&(s=br(s),s!==null&&Yv(s)),i):(i.eventSystemFlags|=d,s=i.targetContainers,y!==null&&s.indexOf(y)===-1&&s.push(y),i)}function Aj(i,s,l,d,y){switch(s){case"focusin":return Gs=au(Gs,i,s,l,d,y),!0;case"dragenter":return Qs=au(Qs,i,s,l,d,y),!0;case"mouseover":return Ws=au(Ws,i,s,l,d,y),!0;case"pointerover":var v=y.pointerId;return iu.set(v,au(iu.get(v)||null,i,s,l,d,y)),!0;case"gotpointercapture":return v=y.pointerId,su.set(v,au(su.get(v)||null,i,s,l,d,y)),!0}return!1}function ex(i){var s=di(i.target);if(s!==null){var l=o(s);if(l!==null){if(s=l.tag,s===13){if(s=u(l),s!==null){i.blockedOn=s,Ur(i.priority,function(){Xv(l)});return}}else if(s===31){if(s=h(l),s!==null){i.blockedOn=s,Ur(i.priority,function(){Xv(l)});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){i.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Th(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var l=ug(i.nativeEvent);if(l===null){l=i.nativeEvent;var d=new l.constructor(l.type,l);bc=d,l.target.dispatchEvent(d),bc=null}else return s=br(l),s!==null&&Yv(s),i.blockedOn=l,!1;s.shift()}return!0}function tx(i,s,l){Th(i)&&l.delete(s)}function jj(){hg=!1,Gs!==null&&Th(Gs)&&(Gs=null),Qs!==null&&Th(Qs)&&(Qs=null),Ws!==null&&Th(Ws)&&(Ws=null),iu.forEach(tx),su.forEach(tx)}function Ah(i,s){i.blockedOn===s&&(i.blockedOn=null,hg||(hg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,jj)))}var jh=null;function nx(i){jh!==i&&(jh=i,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){jh===i&&(jh=null);for(var s=0;s<i.length;s+=3){var l=i[s],d=i[s+1],y=i[s+2];if(typeof d!="function"){if(dg(d||l)===null)continue;break}var v=br(l);v!==null&&(i.splice(s,3),s-=3,up(v,{pending:!0,data:y,method:l.method,action:d},d,y))}}))}function cl(i){function s(X){return Ah(X,i)}Gs!==null&&Ah(Gs,i),Qs!==null&&Ah(Qs,i),Ws!==null&&Ah(Ws,i),iu.forEach(s),su.forEach(s);for(var l=0;l<Ks.length;l++){var d=Ks[l];d.blockedOn===i&&(d.blockedOn=null)}for(;0<Ks.length&&(l=Ks[0],l.blockedOn===null);)ex(l),l.blockedOn===null&&Ks.shift();if(l=(i.ownerDocument||i).$$reactFormReplay,l!=null)for(d=0;d<l.length;d+=3){var y=l[d],v=l[d+1],A=y[yn]||null;if(typeof v=="function")A||nx(l);else if(A){var z=null;if(v&&v.hasAttribute("formAction")){if(y=v,A=v[yn]||null)z=A.formAction;else if(dg(y)!==null)continue}else z=A.action;typeof z=="function"?l[d+1]=z:(l.splice(d,3),d-=3),nx(l)}}}function rx(){function i(v){v.canIntercept&&v.info==="react-transition"&&v.intercept({handler:function(){return new Promise(function(A){return y=A})},focusReset:"manual",scroll:"manual"})}function s(){y!==null&&(y(),y=null),d||setTimeout(l,20)}function l(){if(!d&&!navigation.transition){var v=navigation.currentEntry;v&&v.url!=null&&navigation.navigate(v.url,{state:v.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,y=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(l,100),function(){d=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),y!==null&&(y(),y=null)}}}function fg(i){this._internalRoot=i}Rh.prototype.render=fg.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(r(409));var l=s.current,d=hr();Wv(l,d,i,s,null,null)},Rh.prototype.unmount=fg.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;Wv(i.current,2,null,i,null,null),ch(),s[ci]=null}};function Rh(i){this._internalRoot=i}Rh.prototype.unstable_scheduleHydration=function(i){if(i){var s=cd();i={blockedOn:null,target:i,priority:s};for(var l=0;l<Ks.length&&s!==0&&s<Ks[l].priority;l++);Ks.splice(l,0,i),l===0&&ex(i)}};var ix=e.version;if(ix!=="19.2.3")throw Error(r(527,ix,"19.2.3"));$.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(r(188)):(i=Object.keys(i).join(","),Error(r(268,i)));return i=m(s),i=i!==null?g(i):null,i=i===null?null:i.stateNode,i};var Rj={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:B,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Dh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dh.isDisabled&&Dh.supportsFiber)try{Br=Dh.inject(Rj),Sn=Dh}catch{}}return lu.createRoot=function(i,s){if(!a(i))throw Error(r(299));var l=!1,d="",y=db,v=hb,A=fb;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onUncaughtError!==void 0&&(y=s.onUncaughtError),s.onCaughtError!==void 0&&(v=s.onCaughtError),s.onRecoverableError!==void 0&&(A=s.onRecoverableError)),s=Gv(i,1,!1,null,null,l,d,null,y,v,A,rx),i[ci]=s.current,Wp(i),new fg(s)},lu.hydrateRoot=function(i,s,l){if(!a(i))throw Error(r(299));var d=!1,y="",v=db,A=hb,z=fb,X=null;return l!=null&&(l.unstable_strictMode===!0&&(d=!0),l.identifierPrefix!==void 0&&(y=l.identifierPrefix),l.onUncaughtError!==void 0&&(v=l.onUncaughtError),l.onCaughtError!==void 0&&(A=l.onCaughtError),l.onRecoverableError!==void 0&&(z=l.onRecoverableError),l.formState!==void 0&&(X=l.formState)),s=Gv(i,1,!0,s,l??null,d,y,X,v,A,z,rx),s.context=Qv(null),l=s.current,d=hr(),d=Da(d),y=Os(d),y.callback=null,Ns(l,y,d),l=d,s.current.lanes=l,ja(s,l),Ci(s),i[ci]=s.current,Wp(i),new Rh(s)},lu.version="19.2.3",lu}var mx;function zj(){if(mx)return gg.exports;mx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),gg.exports=Bj(),gg.exports}var Uj=zj();var px="popstate";function Vj(t={}){function e(r,a){let{pathname:o,search:u,hash:h}=r.location;return Ug("",{pathname:o,search:u,hash:h},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(r,a){return typeof a=="string"?a:Su(a)}return $j(e,n,null,t)}function Nt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function mr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Fj(){return Math.random().toString(36).substring(2,10)}function gx(t,e){return{usr:t.state,key:t.key,idx:e}}function Ug(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Vl(e):e,state:n,key:e&&e.key||r||Fj()}}function Su({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Vl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function $j(t,e,n,r={}){let{window:a=document.defaultView,v5Compat:o=!1}=r,u=a.history,h="POP",f=null,m=g();m==null&&(m=0,u.replaceState({...u.state,idx:m},""));function g(){return(u.state||{idx:null}).idx}function _(){h="POP";let T=g(),D=T==null?null:T-m;m=T,f&&f({action:h,location:S.location,delta:D})}function b(T,D){h="PUSH";let j=Ug(S.location,T,D);m=g()+1;let M=gx(j,m),K=S.createHref(j);try{u.pushState(M,"",K)}catch(H){if(H instanceof DOMException&&H.name==="DataCloneError")throw H;a.location.assign(K)}o&&f&&f({action:h,location:S.location,delta:1})}function x(T,D){h="REPLACE";let j=Ug(S.location,T,D);m=g();let M=gx(j,m),K=S.createHref(j);u.replaceState(M,"",K),o&&f&&f({action:h,location:S.location,delta:0})}function E(T){return qj(T)}let S={get action(){return h},get location(){return t(a,u)},listen(T){if(f)throw new Error("A history only accepts one active listener");return a.addEventListener(px,_),f=T,()=>{a.removeEventListener(px,_),f=null}},createHref(T){return e(a,T)},createURL:E,encodeLocation(T){let D=E(T);return{pathname:D.pathname,search:D.search,hash:D.hash}},push:b,replace:x,go(T){return u.go(T)}};return S}function qj(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Nt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Su(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function Vw(t,e,n="/"){return Hj(t,e,n,!1)}function Hj(t,e,n,r){let a=typeof e=="string"?Vl(e):e,o=cs(a.pathname||"/",n);if(o==null)return null;let u=Fw(t);Gj(u);let h=null;for(let f=0;h==null&&f<u.length;++f){let m=rR(o);h=tR(u[f],m,r)}return h}function Fw(t,e=[],n=[],r="",a=!1){let o=(u,h,f=a,m)=>{let g={relativePath:m===void 0?u.path||"":m,caseSensitive:u.caseSensitive===!0,childrenIndex:h,route:u};if(g.relativePath.startsWith("/")){if(!g.relativePath.startsWith(r)&&f)return;Nt(g.relativePath.startsWith(r),`Absolute route path "${g.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),g.relativePath=g.relativePath.slice(r.length)}let _=os([r,g.relativePath]),b=n.concat(g);u.children&&u.children.length>0&&(Nt(u.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${_}".`),Fw(u.children,e,b,_,f)),!(u.path==null&&!u.index)&&e.push({path:_,score:Zj(_,u.index),routesMeta:b})};return t.forEach((u,h)=>{if(u.path===""||!u.path?.includes("?"))o(u,h);else for(let f of $w(u.path))o(u,h,!0,f)}),e}function $w(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,a=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return a?[o,""]:[o];let u=$w(r.join("/")),h=[];return h.push(...u.map(f=>f===""?o:[o,f].join("/"))),a&&h.push(...u),h.map(f=>t.startsWith("/")&&f===""?"/":f)}function Gj(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:eR(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var Qj=/^:[\w-]+$/,Wj=3,Kj=2,Yj=1,Xj=10,Jj=-2,yx=t=>t==="*";function Zj(t,e){let n=t.split("/"),r=n.length;return n.some(yx)&&(r+=Jj),e&&(r+=Kj),n.filter(a=>!yx(a)).reduce((a,o)=>a+(Qj.test(o)?Wj:o===""?Yj:Xj),r)}function eR(t,e){return t.length===e.length&&t.slice(0,-1).every((r,a)=>r===e[a])?t[t.length-1]-e[e.length-1]:0}function tR(t,e,n=!1){let{routesMeta:r}=t,a={},o="/",u=[];for(let h=0;h<r.length;++h){let f=r[h],m=h===r.length-1,g=o==="/"?e:e.slice(o.length)||"/",_=tf({path:f.relativePath,caseSensitive:f.caseSensitive,end:m},g),b=f.route;if(!_&&m&&n&&!r[r.length-1].route.index&&(_=tf({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},g)),!_)return null;Object.assign(a,_.params),u.push({params:a,pathname:os([o,_.pathname]),pathnameBase:oR(os([o,_.pathnameBase])),route:b}),_.pathnameBase!=="/"&&(o=os([o,_.pathnameBase]))}return u}function tf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=nR(t.path,t.caseSensitive,t.end),a=e.match(n);if(!a)return null;let o=a[0],u=o.replace(/(.)\/+$/,"$1"),h=a.slice(1);return{params:r.reduce((m,{paramName:g,isOptional:_},b)=>{if(g==="*"){let E=h[b]||"";u=o.slice(0,o.length-E.length).replace(/(.)\/+$/,"$1")}const x=h[b];return _&&!x?m[g]=void 0:m[g]=(x||"").replace(/%2F/g,"/"),m},{}),pathname:o,pathnameBase:u,pattern:t}}function nR(t,e=!1,n=!0){mr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],a="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,h,f)=>(r.push({paramName:h,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),a+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":t!==""&&t!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),r]}function rR(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return mr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function cs(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var qw=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,iR=t=>qw.test(t);function sR(t,e="/"){let{pathname:n,search:r="",hash:a=""}=typeof t=="string"?Vl(t):t,o;if(n)if(iR(n))o=n;else{if(n.includes("//")){let u=n;n=n.replace(/\/\/+/g,"/"),mr(!1,`Pathnames cannot have embedded double slashes - normalizing ${u} -> ${n}`)}n.startsWith("/")?o=_x(n.substring(1),"/"):o=_x(n,e)}else o=e;return{pathname:o,search:lR(r),hash:cR(a)}}function _x(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function vg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function aR(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Ty(t){let e=aR(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Ay(t,e,n,r=!1){let a;typeof t=="string"?a=Vl(t):(a={...t},Nt(!a.pathname||!a.pathname.includes("?"),vg("?","pathname","search",a)),Nt(!a.pathname||!a.pathname.includes("#"),vg("#","pathname","hash",a)),Nt(!a.search||!a.search.includes("#"),vg("#","search","hash",a)));let o=t===""||a.pathname==="",u=o?"/":a.pathname,h;if(u==null)h=n;else{let _=e.length-1;if(!r&&u.startsWith("..")){let b=u.split("/");for(;b[0]==="..";)b.shift(),_-=1;a.pathname=b.join("/")}h=_>=0?e[_]:"/"}let f=sR(a,h),m=u&&u!=="/"&&u.endsWith("/"),g=(o||u===".")&&n.endsWith("/");return!f.pathname.endsWith("/")&&(m||g)&&(f.pathname+="/"),f}var os=t=>t.join("/").replace(/\/\/+/g,"/"),oR=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),lR=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,cR=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,uR=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function dR(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function hR(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Hw=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Gw(t,e){let n=t;if(typeof n!="string"||!qw.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,a=!1;if(Hw)try{let o=new URL(window.location.href),u=n.startsWith("//")?new URL(o.protocol+n):new URL(n),h=cs(u.pathname,e);u.origin===o.origin&&h!=null?n=h+u.search+u.hash:a=!0}catch{mr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:a,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Qw=["POST","PUT","PATCH","DELETE"];new Set(Qw);var fR=["GET",...Qw];new Set(fR);var Fl=C.createContext(null);Fl.displayName="DataRouter";var kf=C.createContext(null);kf.displayName="DataRouterState";var mR=C.createContext(!1),Ww=C.createContext({isTransitioning:!1});Ww.displayName="ViewTransition";var pR=C.createContext(new Map);pR.displayName="Fetchers";var gR=C.createContext(null);gR.displayName="Await";var gr=C.createContext(null);gr.displayName="Navigation";var Lu=C.createContext(null);Lu.displayName="Location";var Pr=C.createContext({outlet:null,matches:[],isDataRoute:!1});Pr.displayName="Route";var jy=C.createContext(null);jy.displayName="RouteError";var Kw="REACT_ROUTER_ERROR",yR="REDIRECT",_R="ROUTE_ERROR_RESPONSE";function bR(t){if(t.startsWith(`${Kw}:${yR}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function vR(t){if(t.startsWith(`${Kw}:${_R}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new uR(e.status,e.statusText,e.data)}catch{}}function xR(t,{relative:e}={}){Nt($l(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=C.useContext(gr),{hash:a,pathname:o,search:u}=zu(t,{relative:e}),h=o;return n!=="/"&&(h=o==="/"?n:os([n,o])),r.createHref({pathname:h,search:u,hash:a})}function $l(){return C.useContext(Lu)!=null}function Bn(){return Nt($l(),"useLocation() may be used only in the context of a <Router> component."),C.useContext(Lu).location}var Yw="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Xw(t){C.useContext(gr).static||C.useLayoutEffect(t)}function Bu(){let{isDataRoute:t}=C.useContext(Pr);return t?LR():SR()}function SR(){Nt($l(),"useNavigate() may be used only in the context of a <Router> component.");let t=C.useContext(Fl),{basename:e,navigator:n}=C.useContext(gr),{matches:r}=C.useContext(Pr),{pathname:a}=Bn(),o=JSON.stringify(Ty(r)),u=C.useRef(!1);return Xw(()=>{u.current=!0}),C.useCallback((f,m={})=>{if(mr(u.current,Yw),!u.current)return;if(typeof f=="number"){n.go(f);return}let g=Ay(f,JSON.parse(o),a,m.relative==="path");t==null&&e!=="/"&&(g.pathname=g.pathname==="/"?e:os([e,g.pathname])),(m.replace?n.replace:n.push)(g,m.state,m)},[e,n,o,a,t])}var wR=C.createContext(null);function ER(t){let e=C.useContext(Pr).outlet;return C.useMemo(()=>e&&C.createElement(wR.Provider,{value:t},e),[e,t])}function CR(){let{matches:t}=C.useContext(Pr),e=t[t.length-1];return e?e.params:{}}function zu(t,{relative:e}={}){let{matches:n}=C.useContext(Pr),{pathname:r}=Bn(),a=JSON.stringify(Ty(n));return C.useMemo(()=>Ay(t,JSON.parse(a),r,e==="path"),[t,a,r,e])}function TR(t,e){return Jw(t,e)}function Jw(t,e,n,r,a){Nt($l(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=C.useContext(gr),{matches:u}=C.useContext(Pr),h=u[u.length-1],f=h?h.params:{},m=h?h.pathname:"/",g=h?h.pathnameBase:"/",_=h&&h.route;{let j=_&&_.path||"";eE(m,!_||j.endsWith("*")||j.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${j}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${j}"> to <Route path="${j==="/"?"*":`${j}/*`}">.`)}let b=Bn(),x;if(e){let j=typeof e=="string"?Vl(e):e;Nt(g==="/"||j.pathname?.startsWith(g),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${g}" but pathname "${j.pathname}" was given in the \`location\` prop.`),x=j}else x=b;let E=x.pathname||"/",S=E;if(g!=="/"){let j=g.replace(/^\//,"").split("/");S="/"+E.replace(/^\//,"").split("/").slice(j.length).join("/")}let T=Vw(t,{pathname:S});mr(_||T!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),mr(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let D=IR(T&&T.map(j=>Object.assign({},j,{params:Object.assign({},f,j.params),pathname:os([g,o.encodeLocation?o.encodeLocation(j.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:j.pathname]),pathnameBase:j.pathnameBase==="/"?g:os([g,o.encodeLocation?o.encodeLocation(j.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:j.pathnameBase])})),u,n,r,a);return e&&D?C.createElement(Lu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},D):D}function AR(){let t=PR(),e=dR(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},u=null;return console.error("Error handled by React Router default ErrorBoundary:",t),u=C.createElement(C.Fragment,null,C.createElement("p",null," Hey developer "),C.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",C.createElement("code",{style:o},"ErrorBoundary")," or"," ",C.createElement("code",{style:o},"errorElement")," prop on your route.")),C.createElement(C.Fragment,null,C.createElement("h2",null,"Unexpected Application Error!"),C.createElement("h3",{style:{fontStyle:"italic"}},e),n?C.createElement("pre",{style:a},n):null,u)}var jR=C.createElement(AR,null),Zw=class extends C.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=vR(t.digest);n&&(t=n)}let e=t!==void 0?C.createElement(Pr.Provider,{value:this.props.routeContext},C.createElement(jy.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?C.createElement(RR,{error:t},e):e}};Zw.contextType=mR;var xg=new WeakMap;function RR({children:t,error:e}){let{basename:n}=C.useContext(gr);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=bR(e.digest);if(r){let a=xg.get(e);if(a)throw a;let o=Gw(r.location,n);if(Hw&&!xg.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const u=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw xg.set(e,u),u}return C.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function DR({routeContext:t,match:e,children:n}){let r=C.useContext(Fl);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),C.createElement(Pr.Provider,{value:t},n)}function IR(t,e=[],n=null,r=null,a=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,u=n?.errors;if(u!=null){let g=o.findIndex(_=>_.route.id&&u?.[_.route.id]!==void 0);Nt(g>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),o=o.slice(0,Math.min(o.length,g+1))}let h=!1,f=-1;if(n)for(let g=0;g<o.length;g++){let _=o[g];if((_.route.HydrateFallback||_.route.hydrateFallbackElement)&&(f=g),_.route.id){let{loaderData:b,errors:x}=n,E=_.route.loader&&!b.hasOwnProperty(_.route.id)&&(!x||x[_.route.id]===void 0);if(_.route.lazy||E){h=!0,f>=0?o=o.slice(0,f+1):o=[o[0]];break}}}let m=n&&r?(g,_)=>{r(g,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:hR(n.matches),errorInfo:_})}:void 0;return o.reduceRight((g,_,b)=>{let x,E=!1,S=null,T=null;n&&(x=u&&_.route.id?u[_.route.id]:void 0,S=_.route.errorElement||jR,h&&(f<0&&b===0?(eE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),E=!0,T=null):f===b&&(E=!0,T=_.route.hydrateFallbackElement||null)));let D=e.concat(o.slice(0,b+1)),j=()=>{let M;return x?M=S:E?M=T:_.route.Component?M=C.createElement(_.route.Component,null):_.route.element?M=_.route.element:M=g,C.createElement(DR,{match:_,routeContext:{outlet:g,matches:D,isDataRoute:n!=null},children:M})};return n&&(_.route.ErrorBoundary||_.route.errorElement||b===0)?C.createElement(Zw,{location:n.location,revalidation:n.revalidation,component:S,error:x,children:j(),routeContext:{outlet:null,matches:D,isDataRoute:!0},onError:m}):j()},null)}function Ry(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function MR(t){let e=C.useContext(Fl);return Nt(e,Ry(t)),e}function kR(t){let e=C.useContext(kf);return Nt(e,Ry(t)),e}function OR(t){let e=C.useContext(Pr);return Nt(e,Ry(t)),e}function Dy(t){let e=OR(t),n=e.matches[e.matches.length-1];return Nt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function NR(){return Dy("useRouteId")}function PR(){let t=C.useContext(jy),e=kR("useRouteError"),n=Dy("useRouteError");return t!==void 0?t:e.errors?.[n]}function LR(){let{router:t}=MR("useNavigate"),e=Dy("useNavigate"),n=C.useRef(!1);return Xw(()=>{n.current=!0}),C.useCallback(async(a,o={})=>{mr(n.current,Yw),n.current&&(typeof a=="number"?await t.navigate(a):await t.navigate(a,{fromRouteId:e,...o}))},[t,e])}var bx={};function eE(t,e,n){!e&&!bx[t]&&(bx[t]=!0,mr(!1,n))}C.memo(BR);function BR({routes:t,future:e,state:n,onError:r}){return Jw(t,void 0,n,r,e)}function Of({to:t,replace:e,state:n,relative:r}){Nt($l(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=C.useContext(gr);mr(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=C.useContext(Pr),{pathname:u}=Bn(),h=Bu(),f=Ay(t,Ty(o),u,r==="path"),m=JSON.stringify(f);return C.useEffect(()=>{h(JSON.parse(m),{replace:e,state:n,relative:r})},[h,m,r,e,n]),null}function Nf(t){return ER(t.context)}function dn(t){Nt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function zR({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:a,static:o=!1,unstable_useTransitions:u}){Nt(!$l(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let h=t.replace(/^\/*/,"/"),f=C.useMemo(()=>({basename:h,navigator:a,static:o,unstable_useTransitions:u,future:{}}),[h,a,o,u]);typeof n=="string"&&(n=Vl(n));let{pathname:m="/",search:g="",hash:_="",state:b=null,key:x="default"}=n,E=C.useMemo(()=>{let S=cs(m,h);return S==null?null:{location:{pathname:S,search:g,hash:_,state:b,key:x},navigationType:r}},[h,m,g,_,b,x,r]);return mr(E!=null,`<Router basename="${h}"> is not able to match the URL "${m}${g}${_}" because it does not start with the basename, so the <Router> won't render anything.`),E==null?null:C.createElement(gr.Provider,{value:f},C.createElement(Lu.Provider,{children:e,value:E}))}function UR({children:t,location:e}){return TR(Vg(t),e)}function Vg(t,e=[]){let n=[];return C.Children.forEach(t,(r,a)=>{if(!C.isValidElement(r))return;let o=[...e,a];if(r.type===C.Fragment){n.push.apply(n,Vg(r.props.children,o));return}Nt(r.type===dn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Nt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let u={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(u.children=Vg(r.props.children,o)),n.push(u)}),n}var Vh="get",Fh="application/x-www-form-urlencoded";function Pf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function VR(t){return Pf(t)&&t.tagName.toLowerCase()==="button"}function FR(t){return Pf(t)&&t.tagName.toLowerCase()==="form"}function $R(t){return Pf(t)&&t.tagName.toLowerCase()==="input"}function qR(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function HR(t,e){return t.button===0&&(!e||e==="_self")&&!qR(t)}function Fg(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(a=>[n,a]):[[n,r]])},[]))}function GR(t,e){let n=Fg(t);return e&&e.forEach((r,a)=>{n.has(a)||e.getAll(a).forEach(o=>{n.append(a,o)})}),n}var Ih=null;function QR(){if(Ih===null)try{new FormData(document.createElement("form"),0),Ih=!1}catch{Ih=!0}return Ih}var WR=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Sg(t){return t!=null&&!WR.has(t)?(mr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Fh}"`),null):t}function KR(t,e){let n,r,a,o,u;if(FR(t)){let h=t.getAttribute("action");r=h?cs(h,e):null,n=t.getAttribute("method")||Vh,a=Sg(t.getAttribute("enctype"))||Fh,o=new FormData(t)}else if(VR(t)||$R(t)&&(t.type==="submit"||t.type==="image")){let h=t.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=t.getAttribute("formaction")||h.getAttribute("action");if(r=f?cs(f,e):null,n=t.getAttribute("formmethod")||h.getAttribute("method")||Vh,a=Sg(t.getAttribute("formenctype"))||Sg(h.getAttribute("enctype"))||Fh,o=new FormData(h,t),!QR()){let{name:m,type:g,value:_}=t;if(g==="image"){let b=m?`${m}.`:"";o.append(`${b}x`,"0"),o.append(`${b}y`,"0")}else m&&o.append(m,_)}}else{if(Pf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Vh,r=null,a=Fh,u=t}return o&&a==="text/plain"&&(u=o,o=void 0),{action:r,method:n.toLowerCase(),encType:a,formData:o,body:u}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Iy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function YR(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&cs(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function XR(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function JR(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function ZR(t,e,n){let r=await Promise.all(t.map(async a=>{let o=e.routes[a.route.id];if(o){let u=await XR(o,n);return u.links?u.links():[]}return[]}));return r5(r.flat(1).filter(JR).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function vx(t,e,n,r,a,o){let u=(f,m)=>n[m]?f.route.id!==n[m].route.id:!0,h=(f,m)=>n[m].pathname!==f.pathname||n[m].route.path?.endsWith("*")&&n[m].params["*"]!==f.params["*"];return o==="assets"?e.filter((f,m)=>u(f,m)||h(f,m)):o==="data"?e.filter((f,m)=>{let g=r.routes[f.route.id];if(!g||!g.hasLoader)return!1;if(u(f,m)||h(f,m))return!0;if(f.route.shouldRevalidate){let _=f.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof _=="boolean")return _}return!0}):[]}function e5(t,e,{includeHydrateFallback:n}={}){return t5(t.map(r=>{let a=e.routes[r.route.id];if(!a)return[];let o=[a.module];return a.clientActionModule&&(o=o.concat(a.clientActionModule)),a.clientLoaderModule&&(o=o.concat(a.clientLoaderModule)),n&&a.hydrateFallbackModule&&(o=o.concat(a.hydrateFallbackModule)),a.imports&&(o=o.concat(a.imports)),o}).flat(1))}function t5(t){return[...new Set(t)]}function n5(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function r5(t,e){let n=new Set;return new Set(e),t.reduce((r,a)=>{let o=JSON.stringify(n5(a));return n.has(o)||(n.add(o),r.push({key:o,link:a})),r},[])}function tE(){let t=C.useContext(Fl);return Iy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function i5(){let t=C.useContext(kf);return Iy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var My=C.createContext(void 0);My.displayName="FrameworkContext";function nE(){let t=C.useContext(My);return Iy(t,"You must render this element inside a <HydratedRouter> element"),t}function s5(t,e){let n=C.useContext(My),[r,a]=C.useState(!1),[o,u]=C.useState(!1),{onFocus:h,onBlur:f,onMouseEnter:m,onMouseLeave:g,onTouchStart:_}=e,b=C.useRef(null);C.useEffect(()=>{if(t==="render"&&u(!0),t==="viewport"){let S=D=>{D.forEach(j=>{u(j.isIntersecting)})},T=new IntersectionObserver(S,{threshold:.5});return b.current&&T.observe(b.current),()=>{T.disconnect()}}},[t]),C.useEffect(()=>{if(r){let S=setTimeout(()=>{u(!0)},100);return()=>{clearTimeout(S)}}},[r]);let x=()=>{a(!0)},E=()=>{a(!1),u(!1)};return n?t!=="intent"?[o,b,{}]:[o,b,{onFocus:cu(h,x),onBlur:cu(f,E),onMouseEnter:cu(m,x),onMouseLeave:cu(g,E),onTouchStart:cu(_,x)}]:[!1,b,{}]}function cu(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function a5({page:t,...e}){let{router:n}=tE(),r=C.useMemo(()=>Vw(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?C.createElement(l5,{page:t,matches:r,...e}):null}function o5(t){let{manifest:e,routeModules:n}=nE(),[r,a]=C.useState([]);return C.useEffect(()=>{let o=!1;return ZR(t,e,n).then(u=>{o||a(u)}),()=>{o=!0}},[t,e,n]),r}function l5({page:t,matches:e,...n}){let r=Bn(),{manifest:a,routeModules:o}=nE(),{basename:u}=tE(),{loaderData:h,matches:f}=i5(),m=C.useMemo(()=>vx(t,e,f,a,r,"data"),[t,e,f,a,r]),g=C.useMemo(()=>vx(t,e,f,a,r,"assets"),[t,e,f,a,r]),_=C.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let E=new Set,S=!1;if(e.forEach(D=>{let j=a.routes[D.route.id];!j||!j.hasLoader||(!m.some(M=>M.route.id===D.route.id)&&D.route.id in h&&o[D.route.id]?.shouldRevalidate||j.hasClientLoader?S=!0:E.add(D.route.id))}),E.size===0)return[];let T=YR(t,u,"data");return S&&E.size>0&&T.searchParams.set("_routes",e.filter(D=>E.has(D.route.id)).map(D=>D.route.id).join(",")),[T.pathname+T.search]},[u,h,r,a,m,e,t,o]),b=C.useMemo(()=>e5(g,a),[g,a]),x=o5(g);return C.createElement(C.Fragment,null,_.map(E=>C.createElement("link",{key:E,rel:"prefetch",as:"fetch",href:E,...n})),b.map(E=>C.createElement("link",{key:E,rel:"modulepreload",href:E,...n})),x.map(({key:E,link:S})=>C.createElement("link",{key:E,nonce:n.nonce,...S})))}function c5(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var u5=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{u5&&(window.__reactRouterVersion="7.11.0")}catch{}function d5({basename:t,children:e,unstable_useTransitions:n,window:r}){let a=C.useRef();a.current==null&&(a.current=Vj({window:r,v5Compat:!0}));let o=a.current,[u,h]=C.useState({action:o.action,location:o.location}),f=C.useCallback(m=>{n===!1?h(m):C.startTransition(()=>h(m))},[n]);return C.useLayoutEffect(()=>o.listen(f),[o,f]),C.createElement(zR,{basename:t,children:e,location:u.location,navigationType:u.action,navigator:o,unstable_useTransitions:n})}var rE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Bt=C.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:a,reloadDocument:o,replace:u,state:h,target:f,to:m,preventScrollReset:g,viewTransition:_,unstable_defaultShouldRevalidate:b,...x},E){let{basename:S,unstable_useTransitions:T}=C.useContext(gr),D=typeof m=="string"&&rE.test(m),j=Gw(m,S);m=j.to;let M=xR(m,{relative:a}),[K,H,Q]=s5(r,x),P=p5(m,{replace:u,state:h,target:f,preventScrollReset:g,relative:a,viewTransition:_,unstable_defaultShouldRevalidate:b,unstable_useTransitions:T});function k(N){e&&e(N),N.defaultPrevented||P(N)}let O=C.createElement("a",{...x,...Q,href:j.absoluteURL||M,onClick:j.isExternal||o?e:k,ref:c5(E,H),target:f,"data-discover":!D&&n==="render"?"true":void 0});return K&&!D?C.createElement(C.Fragment,null,O,C.createElement(a5,{page:M})):O});Bt.displayName="Link";var h5=C.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:a=!1,style:o,to:u,viewTransition:h,children:f,...m},g){let _=zu(u,{relative:m.relative}),b=Bn(),x=C.useContext(kf),{navigator:E,basename:S}=C.useContext(gr),T=x!=null&&x5(_)&&h===!0,D=E.encodeLocation?E.encodeLocation(_).pathname:_.pathname,j=b.pathname,M=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;n||(j=j.toLowerCase(),M=M?M.toLowerCase():null,D=D.toLowerCase()),M&&S&&(M=cs(M,S)||M);const K=D!=="/"&&D.endsWith("/")?D.length-1:D.length;let H=j===D||!a&&j.startsWith(D)&&j.charAt(K)==="/",Q=M!=null&&(M===D||!a&&M.startsWith(D)&&M.charAt(D.length)==="/"),P={isActive:H,isPending:Q,isTransitioning:T},k=H?e:void 0,O;typeof r=="function"?O=r(P):O=[r,H?"active":null,Q?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let N=typeof o=="function"?o(P):o;return C.createElement(Bt,{...m,"aria-current":k,className:O,ref:g,style:N,to:u,viewTransition:h},typeof f=="function"?f(P):f)});h5.displayName="NavLink";var f5=C.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:a,state:o,method:u=Vh,action:h,onSubmit:f,relative:m,preventScrollReset:g,viewTransition:_,unstable_defaultShouldRevalidate:b,...x},E)=>{let{unstable_useTransitions:S}=C.useContext(gr),T=b5(),D=v5(h,{relative:m}),j=u.toLowerCase()==="get"?"get":"post",M=typeof h=="string"&&rE.test(h),K=H=>{if(f&&f(H),H.defaultPrevented)return;H.preventDefault();let Q=H.nativeEvent.submitter,P=Q?.getAttribute("formmethod")||u,k=()=>T(Q||H.currentTarget,{fetcherKey:e,method:P,navigate:n,replace:a,state:o,relative:m,preventScrollReset:g,viewTransition:_,unstable_defaultShouldRevalidate:b});S&&n!==!1?C.startTransition(()=>k()):k()};return C.createElement("form",{ref:E,method:j,action:D,onSubmit:r?f:K,...x,"data-discover":!M&&t==="render"?"true":void 0})});f5.displayName="Form";function m5(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function iE(t){let e=C.useContext(Fl);return Nt(e,m5(t)),e}function p5(t,{target:e,replace:n,state:r,preventScrollReset:a,relative:o,viewTransition:u,unstable_defaultShouldRevalidate:h,unstable_useTransitions:f}={}){let m=Bu(),g=Bn(),_=zu(t,{relative:o});return C.useCallback(b=>{if(HR(b,e)){b.preventDefault();let x=n!==void 0?n:Su(g)===Su(_),E=()=>m(t,{replace:x,state:r,preventScrollReset:a,relative:o,viewTransition:u,unstable_defaultShouldRevalidate:h});f?C.startTransition(()=>E()):E()}},[g,m,_,n,r,e,t,a,o,u,h,f])}function g5(t){mr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=C.useRef(Fg(t)),n=C.useRef(!1),r=Bn(),a=C.useMemo(()=>GR(r.search,n.current?null:e.current),[r.search]),o=Bu(),u=C.useCallback((h,f)=>{const m=Fg(typeof h=="function"?h(new URLSearchParams(a)):h);n.current=!0,o("?"+m,f)},[o,a]);return[a,u]}var y5=0,_5=()=>`__${String(++y5)}__`;function b5(){let{router:t}=iE("useSubmit"),{basename:e}=C.useContext(gr),n=NR(),r=t.fetch,a=t.navigate;return C.useCallback(async(o,u={})=>{let{action:h,method:f,encType:m,formData:g,body:_}=KR(o,e);if(u.navigate===!1){let b=u.fetcherKey||_5();await r(b,n,u.action||h,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:g,body:_,formMethod:u.method||f,formEncType:u.encType||m,flushSync:u.flushSync})}else await a(u.action||h,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:g,body:_,formMethod:u.method||f,formEncType:u.encType||m,replace:u.replace,state:u.state,fromRouteId:n,flushSync:u.flushSync,viewTransition:u.viewTransition})},[r,a,e,n])}function v5(t,{relative:e}={}){let{basename:n}=C.useContext(gr),r=C.useContext(Pr);Nt(r,"useFormAction must be used inside a RouteContext");let[a]=r.matches.slice(-1),o={...zu(t||".",{relative:e})},u=Bn();if(t==null){o.search=u.search;let h=new URLSearchParams(o.search),f=h.getAll("index");if(f.some(g=>g==="")){h.delete("index"),f.filter(_=>_).forEach(_=>h.append("index",_));let g=h.toString();o.search=g?`?${g}`:""}}return(!t||t===".")&&a.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:os([n,o.pathname])),Su(o)}function x5(t,{relative:e}={}){let n=C.useContext(Ww);Nt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=iE("useViewTransitionState"),a=zu(t,{relative:e});if(!n.isTransitioning)return!1;let o=cs(n.currentLocation.pathname,r)||n.currentLocation.pathname,u=cs(n.nextLocation.pathname,r)||n.nextLocation.pathname;return tf(a.pathname,u)!=null||tf(a.pathname,o)!=null}const S5={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},sE=C.createContext(S5);function w5({children:t}){const[e,n]=C.useState(new Map),r=C.useCallback((f,m)=>{n(g=>new Map(g).set(f,m))},[]),a=C.useCallback(f=>{n(m=>{const g=new Map(m);return g.delete(f),g})},[]),o=e.size>0,u=e.size>0&&Array.from(e.values()).pop()||"Loading...",h={isLoading:o,loadingMessage:u,addLoadingHold:r,removeLoadingHold:a};return c.jsx(sE.Provider,{value:h,children:t})}function nr(){const t=C.useContext(sE);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const E5=()=>{};var xx={};const aE=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let a=t.charCodeAt(r);a<128?e[n++]=a:a<2048?(e[n++]=a>>6|192,e[n++]=a&63|128):(a&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(a=65536+((a&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=a>>18|240,e[n++]=a>>12&63|128,e[n++]=a>>6&63|128,e[n++]=a&63|128):(e[n++]=a>>12|224,e[n++]=a>>6&63|128,e[n++]=a&63|128)}return e},C5=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const a=t[n++];if(a<128)e[r++]=String.fromCharCode(a);else if(a>191&&a<224){const o=t[n++];e[r++]=String.fromCharCode((a&31)<<6|o&63)}else if(a>239&&a<365){const o=t[n++],u=t[n++],h=t[n++],f=((a&7)<<18|(o&63)<<12|(u&63)<<6|h&63)-65536;e[r++]=String.fromCharCode(55296+(f>>10)),e[r++]=String.fromCharCode(56320+(f&1023))}else{const o=t[n++],u=t[n++];e[r++]=String.fromCharCode((a&15)<<12|(o&63)<<6|u&63)}}return e.join("")},oE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let a=0;a<t.length;a+=3){const o=t[a],u=a+1<t.length,h=u?t[a+1]:0,f=a+2<t.length,m=f?t[a+2]:0,g=o>>2,_=(o&3)<<4|h>>4;let b=(h&15)<<2|m>>6,x=m&63;f||(x=64,u||(b=64)),r.push(n[g],n[_],n[b],n[x])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(aE(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):C5(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let a=0;a<t.length;){const o=n[t.charAt(a++)],h=a<t.length?n[t.charAt(a)]:0;++a;const m=a<t.length?n[t.charAt(a)]:64;++a;const _=a<t.length?n[t.charAt(a)]:64;if(++a,o==null||h==null||m==null||_==null)throw new T5;const b=o<<2|h>>4;if(r.push(b),m!==64){const x=h<<4&240|m>>2;if(r.push(x),_!==64){const E=m<<6&192|_;r.push(E)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class T5 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const A5=function(t){const e=aE(t);return oE.encodeByteArray(e,!0)},nf=function(t){return A5(t).replace(/\./g,"")},lE=function(t){try{return oE.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function j5(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const R5=()=>j5().__FIREBASE_DEFAULTS__,D5=()=>{if(typeof process>"u"||typeof xx>"u")return;const t=xx.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},I5=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&lE(t[1]);return e&&JSON.parse(e)},Lf=()=>{try{return E5()||R5()||D5()||I5()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},cE=t=>Lf()?.emulatorHosts?.[t],M5=t=>{const e=cE(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},uE=()=>Lf()?.config,dE=t=>Lf()?.[`_${t}`];class k5{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function ql(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function hE(t){return(await fetch(t,{credentials:"include"})).ok}function O5(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",a=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const u={iss:`https://securetoken.google.com/${r}`,aud:r,iat:a,exp:a+3600,auth_time:a,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[nf(JSON.stringify(n)),nf(JSON.stringify(u)),""].join(".")}const gu={};function N5(){const t={prod:[],emulator:[]};for(const e of Object.keys(gu))gu[e]?t.emulator.push(e):t.prod.push(e);return t}function P5(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Sx=!1;function fE(t,e){if(typeof window>"u"||typeof document>"u"||!ql(window.location.host)||gu[t]===e||gu[t]||Sx)return;gu[t]=e;function n(b){return`__firebase__banner__${b}`}const r="__firebase__banner",o=N5().prod.length>0;function u(){const b=document.getElementById(r);b&&b.remove()}function h(b){b.style.display="flex",b.style.background="#7faaf0",b.style.position="fixed",b.style.bottom="5px",b.style.left="5px",b.style.padding=".5em",b.style.borderRadius="5px",b.style.alignItems="center"}function f(b,x){b.setAttribute("width","24"),b.setAttribute("id",x),b.setAttribute("height","24"),b.setAttribute("viewBox","0 0 24 24"),b.setAttribute("fill","none"),b.style.marginLeft="-6px"}function m(){const b=document.createElement("span");return b.style.cursor="pointer",b.style.marginLeft="16px",b.style.fontSize="24px",b.innerHTML=" &times;",b.onclick=()=>{Sx=!0,u()},b}function g(b,x){b.setAttribute("id",x),b.innerText="Learn more",b.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",b.setAttribute("target","__blank"),b.style.paddingLeft="5px",b.style.textDecoration="underline"}function _(){const b=P5(r),x=n("text"),E=document.getElementById(x)||document.createElement("span"),S=n("learnmore"),T=document.getElementById(S)||document.createElement("a"),D=n("preprendIcon"),j=document.getElementById(D)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(b.created){const M=b.element;h(M),g(T,S);const K=m();f(j,D),M.append(j,E,T,K),document.body.appendChild(M)}o?(E.innerText="Preview backend disconnected.",j.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(j.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,E.innerText="Preview backend running in this workspace."),E.setAttribute("id",x)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}function Ln(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function L5(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ln())}function B5(){const t=Lf()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function z5(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function U5(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function V5(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function F5(){const t=Ln();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function $5(){return!B5()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function q5(){try{return typeof indexedDB=="object"}catch{return!1}}function H5(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(r);a.onsuccess=()=>{a.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},a.onupgradeneeded=()=>{n=!1},a.onerror=()=>{e(a.error?.message||"")}}catch(n){e(n)}})}const G5="FirebaseError";class gs extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=G5,Object.setPrototypeOf(this,gs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Uu.prototype.create)}}class Uu{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},a=`${this.service}/${e}`,o=this.errors[e],u=o?Q5(o,r):"Error",h=`${this.serviceName}: ${u} (${a}).`;return new gs(a,h,r)}}function Q5(t,e){return t.replace(W5,(n,r)=>{const a=e[r];return a!=null?String(a):`<${r}?>`})}const W5=/\{\$([^}]+)}/g;function K5(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function ha(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const a of n){if(!r.includes(a))return!1;const o=t[a],u=e[a];if(wx(o)&&wx(u)){if(!ha(o,u))return!1}else if(o!==u)return!1}for(const a of r)if(!n.includes(a))return!1;return!0}function wx(t){return t!==null&&typeof t=="object"}function Vu(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(a=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function uu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[a,o]=r.split("=");e[decodeURIComponent(a)]=decodeURIComponent(o)}}),e}function du(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function Y5(t,e){const n=new X5(t,e);return n.subscribe.bind(n)}class X5{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let a;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");J5(e,["next","error","complete"])?a=e:a={next:e,error:n,complete:r},a.next===void 0&&(a.next=wg),a.error===void 0&&(a.error=wg),a.complete===void 0&&(a.complete=wg);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function J5(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function wg(){}function on(t){return t&&t._delegate?t._delegate:t}class lo{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ro="[DEFAULT]";class Z5{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new k5;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:n});a&&r.resolve(a)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(r)return null;throw a}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(tD(e))try{this.getOrInitializeService({instanceIdentifier:ro})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:a});r.resolve(o)}catch{}}}}clearInstance(e=ro){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ro){return this.instances.has(e)}getOptions(e=ro){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,u]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(o);r===h&&u.resolve(a)}return a}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),a=this.onInitCallbacks.get(r)??new Set;a.add(e),this.onInitCallbacks.set(r,a);const o=this.instances.get(r);return o&&e(o,r),()=>{a.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const a of r)try{a(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:eD(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ro){return this.component?this.component.multipleInstances?e:ro:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function eD(t){return t===ro?void 0:t}function tD(t){return t.instantiationMode==="EAGER"}class nD{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Z5(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var tt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(tt||(tt={}));const rD={debug:tt.DEBUG,verbose:tt.VERBOSE,info:tt.INFO,warn:tt.WARN,error:tt.ERROR,silent:tt.SILENT},iD=tt.INFO,sD={[tt.DEBUG]:"log",[tt.VERBOSE]:"log",[tt.INFO]:"info",[tt.WARN]:"warn",[tt.ERROR]:"error"},aD=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),a=sD[e];if(a)console[a](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ky{constructor(e){this.name=e,this._logLevel=iD,this._logHandler=aD,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in tt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?rD[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,tt.DEBUG,...e),this._logHandler(this,tt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,tt.VERBOSE,...e),this._logHandler(this,tt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,tt.INFO,...e),this._logHandler(this,tt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,tt.WARN,...e),this._logHandler(this,tt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,tt.ERROR,...e),this._logHandler(this,tt.ERROR,...e)}}const oD=(t,e)=>e.some(n=>t instanceof n);let Ex,Cx;function lD(){return Ex||(Ex=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function cD(){return Cx||(Cx=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const mE=new WeakMap,$g=new WeakMap,pE=new WeakMap,Eg=new WeakMap,Oy=new WeakMap;function uD(t){const e=new Promise((n,r)=>{const a=()=>{t.removeEventListener("success",o),t.removeEventListener("error",u)},o=()=>{n(sa(t.result)),a()},u=()=>{r(t.error),a()};t.addEventListener("success",o),t.addEventListener("error",u)});return e.then(n=>{n instanceof IDBCursor&&mE.set(n,t)}).catch(()=>{}),Oy.set(e,t),e}function dD(t){if($g.has(t))return;const e=new Promise((n,r)=>{const a=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",u),t.removeEventListener("abort",u)},o=()=>{n(),a()},u=()=>{r(t.error||new DOMException("AbortError","AbortError")),a()};t.addEventListener("complete",o),t.addEventListener("error",u),t.addEventListener("abort",u)});$g.set(t,e)}let qg={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return $g.get(t);if(e==="objectStoreNames")return t.objectStoreNames||pE.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return sa(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function hD(t){qg=t(qg)}function fD(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Cg(this),e,...n);return pE.set(r,e.sort?e.sort():[e]),sa(r)}:cD().includes(t)?function(...e){return t.apply(Cg(this),e),sa(mE.get(this))}:function(...e){return sa(t.apply(Cg(this),e))}}function mD(t){return typeof t=="function"?fD(t):(t instanceof IDBTransaction&&dD(t),oD(t,lD())?new Proxy(t,qg):t)}function sa(t){if(t instanceof IDBRequest)return uD(t);if(Eg.has(t))return Eg.get(t);const e=mD(t);return e!==t&&(Eg.set(t,e),Oy.set(e,t)),e}const Cg=t=>Oy.get(t);function pD(t,e,{blocked:n,upgrade:r,blocking:a,terminated:o}={}){const u=indexedDB.open(t,e),h=sa(u);return r&&u.addEventListener("upgradeneeded",f=>{r(sa(u.result),f.oldVersion,f.newVersion,sa(u.transaction),f)}),n&&u.addEventListener("blocked",f=>n(f.oldVersion,f.newVersion,f)),h.then(f=>{o&&f.addEventListener("close",()=>o()),a&&f.addEventListener("versionchange",m=>a(m.oldVersion,m.newVersion,m))}).catch(()=>{}),h}const gD=["get","getKey","getAll","getAllKeys","count"],yD=["put","add","delete","clear"],Tg=new Map;function Tx(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Tg.get(e))return Tg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,a=yD.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(a||gD.includes(n)))return;const o=async function(u,...h){const f=this.transaction(u,a?"readwrite":"readonly");let m=f.store;return r&&(m=m.index(h.shift())),(await Promise.all([m[n](...h),a&&f.done]))[0]};return Tg.set(e,o),o}hD(t=>({...t,get:(e,n,r)=>Tx(e,n)||t.get(e,n,r),has:(e,n)=>!!Tx(e,n)||t.has(e,n)}));class _D{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(bD(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function bD(t){return t.getComponent()?.type==="VERSION"}const Hg="@firebase/app",Ax="0.14.6";const us=new ky("@firebase/app"),vD="@firebase/app-compat",xD="@firebase/analytics-compat",SD="@firebase/analytics",wD="@firebase/app-check-compat",ED="@firebase/app-check",CD="@firebase/auth",TD="@firebase/auth-compat",AD="@firebase/database",jD="@firebase/data-connect",RD="@firebase/database-compat",DD="@firebase/functions",ID="@firebase/functions-compat",MD="@firebase/installations",kD="@firebase/installations-compat",OD="@firebase/messaging",ND="@firebase/messaging-compat",PD="@firebase/performance",LD="@firebase/performance-compat",BD="@firebase/remote-config",zD="@firebase/remote-config-compat",UD="@firebase/storage",VD="@firebase/storage-compat",FD="@firebase/firestore",$D="@firebase/ai",qD="@firebase/firestore-compat",HD="firebase",GD="12.6.0";const Gg="[DEFAULT]",QD={[Hg]:"fire-core",[vD]:"fire-core-compat",[SD]:"fire-analytics",[xD]:"fire-analytics-compat",[ED]:"fire-app-check",[wD]:"fire-app-check-compat",[CD]:"fire-auth",[TD]:"fire-auth-compat",[AD]:"fire-rtdb",[jD]:"fire-data-connect",[RD]:"fire-rtdb-compat",[DD]:"fire-fn",[ID]:"fire-fn-compat",[MD]:"fire-iid",[kD]:"fire-iid-compat",[OD]:"fire-fcm",[ND]:"fire-fcm-compat",[PD]:"fire-perf",[LD]:"fire-perf-compat",[BD]:"fire-rc",[zD]:"fire-rc-compat",[UD]:"fire-gcs",[VD]:"fire-gcs-compat",[FD]:"fire-fst",[qD]:"fire-fst-compat",[$D]:"fire-vertex","fire-js":"fire-js",[HD]:"fire-js-all"};const rf=new Map,WD=new Map,Qg=new Map;function jx(t,e){try{t.container.addComponent(e)}catch(n){us.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Al(t){const e=t.name;if(Qg.has(e))return us.debug(`There were multiple attempts to register component ${e}.`),!1;Qg.set(e,t);for(const n of rf.values())jx(n,t);for(const n of WD.values())jx(n,t);return!0}function Ny(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Yr(t){return t==null?!1:t.settings!==void 0}const KD={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},aa=new Uu("app","Firebase",KD);class YD{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new lo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw aa.create("app-deleted",{appName:this._name})}}const Hl=GD;function gE(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Gg,automaticDataCollectionEnabled:!0,...e},a=r.name;if(typeof a!="string"||!a)throw aa.create("bad-app-name",{appName:String(a)});if(n||(n=uE()),!n)throw aa.create("no-options");const o=rf.get(a);if(o){if(ha(n,o.options)&&ha(r,o.config))return o;throw aa.create("duplicate-app",{appName:a})}const u=new nD(a);for(const f of Qg.values())u.addComponent(f);const h=new YD(n,r,u);return rf.set(a,h),h}function yE(t=Gg){const e=rf.get(t);if(!e&&t===Gg&&uE())return gE();if(!e)throw aa.create("no-app",{appName:t});return e}function oa(t,e,n){let r=QD[t]??t;n&&(r+=`-${n}`);const a=r.match(/\s|\//),o=e.match(/\s|\//);if(a||o){const u=[`Unable to register library "${r}" with version "${e}":`];a&&u.push(`library name "${r}" contains illegal characters (whitespace or "/")`),a&&o&&u.push("and"),o&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),us.warn(u.join(" "));return}Al(new lo(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const XD="firebase-heartbeat-database",JD=1,wu="firebase-heartbeat-store";let Ag=null;function _E(){return Ag||(Ag=pD(XD,JD,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(wu)}catch(n){console.warn(n)}}}}).catch(t=>{throw aa.create("idb-open",{originalErrorMessage:t.message})})),Ag}async function ZD(t){try{const n=(await _E()).transaction(wu),r=await n.objectStore(wu).get(bE(t));return await n.done,r}catch(e){if(e instanceof gs)us.warn(e.message);else{const n=aa.create("idb-get",{originalErrorMessage:e?.message});us.warn(n.message)}}}async function Rx(t,e){try{const r=(await _E()).transaction(wu,"readwrite");await r.objectStore(wu).put(e,bE(t)),await r.done}catch(n){if(n instanceof gs)us.warn(n.message);else{const r=aa.create("idb-set",{originalErrorMessage:n?.message});us.warn(r.message)}}}function bE(t){return`${t.name}!${t.options.appId}`}const eI=1024,tI=30;class nI{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new iI(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Dx();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(a=>a.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>tI){const a=sI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){us.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Dx(),{heartbeatsToSend:n,unsentEntries:r}=rI(this._heartbeatsCache.heartbeats),a=nf(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(e){return us.warn(e),""}}}function Dx(){return new Date().toISOString().substring(0,10)}function rI(t,e=eI){const n=[];let r=t.slice();for(const a of t){const o=n.find(u=>u.agent===a.agent);if(o){if(o.dates.push(a.date),Ix(n)>e){o.dates.pop();break}}else if(n.push({agent:a.agent,dates:[a.date]}),Ix(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class iI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return q5()?H5().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await ZD(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Rx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Rx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Ix(t){return nf(JSON.stringify({version:2,heartbeats:t})).length}function sI(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function aI(t){Al(new lo("platform-logger",e=>new _D(e),"PRIVATE")),Al(new lo("heartbeat",e=>new nI(e),"PRIVATE")),oa(Hg,Ax,t),oa(Hg,Ax,"esm2020"),oa("fire-js","")}aI("");function vE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const oI=vE,xE=new Uu("auth","Firebase",vE());const sf=new ky("@firebase/auth");function lI(t,...e){sf.logLevel<=tt.WARN&&sf.warn(`Auth (${Hl}): ${t}`,...e)}function $h(t,...e){sf.logLevel<=tt.ERROR&&sf.error(`Auth (${Hl}): ${t}`,...e)}function ei(t,...e){throw Py(t,...e)}function Ri(t,...e){return Py(t,...e)}function SE(t,e,n){const r={...oI(),[e]:n};return new Uu("auth","Firebase",r).create(e,{appName:t.name})}function la(t){return SE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Py(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return xE.create(t,...e)}function Be(t,e,...n){if(!t)throw Py(e,...n)}function is(t){const e="INTERNAL ASSERTION FAILED: "+t;throw $h(e),new Error(e)}function ds(t,e){t||is(e)}function Wg(){return typeof self<"u"&&self.location?.href||""}function cI(){return Mx()==="http:"||Mx()==="https:"}function Mx(){return typeof self<"u"&&self.location?.protocol||null}function uI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(cI()||U5()||"connection"in navigator)?navigator.onLine:!0}function dI(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class Fu{constructor(e,n){this.shortDelay=e,this.longDelay=n,ds(n>e,"Short delay should be less than long delay!"),this.isMobile=L5()||V5()}get(){return uI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Ly(t,e){ds(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class wE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;is("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;is("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;is("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const hI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const fI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],mI=new Fu(3e4,6e4);function po(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function xa(t,e,n,r,a={}){return EE(t,a,async()=>{let o={},u={};r&&(e==="GET"?u=r:o={body:JSON.stringify(r)});const h=Vu({key:t.config.apiKey,...u}).slice(1),f=await t._getAdditionalHeaders();f["Content-Type"]="application/json",t.languageCode&&(f["X-Firebase-Locale"]=t.languageCode);const m={method:e,headers:f,...o};return z5()||(m.referrerPolicy="no-referrer"),t.emulatorConfig&&ql(t.emulatorConfig.host)&&(m.credentials="include"),wE.fetch()(await CE(t,t.config.apiHost,n,h),m)})}async function EE(t,e,n){t._canInitEmulator=!1;const r={...hI,...e};try{const a=new gI(t),o=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();const u=await o.json();if("needConfirmation"in u)throw Mh(t,"account-exists-with-different-credential",u);if(o.ok&&!("errorMessage"in u))return u;{const h=o.ok?u.errorMessage:u.error.message,[f,m]=h.split(" : ");if(f==="FEDERATED_USER_ID_ALREADY_LINKED")throw Mh(t,"credential-already-in-use",u);if(f==="EMAIL_EXISTS")throw Mh(t,"email-already-in-use",u);if(f==="USER_DISABLED")throw Mh(t,"user-disabled",u);const g=r[f]||f.toLowerCase().replace(/[_\s]+/g,"-");if(m)throw SE(t,g,m);ei(t,g)}}catch(a){if(a instanceof gs)throw a;ei(t,"network-request-failed",{message:String(a)})}}async function Bf(t,e,n,r,a={}){const o=await xa(t,e,n,r,a);return"mfaPendingCredential"in o&&ei(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function CE(t,e,n,r){const a=`${e}${n}?${r}`,o=t,u=o.config.emulator?Ly(t.config,a):`${t.config.apiScheme}://${a}`;return fI.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(u).toString():u}function pI(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class gI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Ri(this.auth,"network-request-failed")),mI.get())})}}function Mh(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const a=Ri(t,e,r);return a.customData._tokenResponse=n,a}function kx(t){return t!==void 0&&t.enterprise!==void 0}class yI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return pI(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function _I(t,e){return xa(t,"GET","/v2/recaptchaConfig",po(t,e))}async function bI(t,e){return xa(t,"POST","/v1/accounts:delete",e)}async function af(t,e){return xa(t,"POST","/v1/accounts:lookup",e)}function yu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function vI(t,e=!1){const n=on(t),r=await n.getIdToken(e),a=By(r);Be(a&&a.exp&&a.auth_time&&a.iat,n.auth,"internal-error");const o=typeof a.firebase=="object"?a.firebase:void 0,u=o?.sign_in_provider;return{claims:a,token:r,authTime:yu(jg(a.auth_time)),issuedAtTime:yu(jg(a.iat)),expirationTime:yu(jg(a.exp)),signInProvider:u||null,signInSecondFactor:o?.sign_in_second_factor||null}}function jg(t){return Number(t)*1e3}function By(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return $h("JWT malformed, contained fewer than 3 sections"),null;try{const a=lE(n);return a?JSON.parse(a):($h("Failed to decode base64 JWT payload"),null)}catch(a){return $h("Caught error parsing JWT payload as JSON",a?.toString()),null}}function Ox(t){const e=By(t);return Be(e,"internal-error"),Be(typeof e.exp<"u","internal-error"),Be(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Eu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof gs&&xI(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function xI({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class SI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Kg{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=yu(this.lastLoginAt),this.creationTime=yu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function of(t){const e=t.auth,n=await t.getIdToken(),r=await Eu(t,af(e,{idToken:n}));Be(r?.users.length,e,"internal-error");const a=r.users[0];t._notifyReloadListener(a);const o=a.providerUserInfo?.length?TE(a.providerUserInfo):[],u=EI(t.providerData,o),h=t.isAnonymous,f=!(t.email&&a.passwordHash)&&!u?.length,m=h?f:!1,g={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:u,metadata:new Kg(a.createdAt,a.lastLoginAt),isAnonymous:m};Object.assign(t,g)}async function wI(t){const e=on(t);await of(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function EI(t,e){return[...t.filter(r=>!e.some(a=>a.providerId===r.providerId)),...e]}function TE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function CI(t,e){const n=await EE(t,{},async()=>{const r=Vu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:o}=t.config,u=await CE(t,a,"/v1/token",`key=${o}`),h=await t._getAdditionalHeaders();h["Content-Type"]="application/x-www-form-urlencoded";const f={method:"POST",headers:h,body:r};return t.emulatorConfig&&ql(t.emulatorConfig.host)&&(f.credentials="include"),wE.fetch()(u,f)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function TI(t,e){return xa(t,"POST","/v2/accounts:revokeToken",po(t,e))}class vl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Be(e.idToken,"internal-error"),Be(typeof e.idToken<"u","internal-error"),Be(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Ox(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Be(e.length!==0,"internal-error");const n=Ox(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Be(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:a,expiresIn:o}=await CI(e,n);this.updateTokensAndExpiration(r,a,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:a,expirationTime:o}=n,u=new vl;return r&&(Be(typeof r=="string","internal-error",{appName:e}),u.refreshToken=r),a&&(Be(typeof a=="string","internal-error",{appName:e}),u.accessToken=a),o&&(Be(typeof o=="number","internal-error",{appName:e}),u.expirationTime=o),u}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new vl,this.toJSON())}_performRefresh(){return is("not implemented")}}function Xs(t,e){Be(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Xr{constructor({uid:e,auth:n,stsTokenManager:r,...a}){this.providerId="firebase",this.proactiveRefresh=new SI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new Kg(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const n=await Eu(this,this.stsTokenManager.getToken(this.auth,e));return Be(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return vI(this,e)}reload(){return wI(this)}_assign(e){this!==e&&(Be(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Xr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Be(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await of(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Yr(this.auth.app))return Promise.reject(la(this.auth));const e=await this.getIdToken();return await Eu(this,bI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,a=n.email??void 0,o=n.phoneNumber??void 0,u=n.photoURL??void 0,h=n.tenantId??void 0,f=n._redirectEventId??void 0,m=n.createdAt??void 0,g=n.lastLoginAt??void 0,{uid:_,emailVerified:b,isAnonymous:x,providerData:E,stsTokenManager:S}=n;Be(_&&S,e,"internal-error");const T=vl.fromJSON(this.name,S);Be(typeof _=="string",e,"internal-error"),Xs(r,e.name),Xs(a,e.name),Be(typeof b=="boolean",e,"internal-error"),Be(typeof x=="boolean",e,"internal-error"),Xs(o,e.name),Xs(u,e.name),Xs(h,e.name),Xs(f,e.name),Xs(m,e.name),Xs(g,e.name);const D=new Xr({uid:_,auth:e,email:a,emailVerified:b,displayName:r,isAnonymous:x,photoURL:u,phoneNumber:o,tenantId:h,stsTokenManager:T,createdAt:m,lastLoginAt:g});return E&&Array.isArray(E)&&(D.providerData=E.map(j=>({...j}))),f&&(D._redirectEventId=f),D}static async _fromIdTokenResponse(e,n,r=!1){const a=new vl;a.updateFromServerResponse(n);const o=new Xr({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:r});return await of(o),o}static async _fromGetAccountInfoResponse(e,n,r){const a=n.users[0];Be(a.localId!==void 0,"internal-error");const o=a.providerUserInfo!==void 0?TE(a.providerUserInfo):[],u=!(a.email&&a.passwordHash)&&!o?.length,h=new vl;h.updateFromIdToken(r);const f=new Xr({uid:a.localId,auth:e,stsTokenManager:h,isAnonymous:u}),m={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:o,metadata:new Kg(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!o?.length};return Object.assign(f,m),f}}const Nx=new Map;function ss(t){ds(t instanceof Function,"Expected a class definition");let e=Nx.get(t);return e?(ds(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Nx.set(t,e),e)}class AE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}AE.type="NONE";const Px=AE;function qh(t,e,n){return`firebase:${t}:${e}:${n}`}class xl{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:a,name:o}=this.auth;this.fullUserKey=qh(this.userKey,a.apiKey,o),this.fullPersistenceKey=qh("persistence",a.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await af(this.auth,{idToken:e}).catch(()=>{});return n?Xr._fromGetAccountInfoResponse(this.auth,n,e):null}return Xr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new xl(ss(Px),e,r);const a=(await Promise.all(n.map(async m=>{if(await m._isAvailable())return m}))).filter(m=>m);let o=a[0]||ss(Px);const u=qh(r,e.config.apiKey,e.name);let h=null;for(const m of n)try{const g=await m._get(u);if(g){let _;if(typeof g=="string"){const b=await af(e,{idToken:g}).catch(()=>{});if(!b)break;_=await Xr._fromGetAccountInfoResponse(e,b,g)}else _=Xr._fromJSON(e,g);m!==o&&(h=_),o=m;break}}catch{}const f=a.filter(m=>m._shouldAllowMigration);return!o._shouldAllowMigration||!f.length?new xl(o,e,r):(o=f[0],h&&await o._set(u,h.toJSON()),await Promise.all(n.map(async m=>{if(m!==o)try{await m._remove(u)}catch{}})),new xl(o,e,r))}}function Lx(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(IE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(jE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(kE(e))return"Blackberry";if(OE(e))return"Webos";if(RE(e))return"Safari";if((e.includes("chrome/")||DE(e))&&!e.includes("edge/"))return"Chrome";if(ME(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function jE(t=Ln()){return/firefox\//i.test(t)}function RE(t=Ln()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function DE(t=Ln()){return/crios\//i.test(t)}function IE(t=Ln()){return/iemobile/i.test(t)}function ME(t=Ln()){return/android/i.test(t)}function kE(t=Ln()){return/blackberry/i.test(t)}function OE(t=Ln()){return/webos/i.test(t)}function zy(t=Ln()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function AI(t=Ln()){return zy(t)&&!!window.navigator?.standalone}function jI(){return F5()&&document.documentMode===10}function NE(t=Ln()){return zy(t)||ME(t)||OE(t)||kE(t)||/windows phone/i.test(t)||IE(t)}function PE(t,e=[]){let n;switch(t){case"Browser":n=Lx(Ln());break;case"Worker":n=`${Lx(Ln())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Hl}/${r}`}class RI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((u,h)=>{try{const f=e(o);u(f)}catch(f){h(f)}});r.onAbort=n,this.queue.push(r);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const a of n)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function DI(t,e={}){return xa(t,"GET","/v2/passwordPolicy",po(t,e))}const II=6;class MI{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??II,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),a&&(n.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let a=0;a<e.length;a++)r=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,a,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class kI{constructor(e,n,r,a){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Bx(this),this.idTokenSubscription=new Bx(this),this.beforeStateQueue=new RI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=xE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=ss(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await xl.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await af(this,{idToken:e}),r=await Xr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Yr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(u,u))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,u=r?._redirectEventId,h=await this.tryRedirectSignIn(e);(!o||o===u)&&h?.user&&(r=h.user,a=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Be(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await of(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=dI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Yr(this.app))return Promise.reject(la(this));const n=e?on(e):null;return n&&Be(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Be(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Yr(this.app)?Promise.reject(la(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Yr(this.app)?Promise.reject(la(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ss(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await DI(this),n=new MI(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Uu("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await TI(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&ss(e)||this._popupRedirectResolver;Be(n,this,"argument-error"),this.redirectPersistenceManager=await xl.create(this,[ss(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,a){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let u=!1;const h=this._isInitialized?Promise.resolve():this._initializationPromise;if(Be(h,this,"internal-error"),h.then(()=>{u||o(this.currentUser)}),typeof n=="function"){const f=e.addObserver(n,r,a);return()=>{u=!0,f()}}else{const f=e.addObserver(n);return()=>{u=!0,f()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Be(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=PE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Yr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&lI(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Gl(t){return on(t)}class Bx{constructor(e){this.auth=e,this.observer=null,this.addObserver=Y5(n=>this.observer=n)}get next(){return Be(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let zf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function OI(t){zf=t}function LE(t){return zf.loadJS(t)}function NI(){return zf.recaptchaEnterpriseScript}function PI(){return zf.gapiScript}function LI(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class BI{constructor(){this.enterprise=new zI}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class zI{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const UI="recaptcha-enterprise",BE="NO_RECAPTCHA";class VI{constructor(e){this.type=UI,this.auth=Gl(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(u,h)=>{_I(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(f=>{if(f.recaptchaKey===void 0)h(new Error("recaptcha Enterprise site key undefined"));else{const m=new yI(f);return o.tenantId==null?o._agentRecaptchaConfig=m:o._tenantRecaptchaConfigs[o.tenantId]=m,u(m.siteKey)}}).catch(f=>{h(f)})})}function a(o,u,h){const f=window.grecaptcha;kx(f)?f.enterprise.ready(()=>{f.enterprise.execute(o,{action:e}).then(m=>{u(m)}).catch(()=>{u(BE)})}):h(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new BI().execute("siteKey",{action:"verify"}):new Promise((o,u)=>{r(this.auth).then(h=>{if(!n&&kx(window.grecaptcha))a(h,o,u);else{if(typeof window>"u"){u(new Error("RecaptchaVerifier is only supported in browser"));return}let f=NI();f.length!==0&&(f+=h),LE(f).then(()=>{a(h,o,u)}).catch(m=>{u(m)})}}).catch(h=>{u(h)})})}}async function zx(t,e,n,r=!1,a=!1){const o=new VI(t);let u;if(a)u=BE;else try{u=await o.verify(n)}catch{u=await o.verify(n,!0)}const h={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in h){const f=h.phoneEnrollmentInfo.phoneNumber,m=h.phoneEnrollmentInfo.recaptchaToken;Object.assign(h,{phoneEnrollmentInfo:{phoneNumber:f,recaptchaToken:m,captchaResponse:u,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in h){const f=h.phoneSignInInfo.recaptchaToken;Object.assign(h,{phoneSignInInfo:{recaptchaToken:f,captchaResponse:u,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return h}return r?Object.assign(h,{captchaResp:u}):Object.assign(h,{captchaResponse:u}),Object.assign(h,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(h,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),h}async function Ux(t,e,n,r,a){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await zx(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const u=await zx(t,e,n,n==="getOobCode");return r(t,u)}else return Promise.reject(o)})}function FI(t,e){const n=Ny(t,"auth");if(n.isInitialized()){const a=n.getImmediate(),o=n.getOptions();if(ha(o,e??{}))return a;ei(a,"already-initialized")}return n.initialize({options:e})}function $I(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(ss);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function qI(t,e,n){const r=Gl(t);Be(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const a=!1,o=zE(e),{host:u,port:h}=HI(e),f=h===null?"":`:${h}`,m={url:`${o}//${u}${f}/`},g=Object.freeze({host:u,port:h,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!r._canInitEmulator){Be(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Be(ha(m,r.config.emulator)&&ha(g,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=m,r.emulatorConfig=g,r.settings.appVerificationDisabledForTesting=!0,ql(u)?(hE(`${o}//${u}${f}`),fE("Auth",!0)):GI()}function zE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function HI(t){const e=zE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(r);if(a){const o=a[1];return{host:o,port:Vx(r.substr(o.length+1))}}else{const[o,u]=r.split(":");return{host:o,port:Vx(u)}}}function Vx(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function GI(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class Uy{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return is("not implemented")}_getIdTokenResponse(e){return is("not implemented")}_linkToIdToken(e,n){return is("not implemented")}_getReauthenticationResolver(e){return is("not implemented")}}async function QI(t,e){return xa(t,"POST","/v1/accounts:signUp",e)}async function WI(t,e){return Bf(t,"POST","/v1/accounts:signInWithPassword",po(t,e))}async function KI(t,e){return Bf(t,"POST","/v1/accounts:signInWithEmailLink",po(t,e))}async function YI(t,e){return Bf(t,"POST","/v1/accounts:signInWithEmailLink",po(t,e))}class Cu extends Uy{constructor(e,n,r,a=null){super("password",r),this._email=e,this._password=n,this._tenantId=a}static _fromEmailAndPassword(e,n){return new Cu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Cu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ux(e,n,"signInWithPassword",WI);case"emailLink":return KI(e,{email:this._email,oobCode:this._password});default:ei(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ux(e,r,"signUpPassword",QI);case"emailLink":return YI(e,{idToken:n,email:this._email,oobCode:this._password});default:ei(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Sl(t,e){return Bf(t,"POST","/v1/accounts:signInWithIdp",po(t,e))}const XI="http://localhost";class co extends Uy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new co(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):ei("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:a,...o}=n;if(!r||!a)return null;const u=new co(r,a);return u.idToken=o.idToken||void 0,u.accessToken=o.accessToken||void 0,u.secret=o.secret,u.nonce=o.nonce,u.pendingToken=o.pendingToken||null,u}_getIdTokenResponse(e){const n=this.buildRequest();return Sl(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Sl(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Sl(e,n)}buildRequest(){const e={requestUri:XI,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Vu(n)}return e}}function JI(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function ZI(t){const e=uu(du(t)).link,n=e?uu(du(e)).deep_link_id:null,r=uu(du(t)).deep_link_id;return(r?uu(du(r)).link:null)||r||n||e||t}class Vy{constructor(e){const n=uu(du(e)),r=n.apiKey??null,a=n.oobCode??null,o=JI(n.mode??null);Be(r&&a&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=a,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=ZI(e);try{return new Vy(n)}catch{return null}}}class Ql{constructor(){this.providerId=Ql.PROVIDER_ID}static credential(e,n){return Cu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Vy.parseLink(n);return Be(r,"argument-error"),Cu._fromEmailAndCode(e,r.code,r.tenantId)}}Ql.PROVIDER_ID="password";Ql.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ql.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class UE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class $u extends UE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Zs extends $u{constructor(){super("facebook.com")}static credential(e){return co._fromParams({providerId:Zs.PROVIDER_ID,signInMethod:Zs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zs.credentialFromTaggedObject(e)}static credentialFromError(e){return Zs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zs.credential(e.oauthAccessToken)}catch{return null}}}Zs.FACEBOOK_SIGN_IN_METHOD="facebook.com";Zs.PROVIDER_ID="facebook.com";class ea extends $u{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return co._fromParams({providerId:ea.PROVIDER_ID,signInMethod:ea.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return ea.credentialFromTaggedObject(e)}static credentialFromError(e){return ea.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return ea.credential(n,r)}catch{return null}}}ea.GOOGLE_SIGN_IN_METHOD="google.com";ea.PROVIDER_ID="google.com";class ta extends $u{constructor(){super("github.com")}static credential(e){return co._fromParams({providerId:ta.PROVIDER_ID,signInMethod:ta.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ta.credentialFromTaggedObject(e)}static credentialFromError(e){return ta.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ta.credential(e.oauthAccessToken)}catch{return null}}}ta.GITHUB_SIGN_IN_METHOD="github.com";ta.PROVIDER_ID="github.com";class na extends $u{constructor(){super("twitter.com")}static credential(e,n){return co._fromParams({providerId:na.PROVIDER_ID,signInMethod:na.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return na.credentialFromTaggedObject(e)}static credentialFromError(e){return na.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return na.credential(n,r)}catch{return null}}}na.TWITTER_SIGN_IN_METHOD="twitter.com";na.PROVIDER_ID="twitter.com";class jl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,a=!1){const o=await Xr._fromIdTokenResponse(e,r,a),u=Fx(r);return new jl({user:o,providerId:u,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const a=Fx(r);return new jl({user:e,providerId:a,_tokenResponse:r,operationType:n})}}function Fx(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class lf extends gs{constructor(e,n,r,a){super(n.code,n.message),this.operationType=r,this.user=a,Object.setPrototypeOf(this,lf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,a){return new lf(e,n,r,a)}}function VE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?lf._fromErrorAndOperation(t,o,e,r):o})}async function e2(t,e,n=!1){const r=await Eu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return jl._forOperation(t,"link",r)}async function t2(t,e,n=!1){const{auth:r}=t;if(Yr(r.app))return Promise.reject(la(r));const a="reauthenticate";try{const o=await Eu(t,VE(r,a,e,t),n);Be(o.idToken,r,"internal-error");const u=By(o.idToken);Be(u,r,"internal-error");const{sub:h}=u;return Be(t.uid===h,r,"user-mismatch"),jl._forOperation(t,a,o)}catch(o){throw o?.code==="auth/user-not-found"&&ei(r,"user-mismatch"),o}}async function FE(t,e,n=!1){if(Yr(t.app))return Promise.reject(la(t));const r="signIn",a=await VE(t,r,e),o=await jl._fromIdTokenResponse(t,r,a);return n||await t._updateCurrentUser(o.user),o}async function n2(t,e){return FE(Gl(t),e)}async function r2(t){const e=Gl(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function i2(t,e,n){return Yr(t.app)?Promise.reject(la(t)):n2(on(t),Ql.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&r2(t),r})}function s2(t,e,n,r){return on(t).onIdTokenChanged(e,n,r)}function a2(t,e,n){return on(t).beforeAuthStateChanged(e,n)}function o2(t,e,n,r){return on(t).onAuthStateChanged(e,n,r)}function l2(t){return on(t).signOut()}const cf="__sak";class $E{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(cf,"1"),this.storage.removeItem(cf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const c2=1e3,u2=10;class qE extends $E{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=NE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),a=this.localCache[n];r!==a&&e(n,a,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((u,h,f)=>{this.notifyListeners(u,f)});return}const r=e.key;n?this.detachListener():this.stopPolling();const a=()=>{const u=this.storage.getItem(r);!n&&this.localCache[r]===u||this.notifyListeners(r,u)},o=this.storage.getItem(r);jI()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,u2):a()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const a of Array.from(r))a(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},c2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}qE.type="LOCAL";const d2=qE;class HE extends $E{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}HE.type="SESSION";const GE=HE;function h2(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class Uf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(a=>a.isListeningto(e));if(n)return n;const r=new Uf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:a,data:o}=n.data,u=this.handlersMap[a];if(!u?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:a});const h=Array.from(u).map(async m=>m(n.origin,o)),f=await h2(h);n.ports[0].postMessage({status:"done",eventId:r,eventType:a,response:f})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Uf.receivers=[];function Fy(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class f2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let o,u;return new Promise((h,f)=>{const m=Fy("",20);a.port1.start();const g=setTimeout(()=>{f(new Error("unsupported_event"))},r);u={messageChannel:a,onMessage(_){const b=_;if(b.data.eventId===m)switch(b.data.status){case"ack":clearTimeout(g),o=setTimeout(()=>{f(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),h(b.data.response);break;default:clearTimeout(g),clearTimeout(o),f(new Error("invalid_response"));break}}},this.handlers.add(u),a.port1.addEventListener("message",u.onMessage),this.target.postMessage({eventType:e,eventId:m,data:n},[a.port2])}).finally(()=>{u&&this.removeMessageHandler(u)})}}function Di(){return window}function m2(t){Di().location.href=t}function QE(){return typeof Di().WorkerGlobalScope<"u"&&typeof Di().importScripts=="function"}async function p2(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function g2(){return navigator?.serviceWorker?.controller||null}function y2(){return QE()?self:null}const WE="firebaseLocalStorageDb",_2=1,uf="firebaseLocalStorage",KE="fbase_key";class qu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Vf(t,e){return t.transaction([uf],e?"readwrite":"readonly").objectStore(uf)}function b2(){const t=indexedDB.deleteDatabase(WE);return new qu(t).toPromise()}function Yg(){const t=indexedDB.open(WE,_2);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(uf,{keyPath:KE})}catch(a){n(a)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(uf)?e(r):(r.close(),await b2(),e(await Yg()))})})}async function $x(t,e,n){const r=Vf(t,!0).put({[KE]:e,value:n});return new qu(r).toPromise()}async function v2(t,e){const n=Vf(t,!1).get(e),r=await new qu(n).toPromise();return r===void 0?null:r.value}function qx(t,e){const n=Vf(t,!0).delete(e);return new qu(n).toPromise()}const x2=800,S2=3;class YE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Yg(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>S2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return QE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Uf._getInstance(y2()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await p2(),!this.activeServiceWorker)return;this.sender=new f2(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||g2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Yg();return await $x(e,cf,"1"),await qx(e,cf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>$x(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>v2(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>qx(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const o=Vf(a,!1).getAll();return new qu(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:a,value:o}of e)r.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(o)&&(this.notifyListeners(a,o),n.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!r.has(a)&&(this.notifyListeners(a,null),n.push(a));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const a of Array.from(r))a(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),x2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}YE.type="LOCAL";const w2=YE;new Fu(3e4,6e4);function E2(t,e){return e?ss(e):(Be(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class $y extends Uy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Sl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Sl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Sl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function C2(t){return FE(t.auth,new $y(t),t.bypassAuthState)}function T2(t){const{auth:e,user:n}=t;return Be(n,e,"internal-error"),t2(n,new $y(t),t.bypassAuthState)}async function A2(t){const{auth:e,user:n}=t;return Be(n,e,"internal-error"),e2(n,new $y(t),t.bypassAuthState)}class XE{constructor(e,n,r,a,o=!1){this.auth=e,this.resolver=r,this.user=a,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:a,tenantId:o,error:u,type:h}=e;if(u){this.reject(u);return}const f={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(h)(f))}catch(m){this.reject(m)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return C2;case"linkViaPopup":case"linkViaRedirect":return A2;case"reauthViaPopup":case"reauthViaRedirect":return T2;default:ei(this.auth,"internal-error")}}resolve(e){ds(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ds(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const j2=new Fu(2e3,1e4);class bl extends XE{constructor(e,n,r,a,o){super(e,n,a,o),this.provider=r,this.authWindow=null,this.pollId=null,bl.currentPopupAction&&bl.currentPopupAction.cancel(),bl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Be(e,this.auth,"internal-error"),e}async onExecution(){ds(this.filter.length===1,"Popup operations only handle one event");const e=Fy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Ri(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ri(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,bl.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ri(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,j2.get())};e()}}bl.currentPopupAction=null;const R2="pendingRedirect",Hh=new Map;class D2 extends XE{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Hh.get(this.auth._key());if(!e){try{const r=await I2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Hh.set(this.auth._key(),e)}return this.bypassAuthState||Hh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function I2(t,e){const n=O2(e),r=k2(t);if(!await r._isAvailable())return!1;const a=await r._get(n)==="true";return await r._remove(n),a}function M2(t,e){Hh.set(t._key(),e)}function k2(t){return ss(t._redirectPersistence)}function O2(t){return qh(R2,t.config.apiKey,t.name)}async function N2(t,e,n=!1){if(Yr(t.app))return Promise.reject(la(t));const r=Gl(t),a=E2(r,e),u=await new D2(r,a,n).execute();return u&&!n&&(delete u.user._redirectEventId,await r._persistUserIfCurrent(u.user),await r._setRedirectUser(null,e)),u}const P2=600*1e3;class L2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!B2(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!JE(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Ri(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=P2&&this.cachedEventUids.clear(),this.cachedEventUids.has(Hx(e))}saveEventToCache(e){this.cachedEventUids.add(Hx(e)),this.lastProcessedEventTime=Date.now()}}function Hx(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function JE({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function B2(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return JE(t);default:return!1}}async function z2(t,e={}){return xa(t,"GET","/v1/projects",e)}const U2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,V2=/^https?/;async function F2(t){if(t.config.emulator)return;const{authorizedDomains:e}=await z2(t);for(const n of e)try{if($2(n))return}catch{}ei(t,"unauthorized-domain")}function $2(t){const e=Wg(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const u=new URL(t);return u.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&u.hostname===r}if(!V2.test(n))return!1;if(U2.test(t))return r===t;const a=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(r)}const q2=new Fu(3e4,6e4);function Gx(){const t=Di().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function H2(t){return new Promise((e,n)=>{function r(){Gx(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Gx(),n(Ri(t,"network-request-failed"))},timeout:q2.get()})}if(Di().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Di().gapi?.load)r();else{const a=LI("iframefcb");return Di()[a]=()=>{gapi.load?r():n(Ri(t,"network-request-failed"))},LE(`${PI()}?onload=${a}`).catch(o=>n(o))}}).catch(e=>{throw Gh=null,e})}let Gh=null;function G2(t){return Gh=Gh||H2(t),Gh}const Q2=new Fu(5e3,15e3),W2="__/auth/iframe",K2="emulator/auth/iframe",Y2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},X2=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function J2(t){const e=t.config;Be(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Ly(e,K2):`https://${t.config.authDomain}/${W2}`,r={apiKey:e.apiKey,appName:t.name,v:Hl},a=X2.get(t.config.apiHost);a&&(r.eid=a);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${Vu(r).slice(1)}`}async function Z2(t){const e=await G2(t),n=Di().gapi;return Be(n,t,"internal-error"),e.open({where:document.body,url:J2(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Y2,dontclear:!0},r=>new Promise(async(a,o)=>{await r.restyle({setHideOnLeave:!1});const u=Ri(t,"network-request-failed"),h=Di().setTimeout(()=>{o(u)},Q2.get());function f(){Di().clearTimeout(h),a(r)}r.ping(f).then(f,()=>{o(u)})}))}const eM={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},tM=500,nM=600,rM="_blank",iM="http://localhost";class Qx{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function sM(t,e,n,r=tM,a=nM){const o=Math.max((window.screen.availHeight-a)/2,0).toString(),u=Math.max((window.screen.availWidth-r)/2,0).toString();let h="";const f={...eM,width:r.toString(),height:a.toString(),top:o,left:u},m=Ln().toLowerCase();n&&(h=DE(m)?rM:n),jE(m)&&(e=e||iM,f.scrollbars="yes");const g=Object.entries(f).reduce((b,[x,E])=>`${b}${x}=${E},`,"");if(AI(m)&&h!=="_self")return aM(e||"",h),new Qx(null);const _=window.open(e||"",h,g);Be(_,t,"popup-blocked");try{_.focus()}catch{}return new Qx(_)}function aM(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const oM="__/auth/handler",lM="emulator/auth/handler",cM=encodeURIComponent("fac");async function Wx(t,e,n,r,a,o){Be(t.config.authDomain,t,"auth-domain-config-required"),Be(t.config.apiKey,t,"invalid-api-key");const u={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Hl,eventId:a};if(e instanceof UE){e.setDefaultLanguage(t.languageCode),u.providerId=e.providerId||"",K5(e.getCustomParameters())||(u.customParameters=JSON.stringify(e.getCustomParameters()));for(const[g,_]of Object.entries({}))u[g]=_}if(e instanceof $u){const g=e.getScopes().filter(_=>_!=="");g.length>0&&(u.scopes=g.join(","))}t.tenantId&&(u.tid=t.tenantId);const h=u;for(const g of Object.keys(h))h[g]===void 0&&delete h[g];const f=await t._getAppCheckToken(),m=f?`#${cM}=${encodeURIComponent(f)}`:"";return`${uM(t)}?${Vu(h).slice(1)}${m}`}function uM({config:t}){return t.emulator?Ly(t,lM):`https://${t.authDomain}/${oM}`}const Rg="webStorageSupport";class dM{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=GE,this._completeRedirectFn=N2,this._overrideRedirectResult=M2}async _openPopup(e,n,r,a){ds(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Wx(e,n,r,Wg(),a);return sM(e,o,Fy())}async _openRedirect(e,n,r,a){await this._originValidation(e);const o=await Wx(e,n,r,Wg(),a);return m2(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:a,promise:o}=this.eventManagers[n];return a?Promise.resolve(a):(ds(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await Z2(e),r=new L2(e);return n.register("authEvent",a=>(Be(a?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Rg,{type:Rg},a=>{const o=a?.[0]?.[Rg];o!==void 0&&n(!!o),ei(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=F2(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return NE()||RE()||zy()}}const hM=dM;var Kx="@firebase/auth",Yx="1.12.0";class fM{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Be(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function mM(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function pM(t){Al(new lo("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:u,authDomain:h}=r.options;Be(u&&!u.includes(":"),"invalid-api-key",{appName:r.name});const f={apiKey:u,authDomain:h,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:PE(t)},m=new kI(r,a,o,f);return $I(m,n),m},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Al(new lo("auth-internal",e=>{const n=Gl(e.getProvider("auth").getImmediate());return(r=>new fM(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),oa(Kx,Yx,mM(t)),oa(Kx,Yx,"esm2020")}const gM=300,yM=dE("authIdTokenMaxAge")||gM;let Xx=null;const _M=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>yM)return;const a=n?.token;Xx!==a&&(Xx=a,await fetch(t,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function bM(t=yE()){const e=Ny(t,"auth");if(e.isInitialized())return e.getImmediate();const n=FI(t,{popupRedirectResolver:hM,persistence:[w2,d2,GE]}),r=dE("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const u=_M(o.toString());a2(n,u,()=>u(n.currentUser)),s2(n,h=>u(h))}}const a=cE("auth");return a&&qI(n,`http://${a}`),n}function vM(){return document.getElementsByTagName("head")?.[0]??document}OI({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=a=>{const o=Ri("internal-error");o.customData=a,n(o)},r.type="text/javascript",r.charset="UTF-8",vM().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});pM("Browser");var xM="firebase",SM="12.7.0";oa(xM,SM,"app");const wM={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},ZE=gE(wM);function go(){const t=bM(ZE);async function e(){return!1}async function n(h,f){return i2(t,h,f)}function r(){return l2(t)}function a(h){o2(t,f=>{h(f)})}function o(){return t.currentUser}return{set_user_listener:a,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o}}var Wl=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},EM={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},CM=class{#e=EM;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},as=new CM;function TM(t){setTimeout(t,0)}var uo=typeof window>"u"||"Deno"in globalThis;function hn(){}function AM(t,e){return typeof t=="function"?t(e):t}function Xg(t){return typeof t=="number"&&t>=0&&t!==1/0}function e1(t,e){return Math.max(t+(e||0)-Date.now(),0)}function ca(t,e){return typeof t=="function"?t(e):t}function Ir(t,e){return typeof t=="function"?t(e):t}function Jx(t,e){const{type:n="all",exact:r,fetchStatus:a,predicate:o,queryKey:u,stale:h}=t;if(u){if(r){if(e.queryHash!==qy(u,e.options))return!1}else if(!Tu(e.queryKey,u))return!1}if(n!=="all"){const f=e.isActive();if(n==="active"&&!f||n==="inactive"&&f)return!1}return!(typeof h=="boolean"&&e.isStale()!==h||a&&a!==e.state.fetchStatus||o&&!o(e))}function Zx(t,e){const{exact:n,status:r,predicate:a,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(ho(e.options.mutationKey)!==ho(o))return!1}else if(!Tu(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||a&&!a(e))}function qy(t,e){return(e?.queryKeyHashFn||ho)(t)}function ho(t){return JSON.stringify(t,(e,n)=>Jg(n)?Object.keys(n).sort().reduce((r,a)=>(r[a]=n[a],r),{}):n)}function Tu(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Tu(t[n],e[n])):!1}var jM=Object.prototype.hasOwnProperty;function t1(t,e){if(t===e)return t;const n=eS(t)&&eS(e);if(!n&&!(Jg(t)&&Jg(e)))return e;const a=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),u=o.length,h=n?new Array(u):{};let f=0;for(let m=0;m<u;m++){const g=n?m:o[m],_=t[g],b=e[g];if(_===b){h[g]=_,(n?m<a:jM.call(t,g))&&f++;continue}if(_===null||b===null||typeof _!="object"||typeof b!="object"){h[g]=b;continue}const x=t1(_,b);h[g]=x,x===_&&f++}return a===u&&f===a?t:h}function df(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function eS(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Jg(t){if(!tS(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!tS(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function tS(t){return Object.prototype.toString.call(t)==="[object Object]"}function RM(t){return new Promise(e=>{as.setTimeout(e,t)})}function Zg(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?t1(t,e):e}function DM(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function IM(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Hy=Symbol();function n1(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Hy?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function r1(t,e){return typeof t=="function"?t(...e):!!t}var MM=class extends Wl{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!uo&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Gy=new MM;function ey(){let t,e;const n=new Promise((a,o)=>{t=a,e=o});n.status="pending",n.catch(()=>{});function r(a){Object.assign(n,a),delete n.resolve,delete n.reject}return n.resolve=a=>{r({status:"fulfilled",value:a}),t(a)},n.reject=a=>{r({status:"rejected",reason:a}),e(a)},n}function kM(t){let e;if(t.then(n=>(e=n,n),hn)?.catch(hn),e!==void 0)return{data:e}}function i1(t){return t}function OM(t){return{mutationKey:t.options.mutationKey,state:t.state,...t.options.scope&&{scope:t.options.scope},...t.meta&&{meta:t.meta}}}function NM(t,e,n){const r=()=>{const a=t.promise?.then(e).catch(o=>n(o)?Promise.reject(new Error("redacted")):Promise.reject(o));return a?.catch(hn),a};return{dehydratedAt:Date.now(),state:{...t.state,...t.state.data!==void 0&&{data:e(t.state.data)}},queryKey:t.queryKey,queryHash:t.queryHash,...t.state.status==="pending"&&{promise:r()},...t.meta&&{meta:t.meta}}}function PM(t){return t.state.isPaused}function LM(t){return t.state.status==="success"}function BM(t){return!0}function zM(t,e={}){const n=e.shouldDehydrateMutation??t.getDefaultOptions().dehydrate?.shouldDehydrateMutation??PM,r=t.getMutationCache().getAll().flatMap(f=>n(f)?[OM(f)]:[]),a=e.shouldDehydrateQuery??t.getDefaultOptions().dehydrate?.shouldDehydrateQuery??LM,o=e.shouldRedactErrors??t.getDefaultOptions().dehydrate?.shouldRedactErrors??BM,u=e.serializeData??t.getDefaultOptions().dehydrate?.serializeData??i1,h=t.getQueryCache().getAll().flatMap(f=>a(f)?[NM(f,u,o)]:[]);return{mutations:r,queries:h}}function UM(t,e,n){if(typeof e!="object"||e===null)return;const r=t.getMutationCache(),a=t.getQueryCache(),o=n?.defaultOptions?.deserializeData??t.getDefaultOptions().hydrate?.deserializeData??i1,u=e.mutations||[],h=e.queries||[];u.forEach(({state:f,...m})=>{r.build(t,{...t.getDefaultOptions().hydrate?.mutations,...n?.defaultOptions?.mutations,...m},f)}),h.forEach(({queryKey:f,state:m,queryHash:g,meta:_,promise:b,dehydratedAt:x})=>{const E=b?kM(b):void 0,S=m.data===void 0?E?.data:m.data,T=S===void 0?S:o(S);let D=a.get(g);const j=D?.state.status==="pending",M=D?.state.fetchStatus==="fetching";if(D){const K=E&&x!==void 0&&x>D.state.dataUpdatedAt;if(m.dataUpdatedAt>D.state.dataUpdatedAt||K){const{fetchStatus:H,...Q}=m;D.setState({...Q,data:T})}}else D=a.build(t,{...t.getDefaultOptions().hydrate?.queries,...n?.defaultOptions?.queries,queryKey:f,queryHash:g,meta:_},{...m,data:T,fetchStatus:"idle",status:T!==void 0?"success":m.status});b&&!j&&!M&&(x===void 0||x>D.state.dataUpdatedAt)&&D.fetch(void 0,{initialPromise:Promise.resolve(b).then(o)}).catch(hn)})}var VM=TM;function FM(){let t=[],e=0,n=h=>{h()},r=h=>{h()},a=VM;const o=h=>{e?t.push(h):a(()=>{n(h)})},u=()=>{const h=t;t=[],h.length&&a(()=>{r(()=>{h.forEach(f=>{n(f)})})})};return{batch:h=>{let f;e++;try{f=h()}finally{e--,e||u()}return f},batchCalls:h=>(...f)=>{o(()=>{h(...f)})},schedule:o,setNotifyFunction:h=>{n=h},setBatchNotifyFunction:h=>{r=h},setScheduler:h=>{a=h}}}var fn=FM(),$M=class extends Wl{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!uo&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},hf=new $M;function qM(t){return Math.min(1e3*2**t,3e4)}function s1(t){return(t??"online")==="online"?hf.isOnline():!0}var ty=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function a1(t){let e=!1,n=0,r;const a=ey(),o=()=>a.status!=="pending",u=S=>{if(!o()){const T=new ty(S);b(T),t.onCancel?.(T)}},h=()=>{e=!0},f=()=>{e=!1},m=()=>Gy.isFocused()&&(t.networkMode==="always"||hf.isOnline())&&t.canRun(),g=()=>s1(t.networkMode)&&t.canRun(),_=S=>{o()||(r?.(),a.resolve(S))},b=S=>{o()||(r?.(),a.reject(S))},x=()=>new Promise(S=>{r=T=>{(o()||m())&&S(T)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),E=()=>{if(o())return;let S;const T=n===0?t.initialPromise:void 0;try{S=T??t.fn()}catch(D){S=Promise.reject(D)}Promise.resolve(S).then(_).catch(D=>{if(o())return;const j=t.retry??(uo?0:3),M=t.retryDelay??qM,K=typeof M=="function"?M(n,D):M,H=j===!0||typeof j=="number"&&n<j||typeof j=="function"&&j(n,D);if(e||!H){b(D);return}n++,t.onFail?.(n,D),RM(K).then(()=>m()?void 0:x()).then(()=>{e?b(D):E()})})};return{promise:a,status:()=>a.status,cancel:u,continue:()=>(r?.(),a),cancelRetry:h,continueRetry:f,canStart:g,start:()=>(g()?E():x().then(E),a)}}var o1=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Xg(this.gcTime)&&(this.#e=as.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(uo?1/0:300*1e3))}clearGcTimeout(){this.#e&&(as.clearTimeout(this.#e),this.#e=void 0)}},HM=class extends o1{#e;#t;#n;#i;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#i=e.client,this.#n=this.#i.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=rS(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=rS(this.options);n.data!==void 0&&(this.setState(nS(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=Zg(this.state.data,e,this.options);return this.#s({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#s({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(hn).catch(hn):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Ir(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Hy||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ca(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!e1(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const f=this.observers.find(m=>m.options.queryFn);f&&this.setOptions(f.options)}const r=new AbortController,a=f=>{Object.defineProperty(f,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const f=n1(this.options,n),g=(()=>{const _={client:this.#i,queryKey:this.queryKey,meta:this.meta};return a(_),_})();return this.#o=!1,this.options.persister?this.options.persister(f,g,this):f(g)},h=(()=>{const f={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:o};return a(f),f})();this.options.behavior?.onFetch(h,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==h.fetchOptions?.meta)&&this.#s({type:"fetch",meta:h.fetchOptions?.meta}),this.#r=a1({initialPromise:n?.initialPromise,fn:h.fetchFn,onCancel:f=>{f instanceof ty&&f.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(f,m)=>{this.#s({type:"failed",failureCount:f,error:m})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:h.options.retry,retryDelay:h.options.retryDelay,networkMode:h.options.networkMode,canRun:()=>!0});try{const f=await this.#r.start();if(f===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(f),this.#n.config.onSuccess?.(f,this),this.#n.config.onSettled?.(f,this.state.error,this),f}catch(f){if(f instanceof ty){if(f.silent)return this.#r.promise;if(f.revert){if(this.state.data===void 0)throw f;return this.state.data}}throw this.#s({type:"error",error:f}),this.#n.config.onError?.(f,this),this.#n.config.onSettled?.(this.state.data,f,this),f}finally{this.scheduleGc()}}#s(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...l1(r.data,this.options),fetchMeta:e.meta??null};case"success":const a={...r,...nS(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?a:void 0,a;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),fn.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function l1(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:s1(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function nS(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function rS(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var GM=class extends Wl{constructor(t,e){super(),this.options=e,this.#e=t,this.#s=null,this.#o=ey(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#i=void 0;#r;#a;#o;#s;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),iS(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ny(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ny(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Ir(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#S(),this.#t.setOptions(this.options),e._defaulted&&!df(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&sS(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Ir(this.options.enabled,this.#t)!==Ir(e.enabled,this.#t)||ca(this.options.staleTime,this.#t)!==ca(e.staleTime,this.#t))&&this.#g();const a=this.#y();r&&(this.#t!==n||Ir(this.options.enabled,this.#t)!==Ir(e.enabled,this.#t)||a!==this.#l)&&this.#_(a)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return WM(this,n)&&(this.#i=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#i}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#i))}#d(t){this.#S();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(hn)),e}#g(){this.#v();const t=ca(this.options.staleTime,this.#t);if(uo||this.#i.isStale||!Xg(t))return;const n=e1(this.#i.dataUpdatedAt,t)+1;this.#c=as.setTimeout(()=>{this.#i.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(uo||Ir(this.options.enabled,this.#t)===!1||!Xg(this.#l)||this.#l===0)&&(this.#u=as.setInterval(()=>{(this.options.refetchIntervalInBackground||Gy.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(as.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(as.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,a=this.#i,o=this.#r,u=this.#a,f=t!==n?t.state:this.#n,{state:m}=t;let g={...m},_=!1,b;if(e._optimisticResults){const k=this.hasListeners(),O=!k&&iS(t,e),N=k&&sS(t,n,e,r);(O||N)&&(g={...g,...l1(m.data,t.options)}),e._optimisticResults==="isRestoring"&&(g.fetchStatus="idle")}let{error:x,errorUpdatedAt:E,status:S}=g;b=g.data;let T=!1;if(e.placeholderData!==void 0&&b===void 0&&S==="pending"){let k;a?.isPlaceholderData&&e.placeholderData===u?.placeholderData?(k=a.data,T=!0):k=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,k!==void 0&&(S="success",b=Zg(a?.data,k,e),_=!0)}if(e.select&&b!==void 0&&!T)if(a&&b===o?.data&&e.select===this.#p)b=this.#h;else try{this.#p=e.select,b=e.select(b),b=Zg(a?.data,b,e),this.#h=b,this.#s=null}catch(k){this.#s=k}this.#s&&(x=this.#s,b=this.#h,E=Date.now(),S="error");const D=g.fetchStatus==="fetching",j=S==="pending",M=S==="error",K=j&&D,H=b!==void 0,P={status:S,fetchStatus:g.fetchStatus,isPending:j,isSuccess:S==="success",isError:M,isInitialLoading:K,isLoading:K,data:b,dataUpdatedAt:g.dataUpdatedAt,error:x,errorUpdatedAt:E,failureCount:g.fetchFailureCount,failureReason:g.fetchFailureReason,errorUpdateCount:g.errorUpdateCount,isFetched:g.dataUpdateCount>0||g.errorUpdateCount>0,isFetchedAfterMount:g.dataUpdateCount>f.dataUpdateCount||g.errorUpdateCount>f.errorUpdateCount,isFetching:D,isRefetching:D&&!j,isLoadingError:M&&!H,isPaused:g.fetchStatus==="paused",isPlaceholderData:_,isRefetchError:M&&H,isStale:Qy(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Ir(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const k=L=>{P.status==="error"?L.reject(P.error):P.data!==void 0&&L.resolve(P.data)},O=()=>{const L=this.#o=P.promise=ey();k(L)},N=this.#o;switch(N.status){case"pending":t.queryHash===n.queryHash&&k(N);break;case"fulfilled":(P.status==="error"||P.data!==N.value)&&O();break;case"rejected":(P.status!=="error"||P.error!==N.reason)&&O();break}}return P}updateResult(){const t=this.#i,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),df(e,t))return;this.#i=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,a=typeof r=="function"?r():r;if(a==="all"||!a&&!this.#m.size)return!0;const o=new Set(a??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#i).some(u=>{const h=u;return this.#i[h]!==t[h]&&o.has(h)})};this.#w({listeners:n()})}#S(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#w(t){fn.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#i)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function QM(t,e){return Ir(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function iS(t,e){return QM(t,e)||t.state.data!==void 0&&ny(t,e,e.refetchOnMount)}function ny(t,e,n){if(Ir(e.enabled,t)!==!1&&ca(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&Qy(t,e)}return!1}function sS(t,e,n,r){return(t!==e||Ir(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&Qy(t,n)}function Qy(t,e){return Ir(e.enabled,t)!==!1&&t.isStaleByTime(ca(e.staleTime,t))}function WM(t,e){return!df(t.getCurrentResult(),e)}function aS(t){return{onFetch:(e,n)=>{const r=e.options,a=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],u=e.state.data?.pageParams||[];let h={pages:[],pageParams:[]},f=0;const m=async()=>{let g=!1;const _=E=>{Object.defineProperty(E,"signal",{enumerable:!0,get:()=>(e.signal.aborted?g=!0:e.signal.addEventListener("abort",()=>{g=!0}),e.signal)})},b=n1(e.options,e.fetchOptions),x=async(E,S,T)=>{if(g)return Promise.reject();if(S==null&&E.pages.length)return Promise.resolve(E);const j=(()=>{const Q={client:e.client,queryKey:e.queryKey,pageParam:S,direction:T?"backward":"forward",meta:e.options.meta};return _(Q),Q})(),M=await b(j),{maxPages:K}=e.options,H=T?IM:DM;return{pages:H(E.pages,M,K),pageParams:H(E.pageParams,S,K)}};if(a&&o.length){const E=a==="backward",S=E?KM:oS,T={pages:o,pageParams:u},D=S(r,T);h=await x(T,D,E)}else{const E=t??o.length;do{const S=f===0?u[0]??r.initialPageParam:oS(r,h);if(f>0&&S==null)break;h=await x(h,S),f++}while(f<E)}return h};e.options.persister?e.fetchFn=()=>e.options.persister?.(m,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=m}}}function oS(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function KM(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var YM=class extends o1{#e;#t;#n;#i;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||c1(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#i?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#i=a1({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(u,h)=>{this.#r({type:"failed",failureCount:u,error:h})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const a=this.state.status==="pending",o=!this.#i.canStart();try{if(a)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const h=await this.options.onMutate?.(e,r);h!==this.state.context&&this.#r({type:"pending",context:h,variables:e,isPaused:o})}const u=await this.#i.start();return await this.#n.config.onSuccess?.(u,e,this.state.context,this,r),await this.options.onSuccess?.(u,e,this.state.context,r),await this.#n.config.onSettled?.(u,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(u,null,e,this.state.context,r),this.#r({type:"success",data:u}),u}catch(u){try{throw await this.#n.config.onError?.(u,e,this.state.context,this,r),await this.options.onError?.(u,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,u,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,u,e,this.state.context,r),u}finally{this.#r({type:"error",error:u})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),fn.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function c1(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var XM=class extends Wl{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new YM({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=kh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=kh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=kh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(a=>a.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=kh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){fn.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Zx(e,n))}findAll(t={}){return this.getAll().filter(e=>Zx(t,e))}notify(t){fn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return fn.batch(()=>Promise.all(t.map(e=>e.continue().catch(hn))))}};function kh(t){return t.options.scope?.id}var JM=class extends Wl{#e;#t=void 0;#n;#i;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),df(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&ho(n.mutationKey)!==ho(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#i=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??c1();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){fn.batch(()=>{if(this.#i&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,a={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#i.onSuccess?.(e.data,n,r,a),this.#i.onSettled?.(e.data,null,n,r,a)):e?.type==="error"&&(this.#i.onError?.(e.error,n,r,a),this.#i.onSettled?.(void 0,e.error,n,r,a))}this.listeners.forEach(n=>{n(this.#t)})})}},ZM=class extends Wl{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,a=e.queryHash??qy(r,e);let o=this.get(a);return o||(o=new HM({client:t,queryKey:r,queryHash:a,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){fn.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Jx(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>Jx(t,n)):e}notify(t){fn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){fn.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){fn.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},ek=class{#e;#t;#n;#i;#r;#a;#o;#s;constructor(t={}){this.#e=t.queryCache||new ZM,this.#t=t.mutationCache||new XM,this.#n=t.defaultOptions||{},this.#i=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=Gy.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=hf.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#s?.(),this.#s=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(ca(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,u=AM(e,o);if(u!==void 0)return this.#e.build(this,r).setData(u,{...n,manual:!0})}setQueriesData(t,e,n){return fn.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;fn.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return fn.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=fn.batch(()=>this.#e.findAll(t).map(a=>a.cancel(n)));return Promise.all(r).then(hn).catch(hn)}invalidateQueries(t,e={}){return fn.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=fn.batch(()=>this.#e.findAll(t).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let o=a.fetch(void 0,n);return n.throwOnError||(o=o.catch(hn)),a.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(hn)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(ca(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(hn).catch(hn)}fetchInfiniteQuery(t){return t.behavior=aS(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(hn).catch(hn)}ensureInfiniteQueryData(t){return t.behavior=aS(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return hf.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#i.set(ho(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#i.values()],n={};return e.forEach(r=>{Tu(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(ho(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{Tu(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=qy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Hy&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},u1=C.createContext(void 0),gn=t=>{const e=C.useContext(u1);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},tk=({client:t,children:e})=>(C.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),c.jsx(u1.Provider,{value:t,children:e})),d1=C.createContext(!1),nk=()=>C.useContext(d1),rk=d1.Provider;function ik(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var sk=C.createContext(ik()),ak=()=>C.useContext(sk),ok=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},lk=t=>{C.useEffect(()=>{t.clearReset()},[t])},ck=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:a})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(a&&t.data===void 0||r1(n,[t.error,r])),uk=t=>{if(t.suspense){const n=a=>a==="static"?a:Math.max(a??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...a)=>n(r(...a)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},dk=(t,e)=>t.isLoading&&t.isFetching&&!e,hk=(t,e)=>t?.suspense&&e.isPending,lS=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function fk(t,e,n){const r=nk(),a=ak(),o=gn(),u=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(u),u._optimisticResults=r?"isRestoring":"optimistic",uk(u),ok(u,a),lk(a);const h=!o.getQueryCache().get(u.queryHash),[f]=C.useState(()=>new e(o,u)),m=f.getOptimisticResult(u),g=!r&&t.subscribed!==!1;if(C.useSyncExternalStore(C.useCallback(_=>{const b=g?f.subscribe(fn.batchCalls(_)):hn;return f.updateResult(),b},[f,g]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),C.useEffect(()=>{f.setOptions(u)},[u,f]),hk(u,m))throw lS(u,f,a);if(ck({result:m,errorResetBoundary:a,throwOnError:u.throwOnError,query:o.getQueryCache().get(u.queryHash),suspense:u.suspense}))throw m.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(u,m),u.experimental_prefetchInRender&&!uo&&dk(m,r)&&(h?lS(u,f,a):o.getQueryCache().get(u.queryHash)?.promise)?.catch(hn).finally(()=>{f.updateResult()}),u.notifyOnChangeProps?m:f.trackResult(m)}function Kl(t,e){return fk(t,GM)}function yr(t,e){const n=gn(),[r]=C.useState(()=>new JM(n,t));C.useEffect(()=>{r.setOptions(t)},[r,t]);const a=C.useSyncExternalStore(C.useCallback(u=>r.subscribe(fn.batchCalls(u)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=C.useCallback((u,h)=>{r.mutate(u,h).catch(hn)},[r]);if(a.error&&r1(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:o,mutateAsync:a.mutate}}function ry(){}function mk(t,{interval:e=1e3,onError:n=ry}={}){if(typeof t!="function")throw new Error("argument is not function.");let r=0,a=null,o=!1,u=!1;return async(...h)=>{if(a=h,!u){for(u=!0;o;)await new Promise(f=>as.setTimeout(f,e));for(;Date.now()<r;)await new Promise(f=>as.setTimeout(f,r-Date.now()));u=!1,o=!0;try{await t(...a)}catch(f){try{n(f)}catch{}}r=Date.now()+e,o=!1}}}var pk=({storage:t,key:e="REACT_QUERY_OFFLINE_CACHE",throttleTime:n=1e3,serialize:r=JSON.stringify,deserialize:a=JSON.parse,retry:o})=>{if(t){const u=async h=>{try{const f=await r(h);await t.setItem(e,f);return}catch(f){return f}};return{persistClient:mk(async h=>{let f=h,m=await u(f),g=0;for(;m&&f;)g++,f=await o?.({persistedClient:f,error:m,errorCount:g}),f&&(m=await u(f))},{interval:n}),restoreClient:async()=>{const h=await t.getItem(e);if(h)return await a(h)},removeClient:()=>t.removeItem(e)}}return{persistClient:ry,restoreClient:()=>Promise.resolve(void 0),removeClient:ry}};const h1=300*1e3,gk=1800*1e3,Qe=new ek({defaultOptions:{queries:{staleTime:h1,gcTime:gk,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Qe.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const yk=pk({storage:typeof window<"u"?{getItem:t=>Promise.resolve(localStorage.getItem(t)),setItem:(t,e)=>Promise.resolve(localStorage.setItem(t,e)),removeItem:t=>Promise.resolve(localStorage.removeItem(t))}:void 0,key:"BUDGET_APP_QUERY_CACHE"}),Se={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};var _k=["added","removed","updated"];function cS(t){return _k.includes(t)}async function bk({queryClient:t,persister:e,maxAge:n=1e3*60*60*24,buster:r="",hydrateOptions:a}){try{const o=await e.restoreClient();if(o)if(o.timestamp){const u=Date.now()-o.timestamp>n,h=o.buster!==r;if(u||h)return e.removeClient();UM(t,o.clientState,a)}else return e.removeClient()}catch(o){throw await e.removeClient(),o}}async function uS({queryClient:t,persister:e,buster:n="",dehydrateOptions:r}){const a={buster:n,timestamp:Date.now(),clientState:zM(t,r)};await e.persistClient(a)}function vk(t){const e=t.queryClient.getQueryCache().subscribe(r=>{cS(r.type)&&uS(t)}),n=t.queryClient.getMutationCache().subscribe(r=>{cS(r.type)&&uS(t)});return()=>{e(),n()}}var xk=({children:t,persistOptions:e,onSuccess:n,onError:r,...a})=>{const[o,u]=C.useState(!0),h=C.useRef({persistOptions:e,onSuccess:n,onError:r}),f=C.useRef(!1);return C.useEffect(()=>{h.current={persistOptions:e,onSuccess:n,onError:r}}),C.useEffect(()=>{const m={...h.current.persistOptions,queryClient:a.client};return f.current||(f.current=!0,bk(m).then(()=>h.current.onSuccess?.()).catch(()=>h.current.onError?.()).finally(()=>{u(!1)})),o?void 0:vk(m)},[a.client,o]),c.jsx(tk,{...a,children:c.jsx(rk,{value:o,children:t})})};function Sk({children:t}){return c.jsx(xk,{client:Qe,persistOptions:{persister:yk,maxAge:300*1e3,buster:"v2"},children:t})}var dS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ua,f1;(function(){var t;function e(P,k){function O(){}O.prototype=k.prototype,P.F=k.prototype,P.prototype=new O,P.prototype.constructor=P,P.D=function(N,L,U){for(var R=Array(arguments.length-2),Y=2;Y<arguments.length;Y++)R[Y-2]=arguments[Y];return k.prototype[L].apply(N,R)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(P,k,O){O||(O=0);const N=Array(16);if(typeof k=="string")for(var L=0;L<16;++L)N[L]=k.charCodeAt(O++)|k.charCodeAt(O++)<<8|k.charCodeAt(O++)<<16|k.charCodeAt(O++)<<24;else for(L=0;L<16;++L)N[L]=k[O++]|k[O++]<<8|k[O++]<<16|k[O++]<<24;k=P.g[0],O=P.g[1],L=P.g[2];let U=P.g[3],R;R=k+(U^O&(L^U))+N[0]+3614090360&4294967295,k=O+(R<<7&4294967295|R>>>25),R=U+(L^k&(O^L))+N[1]+3905402710&4294967295,U=k+(R<<12&4294967295|R>>>20),R=L+(O^U&(k^O))+N[2]+606105819&4294967295,L=U+(R<<17&4294967295|R>>>15),R=O+(k^L&(U^k))+N[3]+3250441966&4294967295,O=L+(R<<22&4294967295|R>>>10),R=k+(U^O&(L^U))+N[4]+4118548399&4294967295,k=O+(R<<7&4294967295|R>>>25),R=U+(L^k&(O^L))+N[5]+1200080426&4294967295,U=k+(R<<12&4294967295|R>>>20),R=L+(O^U&(k^O))+N[6]+2821735955&4294967295,L=U+(R<<17&4294967295|R>>>15),R=O+(k^L&(U^k))+N[7]+4249261313&4294967295,O=L+(R<<22&4294967295|R>>>10),R=k+(U^O&(L^U))+N[8]+1770035416&4294967295,k=O+(R<<7&4294967295|R>>>25),R=U+(L^k&(O^L))+N[9]+2336552879&4294967295,U=k+(R<<12&4294967295|R>>>20),R=L+(O^U&(k^O))+N[10]+4294925233&4294967295,L=U+(R<<17&4294967295|R>>>15),R=O+(k^L&(U^k))+N[11]+2304563134&4294967295,O=L+(R<<22&4294967295|R>>>10),R=k+(U^O&(L^U))+N[12]+1804603682&4294967295,k=O+(R<<7&4294967295|R>>>25),R=U+(L^k&(O^L))+N[13]+4254626195&4294967295,U=k+(R<<12&4294967295|R>>>20),R=L+(O^U&(k^O))+N[14]+2792965006&4294967295,L=U+(R<<17&4294967295|R>>>15),R=O+(k^L&(U^k))+N[15]+1236535329&4294967295,O=L+(R<<22&4294967295|R>>>10),R=k+(L^U&(O^L))+N[1]+4129170786&4294967295,k=O+(R<<5&4294967295|R>>>27),R=U+(O^L&(k^O))+N[6]+3225465664&4294967295,U=k+(R<<9&4294967295|R>>>23),R=L+(k^O&(U^k))+N[11]+643717713&4294967295,L=U+(R<<14&4294967295|R>>>18),R=O+(U^k&(L^U))+N[0]+3921069994&4294967295,O=L+(R<<20&4294967295|R>>>12),R=k+(L^U&(O^L))+N[5]+3593408605&4294967295,k=O+(R<<5&4294967295|R>>>27),R=U+(O^L&(k^O))+N[10]+38016083&4294967295,U=k+(R<<9&4294967295|R>>>23),R=L+(k^O&(U^k))+N[15]+3634488961&4294967295,L=U+(R<<14&4294967295|R>>>18),R=O+(U^k&(L^U))+N[4]+3889429448&4294967295,O=L+(R<<20&4294967295|R>>>12),R=k+(L^U&(O^L))+N[9]+568446438&4294967295,k=O+(R<<5&4294967295|R>>>27),R=U+(O^L&(k^O))+N[14]+3275163606&4294967295,U=k+(R<<9&4294967295|R>>>23),R=L+(k^O&(U^k))+N[3]+4107603335&4294967295,L=U+(R<<14&4294967295|R>>>18),R=O+(U^k&(L^U))+N[8]+1163531501&4294967295,O=L+(R<<20&4294967295|R>>>12),R=k+(L^U&(O^L))+N[13]+2850285829&4294967295,k=O+(R<<5&4294967295|R>>>27),R=U+(O^L&(k^O))+N[2]+4243563512&4294967295,U=k+(R<<9&4294967295|R>>>23),R=L+(k^O&(U^k))+N[7]+1735328473&4294967295,L=U+(R<<14&4294967295|R>>>18),R=O+(U^k&(L^U))+N[12]+2368359562&4294967295,O=L+(R<<20&4294967295|R>>>12),R=k+(O^L^U)+N[5]+4294588738&4294967295,k=O+(R<<4&4294967295|R>>>28),R=U+(k^O^L)+N[8]+2272392833&4294967295,U=k+(R<<11&4294967295|R>>>21),R=L+(U^k^O)+N[11]+1839030562&4294967295,L=U+(R<<16&4294967295|R>>>16),R=O+(L^U^k)+N[14]+4259657740&4294967295,O=L+(R<<23&4294967295|R>>>9),R=k+(O^L^U)+N[1]+2763975236&4294967295,k=O+(R<<4&4294967295|R>>>28),R=U+(k^O^L)+N[4]+1272893353&4294967295,U=k+(R<<11&4294967295|R>>>21),R=L+(U^k^O)+N[7]+4139469664&4294967295,L=U+(R<<16&4294967295|R>>>16),R=O+(L^U^k)+N[10]+3200236656&4294967295,O=L+(R<<23&4294967295|R>>>9),R=k+(O^L^U)+N[13]+681279174&4294967295,k=O+(R<<4&4294967295|R>>>28),R=U+(k^O^L)+N[0]+3936430074&4294967295,U=k+(R<<11&4294967295|R>>>21),R=L+(U^k^O)+N[3]+3572445317&4294967295,L=U+(R<<16&4294967295|R>>>16),R=O+(L^U^k)+N[6]+76029189&4294967295,O=L+(R<<23&4294967295|R>>>9),R=k+(O^L^U)+N[9]+3654602809&4294967295,k=O+(R<<4&4294967295|R>>>28),R=U+(k^O^L)+N[12]+3873151461&4294967295,U=k+(R<<11&4294967295|R>>>21),R=L+(U^k^O)+N[15]+530742520&4294967295,L=U+(R<<16&4294967295|R>>>16),R=O+(L^U^k)+N[2]+3299628645&4294967295,O=L+(R<<23&4294967295|R>>>9),R=k+(L^(O|~U))+N[0]+4096336452&4294967295,k=O+(R<<6&4294967295|R>>>26),R=U+(O^(k|~L))+N[7]+1126891415&4294967295,U=k+(R<<10&4294967295|R>>>22),R=L+(k^(U|~O))+N[14]+2878612391&4294967295,L=U+(R<<15&4294967295|R>>>17),R=O+(U^(L|~k))+N[5]+4237533241&4294967295,O=L+(R<<21&4294967295|R>>>11),R=k+(L^(O|~U))+N[12]+1700485571&4294967295,k=O+(R<<6&4294967295|R>>>26),R=U+(O^(k|~L))+N[3]+2399980690&4294967295,U=k+(R<<10&4294967295|R>>>22),R=L+(k^(U|~O))+N[10]+4293915773&4294967295,L=U+(R<<15&4294967295|R>>>17),R=O+(U^(L|~k))+N[1]+2240044497&4294967295,O=L+(R<<21&4294967295|R>>>11),R=k+(L^(O|~U))+N[8]+1873313359&4294967295,k=O+(R<<6&4294967295|R>>>26),R=U+(O^(k|~L))+N[15]+4264355552&4294967295,U=k+(R<<10&4294967295|R>>>22),R=L+(k^(U|~O))+N[6]+2734768916&4294967295,L=U+(R<<15&4294967295|R>>>17),R=O+(U^(L|~k))+N[13]+1309151649&4294967295,O=L+(R<<21&4294967295|R>>>11),R=k+(L^(O|~U))+N[4]+4149444226&4294967295,k=O+(R<<6&4294967295|R>>>26),R=U+(O^(k|~L))+N[11]+3174756917&4294967295,U=k+(R<<10&4294967295|R>>>22),R=L+(k^(U|~O))+N[2]+718787259&4294967295,L=U+(R<<15&4294967295|R>>>17),R=O+(U^(L|~k))+N[9]+3951481745&4294967295,P.g[0]=P.g[0]+k&4294967295,P.g[1]=P.g[1]+(L+(R<<21&4294967295|R>>>11))&4294967295,P.g[2]=P.g[2]+L&4294967295,P.g[3]=P.g[3]+U&4294967295}r.prototype.v=function(P,k){k===void 0&&(k=P.length);const O=k-this.blockSize,N=this.C;let L=this.h,U=0;for(;U<k;){if(L==0)for(;U<=O;)a(this,P,U),U+=this.blockSize;if(typeof P=="string"){for(;U<k;)if(N[L++]=P.charCodeAt(U++),L==this.blockSize){a(this,N),L=0;break}}else for(;U<k;)if(N[L++]=P[U++],L==this.blockSize){a(this,N),L=0;break}}this.h=L,this.o+=k},r.prototype.A=function(){var P=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);P[0]=128;for(var k=1;k<P.length-8;++k)P[k]=0;k=this.o*8;for(var O=P.length-8;O<P.length;++O)P[O]=k&255,k/=256;for(this.v(P),P=Array(16),k=0,O=0;O<4;++O)for(let N=0;N<32;N+=8)P[k++]=this.g[O]>>>N&255;return P};function o(P,k){var O=h;return Object.prototype.hasOwnProperty.call(O,P)?O[P]:O[P]=k(P)}function u(P,k){this.h=k;const O=[];let N=!0;for(let L=P.length-1;L>=0;L--){const U=P[L]|0;N&&U==k||(O[L]=U,N=!1)}this.g=O}var h={};function f(P){return-128<=P&&P<128?o(P,function(k){return new u([k|0],k<0?-1:0)}):new u([P|0],P<0?-1:0)}function m(P){if(isNaN(P)||!isFinite(P))return _;if(P<0)return T(m(-P));const k=[];let O=1;for(let N=0;P>=O;N++)k[N]=P/O|0,O*=4294967296;return new u(k,0)}function g(P,k){if(P.length==0)throw Error("number format error: empty string");if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(P.charAt(0)=="-")return T(g(P.substring(1),k));if(P.indexOf("-")>=0)throw Error('number format error: interior "-" character');const O=m(Math.pow(k,8));let N=_;for(let U=0;U<P.length;U+=8){var L=Math.min(8,P.length-U);const R=parseInt(P.substring(U,U+L),k);L<8?(L=m(Math.pow(k,L)),N=N.j(L).add(m(R))):(N=N.j(O),N=N.add(m(R)))}return N}var _=f(0),b=f(1),x=f(16777216);t=u.prototype,t.m=function(){if(S(this))return-T(this).m();let P=0,k=1;for(let O=0;O<this.g.length;O++){const N=this.i(O);P+=(N>=0?N:4294967296+N)*k,k*=4294967296}return P},t.toString=function(P){if(P=P||10,P<2||36<P)throw Error("radix out of range: "+P);if(E(this))return"0";if(S(this))return"-"+T(this).toString(P);const k=m(Math.pow(P,6));var O=this;let N="";for(;;){const L=K(O,k).g;O=D(O,L.j(k));let U=((O.g.length>0?O.g[0]:O.h)>>>0).toString(P);if(O=L,E(O))return U+N;for(;U.length<6;)U="0"+U;N=U+N}},t.i=function(P){return P<0?0:P<this.g.length?this.g[P]:this.h};function E(P){if(P.h!=0)return!1;for(let k=0;k<P.g.length;k++)if(P.g[k]!=0)return!1;return!0}function S(P){return P.h==-1}t.l=function(P){return P=D(this,P),S(P)?-1:E(P)?0:1};function T(P){const k=P.g.length,O=[];for(let N=0;N<k;N++)O[N]=~P.g[N];return new u(O,~P.h).add(b)}t.abs=function(){return S(this)?T(this):this},t.add=function(P){const k=Math.max(this.g.length,P.g.length),O=[];let N=0;for(let L=0;L<=k;L++){let U=N+(this.i(L)&65535)+(P.i(L)&65535),R=(U>>>16)+(this.i(L)>>>16)+(P.i(L)>>>16);N=R>>>16,U&=65535,R&=65535,O[L]=R<<16|U}return new u(O,O[O.length-1]&-2147483648?-1:0)};function D(P,k){return P.add(T(k))}t.j=function(P){if(E(this)||E(P))return _;if(S(this))return S(P)?T(this).j(T(P)):T(T(this).j(P));if(S(P))return T(this.j(T(P)));if(this.l(x)<0&&P.l(x)<0)return m(this.m()*P.m());const k=this.g.length+P.g.length,O=[];for(var N=0;N<2*k;N++)O[N]=0;for(N=0;N<this.g.length;N++)for(let L=0;L<P.g.length;L++){const U=this.i(N)>>>16,R=this.i(N)&65535,Y=P.i(L)>>>16,W=P.i(L)&65535;O[2*N+2*L]+=R*W,j(O,2*N+2*L),O[2*N+2*L+1]+=U*W,j(O,2*N+2*L+1),O[2*N+2*L+1]+=R*Y,j(O,2*N+2*L+1),O[2*N+2*L+2]+=U*Y,j(O,2*N+2*L+2)}for(P=0;P<k;P++)O[P]=O[2*P+1]<<16|O[2*P];for(P=k;P<2*k;P++)O[P]=0;return new u(O,0)};function j(P,k){for(;(P[k]&65535)!=P[k];)P[k+1]+=P[k]>>>16,P[k]&=65535,k++}function M(P,k){this.g=P,this.h=k}function K(P,k){if(E(k))throw Error("division by zero");if(E(P))return new M(_,_);if(S(P))return k=K(T(P),k),new M(T(k.g),T(k.h));if(S(k))return k=K(P,T(k)),new M(T(k.g),k.h);if(P.g.length>30){if(S(P)||S(k))throw Error("slowDivide_ only works with positive integers.");for(var O=b,N=k;N.l(P)<=0;)O=H(O),N=H(N);var L=Q(O,1),U=Q(N,1);for(N=Q(N,2),O=Q(O,2);!E(N);){var R=U.add(N);R.l(P)<=0&&(L=L.add(O),U=R),N=Q(N,1),O=Q(O,1)}return k=D(P,L.j(k)),new M(L,k)}for(L=_;P.l(k)>=0;){for(O=Math.max(1,Math.floor(P.m()/k.m())),N=Math.ceil(Math.log(O)/Math.LN2),N=N<=48?1:Math.pow(2,N-48),U=m(O),R=U.j(k);S(R)||R.l(P)>0;)O-=N,U=m(O),R=U.j(k);E(U)&&(U=b),L=L.add(U),P=D(P,R)}return new M(L,P)}t.B=function(P){return K(this,P).h},t.and=function(P){const k=Math.max(this.g.length,P.g.length),O=[];for(let N=0;N<k;N++)O[N]=this.i(N)&P.i(N);return new u(O,this.h&P.h)},t.or=function(P){const k=Math.max(this.g.length,P.g.length),O=[];for(let N=0;N<k;N++)O[N]=this.i(N)|P.i(N);return new u(O,this.h|P.h)},t.xor=function(P){const k=Math.max(this.g.length,P.g.length),O=[];for(let N=0;N<k;N++)O[N]=this.i(N)^P.i(N);return new u(O,this.h^P.h)};function H(P){const k=P.g.length+1,O=[];for(let N=0;N<k;N++)O[N]=P.i(N)<<1|P.i(N-1)>>>31;return new u(O,P.h)}function Q(P,k){const O=k>>5;k%=32;const N=P.g.length-O,L=[];for(let U=0;U<N;U++)L[U]=k>0?P.i(U+O)>>>k|P.i(U+O+1)<<32-k:P.i(U+O);return new u(L,P.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,f1=r,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.B,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=m,u.fromString=g,ua=u}).apply(typeof dS<"u"?dS:typeof self<"u"?self:typeof window<"u"?window:{});var Oh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var m1,hu,p1,Qh,iy,g1,y1,_1;(function(){var t,e=Object.defineProperty;function n(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof Oh=="object"&&Oh];for(var w=0;w<p.length;++w){var I=p[w];if(I&&I.Math==Math)return I}throw Error("Cannot find global object")}var r=n(this);function a(p,w){if(w)e:{var I=r;p=p.split(".");for(var F=0;F<p.length-1;F++){var le=p[F];if(!(le in I))break e;I=I[le]}p=p[p.length-1],F=I[p],w=w(F),w!=F&&w!=null&&e(I,p,{configurable:!0,writable:!0,value:w})}}a("Symbol.dispose",function(p){return p||Symbol("Symbol.dispose")}),a("Array.prototype.values",function(p){return p||function(){return this[Symbol.iterator]()}}),a("Object.entries",function(p){return p||function(w){var I=[],F;for(F in w)Object.prototype.hasOwnProperty.call(w,F)&&I.push([F,w[F]]);return I}});var o=o||{},u=this||self;function h(p){var w=typeof p;return w=="object"&&p!=null||w=="function"}function f(p,w,I){return p.call.apply(p.bind,arguments)}function m(p,w,I){return m=f,m.apply(null,arguments)}function g(p,w){var I=Array.prototype.slice.call(arguments,1);return function(){var F=I.slice();return F.push.apply(F,arguments),p.apply(this,F)}}function _(p,w){function I(){}I.prototype=w.prototype,p.Z=w.prototype,p.prototype=new I,p.prototype.constructor=p,p.Ob=function(F,le,fe){for(var Ce=Array(arguments.length-2),He=2;He<arguments.length;He++)Ce[He-2]=arguments[He];return w.prototype[le].apply(F,Ce)}}var b=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?p=>p&&AsyncContext.Snapshot.wrap(p):p=>p;function x(p){const w=p.length;if(w>0){const I=Array(w);for(let F=0;F<w;F++)I[F]=p[F];return I}return[]}function E(p,w){for(let F=1;F<arguments.length;F++){const le=arguments[F];var I=typeof le;if(I=I!="object"?I:le?Array.isArray(le)?"array":I:"null",I=="array"||I=="object"&&typeof le.length=="number"){I=p.length||0;const fe=le.length||0;p.length=I+fe;for(let Ce=0;Ce<fe;Ce++)p[I+Ce]=le[Ce]}else p.push(le)}}class S{constructor(w,I){this.i=w,this.j=I,this.h=0,this.g=null}get(){let w;return this.h>0?(this.h--,w=this.g,this.g=w.next,w.next=null):w=this.i(),w}}function T(p){u.setTimeout(()=>{throw p},0)}function D(){var p=P;let w=null;return p.g&&(w=p.g,p.g=p.g.next,p.g||(p.h=null),w.next=null),w}class j{constructor(){this.h=this.g=null}add(w,I){const F=M.get();F.set(w,I),this.h?this.h.next=F:this.g=F,this.h=F}}var M=new S(()=>new K,p=>p.reset());class K{constructor(){this.next=this.g=this.h=null}set(w,I){this.h=w,this.g=I,this.next=null}reset(){this.next=this.g=this.h=null}}let H,Q=!1,P=new j,k=()=>{const p=Promise.resolve(void 0);H=()=>{p.then(O)}};function O(){for(var p;p=D();){try{p.h.call(p.g)}catch(I){T(I)}var w=M;w.j(p),w.h<100&&(w.h++,p.next=w.g,w.g=p)}Q=!1}function N(){this.u=this.u,this.C=this.C}N.prototype.u=!1,N.prototype.dispose=function(){this.u||(this.u=!0,this.N())},N.prototype[Symbol.dispose]=function(){this.dispose()},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function L(p,w){this.type=p,this.g=this.target=w,this.defaultPrevented=!1}L.prototype.h=function(){this.defaultPrevented=!0};var U=(function(){if(!u.addEventListener||!Object.defineProperty)return!1;var p=!1,w=Object.defineProperty({},"passive",{get:function(){p=!0}});try{const I=()=>{};u.addEventListener("test",I,w),u.removeEventListener("test",I,w)}catch{}return p})();function R(p){return/^[\s\xa0]*$/.test(p)}function Y(p,w){L.call(this,p?p.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,p&&this.init(p,w)}_(Y,L),Y.prototype.init=function(p,w){const I=this.type=p.type,F=p.changedTouches&&p.changedTouches.length?p.changedTouches[0]:null;this.target=p.target||p.srcElement,this.g=w,w=p.relatedTarget,w||(I=="mouseover"?w=p.fromElement:I=="mouseout"&&(w=p.toElement)),this.relatedTarget=w,F?(this.clientX=F.clientX!==void 0?F.clientX:F.pageX,this.clientY=F.clientY!==void 0?F.clientY:F.pageY,this.screenX=F.screenX||0,this.screenY=F.screenY||0):(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0),this.button=p.button,this.key=p.key||"",this.ctrlKey=p.ctrlKey,this.altKey=p.altKey,this.shiftKey=p.shiftKey,this.metaKey=p.metaKey,this.pointerId=p.pointerId||0,this.pointerType=p.pointerType,this.state=p.state,this.i=p,p.defaultPrevented&&Y.Z.h.call(this)},Y.prototype.h=function(){Y.Z.h.call(this);const p=this.i;p.preventDefault?p.preventDefault():p.returnValue=!1};var W="closure_listenable_"+(Math.random()*1e6|0),B=0;function $(p,w,I,F,le){this.listener=p,this.proxy=null,this.src=w,this.type=I,this.capture=!!F,this.ha=le,this.key=++B,this.da=this.fa=!1}function G(p){p.da=!0,p.listener=null,p.proxy=null,p.src=null,p.ha=null}function J(p,w,I){for(const F in p)w.call(I,p[F],F,p)}function re(p,w){for(const I in p)w.call(void 0,p[I],I,p)}function V(p){const w={};for(const I in p)w[I]=p[I];return w}const q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ee(p,w){let I,F;for(let le=1;le<arguments.length;le++){F=arguments[le];for(I in F)p[I]=F[I];for(let fe=0;fe<q.length;fe++)I=q[fe],Object.prototype.hasOwnProperty.call(F,I)&&(p[I]=F[I])}}function ne(p){this.src=p,this.g={},this.h=0}ne.prototype.add=function(p,w,I,F,le){const fe=p.toString();p=this.g[fe],p||(p=this.g[fe]=[],this.h++);const Ce=se(p,w,F,le);return Ce>-1?(w=p[Ce],I||(w.fa=!1)):(w=new $(w,this.src,fe,!!F,le),w.fa=I,p.push(w)),w};function te(p,w){const I=w.type;if(I in p.g){var F=p.g[I],le=Array.prototype.indexOf.call(F,w,void 0),fe;(fe=le>=0)&&Array.prototype.splice.call(F,le,1),fe&&(G(w),p.g[I].length==0&&(delete p.g[I],p.h--))}}function se(p,w,I,F){for(let le=0;le<p.length;++le){const fe=p[le];if(!fe.da&&fe.listener==w&&fe.capture==!!I&&fe.ha==F)return le}return-1}var he="closure_lm_"+(Math.random()*1e6|0),we={};function ge(p,w,I,F,le){if(Array.isArray(w)){for(let fe=0;fe<w.length;fe++)ge(p,w[fe],I,F,le);return null}return I=ii(I),p&&p[W]?p.J(w,I,h(F)?!!F.capture:!1,le):Z(p,w,I,!1,F,le)}function Z(p,w,I,F,le,fe){if(!w)throw Error("Invalid event type");const Ce=h(le)?!!le.capture:!!le;let He=lt(p);if(He||(p[he]=He=new ne(p)),I=He.add(w,I,F,Ce,fe),I.proxy)return I;if(F=ve(),I.proxy=F,F.src=p,F.listener=I,p.addEventListener)U||(le=Ce),le===void 0&&(le=!1),p.addEventListener(w.toString(),F,le);else if(p.attachEvent)p.attachEvent(Me(w.toString()),F);else if(p.addListener&&p.removeListener)p.addListener(F);else throw Error("addEventListener and attachEvent are unavailable.");return I}function ve(){function p(I){return w.call(p.src,p.listener,I)}const w=ke;return p}function Te(p,w,I,F,le){if(Array.isArray(w))for(var fe=0;fe<w.length;fe++)Te(p,w[fe],I,F,le);else F=h(F)?!!F.capture:!!F,I=ii(I),p&&p[W]?(p=p.i,fe=String(w).toString(),fe in p.g&&(w=p.g[fe],I=se(w,I,F,le),I>-1&&(G(w[I]),Array.prototype.splice.call(w,I,1),w.length==0&&(delete p.g[fe],p.h--)))):p&&(p=lt(p))&&(w=p.g[w.toString()],p=-1,w&&(p=se(w,I,F,le)),(I=p>-1?w[p]:null)&&dt(I))}function dt(p){if(typeof p!="number"&&p&&!p.da){var w=p.src;if(w&&w[W])te(w.i,p);else{var I=p.type,F=p.proxy;w.removeEventListener?w.removeEventListener(I,F,p.capture):w.detachEvent?w.detachEvent(Me(I),F):w.addListener&&w.removeListener&&w.removeListener(F),(I=lt(w))?(te(I,p),I.h==0&&(I.src=null,w[he]=null)):G(p)}}}function Me(p){return p in we?we[p]:we[p]="on"+p}function ke(p,w){if(p.da)p=!0;else{w=new Y(w,this);const I=p.listener,F=p.ha||p.src;p.fa&&dt(p),p=I.call(F,w)}return p}function lt(p){return p=p[he],p instanceof ne?p:null}var rr="__closure_events_fn_"+(Math.random()*1e9>>>0);function ii(p){return typeof p=="function"?p:(p[rr]||(p[rr]=function(w){return p.handleEvent(w)}),p[rr])}function Et(){N.call(this),this.i=new ne(this),this.M=this,this.G=null}_(Et,N),Et.prototype[W]=!0,Et.prototype.removeEventListener=function(p,w,I,F){Te(this,p,w,I,F)};function Ft(p,w){var I,F=p.G;if(F)for(I=[];F;F=F.G)I.push(F);if(p=p.M,F=w.type||w,typeof w=="string")w=new L(w,p);else if(w instanceof L)w.target=w.target||p;else{var le=w;w=new L(F,p),ee(w,le)}le=!0;let fe,Ce;if(I)for(Ce=I.length-1;Ce>=0;Ce--)fe=w.g=I[Ce],le=at(fe,F,!0,w)&&le;if(fe=w.g=p,le=at(fe,F,!0,w)&&le,le=at(fe,F,!1,w)&&le,I)for(Ce=0;Ce<I.length;Ce++)fe=w.g=I[Ce],le=at(fe,F,!1,w)&&le}Et.prototype.N=function(){if(Et.Z.N.call(this),this.i){var p=this.i;for(const w in p.g){const I=p.g[w];for(let F=0;F<I.length;F++)G(I[F]);delete p.g[w],p.h--}}this.G=null},Et.prototype.J=function(p,w,I,F){return this.i.add(String(p),w,!1,I,F)},Et.prototype.K=function(p,w,I,F){return this.i.add(String(p),w,!0,I,F)};function at(p,w,I,F){if(w=p.i.g[String(w)],!w)return!0;w=w.concat();let le=!0;for(let fe=0;fe<w.length;++fe){const Ce=w[fe];if(Ce&&!Ce.da&&Ce.capture==I){const He=Ce.listener,qt=Ce.ha||Ce.src;Ce.fa&&te(p.i,Ce),le=He.call(qt,F)!==!1&&le}}return le&&!F.defaultPrevented}function ln(p,w){if(typeof p!="function")if(p&&typeof p.handleEvent=="function")p=m(p.handleEvent,p);else throw Error("Invalid listener argument");return Number(w)>2147483647?-1:u.setTimeout(p,w||0)}function _s(p){p.g=ln(()=>{p.g=null,p.i&&(p.i=!1,_s(p))},p.l);const w=p.h;p.h=null,p.m.apply(null,w)}class cn extends N{constructor(w,I){super(),this.m=w,this.l=I,this.h=null,this.i=!1,this.g=null}j(w){this.h=arguments,this.g?this.i=!0:_s(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Lr(p){N.call(this),this.h=p,this.g={}}_(Lr,N);var ac=[];function oc(p){J(p.g,function(w,I){this.g.hasOwnProperty(I)&&dt(w)},p),p.g={}}Lr.prototype.N=function(){Lr.Z.N.call(this),oc(this)},Lr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var bs=u.JSON.stringify,ym=u.JSON.parse,rd=class{stringify(p){return u.JSON.stringify(p,void 0)}parse(p){return u.JSON.parse(p,void 0)}};function id(){}function sd(){}var Br={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Sn(){L.call(this,"d")}_(Sn,L);function _r(){L.call(this,"c")}_(_r,L);var $t={},ad=null;function wo(){return ad=ad||new Et}$t.Ia="serverreachability";function od(p){L.call(this,$t.Ia,p)}_(od,L);function si(p){const w=wo();Ft(w,new od(w))}$t.STAT_EVENT="statevent";function Aa(p,w){L.call(this,$t.STAT_EVENT,p),this.stat=w}_(Aa,L);function Kt(p){const w=wo();Ft(w,new Aa(w,p))}$t.Ja="timingevent";function ai(p,w){L.call(this,$t.Ja,p),this.size=w}_(ai,L);function oi(p,w){if(typeof p!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){p()},w)}function zr(){this.g=!0}zr.prototype.ua=function(){this.g=!1};function _m(p,w,I,F,le,fe){p.info(function(){if(p.g)if(fe){var Ce="",He=fe.split("&");for(let ht=0;ht<He.length;ht++){var qt=He[ht].split("=");if(qt.length>1){const Mt=qt[0];qt=qt[1];const Sr=Mt.split("_");Ce=Sr.length>=2&&Sr[1]=="type"?Ce+(Mt+"="+qt+"&"):Ce+(Mt+"=redacted&")}}}else Ce=null;else Ce=fe;return"XMLHTTP REQ ("+F+") [attempt "+le+"]: "+w+`
`+I+`
`+Ce})}function ld(p,w,I,F,le,fe,Ce){p.info(function(){return"XMLHTTP RESP ("+F+") [ attempt "+le+"]: "+w+`
`+I+`
`+fe+" "+Ce})}function li(p,w,I,F){p.info(function(){return"XMLHTTP TEXT ("+w+"): "+bm(p,I)+(F?" "+F:"")})}function ja(p,w){p.info(function(){return"TIMEOUT: "+w})}zr.prototype.info=function(){};function bm(p,w){if(!p.g)return w;if(!w)return null;try{const fe=JSON.parse(w);if(fe){for(p=0;p<fe.length;p++)if(Array.isArray(fe[p])){var I=fe[p];if(!(I.length<2)){var F=I[1];if(Array.isArray(F)&&!(F.length<1)){var le=F[0];if(le!="noop"&&le!="stop"&&le!="close")for(let Ce=1;Ce<F.length;Ce++)F[Ce]=""}}}}return bs(fe)}catch{return w}}var Ra={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},lc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},cc;function Da(){}_(Da,id),Da.prototype.g=function(){return new XMLHttpRequest},cc=new Da;function zi(p){return encodeURIComponent(String(p))}function cd(p){var w=1;p=p.split(":");const I=[];for(;w>0&&p.length;)I.push(p.shift()),w--;return p.length&&I.push(p.join(":")),I}function Ur(p,w,I,F){this.j=p,this.i=w,this.l=I,this.S=F||1,this.V=new Lr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Vr}function Vr(){this.i=null,this.g="",this.h=!1}var Yt={},yn={};function ci(p,w,I){p.M=1,p.A=Ia(Jt(w)),p.u=I,p.R=!0,Eo(p,null)}function Eo(p,w){p.F=Date.now(),ui(p),p.B=Jt(p.A);var I=p.B,F=p.S;Array.isArray(F)||(F=[String(F)]),jo(I.i,"t",F),p.C=0,I=p.j.L,p.h=new Vr,p.g=Ed(p.j,I?w:null,!p.u),p.P>0&&(p.O=new cn(m(p.Y,p,p.g),p.P)),w=p.V,I=p.g,F=p.ba;var le="readystatechange";Array.isArray(le)||(le&&(ac[0]=le.toString()),le=ac);for(let fe=0;fe<le.length;fe++){const Ce=ge(I,le[fe],F||w.handleEvent,!1,w.h||w);if(!Ce)break;w.g[Ce.key]=Ce}w=p.J?V(p.J):{},p.u?(p.v||(p.v="POST"),w["Content-Type"]="application/x-www-form-urlencoded",p.g.ea(p.B,p.v,p.u,w)):(p.v="GET",p.g.ea(p.B,p.v,null,w)),si(),_m(p.i,p.v,p.B,p.l,p.S,p.u)}Ur.prototype.ba=function(p){p=p.target;const w=this.O;w&&qr(p)==3?w.j():this.Y(p)},Ur.prototype.Y=function(p){try{if(p==this.g)e:{const He=qr(this.g),qt=this.g.ya(),ht=this.g.ca();if(!(He<3)&&(He!=3||this.g&&(this.h.h||this.g.la()||wn(this.g)))){this.K||He!=4||qt==7||(qt==8||ht<=0?si(3):si(2)),di(this);var w=this.g.ca();this.X=w;var I=vm(this);if(this.o=w==200,ld(this.i,this.v,this.B,this.l,this.S,He,w),this.o){if(this.U&&!this.L){t:{if(this.g){var F,le=this.g;if((F=le.g?le.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!R(F)){var fe=F;break t}}fe=null}if(p=fe)li(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,hi(this,p);else{this.o=!1,this.m=3,Kt(12),ir(this),br(this);break e}}if(this.R){p=!0;let Mt;for(;!this.K&&this.C<I.length;)if(Mt=dd(this,I),Mt==yn){He==4&&(this.m=4,Kt(14),p=!1),li(this.i,this.l,null,"[Incomplete Response]");break}else if(Mt==Yt){this.m=4,Kt(15),li(this.i,this.l,I,"[Invalid Chunk]"),p=!1;break}else li(this.i,this.l,Mt,null),hi(this,Mt);if(ud(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),He!=4||I.length!=0||this.h.h||(this.m=1,Kt(16),p=!1),this.o=this.o&&p,!p)li(this.i,this.l,I,"[Invalid Chunked Response]"),ir(this),br(this);else if(I.length>0&&!this.W){this.W=!0;var Ce=this.j;Ce.g==this&&Ce.aa&&!Ce.P&&(Ce.j.info("Great, no buffering proxy detected. Bytes received: "+I.length),Ec(Ce),Ce.P=!0,Kt(11))}}else li(this.i,this.l,I,null),hi(this,I);He==4&&ir(this),this.o&&!this.K&&(He==4?vd(this.j,this):(this.o=!1,ui(this)))}else Vi(this.g),w==400&&I.indexOf("Unknown SID")>0?(this.m=3,Kt(12)):(this.m=0,Kt(13)),ir(this),br(this)}}}catch{}};function vm(p){if(!ud(p))return p.g.la();const w=wn(p.g);if(w==="")return"";let I="";const F=w.length,le=qr(p.g)==4;if(!p.h.i){if(typeof TextDecoder>"u")return ir(p),br(p),"";p.h.i=new u.TextDecoder}for(let fe=0;fe<F;fe++)p.h.h=!0,I+=p.h.i.decode(w[fe],{stream:!(le&&fe==F-1)});return w.length=0,p.h.g+=I,p.C=0,p.h.g}function ud(p){return p.g?p.v=="GET"&&p.M!=2&&p.j.Aa:!1}function dd(p,w){var I=p.C,F=w.indexOf(`
`,I);return F==-1?yn:(I=Number(w.substring(I,F)),isNaN(I)?Yt:(F+=1,F+I>w.length?yn:(w=w.slice(F,F+I),p.C=F+I,w)))}Ur.prototype.cancel=function(){this.K=!0,ir(this)};function ui(p){p.T=Date.now()+p.H,Co(p,p.H)}function Co(p,w){if(p.D!=null)throw Error("WatchDog timer not null");p.D=oi(m(p.aa,p),w)}function di(p){p.D&&(u.clearTimeout(p.D),p.D=null)}Ur.prototype.aa=function(){this.D=null;const p=Date.now();p-this.T>=0?(ja(this.i,this.B),this.M!=2&&(si(),Kt(17)),ir(this),this.m=2,br(this)):Co(this,this.T-p)};function br(p){p.j.I==0||p.K||vd(p.j,p)}function ir(p){di(p);var w=p.O;w&&typeof w.dispose=="function"&&w.dispose(),p.O=null,oc(p.V),p.g&&(w=p.g,p.g=null,w.abort(),w.dispose())}function hi(p,w){try{var I=p.j;if(I.I!=0&&(I.g==p||mi(I.h,p))){if(!p.L&&mi(I.h,p)&&I.I==3){try{var F=I.Ba.g.parse(w)}catch{F=null}if(Array.isArray(F)&&F.length==3){var le=F;if(le[0]==0){e:if(!I.v){if(I.g)if(I.g.F+3e3<p.F)ko(I),As(I);else break e;Ba(I),Kt(18)}}else I.xa=le[1],0<I.xa-I.K&&le[2]<37500&&I.F&&I.A==0&&!I.C&&(I.C=oi(m(I.Va,I),6e3));fi(I.h)<=1&&I.ta&&(I.ta=void 0)}else vi(I,11)}else if((p.L||I.g==p)&&ko(I),!R(w))for(le=I.Ba.g.parse(w),w=0;w<le.length;w++){let ht=le[w];const Mt=ht[0];if(!(Mt<=I.K))if(I.K=Mt,ht=ht[1],I.I==2)if(ht[0]=="c"){I.M=ht[1],I.ba=ht[2];const Sr=ht[3];Sr!=null&&(I.ka=Sr,I.j.info("VER="+I.ka));const xi=ht[4];xi!=null&&(I.za=xi,I.j.info("SVER="+I.za));const Hr=ht[5];Hr!=null&&typeof Hr=="number"&&Hr>0&&(F=1.5*Hr,I.O=F,I.j.info("backChannelRequestTimeoutMs_="+F)),F=I;const Gr=p.g;if(Gr){const za=Gr.g?Gr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(za){var fe=F.h;fe.g||za.indexOf("spdy")==-1&&za.indexOf("quic")==-1&&za.indexOf("h2")==-1||(fe.j=fe.l,fe.g=new Set,fe.h&&(hc(fe,fe.h),fe.h=null))}if(F.G){const Oo=Gr.g?Gr.g.getResponseHeader("X-HTTP-Session-Id"):null;Oo&&(F.wa=Oo,gt(F.J,F.G,Oo))}}I.I=3,I.l&&I.l.ra(),I.aa&&(I.T=Date.now()-p.F,I.j.info("Handshake RTT: "+I.T+"ms")),F=I;var Ce=p;if(F.na=wd(F,F.L?F.ba:null,F.W),Ce.L){fc(F.h,Ce);var He=Ce,qt=F.O;qt&&(He.H=qt),He.D&&(di(He),ui(He)),F.g=Ce}else _d(F);I.i.length>0&&bi(I)}else ht[0]!="stop"&&ht[0]!="close"||vi(I,7);else I.I==3&&(ht[0]=="stop"||ht[0]=="close"?ht[0]=="stop"?vi(I,7):Sc(I):ht[0]!="noop"&&I.l&&I.l.qa(ht),I.A=0)}}si(4)}catch{}}var Xt=class{constructor(p,w){this.g=p,this.map=w}};function uc(p){this.l=p||10,u.PerformanceNavigationTiming?(p=u.performance.getEntriesByType("navigation"),p=p.length>0&&(p[0].nextHopProtocol=="hq"||p[0].nextHopProtocol=="h2")):p=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=p?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function dc(p){return p.h?!0:p.g?p.g.size>=p.j:!1}function fi(p){return p.h?1:p.g?p.g.size:0}function mi(p,w){return p.h?p.h==w:p.g?p.g.has(w):!1}function hc(p,w){p.g?p.g.add(w):p.h=w}function fc(p,w){p.h&&p.h==w?p.h=null:p.g&&p.g.has(w)&&p.g.delete(w)}uc.prototype.cancel=function(){if(this.i=mc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const p of this.g.values())p.cancel();this.g.clear()}};function mc(p){if(p.h!=null)return p.i.concat(p.h.G);if(p.g!=null&&p.g.size!==0){let w=p.i;for(const I of p.g.values())w=w.concat(I.G);return w}return x(p.i)}var hd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function To(p,w){if(p){p=p.split("&");for(let I=0;I<p.length;I++){const F=p[I].indexOf("=");let le,fe=null;F>=0?(le=p[I].substring(0,F),fe=p[I].substring(F+1)):le=p[I],w(le,fe?decodeURIComponent(fe.replace(/\+/g," ")):"")}}}function sr(p){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let w;p instanceof sr?(this.l=p.l,_n(this,p.j),this.o=p.o,this.g=p.g,vs(this,p.u),this.h=p.h,pc(this,gd(p.i)),this.m=p.m):p&&(w=String(p).match(hd))?(this.l=!1,_n(this,w[1]||"",!0),this.o=pi(w[2]||""),this.g=pi(w[3]||"",!0),vs(this,w[4]),this.h=pi(w[5]||"",!0),pc(this,w[6]||"",!0),this.m=pi(w[7]||"")):(this.l=!1,this.i=new Ss(null,this.l))}sr.prototype.toString=function(){const p=[];var w=this.j;w&&p.push(Ma(w,Ao,!0),":");var I=this.g;return(I||w=="file")&&(p.push("//"),(w=this.o)&&p.push(Ma(w,Ao,!0),"@"),p.push(zi(I).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),I=this.u,I!=null&&p.push(":",String(I))),(I=this.h)&&(this.g&&I.charAt(0)!="/"&&p.push("/"),p.push(Ma(I,I.charAt(0)=="/"?gc:fd,!0))),(I=this.i.toString())&&p.push("?",I),(I=this.m)&&p.push("#",Ma(I,md)),p.join("")},sr.prototype.resolve=function(p){const w=Jt(this);let I=!!p.j;I?_n(w,p.j):I=!!p.o,I?w.o=p.o:I=!!p.g,I?w.g=p.g:I=p.u!=null;var F=p.h;if(I)vs(w,p.u);else if(I=!!p.h){if(F.charAt(0)!="/")if(this.g&&!this.h)F="/"+F;else{var le=w.h.lastIndexOf("/");le!=-1&&(F=w.h.slice(0,le+1)+F)}if(le=F,le==".."||le==".")F="";else if(le.indexOf("./")!=-1||le.indexOf("/.")!=-1){F=le.lastIndexOf("/",0)==0,le=le.split("/");const fe=[];for(let Ce=0;Ce<le.length;){const He=le[Ce++];He=="."?F&&Ce==le.length&&fe.push(""):He==".."?((fe.length>1||fe.length==1&&fe[0]!="")&&fe.pop(),F&&Ce==le.length&&fe.push("")):(fe.push(He),F=!0)}F=fe.join("/")}else F=le}return I?w.h=F:I=p.i.toString()!=="",I?pc(w,gd(p.i)):I=!!p.m,I&&(w.m=p.m),w};function Jt(p){return new sr(p)}function _n(p,w,I){p.j=I?pi(w,!0):w,p.j&&(p.j=p.j.replace(/:$/,""))}function vs(p,w){if(w){if(w=Number(w),isNaN(w)||w<0)throw Error("Bad port number "+w);p.u=w}else p.u=null}function pc(p,w,I){w instanceof Ss?(p.i=w,Ro(p.i,p.l)):(I||(w=Ma(w,xs)),p.i=new Ss(w,p.l))}function gt(p,w,I){p.i.set(w,I)}function Ia(p){return gt(p,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),p}function pi(p,w){return p?w?decodeURI(p.replace(/%25/g,"%2525")):decodeURIComponent(p):""}function Ma(p,w,I){return typeof p=="string"?(p=encodeURI(p).replace(w,Gn),I&&(p=p.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p):null}function Gn(p){return p=p.charCodeAt(0),"%"+(p>>4&15).toString(16)+(p&15).toString(16)}var Ao=/[#\/\?@]/g,fd=/[#\?:]/g,gc=/[#\?]/g,xs=/[#\?@]/g,md=/#/g;function Ss(p,w){this.h=this.g=null,this.i=p||null,this.j=!!w}function Qn(p){p.g||(p.g=new Map,p.h=0,p.i&&To(p.i,function(w,I){p.add(decodeURIComponent(w.replace(/\+/g," ")),I)}))}t=Ss.prototype,t.add=function(p,w){Qn(this),this.i=null,p=ws(this,p);let I=this.g.get(p);return I||this.g.set(p,I=[]),I.push(w),this.h+=1,this};function pd(p,w){Qn(p),w=ws(p,w),p.g.has(w)&&(p.i=null,p.h-=p.g.get(w).length,p.g.delete(w))}function yc(p,w){return Qn(p),w=ws(p,w),p.g.has(w)}t.forEach=function(p,w){Qn(this),this.g.forEach(function(I,F){I.forEach(function(le){p.call(w,le,F,this)},this)},this)};function _c(p,w){Qn(p);let I=[];if(typeof w=="string")yc(p,w)&&(I=I.concat(p.g.get(ws(p,w))));else for(p=Array.from(p.g.values()),w=0;w<p.length;w++)I=I.concat(p[w]);return I}t.set=function(p,w){return Qn(this),this.i=null,p=ws(this,p),yc(this,p)&&(this.h-=this.g.get(p).length),this.g.set(p,[w]),this.h+=1,this},t.get=function(p,w){return p?(p=_c(this,p),p.length>0?String(p[0]):w):w};function jo(p,w,I){pd(p,w),I.length>0&&(p.i=null,p.g.set(ws(p,w),x(I)),p.h+=I.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const p=[],w=Array.from(this.g.keys());for(let F=0;F<w.length;F++){var I=w[F];const le=zi(I);I=_c(this,I);for(let fe=0;fe<I.length;fe++){let Ce=le;I[fe]!==""&&(Ce+="="+zi(I[fe])),p.push(Ce)}}return this.i=p.join("&")};function gd(p){const w=new Ss;return w.i=p.i,p.g&&(w.g=new Map(p.g),w.h=p.h),w}function ws(p,w){return w=String(w),p.j&&(w=w.toLowerCase()),w}function Ro(p,w){w&&!p.j&&(Qn(p),p.i=null,p.g.forEach(function(I,F){const le=F.toLowerCase();F!=le&&(pd(this,F),jo(this,le,I))},p)),p.j=w}function Fr(p,w){const I=new zr;if(u.Image){const F=new Image;F.onload=g(vr,I,"TestLoadImage: loaded",!0,w,F),F.onerror=g(vr,I,"TestLoadImage: error",!1,w,F),F.onabort=g(vr,I,"TestLoadImage: abort",!1,w,F),F.ontimeout=g(vr,I,"TestLoadImage: timeout",!1,w,F),u.setTimeout(function(){F.ontimeout&&F.ontimeout()},1e4),F.src=p}else w(!1)}function bc(p,w){const I=new zr,F=new AbortController,le=setTimeout(()=>{F.abort(),vr(I,"TestPingServer: timeout",!1,w)},1e4);fetch(p,{signal:F.signal}).then(fe=>{clearTimeout(le),fe.ok?vr(I,"TestPingServer: ok",!0,w):vr(I,"TestPingServer: server error",!1,w)}).catch(()=>{clearTimeout(le),vr(I,"TestPingServer: error",!1,w)})}function vr(p,w,I,F,le){try{le&&(le.onload=null,le.onerror=null,le.onabort=null,le.ontimeout=null),F(I)}catch{}}function Es(){this.g=new rd}function gi(p){this.i=p.Sb||null,this.h=p.ab||!1}_(gi,id),gi.prototype.g=function(){return new ka(this.i,this.h)};function ka(p,w){Et.call(this),this.H=p,this.o=w,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}_(ka,Et),t=ka.prototype,t.open=function(p,w){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=p,this.D=w,this.readyState=1,$r(this)},t.send=function(p){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const w={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};p&&(w.body=p),(this.H||u).fetch(new Request(this.D,w)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Cs(this)),this.readyState=0},t.Pa=function(p){if(this.g&&(this.l=p,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=p.headers,this.readyState=2,$r(this)),this.g&&(this.readyState=3,$r(this),this.g)))if(this.responseType==="arraybuffer")p.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in p){if(this.j=p.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Do(this)}else p.text().then(this.Oa.bind(this),this.ga.bind(this))};function Do(p){p.j.read().then(p.Ma.bind(p)).catch(p.ga.bind(p))}t.Ma=function(p){if(this.g){if(this.o&&p.value)this.response.push(p.value);else if(!this.o){var w=p.value?p.value:new Uint8Array(0);(w=this.B.decode(w,{stream:!p.done}))&&(this.response=this.responseText+=w)}p.done?Cs(this):$r(this),this.readyState==3&&Do(this)}},t.Oa=function(p){this.g&&(this.response=this.responseText=p,Cs(this))},t.Na=function(p){this.g&&(this.response=p,Cs(this))},t.ga=function(){this.g&&Cs(this)};function Cs(p){p.readyState=4,p.l=null,p.j=null,p.B=null,$r(p)}t.setRequestHeader=function(p,w){this.A.append(p,w)},t.getResponseHeader=function(p){return this.h&&this.h.get(p.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const p=[],w=this.h.entries();for(var I=w.next();!I.done;)I=I.value,p.push(I[0]+": "+I[1]),I=w.next();return p.join(`\r
`)};function $r(p){p.onreadystatechange&&p.onreadystatechange.call(p)}Object.defineProperty(ka.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(p){this.m=p?"include":"same-origin"}});function xr(p){let w="";return J(p,function(I,F){w+=F,w+=":",w+=I,w+=`\r
`}),w}function Oa(p,w,I){e:{for(F in I){var F=!1;break e}F=!0}F||(I=xr(I),typeof p=="string"?I!=null&&zi(I):gt(p,w,I))}function bt(p){Et.call(this),this.headers=new Map,this.L=p||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}_(bt,Et);var yi=/^https?$/i,vc=["POST","PUT"];t=bt.prototype,t.Fa=function(p){this.H=p},t.ea=function(p,w,I,F){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+p);w=w?w.toUpperCase():"GET",this.D=p,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():cc.g(),this.g.onreadystatechange=b(m(this.Ca,this));try{this.B=!0,this.g.open(w,String(p),!0),this.B=!1}catch(fe){Na(this,fe);return}if(p=I||"",I=new Map(this.headers),F)if(Object.getPrototypeOf(F)===Object.prototype)for(var le in F)I.set(le,F[le]);else if(typeof F.keys=="function"&&typeof F.get=="function")for(const fe of F.keys())I.set(fe,F.get(fe));else throw Error("Unknown input type for opt_headers: "+String(F));F=Array.from(I.keys()).find(fe=>fe.toLowerCase()=="content-type"),le=u.FormData&&p instanceof u.FormData,!(Array.prototype.indexOf.call(vc,w,void 0)>=0)||F||le||I.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[fe,Ce]of I)this.g.setRequestHeader(fe,Ce);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(p),this.v=!1}catch(fe){Na(this,fe)}};function Na(p,w){p.h=!1,p.g&&(p.j=!0,p.g.abort(),p.j=!1),p.l=w,p.o=5,xc(p),Ui(p)}function xc(p){p.A||(p.A=!0,Ft(p,"complete"),Ft(p,"error"))}t.abort=function(p){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=p||7,Ft(this,"complete"),Ft(this,"abort"),Ui(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ui(this,!0)),bt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Pa(this):this.Xa())},t.Xa=function(){Pa(this)};function Pa(p){if(p.h&&typeof o<"u"){if(p.v&&qr(p)==4)setTimeout(p.Ca.bind(p),0);else if(Ft(p,"readystatechange"),qr(p)==4){p.h=!1;try{const fe=p.ca();e:switch(fe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var w=!0;break e;default:w=!1}var I;if(!(I=w)){var F;if(F=fe===0){let Ce=String(p.D).match(hd)[1]||null;!Ce&&u.self&&u.self.location&&(Ce=u.self.location.protocol.slice(0,-1)),F=!yi.test(Ce?Ce.toLowerCase():"")}I=F}if(I)Ft(p,"complete"),Ft(p,"success");else{p.o=6;try{var le=qr(p)>2?p.g.statusText:""}catch{le=""}p.l=le+" ["+p.ca()+"]",xc(p)}}finally{Ui(p)}}}}function Ui(p,w){if(p.g){p.m&&(clearTimeout(p.m),p.m=null);const I=p.g;p.g=null,w||Ft(p,"ready");try{I.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function qr(p){return p.g?p.g.readyState:0}t.ca=function(){try{return qr(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(p){if(this.g){var w=this.g.responseText;return p&&w.indexOf(p)==0&&(w=w.substring(p.length)),ym(w)}};function wn(p){try{if(!p.g)return null;if("response"in p.g)return p.g.response;switch(p.F){case"":case"text":return p.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in p.g)return p.g.mozResponseArrayBuffer}return null}catch{return null}}function Vi(p){const w={};p=(p.g&&qr(p)>=2&&p.g.getAllResponseHeaders()||"").split(`\r
`);for(let F=0;F<p.length;F++){if(R(p[F]))continue;var I=cd(p[F]);const le=I[0];if(I=I[1],typeof I!="string")continue;I=I.trim();const fe=w[le]||[];w[le]=fe,fe.push(I)}re(w,function(F){return F.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function _i(p,w,I){return I&&I.internalChannelParams&&I.internalChannelParams[p]||w}function Ts(p){this.za=0,this.i=[],this.j=new zr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=_i("failFast",!1,p),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=_i("baseRetryDelayMs",5e3,p),this.Za=_i("retryDelaySeedMs",1e4,p),this.Ta=_i("forwardChannelMaxRetries",2,p),this.va=_i("forwardChannelRequestTimeoutMs",2e4,p),this.ma=p&&p.xmlHttpFactory||void 0,this.Ua=p&&p.Rb||void 0,this.Aa=p&&p.useFetchStreams||!1,this.O=void 0,this.L=p&&p.supportsCrossDomainXhr||!1,this.M="",this.h=new uc(p&&p.concurrentRequestLimit),this.Ba=new Es,this.S=p&&p.fastHandshake||!1,this.R=p&&p.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=p&&p.Pb||!1,p&&p.ua&&this.j.ua(),p&&p.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&p&&p.detectBufferingProxy||!1,this.ia=void 0,p&&p.longPollingTimeout&&p.longPollingTimeout>0&&(this.ia=p.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Ts.prototype,t.ka=8,t.I=1,t.connect=function(p,w,I,F){Kt(0),this.W=p,this.H=w||{},I&&F!==void 0&&(this.H.OSID=I,this.H.OAID=F),this.F=this.X,this.J=wd(this,null,this.W),bi(this)};function Sc(p){if(Io(p),p.I==3){var w=p.V++,I=Jt(p.J);if(gt(I,"SID",p.M),gt(I,"RID",w),gt(I,"TYPE","terminate"),La(p,I),w=new Ur(p,p.j,w),w.M=2,w.A=Ia(Jt(I)),I=!1,u.navigator&&u.navigator.sendBeacon)try{I=u.navigator.sendBeacon(w.A.toString(),"")}catch{}!I&&u.Image&&(new Image().src=w.A,I=!0),I||(w.g=Ed(w.j,null),w.g.ea(w.A)),w.F=Date.now(),ui(w)}Sd(p)}function As(p){p.g&&(Ec(p),p.g.cancel(),p.g=null)}function Io(p){As(p),p.v&&(u.clearTimeout(p.v),p.v=null),ko(p),p.h.cancel(),p.m&&(typeof p.m=="number"&&u.clearTimeout(p.m),p.m=null)}function bi(p){if(!dc(p.h)&&!p.m){p.m=!0;var w=p.Ea;H||k(),Q||(H(),Q=!0),P.add(w,p),p.D=0}}function Mo(p,w){return fi(p.h)>=p.h.j-(p.m?1:0)?!1:p.m?(p.i=w.G.concat(p.i),!0):p.I==1||p.I==2||p.D>=(p.Sa?0:p.Ta)?!1:(p.m=oi(m(p.Ea,p,w),xd(p,p.D)),p.D++,!0)}t.Ea=function(p){if(this.m)if(this.m=null,this.I==1){if(!p){this.V=Math.floor(Math.random()*1e5),p=this.V++;const le=new Ur(this,this.j,p);let fe=this.o;if(this.U&&(fe?(fe=V(fe),ee(fe,this.U)):fe=this.U),this.u!==null||this.R||(le.J=fe,fe=null),this.S)e:{for(var w=0,I=0;I<this.i.length;I++){t:{var F=this.i[I];if("__data__"in F.map&&(F=F.map.__data__,typeof F=="string")){F=F.length;break t}F=void 0}if(F===void 0)break;if(w+=F,w>4096){w=I;break e}if(w===4096||I===this.i.length-1){w=I+1;break e}}w=1e3}else w=1e3;w=yd(this,le,w),I=Jt(this.J),gt(I,"RID",p),gt(I,"CVER",22),this.G&&gt(I,"X-HTTP-Session-Id",this.G),La(this,I),fe&&(this.R?w="headers="+zi(xr(fe))+"&"+w:this.u&&Oa(I,this.u,fe)),hc(this.h,le),this.Ra&&gt(I,"TYPE","init"),this.S?(gt(I,"$req",w),gt(I,"SID","null"),le.U=!0,ci(le,I,null)):ci(le,I,w),this.I=2}}else this.I==3&&(p?wc(this,p):this.i.length==0||dc(this.h)||wc(this))};function wc(p,w){var I;w?I=w.l:I=p.V++;const F=Jt(p.J);gt(F,"SID",p.M),gt(F,"RID",I),gt(F,"AID",p.K),La(p,F),p.u&&p.o&&Oa(F,p.u,p.o),I=new Ur(p,p.j,I,p.D+1),p.u===null&&(I.J=p.o),w&&(p.i=w.G.concat(p.i)),w=yd(p,I,1e3),I.H=Math.round(p.va*.5)+Math.round(p.va*.5*Math.random()),hc(p.h,I),ci(I,F,w)}function La(p,w){p.H&&J(p.H,function(I,F){gt(w,F,I)}),p.l&&J({},function(I,F){gt(w,F,I)})}function yd(p,w,I){I=Math.min(p.i.length,I);const F=p.l?m(p.l.Ka,p.l,p):null;e:{var le=p.i;let He=-1;for(;;){const qt=["count="+I];He==-1?I>0?(He=le[0].g,qt.push("ofs="+He)):He=0:qt.push("ofs="+He);let ht=!0;for(let Mt=0;Mt<I;Mt++){var fe=le[Mt].g;const Sr=le[Mt].map;if(fe-=He,fe<0)He=Math.max(0,le[Mt].g-100),ht=!1;else try{fe="req"+fe+"_"||"";try{var Ce=Sr instanceof Map?Sr:Object.entries(Sr);for(const[xi,Hr]of Ce){let Gr=Hr;h(Hr)&&(Gr=bs(Hr)),qt.push(fe+xi+"="+encodeURIComponent(Gr))}}catch(xi){throw qt.push(fe+"type="+encodeURIComponent("_badmap")),xi}}catch{F&&F(Sr)}}if(ht){Ce=qt.join("&");break e}}Ce=void 0}return p=p.i.splice(0,I),w.G=p,Ce}function _d(p){if(!p.g&&!p.v){p.Y=1;var w=p.Da;H||k(),Q||(H(),Q=!0),P.add(w,p),p.A=0}}function Ba(p){return p.g||p.v||p.A>=3?!1:(p.Y++,p.v=oi(m(p.Da,p),xd(p,p.A)),p.A++,!0)}t.Da=function(){if(this.v=null,bd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var p=4*this.T;this.j.info("BP detection timer enabled: "+p),this.B=oi(m(this.Wa,this),p)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Kt(10),As(this),bd(this))};function Ec(p){p.B!=null&&(u.clearTimeout(p.B),p.B=null)}function bd(p){p.g=new Ur(p,p.j,"rpc",p.Y),p.u===null&&(p.g.J=p.o),p.g.P=0;var w=Jt(p.na);gt(w,"RID","rpc"),gt(w,"SID",p.M),gt(w,"AID",p.K),gt(w,"CI",p.F?"0":"1"),!p.F&&p.ia&&gt(w,"TO",p.ia),gt(w,"TYPE","xmlhttp"),La(p,w),p.u&&p.o&&Oa(w,p.u,p.o),p.O&&(p.g.H=p.O);var I=p.g;p=p.ba,I.M=1,I.A=Ia(Jt(w)),I.u=null,I.R=!0,Eo(I,p)}t.Va=function(){this.C!=null&&(this.C=null,As(this),Ba(this),Kt(19))};function ko(p){p.C!=null&&(u.clearTimeout(p.C),p.C=null)}function vd(p,w){var I=null;if(p.g==w){ko(p),Ec(p),p.g=null;var F=2}else if(mi(p.h,w))I=w.G,fc(p.h,w),F=1;else return;if(p.I!=0){if(w.o)if(F==1){I=w.u?w.u.length:0,w=Date.now()-w.F;var le=p.D;F=wo(),Ft(F,new ai(F,I)),bi(p)}else _d(p);else if(le=w.m,le==3||le==0&&w.X>0||!(F==1&&Mo(p,w)||F==2&&Ba(p)))switch(I&&I.length>0&&(w=p.h,w.i=w.i.concat(I)),le){case 1:vi(p,5);break;case 4:vi(p,10);break;case 3:vi(p,6);break;default:vi(p,2)}}}function xd(p,w){let I=p.Qa+Math.floor(Math.random()*p.Za);return p.isActive()||(I*=2),I*w}function vi(p,w){if(p.j.info("Error code "+w),w==2){var I=m(p.bb,p),F=p.Ua;const le=!F;F=new sr(F||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||_n(F,"https"),Ia(F),le?Fr(F.toString(),I):bc(F.toString(),I)}else Kt(2);p.I=0,p.l&&p.l.pa(w),Sd(p),Io(p)}t.bb=function(p){p?(this.j.info("Successfully pinged google.com"),Kt(2)):(this.j.info("Failed to ping google.com"),Kt(1))};function Sd(p){if(p.I=0,p.ja=[],p.l){const w=mc(p.h);(w.length!=0||p.i.length!=0)&&(E(p.ja,w),E(p.ja,p.i),p.h.i.length=0,x(p.i),p.i.length=0),p.l.oa()}}function wd(p,w,I){var F=I instanceof sr?Jt(I):new sr(I);if(F.g!="")w&&(F.g=w+"."+F.g),vs(F,F.u);else{var le=u.location;F=le.protocol,w=w?w+"."+le.hostname:le.hostname,le=+le.port;const fe=new sr(null);F&&_n(fe,F),w&&(fe.g=w),le&&vs(fe,le),I&&(fe.h=I),F=fe}return I=p.G,w=p.wa,I&&w&&gt(F,I,w),gt(F,"VER",p.ka),La(p,F),F}function Ed(p,w,I){if(w&&!p.L)throw Error("Can't create secondary domain capable XhrIo object.");return w=p.Aa&&!p.ma?new bt(new gi({ab:I})):new bt(p.ma),w.Fa(p.L),w}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Cd(){}t=Cd.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function js(){}js.prototype.g=function(p,w){return new Un(p,w)};function Un(p,w){Et.call(this),this.g=new Ts(w),this.l=p,this.h=w&&w.messageUrlParams||null,p=w&&w.messageHeaders||null,w&&w.clientProtocolHeaderRequired&&(p?p["X-Client-Protocol"]="webchannel":p={"X-Client-Protocol":"webchannel"}),this.g.o=p,p=w&&w.initMessageHeaders||null,w&&w.messageContentType&&(p?p["X-WebChannel-Content-Type"]=w.messageContentType:p={"X-WebChannel-Content-Type":w.messageContentType}),w&&w.sa&&(p?p["X-WebChannel-Client-Profile"]=w.sa:p={"X-WebChannel-Client-Profile":w.sa}),this.g.U=p,(p=w&&w.Qb)&&!R(p)&&(this.g.u=p),this.A=w&&w.supportsCrossDomainXhr||!1,this.v=w&&w.sendRawJson||!1,(w=w&&w.httpSessionIdParam)&&!R(w)&&(this.g.G=w,p=this.h,p!==null&&w in p&&(p=this.h,w in p&&delete p[w])),this.j=new Fi(this)}_(Un,Et),Un.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Un.prototype.close=function(){Sc(this.g)},Un.prototype.o=function(p){var w=this.g;if(typeof p=="string"){var I={};I.__data__=p,p=I}else this.v&&(I={},I.__data__=bs(p),p=I);w.i.push(new Xt(w.Ya++,p)),w.I==3&&bi(w)},Un.prototype.N=function(){this.g.l=null,delete this.j,Sc(this.g),delete this.g,Un.Z.N.call(this)};function Td(p){Sn.call(this),p.__headers__&&(this.headers=p.__headers__,this.statusCode=p.__status__,delete p.__headers__,delete p.__status__);var w=p.__sm__;if(w){e:{for(const I in w){p=I;break e}p=void 0}(this.i=p)&&(p=this.i,w=w!==null&&p in w?w[p]:void 0),this.data=w}else this.data=p}_(Td,Sn);function Ad(){_r.call(this),this.status=1}_(Ad,_r);function Fi(p){this.g=p}_(Fi,Cd),Fi.prototype.ra=function(){Ft(this.g,"a")},Fi.prototype.qa=function(p){Ft(this.g,new Td(p))},Fi.prototype.pa=function(p){Ft(this.g,new Ad)},Fi.prototype.oa=function(){Ft(this.g,"b")},js.prototype.createWebChannel=js.prototype.g,Un.prototype.send=Un.prototype.o,Un.prototype.open=Un.prototype.m,Un.prototype.close=Un.prototype.close,_1=function(){return new js},y1=function(){return wo()},g1=$t,iy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ra.NO_ERROR=0,Ra.TIMEOUT=8,Ra.HTTP_ERROR=6,Qh=Ra,lc.COMPLETE="complete",p1=lc,sd.EventType=Br,Br.OPEN="a",Br.CLOSE="b",Br.ERROR="c",Br.MESSAGE="d",Et.prototype.listen=Et.prototype.J,hu=sd,bt.prototype.listenOnce=bt.prototype.K,bt.prototype.getLastError=bt.prototype.Ha,bt.prototype.getLastErrorCode=bt.prototype.ya,bt.prototype.getStatus=bt.prototype.ca,bt.prototype.getResponseJson=bt.prototype.La,bt.prototype.getResponseText=bt.prototype.la,bt.prototype.send=bt.prototype.ea,bt.prototype.setWithCredentials=bt.prototype.Fa,m1=bt}).apply(typeof Oh<"u"?Oh:typeof self<"u"?self:typeof window<"u"?window:{});const hS="@firebase/firestore",fS="4.9.3";class Nn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Nn.UNAUTHENTICATED=new Nn(null),Nn.GOOGLE_CREDENTIALS=new Nn("google-credentials-uid"),Nn.FIRST_PARTY=new Nn("first-party-uid"),Nn.MOCK_USER=new Nn("mock-user");let Yl="12.7.0";const fo=new ky("@firebase/firestore");function pl(){return fo.logLevel}function je(t,...e){if(fo.logLevel<=tt.DEBUG){const n=e.map(Wy);fo.debug(`Firestore (${Yl}): ${t}`,...n)}}function hs(t,...e){if(fo.logLevel<=tt.ERROR){const n=e.map(Wy);fo.error(`Firestore (${Yl}): ${t}`,...n)}}function Rl(t,...e){if(fo.logLevel<=tt.WARN){const n=e.map(Wy);fo.warn(`Firestore (${Yl}): ${t}`,...n)}}function Wy(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function ze(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,b1(t,r,n)}function b1(t,e,n){let r=`FIRESTORE (${Yl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw hs(r),new Error(r)}function pt(t,e,n,r){let a="Unexpected state";typeof n=="string"?a=n:r=n,t||b1(e,a,r)}function qe(t,e){return t}const _e={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ae extends gs{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ls{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class v1{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class wk{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Nn.UNAUTHENTICATED)))}shutdown(){}}class Ek{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class Ck{constructor(e){this.t=e,this.currentUser=Nn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){pt(this.o===void 0,42304);let r=this.i;const a=f=>this.i!==r?(r=this.i,n(f)):Promise.resolve();let o=new ls;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ls,e.enqueueRetryable((()=>a(this.currentUser)))};const u=()=>{const f=o;e.enqueueRetryable((async()=>{await f.promise,await a(this.currentUser)}))},h=f=>{je("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit((f=>h(f))),setTimeout((()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?h(f):(je("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ls)}}),0),u()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(je("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(pt(typeof r.accessToken=="string",31837,{l:r}),new v1(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return pt(e===null||typeof e=="string",2055,{h:e}),new Nn(e)}}class Tk{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Nn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Ak{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new Tk(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Nn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class mS{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class jk{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Yr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){pt(this.o===void 0,3512);const r=o=>{o.error!=null&&je("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const u=o.token!==this.m;return this.m=o.token,je("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const a=o=>{je("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>a(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?a(o):je("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new mS(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(pt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new mS(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Rk(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class Ky{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const a=Rk(40);for(let o=0;o<a.length;++o)r.length<20&&a[o]<n&&(r+=e.charAt(a[o]%62))}return r}}function nt(t,e){return t<e?-1:t>e?1:0}function sy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const a=t.charAt(r),o=e.charAt(r);if(a!==o)return Dg(a)===Dg(o)?nt(a,o):Dg(a)?1:-1}return nt(t.length,e.length)}const Dk=55296,Ik=57343;function Dg(t){const e=t.charCodeAt(0);return e>=Dk&&e<=Ik}function Dl(t,e,n){return t.length===e.length&&t.every(((r,a)=>n(r,e[a])))}const pS="__name__";class Ai{constructor(e,n,r){n===void 0?n=0:n>e.length&&ze(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&ze(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Ai.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Ai?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let a=0;a<r;a++){const o=Ai.compareSegments(e.get(a),n.get(a));if(o!==0)return o}return nt(e.length,n.length)}static compareSegments(e,n){const r=Ai.isNumericId(e),a=Ai.isNumericId(n);return r&&!a?-1:!r&&a?1:r&&a?Ai.extractNumericId(e).compare(Ai.extractNumericId(n)):sy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ua.fromString(e.substring(4,e.length-2))}}class At extends Ai{construct(e,n,r){return new At(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ae(_e.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((a=>a.length>0)))}return new At(n)}static emptyPath(){return new At([])}}const Mk=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Rn extends Ai{construct(e,n,r){return new Rn(e,n,r)}static isValidIdentifier(e){return Mk.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Rn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===pS}static keyField(){return new Rn([pS])}static fromServerFormat(e){const n=[];let r="",a=0;const o=()=>{if(r.length===0)throw new Ae(_e.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let u=!1;for(;a<e.length;){const h=e[a];if(h==="\\"){if(a+1===e.length)throw new Ae(_e.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[a+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new Ae(_e.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=f,a+=2}else h==="`"?(u=!u,a++):h!=="."||u?(r+=h,a++):(o(),a++)}if(o(),u)throw new Ae(_e.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Rn(n)}static emptyPath(){return new Rn([])}}class Ne{constructor(e){this.path=e}static fromPath(e){return new Ne(At.fromString(e))}static fromName(e){return new Ne(At.fromString(e).popFirst(5))}static empty(){return new Ne(At.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&At.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return At.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ne(new At(e.slice()))}}function x1(t,e,n){if(!n)throw new Ae(_e.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function kk(t,e,n,r){if(e===!0&&r===!0)throw new Ae(_e.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function gS(t){if(!Ne.isDocumentKey(t))throw new Ae(_e.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function yS(t){if(Ne.isDocumentKey(t))throw new Ae(_e.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function S1(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Ff(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ze(12329,{type:typeof t})}function ti(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ae(_e.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Ff(t);throw new Ae(_e.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function an(t,e){const n={typeString:t};return e&&(n.value=e),n}function Hu(t,e){if(!S1(t))throw new Ae(_e.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const a=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const u=t[r];if(a&&typeof u!==a){n=`JSON field '${r}' must be a ${a}.`;break}if(o!==void 0&&u!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Ae(_e.INVALID_ARGUMENT,n);return!0}const _S=-62135596800,bS=1e6;class Dt{static now(){return Dt.fromMillis(Date.now())}static fromDate(e){return Dt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*bS);return new Dt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Ae(_e.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Ae(_e.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<_S)throw new Ae(_e.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ae(_e.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/bS}_compareTo(e){return this.seconds===e.seconds?nt(this.nanoseconds,e.nanoseconds):nt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Dt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Hu(e,Dt._jsonSchema))return new Dt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-_S;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Dt._jsonSchemaVersion="firestore/timestamp/1.0",Dt._jsonSchema={type:an("string",Dt._jsonSchemaVersion),seconds:an("number"),nanoseconds:an("number")};class Fe{static fromTimestamp(e){return new Fe(e)}static min(){return new Fe(new Dt(0,0))}static max(){return new Fe(new Dt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Au=-1;function Ok(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,a=Fe.fromTimestamp(r===1e9?new Dt(n+1,0):new Dt(n,r));return new fa(a,Ne.empty(),e)}function Nk(t){return new fa(t.readTime,t.key,Au)}class fa{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new fa(Fe.min(),Ne.empty(),Au)}static max(){return new fa(Fe.max(),Ne.empty(),Au)}}function Pk(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Ne.comparator(t.documentKey,e.documentKey),n!==0?n:nt(t.largestBatchId,e.largestBatchId))}const Lk="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Bk{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Xl(t){if(t.code!==_e.FAILED_PRECONDITION||t.message!==Lk)throw t;je("LocalStore","Unexpectedly lost primary lease")}class xe{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ze(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new xe(((r,a)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,a)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,a)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof xe?n:xe.resolve(n)}catch(n){return xe.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):xe.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):xe.reject(n)}static resolve(e){return new xe(((n,r)=>{n(e)}))}static reject(e){return new xe(((n,r)=>{r(e)}))}static waitFor(e){return new xe(((n,r)=>{let a=0,o=0,u=!1;e.forEach((h=>{++a,h.next((()=>{++o,u&&o===a&&n()}),(f=>r(f)))})),u=!0,o===a&&n()}))}static or(e){let n=xe.resolve(!1);for(const r of e)n=n.next((a=>a?xe.resolve(a):r()));return n}static forEach(e,n){const r=[];return e.forEach(((a,o)=>{r.push(n.call(this,a,o))})),this.waitFor(r)}static mapArray(e,n){return new xe(((r,a)=>{const o=e.length,u=new Array(o);let h=0;for(let f=0;f<o;f++){const m=f;n(e[m]).next((g=>{u[m]=g,++h,h===o&&r(u)}),(g=>a(g)))}}))}static doWhile(e,n){return new xe(((r,a)=>{const o=()=>{e()===!0?n().next((()=>{o()}),a):r()};o()}))}}function zk(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Jl(t){return t.name==="IndexedDbTransactionError"}class $f{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}$f.ce=-1;const Yy=-1;function qf(t){return t==null}function ff(t){return t===0&&1/t==-1/0}function Uk(t){return typeof t=="number"&&Number.isInteger(t)&&!ff(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const w1="";function Vk(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=vS(e)),e=Fk(t.get(n),e);return vS(e)}function Fk(t,e){let n=e;const r=t.length;for(let a=0;a<r;a++){const o=t.charAt(a);switch(o){case"\0":n+="";break;case w1:n+="";break;default:n+=o}}return n}function vS(t){return t+w1+""}function xS(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Sa(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function E1(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class zt{constructor(e,n){this.comparator=e,this.root=n||jn.EMPTY}insert(e,n){return new zt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,jn.BLACK,null,null))}remove(e){return new zt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,jn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const a=this.comparator(e,r.key);if(a===0)return n+r.left.size;a<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Nh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Nh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Nh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Nh(this.root,e,this.comparator,!0)}}class Nh{constructor(e,n,r,a){this.isReverse=a,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&a&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class jn{constructor(e,n,r,a,o){this.key=e,this.value=n,this.color=r??jn.RED,this.left=a??jn.EMPTY,this.right=o??jn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,a,o){return new jn(e??this.key,n??this.value,r??this.color,a??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let a=this;const o=r(e,a.key);return a=o<0?a.copy(null,null,null,a.left.insert(e,n,r),null):o===0?a.copy(null,n,null,null,null):a.copy(null,null,null,null,a.right.insert(e,n,r)),a.fixUp()}removeMin(){if(this.left.isEmpty())return jn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,a=this;if(n(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,n),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),n(e,a.key)===0){if(a.right.isEmpty())return jn.EMPTY;r=a.right.min(),a=a.copy(r.key,r.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,n))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,jn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,jn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ze(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ze(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ze(27949);return e+(this.isRed()?0:1)}}jn.EMPTY=null,jn.RED=!0,jn.BLACK=!1;jn.EMPTY=new class{constructor(){this.size=0}get key(){throw ze(57766)}get value(){throw ze(16141)}get color(){throw ze(16727)}get left(){throw ze(29726)}get right(){throw ze(36894)}copy(e,n,r,a,o){return this}insert(e,n,r){return new jn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class mn{constructor(e){this.comparator=e,this.data=new zt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const a=r.getNext();if(this.comparator(a.key,e[1])>=0)return;n(a.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new SS(this.data.getIterator())}getIteratorFrom(e){return new SS(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof mn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const a=n.getNext().key,o=r.getNext().key;if(this.comparator(a,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new mn(this.comparator);return n.data=e,n}}class SS{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class fr{constructor(e){this.fields=e,e.sort(Rn.comparator)}static empty(){return new fr([])}unionWith(e){let n=new mn(Rn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new fr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Dl(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class C1 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class In{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(a){try{return atob(a)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new C1("Invalid base64 string: "+o):o}})(e);return new In(n)}static fromUint8Array(e){const n=(function(a){let o="";for(let u=0;u<a.length;++u)o+=String.fromCharCode(a[u]);return o})(e);return new In(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let a=0;a<n.length;a++)r[a]=n.charCodeAt(a);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return nt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}In.EMPTY_BYTE_STRING=new In("");const $k=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ma(t){if(pt(!!t,39018),typeof t=="string"){let e=0;const n=$k.exec(t);if(pt(!!n,46558,{timestamp:t}),n[1]){let a=n[1];a=(a+"000000000").substr(0,9),e=Number(a)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Qt(t.seconds),nanos:Qt(t.nanos)}}function Qt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function pa(t){return typeof t=="string"?In.fromBase64String(t):In.fromUint8Array(t)}const T1="server_timestamp",A1="__type__",j1="__previous_value__",R1="__local_write_time__";function Xy(t){return(t?.mapValue?.fields||{})[A1]?.stringValue===T1}function Hf(t){const e=t.mapValue.fields[j1];return Xy(e)?Hf(e):e}function ju(t){const e=ma(t.mapValue.fields[R1].timestampValue);return new Dt(e.seconds,e.nanos)}class qk{constructor(e,n,r,a,o,u,h,f,m,g){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=a,this.ssl=o,this.forceLongPolling=u,this.autoDetectLongPolling=h,this.longPollingOptions=f,this.useFetchStreams=m,this.isUsingEmulator=g}}const mf="(default)";class Ru{constructor(e,n){this.projectId=e,this.database=n||mf}static empty(){return new Ru("","")}get isDefaultDatabase(){return this.database===mf}isEqual(e){return e instanceof Ru&&e.projectId===this.projectId&&e.database===this.database}}const D1="__type__",Hk="__max__",Ph={mapValue:{}},I1="__vector__",pf="value";function ga(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Xy(t)?4:Qk(t)?9007199254740991:Gk(t)?10:11:ze(28295,{value:t})}function Ni(t,e){if(t===e)return!0;const n=ga(t);if(n!==ga(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ju(t).isEqual(ju(e));case 3:return(function(a,o){if(typeof a.timestampValue=="string"&&typeof o.timestampValue=="string"&&a.timestampValue.length===o.timestampValue.length)return a.timestampValue===o.timestampValue;const u=ma(a.timestampValue),h=ma(o.timestampValue);return u.seconds===h.seconds&&u.nanos===h.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(a,o){return pa(a.bytesValue).isEqual(pa(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(a,o){return Qt(a.geoPointValue.latitude)===Qt(o.geoPointValue.latitude)&&Qt(a.geoPointValue.longitude)===Qt(o.geoPointValue.longitude)})(t,e);case 2:return(function(a,o){if("integerValue"in a&&"integerValue"in o)return Qt(a.integerValue)===Qt(o.integerValue);if("doubleValue"in a&&"doubleValue"in o){const u=Qt(a.doubleValue),h=Qt(o.doubleValue);return u===h?ff(u)===ff(h):isNaN(u)&&isNaN(h)}return!1})(t,e);case 9:return Dl(t.arrayValue.values||[],e.arrayValue.values||[],Ni);case 10:case 11:return(function(a,o){const u=a.mapValue.fields||{},h=o.mapValue.fields||{};if(xS(u)!==xS(h))return!1;for(const f in u)if(u.hasOwnProperty(f)&&(h[f]===void 0||!Ni(u[f],h[f])))return!1;return!0})(t,e);default:return ze(52216,{left:t})}}function Du(t,e){return(t.values||[]).find((n=>Ni(n,e)))!==void 0}function Il(t,e){if(t===e)return 0;const n=ga(t),r=ga(e);if(n!==r)return nt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return nt(t.booleanValue,e.booleanValue);case 2:return(function(o,u){const h=Qt(o.integerValue||o.doubleValue),f=Qt(u.integerValue||u.doubleValue);return h<f?-1:h>f?1:h===f?0:isNaN(h)?isNaN(f)?0:-1:1})(t,e);case 3:return wS(t.timestampValue,e.timestampValue);case 4:return wS(ju(t),ju(e));case 5:return sy(t.stringValue,e.stringValue);case 6:return(function(o,u){const h=pa(o),f=pa(u);return h.compareTo(f)})(t.bytesValue,e.bytesValue);case 7:return(function(o,u){const h=o.split("/"),f=u.split("/");for(let m=0;m<h.length&&m<f.length;m++){const g=nt(h[m],f[m]);if(g!==0)return g}return nt(h.length,f.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,u){const h=nt(Qt(o.latitude),Qt(u.latitude));return h!==0?h:nt(Qt(o.longitude),Qt(u.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return ES(t.arrayValue,e.arrayValue);case 10:return(function(o,u){const h=o.fields||{},f=u.fields||{},m=h[pf]?.arrayValue,g=f[pf]?.arrayValue,_=nt(m?.values?.length||0,g?.values?.length||0);return _!==0?_:ES(m,g)})(t.mapValue,e.mapValue);case 11:return(function(o,u){if(o===Ph.mapValue&&u===Ph.mapValue)return 0;if(o===Ph.mapValue)return 1;if(u===Ph.mapValue)return-1;const h=o.fields||{},f=Object.keys(h),m=u.fields||{},g=Object.keys(m);f.sort(),g.sort();for(let _=0;_<f.length&&_<g.length;++_){const b=sy(f[_],g[_]);if(b!==0)return b;const x=Il(h[f[_]],m[g[_]]);if(x!==0)return x}return nt(f.length,g.length)})(t.mapValue,e.mapValue);default:throw ze(23264,{he:n})}}function wS(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return nt(t,e);const n=ma(t),r=ma(e),a=nt(n.seconds,r.seconds);return a!==0?a:nt(n.nanos,r.nanos)}function ES(t,e){const n=t.values||[],r=e.values||[];for(let a=0;a<n.length&&a<r.length;++a){const o=Il(n[a],r[a]);if(o)return o}return nt(n.length,r.length)}function Ml(t){return ay(t)}function ay(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=ma(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return pa(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return Ne.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",a=!0;for(const o of n.values||[])a?a=!1:r+=",",r+=ay(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let a="{",o=!0;for(const u of r)o?o=!1:a+=",",a+=`${u}:${ay(n.fields[u])}`;return a+"}"})(t.mapValue):ze(61005,{value:t})}function Wh(t){switch(ga(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Hf(t);return e?16+Wh(e):16;case 5:return 2*t.stringValue.length;case 6:return pa(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((a,o)=>a+Wh(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let a=0;return Sa(r.fields,((o,u)=>{a+=o.length+Wh(u)})),a})(t.mapValue);default:throw ze(13486,{value:t})}}function CS(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function oy(t){return!!t&&"integerValue"in t}function Jy(t){return!!t&&"arrayValue"in t}function TS(t){return!!t&&"nullValue"in t}function AS(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Kh(t){return!!t&&"mapValue"in t}function Gk(t){return(t?.mapValue?.fields||{})[D1]?.stringValue===I1}function _u(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Sa(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=_u(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=_u(t.arrayValue.values[n]);return e}return{...t}}function Qk(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===Hk}class er{constructor(e){this.value=e}static empty(){return new er({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Kh(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=_u(n)}setAll(e){let n=Rn.emptyPath(),r={},a=[];e.forEach(((u,h)=>{if(!n.isImmediateParentOf(h)){const f=this.getFieldsMap(n);this.applyChanges(f,r,a),r={},a=[],n=h.popLast()}u?r[h.lastSegment()]=_u(u):a.push(h.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,a)}delete(e){const n=this.field(e.popLast());Kh(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Ni(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let a=n.mapValue.fields[e.get(r)];Kh(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=a),n=a}return n.mapValue.fields}applyChanges(e,n,r){Sa(n,((a,o)=>e[a]=o));for(const a of r)delete e[a]}clone(){return new er(_u(this.value))}}function M1(t){const e=[];return Sa(t.fields,((n,r)=>{const a=new Rn([n]);if(Kh(r)){const o=M1(r.mapValue).fields;if(o.length===0)e.push(a);else for(const u of o)e.push(a.child(u))}else e.push(a)})),new fr(e)}class Pn{constructor(e,n,r,a,o,u,h){this.key=e,this.documentType=n,this.version=r,this.readTime=a,this.createTime=o,this.data=u,this.documentState=h}static newInvalidDocument(e){return new Pn(e,0,Fe.min(),Fe.min(),Fe.min(),er.empty(),0)}static newFoundDocument(e,n,r,a){return new Pn(e,1,n,Fe.min(),r,a,0)}static newNoDocument(e,n){return new Pn(e,2,n,Fe.min(),Fe.min(),er.empty(),0)}static newUnknownDocument(e,n){return new Pn(e,3,n,Fe.min(),Fe.min(),er.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Fe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=er.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=er.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Fe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Pn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Pn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class gf{constructor(e,n){this.position=e,this.inclusive=n}}function jS(t,e,n){let r=0;for(let a=0;a<t.position.length;a++){const o=e[a],u=t.position[a];if(o.field.isKeyField()?r=Ne.comparator(Ne.fromName(u.referenceValue),n.key):r=Il(u,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function RS(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ni(t.position[n],e.position[n]))return!1;return!0}class yf{constructor(e,n="asc"){this.field=e,this.dir=n}}function Wk(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class k1{}class sn extends k1{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new Yk(e,n,r):n==="array-contains"?new Zk(e,r):n==="in"?new eO(e,r):n==="not-in"?new tO(e,r):n==="array-contains-any"?new nO(e,r):new sn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new Xk(e,r):new Jk(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Il(n,this.value)):n!==null&&ga(this.value)===ga(n)&&this.matchesComparison(Il(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ze(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ni extends k1{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ni(e,n)}matches(e){return O1(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function O1(t){return t.op==="and"}function N1(t){return Kk(t)&&O1(t)}function Kk(t){for(const e of t.filters)if(e instanceof ni)return!1;return!0}function ly(t){if(t instanceof sn)return t.field.canonicalString()+t.op.toString()+Ml(t.value);if(N1(t))return t.filters.map((e=>ly(e))).join(",");{const e=t.filters.map((n=>ly(n))).join(",");return`${t.op}(${e})`}}function P1(t,e){return t instanceof sn?(function(r,a){return a instanceof sn&&r.op===a.op&&r.field.isEqual(a.field)&&Ni(r.value,a.value)})(t,e):t instanceof ni?(function(r,a){return a instanceof ni&&r.op===a.op&&r.filters.length===a.filters.length?r.filters.reduce(((o,u,h)=>o&&P1(u,a.filters[h])),!0):!1})(t,e):void ze(19439)}function L1(t){return t instanceof sn?(function(n){return`${n.field.canonicalString()} ${n.op} ${Ml(n.value)}`})(t):t instanceof ni?(function(n){return n.op.toString()+" {"+n.getFilters().map(L1).join(" ,")+"}"})(t):"Filter"}class Yk extends sn{constructor(e,n,r){super(e,n,r),this.key=Ne.fromName(r.referenceValue)}matches(e){const n=Ne.comparator(e.key,this.key);return this.matchesComparison(n)}}class Xk extends sn{constructor(e,n){super(e,"in",n),this.keys=B1("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class Jk extends sn{constructor(e,n){super(e,"not-in",n),this.keys=B1("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function B1(t,e){return(e.arrayValue?.values||[]).map((n=>Ne.fromName(n.referenceValue)))}class Zk extends sn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Jy(n)&&Du(n.arrayValue,this.value)}}class eO extends sn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Du(this.value.arrayValue,n)}}class tO extends sn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Du(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Du(this.value.arrayValue,n)}}class nO extends sn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Jy(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Du(this.value.arrayValue,r)))}}class rO{constructor(e,n=null,r=[],a=[],o=null,u=null,h=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=a,this.limit=o,this.startAt=u,this.endAt=h,this.Te=null}}function DS(t,e=null,n=[],r=[],a=null,o=null,u=null){return new rO(t,e,n,r,a,o,u)}function Zy(t){const e=qe(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>ly(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),qf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>Ml(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>Ml(r))).join(",")),e.Te=n}return e.Te}function e0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Wk(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!P1(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!RS(t.startAt,e.startAt)&&RS(t.endAt,e.endAt)}function cy(t){return Ne.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class Gu{constructor(e,n=null,r=[],a=[],o=null,u="F",h=null,f=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=a,this.limit=o,this.limitType=u,this.startAt=h,this.endAt=f,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function iO(t,e,n,r,a,o,u,h){return new Gu(t,e,n,r,a,o,u,h)}function t0(t){return new Gu(t)}function IS(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function z1(t){return t.collectionGroup!==null}function bu(t){const e=qe(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(u){let h=new mn(Rn.comparator);return u.filters.forEach((f=>{f.getFlattenedFilters().forEach((m=>{m.isInequality()&&(h=h.add(m.field))}))})),h})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new yf(o,r))})),n.has(Rn.keyField().canonicalString())||e.Ie.push(new yf(Rn.keyField(),r))}return e.Ie}function Ii(t){const e=qe(t);return e.Ee||(e.Ee=sO(e,bu(t))),e.Ee}function sO(t,e){if(t.limitType==="F")return DS(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((a=>{const o=a.dir==="desc"?"asc":"desc";return new yf(a.field,o)}));const n=t.endAt?new gf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new gf(t.startAt.position,t.startAt.inclusive):null;return DS(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function uy(t,e){const n=t.filters.concat([e]);return new Gu(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function dy(t,e,n){return new Gu(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Gf(t,e){return e0(Ii(t),Ii(e))&&t.limitType===e.limitType}function U1(t){return`${Zy(Ii(t))}|lt:${t.limitType}`}function gl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((a=>L1(a))).join(", ")}]`),qf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((a=>(function(u){return`${u.field.canonicalString()} (${u.dir})`})(a))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((a=>Ml(a))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((a=>Ml(a))).join(",")),`Target(${r})`})(Ii(t))}; limitType=${t.limitType})`}function Qf(t,e){return e.isFoundDocument()&&(function(r,a){const o=a.key.path;return r.collectionGroup!==null?a.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):Ne.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,a){for(const o of bu(r))if(!o.field.isKeyField()&&a.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,a){for(const o of r.filters)if(!o.matches(a))return!1;return!0})(t,e)&&(function(r,a){return!(r.startAt&&!(function(u,h,f){const m=jS(u,h,f);return u.inclusive?m<=0:m<0})(r.startAt,bu(r),a)||r.endAt&&!(function(u,h,f){const m=jS(u,h,f);return u.inclusive?m>=0:m>0})(r.endAt,bu(r),a))})(t,e)}function aO(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function V1(t){return(e,n)=>{let r=!1;for(const a of bu(t)){const o=oO(a,e,n);if(o!==0)return o;r=r||a.field.isKeyField()}return 0}}function oO(t,e,n){const r=t.field.isKeyField()?Ne.comparator(e.key,n.key):(function(o,u,h){const f=u.data.field(o),m=h.data.field(o);return f!==null&&m!==null?Il(f,m):ze(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ze(19790,{direction:t.dir})}}class yo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[a,o]of r)if(this.equalsFn(a,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),a=this.inner[r];if(a===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<a.length;o++)if(this.equalsFn(a[o][0],e))return void(a[o]=[e,n]);a.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let a=0;a<r.length;a++)if(this.equalsFn(r[a][0],e))return r.length===1?delete this.inner[n]:r.splice(a,1),this.innerSize--,!0;return!1}forEach(e){Sa(this.inner,((n,r)=>{for(const[a,o]of r)e(a,o)}))}isEmpty(){return E1(this.inner)}size(){return this.innerSize}}const lO=new zt(Ne.comparator);function fs(){return lO}const F1=new zt(Ne.comparator);function fu(...t){let e=F1;for(const n of t)e=e.insert(n.key,n);return e}function $1(t){let e=F1;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function so(){return vu()}function q1(){return vu()}function vu(){return new yo((t=>t.toString()),((t,e)=>t.isEqual(e)))}const cO=new zt(Ne.comparator),uO=new mn(Ne.comparator);function rt(...t){let e=uO;for(const n of t)e=e.add(n);return e}const dO=new mn(nt);function hO(){return dO}function n0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ff(e)?"-0":e}}function H1(t){return{integerValue:""+t}}function fO(t,e){return Uk(e)?H1(e):n0(t,e)}class Wf{constructor(){this._=void 0}}function mO(t,e,n){return t instanceof _f?(function(a,o){const u={fields:{[A1]:{stringValue:T1},[R1]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return o&&Xy(o)&&(o=Hf(o)),o&&(u.fields[j1]=o),{mapValue:u}})(n,e):t instanceof kl?Q1(t,e):t instanceof Iu?W1(t,e):(function(a,o){const u=G1(a,o),h=MS(u)+MS(a.Ae);return oy(u)&&oy(a.Ae)?H1(h):n0(a.serializer,h)})(t,e)}function pO(t,e,n){return t instanceof kl?Q1(t,e):t instanceof Iu?W1(t,e):n}function G1(t,e){return t instanceof bf?(function(r){return oy(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class _f extends Wf{}class kl extends Wf{constructor(e){super(),this.elements=e}}function Q1(t,e){const n=K1(e);for(const r of t.elements)n.some((a=>Ni(a,r)))||n.push(r);return{arrayValue:{values:n}}}class Iu extends Wf{constructor(e){super(),this.elements=e}}function W1(t,e){let n=K1(e);for(const r of t.elements)n=n.filter((a=>!Ni(a,r)));return{arrayValue:{values:n}}}class bf extends Wf{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function MS(t){return Qt(t.integerValue||t.doubleValue)}function K1(t){return Jy(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class gO{constructor(e,n){this.field=e,this.transform=n}}function yO(t,e){return t.field.isEqual(e.field)&&(function(r,a){return r instanceof kl&&a instanceof kl||r instanceof Iu&&a instanceof Iu?Dl(r.elements,a.elements,Ni):r instanceof bf&&a instanceof bf?Ni(r.Ae,a.Ae):r instanceof _f&&a instanceof _f})(t.transform,e.transform)}class _O{constructor(e,n){this.version=e,this.transformResults=n}}class tr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new tr}static exists(e){return new tr(void 0,e)}static updateTime(e){return new tr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Yh(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Kf{}function Y1(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Yf(t.key,tr.none()):new Qu(t.key,t.data,tr.none());{const n=t.data,r=er.empty();let a=new mn(Rn.comparator);for(let o of e.fields)if(!a.has(o)){let u=n.field(o);u===null&&o.length>1&&(o=o.popLast(),u=n.field(o)),u===null?r.delete(o):r.set(o,u),a=a.add(o)}return new wa(t.key,r,new fr(a.toArray()),tr.none())}}function bO(t,e,n){t instanceof Qu?(function(a,o,u){const h=a.value.clone(),f=OS(a.fieldTransforms,o,u.transformResults);h.setAll(f),o.convertToFoundDocument(u.version,h).setHasCommittedMutations()})(t,e,n):t instanceof wa?(function(a,o,u){if(!Yh(a.precondition,o))return void o.convertToUnknownDocument(u.version);const h=OS(a.fieldTransforms,o,u.transformResults),f=o.data;f.setAll(X1(a)),f.setAll(h),o.convertToFoundDocument(u.version,f).setHasCommittedMutations()})(t,e,n):(function(a,o,u){o.convertToNoDocument(u.version).setHasCommittedMutations()})(0,e,n)}function xu(t,e,n,r){return t instanceof Qu?(function(o,u,h,f){if(!Yh(o.precondition,u))return h;const m=o.value.clone(),g=NS(o.fieldTransforms,f,u);return m.setAll(g),u.convertToFoundDocument(u.version,m).setHasLocalMutations(),null})(t,e,n,r):t instanceof wa?(function(o,u,h,f){if(!Yh(o.precondition,u))return h;const m=NS(o.fieldTransforms,f,u),g=u.data;return g.setAll(X1(o)),g.setAll(m),u.convertToFoundDocument(u.version,g).setHasLocalMutations(),h===null?null:h.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((_=>_.field)))})(t,e,n,r):(function(o,u,h){return Yh(o.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):h})(t,e,n)}function vO(t,e){let n=null;for(const r of t.fieldTransforms){const a=e.data.field(r.field),o=G1(r.transform,a||null);o!=null&&(n===null&&(n=er.empty()),n.set(r.field,o))}return n||null}function kS(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,a){return r===void 0&&a===void 0||!(!r||!a)&&Dl(r,a,((o,u)=>yO(o,u)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Qu extends Kf{constructor(e,n,r,a=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class wa extends Kf{constructor(e,n,r,a,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=a,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function X1(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function OS(t,e,n){const r=new Map;pt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let a=0;a<n.length;a++){const o=t[a],u=o.transform,h=e.data.field(o.field);r.set(o.field,pO(u,h,n[a]))}return r}function NS(t,e,n){const r=new Map;for(const a of t){const o=a.transform,u=n.data.field(a.field);r.set(a.field,mO(o,u,e))}return r}class Yf extends Kf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class xO extends Kf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class SO{constructor(e,n,r,a){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=a}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let a=0;a<this.mutations.length;a++){const o=this.mutations[a];o.key.isEqual(e.key)&&bO(o,e,r[a])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=xu(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=xu(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=q1();return this.mutations.forEach((a=>{const o=e.get(a.key),u=o.overlayedDocument;let h=this.applyToLocalView(u,o.mutatedFields);h=n.has(a.key)?null:h;const f=Y1(u,h);f!==null&&r.set(a.key,f),u.isValidDocument()||u.convertToNoDocument(Fe.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),rt())}isEqual(e){return this.batchId===e.batchId&&Dl(this.mutations,e.mutations,((n,r)=>kS(n,r)))&&Dl(this.baseMutations,e.baseMutations,((n,r)=>kS(n,r)))}}class r0{constructor(e,n,r,a){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=a}static from(e,n,r){pt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let a=(function(){return cO})();const o=e.mutations;for(let u=0;u<o.length;u++)a=a.insert(o[u].key,r[u].version);return new r0(e,n,r,a)}}class wO{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class EO{constructor(e,n){this.count=e,this.unchangedNames=n}}var rn,st;function CO(t){switch(t){case _e.OK:return ze(64938);case _e.CANCELLED:case _e.UNKNOWN:case _e.DEADLINE_EXCEEDED:case _e.RESOURCE_EXHAUSTED:case _e.INTERNAL:case _e.UNAVAILABLE:case _e.UNAUTHENTICATED:return!1;case _e.INVALID_ARGUMENT:case _e.NOT_FOUND:case _e.ALREADY_EXISTS:case _e.PERMISSION_DENIED:case _e.FAILED_PRECONDITION:case _e.ABORTED:case _e.OUT_OF_RANGE:case _e.UNIMPLEMENTED:case _e.DATA_LOSS:return!0;default:return ze(15467,{code:t})}}function J1(t){if(t===void 0)return hs("GRPC error has no .code"),_e.UNKNOWN;switch(t){case rn.OK:return _e.OK;case rn.CANCELLED:return _e.CANCELLED;case rn.UNKNOWN:return _e.UNKNOWN;case rn.DEADLINE_EXCEEDED:return _e.DEADLINE_EXCEEDED;case rn.RESOURCE_EXHAUSTED:return _e.RESOURCE_EXHAUSTED;case rn.INTERNAL:return _e.INTERNAL;case rn.UNAVAILABLE:return _e.UNAVAILABLE;case rn.UNAUTHENTICATED:return _e.UNAUTHENTICATED;case rn.INVALID_ARGUMENT:return _e.INVALID_ARGUMENT;case rn.NOT_FOUND:return _e.NOT_FOUND;case rn.ALREADY_EXISTS:return _e.ALREADY_EXISTS;case rn.PERMISSION_DENIED:return _e.PERMISSION_DENIED;case rn.FAILED_PRECONDITION:return _e.FAILED_PRECONDITION;case rn.ABORTED:return _e.ABORTED;case rn.OUT_OF_RANGE:return _e.OUT_OF_RANGE;case rn.UNIMPLEMENTED:return _e.UNIMPLEMENTED;case rn.DATA_LOSS:return _e.DATA_LOSS;default:return ze(39323,{code:t})}}(st=rn||(rn={}))[st.OK=0]="OK",st[st.CANCELLED=1]="CANCELLED",st[st.UNKNOWN=2]="UNKNOWN",st[st.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",st[st.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",st[st.NOT_FOUND=5]="NOT_FOUND",st[st.ALREADY_EXISTS=6]="ALREADY_EXISTS",st[st.PERMISSION_DENIED=7]="PERMISSION_DENIED",st[st.UNAUTHENTICATED=16]="UNAUTHENTICATED",st[st.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",st[st.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",st[st.ABORTED=10]="ABORTED",st[st.OUT_OF_RANGE=11]="OUT_OF_RANGE",st[st.UNIMPLEMENTED=12]="UNIMPLEMENTED",st[st.INTERNAL=13]="INTERNAL",st[st.UNAVAILABLE=14]="UNAVAILABLE",st[st.DATA_LOSS=15]="DATA_LOSS";function TO(){return new TextEncoder}const AO=new ua([4294967295,4294967295],0);function PS(t){const e=TO().encode(t),n=new f1;return n.update(e),new Uint8Array(n.digest())}function LS(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),a=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new ua([n,r],0),new ua([a,o],0)]}class i0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new mu(`Invalid padding: ${n}`);if(r<0)throw new mu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new mu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new mu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=ua.fromNumber(this.ge)}ye(e,n,r){let a=e.add(n.multiply(ua.fromNumber(r)));return a.compare(AO)===1&&(a=new ua([a.getBits(0),a.getBits(1)],0)),a.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=PS(e),[r,a]=LS(n);for(let o=0;o<this.hashCount;o++){const u=this.ye(r,a,o);if(!this.we(u))return!1}return!0}static create(e,n,r){const a=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),u=new i0(o,a,n);return r.forEach((h=>u.insert(h))),u}insert(e){if(this.ge===0)return;const n=PS(e),[r,a]=LS(n);for(let o=0;o<this.hashCount;o++){const u=this.ye(r,a,o);this.Se(u)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class mu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Xf{constructor(e,n,r,a,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=a,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const a=new Map;return a.set(e,Wu.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new Xf(Fe.min(),a,new zt(nt),fs(),rt())}}class Wu{constructor(e,n,r,a,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=a,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Wu(r,n,rt(),rt(),rt())}}class Xh{constructor(e,n,r,a){this.be=e,this.removedTargetIds=n,this.key=r,this.De=a}}class Z1{constructor(e,n){this.targetId=e,this.Ce=n}}class eC{constructor(e,n,r=In.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=a}}class BS{constructor(){this.ve=0,this.Fe=zS(),this.Me=In.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=rt(),n=rt(),r=rt();return this.Fe.forEach(((a,o)=>{switch(o){case 0:e=e.add(a);break;case 2:n=n.add(a);break;case 1:r=r.add(a);break;default:ze(38017,{changeType:o})}})),new Wu(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=zS()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,pt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class jO{constructor(e){this.Ge=e,this.ze=new Map,this.je=fs(),this.Je=Lh(),this.He=Lh(),this.Ye=new zt(nt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:ze(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,a)=>{this.rt(a)&&n(a)}))}st(e){const n=e.targetId,r=e.Ce.count,a=this.ot(n);if(a){const o=a.target;if(cy(o))if(r===0){const u=new Ne(o.path);this.et(n,u,Pn.newNoDocument(u,Fe.min()))}else pt(r===1,20013,{expectedCount:r});else{const u=this._t(n);if(u!==r){const h=this.ut(e),f=h?this.ct(h,e,u):1;if(f!==0){this.it(n);const m=f===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,m)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:a=0},hashCount:o=0}=n;let u,h;try{u=pa(r).toUint8Array()}catch(f){if(f instanceof C1)return Rl("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{h=new i0(u,a,o)}catch(f){return Rl(f instanceof mu?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return h.ge===0?null:h}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let a=0;return r.forEach((o=>{const u=this.Ge.ht(),h=`projects/${u.projectId}/databases/${u.database}/documents/${o.path.canonicalString()}`;e.mightContain(h)||(this.et(n,o,null),a++)})),a}Tt(e){const n=new Map;this.ze.forEach(((o,u)=>{const h=this.ot(u);if(h){if(o.current&&cy(h.target)){const f=new Ne(h.target.path);this.It(f).has(u)||this.Et(u,f)||this.et(u,f,Pn.newNoDocument(f,e))}o.Be&&(n.set(u,o.ke()),o.qe())}}));let r=rt();this.He.forEach(((o,u)=>{let h=!0;u.forEachWhile((f=>{const m=this.ot(f);return!m||m.purpose==="TargetPurposeLimboResolution"||(h=!1,!1)})),h&&(r=r.add(o))})),this.je.forEach(((o,u)=>u.setReadTime(e)));const a=new Xf(e,n,this.Ye,this.je,r);return this.je=fs(),this.Je=Lh(),this.He=Lh(),this.Ye=new zt(nt),a}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const a=this.nt(e);this.Et(e,n)?a.Qe(n,1):a.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new BS,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new mn(nt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new mn(nt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||je("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new BS),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Lh(){return new zt(Ne.comparator)}function zS(){return new zt(Ne.comparator)}const RO={asc:"ASCENDING",desc:"DESCENDING"},DO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},IO={and:"AND",or:"OR"};class MO{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function hy(t,e){return t.useProto3Json||qf(e)?e:{value:e}}function vf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function tC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function kO(t,e){return vf(t,e.toTimestamp())}function Mi(t){return pt(!!t,49232),Fe.fromTimestamp((function(n){const r=ma(n);return new Dt(r.seconds,r.nanos)})(t))}function s0(t,e){return fy(t,e).canonicalString()}function fy(t,e){const n=(function(a){return new At(["projects",a.projectId,"databases",a.database])})(t).child("documents");return e===void 0?n:n.child(e)}function nC(t){const e=At.fromString(t);return pt(oC(e),10190,{key:e.toString()}),e}function my(t,e){return s0(t.databaseId,e.path)}function Ig(t,e){const n=nC(e);if(n.get(1)!==t.databaseId.projectId)throw new Ae(_e.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ae(_e.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ne(iC(n))}function rC(t,e){return s0(t.databaseId,e)}function OO(t){const e=nC(t);return e.length===4?At.emptyPath():iC(e)}function py(t){return new At(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function iC(t){return pt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function US(t,e,n){return{name:my(t,e),fields:n.value.mapValue.fields}}function NO(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:ze(39313,{state:m})})(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],o=(function(m,g){return m.useProto3Json?(pt(g===void 0||typeof g=="string",58123),In.fromBase64String(g||"")):(pt(g===void 0||g instanceof Buffer||g instanceof Uint8Array,16193),In.fromUint8Array(g||new Uint8Array))})(t,e.targetChange.resumeToken),u=e.targetChange.cause,h=u&&(function(m){const g=m.code===void 0?_e.UNKNOWN:J1(m.code);return new Ae(g,m.message||"")})(u);n=new eC(r,a,o,h||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const a=Ig(t,r.document.name),o=Mi(r.document.updateTime),u=r.document.createTime?Mi(r.document.createTime):Fe.min(),h=new er({mapValue:{fields:r.document.fields}}),f=Pn.newFoundDocument(a,o,u,h),m=r.targetIds||[],g=r.removedTargetIds||[];n=new Xh(m,g,f.key,f)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const a=Ig(t,r.document),o=r.readTime?Mi(r.readTime):Fe.min(),u=Pn.newNoDocument(a,o),h=r.removedTargetIds||[];n=new Xh([],h,u.key,u)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const a=Ig(t,r.document),o=r.removedTargetIds||[];n=new Xh([],o,a,null)}else{if(!("filter"in e))return ze(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:a=0,unchangedNames:o}=r,u=new EO(a,o),h=r.targetId;n=new Z1(h,u)}}return n}function PO(t,e){let n;if(e instanceof Qu)n={update:US(t,e.key,e.value)};else if(e instanceof Yf)n={delete:my(t,e.key)};else if(e instanceof wa)n={update:US(t,e.key,e.data),updateMask:HO(e.fieldMask)};else{if(!(e instanceof xO))return ze(16599,{Vt:e.type});n={verify:my(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,u){const h=u.transform;if(h instanceof _f)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof kl)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof Iu)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof bf)return{fieldPath:u.field.canonicalString(),increment:h.Ae};throw ze(20930,{transform:u.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(a,o){return o.updateTime!==void 0?{updateTime:kO(a,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:ze(27497)})(t,e.precondition)),n}function LO(t,e){return t&&t.length>0?(pt(e!==void 0,14353),t.map((n=>(function(a,o){let u=a.updateTime?Mi(a.updateTime):Mi(o);return u.isEqual(Fe.min())&&(u=Mi(o)),new _O(u,a.transformResults||[])})(n,e)))):[]}function BO(t,e){return{documents:[rC(t,e.path)]}}function zO(t,e){const n={structuredQuery:{}},r=e.path;let a;e.collectionGroup!==null?(a=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=rC(t,a);const o=(function(m){if(m.length!==0)return aC(ni.create(m,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const u=(function(m){if(m.length!==0)return m.map((g=>(function(b){return{field:yl(b.field),direction:FO(b.dir)}})(g)))})(e.orderBy);u&&(n.structuredQuery.orderBy=u);const h=hy(t,e.limit);return h!==null&&(n.structuredQuery.limit=h),e.startAt&&(n.structuredQuery.startAt=(function(m){return{before:m.inclusive,values:m.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(m){return{before:!m.inclusive,values:m.position}})(e.endAt)),{ft:n,parent:a}}function UO(t){let e=OO(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let a=null;if(r>0){pt(r===1,65062);const g=n.from[0];g.allDescendants?a=g.collectionId:e=e.child(g.collectionId)}let o=[];n.where&&(o=(function(_){const b=sC(_);return b instanceof ni&&N1(b)?b.getFilters():[b]})(n.where));let u=[];n.orderBy&&(u=(function(_){return _.map((b=>(function(E){return new yf(_l(E.field),(function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(E.direction))})(b)))})(n.orderBy));let h=null;n.limit&&(h=(function(_){let b;return b=typeof _=="object"?_.value:_,qf(b)?null:b})(n.limit));let f=null;n.startAt&&(f=(function(_){const b=!!_.before,x=_.values||[];return new gf(x,b)})(n.startAt));let m=null;return n.endAt&&(m=(function(_){const b=!_.before,x=_.values||[];return new gf(x,b)})(n.endAt)),iO(e,a,u,o,h,"F",f,m)}function VO(t,e){const n=(function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ze(28987,{purpose:a})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function sC(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=_l(n.unaryFilter.field);return sn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const a=_l(n.unaryFilter.field);return sn.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=_l(n.unaryFilter.field);return sn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const u=_l(n.unaryFilter.field);return sn.create(u,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ze(61313);default:return ze(60726)}})(t):t.fieldFilter!==void 0?(function(n){return sn.create(_l(n.fieldFilter.field),(function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ze(58110);default:return ze(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return ni.create(n.compositeFilter.filters.map((r=>sC(r))),(function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return ze(1026)}})(n.compositeFilter.op))})(t):ze(30097,{filter:t})}function FO(t){return RO[t]}function $O(t){return DO[t]}function qO(t){return IO[t]}function yl(t){return{fieldPath:t.canonicalString()}}function _l(t){return Rn.fromServerFormat(t.fieldPath)}function aC(t){return t instanceof sn?(function(n){if(n.op==="=="){if(AS(n.value))return{unaryFilter:{field:yl(n.field),op:"IS_NAN"}};if(TS(n.value))return{unaryFilter:{field:yl(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(AS(n.value))return{unaryFilter:{field:yl(n.field),op:"IS_NOT_NAN"}};if(TS(n.value))return{unaryFilter:{field:yl(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:yl(n.field),op:$O(n.op),value:n.value}}})(t):t instanceof ni?(function(n){const r=n.getFilters().map((a=>aC(a)));return r.length===1?r[0]:{compositeFilter:{op:qO(n.op),filters:r}}})(t):ze(54877,{filter:t})}function HO(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function oC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class ra{constructor(e,n,r,a,o=Fe.min(),u=Fe.min(),h=In.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=a,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=h,this.expectedCount=f}withSequenceNumber(e){return new ra(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ra(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ra(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ra(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class GO{constructor(e){this.yt=e}}function QO(t){const e=UO({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?dy(e,e.limit,"L"):e}class WO{constructor(){this.Cn=new KO}addToCollectionParentIndex(e,n){return this.Cn.add(n),xe.resolve()}getCollectionParents(e,n){return xe.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return xe.resolve()}deleteFieldIndex(e,n){return xe.resolve()}deleteAllFieldIndexes(e){return xe.resolve()}createTargetIndexes(e,n){return xe.resolve()}getDocumentsMatchingTarget(e,n){return xe.resolve(null)}getIndexType(e,n){return xe.resolve(0)}getFieldIndexes(e,n){return xe.resolve([])}getNextCollectionGroupToUpdate(e){return xe.resolve(null)}getMinOffset(e,n){return xe.resolve(fa.min())}getMinOffsetFromCollectionGroup(e,n){return xe.resolve(fa.min())}updateCollectionGroup(e,n,r){return xe.resolve()}updateIndexEntries(e,n){return xe.resolve()}}class KO{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),a=this.index[n]||new mn(At.comparator),o=!a.has(r);return this.index[n]=a.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),a=this.index[n];return a&&a.has(r)}getEntries(e){return(this.index[e]||new mn(At.comparator)).toArray()}}const VS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},lC=41943040;class Zn{static withCacheSize(e){return new Zn(e,Zn.DEFAULT_COLLECTION_PERCENTILE,Zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}Zn.DEFAULT_COLLECTION_PERCENTILE=10,Zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Zn.DEFAULT=new Zn(lC,Zn.DEFAULT_COLLECTION_PERCENTILE,Zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Zn.DISABLED=new Zn(-1,0,0);class Ol{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ol(0)}static cr(){return new Ol(-1)}}const FS="LruGarbageCollector",YO=1048576;function $S([t,e],[n,r]){const a=nt(t,n);return a===0?nt(e,r):a}class XO{constructor(e){this.Ir=e,this.buffer=new mn($S),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();$S(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class JO{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){je(FS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Jl(n)?je(FS,"Ignoring IndexedDB error during garbage collection: ",n):await Xl(n)}await this.Vr(3e5)}))}}class ZO{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return xe.resolve($f.ce);const r=new XO(n);return this.mr.forEachTarget(e,(a=>r.Ar(a.sequenceNumber))).next((()=>this.mr.pr(e,(a=>r.Ar(a))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(je("LruGarbageCollector","Garbage collection skipped; disabled"),xe.resolve(VS)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(je("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),VS):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,a,o,u,h,f,m;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((_=>(_>this.params.maximumSequenceNumbersToCollect?(je("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),a=this.params.maximumSequenceNumbersToCollect):a=_,u=Date.now(),this.nthSequenceNumber(e,a)))).next((_=>(r=_,h=Date.now(),this.removeTargets(e,r,n)))).next((_=>(o=_,f=Date.now(),this.removeOrphanedDocuments(e,r)))).next((_=>(m=Date.now(),pl()<=tt.DEBUG&&je("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-g}ms
	Determined least recently used ${a} in `+(h-u)+`ms
	Removed ${o} targets in `+(f-h)+`ms
	Removed ${_} documents in `+(m-f)+`ms
Total Duration: ${m-g}ms`),xe.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:o,documentsRemoved:_}))))}}function eN(t,e){return new ZO(t,e)}class tN{constructor(){this.changes=new yo((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Pn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?xe.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class nN{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class rN{constructor(e,n,r,a){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=a}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((a=>(r=a,this.remoteDocumentCache.getEntry(e,n)))).next((a=>(r!==null&&xu(r.mutation,a,fr.empty(),Dt.now()),a)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,rt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=rt()){const a=so();return this.populateOverlays(e,a,n).next((()=>this.computeViews(e,n,a,r).next((o=>{let u=fu();return o.forEach(((h,f)=>{u=u.insert(h,f.overlayedDocument)})),u}))))}getOverlayedDocuments(e,n){const r=so();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,rt())))}populateOverlays(e,n,r){const a=[];return r.forEach((o=>{n.has(o)||a.push(o)})),this.documentOverlayCache.getOverlays(e,a).next((o=>{o.forEach(((u,h)=>{n.set(u,h)}))}))}computeViews(e,n,r,a){let o=fs();const u=vu(),h=(function(){return vu()})();return n.forEach(((f,m)=>{const g=r.get(m.key);a.has(m.key)&&(g===void 0||g.mutation instanceof wa)?o=o.insert(m.key,m):g!==void 0?(u.set(m.key,g.mutation.getFieldMask()),xu(g.mutation,m,g.mutation.getFieldMask(),Dt.now())):u.set(m.key,fr.empty())})),this.recalculateAndSaveOverlays(e,o).next((f=>(f.forEach(((m,g)=>u.set(m,g))),n.forEach(((m,g)=>h.set(m,new nN(g,u.get(m)??null)))),h)))}recalculateAndSaveOverlays(e,n){const r=vu();let a=new zt(((u,h)=>u-h)),o=rt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((u=>{for(const h of u)h.keys().forEach((f=>{const m=n.get(f);if(m===null)return;let g=r.get(f)||fr.empty();g=h.applyToLocalView(m,g),r.set(f,g);const _=(a.get(h.batchId)||rt()).add(f);a=a.insert(h.batchId,_)}))})).next((()=>{const u=[],h=a.getReverseIterator();for(;h.hasNext();){const f=h.getNext(),m=f.key,g=f.value,_=q1();g.forEach((b=>{if(!o.has(b)){const x=Y1(n.get(b),r.get(b));x!==null&&_.set(b,x),o=o.add(b)}})),u.push(this.documentOverlayCache.saveOverlays(e,m,_))}return xe.waitFor(u)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,a){return(function(u){return Ne.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):z1(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,a):this.getDocumentsMatchingCollectionQuery(e,n,r,a)}getNextDocuments(e,n,r,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,a).next((o=>{const u=a-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,a-o.size):xe.resolve(so());let h=Au,f=o;return u.next((m=>xe.forEach(m,((g,_)=>(h<_.largestBatchId&&(h=_.largestBatchId),o.get(g)?xe.resolve():this.remoteDocumentCache.getEntry(e,g).next((b=>{f=f.insert(g,b)}))))).next((()=>this.populateOverlays(e,m,o))).next((()=>this.computeViews(e,f,m,rt()))).next((g=>({batchId:h,changes:$1(g)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Ne(n)).next((r=>{let a=fu();return r.isFoundDocument()&&(a=a.insert(r.key,r)),a}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,a){const o=n.collectionGroup;let u=fu();return this.indexManager.getCollectionParents(e,o).next((h=>xe.forEach(h,(f=>{const m=(function(_,b){return new Gu(b,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)})(n,f.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,r,a).next((g=>{g.forEach(((_,b)=>{u=u.insert(_,b)}))}))})).next((()=>u))))}getDocumentsMatchingCollectionQuery(e,n,r,a){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((u=>(o=u,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,a)))).next((u=>{o.forEach(((f,m)=>{const g=m.getKey();u.get(g)===null&&(u=u.insert(g,Pn.newInvalidDocument(g)))}));let h=fu();return u.forEach(((f,m)=>{const g=o.get(f);g!==void 0&&xu(g.mutation,m,fr.empty(),Dt.now()),Qf(n,m)&&(h=h.insert(f,m))})),h}))}}class iN{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return xe.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(a){return{id:a.id,version:a.version,createTime:Mi(a.createTime)}})(n)),xe.resolve()}getNamedQuery(e,n){return xe.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(a){return{name:a.name,query:QO(a.bundledQuery),readTime:Mi(a.readTime)}})(n)),xe.resolve()}}class sN{constructor(){this.overlays=new zt(Ne.comparator),this.qr=new Map}getOverlay(e,n){return xe.resolve(this.overlays.get(n))}getOverlays(e,n){const r=so();return xe.forEach(n,(a=>this.getOverlay(e,a).next((o=>{o!==null&&r.set(a,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((a,o)=>{this.St(e,n,o)})),xe.resolve()}removeOverlaysForBatchId(e,n,r){const a=this.qr.get(r);return a!==void 0&&(a.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),xe.resolve()}getOverlaysForCollection(e,n,r){const a=so(),o=n.length+1,u=new Ne(n.child("")),h=this.overlays.getIteratorFrom(u);for(;h.hasNext();){const f=h.getNext().value,m=f.getKey();if(!n.isPrefixOf(m.path))break;m.path.length===o&&f.largestBatchId>r&&a.set(f.getKey(),f)}return xe.resolve(a)}getOverlaysForCollectionGroup(e,n,r,a){let o=new zt(((m,g)=>m-g));const u=this.overlays.getIterator();for(;u.hasNext();){const m=u.getNext().value;if(m.getKey().getCollectionGroup()===n&&m.largestBatchId>r){let g=o.get(m.largestBatchId);g===null&&(g=so(),o=o.insert(m.largestBatchId,g)),g.set(m.getKey(),m)}}const h=so(),f=o.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach(((m,g)=>h.set(m,g))),!(h.size()>=a)););return xe.resolve(h)}St(e,n,r){const a=this.overlays.get(r.key);if(a!==null){const u=this.qr.get(a.largestBatchId).delete(r.key);this.qr.set(a.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new wO(n,r));let o=this.qr.get(n);o===void 0&&(o=rt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class aN{constructor(){this.sessionToken=In.EMPTY_BYTE_STRING}getSessionToken(e){return xe.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,xe.resolve()}}class a0{constructor(){this.Qr=new mn(vn.$r),this.Ur=new mn(vn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new vn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new vn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new Ne(new At([])),r=new vn(n,e),a=new vn(n,e+1),o=[];return this.Ur.forEachInRange([r,a],(u=>{this.Gr(u),o.push(u.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Ne(new At([])),r=new vn(n,e),a=new vn(n,e+1);let o=rt();return this.Ur.forEachInRange([r,a],(u=>{o=o.add(u.key)})),o}containsKey(e){const n=new vn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class vn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Ne.comparator(e.key,n.key)||nt(e.Yr,n.Yr)}static Kr(e,n){return nt(e.Yr,n.Yr)||Ne.comparator(e.key,n.key)}}class oN{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new mn(vn.$r)}checkEmpty(e){return xe.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,a){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const u=new SO(o,n,r,a);this.mutationQueue.push(u);for(const h of a)this.Zr=this.Zr.add(new vn(h.key,o)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return xe.resolve(u)}lookupMutationBatch(e,n){return xe.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,a=this.ei(r),o=a<0?0:a;return xe.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return xe.resolve(this.mutationQueue.length===0?Yy:this.tr-1)}getAllMutationBatches(e){return xe.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new vn(n,0),a=new vn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,a],(u=>{const h=this.Xr(u.Yr);o.push(h)})),xe.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new mn(nt);return n.forEach((a=>{const o=new vn(a,0),u=new vn(a,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,u],(h=>{r=r.add(h.Yr)}))})),xe.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,a=r.length+1;let o=r;Ne.isDocumentKey(o)||(o=o.child(""));const u=new vn(new Ne(o),0);let h=new mn(nt);return this.Zr.forEachWhile((f=>{const m=f.key.path;return!!r.isPrefixOf(m)&&(m.length===a&&(h=h.add(f.Yr)),!0)}),u),xe.resolve(this.ti(h))}ti(e){const n=[];return e.forEach((r=>{const a=this.Xr(r);a!==null&&n.push(a)})),n}removeMutationBatch(e,n){pt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return xe.forEach(n.mutations,(a=>{const o=new vn(a.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new vn(n,0),a=this.Zr.firstAfterOrEqual(r);return xe.resolve(n.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,xe.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class lN{constructor(e){this.ri=e,this.docs=(function(){return new zt(Ne.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,a=this.docs.get(r),o=a?a.size:0,u=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:u}),this.size+=u-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return xe.resolve(r?r.document.mutableCopy():Pn.newInvalidDocument(n))}getEntries(e,n){let r=fs();return n.forEach((a=>{const o=this.docs.get(a);r=r.insert(a,o?o.document.mutableCopy():Pn.newInvalidDocument(a))})),xe.resolve(r)}getDocumentsMatchingQuery(e,n,r,a){let o=fs();const u=n.path,h=new Ne(u.child("__id-9223372036854775808__")),f=this.docs.getIteratorFrom(h);for(;f.hasNext();){const{key:m,value:{document:g}}=f.getNext();if(!u.isPrefixOf(m.path))break;m.path.length>u.length+1||Pk(Nk(g),r)<=0||(a.has(g.key)||Qf(n,g))&&(o=o.insert(g.key,g.mutableCopy()))}return xe.resolve(o)}getAllFromCollectionGroup(e,n,r,a){ze(9500)}ii(e,n){return xe.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new cN(this)}getSize(e){return xe.resolve(this.size)}}class cN extends tN{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,a)=>{a.isValidDocument()?n.push(this.Nr.addEntry(e,a)):this.Nr.removeEntry(r)})),xe.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class uN{constructor(e){this.persistence=e,this.si=new yo((n=>Zy(n)),e0),this.lastRemoteSnapshotVersion=Fe.min(),this.highestTargetId=0,this.oi=0,this._i=new a0,this.targetCount=0,this.ai=Ol.ur()}forEachTarget(e,n){return this.si.forEach(((r,a)=>n(a))),xe.resolve()}getLastRemoteSnapshotVersion(e){return xe.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return xe.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),xe.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),xe.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Ol(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,xe.resolve()}updateTargetData(e,n){return this.Pr(n),xe.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,xe.resolve()}removeTargets(e,n,r){let a=0;const o=[];return this.si.forEach(((u,h)=>{h.sequenceNumber<=n&&r.get(h.targetId)===null&&(this.si.delete(u),o.push(this.removeMatchingKeysForTargetId(e,h.targetId)),a++)})),xe.waitFor(o).next((()=>a))}getTargetCount(e){return xe.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return xe.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),xe.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const a=this.persistence.referenceDelegate,o=[];return a&&n.forEach((u=>{o.push(a.markPotentiallyOrphaned(e,u))})),xe.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),xe.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return xe.resolve(r)}containsKey(e,n){return xe.resolve(this._i.containsKey(n))}}class cC{constructor(e,n){this.ui={},this.overlays={},this.ci=new $f(0),this.li=!1,this.li=!0,this.hi=new aN,this.referenceDelegate=e(this),this.Pi=new uN(this),this.indexManager=new WO,this.remoteDocumentCache=(function(a){return new lN(a)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new GO(n),this.Ii=new iN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new sN,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new oN(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){je("MemoryPersistence","Starting transaction:",e);const a=new dN(this.ci.next());return this.referenceDelegate.Ei(),r(a).next((o=>this.referenceDelegate.di(a).next((()=>o)))).toPromise().then((o=>(a.raiseOnCommittedEvent(),o)))}Ai(e,n){return xe.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class dN extends Bk{constructor(e){super(),this.currentSequenceNumber=e}}class o0{constructor(e){this.persistence=e,this.Ri=new a0,this.Vi=null}static mi(e){return new o0(e)}get fi(){if(this.Vi)return this.Vi;throw ze(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),xe.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),xe.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),xe.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((a=>this.fi.add(a.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((a=>{a.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return xe.forEach(this.fi,(r=>{const a=Ne.fromPath(r);return this.gi(e,a).next((o=>{o||n.removeEntry(a,Fe.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return xe.or([()=>xe.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class xf{constructor(e,n){this.persistence=e,this.pi=new yo((r=>Vk(r.path)),((r,a)=>r.isEqual(a))),this.garbageCollector=eN(this,n)}static mi(e,n){return new xf(e,n)}Ei(){}di(e){return xe.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((a=>r+a))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return xe.forEach(this.pi,((r,a)=>this.br(e,r,a).next((o=>o?xe.resolve():n(a)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const a=this.persistence.getRemoteDocumentCache(),o=a.newChangeBuffer();return a.ii(e,(u=>this.br(e,u,n).next((h=>{h||(r++,o.removeEntry(u,Fe.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),xe.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),xe.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),xe.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),xe.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Wh(e.data.value)),n}br(e,n,r){return xe.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const a=this.pi.get(n);return xe.resolve(a!==void 0&&a>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class l0{constructor(e,n,r,a){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=a}static As(e,n){let r=rt(),a=rt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:a=a.add(o.doc.key)}return new l0(e,n.fromCache,r,a)}}class hN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class fN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return $5()?8:zk(Ln())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,a){const o={result:null};return this.ys(e,n).next((u=>{o.result=u})).next((()=>{if(!o.result)return this.ws(e,n,a,r).next((u=>{o.result=u}))})).next((()=>{if(o.result)return;const u=new hN;return this.Ss(e,n,u).next((h=>{if(o.result=h,this.Vs)return this.bs(e,n,u,h.size)}))})).next((()=>o.result))}bs(e,n,r,a){return r.documentReadCount<this.fs?(pl()<=tt.DEBUG&&je("QueryEngine","SDK will not create cache indexes for query:",gl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),xe.resolve()):(pl()<=tt.DEBUG&&je("QueryEngine","Query:",gl(n),"scans",r.documentReadCount,"local documents and returns",a,"documents as results."),r.documentReadCount>this.gs*a?(pl()<=tt.DEBUG&&je("QueryEngine","The SDK decides to create cache indexes for query:",gl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ii(n))):xe.resolve())}ys(e,n){if(IS(n))return xe.resolve(null);let r=Ii(n);return this.indexManager.getIndexType(e,r).next((a=>a===0?null:(n.limit!==null&&a===1&&(n=dy(n,null,"F"),r=Ii(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const u=rt(...o);return this.ps.getDocuments(e,u).next((h=>this.indexManager.getMinOffset(e,r).next((f=>{const m=this.Ds(n,h);return this.Cs(n,m,u,f.readTime)?this.ys(e,dy(n,null,"F")):this.vs(e,m,n,f)}))))})))))}ws(e,n,r,a){return IS(n)||a.isEqual(Fe.min())?xe.resolve(null):this.ps.getDocuments(e,r).next((o=>{const u=this.Ds(n,o);return this.Cs(n,u,r,a)?xe.resolve(null):(pl()<=tt.DEBUG&&je("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),gl(n)),this.vs(e,u,n,Ok(a,Au)).next((h=>h)))}))}Ds(e,n){let r=new mn(V1(e));return n.forEach(((a,o)=>{Qf(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,a){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(a)>0)}Ss(e,n,r){return pl()<=tt.DEBUG&&je("QueryEngine","Using full collection scan to execute query:",gl(n)),this.ps.getDocumentsMatchingQuery(e,n,fa.min(),r)}vs(e,n,r,a){return this.ps.getDocumentsMatchingQuery(e,r,a).next((o=>(n.forEach((u=>{o=o.insert(u.key,u)})),o)))}}const c0="LocalStore",mN=3e8;class pN{constructor(e,n,r,a){this.persistence=e,this.Fs=n,this.serializer=a,this.Ms=new zt(nt),this.xs=new yo((o=>Zy(o)),e0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function gN(t,e,n,r){return new pN(t,e,n,r)}async function uC(t,e){const n=qe(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let a;return n.mutationQueue.getAllMutationBatches(r).next((o=>(a=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const u=[],h=[];let f=rt();for(const m of a){u.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}for(const m of o){h.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}return n.localDocuments.getDocuments(r,f).next((m=>({Ls:m,removedBatchIds:u,addedBatchIds:h})))}))}))}function yN(t,e){const n=qe(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const a=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(h,f,m,g){const _=m.batch,b=_.keys();let x=xe.resolve();return b.forEach((E=>{x=x.next((()=>g.getEntry(f,E))).next((S=>{const T=m.docVersions.get(E);pt(T!==null,48541),S.version.compareTo(T)<0&&(_.applyToRemoteDocument(S,m),S.isValidDocument()&&(S.setReadTime(m.commitVersion),g.addEntry(S)))}))})),x.next((()=>h.mutationQueue.removeMutationBatch(f,_)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,a,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(h){let f=rt();for(let m=0;m<h.mutationResults.length;++m)h.mutationResults[m].transformResults.length>0&&(f=f.add(h.batch.mutations[m].key));return f})(e)))).next((()=>n.localDocuments.getDocuments(r,a)))}))}function dC(t){const e=qe(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function _N(t,e){const n=qe(t),r=e.snapshotVersion;let a=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const u=n.Ns.newChangeBuffer({trackRemovals:!0});a=n.Ms;const h=[];e.targetChanges.forEach(((g,_)=>{const b=a.get(_);if(!b)return;h.push(n.Pi.removeMatchingKeys(o,g.removedDocuments,_).next((()=>n.Pi.addMatchingKeys(o,g.addedDocuments,_))));let x=b.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(_)!==null?x=x.withResumeToken(In.EMPTY_BYTE_STRING,Fe.min()).withLastLimboFreeSnapshotVersion(Fe.min()):g.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(g.resumeToken,r)),a=a.insert(_,x),(function(S,T,D){return S.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=mN?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0})(b,x,g)&&h.push(n.Pi.updateTargetData(o,x))}));let f=fs(),m=rt();if(e.documentUpdates.forEach((g=>{e.resolvedLimboDocuments.has(g)&&h.push(n.persistence.referenceDelegate.updateLimboDocument(o,g))})),h.push(bN(o,u,e.documentUpdates).next((g=>{f=g.ks,m=g.qs}))),!r.isEqual(Fe.min())){const g=n.Pi.getLastRemoteSnapshotVersion(o).next((_=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));h.push(g)}return xe.waitFor(h).next((()=>u.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,f,m))).next((()=>f))})).then((o=>(n.Ms=a,o)))}function bN(t,e,n){let r=rt(),a=rt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let u=fs();return n.forEach(((h,f)=>{const m=o.get(h);f.isFoundDocument()!==m.isFoundDocument()&&(a=a.add(h)),f.isNoDocument()&&f.version.isEqual(Fe.min())?(e.removeEntry(h,f.readTime),u=u.insert(h,f)):!m.isValidDocument()||f.version.compareTo(m.version)>0||f.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(f),u=u.insert(h,f)):je(c0,"Ignoring outdated watch update for ",h,". Current version:",m.version," Watch version:",f.version)})),{ks:u,qs:a}}))}function vN(t,e){const n=qe(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Yy),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function xN(t,e){const n=qe(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let a;return n.Pi.getTargetData(r,e).next((o=>o?(a=o,xe.resolve(a)):n.Pi.allocateTargetId(r).next((u=>(a=new ra(e,u,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,a).next((()=>a)))))))})).then((r=>{const a=n.Ms.get(r.targetId);return(a===null||r.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function gy(t,e,n){const r=qe(t),a=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(u=>r.persistence.referenceDelegate.removeTarget(u,a)))}catch(u){if(!Jl(u))throw u;je(c0,`Failed to update sequence numbers for target ${e}: ${u}`)}r.Ms=r.Ms.remove(e),r.xs.delete(a.target)}function qS(t,e,n){const r=qe(t);let a=Fe.min(),o=rt();return r.persistence.runTransaction("Execute query","readwrite",(u=>(function(f,m,g){const _=qe(f),b=_.xs.get(g);return b!==void 0?xe.resolve(_.Ms.get(b)):_.Pi.getTargetData(m,g)})(r,u,Ii(e)).next((h=>{if(h)return a=h.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(u,h.targetId).next((f=>{o=f}))})).next((()=>r.Fs.getDocumentsMatchingQuery(u,e,n?a:Fe.min(),n?o:rt()))).next((h=>(SN(r,aO(e),h),{documents:h,Qs:o})))))}function SN(t,e,n){let r=t.Os.get(e)||Fe.min();n.forEach(((a,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class HS{constructor(){this.activeTargetIds=hO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class wN{constructor(){this.Mo=new HS,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new HS,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class EN{Oo(e){}shutdown(){}}const GS="ConnectivityMonitor";class QS{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){je(GS,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){je(GS,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Bh=null;function yy(){return Bh===null?Bh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Bh++,"0x"+Bh.toString(16)}const Mg="RestConnection",CN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class TN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${a}`,this.Wo=this.databaseId.database===mf?`project_id=${r}`:`project_id=${r}&database_id=${a}`}Go(e,n,r,a,o){const u=yy(),h=this.zo(e,n.toUriEncodedString());je(Mg,`Sending RPC '${e}' ${u}:`,h,r);const f={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(f,a,o);const{host:m}=new URL(h),g=ql(m);return this.Jo(e,h,f,r,g).then((_=>(je(Mg,`Received RPC '${e}' ${u}: `,_),_)),(_=>{throw Rl(Mg,`RPC '${e}' ${u} failed with error: `,_,"url: ",h,"request:",r),_}))}Ho(e,n,r,a,o,u){return this.Go(e,n,r,a,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Yl})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((a,o)=>e[o]=a)),r&&r.headers.forEach(((a,o)=>e[o]=a))}zo(e,n){const r=CN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class AN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const On="WebChannelConnection";class jN extends TN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,a,o){const u=yy();return new Promise(((h,f)=>{const m=new m1;m.setWithCredentials(!0),m.listenOnce(p1.COMPLETE,(()=>{try{switch(m.getLastErrorCode()){case Qh.NO_ERROR:const _=m.getResponseJson();je(On,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(_)),h(_);break;case Qh.TIMEOUT:je(On,`RPC '${e}' ${u} timed out`),f(new Ae(_e.DEADLINE_EXCEEDED,"Request time out"));break;case Qh.HTTP_ERROR:const b=m.getStatus();if(je(On,`RPC '${e}' ${u} failed with status:`,b,"response text:",m.getResponseText()),b>0){let x=m.getResponseJson();Array.isArray(x)&&(x=x[0]);const E=x?.error;if(E&&E.status&&E.message){const S=(function(D){const j=D.toLowerCase().replace(/_/g,"-");return Object.values(_e).indexOf(j)>=0?j:_e.UNKNOWN})(E.status);f(new Ae(S,E.message))}else f(new Ae(_e.UNKNOWN,"Server responded with status "+m.getStatus()))}else f(new Ae(_e.UNAVAILABLE,"Connection failed."));break;default:ze(9055,{l_:e,streamId:u,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{je(On,`RPC '${e}' ${u} completed.`)}}));const g=JSON.stringify(a);je(On,`RPC '${e}' ${u} sending request:`,a),m.send(n,"POST",g,r,15)}))}T_(e,n,r){const a=yy(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],u=_1(),h=y1(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(f.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(f.useFetchStreams=!0),this.jo(f.initMessageHeaders,n,r),f.encodeInitMessageHeaders=!0;const g=o.join("");je(On,`Creating RPC '${e}' stream ${a}: ${g}`,f);const _=u.createWebChannel(g,f);this.I_(_);let b=!1,x=!1;const E=new AN({Yo:T=>{x?je(On,`Not sending because RPC '${e}' stream ${a} is closed:`,T):(b||(je(On,`Opening RPC '${e}' stream ${a} transport.`),_.open(),b=!0),je(On,`RPC '${e}' stream ${a} sending:`,T),_.send(T))},Zo:()=>_.close()}),S=(T,D,j)=>{T.listen(D,(M=>{try{j(M)}catch(K){setTimeout((()=>{throw K}),0)}}))};return S(_,hu.EventType.OPEN,(()=>{x||(je(On,`RPC '${e}' stream ${a} transport opened.`),E.o_())})),S(_,hu.EventType.CLOSE,(()=>{x||(x=!0,je(On,`RPC '${e}' stream ${a} transport closed`),E.a_(),this.E_(_))})),S(_,hu.EventType.ERROR,(T=>{x||(x=!0,Rl(On,`RPC '${e}' stream ${a} transport errored. Name:`,T.name,"Message:",T.message),E.a_(new Ae(_e.UNAVAILABLE,"The operation could not be completed")))})),S(_,hu.EventType.MESSAGE,(T=>{if(!x){const D=T.data[0];pt(!!D,16349);const j=D,M=j?.error||j[0]?.error;if(M){je(On,`RPC '${e}' stream ${a} received error:`,M);const K=M.status;let H=(function(k){const O=rn[k];if(O!==void 0)return J1(O)})(K),Q=M.message;H===void 0&&(H=_e.INTERNAL,Q="Unknown error status: "+K+" with message "+M.message),x=!0,E.a_(new Ae(H,Q)),_.close()}else je(On,`RPC '${e}' stream ${a} received:`,D),E.u_(D)}})),S(h,g1.STAT_EVENT,(T=>{T.stat===iy.PROXY?je(On,`RPC '${e}' stream ${a} detected buffering proxy`):T.stat===iy.NOPROXY&&je(On,`RPC '${e}' stream ${a} detected no buffering proxy`)})),setTimeout((()=>{E.__()}),0),E}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function kg(){return typeof document<"u"?document:null}function Jf(t){return new MO(t,!0)}class hC{constructor(e,n,r=1e3,a=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=a,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),a=Math.max(0,n-r);a>0&&je("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,a,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const WS="PersistentStream";class fC{constructor(e,n,r,a,o,u,h,f){this.Mi=e,this.S_=r,this.b_=a,this.connection=o,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=h,this.listener=f,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new hC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===_e.RESOURCE_EXHAUSTED?(hs(n.toString()),hs("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===_e.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,a])=>{this.D_===n&&this.G_(r,a)}),(r=>{e((()=>{const a=new Ae(_e.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(a)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((a=>{r((()=>this.z_(a)))})),this.stream.onMessage((a=>{r((()=>++this.F_==1?this.J_(a):this.onNext(a)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return je(WS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(je(WS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class RN extends fC{constructor(e,n,r,a,o,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,a,u),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=NO(this.serializer,e),r=(function(o){if(!("targetChange"in o))return Fe.min();const u=o.targetChange;return u.targetIds&&u.targetIds.length?Fe.min():u.readTime?Mi(u.readTime):Fe.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=py(this.serializer),n.addTarget=(function(o,u){let h;const f=u.target;if(h=cy(f)?{documents:BO(o,f)}:{query:zO(o,f).ft},h.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){h.resumeToken=tC(o,u.resumeToken);const m=hy(o,u.expectedCount);m!==null&&(h.expectedCount=m)}else if(u.snapshotVersion.compareTo(Fe.min())>0){h.readTime=vf(o,u.snapshotVersion.toTimestamp());const m=hy(o,u.expectedCount);m!==null&&(h.expectedCount=m)}return h})(this.serializer,e);const r=VO(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=py(this.serializer),n.removeTarget=e,this.q_(n)}}class DN extends fC{constructor(e,n,r,a,o,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,a,u),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return pt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,pt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){pt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=LO(e.writeResults,e.commitTime),r=Mi(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=py(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>PO(this.serializer,r)))};this.q_(n)}}class IN{}class MN extends IN{constructor(e,n,r,a){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=a,this.ia=!1}sa(){if(this.ia)throw new Ae(_e.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,u])=>this.connection.Go(e,fy(n,r),a,o,u))).catch((o=>{throw o.name==="FirebaseError"?(o.code===_e.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Ae(_e.UNKNOWN,o.toString())}))}Ho(e,n,r,a,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,h])=>this.connection.Ho(e,fy(n,r),a,u,h,o))).catch((u=>{throw u.name==="FirebaseError"?(u.code===_e.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new Ae(_e.UNKNOWN,u.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class kN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(hs(n),this.aa=!1):je("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const mo="RemoteStore";class ON{constructor(e,n,r,a,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((u=>{r.enqueueAndForget((async()=>{_o(this)&&(je(mo,"Restarting streams for network reachability change."),await(async function(f){const m=qe(f);m.Ea.add(4),await Ku(m),m.Ra.set("Unknown"),m.Ea.delete(4),await Zf(m)})(this))}))})),this.Ra=new kN(r,a)}}async function Zf(t){if(_o(t))for(const e of t.da)await e(!0)}async function Ku(t){for(const e of t.da)await e(!1)}function mC(t,e){const n=qe(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),f0(n)?h0(n):Zl(n).O_()&&d0(n,e))}function u0(t,e){const n=qe(t),r=Zl(n);n.Ia.delete(e),r.O_()&&pC(n,e),n.Ia.size===0&&(r.O_()?r.L_():_o(n)&&n.Ra.set("Unknown"))}function d0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Fe.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Zl(t).Y_(e)}function pC(t,e){t.Va.Ue(e),Zl(t).Z_(e)}function h0(t){t.Va=new jO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),Zl(t).start(),t.Ra.ua()}function f0(t){return _o(t)&&!Zl(t).x_()&&t.Ia.size>0}function _o(t){return qe(t).Ea.size===0}function gC(t){t.Va=void 0}async function NN(t){t.Ra.set("Online")}async function PN(t){t.Ia.forEach(((e,n)=>{d0(t,e)}))}async function LN(t,e){gC(t),f0(t)?(t.Ra.ha(e),h0(t)):t.Ra.set("Unknown")}async function BN(t,e,n){if(t.Ra.set("Online"),e instanceof eC&&e.state===2&&e.cause)try{await(async function(a,o){const u=o.cause;for(const h of o.targetIds)a.Ia.has(h)&&(await a.remoteSyncer.rejectListen(h,u),a.Ia.delete(h),a.Va.removeTarget(h))})(t,e)}catch(r){je(mo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Sf(t,r)}else if(e instanceof Xh?t.Va.Ze(e):e instanceof Z1?t.Va.st(e):t.Va.tt(e),!n.isEqual(Fe.min()))try{const r=await dC(t.localStore);n.compareTo(r)>=0&&await(function(o,u){const h=o.Va.Tt(u);return h.targetChanges.forEach(((f,m)=>{if(f.resumeToken.approximateByteSize()>0){const g=o.Ia.get(m);g&&o.Ia.set(m,g.withResumeToken(f.resumeToken,u))}})),h.targetMismatches.forEach(((f,m)=>{const g=o.Ia.get(f);if(!g)return;o.Ia.set(f,g.withResumeToken(In.EMPTY_BYTE_STRING,g.snapshotVersion)),pC(o,f);const _=new ra(g.target,f,m,g.sequenceNumber);d0(o,_)})),o.remoteSyncer.applyRemoteEvent(h)})(t,n)}catch(r){je(mo,"Failed to raise snapshot:",r),await Sf(t,r)}}async function Sf(t,e,n){if(!Jl(e))throw e;t.Ea.add(1),await Ku(t),t.Ra.set("Offline"),n||(n=()=>dC(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{je(mo,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await Zf(t)}))}function yC(t,e){return e().catch((n=>Sf(t,n,e)))}async function em(t){const e=qe(t),n=ya(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Yy;for(;zN(e);)try{const a=await vN(e.localStore,r);if(a===null){e.Ta.length===0&&n.L_();break}r=a.batchId,UN(e,a)}catch(a){await Sf(e,a)}_C(e)&&bC(e)}function zN(t){return _o(t)&&t.Ta.length<10}function UN(t,e){t.Ta.push(e);const n=ya(t);n.O_()&&n.X_&&n.ea(e.mutations)}function _C(t){return _o(t)&&!ya(t).x_()&&t.Ta.length>0}function bC(t){ya(t).start()}async function VN(t){ya(t).ra()}async function FN(t){const e=ya(t);for(const n of t.Ta)e.ea(n.mutations)}async function $N(t,e,n){const r=t.Ta.shift(),a=r0.from(r,e,n);await yC(t,(()=>t.remoteSyncer.applySuccessfulWrite(a))),await em(t)}async function qN(t,e){e&&ya(t).X_&&await(async function(r,a){if((function(u){return CO(u)&&u!==_e.ABORTED})(a.code)){const o=r.Ta.shift();ya(r).B_(),await yC(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,a))),await em(r)}})(t,e),_C(t)&&bC(t)}async function KS(t,e){const n=qe(t);n.asyncQueue.verifyOperationInProgress(),je(mo,"RemoteStore received new credentials");const r=_o(n);n.Ea.add(3),await Ku(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await Zf(n)}async function HN(t,e){const n=qe(t);e?(n.Ea.delete(2),await Zf(n)):e||(n.Ea.add(2),await Ku(n),n.Ra.set("Unknown"))}function Zl(t){return t.ma||(t.ma=(function(n,r,a){const o=qe(n);return o.sa(),new RN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,a)})(t.datastore,t.asyncQueue,{Xo:NN.bind(null,t),t_:PN.bind(null,t),r_:LN.bind(null,t),H_:BN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),f0(t)?h0(t):t.Ra.set("Unknown")):(await t.ma.stop(),gC(t))}))),t.ma}function ya(t){return t.fa||(t.fa=(function(n,r,a){const o=qe(n);return o.sa(),new DN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,a)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:VN.bind(null,t),r_:qN.bind(null,t),ta:FN.bind(null,t),na:$N.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await em(t)):(await t.fa.stop(),t.Ta.length>0&&(je(mo,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class m0{constructor(e,n,r,a,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=a,this.removalCallback=o,this.deferred=new ls,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((u=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,a,o){const u=Date.now()+r,h=new m0(e,n,u,a,o);return h.start(r),h}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ae(_e.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function p0(t,e){if(hs("AsyncQueue",`${e}: ${t}`),Jl(t))return new Ae(_e.UNAVAILABLE,`${e}: ${t}`);throw t}class wl{static emptySet(e){return new wl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Ne.comparator(n.key,r.key):(n,r)=>Ne.comparator(n.key,r.key),this.keyedMap=fu(),this.sortedSet=new zt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof wl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const a=n.getNext().key,o=r.getNext().key;if(!a.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new wl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class YS{constructor(){this.ga=new zt(Ne.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):ze(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class Nl{constructor(e,n,r,a,o,u,h,f,m){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=a,this.mutatedKeys=o,this.fromCache=u,this.syncStateChanged=h,this.excludesMetadataChanges=f,this.hasCachedResults=m}static fromInitialDocuments(e,n,r,a,o){const u=[];return n.forEach((h=>{u.push({type:0,doc:h})})),new Nl(e,n,wl.emptySet(n),u,r,a,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Gf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let a=0;a<n.length;a++)if(n[a].type!==r[a].type||!n[a].doc.isEqual(r[a].doc))return!1;return!0}}class GN{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class QN{constructor(){this.queries=XS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const a=qe(n),o=a.queries;a.queries=XS(),o.forEach(((u,h)=>{for(const f of h.Sa)f.onError(r)}))})(this,new Ae(_e.ABORTED,"Firestore shutting down"))}}function XS(){return new yo((t=>U1(t)),Gf)}async function vC(t,e){const n=qe(t);let r=3;const a=e.query;let o=n.queries.get(a);o?!o.ba()&&e.Da()&&(r=2):(o=new GN,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(a,!0);break;case 1:o.wa=await n.onListen(a,!1);break;case 2:await n.onFirstRemoteStoreListen(a)}}catch(u){const h=p0(u,`Initialization of query '${gl(e.query)}' failed`);return void e.onError(h)}n.queries.set(a,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&g0(n)}async function xC(t,e){const n=qe(t),r=e.query;let a=3;const o=n.queries.get(r);if(o){const u=o.Sa.indexOf(e);u>=0&&(o.Sa.splice(u,1),o.Sa.length===0?a=e.Da()?0:1:!o.ba()&&e.Da()&&(a=2))}switch(a){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function WN(t,e){const n=qe(t);let r=!1;for(const a of e){const o=a.query,u=n.queries.get(o);if(u){for(const h of u.Sa)h.Fa(a)&&(r=!0);u.wa=a}}r&&g0(n)}function KN(t,e,n){const r=qe(t),a=r.queries.get(e);if(a)for(const o of a.Sa)o.onError(n);r.queries.delete(e)}function g0(t){t.Ca.forEach((e=>{e.next()}))}var _y,JS;(JS=_y||(_y={})).Ma="default",JS.Cache="cache";class SC{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const a of e.docChanges)a.type!==3&&r.push(a);e=new Nl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Nl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==_y.Cache}}class wC{constructor(e){this.key=e}}class EC{constructor(e){this.key=e}}class YN{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=rt(),this.mutatedKeys=rt(),this.eu=V1(e),this.tu=new wl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new YS,a=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,u=a,h=!1;const f=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,m=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal(((g,_)=>{const b=a.get(g),x=Qf(this.query,_)?_:null,E=!!b&&this.mutatedKeys.has(b.key),S=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let T=!1;b&&x?b.data.isEqual(x.data)?E!==S&&(r.track({type:3,doc:x}),T=!0):this.su(b,x)||(r.track({type:2,doc:x}),T=!0,(f&&this.eu(x,f)>0||m&&this.eu(x,m)<0)&&(h=!0)):!b&&x?(r.track({type:0,doc:x}),T=!0):b&&!x&&(r.track({type:1,doc:b}),T=!0,(f||m)&&(h=!0)),T&&(x?(u=u.add(x),o=S?o.add(g):o.delete(g)):(u=u.delete(g),o=o.delete(g)))})),this.query.limit!==null)for(;u.size>this.query.limit;){const g=this.query.limitType==="F"?u.last():u.first();u=u.delete(g.key),o=o.delete(g.key),r.track({type:1,doc:g})}return{tu:u,iu:r,Cs:h,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,a){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const u=e.iu.ya();u.sort(((g,_)=>(function(x,E){const S=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ze(20277,{Rt:T})}};return S(x)-S(E)})(g.type,_.type)||this.eu(g.doc,_.doc))),this.ou(r),a=a??!1;const h=n&&!a?this._u():[],f=this.Xa.size===0&&this.current&&!a?1:0,m=f!==this.Za;return this.Za=f,u.length!==0||m?{snapshot:new Nl(this.query,e.tu,o,u,e.mutatedKeys,f===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:h}:{au:h}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new YS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=rt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new EC(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new wC(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=rt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Nl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const y0="SyncEngine";class XN{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class JN{constructor(e){this.key=e,this.hu=!1}}class ZN{constructor(e,n,r,a,o,u){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=a,this.currentUser=o,this.maxConcurrentLimboResolutions=u,this.Pu={},this.Tu=new yo((h=>U1(h)),Gf),this.Iu=new Map,this.Eu=new Set,this.du=new zt(Ne.comparator),this.Au=new Map,this.Ru=new a0,this.Vu={},this.mu=new Map,this.fu=Ol.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function eP(t,e,n=!0){const r=DC(t);let a;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),a=o.view.lu()):a=await CC(r,e,n,!0),a}async function tP(t,e){const n=DC(t);await CC(n,e,!0,!1)}async function CC(t,e,n,r){const a=await xN(t.localStore,Ii(e)),o=a.targetId,u=t.sharedClientState.addLocalQueryTarget(o,n);let h;return r&&(h=await nP(t,e,o,u==="current",a.resumeToken)),t.isPrimaryClient&&n&&mC(t.remoteStore,a),h}async function nP(t,e,n,r,a){t.pu=(_,b,x)=>(async function(S,T,D,j){let M=T.view.ru(D);M.Cs&&(M=await qS(S.localStore,T.query,!1).then((({documents:P})=>T.view.ru(P,M))));const K=j&&j.targetChanges.get(T.targetId),H=j&&j.targetMismatches.get(T.targetId)!=null,Q=T.view.applyChanges(M,S.isPrimaryClient,K,H);return ew(S,T.targetId,Q.au),Q.snapshot})(t,_,b,x);const o=await qS(t.localStore,e,!0),u=new YN(e,o.Qs),h=u.ru(o.documents),f=Wu.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",a),m=u.applyChanges(h,t.isPrimaryClient,f);ew(t,n,m.au);const g=new XN(e,n,u);return t.Tu.set(e,g),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),m.snapshot}async function rP(t,e,n){const r=qe(t),a=r.Tu.get(e),o=r.Iu.get(a.targetId);if(o.length>1)return r.Iu.set(a.targetId,o.filter((u=>!Gf(u,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(a.targetId),r.sharedClientState.isActiveQueryTarget(a.targetId)||await gy(r.localStore,a.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(a.targetId),n&&u0(r.remoteStore,a.targetId),by(r,a.targetId)})).catch(Xl)):(by(r,a.targetId),await gy(r.localStore,a.targetId,!0))}async function iP(t,e){const n=qe(t),r=n.Tu.get(e),a=n.Iu.get(r.targetId);n.isPrimaryClient&&a.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),u0(n.remoteStore,r.targetId))}async function sP(t,e,n){const r=hP(t);try{const a=await(function(u,h){const f=qe(u),m=Dt.now(),g=h.reduce(((x,E)=>x.add(E.key)),rt());let _,b;return f.persistence.runTransaction("Locally write mutations","readwrite",(x=>{let E=fs(),S=rt();return f.Ns.getEntries(x,g).next((T=>{E=T,E.forEach(((D,j)=>{j.isValidDocument()||(S=S.add(D))}))})).next((()=>f.localDocuments.getOverlayedDocuments(x,E))).next((T=>{_=T;const D=[];for(const j of h){const M=vO(j,_.get(j.key).overlayedDocument);M!=null&&D.push(new wa(j.key,M,M1(M.value.mapValue),tr.exists(!0)))}return f.mutationQueue.addMutationBatch(x,m,D,h)})).next((T=>{b=T;const D=T.applyToLocalDocumentSet(_,S);return f.documentOverlayCache.saveOverlays(x,T.batchId,D)}))})).then((()=>({batchId:b.batchId,changes:$1(_)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(a.batchId),(function(u,h,f){let m=u.Vu[u.currentUser.toKey()];m||(m=new zt(nt)),m=m.insert(h,f),u.Vu[u.currentUser.toKey()]=m})(r,a.batchId,n),await Yu(r,a.changes),await em(r.remoteStore)}catch(a){const o=p0(a,"Failed to persist write");n.reject(o)}}async function TC(t,e){const n=qe(t);try{const r=await _N(n.localStore,e);e.targetChanges.forEach(((a,o)=>{const u=n.Au.get(o);u&&(pt(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?u.hu=!0:a.modifiedDocuments.size>0?pt(u.hu,14607):a.removedDocuments.size>0&&(pt(u.hu,42227),u.hu=!1))})),await Yu(n,r,e)}catch(r){await Xl(r)}}function ZS(t,e,n){const r=qe(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const a=[];r.Tu.forEach(((o,u)=>{const h=u.view.va(e);h.snapshot&&a.push(h.snapshot)})),(function(u,h){const f=qe(u);f.onlineState=h;let m=!1;f.queries.forEach(((g,_)=>{for(const b of _.Sa)b.va(h)&&(m=!0)})),m&&g0(f)})(r.eventManager,e),a.length&&r.Pu.H_(a),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function aP(t,e,n){const r=qe(t);r.sharedClientState.updateQueryState(e,"rejected",n);const a=r.Au.get(e),o=a&&a.key;if(o){let u=new zt(Ne.comparator);u=u.insert(o,Pn.newNoDocument(o,Fe.min()));const h=rt().add(o),f=new Xf(Fe.min(),new Map,new zt(nt),u,h);await TC(r,f),r.du=r.du.remove(o),r.Au.delete(e),_0(r)}else await gy(r.localStore,e,!1).then((()=>by(r,e,n))).catch(Xl)}async function oP(t,e){const n=qe(t),r=e.batch.batchId;try{const a=await yN(n.localStore,e);jC(n,r,null),AC(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Yu(n,a)}catch(a){await Xl(a)}}async function lP(t,e,n){const r=qe(t);try{const a=await(function(u,h){const f=qe(u);return f.persistence.runTransaction("Reject batch","readwrite-primary",(m=>{let g;return f.mutationQueue.lookupMutationBatch(m,h).next((_=>(pt(_!==null,37113),g=_.keys(),f.mutationQueue.removeMutationBatch(m,_)))).next((()=>f.mutationQueue.performConsistencyCheck(m))).next((()=>f.documentOverlayCache.removeOverlaysForBatchId(m,g,h))).next((()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,g))).next((()=>f.localDocuments.getDocuments(m,g)))}))})(r.localStore,e);jC(r,e,n),AC(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Yu(r,a)}catch(a){await Xl(a)}}function AC(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function jC(t,e,n){const r=qe(t);let a=r.Vu[r.currentUser.toKey()];if(a){const o=a.get(e);o&&(n?o.reject(n):o.resolve(),a=a.remove(e)),r.Vu[r.currentUser.toKey()]=a}}function by(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||RC(t,r)}))}function RC(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(u0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),_0(t))}function ew(t,e,n){for(const r of n)r instanceof wC?(t.Ru.addReference(r.key,e),cP(t,r)):r instanceof EC?(je(y0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||RC(t,r.key)):ze(19791,{wu:r})}function cP(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(je(y0,"New document in limbo: "+n),t.Eu.add(r),_0(t))}function _0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Ne(At.fromString(e)),r=t.fu.next();t.Au.set(r,new JN(n)),t.du=t.du.insert(n,r),mC(t.remoteStore,new ra(Ii(t0(n.path)),r,"TargetPurposeLimboResolution",$f.ce))}}async function Yu(t,e,n){const r=qe(t),a=[],o=[],u=[];r.Tu.isEmpty()||(r.Tu.forEach(((h,f)=>{u.push(r.pu(f,e,n).then((m=>{if((m||n)&&r.isPrimaryClient){const g=m?!m.fromCache:n?.targetChanges.get(f.targetId)?.current;r.sharedClientState.updateQueryState(f.targetId,g?"current":"not-current")}if(m){a.push(m);const g=l0.As(f.targetId,m);o.push(g)}})))})),await Promise.all(u),r.Pu.H_(a),await(async function(f,m){const g=qe(f);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",(_=>xe.forEach(m,(b=>xe.forEach(b.Es,(x=>g.persistence.referenceDelegate.addReference(_,b.targetId,x))).next((()=>xe.forEach(b.ds,(x=>g.persistence.referenceDelegate.removeReference(_,b.targetId,x)))))))))}catch(_){if(!Jl(_))throw _;je(c0,"Failed to update sequence numbers: "+_)}for(const _ of m){const b=_.targetId;if(!_.fromCache){const x=g.Ms.get(b),E=x.snapshotVersion,S=x.withLastLimboFreeSnapshotVersion(E);g.Ms=g.Ms.insert(b,S)}}})(r.localStore,o))}async function uP(t,e){const n=qe(t);if(!n.currentUser.isEqual(e)){je(y0,"User change. New user:",e.toKey());const r=await uC(n.localStore,e);n.currentUser=e,(function(o,u){o.mu.forEach((h=>{h.forEach((f=>{f.reject(new Ae(_e.CANCELLED,u))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Yu(n,r.Ls)}}function dP(t,e){const n=qe(t),r=n.Au.get(e);if(r&&r.hu)return rt().add(r.key);{let a=rt();const o=n.Iu.get(e);if(!o)return a;for(const u of o){const h=n.Tu.get(u);a=a.unionWith(h.view.nu)}return a}}function DC(t){const e=qe(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=TC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=dP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=aP.bind(null,e),e.Pu.H_=WN.bind(null,e.eventManager),e.Pu.yu=KN.bind(null,e.eventManager),e}function hP(t){const e=qe(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=oP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=lP.bind(null,e),e}class wf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Jf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return gN(this.persistence,new fN,e.initialUser,this.serializer)}Cu(e){return new cC(o0.mi,this.serializer)}Du(e){return new wN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}wf.provider={build:()=>new wf};class fP extends wf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){pt(this.persistence.referenceDelegate instanceof xf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new JO(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?Zn.withCacheSize(this.cacheSizeBytes):Zn.DEFAULT;return new cC((r=>xf.mi(r,n)),this.serializer)}}class vy{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>ZS(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=uP.bind(null,this.syncEngine),await HN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new QN})()}createDatastore(e){const n=Jf(e.databaseInfo.databaseId),r=(function(o){return new jN(o)})(e.databaseInfo);return(function(o,u,h,f){return new MN(o,u,h,f)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,a,o,u,h){return new ON(r,a,o,u,h)})(this.localStore,this.datastore,e.asyncQueue,(n=>ZS(this.syncEngine,n,0)),(function(){return QS.v()?new QS:new EN})())}createSyncEngine(e,n){return(function(a,o,u,h,f,m,g){const _=new ZN(a,o,u,h,f,m);return g&&(_.gu=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=qe(n);je(mo,"RemoteStore shutting down."),r.Ea.add(5),await Ku(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}vy.provider={build:()=>new vy};class IC{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):hs("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const _a="FirestoreClient";class mP{constructor(e,n,r,a,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=a,this.user=Nn.UNAUTHENTICATED,this.clientId=Ky.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async u=>{je(_a,"Received user=",u.uid),await this.authCredentialListener(u),this.user=u})),this.appCheckCredentials.start(r,(u=>(je(_a,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ls;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=p0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Og(t,e){t.asyncQueue.verifyOperationInProgress(),je(_a,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async a=>{r.isEqual(a)||(await uC(e.localStore,a),r=a)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function tw(t,e){t.asyncQueue.verifyOperationInProgress();const n=await pP(t);je(_a,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>KS(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,a)=>KS(e.remoteStore,a))),t._onlineComponents=e}async function pP(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){je(_a,"Using user provided OfflineComponentProvider");try{await Og(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(a){return a.name==="FirebaseError"?a.code===_e.FAILED_PRECONDITION||a.code===_e.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(n))throw n;Rl("Error using user provided cache. Falling back to memory cache: "+n),await Og(t,new wf)}}else je(_a,"Using default OfflineComponentProvider"),await Og(t,new fP(void 0));return t._offlineComponents}async function MC(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(je(_a,"Using user provided OnlineComponentProvider"),await tw(t,t._uninitializedComponentsProvider._online)):(je(_a,"Using default OnlineComponentProvider"),await tw(t,new vy))),t._onlineComponents}function gP(t){return MC(t).then((e=>e.syncEngine))}async function kC(t){const e=await MC(t),n=e.eventManager;return n.onListen=eP.bind(null,e.syncEngine),n.onUnlisten=rP.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=tP.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=iP.bind(null,e.syncEngine),n}function yP(t,e,n={}){const r=new ls;return t.asyncQueue.enqueueAndForget((async()=>(function(o,u,h,f,m){const g=new IC({next:b=>{g.Nu(),u.enqueueAndForget((()=>xC(o,_)));const x=b.docs.has(h);!x&&b.fromCache?m.reject(new Ae(_e.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&b.fromCache&&f&&f.source==="server"?m.reject(new Ae(_e.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(b)},error:b=>m.reject(b)}),_=new SC(t0(h.path),g,{includeMetadataChanges:!0,qa:!0});return vC(o,_)})(await kC(t),t.asyncQueue,e,n,r))),r.promise}function _P(t,e,n={}){const r=new ls;return t.asyncQueue.enqueueAndForget((async()=>(function(o,u,h,f,m){const g=new IC({next:b=>{g.Nu(),u.enqueueAndForget((()=>xC(o,_))),b.fromCache&&f.source==="server"?m.reject(new Ae(_e.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(b)},error:b=>m.reject(b)}),_=new SC(h,g,{includeMetadataChanges:!0,qa:!0});return vC(o,_)})(await kC(t),t.asyncQueue,e,n,r))),r.promise}function OC(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const nw=new Map;const NC="firestore.googleapis.com",rw=!0;class iw{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Ae(_e.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=NC,this.ssl=rw}else this.host=e.host,this.ssl=e.ssl??rw;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=lC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<YO)throw new Ae(_e.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}kk("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=OC(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Ae(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Ae(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Ae(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,a){return r.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class tm{constructor(e,n,r,a){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new iw({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ae(_e.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ae(_e.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new iw(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new wk;switch(r.type){case"firstParty":return new Ak(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Ae(_e.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=nw.get(n);r&&(je("ComponentProvider","Removing Datastore"),nw.delete(n),r.terminate())})(this),Promise.resolve()}}function bP(t,e,n,r={}){t=ti(t,tm);const a=ql(e),o=t._getSettings(),u={...o,emulatorOptions:t._getEmulatorOptions()},h=`${e}:${n}`;a&&(hE(`https://${h}`),fE("Firestore",!0)),o.host!==NC&&o.host!==h&&Rl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const f={...o,host:h,ssl:a,emulatorOptions:r};if(!ha(f,u)&&(t._setSettings(f),r.mockUserToken)){let m,g;if(typeof r.mockUserToken=="string")m=r.mockUserToken,g=Nn.MOCK_USER;else{m=O5(r.mockUserToken,t._app?.options.projectId);const _=r.mockUserToken.sub||r.mockUserToken.user_id;if(!_)throw new Ae(_e.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new Nn(_)}t._authCredentials=new Ek(new v1(m,g))}}class ec{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ec(this.firestore,e,this._query)}}class Wt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new da(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Wt(this.firestore,e,this._key)}toJSON(){return{type:Wt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(Hu(n,Wt._jsonSchema))return new Wt(e,r||null,new Ne(At.fromString(n.referencePath)))}}Wt._jsonSchemaVersion="firestore/documentReference/1.0",Wt._jsonSchema={type:an("string",Wt._jsonSchemaVersion),referencePath:an("string")};class da extends ec{constructor(e,n,r){super(e,n,t0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Wt(this.firestore,null,new Ne(e))}withConverter(e){return new da(this.firestore,e,this._path)}}function vP(t,e,...n){if(t=on(t),x1("collection","path",e),t instanceof tm){const r=At.fromString(e,...n);return yS(r),new da(t,null,r)}{if(!(t instanceof Wt||t instanceof da))throw new Ae(_e.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(At.fromString(e,...n));return yS(r),new da(t.firestore,null,r)}}function tc(t,e,...n){if(t=on(t),arguments.length===1&&(e=Ky.newId()),x1("doc","path",e),t instanceof tm){const r=At.fromString(e,...n);return gS(r),new Wt(t,null,new Ne(r))}{if(!(t instanceof Wt||t instanceof da))throw new Ae(_e.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(At.fromString(e,...n));return gS(r),new Wt(t.firestore,t instanceof da?t.converter:null,new Ne(r))}}const sw="AsyncQueue";class aw{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new hC(this,"async_queue_retry"),this._c=()=>{const r=kg();r&&je(sw,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=kg();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=kg();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new ls;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Jl(e))throw e;je(sw,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,hs("INTERNAL UNHANDLED ERROR: ",ow(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const a=m0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(a),a}uc(){this.nc&&ze(47125,{Pc:ow(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function ow(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class bo extends tm{constructor(e,n,r,a){super(e,n,r,a),this.type="firestore",this._queue=new aw,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new aw(e),this._firestoreClient=void 0,await e}}}function xP(t,e){const n=typeof t=="object"?t:yE(),r=typeof t=="string"?t:mf,a=Ny(n,"firestore").getImmediate({identifier:r});if(!a._initialized){const o=M5("firestore");o&&bP(a,...o)}return a}function nm(t){if(t._terminated)throw new Ae(_e.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||SP(t),t._firestoreClient}function SP(t){const e=t._freezeSettings(),n=(function(a,o,u,h){return new qk(a,o,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,OC(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new mP(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(a){const o=a?._online.build();return{_offline:a?._offline.build(o),_online:o}})(t._componentsProvider))}class kr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new kr(In.fromBase64String(e))}catch(n){throw new Ae(_e.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new kr(In.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:kr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Hu(e,kr._jsonSchema))return kr.fromBase64String(e.bytes)}}kr._jsonSchemaVersion="firestore/bytes/1.0",kr._jsonSchema={type:an("string",kr._jsonSchemaVersion),bytes:an("string")};class Xu{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Ae(_e.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Rn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class rm{constructor(e){this._methodName=e}}class ki{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Ae(_e.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Ae(_e.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return nt(this._lat,e._lat)||nt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ki._jsonSchemaVersion}}static fromJSON(e){if(Hu(e,ki._jsonSchema))return new ki(e.latitude,e.longitude)}}ki._jsonSchemaVersion="firestore/geoPoint/1.0",ki._jsonSchema={type:an("string",ki._jsonSchemaVersion),latitude:an("number"),longitude:an("number")};class Oi{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,a){if(r.length!==a.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==a[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Oi._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Hu(e,Oi._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Oi(e.vectorValues);throw new Ae(_e.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Oi._jsonSchemaVersion="firestore/vectorValue/1.0",Oi._jsonSchema={type:an("string",Oi._jsonSchemaVersion),vectorValues:an("object")};const wP=/^__.*__$/;class EP{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new wa(e,this.data,this.fieldMask,n,this.fieldTransforms):new Qu(e,this.data,n,this.fieldTransforms)}}class PC{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new wa(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function LC(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ze(40011,{Ac:t})}}class im{constructor(e,n,r,a,o,u){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=a,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new im({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Ef(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(LC(this.Ac)&&wP.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class CP{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Jf(e)}Cc(e,n,r,a=!1){return new im({Ac:e,methodName:n,Dc:r,path:Rn.emptyPath(),fc:!1,bc:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sm(t){const e=t._freezeSettings(),n=Jf(t._databaseId);return new CP(t._databaseId,!!e.ignoreUndefinedProperties,n)}function BC(t,e,n,r,a,o={}){const u=t.Cc(o.merge||o.mergeFields?2:0,e,n,a);v0("Data must be an object, but it was:",u,r);const h=VC(r,u);let f,m;if(o.merge)f=new fr(u.fieldMask),m=u.fieldTransforms;else if(o.mergeFields){const g=[];for(const _ of o.mergeFields){const b=xy(e,_,n);if(!u.contains(b))throw new Ae(_e.INVALID_ARGUMENT,`Field '${b}' is specified in your field mask but missing from your input data.`);$C(g,b)||g.push(b)}f=new fr(g),m=u.fieldTransforms.filter((_=>f.covers(_.field)))}else f=null,m=u.fieldTransforms;return new EP(new er(h),f,m)}class Ju extends rm{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ju}}function TP(t,e,n){return new im({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class b0 extends rm{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=TP(this,e,!0),r=this.vc.map((o=>nc(o,n))),a=new kl(r);return new gO(e.path,a)}isEqual(e){return e instanceof b0&&ha(this.vc,e.vc)}}function zC(t,e,n,r){const a=t.Cc(1,e,n);v0("Data must be an object, but it was:",a,r);const o=[],u=er.empty();Sa(r,((f,m)=>{const g=x0(e,f,n);m=on(m);const _=a.yc(g);if(m instanceof Ju)o.push(g);else{const b=nc(m,_);b!=null&&(o.push(g),u.set(g,b))}}));const h=new fr(o);return new PC(u,h,a.fieldTransforms)}function UC(t,e,n,r,a,o){const u=t.Cc(1,e,n),h=[xy(e,r,n)],f=[a];if(o.length%2!=0)throw new Ae(_e.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let b=0;b<o.length;b+=2)h.push(xy(e,o[b])),f.push(o[b+1]);const m=[],g=er.empty();for(let b=h.length-1;b>=0;--b)if(!$C(m,h[b])){const x=h[b];let E=f[b];E=on(E);const S=u.yc(x);if(E instanceof Ju)m.push(x);else{const T=nc(E,S);T!=null&&(m.push(x),g.set(x,T))}}const _=new fr(m);return new PC(g,_,u.fieldTransforms)}function AP(t,e,n,r=!1){return nc(n,t.Cc(r?4:3,e))}function nc(t,e){if(FC(t=on(t)))return v0("Unsupported field value:",e,t),VC(t,e);if(t instanceof rm)return(function(r,a){if(!LC(a.Ac))throw a.Sc(`${r._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(a);o&&a.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,a){const o=[];let u=0;for(const h of r){let f=nc(h,a.wc(u));f==null&&(f={nullValue:"NULL_VALUE"}),o.push(f),u++}return{arrayValue:{values:o}}})(t,e)}return(function(r,a){if((r=on(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return fO(a.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Dt.fromDate(r);return{timestampValue:vf(a.serializer,o)}}if(r instanceof Dt){const o=new Dt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:vf(a.serializer,o)}}if(r instanceof ki)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof kr)return{bytesValue:tC(a.serializer,r._byteString)};if(r instanceof Wt){const o=a.databaseId,u=r.firestore._databaseId;if(!u.isEqual(o))throw a.Sc(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:s0(r.firestore._databaseId||a.databaseId,r._key.path)}}if(r instanceof Oi)return(function(u,h){return{mapValue:{fields:{[D1]:{stringValue:I1},[pf]:{arrayValue:{values:u.toArray().map((m=>{if(typeof m!="number")throw h.Sc("VectorValues must only contain numeric values.");return n0(h.serializer,m)}))}}}}}})(r,a);throw a.Sc(`Unsupported field value: ${Ff(r)}`)})(t,e)}function VC(t,e){const n={};return E1(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Sa(t,((r,a)=>{const o=nc(a,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function FC(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Dt||t instanceof ki||t instanceof kr||t instanceof Wt||t instanceof rm||t instanceof Oi)}function v0(t,e,n){if(!FC(n)||!S1(n)){const r=Ff(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function xy(t,e,n){if((e=on(e))instanceof Xu)return e._internalPath;if(typeof e=="string")return x0(t,e);throw Ef("Field path arguments must be of type string or ",t,!1,void 0,n)}const jP=new RegExp("[~\\*/\\[\\]]");function x0(t,e,n){if(e.search(jP)>=0)throw Ef(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Xu(...e.split("."))._internalPath}catch{throw Ef(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ef(t,e,n,r,a){const o=r&&!r.isEmpty(),u=a!==void 0;let h=`Function ${e}() called with invalid data`;n&&(h+=" (via `toFirestore()`)"),h+=". ";let f="";return(o||u)&&(f+=" (found",o&&(f+=` in field ${r}`),u&&(f+=` in document ${a}`),f+=")"),new Ae(_e.INVALID_ARGUMENT,h+t+f)}function $C(t,e){return t.some((n=>n.isEqual(e)))}class qC{constructor(e,n,r,a,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=a,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Wt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new RP(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(S0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class RP extends qC{data(){return super.data()}}function S0(t,e){return typeof e=="string"?x0(t,e):e instanceof Xu?e._internalPath:e._delegate._internalPath}function DP(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Ae(_e.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class w0{}class IP extends w0{}function MP(t,e,...n){let r=[];e instanceof w0&&r.push(e),r=r.concat(n),(function(o){const u=o.filter((f=>f instanceof E0)).length,h=o.filter((f=>f instanceof am)).length;if(u>1||u>0&&h>0)throw new Ae(_e.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const a of r)t=a._apply(t);return t}class am extends IP{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new am(e,n,r)}_apply(e){const n=this._parse(e);return HC(e._query,n),new ec(e.firestore,e.converter,uy(e._query,n))}_parse(e){const n=sm(e.firestore);return(function(o,u,h,f,m,g,_){let b;if(m.isKeyField()){if(g==="array-contains"||g==="array-contains-any")throw new Ae(_e.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if(g==="in"||g==="not-in"){cw(_,g);const E=[];for(const S of _)E.push(lw(f,o,S));b={arrayValue:{values:E}}}else b=lw(f,o,_)}else g!=="in"&&g!=="not-in"&&g!=="array-contains-any"||cw(_,g),b=AP(h,u,_,g==="in"||g==="not-in");return sn.create(m,g,b)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function kP(t,e,n){const r=e,a=S0("where",t);return am._create(a,r,n)}class E0 extends w0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new E0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:ni.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(a,o){let u=a;const h=o.getFlattenedFilters();for(const f of h)HC(u,f),u=uy(u,f)})(e._query,n),new ec(e.firestore,e.converter,uy(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function lw(t,e,n){if(typeof(n=on(n))=="string"){if(n==="")throw new Ae(_e.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!z1(e)&&n.indexOf("/")!==-1)throw new Ae(_e.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(At.fromString(n));if(!Ne.isDocumentKey(r))throw new Ae(_e.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return CS(t,new Ne(r))}if(n instanceof Wt)return CS(t,n._key);throw new Ae(_e.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ff(n)}.`)}function cw(t,e){if(!Array.isArray(t)||t.length===0)throw new Ae(_e.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function HC(t,e){const n=(function(a,o){for(const u of a)for(const h of u.getFlattenedFilters())if(o.indexOf(h.op)>=0)return h.op;return null})(t.filters,(function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Ae(_e.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ae(_e.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class OP{convertValue(e,n="none"){switch(ga(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Qt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(pa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw ze(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Sa(e,((a,o)=>{r[a]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[pf].arrayValue?.values?.map((r=>Qt(r.doubleValue)));return new Oi(n)}convertGeoPoint(e){return new ki(Qt(e.latitude),Qt(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Hf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(ju(e));default:return null}}convertTimestamp(e){const n=ma(e);return new Dt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=At.fromString(e);pt(oC(r),9688,{name:e});const a=new Ru(r.get(1),r.get(3)),o=new Ne(r.popFirst(5));return a.isEqual(n)||hs(`Document ${o} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function GC(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class pu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class oo extends qC{constructor(e,n,r,a,o,u){super(e,n,r,a,u),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Jh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(S0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Ae(_e.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=oo._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}oo._jsonSchemaVersion="firestore/documentSnapshot/1.0",oo._jsonSchema={type:an("string",oo._jsonSchemaVersion),bundleSource:an("string","DocumentSnapshot"),bundleName:an("string"),bundle:an("string")};class Jh extends oo{data(e={}){return super.data(e)}}class El{constructor(e,n,r,a){this._firestore=e,this._userDataWriter=n,this._snapshot=a,this.metadata=new pu(a.hasPendingWrites,a.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new Jh(this._firestore,this._userDataWriter,r.key,r,new pu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Ae(_e.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(a,o){if(a._snapshot.oldDocs.isEmpty()){let u=0;return a._snapshot.docChanges.map((h=>{const f=new Jh(a._firestore,a._userDataWriter,h.doc.key,h.doc,new pu(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);return h.doc,{type:"added",doc:f,oldIndex:-1,newIndex:u++}}))}{let u=a._snapshot.oldDocs;return a._snapshot.docChanges.filter((h=>o||h.type!==3)).map((h=>{const f=new Jh(a._firestore,a._userDataWriter,h.doc.key,h.doc,new pu(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);let m=-1,g=-1;return h.type!==0&&(m=u.indexOf(h.doc.key),u=u.delete(h.doc.key)),h.type!==1&&(u=u.add(h.doc),g=u.indexOf(h.doc.key)),{type:NP(h.type),doc:f,oldIndex:m,newIndex:g}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Ae(_e.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=El._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ky.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],a=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),a.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function NP(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ze(61501,{type:t})}}function PP(t){t=ti(t,Wt);const e=ti(t.firestore,bo);return yP(nm(e),t._key).then((n=>VP(e,t,n)))}El._jsonSchemaVersion="firestore/querySnapshot/1.0",El._jsonSchema={type:an("string",El._jsonSchemaVersion),bundleSource:an("string","QuerySnapshot"),bundleName:an("string"),bundle:an("string")};class QC extends OP{constructor(e){super(),this.firestore=e}convertBytes(e){return new kr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Wt(this.firestore,null,n)}}function LP(t){t=ti(t,ec);const e=ti(t.firestore,bo),n=nm(e),r=new QC(e);return DP(t._query),_P(n,t._query).then((a=>new El(e,r,t,a)))}function BP(t,e,n){t=ti(t,Wt);const r=ti(t.firestore,bo),a=GC(t.converter,e,n);return om(r,[BC(sm(r),"setDoc",t._key,a,t.converter!==null,n).toMutation(t._key,tr.none())])}function zP(t,e,n,...r){t=ti(t,Wt);const a=ti(t.firestore,bo),o=sm(a);let u;return u=typeof(e=on(e))=="string"||e instanceof Xu?UC(o,"updateDoc",t._key,e,n,r):zC(o,"updateDoc",t._key,e),om(a,[u.toMutation(t._key,tr.exists(!0))])}function UP(t){return om(ti(t.firestore,bo),[new Yf(t._key,tr.none())])}function om(t,e){return(function(r,a){const o=new ls;return r.asyncQueue.enqueueAndForget((async()=>sP(await gP(r),a,o))),o.promise})(nm(t),e)}function VP(t,e,n){const r=n.docs.get(e._key),a=new QC(t);return new oo(t,a,e._key,r,new pu(n.hasPendingWrites,n.fromCache),e.converter)}class FP{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=sm(e)}set(e,n,r){this._verifyNotCommitted();const a=Ng(e,this._firestore),o=GC(a.converter,n,r),u=BC(this._dataReader,"WriteBatch.set",a._key,o,a.converter!==null,r);return this._mutations.push(u.toMutation(a._key,tr.none())),this}update(e,n,r,...a){this._verifyNotCommitted();const o=Ng(e,this._firestore);let u;return u=typeof(n=on(n))=="string"||n instanceof Xu?UC(this._dataReader,"WriteBatch.update",o._key,n,r,a):zC(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(u.toMutation(o._key,tr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Ng(e,this._firestore);return this._mutations=this._mutations.concat(new Yf(n._key,tr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Ae(_e.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ng(t,e){if((t=on(t)).firestore!==e)throw new Ae(_e.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function uw(){return new Ju("deleteField")}function $P(...t){return new b0("arrayUnion",t)}function WC(t){return nm(t=ti(t,bo)),new FP(t,(e=>om(t,e)))}(function(e,n=!0){(function(a){Yl=a})(Hl),Al(new lo("firestore",((r,{instanceIdentifier:a,options:o})=>{const u=r.getProvider("app").getImmediate(),h=new bo(new Ck(r.getProvider("auth-internal")),new jk(u,r.getProvider("app-check-internal")),(function(m,g){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new Ae(_e.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ru(m.options.projectId,g)})(u,a),u);return o={useFetchStreams:n,...o},h._setSettings(o),h}),"PUBLIC").setMultipleInstances(!0)),oa(hS,fS,e),oa(hS,fS,"esm2020")})();function vo(){return xP(ZE)}const Fn={showGroupTotals:!1};function xo(t,e,n,r=1,a){{let o=e;if(e.startsWith("budgets/"))o="budgets";else if(e.startsWith("months/")){const f=e.replace("months/","").split("_");if(f.length>=2){const m=f[f.length-1];o=`months/${f[f.length-2]}/${m}`}}console.log(`[Firebase] ${t}(${r}): ${o}${a===!1?" [NOT FOUND]":""}  ${n}`)}}async function We(t,e,n){const r=tc(vo(),t,e),a=`${t}/${e}`,o=await PP(r),u=o.exists();return xo("READ",a,n,1,u),{exists:u,data:u?o.data():null,ref:r}}async function pn(t,e,n){const r=vo(),a=vP(r,t);let o;if(n&&n.length>0){const f=n.map(m=>kP(m.field,m.op,m.value));o=MP(a,...f)}else o=a;const u=await LP(o);let h=t;if(n&&n.length>0){const f=n.map(m=>`${m.field} ${m.op} ${JSON.stringify(m.value)}`).join(", ");h+=` WHERE ${f}`}return xo("QUERY",h,e,u.docs.length),{docs:u.docs.map(f=>({id:f.id,data:f.data()}))}}async function mt(t,e,n,r,a){const o=tc(vo(),t,e),u=`${t}/${e}`;return xo("WRITE",u,r),BP(o,n,a??{})}async function lm(t,e){const r=vo();for(let a=0;a<t.length;a+=500){const o=t.slice(a,a+500),u=WC(r);for(const{collectionPath:h,docId:f,data:m}of o){const g=tc(r,h,f);u.set(g,m)}xo("BATCH_WRITE",`${o.length} docs`,e,o.length),await u.commit()}}async function Pl(t,e,n,r){const a=tc(vo(),t,e),o=`${t}/${e}`;return xo("UPDATE",o,r),zP(a,n)}async function KC(t,e,n){const r=tc(vo(),t,e),a=`${t}/${e}`;return xo("DELETE",a,n),UP(r)}async function qP(t,e,n){const a=vo();for(let o=0;o<t.length;o+=500){const u=t.slice(o,o+500),h=WC(a);for(const{collectionPath:f,docId:m}of u){const g=tc(a,f,m);h.delete(g)}xo("BATCH_DELETE",`${u.length} docs`,e,u.length),await h.commit(),n?.(o+u.length)}}function HP(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??null,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function GP(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget,is_active:r.is_active}}),e}function QP(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??null,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0}}),e}function WP(t=[]){const e=t.map(n=>({id:n.id,name:n.name,sort_order:n.sort_order??0}));return e.sort((n,r)=>n.sort_order-r.sort_order),e}function KP(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}async function YP(t){const{exists:e,data:n}=await We("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=HP(n.accounts),a=GP(n.account_groups),o=QP(n.categories),u=WP(n.category_groups),h=n.total_available??0,f=KP(n.month_map),m=n.is_needs_recalculation??!1;return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:a,categories:o,category_groups:u,total_available:h,is_needs_recalculation:m,month_map:f},accounts:r,accountGroups:a,categories:o,categoryGroups:u,isNeedsRecalculation:m,monthMap:f}}function YC(t,e){return Kl({queryKey:t?Se.budget(t):["budget","none"],queryFn:()=>YP(t),enabled:!!t&&e?.enabled!==!1})}function Nr(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function Cf(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function XP(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function It(t,e){return`${t}${e.toString().padStart(2,"0")}`}function Sy(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function Ee(t){return Math.round((t+Number.EPSILON)*100)/100}function ot(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function JP(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??It(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function ZP(t,e,n,r){const a=Nr(t,e,n);return(await Qe.fetchQuery({queryKey:Se.month(t,e,n),queryFn:async()=>{const{exists:u,data:h}=await We("months",a,r?.description??`reading month ${e}/${n}`);return!u||!h?null:{month:JP(h,t,e,n)}},staleTime:h1}))?.month??null}async function zn(t,e,n,r){const a=Nr(t,e,n),o=r?`PRE-EDIT-READ: ${r}`:"PRE-EDIT-READ",{exists:u,data:h}=await We("months",a,o);if(!u||!h)throw new Error(`Month data not found for ${e}/${n}`);return h}async function e4(t,e,n){const r=It(e,n);return(await pn("months","getFutureMonths: querying months after specified month",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">",value:r}])).docs.map(u=>({id:u.id,...u.data})).sort((u,h)=>u.year!==h.year?u.year-h.year:u.month-h.month)}function t4(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}const io={mobile:640,tablet:768,wide:1200},n4=io.mobile,Cl=["January","February","March","April","May","June","July","August","September","October","November","December"],Mu=3,Tf=3,Lt="__NO_CATEGORY__",ba="No Category";function Je(t){return t===Lt}const Ot="__NO_ACCOUNT__",Pi="No Account";function Pe(t){return t===Ot}const C0={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function T0(t,e){const n=r4(t),r=i4(t.category_balances,e.categoryEndBalances,n),a=s4(t,e.accountEndBalances);return{...t,previous_month_income:e.totalIncome,category_balances:r,account_balances:a,updated_at:new Date().toISOString()}}function r4(t){const e={};for(const n of t.transfers||[])Je(n.from_category_id)||(e[n.from_category_id]=(e[n.from_category_id]||0)-n.amount),Je(n.to_category_id)||(e[n.to_category_id]=(e[n.to_category_id]||0)+n.amount);for(const n of t.adjustments||[])Je(n.category_id)||(e[n.category_id]=(e[n.category_id]||0)+n.amount);for(const n of Object.keys(e))e[n]=Ee(e[n]);return e}function i4(t,e,n){const r=new Map;for(const u of t)Je(u.category_id)||r.set(u.category_id,u);const a=new Set;for(const u of t)Je(u.category_id)||a.add(u.category_id);for(const u of Object.keys(e))Je(u)||a.add(u);for(const u of Object.keys(n))Je(u)||a.add(u);const o=[];for(const u of a){const h=r.get(u),f=Ee(e[u]??0),m=Ee(h?.allocated??0),g=Ee(h?.spent??0),_=Ee(n[u]??0);o.push({category_id:u,start_balance:f,allocated:m,spent:g,end_balance:Ee(f+m+g+_)})}return o}function s4(t,e){const n=new Set;for(const a of t.income||[])Pe(a.account_id)||n.add(a.account_id);for(const a of t.expenses||[])Pe(a.account_id)||n.add(a.account_id);for(const a of t.transfers||[])Pe(a.from_account_id)||n.add(a.from_account_id),Pe(a.to_account_id)||n.add(a.to_account_id);for(const a of t.adjustments||[])Pe(a.account_id)||n.add(a.account_id);for(const a of Object.keys(e))Pe(a)||n.add(a);for(const a of t.account_balances||[])Pe(a.account_id)||n.add(a.account_id);const r=[];for(const a of n){const o=Ee(e[a]??0),u=Ee((t.income||[]).filter(b=>b.account_id===a).reduce((b,x)=>b+x.amount,0)),h=Ee((t.expenses||[]).filter(b=>b.account_id===a).reduce((b,x)=>b+x.amount,0)),f=Ee((t.transfers||[]).filter(b=>b.from_account_id===a).reduce((b,x)=>b-x.amount,0)),m=Ee((t.transfers||[]).filter(b=>b.to_account_id===a).reduce((b,x)=>b+x.amount,0)),g=Ee((t.adjustments||[]).filter(b=>b.account_id===a).reduce((b,x)=>b+x.amount,0)),_=Ee(u+h+f+m+g);r.push({account_id:a,start_balance:o,income:u,expenses:h,net_change:_,end_balance:Ee(o+_)})}return r}function Af(t){const e={},n={};for(const r of t.category_balances||[])Je(r.category_id)||(e[r.category_id]=Ee(r.end_balance));for(const r of t.account_balances||[])Pe(r.account_id)||(n[r.account_id]=Ee(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:Ee(t.total_income)}}const a4=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function o4(t){return{year:parseInt(t.slice(0,4),10),month:parseInt(t.slice(4,6),10)}}function XC(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}function l4(t){return Object.entries(t).filter(([,e])=>e.needs_recalculation).map(([e])=>e).sort()}function c4(t){return Object.keys(t).sort()}async function u4(t,e){const{year:n,month:r}=o4(e),a=Nr(t,n,r),{exists:o,data:u}=await We("months",a,`[recalc] fetching month ${n}/${r}`);return!o||!u?null:{id:a,budget_id:t,year_month_ordinal:u.year_month_ordinal??It(n,r),year:u.year??n,month:u.month??r,income:u.income||[],total_income:u.total_income??0,previous_month_income:u.previous_month_income??0,expenses:u.expenses||[],total_expenses:u.total_expenses??0,transfers:u.transfers||[],adjustments:u.adjustments||[],account_balances:u.account_balances||[],category_balances:u.category_balances||[],are_allocations_finalized:u.are_allocations_finalized??!1,created_at:u.created_at,updated_at:u.updated_at}}async function d4(t,e,n){n?.(0,e.length);const r=await Promise.all(e.map(a=>u4(t,a)));return n?.(e.length,e.length),r.filter(a=>a!==null)}function A0(t){const e={};for(const n of Object.keys(t))e[n]={needs_recalculation:!1};return e}function JC(t,e,n){const r=Object.entries(t).reduce((o,[,u])=>{const h=u.account_group_id?n[u.account_group_id]:void 0,f=h?.on_budget!==void 0?h.on_budget:u.on_budget!==!1,m=h?.is_active!==void 0?h.is_active:u.is_active!==!1;return f&&m?o+(u.balance??0):o},0),a=Object.values(e).reduce((o,u)=>{const h=u.balance??0;return o+(h>0?h:0)},0);return Ee(r-a)}async function ZC(t,e,n,r){const{exists:a,data:o}=await We("budgets",t,"[recalc] reading budget for balance update");if(!a||!o)return;const u={...o.accounts};for(const[g,_]of Object.entries(e))u[g]&&(u[g]={...u[g],balance:Ee(_)});const h={...o.categories};for(const[g,_]of Object.entries(n))h[g]&&(h[g]={...h[g],balance:Ee(_)});const f=A0(r),m=JC(u,h,o.account_groups||{});await mt("budgets",t,{...o,accounts:u,categories:h,total_available:m,is_needs_recalculation:!1,month_map:f,updated_at:new Date().toISOString()},"[recalc] saving balances and clearing flags"),f4(t,u,h,m,f)}function h4(t,e){const n=Qe.getQueryData(Se.budget(t));n&&Qe.setQueryData(Se.budget(t),{...n,isNeedsRecalculation:!1,monthMap:e,budget:{...n.budget,is_needs_recalculation:!1,month_map:e}})}function f4(t,e,n,r,a){const o=Qe.getQueryData(Se.budget(t));if(o){const u={};for(const[f,m]of Object.entries(o.accounts)){const g=e[f];u[f]=g?{...m,balance:g.balance??m.balance}:m}const h={};for(const[f,m]of Object.entries(o.categories)){const g=n[f];h[f]=g?{...m,balance:g.balance??m.balance}:m}Qe.setQueryData(Se.budget(t),{...o,accounts:u,categories:h,isNeedsRecalculation:!1,monthMap:a,budget:{...o.budget,accounts:e,categories:n,total_available:r,is_needs_recalculation:!1,month_map:a}})}}async function dw(t,e){const{exists:n,data:r}=await We("budgets",t,"[recalc] reading budget to clear flags");if(!n||!r)return;const a=A0(e);await mt("budgets",t,{...r,total_available:JC(r.accounts||{},r.categories||{},r.account_groups||{}),is_needs_recalculation:!1,month_map:a,updated_at:new Date().toISOString()},"[recalc] clearing flags"),h4(t,a)}const Pg=new Map;async function cm(t,e={}){const n=Pg.get(t);if(n)return n;const r=m4(t,e);Pg.set(t,r);try{return await r}finally{Pg.delete(t)}}async function m4(t,e={}){const{onProgress:n}=e;n?.({phase:"reading-budget",monthsProcessed:0,totalMonths:0,percentComplete:5});const{exists:r,data:a}=await We("budgets",t,"[recalc] reading budget for month_map");if(!r||!a)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const o=XC(a.month_map),u=l4(o);if(u.length===0&&!a.is_needs_recalculation)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const h=c4(o),f=u.length>0?u[0]:null;if(!f)return await dw(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const m=h.indexOf(f),g=m>0,_=g?h.slice(m-1):h.slice(m),b=g?_.length-1:_.length;n?.({phase:"fetching-months",monthsFetched:0,totalMonthsToFetch:_.length,monthsProcessed:0,totalMonths:b,percentComplete:10});const x=await d4(t,_,(P,k)=>{n?.({phase:"fetching-months",monthsFetched:P,totalMonthsToFetch:k,monthsProcessed:0,totalMonths:b,percentComplete:P===0?10:30})});if(x.length===0)return await dw(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const E=g?1:0,S=x.length-1,T=S-E+1;let D=C0;g&&x.length>0&&(D=Af(x[0]));const j=[];let M=0;for(let P=E;P<=S;P++){const k=x[P],O=`${a4[k.month-1]} ${k.year}`;n?.({phase:"recalculating",currentMonth:O,monthsProcessed:M,totalMonths:T,percentComplete:Math.round(30+M/T*40)});const N=T0(k,D);j.push(N),D=Af(N),M++}n?.({phase:"saving",monthsProcessed:M,totalMonths:T,percentComplete:75});const K=j.map(P=>({collectionPath:"months",docId:Nr(t,P.year,P.month),data:P}));await lm(K,`[recalc] batch write ${j.length} months`);for(const P of j)Qe.setQueryData(Se.month(t,P.year,P.month),{month:P});n?.({phase:"saving",monthsProcessed:M,totalMonths:T,percentComplete:92});const H=D.accountEndBalances,Q=D.categoryEndBalances;return await ZC(t,H,Q,o),n?.({phase:"complete",monthsProcessed:M,totalMonths:T,percentComplete:100}),{monthsRecalculated:M,budgetUpdated:!0,finalAccountBalances:H}}function p4(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let a=Tf;a>0;a--){let o=e,u=n-a;for(;u<1;)u+=12,o-=1;r.push(It(o,u))}r.push(It(e,n));for(let a=1;a<=Mu;a++){let o=e,u=n+a;for(;u>12;)u-=12,o+=1;r.push(It(o,u))}return r}function g4(t,e){const n=Se.budget(t),r=Qe.getQueryData(n);if(!r?.monthMap)return!1;for(const[a,o]of Object.entries(r.monthMap))if(a>=e&&!o.needs_recalculation)return!1;return!0}function y4(t,e,n){const r=Se.budget(t),a=Qe.getQueryData(r);a&&Qe.setQueryData(r,{...a,isNeedsRecalculation:!0,monthMap:n,budget:{...a.budget,is_needs_recalculation:!0,month_map:n}})}function _4(t,e){const n=Se.budget(t),r=Qe.getQueryData(n);r&&Qe.setQueryData(n,{...r,monthMap:e,budget:{...r.budget,month_map:e}})}async function b4(t,e,n){const r=It(e,n);if(g4(t,r))return{markedCount:0,budgetUpdated:!1};const{exists:a,data:o}=await We("budgets",t,"reading budget for month_map update");if(!a||!o)return console.warn(`[markMonthsNeedRecalculation] Budget ${t} not found`),{markedCount:0,budgetUpdated:!1};const h={...o.month_map||{}},f=p4();for(const b of f)h[b]||(h[b]={needs_recalculation:!1});let m=0;for(const b of f)b>=r&&(h[b]?.needs_recalculation||(h[b]={needs_recalculation:!0},m++));const g=o.is_needs_recalculation===!0;if(m===0&&g)return{markedCount:0,budgetUpdated:!1};const _=h;return y4(t,r,_),await Pl("budgets",t,{is_needs_recalculation:!0,month_map:_,updated_at:new Date().toISOString()},`marking budget and ${m} future months as needing recalculation`),{markedCount:m,budgetUpdated:!0}}async function v4(t,e,n,r=!1){const a=It(e,n),{exists:o,data:u}=await We("budgets",t,"reading budget for month_map update (add month)");if(!o||!u){console.warn(`[setMonthInBudgetMap] Budget ${t} not found`);return}const f={...u.month_map||{},[a]:{needs_recalculation:r}},m=f;_4(t,m),await Pl("budgets",t,{month_map:m,updated_at:new Date().toISOString()},`adding month ${e}/${n} to budget month_map`)}async function eT(t,e,n,r){const{bypassDateLimit:a=!1}=r??{},o=new Date,u=o.getFullYear(),h=o.getMonth()+1,f=(e-u)*12+(n-h);if(!a&&f>Mu){const j=`[createMonth] Refusing to create month ${e}/${n} - it's ${f} months in the future (max allowed: ${Mu}). This likely indicates a bug in month navigation.`;throw console.error(j),new Error(j)}if(!a&&f<-Tf){const j=`[createMonth] Refusing to create month ${e}/${n} - it's ${Math.abs(f)} months in the past (max allowed: ${Tf}). Existing months can still be viewed, but new months cannot be created this far back.`;throw console.error(j),new Error(j)}const m=o.toISOString(),g=Nr(t,e,n);let _=0,b={},x={};if(n>1||e>new Date().getFullYear()-10){const{year:j,month:M}=Cf(e,n),K=Nr(t,j,M),{exists:H,data:Q}=await We("months",K,"fetching previous month to create start balances for new month");if(H&&Q){const P={year_month_ordinal:Q.year_month_ordinal??It(j,M),year:Q.year??j,month:Q.month??M,income:Q.income||[],total_income:Q.total_income??0,previous_month_income:Q.previous_month_income??0,expenses:Q.expenses||[],total_expenses:Q.total_expenses??0,transfers:Q.transfers||[],adjustments:Q.adjustments||[],account_balances:Q.account_balances||[],category_balances:Q.category_balances||[],are_allocations_finalized:Q.are_allocations_finalized??!1,created_at:Q.created_at,updated_at:Q.updated_at};_=P.total_income;const{categoryEndBalances:k,accountEndBalances:O}=t4(P);b=k,x=O}}const E=Object.entries(b).map(([j,M])=>({category_id:j,start_balance:M,allocated:0,spent:0,end_balance:M})),S=Object.entries(x).map(([j,M])=>({account_id:j,start_balance:M,income:0,expenses:0,net_change:0,end_balance:M})),T={budget_id:t,year_month_ordinal:It(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:_,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:S,category_balances:E,are_allocations_finalized:!1,created_at:m,updated_at:m},D={budget_id:t,year_month_ordinal:It(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:_,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:S,category_balances:E,are_allocations_finalized:!1,created_at:m,updated_at:m};return await mt("months",g,D,"creating new month document (first time viewing this month)"),Qe.setQueryData(Se.month(t,e,n),{month:T}),await v4(t,e,n,!1),T}function x4(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??It(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function S4(t,e,n){const r=Nr(t,e,n),{exists:a,data:o}=await We("months",r,`loading month ${e}/${n}`);return!a||!o?null:x4(o,t,e,n)}async function w4(t,e,n){const r=await S4(t,e,n);return r||eT(t,e,n)}function E4(t,e,n,r){return Kl({queryKey:t?Se.month(t,e,n):["month","none"],queryFn:async()=>({month:await w4(t,e,n)}),enabled:!!t&&r?.enabled!==!1})}async function C4(t){const{exists:e,data:n}=await We("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function tT(t,e){return Kl({queryKey:t?Se.payees(t):["payees","none"],queryFn:()=>C4(t),enabled:!!t&&e?.enabled!==!1})}async function T4(t,e){const{exists:n,data:r}=await We("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const a={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await mt("users",t,a,"creating new user document (first login)"),a}function A4(t,e,n){return Kl({queryKey:t?Se.user(t):["user","none"],queryFn:()=>T4(t,e),enabled:!!t&&n?.enabled!==!1})}async function j4(t,e){const n=await pn("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],a=[];for(const o of n.docs){const u=o.data;u.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:u.name||"Unnamed Budget",ownerEmail:u.owner_email||null,isOwner:u.owner_id===t,isPending:!1}):a.push({budgetId:o.id,budgetName:u.name||"Unnamed Budget",ownerEmail:u.owner_email||null})}return{budgets:r,pendingInvites:a}}function R4(t,e,n){return Kl({queryKey:t?Se.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?j4(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function D4(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function I4(){const t=await pn("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=D4(n.data.items),a=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:a})})}return{items:e}}function M4(t){return Kl({queryKey:Se.feedback(),queryFn:I4,enabled:t?.enabled!==!1})}async function k4(t,e){return Qe.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await We("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function wy(t,e,n){const r=await ZP(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function O4(t,e,n,r){const a={};e.forEach(b=>{a[b]=0});const o=await wy(t,n,r);if(o?.category_balances){for(const b of o.category_balances)e.includes(b.category_id)&&(a[b.category_id]=b.end_balance);return a}const u={};e.forEach(b=>{u[b]=0});const h=[];o&&h.push(o);let f=n,m=r,g=!1;const _=120;for(let b=0;b<_&&!g;b++){const x=Cf(f,m);f=x.year,m=x.month;const E=await wy(t,f,m);if(!E)g=!0;else if(E.category_balances){g=!0;for(const S of E.category_balances)e.includes(S.category_id)&&(u[S.category_id]=S.end_balance)}else h.push(E)}h.reverse(),Object.assign(a,u);for(const b of h){if(b.are_allocations_finalized&&b.category_balances)for(const x of b.category_balances)e.includes(x.category_id)&&(a[x.category_id]=(a[x.category_id]||0)+x.allocated);if(b.expenses)for(const x of b.expenses)e.includes(x.category_id)&&(a[x.category_id]=(a[x.category_id]||0)-x.amount)}return a}async function N4(t,e,n,r,a){const o={...n};let u=r,h=a;const f=24;for(let m=0;m<f;m++){const g=XP(u,h);u=g.year,h=g.month;const _=await wy(t,u,h);if(!_)break;if(_.are_allocations_finalized&&_.category_balances)for(const b of _.category_balances)e.includes(b.category_id)&&(o[b.category_id]=(o[b.category_id]||0)+b.allocated);if(_.expenses)for(const b of _.expenses)e.includes(b.category_id)&&(o[b.category_id]=(o[b.category_id]||0)-b.amount)}return o}async function hw(t,e,n,r){const a=await O4(t,e,n,r),o=await N4(t,e,a,n,r);return{current:a,total:o}}async function nT(t,e,n){const r=Nr(t,e.year,e.month);await mt("months",r,e,`writeMonthData: ${n}`)}async function rT(t,e,n){await b4(t,e,n)}async function P4(t){const{budgetId:e,month:n,description:r,cascadeRecalculation:a=!0}=t;await nT(e,n,r||`${n.year}/${n.month}`),Qe.setQueryData(Se.month(e,n.year,n.month),{month:n}),a&&await rT(e,n.year,n.month)}function qn(){const t=gn();return{writeData:yr({mutationFn:async({budgetId:n,month:r,description:a,cascadeRecalculation:o=!0})=>(await nT(n,r,a||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,cascadeRecalculation:o}),onMutate:async({budgetId:n,month:r})=>{const a=Se.month(n,r.year,r.month);await t.cancelQueries({queryKey:a});const o=t.getQueryData(a);return t.setQueryData(a,{month:r}),{oldMonthQueryData:o,monthKey:a}},onSuccess:async({budgetId:n,year:r,month:a,cascadeRecalculation:o})=>{o&&await rT(n,r,a)},onError:(n,r,a)=>{a?.oldMonthQueryData&&t.setQueryData(a.monthKey,a.oldMonthQueryData)}})}}function L4(t,e,n,r){const a={};t.category_balances&&t.category_balances.forEach(u=>{a[u.category_id]=u});const o=t.expenses??[];return e.map(u=>{const h=a[u],f=Ee(h?.start_balance??0),m=Ee(n[u]??0),g=Ee(o.filter(_=>_.category_id===u).reduce((_,b)=>_+b.amount,0));return{category_id:u,start_balance:f,allocated:m,spent:g,end_balance:Ee(f+m+g)}})}function B4(){const{writeData:t}=qn();return{saveDraftAllocations:async(n,r,a,o)=>{const u=await zn(n,r,a,"save draft allocations"),h=u.category_balances.map(m=>({...m,allocated:o[m.category_id]??m.allocated})),f={...u,category_balances:h,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:f,cascadeRecalculation:!1}),{updatedMonth:f}},isPending:t.isPending,isError:t.isError,error:t.error}}function z4(){const{writeData:t}=qn();return{finalizeAllocations:async n=>{const{budgetId:r,year:a,month:o,allocations:u,onProgress:h}=n;h?.({phase:"saving",message:"Saving allocations..."});const f=await zn(r,a,o,"finalize allocations"),m=f.category_balances?.map(x=>x.category_id)??[],g=m.length>0?m:Object.keys(u),_=g.length>0?L4(f,g,u):f.category_balances,b={...f,category_balances:_,are_allocations_finalized:!0,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:r,month:b,description:"finalize allocations"}),h?.({phase:"recalculating",message:"Recalculating month balances..."}),await cm(r,{triggeringMonthOrdinal:`${a}${String(o).padStart(2,"0")}`,onProgress:x=>{let E="Recalculating balances...";x.phase==="fetching-months"?E=`Loading month data (${x.monthsFetched}/${x.totalMonthsToFetch})...`:x.phase==="recalculating"&&x.currentMonth?E=`Recalculating ${x.currentMonth}...`:x.phase==="saving"&&(E="Saving recalculated balances..."),h?.({phase:"recalculating",message:E,recalcProgress:x})}}),await Qe.refetchQueries({queryKey:Se.month(r,a,o)}),await Qe.refetchQueries({queryKey:Se.budget(r)}),h?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:b}},isPending:t.isPending,isError:t.isError,error:t.error}}function iT(){const{writeData:t}=qn();return{deleteAllocations:async n=>{const{budgetId:r,year:a,month:o,onProgress:u}=n;u?.({phase:"saving",message:"Deleting allocations..."});const h=await zn(r,a,o,"delete allocations"),f=h.category_balances.map(g=>({...g,allocated:0,end_balance:g.start_balance-g.spent})),m={...h,category_balances:f,are_allocations_finalized:!1,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:r,month:m,description:"delete allocations"}),u?.({phase:"recalculating",message:"Recalculating month balances..."}),await cm(r,{triggeringMonthOrdinal:`${a}${String(o).padStart(2,"0")}`,onProgress:g=>{let _="Recalculating balances...";g.phase==="fetching-months"?_=`Loading month data (${g.monthsFetched}/${g.totalMonthsToFetch})...`:g.phase==="recalculating"&&g.currentMonth?_=`Recalculating ${g.currentMonth}...`:g.phase==="saving"&&(_="Saving recalculated balances..."),u?.({phase:"recalculating",message:_,recalcProgress:g})}}),await Qe.refetchQueries({queryKey:Se.month(r,a,o)}),await Qe.refetchQueries({queryKey:Se.budget(r)}),u?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:m}},isPending:t.isPending,isError:t.isError,error:t.error}}async function um(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const a=[...n,r].sort((o,u)=>o.toLowerCase().localeCompare(u.toLowerCase()));return await mt("payees",t,{budget_id:t,payees:a,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),a}function Hn(t){const e=t.income||[],n=t.expenses||[],r=Ee(e.reduce((h,f)=>h+f.amount,0)),a=Ee(n.reduce((h,f)=>h+f.amount,0)),o=U4(t),u=V4(t);return{...t,total_income:r,total_expenses:a,account_balances:o,category_balances:u}}function U4(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],a=t.adjustments||[],o=t.account_balances||[],u=new Map;for(const m of o)Pe(m.account_id)||u.set(m.account_id,m);const h=new Set;for(const m of e)Pe(m.account_id)||h.add(m.account_id);for(const m of n)Pe(m.account_id)||h.add(m.account_id);for(const m of r)Pe(m.from_account_id)||h.add(m.from_account_id),Pe(m.to_account_id)||h.add(m.to_account_id);for(const m of a)Pe(m.account_id)||h.add(m.account_id);for(const m of o)Pe(m.account_id)||h.add(m.account_id);const f=[];for(const m of h){const g=u.get(m),_=Ee(g?.start_balance??0),b=Ee(e.filter(j=>j.account_id===m).reduce((j,M)=>j+M.amount,0)),x=Ee(n.filter(j=>j.account_id===m).reduce((j,M)=>j+M.amount,0)),E=Ee(r.filter(j=>j.from_account_id===m).reduce((j,M)=>j-M.amount,0)),S=Ee(r.filter(j=>j.to_account_id===m).reduce((j,M)=>j+M.amount,0)),T=Ee(a.filter(j=>j.account_id===m).reduce((j,M)=>j+M.amount,0)),D=Ee(b+x+E+S+T);f.push({account_id:m,start_balance:_,income:b,expenses:x,net_change:D,end_balance:Ee(_+D)})}return f}function V4(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],a=t.category_balances||[],o=new Map;for(const g of a)Je(g.category_id)||o.set(g.category_id,g);const u=new Map;for(const g of e){if(Je(g.category_id))continue;const _=u.get(g.category_id)||0;u.set(g.category_id,_+g.amount)}const h=new Map;for(const g of n){if(!Je(g.from_category_id)){const _=h.get(g.from_category_id)||0;h.set(g.from_category_id,_-g.amount)}if(!Je(g.to_category_id)){const _=h.get(g.to_category_id)||0;h.set(g.to_category_id,_+g.amount)}}for(const g of r)if(!Je(g.category_id)){const _=h.get(g.category_id)||0;h.set(g.category_id,_+g.amount)}const f=new Set;for(const g of a)Je(g.category_id)||f.add(g.category_id);for(const g of e)Je(g.category_id)||f.add(g.category_id);for(const g of n)Je(g.from_category_id)||f.add(g.from_category_id),Je(g.to_category_id)||f.add(g.to_category_id);for(const g of r)Je(g.category_id)||f.add(g.category_id);const m=[];for(const g of f){const _=o.get(g),b=Ee(u.get(g)??0),x=Ee(h.get(g)??0);if(_){const E=Ee(_.start_balance),S=Ee(_.allocated);m.push({..._,start_balance:E,allocated:S,spent:b,end_balance:Ee(E+S+b+x)})}else m.push({category_id:g,start_balance:0,allocated:0,spent:b,end_balance:Ee(b+x)})}return m}function F4(t,e){let n=0;for(const{accountId:r,delta:a}of e){const o=t.accounts[r];if(!o)continue;const u=o.account_group_id?t.accountGroups[o.account_group_id]:void 0,h=u?.on_budget!==void 0?u.on_budget:o.on_budget!==!1,f=u?.is_active!==void 0?u.is_active:o.is_active!==!1;h&&f&&(n+=a)}return n}async function $n(t,e){if(e.length===0)return;const n=e.filter(h=>h.delta!==0);if(n.length===0)return;const r=Qe.getQueryData(Se.budget(t));if(!r)return;const a=F4(r,n),o={...r.accounts};for(const{accountId:h,delta:f}of n)o[h]&&(o[h]={...o[h],balance:o[h].balance+f});const u=r.budget?{...r.budget,total_available:r.budget.total_available+a}:r.budget;Qe.setQueryData(Se.budget(t),{...r,accounts:o,budget:u})}function $4(){const t=gn(),{writeData:e}=qn();return{addIncome:async(r,a,o,u,h,f,m,g)=>{const _=await zn(r,a,o,"add income"),b={id:`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:u,account_id:h,date:f,created_at:new Date().toISOString()};m?.trim()&&(b.payee=m.trim()),g&&(b.description=g);const x=[..._.income||[],b],E=Hn({..._,income:x,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:r,month:E,description:"add income"}),await $n(r,[{accountId:h,delta:u}]),m?.trim()){const S=t.getQueryData(Se.payees(r))||[],T=await um(r,m,S);T&&t.setQueryData(Se.payees(r),T)}return{updatedMonth:E,newIncome:b}},isPending:e.isPending,isError:e.isError,error:e.error}}function q4(t,e,n,r,a,o){if(!t)return!0;const u=t.payee||void 0,h=a?.trim()||void 0,f=t.description||void 0,m=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||h!==u||m!==f}function H4(){const t=gn(),{writeData:e}=qn();return{updateIncome:async(r,a,o,u,h,f,m,g,_)=>{const b=await zn(r,a,o,"update income"),x=(b.income||[]).find(M=>M.id===u);if(!q4(x,h,f,m,g,_))return{updatedMonth:b,noOp:!0};const E=x?.amount??0,S=x?.account_id??f,T={id:u,amount:h,account_id:f,date:m,created_at:(b.income||[]).find(M=>M.id===u)?.created_at||new Date().toISOString()};g?.trim()&&(T.payee=g.trim()),_&&(T.description=_);const D=(b.income||[]).map(M=>M.id===u?T:M),j=Hn({...b,income:D,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:r,month:j,description:"update income"}),S===f?await $n(r,[{accountId:f,delta:h-E}]):await $n(r,[{accountId:S,delta:-E},{accountId:f,delta:h}]),g?.trim()){const M=t.getQueryData(Se.payees(r))||[],K=await um(r,g,M);K&&t.setQueryData(Se.payees(r),K)}return{updatedMonth:j}},isPending:e.isPending,isError:e.isError,error:e.error}}function G4(){const{writeData:t}=qn();return{deleteIncome:async(n,r,a,o)=>{const u=await zn(n,r,a,"delete income"),h=(u.income||[]).find(b=>b.id===o),f=h?.amount??0,m=h?.account_id,g=(u.income||[]).filter(b=>b.id!==o),_=Hn({...u,income:g,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:_,description:"delete income"}),m&&f>0&&await $n(n,[{accountId:m,delta:-f}]),{updatedMonth:_}},isPending:t.isPending,isError:t.isError,error:t.error}}function Q4(){const t=gn(),{writeData:e}=qn();return{addExpense:async(r,a,o,u,h,f,m,g,_,b)=>{const x=await zn(r,a,o,"add expense"),E={id:`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:u,category_id:h,account_id:f,date:m,created_at:new Date().toISOString()};g?.trim()&&(E.payee=g.trim()),_&&(E.description=_),b!==void 0&&(E.cleared=b);const S=[...x.expenses||[],E],T=Hn({...x,expenses:S,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:r,month:T,description:"add expense"}),await $n(r,[{accountId:f,delta:u}]),g?.trim()){const D=t.getQueryData(Se.payees(r))||[],j=await um(r,g,D);j&&t.setQueryData(Se.payees(r),j)}return{updatedMonth:T,newExpense:E}},isPending:e.isPending,isError:e.isError,error:e.error}}function W4(t,e,n,r,a,o,u,h){if(!t)return!0;const f=t.payee||void 0,m=o?.trim()||void 0,g=t.description||void 0,_=u||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||a!==t.date||m!==f||_!==g||h!==t.cleared}function K4(){const t=gn(),{writeData:e}=qn();return{updateExpense:async(r,a,o,u,h,f,m,g,_,b,x)=>{const E=await zn(r,a,o,"update expense"),S=(E.expenses||[]).find(H=>H.id===u);if(!W4(S,h,f,m,g,_,b,x))return{updatedMonth:E,noOp:!0};const T=S?.amount??0,D=S?.account_id??m,j={id:u,amount:h,category_id:f,account_id:m,date:g,created_at:E.expenses?.find(H=>H.id===u)?.created_at||new Date().toISOString()};_?.trim()&&(j.payee=_.trim()),b&&(j.description=b),x!==void 0&&(j.cleared=x);const M=(E.expenses||[]).map(H=>H.id===u?j:H),K=Hn({...E,expenses:M,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:r,month:K,description:"update expense"}),D===m?await $n(r,[{accountId:m,delta:h-T}]):await $n(r,[{accountId:D,delta:-T},{accountId:m,delta:h}]),_?.trim()){const H=t.getQueryData(Se.payees(r))||[],Q=await um(r,_,H);Q&&t.setQueryData(Se.payees(r),Q)}return{updatedMonth:K}},isPending:e.isPending,isError:e.isError,error:e.error}}function Y4(){const{writeData:t}=qn();return{deleteExpense:async(n,r,a,o)=>{const u=await zn(n,r,a,"delete expense"),h=(u.expenses||[]).find(b=>b.id===o),f=h?.amount??0,m=h?.account_id,g=(u.expenses||[]).filter(b=>b.id!==o),_=Hn({...u,expenses:g,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:_,description:"delete expense"}),m&&f!==0&&await $n(n,[{accountId:m,delta:-f}]),{updatedMonth:_}},isPending:t.isPending,isError:t.isError,error:t.error}}function X4(){const{writeData:t}=qn();return{addTransfer:async(n,r,a,o,u,h,f,m,g,_,b)=>{const x=await zn(n,r,a,"add transfer"),E={id:`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:o,from_account_id:u,to_account_id:h,from_category_id:f,to_category_id:m,date:g,created_at:new Date().toISOString()};_&&(E.description=_),b!==void 0&&(E.cleared=b);const S=[...x.transfers||[],E],T=Hn({...x,transfers:S,updated_at:new Date().toISOString()});await t.mutateAsync({budgetId:n,month:T,description:"add transfer"});const D=[];return Pe(u)||D.push({accountId:u,delta:-o}),Pe(h)||D.push({accountId:h,delta:o}),D.length>0&&await $n(n,D),{updatedMonth:T,newTransfer:E}},isPending:t.isPending,isError:t.isError,error:t.error}}function J4(t,e,n,r,a,o,u,h,f){if(!t)return!0;const m=t.description||void 0,g=h||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||a!==t.from_category_id||o!==t.to_category_id||u!==t.date||g!==m||f!==t.cleared}function Z4(){const{writeData:t}=qn();return{updateTransfer:async(n,r,a,o,u,h,f,m,g,_,b,x)=>{const E=await zn(n,r,a,"update transfer"),S=(E.transfers||[]).find(P=>P.id===o);if(!J4(S,u,h,f,m,g,_,b,x))return{updatedMonth:E,noOp:!0};const T=S?.amount??0,D=S?.from_account_id??h,j=S?.to_account_id??f,M={id:o,amount:u,from_account_id:h,to_account_id:f,from_category_id:m,to_category_id:g,date:_,created_at:E.transfers?.find(P=>P.id===o)?.created_at||new Date().toISOString()};b&&(M.description=b),x!==void 0&&(M.cleared=x);const K=(E.transfers||[]).map(P=>P.id===o?M:P),H=Hn({...E,transfers:K,updated_at:new Date().toISOString()});await t.mutateAsync({budgetId:n,month:H,description:"update transfer"});const Q=[];return Pe(D)||Q.push({accountId:D,delta:T}),Pe(j)||Q.push({accountId:j,delta:-T}),Pe(h)||Q.push({accountId:h,delta:-u}),Pe(f)||Q.push({accountId:f,delta:u}),Q.length>0&&await $n(n,Q),{updatedMonth:H}},isPending:t.isPending,isError:t.isError,error:t.error}}function eL(){const{writeData:t}=qn();return{deleteTransfer:async(n,r,a,o)=>{const u=await zn(n,r,a,"delete transfer"),h=(u.transfers||[]).find(E=>E.id===o),f=h?.amount??0,m=h?.from_account_id,g=h?.to_account_id,_=(u.transfers||[]).filter(E=>E.id!==o),b=Hn({...u,transfers:_,updated_at:new Date().toISOString()});await t.mutateAsync({budgetId:n,month:b,description:"delete transfer"});const x=[];return m&&!Pe(m)&&f!==0&&x.push({accountId:m,delta:f}),g&&!Pe(g)&&f!==0&&x.push({accountId:g,delta:-f}),x.length>0&&await $n(n,x),{updatedMonth:b}},isPending:t.isPending,isError:t.isError,error:t.error}}function tL(){const{writeData:t}=qn();return{addAdjustment:async(n,r,a,o,u,h,f,m,g)=>{const _=await zn(n,r,a,"add adjustment"),b={id:`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:o,account_id:u,category_id:h,date:f,created_at:new Date().toISOString()};m&&(b.description=m),g!==void 0&&(b.cleared=g);const x=[..._.adjustments||[],b],E=Hn({..._,adjustments:x,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:E,description:"add adjustment"}),Pe(u)||await $n(n,[{accountId:u,delta:o}]),{updatedMonth:E,newAdjustment:b}},isPending:t.isPending,isError:t.isError,error:t.error}}function nL(t,e,n,r,a,o,u){if(!t)return!0;const h=t.description||void 0,f=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||a!==t.date||f!==h||u!==t.cleared}function rL(){const{writeData:t}=qn();return{updateAdjustment:async(n,r,a,o,u,h,f,m,g,_)=>{const b=await zn(n,r,a,"update adjustment"),x=(b.adjustments||[]).find(M=>M.id===o);if(!nL(x,u,h,f,m,g,_))return{updatedMonth:b,noOp:!0};const E=x?.amount??0,S=x?.account_id??h,T={id:o,amount:u,account_id:h,category_id:f,date:m,created_at:b.adjustments?.find(M=>M.id===o)?.created_at||new Date().toISOString()};g&&(T.description=g),_!==void 0&&(T.cleared=_);const D=(b.adjustments||[]).map(M=>M.id===o?T:M),j=Hn({...b,adjustments:D,updated_at:new Date().toISOString()});if(await t.mutateAsync({budgetId:n,month:j,description:"update adjustment"}),!Pe(S)&&S===h)await $n(n,[{accountId:h,delta:u-E}]);else{const M=[];Pe(S)||M.push({accountId:S,delta:-E}),Pe(h)||M.push({accountId:h,delta:u}),M.length>0&&await $n(n,M)}return{updatedMonth:j}},isPending:t.isPending,isError:t.isError,error:t.error}}function iL(){const{writeData:t}=qn();return{deleteAdjustment:async(n,r,a,o)=>{const u=await zn(n,r,a,"delete adjustment"),h=(u.adjustments||[]).find(b=>b.id===o),f=h?.amount??0,m=h?.account_id,g=(u.adjustments||[]).filter(b=>b.id!==o),_=Hn({...u,adjustments:g,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:_,description:"delete adjustment"}),m&&!Pe(m)&&f!==0&&await $n(n,[{accountId:m,delta:-f}]),{updatedMonth:_}},isPending:t.isPending,isError:t.isError,error:t.error}}const sL={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},sT=C.createContext(sL);function aL({children:t}){const n=go().get_current_firebase_user(),[r,a]=C.useState(null),[o,u]=C.useState(new Date().getFullYear()),[h,f]=C.useState(new Date().getMonth()+1),[m,g]=C.useState("categories"),[_,b]=C.useState("categories"),[x,E]=C.useState("budget"),[S,T]=C.useState("Budget"),D=C.useCallback(V=>{T(q=>q===V?q:V)},[]),[j,M]=C.useState(!1),[K,H]=C.useState(!1),Q=A4(n?.uid||null,n?.email||null),P=Q.data&&Q.data.budget_ids.length===0,k=R4(n?.uid||null,Q.data||null,{enabled:!!n?.uid&&!!Q.data&&P}),O=Q.data?.permission_flags?.is_admin===!0,N=Q.data?.permission_flags?.is_test===!0,L=k.data?.pendingInvites||[],U=k.data?.budgets||[],R=L.length>0;C.useEffect(()=>{if(!n||j||Q.isLoading)return;const V=Q.data;if(!(!V&&!Q.isError))if(V&&V.budget_ids.length>0)a(V.budget_ids[0]),H(!1),M(!0);else{if(k.isLoading)return;const q=k.data;q?.pendingInvites&&q.pendingInvites.length>0?H(!1):H(!0),M(!0)}},[n,j,Q.data,Q.isLoading,Q.isError,k.data,k.isLoading]);const Y=C.useCallback(()=>{h===1?(u(V=>V-1),f(12)):f(V=>V-1)},[h]),W=C.useCallback(()=>{h===12?(u(V=>V+1),f(1)):f(V=>V+1)},[h]),B=C.useCallback(async()=>{await k.refetch()},[k]),$=C.useCallback(V=>{a(V)},[]),G=C.useCallback(async V=>{if(!n)return null;try{const q=await k4(V,n.uid);return q&&q.isInvited&&!q.hasAccepted?{budgetId:V,budgetName:q.budgetName,ownerEmail:q.ownerEmail}:null}catch(q){return console.error("[BudgetContext] Error checking budget invite:",q),null}},[n]),J=C.useCallback(()=>{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")},[]),re={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:h,lastActiveTab:m,lastSettingsTab:_,lastAdminTab:x,setSelectedBudgetId:a,setCurrentYear:u,setCurrentMonthNumber:f,setLastActiveTab:g,setLastSettingsTab:b,setLastAdminTab:E,pageTitle:S,setPageTitle:D,isInitialized:j,needsFirstBudget:K,goToPreviousMonth:Y,goToNextMonth:W,pendingInvites:L,hasPendingInvites:R,accessibleBudgets:U,isAdmin:O,isTest:N,loadAccessibleBudgets:B,switchToBudget:$,checkBudgetInvite:G,clearCache:J};return c.jsx(sT.Provider,{value:re,children:t})}function Pt(){const t=C.useContext(sT);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const oL=function(){},lL={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:oL},Zu=C.createContext(lL);function Li(t=n4){const[e,n]=C.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return C.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function a(u){n(u.matches)}a(r),r.addEventListener("change",a);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",a),window.removeEventListener("resize",o)}},[t]),e}function aT(){const[t,e]=C.useState(()=>typeof window>"u"?1200:window.innerWidth);return C.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=io.wide,isMedium:t>=io.tablet&&t<io.wide,isNarrowMedium:t>=io.mobile&&t<io.tablet,isMobile:t<io.mobile}}function cL(){const t=gn();return{updateAccounts:yr({mutationFn:async({budgetId:n,accounts:r})=>{const{exists:a,data:o}=await We("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");return await mt("budgets",n,{...o,accounts:r},"saving updated accounts (user edited account settings)"),r},onMutate:async({budgetId:n,accounts:r})=>{await t.cancelQueries({queryKey:Se.budget(n)});const a=t.getQueryData(Se.budget(n));return a&&t.setQueryData(Se.budget(n),{...a,accounts:r}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(Se.budget(r));a&&t.setQueryData(Se.budget(r),{...a,accounts:n})},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(Se.budget(r),a.previousData)}})}}function uL(t){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order},r.expected_balance!==void 0&&(e[n].expected_balance=r.expected_balance),r.on_budget!==void 0&&(e[n].on_budget=r.on_budget),r.is_active!==void 0&&(e[n].is_active=r.is_active)}),e}function dL(){const t=gn();return{updateAccountGroups:yr({mutationFn:async({budgetId:n,accountGroups:r})=>{const{exists:a,data:o}=await We("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");const u=uL(r);return await mt("budgets",n,{...o,account_groups:u},"saving updated account groups (user edited group settings)"),r},onMutate:async({budgetId:n,accountGroups:r})=>{await t.cancelQueries({queryKey:Se.budget(n)});const a=t.getQueryData(Se.budget(n));return a&&t.setQueryData(Se.budget(n),{...a,accountGroups:r}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(Se.budget(r));a&&t.setQueryData(Se.budget(r),{...a,accountGroups:n})},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(Se.budget(r),a.previousData)}})}}function hL(t){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,category_group_id:r.category_group_id??null,sort_order:r.sort_order,balance:r.balance??0},r.description!==void 0&&(e[n].description=r.description),r.default_monthly_amount!==void 0&&(e[n].default_monthly_amount=r.default_monthly_amount),r.default_monthly_type!==void 0&&(e[n].default_monthly_type=r.default_monthly_type),r.is_hidden!==void 0&&(e[n].is_hidden=r.is_hidden)}),e}function fL(){const t=gn();return{updateCategories:yr({mutationFn:async({budgetId:n,categories:r})=>{const{exists:a,data:o}=await We("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");const u=hL(r);return await mt("budgets",n,{...o,categories:u},"saving updated categories (user edited category settings)"),r},onMutate:async({budgetId:n,categories:r})=>{await t.cancelQueries({queryKey:Se.budget(n)});const a=t.getQueryData(Se.budget(n));return a&&t.setQueryData(Se.budget(n),{...a,categories:r}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(Se.budget(r));a&&t.setQueryData(Se.budget(r),{...a,categories:n})},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(Se.budget(r),a.previousData)}})}}function mL(){const t=gn();return{updateCategoryGroups:yr({mutationFn:async({budgetId:n,categoryGroups:r})=>{const{exists:a,data:o}=await We("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");return await mt("budgets",n,{...o,category_groups:r},"saving updated category groups (user edited group settings)"),r},onMutate:async({budgetId:n,categoryGroups:r})=>{await t.cancelQueries({queryKey:Se.budget(n)});const a=t.getQueryData(Se.budget(n));return a&&t.setQueryData(Se.budget(n),{...a,categoryGroups:r}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(Se.budget(r));a&&t.setQueryData(Se.budget(r),{...a,categoryGroups:n})},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(Se.budget(r),a.previousData)}})}}function pL(){const t=gn();return{renameBudget:yr({mutationFn:async({budgetId:n,newName:r})=>{const{exists:a,data:o}=await We("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");return await mt("budgets",n,{...o,name:r.trim()},`renaming budget to "${r.trim()}"`),r.trim()},onMutate:async({budgetId:n,newName:r})=>{await t.cancelQueries({queryKey:Se.budget(n)});const a=t.getQueryData(Se.budget(n));return a&&t.setQueryData(Se.budget(n),{...a,budget:{...a.budget,name:r.trim()}}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(Se.budget(r));a&&t.setQueryData(Se.budget(r),{...a,budget:{...a.budget,name:n}})},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(Se.budget(r),a.previousData)}})}}function gL(){const t=gn();return{createBudget:yr({mutationFn:async({name:n,userId:r,userEmail:a})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,u=new Date().toISOString(),h={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:a,accounts:{},account_groups:{},categories:{},category_groups:[],created_at:u,updated_at:u};await mt("budgets",o,h,"creating new budget document");const{exists:f,data:m}=await We("users",r,"reading user document to add new budget to their list");return f&&m?await mt("users",r,{...m,budget_ids:[o,...m.budget_ids],updated_at:u},"adding new budget to user's budget list"):await mt("users",r,{uid:r,email:a,budget_ids:[o],created_at:u,updated_at:u},"creating new user document with first budget"),{budgetId:o,budget:{id:o,...h}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Se.user(r)}),t.invalidateQueries({queryKey:Se.accessibleBudgets(r)})}})}}function yL(){const t=gn();return{acceptInvite:yr({mutationFn:async({budgetId:n,userId:r})=>{const a=new Date().toISOString(),{exists:o,data:u}=await We("budgets",n,"verifying user was invited to this budget");if(!o||!u)throw new Error("Budget not found");if(!u.user_ids?.includes(r))throw new Error("You have not been invited to this budget");const{data:h}=await We("users",r,"PRE-EDIT-READ");if(h?.budget_ids?.includes(n))throw new Error("You have already accepted this invite");return await mt("users",r,{...h||{uid:r,email:null},budget_ids:[n,...h?.budget_ids||[]],updated_at:a},"adding accepted budget to user's budget list"),await mt("budgets",n,{...u,accepted_user_ids:[...u.accepted_user_ids||[],r]},"marking user as accepted in budget's accepted_user_ids"),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Se.user(r)}),t.invalidateQueries({queryKey:Se.accessibleBudgets(r)}),t.invalidateQueries({queryKey:Se.budget(n.budgetId)})}})}}function _L(){const t=gn();return{inviteUser:yr({mutationFn:async({budgetId:n,userId:r})=>{const{exists:a,data:o}=await We("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");if(o.user_ids?.includes(r))throw new Error("User is already invited");return await mt("budgets",n,{...o,user_ids:[...o.user_ids||[],r]},"adding user to budget's invited users list"),{budgetId:n}},onMutate:async({budgetId:n,userId:r})=>{await t.cancelQueries({queryKey:Se.budget(n)});const a=t.getQueryData(Se.budget(n));return a&&t.setQueryData(Se.budget(n),{...a,budget:{...a.budget,user_ids:[...a.budget.user_ids,r]}}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(Se.budget(r));a&&t.setQueryData(Se.budget(r),a)},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(Se.budget(r),a.previousData)}})}}function bL(){const t=gn();return{revokeUser:yr({mutationFn:async({budgetId:n,userId:r})=>{const{exists:a,data:o}=await We("budgets",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Budget not found");return await mt("budgets",n,{...o,user_ids:(o.user_ids||[]).filter(u=>u!==r),accepted_user_ids:(o.accepted_user_ids||[]).filter(u=>u!==r)},"removing user from budget's access lists"),{budgetId:n}},onMutate:async({budgetId:n,userId:r})=>{await t.cancelQueries({queryKey:Se.budget(n)});const a=t.getQueryData(Se.budget(n));return a&&t.setQueryData(Se.budget(n),{...a,budget:{...a.budget,user_ids:a.budget.user_ids.filter(o=>o!==r),accepted_user_ids:a.budget.accepted_user_ids.filter(o=>o!==r)}}),{previousData:a}},onSuccess:(n,{budgetId:r})=>{const a=t.getQueryData(Se.budget(r));a&&t.setQueryData(Se.budget(r),a)},onError:(n,{budgetId:r},a)=>{a?.previousData&&t.setQueryData(Se.budget(r),a.previousData)}})}}function Mn(t,e){const n=YC(t),{updateAccounts:r}=cL(),{updateAccountGroups:a}=dL(),{updateCategories:o}=fL(),{updateCategoryGroups:u}=mL(),{renameBudget:h}=pL(),{createBudget:f}=gL(),{acceptInvite:m}=yL(),{inviteUser:g}=_L(),{revokeUser:_}=bL(),b=n.data,x=b?.budget||null,E=C.useMemo(()=>b?.accounts||{},[b?.accounts]),S=C.useMemo(()=>b?.accountGroups||{},[b?.accountGroups]),T=C.useMemo(()=>b?.categories||{},[b?.categories]),D=C.useMemo(()=>b?.categoryGroups||[],[b?.categoryGroups]),j=x?.owner_id===e,M=C.useMemo(()=>x?.user_ids||[],[x?.user_ids]),K=C.useMemo(()=>x?.accepted_user_ids||[],[x?.accepted_user_ids]),H=x?.total_available??0,Q=C.useMemo(()=>b?.monthMap||{},[b?.monthMap]),P=C.useCallback(async ne=>{if(!t)throw new Error("No budget selected");await r.mutateAsync({budgetId:t,accounts:ne})},[t,r]),k=C.useCallback(async ne=>{if(!t)throw new Error("No budget selected");await a.mutateAsync({budgetId:t,accountGroups:ne})},[t,a]),O=C.useCallback(async ne=>{if(!t)throw new Error("No budget selected");await o.mutateAsync({budgetId:t,categories:ne})},[t,o]),N=C.useCallback(async ne=>{if(!t)throw new Error("No budget selected");await u.mutateAsync({budgetId:t,categoryGroups:ne})},[t,u]),L=C.useCallback(async(ne,te)=>{if(!t)throw new Error("No budget selected");await Promise.all([r.mutateAsync({budgetId:t,accounts:ne}),a.mutateAsync({budgetId:t,accountGroups:te})])},[t,r,a]),U=C.useCallback(async(ne,te)=>{if(!t)throw new Error("No budget selected");await Promise.all([o.mutateAsync({budgetId:t,categories:ne}),u.mutateAsync({budgetId:t,categoryGroups:te})])},[t,o,u]),R=C.useCallback(async ne=>{if(!t)throw new Error("No budget selected");await h.mutateAsync({budgetId:t,newName:ne})},[t,h]),Y=C.useCallback(async ne=>{if(!e)throw new Error("Not authenticated");return await f.mutateAsync({name:ne.trim()||"My Budget",userId:e,userEmail:null})},[e,f]),W=C.useCallback(async ne=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,userId:ne})},[t,g]),B=C.useCallback(async ne=>{if(!t)throw new Error("No budget selected");await _.mutateAsync({budgetId:t,userId:ne})},[t,_]),$=C.useCallback(async ne=>{if(!e)throw new Error("Not authenticated");await m.mutateAsync({budgetId:ne,userId:e})},[e,m]),G=C.useCallback(ne=>{if(!t)return;const te=Qe.getQueryData(Se.budget(t));te&&Qe.setQueryData(Se.budget(t),{...te,accounts:ne})},[t]),J=C.useCallback(ne=>{if(!t)return;const te=Qe.getQueryData(Se.budget(t));te&&Qe.setQueryData(Se.budget(t),{...te,accountGroups:ne})},[t]),re=C.useCallback(ne=>{if(!t)return;const te=Qe.getQueryData(Se.budget(t));te&&Qe.setQueryData(Se.budget(t),{...te,categories:ne})},[t]),V=C.useCallback(ne=>{if(!t)return;const te=Qe.getQueryData(Se.budget(t));te&&Qe.setQueryData(Se.budget(t),{...te,categoryGroups:ne})},[t]),q=C.useCallback(async()=>{t&&await Qe.invalidateQueries({queryKey:Se.budget(t)})},[t]),ee=C.useCallback(()=>Object.entries(E).filter(([,ne])=>{const te=ne.account_group_id?S[ne.account_group_id]:void 0,se=te?.on_budget!==void 0?te.on_budget:ne.on_budget!==!1,he=te?.is_active!==void 0?te.is_active:ne.is_active!==!1;return se&&he}).reduce((ne,[,te])=>ne+te.balance,0),[E,S]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:x,accounts:E,accountGroups:S,categories:T,categoryGroups:D,isOwner:j,budgetUserIds:M,acceptedUserIds:K,totalAvailable:H,monthMap:Q,saveAccounts:P,saveAccountGroups:k,saveCategories:O,saveCategoryGroups:N,saveAccountsAndGroups:L,saveCategoriesAndGroups:U,renameBudget:R,createBudget:Y,inviteUser:W,revokeUser:B,acceptInvite:$,setAccountsOptimistic:G,setAccountGroupsOptimistic:J,setCategoriesOptimistic:re,setCategoryGroupsOptimistic:V,refreshBudget:q,getOnBudgetTotal:ee}}function ys(t,e,n){const{addLoadingHold:r,removeLoadingHold:a}=nr(),o=E4(t,e,n,{enabled:!!t});C.useEffect(()=>(o.isLoading?r("month-query","Loading month data..."):a("month-query"),()=>a("month-query")),[o.isLoading,r,a]);const{addIncome:u}=$4(),{updateIncome:h}=H4(),{deleteIncome:f}=G4(),{addExpense:m}=Q4(),{updateExpense:g}=K4(),{deleteExpense:_}=Y4(),{addTransfer:b}=X4(),{updateTransfer:x}=Z4(),{deleteTransfer:E}=eL(),{addAdjustment:S}=tL(),{updateAdjustment:T}=rL(),{deleteAdjustment:D}=iL(),j=o.data?.month||null,M=j?.income||[],K=j?.expenses||[],H=j?.transfers||[],Q=j?.adjustments||[],P=j?.category_balances||[],k=j?.total_income||0,O=j?.total_expenses||0,N=j?.are_allocations_finalized||!1,L=j?.previous_month_income??0,U=C.useCallback(async(te,se,he,we,ge)=>{if(!t)throw new Error("No budget selected");const[Z,ve]=he.split("-").map(Number);await u(t,Z,ve,te,se,he,we,ge)},[t,u]),R=C.useCallback(async(te,se,he,we,ge,Z)=>{if(!t)throw new Error("No budget selected");await h(t,e,n,te,se,he,we,ge,Z)},[t,e,n,h]),Y=C.useCallback(async te=>{if(!t)throw new Error("No budget selected");await f(t,e,n,te)},[t,e,n,f]),W=C.useCallback(async(te,se,he,we,ge,Z,ve)=>{if(!t)throw new Error("No budget selected");const[Te,dt]=we.split("-").map(Number);await m(t,Te,dt,te,se,he,we,ge,Z,ve)},[t,m]),B=C.useCallback(async(te,se,he,we,ge,Z,ve,Te)=>{if(!t)throw new Error("No budget selected");await g(t,e,n,te,se,he,we,ge,Z,ve,Te)},[t,e,n,g]),$=C.useCallback(async te=>{if(!t)throw new Error("No budget selected");await _(t,e,n,te)},[t,e,n,_]),G=C.useCallback(async(te,se,he,we,ge,Z,ve,Te)=>{if(!t)throw new Error("No budget selected");const[dt,Me]=Z.split("-").map(Number);await b(t,dt,Me,te,se,he,we,ge,Z,ve,Te)},[t,b]),J=C.useCallback(async(te,se,he,we,ge,Z,ve,Te,dt)=>{if(!t)throw new Error("No budget selected");await x(t,e,n,te,se,he,we,ge,Z,ve,Te,dt)},[t,e,n,x]),re=C.useCallback(async te=>{if(!t)throw new Error("No budget selected");await E(t,e,n,te)},[t,e,n,E]),V=C.useCallback(async(te,se,he,we,ge,Z)=>{if(!t)throw new Error("No budget selected");const[ve,Te]=we.split("-").map(Number);await S(t,ve,Te,te,se,he,we,ge,Z)},[t,S]),q=C.useCallback(async(te,se,he,we,ge,Z,ve)=>{if(!t)throw new Error("No budget selected");await T(t,e,n,te,se,he,we,ge,Z,ve)},[t,e,n,T]),ee=C.useCallback(async te=>{if(!t)throw new Error("No budget selected");await D(t,e,n,te)},[t,e,n,D]),ne=C.useCallback(async()=>{t&&await Qe.invalidateQueries({queryKey:Se.month(t,e,n)})},[t,e,n]);return{isLoading:o.isLoading,isFetching:o.isFetching,error:o.error,month:j,income:M,expenses:K,transfers:H,adjustments:Q,categoryBalances:P,totalIncome:k,totalExpenses:O,areAllocationsFinalized:N,previousMonthIncome:L,addIncome:U,updateIncome:R,deleteIncome:Y,addExpense:W,updateExpense:B,deleteExpense:$,addTransfer:G,updateTransfer:J,deleteTransfer:re,addAdjustment:V,updateAdjustment:q,deleteAdjustment:ee,refreshMonth:ne}}function vL({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:a,saveAccounts:o,saveAccountGroups:u,setError:h}){const f=C.useCallback(async(g,_,b)=>{const x=e[g];if(!x)return;const E=b==="ungrouped"?null:b,S=Object.entries(e).filter(([,j])=>(j.account_group_id||"ungrouped")===b),T={};Object.entries(e).forEach(([j,M])=>{j!==g&&(T[j]={...M})});let D;if(_==="__group_end__"||S.length===0||!S.find(([j])=>j===_))D=(S.length>0?Math.max(...S.filter(([M])=>M!==g).map(([,M])=>M.sort_order)):-1)+1;else{const j=S.find(([M])=>M===_);if(j){const[,M]=j;D=M.sort_order,Object.entries(T).forEach(([K,H])=>{(H.account_group_id||"ungrouped")===b&&H.sort_order>=D&&(T[K]={...H,sort_order:H.sort_order+1})})}else D=0}if(T[g]={...x,account_group_id:E,sort_order:D},r(T),!!t)try{await o(T)}catch(j){h(j instanceof Error?j.message:"Failed to save changes")}},[t,e,r,o,h]),m=C.useCallback(async(g,_)=>{if(g===_)return;const b=Object.entries(n).sort(([,D],[,j])=>D.sort_order-j.sort_order),x=b.findIndex(([D])=>D===g),E=[...b],[S]=E.splice(x,1);if(_==="__end__")E.push(S);else{const D=E.findIndex(([j])=>j===_);E.splice(D,0,S)}const T={};if(E.forEach(([D,j],M)=>{T[D]={...j,sort_order:M}}),a(T),!!t)try{await u(T)}catch(D){h(D instanceof Error?D.message:"Failed to save new order")}},[t,n,a,u,h]);return{reorderAccountsInGroup:f,reorderGroups:m}}function xL(){const{selectedBudgetId:t,currentUserId:e}=Pt(),{budget:n,accounts:r,accountGroups:a,saveAccounts:o,saveAccountGroups:u,saveAccountsAndGroups:h,setAccountsOptimistic:f,setAccountGroupsOptimistic:m}=Mn(t,e),[g,_]=C.useState(null),b=C.useMemo(()=>Object.entries(r).filter(([,O])=>!O.is_hidden).reduce((O,[N,L])=>{const U=L.account_group_id||"ungrouped";return O[U]||(O[U]=[]),O[U].push({...L,id:N}),O},{}),[r]),x=C.useMemo(()=>Object.entries(r).filter(([,O])=>O.is_hidden).map(([O,N])=>({...N,id:O})).sort((O,N)=>O.sort_order-N.sort_order),[r]),E=C.useMemo(()=>Object.entries(a).sort(([,O],[,N])=>O.sort_order-N.sort_order).map(([O,N])=>({...N,id:O})),[a]),S=C.useCallback((O,N)=>{if(!n)return;const L=Object.values(r).filter(B=>N==="ungrouped"?!B.account_group_id:B.account_group_id===N),U=L.length>0?Math.max(...L.map(B=>B.sort_order)):-1,R=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,Y={nickname:O.nickname,description:"",balance:0,account_group_id:N==="ungrouped"?null:N,sort_order:U+1,is_income_account:O.is_income_account??!1,is_income_default:O.is_income_default??!1,is_outgo_account:O.is_outgo_account??!1,is_outgo_default:O.is_outgo_default??!1,on_budget:O.on_budget!==!1,is_active:O.is_active!==!1,is_hidden:O.is_hidden??!1},W={...r};O.is_income_default&&Object.keys(W).forEach(B=>{W[B]={...W[B],is_income_default:!1}}),O.is_outgo_default&&Object.keys(W).forEach(B=>{W[B]={...W[B],is_outgo_default:!1}}),W[R]=Y,f(W),o(W).catch(B=>_(B instanceof Error?B.message:"Failed to create account."))},[n,r,f,o]),T=C.useCallback((O,N)=>{if(!n)return;const L=r[O];if(!L)return;const U=L.account_group_id||"ungrouped",R=N.account_group_id;let Y=L.sort_order;if(U!==(R||"ungrouped")){const B=Object.values(r).filter($=>($.account_group_id||"ungrouped")===(R||"ungrouped"));Y=B.length>0?Math.max(...B.map($=>$.sort_order))+1:0}const W={};Object.entries(r).forEach(([B,$])=>{B===O?W[B]={...$,nickname:N.nickname,account_group_id:R,sort_order:Y,is_income_account:N.is_income_account??!1,is_income_default:N.is_income_default??!1,is_outgo_account:N.is_outgo_account??!1,is_outgo_default:N.is_outgo_default??!1,on_budget:N.on_budget!==!1,is_active:N.is_active!==!1,is_hidden:N.is_hidden??!1}:(W[B]={...$},N.is_income_default&&!L.is_income_default&&(W[B].is_income_default=!1),N.is_outgo_default&&!L.is_outgo_default&&(W[B].is_outgo_default=!1))}),f(W),o(W).catch(B=>_(B instanceof Error?B.message:"Failed to save account."))},[n,r,f,o]),D=C.useCallback(O=>{if(!confirm("Are you sure you want to delete this account?")||!n)return;const{[O]:N,...L}=r;f(L),o(L).catch(U=>_(U instanceof Error?U.message:"Failed to delete account."))},[n,r,f,o]),j=C.useCallback(async(O,N)=>{const L=r[O];if(!L)return;const U=L.account_group_id||"ungrouped",R=Object.entries(r).filter(([,J])=>(J.account_group_id||"ungrouped")===U).sort(([,J],[,re])=>J.sort_order-re.sort_order),Y=R.findIndex(([J])=>J===O),W=N==="up"?Y-1:Y+1;if(W<0||W>=R.length)return;const[B,$]=R[W],G={};if(Object.entries(r).forEach(([J,re])=>{J===O?G[J]={...re,sort_order:$.sort_order}:J===B?G[J]={...re,sort_order:L.sort_order}:G[J]={...re}}),f(G),!!n)try{await o(G)}catch(J){f(r),_(J instanceof Error?J.message:"Failed to move account")}},[n,r,f,o]),M=C.useCallback(O=>{if(!n)return;const N=Object.values(a).map(W=>W.sort_order),L=N.length>0?Math.max(...N):-1,U=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,R={name:O.name,sort_order:L+1,expected_balance:O.expected_balance,on_budget:O.on_budget,is_active:O.is_active},Y={...a,[U]:R};m(Y),u(Y).catch(W=>_(W instanceof Error?W.message:"Failed to create account type."))},[n,a,m,u]),K=C.useCallback((O,N)=>{if(!n)return;const L={...a,[O]:{...a[O],name:N.name,expected_balance:N.expected_balance,on_budget:N.on_budget,is_active:N.is_active}};m(L),u(L).catch(U=>_(U instanceof Error?U.message:"Failed to update account type."))},[n,a,m,u]),H=C.useCallback(O=>{if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!n)return;const N={};Object.entries(r).forEach(([R,Y])=>{N[R]=Y.account_group_id===O?{...Y,account_group_id:null}:Y});const{[O]:L,...U}=a;f(N),m(U),h(N,U).catch(R=>_(R instanceof Error?R.message:"Failed to delete account type."))},[n,r,a,f,m,h]),Q=C.useCallback(async(O,N)=>{const L=Object.entries(a).sort(([,B],[,$])=>B.sort_order-$.sort_order),U=L.findIndex(([B])=>B===O),R=N==="up"?U-1:U+1;if(R<0||R>=L.length)return;const[Y]=L.splice(U,1);L.splice(R,0,Y);const W={};if(L.forEach(([B,$],G)=>{W[B]={...$,sort_order:G}}),m(W),!!n)try{await u(W)}catch(B){m(a),_(B instanceof Error?B.message:"Failed to move account type")}},[n,a,m,u]),{reorderAccountsInGroup:P,reorderGroups:k}=vL({currentBudget:n,accounts:r,accountGroups:a,setAccountsOptimistic:f,setAccountGroupsOptimistic:m,saveAccounts:o,saveAccountGroups:u,setError:_});return{accounts:r,accountGroups:a,accountsByGroup:b,hiddenAccounts:x,sortedGroups:E,currentBudget:n,error:g,setError:_,handleCreateAccount:S,handleUpdateAccount:T,handleDeleteAccount:D,handleMoveAccount:j,handleCreateGroup:M,handleUpdateGroup:K,handleDeleteGroup:H,handleMoveGroup:Q,reorderAccountsInGroup:P,reorderGroups:k}}function fw(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,a])=>{if(a.default_monthly_type==="percentage")return;const o=t.category_balances?.find(u=>u.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():a.default_monthly_amount!==void 0&&a.default_monthly_amount>0?n[r]=a.default_monthly_amount.toString():n[r]=""}),n}function SL(){const{addLoadingHold:t,removeLoadingHold:e}=nr(),{selectedBudgetId:n,currentUserId:r,currentYear:a,currentMonthNumber:o}=Pt(),{categories:u,getOnBudgetTotal:h,totalAvailable:f}=Mn(n,r),{month:m,isLoading:g,previousMonthIncome:_,areAllocationsFinalized:b}=ys(n,a,o),x=C.useMemo(()=>m?.income?m.income.reduce((q,ee)=>q+ee.amount,0):0,[m]),{saveDraftAllocations:E}=B4(),{finalizeAllocations:S}=z4(),{deleteAllocations:T}=iT(),D=C.useMemo(()=>fw(m,u),[m,u]),[j,M]=C.useState(D),[K,H]=C.useState(!1),[Q,P]=C.useState(null),k=C.useRef(null);C.useMemo(()=>Object.values(u).reduce((q,ee)=>q+(ee.balance??0),0),[u]),C.useEffect(()=>{if(!m)return;const q=`${m.year}-${m.month}`;k.current!==q&&(H(!1),M(fw(m,u)),k.current=q)},[m,u]);const O=C.useCallback((q,ee)=>{if(ee.default_monthly_type==="percentage"&&ee.default_monthly_amount!==void 0)return Ee(ee.default_monthly_amount/100*_);const ne=j[q],te=parseFloat(ne||"0");return isNaN(te)?0:Ee(te)},[j,_]),N=C.useMemo(()=>Object.entries(u).reduce((q,[ee,ne])=>{const te=O(ee,ne),se=ne.balance??0;if(se<0){const he=Math.abs(se),we=Math.max(0,te-he);return q+we}return q+te},0),[u,O]),L=h(),U=b?(m?.category_balances||[]).reduce((q,ee)=>{const ne=u[ee.category_id]?.balance??0,te=ee.allocated,se=ne-te;if(se<0){const he=Math.abs(se);return q+Math.max(0,te-he)}return q+te},0):0,R=K?f+U:f,Y=C.useMemo(()=>K?R-N:R-N+U,[R,N,U,K]),W=C.useCallback((q,ee)=>{M(ne=>({...ne,[q]:ee}))},[]),B=C.useCallback(()=>{if(!m)return;const q={};Object.entries(u).forEach(([ee,ne])=>{if(ne.default_monthly_type==="percentage")return;const te=m.category_balances?.find(se=>se.category_id===ee);te&&te.allocated>0?q[ee]=te.allocated.toString():ne.default_monthly_amount!==void 0&&ne.default_monthly_amount>0?q[ee]=ne.default_monthly_amount.toString():q[ee]=""}),M(q),H(!1)},[m,u]),$=C.useCallback(()=>{const q={};return Object.entries(u).forEach(([ee,ne])=>{const te=O(ee,ne);te>0&&(q[ee]=te)}),q},[u,O]),G=C.useCallback(async()=>{if(n){P(null),t("allocations-save","Saving allocations...");try{await E(n,a,o,$()),H(!1)}catch(q){P(q instanceof Error?q.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,a,o,E,$,t,e]),J=C.useCallback(async()=>{if(n){P(null),t("allocations-finalize","Applying allocations...");try{await S({budgetId:n,year:a,month:o,allocations:$(),onProgress:q=>{t("allocations-finalize",q.message)}}),H(!1)}catch(q){P(q instanceof Error?q.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,a,o,S,$,t,e]),re=C.useCallback(async()=>{if(n){P(null),t("allocations-delete","Deleting allocations...");try{await T({budgetId:n,year:a,month:o,onProgress:ee=>{t("allocations-delete",ee.message)}});const q={};Object.entries(u).forEach(([ee,ne])=>{ne.default_monthly_type!=="percentage"&&(ne.default_monthly_amount!==void 0&&ne.default_monthly_amount>0?q[ee]=ne.default_monthly_amount.toString():q[ee]="")}),M(q),H(!1)}catch(q){P(q instanceof Error?q.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,a,o,T,u,t,e]),V=N-U;return{localAllocations:j,isEditingAppliedAllocations:K,error:Q,monthLoading:g,onBudgetTotal:L,availableNow:R,currentDraftTotal:N,draftChangeAmount:V,availableAfterApply:Y,previousMonthIncome:_,currentMonthIncome:x,allocationsFinalized:b,getAllocationAmount:O,handleAllocationChange:W,resetAllocationsToSaved:B,handleSaveAllocations:G,handleFinalizeAllocations:J,handleDeleteAllocations:re,setIsEditingAppliedAllocations:H,setError:P}}function wL({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:a}){const o=C.useMemo(()=>{const b={};return Object.entries(e).forEach(([x,E])=>{b[x]={current:E.balance??0,total:E.balance??0}}),b},[e]),[u,h]=C.useState(!1),[f,m]=C.useState(null),g=C.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const b=Object.keys(e),{total:x}=await hw(t,b,n,r),E={};Object.entries(e).forEach(([T,D])=>{const j=D.balance,M=x[T]??0;Math.abs(j-M)>.01&&(E[T]={stored:j,calculated:M})});const S=Object.keys(E).length>0?E:null;return m(S),S},[t,e,n,r]),_=C.useCallback(async()=>{if(!(!t||Object.keys(e).length===0)){h(!0);try{const b=Object.keys(e),{total:x}=await hw(t,b,n,r),E={};Object.entries(e).forEach(([S,T])=>{E[S]={...T,balance:x[S]??0}}),await a(E),m(null)}finally{h(!1)}}},[t,e,a,n,r]);return{categoryBalances:o,loadingBalances:u,categoryBalanceMismatch:f,checkCategoryBalanceMismatch:g,recalculateAndSaveCategoryBalances:_}}function EL({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:a,saveCategories:o,saveCategoryGroups:u,setError:h}){const[f,m]=C.useState(null),[g,_]=C.useState(null),[b,x]=C.useState(null),[E,S]=C.useState(null);function T(N,L){m("category"),_(L),N.dataTransfer.effectAllowed="move"}function D(N,L,U){N.preventDefault(),f==="category"&&(L!==g&&x(L),S(U))}function j(N,L){N.preventDefault(),f==="category"?(S(L),x(null)):f==="group"&&L!==g&&x(L)}function M(){x(null)}function K(){S(null)}function H(){m(null),_(null),x(null),S(null)}async function Q(N,L,U){if(N.preventDefault(),N.stopPropagation(),!g||f!=="category"){H();return}const R=t[g];if(!R)return;const Y=U==="ungrouped"?null:U,W=Object.entries(t).filter(([,G])=>(G.category_group_id||"ungrouped")===U),B={};Object.entries(t).forEach(([G,J])=>{G!==g&&(B[G]=J)});let $;if(L==="__group_end__"||W.length===0||!W.find(([G])=>G===L))$=(W.length>0?Math.max(...W.filter(([J])=>J!==g).map(([,J])=>J.sort_order)):-1)+1;else{const G=W.find(([J])=>J===L);G?($=G[1].sort_order,Object.entries(B).forEach(([J,re])=>{(re.category_group_id||"ungrouped")===U&&re.sort_order>=$&&(B[J]={...re,sort_order:re.sort_order+1})})):$=0}if(B[g]={...R,category_group_id:Y,sort_order:$},r(B),H(),!!n)try{await o(B)}catch(G){h(G instanceof Error?G.message:"Failed to save changes")}}async function P(N,L){N.preventDefault(),f==="category"?await Q(N,"__group_end__",L):f==="group"&&await O(N,L)}function k(N,L){N.stopPropagation(),m("group"),_(L),N.dataTransfer.effectAllowed="move"}async function O(N,L){if(N.preventDefault(),!g||f!=="group"||g===L){H();return}const U=e.findIndex(B=>B.id===g),R=[...e],[Y]=R.splice(U,1);if(L==="__end__")R.push(Y);else{const B=R.findIndex($=>$.id===L);R.splice(B,0,Y)}const W=R.map((B,$)=>({...B,sort_order:$}));if(a(W),H(),!!n)try{await u(W)}catch(B){h(B instanceof Error?B.message:"Failed to save new order")}}return{dragType:f,draggedId:g,dragOverId:b,dragOverGroupId:E,setDragOverId:x,setDragOverGroupId:S,handleCategoryDragStart:T,handleCategoryDragOver:D,handleDragOverGroup:j,handleDragLeave:M,handleDragLeaveGroup:K,handleDragEnd:H,handleCategoryDrop:Q,handleDropOnGroup:P,handleGroupDragStart:k,handleGroupDrop:O}}function CL(){const{selectedBudgetId:t,currentUserId:e,currentYear:n,currentMonthNumber:r}=Pt(),{budget:a,categories:o,categoryGroups:u,isLoading:h,saveCategories:f,saveCategoryGroups:m,saveCategoriesAndGroups:g,setCategoriesOptimistic:_,setCategoryGroupsOptimistic:b,getOnBudgetTotal:x}=Mn(t,e),[E,S]=C.useState(null),{categoryBalances:T,loadingBalances:D,categoryBalanceMismatch:j,checkCategoryBalanceMismatch:M,recalculateAndSaveCategoryBalances:K}=wL({budgetId:t,categories:o,currentYear:n,currentMonth:r,updateCategoriesWithBalances:f}),H=EL({categories:o,categoryGroups:u,currentBudget:a,setCategoriesOptimistic:_,setCategoryGroupsOptimistic:b,saveCategories:f,saveCategoryGroups:m,setError:S});async function Q($,G){if(!a)return;const J=G==="ungrouped"?null:G,re=Object.values(o).filter(te=>G==="ungrouped"?!te.category_group_id:te.category_group_id===G),V=re.length>0?Math.max(...re.map(te=>te.sort_order)):-1,q=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,ee={name:$.name,description:$.description??"",category_group_id:J,sort_order:V+1,default_monthly_amount:$.default_monthly_amount??0,default_monthly_type:$.default_monthly_type??"fixed",balance:0,is_hidden:$.is_hidden??!1},ne={...o,[q]:ee};_(ne);try{await f(ne)}catch(te){_(o),S(te instanceof Error?te.message:"Failed to create category")}}async function P($,G){if(a)try{const J=o[$];if(!J)return;const re=J.category_group_id||"ungrouped",V=G.category_group_id;let q=J.sort_order;if(re!==(V||"ungrouped")){const ne=Object.values(o).filter(te=>(te.category_group_id||"ungrouped")===(V||"ungrouped")).filter((te,se,he)=>o[$]!==he[se]);q=ne.length>0?Math.max(...ne.map(te=>te.sort_order))+1:0}const ee={...o,[$]:{...J,name:G.name,description:G.description??"",category_group_id:V,sort_order:q,default_monthly_amount:G.default_monthly_amount??0,default_monthly_type:G.default_monthly_type??"fixed",is_hidden:G.is_hidden??!1}};_(ee),await f(ee)}catch(J){S(J instanceof Error?J.message:"Failed to update category")}}async function k($){if(confirm("Are you sure you want to delete this category?")&&a)try{const{[$]:G,...J}=o;_(J),await f(J)}catch(G){S(G instanceof Error?G.message:"Failed to delete category")}}async function O($,G){const J=o[$];if(!J)return;const re=J.category_group_id||"ungrouped",V=Object.entries(o).filter(([,he])=>(he.category_group_id||"ungrouped")===re).sort((he,we)=>he[1].sort_order-we[1].sort_order),q=V.findIndex(([he])=>he===$),ee=G==="up"?q-1:q+1;if(ee<0||ee>=V.length)return;const[ne,te]=V[ee],se={};if(Object.entries(o).forEach(([he,we])=>{he===$?se[he]={...we,sort_order:te.sort_order}:he===ne?se[he]={...we,sort_order:J.sort_order}:se[he]=we}),_(se),!!a)try{await f(se)}catch(he){_(o),S(he instanceof Error?he.message:"Failed to move category")}}async function N($){if(a)try{const G=u.length>0?Math.max(...u.map(V=>V.sort_order)):-1,J={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:$.name,sort_order:G+1},re=[...u,J];b(re),await m(re)}catch(G){S(G instanceof Error?G.message:"Failed to create group")}}async function L($,G){if(a)try{const J=u.map(re=>re.id===$?{...re,name:G.name}:re);b(J),await m(J)}catch(J){S(J instanceof Error?J.message:"Failed to update group")}}async function U($){if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&a)try{const G={};Object.entries(o).forEach(([re,V])=>{G[re]=V.category_group_id===$?{...V,category_group_id:null}:V});const J=u.filter(re=>re.id!==$);_(G),b(J),await g(G,J)}catch(G){S(G instanceof Error?G.message:"Failed to delete group")}}async function R($,G){const J=[...u].sort((ne,te)=>ne.sort_order-te.sort_order),re=J.findIndex(ne=>ne.id===$),V=G==="up"?re-1:re+1;if(V<0||V>=J.length)return;const[q]=J.splice(re,1);J.splice(V,0,q);const ee=J.map((ne,te)=>({...ne,sort_order:te}));if(b(ee),!!a)try{await m(ee)}catch(ne){b(u),S(ne instanceof Error?ne.message:"Failed to move group")}}const Y=Object.entries(o).filter(([,$])=>!$.is_hidden).reduce(($,[G,J])=>{const re=J.category_group_id||"ungrouped";return $[re]||($[re]=[]),$[re].push([G,J]),$},{}),W=Object.entries(o).filter(([,$])=>$.is_hidden).map(([$,G])=>[$,G]).sort(($,G)=>$[1].sort_order-G[1].sort_order),B=[...u].sort(($,G)=>$.sort_order-G.sort_order);return{currentBudget:a,categories:o,categoryGroups:u,categoriesByGroup:Y,hiddenCategories:W,sortedGroups:B,categoryBalances:T,isLoading:h,loadingBalances:D,error:E,setError:S,getOnBudgetTotal:x,categoryBalanceMismatch:j,checkCategoryBalanceMismatch:M,recalculateAndSaveCategoryBalances:K,handleCreateCategory:Q,handleUpdateCategory:P,handleDeleteCategory:k,handleMoveCategory:O,handleCreateGroup:N,handleUpdateGroup:L,handleDeleteGroup:U,handleMoveGroup:R,dragType:H.dragType,draggedId:H.draggedId,dragOverId:H.dragOverId,dragOverGroupId:H.dragOverGroupId,setDragOverId:H.setDragOverId,setDragOverGroupId:H.setDragOverGroupId,handleCategoryDragStart:H.handleCategoryDragStart,handleCategoryDragOver:H.handleCategoryDragOver,handleDragOverGroup:H.handleDragOverGroup,handleDragLeave:H.handleDragLeave,handleDragLeaveGroup:H.handleDragLeaveGroup,handleDragEnd:H.handleDragEnd,handleCategoryDrop:H.handleCategoryDrop,handleDropOnGroup:H.handleDropOnGroup,handleGroupDragStart:H.handleGroupDragStart,handleGroupDrop:H.handleGroupDrop}}function Ll(){Qe.removeQueries({queryKey:["budget"]}),Qe.removeQueries({queryKey:["month"]}),Qe.removeQueries({queryKey:["accessibleBudgets"]}),Qe.removeQueries({queryKey:["payees"]}),Qe.removeQueries({queryKey:["user"]});try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")}catch{}console.log("[Migration] All caches cleared")}async function rc(t){try{const e=await t();return Ll(),e}catch(e){throw Ll(),e}}const oT=C.createContext(null),mw={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function TL({children:t}){const[e,n]=C.useState(mw),r=C.useCallback(()=>({setStage:h=>{n(f=>({...f,stage:h}))},setProgress:h=>{n(f=>({...f,progress:h}))},setCurrentItem:h=>{n(f=>({...f,currentItem:h}))},setDetails:h=>{n(f=>({...f,details:h}))},updateItemProgress:(h,f,m)=>{const g=f>0?Math.round(h/f*100):0;n(_=>({..._,progress:g,currentItem:m||`Item ${h} of ${f}`,details:`${h} / ${f} complete`}))}}),[]),a=C.useCallback(async(h,f)=>{n({isOpen:!0,migrationName:h,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const m=r();try{const g=await f(m);return Ll(),n(_=>({..._,isComplete:!0,stage:"Migration complete",progress:100,details:g.errors.length>0?`Completed with ${g.errors.length} error(s)`:"All operations successful"})),g}catch(g){Ll();const _=g instanceof Error?g.message:"Unknown error occurred";throw n(b=>({...b,isComplete:!0,error:_,stage:"Migration failed",progress:null})),g}},[r]),o=C.useCallback(()=>{n(h=>h.isComplete?mw:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),h))},[]),u={state:e,runMigrationWithProgress:a,closeModal:o};return c.jsx(oT.Provider,{value:u,children:t})}function lT(){const t=C.useContext(oT);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function AL(t){return(await pn("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function jL(t,e){return(await pn("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(a=>({id:a.id,data:a.data,budgetId:a.data.budget_id,year:a.data.year,month:a.data.month})).sort((a,o)=>a.year!==o.year?a.year-o.year:a.month-o.month)}async function ri(t){const e=await AL(t),n=await pn("months",`${t}: batch reading all months`),r=new Map;for(const a of n.docs){const o=a.data.budget_id,u={id:a.id,data:a.data,budgetId:o,year:a.data.year,month:a.data.month};r.has(o)||r.set(o,[]),r.get(o).push(u)}for(const a of r.values())a.sort((o,u)=>o.year!==u.year?o.year-u.year:o.month-u.month);return{budgets:e,monthsByBudget:r}}async function ed(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"months",docId:Nr(r.budgetId,r.year,r.month),data:{...r.data,updated_at:new Date().toISOString()}}));await lm(n,`${e}: batch writing ${t.length} months`)}async function cT(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"budgets",docId:r.budgetId,data:{...r.data,updated_at:new Date().toISOString()}}));await lm(n,`${e}: batch writing ${t.length} budgets`)}async function uT(t,e,n){if(e.length===0)return;let r=C0;const a=[];for(const g of e){const _=T0(g,r);a.push(_),r=Af(_)}const o=a.map(g=>({budgetId:t,year:g.year,month:g.month,data:g}));await ed(o,n);const u=r.accountEndBalances,h=r.categoryEndBalances,{exists:f,data:m}=await We("budgets",t,`${n}: reading budget for final update`);if(f&&m){const g=XC(m.month_map||{}),_=A0(g);await ZC(t,u,h,_)}}async function RL(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,a]of n){a.sort((h,f)=>h.year!==f.year?h.year-f.year:h.month-f.month),await ed(a,e);const u=(await jL(r,e)).map(h=>h.data);await uT(r,u,e)}}function dT(t){return t.nickname===void 0||t.description===void 0||t.balance===void 0||t.sort_order===void 0||t.is_income_account===void 0||t.is_income_default===void 0||t.is_outgo_account===void 0||t.is_outgo_default===void 0||t.on_budget===void 0||t.is_active===void 0}function hT(t){return t.name===void 0||t.description===void 0||t.sort_order===void 0||t.default_monthly_amount===void 0||t.default_monthly_type===void 0||t.balance===void 0}function fT(t){return t.name===void 0||t.sort_order===void 0}function mT(t){return t.budget_id===void 0||t.year_month_ordinal===void 0||t.year===void 0||t.month===void 0||!Array.isArray(t.income)||t.total_income===void 0||t.previous_month_income===void 0||!Array.isArray(t.expenses)||t.total_expenses===void 0||!Array.isArray(t.account_balances)||!Array.isArray(t.category_balances)||t.are_allocations_finalized===void 0||t.created_at===void 0||t.updated_at===void 0}function pT(){const t=new Date,e=t.getFullYear();let r=t.getMonth()+1+Mu,a=e;for(;r>12;)r-=12,a+=1;return{year:a,month:r}}function gT(t,e,n){return t>n.year||t===n.year&&e>n.month}async function DL(){const t=await pn("budgets","database cleanup: scanning all budgets");let e=0,n=0,r=0,a=0,o=0,u=0,h=0,f=0,m=0;const g=new Set;for(const j of t.docs){const M=j.data;if(Array.isArray(M.accounts)||Array.isArray(M.categories)||Array.isArray(M.account_groups)){e++;continue}g.add(j.id),M.month_map===void 0&&f++,M.earliest_month!==void 0&&m++;const K=M.accounts;if(K&&typeof K=="object"){let P=!1;for(const k of Object.values(K))dT(k)&&(o++,P=!0);P&&n++}const H=M.categories;if(H&&typeof H=="object"){let P=!1;for(const k of Object.values(H))hT(k)&&(u++,P=!0);P&&r++}const Q=M.account_groups;if(Q&&typeof Q=="object"){let P=!1;for(const k of Object.values(Q))fT(k)&&(h++,P=!0);P&&a++}}const _=await pn("months","database cleanup: scanning all months"),b=pT(),x=[];let E=0,S=0;for(const j of _.docs){const M=j.data,K=M.year,H=M.month;K&&H&&gT(K,H,b)&&x.push({docId:j.id,budgetId:M.budget_id,year:K,month:H}),mT(M)&&E++,M.is_needs_recalculation!==void 0&&S++}x.sort((j,M)=>j.year!==M.year?j.year-M.year:j.month-M.month);const T=await pn("data_mappings","database cleanup: scanning all data mappings");let D=0;for(const j of T.docs)j.data.budget_id===void 0&&D++;return{totalBudgets:t.docs.length,budgetsWithArrays:e,budgetsWithMissingAccountDefaults:n,budgetsWithMissingCategoryDefaults:r,budgetsWithMissingGroupDefaults:a,accountsNeedingDefaults:o,categoriesNeedingDefaults:u,groupsNeedingDefaults:h,budgetsNeedingMonthMapUpdate:f,budgetsWithDeprecatedEarliestMonth:m,totalMonths:_.docs.length,futureMonthsToDelete:x,monthsWithSchemaIssues:E,monthsWithOldRecalcField:S,totalDataMappings:T.docs.length,dataMappingsMissingBudgetId:D}}function pw(t){return{nickname:t.nickname??"",description:t.description??"",balance:t.balance??0,account_group_id:t.account_group_id??null,sort_order:t.sort_order??0,is_income_account:t.is_income_account??!1,is_income_default:t.is_income_default??!1,is_outgo_account:t.is_outgo_account??!1,is_outgo_default:t.is_outgo_default??!1,on_budget:t.on_budget??!0,is_active:t.is_active??!0,is_hidden:t.is_hidden??!1}}function gw(t){return{name:t.name??"",description:t.description??"",category_group_id:t.category_group_id??null,sort_order:t.sort_order??0,default_monthly_amount:t.default_monthly_amount??0,default_monthly_type:t.default_monthly_type??"fixed",balance:t.balance??0,is_hidden:t.is_hidden??!1}}function yw(t){return{name:t.name??"",sort_order:t.sort_order??0,...t.expected_balance!==void 0&&{expected_balance:t.expected_balance},...t.on_budget!==void 0&&{on_budget:t.on_budget},...t.is_active!==void 0&&{is_active:t.is_active}}}function IL(t,e){const n=e.match(/_(\d{4})(\d{2})$/),r=n?parseInt(n[1]):new Date().getFullYear(),a=n?parseInt(n[2]):new Date().getMonth()+1,o=`${r}${String(a).padStart(2,"0")}`;return{budget_id:t.budget_id??"",year_month_ordinal:t.year_month_ordinal??o,year:t.year??r,month:t.month??a,income:Array.isArray(t.income)?t.income:[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:Array.isArray(t.expenses)?t.expenses:[],total_expenses:t.total_expenses??0,transfers:Array.isArray(t.transfers)?t.transfers:[],adjustments:Array.isArray(t.adjustments)?t.adjustments:[],account_balances:Array.isArray(t.account_balances)?t.account_balances:[],category_balances:Array.isArray(t.category_balances)?t.category_balances:[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at??new Date().toISOString(),updated_at:t.updated_at??new Date().toISOString()}}async function ML(t){const e={},n=await pn("months",`database cleanup: querying all months for budget ${t}`,[{field:"budget_id",op:"==",value:t}]);for(const r of n.docs){const a=r.data;if(a.year&&a.month){const o=It(a.year,a.month);e[o]={needs_recalculation:!1}}}return e}async function kL(){const t=[];let e=0,n=0,r=0,a=0,o=0,u=0,h=0,f=0,m=0,g=0;const _=await pn("budgets","database cleanup: reading all budgets to fix");for(const T of _.docs)try{const{exists:D,data:j}=await We("budgets",T.id,"database cleanup: reading budget for update");if(!D||!j)continue;let M=!1;const K={...j};if(Array.isArray(j.accounts)){const H=j.accounts,Q={};for(const P of H){const k=P.id||`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;Q[k]=pw(P),n++}K.accounts=Q,M=!0,o++}if(Array.isArray(j.categories)){const H=j.categories,Q={};for(const P of H){const k=P.id||`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;Q[k]=gw(P),r++}K.categories=Q,M=!0,o++}if(Array.isArray(j.account_groups)){const H=j.account_groups,Q={};for(const P of H){const k=P.id||`group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;Q[k]=yw(P),a++}K.account_groups=Q,M=!0,o++}if(!Array.isArray(j.accounts)&&j.accounts&&typeof j.accounts=="object"){const H=j.accounts,Q={};for(const[P,k]of Object.entries(H))dT(k)?(Q[P]=pw(k),n++,M=!0):Q[P]=k;M&&(K.accounts=Q)}if(!Array.isArray(j.categories)&&j.categories&&typeof j.categories=="object"){const H=j.categories,Q={};let P=!1;for(const[k,O]of Object.entries(H))hT(O)?(Q[k]=gw(O),r++,P=!0):Q[k]=O;P&&(K.categories=Q,M=!0)}if(!Array.isArray(j.account_groups)&&j.account_groups&&typeof j.account_groups=="object"){const H=j.account_groups,Q={};let P=!1;for(const[k,O]of Object.entries(H))fT(O)?(Q[k]=yw(O),a++,P=!0):Q[k]=O;P&&(K.account_groups=Q,M=!0)}if(j.month_map===void 0){const H=await ML(T.id);K.month_map=H,M=!0,u++}delete K.category_balances,delete K.allocations,delete K.allocations_finalized,delete K.is_needs_recalculation,delete K.earliest_month,M&&(await mt("budgets",T.id,K,"database cleanup: saving fixed budget"),e++),j.earliest_month!==void 0&&(await Pl("budgets",T.id,{earliest_month:uw(),updated_at:new Date().toISOString()},`database cleanup: removing deprecated earliest_month from budget ${T.id}`),h++)}catch(D){t.push(`Budget ${T.id}: ${D instanceof Error?D.message:"Unknown error"}`)}const b=await pn("months","database cleanup: reading all months"),x=pT();for(const T of b.docs)try{const D=T.data,j=D.year,M=D.month;if(j&&M&&gT(j,M,x)){await KC("months",T.id,`database cleanup: deleting future month ${j}-${M}`),f++;continue}if(mT(D)){const K=IL(D,T.id);await mt("months",T.id,K,"database cleanup: saving fixed month"),m++}D.is_needs_recalculation!==void 0&&(await Pl("months",T.id,{is_needs_recalculation:uw(),updated_at:new Date().toISOString()},`database cleanup: removing is_needs_recalculation from month ${j}/${M}`),g++)}catch(D){t.push(`Month ${T.id}: ${D instanceof Error?D.message:"Unknown error"}`)}let E=0;const S=await pn("data_mappings","database cleanup: reading all data mappings");for(const T of S.docs)try{const D=T.data;if(D.budget_id!==void 0)continue;const j=T.id,M=j.lastIndexOf("_import_data_map");if(M===-1){t.push(`Data mapping ${j}: Cannot extract budget_id from document ID (unexpected format)`);continue}const K=j.substring(0,M),{exists:H}=await We("budgets",K,`database cleanup: verifying budget exists for data mapping ${j}`);if(!H){t.push(`Data mapping ${j}: Referenced budget ${K} does not exist`);continue}await mt("data_mappings",j,{...D,budget_id:K},`database cleanup: adding budget_id to data mapping ${j}`),E++}catch(D){t.push(`Data mapping ${T.id}: ${D instanceof Error?D.message:"Unknown error"}`)}return{budgetsProcessed:e,accountsFixed:n,categoriesFixed:r,groupsFixed:a,arraysConverted:o,monthMapsUpdated:u,deprecatedFieldsRemoved:h,futureMonthsDeleted:f,monthsFixed:m,oldRecalcFieldsRemoved:g,dataMappingsFixed:E,errors:t}}function OL({currentUser:t,onComplete:e}){const[n,r]=C.useState(!1),[a,o]=C.useState(!1),[u,h]=C.useState(null),[f,m]=C.useState(null);async function g(){if(t){r(!0);try{const E=await DL();h(E)}catch(E){console.error("Failed to scan database:",E)}finally{r(!1)}}}async function _(){if(t){o(!0),m(null);try{const E=await rc(()=>kL());m(E),e?.()}catch(E){m({budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,groupsFixed:0,arraysConverted:0,monthMapsUpdated:0,deprecatedFieldsRemoved:0,futureMonthsDeleted:0,monthsFixed:0,oldRecalcFieldsRemoved:0,dataMappingsFixed:0,errors:[E instanceof Error?E.message:"Unknown error"]})}finally{o(!1)}}}const b=u!==null&&(u.budgetsWithArrays>0||u.accountsNeedingDefaults>0||u.categoriesNeedingDefaults>0||u.groupsNeedingDefaults>0||u.budgetsNeedingMonthMapUpdate>0||u.budgetsWithDeprecatedEarliestMonth>0||u.futureMonthsToDelete.length>0||u.monthsWithSchemaIssues>0||u.monthsWithOldRecalcField>0||u.dataMappingsMissingBudgetId>0),x=u!==null?u.budgetsWithArrays+u.accountsNeedingDefaults+u.categoriesNeedingDefaults+u.groupsNeedingDefaults+u.budgetsNeedingMonthMapUpdate+u.budgetsWithDeprecatedEarliestMonth+u.futureMonthsToDelete.length+u.monthsWithSchemaIssues+u.monthsWithOldRecalcField+u.dataMappingsMissingBudgetId:0;return{status:u,isScanning:n,scanStatus:g,hasIssues:b,totalIssues:x,isRunning:a,result:f,runCleanup:_}}function Lg(t){return t.includes("@")?!1:!!(/_[a-z0-9]+_(com|org|net|edu|io|co|uk|gov|mil|biz|info)$/i.test(t)&&(t.match(/_/g)||[]).length>=2||/_[a-z0-9]+\.(com|org|net|edu|io|co|uk|gov|mil|biz|info)$/i.test(t)&&(t.match(/_/g)||[]).length>=1)}function NL(t){let e=t;const n=/^(.+)_(gmail|yahoo|hotmail|outlook|icloud|aol|proton|protonmail)\.(.+)$/i,r=e.match(n);return r?`${r[1]}@${r[2]}.${r[3]}`:(e=e.replace(/_com$/,".com").replace(/_net$/,".net").replace(/_org$/,".org").replace(/_edu$/,".edu").replace(/_io$/,".io"),e=e.replace(/_gmail_/,"@gmail.").replace(/_yahoo_/,"@yahoo.").replace(/_hotmail_/,"@hotmail.").replace(/_outlook_/,"@outlook.").replace(/_icloud_/,"@icloud."),e)}function Zh(t){if(t===null||typeof t!="object"||Array.isArray(t))return!1;const e=t;return e._methodName==="arrayUnion"&&Array.isArray(e.vc)}function yT(t){return t.vc||[]}function _w(t){return Array.isArray(t.items)?t.items:Zh(t.items)?yT(t.items):[]}function PL({currentUser:t}){const[e,n]=C.useState(!1),[r,a]=C.useState(!1),[o,u]=C.useState(null),[h,f]=C.useState(null);async function m(){if(!t)return;n(!0);const _={documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],isHealthy:!0};try{const b=await pn("feedback","feedback migration: scanning for issues");_.documentsFound=b.docs.length;for(const x of b.docs)Lg(x.id)&&_.sanitizedDocuments.push(x.id),Zh(x.data.items)&&_.corruptedDocuments.push(x.id);_.isHealthy=_.sanitizedDocuments.length===0&&_.corruptedDocuments.length===0,u(_)}catch(b){console.error("Failed to scan feedback:",b)}finally{n(!1)}}async function g(){if(t){a(!0);try{const _=await rc(async()=>{const b={documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],mergedItems:0,deletedDocuments:0,fixedDocuments:0,errors:[]},x=await pn("feedback","feedback migration: listing all documents");b.documentsFound=x.docs.length;for(const E of x.docs){const S=Lg(E.id);if(Zh(E.data.items)&&!S){b.corruptedDocuments.push(E.id);const D=yT(E.data.items);try{await mt("feedback",E.id,{items:D,user_email:E.data.user_email||E.id,created_at:E.data.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},`feedback migration: fixing corrupted arrayUnion in ${E.id}`),b.fixedDocuments++}catch(j){b.errors.push(`Failed to fix ${E.id}: ${j instanceof Error?j.message:"Unknown error"}`)}}}for(const E of x.docs)if(Lg(E.id)){b.sanitizedDocuments.push(E.id);const S=E.id,T=NL(S),D=_w(E.data),{exists:j,data:M}=await We("feedback",T,`feedback migration: checking if ${T} exists`);if(j&&M){const K=_w(M),H=new Set(K.map(P=>P.id)),Q=D.filter(P=>!H.has(P.id));if(Q.length>0||Zh(M.items)){const P=[...K,...Q];await mt("feedback",T,{...M,items:P,updated_at:new Date().toISOString()},`feedback migration: merging ${Q.length} items from ${S}`),b.mergedItems+=Q.length}}else D.length>0&&(await mt("feedback",T,{items:D,user_email:T,created_at:E.data.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},`feedback migration: creating ${T} from ${S}`),b.mergedItems+=D.length);try{await KC("feedback",S,`feedback migration: deleting sanitized document ${S}`),b.deletedDocuments++}catch(K){b.errors.push(`Failed to delete ${S}: ${K instanceof Error?K.message:"Unknown error"}`)}}return b});f(_)}catch(_){f({documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],mergedItems:0,deletedDocuments:0,fixedDocuments:0,errors:[_ instanceof Error?_.message:"Migration failed"]})}finally{a(!1)}}}return{status:o,isScanning:e,scanStatus:m,isMigratingFeedback:r,feedbackMigrationResult:h,migrateFeedbackDocuments:g}}async function LL(t){const{exists:e,data:n}=await We("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r={...n.accounts};for(const o of Object.keys(r))r[o]&&typeof r[o]=="object"&&(r[o]={...r[o],balance:0});const a={...n.categories};for(const o of Object.keys(a))a[o]&&typeof a[o]=="object"&&(a[o]={...a[o],balance:0});await mt("budgets",t,{...n,accounts:r,categories:a,month_map:{},total_available:0,is_needs_recalculation:!1,updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} balances to zero`)}function BL({currentUser:t,onComplete:e}){const[n,r]=C.useState(!1),[a,o]=C.useState(!1),[u,h]=C.useState(null),[f,m]=C.useState(null),[g,_]=C.useState(null);async function b(){if(t){r(!0);try{const E=await pn("months","delete all months: scanning for all months"),S=[],T=new Set;for(const D of E.docs){const{budget_id:j,year:M,month:K}=D.data;T.add(j),S.push({docId:D.id,budgetId:j,year:M,month:K})}S.sort((D,j)=>D.budgetId!==j.budgetId?D.budgetId.localeCompare(j.budgetId):D.year!==j.year?D.year-j.year:D.month-j.month),h({monthsToDelete:S,monthsCount:S.length,budgetCount:T.size})}catch{}finally{r(!1)}}}async function x(){if(!t||!u||u.monthsToDelete.length===0)return;o(!0),m(null);const E=u.monthsToDelete.length,S=new Set,T=[];for(const H of u.monthsToDelete)S.add(H.budgetId);_({phase:"deleting",deleted:0,total:E,currentMonth:null,budgetsRecalculated:0,totalBudgets:u.budgetCount,percentComplete:0});const D=u.monthsToDelete.map(H=>({collectionPath:"months",docId:H.docId}));let j=0;try{await qP(D,"delete all months: batch deleting all month documents",H=>{j=H,_({phase:"deleting",deleted:H,total:E,currentMonth:`Batch ${Math.ceil(H/500)} of ${Math.ceil(E/500)}`,budgetsRecalculated:0,totalBudgets:u.budgetCount,percentComplete:Math.round(H/E*70)})}),j=E}catch(H){T.push(`Batch delete failed: ${H instanceof Error?H.message:"Unknown error"}`)}const M=Array.from(S);let K=0;for(const H of M){_({phase:"resetting-budgets",deleted:j,total:E,currentMonth:`Budget ${K+1}/${M.length}`,budgetsRecalculated:K,totalBudgets:M.length,percentComplete:70+Math.round(K/M.length*25)});try{await LL(H),K++}catch{K++}}_({phase:"clearing-cache",deleted:j,total:E,currentMonth:null,budgetsRecalculated:K,totalBudgets:M.length,percentComplete:95}),Ll(),_({phase:"complete",deleted:j,total:E,currentMonth:null,budgetsRecalculated:K,totalBudgets:M.length,percentComplete:100}),m({deleted:j,errors:T,budgetsRecalculated:K}),o(!1),_(null),T.length===0&&(h({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:u,isScanning:n,scanStatus:b,isDeleting:a,deleteResult:f,deleteProgress:g,deleteAllMonths:x}}function bw(t){if(!t)return 0;let e=0;for(const n of t)ot(n.start_balance??0)&&e++,ot(n.end_balance??0)&&e++,ot(n.allocated??0)&&e++,ot(n.spent??0)&&e++,ot(n.income??0)&&e++,ot(n.expenses??0)&&e++,ot(n.net_change??0)&&e++;return e}function vw(t){if(!t)return 0;let e=0;for(const n of t)ot(n.amount??0)&&e++;return e}async function xw(){const t=await pn("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,a=0;for(const _ of t.docs){const b=_.data;let x=!1;ot(b.total_available??0)&&(a++,x=!0);const E=b.accounts;if(E&&typeof E=="object")for(const T of Object.values(E))ot(T.balance??0)&&(n++,x=!0);const S=b.categories;if(S&&typeof S=="object")for(const T of Object.values(S))ot(T.balance??0)&&(r++,x=!0),ot(T.default_monthly_amount??0)&&(r++,x=!0);x&&e++}const o=await pn("months","precision cleanup: scanning all months");let u=0,h=0,f=0,m=0,g=0;for(const _ of o.docs){const b=_.data;let x=!1;(ot(b.total_income??0)||ot(b.total_expenses??0)||ot(b.previous_month_income??0))&&(x=!0);const E=vw(b.income);E>0&&(h+=E,x=!0);const S=vw(b.expenses);S>0&&(f+=S,x=!0);const T=bw(b.category_balances);T>0&&(m+=T,x=!0);const D=bw(b.account_balances);D>0&&(g+=D,x=!0),x&&u++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:a,totalMonths:o.docs.length,monthsWithPrecisionIssues:u,incomeValuesWithPrecisionIssues:h,expenseValuesWithPrecisionIssues:f,categoryBalancesWithPrecisionIssues:m,accountBalancesWithPrecisionIssues:g}}function Sw(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=Ee(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=Ee(e.end_balance)),e.allocated!==void 0&&(e.allocated=Ee(e.allocated)),e.spent!==void 0&&(e.spent=Ee(e.spent)),e.income!==void 0&&(e.income=Ee(e.income)),e.expenses!==void 0&&(e.expenses=Ee(e.expenses)),e.net_change!==void 0&&(e.net_change=Ee(e.net_change)),e}function zL(t,e){let n=!1;ot(t.total_available??0)&&(t.total_available=Ee(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,u]of Object.entries(r)){const h=u;ot(h.balance??0)&&(r[o].balance=Ee(h.balance??0),e.accountsFixed++,n=!0)}const a=t.categories;if(a&&typeof a=="object")for(const[o,u]of Object.entries(a)){const h=u;ot(h.balance??0)&&(a[o].balance=Ee(h.balance??0),e.categoriesFixed++,n=!0),ot(h.default_monthly_amount??0)&&(a[o].default_monthly_amount=Ee(h.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function UL(t,e){let n=!1;if(ot(t.total_income??0)&&(t.total_income=Ee(t.total_income??0),n=!0),ot(t.total_expenses??0)&&(t.total_expenses=Ee(t.total_expenses??0),n=!0),ot(t.previous_month_income??0)&&(t.previous_month_income=Ee(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const a of t.income)ot(a.amount??0)?(r.push({...a,amount:Ee(a.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(a);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const a of t.expenses)ot(a.amount??0)?(r.push({...a,amount:Ee(a.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(a);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const a of t.category_balances)ot(a.start_balance??0)||ot(a.end_balance??0)||ot(a.allocated??0)||ot(a.spent??0)?(r.push(Sw(a)),e.categoryBalancesFixed++,n=!0):r.push(a);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const a of t.account_balances)ot(a.start_balance??0)||ot(a.end_balance??0)||ot(a.income??0)||ot(a.expenses??0)||ot(a.net_change??0)?(r.push(Sw(a)),e.accountBalancesFixed++,n=!0):r.push(a);t.account_balances=r}return{fixed:n,data:t}}function VL(t,e,n){const r={...t.data},{fixed:a,data:o}=zL(r,n),u=a?{budgetId:t.id,data:o}:null;a&&n.budgetsProcessed++;const h=[];let f=!1;for(const m of e){const g={...m.data},{fixed:_,data:b}=UL(g,n);_&&(n.monthsProcessed++,f=!0),h.push(b)}return{budgetUpdate:u,fixedMonths:h,hasMonthFixes:f}}async function FL(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await ri("precision cleanup"),r=[],a=[];for(const o of e)try{const u=n.get(o.id)||[],{budgetUpdate:h,fixedMonths:f,hasMonthFixes:m}=VL(o,u,t);h&&r.push(h),(m||f.length>0)&&a.push({budgetId:o.id,months:f})}catch(u){t.errors.push(`Budget ${o.id}: ${u instanceof Error?u.message:String(u)}`)}if(r.length>0)try{await cT(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:u}of a)try{await uT(o,u,"precision cleanup")}catch(h){t.errors.push(`Budget ${o} recalc: ${h instanceof Error?h.message:String(h)}`)}return t}function $L({currentUser:t,onComplete:e}){const[n,r]=C.useState(null),[a,o]=C.useState(!1),[u,h]=C.useState(!1),[f,m]=C.useState(null),[g,_]=C.useState(null),b=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,x=b>0,E=C.useCallback(async()=>{if(t){o(!0),_(null);try{const T=await xw();r(T),m(null)}catch(T){_(T instanceof Error?T.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),S=C.useCallback(async()=>{if(!(!t||!x)){h(!0),_(null);try{const T=await rc(()=>FL());m(T);const D=await xw();r(D),e?.()}catch(T){_(T instanceof Error?T.message:"Failed to run precision cleanup")}finally{h(!1)}}},[t,x,e]);return C.useEffect(()=>{t&&!n&&!a&&E()},[t,n,a,E]),{status:n,isScanning:a,isRunning:u,result:f,error:g,totalIssues:b,hasIssues:x,hasData:n!==null,scan:E,runCleanup:S}}const qL=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],HL=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function dm(t){return!t||Pe(t)?!0:qL.includes(t)}function hm(t){return!t||Je(t)?!0:HL.includes(t)}function _T(t){return dm(t.account_id)||hm(t.category_id)}function GL(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:dm(t.account_id)?Ot:t.account_id,category_id:hm(t.category_id)?Lt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function QL(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],a=[],o=[];let u=0,h=0;for(const m of n)_T(m)?(dm(m.account_id)&&!Pe(m.account_id)&&u++,hm(m.category_id)&&!Je(m.category_id)&&h++,o.push(GL(m))):a.push(m);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:Hn({...e,expenses:a,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:u,invalidCategoriesFixed:h}}}async function WL(){const{budgets:t,monthsByBudget:e}=await ri("expense-to-adjustment-scan");let n=0,r=0,a=0,o=0;for(const u of t){const h=e.get(u.id)||[];n+=h.length;for(const f of h){const g=f.data.expenses||[];for(const _ of g)_T(_)&&(r++,dm(_.account_id)&&!Pe(_.account_id)&&a++,hm(_.category_id)&&!Je(_.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:a,invalidCategoriesToFix:o}}async function KL(){const{budgets:t,monthsByBudget:e}=await ri("expense-to-adjustment-migration"),n=[];let r=0,a=0,o=0;const u=[];for(const h of t){const f=e.get(h.id)||[];for(const m of f)try{const{needsUpdate:g,updatedMonth:_,stats:b}=QL(m);g&&_&&(n.push({budgetId:h.id,year:m.year,month:m.month,data:_}),r+=b.expensesMigrated,a+=b.invalidAccountsFixed,o+=b.invalidCategoriesFixed)}catch(g){u.push(`Month ${m.year}/${m.month} in budget ${h.id}: ${g instanceof Error?g.message:String(g)}`)}}return n.length>0&&await ed(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:a,invalidCategoriesFixed:o,errors:u}}function YL({currentUser:t,onComplete:e}){const[n,r]=C.useState(!1),[a,o]=C.useState(!1),[u,h]=C.useState(null),[f,m]=C.useState(null);async function g(){if(t){r(!0);try{const x=await WL();h(x)}catch(x){console.error("Failed to scan for expense to adjustment migration:",x)}finally{r(!1)}}}async function _(){if(t){o(!0),m(null);try{const x=await rc(()=>KL());m(x),e?.()}catch(x){m({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{o(!1)}}}const b=u!==null&&u.expensesToMigrate>0;return{status:u,isScanning:n,scanStatus:g,hasItemsToMigrate:b,isRunning:a,result:f,runMigration:_}}function bT(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const a=t.accounts;if(a)for(const o of Object.keys(a))n.add(o);return{categoryIds:e,accountIds:n}}function ia(t,e){return!t||Je(t)?!1:!e.has(t)}function ji(t,e){return!t||Pe(t)?!1:!e.has(t)}function XL(t,e){const n=t.data;let r=0,a=0,o=0,u=0,h=0,f=0,m=!1;const g=(n.expenses||[]).map(S=>{const T={...S};let D=!1;return ia(S.category_id,e.categoryIds)&&(T.category_id=Lt,r++,D=!0),ji(S.account_id,e.accountIds)&&(T.account_id=Ot,a++,D=!0),D&&(o++,m=!0),T}),_=(n.income||[]).map(S=>{const T={...S};let D=!1;return ji(S.account_id,e.accountIds)&&(T.account_id=Ot,a++,D=!0),D&&(u++,m=!0),T}),b=(n.transfers||[]).map(S=>{const T={...S};let D=!1;return ia(S.from_category_id,e.categoryIds)&&(T.from_category_id=Lt,r++,D=!0),ia(S.to_category_id,e.categoryIds)&&(T.to_category_id=Lt,r++,D=!0),ji(S.from_account_id,e.accountIds)&&(T.from_account_id=Ot,a++,D=!0),ji(S.to_account_id,e.accountIds)&&(T.to_account_id=Ot,a++,D=!0),D&&(h++,m=!0),T}),x=(n.adjustments||[]).map(S=>{const T={...S};let D=!1;return ia(S.category_id,e.categoryIds)&&(T.category_id=Lt,r++,D=!0),ji(S.account_id,e.accountIds)&&(T.account_id=Ot,a++,D=!0),D&&(f++,m=!0),T});return m?{needsUpdate:!0,updatedMonth:{...n,expenses:g,income:_,transfers:b,adjustments:x,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:a,affectedExpenses:o,affectedIncome:u,affectedTransfers:h,affectedAdjustments:f}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function JL(){const{budgets:t,monthsByBudget:e}=await ri("orphaned-id-scan");let n=0,r=0,a=0,o=0,u=0,h=0,f=0;for(const m of t){const g=bT(m.data),_=e.get(m.id)||[];n+=_.length;for(const b of _){const x=b.data;for(const E of x.expenses||[]){let S=!1;ia(E.category_id,g.categoryIds)&&(r++,S=!0),ji(E.account_id,g.accountIds)&&(a++,S=!0),S&&o++}for(const E of x.income||[])ji(E.account_id,g.accountIds)&&(a++,u++);for(const E of x.transfers||[]){let S=!1;ia(E.from_category_id,g.categoryIds)&&(r++,S=!0),ia(E.to_category_id,g.categoryIds)&&(r++,S=!0),ji(E.from_account_id,g.accountIds)&&(a++,S=!0),ji(E.to_account_id,g.accountIds)&&(a++,S=!0),S&&h++}for(const E of x.adjustments||[]){let S=!1;ia(E.category_id,g.categoryIds)&&(r++,S=!0),ji(E.account_id,g.accountIds)&&(a++,S=!0),S&&f++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:a,affectedExpenses:o,affectedIncome:u,affectedTransfers:h,affectedAdjustments:f}}async function ZL(){const{budgets:t,monthsByBudget:e}=await ri("orphaned-id-cleanup"),n=[];let r=0,a=0;const o=[];for(const u of t){const h=bT(u.data),f=e.get(u.id)||[];for(const m of f)try{const{needsUpdate:g,updatedMonth:_,stats:b}=XL(m,h);g&&_&&(n.push({budgetId:u.id,year:m.year,month:m.month,data:_}),r+=b.categoryIdsFixed,a+=b.accountIdsFixed)}catch(g){o.push(`Month ${m.year}/${m.month} in budget ${u.id}: ${g instanceof Error?g.message:String(g)}`)}}return n.length>0&&await ed(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:a,errors:o}}function e6({currentUser:t,onComplete:e}){const[n,r]=C.useState(!1),[a,o]=C.useState(!1),[u,h]=C.useState(null),[f,m]=C.useState(null);async function g(){if(t){r(!0);try{const x=await JL();h(x)}catch(x){console.error("Failed to scan for orphaned IDs:",x)}finally{r(!1)}}}async function _(){if(t){o(!0),m(null);try{const x=await rc(()=>ZL());m(x),e?.()}catch(x){m({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{o(!1)}}}const b=u!==null&&(u.orphanedCategoryIds>0||u.orphanedAccountIds>0);return{status:u,isScanning:n,scanStatus:g,hasItemsToFix:b,isRunning:a,result:f,runMigration:_}}function t6(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,a=Je(t.category_id)&&Je(e.category_id),o=!Pe(t.account_id)&&!Pe(e.account_id),u=t.account_id!==e.account_id;if(a&&o&&u)return{negative:n,positive:r,type:"account"};const h=Pe(t.account_id)&&Pe(e.account_id),f=!Je(t.category_id)&&!Je(e.category_id),m=t.category_id!==e.category_id;return h&&f&&m?{negative:n,positive:r,type:"category"}:null}function vT(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let a=r+1;a<t.length;a++){if(n.has(t[a].id))continue;const o=t6(t[r],t[a]);if(o){e.push(o),n.add(t[r].id),n.add(t[a].id);break}}return e}function n6(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Lt,to_category_id:Lt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Ot,to_account_id:Ot,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function r6(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],a=vT(n);if(a.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=a.map(n6),u=new Set;for(const m of a)u.add(m.negative.id),u.add(m.positive.id);const h=n.filter(m=>!u.has(m.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:h,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:a.length,adjustmentsRemoved:u.size}}}async function i6(){const{budgets:t,monthsByBudget:e}=await ri("adjustments-to-transfers-scan");let n=0,r=0,a=0,o=0;for(const u of t){const h=e.get(u.id)||[];n+=h.length;for(const f of h){const g=f.data.adjustments||[],_=vT(g);r+=_.length;for(const b of _)b.type==="account"?a++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:a,categoryTransferPairs:o}}async function s6(){const{budgets:t,monthsByBudget:e}=await ri("adjustments-to-transfers-migration"),n=[];let r=0,a=0;const o=[];for(const u of t){const h=e.get(u.id)||[];for(const f of h)try{const{needsUpdate:m,updatedMonth:g,stats:_}=r6(f);m&&g&&(n.push({budgetId:u.id,year:f.year,month:f.month,data:g}),r+=_.pairsConverted,a+=_.adjustmentsRemoved)}catch(m){o.push(`Month ${f.year}/${f.month} in budget ${u.id}: ${m instanceof Error?m.message:String(m)}`)}}return n.length>0&&await ed(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:a,errors:o}}function a6({currentUser:t,onComplete:e}){const[n,r]=C.useState(!1),[a,o]=C.useState(!1),[u,h]=C.useState(null),[f,m]=C.useState(null);async function g(){if(t){r(!0);try{const x=await i6();h(x)}catch(x){console.error("Failed to scan for adjustment pairs:",x)}finally{r(!1)}}}async function _(){if(t){o(!0),m(null);try{const x=await rc(()=>s6());m(x),e?.()}catch(x){m({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{o(!1)}}}const b=u!==null&&u.pairsFound>0;return{status:u,isScanning:n,scanStatus:g,hasPairsToConvert:b,isRunning:a,result:f,runMigration:_}}function xT(t){const e=[];let n="",r=!1;for(let a=0;a<t.length;a++){const o=t[a];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function ST(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function wT(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),a=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(a)||n<1||n>12||r<1||r>31?null:{year:a,month:n,day:r}}function o6(t){const e=t.toLowerCase().trim();return e==="income"?"income":e==="spend"?"spend":e==="allocation"||e==="allocations"?"allocation":null}function ET(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function l6(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const a=xT(r);if(a.length<6)continue;const[o,u,h,f,m,g,_,b]=a;if(o.toLowerCase()==="type")continue;const x=o6(o);if(!x)continue;const E=wT(u);if(!E)continue;const S=ST(g),T=ET(b||"");n.push({recordType:x,date:u,year:E.year,month:E.month,day:E.day,payee:h,category:f,account:m,amount:S,description:_||"",cleared:T,rawLine:r})}return n}function CT(t,e,n){const r=e.toString().padStart(2,"0"),a=n.toString().padStart(2,"0");return`${t}-${r}-${a}`}function c6(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function TT(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const a=xT(r);if(a.length<5)continue;const[o,u,h,f,m,g,_]=a;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const b=wT(o);if(!b)continue;const x=c6(u,h),E=ST(m),S=ET(_||"");n.push({recordType:x,date:o,year:b.year,month:b.month,day:b.day,payee:u,category:h,account:f,amount:E,description:g||"",cleared:S,rawLine:r})}return n}function u6(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function d6(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function h6(t){const e=Pe(t.account_id)||!t.account_id||t.account_id.trim()==="",n=Je(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function f6(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const a=Pe(t.from_account_id),o=Pe(t.to_account_id),u=Je(t.from_category_id),h=Je(t.to_category_id);return a&&o&&u&&h?"All from/to account and category IDs are NO_* (must involve at least one real entity)":a&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":u&&h&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function zh(t,e,n,r,a){return t.filter(o=>{const[u,h,f]=e.split("-").map(Number);return o.year!==u||o.month!==h||o.day!==f||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||a&&o.description&&o.description.toLowerCase().includes(a.toLowerCase()),!0)})}async function m6(t){const e=[];let n=0,r=0,a=0,o=0;const u=t?TT(t):[],{budgets:h,monthsByBudget:f}=await ri("account-category-validation");for(const m of h){const g=f.get(m.id)||[];for(const _ of g){const b=_.data,x=`${b.year}-${String(b.month).padStart(2,"0")}`,E=b.income||[];n+=E.length;for(const j of E){const M=u6(j);M&&e.push({budgetId:m.id,monthKey:x,transactionType:"income",transactionId:j.id,violation:M,transactionDetails:{date:j.date,amount:j.amount,payee:j.payee,description:j.description,accountId:j.account_id},potentialSeedMatches:zh(u,j.date,j.amount,j.payee,j.description)})}const S=b.expenses||[];r+=S.length;for(const j of S){const M=d6(j);M&&e.push({budgetId:m.id,monthKey:x,transactionType:"expense",transactionId:j.id,violation:M,transactionDetails:{date:j.date,amount:j.amount,payee:j.payee,description:j.description,accountId:j.account_id,categoryId:j.category_id},potentialSeedMatches:zh(u,j.date,j.amount,j.payee,j.description)})}const T=b.adjustments||[];a+=T.length;for(const j of T){const M=h6(j);M&&e.push({budgetId:m.id,monthKey:x,transactionType:"adjustment",transactionId:j.id,violation:M,transactionDetails:{date:j.date,amount:j.amount,description:j.description,accountId:j.account_id,categoryId:j.category_id},potentialSeedMatches:zh(u,j.date,j.amount,void 0,j.description)})}const D=b.transfers||[];o+=D.length;for(const j of D){const M=f6(j);M&&e.push({budgetId:m.id,monthKey:x,transactionType:"transfer",transactionId:j.id,violation:M,transactionDetails:{date:j.date,amount:j.amount,description:j.description,fromAccountId:j.from_account_id,toAccountId:j.to_account_id,fromCategoryId:j.from_category_id,toCategoryId:j.to_category_id},potentialSeedMatches:zh(u,j.date,j.amount,void 0,j.description)})}}}return e.sort((m,g)=>{const _=m.monthKey.localeCompare(g.monthKey);return _!==0?_:m.transactionType.localeCompare(g.transactionType)}),{totalBudgets:h.length,totalMonths:Array.from(f.values()).reduce((m,g)=>m+g.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:a,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function p6(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,a]of n){e.push("",`## ${r.toUpperCase()} (${a.length} violations)`,"");for(const o of a){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const u of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${u.rawLine}`,`        Type: ${u.recordType}, Date: ${u.date}, Payee: ${u.payee}`,`        Category: ${u.category}, Account: ${u.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function g6({currentUser:t}){const[e,n]=C.useState(!1),[r,a]=C.useState(null),[o,u]=C.useState(null);async function h(f){if(t){n(!0),a(null),u(null);try{const m=await m6(f);a(m),u(p6(m))}catch(m){console.error("Failed to scan transactions:",m),u(`Error scanning: ${m instanceof Error?m.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:h,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}const y6=[{id:"adjustment_import_1767473622525_qzkq34i7r",amount:14877.86,date:"2020-08-23",description:"Starting Balance on app switchover",targetAccount:"Alerus 401K Eide Bailly",targetCategory:null},{id:"adjustment_import_1767473622530_nj6pnwlb2",amount:-2e3,date:"2022-03-01",description:"Transfer",targetAccount:null,targetCategory:"House"}];async function _6(){const{budgets:t,monthsByBudget:e}=await ri("hidden-field-migration-scan");let n=0,r=0,a=0,o=0;const u=[];for(const h of t){const f=h.data,m=f.accounts;if(m&&typeof m=="object")for(const b of Object.values(m))b.is_hidden===void 0&&n++;const g=f.categories;if(g&&typeof g=="object")for(const b of Object.values(g))b.is_hidden===void 0&&r++;const _=e.get(h.id)||[];o+=_.length;for(const b of _){const x=b.data,E=`${x.year}-${String(x.month).padStart(2,"0")}`;for(const S of x.adjustments||[]){const T=Pe(S.account_id)||!S.account_id,D=Je(S.category_id)||!S.category_id;T&&D&&(a++,u.push({monthKey:E,id:S.id,description:S.description||"",amount:S.amount,accountId:S.account_id,categoryId:S.category_id}))}}}return{totalBudgets:t.length,totalMonths:o,accountsNeedingField:n,categoriesNeedingField:r,adjustmentsToFix:a,adjustmentDetails:u}}async function b6(t){const e={budgetsProcessed:0,accountsUpdated:0,categoriesUpdated:0,hiddenAccountsCreated:0,hiddenCategoriesCreated:0,adjustmentsFixed:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await ri("hidden-field-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const a=[],o=[];t.setStage("Processing budgets...");for(let u=0;u<n.length;u++){const h=n[u];t.updateItemProgress(u+1,n.length,`Budget: ${h.data.name||h.id}`);try{const f={...h.data};let m=!1;const g={...f.accounts||{}},_={...f.categories||{}};for(const[D,j]of Object.entries(g))j.is_hidden===void 0&&(g[D]={...j,is_hidden:!1},e.accountsUpdated++,m=!0);for(const[D,j]of Object.entries(_))j.is_hidden===void 0&&(_[D]={...j,is_hidden:!1},e.categoriesUpdated++,m=!0);let b=null;const x="Alerus 401K Eide Bailly";for(const[D,j]of Object.entries(g))if(j.nickname?.toLowerCase()===x.toLowerCase()){b=D;break}if(b)g[b].is_hidden||(g[b]={...g[b],is_hidden:!0},m=!0);else{b=`account_hidden_${Date.now()}_alerus`;const D=Math.max(0,...Object.values(g).map(j=>j.sort_order||0));g[b]={nickname:x,description:"Historical 401K account (hidden)",balance:0,account_group_id:null,sort_order:D+1,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!1,is_active:!0,is_hidden:!0},e.hiddenAccountsCreated++,m=!0}let E=null;const S="House";for(const[D,j]of Object.entries(_))if(j.name?.toLowerCase()===S.toLowerCase()){E=D;break}if(E)_[E].is_hidden||(_[E]={..._[E],is_hidden:!0},m=!0);else{E=`category_hidden_${Date.now()}_house`;const D=Math.max(0,...Object.values(_).map(j=>j.sort_order||0));_[E]={name:S,description:"Historical house-related transactions (hidden)",category_group_id:null,sort_order:D+1,default_monthly_amount:0,default_monthly_type:"fixed",balance:0,is_hidden:!0},e.hiddenCategoriesCreated++,m=!0}const T=r.get(h.id)||[];for(const D of T){const j=D.data;let M=!1;const K=(j.adjustments||[]).map(H=>{const Q=Pe(H.account_id)||!H.account_id,P=Je(H.category_id)||!H.category_id;if(Q&&P){const k=y6.find(O=>O.id===H.id||Math.abs(O.amount-H.amount)<.01&&O.date===H.date&&O.description.toLowerCase()===(H.description||"").toLowerCase());if(k){const O={...H};return k.targetAccount&&(O.account_id=b),k.targetCategory&&(O.category_id=E),e.adjustmentsFixed++,M=!0,O}}return H});M&&o.push({budgetId:h.id,year:j.year,month:j.month,data:{...j,adjustments:K}})}m&&(a.push({budgetId:h.id,data:{...f,accounts:g,categories:_,updated_at:new Date().toISOString()}}),e.budgetsProcessed++)}catch(f){e.errors.push(`Budget ${h.id}: ${f instanceof Error?f.message:String(f)}`)}}return a.length>0&&(t.setStage("Writing budget updates..."),t.setProgress(null),t.setCurrentItem(`${a.length} budget(s) to update`),await cT(a,"hidden-field-migration")),o.length>0&&(t.setStage("Writing month updates and recalculating..."),t.setCurrentItem(`${o.length} month(s) to update`),await RL(o,"hidden-field-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function v6({currentUser:t}){const[e,n]=C.useState(!1),[r,a]=C.useState(!1),[o,u]=C.useState(null),[h,f]=C.useState(null),{runMigrationWithProgress:m}=lT();async function g(){if(t){n(!0);try{const E=await _6();u(E)}catch(E){console.error("Failed to scan hidden field status:",E)}finally{n(!1)}}}async function _(){if(t){a(!0),f(null);try{const E=await m("Hidden Field Migration",S=>b6(S));f(E)}catch(E){f({budgetsProcessed:0,accountsUpdated:0,categoriesUpdated:0,hiddenAccountsCreated:0,hiddenCategoriesCreated:0,adjustmentsFixed:0,errors:[E instanceof Error?E.message:"Unknown error"]})}finally{a(!1)}}}const b=o!==null&&(o.accountsNeedingField>0||o.categoriesNeedingField>0||o.adjustmentsToFix>0),x=o!==null?o.accountsNeedingField+o.categoriesNeedingField+o.adjustmentsToFix:0;return{isScanning:e,isRunning:r,status:o,result:h,scanStatus:g,runMigration:_,needsMigration:b,totalItemsToFix:x}}function ef(t){return t==="no_category"||t==="NO_CATEGORY"}function x6(t,e){const n={};for(const r of t)r.from_category_id&&!ef(r.from_category_id)&&(n[r.from_category_id]=(n[r.from_category_id]||0)-r.amount),r.to_category_id&&!ef(r.to_category_id)&&(n[r.to_category_id]=(n[r.to_category_id]||0)+r.amount);for(const r of e)r.category_id&&!ef(r.category_id)&&(n[r.category_id]=(n[r.category_id]||0)+r.amount);return n}function S6(t,e,n){const r=Object.keys(e).filter(b=>!ef(b)),a=Object.keys(n),o={},u={};r.forEach(b=>{o[b]=0}),a.forEach(b=>{u[b]=0});const h={};r.forEach(b=>{h[b]=[]});const f=[],m=[];for(const b of t){const x=b.data,E=`${b.year}-${String(b.month).padStart(2,"0")}`,S=x.income||[],T=x.expenses||[],D=x.transfers||[],j=x.adjustments||[],M=x.category_balances||[],K=x.account_balances||[],H=x.are_allocations_finalized===!0,Q={};for(const R of M)Q[R.category_id]=R;const P=x6(D,j);for(const R of r){const Y=Ee(o[R]||0);let W=0;H&&Q[R]&&(W=Ee(Q[R].allocated||0));const B=Ee(T.filter(re=>re.category_id===R).reduce((re,V)=>re+V.amount,0)),$=Ee(P[R]||0),G=Ee(Y+W+B+$),J=Ee(Q[R]?.end_balance??0);h[R].push({month:E,startBalance:Y,allocated:W,spent:B,adjustment:$,calculatedEnd:G,storedEnd:J,endDiscrepancy:Ee(G-J)}),o[R]=J}for(const R of a){const Y=Ee(S.filter(J=>J.account_id===R).reduce((J,re)=>J+re.amount,0)),W=Ee(T.filter(J=>J.account_id===R).reduce((J,re)=>J+re.amount,0)),B=Ee(D.filter(J=>J.to_account_id===R).reduce((J,re)=>J+re.amount,0)),$=Ee(D.filter(J=>J.from_account_id===R).reduce((J,re)=>J+re.amount,0)),G=Ee(j.filter(J=>J.account_id===R).reduce((J,re)=>J+re.amount,0));u[R]+=Y+W+B-$+G}const k=Ee(S.reduce((R,Y)=>R+Y.amount,0)),O=Ee(T.reduce((R,Y)=>R+Y.amount,0)),N=Ee(M.reduce((R,Y)=>R+(Y.allocated||0),0)),L=Ee(D.reduce((R,Y)=>R+Y.amount,0)),U=Ee(j.reduce((R,Y)=>R+Y.amount,0));f.push({year:b.year,month:b.month,monthKey:E,totalIncome:k,totalExpenses:O,totalAllocated:N,totalTransfers:L,totalAdjustments:U,allocationsFinalized:H,expenseCount:T.length,incomeCount:S.length,transferCount:D.length,adjustmentCount:j.length}),m.push({year:b.year,month:b.month,income:S,expenses:T,transfers:D,adjustments:j,categoryBalances:M,accountBalances:K,areAllocationsFinalized:H})}const g=r.map(b=>{const x=Ee(e[b]?.balance??0),E=Ee(o[b]);return{categoryId:b,categoryName:e[b]?.name||"Unknown",storedAllTimeBalance:x,calculatedAllTimeBalance:E,discrepancy:Ee(E-x),monthBreakdown:h[b]}}),_=a.map(b=>{const x=Ee(n[b]?.balance??0),E=Ee(u[b]);return{accountId:b,accountName:n[b]?.name||"Unknown",storedBalance:x,calculatedBalance:E,discrepancy:Ee(E-x)}});return{categoryBalances:g,accountBalances:_,monthSummaries:f,rawMonthData:m}}function w6({currentUser:t}){const[e,n]=C.useState(!1),[r,a]=C.useState(null),[o,u]=C.useState(null);async function h(){if(!t){u("Must be logged in to download diagnostics");return}n(!0),u(null),a({phase:"reading",current:0,total:1,percentComplete:0});try{a({phase:"reading",current:0,total:1,percentComplete:10});const{budgets:f,monthsByBudget:m}=await ri("diagnostic-download");a({phase:"analyzing",current:0,total:f.length,percentComplete:30});const g=[];let _=0,b=0,x=0,E=0;for(let M=0;M<f.length;M++){const K=f[M],H=m.get(K.id)||[];_+=H.length;const Q=K.data,P=Q.categories||{},k=Q.accounts||{};b+=Object.keys(P).length,x+=Object.keys(k).length;const{categoryBalances:O,accountBalances:N,monthSummaries:L,rawMonthData:U}=S6(H,P,k),R=O.filter($=>Math.abs($.discrepancy)>.01).length,Y=N.filter($=>Math.abs($.discrepancy)>.01).length,W=Ee(O.reduce(($,G)=>$+G.discrepancy,0)),B=Ee(N.reduce(($,G)=>$+G.discrepancy,0));(R>0||Y>0)&&E++,g.push({budgetId:K.id,budgetName:Q.name||"Unknown Budget",totalAvailable:Q.total_available??0,categoryBalances:O,accountBalances:N,monthSummaries:L,rawMonthData:U,discrepancySummary:{totalCategoryDiscrepancy:W,totalAccountDiscrepancy:B,categoriesWithDiscrepancies:R,accountsWithDiscrepancies:Y}}),a({phase:"analyzing",current:M+1,total:f.length,percentComplete:30+Math.round((M+1)/f.length*60)})}const S={timestamp:new Date().toISOString(),budgets:g,globalSummary:{totalBudgets:f.length,totalMonths:_,totalCategories:b,totalAccounts:x,budgetsWithDiscrepancies:E}};a({phase:"complete",current:1,total:1,percentComplete:100});const T=new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),D=URL.createObjectURL(T),j=document.createElement("a");j.href=D,j.download=`budget-diagnostic-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(D)}catch(f){u(f instanceof Error?f.message:"Unknown error during download")}finally{n(!1),a(null)}}return{isDownloading:e,progress:r,error:o,downloadDiagnostics:h}}const jf=["n/a","na","none","-",""];function AT(t,e,n){const r=t.toLowerCase();for(const[a,o]of Object.entries(e))if((n?o.nickname:o.name).toLowerCase()===r)return a;return null}function jT(t,e,n){if(jf.includes(t.toLowerCase().trim()))return Lt;const r=n.get(t);return r?r.newId:AT(t,e,!1)}function RT(t,e,n){if(jf.includes(t.toLowerCase().trim()))return Ot;const r=n.get(t);return r?r.newId:AT(t,e,!0)}function E6(t,e,n,r){const a=[];let o=0,u=0;const h=e.income.length,f=[];for(const g of t){const _=RT(g.account,n,r);if(!_){a.push(`Unknown account "${g.account}" for income on ${g.date}`),u++;continue}const b={id:`income_import_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:g.amount,account_id:_,date:CT(g.year,g.month,g.day),payee:g.payee,description:g.description,cleared:g.cleared,created_at:new Date().toISOString()};f.push(b),o++}return{monthData:Hn({...e,income:f,updated_at:new Date().toISOString()}),imported:o,skipped:u,errors:a,cleared:h}}function C6(t,e,n,r,a,o){const u=[];let h=0,f=0;const m=e.expenses.length,g=[];for(const b of t){const x=jT(b.category,n,a);if(!x){u.push(`Unknown category "${b.category}" for expense on ${b.date}`),f++;continue}const E=RT(b.account,r,o);if(!E){u.push(`Unknown account "${b.account}" for expense on ${b.date}`),f++;continue}const S={id:`expense_import_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:b.amount,category_id:x,account_id:E,date:CT(b.year,b.month,b.day),payee:b.payee,description:b.description,cleared:b.cleared,created_at:new Date().toISOString()};g.push(S),h++}return{monthData:Hn({...e,expenses:g,updated_at:new Date().toISOString()}),imported:h,skipped:f,errors:u,cleared:m}}function T6(t,e,n,r){const a=[];let o=0,u=0;const h=e.category_balances.filter(g=>g.allocated>0).length,f=new Map;for(const g of t){const _=jT(g.category,n,r);if(!_){a.push(`Unknown category "${g.category}" for allocation on ${g.date}`),u++;continue}const b=f.get(_)||0;f.set(_,b+g.amount),o++}const m=e.category_balances.map(g=>{const _=f.get(g.category_id);return _!==void 0?{...g,allocated:_,end_balance:g.start_balance+_-g.spent}:{...g,allocated:0,end_balance:g.start_balance-g.spent}});for(const[g,_]of f)m.find(b=>b.category_id===g)||m.push({category_id:g,start_balance:0,allocated:_,spent:0,end_balance:_});return{monthData:{...e,category_balances:m,are_allocations_finalized:!0,updated_at:new Date().toISOString()},imported:o,skipped:u,errors:a,cleared:h}}function A6(t,e,n,r,a){const o=new Set(Object.values(e).map(m=>m.name.toLowerCase())),u=new Set(Object.values(n).map(m=>m.nickname.toLowerCase())),h=new Set,f=new Set;for(const m of t){if(m.recordType==="spend"||m.recordType==="allocation"){const g=m.category.toLowerCase().trim(),_=o.has(g),b=r.has(m.category),x=jf.includes(g);!_&&!b&&!x&&m.category&&h.add(m.category)}if(m.recordType==="spend"||m.recordType==="income"){const g=m.account.toLowerCase().trim(),_=u.has(g),b=a.has(m.account),x=jf.includes(g);!_&&!b&&!x&&m.account&&f.add(m.account)}}return{unmappedCategories:Array.from(h).sort(),unmappedAccounts:Array.from(f).sort()}}const ww=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function j6(t,e,n){const r=Object.entries(t).reduce((o,[,u])=>{const h=u.account_group_id?n[u.account_group_id]:void 0,f=h?.on_budget!==void 0?h.on_budget:u.on_budget!==!1,m=h?.is_active!==void 0?h.is_active:u.is_active!==!1;return f&&m?o+(u.balance??0):o},0),a=Object.values(e).reduce((o,u)=>{const h=u.balance??0;return o+(h>0?h:0)},0);return r-a}async function R6(t,e,n){const{exists:r,data:a}=await We("budgets",t,"[seed import] reading budget for final update");if(!r||!a)throw new Error(`Budget ${t} not found`);const o={...a.accounts};for(const[_,b]of Object.entries(e.accountEndBalances))o[_]&&(o[_]={...o[_],balance:b});const u={...a.categories};for(const[_,b]of Object.entries(e.categoryEndBalances))u[_]&&(u[_]={...u[_],balance:b});const f={...a.month_map||{}};for(const{info:_}of n)f[_.ordinal]={needs_recalculation:!1};const m=j6(o,u,a.account_groups||{});await mt("budgets",t,{...a,accounts:o,categories:u,total_available:m,is_needs_recalculation:!1,month_map:f,updated_at:new Date().toISOString()},"[seed import] saving final balances");const g=Qe.getQueryData(Se.budget(t));if(g){const _={};for(const[x,E]of Object.entries(g.accounts)){const S=o[x];_[x]=S?{...E,balance:S.balance??E.balance}:E}const b={};for(const[x,E]of Object.entries(g.categories)){const S=u[x];b[x]=S?{...E,balance:S.balance??E.balance}:E}Qe.setQueryData(Se.budget(t),{...g,accounts:_,categories:b,isNeedsRecalculation:!1,monthMap:f,budget:{...g.budget,accounts:o,categories:u,total_available:m,is_needs_recalculation:!1,month_map:f}})}}async function D6(t,e,n,r,a,o,u){const h=[];let f=0,m=0,g=0,_=0,b=0,x=0;const E=[],S=new Map;for(const N of e){const L=`${N.year}-${N.month}`;S.has(L)||S.set(L,[]),S.get(L).push(N)}for(const[N,L]of S){const[U,R]=N.split("-"),Y=parseInt(U,10),W=parseInt(R,10);E.push({key:N,year:Y,month:W,ordinal:It(Y,W),name:`${ww[W-1]} ${Y}`,rows:L})}if(E.sort((N,L)=>N.ordinal.localeCompare(L.ordinal)),E.length>0){const N=new Set(E.map(W=>W.ordinal)),L=E[0],U=E[E.length-1];let R=L.year,Y=L.month;for(;R<U.year||R===U.year&&Y<=U.month;){const W=It(R,Y);N.has(W)||E.push({key:`${R}-${Y}`,year:R,month:Y,ordinal:W,name:`${ww[Y-1]} ${R}`,rows:[]}),Y++,Y>12&&(Y=1,R++)}E.sort((W,B)=>W.ordinal.localeCompare(B.ordinal))}const T=E.filter(N=>N.rows.length===0).length,D=E.length;u({phase:"reading-months",currentMonth:null,monthsProcessed:0,totalMonths:D,recordsImported:0,totalRecords:e.length,monthsCreated:0,monthsToCreate:0,gapMonths:T,percentComplete:5,incomeImported:0,spendImported:0,allocationsImported:0});const j=await Promise.all(E.map(async N=>{try{const L=await zn(t,N.year,N.month,"seed import combined");return{info:N,data:L,needsCreation:!1}}catch{return{info:N,data:null,needsCreation:!0}}})),M=new Map(j.map(N=>[N.info.ordinal,N])),K=E.map(N=>M.get(N.ordinal)),H=K.filter(N=>N.needsCreation).length;if(H>0){u({phase:"creating-months",currentMonth:null,monthsProcessed:0,totalMonths:D,recordsImported:0,totalRecords:e.length,monthsCreated:0,monthsToCreate:H,gapMonths:T,percentComplete:15,incomeImported:0,spendImported:0,allocationsImported:0});for(const N of K)if(N.needsCreation)try{N.data=await eT(t,N.info.year,N.info.month,{bypassDateLimit:!0}),g++,u({phase:"creating-months",currentMonth:N.info.name,monthsProcessed:0,totalMonths:D,recordsImported:0,totalRecords:e.length,monthsCreated:g,monthsToCreate:H,gapMonths:T,percentComplete:15+Math.round(g/H*10),incomeImported:0,spendImported:0,allocationsImported:0})}catch(L){N.error=`Failed to create month ${N.info.month}/${N.info.year}: ${L instanceof Error?L.message:"Unknown error"}`,h.push(N.error),m+=N.info.rows.length}}u({phase:"processing-months",currentMonth:null,monthsProcessed:0,totalMonths:D,recordsImported:0,totalRecords:e.length,monthsCreated:g,monthsToCreate:H,gapMonths:T,percentComplete:30,incomeImported:0,spendImported:0,allocationsImported:0});const Q=[];let P=0,k=C0;for(const N of K){if(!N.data||N.error){P++;continue}let L=N.data;const U=N.info.rows,R=U.filter(B=>B.recordType==="income"),Y=U.filter(B=>B.recordType==="spend"),W=U.filter(B=>B.recordType==="allocation");if(R.length>0){const B=E6(R,L,r,o);L=B.monthData,f+=B.imported,_+=B.imported,m+=B.skipped,h.push(...B.errors)}if(Y.length>0){const B=C6(Y,L,n,r,a,o);L=B.monthData,f+=B.imported,b+=B.imported,m+=B.skipped,h.push(...B.errors)}if(W.length>0){const B=T6(W,L,n,a);L=B.monthData,f+=B.imported,x+=B.imported,m+=B.skipped,h.push(...B.errors)}L=T0(L,k),k=Af(L),Q.push({info:N.info,data:L}),P++,u({phase:"processing-months",currentMonth:N.info.name,monthsProcessed:P,totalMonths:D,recordsImported:f,totalRecords:e.length,monthsCreated:g,monthsToCreate:H,gapMonths:T,percentComplete:30+Math.round(P/D*30),incomeImported:_,spendImported:b,allocationsImported:x})}u({phase:"saving-months",currentMonth:null,monthsProcessed:Q.length,totalMonths:Q.length,recordsImported:f,totalRecords:e.length,monthsCreated:g,monthsToCreate:H,gapMonths:T,percentComplete:65,incomeImported:_,spendImported:b,allocationsImported:x});const O=Q.map(({info:N,data:L})=>({collectionPath:"months",docId:Nr(t,N.year,N.month),data:L}));try{await lm(O,`seed import combined (${Q.length} months)`)}catch(N){h.push(`Error batch saving months: ${N instanceof Error?N.message:"Unknown error"}`)}u({phase:"updating-budget",currentMonth:null,monthsProcessed:Q.length,totalMonths:Q.length,recordsImported:f,totalRecords:e.length,monthsCreated:g,monthsToCreate:H,gapMonths:T,percentComplete:85,incomeImported:_,spendImported:b,allocationsImported:x});try{await R6(t,k,Q)}catch(N){h.push(`Error updating budget: ${N instanceof Error?N.message:"Unknown error"}`)}return{success:h.length===0,imported:f,skipped:m,errors:h}}function I6(t){const e=t.split(`
`)[0]?.toLowerCase().trim()||"";return e.startsWith("cash flow")||e.startsWith("date,")?"raw_cash_flow":(e.startsWith("type,")||e.startsWith("income,")||e.startsWith("spend,")||e.startsWith("allocation,"),"combined")}async function M6(t){if(!t)return{categoryMappings:new Map,accountMappings:new Map};try{const{exists:e,data:n}=await We("data_mappings",`${t}_import_data_map`,"loading existing import mappings");if(!e||!n)return{categoryMappings:new Map,accountMappings:new Map};const r=new Map,a=new Map;if(n.category_mappings)for(const[o,u]of Object.entries(n.category_mappings))r.set(o,{oldName:o,newId:u.id,newName:u.name});if(n.account_mappings)for(const[o,u]of Object.entries(n.account_mappings))a.set(o,{oldName:o,newId:u.id,newName:u.name});return{categoryMappings:r,accountMappings:a}}catch(e){return console.error("[useSeedImport] Failed to load existing mappings:",e),{categoryMappings:new Map,accountMappings:new Map}}}async function k6(t,e,n){if(!t)return;const r={},a={};for(const[u,h]of e)r[u]={id:h.newId,name:h.newName};for(const[u,h]of n)a[u]={id:h.newId,name:h.newName};const o={budget_id:t,category_mappings:r,account_mappings:a,last_updated:new Date().toISOString()};await mt("data_mappings",`${t}_import_data_map`,o,"saving import mappings")}function O6(t){const[e,n]=C.useState("idle"),[r,a]=C.useState(null),[o,u]=C.useState([]),[h,f]=C.useState([]),[m,g]=C.useState([]),[_,b]=C.useState([]),[x,E]=C.useState(new Map),[S,T]=C.useState(new Map),[D,j]=C.useState(null),[M,K]=C.useState(null),H=e==="parsing",Q=e==="importing",P=o.length>0||h.length>0,k=C.useCallback(async(R,Y,W)=>{n("parsing"),j(null);try{const B=await R.text(),G=I6(B)==="raw_cash_flow"?TT(B):l6(B);if(G.length===0){n("error"),a(null);return}a(G);const J=new Set,re=new Set,V=["n/a","na","none","-",""];for(const Me of G){if((Me.recordType==="spend"||Me.recordType==="allocation")&&Me.category){const ke=Me.category.toLowerCase().trim();V.includes(ke)||J.add(Me.category)}if((Me.recordType==="spend"||Me.recordType==="income")&&Me.account){const ke=Me.account.toLowerCase().trim();V.includes(ke)||re.add(Me.account)}}const q=Array.from(J).sort(),ee=Array.from(re).sort(),{categoryMappings:ne,accountMappings:te}=await M6(t),se=new Map;for(const[Me,ke]of Object.entries(Y))se.set(ke.name.toLowerCase(),{id:Me,name:ke.name});const he=new Map;for(const[Me,ke]of Object.entries(W))he.set(ke.nickname.toLowerCase(),{id:Me,name:ke.nickname});const we=[],ge=[];for(const Me of q)if(ne.has(Me)){const ke=se.get(Me.toLowerCase()),lt=ne.get(Me);(!ke||ke.id!==lt.newId)&&we.push(Me)}for(const Me of ee)if(te.has(Me)){const ke=he.get(Me.toLowerCase()),lt=te.get(Me);(!ke||ke.id!==lt.newId)&&ge.push(Me)}g(we),b(ge);const Z=new Map(ne);for(const Me of q)if(!Z.has(Me)){const ke=se.get(Me.toLowerCase());ke&&Z.set(Me,{oldName:Me,newId:ke.id,newName:ke.name})}const ve=new Map(te);for(const Me of ee)if(!ve.has(Me)){const ke=he.get(Me.toLowerCase());ke&&ve.set(Me,{oldName:Me,newId:ke.id,newName:ke.name})}E(Z),T(ve);const{unmappedCategories:Te,unmappedAccounts:dt}=A6(G,Y,W,Z,ve);u(Te),f(dt),Te.length>0||dt.length>0?n("mapping"):n("ready")}catch(B){console.error("[useSeedImport] Parse error:",B),n("error"),a(null)}},[t]),O=C.useCallback((R,Y,W)=>{E(B=>{const $=new Map(B);return $.set(R,{oldName:R,newId:Y,newName:W}),$}),u(B=>{const $=B.filter(G=>G===R?!1:!x.has(G));return $.length===0&&h.length===0&&n("ready"),$})},[x,h.length]),N=C.useCallback((R,Y,W)=>{T(B=>{const $=new Map(B);return $.set(R,{oldName:R,newId:Y,newName:W}),$}),f(B=>{const $=B.filter(G=>G===R?!1:!S.has(G));return $.length===0&&o.length===0&&n("ready"),$})},[S,o.length]),L=C.useCallback(async(R,Y)=>{if(!t||!r)return;n("importing"),K({phase:"saving-mappings",currentMonth:null,monthsProcessed:0,totalMonths:0,recordsImported:0,totalRecords:r.length,monthsCreated:0,monthsToCreate:0,gapMonths:0,percentComplete:0,incomeImported:0,spendImported:0,allocationsImported:0}),await k6(t,x,S);const W=await D6(t,r,R,Y,x,S,B=>K(B));Ll(),K(B=>B?{...B,phase:"complete",percentComplete:100}:null),j(W),n(W.success?"complete":"error")},[t,r,x,S]),U=C.useCallback(()=>{n("idle"),a(null),u([]),f([]),g([]),b([]),j(null),K(null)},[]);return{status:e,parsedData:r,unmappedCategories:o,unmappedAccounts:h,customMappedCategories:m,customMappedAccounts:_,categoryMappings:x,accountMappings:S,importResult:D,importProgress:M,parseFile:k,setCategoryMapping:O,setAccountMapping:N,runImport:L,reset:U,isParsing:H,isImporting:Q,hasUnmappedEntities:P}}function Ew({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:a,editName:o,isRenaming:u,onAccept:h,onSwitch:f,onStartEdit:m,onCancelEdit:g,onEditNameChange:_,onSaveEdit:b}){const x=e&&t.isOwner;return c.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:a?c.jsxs("form",{onSubmit:b,children:[c.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:c.jsx("input",{type:"text",value:o,onChange:E=>_(E.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[c.jsx("button",{type:"submit",disabled:u||!o.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:u||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:u||!o.trim()?.7:1,fontSize:"0.8rem"},children:u?"Saving...":"Save"}),c.jsx("button",{type:"button",onClick:g,disabled:u,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:u?"not-allowed":"pointer",fontWeight:500,opacity:u?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[c.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[c.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&c.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&c.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&c.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),x&&c.jsx("button",{onClick:m,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),c.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?c.jsx("button",{onClick:h,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:c.jsx("button",{onClick:f,disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}const oe={primary:"#646cff",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},Jr={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},Rf="1px solid color-mix(in srgb, currentColor 20%, transparent)",Df={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},td={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},N6={...td,padding:"0.6rem 0.875rem",gap:"0.5rem"},P6={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},L6={display:"flex",flexDirection:"column",gap:"0.5rem"},B6={fontSize:"0.9rem",fontWeight:500},Ea={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},z6={...Ea,cursor:"pointer"},j0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},DT={...j0,background:oe.primary,color:"white",border:"none"},U6={...DT,padding:"0.75rem 1.5rem",borderRadius:"8px"},V6={...j0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},F6={...j0,background:"transparent",border:`1px solid ${oe.errorBorder}`,color:oe.error},$6={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s"},q6={display:"flex",gap:"0.5rem"},H6={display:"flex",gap:"0.25rem"},IT={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.9rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"2rem",minHeight:"2rem",transition:"opacity 0.15s, border-color 0.15s"},G6={...IT,borderColor:oe.errorBorder,color:oe.error},Bl={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},R0={display:"flex",flexDirection:"column",gap:"2px"},Q6={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},MT={opacity:.4,cursor:"grab"},kT={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:oe.primary,borderRadius:"2px",transition:"opacity 0.15s"},W6={position:"relative",height:"2rem",marginTop:"-0.25rem"},K6={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:oe.primary,borderRadius:"2px",transition:"opacity 0.15s"},Y6={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},X6={background:oe.errorBg,border:`1px solid ${oe.errorBorder}`,color:oe.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},J6={background:"transparent",border:"none",color:oe.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},OT={opacity:.7,marginBottom:"1.5rem"},fm={margin:0,fontSize:"0.85rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6},D0={fontWeight:500,fontSize:"1.1rem"},zl={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"},Ey={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function NT({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in Ey?n:"bug",a=Ey[r];return c.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:a.bgColor,color:a.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:a.label})}function Z6({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:a,onDragLeave:o,onDragEnd:u,onDrop:h,onToggleDone:f,onTypeClick:m}){return c.jsxs("div",{onDragOver:g=>{g.stopPropagation(),a(g)},onDragLeave:g=>{g.stopPropagation(),o()},onDrop:g=>{g.stopPropagation(),h(g)},style:{position:"relative"},children:[c.jsx("div",{style:{...kT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),c.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:u,style:{...td,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[c.jsx("span",{style:{...MT},children:""}),c.jsx("input",{type:"checkbox",checked:t.is_done,onChange:f,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:oe.primary,flexShrink:0}}),c.jsx(NT,{type:t.feedback_type,onClick:m})]}),c.jsxs("div",{style:{marginLeft:"3.25rem"},children:[c.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",Sy(t.created_at)]})]})]})]})}function eB({item:t,onToggleDone:e,onTypeClick:n}){return c.jsxs("div",{style:{...td,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[c.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:oe.primary,flexShrink:0}}),c.jsx(NT,{type:t.feedback_type,onClick:n})]}),c.jsxs("div",{style:{marginLeft:"2rem"},children:[c.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",Sy(t.created_at)]}),t.completed_at&&c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:oe.success},children:[" Completed: ",Sy(t.completed_at)]})]})]})}function Ul({noMargin:t}={}){return c.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function Bi({title:t,description:e,status:n,statusText:r,onRefresh:a,isRefreshing:o,isBusy:u=!1,children:h,cardName:f}){const g=(()=>{switch(n){case"unknown":return{color:"#9ca3af",text:r??"Unknown"};case"clean":case"complete":return{color:"#22c55e",text:r??" Clean"};case"needs-action":return{color:"#f59e0b",text:r??"Action Needed"}}})(),_=o||u;return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1.5rem",marginBottom:"1rem"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.75rem"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("h3",{style:{margin:"0 0 0.5rem 0"},children:t}),c.jsx("p",{style:{margin:0,opacity:.7,fontSize:"0.9rem"},children:e})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexShrink:0},children:[n!=="unknown"&&c.jsx("span",{style:{color:g.color,fontWeight:600,fontSize:"0.9rem"},children:g.text}),c.jsxs("button",{onClick:()=>{a()},disabled:_,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.65rem",borderRadius:"6px",cursor:_?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:_?.6:1,display:"flex",alignItems:"center",gap:"0.3rem"},title:"Refresh status",children:[o?c.jsx(Ul,{noMargin:!0}):""," Refresh"]})]})]}),h]})}const tB={unknown:{bg:"rgba(100, 100, 100, 0.1)",border:"rgba(100, 100, 100, 0.3)",color:"#9ca3af"},clean:{bg:"rgba(34, 197, 94, 0.1)",border:"rgba(34, 197, 94, 0.3)",color:"#4ade80"},warning:{bg:"rgba(245, 158, 11, 0.1)",border:"rgba(245, 158, 11, 0.3)",color:"#fbbf24"},running:{bg:"rgba(200, 200, 200, 0.1)",border:"rgba(200, 200, 200, 0.3)",color:"rgba(255, 255, 255, 0.7)"},success:{bg:"rgba(34, 197, 94, 0.1)",border:"rgba(34, 197, 94, 0.3)",color:"#4ade80"}};function Ve({type:t,children:e}){const n=tB[t];return c.jsx("div",{style:{background:n.bg,border:`1px solid ${n.border}`,color:n.color,padding:"0.75rem 1rem",borderRadius:"8px",display:"flex",alignItems:"center"},children:e})}function Or({onClick:t,disabled:e,isBusy:n,busyText:r,children:a,actionName:o}){const u=e||n;return c.jsx("button",{onClick:()=>{t()},disabled:u,style:{marginTop:"1rem",background:"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:u?"not-allowed":"pointer",fontWeight:500,opacity:u?.7:1,display:"flex",alignItems:"center",gap:"0.4rem"},children:n?c.jsxs(c.Fragment,{children:[c.jsx(Ul,{noMargin:!0})," ",r??"Running..."]}):a})}function nB({hasData:t,status:e,hasIssues:n,totalIssues:r,isRunning:a,result:o,onRunCleanup:u,onRefresh:h,isRefreshing:f,disabled:m}){const g=()=>t?o&&o.errors.length===0&&(o.accountsFixed>0||o.categoriesFixed>0||o.groupsFixed>0||o.monthMapsUpdated>0||o.deprecatedFieldsRemoved>0||o.futureMonthsDeleted>0||o.monthsFixed>0||o.oldRecalcFieldsRemoved>0||o.dataMappingsFixed>0)?"complete":n?"needs-action":"clean":"unknown",_=o?o.accountsFixed+o.categoriesFixed+o.groupsFixed+o.monthMapsUpdated+o.deprecatedFieldsRemoved+o.futureMonthsDeleted+o.monthsFixed+o.oldRecalcFieldsRemoved+o.dataMappingsFixed:0;return c.jsx(Bi,{title:" Database Cleanup",description:"Validates and fixes all budget, month, and data mapping documents to match the expected schema. Converts legacy formats, adds missing default values, removes invalid future months, and ensures data mappings have required security fields.",status:g(),onRefresh:h,isRefreshing:f,isBusy:a,children:a?c.jsx(Ve,{type:"running",children:"Running database cleanup..."}):o?c.jsx(Ve,{type:o.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[o.errors.length>0?"":""," Cleanup complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[o.budgetsProcessed>0&&c.jsxs("li",{children:[o.budgetsProcessed," budget",o.budgetsProcessed!==1?"s":""," updated"]}),o.arraysConverted>0&&c.jsxs("li",{children:[o.arraysConverted," array",o.arraysConverted!==1?"s":""," converted to maps"]}),o.accountsFixed>0&&c.jsxs("li",{children:[o.accountsFixed," account",o.accountsFixed!==1?"s":""," fixed"]}),o.categoriesFixed>0&&c.jsxs("li",{children:[o.categoriesFixed," categor",o.categoriesFixed!==1?"ies":"y"," fixed"]}),o.groupsFixed>0&&c.jsxs("li",{children:[o.groupsFixed," group",o.groupsFixed!==1?"s":""," fixed"]}),o.monthMapsUpdated>0&&c.jsxs("li",{children:[o.monthMapsUpdated," budget",o.monthMapsUpdated!==1?"s":""," got month_map updated"]}),o.deprecatedFieldsRemoved>0&&c.jsxs("li",{children:[o.deprecatedFieldsRemoved," budget",o.deprecatedFieldsRemoved!==1?"s":""," had deprecated fields removed"]}),o.futureMonthsDeleted>0&&c.jsxs("li",{children:[o.futureMonthsDeleted," future month",o.futureMonthsDeleted!==1?"s":""," deleted"]}),o.monthsFixed>0&&c.jsxs("li",{children:[o.monthsFixed," month",o.monthsFixed!==1?"s":""," schema fixed"]}),o.oldRecalcFieldsRemoved>0&&c.jsxs("li",{children:[o.oldRecalcFieldsRemoved," month",o.oldRecalcFieldsRemoved!==1?"s":""," had old recalc field removed"]}),o.dataMappingsFixed>0&&c.jsxs("li",{children:[o.dataMappingsFixed," data mapping",o.dataMappingsFixed!==1?"s":""," had budget_id added"]}),_===0&&c.jsx("li",{children:"No changes needed"})]}),o.errors.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[o.errors.slice(0,5).map((b,x)=>c.jsx("li",{children:b},x)),o.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",o.errors.length-5," more errors"]})]})]})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Ve,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",r," issue",r!==1?"s":""," to fix:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.budgetsWithArrays>0&&c.jsxs("li",{children:[e.budgetsWithArrays," budget",e.budgetsWithArrays!==1?"s":""," using legacy array format"]}),e.accountsNeedingDefaults>0&&c.jsxs("li",{children:[e.accountsNeedingDefaults," account",e.accountsNeedingDefaults!==1?"s":""," missing default values"]}),e.categoriesNeedingDefaults>0&&c.jsxs("li",{children:[e.categoriesNeedingDefaults," categor",e.categoriesNeedingDefaults!==1?"ies":"y"," missing default values"]}),e.groupsNeedingDefaults>0&&c.jsxs("li",{children:[e.groupsNeedingDefaults," account group",e.groupsNeedingDefaults!==1?"s":""," missing default values"]}),e.budgetsNeedingMonthMapUpdate>0&&c.jsxs("li",{children:[e.budgetsNeedingMonthMapUpdate," budget",e.budgetsNeedingMonthMapUpdate!==1?"s":""," missing month_map"]}),e.budgetsWithDeprecatedEarliestMonth>0&&c.jsxs("li",{children:[e.budgetsWithDeprecatedEarliestMonth," budget",e.budgetsWithDeprecatedEarliestMonth!==1?"s":""," with deprecated earliest_month field to remove"]}),e.futureMonthsToDelete.length>0&&c.jsxs("li",{children:[e.futureMonthsToDelete.length," future month",e.futureMonthsToDelete.length!==1?"s":""," to delete",c.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.85rem",opacity:.8},children:[e.futureMonthsToDelete.slice(0,3).map(b=>c.jsxs("li",{children:[Cl[b.month-1]," ",b.year]},b.docId)),e.futureMonthsToDelete.length>3&&c.jsxs("li",{style:{opacity:.7},children:["...and ",e.futureMonthsToDelete.length-3," more"]})]})]}),e.monthsWithSchemaIssues>0&&c.jsxs("li",{children:[e.monthsWithSchemaIssues," month",e.monthsWithSchemaIssues!==1?"s":""," with schema issues"]}),e.monthsWithOldRecalcField>0&&c.jsxs("li",{children:[e.monthsWithOldRecalcField," month",e.monthsWithOldRecalcField!==1?"s":""," with deprecated is_needs_recalculation field"]}),e.dataMappingsMissingBudgetId>0&&c.jsxs("li",{children:[e.dataMappingsMissingBudgetId," data mapping",e.dataMappingsMissingBudgetId!==1?"s":""," missing budget_id (security fix)"]})]}),c.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budgets, ",e.totalMonths," months, and ",e.totalDataMappings," data mappings."]})]})}),c.jsxs(Or,{onClick:u,disabled:m,isBusy:a,busyText:"Running...",actionName:"Run Database Cleanup",children:[" Fix ",r," Issue",r!==1?"s":""]})]}):c.jsx(Ve,{type:"clean",children:c.jsxs("div",{children:[" Database is clean",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalBudgets," budgets, ",e.totalMonths," months, and ",e.totalDataMappings," data mappings match expected schema."]})]})}):c.jsx(Ve,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function rB({hasData:t,status:e,isMigrating:n,onMigrate:r,onRefresh:a,isRefreshing:o,disabled:u,migrationResult:h}){const f=e&&(e.sanitizedDocuments.length>0||e.corruptedDocuments.length>0),m=h&&(h.deletedDocuments>0||h.fixedDocuments>0),g=()=>t?m?"complete":f?"needs-action":"clean":"unknown";return c.jsx(Bi,{title:" Consolidate Feedback Documents",description:"Fixes corrupted feedback data and merges documents with sanitized IDs into proper email format.",status:g(),onRefresh:a,isRefreshing:o,isBusy:n,children:n?c.jsx(Ve,{type:"running",children:"Migrating feedback documents..."}):t?m?c.jsx(Ve,{type:"success",children:c.jsxs("div",{children:[" Migration complete:",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[h.fixedDocuments>0&&c.jsxs("li",{children:["Fixed ",h.fixedDocuments," corrupted document(s)"]}),h.deletedDocuments>0&&c.jsxs("li",{children:["Merged & deleted ",h.deletedDocuments," sanitized document(s)"]}),h.mergedItems>0&&c.jsxs("li",{children:["Merged ",h.mergedItems," feedback item(s)"]})]}),h.errors.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:{marginTop:"0.5rem"},children:" Errors:"}),c.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem",fontSize:"0.9rem"},children:h.errors.map((_,b)=>c.jsx("li",{children:_},b))})]})]})}):f?c.jsxs(c.Fragment,{children:[c.jsx(Ve,{type:"warning",children:c.jsxs("div",{children:[e?.corruptedDocuments&&e.corruptedDocuments.length>0&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.corruptedDocuments.length," corrupted document(s):"]}),c.jsx("ul",{style:{margin:"0 0 0.75rem 0",paddingLeft:"1.25rem",fontSize:"0.9rem"},children:e.corruptedDocuments.map(_=>c.jsxs("li",{children:[_," ",c.jsx("span",{style:{opacity:.6},children:"(broken arrayUnion)"})]},_))})]}),e?.sanitizedDocuments&&e.sanitizedDocuments.length>0&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.sanitizedDocuments.length," sanitized document(s) to merge:"]}),c.jsx("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:e.sanitizedDocuments.map(_=>c.jsx("li",{children:_},_))})]})]})}),c.jsx(Or,{onClick:r,disabled:u,isBusy:n,busyText:"Migrating...",actionName:"Run Feedback Migration",children:"Run Migration"})]}):c.jsxs(Ve,{type:"clean",children:[" No issues found. All feedback documents are healthy.",c.jsxs("span",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginTop:"0.25rem"},children:["Found ",e?.documentsFound??0," document(s) total."]})]}):c.jsx(Ve,{type:"unknown",children:" Status unknown  click Refresh to scan for issues"})})}function nd({message:t="Loading...",spinnerColor:e=oe.primary,children:n,spinnerSize:r=4}){return c.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[c.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),c.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,c.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function mm({percent:t,gradient:e="linear-gradient(90deg, #646cff, #8b5cf6)",width:n=300}){return c.jsx("div",{style:{width:`${n}px`,height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden"},children:c.jsx("div",{style:{width:`${t}%`,height:"100%",background:e,borderRadius:"4px",transition:"width 0.3s ease-out"}})})}function xn({value:t,label:e,color:n="#646cff"}){return c.jsxs("div",{style:{textAlign:"center"},children:[c.jsx("p",{style:{color:n,fontSize:"1.5rem",fontWeight:700,margin:0},children:t}),c.jsx("p",{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.8rem",margin:"0.25rem 0 0",textTransform:"uppercase",letterSpacing:"0.05em"},children:e})]})}function Tl({children:t,columns:e=3}){return c.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${e}, 1fr)`,gap:"2rem",textAlign:"center"},children:t})}function pm({percent:t}){return c.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:"0.9rem",margin:0},children:[t,"% complete"]})}function So({message:t,children:e,onDismiss:n,style:r}){return c.jsxs("div",{style:{...X6,...r},children:[c.jsx("span",{children:e??t}),n&&c.jsx("button",{onClick:n,style:J6,children:""})]})}const iB={primary:DT,"primary-large":U6,secondary:V6,danger:F6,small:$6};function Ie({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:a,style:o,actionName:u,onClick:h,...f}){const m=iB[t],g=a||e;function _(b){h?.(b)}return c.jsx("button",{disabled:g,style:{...m,cursor:g?"not-allowed":"pointer",opacity:g?.7:1,...o},onClick:_,...f,children:e?n:r})}function PT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const h=r.indexOf(n);return{match:!0,score:h===0||/\s/.test(r[h-1])?100:90}}let a=0,o=0,u=0;for(let h=0;h<r.length&&a<n.length;h++)r[h]===n[a]?(a++,u++,o+=u*2):u=0;return a===n.length?{match:!0,score:o}:{match:!1,score:0}}function LT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function BT(t){const e=LT(t),n=[];let r="__initial__";return e.forEach(a=>{a.groupId!==r&&(r=a.groupId,n.push({groupId:a.groupId,groupName:a.groupName,groupSortOrder:a.groupSortOrder,items:[]})),n[n.length-1].items.push(a)}),n}function zT(t,e,n){return e.trim()?t.map(a=>{const o=n(a);let u=0,h=!1;for(const f of o){const m=PT(e,f);m.match&&(h=!0,u=Math.max(u,m.score))}return{item:a,score:u,hasMatch:h}}).filter(({hasMatch:a})=>a).sort((a,o)=>o.score!==a.score?o.score-a.score:!a.item.groupId&&o.item.groupId?1:a.item.groupId&&!o.item.groupId?-1:a.item.groupSortOrder!==o.item.groupSortOrder?a.item.groupSortOrder-o.item.groupSortOrder:a.item.sortOrder-o.item.sortOrder).map(({item:a})=>a):LT(t)}const I0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},ku={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function Cw({id:t,value:e,onChange:n,payees:r,placeholder:a="Enter payee name"}){const[o,u]=C.useState(!1),[h,f]=C.useState(-1),m=C.useRef(null),g=C.useRef(null),_=e.trim()?r.map(E=>({payee:E,...PT(e,E)})).filter(E=>E.match).sort((E,S)=>S.score-E.score).slice(0,8).map(E=>E.payee):[];C.useEffect(()=>{function E(S){m.current&&!m.current.contains(S.target)&&u(!1)}return document.addEventListener("mousedown",E),()=>document.removeEventListener("mousedown",E)},[]);function b(E){!o||_.length===0||(E.key==="ArrowDown"?(E.preventDefault(),f(S=>Math.min(S+1,_.length-1))):E.key==="ArrowUp"?(E.preventDefault(),f(S=>Math.max(S-1,-1))):E.key==="Enter"&&h>=0?(E.preventDefault(),n(_[h]),u(!1),f(-1)):E.key==="Escape"&&(u(!1),f(-1)))}function x(E){n(E),u(!1),f(-1),g.current?.focus()}return c.jsxs("div",{ref:m,style:{position:"relative"},children:[c.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:E=>{n(E.target.value),u(!0),f(-1)},onFocus:()=>u(!0),onKeyDown:b,placeholder:a,autoComplete:"off",style:Ea}),o&&_.length>0&&c.jsx("div",{style:{...I0,maxHeight:"200px",overflowY:"auto"},children:_.map((E,S)=>c.jsx("div",{onClick:()=>x(E),style:{...ku,background:S===h?`color-mix(in srgb, ${oe.primary} 20%, transparent)`:"transparent",borderBottom:S<_.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>f(S),children:E},E))})]})}function UT({id:t,value:e,onChange:n,categories:r,categoryGroups:a,placeholder:o="Search categories...",required:u,showNoCategoryOption:h=!1,showHiddenCategories:f=!1}){const m=Object.fromEntries(a.map($=>[$.id,$.name])),g=Object.fromEntries(a.map($=>[$.id,$.sort_order])),_=f?r:Object.fromEntries(Object.entries(r).filter(([,$])=>!$.is_hidden)),b=Object.entries(_).map(([$,G])=>({id:$,name:G.name,groupId:G.category_group_id,groupName:G.category_group_id&&m[G.category_group_id]||null,sortOrder:G.sort_order,groupSortOrder:G.category_group_id?g[G.category_group_id]??999:999})),x=e===Lt,E=x?null:e?r[e]:null,S=x?"":E?.name||"",[T,D]=C.useState(S),[j,M]=C.useState(!1),[K,H]=C.useState(-1),Q=C.useRef(null),P=C.useRef(null);C.useEffect(()=>{if(e===Lt)D("");else{const $=e?r[e]:null;D($?.name||"")}},[e,r]);const k=zT(b,T,$=>[$.name,$.groupName||""].filter(Boolean)),O=BT(k);C.useEffect(()=>{function $(G){if(Q.current&&!Q.current.contains(G.target))if(M(!1),e===Lt)D("");else{const J=e?r[e]:null;D(J?.name||"")}}return document.addEventListener("mousedown",$),()=>document.removeEventListener("mousedown",$)},[e,r]);function N($){if($.key==="ArrowDown")$.preventDefault(),j?H(G=>Math.min(G+1,k.length-1)):(M(!0),H(0));else if($.key==="ArrowUp")$.preventDefault(),H(G=>Math.max(G-1,0));else if($.key==="Enter")$.preventDefault(),j&&K>=0&&k[K]&&L(k[K]);else if($.key==="Escape")if(M(!1),H(-1),e===Lt)D("");else{const G=e?r[e]:null;D(G?.name||"")}else if($.key==="Tab"&&j&&k.length>0){const G=K>=0?K:0;L(k[G])}}function L($){n($.id),D($.id===Lt?"":$.name),M(!1),H(-1),P.current?.focus()}function U(){n(Lt),D(""),M(!1),H(-1)}function R($){const G=$.target.value;D(G),M(!0),H(-1),G!==S&&n("")}function Y(){M(!0),k.length>0&&H(0)}let W=-1;const B=()=>++W;return c.jsxs("div",{ref:Q,style:{position:"relative"},children:[c.jsx("input",{ref:P,id:t,type:"text",value:T,onChange:R,onFocus:Y,onKeyDown:N,placeholder:o,autoComplete:"off",required:u,style:{...Ea,borderColor:u&&!e?oe.error:void 0}}),j&&c.jsxs("div",{style:{...I0,maxHeight:"250px",overflowY:"auto"},children:[h&&c.jsx("div",{onClick:U,onMouseEnter:()=>H(-1),style:{...ku,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:K===-1?`color-mix(in srgb, ${oe.primary} 20%, transparent)`:"transparent"},children:ba}),O.map(($,G)=>c.jsxs("div",{children:[$.groupName&&c.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:$.groupName}),$.items.map(J=>{const re=B();return c.jsx("div",{onClick:()=>L(J),style:{...ku,paddingLeft:$.groupName?"1.2rem":"0.8rem",background:re===K?`color-mix(in srgb, ${oe.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>H(re),children:J.name},J.id)})]},`group-${G}`)),k.length===0&&T.trim()&&!h&&c.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function VT({id:t,value:e,onChange:n,accounts:r,accountGroups:a,placeholder:o="Search accounts...",required:u,showNoAccountOption:h=!1,showHiddenAccounts:f=!1}){const g=(f?r:r.filter(([,W])=>!W.is_hidden)).map(([W,B])=>({id:W,name:B.nickname,groupId:B.account_group_id,groupName:B.account_group_id&&a[B.account_group_id]?.name||null,sortOrder:B.sort_order,groupSortOrder:B.account_group_id?a[B.account_group_id]?.sort_order??999:999})),_=e===Ot,b=_?null:r.find(([W])=>W===e)?.[1],x=_?"":b?.nickname||"",[E,S]=C.useState(x),[T,D]=C.useState(!1),[j,M]=C.useState(-1),K=C.useRef(null),H=C.useRef(null);C.useEffect(()=>{if(e===Ot)S("");else{const W=r.find(([B])=>B===e)?.[1];S(W?.nickname||"")}},[e,r]);const Q=zT(g,E,W=>[W.name,W.groupName||""].filter(Boolean)),P=BT(Q);C.useEffect(()=>{function W(B){if(K.current&&!K.current.contains(B.target))if(D(!1),e===Ot)S("");else{const $=r.find(([G])=>G===e)?.[1];S($?.nickname||"")}}return document.addEventListener("mousedown",W),()=>document.removeEventListener("mousedown",W)},[e,r]);function k(W){if(W.key==="ArrowDown")W.preventDefault(),T?M(B=>Math.min(B+1,Q.length-1)):(D(!0),M(0));else if(W.key==="ArrowUp")W.preventDefault(),M(B=>Math.max(B-1,0));else if(W.key==="Enter")W.preventDefault(),T&&j>=0&&Q[j]&&O(Q[j]);else if(W.key==="Escape")if(D(!1),M(-1),e===Ot)S("");else{const B=r.find(([$])=>$===e)?.[1];S(B?.nickname||"")}else if(W.key==="Tab"&&T&&Q.length>0){const B=j>=0?j:0;O(Q[B])}}function O(W){n(W.id),S(W.id===Ot?"":W.name),D(!1),M(-1),H.current?.focus()}function N(){n(Ot),S(""),D(!1),M(-1)}function L(W){const B=W.target.value;S(B),D(!0),M(-1),B!==x&&n("")}function U(){D(!0),Q.length>0&&M(0)}let R=-1;const Y=()=>++R;return c.jsxs("div",{ref:K,style:{position:"relative"},children:[c.jsx("input",{ref:H,id:t,type:"text",value:E,onChange:L,onFocus:U,onKeyDown:k,placeholder:o,autoComplete:"off",required:u,style:{...Ea,borderColor:u&&!e?oe.error:void 0}}),T&&c.jsxs("div",{style:{...I0,maxHeight:"250px",overflowY:"auto"},children:[h&&c.jsx("div",{onClick:N,onMouseEnter:()=>M(-1),style:{...ku,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:j===-1?`color-mix(in srgb, ${oe.primary} 20%, transparent)`:"transparent"},children:Pi}),P.map((W,B)=>c.jsxs("div",{children:[W.groupName&&c.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:W.groupName}),W.items.map($=>{const G=Y();return c.jsx("div",{onClick:()=>O($),style:{...ku,paddingLeft:W.groupName?"1.2rem":"0.8rem",background:G===j?`color-mix(in srgb, ${oe.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>M(G),children:$.name},$.id)})]},`group-${B}`)),Q.length===0&&E.trim()&&!h&&c.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function ms({children:t,onSubmit:e,actionName:n}){function r(a){e(a)}return c.jsx("form",{onSubmit:r,style:P6,children:t})}function wt({label:t,htmlFor:e,children:n,hint:r,style:a}){return c.jsxs("div",{style:{...L6,...a},children:[c.jsx("label",{htmlFor:e,style:B6,children:t}),n,r&&c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function ps(t){return c.jsx("input",{style:Ea,...t})}function sB(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function If({value:t,onChange:e,style:n,...r}){const a=C.useRef(null),o=sB(t);function u(){a.current?.showPicker?.()}return c.jsxs("div",{style:{position:"relative"},children:[c.jsx("input",{ref:a,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...r}),c.jsx("div",{onClick:u,style:{...Ea,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:o||"Select date"})]})}function Ou({children:t,...e}){return c.jsx("select",{style:z6,...e,children:t})}function M0({minHeight:t="6rem",style:e,...n}){return c.jsx("textarea",{style:{...Ea,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function Ca({children:t}){return c.jsx("div",{style:Q6,children:t})}function Bg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",a=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return a!==void 0?`$${o}.${a.slice(0,2)}`:o?`$${o}`:""}function aB(t){return t.replace(/[$,]/g,"")}function ao({id:t,value:e,onChange:n,placeholder:r="$0.00",required:a,autoFocus:o,style:u}){const[h,f]=C.useState(()=>Bg(e)),m=C.useRef(null);C.useEffect(()=>{const _=Bg(e);aB(h)!==e&&f(_)},[e]);function g(_){const b=_.target.value;if(!b||b==="$"){f(""),n("");return}const E=b.replace(/[^\d.]/g,"").split(".");let S=E[0];E.length>1&&(S+="."+E.slice(1).join("").slice(0,2));const T=Bg(S);f(T),n(S)}return c.jsx("input",{ref:m,id:t,type:"text",inputMode:"decimal",value:h,onChange:g,placeholder:r,required:a,autoFocus:o,style:{...Ea,...u}})}function gm({children:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:a,onDragLeave:o,onDragEnd:u,onDrop:h,onEdit:f,onDelete:m,onMoveUp:g,onMoveDown:_,canMoveUp:b=!0,canMoveDown:x=!0,itemName:E}){const S=Li(),T=g||_;return c.jsxs("div",{onDragOver:D=>{D.stopPropagation(),a(D)},onDragLeave:D=>{D.stopPropagation(),o()},onDrop:D=>{D.stopPropagation(),h(D)},style:{position:"relative"},children:[c.jsx("div",{style:{...kT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),c.jsxs("div",{style:{...S?N6:td,opacity:e?.5:1},children:[c.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:S?"0.5rem":"0.75rem",minWidth:0},children:[c.jsx("span",{draggable:!0,onDragStart:D=>{r(D)},onDragEnd:()=>{u()},style:{...MT,fontSize:S?"0.9rem":void 0,cursor:"grab",padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder",children:""}),c.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis"},children:t})]}),c.jsxs("div",{style:S?H6:q6,children:[S?c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:()=>{f()},style:IT,title:"Edit","aria-label":"Edit",children:""}),c.jsx("button",{onClick:()=>{m()},style:G6,title:"Delete","aria-label":"Delete",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsx(Ie,{variant:"secondary",actionName:`Edit ${E||"Item"}`,onClick:f,children:"Edit"}),c.jsx(Ie,{variant:"danger",actionName:`Delete ${E||"Item"}`,onClick:m,children:"Delete"})]}),T&&c.jsxs("div",{style:R0,children:[c.jsx("button",{onClick:D=>{D.stopPropagation(),g?.()},disabled:!b,style:{...Bl,opacity:b?.6:.2,cursor:b?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),c.jsx("button",{onClick:D=>{D.stopPropagation(),_?.()},disabled:!x,style:{...Bl,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})]})}function k0({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:a="Move to end"}){return c.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:W6,children:[c.jsx("div",{style:{...K6,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&c.jsx("span",{style:Y6,children:a})]})}function Ue(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Zr(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Ta(t){return t===0?"$0.00":`${t>0?"+":"-"}${Ue(t)}`}function pr(t){return`${t>=0?"+":"-"}${Ue(t)}`}function Tt(t){return t===0?oe.zero:t>0?oe.success:oe.danger}function Dn(t){return t===0?oe.zero:t>0?oe.success:oe.debt}function ic(t){return t===0?oe.zero:t<0?oe.error:oe.success}function sc(t){return t===0?oe.zero:t>0?oe.success:oe.error}function FT(){const t=gn();return{submitFeedback:yr({mutationFn:async({userId:n,userEmail:r,text:a,feedbackType:o,currentPath:u})=>{const h=r||n,f={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${a}

(Submitted from: ${u})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:o},{exists:m}=await We("feedback",h,"checking if user has existing feedback document");return m?await mt("feedback",h,{items:$P(f),user_email:r,updated_at:new Date().toISOString()},"adding new feedback item to existing document",{merge:!0}):await mt("feedback",h,{items:[f],user_email:r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},"creating new feedback document for user"),{feedbackItem:f,docId:h}},onMutate:async({userId:n,userEmail:r,text:a,feedbackType:o,currentPath:u})=>{await t.cancelQueries({queryKey:Se.feedback()});const h=t.getQueryData(Se.feedback());if(!h)return{previousData:void 0,optimisticItemId:void 0};const f=r||n,m={id:`feedback_optimistic_${Date.now()}`,text:`${a}

(Submitted from: ${u})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:o,doc_id:f,user_email:r};return t.setQueryData(Se.feedback(),g=>({items:[...g?.items||[],m]})),{previousData:h,optimisticItemId:m.id}},onSuccess:(n,r,a)=>{a?.optimisticItemId&&t.setQueryData(Se.feedback(),o=>o&&{items:o.items.map(u=>u.id===a.optimisticItemId?{...n.feedbackItem,doc_id:n.docId,user_email:r.userEmail}:u)})},onError:(n,r,a)=>{a?.previousData&&t.setQueryData(Se.feedback(),a.previousData)}})}}function oB(){const t=gn();return{toggleFeedback:yr({mutationFn:async({item:n})=>{const{exists:r,data:a}=await We("feedback",n.doc_id,"PRE-EDIT-READ");if(!r||!a)throw new Error(`Feedback document not found: ${n.doc_id}`);const o=!n.is_done,u=o?new Date().toISOString():null,h=a.items||[];let f=!1;const m=h.map(g=>g.id===n.id?(f=!0,{...g,is_done:o,completed_at:u}):g);if(!f)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:n.id,inDocument:n.doc_id,availableIds:h.map(g=>g.id)}),new Error(`Feedback item not found in document. Item ID: ${n.id}, Doc ID: ${n.doc_id}`);return await mt("feedback",n.doc_id,{...a,items:m,updated_at:new Date().toISOString()},`marking feedback item as ${o?"done":"not done"}`),{itemId:n.id,isDone:o,completedAt:u}},onMutate:async({item:n})=>{await t.cancelQueries({queryKey:Se.feedback()});const r=t.getQueryData(Se.feedback()),a=!n.is_done,o=a?new Date().toISOString():null;return t.setQueryData(Se.feedback(),u=>u&&{items:u.items.map(h=>h.id===n.id?{...h,is_done:a,completed_at:o}:h)}),{previousData:r}},onError:(n,r,a)=>{a?.previousData&&t.setQueryData(Se.feedback(),a.previousData)}})}}function lB(){const t=gn();return{updateSortOrder:yr({mutationFn:async({docId:n,items:r})=>{const{exists:a,data:o}=await We("feedback",n,"PRE-EDIT-READ");if(!a||!o)throw new Error("Feedback document not found");return await mt("feedback",n,{...o,items:r,updated_at:new Date().toISOString()},"saving reordered feedback items"),{docId:n,items:r}},onMutate:async({docId:n,items:r})=>{await t.cancelQueries({queryKey:Se.feedback()});const a=t.getQueryData(Se.feedback());return t.setQueryData(Se.feedback(),o=>{if(!o)return o;const u=new Map;return r.forEach(h=>{u.set(h.id,h.sort_order)}),{items:o.items.map(h=>h.doc_id===n&&u.has(h.id)?{...h,sort_order:u.get(h.id)}:h)}}),{previousData:a}},onError:(n,r,a)=>{a?.previousData&&t.setQueryData(Se.feedback(),a.previousData)}})}}function va({isOpen:t,onClose:e,title:n,children:r,width:a="28rem"}){if(!t)return null;function o(){e()}return c.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:c.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:a,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:u=>u.stopPropagation(),children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[c.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),c.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const cB=2e3,uB={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function dB(){const[t,e]=C.useState(!1),[n,r]=C.useState(""),[a,o]=C.useState("bug"),[u,h]=C.useState(!1),f=C.useContext(Zu),g=go().get_current_firebase_user(),_=Bn(),{submitFeedback:b}=FT();if(C.useEffect(()=>{if(u){const S=setTimeout(()=>h(!1),cB);return()=>clearTimeout(S)}},[u]),_.pathname.includes("/admin/feedback")||!f.is_logged_in)return null;function E(S){S.preventDefault(),!(!n.trim()||!f.username||!g)&&(b.mutate({userId:g.uid,userEmail:f.username,text:n.trim(),feedbackType:a,currentPath:_.pathname}),r(""),o("bug"),e(!1),h(!0))}return c.jsxs(c.Fragment,{children:[u&&c.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Feedback submitted!"})]}),c.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:oe.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:S=>{S.currentTarget.style.transform="scale(1.1)",S.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:S=>{S.currentTarget.style.transform="scale(1)",S.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),c.jsx(va,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:c.jsxs("form",{onSubmit:E,children:[c.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(S=>{const T=uB[S],D=a===S;return c.jsxs("button",{type:"button",onClick:()=>{T.label,o(S)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${T.color}`,borderRadius:"0.5rem",background:D?T.bgColor:"transparent",color:D?T.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:D?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:D?1:.5,boxShadow:D?`0 0 12px ${T.bgColor}`:"none",position:"relative"},children:[T.label,D&&c.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},S)})}),c.jsx(M0,{value:n,onChange:S=>r(S.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),c.jsxs(Ca,{children:[c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),c.jsx(Ie,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}const hB=1500;function fB(){try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")}catch(t){console.warn("Failed to clear localStorage cache:",t)}window.location.reload()}function mB(){const[t,e]=C.useState(!1),{isAdmin:n}=Pt();if(C.useEffect(()=>{if(t){const a=setTimeout(()=>e(!1),hB);return()=>clearTimeout(a)}},[t]),!n)return null;function r(){e(!0),setTimeout(()=>{fB()},200)}return c.jsxs(c.Fragment,{children:[t&&c.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"5.5rem",background:"rgba(100, 108, 255, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Clearing cache & reloading..."})]}),c.jsx("button",{onClick:r,style:{position:"fixed",bottom:"1.5rem",right:"5.25rem",width:"3rem",height:"3rem",borderRadius:"50%",background:"#4a4a4a",color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Clear Cache & Reload",onMouseEnter:a=>{a.currentTarget.style.transform="scale(1.1)",a.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:a=>{a.currentTarget.style.transform="scale(1)",a.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""})]})}function Mr({children:t,labelStyle:e,...n}){return c.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[c.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:oe.primary},...n}),t]})}function O0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[a,o]=C.useState(r);return c.jsxs("div",{style:{marginTop:"2rem"},children:[c.jsxs("button",{onClick:()=>o(!a),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[c.jsx("span",{style:{transition:"transform 0.2s",transform:a?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),a&&n]})}const pB=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},gB=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Mf(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,a=e.filter(T=>!T.hidden),o=a.length,u=pB(o),h=gB(o),f=Math.floor(100/h),m=`tab-nav-${o}-${r}`,g=r==="primary",_=r==="secondary",b=r==="segmented",x=T=>{const D="color-mix(in srgb, currentColor 10%, transparent)",j="color-mix(in srgb, currentColor 3%, transparent)";return b?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:T?D:j,cursor:"pointer",fontWeight:T?600:400,fontSize:"0.95rem",color:"inherit",opacity:T?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:T?"2px solid currentColor":"2px solid transparent"}:_?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:T?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:T?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:T?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:T?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},E=(T,D)=>c.jsxs(c.Fragment,{children:[c.jsx("span",{children:T.label}),T.checkmark&&c.jsx("span",{style:{color:oe.success,fontWeight:600},children:""}),g&&D&&c.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),S=()=>b?`
        .${m} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:_?`
        .${m} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${m} > button,
        .${m} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${m} > button:last-child,
        .${m} > a:last-child {
          margin-right: 0;
        }
        .${m} > button::before,
        .${m} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 #242424, 1px 0 0 #242424;
        }
        .${m} > button:nth-child(1),
        .${m} > a:nth-child(1) {
          z-index: 4;
        }
        .${m} > button:nth-child(2),
        .${m} > a:nth-child(2) {
          z-index: 3;
        }
        .${m} > button:nth-child(3),
        .${m} > a:nth-child(3) {
          z-index: 2;
        }
        .${m} > button:nth-child(4),
        .${m} > a:nth-child(4) {
          z-index: 1;
        }
        .${m} > button.tab-active,
        .${m} > a.tab-active {
          z-index: 10;
        }
        .${m} > button.tab-active::before,
        .${m} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${m} > button:not(.tab-active):hover,
        .${m} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${m} > button:not(.tab-active):hover::before,
        .${m} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${m} {
            padding-left: 0;
            padding-right: 0;
          }
          .${m} > button,
          .${m} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${m} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${u}px) {
        .${m} > * {
          flex: 1 1 ${f}% !important;
          min-width: ${f}% !important;
        }
      }
    `;return c.jsxs(c.Fragment,{children:[c.jsx("style",{children:`
        ${S()}
        .${m} > button,
        .${m} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${m} > button:hover,
        .${m} > button:focus,
        .${m} > a:hover,
        .${m} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${g?"opacity: 0.85;":""}
          ${b?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),c.jsx("div",{className:m,children:a.map(T=>{const D=n===T.id;return t.mode==="link"?c.jsx(Bt,{to:`${t.linkPrefix}/${T.id}`,onClick:()=>(`${T.label}`,void 0),style:x(D),className:D?"tab-active":"",children:E(T,D)},T.id):c.jsx("button",{onClick:()=>{`${T.label}`,t.onTabChange(T.id)},style:x(D),className:D?"tab-active":"",children:E(T,D)},T.id)})})]})}function $T({items:t}){const[e,n]=C.useState(!1),r=C.useRef(null),o=Bn().pathname;C.useEffect(()=>{function h(f){r.current&&!r.current.contains(f.target)&&n(!1)}if(e)return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[e]),C.useEffect(()=>{function h(f){f.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[e]);const u=t.filter(h=>h.hidden?!1:h.to?h.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):h.to==="/account"||h.to==="/"?o!==h.to:!o.startsWith(h.to):!0);return c.jsxs("div",{ref:r,style:{position:"relative"},children:[c.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&c.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:u.map((h,f)=>{if(h.divider)return c.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},f);const m=c.jsxs(c.Fragment,{children:[h.icon&&c.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:h.icon}),c.jsx("span",{children:h.label})]}),g={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},_={background:"color-mix(in srgb, currentColor 10%, transparent)"};return h.to?c.jsx(Bt,{to:h.to,style:g,onMouseEnter:b=>Object.assign(b.currentTarget.style,_),onMouseLeave:b=>b.currentTarget.style.background="transparent",onClick:()=>{`${h.label}`,n(!1)},children:m},f):c.jsx("button",{onClick:()=>{`${h.label}`,h.onClick?.(),n(!1)},style:g,onMouseEnter:b=>Object.assign(b.currentTarget.style,_),onMouseLeave:b=>b.currentTarget.style.background="transparent",children:m},f)})})]})}function yB({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Pt(),a=Bn(),u=[...a.pathname==="/budget"||a.pathname.startsWith("/budget/")&&!a.pathname.startsWith("/budget/settings")&&!a.pathname.startsWith("/budget/admin")&&!a.pathname.startsWith("/budget/analytics")&&!a.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return c.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[c.jsx("div",{style:{flex:"0 0 auto"},children:e?c.jsx(Bt,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):c.jsx(Bt,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:c.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),c.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),c.jsx("div",{style:{flex:"0 0 auto"},children:n?c.jsx("div",{style:{width:"1.5rem"}}):c.jsx($T,{items:u})})]})}function qT({children:t,style:e}){return c.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function _B({hasData:t,monthsCount:e,budgetCount:n,monthsToDelete:r,isDeleting:a,onDelete:o,onRefresh:u,isRefreshing:h,disabled:f,deleteResult:m,deleteProgress:g}){const[_,b]=C.useState(!1),x=()=>{b(!0)},E=()=>{b(!1),o()},S=()=>t?m&&m.deleted>0&&m.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",T=r.reduce((D,j)=>{const M=j.budgetId;return D[M]||(D[M]=[]),D[M].push(j),D},{});return c.jsxs(Bi,{title:" Delete ALL Months",description:"DESTRUCTIVE: Deletes ALL month documents from Firebase for ALL budgets. This will reset all income, expenses, and allocations. Use with extreme caution!",status:S(),onRefresh:u,isRefreshing:h,isBusy:a,children:[a?c.jsx(Ve,{type:"running",children:"Deleting all months..."}):m?c.jsx(Ve,{type:m.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[m.errors.length>0?"":""," Deleted ",m.deleted," month",m.deleted!==1?"s":"",m.budgetsRecalculated>0&&c.jsxs("span",{children:[", reset ",m.budgetsRecalculated," budget",m.budgetsRecalculated!==1?"s":""]}),c.jsx("span",{style:{opacity:.8},children:", cache cleared"}),m.errors.length>0&&c.jsx("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.85rem"},children:m.errors.map((D,j)=>c.jsx("li",{children:D},j))})]})}):t?e>0?c.jsxs(c.Fragment,{children:[c.jsx(Ve,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",c.jsx("strong",{children:e})," month",e!==1?"s":""," across ",c.jsx("strong",{children:n})," budget",n!==1?"s":"",":"]}),c.jsxs("div",{style:{maxHeight:"200px",overflowY:"auto"},children:[Object.entries(T).slice(0,5).map(([D,j])=>c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[c.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:["Budget: ",D.slice(0,12),"..."]}),c.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem",fontSize:"0.85rem"},children:[j.slice(0,3).map(M=>c.jsxs("li",{children:[Cl[M.month-1]," ",M.year]},M.docId)),j.length>3&&c.jsxs("li",{style:{opacity:.7},children:["...and ",j.length-3," more"]})]})]},D)),Object.keys(T).length>5&&c.jsxs("div",{style:{opacity:.7,fontSize:"0.85rem",marginTop:"0.5rem"},children:["...and ",Object.keys(T).length-5," more budgets"]})]})]})}),c.jsxs(Or,{onClick:x,disabled:f,isBusy:a,busyText:"Deleting...",actionName:"Delete All Months",children:[" Delete ALL ",e," Month",e!==1?"s":""]}),c.jsx("p",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.5rem",fontWeight:500},children:" This action cannot be undone!"})]}):c.jsx(Ve,{type:"clean",children:" No month documents found in Firebase."}):c.jsx(Ve,{type:"unknown",children:" Status unknown  click Refresh to scan for months"}),c.jsxs(va,{isOpen:_,onClose:()=>b(!1),title:" Delete All Months?",children:[c.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:c.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),c.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",c.jsxs("strong",{style:{color:"#ef4444"},children:[e," month",e!==1?"s":""]})," across"," ",c.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget",n!==1?"s":""]}),"."]}),c.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, all affected budgets will be reset:"}),c.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[c.jsx("li",{children:"All account balances  $0"}),c.jsx("li",{children:"All category balances  $0"}),c.jsx("li",{children:"Month history cleared"}),c.jsx("li",{children:"Cache cleared automatically"})]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>b(!1),children:"Cancel"}),c.jsxs(Ie,{variant:"danger",actionName:"Confirm Delete All Months",onClick:E,children:[" Delete All ",e," Months"]})]})]}),a&&g&&c.jsx(bB,{progress:g})]})}function bB({progress:t}){const e=()=>{switch(t.phase){case"deleting":return t.currentMonth?`Deleting ${t.currentMonth}...`:"Deleting months...";case"resetting-budgets":return t.currentMonth?`Resetting ${t.currentMonth}...`:"Resetting budgets...";case"clearing-cache":return"Clearing cache...";case"complete":return"Complete!";default:return"Processing..."}},n=()=>t.phase==="resetting-budgets"||t.phase==="clearing-cache"?"linear-gradient(90deg, #22c55e, #10b981)":"linear-gradient(90deg, #ef4444, #dc2626)",r=()=>t.phase==="resetting-budgets"||t.phase==="clearing-cache"?"#22c55e":"#ef4444";return c.jsxs(nd,{message:e(),spinnerColor:r(),children:[c.jsx(mm,{percent:t.percentComplete,gradient:n()}),t.phase==="deleting"&&c.jsxs(Tl,{columns:2,children:[c.jsx(xn,{value:`${t.deleted}/${t.total}`,label:"Months Deleted",color:"#ef4444"}),c.jsx(xn,{value:t.total-t.deleted,label:"Remaining",color:"rgba(255, 255, 255, 0.6)"})]}),t.phase==="resetting-budgets"&&c.jsxs(Tl,{columns:2,children:[c.jsx(xn,{value:t.deleted,label:"Months Deleted",color:"#ef4444"}),c.jsx(xn,{value:`${t.budgetsRecalculated}/${t.totalBudgets}`,label:"Budgets Reset",color:"#22c55e"})]}),(t.phase==="clearing-cache"||t.phase==="complete")&&c.jsxs(Tl,{columns:2,children:[c.jsx(xn,{value:t.deleted,label:"Months Deleted",color:"#ef4444"}),c.jsx(xn,{value:t.budgetsRecalculated,label:"Budgets Reset",color:"#22c55e"})]}),c.jsx(pm,{percent:t.percentComplete})]})}function vB({result:t}){return c.jsx("div",{style:{marginTop:"1rem"},children:c.jsx(Ve,{type:t.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[t.errors.length>0?"":""," Import ",t.success?"complete":"finished with errors",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[c.jsxs("li",{children:[t.imported," records imported"]}),t.skipped>0&&c.jsxs("li",{children:[t.skipped," records skipped"]})]}),t.errors.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[t.errors.slice(0,5).map((e,n)=>c.jsx("li",{children:e},n)),t.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",t.errors.length-5," more errors"]})]})]})]})})})}function xB({recordCount:t,recordTypeCounts:e,monthRange:n,onCancel:r,onConfirm:a}){const o=()=>n?n.isSingleMonth?n.start:`${n.start} to ${n.end}`:"";return c.jsxs("div",{children:[c.jsxs("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:[c.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" Warning: Destructive Operation"}),c.jsxs("p",{style:{margin:"0.5rem 0 0",color:"rgba(255, 255, 255, 0.8)",fontSize:"0.9rem"},children:["This will ",c.jsx("strong",{children:"REPLACE"})," all existing income, expenses, and allocations in"," ",c.jsx("strong",{style:{color:"#fbbf24"},children:n?.count===1?"1 month":`${n?.count} months`})," ","(",o(),")."]})]}),c.jsxs("p",{style:{margin:"0 0 0.5rem",opacity:.8},children:["You are about to import ",c.jsx("strong",{children:t.toLocaleString()})," records:"]}),c.jsxs("ul",{style:{margin:"0 0 1rem",paddingLeft:"1.5rem",fontSize:"0.9rem",opacity:.9},children:[e.income>0&&c.jsxs("li",{children:[e.income.toLocaleString()," income transactions"]}),e.spend>0&&c.jsxs("li",{children:[e.spend.toLocaleString()," expense transactions"]}),e.allocations>0&&c.jsxs("li",{children:[e.allocations.toLocaleString()," budget allocations"]})]}),c.jsxs("p",{style:{margin:"0 0 1.5rem",opacity:.8},children:["Any existing data of these types in the affected months will be ",c.jsx("strong",{style:{color:"#fca5a5"},children:"deleted and replaced"}),". This cannot be undone."]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{variant:"secondary",actionName:"Cancel Seed Import",onClick:r,children:"Cancel"}),c.jsx(Ie,{variant:"danger",actionName:"Confirm Seed Import",onClick:a,children:"Replace & Import"})]})]})}function SB({progress:t}){const e=()=>{switch(t.phase){case"saving-mappings":return"Saving mappings...";case"reading-months":return`Reading ${t.totalMonths} months (parallel)...`;case"creating-months":return t.currentMonth?`Creating ${t.currentMonth}...`:`Creating ${t.monthsToCreate} new months...`;case"processing-months":return t.currentMonth?`Processing & recalculating ${t.currentMonth}...`:`Processing ${t.totalRecords.toLocaleString()} records...`;case"saving-months":return`Saving ${t.totalMonths} months (batch)...`;case"updating-budget":return"Updating budget balances...";case"complete":return"Import complete!";default:return"Importing..."}},n=t.phase==="creating-months"&&t.monthsToCreate>0,r=t.phase==="processing-months"||t.phase==="saving-months"||t.phase==="updating-budget"||t.phase==="complete";return c.jsxs(nd,{message:e(),spinnerColor:"#646cff",children:[c.jsx(mm,{percent:t.percentComplete,gradient:"linear-gradient(90deg, #646cff, #8b5cf6)"}),n&&c.jsxs(Tl,{columns:2,children:[c.jsx(xn,{value:`${t.monthsCreated}/${t.monthsToCreate}`,label:"Months Created",color:"#f59e0b"}),c.jsx(xn,{value:t.totalMonths,label:"Total Months",color:"#646cff"})]}),!n&&c.jsxs(Tl,{columns:t.gapMonths>0?3:2,children:[c.jsx(xn,{value:t.totalMonths,label:"Months",color:"#646cff"}),t.monthsCreated>0&&c.jsx(xn,{value:t.monthsCreated,label:"New",color:"#f59e0b"}),t.gapMonths>0&&c.jsx(xn,{value:t.gapMonths,label:"Gap Filled",color:"#8b5cf6"})]}),r&&c.jsxs(Tl,{columns:3,children:[c.jsx(xn,{value:t.incomeImported,label:"Income",color:"#22c55e"}),c.jsx(xn,{value:t.spendImported,label:"Expenses",color:"#ef4444"}),c.jsx(xn,{value:t.allocationsImported,label:"Allocations",color:"#3b82f6"})]}),c.jsx(pm,{percent:t.percentComplete})]})}function wB(t,e){return t.account_group_id&&e[t.account_group_id]?e[t.account_group_id].name:"Ungrouped"}function Uh({oldName:t,currentMapping:e,options:n,onMap:r,placeholder:a,isAutoMapped:o}){const u=h=>{const f=h.target.value,m=n.find(g=>g.id===f);if(m){const g=m.rawName??m.name;r(f,g)}};return c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem",padding:"0.5rem",background:o?"color-mix(in srgb, #22c55e 8%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"6px",borderLeft:o?"3px solid #22c55e":"none"},children:[c.jsxs("span",{style:{flex:"0 0 40%",fontSize:"0.85rem",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"0.35rem"},title:t,children:['"',t,'"',o&&c.jsx("span",{style:{fontSize:"0.7rem",opacity:.6},children:"(auto)"})]}),c.jsx("span",{style:{opacity:.5},children:""}),c.jsxs("select",{value:e?.newId??"",onChange:u,style:{flex:1,padding:"0.4rem",borderRadius:"4px",border:e?"1px solid #22c55e":"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:e?"color-mix(in srgb, #22c55e 10%, transparent)":"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",fontSize:"0.85rem"},children:[c.jsx("option",{value:"",children:a}),n.map(h=>c.jsx("option",{value:h.id,children:h.name},h.id))]})]})}function EB({unmappedCategories:t,unmappedAccounts:e,customMappedCategories:n,customMappedAccounts:r,categoryMappings:a,accountMappings:o,categories:u,accounts:h,accountGroups:f,onCategoryMap:m,onAccountMap:g}){const _=C.useMemo(()=>{const E=Object.entries(u).sort((S,T)=>S[1].name.localeCompare(T[1].name));return[[Lt,{name:ba,category_group_id:null,sort_order:-1}],...E]},[u]),b=C.useMemo(()=>{const E=Object.entries(h).sort((S,T)=>S[1].nickname.localeCompare(T[1].nickname)).map(([S,T])=>({id:S,acc:T,displayName:`${T.nickname} (${wB(T,f)})`}));return[{id:Ot,acc:{nickname:Pi},displayName:Pi},...E]},[h,f]),x=t.length>0||e.length>0;return c.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:[c.jsx("h4",{style:{margin:"0 0 0.75rem 0",fontSize:"0.95rem"},children:" Entity Mappings"}),c.jsxs("p",{style:{margin:"0 0 1rem 0",fontSize:"0.85rem",opacity:.8},children:[x?"Map unknown entities to existing categories/accounts.":"Review saved mappings (names that don't exactly match existing entities)."," ","These mappings will be saved for future imports."]}),t.length>0&&c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#ef4444"},children:[" Unmapped Categories (",t.length,")"]}),t.map(E=>c.jsx(Uh,{oldName:E,currentMapping:a.get(E),options:_.map(([S,T])=>({id:S,name:T.name})),onMap:(S,T)=>m(E,S,T),placeholder:"Select a category..."},`cat-unmapped-${E}`))]}),n.length>0&&c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#60a5fa"},children:[" Saved Category Mappings (",n.length,")"]}),n.map(E=>c.jsx(Uh,{oldName:E,currentMapping:a.get(E),options:_.map(([S,T])=>({id:S,name:T.name})),onMap:(S,T)=>m(E,S,T),placeholder:"Select a category...",isAutoMapped:!0},`cat-custom-${E}`))]}),e.length>0&&c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#ef4444"},children:[" Unmapped Accounts (",e.length,")"]}),e.map(E=>c.jsx(Uh,{oldName:E,currentMapping:o.get(E),options:b.map(({id:S,acc:T,displayName:D})=>({id:S,name:D,rawName:T.nickname})),onMap:(S,T)=>g(E,S,T),placeholder:"Select an account..."},`acc-unmapped-${E}`))]}),r.length>0&&c.jsxs("div",{children:[c.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#60a5fa"},children:[" Saved Account Mappings (",r.length,")"]}),r.map(E=>c.jsx(Uh,{oldName:E,currentMapping:o.get(E),options:b.map(({id:S,acc:T,displayName:D})=>({id:S,name:D,rawName:T.nickname})),onMap:(S,T)=>g(E,S,T),placeholder:"Select an account...",isAutoMapped:!0},`acc-custom-${E}`))]})]})}function CB({disabled:t}){const{selectedBudgetId:e}=Pt(),{data:n}=YC(e),r=C.useRef(null),[a,o]=C.useState(null),[u,h]=C.useState(!1),{status:f,parsedData:m,unmappedCategories:g,unmappedAccounts:_,customMappedCategories:b,customMappedAccounts:x,categoryMappings:E,accountMappings:S,importResult:T,importProgress:D,parseFile:j,setCategoryMapping:M,setAccountMapping:K,runImport:H,reset:Q,isParsing:P,isImporting:k,hasUnmappedEntities:O}=O6(e),N=b.length>0||x.length>0,L=C.useMemo(()=>n?.budget?.categories??{},[n?.budget?.categories]),U=C.useMemo(()=>n?.budget?.accounts??{},[n?.budget?.accounts]),R=C.useMemo(()=>n?.budget?.account_groups??{},[n?.budget?.account_groups]),Y=C.useCallback(q=>{const ee=q.target.files?.[0];ee&&(o(ee),j(ee,L,U))},[j,L,U]),W=C.useCallback(()=>{!e||!m||h(!0)},[e,m]),B=C.useCallback(async()=>{h(!1),!(!e||!m)&&await H(L,U)},[e,m,H,L,U]),$=C.useCallback(()=>{o(null),Q(),r.current&&(r.current.value="")},[Q]),G=C.useMemo(()=>T&&T.errors.length===0?"complete":f==="ready"||f==="mapping"?"needs-action":"unknown",[f,T]),J=C.useMemo(()=>T&&T.errors.length===0?" Import Complete":f==="ready"?"Ready to Import":f==="mapping"?"Mapping Required":"Select a File",[f,T]),{monthRange:re,recordTypeCounts:V}=C.useMemo(()=>{if(!m||m.length===0)return{monthRange:null,recordTypeCounts:{income:0,spend:0,allocations:0}};const q=new Set;let ee=1/0,ne=-1/0,te=12,se=1;const he={income:0,spend:0,allocations:0};for(const ve of m)q.add(`${ve.year}-${ve.month}`),(ve.year<ee||ve.year===ee&&ve.month<te)&&(ee=ve.year,te=ve.month),(ve.year>ne||ve.year===ne&&ve.month>se)&&(ne=ve.year,se=ve.month),ve.recordType==="income"?he.income++:ve.recordType==="spend"?he.spend++:ve.recordType==="allocation"&&he.allocations++;const we=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ge=`${we[te-1]} ${ee}`,Z=`${we[se-1]} ${ne}`;return{monthRange:{start:ge,end:Z,count:q.size,isSingleMonth:q.size===1},recordTypeCounts:he}},[m]);return c.jsxs(Bi,{title:" Seed Data Import",description:"Import historical data from a combined CSV file. The file should have a 'type' column (income, spend, or allocation) as the first column. Unknown categories and accounts will be mapped to existing ones.",status:G,statusText:J,onRefresh:$,isRefreshing:!1,isBusy:P||k,cardName:"Seed Import",children:[k&&D&&c.jsx(SB,{progress:D}),c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:500,fontSize:"0.9rem"},children:"CSV File"}),c.jsx("input",{ref:r,type:"file",accept:".csv",onChange:Y,disabled:t||P||k,style:{display:"block",width:"100%",padding:"0.5rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",color:"inherit",cursor:t||P||k?"not-allowed":"pointer"}}),a&&c.jsxs("p",{style:{margin:"0.5rem 0 0",fontSize:"0.85rem",opacity:.7},children:["Selected: ",a.name]})]}),P&&c.jsxs(Ve,{type:"running",children:[c.jsx(Ul,{})," Parsing CSV file..."]}),m&&m.length>0&&!P&&c.jsx("div",{style:{marginBottom:"1rem"},children:c.jsx(Ve,{type:O?"warning":"clean",children:c.jsxs("div",{children:[O?"":""," Parsed ",m.length," rows",c.jsxs("ul",{style:{margin:"0.5rem 0 0",paddingLeft:"1.5rem",fontSize:"0.85rem"},children:[V.income>0&&c.jsxs("li",{children:[V.income," income"]}),V.spend>0&&c.jsxs("li",{children:[V.spend," spend"]}),V.allocations>0&&c.jsxs("li",{children:[V.allocations," allocations"]})]}),O&&c.jsx("span",{style:{display:"block",fontSize:"0.85rem",marginTop:"0.25rem"},children:"Some categories or accounts need to be mapped"})]})})}),(O||N)&&!P&&c.jsx(EB,{unmappedCategories:g,unmappedAccounts:_,customMappedCategories:b,customMappedAccounts:x,categoryMappings:E,accountMappings:S,categories:L,accounts:U,accountGroups:R,onCategoryMap:M,onAccountMap:K}),f==="ready"&&!P&&c.jsxs(Or,{onClick:W,disabled:t||!e,isBusy:k,busyText:"Importing...",actionName:"Run Seed Import",children:[" Import ",m?.length??0," Records"]}),T&&c.jsx(vB,{result:T}),c.jsx(va,{isOpen:u,onClose:()=>h(!1),title:" Confirm Import",children:c.jsx(xB,{recordCount:m?.length??0,recordTypeCounts:V,monthRange:re,onCancel:()=>h(!1),onConfirm:B})})]})}function TB({hasData:t,status:e,hasIssues:n,totalIssues:r,isRunning:a,result:o,onRunCleanup:u,onRefresh:h,isRefreshing:f,disabled:m}){const g=()=>t?o&&o.errors.length===0&&(o.budgetsProcessed>0||o.monthsProcessed>0)?"complete":n?"needs-action":"clean":"unknown",_=o?o.accountsFixed+o.categoriesFixed+o.totalAvailableFixed+o.incomeValuesFixed+o.expenseValuesFixed+o.categoryBalancesFixed+o.accountBalancesFixed:0;return c.jsx(Bi,{title:" Currency Precision Cleanup",description:"Fixes floating-point precision issues by rounding all currency values to exactly 2 decimal places. Processes all months in batches, recalculates budget balances, and clears all caches. This prevents display issues like '$0.00' showing as orange (slightly negative) or totals not summing correctly.",status:g(),onRefresh:h,isRefreshing:f,isBusy:a,children:a?c.jsx(Ve,{type:"running",children:"Running precision cleanup..."}):o?c.jsx(Ve,{type:o.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[o.errors.length>0?"":""," Cleanup complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[o.budgetsProcessed>0&&c.jsxs("li",{children:[o.budgetsProcessed," budget",o.budgetsProcessed!==1?"s":""," updated"]}),o.accountsFixed>0&&c.jsxs("li",{children:[o.accountsFixed," account balance",o.accountsFixed!==1?"s":""," fixed"]}),o.categoriesFixed>0&&c.jsxs("li",{children:[o.categoriesFixed," category value",o.categoriesFixed!==1?"s":""," fixed"]}),o.totalAvailableFixed>0&&c.jsxs("li",{children:[o.totalAvailableFixed," total_available value",o.totalAvailableFixed!==1?"s":""," fixed"]}),o.monthsProcessed>0&&c.jsxs("li",{children:[o.monthsProcessed," month",o.monthsProcessed!==1?"s":""," updated"]}),o.incomeValuesFixed>0&&c.jsxs("li",{children:[o.incomeValuesFixed," income amount",o.incomeValuesFixed!==1?"s":""," fixed"]}),o.expenseValuesFixed>0&&c.jsxs("li",{children:[o.expenseValuesFixed," expense amount",o.expenseValuesFixed!==1?"s":""," fixed"]}),o.categoryBalancesFixed>0&&c.jsxs("li",{children:[o.categoryBalancesFixed," category balance",o.categoryBalancesFixed!==1?"s":""," fixed"]}),o.accountBalancesFixed>0&&c.jsxs("li",{children:[o.accountBalancesFixed," account balance",o.accountBalancesFixed!==1?"s":""," fixed"]}),_===0&&c.jsx("li",{children:"No changes needed"})]}),o.errors.length>0?c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[o.errors.slice(0,5).map((b,x)=>c.jsx("li",{children:b},x)),o.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",o.errors.length-5," more errors"]})]})]}):c.jsx("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:" All budgets recalculated and cache cleared."})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Ve,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",r," precision issue",r!==1?"s":""," to fix:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.budgetsWithPrecisionIssues>0&&c.jsxs("li",{children:[e.budgetsWithPrecisionIssues," budget",e.budgetsWithPrecisionIssues!==1?"s":""," with precision issues",c.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.85rem",opacity:.8},children:[e.accountsWithPrecisionIssues>0&&c.jsxs("li",{children:[e.accountsWithPrecisionIssues," account balance",e.accountsWithPrecisionIssues!==1?"s":""]}),e.categoriesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.categoriesWithPrecisionIssues," category value",e.categoriesWithPrecisionIssues!==1?"s":""]}),e.totalAvailableWithPrecisionIssues>0&&c.jsxs("li",{children:[e.totalAvailableWithPrecisionIssues," total_available value",e.totalAvailableWithPrecisionIssues!==1?"s":""]})]})]}),e.monthsWithPrecisionIssues>0&&c.jsxs("li",{children:[e.monthsWithPrecisionIssues," month",e.monthsWithPrecisionIssues!==1?"s":""," with precision issues",c.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.85rem",opacity:.8},children:[e.incomeValuesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.incomeValuesWithPrecisionIssues," income amount",e.incomeValuesWithPrecisionIssues!==1?"s":""]}),e.expenseValuesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.expenseValuesWithPrecisionIssues," expense amount",e.expenseValuesWithPrecisionIssues!==1?"s":""]}),e.categoryBalancesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.categoryBalancesWithPrecisionIssues," category balance value",e.categoryBalancesWithPrecisionIssues!==1?"s":""]}),e.accountBalancesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.accountBalancesWithPrecisionIssues," account balance value",e.accountBalancesWithPrecisionIssues!==1?"s":""]})]})]})]}),c.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budgets and ",e.totalMonths," months."]})]})}),c.jsxs(Or,{onClick:u,disabled:m,isBusy:a,busyText:"Running...",actionName:"Run Precision Cleanup",children:[" Fix ",r," Issue",r!==1?"s":""]})]}):c.jsx(Ve,{type:"clean",children:c.jsxs("div",{children:[" All currency values have proper precision",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalBudgets," budgets and ",e.totalMonths," months have values rounded to 2 decimal places."]})]})}):c.jsx(Ve,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function AB({hasData:t,status:e,hasItemsToMigrate:n,isRunning:r,result:a,onRunMigration:o,onRefresh:u,isRefreshing:h,disabled:f}){const m=()=>t?a&&a.errors.length===0&&a.expensesMigrated>0?"complete":n?"needs-action":"clean":"unknown";return c.jsx(Bi,{title:" Expense to Adjustment Migration",description:"Migrates expense entries with 'No Account' or 'No Category' to the new Adjustments tab. Also fixes invalid account/category IDs like 'unknown' by converting them to proper no-account/no-category values. After this migration, the Spend tab will require both a real account AND category.",status:m(),onRefresh:u,isRefreshing:h,isBusy:r,children:r?c.jsx(Ve,{type:"running",children:"Running expense to adjustment migration..."}):a?c.jsx(Ve,{type:a.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[a.errors.length>0?"":""," Migration complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[a.budgetsProcessed>0&&c.jsxs("li",{children:[a.budgetsProcessed," budget",a.budgetsProcessed!==1?"s":""," scanned"]}),a.monthsProcessed>0&&c.jsxs("li",{children:[a.monthsProcessed," month",a.monthsProcessed!==1?"s":""," updated"]}),a.expensesMigrated>0&&c.jsxs("li",{children:[a.expensesMigrated," expense",a.expensesMigrated!==1?"s":""," migrated to adjustments"]}),a.invalidAccountsFixed>0&&c.jsxs("li",{children:[a.invalidAccountsFixed," invalid account ID",a.invalidAccountsFixed!==1?"s":""," fixed"]}),a.invalidCategoriesFixed>0&&c.jsxs("li",{children:[a.invalidCategoriesFixed," invalid category ID",a.invalidCategoriesFixed!==1?"s":""," fixed"]}),a.expensesMigrated===0&&c.jsx("li",{children:"No changes needed"})]}),a.errors.length>0?c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[a.errors.slice(0,5).map((g,_)=>c.jsx("li",{children:g},_)),a.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",a.errors.length-5," more errors"]})]})]}):c.jsx("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:' All data migrated successfully. Run "Database Cleanup" to recalculate balances.'})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Ve,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.expensesToMigrate," expense",e.expensesToMigrate!==1?"s":""," to migrate:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[c.jsxs("li",{children:[e.expensesToMigrate," expense",e.expensesToMigrate!==1?"s":""," with No Account or No Category"]}),e.invalidAccountsToFix>0&&c.jsxs("li",{children:[e.invalidAccountsToFix," invalid account ID",e.invalidAccountsToFix!==1?"s":"",' (e.g., "unknown")']}),e.invalidCategoriesToFix>0&&c.jsxs("li",{children:[e.invalidCategoriesToFix," invalid category ID",e.invalidCategoriesToFix!==1?"s":"",' (e.g., "unknown")']})]}),c.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," and ",e.totalMonths," month",e.totalMonths!==1?"s":"","."]})]})}),c.jsxs(Or,{onClick:o,disabled:f,isBusy:r,busyText:"Migrating...",actionName:"Run Expense to Adjustment Migration",children:[" Migrate ",e.expensesToMigrate," Expense",e.expensesToMigrate!==1?"s":""]})]}):c.jsx(Ve,{type:"clean",children:c.jsxs("div",{children:[" No expenses need migration",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalMonths," month",e.totalMonths!==1?"s":""," across ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," have valid expense data."]})]})}):c.jsx(Ve,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function jB({hasData:t,status:e,hasItemsToFix:n,isRunning:r,result:a,onRunMigration:o,onRefresh:u,isRefreshing:h,disabled:f}){const m=()=>t?a&&a.errors.length===0&&(a.categoryIdsFixed>0||a.accountIdsFixed>0)?"complete":n?"needs-action":"clean":"unknown",g=e?e.orphanedCategoryIds+e.orphanedAccountIds:0,_=a?a.categoryIdsFixed+a.accountIdsFixed:0;return c.jsx(Bi,{title:" Orphaned ID Cleanup",description:"Finds transactions referencing deleted or non-existent categories/accounts and converts them to 'No Category' / 'No Account'. Run this BEFORE the Expense to Adjustment migration.",status:m(),onRefresh:u,isRefreshing:h,isBusy:r,children:r?c.jsx(Ve,{type:"running",children:"Running orphaned ID cleanup..."}):a?c.jsx(Ve,{type:a.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[a.errors.length>0?"":""," Cleanup complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[a.budgetsProcessed>0&&c.jsxs("li",{children:[a.budgetsProcessed," budget",a.budgetsProcessed!==1?"s":""," scanned"]}),a.monthsProcessed>0&&c.jsxs("li",{children:[a.monthsProcessed," month",a.monthsProcessed!==1?"s":""," updated"]}),a.categoryIdsFixed>0&&c.jsxs("li",{children:[a.categoryIdsFixed," orphaned category ID",a.categoryIdsFixed!==1?"s":"","  No Category"]}),a.accountIdsFixed>0&&c.jsxs("li",{children:[a.accountIdsFixed," orphaned account ID",a.accountIdsFixed!==1?"s":"","  No Account"]}),_===0&&c.jsx("li",{children:"No changes needed"})]}),a.errors.length>0?c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[a.errors.slice(0,5).map((b,x)=>c.jsx("li",{children:b},x)),a.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",a.errors.length-5," more errors"]})]})]}):c.jsx("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:' Now run "Expense to Adjustment Migration" to move these to the Adjustments tab.'})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Ve,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",g," orphaned ID",g!==1?"s":""," to fix:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.orphanedCategoryIds>0&&c.jsxs("li",{children:[e.orphanedCategoryIds," orphaned category ID",e.orphanedCategoryIds!==1?"s":""]}),e.orphanedAccountIds>0&&c.jsxs("li",{children:[e.orphanedAccountIds," orphaned account ID",e.orphanedAccountIds!==1?"s":""]})]}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Affected transactions: ",e.affectedExpenses," expense",e.affectedExpenses!==1?"s":"",", ",e.affectedIncome," income, ",e.affectedTransfers," transfer",e.affectedTransfers!==1?"s":"",", ",e.affectedAdjustments," adjustment",e.affectedAdjustments!==1?"s":""]}),c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," and ",e.totalMonths," month",e.totalMonths!==1?"s":"","."]})]})}),c.jsxs(Or,{onClick:o,disabled:f,isBusy:r,busyText:"Cleaning up...",actionName:"Run Orphaned ID Cleanup",children:[" Fix ",g," Orphaned ID",g!==1?"s":""]})]}):c.jsx(Ve,{type:"clean",children:c.jsxs("div",{children:[" No orphaned IDs found",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalMonths," month",e.totalMonths!==1?"s":""," across ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," have valid category/account references."]})]})}):c.jsx(Ve,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function RB({hasData:t,status:e,hasPairsToConvert:n,isRunning:r,result:a,onRunMigration:o,onRefresh:u,isRefreshing:h,disabled:f}){const m=()=>t?a&&a.errors.length===0&&a.transfersCreated>0?"complete":n?"needs-action":"clean":"unknown";return c.jsx(Bi,{title:" Adjustments to Transfers",description:"Finds pairs of adjustments with exact opposite amounts on the same date and converts them to transfers. Only converts valid pairs: account-to-account (both No Category) or category-to-category (both No Account).",status:m(),onRefresh:u,isRefreshing:h,isBusy:r,children:r?c.jsx(Ve,{type:"running",children:"Converting adjustment pairs to transfers..."}):a?c.jsx(Ve,{type:a.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[a.errors.length>0?"":""," Migration complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[a.budgetsProcessed>0&&c.jsxs("li",{children:[a.budgetsProcessed," budget",a.budgetsProcessed!==1?"s":""," scanned"]}),a.monthsProcessed>0&&c.jsxs("li",{children:[a.monthsProcessed," month",a.monthsProcessed!==1?"s":""," updated"]}),a.transfersCreated>0&&c.jsxs("li",{children:[a.transfersCreated," transfer",a.transfersCreated!==1?"s":""," created"]}),a.adjustmentsRemoved>0&&c.jsxs("li",{children:[a.adjustmentsRemoved," adjustment",a.adjustmentsRemoved!==1?"s":""," removed"]}),a.transfersCreated===0&&c.jsx("li",{children:"No changes needed"})]}),a.errors.length>0?c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[a.errors.slice(0,5).map((g,_)=>c.jsx("li",{children:g},_)),a.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",a.errors.length-5," more errors"]})]})]}):c.jsx("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:" Adjustment pairs converted to transfers successfully."})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Ve,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.pairsFound," adjustment pair",e.pairsFound!==1?"s":""," to convert:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.accountTransferPairs>0&&c.jsxs("li",{children:[e.accountTransferPairs," account-to-account transfer",e.accountTransferPairs!==1?"s":""]}),e.categoryTransferPairs>0&&c.jsxs("li",{children:[e.categoryTransferPairs," category-to-category transfer",e.categoryTransferPairs!==1?"s":""]})]}),c.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," and ",e.totalMonths," month",e.totalMonths!==1?"s":"","."]})]})}),c.jsxs(Or,{onClick:o,disabled:f,isBusy:r,busyText:"Converting...",actionName:"Run Adjustments to Transfers Migration",children:[" Convert ",e.pairsFound," Pair",e.pairsFound!==1?"s":""," to Transfer",e.pairsFound!==1?"s":""]})]}):c.jsx(Ve,{type:"clean",children:c.jsxs("div",{children:[" No adjustment pairs found to convert",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalMonths," month",e.totalMonths!==1?"s":""," across ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," checked."]})]})}):c.jsx(Ve,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function DB({hasData:t,status:e,report:n,hasViolations:r,violationCount:a,isScanning:o,onScan:u,disabled:h}){const[f,m]=C.useState(!1),[g,_]=C.useState(null),[b,x]=C.useState(!1),E=C.useRef(null),S=()=>t?r?"needs-action":"clean":"unknown",T=M=>{const K=M.target.files?.[0];if(!K)return;const H=new FileReader;H.onload=Q=>{_(Q.target?.result)},H.readAsText(K)},D=()=>{u(f&&g?g:void 0)},j=()=>{n&&navigator.clipboard.writeText(n)};return c.jsxs(Bi,{title:" Account/Category Validation",description:"Scans all transactions for invalid account/category combinations. Can compare against seed CSV to identify source rows.",status:S(),onRefresh:D,isRefreshing:o,isBusy:o,children:[c.jsxs("div",{style:{marginBottom:"0.75rem",padding:"0.75rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px"},children:[c.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",marginBottom:"0.5rem"},children:[c.jsx("input",{type:"checkbox",checked:f,onChange:M=>m(M.target.checked)}),c.jsx("span",{style:{fontSize:"0.9rem"},children:"Compare against seed CSV (optional)"})]}),f&&c.jsxs("div",{style:{marginTop:"0.5rem"},children:[c.jsx("input",{ref:E,type:"file",accept:".csv",onChange:T,style:{fontSize:"0.85rem"}}),g&&c.jsxs("div",{style:{marginTop:"0.25rem",fontSize:"0.8rem",opacity:.7},children:[" Seed file loaded (",g.split(`
`).length," lines)"]})]})]}),o?c.jsx(Ve,{type:"running",children:"Scanning transactions..."}):t?r?c.jsxs(c.Fragment,{children:[c.jsx(Ve,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",a," transaction",a!==1?"s":""," with invalid account/category configuration"]}),e&&c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.violations.filter(M=>M.transactionType==="income").length>0&&c.jsxs("li",{children:[e.violations.filter(M=>M.transactionType==="income").length," income transaction",e.violations.filter(M=>M.transactionType==="income").length!==1?"s":""]}),e.violations.filter(M=>M.transactionType==="expense").length>0&&c.jsxs("li",{children:[e.violations.filter(M=>M.transactionType==="expense").length," expense transaction",e.violations.filter(M=>M.transactionType==="expense").length!==1?"s":""]}),e.violations.filter(M=>M.transactionType==="adjustment").length>0&&c.jsxs("li",{children:[e.violations.filter(M=>M.transactionType==="adjustment").length," adjustment transaction",e.violations.filter(M=>M.transactionType==="adjustment").length!==1?"s":""]}),e.violations.filter(M=>M.transactionType==="transfer").length>0&&c.jsxs("li",{children:[e.violations.filter(M=>M.transactionType==="transfer").length," transfer transaction",e.violations.filter(M=>M.transactionType==="transfer").length!==1?"s":""]})]}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e?.totalMonths," month",e?.totalMonths!==1?"s":""," (",e?.totalIncome," income, ",e?.totalExpenses," expenses, ",e?.totalAdjustments," adjustments, ",e?.totalTransfers," transfers)"]})]})}),c.jsxs("div",{style:{marginTop:"0.5rem"},children:[c.jsxs("button",{onClick:()=>x(!b),style:{background:"none",border:"none",color:"#646cff",cursor:"pointer",fontSize:"0.9rem",textDecoration:"underline"},children:[b?"Hide":"Show"," Detailed Report"]}),n&&c.jsx("button",{onClick:j,style:{background:"none",border:"none",color:"#646cff",cursor:"pointer",fontSize:"0.9rem",textDecoration:"underline",marginLeft:"1rem"},children:" Copy Report"})]}),b&&n&&c.jsx("pre",{style:{marginTop:"0.5rem",padding:"1rem",background:"#1a1a2e",color:"#eee",borderRadius:"6px",fontSize:"0.75rem",overflow:"auto",maxHeight:"400px",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:n}),c.jsx(Or,{onClick:D,disabled:h||f&&!g,isBusy:o,busyText:"Scanning...",actionName:"Re-scan Transaction Validation",children:" Re-scan Transactions"})]}):c.jsxs(c.Fragment,{children:[c.jsx(Ve,{type:"clean",children:c.jsxs("div",{children:[" All transactions have valid account/category configurations",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e?.totalMonths," month",e?.totalMonths!==1?"s":""," (",e?.totalIncome," income, ",e?.totalExpenses," expenses, ",e?.totalAdjustments," adjustments, ",e?.totalTransfers," transfers)"]})]})}),c.jsx(Or,{onClick:D,disabled:h||f&&!g,isBusy:o,busyText:"Scanning...",actionName:"Re-scan Transaction Validation",children:" Re-scan Transactions"})]}):c.jsxs(c.Fragment,{children:[c.jsx(Ve,{type:"unknown",children:" Click Scan to check all transactions for validation issues"}),c.jsx(Or,{onClick:D,disabled:h||f&&!g,isBusy:o,busyText:"Scanning...",actionName:"Scan Transaction Validation",children:" Scan All Transactions"})]})]})}function IB({hasData:t,status:e,needsMigration:n,totalItemsToFix:r,isRunning:a,result:o,onRunMigration:u,onRefresh:h,isRefreshing:f,disabled:m}){const g=()=>t?o&&o.errors.length===0?"complete":n?"needs-action":"clean":"unknown",_=o?o.accountsUpdated+o.categoriesUpdated+o.hiddenAccountsCreated+o.hiddenCategoriesCreated+o.adjustmentsFixed:0;return c.jsx(Bi,{title:" Hidden Field Migration",description:"Adds is_hidden field to accounts/categories, creates hidden account 'Alerus 401K Eide Bailly' and category 'House', and fixes adjustment transactions missing both account and category.",status:g(),onRefresh:h,isRefreshing:f,isBusy:a,children:a?c.jsx(Ve,{type:"running",children:"Running hidden field migration..."}):o?c.jsx(Ve,{type:o.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[o.errors.length>0?"":""," Migration complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[o.budgetsProcessed>0&&c.jsxs("li",{children:[o.budgetsProcessed," budget",o.budgetsProcessed!==1?"s":""," updated"]}),o.accountsUpdated>0&&c.jsxs("li",{children:[o.accountsUpdated," account",o.accountsUpdated!==1?"s":""," got is_hidden field"]}),o.categoriesUpdated>0&&c.jsxs("li",{children:[o.categoriesUpdated," categor",o.categoriesUpdated!==1?"ies":"y"," got is_hidden field"]}),o.hiddenAccountsCreated>0&&c.jsxs("li",{children:[o.hiddenAccountsCreated," hidden account",o.hiddenAccountsCreated!==1?"s":""," created"]}),o.hiddenCategoriesCreated>0&&c.jsxs("li",{children:[o.hiddenCategoriesCreated," hidden categor",o.hiddenCategoriesCreated!==1?"ies":"y"," created"]}),o.adjustmentsFixed>0&&c.jsxs("li",{children:[o.adjustmentsFixed," adjustment",o.adjustmentsFixed!==1?"s":""," fixed"]}),_===0&&c.jsx("li",{children:"No changes needed"})]}),o.errors.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[o.errors.slice(0,5).map((b,x)=>c.jsx("li",{children:b},x)),o.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",o.errors.length-5," more errors"]})]})]})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Ve,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",r," item",r!==1?"s":""," to migrate:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.accountsNeedingField>0&&c.jsxs("li",{children:[e.accountsNeedingField," account",e.accountsNeedingField!==1?"s":""," need is_hidden field"]}),e.categoriesNeedingField>0&&c.jsxs("li",{children:[e.categoriesNeedingField," categor",e.categoriesNeedingField!==1?"ies":"y"," need is_hidden field"]}),e.adjustmentsToFix>0&&c.jsxs("li",{children:[e.adjustmentsToFix," adjustment",e.adjustmentsToFix!==1?"s":""," with missing account/category"]})]}),e.adjustmentDetails.length>0&&c.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",opacity:.8},children:[c.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:500},children:"Adjustments to fix:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[e.adjustmentDetails.slice(0,3).map((b,x)=>c.jsxs("li",{children:["[",b.monthKey,"] $",b.amount.toFixed(2)," - ",b.description||"(no description)"]},x)),e.adjustmentDetails.length>3&&c.jsxs("li",{style:{opacity:.7},children:["...and ",e.adjustmentDetails.length-3," more"]})]})]}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," and ",e.totalMonths," month",e.totalMonths!==1?"s":"","."]})]})}),c.jsxs(Or,{onClick:u,disabled:m,isBusy:a,busyText:"Migrating...",actionName:"Run Hidden Field Migration",children:[" Run Migration (",r," item",r!==1?"s":"",")"]})]}):c.jsx(Ve,{type:"clean",children:c.jsxs("div",{children:[" All accounts and categories have is_hidden field",c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:"No adjustment transactions with missing account/category found."})]})}):c.jsx(Ve,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function MB(){const{state:t,closeModal:e}=lT();if(!t.isOpen)return null;const n=t.isComplete;return c.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:c.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:r=>r.stopPropagation(),children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[c.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&c.jsx(Ul,{noMargin:!0}),t.migrationName]}),n&&c.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),c.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"#ef4444":t.isComplete?"#22c55e":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),c.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?c.jsx("div",{style:{background:t.error?"#ef4444":t.isComplete?"#22c55e":"#646cff",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):c.jsx("div",{style:{background:t.error?"#ef4444":"#646cff",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&c.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&c.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&c.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"#ef4444"},children:t.error}),t.isComplete&&c.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"rgba(239, 68, 68, 0.2)":"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&c.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),c.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function kB(){return c.jsxs("div",{style:Df,children:[c.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:c.jsx(Bt,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:c.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),c.jsx("h1",{children:"Tarron Lane Homepage"}),c.jsx("nav",{children:c.jsxs("ul",{children:[c.jsx("li",{children:c.jsx(Bt,{to:"/sql-test",children:"SQL Test"})}),c.jsx("li",{children:c.jsx(Bt,{to:"/budget",children:"Budget"})}),c.jsx("li",{children:c.jsx(Bt,{to:"/account",children:"Account"})})]})})]})}function OB(){const t=C.useContext(Zu),e=go(),[n,r]=C.useState(!1),a=Bn(),o=Bu(),u=a.state?.from||"/";C.useEffect(()=>{t.is_logged_in&&u!=="/"&&o(u,{replace:!0})},[t.is_logged_in,u,o]);function h(){r(!0),e.logout_firebase_user().then(function(){r(!1)})}return c.jsxs("div",{style:Df,children:[c.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[c.jsx("div",{style:{display:"flex",alignItems:"center"},children:c.jsx(Bt,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),c.jsxs(Bt,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[c.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),c.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),c.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:c.jsx($T,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),c.jsx("h1",{children:"Account"}),t.is_logged_in?n?c.jsx("p",{children:"Logging Out..."}):c.jsxs(c.Fragment,{children:[c.jsxs("p",{children:["You are logged in as ",t.username]}),c.jsx("button",{onClick:h,style:{marginTop:"1rem"},children:"Logout"})]}):c.jsx(NB,{})]})}function NB(){const t=go(),[e,n]=C.useState(""),[r,a]=C.useState(""),[o,u]=C.useState(!1),[h,f]=C.useState("");function m(b){n(b.target.value)}function g(b){a(b.target.value)}function _(b){b.preventDefault(),u(!0),f(""),t.login_firebase_user(e,r).then(function(){}).catch(function(){f("Incorrect login credentials")}).finally(function(){u(!1)})}return c.jsxs("form",{onSubmit:_,children:[c.jsxs("div",{children:[c.jsx("label",{htmlFor:"username",children:"Email: "}),c.jsx("input",{id:"username",type:"email",value:e,onChange:m})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"password",children:"Password: "}),c.jsx("input",{id:"password",type:"password",value:r,onChange:g})]}),o?c.jsx("p",{children:"Logging in..."}):c.jsx("button",{children:"Login"}),h&&c.jsx("p",{style:{color:"red"},children:h})]})}function PB({onCreateNew:t}){const[e,n]=C.useState(""),[r,a]=C.useState(!1),[o,u]=C.useState(null);async function h(f){f.preventDefault(),a(!0),u(null);try{await t(e.trim()||void 0)}catch(m){u(m instanceof Error?m.message:"Failed to create budget"),a(!1)}}return c.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto"},children:[c.jsx("h1",{style:{marginBottom:"0.5rem"},children:"Welcome!"}),c.jsx("p",{style:{opacity:.7,marginBottom:"2rem"},children:"You don't have any budgets yet. Create your first budget to get started."}),o&&c.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:o}),c.jsx("button",{onClick:()=>u(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),c.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"2rem",borderRadius:"12px"},children:[c.jsxs("h2",{style:{margin:"0 0 1rem 0",fontSize:"1.1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Create Your Budget"]}),c.jsxs("form",{onSubmit:h,children:[c.jsxs("div",{style:{marginBottom:"1.5rem"},children:[c.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),c.jsx("input",{type:"text",value:e,onChange:f=>n(f.target.value),placeholder:"My Budget",autoFocus:!0,style:{width:"100%",padding:"0.75rem 1rem",borderRadius:"8px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",boxSizing:"border-box"}}),c.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),c.jsx("button",{type:"submit",disabled:r,style:{width:"100%",background:oe.primary,color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:r?"not-allowed":"pointer",fontWeight:600,opacity:r?.7:1,fontSize:"1rem"},children:r?"Creating...":"Create Budget"})]})]}),c.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"If someone has invited you to their budget, you can accept the invitation from the budget settings page after creating your account."})]})}function LB({invites:t,onAccept:e,onCreateNew:n}){const[r,a]=C.useState(null),[o,u]=C.useState(!1),[h,f]=C.useState(""),[m,g]=C.useState(!1),[_,b]=C.useState(null);async function x(S){a(S),b(null);try{await e(S)}catch(T){b(T instanceof Error?T.message:"Failed to accept invitation"),a(null)}}async function E(S){S.preventDefault(),g(!0),b(null);try{await n(h.trim()||void 0)}catch(T){b(T instanceof Error?T.message:"Failed to create new budget"),g(!1)}}return c.jsxs("div",{children:[c.jsx("h1",{style:{marginBottom:"0.5rem"},children:"Welcome!"}),c.jsxs("p",{style:{opacity:.7,marginBottom:"2rem"},children:["You've been invited to join ",t.length===1?"a budget":"some budgets",". Choose one to get started!"]}),_&&c.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:_}),c.jsx("button",{onClick:()=>b(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),c.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 8%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 25%, transparent)",padding:"1.5rem",borderRadius:"12px",marginBottom:"1.5rem"},children:[c.jsxs("h2",{style:{margin:"0 0 1rem 0",fontSize:"1.1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Budget Invitations"]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:t.map(S=>c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[c.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[c.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.05rem"},children:S.budgetName}),S.ownerEmail&&c.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.6},children:["From: ",S.ownerEmail]})]}),c.jsx("button",{onClick:()=>x(S.budgetId),disabled:r!==null||m,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"8px",cursor:r!==null||m?"not-allowed":"pointer",fontWeight:500,opacity:r!==null||m?.7:1,fontSize:"0.9rem"},children:r===S.budgetId?"Joining...":"Accept & Join"})]},S.budgetId))})]}),c.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",border:"1px dashed color-mix(in srgb, currentColor 20%, transparent)",padding:"1.5rem",borderRadius:"12px"},children:o?c.jsxs("form",{onSubmit:E,children:[c.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Create Your Budget"}),c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),c.jsx("input",{type:"text",value:h,onChange:S=>f(S.target.value),placeholder:"My Budget",autoFocus:!0,style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}})]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[c.jsx("button",{type:"submit",disabled:m||r!==null,style:{background:oe.primary,color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:m||r!==null?"not-allowed":"pointer",fontWeight:500,opacity:m||r!==null?.7:1,fontSize:"0.9rem"},children:m?"Creating...":"Create Budget"}),c.jsx("button",{type:"button",onClick:()=>{u(!1),f("")},disabled:m,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:m?"not-allowed":"pointer",fontWeight:500,opacity:m?.7:.8,fontSize:"0.9rem"},children:"Cancel"})]})]}):c.jsxs("div",{style:{textAlign:"center"},children:[c.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.7},children:"Or start fresh with your own budget"}),c.jsx("button",{onClick:()=>u(!0),disabled:r!==null,style:{background:oe.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"8px",cursor:r!==null?"not-allowed":"pointer",fontWeight:500,opacity:r!==null?.7:1,fontSize:"0.9rem"},children:"Create New Budget"})]})})]})}const BB={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"},zB={balances:"categories",transactions:"income"};function UB({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const r=BB[t],a=C.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),o=C.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"}],[n]),u=C.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),h=m=>{e(zB[m])},f=r==="balances"?o:u;return c.jsxs("div",{children:[c.jsx(Mf,{mode:"button",tabs:a,activeTab:r,onTabChange:h,variant:"segmented"}),c.jsx(Mf,{mode:"button",tabs:f,activeTab:t,onTabChange:m=>e(m),variant:"secondary"})]})}function VB({isOpen:t,onClose:e,onProceed:n,results:r}){const[a,o]=C.useState("from_current"),u=!r||r.status==="confirming",h=r&&!["confirming","done","error"].includes(r.status),f=u||r?.status==="done"||r?.status==="error";function m(){f&&(e(),o("from_current"))}function g(){n(a)}return c.jsx(va,{isOpen:t,onClose:m,title:"Recalculate Balances",width:"540px",children:c.jsxs("div",{style:{padding:"0.5rem 0"},children:[u&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.95rem",lineHeight:1.5},children:"Choose what to recalculate:"}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[c.jsx(Aw,{selected:a==="from_current",onClick:()=>o("from_current"),title:"From current month forward",description:"Recalculate from this month onward. Use for quick fixes."}),c.jsx(Aw,{selected:a==="all_months",onClick:()=>o("all_months"),title:"All months from beginning",description:"Recalculate entire history. Use after migrations or data repairs.",recommended:!0})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[c.jsx(ul,{status:"waiting",label:"Find all months to process"}),c.jsx(ul,{status:"waiting",label:"Process months"}),c.jsx(ul,{status:"waiting",label:"Update budget totals"})]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{variant:"secondary",actionName:"Cancel Recalculation",onClick:e,children:"Cancel"}),c.jsx(Ie,{actionName:"Proceed with Recalculation",onClick:g,children:"Proceed"})]})]}),!u&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Recalculating category balances and account balances..."}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[c.jsx(ul,{status:r?.status==="pending"?"waiting":"complete",label:"Find all months to process",detail:r&&r.status!=="pending"?`Found ${r.monthsFound||0} month${r.monthsFound!==1?"s":""}`:void 0}),c.jsx(ul,{status:Tw(r?.status,["pending","finding_months"],"processing_months"),label:"Process months",detail:r?.status==="processing_months"?`Processing: ${r.currentMonthLabel} (${(r.currentMonthIndex||0)+1}/${r.monthsFound||0})`:r?.monthsProcessed!==void 0?`Processed ${r.monthsProcessed} month${r.monthsProcessed!==1?"s":""}`:void 0}),c.jsx(ul,{status:r?.status==="error"?"error":Tw(r?.status,["pending","finding_months","processing_months"],"updating_budget"),label:"Update budget totals",detail:r?.status==="error"?r.error:void 0,isError:r?.status==="error"})]}),r?.status==="done"&&c.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:`color-mix(in srgb, ${oe.success} 10%, transparent)`,border:`1px solid ${oe.success}`,borderRadius:"8px",textAlign:"center"},children:[c.jsx("p",{style:{margin:0,fontWeight:600,color:oe.success},children:" Recalculation complete!"}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",opacity:.8},children:[r.monthsProcessed," month",r.monthsProcessed!==1?"s":""," processed",c.jsx("br",{}),"Total Income: ",Ue(r.totalIncomeRecalculated||0),c.jsx("br",{}),"Total Expenses: ",Ue(r.totalExpensesRecalculated||0)]})]}),(r?.status==="done"||r?.status==="error")&&c.jsx("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"center"},children:c.jsx(Ie,{actionName:"Close Recalculation Modal",onClick:e,children:"Done"})}),h&&c.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"Please wait, do not close this window..."})]})]})})}function Tw(t,e,n){return!t||e.includes(t)?t===n?"active":"waiting":t===n?"active":"complete"}function ul({status:t,label:e,detail:n,isError:r}){const a=t==="waiting"?"":t==="active"?"":t==="error"?"":"";return c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[c.jsx("span",{style:{fontSize:"1.1rem",width:"1.5rem",textAlign:"center"},children:a}),c.jsxs("div",{style:{flex:1},children:[c.jsx("p",{style:{margin:0,fontWeight:500},children:e}),n&&c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:r?1:.6,color:r?oe.error:"inherit"},children:n})]})]})}function Aw({selected:t,onClick:e,title:n,description:r,recommended:a}){return c.jsxs("button",{type:"button",onClick:e,style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem 1rem",background:t?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",border:t?"2px solid #646cff":"2px solid transparent",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.15s ease"},children:[c.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",border:t?"6px solid #646cff":"2px solid rgba(128,128,128,0.5)",flexShrink:0,marginTop:"2px",background:t?"white":"transparent"}}),c.jsxs("div",{style:{flex:1},children:[c.jsxs("p",{style:{margin:0,fontWeight:600,fontSize:"0.95rem"},children:[n,a&&c.jsx("span",{style:{marginLeft:"0.5rem",padding:"0.15rem 0.5rem",background:oe.success,color:"white",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,verticalAlign:"middle"},children:"RECOMMENDED"})]}),c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:r})]})]})}function zg(t){return t==="no_category"||t==="NO_CATEGORY"}function FB(t,e){const n={};for(const r of t)zg(r.from_category_id)||(n[r.from_category_id]=(n[r.from_category_id]||0)-r.amount),zg(r.to_category_id)||(n[r.to_category_id]=(n[r.to_category_id]||0)+r.amount);for(const r of e)zg(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(n))n[r]=Ee(n[r]);return n}async function $B(t,e,n,r,a,o,u){const h=Nr(t,e.year,e.month),{exists:f,data:m}=await We("months",h,"recalculate: reading full month data");if(!f||!m)return null;const g=m.income||[],_=m.expenses||[],b=m.transfers||[],x=m.adjustments||[],E=m.are_allocations_finalized||!1,S=Ee(g.reduce((k,O)=>k+O.amount,0)),T=Ee(_.reduce((k,O)=>k+O.amount,0)),D={};if(m.category_balances)for(const k of m.category_balances)D[k.category_id]={allocated:k.allocated??0};const j=FB(b,x),M=n.map(k=>{const O=Ee(a[k]??0);let N=0;E&&D[k]&&(N=Ee(D[k].allocated));let L=0;_.length>0&&(L=Ee(_.filter(Y=>Y.category_id===k).reduce((Y,W)=>Y+W.amount,0)));const U=j[k]??0,R=Ee(O+N+L+U);return{category_id:k,start_balance:O,allocated:N,spent:L,end_balance:R}});M.forEach(k=>{a[k.category_id]=k.end_balance});const K=Object.keys(r),H={},Q=K.map(k=>{const O=Ee(g.filter(B=>B.account_id===k).reduce((B,$)=>B+$.amount,0)),N=Ee(_.filter(B=>B.account_id===k).reduce((B,$)=>B+$.amount,0)),L=Ee(b.filter(B=>B.from_account_id===k).reduce((B,$)=>B-$.amount,0)),U=Ee(b.filter(B=>B.to_account_id===k).reduce((B,$)=>B+$.amount,0)),R=Ee(x.filter(B=>B.account_id===k).reduce((B,$)=>B+$.amount,0)),Y=Ee(O+N+L+U+R);H[k]=Y;const W=Ee(o[k]??0);return{account_id:k,start_balance:W,income:O,expenses:N,net_change:Y,end_balance:Ee(W+Y)}});for(const k of Q)o[k.account_id]=k.end_balance;return{updatedMonth:{budget_id:t,year_month_ordinal:It(e.year,e.month),year:e.year,month:e.month,income:g,total_income:S,previous_month_income:u,expenses:_,total_expenses:T,transfers:b,adjustments:x,account_balances:Q,category_balances:M,are_allocations_finalized:E,created_at:m.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},totalIncome:S,totalExpenses:T,accountNetChanges:H}}function N0({isDisabled:t,onCloseMenu:e}){const{selectedBudgetId:n,currentUserId:r,currentYear:a,currentMonthNumber:o}=Pt(),{categories:u,accounts:h,saveCategories:f,saveAccounts:m}=Mn(n,r),[g,_]=C.useState(!1),[b,x]=C.useState(!1),[E,S]=C.useState(null);function T(){x(!0),S({status:"confirming"})}async function D(M){if(n){_(!0),S({status:"pending"});try{S({status:"finding_months"});let K;if(M==="all_months")K=(await pn("months","recalculate: querying all months for full recalculation",[{field:"budget_id",op:"==",value:n}])).docs.map(Y=>({year:Y.data.year,month:Y.data.month})).sort((Y,W)=>Y.year!==W.year?Y.year-W.year:Y.month-W.month);else{const R=new Date,Y=a||R.getFullYear(),W=o||R.getMonth()+1,{year:B,month:$}=Cf(Y,W);K=await e4(n,B,$)}const H=Object.keys(u);S({status:"finding_months",monthsFound:K.length}),await new Promise(R=>setTimeout(R,100));const Q={},P={};if(M==="from_current"){const R=new Date,Y=a||R.getFullYear(),W=o||R.getMonth()+1,{year:B,month:$}=Cf(Y,W),G=Nr(n,B,$),{exists:J,data:re}=await We("months",G,"recalculate: reading previous month for starting balances");if(J&&re?.category_balances)for(const V of re.category_balances)Q[V.category_id]=V.end_balance??0;if(J&&re?.account_balances)for(const V of re.account_balances)P[V.account_id]=V.end_balance??0}H.forEach(R=>{Q[R]===void 0&&(Q[R]=0)}),Object.keys(h).forEach(R=>{P[R]===void 0&&(P[R]=0)});let k=0,O=0,N=0;for(let R=0;R<K.length;R++){const Y=K[R],W=`${Cl[Y.month-1]} ${Y.year}`;S({status:"processing_months",monthsFound:K.length,currentMonthIndex:R,currentMonthLabel:W});const B=await $B(n,Y,H,h,Q,P,N);B&&(k+=B.totalIncome,O+=B.totalExpenses,N=B.totalIncome,await P4({budgetId:n,month:B.updatedMonth,description:"recalculate all months"}),await new Promise($=>setTimeout($,50)))}const L={};Object.entries(h).forEach(([R,Y])=>{L[R]={...Y,balance:P[R]??0}}),await m(L),S({status:"updating_budget",monthsFound:K.length,monthsProcessed:K.length,totalIncomeRecalculated:k,totalExpensesRecalculated:O});const U={};Object.entries(u).forEach(([R,Y])=>{U[R]={...Y,balance:Q[R]??0}}),await f(U);for(const R of K)Qe.invalidateQueries({queryKey:Se.month(n,R.year,R.month)});S({status:"done",monthsFound:K.length,monthsProcessed:K.length,totalIncomeRecalculated:k,totalExpensesRecalculated:O})}catch(K){console.error("Recalculate error:",K),S({status:"error",error:K instanceof Error?K.message:"Failed to recalculate"})}finally{_(!1)}}}function j(){x(!1),S(null),e?.()}return c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:T,disabled:t||g,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.5rem",cursor:t||g?"not-allowed":"pointer",opacity:t||g?.5:1,fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center"},title:"Recalculate balances from this month forward",children:[g?"":""," Recalculate"]}),c.jsx(VB,{isOpen:b,onClose:j,onProceed:D,results:E})]})}function jw({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:a}){const[o,u]=C.useState(!1),h=n||e,f=t==="prev"?"":"",m=t==="prev"?"Previous month":"Next month",g=()=>{n||(e?(u(!0),setTimeout(()=>u(!1),2e3)):a())};return c.jsxs("div",{style:{position:"relative"},children:[c.jsx("button",{onClick:g,onMouseEnter:()=>e&&u(!0),onMouseLeave:()=>u(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:h?"not-allowed":"pointer",fontSize:"1.25rem",opacity:h?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:m,children:f}),o&&e&&c.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:oe.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r})]})}function qB(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Mu;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function HB(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-Tf;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function GB(t){return Object.keys(t).sort()[0]}function QB(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function WB(t){const e=HB(),n=GB(t);if(!n)return e;const r=It(e.year,e.month);return n<r?QB(n):e}function KB(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function YB(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function XB({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=nr(),{currentYear:r,currentMonthNumber:a,isAdmin:o,selectedBudgetId:u,currentUserId:h,setCurrentYear:f,setCurrentMonthNumber:m}=Pt(),{budget:g,monthMap:_}=Mn(u,h),{month:b}=ys(u,r,a),x=KB(r,a),E=YB(r,a),S=WB(_),T=qB(),D=It(S.year,S.month),j=It(T.year,T.month),M=It(x.year,x.month),K=It(E.year,E.month),H=M<D,Q=K>j,[P,k]=C.useState(!1),[O,N]=C.useState(!1),[L,U]=C.useState(r),[R,Y]=C.useState(a),W=C.useRef(null);C.useEffect(()=>{if(!P)return;function J(re){W.current&&!W.current.contains(re.target)&&(k(!1),N(!1))}return document.addEventListener("mousedown",J),()=>document.removeEventListener("mousedown",J)},[P]);function B(){O||(U(r),Y(a)),N(!O)}function $(){f(L),m(R),N(!1),k(!1)}function G(){if(!b||!g)return;const J={...b,_meta:{downloaded_at:new Date().toISOString(),budget_id:g.id,budget_name:g.name}},re=new Blob([JSON.stringify(J,null,2)],{type:"application/json"}),V=URL.createObjectURL(re),q=document.createElement("a");q.href=V,q.download=`month_${r}_${String(a).padStart(2,"0")}.json`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(V),k(!1)}return c.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[c.jsx(jw,{direction:"prev",isDisabled:H,isLoading:n,disabledReason:"Cannot create months more than 3 months into the past",onNavigate:t}),c.jsxs("div",{ref:W,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[c.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[Cl[a-1]," ",r]}),c.jsx("button",{onClick:()=>k(!P),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:P?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&c.jsxs(c.Fragment,{children:[c.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),c.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[c.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:oe.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),c.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),P&&c.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[c.jsx(N0,{isDisabled:n,onCloseMenu:()=>k(!1)}),c.jsx("button",{onClick:B,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),O&&(()=>{const J=S.year,re=T.year,V=L>J,q=L<re;return c.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[c.jsx("button",{onClick:()=>U(ee=>ee-1),disabled:!V,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:V?"pointer":"not-allowed",fontSize:"0.8rem",opacity:V?1:.3},title:V?"Previous year":"Cannot go further back",children:""}),c.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:L}),c.jsx("button",{onClick:()=>U(ee=>ee+1),disabled:!q,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:q?"pointer":"not-allowed",fontSize:"0.8rem",opacity:q?1:.3},title:q?"Next year":"Cannot go further ahead",children:""})]}),c.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:Cl.map((ee,ne)=>{const te=ne+1,se=te===R,he=L===r&&te===a,we=It(L,te),ge=we<D,Z=we>j,ve=ge||Z;let Te=ee;return ge?Te="Too far in the past":Z&&(Te="Too far in the future"),c.jsx("button",{onClick:()=>Y(te),disabled:ve,style:{background:se?oe.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:he?`1px solid ${oe.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:ve?"not-allowed":"pointer",fontSize:"0.7rem",color:se?"#fff":"inherit",opacity:ve?.3:1,transition:"background 0.15s"},title:Te,children:ee.slice(0,3)},te)})}),(()=>{const ee=It(L,R),ne=ee>=D&&ee<=j;return c.jsxs("button",{onClick:$,disabled:!ne,style:{width:"100%",background:ne?oe.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:ne?"pointer":"not-allowed",fontSize:"0.85rem",color:ne?"#fff":"inherit",fontWeight:500,opacity:ne?1:.5},children:["Go to ",Cl[R-1]," ",L]})})()]})})(),o&&b&&c.jsx("button",{onClick:()=>{G()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"})]})]}),c.jsx(jw,{direction:"next",isDisabled:Q,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e})]})}const P0={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},JB={...P0,background:oe.primary,border:"none",color:"white"},ZB={...P0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},ez={...P0,background:"transparent",border:`1px solid ${oe.errorBorder}`,color:oe.error},Rw=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${oe.error} 15%, transparent)`:`color-mix(in srgb, ${oe.success} 15%, transparent)`,border:`1px solid ${t?oe.errorBorder:"rgba(74, 222, 128, 0.4)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?oe.error:oe.success,transition:"all 0.15s ease",flexShrink:0});function L0({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:a,initialData:o,defaultAccountId:u,defaultDate:h,config:f,onSubmit:m,onCancel:g,onDelete:_,extraContent:b}){const{isWide:x}=aT(),{showCategory:E=!1,showCleared:S=!1,showSignToggle:T=!1,accountLabel:D="Account",payeePlaceholder:j="Payee name",descriptionPlaceholder:M="Optional note",submitLabel:K}=f,H=new Date().toISOString().split("T")[0],[Q,P]=C.useState(o?.date||h||H),[k,O]=C.useState(o?.payee||""),[N,L]=C.useState(o?.categoryId||(f.showNoCategoryOption?Lt:"")),[U,R]=C.useState(o?.accountId||u||(f.showNoAccountOption?Ot:t[0]?t[0][0]:"")),Y=o?.amount!==void 0?Math.abs(o.amount):void 0,[W,B]=C.useState(Y?.toString()||""),[$,G]=C.useState(o?.description||""),[J,re]=C.useState(o?.cleared||!1),[V,q]=C.useState(()=>T?o?.amount!==void 0?o.amount<0:!1:!0),[ee,ne]=C.useState(!1),te={},se=[];t.forEach(([at,ln])=>{ln.account_group_id?(te[ln.account_group_id]||(te[ln.account_group_id]=[]),te[ln.account_group_id].push([at,ln])):se.push([at,ln])});function he(at){at.preventDefault();const ln=parseFloat(W);if(isNaN(ln)||ln<=0||E&&!N||!U||!Q)return;if(N===Lt&&U===Ot){ne(!0);return}ne(!1);const Lr=T&&V?-ln:ln;m({date:Q,payee:k.trim()||void 0,categoryId:E?N:void 0,accountId:U,amount:Lr,description:$.trim()||void 0,cleared:S?J:void 0})}!(N===Lt&&U===Ot)&&ee&&ne(!1);const ve=f.showNoAccountOption?c.jsx(VT,{id:"txn-account",value:U,onChange:R,accounts:t,accountGroups:e,placeholder:Pi,required:!0,showNoAccountOption:!0}):c.jsxs(Ou,{id:"txn-account",value:U,onChange:at=>R(at.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([at,ln])=>{const _s=te[at];return _s?.length?c.jsx("optgroup",{label:ln.name,children:_s.map(([cn,Lr])=>c.jsx("option",{value:cn,children:Lr.nickname},cn))},at):null}),se.length>0&&c.jsx("optgroup",{label:"Other",children:se.map(([at,ln])=>c.jsx("option",{value:at,children:ln.nickname},at))})]}),Te=E&&n&&r?c.jsx(wt,{label:"Category",htmlFor:"txn-category",children:c.jsx(UT,{id:"txn-category",value:N,onChange:L,categories:n,categoryGroups:r,placeholder:f.showNoCategoryOption?ba:"Search...",required:!0,showNoCategoryOption:f.showNoCategoryOption})}):null,dt=S?c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[c.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),c.jsx(Mr,{id:"txn-cleared",checked:J,onChange:at=>re(at.target.checked)})]}):null,Me=c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),c.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[c.jsx("button",{type:"submit",title:K,style:JB,children:""}),c.jsx("button",{type:"button",onClick:()=>{g()},title:"Cancel",style:ZB,children:""}),_&&c.jsx("button",{type:"button",onClick:()=>{_()},title:"Delete",style:ez,children:""})]})]}),ke=ee?c.jsx("div",{style:{background:`color-mix(in srgb, ${oe.error} 15%, transparent)`,border:`1px solid ${oe.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:oe.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,lt=c.jsxs(Ca,{children:[c.jsx(Ie,{type:"submit",actionName:K,children:K}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:g,children:"Cancel"}),_&&c.jsx(Ie,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:_,children:" Delete"})]}),rr=E&&n&&r,ii={fontSize:"0.85rem",padding:"0.5rem"};if(!x)return c.jsxs(ms,{actionName:K,onSubmit:he,children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[c.jsx(wt,{label:"Date",htmlFor:"txn-date",children:c.jsx(If,{id:"txn-date",value:Q,onChange:at=>P(at.target.value),required:!0})}),c.jsx(wt,{label:T?V?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:T?c.jsxs("div",{style:{display:"flex",alignItems:"stretch"},children:[c.jsx("button",{type:"button",onClick:()=>q(!V),style:Rw(V),title:V?"Click to make this a refund (+)":"Click to make this an expense (-)",children:V?"":"+"}),c.jsx("div",{style:{flex:1},children:c.jsx(ao,{id:"txn-amount",value:W,onChange:B,placeholder:"$0.00",required:!0,autoFocus:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:V?oe.error:oe.success}})})]}):c.jsx(ao,{id:"txn-amount",value:W,onChange:B,placeholder:"$0.00",required:!0,autoFocus:!0})})]}),c.jsx(wt,{label:"Payee",htmlFor:"txn-payee",children:c.jsx(Cw,{id:"txn-payee",value:k,onChange:O,payees:a,placeholder:j})}),Te,c.jsx(wt,{label:D,htmlFor:"txn-account",children:ve}),c.jsx(wt,{label:"Description (optional)",htmlFor:"txn-description",children:c.jsx(ps,{id:"txn-description",value:$,onChange:at=>G(at.target.value),placeholder:M})}),S&&c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx(Mr,{id:"txn-cleared-stacked",checked:J,onChange:at=>re(at.target.checked)}),c.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),ke,b]}),lt]});const Et=T?"8.25rem":"6rem",Ft=rr?S?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${Et} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${Et} minmax(10rem, 2fr) auto`:S?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${Et} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${Et} minmax(12rem, 2fr) auto`;return c.jsxs(ms,{actionName:K,onSubmit:he,children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:Ft,gap:"1rem",alignItems:"end"},children:[c.jsx(wt,{label:"Date",htmlFor:"txn-date",children:c.jsx(If,{id:"txn-date",value:Q,onChange:at=>P(at.target.value),required:!0,style:ii})}),c.jsx(wt,{label:"Payee",htmlFor:"txn-payee",children:c.jsx(Cw,{id:"txn-payee",value:k,onChange:O,payees:a,placeholder:j})}),Te,c.jsx(wt,{label:D,htmlFor:"txn-account",children:ve}),c.jsx(wt,{label:T?V?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:T?c.jsxs("div",{style:{display:"flex",alignItems:"stretch"},children:[c.jsx("button",{type:"button",onClick:()=>q(!V),style:Rw(V),title:V?"Click to make this a refund (+)":"Click to make this an expense (-)",children:V?"":"+"}),c.jsx("div",{style:{flex:1},children:c.jsx(ao,{id:"txn-amount",value:W,onChange:B,placeholder:"$0.00",required:!0,autoFocus:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:V?oe.error:oe.success}})})]}):c.jsx(ao,{id:"txn-amount",value:W,onChange:B,placeholder:"$0.00",required:!0,autoFocus:!0})}),c.jsx(wt,{label:"Description",htmlFor:"txn-description",children:c.jsx(ps,{id:"txn-description",value:$,onChange:at=>G(at.target.value),placeholder:M,style:ii})}),dt,Me]}),ke,b]})}function Dw({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:a,defaultDate:o,onSubmit:u,onCancel:h,onDelete:f,submitLabel:m}){function g(_){u(_.amount,_.accountId,_.date,_.payee,_.description)}return c.jsx(L0,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:a,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:m},onSubmit:g,onCancel:h,onDelete:f})}function tz({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:a,isMobile:o,isEvenRow:u}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=n?`${n} / ${e}`:e,m=u?"transparent":"rgba(255,255,255,0.04)";if(o)return c.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:m,cursor:"pointer",transition:"background 0.15s"},children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),c.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),c.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",f]})]}),c.jsx("div",{style:{display:"flex",alignItems:"center"},children:c.jsxs("span",{style:{fontWeight:600,color:oe.success,fontFamily:"monospace"},children:["+",Ue(t.amount)]})})]});const g={padding:"0.6rem 0.5rem",background:m,display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:c.jsx("span",{style:{opacity:.6},children:h})}),c.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),c.jsx("div",{style:{...g,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),c.jsxs("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:oe.success,fontFamily:"monospace"},children:["+",Ue(t.amount)]}),c.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),c.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[c.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Edit",children:""}),c.jsx("button",{onClick:a,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const dl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function nz(){const{selectedBudgetId:t,currentUserId:e,currentYear:n,currentMonthNumber:r,setCurrentYear:a,setCurrentMonthNumber:o}=Pt(),{accounts:u,accountGroups:h}=Mn(t,e),{month:f,isLoading:m,addIncome:g,updateIncome:_,deleteIncome:b}=ys(t,n,r),x=Li(),[E,S]=C.useState(null),[T,D]=C.useState(!1),[j,M]=C.useState(null),Q=tT(t,{enabled:T||j!==null}).data||[];function P(G){const J=G.account_group_id?h[G.account_group_id]:void 0;return J?.is_active!==void 0?J.is_active:G.is_active!==!1}function k(G){const J=G.account_group_id?h[G.account_group_id]:void 0;return J?.on_budget!==void 0?J.on_budget:G.on_budget!==!1}const O=Object.entries(u).filter(([,G])=>P(G)&&k(G)),N=O.filter(([,G])=>G.is_income_account),L=N.length>0?N:O,U=O.find(([,G])=>G.is_income_default),R=U?U[0]:void 0,Y=f?.income.reduce((G,J)=>G+J.amount,0)||0;function W(G,J,re,V,q){S(null),D(!1);const[ee,ne]=re.split("-").map(Number);g(G,J,re,V,q).then(()=>{(ee!==n||ne!==r)&&(a(ee),o(ne))}).catch(te=>{S(te instanceof Error?te.message:"Failed to add income")})}function B(G,J,re,V,q,ee){S(null),M(null),_(G,J,re,V,q,ee).catch(ne=>{S(ne instanceof Error?ne.message:"Failed to update income")})}function $(G){confirm("Are you sure you want to delete this income entry?")&&(S(null),b(G).catch(J=>{S(J instanceof Error?J.message:"Failed to delete income")}))}return c.jsxs("div",{style:{opacity:m?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:m?"none":"auto"},children:[E&&c.jsx("div",{style:{background:`color-mix(in srgb, ${oe.error} 15%, transparent)`,border:`1px solid ${oe.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:oe.error},children:E}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:x?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:x?"block":"grid",gridTemplateColumns:x?void 0:"subgrid"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Income:"}),c.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Total: "}),c.jsx("span",{style:{color:Tt(Y),fontWeight:600},children:Ue(Y)})]})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!T&&c.jsx(Ie,{actionName:"Open Add Income Form",onClick:()=>D(!0),disabled:L.length===0,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!x&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:dl,children:"Date"}),c.jsx("div",{style:dl,children:"Payee"}),c.jsx("div",{style:dl,children:"Account"}),c.jsx("div",{style:{...dl,textAlign:"right"},children:"Amount"}),c.jsx("div",{style:dl,children:"Description"}),c.jsx("div",{style:dl})]})]}),c.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),L.length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:[Object.keys(u).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".'," ",c.jsx(Bt,{to:"/budget/accounts",style:{opacity:1},children:"Manage accounts "})]}),T&&c.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:c.jsx(Dw,{accounts:L,accountGroups:h,payees:Q,defaultAccountId:R,defaultDate:`${n}-${String(r).padStart(2,"0")}-01`,onSubmit:W,onCancel:()=>D(!1),submitLabel:"Add Income",isMobile:x})}),f?.income.slice().sort((G,J)=>(G.date||"").localeCompare(J.date||"")).map((G,J)=>j===G.id?c.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:c.jsx(Dw,{accounts:L,accountGroups:h,payees:Q,initialData:G,onSubmit:(re,V,q,ee,ne)=>B(G.id,re,V,q,ee,ne),onCancel:()=>M(null),onDelete:()=>$(G.id),submitLabel:"Save",isMobile:x})},G.id):c.jsx(tz,{income:G,accountName:Pe(G.account_id)?Pi:u[G.account_id]?.nickname||"Unknown Account",accountGroupName:Pe(G.account_id)?void 0:u[G.account_id]?.account_group_id?h[u[G.account_id].account_group_id]?.name:void 0,onEdit:()=>{G.payee||`${G.amount}`,M(G.id)},onDelete:()=>$(G.id),isMobile:x,isEvenRow:J%2===0},G.id)),(!f?.income||f.income.length===0)&&!T&&c.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function Iw({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:a,initialData:o,defaultAccountId:u,defaultDate:h,onSubmit:f,onCancel:m,onDelete:g,submitLabel:_}){function b(x){f(x.amount,x.categoryId,x.accountId,x.date,x.payee,x.description,x.cleared)}return c.jsx(L0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:a,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:u,defaultDate:h,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:_},onSubmit:b,onCancel:m,onDelete:g})}function rz({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:a,onDelete:o,isMobile:u,isEvenRow:h}){const f=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,g=h?"transparent":"rgba(255,255,255,0.04)";if(u)return c.jsxs("div",{onClick:a,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:g,cursor:"pointer",transition:"background 0.15s"},children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:f}),c.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&c.jsx("span",{style:{fontSize:"0.7rem",color:oe.success},title:"Cleared",children:""})]}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),c.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",m]})]})]}),c.jsx("div",{style:{display:"flex",alignItems:"center"},children:c.jsx("span",{style:{fontWeight:600,color:Tt(t.amount),fontFamily:"monospace"},children:pr(t.amount)})})]});const _={padding:"0.6rem 0.5rem",background:g,display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{..._,fontSize:"0.85rem",fontFamily:"monospace"},children:c.jsx("span",{style:{opacity:.6},children:f})}),c.jsx("div",{style:{..._,fontWeight:500,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),c.jsx("div",{style:{..._,justifyContent:"center"},children:c.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),c.jsx("div",{style:{..._,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),c.jsx("div",{style:{..._,justifyContent:"flex-end",fontWeight:600,color:Tt(t.amount),fontFamily:"monospace"},children:pr(t.amount)}),c.jsx("div",{style:{..._,paddingLeft:"0.5rem",overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),c.jsx("div",{style:{..._,justifyContent:"center",color:t.cleared?oe.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),c.jsxs("div",{style:{..._,justifyContent:"flex-end",gap:"0.25rem"},children:[c.jsx("button",{onClick:a,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Edit",children:""}),c.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Js={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function iz(){const{selectedBudgetId:t,currentUserId:e,currentYear:n,currentMonthNumber:r,setCurrentYear:a,setCurrentMonthNumber:o}=Pt(),{accounts:u,accountGroups:h,categories:f,categoryGroups:m}=Mn(t,e),{month:g,isLoading:_,addExpense:b,updateExpense:x,deleteExpense:E}=ys(t,n,r),S=Li(),[T,D]=C.useState(null),[j,M]=C.useState(!1),[K,H]=C.useState(null),k=tT(t,{enabled:j||K!==null}).data||[];function O(re){const V=re.account_group_id?h[re.account_group_id]:void 0;return V?.is_active!==void 0?V.is_active:re.is_active!==!1}function N(re){const V=re.account_group_id?h[re.account_group_id]:void 0;return V?.on_budget!==void 0?V.on_budget:re.on_budget!==!1}const L=Object.entries(u).filter(([,re])=>O(re)&&N(re)),U=L.filter(([,re])=>re.is_outgo_account),R=U.length>0?U:L,Y=L.find(([,re])=>re.is_outgo_default),W=Y?Y[0]:void 0,B=g?.expenses?.reduce((re,V)=>re+V.amount,0)||0;function $(re,V,q,ee,ne,te,se){D(null),M(!1);const[he,we]=ee.split("-").map(Number);b(re,V,q,ee,ne,te,se).then(()=>{(he!==n||we!==r)&&(a(he),o(we))}).catch(ge=>{D(ge instanceof Error?ge.message:"Failed to add expense")})}function G(re,V,q,ee,ne,te,se,he){D(null),H(null),x(re,V,q,ee,ne,te,se,he).catch(we=>{D(we instanceof Error?we.message:"Failed to update expense")})}function J(re){confirm("Are you sure you want to delete this expense?")&&(D(null),E(re).catch(V=>{D(V instanceof Error?V.message:"Failed to delete expense")}))}return c.jsxs("div",{style:{opacity:_?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:_?"none":"auto"},children:[T&&c.jsx("div",{style:{background:`color-mix(in srgb, ${oe.error} 15%, transparent)`,border:`1px solid ${oe.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:oe.error},children:T}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:S?"block":"grid",gridTemplateColumns:S?void 0:"subgrid"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),c.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Total: "}),c.jsx("span",{style:{color:Tt(B),fontWeight:600},children:pr(B)})]})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!j&&c.jsx(Ie,{actionName:"Open Add Expense Form",onClick:()=>M(!0),disabled:R.length===0||Object.keys(f).length===0,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!S&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:Js,children:"Date"}),c.jsx("div",{style:Js,children:"Payee"}),c.jsx("div",{style:{...Js,textAlign:"center"},children:"Category"}),c.jsx("div",{style:Js,children:"Account"}),c.jsx("div",{style:{...Js,textAlign:"right"},children:"Amount"}),c.jsx("div",{style:Js,children:"Description"}),c.jsx("div",{style:{...Js,textAlign:"center"},children:"Clr"}),c.jsx("div",{style:Js})]})]}),R.length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:[Object.keys(u).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".'," ",c.jsx(Bt,{to:"/budget/accounts",style:{opacity:1},children:"Manage accounts "})]}),Object.keys(f).length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:["You need to create at least one category before adding expenses."," ",c.jsx(Bt,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),j&&c.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:c.jsx(Iw,{accounts:R,accountGroups:h,categories:f,categoryGroups:m,payees:k,defaultAccountId:W,defaultDate:`${n}-${String(r).padStart(2,"0")}-01`,onSubmit:$,onCancel:()=>M(!1),submitLabel:"Add Expense",isMobile:S})}),g?.expenses?.slice().sort((re,V)=>(re.date||"").localeCompare(V.date||"")).map((re,V)=>K===re.id?c.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:c.jsx(Iw,{accounts:R,accountGroups:h,categories:f,categoryGroups:m,payees:k,initialData:re,onSubmit:(q,ee,ne,te,se,he,we)=>G(re.id,q,ee,ne,te,se,he,we),onCancel:()=>H(null),onDelete:()=>J(re.id),submitLabel:"Save",isMobile:S})},re.id):c.jsx(rz,{expense:re,categoryName:Je(re.category_id)?ba:f[re.category_id]?.name||"Unknown Category",accountName:Pe(re.account_id)?Pi:u[re.account_id]?.nickname||"Unknown Account",accountGroupName:Pe(re.account_id)?void 0:u[re.account_id]?.account_group_id?h[u[re.account_id].account_group_id]?.name:void 0,onEdit:()=>{re.payee||`${re.amount}`,H(re.id)},onDelete:()=>J(re.id),isMobile:S,isEvenRow:V%2===0},re.id)),(!g?.expenses||g.expenses.length===0)&&!j&&c.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const sz={background:oe.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},az={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},oz={background:"transparent",border:`1px solid ${oe.errorBorder}`,color:oe.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function Mw({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:a,defaultDate:o,onSubmit:u,onCancel:h,onDelete:f,submitLabel:m}){const{isWide:g}=aT(),_=new Date().toISOString().split("T")[0],[b,x]=C.useState(a?.date||o||_),[E,S]=C.useState(a?.amount?.toString()||""),[T,D]=C.useState(a?.from_account_id||Ot),[j,M]=C.useState(a?.to_account_id||Ot),[K,H]=C.useState(a?.from_category_id||Lt),[Q,P]=C.useState(a?.to_category_id||Lt),[k,O]=C.useState(a?.description||""),[N,L]=C.useState(a?.cleared||!1),[U,R]=C.useState(!1),re=K===Lt&&Q===Lt&&(T===Ot&&j===Ot);!re&&U&&R(!1);function V(ge){ge.preventDefault();const Z=parseFloat(E);if(!(isNaN(Z)||Z<=0)&&!(!T||!j||!K||!Q||!b)){if(re){R(!0);return}R(!1),u(Z,T,j,K,Q,b,k.trim()||void 0,N)}}const q=U?c.jsx("div",{style:{background:`color-mix(in srgb, ${oe.error} 15%, transparent)`,border:`1px solid ${oe.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:oe.error,marginTop:"0.5rem"},children:'A transfer must move between real categories or real accounts  not all "No" options.'}):null,ee=(ge,Z,ve,Te)=>c.jsx(wt,{label:Te,htmlFor:ge,children:c.jsx(VT,{id:ge,value:Z,onChange:ve,accounts:t,accountGroups:e,placeholder:Pi,required:!0,showNoAccountOption:!0})}),ne=(ge,Z,ve,Te)=>c.jsx(wt,{label:Te,htmlFor:ge,children:c.jsx(UT,{id:ge,value:Z,onChange:ve,categories:n,categoryGroups:r,placeholder:ba,required:!0,showNoCategoryOption:!0})}),te=c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[c.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),c.jsx(Mr,{id:"transfer-cleared",checked:N,onChange:ge=>L(ge.target.checked)})]}),se=c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),c.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[c.jsx("button",{type:"submit",title:m,style:sz,children:""}),c.jsx("button",{type:"button",onClick:()=>{h()},title:"Cancel",style:az,children:""}),f&&c.jsx("button",{type:"button",onClick:()=>{f()},title:"Delete",style:oz,children:""})]})]}),he=c.jsxs(Ca,{children:[c.jsx(Ie,{type:"submit",actionName:m,children:m}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:h,children:"Cancel"}),f&&c.jsx(Ie,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:f,children:" Delete"})]}),we={fontSize:"0.85rem",padding:"0.5rem"};return g?c.jsx(ms,{actionName:m,onSubmit:V,children:c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[c.jsx(wt,{label:"Date",htmlFor:"transfer-date",children:c.jsx(If,{id:"transfer-date",value:b,onChange:ge=>x(ge.target.value),required:!0,style:we})}),c.jsx(wt,{label:"Amount",htmlFor:"transfer-amount",children:c.jsx(ao,{id:"transfer-amount",value:E,onChange:S,placeholder:"$0.00",required:!0,autoFocus:!0})}),ne("from-category",K,H,"From Category"),ee("from-account",T,D,"From Account"),c.jsx(wt,{label:"Description",htmlFor:"transfer-description",children:c.jsx(ps,{id:"transfer-description",value:k,onChange:ge=>O(ge.target.value),placeholder:"e.g., Transfer",style:we})})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[c.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),c.jsx("div",{}),ne("to-category",Q,P,"To Category"),ee("to-account",j,M,"To Account"),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[te,se]})]}),q]})}):c.jsxs(ms,{actionName:m,onSubmit:V,children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[c.jsx(wt,{label:"Date",htmlFor:"transfer-date",children:c.jsx(If,{id:"transfer-date",value:b,onChange:ge=>x(ge.target.value),required:!0})}),c.jsx(wt,{label:"Amount",htmlFor:"transfer-amount",children:c.jsx(ao,{id:"transfer-amount",value:E,onChange:S,placeholder:"$0.00",required:!0,autoFocus:!0})})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[ne("from-category",K,H,"From Cat."),ee("from-account",T,D,"From Acct.")]}),c.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[ne("to-category",Q,P,"To Cat."),ee("to-account",j,M,"To Acct.")]})]}),c.jsx(wt,{label:"Description (optional)",htmlFor:"transfer-description",children:c.jsx(ps,{id:"transfer-description",value:k,onChange:ge=>O(ge.target.value),placeholder:"e.g., Transfer to savings"})}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx(Mr,{id:"transfer-cleared-stacked",checked:N,onChange:ge=>L(ge.target.checked)}),c.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),q]}),he]})}function lz({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:a,fromAccountGroupName:o,toAccountGroupName:u,isFromCategoryNo:h,isToCategoryNo:f,isFromAccountNo:m,isToAccountNo:g,onEdit:_,onDelete:b,isMobile:x,isEvenRow:E}){const S=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",T=E?"transparent":"rgba(255,255,255,0.04)";if(x)return c.jsxs("div",{onClick:_,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:T,cursor:"pointer",transition:"background 0.15s"},children:[c.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:S}),c.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Ue(t.amount)}),t.cleared&&c.jsx("span",{style:{fontSize:"0.7rem",color:oe.success},title:"Cleared",children:""})]})}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),m?c.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):c.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&c.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),c.jsx("span",{children:r})]})]}),c.jsx("span",{style:{opacity:.5},children:""}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx("span",{style:f?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),g?c.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:a}):c.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[u&&c.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:u}),c.jsx("span",{children:a})]})]})]}),t.description&&c.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const D={padding:"0.6rem 0.5rem",background:T,display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{...D,fontSize:"0.85rem",fontFamily:"monospace"},children:c.jsx("span",{style:{opacity:.6},children:S})}),c.jsx("div",{style:{...D,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Ue(t.amount)}),c.jsx("div",{style:{...D,justifyContent:"center"},children:c.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),c.jsx("div",{style:{...D,overflow:"hidden"},children:m?c.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&c.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),c.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),c.jsx("div",{style:{...D,justifyContent:"center",fontSize:"1rem"},children:c.jsx("span",{style:{opacity:.5},children:""})}),c.jsx("div",{style:{...D,justifyContent:"center"},children:c.jsx("span",{style:f?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),c.jsx("div",{style:{...D,overflow:"hidden"},children:g?c.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:a}):c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[u&&c.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:u}),c.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a})]})}),c.jsx("div",{style:{...D,paddingLeft:"0.5rem",overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),c.jsx("div",{style:{...D,justifyContent:"center",color:t.cleared?oe.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),c.jsxs("div",{style:{...D,justifyContent:"flex-end",gap:"0.25rem"},children:[c.jsx("button",{onClick:_,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:j=>j.currentTarget.style.opacity="1",onMouseLeave:j=>j.currentTarget.style.opacity="0.5",title:"Edit",children:""}),c.jsx("button",{onClick:b,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:j=>j.currentTarget.style.opacity="1",onMouseLeave:j=>j.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Ti={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function cz(){const{selectedBudgetId:t,currentUserId:e,currentYear:n,currentMonthNumber:r,setCurrentYear:a,setCurrentMonthNumber:o}=Pt(),{accounts:u,accountGroups:h,categories:f,categoryGroups:m}=Mn(t,e),{month:g,isLoading:_,addTransfer:b,updateTransfer:x,deleteTransfer:E}=ys(t,n,r),S=Li(),[T,D]=C.useState(null),[j,M]=C.useState(!1),[K,H]=C.useState(null);function Q(R){const Y=R.account_group_id?h[R.account_group_id]:void 0;return Y?.is_active!==void 0?Y.is_active:R.is_active!==!1}function P(R){const Y=R.account_group_id?h[R.account_group_id]:void 0;return Y?.on_budget!==void 0?Y.on_budget:R.on_budget!==!1}const k=Object.entries(u).filter(([,R])=>Q(R)&&P(R));function O(R,Y,W,B,$,G,J,re){D(null),M(!1);const[V,q]=G.split("-").map(Number);b(R,Y,W,B,$,G,J,re).then(()=>{(V!==n||q!==r)&&(a(V),o(q))}).catch(ee=>{D(ee instanceof Error?ee.message:"Failed to add transfer")})}function N(R,Y,W,B,$,G,J,re,V){D(null),H(null),x(R,Y,W,B,$,G,J,re,V).catch(q=>{D(q instanceof Error?q.message:"Failed to update transfer")})}function L(R){confirm("Are you sure you want to delete this transfer?")&&(D(null),E(R).catch(Y=>{D(Y instanceof Error?Y.message:"Failed to delete transfer")}))}const U=k.length>=1&&Object.keys(f).length>=1;return c.jsxs("div",{style:{opacity:_?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:_?"none":"auto"},children:[T&&c.jsx("div",{style:{background:`color-mix(in srgb, ${oe.error} 15%, transparent)`,border:`1px solid ${oe.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:oe.error},children:T}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:S?"block":"grid",gridTemplateColumns:S?void 0:"subgrid"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),c.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!j&&c.jsx(Ie,{actionName:"Open Add Transfer Form",onClick:()=>M(!0),disabled:!U,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!S&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:Ti,children:"Date"}),c.jsx("div",{style:{...Ti,textAlign:"right"},children:"Amount"}),c.jsx("div",{style:{...Ti,textAlign:"center"},children:"From Cat"}),c.jsx("div",{style:Ti,children:"From Acct"}),c.jsx("div",{style:Ti}),c.jsx("div",{style:{...Ti,textAlign:"center"},children:"To Cat"}),c.jsx("div",{style:Ti,children:"To Acct"}),c.jsx("div",{style:Ti,children:"Description"}),c.jsx("div",{style:{...Ti,textAlign:"center"},children:"Clr"}),c.jsx("div",{style:Ti})]})]}),!U&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:["You need at least one account and one category before adding transfers."," ",c.jsx(Bt,{to:"/budget/accounts",style:{opacity:1},children:"Manage accounts "})]}),j&&c.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:c.jsx(Mw,{accounts:k,accountGroups:h,categories:f,categoryGroups:m,defaultDate:`${n}-${String(r).padStart(2,"0")}-01`,onSubmit:O,onCancel:()=>M(!1),submitLabel:"Add Transfer"})}),g?.transfers?.slice().sort((R,Y)=>(R.date||"").localeCompare(Y.date||"")).map((R,Y)=>K===R.id?c.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:c.jsx(Mw,{accounts:k,accountGroups:h,categories:f,categoryGroups:m,initialData:R,onSubmit:(W,B,$,G,J,re,V,q)=>N(R.id,W,B,$,G,J,re,V,q),onCancel:()=>H(null),onDelete:()=>L(R.id),submitLabel:"Save"})},R.id):c.jsx(lz,{transfer:R,fromCategoryName:Je(R.from_category_id)?ba:f[R.from_category_id]?.name||"Unknown",toCategoryName:Je(R.to_category_id)?ba:f[R.to_category_id]?.name||"Unknown",fromAccountName:Pe(R.from_account_id)?Pi:u[R.from_account_id]?.nickname||"Unknown",toAccountName:Pe(R.to_account_id)?Pi:u[R.to_account_id]?.nickname||"Unknown",fromAccountGroupName:Pe(R.from_account_id)?void 0:u[R.from_account_id]?.account_group_id?h[u[R.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:Pe(R.to_account_id)?void 0:u[R.to_account_id]?.account_group_id?h[u[R.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:Je(R.from_category_id),isToCategoryNo:Je(R.to_category_id),isFromAccountNo:Pe(R.from_account_id),isToAccountNo:Pe(R.to_account_id),onEdit:()=>{R.description||`${R.amount}`,H(R.id)},onDelete:()=>L(R.id),isMobile:S,isEvenRow:Y%2===0},R.id)),(!g?.transfers||g.transfers.length===0)&&!j&&c.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function kw({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:a,defaultAccountId:o,defaultDate:u,onSubmit:h,onCancel:f,onDelete:m,submitLabel:g}){function _(b){h(b.amount,b.accountId,b.categoryId,b.date,b.description,b.cleared)}return c.jsx(L0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:[],initialData:a?{date:a.date,categoryId:a.category_id,accountId:a.account_id,amount:a.amount,description:a.description,cleared:a.cleared}:void 0,defaultAccountId:o,defaultDate:u,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:_,onCancel:f,onDelete:m})}function uz({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:a,onDelete:o,isMobile:u,isEvenRow:h}){const f=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,g=h?"transparent":"rgba(255,255,255,0.04)";if(u)return c.jsxs("div",{onClick:a,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:g,cursor:"pointer",transition:"background 0.15s"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:f}),t.cleared&&c.jsx("span",{style:{fontSize:"0.7rem",color:oe.success},title:"Cleared",children:""})]}),c.jsx("span",{style:{fontWeight:600,color:Tt(t.amount),fontFamily:"monospace"},children:pr(t.amount)})]}),c.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[c.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),c.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:m})]})]});const _={padding:"0.6rem 0.5rem",background:g,display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{..._,fontSize:"0.85rem",fontFamily:"monospace"},children:c.jsx("span",{style:{opacity:.6},children:f})}),c.jsx("div",{style:{..._,justifyContent:"center"},children:c.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),c.jsx("div",{style:{..._,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),c.jsx("div",{style:{..._,justifyContent:"flex-end",fontWeight:600,color:Tt(t.amount),fontFamily:"monospace"},children:pr(t.amount)}),c.jsx("div",{style:{..._,paddingLeft:"0.5rem",overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),c.jsx("div",{style:{..._,justifyContent:"center",color:t.cleared?oe.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),c.jsxs("div",{style:{..._,justifyContent:"flex-end",gap:"0.25rem"},children:[c.jsx("button",{onClick:a,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Edit",children:""}),c.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const to={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function dz(){const{selectedBudgetId:t,currentUserId:e,currentYear:n,currentMonthNumber:r,setCurrentYear:a,setCurrentMonthNumber:o}=Pt(),{accounts:u,accountGroups:h,categories:f,categoryGroups:m}=Mn(t,e),{month:g,isLoading:_,addAdjustment:b,updateAdjustment:x,deleteAdjustment:E}=ys(t,n,r),S=Li(),[T,D]=C.useState(null),[j,M]=C.useState(!1),[K,H]=C.useState(null);function Q(U){const R=U.account_group_id?h[U.account_group_id]:void 0;return R?.is_active!==void 0?R.is_active:U.is_active!==!1}function P(U){const R=U.account_group_id?h[U.account_group_id]:void 0;return R?.on_budget!==void 0?R.on_budget:U.on_budget!==!1}const k=Object.entries(u).filter(([,U])=>Q(U)&&P(U));function O(U,R,Y,W,B,$){D(null),M(!1);const[G,J]=W.split("-").map(Number);b(U,R,Y,W,B,$).then(()=>{(G!==n||J!==r)&&(a(G),o(J))}).catch(re=>{D(re instanceof Error?re.message:"Failed to add adjustment")})}function N(U,R,Y,W,B,$,G){D(null),H(null),x(U,R,Y,W,B,$,G).catch(J=>{D(J instanceof Error?J.message:"Failed to update adjustment")})}function L(U){confirm("Are you sure you want to delete this adjustment?")&&(D(null),E(U).catch(R=>{D(R instanceof Error?R.message:"Failed to delete adjustment")}))}return c.jsxs("div",{style:{opacity:_?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:_?"none":"auto"},children:[T&&c.jsx("div",{style:{background:`color-mix(in srgb, ${oe.error} 15%, transparent)`,border:`1px solid ${oe.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:oe.error},children:T}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:S?"block":"grid",gridTemplateColumns:S?void 0:"subgrid"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),c.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!j&&c.jsx(Ie,{actionName:"Open Add Adjustment Form",onClick:()=>M(!0),disabled:Object.keys(f).length===0&&k.length===0,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!S&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:to,children:"Date"}),c.jsx("div",{style:{...to,textAlign:"center"},children:"Category"}),c.jsx("div",{style:to,children:"Account"}),c.jsx("div",{style:{...to,textAlign:"right"},children:"Amount"}),c.jsx("div",{style:to,children:"Description"}),c.jsx("div",{style:{...to,textAlign:"center"},children:"Clr"}),c.jsx("div",{style:to})]})]}),k.length===0&&Object.keys(f).length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:["You need to create at least one account or category before adding adjustments."," ",c.jsx(Bt,{to:"/budget/accounts",style:{opacity:1},children:"Manage accounts "})]}),j&&c.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:c.jsx(kw,{accounts:k,accountGroups:h,categories:f,categoryGroups:m,defaultDate:`${n}-${String(r).padStart(2,"0")}-01`,onSubmit:O,onCancel:()=>M(!1),submitLabel:"Add Adjustment"})}),g?.adjustments?.slice().sort((U,R)=>(U.date||"").localeCompare(R.date||"")).map((U,R)=>K===U.id?c.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:c.jsx(kw,{accounts:k,accountGroups:h,categories:f,categoryGroups:m,initialData:U,onSubmit:(Y,W,B,$,G,J)=>N(U.id,Y,W,B,$,G,J),onCancel:()=>H(null),onDelete:()=>L(U.id),submitLabel:"Save"})},U.id):c.jsx(uz,{adjustment:U,categoryName:Je(U.category_id)?ba:f[U.category_id]?.name||"Unknown Category",accountName:Pe(U.account_id)?Pi:u[U.account_id]?.nickname||"Unknown Account",accountGroupName:Pe(U.account_id)?void 0:u[U.account_id]?.account_group_id?h[u[U.account_id].account_group_id]?.name:void 0,onEdit:()=>{U.description||`${U.amount}`,H(U.id)},onDelete:()=>L(U.id),isMobile:S,isEvenRow:R%2===0},U.id)),(!g?.adjustments||g.adjustments.length===0)&&!j&&c.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function hz({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:a}=nr(),{selectedBudgetId:o,currentYear:u,currentMonthNumber:h}=Pt(),{deleteAllocations:f}=iT(),[m,g]=C.useState(null),_=async()=>{if(o){g(null),r("allocations-delete","Deleting allocations...");try{await f({budgetId:o,year:u,month:h}),e(),n?.()}catch(b){g(b instanceof Error?b.message:"Failed to delete allocations")}finally{a("allocations-delete")}}};return c.jsxs(va,{isOpen:t,onClose:e,title:"Delete Allocations",children:[m&&c.jsx(So,{message:m,onDismiss:()=>g(null)}),c.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),c.jsx(Ie,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:_,children:"Delete Allocations"})]})]})}function HT({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:a,draftChangeAmount:o,availableAfterApply:u,currentDraftTotal:h}){const f=t&&h!==void 0?h:a.allocated;return c.jsxs(c.Fragment,{children:[c.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?c.jsx("span",{style:{color:Tt(n),fontWeight:600},children:Ue(n)}):c.jsxs("span",{style:{color:oe.success,fontWeight:600},children:["+",Ue(r)]})]}),c.jsxs("span",{children:[t&&c.jsx("span",{style:{opacity:.6},children:" "}),c.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),c.jsxs("span",{style:{color:sc(t?f:a.allocated),fontWeight:600,...t?Jr:{}},children:[t?"":"+",Ue(t?f:a.allocated)]}),e&&o!==0&&c.jsxs("span",{style:{fontSize:"0.85em",color:o>0?oe.warning:oe.success,marginLeft:"0.25rem"},children:["(",pr(o),")"]})]}),!t&&c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Spent: "}),c.jsx("span",{style:{color:ic(a.spent),fontWeight:600},children:Ta(a.spent)})]}),c.jsxs("span",{children:[t&&c.jsx("span",{style:{opacity:.6},children:"= "}),c.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?c.jsx("span",{style:{color:Tt(u),fontWeight:600,...Jr},children:Ue(u)}):c.jsx("span",{style:{color:Tt(a.allocated+a.spent),fontWeight:600},children:Ue(a.allocated+a.spent)})]})]})}function fz({totals:t}){return c.jsxs(c.Fragment,{children:[c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Start: "}),c.jsx("span",{style:{color:Tt(t.start),fontWeight:600},children:Ue(t.start)})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Inc: "}),c.jsxs("span",{style:{color:oe.success,fontWeight:600},children:["+",Ue(t.income)]})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Exp: "}),c.jsx("span",{style:{color:ic(t.expenses),fontWeight:600},children:Ta(t.expenses)})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"End: "}),c.jsx("span",{style:{color:Tt(t.end),fontWeight:600},children:Ue(t.end)})]})]})}function B0({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:a,onEdit:o,onCancel:u,onDelete:h}){return c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&c.jsxs(c.Fragment,{children:[c.jsx(Ie,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),c.jsx(Ie,{actionName:"Apply Allocations",onClick:a,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&c.jsx(Ie,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&c.jsxs(c.Fragment,{children:[c.jsx(Ie,{actionName:"Apply Allocations",onClick:a,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),c.jsx(Ie,{actionName:"Cancel Edit Allocations",onClick:u,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),c.jsx(Ie,{actionName:"Open Delete Allocations Modal",onClick:h,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:oe.error},children:""})]})]})}function mz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:a,onAllocationChange:o,projectedAllTime:u}){const h=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,f=h?t.default_monthly_amount/100*r:0,m=h?f.toFixed(2):n,g=a&&!h,_=a?u:t.balance??0,b=t.balance??0,x=b<0,E=x?Math.abs(b):0,S=h?f:parseFloat(n)||0,T=x?Math.min(S,E):0,D=x?Math.max(0,S-E):0,j=x&&S>0&&D>0;return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[c.jsx("div",{style:{marginBottom:"0.5rem"},children:c.jsx("span",{style:{fontWeight:500},children:t.name})}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),c.jsx("span",{style:{color:Dn(e.start_balance)},children:Zr(e.start_balance)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),g?c.jsxs(c.Fragment,{children:[c.jsx("input",{type:"text",inputMode:"decimal",value:m?`$${m}`:"",onChange:M=>{const K=M.target.value.replace(/[^\d.]/g,"");o(K)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),x&&S>0&&c.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[c.jsxs("span",{style:{color:oe.debt,display:"block"},children:[Ue(T),"  debt"]}),j&&c.jsxs("span",{style:{color:oe.success,display:"block"},children:[Ue(D),"  balance"]})]})]}):c.jsx("span",{style:{color:sc(e.allocated)},children:pr(e.allocated)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),c.jsx("span",{style:{color:ic(e.spent)},children:Ta(e.spent)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),c.jsx("span",{style:{color:Dn(e.end_balance),...a&&!h?Jr:{}},children:Zr(e.end_balance)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:a?"Proj. All-Time":"All-Time"}),c.jsx("span",{style:{color:Dn(_),...a&&!h?Jr:{}},children:Zr(_)})]})]}),a&&h&&c.jsx("div",{style:{marginTop:"0.5rem"},children:c.jsxs("span",{style:{fontSize:"0.8rem"},children:[c.jsxs("span",{style:{opacity:.6},children:[Ue(r),"  "]}),c.jsxs("span",{style:{color:oe.success},children:[t.default_monthly_amount,"%"]}),c.jsx("span",{style:{opacity:.6},children:" = "}),c.jsx("span",{style:{color:oe.success},children:Ue(f)})]})})]})}function Ow({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:a,savedAllocations:o,previousMonthIncome:u,isDraftMode:h,onAllocationChange:f,isMobile:m,isUngrouped:g,getAllocationAmount:_}){const b={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Rf,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},x=n.allocated+n.spent,E=e.reduce((S,[T,D])=>{const j=D.balance??0;if(h){const M=_(T,D),K=o[T]??0,H=M-K;return S+j+H}return S+j},0);return c.jsxs("div",{style:{display:"contents"},children:[!m&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{...b,paddingLeft:"0.5rem",opacity:g?.7:1},children:[c.jsx("span",{children:t}),c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),c.jsx("div",{style:{...b,justifyContent:"flex-end",color:Dn(n.start)},children:Fn.showGroupTotals}),c.jsx("div",{style:{...b,justifyContent:h?"center":"flex-end",color:sc(n.allocated)},children:Fn.showGroupTotals}),c.jsx("div",{style:{...b,justifyContent:"flex-end",color:ic(n.spent)},children:Fn.showGroupTotals}),c.jsx("div",{style:{...b,justifyContent:"flex-end",color:Dn(x)},children:Fn.showGroupTotals}),c.jsx("div",{style:{...b,justifyContent:"flex-end",color:Dn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:Fn.showGroupTotals}),c.jsx("div",{style:{...b,justifyContent:"flex-end",color:Dn(E)},children:Fn.showGroupTotals})]}),!h&&m&&c.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Rf,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("span",{style:{fontWeight:600,opacity:g?.7:1},children:[t,c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Fn.showGroupTotals]}),e.map(([S,T],D)=>{const j=r(S);if(!j)return null;const M=T.balance??0;let K=M;if(h){const H=_(S,T),Q=o[S]??0,P=H-Q;K=M+P}return m?c.jsx("div",{style:{gridColumn:"1 / -1"},children:c.jsx(mz,{category:T,balance:j,localAllocation:a[S]||"",previousMonthIncome:u,isDraftMode:h,onAllocationChange:H=>f(S,H),projectedAllTime:K})},S):c.jsx(pz,{category:T,balance:j,localAllocation:a[S]||"",previousMonthIncome:u,isDraftMode:h,onAllocationChange:H=>f(S,H),allTimeBalance:K,isEvenRow:D%2===0},S)})]})}function pz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:a,onAllocationChange:o,allTimeBalance:u,isEvenRow:h}){const f=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,m=f?t.default_monthly_amount/100*r:0,g=f?m.toFixed(2):n,_=t.balance??0,b=_<0,x=b?Math.abs(_):0,E=f?m:parseFloat(n)||0,S=b?Math.min(E,x):0,T=b?Math.max(0,E-x):0,D=b&&E>0&&T>0,j=h?"transparent":"rgba(255,255,255,0.04)",M={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",background:j,display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},K=e.allocated+e.spent;return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",background:j,display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:Dn(e.start_balance)},children:Zr(e.start_balance)}),a?c.jsx("div",{style:{...M,justifyContent:"center",flexDirection:"column",gap:"0.1rem",paddingTop:"0.35rem",paddingBottom:"0.35rem"},children:f?c.jsxs("span",{style:{fontSize:"0.85rem"},children:[c.jsxs("span",{style:{color:oe.success},children:[t.default_monthly_amount,"%"]}),c.jsx("span",{style:{opacity:.5},children:" = "}),c.jsx("span",{style:{color:oe.success},children:Ue(m)})]}):c.jsxs(c.Fragment,{children:[c.jsx("input",{type:"text",inputMode:"decimal",value:g?`$${g}`:"",onChange:H=>{const Q=H.target.value.replace(/[^\d.]/g,"");o(Q)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),b&&E>0&&c.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[c.jsxs("span",{style:{color:oe.debt},children:[Ue(S),"  debt"]}),D&&c.jsxs("span",{style:{color:oe.success},children:[Ue(T),"  bal"]})]})]})}):(()=>{const H=e.start_balance<0,Q=H?Math.abs(e.start_balance):0,P=H?Math.min(e.allocated,Q):0,k=H?Math.max(0,e.allocated-Q):0,O=H&&e.allocated>0;return c.jsxs("div",{style:{...M,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:sc(e.allocated)},children:[c.jsxs("span",{children:["+",Ue(e.allocated)]}),O&&c.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[c.jsxs("span",{style:{color:oe.debt},children:[Ue(P),"  debt"]}),k>0&&c.jsxs("span",{style:{color:oe.success},children:[Ue(k),"  bal"]})]})]})})(),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:ic(e.spent)},children:Ta(e.spent)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:Dn(K),...a&&!f?Jr:{}},children:pr(K)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",fontWeight:600,color:Dn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...a&&!f?Jr:{}},children:Zr(e.end_balance)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:Dn(u),...a&&!f?Jr:{}},children:Zr(u)})]})}function gz(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,a])=>n||!a.is_hidden).reduce((a,[o,u])=>{const h=u.category_group_id||"ungrouped";return a[h]||(a[h]=[]),a[h].push([o,u]),a},{});return Object.keys(r).forEach(a=>{r[a].sort((o,u)=>o[1].sort_order-u[1].sort_order)}),r}function yz(t,e,n,r,a){const o={};t?.category_balances&&t.category_balances.forEach(h=>{o[h.category_id]=h});const u={};return Object.entries(e).forEach(([h,f])=>{const m=o[h],g=m?.start_balance??0,_=m?.spent??0;let b=0;n?b=a(h,f):r&&m&&(b=m.allocated),u[h]={category_id:h,start_balance:g,allocated:b,spent:_,end_balance:g+b+_}}),u}function _z(t,e){const n={};t?.account_balances&&t.account_balances.forEach(a=>{n[a.account_id]=a});const r={};return Object.entries(e).forEach(([a,o])=>{const h=n[a]?.start_balance??o.balance;let f=0;t?.income&&(f=t.income.filter(_=>_.account_id===a).reduce((_,b)=>_+b.amount,0));let m=0;t?.expenses&&(m=t.expenses.filter(_=>_.account_id===a).reduce((_,b)=>_+b.amount,0));const g=f+m;r[a]={account_id:a,start_balance:h,income:f,expenses:m,net_change:g,end_balance:h+g}}),r}function bz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,netChange:0,end:0})}function vz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,end:e.end+n.end_balance}),{start:0,allocated:0,spent:0,end:0})}function xz({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:a,onApply:o,onEdit:u,onCancel:h,onDelete:f}){const m={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},g=n.allocated+n.spent;return c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{...m,gap:"0.75rem"},children:["Grand Totals",!t&&c.jsx(B0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:a,onApply:o,onEdit:u,onCancel:h,onDelete:f})]}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:Dn(n.start)},children:Zr(n.start)}),c.jsxs("div",{style:{...m,justifyContent:t?"center":"flex-end",color:sc(n.allocated),...t?Jr:{}},children:["+",Ue(n.allocated)]}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:ic(n.spent)},children:Ta(n.spent)}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:Dn(g),...t?Jr:{}},children:pr(g)}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:Dn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...t?Jr:{}},children:Zr(n.end)}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:Dn(r),...t?Jr:{}},children:Zr(r)})]})}function Sz({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:a,availableAfterApply:o,currentDraftTotal:u,onSave:h,onApply:f,onEdit:m,onCancel:g,onDelete:_}){return c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[c.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),c.jsx(HT,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:a,availableAfterApply:o,currentDraftTotal:u}),c.jsx(B0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:h,onApply:f,onEdit:m,onCancel:g,onDelete:_})]})}const no={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function wz(t){if(!t)return"";switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}}function Ez(){const{selectedBudgetId:t,currentUserId:e,currentYear:n,currentMonthNumber:r}=Pt(),{categories:a,categoryGroups:o,monthMap:u}=Mn(t,e),{month:h}=ys(t,n,r),f=Li(),m=It(n,r),g=u[m]?.needs_recalculation===!0,_=C.useRef(!1),[b,x]=C.useState(null);C.useEffect(()=>{!t||!h||!g||_.current||(_.current=!0,`${n}${String(r).padStart(2,"0")}`,cm(t,{onProgress:se=>x(se)}).then(()=>{Qe.invalidateQueries({queryKey:Se.month(t,n,r)})}).catch(se=>{console.error("[MonthCategories] Recalculation failed:",se)}).finally(()=>{_.current=!1,x(null)}))},[t,g,h,n,r]);const[E,S]=C.useState(!1),{localAllocations:T,isEditingAppliedAllocations:D,error:j,availableNow:M,currentDraftTotal:K,draftChangeAmount:H,availableAfterApply:Q,previousMonthIncome:P,currentMonthIncome:k,allocationsFinalized:O,getAllocationAmount:N,handleAllocationChange:L,resetAllocationsToSaved:U,handleSaveAllocations:R,handleFinalizeAllocations:Y,setIsEditingAppliedAllocations:W,setError:B}=SL(),$=[...o].sort((se,he)=>se.sort_order-he.sort_order),G=C.useMemo(()=>gz(a),[a]),J=!O||D,re=C.useMemo(()=>yz(h,a,J,O,N),[h,a,J,O,N]),V=se=>re[se],q=C.useMemo(()=>vz(re),[re]),ee=C.useMemo(()=>{const se={};if(h?.category_balances)for(const he of h.category_balances)se[he.category_id]=he.allocated;return se},[h]),ne=C.useMemo(()=>Object.entries(a).reduce((se,[he,we])=>{const ge=we.balance??0;if(J){const Z=N(he,we),ve=ee[he]??0,Te=Z-ve;return se+ge+Te}return se+ge},0),[a,J,N,ee]),te={onSave:R,onApply:Y,onEdit:()=>W(!0),onCancel:U,onDelete:()=>S(!0)};return c.jsxs(c.Fragment,{children:[b&&c.jsxs(nd,{message:wz(b),spinnerColor:"#22c55e",children:[c.jsx(mm,{percent:b.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),c.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(b.totalMonthsToFetch??0)>0&&c.jsx(xn,{value:`${b.monthsFetched||0}/${b.totalMonthsToFetch}`,label:"Months Loaded",color:b.phase==="fetching-months"?"#22c55e":"#6b7280"}),(b.totalMonths??0)>0&&c.jsx(xn,{value:`${b.monthsProcessed}/${b.totalMonths}`,label:"Months Recalculated",color:b.phase==="recalculating"?"#22c55e":"#6b7280"})]}),c.jsx(pm,{percent:b.percentComplete})]}),j&&c.jsx(So,{message:j,onDismiss:()=>B(null)}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:f?"1fr":J?"2fr 1fr 200px 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:f?"block":"grid",gridTemplateColumns:f?void 0:"subgrid"},children:[J&&c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:f?"column":"row",flexWrap:"wrap",alignItems:f?"stretch":"center",gap:f?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:f?"0.5rem":"0.25rem"},children:[c.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:f?void 0:1,alignItems:"center"},children:c.jsx(HT,{isDraftMode:J,isEditingAppliedAllocations:D,availableNow:M,currentMonthIncome:k,balanceTotals:q,draftChangeAmount:H,availableAfterApply:Q,currentDraftTotal:K})}),c.jsx(B0,{isDraftMode:J,isEditingAppliedAllocations:D,allocationsFinalized:O,...te})]}),!f&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:no,children:"Category"}),c.jsx("div",{style:{...no,textAlign:"right"},children:"Start"}),c.jsx("div",{style:{...no,textAlign:J?"center":"right"},children:"Allocated"}),c.jsx("div",{style:{...no,textAlign:"right"},children:"Spent"}),c.jsx("div",{style:{...no,textAlign:"right"},children:"Net Change"}),c.jsx("div",{style:{...no,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),c.jsx("div",{style:{...no,textAlign:"right"},children:"All-Time"})]}),!f&&c.jsx(xz,{isDraftMode:J,allocationsFinalized:O,balanceTotals:q,grandAllTime:ne,...te}),!J&&f&&c.jsx(Sz,{allocationsFinalized:O,availableNow:M,currentMonthIncome:k,balanceTotals:q,draftChangeAmount:H,availableAfterApply:Q,currentDraftTotal:K,...te})]}),Object.keys(a).length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",c.jsx(Bt,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),$.map(se=>{const he=G[se.id]||[];if(he.length===0)return null;const we=he.reduce((ge,[Z])=>{const ve=V(Z);return ve?{start:ge.start+ve.start_balance,allocated:ge.allocated+ve.allocated,spent:ge.spent+ve.spent,end:ge.end+ve.end_balance}:ge},{start:0,allocated:0,spent:0,end:0});return c.jsx(Ow,{name:se.name,categories:he,groupTotals:we,getCategoryBalance:V,localAllocations:T,savedAllocations:ee,previousMonthIncome:P,isDraftMode:J,onAllocationChange:L,isMobile:f,getAllocationAmount:N},se.id)}),G.ungrouped?.length>0&&(()=>{const se=G.ungrouped,he=se.reduce((we,[ge])=>{const Z=V(ge);return Z?{start:we.start+Z.start_balance,allocated:we.allocated+Z.allocated,spent:we.spent+Z.spent,end:we.end+Z.end_balance}:we},{start:0,allocated:0,spent:0,end:0});return c.jsx(Ow,{name:"Uncategorized",categories:se,groupTotals:he,getCategoryBalance:V,localAllocations:T,savedAllocations:ee,previousMonthIncome:P,isDraftMode:J,onAllocationChange:L,isMobile:f,isUngrouped:!0,getAllocationAmount:N},"ungrouped")})(),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),c.jsx(hz,{isOpen:E,onClose:()=>S(!1),onDeleted:()=>W(!1)})]})}function GT(t){return t===0?oe.zero:t>0?oe.success:oe.error}function QT(t){return t===0?oe.zero:t<0?oe.error:oe.success}function WT(t){return t===0?oe.zero:t>0?oe.success:oe.error}function Nw({name:t,accounts:e,groupTotals:n,accountBalances:r,isMobile:a,isUngrouped:o}){const u={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Rf,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return c.jsxs("div",{style:{display:"contents"},children:[!a&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{...u,opacity:o?.7:1},children:[c.jsx("span",{children:t}),c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:Tt(n.start)},children:Fn.showGroupTotals}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:GT(n.income)},children:Fn.showGroupTotals}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:QT(n.expenses)},children:Fn.showGroupTotals}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:WT(n.netChange)},children:Fn.showGroupTotals}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:Tt(n.end)},children:Fn.showGroupTotals})]}),a&&c.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Rf,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("span",{style:{fontWeight:600,opacity:o?.7:1},children:[t,c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Fn.showGroupTotals]}),e.map(([h,f],m)=>{const g=r[h];return g?a?c.jsx("div",{style:{gridColumn:"1 / -1"},children:c.jsx(Tz,{account:f,balance:g})},h):c.jsx(Cz,{account:f,balance:g,isEvenRow:m%2===0},h):null})]})}function Cz({account:t,balance:e,isEvenRow:n}){const a={padding:"0.5rem 0.5rem",background:n?"transparent":"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{...a,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),c.jsx("div",{style:{...a,justifyContent:"flex-end",color:Tt(e.start_balance)},children:Ue(e.start_balance)}),c.jsxs("div",{style:{...a,justifyContent:"flex-end",color:GT(e.income)},children:["+",Ue(e.income)]}),c.jsx("div",{style:{...a,justifyContent:"flex-end",color:QT(e.expenses)},children:Ta(e.expenses)}),c.jsx("div",{style:{...a,justifyContent:"flex-end",color:WT(e.net_change)},children:pr(e.net_change)}),c.jsx("div",{style:{...a,justifyContent:"flex-end",fontWeight:600,color:Tt(e.end_balance)},children:Ue(e.end_balance)})]})}function Tz({account:t,balance:e}){return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[c.jsx("div",{style:{marginBottom:"0.5rem"},children:c.jsx("span",{style:{fontWeight:500},children:t.nickname})}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),c.jsx("span",{children:Ue(e.start_balance)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),c.jsx("span",{style:{color:Tt(e.net_change)},children:pr(e.net_change)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),c.jsx("span",{style:{color:Tt(e.end_balance)},children:Ue(e.end_balance)})]})]}),(e.income!==0||e.expenses!==0)&&c.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",gap:"1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&c.jsxs("span",{children:[pr(e.income)," income"]}),e.expenses!==0&&c.jsxs("span",{children:[Ta(e.expenses)," expenses"]})]})]})}const hl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function Az(t){return t===0?oe.zero:t>0?oe.success:oe.error}function jz(t){return t===0?oe.zero:t<0?oe.error:oe.success}function Rz(t){return t===0?oe.zero:t>0?oe.success:oe.error}function Dz(){const{selectedBudgetId:t,currentUserId:e,currentYear:n,currentMonthNumber:r}=Pt(),{accounts:a,accountGroups:o,monthMap:u}=Mn(t,e),{month:h}=ys(t,n,r),f=Li(),m=It(n,r),g=u[m]?.needs_recalculation===!0,_=C.useRef(!1),[b,x]=C.useState(null);C.useEffect(()=>{!t||!h||!g||_.current||(_.current=!0,`${n}${String(r).padStart(2,"0")}`,cm(t,{onProgress:Q=>x(Q)}).then(()=>{Qe.invalidateQueries({queryKey:Se.month(t,n,r)})}).catch(Q=>{console.error("[MonthAccounts] Recalculation failed:",Q)}).finally(()=>{_.current=!1,x(null)}))},[t,g,h,n,r]);const E=C.useMemo(()=>Object.entries(o).map(([Q,P])=>({id:Q,...P})).sort((Q,P)=>Q.sort_order-P.sort_order),[o]),S=C.useMemo(()=>{const Q={};return Object.entries(a).filter(([,P])=>!P.is_hidden).forEach(([P,k])=>{const O=k.account_group_id||"ungrouped";Q[O]||(Q[O]=[]),Q[O].push([P,k])}),Object.keys(Q).forEach(P=>{Q[P].sort((k,O)=>k[1].sort_order-O[1].sort_order)}),Q},[a]),T=C.useMemo(()=>_z(h,a),[h,a]),D=C.useMemo(()=>bz(T),[T]),j=D.income+D.expenses,K={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600},H=()=>{if(!b)return"";switch(b.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return b.currentMonth?`Recalculating ${b.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}};return c.jsxs(c.Fragment,{children:[b&&c.jsxs(nd,{message:H(),spinnerColor:"#22c55e",children:[c.jsx(mm,{percent:b.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),c.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(b.totalMonthsToFetch??0)>0&&c.jsx(xn,{value:`${b.monthsFetched||0}/${b.totalMonthsToFetch}`,label:"Months Loaded",color:b.phase==="fetching-months"?"#22c55e":"#6b7280"}),(b.totalMonths??0)>0&&c.jsx(xn,{value:`${b.monthsProcessed}/${b.totalMonths}`,label:"Months Recalculated",color:b.phase==="recalculating"?"#22c55e":"#6b7280"})]}),c.jsx(pm,{percent:b.percentComplete})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:f?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:f?"block":"grid",gridTemplateColumns:f?void 0:"subgrid"},children:[!f&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:hl,children:"Account"}),c.jsx("div",{style:{...hl,textAlign:"right"},children:"Start"}),c.jsx("div",{style:{...hl,textAlign:"right"},children:"Income"}),c.jsx("div",{style:{...hl,textAlign:"right"},children:"Expenses"}),c.jsx("div",{style:{...hl,textAlign:"right"},children:"Net Change"}),c.jsx("div",{style:{...hl,textAlign:"right"},children:"End"})]}),f?c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[c.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),c.jsx(fz,{totals:D})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{style:{...K},children:"Grand Totals"}),c.jsx("div",{style:{...K,justifyContent:"flex-end",color:Tt(D.start)},children:Ue(D.start)}),c.jsxs("div",{style:{...K,justifyContent:"flex-end",color:Az(D.income)},children:["+",Ue(D.income)]}),c.jsx("div",{style:{...K,justifyContent:"flex-end",color:jz(D.expenses)},children:Ta(D.expenses)}),c.jsx("div",{style:{...K,justifyContent:"flex-end",color:Rz(j)},children:pr(j)}),c.jsx("div",{style:{...K,justifyContent:"flex-end",color:Tt(D.end)},children:Ue(D.end)})]})]}),Object.keys(a).length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",c.jsx(Bt,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),E.map(Q=>{const P=S[Q.id]||[];if(P.length===0)return null;const k=P.reduce((O,[N])=>{const L=T[N];return L?{start:O.start+L.start_balance,income:O.income+L.income,expenses:O.expenses+L.expenses,netChange:O.netChange+L.net_change,end:O.end+L.end_balance}:O},{start:0,income:0,expenses:0,netChange:0,end:0});return c.jsx(Nw,{name:Q.name,accounts:P,groupTotals:k,accountBalances:T,isMobile:f},Q.id)}),S.ungrouped?.length>0&&(()=>{const Q=S.ungrouped,P=Q.reduce((k,[O])=>{const N=T[O];return N?{start:k.start+N.start_balance,income:k.income+N.income,expenses:k.expenses+N.expenses,netChange:k.netChange+N.net_change,end:k.end+N.end_balance}:k},{start:0,income:0,expenses:0,netChange:0,end:0});return c.jsx(Nw,{name:"Ungrouped",accounts:Q,groupTotals:P,accountBalances:T,isMobile:f,isUngrouped:!0},"ungrouped")})(),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const Iz=["income","categories","accounts","spend","transfers","adjustments"];function Pw(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&Iz.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function Mz(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function Lw(){const t=CR(),e=Bu(),[n,r]=g5(),{addLoadingHold:a,removeLoadingHold:o}=nr(),{currentUserId:u,selectedBudgetId:h,currentYear:f,currentMonthNumber:m,lastActiveTab:g,setCurrentYear:_,setCurrentMonthNumber:b,setLastActiveTab:x,setPageTitle:E,goToPreviousMonth:S,goToNextMonth:T,hasPendingInvites:D,pendingInvites:j,needsFirstBudget:M}=Pt(),{budget:K,isLoading:H,createBudget:Q,acceptInvite:P}=Mn(h,u),k=!H,[O,N]=C.useState(!1);C.useEffect(()=>(k||a("budget-data","Loading budget data..."),()=>o("budget-data")),[k,a,o]);const L=C.useRef(!1),U=n.get("error"),[R,Y]=C.useState(U);C.useEffect(()=>{U&&(n.delete("error"),r(n,{replace:!0}))},[U,n,r]);const[W,B]=C.useState(()=>{const{tab:te}=Pw(t);return te??g}),$=te=>{B(te),x(te)};C.useEffect(()=>{if(L.current)return;const{year:te,month:se}=Pw(t);te&&_(te),se&&b(se),L.current=!0},[t,_,b]),C.useEffect(()=>{if(!L.current)return;const te=`/budget/${f}/${m}/${W}`,se=`/budget/${t.year}/${t.month}/${t.tab}`;te!==se&&e(te,{replace:!0})},[f,m,W,e,t]);const{month:G,error:J,isLoading:re}=ys(k?h:null,f,m);C.useEffect(()=>{if(!J||O)return;const te=J.message||"";(te.includes("months in the past")||te.includes("Refusing to create month"))&&queueMicrotask(()=>{a("month-redirect","Redirecting to current month..."),N(!0);const{year:se,month:he}=Mz();Y(`Cannot create month ${f}/${m} - it's too far in the past. Redirected to current month.`),_(se),b(he)})},[J,O,f,m,_,b,a]),C.useEffect(()=>{O&&G&&!re&&queueMicrotask(()=>{N(!1),o("month-redirect")})},[O,G,re,o]),C.useLayoutEffect(()=>{E(K?.name||"Budget")},[K?.name,E]);async function V(te){try{await P(te)}catch(se){Y(se instanceof Error?se.message:"Failed to accept invite")}}async function q(te){try{await Q(te||"My Budget")}catch(se){Y(se instanceof Error?se.message:"Failed to create budget")}}if(!K&&D)return c.jsx(LB,{invites:j,onAccept:V,onCreateNew:q});if(!K&&M)return c.jsx(PB,{onCreateNew:q});if(!k||O)return null;function ee(){Y(null),S()}function ne(){Y(null),T()}return c.jsxs(c.Fragment,{children:[R&&c.jsx(So,{message:R,onDismiss:()=>Y(null)}),c.jsx(XB,{onPreviousMonth:ee,onNextMonth:ne}),c.jsx(UB,{activeTab:W,setActiveTab:$,allocationsFinalized:G?.are_allocations_finalized}),W==="income"&&c.jsx(nz,{},`${f}-${m}`),W==="categories"&&c.jsx(Ez,{},`${f}-${m}`),W==="accounts"&&c.jsx(Dz,{},`${f}-${m}`),W==="spend"&&c.jsx(iz,{},`${f}-${m}`),W==="transfers"&&c.jsx(cz,{},`${f}-${m}`),W==="adjustments"&&c.jsx(dz,{},`${f}-${m}`)]})}function kz(){const{setPageTitle:t}=Pt();return C.useLayoutEffect(()=>{t("Analytics")},[t]),c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[c.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),c.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),c.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),c.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),c.jsx(Bt,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:oe.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function Oz({message:t,onDismiss:e}){return c.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:t}),c.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function Nz({message:t,onDismiss:e}){return c.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:t}),c.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function Pz({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:a,onCheckInvite:o,onAcceptInvite:u,onCancel:h}){return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[c.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Join Budget by ID"]}),c.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?c.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[c.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[c.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&c.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[c.jsx("button",{onClick:u,disabled:a===r.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:a===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:a===r.budgetId?.7:1},children:a===r.budgetId?"Accepting...":"Accept Invitation"}),c.jsx("button",{onClick:h,disabled:a===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:a===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:a===r.budgetId?.7:.8},children:"Cancel"})]})]}):c.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[c.jsx("input",{type:"text",value:t,onChange:f=>e(f.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),c.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function Lz({currentUserId:t}){return c.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[c.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),c.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function Bz(){const{addLoadingHold:t,removeLoadingHold:e}=nr(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:a,loadAccessibleBudgets:o,switchToBudget:u,checkBudgetInvite:h,isInitialized:f,setPageTitle:m}=Pt();C.useLayoutEffect(()=>{m("My Budgets")},[m]),C.useEffect(()=>{f&&o()},[f,o]);const{budget:g,renameBudget:_,acceptInvite:b,isLoading:x}=Mn(n,r),[E,S]=C.useState(null),[T,D]=C.useState(null),[j,M]=C.useState(null),[K,H]=C.useState(null),[Q,P]=C.useState(null),[k,O]=C.useState(""),[N,L]=C.useState(!1),[U,R]=C.useState(""),[Y,W]=C.useState(!1),[B,$]=C.useState(null);async function G(se){if(se!==g?.id){S(se),M(null),H(null);try{await u(se),H("Switched to budget successfully!"),await o()}catch(he){M(he instanceof Error?he.message:"Failed to switch budget")}finally{S(null)}}}async function J(se){D(se),M(null),H(null);try{await b(se),H("Invitation accepted! You now have access to this budget."),await o()}catch(he){M(he instanceof Error?he.message:"Failed to accept invitation")}finally{D(null)}}async function re(se){if(se.preventDefault(),!!U.trim()){W(!0),M(null),$(null);try{const he=await h(U.trim());he?$(he):M("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(he){M(he instanceof Error?he.message:"Failed to check invitation")}finally{W(!1)}}}async function V(){if(B){B.budgetName,D(B.budgetId),M(null);try{await b(B.budgetId),H(`Successfully joined "${B.budgetName}"!`),$(null),R(""),await o()}catch(se){M(se instanceof Error?se.message:"Failed to accept invitation")}finally{D(null)}}}function q(se,he){O(he),P(se)}async function ee(se){if(se.preventDefault(),!(!k.trim()||!Q)){k.trim(),L(!0),M(null),H(null);try{await _(k.trim()),H("Budget renamed successfully!"),P(null),await o()}catch(he){M(he instanceof Error?he.message:"Failed to rename budget")}finally{L(!1)}}}const ne=a.filter(se=>!se.isPending),te=a.filter(se=>se.isPending);return C.useEffect(()=>(x||!f?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[x,f,t,e]),x||!f?null:c.jsxs("div",{children:[c.jsx("h1",{children:"My Budgets"}),c.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Switch between budgets, accept invitations, or join a budget by ID."}),j&&c.jsx(Oz,{message:j,onDismiss:()=>M(null)}),K&&c.jsx(Nz,{message:K,onDismiss:()=>H(null)}),te.length>0&&c.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Pending Invitations (",te.length,")"]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:te.map(se=>c.jsx(Ew,{budget:se,isCurrent:!1,isAccepting:T===se.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>J(se.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},se.id))})]}),c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Your Budgets (",ne.length,")"]}),ne.length===0?c.jsx("p",{style:{opacity:.6,margin:0},children:"You don't have access to any budgets yet."}):c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:ne.map(se=>c.jsx(Ew,{budget:se,isCurrent:se.id===g?.id,isAccepting:!1,isSwitching:E===se.id,isEditing:Q===se.id,editName:Q===se.id?k:"",isRenaming:N,onAccept:()=>{},onSwitch:()=>G(se.id),onStartEdit:()=>q(se.id,se.name),onCancelEdit:()=>{P(null),O("")},onEditNameChange:O,onSaveEdit:ee},se.id))})]}),c.jsx(Pz,{budgetIdInput:U,setBudgetIdInput:R,isCheckingManual:Y,manualInvite:B,isAccepting:T,onCheckInvite:re,onAcceptInvite:V,onCancel:()=>{$(null),R("")}}),r&&c.jsx(Lz,{currentUserId:r})]})}const zz=["accounts","categories","users"];function Uz(){const{addLoadingHold:t,removeLoadingHold:e}=nr(),{selectedBudgetId:n,currentUserId:r,lastSettingsTab:a,setLastSettingsTab:o,setPageTitle:u}=Pt();C.useLayoutEffect(()=>{u("Budget Settings")},[u]);const{isOwner:h,isLoading:f}=Mn(n,r);C.useEffect(()=>(f?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[f,t,e]);const m=Bn(),g=m.pathname==="/budget/settings",_=C.useMemo(()=>{const T=m.pathname;return T.includes("/settings/accounts")?"accounts":T.includes("/settings/categories")?"categories":T.includes("/settings/users")?"users":"categories"},[m.pathname]),b=_==="users";C.useEffect(()=>{g||o(_)},[_,g,o]);function x(){return!zz.includes(a)||a==="users"&&!h?"categories":a}const E=C.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!h}],[h]);return f?null:!h&&b?c.jsxs("div",{children:[c.jsx("h1",{children:"Access Denied"}),c.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),c.jsx("p",{style:{marginTop:"1rem"},children:c.jsx(Bt,{to:"/budget/settings/categories",children:"Go to Categories "})})]}):c.jsxs("div",{children:[c.jsx(Mf,{mode:"link",linkPrefix:"/budget/settings",tabs:E,activeTab:g?x():_}),g?c.jsx(Of,{to:`/budget/settings/${x()}`,replace:!0}):c.jsx(qT,{children:c.jsx(Nf,{})})]})}function Nu({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:a,showGroupSelector:o=!1,showIncomeSettings:u=!1,hasExistingIncomeDefault:h=!1,hasExistingOutgoDefault:f=!1,currentGroupId:m}){const[g,_]=C.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),b=g.account_group_id||m,x=b?a.find(M=>M.id===b):null,E=x?.is_active!==void 0,S=x?.on_budget!==void 0;function T(M){M.preventDefault(),g.nickname.trim()&&e(g)}function D(M){_({...g,is_income_account:M,is_income_default:M?g.is_income_default:!1})}function j(M){_({...g,is_outgo_account:M,is_outgo_default:M?g.is_outgo_default:!1})}return c.jsxs(ms,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:T,children:[c.jsx(wt,{label:"Account Nickname",htmlFor:"account-nickname",children:c.jsx(ps,{id:"account-nickname",type:"text",value:g.nickname,onChange:M=>_({...g,nickname:M.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&c.jsx(wt,{label:"Account Type",htmlFor:"account-group",children:c.jsxs(Ou,{id:"account-group",value:g.account_group_id||"ungrouped",onChange:M=>_({...g,account_group_id:M.target.value==="ungrouped"?null:M.target.value}),children:[c.jsx("option",{value:"ungrouped",children:"Ungrouped"}),a.map(M=>c.jsx("option",{value:M.id,children:M.name},M.id))]})}),u&&c.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx(Mr,{id:"is-active",checked:E?x.is_active:g.is_active!==!1,onChange:M=>_({...g,is_active:M.target.checked}),disabled:E,children:c.jsx("span",{style:{opacity:E?.5:1},children:"Active account"})}),E&&c.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:oe.warning},children:['Set by account type "',x.name,'"']})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx(Mr,{id:"on-budget",checked:S?x.on_budget:g.on_budget!==!1,onChange:M=>_({...g,on_budget:M.target.checked}),disabled:S,children:c.jsx("span",{style:{opacity:S?.5:1},children:"On budget (affects budget totals)"})}),S&&c.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:oe.warning},children:['Set by account type "',x.name,'"']})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx(Mr,{id:"is-hidden",checked:g.is_hidden||!1,onChange:M=>_({...g,is_hidden:M.target.checked}),children:"Hidden account"}),c.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),c.jsx(Mr,{id:"is-income-account",checked:g.is_income_account||!1,onChange:M=>D(M.target.checked),children:"Show in income deposit list"}),g.is_income_account&&c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[c.jsx(Mr,{id:"is-income-default",checked:g.is_income_default||!1,onChange:M=>_({...g,is_income_default:M.target.checked}),disabled:h&&!t?.is_income_default,children:"Default account for new income"}),h&&!t?.is_income_default&&c.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),c.jsx(Mr,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:M=>j(M.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[c.jsx(Mr,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:M=>_({...g,is_outgo_default:M.target.checked}),disabled:f&&!t?.is_outgo_default,children:"Default account for new expenses"}),f&&!t?.is_outgo_default&&c.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),c.jsxs(Ca,{children:[c.jsx(Ie,{type:"submit",actionName:r,children:r}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"})]})]})}function Bw({label:t,value:e,onChange:n,trueLabel:r,falseLabel:a,undefinedLabel:o}){function u(){n(e===void 0?!0:e===!0?!1:void 0)}const h=e===!0?r:e===!1?a:o,f=e===!0?oe.success:e===!1?oe.warning:"inherit",m=e===!0?"":e===!1?"":"";return c.jsxs("button",{type:"button",onClick:u,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${f} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${f} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[c.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?f:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:m}),c.jsxs("span",{style:{flex:1},children:[c.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",c.jsx("span",{style:{fontWeight:500,color:f},children:h})]}),c.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function KT({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[a,o]=C.useState(t||{name:"",expected_balance:"positive"});function u(h){h.preventDefault(),a.name.trim()&&e(a)}return c.jsxs(ms,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:u,children:[c.jsx(wt,{label:"Account Type Name",htmlFor:"group-name",children:c.jsx(ps,{id:"group-name",type:"text",value:a.name,onChange:h=>o({...a,name:h.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),c.jsx(wt,{label:"Expected Balance",htmlFor:"expected-balance",children:c.jsxs(Ou,{id:"expected-balance",value:a.expected_balance,onChange:h=>o({...a,expected_balance:h.target.value}),children:[c.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),c.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),c.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),c.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",c.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),c.jsx(Bw,{label:"Active status",value:a.is_active,onChange:h=>o({...a,is_active:h}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),c.jsx(Bw,{label:"Budget status",value:a.on_budget,onChange:h=>o({...a,on_budget:h}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),c.jsxs(Ca,{children:[c.jsx(Ie,{type:"submit",actionName:r,children:r}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function fl({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${oe.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${oe.success} 40%, transparent)`,color:oe.success,opacity:1},warning:{background:`color-mix(in srgb, ${oe.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${oe.warning} 35%, transparent)`,color:oe.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${oe.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${oe.success} 25%, transparent)`,color:oe.success,opacity:.7},expense:{background:`color-mix(in srgb, ${oe.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${oe.warning} 25%, transparent)`,color:oe.warning,opacity:.7}}[n];return c.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[c.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function YT({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(u=>u.id===t.account_group_id):null,a=r?.is_active!==void 0?r.is_active:t.is_active!==!1,o=r?.on_budget!==void 0?r.on_budget:t.on_budget!==!1;if(!a){const u=r?.is_active!==void 0;n.push(c.jsx(fl,{icon:"",label:u?"Inactive (type)":"Inactive",variant:"warning",title:u?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const u=r?.on_budget!==void 0;n.push(c.jsx(fl,{icon:"",label:u?"Off Budget (type)":"Off Budget",variant:"warning",title:u?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(c.jsx(fl,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(c.jsx(fl,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(c.jsx(fl,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(c.jsx(fl,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:c.jsx(c.Fragment,{children:n})}function Vz({group:t}){const e=[];return t.is_active===!1?e.push(c.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${oe.warning} 20%, transparent)`,color:oe.warning,whiteSpace:"nowrap"},title:"All accounts in this type are inactive",children:"All Inactive"},"inactive")):t.is_active===!0&&e.push(c.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${oe.success} 20%, transparent)`,color:oe.success,whiteSpace:"nowrap"},title:"All accounts in this type are active",children:"All Active"},"active")),t.on_budget===!1?e.push(c.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${oe.warning} 20%, transparent)`,color:oe.warning,whiteSpace:"nowrap"},title:"All accounts in this type are off budget",children:"All Off Budget"},"off-budget")):t.on_budget===!0&&e.push(c.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${oe.success} 20%, transparent)`,color:oe.success,whiteSpace:"nowrap"},title:"All accounts in this type are on budget",children:"All On Budget"},"on-budget")),e.length===0?null:c.jsx(c.Fragment,{children:e})}function XT({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r}){return c.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[c.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:oe.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&c.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function Fz({group:t,accountCount:e,groupTotal:n,canMoveUp:r,canMoveDown:a,isMobile:o,createForGroupId:u,onEdit:h,onDelete:f,onMoveUp:m,onMoveDown:g,onAddAccount:_}){return c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:o?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:o?"wrap":"nowrap"},children:[c.jsxs("h3",{style:{...fm,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0,flexWrap:"wrap"},children:[!o&&c.jsx("span",{style:{cursor:"grab",opacity:.4},children:""}),c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:t.name}),c.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]}),Fn.showGroupTotals,c.jsx(Vz,{group:t})]}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!o&&c.jsx(Ie,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:_,disabled:u!==null,children:"+ Account"}),c.jsx("button",{onClick:()=>{t.name,h()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),c.jsx("button",{onClick:()=>{t.name,f()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),c.jsxs("div",{style:R0,children:[c.jsx("button",{onClick:m,disabled:!r,style:{...Bl,opacity:r?.6:.2,cursor:r?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),c.jsx("button",{onClick:g,disabled:!a,style:{...Bl,opacity:a?.6:.2,cursor:a?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})}function $z(t,e){return!e||e==="any"||t===0?!1:e==="positive"&&t<0||e==="negative"&&t>0}function qz(t,e){return!e||e==="any"||t===0?null:e==="positive"&&t<0?"Unexpected negative balance":e==="negative"&&t>0?"Unexpected positive balance (credit owed to you?)":null}function Hz({group:t,groupIndex:e,totalGroups:n,accounts:r,allGroups:a,allAccounts:o,editingAccountId:u,editingGroupId:h,createForGroupId:f,setEditingAccountId:m,setEditingGroupId:g,setCreateForGroupId:_,dragType:b,draggedId:x,dragOverId:E,dragOverGroupId:S,setDragOverId:T,setDragOverGroupId:D,onAccountDragStart:j,onAccountDragOver:M,onAccountDrop:K,onGroupDragStart:H,onGroupDragOver:Q,onGroupDrop:P,onDragLeave:k,onDragLeaveGroup:O,onDragEnd:N,onDropOnGroup:L,onCreateAccount:U,onUpdateAccount:R,onDeleteAccount:Y,onMoveAccount:W,onUpdateGroup:B,onDeleteGroup:$,onMoveGroup:G}){const J=Li(),re=[...r].sort((Z,ve)=>Z.sort_order-ve.sort_order),V=b==="group"&&x===t.id,q=b==="group"&&E===t.id,ee=b==="account"&&S===t.id,te=(x&&b==="account"?o[x]:null)&&Object.entries(o).find(([Z])=>Z===x)?.[1]&&Object.entries(o).find(([Z])=>Z===x)?.[1]?.account_group_id!==t.id,se=b==="group"&&q&&x!==t.id,he=e>0,we=e<n-1,ge=re.reduce((Z,ve)=>Z+ve.balance,0);return c.jsxs("div",{children:[b==="group"&&!V&&c.jsxs("div",{onDragOver:Z=>{Z.preventDefault(),T(t.id)},onDragLeave:k,onDrop:Z=>P(Z,t.id),style:{position:"relative",height:se?"2.5rem":"0.5rem",marginBottom:se?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[c.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:oe.primary,borderRadius:"2px",opacity:se?1:0,transition:"opacity 0.15s",boxShadow:se?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),se&&c.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),c.jsx("div",{draggable:h!==t.id,onDragStart:Z=>H(Z,t.id),onDragOver:Z=>Q(Z,t.id),onDragLeave:O,onDragEnd:N,onDrop:Z=>L(Z,t.id),style:{background:V?"color-mix(in srgb, currentColor 3%, transparent)":ee&&te?`color-mix(in srgb, ${oe.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:V?.5:1,border:ee&&te?`2px dashed ${oe.primary}`:"2px solid transparent",cursor:h===t.id?"default":"grab",transition:"all 0.15s"},children:h===t.id?c.jsx(KT,{initialData:{name:t.name,expected_balance:t.expected_balance||"positive",on_budget:t.on_budget,is_active:t.is_active},onSubmit:Z=>B(t.id,Z),onCancel:()=>g(null),submitLabel:"Save"}):c.jsxs(c.Fragment,{children:[c.jsx(Fz,{group:t,accountCount:re.length,groupTotal:ge,canMoveUp:he,canMoveDown:we,isMobile:J,createForGroupId:f,onEdit:()=>g(t.id),onDelete:()=>$(t.id),onMoveUp:()=>G(t.id,"up"),onMoveDown:()=>G(t.id,"down"),onAddAccount:()=>_(t.id)}),J&&c.jsx("div",{style:{marginBottom:"0.5rem"},children:c.jsx(Ie,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>_(t.id),disabled:f!==null,children:"+ Account"})}),c.jsxs("div",{style:zl,children:[re.map((Z,ve)=>u===Z.id?c.jsx(Nu,{initialData:{nickname:Z.nickname,account_group_id:Z.account_group_id,is_income_account:Z.is_income_account,is_income_default:Z.is_income_default,is_outgo_account:Z.is_outgo_account,is_outgo_default:Z.is_outgo_default,on_budget:Z.on_budget,is_active:Z.is_active},onSubmit:Te=>R(Z.id,Te),onCancel:()=>m(null),submitLabel:"Save",accountGroups:a,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:Z.account_group_id,hasExistingIncomeDefault:Object.entries(o).some(([Te,dt])=>dt.is_income_default&&Te!==Z.id),hasExistingOutgoDefault:Object.entries(o).some(([Te,dt])=>dt.is_outgo_default&&Te!==Z.id)},Z.id):c.jsx(gm,{isDragging:b==="account"&&x===Z.id,isDragOver:E===Z.id,onDragStart:Te=>{Te.stopPropagation(),j(Te,Z.id)},onDragOver:Te=>M(Te,Z.id,t.id),onDragLeave:k,onDragEnd:N,onDrop:Te=>K(Te,Z.id,t.id),onEdit:()=>{Z.nickname,m(Z.id)},onDelete:()=>{Z.nickname,Y(Z.id)},onMoveUp:()=>W(Z.id,"up"),onMoveDown:()=>W(Z.id,"down"),canMoveUp:ve>0,canMoveDown:ve<re.length-1,children:c.jsxs("div",{children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("span",{style:D0,children:Z.nickname}),c.jsx(YT,{account:Z,accountGroups:a})]}),c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:Tt(Z.balance)},children:[Ue(Z.balance),$z(Z.balance,t.expected_balance)&&c.jsx("span",{title:qz(Z.balance,t.expected_balance)||"",style:{marginLeft:"0.5rem",fontSize:"0.85rem"},children:""})]})]})},Z.id)),re.length===0&&!f&&c.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No accounts in this type"}),b==="account"&&re.length>0&&c.jsx(XT,{groupId:t.id,isActive:E===`__end__${t.id}`,onDragOver:Z=>{Z.preventDefault(),Z.stopPropagation(),T(`__end__${t.id}`),D(t.id)},onDragLeave:Z=>{Z.stopPropagation(),T(null)},onDrop:Z=>{Z.stopPropagation(),K(Z,"__group_end__",t.id)}}),f===t.id&&c.jsx(Nu,{initialData:{nickname:"",account_group_id:t.id},onSubmit:Z=>U(Z,t.id),onCancel:()=>_(null),submitLabel:"Create",accountGroups:a,showIncomeSettings:!0,currentGroupId:t.id})]}),f!==t.id&&c.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:c.jsx(Ie,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>_(t.id),disabled:f!==null,children:"+ Add Account"})})]})})]})}function Gz({accounts:t,allGroups:e,allAccounts:n,hasGroups:r,editingAccountId:a,createForGroupId:o,setEditingAccountId:u,setCreateForGroupId:h,dragType:f,draggedId:m,dragOverId:g,dragOverGroupId:_,setDragOverId:b,setDragOverGroupId:x,onAccountDragStart:E,onAccountDragOver:S,onAccountDrop:T,onDragOverGroup:D,onDropOnGroup:j,onDragLeave:M,onDragLeaveGroup:K,onDragEnd:H,onCreateAccount:Q,onUpdateAccount:P,onDeleteAccount:k,onMoveAccount:O}){const N=[...t].sort((Y,W)=>Y.sort_order-W.sort_order),L=f==="account"&&_==="ungrouped",R=(m&&f==="account"?n[m]:null)&&Object.entries(n).find(([Y])=>Y===m)?.[1]&&Object.entries(n).find(([Y])=>Y===m)?.[1]?.account_group_id!==null;return N.length===0&&!o&&r&&f!=="account"?null:(N.reduce((Y,W)=>Y+W.balance,0),c.jsxs("div",{onDragOver:Y=>D(Y,"ungrouped"),onDragLeave:K,onDrop:Y=>j(Y,"ungrouped"),style:{background:L&&R?`color-mix(in srgb, ${oe.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:L&&R?`2px dashed ${oe.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[c.jsxs("h3",{style:{...fm,margin:0,opacity:.7,display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:"Ungrouped"}),c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",N.length,")"]}),Fn.showGroupTotals]}),c.jsx(Ie,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>h("ungrouped"),disabled:o!==null,children:"+ Account"})]}),c.jsxs("div",{style:zl,children:[N.map((Y,W)=>a===Y.id?c.jsx(Nu,{initialData:{nickname:Y.nickname,account_group_id:Y.account_group_id,is_income_account:Y.is_income_account,is_income_default:Y.is_income_default,is_outgo_account:Y.is_outgo_account,is_outgo_default:Y.is_outgo_default,on_budget:Y.on_budget,is_active:Y.is_active},onSubmit:B=>P(Y.id,B),onCancel:()=>u(null),submitLabel:"Save",accountGroups:e,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:null,hasExistingIncomeDefault:Object.entries(n).some(([B,$])=>$.is_income_default&&B!==Y.id),hasExistingOutgoDefault:Object.entries(n).some(([B,$])=>$.is_outgo_default&&B!==Y.id)},Y.id):c.jsx(gm,{isDragging:f==="account"&&m===Y.id,isDragOver:g===Y.id,onDragStart:B=>E(B,Y.id),onDragOver:B=>S(B,Y.id,"ungrouped"),onDragLeave:M,onDragEnd:H,onDrop:B=>T(B,Y.id,"ungrouped"),onEdit:()=>{Y.nickname,u(Y.id)},onDelete:()=>{Y.nickname,k(Y.id)},onMoveUp:()=>O(Y.id,"up"),onMoveDown:()=>O(Y.id,"down"),canMoveUp:W>0,canMoveDown:W<N.length-1,children:c.jsxs("div",{children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("span",{style:D0,children:Y.nickname}),c.jsx(YT,{account:Y,accountGroups:e})]}),c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:Tt(Y.balance)},children:Ue(Y.balance)})]})},Y.id)),N.length===0&&f==="account"&&c.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to ungroup"}),f==="account"&&N.length>0&&c.jsx(XT,{groupId:"ungrouped",isActive:g==="__end__ungrouped",onDragOver:Y=>{Y.preventDefault(),Y.stopPropagation(),b("__end__ungrouped"),x("ungrouped")},onDragLeave:Y=>{Y.stopPropagation(),b(null)},onDrop:Y=>{Y.stopPropagation(),T(Y,"__group_end__","ungrouped")}}),o==="ungrouped"&&c.jsx(Nu,{initialData:{nickname:"",account_group_id:null},onSubmit:Y=>Q(Y,"ungrouped"),onCancel:()=>h(null),submitLabel:"Create",accountGroups:e,showIncomeSettings:!0,currentGroupId:null})]}),o!=="ungrouped"&&c.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:c.jsx(Ie,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>h("ungrouped"),disabled:o!==null,children:"+ Add Account"})})]}))}function Qz(){const{accounts:t,accountsByGroup:e,hiddenAccounts:n,sortedGroups:r,currentBudget:a,error:o,setError:u,handleCreateAccount:h,handleUpdateAccount:f,handleDeleteAccount:m,handleMoveAccount:g,handleCreateGroup:_,handleUpdateGroup:b,handleDeleteGroup:x,handleMoveGroup:E,reorderAccountsInGroup:S,reorderGroups:T}=xL(),D=Li(),[j,M]=C.useState(null),[K,H]=C.useState(null),[Q,P]=C.useState(null),[k,O]=C.useState(!1),[N,L]=C.useState(null),[U,R]=C.useState(null),[Y,W]=C.useState(null),[B,$]=C.useState(null);function G(Z,ve){L("account"),R(ve),Z.dataTransfer.effectAllowed="move"}function J(Z,ve,Te){Z.preventDefault(),N==="account"&&(ve!==U&&W(ve),$(Te))}function re(Z,ve){Z.preventDefault(),N==="account"?($(ve),W(null)):N==="group"&&ve!==U&&W(ve)}function V(){W(null)}function q(){$(null)}function ee(){L(null),R(null),W(null),$(null)}async function ne(Z,ve,Te){if(Z.preventDefault(),Z.stopPropagation(),!U||N!=="account"){ee();return}await S(U,ve,Te),ee()}async function te(Z,ve){Z.preventDefault(),N==="account"?await ne(Z,"__group_end__",ve):N==="group"&&await he(Z,ve)}function se(Z,ve){Z.stopPropagation(),L("group"),R(ve),Z.dataTransfer.effectAllowed="move"}async function he(Z,ve){if(Z.preventDefault(),!U||N!=="group"||U===ve){ee();return}await T(U,ve),ee()}const we=C.useMemo(()=>{const Z=Object.values(t),ve=Z.reduce((Me,ke)=>Me+(ke.balance??0),0);let Te=0,dt=0;for(const Me of Z){const ke=r.find(rr=>rr.id===Me.account_group_id);Me.on_budget===!0||Me.on_budget===void 0&&ke?.on_budget!==!1?Te+=Me.balance??0:dt+=Me.balance??0}return{count:Z.length,groupCount:r.length,totalBalance:ve,onBudgetTotal:Te,offBudgetTotal:dt}},[t,r]);if(!a)return c.jsx("p",{children:"No budget found. Please log in."});const ge=e.ungrouped||[];return c.jsxs("div",{children:[o&&c.jsx(So,{message:o,onDismiss:()=>u(null)}),c.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),c.jsx("span",{style:{color:Tt(we.onBudgetTotal),fontWeight:600},children:Ue(we.onBudgetTotal)})]}),we.offBudgetTotal!==0&&c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),c.jsx("span",{style:{fontWeight:600,opacity:.7},children:Ue(we.offBudgetTotal)})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Total: "}),c.jsx("span",{style:{color:Tt(we.totalBalance),fontWeight:600},children:Ue(we.totalBalance)})]}),c.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:D?"Drag to move.":"Drag between types or use  to reorder."})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:c.jsx(N0,{})})]})}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(t).length===0&&r.length===0&&c.jsx("p",{style:{opacity:.7},children:"No accounts yet. Create an account type first, then add accounts!"}),r.map((Z,ve)=>c.jsx(Hz,{group:Z,groupIndex:ve,totalGroups:r.length,accounts:e[Z.id]||[],allGroups:r,allAccounts:t,editingAccountId:j,editingGroupId:Q,createForGroupId:K,setEditingAccountId:M,setEditingGroupId:P,setCreateForGroupId:H,dragType:N,draggedId:U,dragOverId:Y,dragOverGroupId:B,setDragOverId:W,setDragOverGroupId:$,onAccountDragStart:G,onAccountDragOver:J,onAccountDrop:ne,onGroupDragStart:se,onGroupDragOver:re,onGroupDrop:he,onDragLeave:V,onDragLeaveGroup:q,onDragEnd:ee,onDropOnGroup:te,onCreateAccount:h,onUpdateAccount:(Te,dt)=>{f(Te,dt),M(null)},onDeleteAccount:m,onMoveAccount:g,onUpdateGroup:(Te,dt)=>{b(Te,dt),P(null)},onDeleteGroup:x,onMoveGroup:E},Z.id)),N==="group"&&r.length>0&&c.jsx(k0,{isActive:Y==="__end__",onDragOver:Z=>{Z.preventDefault(),W("__end__")},onDragLeave:V,onDrop:Z=>he(Z,"__end__"),label:"Move account type to end"}),c.jsx(Gz,{accounts:ge,allGroups:r,allAccounts:t,hasGroups:r.length>0,editingAccountId:j,createForGroupId:K,setEditingAccountId:M,setCreateForGroupId:H,dragType:N,draggedId:U,dragOverId:Y,dragOverGroupId:B,setDragOverId:W,setDragOverGroupId:$,onAccountDragStart:G,onAccountDragOver:J,onAccountDrop:ne,onDragOverGroup:re,onDropOnGroup:te,onDragLeave:V,onDragLeaveGroup:q,onDragEnd:ee,onCreateAccount:h,onUpdateAccount:(Z,ve)=>{f(Z,ve),M(null)},onDeleteAccount:m,onMoveAccount:g})]}),n.length>0&&c.jsx("div",{style:{marginBottom:"2rem"},children:c.jsxs(O0,{title:"Hidden Accounts",count:n.length,children:[c.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[c.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[c.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),c.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:n.map(Z=>j===Z.id?c.jsx(Nu,{initialData:{nickname:Z.nickname,account_group_id:Z.account_group_id,is_income_account:Z.is_income_account,is_income_default:Z.is_income_default,is_outgo_account:Z.is_outgo_account,is_outgo_default:Z.is_outgo_default,on_budget:Z.on_budget,is_active:Z.is_active,is_hidden:Z.is_hidden},onSubmit:ve=>{f(Z.id,ve),M(null)},onCancel:()=>M(null),submitLabel:"Save",accountGroups:r,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:Z.account_group_id,hasExistingIncomeDefault:Object.entries(t).some(([ve,Te])=>Te.is_income_default&&ve!==Z.id),hasExistingOutgoDefault:Object.entries(t).some(([ve,Te])=>Te.is_outgo_default&&ve!==Z.id)},Z.id):c.jsxs("div",{onClick:()=>M(Z.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[c.jsx("span",{children:Z.nickname}),c.jsx("span",{style:{color:Tt(Z.balance),fontWeight:500},children:Ue(Z.balance)})]},Z.id))})]})}),k?c.jsx(KT,{onSubmit:Z=>{_(Z),O(!1)},onCancel:()=>O(!1),submitLabel:"Create Account Type"}):c.jsx(Ie,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>O(!0),children:"+ Add Account Type"})]})}function Pu({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:a=[],showGroupSelector:o=!1}){const[u,h]=C.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[f,m]=C.useState(t?.default_monthly_amount?.toString()||""),[g,_]=C.useState(t?.default_monthly_type||"fixed"),[b,x]=C.useState(!1);function E(S){if(S.preventDefault(),!u.name.trim())return;x(!0);const T=parseFloat(f),D=!isNaN(T)&&T>0;e({...u,description:u.description?.trim()||void 0,default_monthly_amount:D?T:void 0,default_monthly_type:D?g:void 0})}return c.jsxs(ms,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:E,children:[c.jsx(wt,{label:"Category Name",htmlFor:"category-name",children:c.jsx(ps,{id:"category-name",type:"text",value:u.name,onChange:S=>h({...u,name:S.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),c.jsx(wt,{label:"Description (optional)",htmlFor:"category-description",children:c.jsx(M0,{id:"category-description",value:u.description||"",onChange:S=>h({...u,description:S.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&c.jsx(wt,{label:"Category Group",htmlFor:"category-group",children:c.jsxs(Ou,{id:"category-group",value:u.category_group_id||"ungrouped",onChange:S=>h({...u,category_group_id:S.target.value==="ungrouped"?null:S.target.value}),children:[c.jsx("option",{value:"ungrouped",children:"Uncategorized"}),a.map(S=>c.jsx("option",{value:S.id,children:S.name},S.id))]})}),c.jsxs(wt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[c.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[c.jsxs(Ou,{id:"default-type",value:g,onChange:S=>_(S.target.value),style:{width:"auto",flex:"0 0 auto"},children:[c.jsx("option",{value:"fixed",children:"Fixed $"}),c.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?c.jsx(ao,{id:"default-amount",value:f,onChange:m,placeholder:"$0.00"}):c.jsx(ps,{id:"default-amount",type:"number",value:f,onChange:S=>m(S.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&c.jsx("span",{style:{opacity:.6},children:"%"})]}),c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&c.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[c.jsx(Mr,{id:"is-hidden",checked:u.is_hidden||!1,onChange:S=>h({...u,is_hidden:S.target.checked}),children:"Hidden category"}),c.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),c.jsxs(Ca,{children:[c.jsx(Ie,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:b,children:r}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"})]})]})}function JT({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[a,o]=C.useState(t||{name:""}),[u,h]=C.useState(!1);function f(m){m.preventDefault(),a.name.trim()&&(h(!0),e(a))}return c.jsxs(ms,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:f,children:[c.jsx(wt,{label:"Group Name",htmlFor:"group-name",children:c.jsx(ps,{id:"group-name",type:"text",value:a.name,onChange:m=>o({...a,name:m.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),c.jsxs(Ca,{children:[c.jsx(Ie,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:u,children:r}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function ZT({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r}){return c.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[c.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:oe.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&c.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function eA({category:t,catId:e,categoryBalances:n,loadingBalances:r}){const a=n[e]||{current:0,total:0};return c.jsxs("div",{children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[c.jsx("span",{style:D0,children:t.name}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&c.jsxs("span",{style:{fontSize:"0.75rem",opacity:.8,background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.15rem 0.4rem",borderRadius:"4px"},children:["Default: ",t.default_monthly_type==="percentage"?c.jsxs(c.Fragment,{children:[c.jsxs("span",{style:{color:oe.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{style:{color:oe.success,fontWeight:500},children:Ue(t.default_monthly_amount)}),"/mo"]})]})]}),t.description&&c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",opacity:.6,lineHeight:1.3},children:t.description}),c.jsxs("div",{style:{marginTop:"0.25rem"},children:[c.jsxs("p",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:Dn(a.current)},children:[r?"...":Zr(a.current),c.jsx("span",{style:{fontSize:"0.75rem",fontWeight:400,opacity:.6,marginLeft:"0.35rem"},children:"available now"})]}),c.jsxs("p",{style:{margin:"0.15rem 0 0 0",fontSize:"0.85rem",fontWeight:500,color:Dn(a.total),opacity:.75},children:[r?"...":Zr(a.total),c.jsx("span",{style:{fontSize:"0.7rem",fontWeight:400,opacity:.7,marginLeft:"0.35rem"},children:"total allocated"})]})]})]})}function Wz({group:t,categoryCount:e,canMoveUp:n,canMoveDown:r,isMobile:a,createForGroupId:o,onEdit:u,onDelete:h,onMoveUp:f,onMoveDown:m,onAddCategory:g,onDragStart:_,onDragEnd:b}){return c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:a?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:a?"wrap":"nowrap"},children:[c.jsxs("h3",{style:{...fm,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0},children:[!a&&c.jsx("span",{draggable:!0,onDragStart:_,onDragEnd:b,style:{cursor:"grab",opacity:.4,padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder group",children:""}),c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),c.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]})]}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!a&&c.jsx(Ie,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:g,disabled:o!==null,children:"+ Category"}),c.jsx("button",{onClick:()=>{t.name,u()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),c.jsx("button",{onClick:()=>{t.name,h()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),c.jsxs("div",{style:R0,children:[c.jsx("button",{onClick:f,disabled:!n,style:{...Bl,opacity:n?.6:.2,cursor:n?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),c.jsx("button",{onClick:m,disabled:!r,style:{...Bl,opacity:r?.6:.2,cursor:r?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]})}function Kz({group:t,groupIndex:e,groupCategories:n,sortedGroups:r,categoryGroups:a,categoryBalances:o,loadingBalances:u,dragType:h,draggedId:f,dragOverId:m,dragOverGroupId:g,editingCategoryId:_,setEditingCategoryId:b,createForGroupId:x,setCreateForGroupId:E,editingGroupId:S,setEditingGroupId:T,handleCreateCategory:D,handleUpdateCategory:j,handleDeleteCategory:M,handleMoveCategory:K,handleUpdateGroup:H,handleDeleteGroup:Q,handleMoveGroup:P,handleCategoryDragStart:k,handleCategoryDragOver:O,handleDragOverGroup:N,handleDragLeave:L,handleDragLeaveGroup:U,handleDragEnd:R,handleCategoryDrop:Y,handleDropOnGroup:W,handleGroupDragStart:B,handleGroupDrop:$,setDragOverId:G,setDragOverGroupId:J,isMobile:re,categories:V}){const q=h==="group"&&f===t.id,ee=h==="group"&&m===t.id,ne=h==="category"&&g===t.id,te=f&&h==="category"?V[f]:null,se=te&&(te.category_group_id||"ungrouped")!==t.id,he=h==="group"&&ee&&f!==t.id,we=e>0,ge=e<r.length-1;return c.jsxs("div",{children:[h==="group"&&!q&&c.jsxs("div",{onDragOver:Z=>{Z.preventDefault(),G(t.id)},onDragLeave:L,onDrop:Z=>$(Z,t.id),style:{position:"relative",height:he?"2.5rem":"0.5rem",marginBottom:he?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[c.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:oe.primary,borderRadius:"2px",opacity:he?1:0,transition:"opacity 0.15s",boxShadow:he?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),he&&c.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),c.jsx("div",{onDragOver:Z=>N(Z,t.id),onDragLeave:U,onDrop:Z=>W(Z,t.id),style:{background:q?"color-mix(in srgb, currentColor 3%, transparent)":ne&&se?`color-mix(in srgb, ${oe.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:q?.5:1,border:ne&&se?`2px dashed ${oe.primary}`:"2px solid transparent",transition:"all 0.15s"},children:S===t.id?c.jsx(JT,{initialData:{name:t.name},onSubmit:Z=>H(t.id,Z),onCancel:()=>T(null),submitLabel:"Save"}):c.jsxs(c.Fragment,{children:[c.jsx(Wz,{group:t,categoryCount:n.length,canMoveUp:we,canMoveDown:ge,isMobile:re,createForGroupId:x,onEdit:()=>T(t.id),onDelete:()=>Q(t.id),onMoveUp:()=>P(t.id,"up"),onMoveDown:()=>P(t.id,"down"),onAddCategory:()=>E(t.id),onDragStart:Z=>B(Z,t.id),onDragEnd:R}),re&&c.jsx("div",{style:{marginBottom:"0.5rem"},children:c.jsx(Ie,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>E(t.id),disabled:x!==null,children:"+ Category"})}),c.jsxs("div",{style:zl,children:[n.map(([Z,ve])=>_===Z?c.jsx(Pu,{initialData:{name:ve.name,description:ve.description,category_group_id:ve.category_group_id,default_monthly_amount:ve.default_monthly_amount,default_monthly_type:ve.default_monthly_type,is_hidden:ve.is_hidden},onSubmit:Te=>{j(Z,Te),b(null)},onCancel:()=>b(null),submitLabel:"Save",categoryGroups:a,showGroupSelector:!0},Z):c.jsx(gm,{isDragging:h==="category"&&f===Z,isDragOver:m===Z,onDragStart:Te=>{Te.stopPropagation(),k(Te,Z)},onDragOver:Te=>O(Te,Z,t.id),onDragLeave:L,onDragEnd:R,onDrop:Te=>Y(Te,Z,t.id),onEdit:()=>{ve.name,b(Z)},onDelete:()=>{ve.name,M(Z)},onMoveUp:()=>K(Z,"up"),onMoveDown:()=>K(Z,"down"),canMoveUp:n.findIndex(([Te])=>Te===Z)>0,canMoveDown:n.findIndex(([Te])=>Te===Z)<n.length-1,children:c.jsx(eA,{category:ve,catId:Z,categoryBalances:o,loadingBalances:u})},Z)),n.length===0&&!x&&c.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No categories in this group"}),h==="category"&&n.length>0&&c.jsx(ZT,{groupId:t.id,isActive:m===`__end__${t.id}`,onDragOver:Z=>{Z.preventDefault(),Z.stopPropagation(),G(`__end__${t.id}`),J(t.id)},onDragLeave:Z=>{Z.stopPropagation(),G(null)},onDrop:Z=>{Z.stopPropagation(),Y(Z,"__group_end__",t.id)}}),x===t.id&&c.jsx(Pu,{initialData:{name:"",category_group_id:t.id},onSubmit:Z=>D(Z,t.id),onCancel:()=>E(null),submitLabel:"Create",categoryGroups:a})]}),x!==t.id&&c.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:c.jsx(Ie,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>E(t.id),disabled:x!==null,children:"+ Add Category"})})]})})]})}function Yz({ungroupedCategories:t,categoryGroups:e,categoryBalances:n,loadingBalances:r,dragType:a,draggedId:o,dragOverId:u,dragOverGroupId:h,editingCategoryId:f,setEditingCategoryId:m,createForGroupId:g,setCreateForGroupId:_,handleCreateCategory:b,handleUpdateCategory:x,handleDeleteCategory:E,handleMoveCategory:S,handleCategoryDragStart:T,handleCategoryDragOver:D,handleDragOverGroup:j,handleDragLeaveGroup:M,handleDragLeave:K,handleDragEnd:H,handleCategoryDrop:Q,handleDropOnGroup:P,setDragOverId:k,setDragOverGroupId:O,categories:N,hasGroups:L}){const U=a==="category"&&h==="ungrouped",R=o&&a==="category"?N[o]:null,Y=R&&R.category_group_id!==null;return t.length===0&&!g&&L&&a!=="category"?null:c.jsxs("div",{onDragOver:W=>j(W,"ungrouped"),onDragLeave:M,onDrop:W=>P(W,"ungrouped"),style:{background:U&&Y?`color-mix(in srgb, ${oe.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:U&&Y?`2px dashed ${oe.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[c.jsxs("h3",{style:{...fm,margin:0,opacity:.7},children:["Uncategorized",c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",t.length,")"]})]}),c.jsx(Ie,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>_("ungrouped"),disabled:g!==null,children:"+ Category"})]}),c.jsxs("div",{style:zl,children:[t.map(([W,B])=>f===W?c.jsx(Pu,{initialData:{name:B.name,description:B.description,category_group_id:B.category_group_id,default_monthly_amount:B.default_monthly_amount,default_monthly_type:B.default_monthly_type,is_hidden:B.is_hidden},onSubmit:$=>{x(W,$),m(null)},onCancel:()=>m(null),submitLabel:"Save",categoryGroups:e,showGroupSelector:!0},W):c.jsx(gm,{isDragging:a==="category"&&o===W,isDragOver:u===W,onDragStart:$=>T($,W),onDragOver:$=>D($,W,"ungrouped"),onDragLeave:K,onDragEnd:H,onDrop:$=>Q($,W,"ungrouped"),onEdit:()=>{B.name,m(W)},onDelete:()=>{B.name,E(W)},onMoveUp:()=>S(W,"up"),onMoveDown:()=>S(W,"down"),canMoveUp:t.findIndex(([$])=>$===W)>0,canMoveDown:t.findIndex(([$])=>$===W)<t.length-1,children:c.jsx(eA,{category:B,catId:W,categoryBalances:n,loadingBalances:r})},W)),t.length===0&&a==="category"&&c.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to uncategorize"}),a==="category"&&t.length>0&&c.jsx(ZT,{groupId:"ungrouped",isActive:u==="__end__ungrouped",onDragOver:W=>{W.preventDefault(),W.stopPropagation(),k("__end__ungrouped"),O("ungrouped")},onDragLeave:W=>{W.stopPropagation(),k(null)},onDrop:W=>{W.stopPropagation(),Q(W,"__group_end__","ungrouped")}}),g==="ungrouped"&&c.jsx(Pu,{initialData:{name:"",category_group_id:null},onSubmit:W=>b(W,"ungrouped"),onCancel:()=>_(null),submitLabel:"Create",categoryGroups:e})]}),g!=="ungrouped"&&c.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:c.jsx(Ie,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>_("ungrouped"),disabled:g!==null,children:"+ Add Category"})})]})}function Xz(){const{currentBudget:t,categories:e,categoryGroups:n,categoriesByGroup:r,hiddenCategories:a,sortedGroups:o,categoryBalances:u,isLoading:h,loadingBalances:f,error:m,setError:g,getOnBudgetTotal:_,handleCreateCategory:b,handleUpdateCategory:x,handleDeleteCategory:E,handleMoveCategory:S,handleCreateGroup:T,handleUpdateGroup:D,handleDeleteGroup:j,handleMoveGroup:M,dragType:K,draggedId:H,dragOverId:Q,dragOverGroupId:P,setDragOverId:k,setDragOverGroupId:O,handleCategoryDragStart:N,handleCategoryDragOver:L,handleDragOverGroup:U,handleDragLeave:R,handleDragLeaveGroup:Y,handleDragEnd:W,handleCategoryDrop:B,handleDropOnGroup:$,handleGroupDragStart:G,handleGroupDrop:J}=CL(),re=Li(),{addLoadingHold:V,removeLoadingHold:q}=nr();C.useEffect(()=>(h?V("categories","Loading categories..."):q("categories"),()=>q("categories")),[h,V,q]);const[ee,ne]=C.useState(null),[te,se]=C.useState(null),[he,we]=C.useState(null),[ge,Z]=C.useState(!1);if(!t)return c.jsx("p",{children:"No budget found. Please log in."});const ve=Object.values(u).reduce((ke,lt)=>ke+lt.current,0),Te=Object.values(u).reduce((ke,lt)=>ke+lt.total,0),dt=_()-ve,Me=Math.abs(Te-ve)>.01;return h?null:c.jsxs("div",{children:[m&&c.jsx(So,{message:m,onDismiss:()=>g(null)}),c.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Categories:"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),c.jsx("span",{style:{color:Tt(_()),fontWeight:600},children:Ue(_())})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Allocated: "}),c.jsx("span",{style:{color:sc(ve),fontWeight:600},children:f?"...":Ue(ve)}),Me&&c.jsxs("span",{style:{opacity:.5,fontSize:"0.8rem"},children:[" (",Ue(Te)," total)"]})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Available: "}),c.jsx("span",{style:{color:Tt(dt),fontWeight:600},children:f?"...":Ue(dt)})]}),c.jsx("span",{style:{opacity:.6},children:re?"Drag to move between groups.":"Drag categories between groups, or use  to reorder."})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:c.jsx(N0,{})})]})}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(e).length===0&&n.length===0&&c.jsx("p",{style:{opacity:.7},children:"No categories yet. Create a group first, then add categories!"}),o.map((ke,lt)=>{const rr=(r[ke.id]||[]).sort((ii,Et)=>ii[1].sort_order-Et[1].sort_order);return c.jsx(Kz,{group:ke,groupIndex:lt,groupCategories:rr,sortedGroups:o,categoryGroups:n,categoryBalances:u,loadingBalances:f,dragType:K,draggedId:H,dragOverId:Q,dragOverGroupId:P,editingCategoryId:ee,setEditingCategoryId:ne,createForGroupId:te,setCreateForGroupId:se,editingGroupId:he,setEditingGroupId:we,handleCreateCategory:b,handleUpdateCategory:x,handleDeleteCategory:E,handleMoveCategory:S,handleUpdateGroup:D,handleDeleteGroup:j,handleMoveGroup:M,handleCategoryDragStart:N,handleCategoryDragOver:L,handleDragOverGroup:U,handleDragLeave:R,handleDragLeaveGroup:Y,handleDragEnd:W,handleCategoryDrop:B,handleDropOnGroup:$,handleGroupDragStart:G,handleGroupDrop:J,setDragOverId:k,setDragOverGroupId:O,isMobile:re,categories:e},ke.id)}),K==="group"&&o.length>0&&c.jsx(k0,{isActive:Q==="__end__",onDragOver:ke=>{ke.preventDefault(),k("__end__")},onDragLeave:R,onDrop:ke=>J(ke,"__end__"),label:"Move group to end"}),c.jsx(Yz,{ungroupedCategories:(r.ungrouped||[]).sort((ke,lt)=>ke[1].sort_order-lt[1].sort_order),categoryGroups:n,categoryBalances:u,loadingBalances:f,dragType:K,draggedId:H,dragOverId:Q,dragOverGroupId:P,editingCategoryId:ee,setEditingCategoryId:ne,createForGroupId:te,setCreateForGroupId:se,handleCreateCategory:b,handleUpdateCategory:x,handleDeleteCategory:E,handleMoveCategory:S,handleCategoryDragStart:N,handleCategoryDragOver:L,handleDragOverGroup:U,handleDragLeaveGroup:Y,handleDragLeave:R,handleDragEnd:W,handleCategoryDrop:B,handleDropOnGroup:$,setDragOverId:k,setDragOverGroupId:O,categories:e,hasGroups:n.length>0})]}),a.length>0&&c.jsx("div",{style:{marginBottom:"2rem"},children:c.jsxs(O0,{title:"Hidden Categories",count:a.length,children:[c.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[c.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[c.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),c.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:a.map(([ke,lt])=>ee===ke?c.jsx(Pu,{initialData:{name:lt.name,description:lt.description,category_group_id:lt.category_group_id,default_monthly_amount:lt.default_monthly_amount,default_monthly_type:lt.default_monthly_type,is_hidden:lt.is_hidden},onSubmit:rr=>{x(ke,rr),ne(null)},onCancel:()=>ne(null),submitLabel:"Save",categoryGroups:n,showGroupSelector:!0},ke):c.jsxs("div",{onClick:()=>ne(ke),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[c.jsx("span",{children:lt.name}),c.jsx("span",{style:{color:Tt(lt.balance),fontWeight:500},children:Ue(lt.balance)})]},ke))})]})}),ge?c.jsx(JT,{onSubmit:ke=>{T(ke),Z(!1)},onCancel:()=>Z(!1),submitLabel:"Create Group"}):c.jsx(Ie,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>Z(!0),children:"+ Add Category Group"})]})}function Jz(){const{selectedBudgetId:t,currentUserId:e}=Pt(),{budget:n,budgetUserIds:r,acceptedUserIds:a,inviteUser:o,revokeUser:u}=Mn(t,e),[h,f]=C.useState(""),[m,g]=C.useState(!1),[_,b]=C.useState(null),[x,E]=C.useState(null);if(!n)return c.jsx("p",{children:"No budget found."});async function S(M){if(M.preventDefault(),!(!h.trim()||!n)){g(!0),b(null),E(null);try{await o(h.trim()),f(""),E("Invite sent! The user can now accept the invitation from their account.")}catch(K){b(K instanceof Error?K.message:"Failed to invite user")}finally{g(!1)}}}async function T(M){if(!n)return;if(M===n.owner_id){b("Cannot revoke the budget owner");return}if(M===e){b("Cannot revoke yourself from the budget");return}const K=a.includes(M);if(confirm(K?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){b(null),E(null);try{await u(M),E(K?"User access revoked.":"Invitation cancelled.")}catch(Q){b(Q instanceof Error?Q.message:"Failed to revoke user")}}}const D=r.filter(M=>a.includes(M)),j=r.filter(M=>!a.includes(M));return c.jsxs("div",{children:[c.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),c.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),_&&c.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:_}),c.jsx("button",{onClick:()=>b(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),x&&c.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:x}),c.jsx("button",{onClick:()=>E(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",D.length,")"]}),D.length===0?c.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:D.map(M=>{const K=M===n.owner_id,H=M===e;return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[c.jsx("div",{style:{flex:1,minWidth:0},children:c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:M}),K&&c.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),H&&c.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!K&&!H&&c.jsx("button",{onClick:()=>T(M),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},M)})})]}),j.length>0&&c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",j.length,")"]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:j.map(M=>c.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[c.jsx("div",{style:{flex:1,minWidth:0},children:c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:M}),c.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),c.jsx("button",{onClick:()=>T(M),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},M))})]}),c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[c.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),c.jsxs("form",{onSubmit:S,style:{display:"flex",gap:"0.75rem"},children:[c.jsx("input",{type:"text",value:h,onChange:M=>f(M.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),c.jsx("button",{type:"submit",disabled:m||!h.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:m||!h.trim()?"not-allowed":"pointer",fontWeight:500,opacity:m||!h.trim()?.7:1,whiteSpace:"nowrap"},children:m?"Inviting...":"Send Invite"})]}),c.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),c.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:n.id})]})]})}const Zz=["budget","feedback","migration","tests"];function e3(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:a}=Pt();C.useLayoutEffect(()=>{a("Budget Admin")},[a]);const o=Bn(),u=o.pathname==="/budget/admin",h=C.useMemo(()=>{const _=o.pathname;return _.includes("/admin/budget")?"budget":_.includes("/admin/feedback")?"feedback":_.includes("/admin/migration")?"migration":_.includes("/admin/tests")?"tests":"budget"},[o.pathname]),f=h==="tests";C.useEffect(()=>{u||r(h)},[h,u,r]);function m(){return!Zz.includes(n)||n==="tests"&&!e?"budget":n}const g=C.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return t?!e&&f?c.jsxs("div",{children:[c.jsx("h1",{children:"Access Denied"}),c.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),c.jsx("p",{style:{marginTop:"1rem"},children:c.jsx(Bt,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):c.jsxs("div",{children:[c.jsx(Mf,{mode:"link",linkPrefix:"/budget/admin",tabs:g,activeTab:h}),u?c.jsx(Of,{to:`/budget/admin/${m()}`,replace:!0}):c.jsx(Nf,{})]}):c.jsxs("div",{children:[c.jsx("h1",{children:"Access Denied"}),c.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),c.jsx("p",{style:{marginTop:"1rem"},children:c.jsx(Bt,{to:"/budget",children:"Go to Budget "})})]})}function t3(){const{addLoadingHold:t,removeLoadingHold:e}=nr(),{selectedBudgetId:n,currentUserId:r,isAdmin:a}=Pt(),{budget:o,accounts:u,accountGroups:h,categories:f,categoryGroups:m,isOwner:g,isLoading:_}=Mn(n,r);return C.useEffect(()=>(_?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[_,t,e]),_?null:o?c.jsxs("div",{children:[c.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),c.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),c.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""}),c.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),c.jsx("strong",{children:o.name})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""}),c.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),c.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:o.id})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""}),c.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),c.jsx("strong",{children:o.owner_email||o.owner_id})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""}),c.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),c.jsxs("span",{children:[o.user_ids.length," user",o.user_ids.length!==1?"s":"",c.jsxs("span",{style:{opacity:.7},children:["  ",g?"You are the owner":"Shared with you"]})]})]})]})}),a&&c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[c.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),c.jsx("button",{onClick:()=>{const b={...o,accounts:u,account_groups:h,categories:f,category_groups:m,_meta:{downloaded_at:new Date().toISOString()}},x=new Blob([JSON.stringify(b,null,2)],{type:"application/json"}),E=URL.createObjectURL(x),S=document.createElement("a");S.href=E,S.download=`budget_${o.id}.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(E)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):c.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function zw({selectedType:t,onSelect:e}){return c.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=Ey[n],a=t==="feature"?"new_feature":t,o=a===n||!a&&n==="bug";return c.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&c.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function n3(){const[t,e]=C.useState(null),[n,r]=C.useState(null),[a,o]=C.useState(null),[u,h]=C.useState(!1),[f,m]=C.useState(""),[g,_]=C.useState("bug"),[b,x]=C.useState(null),[E,S]=C.useState(null),T=C.useContext(Zu),j=go().get_current_firebase_user(),M=M4(),{submitFeedback:K}=FT(),{toggleFeedback:H}=oB(),{updateSortOrder:Q}=lB(),P=M.data?.items||[],{addLoadingHold:k,removeLoadingHold:O}=nr();C.useEffect(()=>(M.isLoading?k("settings-feedback","Loading feedback..."):O("settings-feedback"),()=>O("settings-feedback")),[M.isLoading,k,O]);function N(q){q.preventDefault(),!(!f.trim()||!T.username||!j)&&(K.mutate({userId:j.uid,userEmail:T.username,text:f.trim(),feedbackType:g,currentPath:"/settings/feedback"}),m(""),_("bug"),h(!1))}function L(q){q.is_done?U(q):x(q)}async function U(q){try{await H.mutateAsync({item:q})}catch(ee){e(ee instanceof Error?ee.message:"Failed to update feedback")}}function R(){b&&(U(b),x(null))}async function Y(q){if(E){try{const ne=P.filter(te=>te.doc_id===E.doc_id).map(te=>({id:te.id,text:te.text,created_at:te.created_at,is_done:te.is_done,completed_at:te.completed_at,sort_order:te.sort_order,feedback_type:te.id===E.id?q:te.feedback_type}));await Q.mutateAsync({docId:E.doc_id,items:ne})}catch(ee){e(ee instanceof Error?ee.message:"Failed to update feedback type")}S(null)}}const W=P.filter(q=>!q.is_done).sort((q,ee)=>q.sort_order-ee.sort_order),B=P.filter(q=>q.is_done).sort((q,ee)=>new Date(ee.completed_at||0).getTime()-new Date(q.completed_at||0).getTime());function $(q,ee){r(ee),q.dataTransfer.effectAllowed="move"}function G(q,ee){q.preventDefault(),ee!==n&&o(ee)}function J(){o(null)}function re(){r(null),o(null)}async function V(q,ee){if(q.preventDefault(),!n||n===ee){re();return}const ne=W.findIndex(ge=>ge.id===n),te=[...W],[se]=te.splice(ne,1);if(ee==="__end__")te.push(se);else{const ge=te.findIndex(Z=>Z.id===ee);te.splice(ge,0,se)}const he=te.map((ge,Z)=>({...ge,sort_order:Z}));re();const we=new Map;for(const ge of he)we.has(ge.doc_id)||we.set(ge.doc_id,[]),we.get(ge.doc_id).push({id:ge.id,text:ge.text,created_at:ge.created_at,is_done:ge.is_done,completed_at:ge.completed_at,sort_order:ge.sort_order,feedback_type:ge.feedback_type});for(const ge of B)we.has(ge.doc_id)||we.set(ge.doc_id,[]),we.get(ge.doc_id).push({id:ge.id,text:ge.text,created_at:ge.created_at,is_done:ge.is_done,completed_at:ge.completed_at,sort_order:ge.sort_order,feedback_type:ge.feedback_type});try{for(const[ge,Z]of we)await Q.mutateAsync({docId:ge,items:Z})}catch(ge){e(ge instanceof Error?ge.message:"Failed to save order")}}return M.isLoading?null:c.jsxs("div",{children:[c.jsx("h2",{style:{marginTop:0},children:"Feedback"}),c.jsx("p",{style:{...OT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."}),t&&c.jsx(So,{message:t,onDismiss:()=>e(null)}),c.jsxs("div",{style:zl,children:[W.length===0&&!u&&c.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),W.map(q=>c.jsx(Z6,{item:q,isDragging:n===q.id,isDragOver:a===q.id,onDragStart:ee=>$(ee,q.id),onDragOver:ee=>G(ee,q.id),onDragLeave:J,onDragEnd:re,onDrop:ee=>V(ee,q.id),onToggleDone:()=>L(q),onTypeClick:()=>S(q)},q.id)),n&&W.length>0&&c.jsx(k0,{isActive:a==="__end__",onDragOver:q=>G(q,"__end__"),onDragLeave:J,onDrop:q=>V(q,"__end__")})]}),u?c.jsxs(ms,{actionName:"Add Feedback",onSubmit:N,children:[c.jsx(zw,{selectedType:g,onSelect:_}),c.jsx(M0,{value:f,onChange:q=>m(q.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),c.jsxs(Ca,{children:[c.jsx(Ie,{type:"submit",actionName:"Add Feedback",disabled:!f.trim(),children:"Add Feedback"}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{h(!1),m(""),_("bug")},children:"Cancel"})]})]}):c.jsx(Ie,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>h(!0),children:"+ Add Feedback"}),B.length>0&&c.jsx(O0,{title:"Completed",count:B.length,children:c.jsx("div",{style:{...zl,marginTop:"0.5rem"},children:B.map(q=>c.jsx(eB,{item:q,onToggleDone:()=>L(q),onTypeClick:()=>S(q)},q.id))})}),c.jsxs(va,{isOpen:b!==null,onClose:()=>x(null),title:"Mark as Complete",children:[c.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),b&&c.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',b.text,'"']}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>x(null),children:"Cancel"}),c.jsx(Ie,{variant:"primary",actionName:"Confirm Mark Complete",onClick:R,children:"Mark Complete"})]})]}),c.jsxs(va,{isOpen:E!==null,onClose:()=>S(null),title:"Change Feedback Type",children:[c.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),c.jsx(zw,{selectedType:E?.feedback_type||"bug",onSelect:Y}),c.jsx(Ie,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>S(null),style:{width:"100%"},children:"Cancel"})]})]})}function r3(){try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE"),console.log("[Cache] Cleared React Query cache from localStorage")}catch(t){console.warn("Failed to clear localStorage cache:",t)}window.location.reload()}function i3(){const e=go().get_current_firebase_user(),[n,r]=C.useState(!1),a=OL({currentUser:e}),o=PL({currentUser:e}),u=BL({currentUser:e}),h=$L({currentUser:e}),f=e6({currentUser:e}),m=YL({currentUser:e}),g=a6({currentUser:e}),_=g6({currentUser:e}),b=v6({currentUser:e}),x=w6({currentUser:e}),E=a.isScanning||o.isScanning||u.isScanning||h.isScanning||m.isScanning||f.isScanning||g.isScanning||b.isScanning,S=a.isRunning||o.isMigratingFeedback||u.isDeleting||h.isRunning||m.isRunning||f.isRunning||g.isRunning||b.isRunning,T=async()=>{await Promise.all([a.scanStatus(),o.scanStatus(),u.scanStatus(),h.scan(),f.scanStatus(),m.scanStatus(),g.scanStatus(),b.scanStatus()])};return c.jsxs("div",{children:[c.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[c.jsx("h2",{style:{margin:0},children:"Data Migrations"}),c.jsxs("button",{onClick:T,disabled:E||S,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:E||S?"not-allowed":"pointer",fontWeight:500,opacity:E||S?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[c.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:E?c.jsx(Ul,{noMargin:!0}):""}),"Refresh All"]})]}),c.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),c.jsx(DB,{hasData:!!_.status,status:_.status,report:_.report,hasViolations:_.hasViolations,violationCount:_.violationCount,isScanning:_.isScanning,onScan:_.scan,disabled:!e}),c.jsx(IB,{hasData:!!b.status,status:b.status,needsMigration:b.needsMigration,totalItemsToFix:b.totalItemsToFix,isRunning:b.isRunning,result:b.result,onRunMigration:b.runMigration,onRefresh:b.scanStatus,isRefreshing:b.isScanning,disabled:!e}),c.jsx(jB,{hasData:!!f.status,status:f.status,hasItemsToFix:f.hasItemsToFix,isRunning:f.isRunning,result:f.result,onRunMigration:f.runMigration,onRefresh:f.scanStatus,isRefreshing:f.isScanning,disabled:!e}),c.jsx(AB,{hasData:!!m.status,status:m.status,hasItemsToMigrate:m.hasItemsToMigrate,isRunning:m.isRunning,result:m.result,onRunMigration:m.runMigration,onRefresh:m.scanStatus,isRefreshing:m.isScanning,disabled:!e}),c.jsx(RB,{hasData:!!g.status,status:g.status,hasPairsToConvert:g.hasPairsToConvert,isRunning:g.isRunning,result:g.result,onRunMigration:g.runMigration,onRefresh:g.scanStatus,isRefreshing:g.isScanning,disabled:!e}),c.jsx(TB,{hasData:h.hasData,status:h.status,hasIssues:h.hasIssues,totalIssues:h.totalIssues,isRunning:h.isRunning,result:h.result,onRunCleanup:h.runCleanup,onRefresh:h.scan,isRefreshing:h.isScanning,disabled:!e}),c.jsx(nB,{hasData:!!a.status,status:a.status,hasIssues:a.hasIssues,totalIssues:a.totalIssues,isRunning:a.isRunning,result:a.result,onRunCleanup:a.runCleanup,onRefresh:a.scanStatus,isRefreshing:a.isScanning,disabled:!e}),c.jsx(rB,{hasData:!!o.status,status:o.status,isMigrating:o.isMigratingFeedback,onMigrate:o.migrateFeedbackDocuments,onRefresh:o.scanStatus,isRefreshing:o.isScanning,disabled:!e,migrationResult:o.feedbackMigrationResult}),c.jsx(_B,{hasData:!!u.status,monthsCount:u.status?.monthsCount??0,budgetCount:u.status?.budgetCount??0,monthsToDelete:u.status?.monthsToDelete??[],isDeleting:u.isDeleting,onDelete:u.deleteAllMonths,onRefresh:u.scanStatus,isRefreshing:u.isScanning,disabled:!e,deleteResult:u.deleteResult,deleteProgress:u.deleteProgress}),c.jsx(CB,{disabled:!e}),c.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem",border:"1px solid color-mix(in srgb, #17a2b8 30%, transparent)"},children:c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("h3",{style:{margin:"0 0 0.25rem 0",fontSize:"1rem",color:"#17a2b8"},children:" Diagnostic Download"}),c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Downloads all budget and month data as JSON for troubleshooting balance discrepancies. Includes stored vs calculated balances, transfers, adjustments, and full month breakdowns."}),x.error&&c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem",color:"#dc3545"},children:["Error: ",x.error]}),x.progress&&c.jsxs("div",{style:{marginTop:"0.5rem"},children:[c.jsx("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:c.jsx("div",{style:{background:"#17a2b8",height:"100%",width:`${x.progress.percentComplete}%`,transition:"width 0.3s"}})}),c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.7},children:[x.progress.phase==="reading"&&"Reading data from Firestore...",x.progress.phase==="analyzing"&&`Analyzing budget ${x.progress.current}/${x.progress.total}...`,x.progress.phase==="complete"&&"Download complete!"]})]})]}),c.jsx(Ie,{variant:"secondary",actionName:"Download Diagnostics",onClick:x.downloadDiagnostics,disabled:!e||x.isDownloading,style:{flexShrink:0},children:x.isDownloading?c.jsxs(c.Fragment,{children:[c.jsx(Ul,{noMargin:!0})," Downloading..."]}):" Download JSON"})]})}),c.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:c.jsxs("p",{style:{margin:0,opacity:.7},children:[c.jsx("strong",{children:"Note:"})," These migrations will process ",c.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),c.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, #ff6b6b 10%, transparent)",borderRadius:"8px",border:"1px solid color-mix(in srgb, #ff6b6b 30%, transparent)"},children:[c.jsxs("p",{style:{margin:"0 0 0.75rem 0",fontSize:"0.9rem"},children:[c.jsx("strong",{children:" Clear All Caches"}),c.jsx("span",{style:{opacity:.7,display:"block",marginTop:"0.25rem"},children:"If you're seeing stale data after running migrations, clear all cached data and reload to fetch fresh data from Firestore."})]}),c.jsx(Ie,{variant:"danger",actionName:"Open Clear Caches Modal",onClick:()=>r(!0),style:{display:"flex",alignItems:"center",gap:"0.4rem"},children:" Clear All Caches & Reload"})]}),c.jsxs(va,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[c.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data from localStorage and reload the page. The app will fetch fresh data from Firestore for everything."}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),c.jsx(Ie,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:r3,children:"Clear & Reload"})]})]})]})}function ml({name:t,description:e,expectedBehavior:n,result:r,onRun:a,disabled:o,expectedToSucceed:u}){const h=r?.status==="passed"?oe.success:r?.status==="failed"?oe.danger:r?.status==="running"?oe.warning:"inherit";return c.jsxs("div",{style:{...td,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),c.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),c.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:u?oe.success:oe.warning},children:["Expected: ",n]})]}),c.jsx(Ie,{onClick:a,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&c.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${h} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${h} 30%, transparent)`,fontSize:"0.85rem",color:h},children:r.message})]})}function s3({totalCount:t,passedCount:e,failedCount:n}){return c.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[c.jsxs("span",{children:["Total: ",c.jsx("strong",{children:t})]}),c.jsxs("span",{style:{color:oe.success},children:["Passed: ",c.jsx("strong",{children:e})]}),c.jsxs("span",{style:{color:oe.danger},children:["Failed: ",c.jsx("strong",{children:n})]})]})}const Uw=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function a3(){const{currentUserId:t}=Pt(),[e,n]=C.useState([]),[r,a]=C.useState(!1);function o(x,E){n(S=>S.map(T=>T.name===x?{...T,...E}:T))}async function u(x,E,S){o(x,{status:"running",message:"Running..."});try{const T=await E();S?o(x,{status:"failed",message:` ${T}`}):o(x,{status:"passed",message:` ${T}`})}catch(T){const D=T instanceof Error?T.message:"Unknown error";S?o(x,{status:"passed",message:` Blocked as expected: ${D}`}):o(x,{status:"failed",message:` ${D}`})}}async function h(){a(!0),n(Uw.map(x=>({...x,status:"pending",message:""})));for(const x of Uw)await f(x.name);a(!1)}async function f(x){switch(x){case"Read unauthorized budget":await u(x,async()=>(await We("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await u(x,async()=>(await We("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await u(x,async()=>(await We("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await u(x,async()=>{if(!t)throw new Error("Not authenticated");const{data:E}=await We("users",t,"security test: reading own user to get current is_admin value"),S=E?.permission_flags?.is_admin??!1;return await Pl("users",t,{"permission_flags.is_admin":!S},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${S} to ${!S} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await u(x,async()=>{if(!t)throw new Error("Not authenticated");const{data:E}=await We("users",t,"security test: reading own user to get current is_test value"),S=E?.permission_flags?.is_test??!1;return await Pl("users",t,{"permission_flags.is_test":!S},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${S} to ${!S} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await u(x,async()=>{if(!t)throw new Error("Not authenticated");const{exists:E}=await We("users",t,"security test: reading own user document (should succeed)");if(E)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function m(x){e.find(S=>S.name===x)||n(S=>[...S,{name:x,status:"pending",message:"",expectedToFail:!0}]),a(!0),await f(x),a(!1)}const g=e.filter(x=>x.status==="passed").length,_=e.filter(x=>x.status==="failed").length,b=e.length;return c.jsxs("div",{children:[c.jsx("p",{style:OT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),c.jsx("div",{style:{marginBottom:"1.5rem"},children:c.jsx(Ie,{onClick:h,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&c.jsx(s3,{totalCount:b,passedCount:g,failedCount:_}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[c.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),c.jsx(ml,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(x=>x.name==="Read unauthorized budget"),onRun:()=>m("Read unauthorized budget"),disabled:r}),c.jsx(ml,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(x=>x.name==="Read another user's document"),onRun:()=>m("Read another user's document"),disabled:r}),c.jsx(ml,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(x=>x.name==="Read unauthorized budget month"),onRun:()=>m("Read unauthorized budget month"),disabled:r}),c.jsx(ml,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(x=>x.name==="Toggle is_admin in own permission_flags"),onRun:()=>m("Toggle is_admin in own permission_flags"),disabled:r}),c.jsx(ml,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(x=>x.name==="Toggle is_test in own permission_flags"),onRun:()=>m("Toggle is_test in own permission_flags"),disabled:r}),c.jsx(ml,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(x=>x.name==="Read own user document"),onRun:()=>m("Read own user document"),disabled:r,expectedToSucceed:!0})]}),_>0&&c.jsxs(So,{style:{marginTop:"1.5rem"},children:[" ",_," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function o3({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=nr(),r=C.useContext(Zu),a=Bn();return C.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?c.jsx(c.Fragment,{children:t}):c.jsx(Nf,{}):c.jsx(Of,{to:"/account",state:{from:a.pathname},replace:!0}):null}function l3(){const{addLoadingHold:t,removeLoadingHold:e}=nr(),{selectedBudgetId:n,currentUserId:r,isInitialized:a,pageTitle:o}=Pt(),{isLoading:u,error:h}=Mn(n,r);return C.useEffect(()=>{a?e("budget-init"):t("budget-init",u?"Fetching data from server...":"Loading budget...")},[a,u,t,e]),C.useEffect(()=>()=>e("budget-init"),[e]),h?(console.error("[BudgetLayout] Error:",h),c.jsx("div",{style:Df,children:c.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",h.message]})})):c.jsx("div",{style:{...Df,paddingBottom:"5rem"},children:c.jsxs(qT,{children:[c.jsx(yB,{title:o}),a&&c.jsx(Nf,{})]})})}const c3={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function u3(){const{isLoading:t,loadingMessage:e}=nr();return t?c.jsx(nd,{message:e}):null}function d3(){const[t,e]=C.useState(c3),n=go(),r=C.useRef(!1),{addLoadingHold:a,removeLoadingHold:o}=nr();return C.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(u=>{e({is_logged_in:u!=null,is_auth_checked:!0,username:u?.email??"",set_user_context:e})}))},[n]),C.useEffect(()=>{t.is_auth_checked?o("auth"):a("auth","Authenticating...")},[t.is_auth_checked,a,o]),t.is_auth_checked?c.jsx(Zu.Provider,{value:t,children:c.jsx(Sk,{children:c.jsx(aL,{children:c.jsx(TL,{children:c.jsxs(d5,{children:[c.jsxs(UR,{children:[c.jsx(dn,{path:"/",element:c.jsx(kB,{})}),c.jsx(dn,{path:"/account",element:c.jsx(OB,{})}),c.jsx(dn,{path:"/budget",element:c.jsx(o3,{}),children:c.jsxs(dn,{element:c.jsx(l3,{}),children:[c.jsx(dn,{index:!0,element:c.jsx(Lw,{})}),c.jsx(dn,{path:":year/:month/:tab/:view?",element:c.jsx(Lw,{})}),c.jsx(dn,{path:"analytics",element:c.jsx(kz,{})}),c.jsx(dn,{path:"my-budgets",element:c.jsx(Bz,{})}),c.jsxs(dn,{path:"settings",element:c.jsx(Uz,{}),children:[c.jsx(dn,{index:!0,element:c.jsx(Of,{to:"categories",replace:!0})}),c.jsx(dn,{path:"accounts",element:c.jsx(Qz,{})}),c.jsx(dn,{path:"categories",element:c.jsx(Xz,{})}),c.jsx(dn,{path:"users",element:c.jsx(Jz,{})})]}),c.jsxs(dn,{path:"admin",element:c.jsx(e3,{}),children:[c.jsx(dn,{path:"budget",element:c.jsx(t3,{})}),c.jsx(dn,{path:"feedback",element:c.jsx(n3,{})}),c.jsx(dn,{path:"migration",element:c.jsx(i3,{})}),c.jsx(dn,{path:"tests",element:c.jsx(a3,{})})]})]})})]}),c.jsx(mB,{}),c.jsx(dB,{}),c.jsx(MB,{})]})})})})}):null}function h3(){return c.jsxs(w5,{children:[c.jsx(u3,{}),c.jsx(d3,{})]})}Uj.createRoot(document.getElementById("root")).render(c.jsx(C.StrictMode,{children:c.jsx(h3,{})}));
