(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var zh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function U2(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Eg={exports:{}},_u={};var Ax;function F2(){if(Ax)return _u;Ax=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,o){var l=null;if(o!==void 0&&(l=""+o),i.key!==void 0&&(l=""+i.key),"key"in i){o={};for(var d in i)d!=="key"&&(o[d]=i[d])}else o=i;return i=o.ref,{$$typeof:t,type:r,key:l,ref:i!==void 0?i:null,props:o}}return _u.Fragment=e,_u.jsx=n,_u.jsxs=n,_u}var jx;function V2(){return jx||(jx=1,Eg.exports=F2()),Eg.exports}var u=V2(),Tg={exports:{}},et={};var Rx;function $2(){if(Rx)return et;Rx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),v=Symbol.iterator;function _(L){return L===null||typeof L!="object"?null:(L=v&&L[v]||L["@@iterator"],typeof L=="function"?L:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function E(L,H,te){this.props=L,this.context=H,this.refs=S,this.updater=te||C}E.prototype.isReactComponent={},E.prototype.setState=function(L,H){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,H,"setState")},E.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};function T(){}T.prototype=E.prototype;function I(L,H,te){this.props=L,this.context=H,this.refs=S,this.updater=te||C}var D=I.prototype=new T;D.constructor=I,x(D,E.prototype),D.isPureReactComponent=!0;var B=Array.isArray;function $(){}var M={H:null,A:null,T:null,S:null},O=Object.prototype.hasOwnProperty;function N(L,H,te){var se=te.ref;return{$$typeof:t,type:L,key:H,ref:se!==void 0?se:null,props:te}}function F(L,H){return N(L.type,H,L.props)}function q(L){return typeof L=="object"&&L!==null&&L.$$typeof===t}function R(L){var H={"=":"=0",":":"=2"};return"$"+L.replace(/[=:]/g,function(te){return H[te]})}var P=/\/+/g;function A(L,H){return typeof L=="object"&&L!==null&&L.key!=null?R(""+L.key):H.toString(36)}function W(L){switch(L.status){case"fulfilled":return L.value;case"rejected":throw L.reason;default:switch(typeof L.status=="string"?L.then($,$):(L.status="pending",L.then(function(H){L.status==="pending"&&(L.status="fulfilled",L.value=H)},function(H){L.status==="pending"&&(L.status="rejected",L.reason=H)})),L.status){case"fulfilled":return L.value;case"rejected":throw L.reason}}throw L}function K(L,H,te,se,ne){var fe=typeof L;(fe==="undefined"||fe==="boolean")&&(L=null);var Ce=!1;if(L===null)Ce=!0;else switch(fe){case"bigint":case"string":case"number":Ce=!0;break;case"object":switch(L.$$typeof){case t:case e:Ce=!0;break;case p:return Ce=L._init,K(Ce(L._payload),H,te,se,ne)}}if(Ce)return ne=ne(L),Ce=se===""?"."+A(L,0):se,B(ne)?(te="",Ce!=null&&(te=Ce.replace(P,"$&/")+"/"),K(ne,H,te,"",function(Me){return Me})):ne!=null&&(q(ne)&&(ne=F(ne,te+(ne.key==null||L&&L.key===ne.key?"":(""+ne.key).replace(P,"$&/")+"/")+Ce)),H.push(ne)),1;Ce=0;var de=se===""?".":se+":";if(B(L))for(var be=0;be<L.length;be++)se=L[be],fe=de+A(se,be),Ce+=K(se,H,te,fe,ne);else if(be=_(L),typeof be=="function")for(L=be.call(L),be=0;!(se=L.next()).done;)se=se.value,fe=de+A(se,be++),Ce+=K(se,H,te,fe,ne);else if(fe==="object"){if(typeof L.then=="function")return K(W(L),H,te,se,ne);throw H=String(L),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.")}return Ce}function G(L,H,te){if(L==null)return L;var se=[],ne=0;return K(L,se,"","",function(fe){return H.call(te,fe,ne++)}),se}function J(L){if(L._status===-1){var H=L._result;H=H(),H.then(function(te){(L._status===0||L._status===-1)&&(L._status=1,L._result=te)},function(te){(L._status===0||L._status===-1)&&(L._status=2,L._result=te)}),L._status===-1&&(L._status=0,L._result=H)}if(L._status===1)return L._result.default;throw L._result}var X=typeof reportError=="function"?reportError:function(L){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var H=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof L=="object"&&L!==null&&typeof L.message=="string"?String(L.message):String(L),error:L});if(!window.dispatchEvent(H))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",L);return}console.error(L)},ie={map:G,forEach:function(L,H,te){G(L,function(){H.apply(this,arguments)},te)},count:function(L){var H=0;return G(L,function(){H++}),H},toArray:function(L){return G(L,function(H){return H})||[]},only:function(L){if(!q(L))throw Error("React.Children.only expected to receive a single React element child.");return L}};return et.Activity=g,et.Children=ie,et.Component=E,et.Fragment=n,et.Profiler=i,et.PureComponent=I,et.StrictMode=r,et.Suspense=h,et.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,et.__COMPILER_RUNTIME={__proto__:null,c:function(L){return M.H.useMemoCache(L)}},et.cache=function(L){return function(){return L.apply(null,arguments)}},et.cacheSignal=function(){return null},et.cloneElement=function(L,H,te){if(L==null)throw Error("The argument must be a React element, but you passed "+L+".");var se=x({},L.props),ne=L.key;if(H!=null)for(fe in H.key!==void 0&&(ne=""+H.key),H)!O.call(H,fe)||fe==="key"||fe==="__self"||fe==="__source"||fe==="ref"&&H.ref===void 0||(se[fe]=H[fe]);var fe=arguments.length-2;if(fe===1)se.children=te;else if(1<fe){for(var Ce=Array(fe),de=0;de<fe;de++)Ce[de]=arguments[de+2];se.children=Ce}return N(L.type,ne,se)},et.createContext=function(L){return L={$$typeof:l,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null},L.Provider=L,L.Consumer={$$typeof:o,_context:L},L},et.createElement=function(L,H,te){var se,ne={},fe=null;if(H!=null)for(se in H.key!==void 0&&(fe=""+H.key),H)O.call(H,se)&&se!=="key"&&se!=="__self"&&se!=="__source"&&(ne[se]=H[se]);var Ce=arguments.length-2;if(Ce===1)ne.children=te;else if(1<Ce){for(var de=Array(Ce),be=0;be<Ce;be++)de[be]=arguments[be+2];ne.children=de}if(L&&L.defaultProps)for(se in Ce=L.defaultProps,Ce)ne[se]===void 0&&(ne[se]=Ce[se]);return N(L,fe,ne)},et.createRef=function(){return{current:null}},et.forwardRef=function(L){return{$$typeof:d,render:L}},et.isValidElement=q,et.lazy=function(L){return{$$typeof:p,_payload:{_status:-1,_result:L},_init:J}},et.memo=function(L,H){return{$$typeof:m,type:L,compare:H===void 0?null:H}},et.startTransition=function(L){var H=M.T,te={};M.T=te;try{var se=L(),ne=M.S;ne!==null&&ne(te,se),typeof se=="object"&&se!==null&&typeof se.then=="function"&&se.then($,X)}catch(fe){X(fe)}finally{H!==null&&te.types!==null&&(H.types=te.types),M.T=H}},et.unstable_useCacheRefresh=function(){return M.H.useCacheRefresh()},et.use=function(L){return M.H.use(L)},et.useActionState=function(L,H,te){return M.H.useActionState(L,H,te)},et.useCallback=function(L,H){return M.H.useCallback(L,H)},et.useContext=function(L){return M.H.useContext(L)},et.useDebugValue=function(){},et.useDeferredValue=function(L,H){return M.H.useDeferredValue(L,H)},et.useEffect=function(L,H){return M.H.useEffect(L,H)},et.useEffectEvent=function(L){return M.H.useEffectEvent(L)},et.useId=function(){return M.H.useId()},et.useImperativeHandle=function(L,H,te){return M.H.useImperativeHandle(L,H,te)},et.useInsertionEffect=function(L,H){return M.H.useInsertionEffect(L,H)},et.useLayoutEffect=function(L,H){return M.H.useLayoutEffect(L,H)},et.useMemo=function(L,H){return M.H.useMemo(L,H)},et.useOptimistic=function(L,H){return M.H.useOptimistic(L,H)},et.useReducer=function(L,H,te){return M.H.useReducer(L,H,te)},et.useRef=function(L){return M.H.useRef(L)},et.useState=function(L){return M.H.useState(L)},et.useSyncExternalStore=function(L,H,te){return M.H.useSyncExternalStore(L,H,te)},et.useTransition=function(){return M.H.useTransition()},et.version="19.2.3",et}var Ix;function zy(){return Ix||(Ix=1,Tg.exports=$2()),Tg.exports}var k=zy(),Ag={exports:{}},bu={},jg={exports:{}},Rg={};var kx;function q2(){return kx||(kx=1,(function(t){function e(K,G){var J=K.length;K.push(G);e:for(;0<J;){var X=J-1>>>1,ie=K[X];if(0<i(ie,G))K[X]=G,K[J]=ie,J=X;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var G=K[0],J=K.pop();if(J!==G){K[0]=J;e:for(var X=0,ie=K.length,L=ie>>>1;X<L;){var H=2*(X+1)-1,te=K[H],se=H+1,ne=K[se];if(0>i(te,J))se<ie&&0>i(ne,te)?(K[X]=ne,K[se]=J,X=se):(K[X]=te,K[H]=J,X=H);else if(se<ie&&0>i(ne,J))K[X]=ne,K[se]=J,X=se;else break e}}return G}function i(K,G){var J=K.sortIndex-G.sortIndex;return J!==0?J:K.id-G.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,d=l.now();t.unstable_now=function(){return l.now()-d}}var h=[],m=[],p=1,g=null,v=3,_=!1,C=!1,x=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function D(K){for(var G=n(m);G!==null;){if(G.callback===null)r(m);else if(G.startTime<=K)r(m),G.sortIndex=G.expirationTime,e(h,G);else break;G=n(m)}}function B(K){if(x=!1,D(K),!C)if(n(h)!==null)C=!0,$||($=!0,R());else{var G=n(m);G!==null&&W(B,G.startTime-K)}}var $=!1,M=-1,O=5,N=-1;function F(){return S?!0:!(t.unstable_now()-N<O)}function q(){if(S=!1,$){var K=t.unstable_now();N=K;var G=!0;try{e:{C=!1,x&&(x=!1,T(M),M=-1),_=!0;var J=v;try{t:{for(D(K),g=n(h);g!==null&&!(g.expirationTime>K&&F());){var X=g.callback;if(typeof X=="function"){g.callback=null,v=g.priorityLevel;var ie=X(g.expirationTime<=K);if(K=t.unstable_now(),typeof ie=="function"){g.callback=ie,D(K),G=!0;break t}g===n(h)&&r(h),D(K)}else r(h);g=n(h)}if(g!==null)G=!0;else{var L=n(m);L!==null&&W(B,L.startTime-K),G=!1}}break e}finally{g=null,v=J,_=!1}G=void 0}}finally{G?R():$=!1}}}var R;if(typeof I=="function")R=function(){I(q)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,A=P.port2;P.port1.onmessage=q,R=function(){A.postMessage(null)}}else R=function(){E(q,0)};function W(K,G){M=E(function(){K(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(K){switch(v){case 1:case 2:case 3:var G=3;break;default:G=v}var J=v;v=G;try{return K()}finally{v=J}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(K,G){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var J=v;v=K;try{return G()}finally{v=J}},t.unstable_scheduleCallback=function(K,G,J){var X=t.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?X+J:X):J=X,K){case 1:var ie=-1;break;case 2:ie=250;break;case 5:ie=1073741823;break;case 4:ie=1e4;break;default:ie=5e3}return ie=J+ie,K={id:p++,callback:G,priorityLevel:K,startTime:J,expirationTime:ie,sortIndex:-1},J>X?(K.sortIndex=J,e(m,K),n(h)===null&&K===n(m)&&(x?(T(M),M=-1):x=!0,W(B,J-X))):(K.sortIndex=ie,e(h,K),C||_||(C=!0,$||($=!0,R()))),K},t.unstable_shouldYield=F,t.unstable_wrapCallback=function(K){var G=v;return function(){var J=v;v=G;try{return K.apply(this,arguments)}finally{v=J}}}})(Rg)),Rg}var Dx;function H2(){return Dx||(Dx=1,jg.exports=q2()),jg.exports}var Ig={exports:{}},Zn={};var Mx;function G2(){if(Mx)return Zn;Mx=1;var t=zy();function e(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)m+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(h,m,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:m,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,m){if(h==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return Zn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Zn.createPortal=function(h,m){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return o(h,m,null,p)},Zn.flushSync=function(h){var m=l.T,p=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=m,r.p=p,r.d.f()}},Zn.preconnect=function(h,m){typeof h=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,r.d.C(h,m))},Zn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Zn.preinit=function(h,m){if(typeof h=="string"&&m&&typeof m.as=="string"){var p=m.as,g=d(p,m.crossOrigin),v=typeof m.integrity=="string"?m.integrity:void 0,_=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;p==="style"?r.d.S(h,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:_}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:v,fetchPriority:_,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},Zn.preinitModule=function(h,m){if(typeof h=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var p=d(m.as,m.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&r.d.M(h)},Zn.preload=function(h,m){if(typeof h=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var p=m.as,g=d(p,m.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},Zn.preloadModule=function(h,m){if(typeof h=="string")if(m){var p=d(m.as,m.crossOrigin);r.d.m(h,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else r.d.m(h)},Zn.requestFormReset=function(h){r.d.r(h)},Zn.unstable_batchedUpdates=function(h,m){return h(m)},Zn.useFormState=function(h,m,p){return l.H.useFormState(h,m,p)},Zn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Zn.version="19.2.3",Zn}var Ox;function Q2(){if(Ox)return Ig.exports;Ox=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ig.exports=G2(),Ig.exports}var Nx;function W2(){if(Nx)return bu;Nx=1;var t=H2(),e=zy(),n=Q2();function r(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function l(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function d(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function m(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(r(188));return a!==s?null:s}for(var c=s,f=a;;){var b=c.return;if(b===null)break;var w=b.alternate;if(w===null){if(f=b.return,f!==null){c=f;continue}break}if(b.child===w.child){for(w=b.child;w;){if(w===c)return h(b),s;if(w===f)return h(b),a;w=w.sibling}throw Error(r(188))}if(c.return!==f.return)c=b,f=w;else{for(var z=!1,Q=b.child;Q;){if(Q===c){z=!0,c=b,f=w;break}if(Q===f){z=!0,f=b,c=w;break}Q=Q.sibling}if(!z){for(Q=w.child;Q;){if(Q===c){z=!0,c=w,f=b;break}if(Q===f){z=!0,f=w,c=b;break}Q=Q.sibling}if(!z)throw Error(r(189))}}if(c.alternate!==f)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?s:a}function p(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=p(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,v=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),I=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),q=Symbol.iterator;function R(s){return s===null||typeof s!="object"?null:(s=q&&s[q]||s["@@iterator"],typeof s=="function"?s:null)}var P=Symbol.for("react.client.reference");function A(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===P?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case x:return"Fragment";case E:return"Profiler";case S:return"StrictMode";case B:return"Suspense";case $:return"SuspenseList";case N:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case C:return"Portal";case I:return s.displayName||"Context";case T:return(s._context.displayName||"Context")+".Consumer";case D:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case M:return a=s.displayName||null,a!==null?a:A(s.type)||"Memo";case O:a=s._payload,s=s._init;try{return A(s(a))}catch{}}return null}var W=Array.isArray,K=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J={pending:!1,data:null,method:null,action:null},X=[],ie=-1;function L(s){return{current:s}}function H(s){0>ie||(s.current=X[ie],X[ie]=null,ie--)}function te(s,a){ie++,X[ie]=s.current,s.current=a}var se=L(null),ne=L(null),fe=L(null),Ce=L(null);function de(s,a){switch(te(fe,a),te(ne,s),te(se,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?Yv(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=Yv(a),s=Xv(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}H(se),te(se,s)}function be(){H(se),H(ne),H(fe)}function Me(s){s.memoizedState!==null&&te(Ce,s);var a=se.current,c=Xv(a,s.type);a!==c&&(te(ne,s),te(se,c))}function Oe(s){ne.current===s&&(H(se),H(ne)),Ce.current===s&&(H(Ce),mu._currentValue=J)}var qe,ot;function U(s){if(qe===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);qe=a&&a[1]||"",ot=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+qe+s+ot}var ce=!1;function ye(s,a){if(!s||ce)return"";ce=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(a){var Ie=function(){throw Error()};if(Object.defineProperty(Ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ie,[])}catch(xe){var _e=xe}Reflect.construct(s,[],Ie)}else{try{Ie.call()}catch(xe){_e=xe}s.call(Ie.prototype)}}else{try{throw Error()}catch(xe){_e=xe}(Ie=s())&&typeof Ie.catch=="function"&&Ie.catch(function(){})}}catch(xe){if(xe&&_e&&typeof xe.stack=="string")return[xe.stack,_e.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=f.DetermineComponentFrameRoot(),z=w[0],Q=w[1];if(z&&Q){var re=z.split(`
`),ge=Q.split(`
`);for(b=f=0;f<re.length&&!re[f].includes("DetermineComponentFrameRoot");)f++;for(;b<ge.length&&!ge[b].includes("DetermineComponentFrameRoot");)b++;if(f===re.length||b===ge.length)for(f=re.length-1,b=ge.length-1;1<=f&&0<=b&&re[f]!==ge[b];)b--;for(;1<=f&&0<=b;f--,b--)if(re[f]!==ge[b]){if(f!==1||b!==1)do if(f--,b--,0>b||re[f]!==ge[b]){var Ee=`
`+re[f].replace(" at new "," at ");return s.displayName&&Ee.includes("<anonymous>")&&(Ee=Ee.replace("<anonymous>",s.displayName)),Ee}while(1<=f&&0<=b);break}}}finally{ce=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?U(c):""}function ee(s,a){switch(s.tag){case 26:case 27:case 5:return U(s.type);case 16:return U("Lazy");case 13:return s.child!==a&&a!==null?U("Suspense Fallback"):U("Suspense");case 19:return U("SuspenseList");case 0:case 15:return ye(s.type,!1);case 11:return ye(s.type.render,!1);case 1:return ye(s.type,!0);case 31:return U("Activity");default:return""}}function Z(s){try{var a="",c=null;do a+=ee(s,c),c=s,s=s.return;while(s);return a}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var oe=Object.prototype.hasOwnProperty,Se=t.unstable_scheduleCallback,we=t.unstable_cancelCallback,ae=t.unstable_shouldYield,Ae=t.unstable_requestPaint,Ne=t.unstable_now,De=t.unstable_getCurrentPriorityLevel,He=t.unstable_ImmediatePriority,wt=t.unstable_UserBlockingPriority,nt=t.unstable_NormalPriority,Yn=t.unstable_LowPriority,gs=t.unstable_IdlePriority,rr=t.log,ys=t.unstable_setDisableYieldValue,xt=null,nn=null;function Xn(s){if(typeof rr=="function"&&ys(s),nn&&typeof nn.setStrictMode=="function")try{nn.setStrictMode(xt,s)}catch{}}var Tt=Math.clz32?Math.clz32:$o,Va=Math.log,Ii=Math.LN2;function $o(s){return s>>>=0,s===0?32:31-(Va(s)/Ii|0)|0}var Dr=256,_s=262144,Ft=4194304;function sr(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function bs(s,a,c){var f=s.pendingLanes;if(f===0)return 0;var b=0,w=s.suspendedLanes,z=s.pingedLanes;s=s.warmLanes;var Q=f&134217727;return Q!==0?(f=Q&~w,f!==0?b=sr(f):(z&=Q,z!==0?b=sr(z):c||(c=Q&~s,c!==0&&(b=sr(c))))):(Q=f&~w,Q!==0?b=sr(Q):z!==0?b=sr(z):c||(c=f&~s,c!==0&&(b=sr(c)))),b===0?0:a!==0&&a!==b&&(a&w)===0&&(w=b&-b,c=a&-a,w>=c||w===32&&(c&4194048)!==0)?a:b}function Yr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function Rm(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function md(){var s=Ft;return Ft<<=1,(Ft&62914560)===0&&(Ft=4194304),s}function vs(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function $a(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Im(s,a,c,f,b,w){var z=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var Q=s.entanglements,re=s.expirationTimes,ge=s.hiddenUpdates;for(c=z&~c;0<c;){var Ee=31-Tt(c),Ie=1<<Ee;Q[Ee]=0,re[Ee]=-1;var _e=ge[Ee];if(_e!==null)for(ge[Ee]=null,Ee=0;Ee<_e.length;Ee++){var xe=_e[Ee];xe!==null&&(xe.lane&=-536870913)}c&=~Ie}f!==0&&qa(s,f,0),w!==0&&b===0&&s.tag!==0&&(s.suspendedLanes|=w&~(z&~a))}function qa(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var f=31-Tt(a);s.entangledLanes|=a,s.entanglements[f]=s.entanglements[f]|1073741824|c&261930}function bc(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var f=31-Tt(c),b=1<<f;b&a|s[f]&a&&(s[f]|=a),c&=~b}}function vc(s,a){var c=a&-a;return c=(c&42)!==0?1:Ha(c),(c&(s.suspendedLanes|a))!==0?0:c}function Ha(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Ys(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function pd(){var s=G.p;return s!==0?s:(s=window.event,s===void 0?32:vx(s.type))}function Xr(s,a){var c=G.p;try{return G.p=s,a()}finally{G.p=c}}var Zr=Math.random().toString(36).slice(2),fn="__reactFiber$"+Zr,kn="__reactProps$"+Zr,xs="__reactContainer$"+Zr,qo="__reactEvents$"+Zr,km="__reactListeners$"+Zr,gd="__reactHandles$"+Zr,yd="__reactResources$"+Zr,ws="__reactMarker$"+Zr;function Ho(s){delete s[fn],delete s[kn],delete s[qo],delete s[km],delete s[gd]}function Ss(s){var a=s[fn];if(a)return a;for(var c=s.parentNode;c;){if(a=c[xs]||c[fn]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=sx(s);s!==null;){if(c=s[fn])return c;s=sx(s)}return a}s=c,c=s.parentNode}return null}function Mr(s){if(s=s[fn]||s[xs]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function vr(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(r(33))}function Cs(s){var a=s[yd];return a||(a=s[yd]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function mn(s){s[ws]=!0}var xc=new Set,wc={};function Es(s,a){Ts(s,a),Ts(s+"Capture",a)}function Ts(s,a){for(wc[s]=a,s=0;s<a.length;s++)xc.add(a[s])}var Sc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Cc={},Ec={};function _d(s){return oe.call(Ec,s)?!0:oe.call(Cc,s)?!1:Sc.test(s)?Ec[s]=!0:(Cc[s]=!0,!1)}function Go(s,a,c){if(_d(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var f=a.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function xr(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function pn(s,a,c,f){if(f===null)s.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+f)}}function Dn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function ki(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Tc(s,a,c){var f=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var b=f.get,w=f.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return b.call(this)},set:function(z){c=""+z,w.call(this,z)}}),Object.defineProperty(s,a,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(z){c=""+z},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function It(s){if(!s._valueTracker){var a=ki(s)?"checked":"value";s._valueTracker=Tc(s,a,""+s[a])}}function Ga(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),f="";return s&&(f=ki(s)?s.checked?"true":"false":s.value),s=f,s!==c?(a.setValue(s),!0):!1}function As(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Qa=/[\n"\\]/g;function lr(s){return s.replace(Qa,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Qo(s,a,c,f,b,w,z,Q){s.name="",z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?s.type=z:s.removeAttribute("type"),a!=null?z==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+Dn(a)):s.value!==""+Dn(a)&&(s.value=""+Dn(a)):z!=="submit"&&z!=="reset"||s.removeAttribute("value"),a!=null?Ac(s,z,Dn(a)):c!=null?Ac(s,z,Dn(c)):f!=null&&s.removeAttribute("value"),b==null&&w!=null&&(s.defaultChecked=!!w),b!=null&&(s.checked=b&&typeof b!="function"&&typeof b!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?s.name=""+Dn(Q):s.removeAttribute("name")}function bd(s,a,c,f,b,w,z,Q){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(s.type=w),a!=null||c!=null){if(!(w!=="submit"&&w!=="reset"||a!=null)){It(s);return}c=c!=null?""+Dn(c):"",a=a!=null?""+Dn(a):c,Q||a===s.value||(s.value=a),s.defaultValue=a}f=f??b,f=typeof f!="function"&&typeof f!="symbol"&&!!f,s.checked=Q?s.checked:!!f,s.defaultChecked=!!f,z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(s.name=z),It(s)}function Ac(s,a,c){a==="number"&&As(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function Di(s,a,c,f){if(s=s.options,a){a={};for(var b=0;b<c.length;b++)a["$"+c[b]]=!0;for(c=0;c<s.length;c++)b=a.hasOwnProperty("$"+s[c].value),s[c].selected!==b&&(s[c].selected=b),b&&f&&(s[c].defaultSelected=!0)}else{for(c=""+Dn(c),a=null,b=0;b<s.length;b++){if(s[b].value===c){s[b].selected=!0,f&&(s[b].defaultSelected=!0);return}a!==null||s[b].disabled||(a=s[b])}a!==null&&(a.selected=!0)}}function vd(s,a,c){if(a!=null&&(a=""+Dn(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+Dn(c):""}function Mi(s,a,c,f){if(a==null){if(f!=null){if(c!=null)throw Error(r(92));if(W(f)){if(1<f.length)throw Error(r(93));f=f[0]}c=f}c==null&&(c=""),a=c}c=Dn(a),s.defaultValue=c,f=s.textContent,f===c&&f!==""&&f!==null&&(s.value=f),It(s)}function cr(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var xd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function jc(s,a,c){var f=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":f?s.setProperty(a,c):typeof c!="number"||c===0||xd.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Rc(s,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(s=s.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||a!=null&&a.hasOwnProperty(f)||(f.indexOf("--")===0?s.setProperty(f,""):f==="float"?s.cssFloat="":s[f]="");for(var b in a)f=a[b],a.hasOwnProperty(b)&&c[b]!==f&&jc(s,b,f)}else for(var w in a)a.hasOwnProperty(w)&&jc(s,w,a[w])}function Wo(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Oi=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ko(s){return Oi.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Jr(){}var Ic=null;function Or(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Ni=null,js=null;function Wa(s){var a=Mr(s);if(a&&(s=a.stateNode)){var c=s[kn]||null;e:switch(s=a.stateNode,a.type){case"input":if(Qo(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+lr(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var f=c[a];if(f!==s&&f.form===s.form){var b=f[kn]||null;if(!b)throw Error(r(90));Qo(f,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(a=0;a<c.length;a++)f=c[a],f.form===s.form&&Ga(f)}break e;case"textarea":vd(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Di(s,!!c.multiple,a,!1)}}}var Yo=!1;function Pi(s,a,c){if(Yo)return s(a,c);Yo=!0;try{var f=s(a);return f}finally{if(Yo=!1,(Ni!==null||js!==null)&&(ph(),Ni&&(a=Ni,s=js,js=Ni=null,Wa(a),s)))for(a=0;a<s.length;a++)Wa(s[a])}}function es(s,a){var c=s.stateNode;if(c===null)return null;var f=c[kn]||null;if(f===null)return null;c=f[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var Nr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ka=!1;if(Nr)try{var Mt={};Object.defineProperty(Mt,"passive",{get:function(){Ka=!0}}),window.addEventListener("test",Mt,Mt),window.removeEventListener("test",Mt,Mt)}catch{Ka=!1}var Rs=null,kc=null,Ya=null;function Dc(){if(Ya)return Ya;var s,a=kc,c=a.length,f,b="value"in Rs?Rs.value:Rs.textContent,w=b.length;for(s=0;s<c&&a[s]===b[s];s++);var z=c-s;for(f=1;f<=z&&a[c-f]===b[w-f];f++);return Ya=b.slice(s,1<f?1-f:void 0)}function Xa(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Xs(){return!0}function ts(){return!1}function zn(s){function a(c,f,b,w,z){this._reactName=c,this._targetInst=b,this.type=f,this.nativeEvent=w,this.target=z,this.currentTarget=null;for(var Q in s)s.hasOwnProperty(Q)&&(c=s[Q],this[Q]=c?c(w):w[Q]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Xs:ts,this.isPropagationStopped=ts,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Xs)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Xs)},persist:function(){},isPersistent:Xs}),a}var Zs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Is=zn(Zs),zi=g({},Zs,{view:0,detail:0}),Mc=zn(zi),Bi,Xo,ks,Zo=g({},zi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Li,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==ks&&(ks&&s.type==="mousemove"?(Bi=s.screenX-ks.screenX,Xo=s.screenY-ks.screenY):Xo=Bi=0,ks=s),Bi)},movementY:function(s){return"movementY"in s?s.movementY:Xo}}),Oc=zn(Zo),Za=g({},Zo,{dataTransfer:0}),Sd=zn(Za),Cd=g({},zi,{relatedTarget:0}),Ja=zn(Cd),Nc=g({},Zs,{animationName:0,elapsedTime:0,pseudoElement:0}),Ed=zn(Nc),Jo=g({},Zs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Td=zn(Jo),Ad=g({},Zs,{data:0}),Ds=zn(Ad),jd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Id={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kd(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=Id[s])?!!a[s]:!1}function Li(){return kd}var ir=g({},zi,{key:function(s){if(s.key){var a=jd[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=Xa(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Rd[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Li,charCode:function(s){return s.type==="keypress"?Xa(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Xa(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Dd=zn(ir),Md=g({},Zo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Js=zn(Md),y=g({},zi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Li}),j=zn(y),V=g({},Zs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Y=zn(V),he=g({},Zo,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),ve=zn(he),Pe=g({},Zs,{newState:0,oldState:0}),it=zn(Pe),an=[9,13,27,32],At=Nr&&"CompositionEvent"in window,Wt=null;Nr&&"documentMode"in document&&(Wt=document.documentMode);var Pr=Nr&&"TextEvent"in window&&!Wt,Ms=Nr&&(!At||Wt&&8<Wt&&11>=Wt),ns=" ",rs=!1;function eo(s,a){switch(s){case"keyup":return an.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function el(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var tl=!1;function uA(s,a){switch(s){case"compositionend":return el(a);case"keypress":return a.which!==32?null:(rs=!0,ns);case"textInput":return s=a.data,s===ns&&rs?null:s;default:return null}}function dA(s,a){if(tl)return s==="compositionend"||!At&&eo(s,a)?(s=Dc(),Ya=kc=Rs=null,tl=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Ms&&a.locale!=="ko"?null:a.data;default:return null}}var hA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function o_(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!hA[s.type]:a==="textarea"}function l_(s,a,c,f){Ni?js?js.push(f):js=[f]:Ni=f,a=wh(a,"onChange"),0<a.length&&(c=new Is("onChange","change",null,c,f),s.push({event:c,listeners:a}))}var Pc=null,zc=null;function fA(s){qv(s,0)}function Od(s){var a=vr(s);if(Ga(a))return s}function c_(s,a){if(s==="change")return a}var u_=!1;if(Nr){var Dm;if(Nr){var Mm="oninput"in document;if(!Mm){var d_=document.createElement("div");d_.setAttribute("oninput","return;"),Mm=typeof d_.oninput=="function"}Dm=Mm}else Dm=!1;u_=Dm&&(!document.documentMode||9<document.documentMode)}function h_(){Pc&&(Pc.detachEvent("onpropertychange",f_),zc=Pc=null)}function f_(s){if(s.propertyName==="value"&&Od(zc)){var a=[];l_(a,zc,s,Or(s)),Pi(fA,a)}}function mA(s,a,c){s==="focusin"?(h_(),Pc=a,zc=c,Pc.attachEvent("onpropertychange",f_)):s==="focusout"&&h_()}function pA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Od(zc)}function gA(s,a){if(s==="click")return Od(a)}function yA(s,a){if(s==="input"||s==="change")return Od(a)}function _A(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var wr=typeof Object.is=="function"?Object.is:_A;function Bc(s,a){if(wr(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),f=Object.keys(a);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var b=c[f];if(!oe.call(a,b)||!wr(s[b],a[b]))return!1}return!0}function m_(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function p_(s,a){var c=m_(s);s=0;for(var f;c;){if(c.nodeType===3){if(f=s+c.textContent.length,s<=a&&f>=a)return{node:c,offset:a-s};s=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=m_(c)}}function g_(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?g_(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function y_(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=As(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=As(s.document)}return a}function Om(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var bA=Nr&&"documentMode"in document&&11>=document.documentMode,nl=null,Nm=null,Lc=null,Pm=!1;function __(s,a,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Pm||nl==null||nl!==As(f)||(f=nl,"selectionStart"in f&&Om(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Lc&&Bc(Lc,f)||(Lc=f,f=wh(Nm,"onSelect"),0<f.length&&(a=new Is("onSelect","select",null,a,c),s.push({event:a,listeners:f}),a.target=nl)))}function to(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var rl={animationend:to("Animation","AnimationEnd"),animationiteration:to("Animation","AnimationIteration"),animationstart:to("Animation","AnimationStart"),transitionrun:to("Transition","TransitionRun"),transitionstart:to("Transition","TransitionStart"),transitioncancel:to("Transition","TransitionCancel"),transitionend:to("Transition","TransitionEnd")},zm={},b_={};Nr&&(b_=document.createElement("div").style,"AnimationEvent"in window||(delete rl.animationend.animation,delete rl.animationiteration.animation,delete rl.animationstart.animation),"TransitionEvent"in window||delete rl.transitionend.transition);function no(s){if(zm[s])return zm[s];if(!rl[s])return s;var a=rl[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in b_)return zm[s]=a[c];return s}var v_=no("animationend"),x_=no("animationiteration"),w_=no("animationstart"),vA=no("transitionrun"),xA=no("transitionstart"),wA=no("transitioncancel"),S_=no("transitionend"),C_=new Map,Bm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Bm.push("scrollEnd");function ss(s,a){C_.set(s,a),Es(a,[s])}var Nd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},zr=[],sl=0,Lm=0;function Pd(){for(var s=sl,a=Lm=sl=0;a<s;){var c=zr[a];zr[a++]=null;var f=zr[a];zr[a++]=null;var b=zr[a];zr[a++]=null;var w=zr[a];if(zr[a++]=null,f!==null&&b!==null){var z=f.pending;z===null?b.next=b:(b.next=z.next,z.next=b),f.pending=b}w!==0&&E_(c,b,w)}}function zd(s,a,c,f){zr[sl++]=s,zr[sl++]=a,zr[sl++]=c,zr[sl++]=f,Lm|=f,s.lanes|=f,s=s.alternate,s!==null&&(s.lanes|=f)}function Um(s,a,c,f){return zd(s,a,c,f),Bd(s)}function ro(s,a){return zd(s,null,null,a),Bd(s)}function E_(s,a,c){s.lanes|=c;var f=s.alternate;f!==null&&(f.lanes|=c);for(var b=!1,w=s.return;w!==null;)w.childLanes|=c,f=w.alternate,f!==null&&(f.childLanes|=c),w.tag===22&&(s=w.stateNode,s===null||s._visibility&1||(b=!0)),s=w,w=w.return;return s.tag===3?(w=s.stateNode,b&&a!==null&&(b=31-Tt(c),s=w.hiddenUpdates,f=s[b],f===null?s[b]=[a]:f.push(a),a.lane=c|536870912),w):null}function Bd(s){if(50<ou)throw ou=0,Kp=null,Error(r(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var il={};function SA(s,a,c,f){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sr(s,a,c,f){return new SA(s,a,c,f)}function Fm(s){return s=s.prototype,!(!s||!s.isReactComponent)}function ei(s,a){var c=s.alternate;return c===null?(c=Sr(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function T_(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Ld(s,a,c,f,b,w){var z=0;if(f=s,typeof s=="function")Fm(s)&&(z=1);else if(typeof s=="string")z=j2(s,c,se.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case N:return s=Sr(31,c,a,b),s.elementType=N,s.lanes=w,s;case x:return so(c.children,b,w,a);case S:z=8,b|=24;break;case E:return s=Sr(12,c,a,b|2),s.elementType=E,s.lanes=w,s;case B:return s=Sr(13,c,a,b),s.elementType=B,s.lanes=w,s;case $:return s=Sr(19,c,a,b),s.elementType=$,s.lanes=w,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case I:z=10;break e;case T:z=9;break e;case D:z=11;break e;case M:z=14;break e;case O:z=16,f=null;break e}z=29,c=Error(r(130,s===null?"null":typeof s,"")),f=null}return a=Sr(z,c,a,b),a.elementType=s,a.type=f,a.lanes=w,a}function so(s,a,c,f){return s=Sr(7,s,f,a),s.lanes=c,s}function Vm(s,a,c){return s=Sr(6,s,null,a),s.lanes=c,s}function A_(s){var a=Sr(18,null,null,0);return a.stateNode=s,a}function $m(s,a,c){return a=Sr(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var j_=new WeakMap;function Br(s,a){if(typeof s=="object"&&s!==null){var c=j_.get(s);return c!==void 0?c:(a={value:s,source:a,stack:Z(a)},j_.set(s,a),a)}return{value:s,source:a,stack:Z(a)}}var al=[],ol=0,Ud=null,Uc=0,Lr=[],Ur=0,Ui=null,Os=1,Ns="";function ti(s,a){al[ol++]=Uc,al[ol++]=Ud,Ud=s,Uc=a}function R_(s,a,c){Lr[Ur++]=Os,Lr[Ur++]=Ns,Lr[Ur++]=Ui,Ui=s;var f=Os;s=Ns;var b=32-Tt(f)-1;f&=~(1<<b),c+=1;var w=32-Tt(a)+b;if(30<w){var z=b-b%5;w=(f&(1<<z)-1).toString(32),f>>=z,b-=z,Os=1<<32-Tt(a)+b|c<<b|f,Ns=w+s}else Os=1<<w|c<<b|f,Ns=s}function qm(s){s.return!==null&&(ti(s,1),R_(s,1,0))}function Hm(s){for(;s===Ud;)Ud=al[--ol],al[ol]=null,Uc=al[--ol],al[ol]=null;for(;s===Ui;)Ui=Lr[--Ur],Lr[Ur]=null,Ns=Lr[--Ur],Lr[Ur]=null,Os=Lr[--Ur],Lr[Ur]=null}function I_(s,a){Lr[Ur++]=Os,Lr[Ur++]=Ns,Lr[Ur++]=Ui,Os=a.id,Ns=a.overflow,Ui=s}var Bn=null,qt=null,_t=!1,Fi=null,Fr=!1,Gm=Error(r(519));function Vi(s){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Fc(Br(a,s)),Gm}function k_(s){var a=s.stateNode,c=s.type,f=s.memoizedProps;switch(a[fn]=s,a[kn]=f,c){case"dialog":dt("cancel",a),dt("close",a);break;case"iframe":case"object":case"embed":dt("load",a);break;case"video":case"audio":for(c=0;c<cu.length;c++)dt(cu[c],a);break;case"source":dt("error",a);break;case"img":case"image":case"link":dt("error",a),dt("load",a);break;case"details":dt("toggle",a);break;case"input":dt("invalid",a),bd(a,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":dt("invalid",a);break;case"textarea":dt("invalid",a),Mi(a,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||f.suppressHydrationWarning===!0||Wv(a.textContent,c)?(f.popover!=null&&(dt("beforetoggle",a),dt("toggle",a)),f.onScroll!=null&&dt("scroll",a),f.onScrollEnd!=null&&dt("scrollend",a),f.onClick!=null&&(a.onclick=Jr),a=!0):a=!1,a||Vi(s,!0)}function D_(s){for(Bn=s.return;Bn;)switch(Bn.tag){case 5:case 31:case 13:Fr=!1;return;case 27:case 3:Fr=!0;return;default:Bn=Bn.return}}function ll(s){if(s!==Bn)return!1;if(!_t)return D_(s),_t=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||ug(s.type,s.memoizedProps)),c=!c),c&&qt&&Vi(s),D_(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));qt=rx(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));qt=rx(s)}else a===27?(a=qt,na(s.type)?(s=pg,pg=null,qt=s):qt=a):qt=Bn?$r(s.stateNode.nextSibling):null;return!0}function io(){qt=Bn=null,_t=!1}function Qm(){var s=Fi;return s!==null&&(fr===null?fr=s:fr.push.apply(fr,s),Fi=null),s}function Fc(s){Fi===null?Fi=[s]:Fi.push(s)}var Wm=L(null),ao=null,ni=null;function $i(s,a,c){te(Wm,a._currentValue),a._currentValue=c}function ri(s){s._currentValue=Wm.current,H(Wm)}function Km(s,a,c){for(;s!==null;){var f=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,f!==null&&(f.childLanes|=a)):f!==null&&(f.childLanes&a)!==a&&(f.childLanes|=a),s===c)break;s=s.return}}function Ym(s,a,c,f){var b=s.child;for(b!==null&&(b.return=s);b!==null;){var w=b.dependencies;if(w!==null){var z=b.child;w=w.firstContext;e:for(;w!==null;){var Q=w;w=b;for(var re=0;re<a.length;re++)if(Q.context===a[re]){w.lanes|=c,Q=w.alternate,Q!==null&&(Q.lanes|=c),Km(w.return,c,s),f||(z=null);break e}w=Q.next}}else if(b.tag===18){if(z=b.return,z===null)throw Error(r(341));z.lanes|=c,w=z.alternate,w!==null&&(w.lanes|=c),Km(z,c,s),z=null}else z=b.child;if(z!==null)z.return=b;else for(z=b;z!==null;){if(z===s){z=null;break}if(b=z.sibling,b!==null){b.return=z.return,z=b;break}z=z.return}b=z}}function cl(s,a,c,f){s=null;for(var b=a,w=!1;b!==null;){if(!w){if((b.flags&524288)!==0)w=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var z=b.alternate;if(z===null)throw Error(r(387));if(z=z.memoizedProps,z!==null){var Q=b.type;wr(b.pendingProps.value,z.value)||(s!==null?s.push(Q):s=[Q])}}else if(b===Ce.current){if(z=b.alternate,z===null)throw Error(r(387));z.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(s!==null?s.push(mu):s=[mu])}b=b.return}s!==null&&Ym(a,s,c,f),a.flags|=262144}function Fd(s){for(s=s.firstContext;s!==null;){if(!wr(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function oo(s){ao=s,ni=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Ln(s){return M_(ao,s)}function Vd(s,a){return ao===null&&oo(s),M_(s,a)}function M_(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},ni===null){if(s===null)throw Error(r(308));ni=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else ni=ni.next=a;return c}var CA=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,f){s.push(f)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},EA=t.unstable_scheduleCallback,TA=t.unstable_NormalPriority,gn={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xm(){return{controller:new CA,data:new Map,refCount:0}}function Vc(s){s.refCount--,s.refCount===0&&EA(TA,function(){s.controller.abort()})}var $c=null,Zm=0,ul=0,dl=null;function AA(s,a){if($c===null){var c=$c=[];Zm=0,ul=tg(),dl={status:"pending",value:void 0,then:function(f){c.push(f)}}}return Zm++,a.then(O_,O_),a}function O_(){if(--Zm===0&&$c!==null){dl!==null&&(dl.status="fulfilled");var s=$c;$c=null,ul=0,dl=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function jA(s,a){var c=[],f={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return s.then(function(){f.status="fulfilled",f.value=a;for(var b=0;b<c.length;b++)(0,c[b])(a)},function(b){for(f.status="rejected",f.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),f}var N_=K.S;K.S=function(s,a){_v=Ne(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&AA(s,a),N_!==null&&N_(s,a)};var lo=L(null);function Jm(){var s=lo.current;return s!==null?s:Ut.pooledCache}function $d(s,a){a===null?te(lo,lo.current):te(lo,a.pool)}function P_(){var s=Jm();return s===null?null:{parent:gn._currentValue,pool:s}}var hl=Error(r(460)),ep=Error(r(474)),qd=Error(r(542)),Hd={then:function(){}};function z_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function B_(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(Jr,Jr),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,U_(s),s;default:if(typeof a.status=="string")a.then(Jr,Jr);else{if(s=Ut,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=a,s.status="pending",s.then(function(f){if(a.status==="pending"){var b=a;b.status="fulfilled",b.value=f}},function(f){if(a.status==="pending"){var b=a;b.status="rejected",b.reason=f}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,U_(s),s}throw uo=a,hl}}function co(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(uo=c,hl):c}}var uo=null;function L_(){if(uo===null)throw Error(r(459));var s=uo;return uo=null,s}function U_(s){if(s===hl||s===qd)throw Error(r(483))}var fl=null,qc=0;function Gd(s){var a=qc;return qc+=1,fl===null&&(fl=[]),B_(fl,s,a)}function Hc(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function Qd(s,a){throw a.$$typeof===v?Error(r(525)):(s=Object.prototype.toString.call(a),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function F_(s){function a(ue,le){if(s){var pe=ue.deletions;pe===null?(ue.deletions=[le],ue.flags|=16):pe.push(le)}}function c(ue,le){if(!s)return null;for(;le!==null;)a(ue,le),le=le.sibling;return null}function f(ue){for(var le=new Map;ue!==null;)ue.key!==null?le.set(ue.key,ue):le.set(ue.index,ue),ue=ue.sibling;return le}function b(ue,le){return ue=ei(ue,le),ue.index=0,ue.sibling=null,ue}function w(ue,le,pe){return ue.index=pe,s?(pe=ue.alternate,pe!==null?(pe=pe.index,pe<le?(ue.flags|=67108866,le):pe):(ue.flags|=67108866,le)):(ue.flags|=1048576,le)}function z(ue){return s&&ue.alternate===null&&(ue.flags|=67108866),ue}function Q(ue,le,pe,Te){return le===null||le.tag!==6?(le=Vm(pe,ue.mode,Te),le.return=ue,le):(le=b(le,pe),le.return=ue,le)}function re(ue,le,pe,Te){var Ge=pe.type;return Ge===x?Ee(ue,le,pe.props.children,Te,pe.key):le!==null&&(le.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===O&&co(Ge)===le.type)?(le=b(le,pe.props),Hc(le,pe),le.return=ue,le):(le=Ld(pe.type,pe.key,pe.props,null,ue.mode,Te),Hc(le,pe),le.return=ue,le)}function ge(ue,le,pe,Te){return le===null||le.tag!==4||le.stateNode.containerInfo!==pe.containerInfo||le.stateNode.implementation!==pe.implementation?(le=$m(pe,ue.mode,Te),le.return=ue,le):(le=b(le,pe.children||[]),le.return=ue,le)}function Ee(ue,le,pe,Te,Ge){return le===null||le.tag!==7?(le=so(pe,ue.mode,Te,Ge),le.return=ue,le):(le=b(le,pe),le.return=ue,le)}function Ie(ue,le,pe){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=Vm(""+le,ue.mode,pe),le.return=ue,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case _:return pe=Ld(le.type,le.key,le.props,null,ue.mode,pe),Hc(pe,le),pe.return=ue,pe;case C:return le=$m(le,ue.mode,pe),le.return=ue,le;case O:return le=co(le),Ie(ue,le,pe)}if(W(le)||R(le))return le=so(le,ue.mode,pe,null),le.return=ue,le;if(typeof le.then=="function")return Ie(ue,Gd(le),pe);if(le.$$typeof===I)return Ie(ue,Vd(ue,le),pe);Qd(ue,le)}return null}function _e(ue,le,pe,Te){var Ge=le!==null?le.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return Ge!==null?null:Q(ue,le,""+pe,Te);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case _:return pe.key===Ge?re(ue,le,pe,Te):null;case C:return pe.key===Ge?ge(ue,le,pe,Te):null;case O:return pe=co(pe),_e(ue,le,pe,Te)}if(W(pe)||R(pe))return Ge!==null?null:Ee(ue,le,pe,Te,null);if(typeof pe.then=="function")return _e(ue,le,Gd(pe),Te);if(pe.$$typeof===I)return _e(ue,le,Vd(ue,pe),Te);Qd(ue,pe)}return null}function xe(ue,le,pe,Te,Ge){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return ue=ue.get(pe)||null,Q(le,ue,""+Te,Ge);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case _:return ue=ue.get(Te.key===null?pe:Te.key)||null,re(le,ue,Te,Ge);case C:return ue=ue.get(Te.key===null?pe:Te.key)||null,ge(le,ue,Te,Ge);case O:return Te=co(Te),xe(ue,le,pe,Te,Ge)}if(W(Te)||R(Te))return ue=ue.get(pe)||null,Ee(le,ue,Te,Ge,null);if(typeof Te.then=="function")return xe(ue,le,pe,Gd(Te),Ge);if(Te.$$typeof===I)return xe(ue,le,pe,Vd(le,Te),Ge);Qd(le,Te)}return null}function Fe(ue,le,pe,Te){for(var Ge=null,St=null,$e=le,lt=le=0,mt=null;$e!==null&&lt<pe.length;lt++){$e.index>lt?(mt=$e,$e=null):mt=$e.sibling;var Ct=_e(ue,$e,pe[lt],Te);if(Ct===null){$e===null&&($e=mt);break}s&&$e&&Ct.alternate===null&&a(ue,$e),le=w(Ct,le,lt),St===null?Ge=Ct:St.sibling=Ct,St=Ct,$e=mt}if(lt===pe.length)return c(ue,$e),_t&&ti(ue,lt),Ge;if($e===null){for(;lt<pe.length;lt++)$e=Ie(ue,pe[lt],Te),$e!==null&&(le=w($e,le,lt),St===null?Ge=$e:St.sibling=$e,St=$e);return _t&&ti(ue,lt),Ge}for($e=f($e);lt<pe.length;lt++)mt=xe($e,ue,lt,pe[lt],Te),mt!==null&&(s&&mt.alternate!==null&&$e.delete(mt.key===null?lt:mt.key),le=w(mt,le,lt),St===null?Ge=mt:St.sibling=mt,St=mt);return s&&$e.forEach(function(oa){return a(ue,oa)}),_t&&ti(ue,lt),Ge}function We(ue,le,pe,Te){if(pe==null)throw Error(r(151));for(var Ge=null,St=null,$e=le,lt=le=0,mt=null,Ct=pe.next();$e!==null&&!Ct.done;lt++,Ct=pe.next()){$e.index>lt?(mt=$e,$e=null):mt=$e.sibling;var oa=_e(ue,$e,Ct.value,Te);if(oa===null){$e===null&&($e=mt);break}s&&$e&&oa.alternate===null&&a(ue,$e),le=w(oa,le,lt),St===null?Ge=oa:St.sibling=oa,St=oa,$e=mt}if(Ct.done)return c(ue,$e),_t&&ti(ue,lt),Ge;if($e===null){for(;!Ct.done;lt++,Ct=pe.next())Ct=Ie(ue,Ct.value,Te),Ct!==null&&(le=w(Ct,le,lt),St===null?Ge=Ct:St.sibling=Ct,St=Ct);return _t&&ti(ue,lt),Ge}for($e=f($e);!Ct.done;lt++,Ct=pe.next())Ct=xe($e,ue,lt,Ct.value,Te),Ct!==null&&(s&&Ct.alternate!==null&&$e.delete(Ct.key===null?lt:Ct.key),le=w(Ct,le,lt),St===null?Ge=Ct:St.sibling=Ct,St=Ct);return s&&$e.forEach(function(L2){return a(ue,L2)}),_t&&ti(ue,lt),Ge}function Pt(ue,le,pe,Te){if(typeof pe=="object"&&pe!==null&&pe.type===x&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case _:e:{for(var Ge=pe.key;le!==null;){if(le.key===Ge){if(Ge=pe.type,Ge===x){if(le.tag===7){c(ue,le.sibling),Te=b(le,pe.props.children),Te.return=ue,ue=Te;break e}}else if(le.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===O&&co(Ge)===le.type){c(ue,le.sibling),Te=b(le,pe.props),Hc(Te,pe),Te.return=ue,ue=Te;break e}c(ue,le);break}else a(ue,le);le=le.sibling}pe.type===x?(Te=so(pe.props.children,ue.mode,Te,pe.key),Te.return=ue,ue=Te):(Te=Ld(pe.type,pe.key,pe.props,null,ue.mode,Te),Hc(Te,pe),Te.return=ue,ue=Te)}return z(ue);case C:e:{for(Ge=pe.key;le!==null;){if(le.key===Ge)if(le.tag===4&&le.stateNode.containerInfo===pe.containerInfo&&le.stateNode.implementation===pe.implementation){c(ue,le.sibling),Te=b(le,pe.children||[]),Te.return=ue,ue=Te;break e}else{c(ue,le);break}else a(ue,le);le=le.sibling}Te=$m(pe,ue.mode,Te),Te.return=ue,ue=Te}return z(ue);case O:return pe=co(pe),Pt(ue,le,pe,Te)}if(W(pe))return Fe(ue,le,pe,Te);if(R(pe)){if(Ge=R(pe),typeof Ge!="function")throw Error(r(150));return pe=Ge.call(pe),We(ue,le,pe,Te)}if(typeof pe.then=="function")return Pt(ue,le,Gd(pe),Te);if(pe.$$typeof===I)return Pt(ue,le,Vd(ue,pe),Te);Qd(ue,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,le!==null&&le.tag===6?(c(ue,le.sibling),Te=b(le,pe),Te.return=ue,ue=Te):(c(ue,le),Te=Vm(pe,ue.mode,Te),Te.return=ue,ue=Te),z(ue)):c(ue,le)}return function(ue,le,pe,Te){try{qc=0;var Ge=Pt(ue,le,pe,Te);return fl=null,Ge}catch($e){if($e===hl||$e===qd)throw $e;var St=Sr(29,$e,null,ue.mode);return St.lanes=Te,St.return=ue,St}}}var ho=F_(!0),V_=F_(!1),qi=!1;function tp(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function np(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Hi(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Gi(s,a,c){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(jt&2)!==0){var b=f.pending;return b===null?a.next=a:(a.next=b.next,b.next=a),f.pending=a,a=Bd(s),E_(s,null,c),a}return zd(s,f,a,c),Bd(s)}function Gc(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var f=a.lanes;f&=s.pendingLanes,c|=f,a.lanes=c,bc(s,c)}}function rp(s,a){var c=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var b=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var z={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};w===null?b=w=z:w=w.next=z,c=c.next}while(c!==null);w===null?b=w=a:w=w.next=a}else b=w=a;c={baseState:f.baseState,firstBaseUpdate:b,lastBaseUpdate:w,shared:f.shared,callbacks:f.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var sp=!1;function Qc(){if(sp){var s=dl;if(s!==null)throw s}}function Wc(s,a,c,f){sp=!1;var b=s.updateQueue;qi=!1;var w=b.firstBaseUpdate,z=b.lastBaseUpdate,Q=b.shared.pending;if(Q!==null){b.shared.pending=null;var re=Q,ge=re.next;re.next=null,z===null?w=ge:z.next=ge,z=re;var Ee=s.alternate;Ee!==null&&(Ee=Ee.updateQueue,Q=Ee.lastBaseUpdate,Q!==z&&(Q===null?Ee.firstBaseUpdate=ge:Q.next=ge,Ee.lastBaseUpdate=re))}if(w!==null){var Ie=b.baseState;z=0,Ee=ge=re=null,Q=w;do{var _e=Q.lane&-536870913,xe=_e!==Q.lane;if(xe?(ft&_e)===_e:(f&_e)===_e){_e!==0&&_e===ul&&(sp=!0),Ee!==null&&(Ee=Ee.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var Fe=s,We=Q;_e=a;var Pt=c;switch(We.tag){case 1:if(Fe=We.payload,typeof Fe=="function"){Ie=Fe.call(Pt,Ie,_e);break e}Ie=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=We.payload,_e=typeof Fe=="function"?Fe.call(Pt,Ie,_e):Fe,_e==null)break e;Ie=g({},Ie,_e);break e;case 2:qi=!0}}_e=Q.callback,_e!==null&&(s.flags|=64,xe&&(s.flags|=8192),xe=b.callbacks,xe===null?b.callbacks=[_e]:xe.push(_e))}else xe={lane:_e,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Ee===null?(ge=Ee=xe,re=Ie):Ee=Ee.next=xe,z|=_e;if(Q=Q.next,Q===null){if(Q=b.shared.pending,Q===null)break;xe=Q,Q=xe.next,xe.next=null,b.lastBaseUpdate=xe,b.shared.pending=null}}while(!0);Ee===null&&(re=Ie),b.baseState=re,b.firstBaseUpdate=ge,b.lastBaseUpdate=Ee,w===null&&(b.shared.lanes=0),Xi|=z,s.lanes=z,s.memoizedState=Ie}}function $_(s,a){if(typeof s!="function")throw Error(r(191,s));s.call(a)}function q_(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)$_(c[s],a)}var ml=L(null),Wd=L(0);function H_(s,a){s=hi,te(Wd,s),te(ml,a),hi=s|a.baseLanes}function ip(){te(Wd,hi),te(ml,ml.current)}function ap(){hi=Wd.current,H(ml),H(Wd)}var Cr=L(null),Vr=null;function Qi(s){var a=s.alternate;te(on,on.current&1),te(Cr,s),Vr===null&&(a===null||ml.current!==null||a.memoizedState!==null)&&(Vr=s)}function op(s){te(on,on.current),te(Cr,s),Vr===null&&(Vr=s)}function G_(s){s.tag===22?(te(on,on.current),te(Cr,s),Vr===null&&(Vr=s)):Wi()}function Wi(){te(on,on.current),te(Cr,Cr.current)}function Er(s){H(Cr),Vr===s&&(Vr=null),H(on)}var on=L(0);function Kd(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||fg(c)||mg(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var si=0,at=null,Ot=null,yn=null,Yd=!1,pl=!1,fo=!1,Xd=0,Kc=0,gl=null,RA=0;function rn(){throw Error(r(321))}function lp(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!wr(s[c],a[c]))return!1;return!0}function cp(s,a,c,f,b,w){return si=w,at=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,K.H=s===null||s.memoizedState===null?Rb:Cp,fo=!1,w=c(f,b),fo=!1,pl&&(w=W_(a,c,f,b)),Q_(s),w}function Q_(s){K.H=Zc;var a=Ot!==null&&Ot.next!==null;if(si=0,yn=Ot=at=null,Yd=!1,Kc=0,gl=null,a)throw Error(r(300));s===null||_n||(s=s.dependencies,s!==null&&Fd(s)&&(_n=!0))}function W_(s,a,c,f){at=s;var b=0;do{if(pl&&(gl=null),Kc=0,pl=!1,25<=b)throw Error(r(301));if(b+=1,yn=Ot=null,s.updateQueue!=null){var w=s.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}K.H=Ib,w=a(c,f)}while(pl);return w}function IA(){var s=K.H,a=s.useState()[0];return a=typeof a.then=="function"?Yc(a):a,s=s.useState()[0],(Ot!==null?Ot.memoizedState:null)!==s&&(at.flags|=1024),a}function up(){var s=Xd!==0;return Xd=0,s}function dp(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function hp(s){if(Yd){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}Yd=!1}si=0,yn=Ot=at=null,pl=!1,Kc=Xd=0,gl=null}function ar(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yn===null?at.memoizedState=yn=s:yn=yn.next=s,yn}function ln(){if(Ot===null){var s=at.alternate;s=s!==null?s.memoizedState:null}else s=Ot.next;var a=yn===null?at.memoizedState:yn.next;if(a!==null)yn=a,Ot=s;else{if(s===null)throw at.alternate===null?Error(r(467)):Error(r(310));Ot=s,s={memoizedState:Ot.memoizedState,baseState:Ot.baseState,baseQueue:Ot.baseQueue,queue:Ot.queue,next:null},yn===null?at.memoizedState=yn=s:yn=yn.next=s}return yn}function Zd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Yc(s){var a=Kc;return Kc+=1,gl===null&&(gl=[]),s=B_(gl,s,a),a=at,(yn===null?a.memoizedState:yn.next)===null&&(a=a.alternate,K.H=a===null||a.memoizedState===null?Rb:Cp),s}function Jd(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Yc(s);if(s.$$typeof===I)return Ln(s)}throw Error(r(438,String(s)))}function fp(s){var a=null,c=at.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var f=at.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(a={data:f.data.map(function(b){return b.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=Zd(),at.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),f=0;f<s;f++)c[f]=F;return a.index++,c}function ii(s,a){return typeof a=="function"?a(s):a}function eh(s){var a=ln();return mp(a,Ot,s)}function mp(s,a,c){var f=s.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=c;var b=s.baseQueue,w=f.pending;if(w!==null){if(b!==null){var z=b.next;b.next=w.next,w.next=z}a.baseQueue=b=w,f.pending=null}if(w=s.baseState,b===null)s.memoizedState=w;else{a=b.next;var Q=z=null,re=null,ge=a,Ee=!1;do{var Ie=ge.lane&-536870913;if(Ie!==ge.lane?(ft&Ie)===Ie:(si&Ie)===Ie){var _e=ge.revertLane;if(_e===0)re!==null&&(re=re.next={lane:0,revertLane:0,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null}),Ie===ul&&(Ee=!0);else if((si&_e)===_e){ge=ge.next,_e===ul&&(Ee=!0);continue}else Ie={lane:0,revertLane:ge.revertLane,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},re===null?(Q=re=Ie,z=w):re=re.next=Ie,at.lanes|=_e,Xi|=_e;Ie=ge.action,fo&&c(w,Ie),w=ge.hasEagerState?ge.eagerState:c(w,Ie)}else _e={lane:Ie,revertLane:ge.revertLane,gesture:ge.gesture,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},re===null?(Q=re=_e,z=w):re=re.next=_e,at.lanes|=Ie,Xi|=Ie;ge=ge.next}while(ge!==null&&ge!==a);if(re===null?z=w:re.next=Q,!wr(w,s.memoizedState)&&(_n=!0,Ee&&(c=dl,c!==null)))throw c;s.memoizedState=w,s.baseState=z,s.baseQueue=re,f.lastRenderedState=w}return b===null&&(f.lanes=0),[s.memoizedState,f.dispatch]}function pp(s){var a=ln(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var f=c.dispatch,b=c.pending,w=a.memoizedState;if(b!==null){c.pending=null;var z=b=b.next;do w=s(w,z.action),z=z.next;while(z!==b);wr(w,a.memoizedState)||(_n=!0),a.memoizedState=w,a.baseQueue===null&&(a.baseState=w),c.lastRenderedState=w}return[w,f]}function K_(s,a,c){var f=at,b=ln(),w=_t;if(w){if(c===void 0)throw Error(r(407));c=c()}else c=a();var z=!wr((Ot||b).memoizedState,c);if(z&&(b.memoizedState=c,_n=!0),b=b.queue,_p(Z_.bind(null,f,b,s),[s]),b.getSnapshot!==a||z||yn!==null&&yn.memoizedState.tag&1){if(f.flags|=2048,yl(9,{destroy:void 0},X_.bind(null,f,b,c,a),null),Ut===null)throw Error(r(349));w||(si&127)!==0||Y_(f,a,c)}return c}function Y_(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=at.updateQueue,a===null?(a=Zd(),at.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function X_(s,a,c,f){a.value=c,a.getSnapshot=f,J_(a)&&eb(s)}function Z_(s,a,c){return c(function(){J_(a)&&eb(s)})}function J_(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!wr(s,c)}catch{return!0}}function eb(s){var a=ro(s,2);a!==null&&mr(a,s,2)}function gp(s){var a=ar();if(typeof s=="function"){var c=s;if(s=c(),fo){Xn(!0);try{c()}finally{Xn(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ii,lastRenderedState:s},a}function tb(s,a,c,f){return s.baseState=c,mp(s,Ot,typeof f=="function"?f:ii)}function kA(s,a,c,f,b){if(rh(s))throw Error(r(485));if(s=a.action,s!==null){var w={payload:b,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(z){w.listeners.push(z)}};K.T!==null?c(!0):w.isTransition=!1,f(w),c=a.pending,c===null?(w.next=a.pending=w,nb(a,w)):(w.next=c.next,a.pending=c.next=w)}}function nb(s,a){var c=a.action,f=a.payload,b=s.state;if(a.isTransition){var w=K.T,z={};K.T=z;try{var Q=c(b,f),re=K.S;re!==null&&re(z,Q),rb(s,a,Q)}catch(ge){yp(s,a,ge)}finally{w!==null&&z.types!==null&&(w.types=z.types),K.T=w}}else try{w=c(b,f),rb(s,a,w)}catch(ge){yp(s,a,ge)}}function rb(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){sb(s,a,f)},function(f){return yp(s,a,f)}):sb(s,a,c)}function sb(s,a,c){a.status="fulfilled",a.value=c,ib(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,nb(s,c)))}function yp(s,a,c){var f=s.pending;if(s.pending=null,f!==null){f=f.next;do a.status="rejected",a.reason=c,ib(a),a=a.next;while(a!==f)}s.action=null}function ib(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function ab(s,a){return a}function ob(s,a){if(_t){var c=Ut.formState;if(c!==null){e:{var f=at;if(_t){if(qt){t:{for(var b=qt,w=Fr;b.nodeType!==8;){if(!w){b=null;break t}if(b=$r(b.nextSibling),b===null){b=null;break t}}w=b.data,b=w==="F!"||w==="F"?b:null}if(b){qt=$r(b.nextSibling),f=b.data==="F!";break e}}Vi(f)}f=!1}f&&(a=c[0])}}return c=ar(),c.memoizedState=c.baseState=a,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ab,lastRenderedState:a},c.queue=f,c=Tb.bind(null,at,f),f.dispatch=c,f=gp(!1),w=Sp.bind(null,at,!1,f.queue),f=ar(),b={state:a,dispatch:null,action:s,pending:null},f.queue=b,c=kA.bind(null,at,b,w,c),b.dispatch=c,f.memoizedState=s,[a,c,!1]}function lb(s){var a=ln();return cb(a,Ot,s)}function cb(s,a,c){if(a=mp(s,a,ab)[0],s=eh(ii)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var f=Yc(a)}catch(z){throw z===hl?qd:z}else f=a;a=ln();var b=a.queue,w=b.dispatch;return c!==a.memoizedState&&(at.flags|=2048,yl(9,{destroy:void 0},DA.bind(null,b,c),null)),[f,w,s]}function DA(s,a){s.action=a}function ub(s){var a=ln(),c=Ot;if(c!==null)return cb(a,c,s);ln(),a=a.memoizedState,c=ln();var f=c.queue.dispatch;return c.memoizedState=s,[a,f,!1]}function yl(s,a,c,f){return s={tag:s,create:c,deps:f,inst:a,next:null},a=at.updateQueue,a===null&&(a=Zd(),at.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(f=c.next,c.next=s,s.next=f,a.lastEffect=s),s}function db(){return ln().memoizedState}function th(s,a,c,f){var b=ar();at.flags|=s,b.memoizedState=yl(1|a,{destroy:void 0},c,f===void 0?null:f)}function nh(s,a,c,f){var b=ln();f=f===void 0?null:f;var w=b.memoizedState.inst;Ot!==null&&f!==null&&lp(f,Ot.memoizedState.deps)?b.memoizedState=yl(a,w,c,f):(at.flags|=s,b.memoizedState=yl(1|a,w,c,f))}function hb(s,a){th(8390656,8,s,a)}function _p(s,a){nh(2048,8,s,a)}function MA(s){at.flags|=4;var a=at.updateQueue;if(a===null)a=Zd(),at.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function fb(s){var a=ln().memoizedState;return MA({ref:a,nextImpl:s}),function(){if((jt&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function mb(s,a){return nh(4,2,s,a)}function pb(s,a){return nh(4,4,s,a)}function gb(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function yb(s,a,c){c=c!=null?c.concat([s]):null,nh(4,4,gb.bind(null,a,s),c)}function bp(){}function _b(s,a){var c=ln();a=a===void 0?null:a;var f=c.memoizedState;return a!==null&&lp(a,f[1])?f[0]:(c.memoizedState=[s,a],s)}function bb(s,a){var c=ln();a=a===void 0?null:a;var f=c.memoizedState;if(a!==null&&lp(a,f[1]))return f[0];if(f=s(),fo){Xn(!0);try{s()}finally{Xn(!1)}}return c.memoizedState=[f,a],f}function vp(s,a,c){return c===void 0||(si&1073741824)!==0&&(ft&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=vv(),at.lanes|=s,Xi|=s,c)}function vb(s,a,c,f){return wr(c,a)?c:ml.current!==null?(s=vp(s,c,f),wr(s,a)||(_n=!0),s):(si&42)===0||(si&1073741824)!==0&&(ft&261930)===0?(_n=!0,s.memoizedState=c):(s=vv(),at.lanes|=s,Xi|=s,a)}function xb(s,a,c,f,b){var w=G.p;G.p=w!==0&&8>w?w:8;var z=K.T,Q={};K.T=Q,Sp(s,!1,a,c);try{var re=b(),ge=K.S;if(ge!==null&&ge(Q,re),re!==null&&typeof re=="object"&&typeof re.then=="function"){var Ee=jA(re,f);Xc(s,a,Ee,jr(s))}else Xc(s,a,f,jr(s))}catch(Ie){Xc(s,a,{then:function(){},status:"rejected",reason:Ie},jr())}finally{G.p=w,z!==null&&Q.types!==null&&(z.types=Q.types),K.T=z}}function OA(){}function xp(s,a,c,f){if(s.tag!==5)throw Error(r(476));var b=wb(s).queue;xb(s,b,a,J,c===null?OA:function(){return Sb(s),c(f)})}function wb(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:J,baseState:J,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ii,lastRenderedState:J},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ii,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function Sb(s){var a=wb(s);a.next===null&&(a=s.alternate.memoizedState),Xc(s,a.next.queue,{},jr())}function wp(){return Ln(mu)}function Cb(){return ln().memoizedState}function Eb(){return ln().memoizedState}function NA(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=jr();s=Hi(c);var f=Gi(a,s,c);f!==null&&(mr(f,a,c),Gc(f,a,c)),a={cache:Xm()},s.payload=a;return}a=a.return}}function PA(s,a,c){var f=jr();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},rh(s)?Ab(a,c):(c=Um(s,a,c,f),c!==null&&(mr(c,s,f),jb(c,a,f)))}function Tb(s,a,c){var f=jr();Xc(s,a,c,f)}function Xc(s,a,c,f){var b={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(rh(s))Ab(a,b);else{var w=s.alternate;if(s.lanes===0&&(w===null||w.lanes===0)&&(w=a.lastRenderedReducer,w!==null))try{var z=a.lastRenderedState,Q=w(z,c);if(b.hasEagerState=!0,b.eagerState=Q,wr(Q,z))return zd(s,a,b,0),Ut===null&&Pd(),!1}catch{}if(c=Um(s,a,b,f),c!==null)return mr(c,s,f),jb(c,a,f),!0}return!1}function Sp(s,a,c,f){if(f={lane:2,revertLane:tg(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},rh(s)){if(a)throw Error(r(479))}else a=Um(s,c,f,2),a!==null&&mr(a,s,2)}function rh(s){var a=s.alternate;return s===at||a!==null&&a===at}function Ab(s,a){pl=Yd=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function jb(s,a,c){if((c&4194048)!==0){var f=a.lanes;f&=s.pendingLanes,c|=f,a.lanes=c,bc(s,c)}}var Zc={readContext:Ln,use:Jd,useCallback:rn,useContext:rn,useEffect:rn,useImperativeHandle:rn,useLayoutEffect:rn,useInsertionEffect:rn,useMemo:rn,useReducer:rn,useRef:rn,useState:rn,useDebugValue:rn,useDeferredValue:rn,useTransition:rn,useSyncExternalStore:rn,useId:rn,useHostTransitionStatus:rn,useFormState:rn,useActionState:rn,useOptimistic:rn,useMemoCache:rn,useCacheRefresh:rn};Zc.useEffectEvent=rn;var Rb={readContext:Ln,use:Jd,useCallback:function(s,a){return ar().memoizedState=[s,a===void 0?null:a],s},useContext:Ln,useEffect:hb,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,th(4194308,4,gb.bind(null,a,s),c)},useLayoutEffect:function(s,a){return th(4194308,4,s,a)},useInsertionEffect:function(s,a){th(4,2,s,a)},useMemo:function(s,a){var c=ar();a=a===void 0?null:a;var f=s();if(fo){Xn(!0);try{s()}finally{Xn(!1)}}return c.memoizedState=[f,a],f},useReducer:function(s,a,c){var f=ar();if(c!==void 0){var b=c(a);if(fo){Xn(!0);try{c(a)}finally{Xn(!1)}}}else b=a;return f.memoizedState=f.baseState=b,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:b},f.queue=s,s=s.dispatch=PA.bind(null,at,s),[f.memoizedState,s]},useRef:function(s){var a=ar();return s={current:s},a.memoizedState=s},useState:function(s){s=gp(s);var a=s.queue,c=Tb.bind(null,at,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:bp,useDeferredValue:function(s,a){var c=ar();return vp(c,s,a)},useTransition:function(){var s=gp(!1);return s=xb.bind(null,at,s.queue,!0,!1),ar().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var f=at,b=ar();if(_t){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),Ut===null)throw Error(r(349));(ft&127)!==0||Y_(f,a,c)}b.memoizedState=c;var w={value:c,getSnapshot:a};return b.queue=w,hb(Z_.bind(null,f,w,s),[s]),f.flags|=2048,yl(9,{destroy:void 0},X_.bind(null,f,w,c,a),null),c},useId:function(){var s=ar(),a=Ut.identifierPrefix;if(_t){var c=Ns,f=Os;c=(f&~(1<<32-Tt(f)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Xd++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=RA++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:wp,useFormState:ob,useActionState:ob,useOptimistic:function(s){var a=ar();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=Sp.bind(null,at,!0,c),c.dispatch=a,[s,a]},useMemoCache:fp,useCacheRefresh:function(){return ar().memoizedState=NA.bind(null,at)},useEffectEvent:function(s){var a=ar(),c={impl:s};return a.memoizedState=c,function(){if((jt&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},Cp={readContext:Ln,use:Jd,useCallback:_b,useContext:Ln,useEffect:_p,useImperativeHandle:yb,useInsertionEffect:mb,useLayoutEffect:pb,useMemo:bb,useReducer:eh,useRef:db,useState:function(){return eh(ii)},useDebugValue:bp,useDeferredValue:function(s,a){var c=ln();return vb(c,Ot.memoizedState,s,a)},useTransition:function(){var s=eh(ii)[0],a=ln().memoizedState;return[typeof s=="boolean"?s:Yc(s),a]},useSyncExternalStore:K_,useId:Cb,useHostTransitionStatus:wp,useFormState:lb,useActionState:lb,useOptimistic:function(s,a){var c=ln();return tb(c,Ot,s,a)},useMemoCache:fp,useCacheRefresh:Eb};Cp.useEffectEvent=fb;var Ib={readContext:Ln,use:Jd,useCallback:_b,useContext:Ln,useEffect:_p,useImperativeHandle:yb,useInsertionEffect:mb,useLayoutEffect:pb,useMemo:bb,useReducer:pp,useRef:db,useState:function(){return pp(ii)},useDebugValue:bp,useDeferredValue:function(s,a){var c=ln();return Ot===null?vp(c,s,a):vb(c,Ot.memoizedState,s,a)},useTransition:function(){var s=pp(ii)[0],a=ln().memoizedState;return[typeof s=="boolean"?s:Yc(s),a]},useSyncExternalStore:K_,useId:Cb,useHostTransitionStatus:wp,useFormState:ub,useActionState:ub,useOptimistic:function(s,a){var c=ln();return Ot!==null?tb(c,Ot,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:fp,useCacheRefresh:Eb};Ib.useEffectEvent=fb;function Ep(s,a,c,f){a=s.memoizedState,c=c(f,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var Tp={enqueueSetState:function(s,a,c){s=s._reactInternals;var f=jr(),b=Hi(f);b.payload=a,c!=null&&(b.callback=c),a=Gi(s,b,f),a!==null&&(mr(a,s,f),Gc(a,s,f))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var f=jr(),b=Hi(f);b.tag=1,b.payload=a,c!=null&&(b.callback=c),a=Gi(s,b,f),a!==null&&(mr(a,s,f),Gc(a,s,f))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=jr(),f=Hi(c);f.tag=2,a!=null&&(f.callback=a),a=Gi(s,f,c),a!==null&&(mr(a,s,c),Gc(a,s,c))}};function kb(s,a,c,f,b,w,z){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,w,z):a.prototype&&a.prototype.isPureReactComponent?!Bc(c,f)||!Bc(b,w):!0}function Db(s,a,c,f){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,f),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,f),a.state!==s&&Tp.enqueueReplaceState(a,a.state,null)}function mo(s,a){var c=a;if("ref"in a){c={};for(var f in a)f!=="ref"&&(c[f]=a[f])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var b in s)c[b]===void 0&&(c[b]=s[b])}return c}function Mb(s){Nd(s)}function Ob(s){console.error(s)}function Nb(s){Nd(s)}function sh(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(f){setTimeout(function(){throw f})}}function Pb(s,a,c){try{var f=s.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function Ap(s,a,c){return c=Hi(c),c.tag=3,c.payload={element:null},c.callback=function(){sh(s,a)},c}function zb(s){return s=Hi(s),s.tag=3,s}function Bb(s,a,c,f){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var w=f.value;s.payload=function(){return b(w)},s.callback=function(){Pb(a,c,f)}}var z=c.stateNode;z!==null&&typeof z.componentDidCatch=="function"&&(s.callback=function(){Pb(a,c,f),typeof b!="function"&&(Zi===null?Zi=new Set([this]):Zi.add(this));var Q=f.stack;this.componentDidCatch(f.value,{componentStack:Q!==null?Q:""})})}function zA(s,a,c,f,b){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(a=c.alternate,a!==null&&cl(a,c,b,!0),c=Cr.current,c!==null){switch(c.tag){case 31:case 13:return Vr===null?gh():c.alternate===null&&sn===0&&(sn=3),c.flags&=-257,c.flags|=65536,c.lanes=b,f===Hd?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([f]):a.add(f),Zp(s,f,b)),!1;case 22:return c.flags|=65536,f===Hd?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([f]):c.add(f)),Zp(s,f,b)),!1}throw Error(r(435,c.tag))}return Zp(s,f,b),gh(),!1}if(_t)return a=Cr.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=b,f!==Gm&&(s=Error(r(422),{cause:f}),Fc(Br(s,c)))):(f!==Gm&&(a=Error(r(423),{cause:f}),Fc(Br(a,c))),s=s.current.alternate,s.flags|=65536,b&=-b,s.lanes|=b,f=Br(f,c),b=Ap(s.stateNode,f,b),rp(s,b),sn!==4&&(sn=2)),!1;var w=Error(r(520),{cause:f});if(w=Br(w,c),au===null?au=[w]:au.push(w),sn!==4&&(sn=2),a===null)return!0;f=Br(f,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=b&-b,c.lanes|=s,s=Ap(c.stateNode,f,s),rp(c,s),!1;case 1:if(a=c.type,w=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Zi===null||!Zi.has(w))))return c.flags|=65536,b&=-b,c.lanes|=b,b=zb(b),Bb(b,s,c,f),rp(c,b),!1}c=c.return}while(c!==null);return!1}var jp=Error(r(461)),_n=!1;function Un(s,a,c,f){a.child=s===null?V_(a,null,c,f):ho(a,s.child,c,f)}function Lb(s,a,c,f,b){c=c.render;var w=a.ref;if("ref"in f){var z={};for(var Q in f)Q!=="ref"&&(z[Q]=f[Q])}else z=f;return oo(a),f=cp(s,a,c,z,w,b),Q=up(),s!==null&&!_n?(dp(s,a,b),ai(s,a,b)):(_t&&Q&&qm(a),a.flags|=1,Un(s,a,f,b),a.child)}function Ub(s,a,c,f,b){if(s===null){var w=c.type;return typeof w=="function"&&!Fm(w)&&w.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=w,Fb(s,a,w,f,b)):(s=Ld(c.type,null,f,a,a.mode,b),s.ref=a.ref,s.return=a,a.child=s)}if(w=s.child,!Pp(s,b)){var z=w.memoizedProps;if(c=c.compare,c=c!==null?c:Bc,c(z,f)&&s.ref===a.ref)return ai(s,a,b)}return a.flags|=1,s=ei(w,f),s.ref=a.ref,s.return=a,a.child=s}function Fb(s,a,c,f,b){if(s!==null){var w=s.memoizedProps;if(Bc(w,f)&&s.ref===a.ref)if(_n=!1,a.pendingProps=f=w,Pp(s,b))(s.flags&131072)!==0&&(_n=!0);else return a.lanes=s.lanes,ai(s,a,b)}return Rp(s,a,c,f,b)}function Vb(s,a,c,f){var b=f.children,w=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((a.flags&128)!==0){if(w=w!==null?w.baseLanes|c:c,s!==null){for(f=a.child=s.child,b=0;f!==null;)b=b|f.lanes|f.childLanes,f=f.sibling;f=b&~w}else f=0,a.child=null;return $b(s,a,w,c,f)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&$d(a,w!==null?w.cachePool:null),w!==null?H_(a,w):ip(),G_(a);else return f=a.lanes=536870912,$b(s,a,w!==null?w.baseLanes|c:c,c,f)}else w!==null?($d(a,w.cachePool),H_(a,w),Wi(),a.memoizedState=null):(s!==null&&$d(a,null),ip(),Wi());return Un(s,a,b,c),a.child}function Jc(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function $b(s,a,c,f,b){var w=Jm();return w=w===null?null:{parent:gn._currentValue,pool:w},a.memoizedState={baseLanes:c,cachePool:w},s!==null&&$d(a,null),ip(),G_(a),s!==null&&cl(s,a,f,!0),a.childLanes=b,null}function ih(s,a){return a=oh({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function qb(s,a,c){return ho(a,s.child,null,c),s=ih(a,a.pendingProps),s.flags|=2,Er(a),a.memoizedState=null,s}function BA(s,a,c){var f=a.pendingProps,b=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(_t){if(f.mode==="hidden")return s=ih(a,f),a.lanes=536870912,Jc(null,s);if(op(a),(s=qt)?(s=nx(s,Fr),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Ui!==null?{id:Os,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},c=A_(s),c.return=a,a.child=c,Bn=a,qt=null)):s=null,s===null)throw Vi(a);return a.lanes=536870912,null}return ih(a,f)}var w=s.memoizedState;if(w!==null){var z=w.dehydrated;if(op(a),b)if(a.flags&256)a.flags&=-257,a=qb(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(r(558));else if(_n||cl(s,a,c,!1),b=(c&s.childLanes)!==0,_n||b){if(f=Ut,f!==null&&(z=vc(f,c),z!==0&&z!==w.retryLane))throw w.retryLane=z,ro(s,z),mr(f,s,z),jp;gh(),a=qb(s,a,c)}else s=w.treeContext,qt=$r(z.nextSibling),Bn=a,_t=!0,Fi=null,Fr=!1,s!==null&&I_(a,s),a=ih(a,f),a.flags|=4096;return a}return s=ei(s.child,{mode:f.mode,children:f.children}),s.ref=a.ref,a.child=s,s.return=a,s}function ah(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function Rp(s,a,c,f,b){return oo(a),c=cp(s,a,c,f,void 0,b),f=up(),s!==null&&!_n?(dp(s,a,b),ai(s,a,b)):(_t&&f&&qm(a),a.flags|=1,Un(s,a,c,b),a.child)}function Hb(s,a,c,f,b,w){return oo(a),a.updateQueue=null,c=W_(a,f,c,b),Q_(s),f=up(),s!==null&&!_n?(dp(s,a,w),ai(s,a,w)):(_t&&f&&qm(a),a.flags|=1,Un(s,a,c,w),a.child)}function Gb(s,a,c,f,b){if(oo(a),a.stateNode===null){var w=il,z=c.contextType;typeof z=="object"&&z!==null&&(w=Ln(z)),w=new c(f,w),a.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=Tp,a.stateNode=w,w._reactInternals=a,w=a.stateNode,w.props=f,w.state=a.memoizedState,w.refs={},tp(a),z=c.contextType,w.context=typeof z=="object"&&z!==null?Ln(z):il,w.state=a.memoizedState,z=c.getDerivedStateFromProps,typeof z=="function"&&(Ep(a,c,z,f),w.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(z=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),z!==w.state&&Tp.enqueueReplaceState(w,w.state,null),Wc(a,f,w,b),Qc(),w.state=a.memoizedState),typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!0}else if(s===null){w=a.stateNode;var Q=a.memoizedProps,re=mo(c,Q);w.props=re;var ge=w.context,Ee=c.contextType;z=il,typeof Ee=="object"&&Ee!==null&&(z=Ln(Ee));var Ie=c.getDerivedStateFromProps;Ee=typeof Ie=="function"||typeof w.getSnapshotBeforeUpdate=="function",Q=a.pendingProps!==Q,Ee||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(Q||ge!==z)&&Db(a,w,f,z),qi=!1;var _e=a.memoizedState;w.state=_e,Wc(a,f,w,b),Qc(),ge=a.memoizedState,Q||_e!==ge||qi?(typeof Ie=="function"&&(Ep(a,c,Ie,f),ge=a.memoizedState),(re=qi||kb(a,c,re,f,_e,ge,z))?(Ee||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(a.flags|=4194308)):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=f,a.memoizedState=ge),w.props=f,w.state=ge,w.context=z,f=re):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!1)}else{w=a.stateNode,np(s,a),z=a.memoizedProps,Ee=mo(c,z),w.props=Ee,Ie=a.pendingProps,_e=w.context,ge=c.contextType,re=il,typeof ge=="object"&&ge!==null&&(re=Ln(ge)),Q=c.getDerivedStateFromProps,(ge=typeof Q=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(z!==Ie||_e!==re)&&Db(a,w,f,re),qi=!1,_e=a.memoizedState,w.state=_e,Wc(a,f,w,b),Qc();var xe=a.memoizedState;z!==Ie||_e!==xe||qi||s!==null&&s.dependencies!==null&&Fd(s.dependencies)?(typeof Q=="function"&&(Ep(a,c,Q,f),xe=a.memoizedState),(Ee=qi||kb(a,c,Ee,f,_e,xe,re)||s!==null&&s.dependencies!==null&&Fd(s.dependencies))?(ge||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(f,xe,re),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(f,xe,re)),typeof w.componentDidUpdate=="function"&&(a.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof w.componentDidUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),a.memoizedProps=f,a.memoizedState=xe),w.props=f,w.state=xe,w.context=re,f=Ee):(typeof w.componentDidUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),f=!1)}return w=f,ah(s,a),f=(a.flags&128)!==0,w||f?(w=a.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:w.render(),a.flags|=1,s!==null&&f?(a.child=ho(a,s.child,null,b),a.child=ho(a,null,c,b)):Un(s,a,c,b),a.memoizedState=w.state,s=a.child):s=ai(s,a,b),s}function Qb(s,a,c,f){return io(),a.flags|=256,Un(s,a,c,f),a.child}var Ip={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function kp(s){return{baseLanes:s,cachePool:P_()}}function Dp(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=Ar),s}function Wb(s,a,c){var f=a.pendingProps,b=!1,w=(a.flags&128)!==0,z;if((z=w)||(z=s!==null&&s.memoizedState===null?!1:(on.current&2)!==0),z&&(b=!0,a.flags&=-129),z=(a.flags&32)!==0,a.flags&=-33,s===null){if(_t){if(b?Qi(a):Wi(),(s=qt)?(s=nx(s,Fr),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Ui!==null?{id:Os,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},c=A_(s),c.return=a,a.child=c,Bn=a,qt=null)):s=null,s===null)throw Vi(a);return mg(s)?a.lanes=32:a.lanes=536870912,null}var Q=f.children;return f=f.fallback,b?(Wi(),b=a.mode,Q=oh({mode:"hidden",children:Q},b),f=so(f,b,c,null),Q.return=a,f.return=a,Q.sibling=f,a.child=Q,f=a.child,f.memoizedState=kp(c),f.childLanes=Dp(s,z,c),a.memoizedState=Ip,Jc(null,f)):(Qi(a),Mp(a,Q))}var re=s.memoizedState;if(re!==null&&(Q=re.dehydrated,Q!==null)){if(w)a.flags&256?(Qi(a),a.flags&=-257,a=Op(s,a,c)):a.memoizedState!==null?(Wi(),a.child=s.child,a.flags|=128,a=null):(Wi(),Q=f.fallback,b=a.mode,f=oh({mode:"visible",children:f.children},b),Q=so(Q,b,c,null),Q.flags|=2,f.return=a,Q.return=a,f.sibling=Q,a.child=f,ho(a,s.child,null,c),f=a.child,f.memoizedState=kp(c),f.childLanes=Dp(s,z,c),a.memoizedState=Ip,a=Jc(null,f));else if(Qi(a),mg(Q)){if(z=Q.nextSibling&&Q.nextSibling.dataset,z)var ge=z.dgst;z=ge,f=Error(r(419)),f.stack="",f.digest=z,Fc({value:f,source:null,stack:null}),a=Op(s,a,c)}else if(_n||cl(s,a,c,!1),z=(c&s.childLanes)!==0,_n||z){if(z=Ut,z!==null&&(f=vc(z,c),f!==0&&f!==re.retryLane))throw re.retryLane=f,ro(s,f),mr(z,s,f),jp;fg(Q)||gh(),a=Op(s,a,c)}else fg(Q)?(a.flags|=192,a.child=s.child,a=null):(s=re.treeContext,qt=$r(Q.nextSibling),Bn=a,_t=!0,Fi=null,Fr=!1,s!==null&&I_(a,s),a=Mp(a,f.children),a.flags|=4096);return a}return b?(Wi(),Q=f.fallback,b=a.mode,re=s.child,ge=re.sibling,f=ei(re,{mode:"hidden",children:f.children}),f.subtreeFlags=re.subtreeFlags&65011712,ge!==null?Q=ei(ge,Q):(Q=so(Q,b,c,null),Q.flags|=2),Q.return=a,f.return=a,f.sibling=Q,a.child=f,Jc(null,f),f=a.child,Q=s.child.memoizedState,Q===null?Q=kp(c):(b=Q.cachePool,b!==null?(re=gn._currentValue,b=b.parent!==re?{parent:re,pool:re}:b):b=P_(),Q={baseLanes:Q.baseLanes|c,cachePool:b}),f.memoizedState=Q,f.childLanes=Dp(s,z,c),a.memoizedState=Ip,Jc(s.child,f)):(Qi(a),c=s.child,s=c.sibling,c=ei(c,{mode:"visible",children:f.children}),c.return=a,c.sibling=null,s!==null&&(z=a.deletions,z===null?(a.deletions=[s],a.flags|=16):z.push(s)),a.child=c,a.memoizedState=null,c)}function Mp(s,a){return a=oh({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function oh(s,a){return s=Sr(22,s,null,a),s.lanes=0,s}function Op(s,a,c){return ho(a,s.child,null,c),s=Mp(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function Kb(s,a,c){s.lanes|=a;var f=s.alternate;f!==null&&(f.lanes|=a),Km(s.return,a,c)}function Np(s,a,c,f,b,w){var z=s.memoizedState;z===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:b,treeForkCount:w}:(z.isBackwards=a,z.rendering=null,z.renderingStartTime=0,z.last=f,z.tail=c,z.tailMode=b,z.treeForkCount=w)}function Yb(s,a,c){var f=a.pendingProps,b=f.revealOrder,w=f.tail;f=f.children;var z=on.current,Q=(z&2)!==0;if(Q?(z=z&1|2,a.flags|=128):z&=1,te(on,z),Un(s,a,f,c),f=_t?Uc:0,!Q&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Kb(s,c,a);else if(s.tag===19)Kb(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(b){case"forwards":for(c=a.child,b=null;c!==null;)s=c.alternate,s!==null&&Kd(s)===null&&(b=c),c=c.sibling;c=b,c===null?(b=a.child,a.child=null):(b=c.sibling,c.sibling=null),Np(a,!1,b,c,w,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=a.child,a.child=null;b!==null;){if(s=b.alternate,s!==null&&Kd(s)===null){a.child=b;break}s=b.sibling,b.sibling=c,c=b,b=s}Np(a,!0,c,null,w,f);break;case"together":Np(a,!1,null,null,void 0,f);break;default:a.memoizedState=null}return a.child}function ai(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),Xi|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(cl(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(r(153));if(a.child!==null){for(s=a.child,c=ei(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=ei(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Pp(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&Fd(s)))}function LA(s,a,c){switch(a.tag){case 3:de(a,a.stateNode.containerInfo),$i(a,gn,s.memoizedState.cache),io();break;case 27:case 5:Me(a);break;case 4:de(a,a.stateNode.containerInfo);break;case 10:$i(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,op(a),null;break;case 13:var f=a.memoizedState;if(f!==null)return f.dehydrated!==null?(Qi(a),a.flags|=128,null):(c&a.child.childLanes)!==0?Wb(s,a,c):(Qi(a),s=ai(s,a,c),s!==null?s.sibling:null);Qi(a);break;case 19:var b=(s.flags&128)!==0;if(f=(c&a.childLanes)!==0,f||(cl(s,a,c,!1),f=(c&a.childLanes)!==0),b){if(f)return Yb(s,a,c);a.flags|=128}if(b=a.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),te(on,on.current),f)break;return null;case 22:return a.lanes=0,Vb(s,a,c,a.pendingProps);case 24:$i(a,gn,s.memoizedState.cache)}return ai(s,a,c)}function Xb(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)_n=!0;else{if(!Pp(s,c)&&(a.flags&128)===0)return _n=!1,LA(s,a,c);_n=(s.flags&131072)!==0}else _n=!1,_t&&(a.flags&1048576)!==0&&R_(a,Uc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var f=a.pendingProps;if(s=co(a.elementType),a.type=s,typeof s=="function")Fm(s)?(f=mo(s,f),a.tag=1,a=Gb(null,a,s,f,c)):(a.tag=0,a=Rp(null,a,s,f,c));else{if(s!=null){var b=s.$$typeof;if(b===D){a.tag=11,a=Lb(null,a,s,f,c);break e}else if(b===M){a.tag=14,a=Ub(null,a,s,f,c);break e}}throw a=A(s)||s,Error(r(306,a,""))}}return a;case 0:return Rp(s,a,a.type,a.pendingProps,c);case 1:return f=a.type,b=mo(f,a.pendingProps),Gb(s,a,f,b,c);case 3:e:{if(de(a,a.stateNode.containerInfo),s===null)throw Error(r(387));f=a.pendingProps;var w=a.memoizedState;b=w.element,np(s,a),Wc(a,f,null,c);var z=a.memoizedState;if(f=z.cache,$i(a,gn,f),f!==w.cache&&Ym(a,[gn],c,!0),Qc(),f=z.element,w.isDehydrated)if(w={element:f,isDehydrated:!1,cache:z.cache},a.updateQueue.baseState=w,a.memoizedState=w,a.flags&256){a=Qb(s,a,f,c);break e}else if(f!==b){b=Br(Error(r(424)),a),Fc(b),a=Qb(s,a,f,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,qt=$r(s.firstChild),Bn=a,_t=!0,Fi=null,Fr=!0,c=V_(a,null,f,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(io(),f===b){a=ai(s,a,c);break e}Un(s,a,f,c)}a=a.child}return a;case 26:return ah(s,a),s===null?(c=lx(a.type,null,a.pendingProps,null))?a.memoizedState=c:_t||(c=a.type,s=a.pendingProps,f=Sh(fe.current).createElement(c),f[fn]=a,f[kn]=s,Fn(f,c,s),mn(f),a.stateNode=f):a.memoizedState=lx(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return Me(a),s===null&&_t&&(f=a.stateNode=ix(a.type,a.pendingProps,fe.current),Bn=a,Fr=!0,b=qt,na(a.type)?(pg=b,qt=$r(f.firstChild)):qt=b),Un(s,a,a.pendingProps.children,c),ah(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&_t&&((b=f=qt)&&(f=p2(f,a.type,a.pendingProps,Fr),f!==null?(a.stateNode=f,Bn=a,qt=$r(f.firstChild),Fr=!1,b=!0):b=!1),b||Vi(a)),Me(a),b=a.type,w=a.pendingProps,z=s!==null?s.memoizedProps:null,f=w.children,ug(b,w)?f=null:z!==null&&ug(b,z)&&(a.flags|=32),a.memoizedState!==null&&(b=cp(s,a,IA,null,null,c),mu._currentValue=b),ah(s,a),Un(s,a,f,c),a.child;case 6:return s===null&&_t&&((s=c=qt)&&(c=g2(c,a.pendingProps,Fr),c!==null?(a.stateNode=c,Bn=a,qt=null,s=!0):s=!1),s||Vi(a)),null;case 13:return Wb(s,a,c);case 4:return de(a,a.stateNode.containerInfo),f=a.pendingProps,s===null?a.child=ho(a,null,f,c):Un(s,a,f,c),a.child;case 11:return Lb(s,a,a.type,a.pendingProps,c);case 7:return Un(s,a,a.pendingProps,c),a.child;case 8:return Un(s,a,a.pendingProps.children,c),a.child;case 12:return Un(s,a,a.pendingProps.children,c),a.child;case 10:return f=a.pendingProps,$i(a,a.type,f.value),Un(s,a,f.children,c),a.child;case 9:return b=a.type._context,f=a.pendingProps.children,oo(a),b=Ln(b),f=f(b),a.flags|=1,Un(s,a,f,c),a.child;case 14:return Ub(s,a,a.type,a.pendingProps,c);case 15:return Fb(s,a,a.type,a.pendingProps,c);case 19:return Yb(s,a,c);case 31:return BA(s,a,c);case 22:return Vb(s,a,c,a.pendingProps);case 24:return oo(a),f=Ln(gn),s===null?(b=Jm(),b===null&&(b=Ut,w=Xm(),b.pooledCache=w,w.refCount++,w!==null&&(b.pooledCacheLanes|=c),b=w),a.memoizedState={parent:f,cache:b},tp(a),$i(a,gn,b)):((s.lanes&c)!==0&&(np(s,a),Wc(a,null,null,c),Qc()),b=s.memoizedState,w=a.memoizedState,b.parent!==f?(b={parent:f,cache:f},a.memoizedState=b,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=b),$i(a,gn,f)):(f=w.cache,$i(a,gn,f),f!==b.cache&&Ym(a,[gn],c,!0))),Un(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function oi(s){s.flags|=4}function zp(s,a,c,f,b){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(b&335544128)===b)if(s.stateNode.complete)s.flags|=8192;else if(Cv())s.flags|=8192;else throw uo=Hd,ep}else s.flags&=-16777217}function Zb(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!fx(a))if(Cv())s.flags|=8192;else throw uo=Hd,ep}function lh(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?md():536870912,s.lanes|=a,xl|=a)}function eu(s,a){if(!_t)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function Ht(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,f=0;if(a)for(var b=s.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags&65011712,f|=b.flags&65011712,b.return=s,b=b.sibling;else for(b=s.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags,f|=b.flags,b.return=s,b=b.sibling;return s.subtreeFlags|=f,s.childLanes=c,a}function UA(s,a,c){var f=a.pendingProps;switch(Hm(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ht(a),null;case 1:return Ht(a),null;case 3:return c=a.stateNode,f=null,s!==null&&(f=s.memoizedState.cache),a.memoizedState.cache!==f&&(a.flags|=2048),ri(gn),be(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(ll(a)?oi(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Qm())),Ht(a),null;case 26:var b=a.type,w=a.memoizedState;return s===null?(oi(a),w!==null?(Ht(a),Zb(a,w)):(Ht(a),zp(a,b,null,f,c))):w?w!==s.memoizedState?(oi(a),Ht(a),Zb(a,w)):(Ht(a),a.flags&=-16777217):(s=s.memoizedProps,s!==f&&oi(a),Ht(a),zp(a,b,s,f,c)),null;case 27:if(Oe(a),c=fe.current,b=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==f&&oi(a);else{if(!f){if(a.stateNode===null)throw Error(r(166));return Ht(a),null}s=se.current,ll(a)?k_(a):(s=ix(b,f,c),a.stateNode=s,oi(a))}return Ht(a),null;case 5:if(Oe(a),b=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==f&&oi(a);else{if(!f){if(a.stateNode===null)throw Error(r(166));return Ht(a),null}if(w=se.current,ll(a))k_(a);else{var z=Sh(fe.current);switch(w){case 1:w=z.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:w=z.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":w=z.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":w=z.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":w=z.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof f.is=="string"?z.createElement("select",{is:f.is}):z.createElement("select"),f.multiple?w.multiple=!0:f.size&&(w.size=f.size);break;default:w=typeof f.is=="string"?z.createElement(b,{is:f.is}):z.createElement(b)}}w[fn]=a,w[kn]=f;e:for(z=a.child;z!==null;){if(z.tag===5||z.tag===6)w.appendChild(z.stateNode);else if(z.tag!==4&&z.tag!==27&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===a)break e;for(;z.sibling===null;){if(z.return===null||z.return===a)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}a.stateNode=w;e:switch(Fn(w,b,f),b){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&oi(a)}}return Ht(a),zp(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==f&&oi(a);else{if(typeof f!="string"&&a.stateNode===null)throw Error(r(166));if(s=fe.current,ll(a)){if(s=a.stateNode,c=a.memoizedProps,f=null,b=Bn,b!==null)switch(b.tag){case 27:case 5:f=b.memoizedProps}s[fn]=a,s=!!(s.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||Wv(s.nodeValue,c)),s||Vi(a,!0)}else s=Sh(s).createTextNode(f),s[fn]=a,a.stateNode=s}return Ht(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(f=ll(a),c!==null){if(s===null){if(!f)throw Error(r(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[fn]=a}else io(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ht(a),s=!1}else c=Qm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(Er(a),a):(Er(a),null);if((a.flags&128)!==0)throw Error(r(558))}return Ht(a),null;case 13:if(f=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(b=ll(a),f!==null&&f.dehydrated!==null){if(s===null){if(!b)throw Error(r(318));if(b=a.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(r(317));b[fn]=a}else io(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ht(a),b=!1}else b=Qm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=b),b=!0;if(!b)return a.flags&256?(Er(a),a):(Er(a),null)}return Er(a),(a.flags&128)!==0?(a.lanes=c,a):(c=f!==null,s=s!==null&&s.memoizedState!==null,c&&(f=a.child,b=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(b=f.alternate.memoizedState.cachePool.pool),w=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(w=f.memoizedState.cachePool.pool),w!==b&&(f.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),lh(a,a.updateQueue),Ht(a),null);case 4:return be(),s===null&&ig(a.stateNode.containerInfo),Ht(a),null;case 10:return ri(a.type),Ht(a),null;case 19:if(H(on),f=a.memoizedState,f===null)return Ht(a),null;if(b=(a.flags&128)!==0,w=f.rendering,w===null)if(b)eu(f,!1);else{if(sn!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(w=Kd(s),w!==null){for(a.flags|=128,eu(f,!1),s=w.updateQueue,a.updateQueue=s,lh(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)T_(c,s),c=c.sibling;return te(on,on.current&1|2),_t&&ti(a,f.treeForkCount),a.child}s=s.sibling}f.tail!==null&&Ne()>fh&&(a.flags|=128,b=!0,eu(f,!1),a.lanes=4194304)}else{if(!b)if(s=Kd(w),s!==null){if(a.flags|=128,b=!0,s=s.updateQueue,a.updateQueue=s,lh(a,s),eu(f,!0),f.tail===null&&f.tailMode==="hidden"&&!w.alternate&&!_t)return Ht(a),null}else 2*Ne()-f.renderingStartTime>fh&&c!==536870912&&(a.flags|=128,b=!0,eu(f,!1),a.lanes=4194304);f.isBackwards?(w.sibling=a.child,a.child=w):(s=f.last,s!==null?s.sibling=w:a.child=w,f.last=w)}return f.tail!==null?(s=f.tail,f.rendering=s,f.tail=s.sibling,f.renderingStartTime=Ne(),s.sibling=null,c=on.current,te(on,b?c&1|2:c&1),_t&&ti(a,f.treeForkCount),s):(Ht(a),null);case 22:case 23:return Er(a),ap(),f=a.memoizedState!==null,s!==null?s.memoizedState!==null!==f&&(a.flags|=8192):f&&(a.flags|=8192),f?(c&536870912)!==0&&(a.flags&128)===0&&(Ht(a),a.subtreeFlags&6&&(a.flags|=8192)):Ht(a),c=a.updateQueue,c!==null&&lh(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),f=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),f!==c&&(a.flags|=2048),s!==null&&H(lo),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),ri(gn),Ht(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function FA(s,a){switch(Hm(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return ri(gn),be(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Oe(a),null;case 31:if(a.memoizedState!==null){if(Er(a),a.alternate===null)throw Error(r(340));io()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(Er(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(r(340));io()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return H(on),null;case 4:return be(),null;case 10:return ri(a.type),null;case 22:case 23:return Er(a),ap(),s!==null&&H(lo),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return ri(gn),null;case 25:return null;default:return null}}function Jb(s,a){switch(Hm(a),a.tag){case 3:ri(gn),be();break;case 26:case 27:case 5:Oe(a);break;case 4:be();break;case 31:a.memoizedState!==null&&Er(a);break;case 13:Er(a);break;case 19:H(on);break;case 10:ri(a.type);break;case 22:case 23:Er(a),ap(),s!==null&&H(lo);break;case 24:ri(gn)}}function tu(s,a){try{var c=a.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var b=f.next;c=b;do{if((c.tag&s)===s){f=void 0;var w=c.create,z=c.inst;f=w(),z.destroy=f}c=c.next}while(c!==b)}}catch(Q){Dt(a,a.return,Q)}}function Ki(s,a,c){try{var f=a.updateQueue,b=f!==null?f.lastEffect:null;if(b!==null){var w=b.next;f=w;do{if((f.tag&s)===s){var z=f.inst,Q=z.destroy;if(Q!==void 0){z.destroy=void 0,b=a;var re=c,ge=Q;try{ge()}catch(Ee){Dt(b,re,Ee)}}}f=f.next}while(f!==w)}}catch(Ee){Dt(a,a.return,Ee)}}function ev(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{q_(a,c)}catch(f){Dt(s,s.return,f)}}}function tv(s,a,c){c.props=mo(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(f){Dt(s,a,f)}}function nu(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var f=s.stateNode;break;case 30:f=s.stateNode;break;default:f=s.stateNode}typeof c=="function"?s.refCleanup=c(f):c.current=f}}catch(b){Dt(s,a,b)}}function Ps(s,a){var c=s.ref,f=s.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(b){Dt(s,a,b)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){Dt(s,a,b)}else c.current=null}function nv(s){var a=s.type,c=s.memoizedProps,f=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(b){Dt(s,s.return,b)}}function Bp(s,a,c){try{var f=s.stateNode;c2(f,s.type,c,a),f[kn]=a}catch(b){Dt(s,s.return,b)}}function rv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&na(s.type)||s.tag===4}function Lp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||rv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&na(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Up(s,a,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=Jr));else if(f!==4&&(f===27&&na(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Up(s,a,c),s=s.sibling;s!==null;)Up(s,a,c),s=s.sibling}function ch(s,a,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(f!==4&&(f===27&&na(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(ch(s,a,c),s=s.sibling;s!==null;)ch(s,a,c),s=s.sibling}function sv(s){var a=s.stateNode,c=s.memoizedProps;try{for(var f=s.type,b=a.attributes;b.length;)a.removeAttributeNode(b[0]);Fn(a,f,c),a[fn]=s,a[kn]=c}catch(w){Dt(s,s.return,w)}}var li=!1,bn=!1,Fp=!1,iv=typeof WeakSet=="function"?WeakSet:Set,Mn=null;function VA(s,a){if(s=s.containerInfo,lg=Ih,s=y_(s),Om(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var b=f.anchorOffset,w=f.focusNode;f=f.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var z=0,Q=-1,re=-1,ge=0,Ee=0,Ie=s,_e=null;t:for(;;){for(var xe;Ie!==c||b!==0&&Ie.nodeType!==3||(Q=z+b),Ie!==w||f!==0&&Ie.nodeType!==3||(re=z+f),Ie.nodeType===3&&(z+=Ie.nodeValue.length),(xe=Ie.firstChild)!==null;)_e=Ie,Ie=xe;for(;;){if(Ie===s)break t;if(_e===c&&++ge===b&&(Q=z),_e===w&&++Ee===f&&(re=z),(xe=Ie.nextSibling)!==null)break;Ie=_e,_e=Ie.parentNode}Ie=xe}c=Q===-1||re===-1?null:{start:Q,end:re}}else c=null}c=c||{start:0,end:0}}else c=null;for(cg={focusedElem:s,selectionRange:c},Ih=!1,Mn=a;Mn!==null;)if(a=Mn,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,Mn=s;else for(;Mn!==null;){switch(a=Mn,w=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)b=s[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&w!==null){s=void 0,c=a,b=w.memoizedProps,w=w.memoizedState,f=c.stateNode;try{var Fe=mo(c.type,b);s=f.getSnapshotBeforeUpdate(Fe,w),f.__reactInternalSnapshotBeforeUpdate=s}catch(We){Dt(c,c.return,We)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)hg(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":hg(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=a.sibling,s!==null){s.return=a.return,Mn=s;break}Mn=a.return}}function av(s,a,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:ui(s,c),f&4&&tu(5,c);break;case 1:if(ui(s,c),f&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(z){Dt(c,c.return,z)}else{var b=mo(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(b,a,s.__reactInternalSnapshotBeforeUpdate)}catch(z){Dt(c,c.return,z)}}f&64&&ev(c),f&512&&nu(c,c.return);break;case 3:if(ui(s,c),f&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{q_(s,a)}catch(z){Dt(c,c.return,z)}}break;case 27:a===null&&f&4&&sv(c);case 26:case 5:ui(s,c),a===null&&f&4&&nv(c),f&512&&nu(c,c.return);break;case 12:ui(s,c);break;case 31:ui(s,c),f&4&&cv(s,c);break;case 13:ui(s,c),f&4&&uv(s,c),f&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=XA.bind(null,c),y2(s,c))));break;case 22:if(f=c.memoizedState!==null||li,!f){a=a!==null&&a.memoizedState!==null||bn,b=li;var w=bn;li=f,(bn=a)&&!w?di(s,c,(c.subtreeFlags&8772)!==0):ui(s,c),li=b,bn=w}break;case 30:break;default:ui(s,c)}}function ov(s){var a=s.alternate;a!==null&&(s.alternate=null,ov(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Ho(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Kt=null,ur=!1;function ci(s,a,c){for(c=c.child;c!==null;)lv(s,a,c),c=c.sibling}function lv(s,a,c){if(nn&&typeof nn.onCommitFiberUnmount=="function")try{nn.onCommitFiberUnmount(xt,c)}catch{}switch(c.tag){case 26:bn||Ps(c,a),ci(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:bn||Ps(c,a);var f=Kt,b=ur;na(c.type)&&(Kt=c.stateNode,ur=!1),ci(s,a,c),du(c.stateNode),Kt=f,ur=b;break;case 5:bn||Ps(c,a);case 6:if(f=Kt,b=ur,Kt=null,ci(s,a,c),Kt=f,ur=b,Kt!==null)if(ur)try{(Kt.nodeType===9?Kt.body:Kt.nodeName==="HTML"?Kt.ownerDocument.body:Kt).removeChild(c.stateNode)}catch(w){Dt(c,a,w)}else try{Kt.removeChild(c.stateNode)}catch(w){Dt(c,a,w)}break;case 18:Kt!==null&&(ur?(s=Kt,ex(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Rl(s)):ex(Kt,c.stateNode));break;case 4:f=Kt,b=ur,Kt=c.stateNode.containerInfo,ur=!0,ci(s,a,c),Kt=f,ur=b;break;case 0:case 11:case 14:case 15:Ki(2,c,a),bn||Ki(4,c,a),ci(s,a,c);break;case 1:bn||(Ps(c,a),f=c.stateNode,typeof f.componentWillUnmount=="function"&&tv(c,a,f)),ci(s,a,c);break;case 21:ci(s,a,c);break;case 22:bn=(f=bn)||c.memoizedState!==null,ci(s,a,c),bn=f;break;default:ci(s,a,c)}}function cv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Rl(s)}catch(c){Dt(a,a.return,c)}}}function uv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Rl(s)}catch(c){Dt(a,a.return,c)}}function $A(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new iv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new iv),a;default:throw Error(r(435,s.tag))}}function uh(s,a){var c=$A(s);a.forEach(function(f){if(!c.has(f)){c.add(f);var b=ZA.bind(null,s,f);f.then(b,b)}})}function dr(s,a){var c=a.deletions;if(c!==null)for(var f=0;f<c.length;f++){var b=c[f],w=s,z=a,Q=z;e:for(;Q!==null;){switch(Q.tag){case 27:if(na(Q.type)){Kt=Q.stateNode,ur=!1;break e}break;case 5:Kt=Q.stateNode,ur=!1;break e;case 3:case 4:Kt=Q.stateNode.containerInfo,ur=!0;break e}Q=Q.return}if(Kt===null)throw Error(r(160));lv(w,z,b),Kt=null,ur=!1,w=b.alternate,w!==null&&(w.return=null),b.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)dv(a,s),a=a.sibling}var is=null;function dv(s,a){var c=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:dr(a,s),hr(s),f&4&&(Ki(3,s,s.return),tu(3,s),Ki(5,s,s.return));break;case 1:dr(a,s),hr(s),f&512&&(bn||c===null||Ps(c,c.return)),f&64&&li&&(s=s.updateQueue,s!==null&&(f=s.callbacks,f!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var b=is;if(dr(a,s),hr(s),f&512&&(bn||c===null||Ps(c,c.return)),f&4){var w=c!==null?c.memoizedState:null;if(f=s.memoizedState,c===null)if(f===null)if(s.stateNode===null){e:{f=s.type,c=s.memoizedProps,b=b.ownerDocument||b;t:switch(f){case"title":w=b.getElementsByTagName("title")[0],(!w||w[ws]||w[fn]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=b.createElement(f),b.head.insertBefore(w,b.querySelector("head > title"))),Fn(w,f,c),w[fn]=s,mn(w),f=w;break e;case"link":var z=dx("link","href",b).get(f+(c.href||""));if(z){for(var Q=0;Q<z.length;Q++)if(w=z[Q],w.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&w.getAttribute("rel")===(c.rel==null?null:c.rel)&&w.getAttribute("title")===(c.title==null?null:c.title)&&w.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){z.splice(Q,1);break t}}w=b.createElement(f),Fn(w,f,c),b.head.appendChild(w);break;case"meta":if(z=dx("meta","content",b).get(f+(c.content||""))){for(Q=0;Q<z.length;Q++)if(w=z[Q],w.getAttribute("content")===(c.content==null?null:""+c.content)&&w.getAttribute("name")===(c.name==null?null:c.name)&&w.getAttribute("property")===(c.property==null?null:c.property)&&w.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&w.getAttribute("charset")===(c.charSet==null?null:c.charSet)){z.splice(Q,1);break t}}w=b.createElement(f),Fn(w,f,c),b.head.appendChild(w);break;default:throw Error(r(468,f))}w[fn]=s,mn(w),f=w}s.stateNode=f}else hx(b,s.type,s.stateNode);else s.stateNode=ux(b,f,s.memoizedProps);else w!==f?(w===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):w.count--,f===null?hx(b,s.type,s.stateNode):ux(b,f,s.memoizedProps)):f===null&&s.stateNode!==null&&Bp(s,s.memoizedProps,c.memoizedProps)}break;case 27:dr(a,s),hr(s),f&512&&(bn||c===null||Ps(c,c.return)),c!==null&&f&4&&Bp(s,s.memoizedProps,c.memoizedProps);break;case 5:if(dr(a,s),hr(s),f&512&&(bn||c===null||Ps(c,c.return)),s.flags&32){b=s.stateNode;try{cr(b,"")}catch(Fe){Dt(s,s.return,Fe)}}f&4&&s.stateNode!=null&&(b=s.memoizedProps,Bp(s,b,c!==null?c.memoizedProps:b)),f&1024&&(Fp=!0);break;case 6:if(dr(a,s),hr(s),f&4){if(s.stateNode===null)throw Error(r(162));f=s.memoizedProps,c=s.stateNode;try{c.nodeValue=f}catch(Fe){Dt(s,s.return,Fe)}}break;case 3:if(Th=null,b=is,is=Ch(a.containerInfo),dr(a,s),is=b,hr(s),f&4&&c!==null&&c.memoizedState.isDehydrated)try{Rl(a.containerInfo)}catch(Fe){Dt(s,s.return,Fe)}Fp&&(Fp=!1,hv(s));break;case 4:f=is,is=Ch(s.stateNode.containerInfo),dr(a,s),hr(s),is=f;break;case 12:dr(a,s),hr(s);break;case 31:dr(a,s),hr(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,uh(s,f)));break;case 13:dr(a,s),hr(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(hh=Ne()),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,uh(s,f)));break;case 22:b=s.memoizedState!==null;var re=c!==null&&c.memoizedState!==null,ge=li,Ee=bn;if(li=ge||b,bn=Ee||re,dr(a,s),bn=Ee,li=ge,hr(s),f&8192)e:for(a=s.stateNode,a._visibility=b?a._visibility&-2:a._visibility|1,b&&(c===null||re||li||bn||po(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){re=c=a;try{if(w=re.stateNode,b)z=w.style,typeof z.setProperty=="function"?z.setProperty("display","none","important"):z.display="none";else{Q=re.stateNode;var Ie=re.memoizedProps.style,_e=Ie!=null&&Ie.hasOwnProperty("display")?Ie.display:null;Q.style.display=_e==null||typeof _e=="boolean"?"":(""+_e).trim()}}catch(Fe){Dt(re,re.return,Fe)}}}else if(a.tag===6){if(c===null){re=a;try{re.stateNode.nodeValue=b?"":re.memoizedProps}catch(Fe){Dt(re,re.return,Fe)}}}else if(a.tag===18){if(c===null){re=a;try{var xe=re.stateNode;b?tx(xe,!0):tx(re.stateNode,!1)}catch(Fe){Dt(re,re.return,Fe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}f&4&&(f=s.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,uh(s,c))));break;case 19:dr(a,s),hr(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,uh(s,f)));break;case 30:break;case 21:break;default:dr(a,s),hr(s)}}function hr(s){var a=s.flags;if(a&2){try{for(var c,f=s.return;f!==null;){if(rv(f)){c=f;break}f=f.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var b=c.stateNode,w=Lp(s);ch(s,w,b);break;case 5:var z=c.stateNode;c.flags&32&&(cr(z,""),c.flags&=-33);var Q=Lp(s);ch(s,Q,z);break;case 3:case 4:var re=c.stateNode.containerInfo,ge=Lp(s);Up(s,ge,re);break;default:throw Error(r(161))}}catch(Ee){Dt(s,s.return,Ee)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function hv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;hv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function ui(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)av(s,a.alternate,a),a=a.sibling}function po(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:Ki(4,a,a.return),po(a);break;case 1:Ps(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&tv(a,a.return,c),po(a);break;case 27:du(a.stateNode);case 26:case 5:Ps(a,a.return),po(a);break;case 22:a.memoizedState===null&&po(a);break;case 30:po(a);break;default:po(a)}s=s.sibling}}function di(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var f=a.alternate,b=s,w=a,z=w.flags;switch(w.tag){case 0:case 11:case 15:di(b,w,c),tu(4,w);break;case 1:if(di(b,w,c),f=w,b=f.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(ge){Dt(f,f.return,ge)}if(f=w,b=f.updateQueue,b!==null){var Q=f.stateNode;try{var re=b.shared.hiddenCallbacks;if(re!==null)for(b.shared.hiddenCallbacks=null,b=0;b<re.length;b++)$_(re[b],Q)}catch(ge){Dt(f,f.return,ge)}}c&&z&64&&ev(w),nu(w,w.return);break;case 27:sv(w);case 26:case 5:di(b,w,c),c&&f===null&&z&4&&nv(w),nu(w,w.return);break;case 12:di(b,w,c);break;case 31:di(b,w,c),c&&z&4&&cv(b,w);break;case 13:di(b,w,c),c&&z&4&&uv(b,w);break;case 22:w.memoizedState===null&&di(b,w,c),nu(w,w.return);break;case 30:break;default:di(b,w,c)}a=a.sibling}}function Vp(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Vc(c))}function $p(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Vc(s))}function as(s,a,c,f){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)fv(s,a,c,f),a=a.sibling}function fv(s,a,c,f){var b=a.flags;switch(a.tag){case 0:case 11:case 15:as(s,a,c,f),b&2048&&tu(9,a);break;case 1:as(s,a,c,f);break;case 3:as(s,a,c,f),b&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Vc(s)));break;case 12:if(b&2048){as(s,a,c,f),s=a.stateNode;try{var w=a.memoizedProps,z=w.id,Q=w.onPostCommit;typeof Q=="function"&&Q(z,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(re){Dt(a,a.return,re)}}else as(s,a,c,f);break;case 31:as(s,a,c,f);break;case 13:as(s,a,c,f);break;case 23:break;case 22:w=a.stateNode,z=a.alternate,a.memoizedState!==null?w._visibility&2?as(s,a,c,f):ru(s,a):w._visibility&2?as(s,a,c,f):(w._visibility|=2,_l(s,a,c,f,(a.subtreeFlags&10256)!==0||!1)),b&2048&&Vp(z,a);break;case 24:as(s,a,c,f),b&2048&&$p(a.alternate,a);break;default:as(s,a,c,f)}}function _l(s,a,c,f,b){for(b=b&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var w=s,z=a,Q=c,re=f,ge=z.flags;switch(z.tag){case 0:case 11:case 15:_l(w,z,Q,re,b),tu(8,z);break;case 23:break;case 22:var Ee=z.stateNode;z.memoizedState!==null?Ee._visibility&2?_l(w,z,Q,re,b):ru(w,z):(Ee._visibility|=2,_l(w,z,Q,re,b)),b&&ge&2048&&Vp(z.alternate,z);break;case 24:_l(w,z,Q,re,b),b&&ge&2048&&$p(z.alternate,z);break;default:_l(w,z,Q,re,b)}a=a.sibling}}function ru(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,f=a,b=f.flags;switch(f.tag){case 22:ru(c,f),b&2048&&Vp(f.alternate,f);break;case 24:ru(c,f),b&2048&&$p(f.alternate,f);break;default:ru(c,f)}a=a.sibling}}var su=8192;function bl(s,a,c){if(s.subtreeFlags&su)for(s=s.child;s!==null;)mv(s,a,c),s=s.sibling}function mv(s,a,c){switch(s.tag){case 26:bl(s,a,c),s.flags&su&&s.memoizedState!==null&&R2(c,is,s.memoizedState,s.memoizedProps);break;case 5:bl(s,a,c);break;case 3:case 4:var f=is;is=Ch(s.stateNode.containerInfo),bl(s,a,c),is=f;break;case 22:s.memoizedState===null&&(f=s.alternate,f!==null&&f.memoizedState!==null?(f=su,su=16777216,bl(s,a,c),su=f):bl(s,a,c));break;default:bl(s,a,c)}}function pv(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function iu(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];Mn=f,yv(f,s)}pv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)gv(s),s=s.sibling}function gv(s){switch(s.tag){case 0:case 11:case 15:iu(s),s.flags&2048&&Ki(9,s,s.return);break;case 3:iu(s);break;case 12:iu(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,dh(s)):iu(s);break;default:iu(s)}}function dh(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];Mn=f,yv(f,s)}pv(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:Ki(8,a,a.return),dh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,dh(a));break;default:dh(a)}s=s.sibling}}function yv(s,a){for(;Mn!==null;){var c=Mn;switch(c.tag){case 0:case 11:case 15:Ki(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Vc(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,Mn=f;else e:for(c=s;Mn!==null;){f=Mn;var b=f.sibling,w=f.return;if(ov(f),f===c){Mn=null;break e}if(b!==null){b.return=w,Mn=b;break e}Mn=w}}}var qA={getCacheForType:function(s){var a=Ln(gn),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return Ln(gn).controller.signal}},HA=typeof WeakMap=="function"?WeakMap:Map,jt=0,Ut=null,ut=null,ft=0,kt=0,Tr=null,Yi=!1,vl=!1,qp=!1,hi=0,sn=0,Xi=0,go=0,Hp=0,Ar=0,xl=0,au=null,fr=null,Gp=!1,hh=0,_v=0,fh=1/0,mh=null,Zi=null,En=0,Ji=null,wl=null,fi=0,Qp=0,Wp=null,bv=null,ou=0,Kp=null;function jr(){return(jt&2)!==0&&ft!==0?ft&-ft:K.T!==null?tg():pd()}function vv(){if(Ar===0)if((ft&536870912)===0||_t){var s=_s;_s<<=1,(_s&3932160)===0&&(_s=262144),Ar=s}else Ar=536870912;return s=Cr.current,s!==null&&(s.flags|=32),Ar}function mr(s,a,c){(s===Ut&&(kt===2||kt===9)||s.cancelPendingCommit!==null)&&(Sl(s,0),ea(s,ft,Ar,!1)),$a(s,c),((jt&2)===0||s!==Ut)&&(s===Ut&&((jt&2)===0&&(go|=c),sn===4&&ea(s,ft,Ar,!1)),zs(s))}function xv(s,a,c){if((jt&6)!==0)throw Error(r(327));var f=!c&&(a&127)===0&&(a&s.expiredLanes)===0||Yr(s,a),b=f?WA(s,a):Xp(s,a,!0),w=f;do{if(b===0){vl&&!f&&ea(s,a,0,!1);break}else{if(c=s.current.alternate,w&&!GA(c)){b=Xp(s,a,!1),w=!1;continue}if(b===2){if(w=a,s.errorRecoveryDisabledLanes&w)var z=0;else z=s.pendingLanes&-536870913,z=z!==0?z:z&536870912?536870912:0;if(z!==0){a=z;e:{var Q=s;b=au;var re=Q.current.memoizedState.isDehydrated;if(re&&(Sl(Q,z).flags|=256),z=Xp(Q,z,!1),z!==2){if(qp&&!re){Q.errorRecoveryDisabledLanes|=w,go|=w,b=4;break e}w=fr,fr=b,w!==null&&(fr===null?fr=w:fr.push.apply(fr,w))}b=z}if(w=!1,b!==2)continue}}if(b===1){Sl(s,0),ea(s,a,0,!0);break}e:{switch(f=s,w=b,w){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:ea(f,a,Ar,!Yi);break e;case 2:fr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(b=hh+300-Ne(),10<b)){if(ea(f,a,Ar,!Yi),bs(f,0,!0)!==0)break e;fi=a,f.timeoutHandle=Zv(wv.bind(null,f,c,fr,mh,Gp,a,Ar,go,xl,Yi,w,"Throttled",-0,0),b);break e}wv(f,c,fr,mh,Gp,a,Ar,go,xl,Yi,w,null,-0,0)}}break}while(!0);zs(s)}function wv(s,a,c,f,b,w,z,Q,re,ge,Ee,Ie,_e,xe){if(s.timeoutHandle=-1,Ie=a.subtreeFlags,Ie&8192||(Ie&16785408)===16785408){Ie={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Jr},mv(a,w,Ie);var Fe=(w&62914560)===w?hh-Ne():(w&4194048)===w?_v-Ne():0;if(Fe=I2(Ie,Fe),Fe!==null){fi=w,s.cancelPendingCommit=Fe(Iv.bind(null,s,a,w,c,f,b,z,Q,re,Ee,Ie,null,_e,xe)),ea(s,w,z,!ge);return}}Iv(s,a,w,c,f,b,z,Q,re)}function GA(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var b=c[f],w=b.getSnapshot;b=b.value;try{if(!wr(w(),b))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function ea(s,a,c,f){a&=~Hp,a&=~go,s.suspendedLanes|=a,s.pingedLanes&=~a,f&&(s.warmLanes|=a),f=s.expirationTimes;for(var b=a;0<b;){var w=31-Tt(b),z=1<<w;f[w]=-1,b&=~z}c!==0&&qa(s,c,a)}function ph(){return(jt&6)===0?(lu(0),!1):!0}function Yp(){if(ut!==null){if(kt===0)var s=ut.return;else s=ut,ni=ao=null,hp(s),fl=null,qc=0,s=ut;for(;s!==null;)Jb(s.alternate,s),s=s.return;ut=null}}function Sl(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,h2(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),fi=0,Yp(),Ut=s,ut=c=ei(s.current,null),ft=a,kt=0,Tr=null,Yi=!1,vl=Yr(s,a),qp=!1,xl=Ar=Hp=go=Xi=sn=0,fr=au=null,Gp=!1,(a&8)!==0&&(a|=a&32);var f=s.entangledLanes;if(f!==0)for(s=s.entanglements,f&=a;0<f;){var b=31-Tt(f),w=1<<b;a|=s[b],f&=~w}return hi=a,Pd(),c}function Sv(s,a){at=null,K.H=Zc,a===hl||a===qd?(a=L_(),kt=3):a===ep?(a=L_(),kt=4):kt=a===jp?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Tr=a,ut===null&&(sn=1,sh(s,Br(a,s.current)))}function Cv(){var s=Cr.current;return s===null?!0:(ft&4194048)===ft?Vr===null:(ft&62914560)===ft||(ft&536870912)!==0?s===Vr:!1}function Ev(){var s=K.H;return K.H=Zc,s===null?Zc:s}function Tv(){var s=K.A;return K.A=qA,s}function gh(){sn=4,Yi||(ft&4194048)!==ft&&Cr.current!==null||(vl=!0),(Xi&134217727)===0&&(go&134217727)===0||Ut===null||ea(Ut,ft,Ar,!1)}function Xp(s,a,c){var f=jt;jt|=2;var b=Ev(),w=Tv();(Ut!==s||ft!==a)&&(mh=null,Sl(s,a)),a=!1;var z=sn;e:do try{if(kt!==0&&ut!==null){var Q=ut,re=Tr;switch(kt){case 8:Yp(),z=6;break e;case 3:case 2:case 9:case 6:Cr.current===null&&(a=!0);var ge=kt;if(kt=0,Tr=null,Cl(s,Q,re,ge),c&&vl){z=0;break e}break;default:ge=kt,kt=0,Tr=null,Cl(s,Q,re,ge)}}QA(),z=sn;break}catch(Ee){Sv(s,Ee)}while(!0);return a&&s.shellSuspendCounter++,ni=ao=null,jt=f,K.H=b,K.A=w,ut===null&&(Ut=null,ft=0,Pd()),z}function QA(){for(;ut!==null;)Av(ut)}function WA(s,a){var c=jt;jt|=2;var f=Ev(),b=Tv();Ut!==s||ft!==a?(mh=null,fh=Ne()+500,Sl(s,a)):vl=Yr(s,a);e:do try{if(kt!==0&&ut!==null){a=ut;var w=Tr;t:switch(kt){case 1:kt=0,Tr=null,Cl(s,a,w,1);break;case 2:case 9:if(z_(w)){kt=0,Tr=null,jv(a);break}a=function(){kt!==2&&kt!==9||Ut!==s||(kt=7),zs(s)},w.then(a,a);break e;case 3:kt=7;break e;case 4:kt=5;break e;case 7:z_(w)?(kt=0,Tr=null,jv(a)):(kt=0,Tr=null,Cl(s,a,w,7));break;case 5:var z=null;switch(ut.tag){case 26:z=ut.memoizedState;case 5:case 27:var Q=ut;if(z?fx(z):Q.stateNode.complete){kt=0,Tr=null;var re=Q.sibling;if(re!==null)ut=re;else{var ge=Q.return;ge!==null?(ut=ge,yh(ge)):ut=null}break t}}kt=0,Tr=null,Cl(s,a,w,5);break;case 6:kt=0,Tr=null,Cl(s,a,w,6);break;case 8:Yp(),sn=6;break e;default:throw Error(r(462))}}KA();break}catch(Ee){Sv(s,Ee)}while(!0);return ni=ao=null,K.H=f,K.A=b,jt=c,ut!==null?0:(Ut=null,ft=0,Pd(),sn)}function KA(){for(;ut!==null&&!ae();)Av(ut)}function Av(s){var a=Xb(s.alternate,s,hi);s.memoizedProps=s.pendingProps,a===null?yh(s):ut=a}function jv(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=Hb(c,a,a.pendingProps,a.type,void 0,ft);break;case 11:a=Hb(c,a,a.pendingProps,a.type.render,a.ref,ft);break;case 5:hp(a);default:Jb(c,a),a=ut=T_(a,hi),a=Xb(c,a,hi)}s.memoizedProps=s.pendingProps,a===null?yh(s):ut=a}function Cl(s,a,c,f){ni=ao=null,hp(a),fl=null,qc=0;var b=a.return;try{if(zA(s,b,a,c,ft)){sn=1,sh(s,Br(c,s.current)),ut=null;return}}catch(w){if(b!==null)throw ut=b,w;sn=1,sh(s,Br(c,s.current)),ut=null;return}a.flags&32768?(_t||f===1?s=!0:vl||(ft&536870912)!==0?s=!1:(Yi=s=!0,(f===2||f===9||f===3||f===6)&&(f=Cr.current,f!==null&&f.tag===13&&(f.flags|=16384))),Rv(a,s)):yh(a)}function yh(s){var a=s;do{if((a.flags&32768)!==0){Rv(a,Yi);return}s=a.return;var c=UA(a.alternate,a,hi);if(c!==null){ut=c;return}if(a=a.sibling,a!==null){ut=a;return}ut=a=s}while(a!==null);sn===0&&(sn=5)}function Rv(s,a){do{var c=FA(s.alternate,s);if(c!==null){c.flags&=32767,ut=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){ut=s;return}ut=s=c}while(s!==null);sn=6,ut=null}function Iv(s,a,c,f,b,w,z,Q,re){s.cancelPendingCommit=null;do _h();while(En!==0);if((jt&6)!==0)throw Error(r(327));if(a!==null){if(a===s.current)throw Error(r(177));if(w=a.lanes|a.childLanes,w|=Lm,Im(s,c,w,z,Q,re),s===Ut&&(ut=Ut=null,ft=0),wl=a,Ji=s,fi=c,Qp=w,Wp=b,bv=f,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,JA(nt,function(){return Nv(),null})):(s.callbackNode=null,s.callbackPriority=0),f=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||f){f=K.T,K.T=null,b=G.p,G.p=2,z=jt,jt|=4;try{VA(s,a,c)}finally{jt=z,G.p=b,K.T=f}}En=1,kv(),Dv(),Mv()}}function kv(){if(En===1){En=0;var s=Ji,a=wl,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=K.T,K.T=null;var f=G.p;G.p=2;var b=jt;jt|=4;try{dv(a,s);var w=cg,z=y_(s.containerInfo),Q=w.focusedElem,re=w.selectionRange;if(z!==Q&&Q&&Q.ownerDocument&&g_(Q.ownerDocument.documentElement,Q)){if(re!==null&&Om(Q)){var ge=re.start,Ee=re.end;if(Ee===void 0&&(Ee=ge),"selectionStart"in Q)Q.selectionStart=ge,Q.selectionEnd=Math.min(Ee,Q.value.length);else{var Ie=Q.ownerDocument||document,_e=Ie&&Ie.defaultView||window;if(_e.getSelection){var xe=_e.getSelection(),Fe=Q.textContent.length,We=Math.min(re.start,Fe),Pt=re.end===void 0?We:Math.min(re.end,Fe);!xe.extend&&We>Pt&&(z=Pt,Pt=We,We=z);var ue=p_(Q,We),le=p_(Q,Pt);if(ue&&le&&(xe.rangeCount!==1||xe.anchorNode!==ue.node||xe.anchorOffset!==ue.offset||xe.focusNode!==le.node||xe.focusOffset!==le.offset)){var pe=Ie.createRange();pe.setStart(ue.node,ue.offset),xe.removeAllRanges(),We>Pt?(xe.addRange(pe),xe.extend(le.node,le.offset)):(pe.setEnd(le.node,le.offset),xe.addRange(pe))}}}}for(Ie=[],xe=Q;xe=xe.parentNode;)xe.nodeType===1&&Ie.push({element:xe,left:xe.scrollLeft,top:xe.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<Ie.length;Q++){var Te=Ie[Q];Te.element.scrollLeft=Te.left,Te.element.scrollTop=Te.top}}Ih=!!lg,cg=lg=null}finally{jt=b,G.p=f,K.T=c}}s.current=a,En=2}}function Dv(){if(En===2){En=0;var s=Ji,a=wl,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=K.T,K.T=null;var f=G.p;G.p=2;var b=jt;jt|=4;try{av(s,a.alternate,a)}finally{jt=b,G.p=f,K.T=c}}En=3}}function Mv(){if(En===4||En===3){En=0,Ae();var s=Ji,a=wl,c=fi,f=bv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?En=5:(En=0,wl=Ji=null,Ov(s,s.pendingLanes));var b=s.pendingLanes;if(b===0&&(Zi=null),Ys(c),a=a.stateNode,nn&&typeof nn.onCommitFiberRoot=="function")try{nn.onCommitFiberRoot(xt,a,void 0,(a.current.flags&128)===128)}catch{}if(f!==null){a=K.T,b=G.p,G.p=2,K.T=null;try{for(var w=s.onRecoverableError,z=0;z<f.length;z++){var Q=f[z];w(Q.value,{componentStack:Q.stack})}}finally{K.T=a,G.p=b}}(fi&3)!==0&&_h(),zs(s),b=s.pendingLanes,(c&261930)!==0&&(b&42)!==0?s===Kp?ou++:(ou=0,Kp=s):ou=0,lu(0)}}function Ov(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Vc(a)))}function _h(){return kv(),Dv(),Mv(),Nv()}function Nv(){if(En!==5)return!1;var s=Ji,a=Qp;Qp=0;var c=Ys(fi),f=K.T,b=G.p;try{G.p=32>c?32:c,K.T=null,c=Wp,Wp=null;var w=Ji,z=fi;if(En=0,wl=Ji=null,fi=0,(jt&6)!==0)throw Error(r(331));var Q=jt;if(jt|=4,gv(w.current),fv(w,w.current,z,c),jt=Q,lu(0,!1),nn&&typeof nn.onPostCommitFiberRoot=="function")try{nn.onPostCommitFiberRoot(xt,w)}catch{}return!0}finally{G.p=b,K.T=f,Ov(s,a)}}function Pv(s,a,c){a=Br(c,a),a=Ap(s.stateNode,a,2),s=Gi(s,a,2),s!==null&&($a(s,2),zs(s))}function Dt(s,a,c){if(s.tag===3)Pv(s,s,c);else for(;a!==null;){if(a.tag===3){Pv(a,s,c);break}else if(a.tag===1){var f=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Zi===null||!Zi.has(f))){s=Br(c,s),c=zb(2),f=Gi(a,c,2),f!==null&&(Bb(c,f,a,s),$a(f,2),zs(f));break}}a=a.return}}function Zp(s,a,c){var f=s.pingCache;if(f===null){f=s.pingCache=new HA;var b=new Set;f.set(a,b)}else b=f.get(a),b===void 0&&(b=new Set,f.set(a,b));b.has(c)||(qp=!0,b.add(c),s=YA.bind(null,s,a,c),a.then(s,s))}function YA(s,a,c){var f=s.pingCache;f!==null&&f.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,Ut===s&&(ft&c)===c&&(sn===4||sn===3&&(ft&62914560)===ft&&300>Ne()-hh?(jt&2)===0&&Sl(s,0):Hp|=c,xl===ft&&(xl=0)),zs(s)}function zv(s,a){a===0&&(a=md()),s=ro(s,a),s!==null&&($a(s,a),zs(s))}function XA(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),zv(s,c)}function ZA(s,a){var c=0;switch(s.tag){case 31:case 13:var f=s.stateNode,b=s.memoizedState;b!==null&&(c=b.retryLane);break;case 19:f=s.stateNode;break;case 22:f=s.stateNode._retryCache;break;default:throw Error(r(314))}f!==null&&f.delete(a),zv(s,c)}function JA(s,a){return Se(s,a)}var bh=null,El=null,Jp=!1,vh=!1,eg=!1,ta=0;function zs(s){s!==El&&s.next===null&&(El===null?bh=El=s:El=El.next=s),vh=!0,Jp||(Jp=!0,t2())}function lu(s,a){if(!eg&&vh){eg=!0;do for(var c=!1,f=bh;f!==null;){if(s!==0){var b=f.pendingLanes;if(b===0)var w=0;else{var z=f.suspendedLanes,Q=f.pingedLanes;w=(1<<31-Tt(42|s)+1)-1,w&=b&~(z&~Q),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(c=!0,Fv(f,w))}else w=ft,w=bs(f,f===Ut?w:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(w&3)===0||Yr(f,w)||(c=!0,Fv(f,w));f=f.next}while(c);eg=!1}}function e2(){Bv()}function Bv(){vh=Jp=!1;var s=0;ta!==0&&d2()&&(s=ta);for(var a=Ne(),c=null,f=bh;f!==null;){var b=f.next,w=Lv(f,a);w===0?(f.next=null,c===null?bh=b:c.next=b,b===null&&(El=c)):(c=f,(s!==0||(w&3)!==0)&&(vh=!0)),f=b}En!==0&&En!==5||lu(s),ta!==0&&(ta=0)}function Lv(s,a){for(var c=s.suspendedLanes,f=s.pingedLanes,b=s.expirationTimes,w=s.pendingLanes&-62914561;0<w;){var z=31-Tt(w),Q=1<<z,re=b[z];re===-1?((Q&c)===0||(Q&f)!==0)&&(b[z]=Rm(Q,a)):re<=a&&(s.expiredLanes|=Q),w&=~Q}if(a=Ut,c=ft,c=bs(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f=s.callbackNode,c===0||s===a&&(kt===2||kt===9)||s.cancelPendingCommit!==null)return f!==null&&f!==null&&we(f),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Yr(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(f!==null&&we(f),Ys(c)){case 2:case 8:c=wt;break;case 32:c=nt;break;case 268435456:c=gs;break;default:c=nt}return f=Uv.bind(null,s),c=Se(c,f),s.callbackPriority=a,s.callbackNode=c,a}return f!==null&&f!==null&&we(f),s.callbackPriority=2,s.callbackNode=null,2}function Uv(s,a){if(En!==0&&En!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(_h()&&s.callbackNode!==c)return null;var f=ft;return f=bs(s,s===Ut?f:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f===0?null:(xv(s,f,a),Lv(s,Ne()),s.callbackNode!=null&&s.callbackNode===c?Uv.bind(null,s):null)}function Fv(s,a){if(_h())return null;xv(s,a,!0)}function t2(){f2(function(){(jt&6)!==0?Se(He,e2):Bv()})}function tg(){if(ta===0){var s=ul;s===0&&(s=Dr,Dr<<=1,(Dr&261888)===0&&(Dr=256)),ta=s}return ta}function Vv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Ko(""+s)}function $v(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function n2(s,a,c,f,b){if(a==="submit"&&c&&c.stateNode===b){var w=Vv((b[kn]||null).action),z=f.submitter;z&&(a=(a=z[kn]||null)?Vv(a.formAction):z.getAttribute("formAction"),a!==null&&(w=a,z=null));var Q=new Is("action","action",null,f,b);s.push({event:Q,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(ta!==0){var re=z?$v(b,z):new FormData(b);xp(c,{pending:!0,data:re,method:b.method,action:w},null,re)}}else typeof w=="function"&&(Q.preventDefault(),re=z?$v(b,z):new FormData(b),xp(c,{pending:!0,data:re,method:b.method,action:w},w,re))},currentTarget:b}]})}}for(var ng=0;ng<Bm.length;ng++){var rg=Bm[ng],r2=rg.toLowerCase(),s2=rg[0].toUpperCase()+rg.slice(1);ss(r2,"on"+s2)}ss(v_,"onAnimationEnd"),ss(x_,"onAnimationIteration"),ss(w_,"onAnimationStart"),ss("dblclick","onDoubleClick"),ss("focusin","onFocus"),ss("focusout","onBlur"),ss(vA,"onTransitionRun"),ss(xA,"onTransitionStart"),ss(wA,"onTransitionCancel"),ss(S_,"onTransitionEnd"),Ts("onMouseEnter",["mouseout","mouseover"]),Ts("onMouseLeave",["mouseout","mouseover"]),Ts("onPointerEnter",["pointerout","pointerover"]),Ts("onPointerLeave",["pointerout","pointerover"]),Es("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Es("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Es("onBeforeInput",["compositionend","keypress","textInput","paste"]),Es("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Es("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Es("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),i2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(cu));function qv(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var f=s[c],b=f.event;f=f.listeners;e:{var w=void 0;if(a)for(var z=f.length-1;0<=z;z--){var Q=f[z],re=Q.instance,ge=Q.currentTarget;if(Q=Q.listener,re!==w&&b.isPropagationStopped())break e;w=Q,b.currentTarget=ge;try{w(b)}catch(Ee){Nd(Ee)}b.currentTarget=null,w=re}else for(z=0;z<f.length;z++){if(Q=f[z],re=Q.instance,ge=Q.currentTarget,Q=Q.listener,re!==w&&b.isPropagationStopped())break e;w=Q,b.currentTarget=ge;try{w(b)}catch(Ee){Nd(Ee)}b.currentTarget=null,w=re}}}}function dt(s,a){var c=a[qo];c===void 0&&(c=a[qo]=new Set);var f=s+"__bubble";c.has(f)||(Hv(a,s,2,!1),c.add(f))}function sg(s,a,c){var f=0;a&&(f|=4),Hv(c,s,f,a)}var xh="_reactListening"+Math.random().toString(36).slice(2);function ig(s){if(!s[xh]){s[xh]=!0,xc.forEach(function(c){c!=="selectionchange"&&(i2.has(c)||sg(c,!1,s),sg(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[xh]||(a[xh]=!0,sg("selectionchange",!1,a))}}function Hv(s,a,c,f){switch(vx(a)){case 2:var b=M2;break;case 8:b=O2;break;default:b=vg}c=b.bind(null,a,c,s),b=void 0,!Ka||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(b=!0),f?b!==void 0?s.addEventListener(a,c,{capture:!0,passive:b}):s.addEventListener(a,c,!0):b!==void 0?s.addEventListener(a,c,{passive:b}):s.addEventListener(a,c,!1)}function ag(s,a,c,f,b){var w=f;if((a&1)===0&&(a&2)===0&&f!==null)e:for(;;){if(f===null)return;var z=f.tag;if(z===3||z===4){var Q=f.stateNode.containerInfo;if(Q===b)break;if(z===4)for(z=f.return;z!==null;){var re=z.tag;if((re===3||re===4)&&z.stateNode.containerInfo===b)return;z=z.return}for(;Q!==null;){if(z=Ss(Q),z===null)return;if(re=z.tag,re===5||re===6||re===26||re===27){f=w=z;continue e}Q=Q.parentNode}}f=f.return}Pi(function(){var ge=w,Ee=Or(c),Ie=[];e:{var _e=C_.get(s);if(_e!==void 0){var xe=Is,Fe=s;switch(s){case"keypress":if(Xa(c)===0)break e;case"keydown":case"keyup":xe=Dd;break;case"focusin":Fe="focus",xe=Ja;break;case"focusout":Fe="blur",xe=Ja;break;case"beforeblur":case"afterblur":xe=Ja;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":xe=Oc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":xe=Sd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":xe=j;break;case v_:case x_:case w_:xe=Ed;break;case S_:xe=Y;break;case"scroll":case"scrollend":xe=Mc;break;case"wheel":xe=ve;break;case"copy":case"cut":case"paste":xe=Td;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":xe=Js;break;case"toggle":case"beforetoggle":xe=it}var We=(a&4)!==0,Pt=!We&&(s==="scroll"||s==="scrollend"),ue=We?_e!==null?_e+"Capture":null:_e;We=[];for(var le=ge,pe;le!==null;){var Te=le;if(pe=Te.stateNode,Te=Te.tag,Te!==5&&Te!==26&&Te!==27||pe===null||ue===null||(Te=es(le,ue),Te!=null&&We.push(uu(le,Te,pe))),Pt)break;le=le.return}0<We.length&&(_e=new xe(_e,Fe,null,c,Ee),Ie.push({event:_e,listeners:We}))}}if((a&7)===0){e:{if(_e=s==="mouseover"||s==="pointerover",xe=s==="mouseout"||s==="pointerout",_e&&c!==Ic&&(Fe=c.relatedTarget||c.fromElement)&&(Ss(Fe)||Fe[xs]))break e;if((xe||_e)&&(_e=Ee.window===Ee?Ee:(_e=Ee.ownerDocument)?_e.defaultView||_e.parentWindow:window,xe?(Fe=c.relatedTarget||c.toElement,xe=ge,Fe=Fe?Ss(Fe):null,Fe!==null&&(Pt=o(Fe),We=Fe.tag,Fe!==Pt||We!==5&&We!==27&&We!==6)&&(Fe=null)):(xe=null,Fe=ge),xe!==Fe)){if(We=Oc,Te="onMouseLeave",ue="onMouseEnter",le="mouse",(s==="pointerout"||s==="pointerover")&&(We=Js,Te="onPointerLeave",ue="onPointerEnter",le="pointer"),Pt=xe==null?_e:vr(xe),pe=Fe==null?_e:vr(Fe),_e=new We(Te,le+"leave",xe,c,Ee),_e.target=Pt,_e.relatedTarget=pe,Te=null,Ss(Ee)===ge&&(We=new We(ue,le+"enter",Fe,c,Ee),We.target=pe,We.relatedTarget=Pt,Te=We),Pt=Te,xe&&Fe)t:{for(We=a2,ue=xe,le=Fe,pe=0,Te=ue;Te;Te=We(Te))pe++;Te=0;for(var Ge=le;Ge;Ge=We(Ge))Te++;for(;0<pe-Te;)ue=We(ue),pe--;for(;0<Te-pe;)le=We(le),Te--;for(;pe--;){if(ue===le||le!==null&&ue===le.alternate){We=ue;break t}ue=We(ue),le=We(le)}We=null}else We=null;xe!==null&&Gv(Ie,_e,xe,We,!1),Fe!==null&&Pt!==null&&Gv(Ie,Pt,Fe,We,!0)}}e:{if(_e=ge?vr(ge):window,xe=_e.nodeName&&_e.nodeName.toLowerCase(),xe==="select"||xe==="input"&&_e.type==="file")var St=c_;else if(o_(_e))if(u_)St=yA;else{St=pA;var $e=mA}else xe=_e.nodeName,!xe||xe.toLowerCase()!=="input"||_e.type!=="checkbox"&&_e.type!=="radio"?ge&&Wo(ge.elementType)&&(St=c_):St=gA;if(St&&(St=St(s,ge))){l_(Ie,St,c,Ee);break e}$e&&$e(s,_e,ge),s==="focusout"&&ge&&_e.type==="number"&&ge.memoizedProps.value!=null&&Ac(_e,"number",_e.value)}switch($e=ge?vr(ge):window,s){case"focusin":(o_($e)||$e.contentEditable==="true")&&(nl=$e,Nm=ge,Lc=null);break;case"focusout":Lc=Nm=nl=null;break;case"mousedown":Pm=!0;break;case"contextmenu":case"mouseup":case"dragend":Pm=!1,__(Ie,c,Ee);break;case"selectionchange":if(bA)break;case"keydown":case"keyup":__(Ie,c,Ee)}var lt;if(At)e:{switch(s){case"compositionstart":var mt="onCompositionStart";break e;case"compositionend":mt="onCompositionEnd";break e;case"compositionupdate":mt="onCompositionUpdate";break e}mt=void 0}else tl?eo(s,c)&&(mt="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(mt="onCompositionStart");mt&&(Ms&&c.locale!=="ko"&&(tl||mt!=="onCompositionStart"?mt==="onCompositionEnd"&&tl&&(lt=Dc()):(Rs=Ee,kc="value"in Rs?Rs.value:Rs.textContent,tl=!0)),$e=wh(ge,mt),0<$e.length&&(mt=new Ds(mt,s,null,c,Ee),Ie.push({event:mt,listeners:$e}),lt?mt.data=lt:(lt=el(c),lt!==null&&(mt.data=lt)))),(lt=Pr?uA(s,c):dA(s,c))&&(mt=wh(ge,"onBeforeInput"),0<mt.length&&($e=new Ds("onBeforeInput","beforeinput",null,c,Ee),Ie.push({event:$e,listeners:mt}),$e.data=lt)),n2(Ie,s,ge,c,Ee)}qv(Ie,a)})}function uu(s,a,c){return{instance:s,listener:a,currentTarget:c}}function wh(s,a){for(var c=a+"Capture",f=[];s!==null;){var b=s,w=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||w===null||(b=es(s,c),b!=null&&f.unshift(uu(s,b,w)),b=es(s,a),b!=null&&f.push(uu(s,b,w))),s.tag===3)return f;s=s.return}return[]}function a2(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Gv(s,a,c,f,b){for(var w=a._reactName,z=[];c!==null&&c!==f;){var Q=c,re=Q.alternate,ge=Q.stateNode;if(Q=Q.tag,re!==null&&re===f)break;Q!==5&&Q!==26&&Q!==27||ge===null||(re=ge,b?(ge=es(c,w),ge!=null&&z.unshift(uu(c,ge,re))):b||(ge=es(c,w),ge!=null&&z.push(uu(c,ge,re)))),c=c.return}z.length!==0&&s.push({event:a,listeners:z})}var o2=/\r\n?/g,l2=/\u0000|\uFFFD/g;function Qv(s){return(typeof s=="string"?s:""+s).replace(o2,`
`).replace(l2,"")}function Wv(s,a){return a=Qv(a),Qv(s)===a}function Nt(s,a,c,f,b,w){switch(c){case"children":typeof f=="string"?a==="body"||a==="textarea"&&f===""||cr(s,f):(typeof f=="number"||typeof f=="bigint")&&a!=="body"&&cr(s,""+f);break;case"className":xr(s,"class",f);break;case"tabIndex":xr(s,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":xr(s,c,f);break;case"style":Rc(s,f,w);break;case"data":if(a!=="object"){xr(s,"data",f);break}case"src":case"href":if(f===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=Ko(""+f),s.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(c==="formAction"?(a!=="input"&&Nt(s,a,"name",b.name,b,null),Nt(s,a,"formEncType",b.formEncType,b,null),Nt(s,a,"formMethod",b.formMethod,b,null),Nt(s,a,"formTarget",b.formTarget,b,null)):(Nt(s,a,"encType",b.encType,b,null),Nt(s,a,"method",b.method,b,null),Nt(s,a,"target",b.target,b,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=Ko(""+f),s.setAttribute(c,f);break;case"onClick":f!=null&&(s.onclick=Jr);break;case"onScroll":f!=null&&dt("scroll",s);break;case"onScrollEnd":f!=null&&dt("scrollend",s);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"multiple":s.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":s.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){s.removeAttribute("xlink:href");break}c=Ko(""+f),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""+f):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":f===!0?s.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,f):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?s.setAttribute(c,f):s.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?s.removeAttribute(c):s.setAttribute(c,f);break;case"popover":dt("beforetoggle",s),dt("toggle",s),Go(s,"popover",f);break;case"xlinkActuate":pn(s,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":pn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":pn(s,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":pn(s,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":pn(s,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":pn(s,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":pn(s,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":pn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":pn(s,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Go(s,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=wd.get(c)||c,Go(s,c,f))}}function og(s,a,c,f,b,w){switch(c){case"style":Rc(s,f,w);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"children":typeof f=="string"?cr(s,f):(typeof f=="number"||typeof f=="bigint")&&cr(s,""+f);break;case"onScroll":f!=null&&dt("scroll",s);break;case"onScrollEnd":f!=null&&dt("scrollend",s);break;case"onClick":f!=null&&(s.onclick=Jr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!wc.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),a=c.slice(2,b?c.length-7:void 0),w=s[kn]||null,w=w!=null?w[c]:null,typeof w=="function"&&s.removeEventListener(a,w,b),typeof f=="function")){typeof w!="function"&&w!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,f,b);break e}c in s?s[c]=f:f===!0?s.setAttribute(c,""):Go(s,c,f)}}}function Fn(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":dt("error",s),dt("load",s);var f=!1,b=!1,w;for(w in c)if(c.hasOwnProperty(w)){var z=c[w];if(z!=null)switch(w){case"src":f=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Nt(s,a,w,z,c,null)}}b&&Nt(s,a,"srcSet",c.srcSet,c,null),f&&Nt(s,a,"src",c.src,c,null);return;case"input":dt("invalid",s);var Q=w=z=b=null,re=null,ge=null;for(f in c)if(c.hasOwnProperty(f)){var Ee=c[f];if(Ee!=null)switch(f){case"name":b=Ee;break;case"type":z=Ee;break;case"checked":re=Ee;break;case"defaultChecked":ge=Ee;break;case"value":w=Ee;break;case"defaultValue":Q=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(r(137,a));break;default:Nt(s,a,f,Ee,c,null)}}bd(s,w,Q,re,ge,z,b,!1);return;case"select":dt("invalid",s),f=z=w=null;for(b in c)if(c.hasOwnProperty(b)&&(Q=c[b],Q!=null))switch(b){case"value":w=Q;break;case"defaultValue":z=Q;break;case"multiple":f=Q;default:Nt(s,a,b,Q,c,null)}a=w,c=z,s.multiple=!!f,a!=null?Di(s,!!f,a,!1):c!=null&&Di(s,!!f,c,!0);return;case"textarea":dt("invalid",s),w=b=f=null;for(z in c)if(c.hasOwnProperty(z)&&(Q=c[z],Q!=null))switch(z){case"value":f=Q;break;case"defaultValue":b=Q;break;case"children":w=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(r(91));break;default:Nt(s,a,z,Q,c,null)}Mi(s,f,b,w);return;case"option":for(re in c)c.hasOwnProperty(re)&&(f=c[re],f!=null)&&(re==="selected"?s.selected=f&&typeof f!="function"&&typeof f!="symbol":Nt(s,a,re,f,c,null));return;case"dialog":dt("beforetoggle",s),dt("toggle",s),dt("cancel",s),dt("close",s);break;case"iframe":case"object":dt("load",s);break;case"video":case"audio":for(f=0;f<cu.length;f++)dt(cu[f],s);break;case"image":dt("error",s),dt("load",s);break;case"details":dt("toggle",s);break;case"embed":case"source":case"link":dt("error",s),dt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ge in c)if(c.hasOwnProperty(ge)&&(f=c[ge],f!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Nt(s,a,ge,f,c,null)}return;default:if(Wo(a)){for(Ee in c)c.hasOwnProperty(Ee)&&(f=c[Ee],f!==void 0&&og(s,a,Ee,f,c,void 0));return}}for(Q in c)c.hasOwnProperty(Q)&&(f=c[Q],f!=null&&Nt(s,a,Q,f,c,null))}function c2(s,a,c,f){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,w=null,z=null,Q=null,re=null,ge=null,Ee=null;for(xe in c){var Ie=c[xe];if(c.hasOwnProperty(xe)&&Ie!=null)switch(xe){case"checked":break;case"value":break;case"defaultValue":re=Ie;default:f.hasOwnProperty(xe)||Nt(s,a,xe,null,f,Ie)}}for(var _e in f){var xe=f[_e];if(Ie=c[_e],f.hasOwnProperty(_e)&&(xe!=null||Ie!=null))switch(_e){case"type":w=xe;break;case"name":b=xe;break;case"checked":ge=xe;break;case"defaultChecked":Ee=xe;break;case"value":z=xe;break;case"defaultValue":Q=xe;break;case"children":case"dangerouslySetInnerHTML":if(xe!=null)throw Error(r(137,a));break;default:xe!==Ie&&Nt(s,a,_e,xe,f,Ie)}}Qo(s,z,Q,re,ge,Ee,w,b);return;case"select":xe=z=Q=_e=null;for(w in c)if(re=c[w],c.hasOwnProperty(w)&&re!=null)switch(w){case"value":break;case"multiple":xe=re;default:f.hasOwnProperty(w)||Nt(s,a,w,null,f,re)}for(b in f)if(w=f[b],re=c[b],f.hasOwnProperty(b)&&(w!=null||re!=null))switch(b){case"value":_e=w;break;case"defaultValue":Q=w;break;case"multiple":z=w;default:w!==re&&Nt(s,a,b,w,f,re)}a=Q,c=z,f=xe,_e!=null?Di(s,!!c,_e,!1):!!f!=!!c&&(a!=null?Di(s,!!c,a,!0):Di(s,!!c,c?[]:"",!1));return;case"textarea":xe=_e=null;for(Q in c)if(b=c[Q],c.hasOwnProperty(Q)&&b!=null&&!f.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:Nt(s,a,Q,null,f,b)}for(z in f)if(b=f[z],w=c[z],f.hasOwnProperty(z)&&(b!=null||w!=null))switch(z){case"value":_e=b;break;case"defaultValue":xe=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(r(91));break;default:b!==w&&Nt(s,a,z,b,f,w)}vd(s,_e,xe);return;case"option":for(var Fe in c)_e=c[Fe],c.hasOwnProperty(Fe)&&_e!=null&&!f.hasOwnProperty(Fe)&&(Fe==="selected"?s.selected=!1:Nt(s,a,Fe,null,f,_e));for(re in f)_e=f[re],xe=c[re],f.hasOwnProperty(re)&&_e!==xe&&(_e!=null||xe!=null)&&(re==="selected"?s.selected=_e&&typeof _e!="function"&&typeof _e!="symbol":Nt(s,a,re,_e,f,xe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var We in c)_e=c[We],c.hasOwnProperty(We)&&_e!=null&&!f.hasOwnProperty(We)&&Nt(s,a,We,null,f,_e);for(ge in f)if(_e=f[ge],xe=c[ge],f.hasOwnProperty(ge)&&_e!==xe&&(_e!=null||xe!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":if(_e!=null)throw Error(r(137,a));break;default:Nt(s,a,ge,_e,f,xe)}return;default:if(Wo(a)){for(var Pt in c)_e=c[Pt],c.hasOwnProperty(Pt)&&_e!==void 0&&!f.hasOwnProperty(Pt)&&og(s,a,Pt,void 0,f,_e);for(Ee in f)_e=f[Ee],xe=c[Ee],!f.hasOwnProperty(Ee)||_e===xe||_e===void 0&&xe===void 0||og(s,a,Ee,_e,f,xe);return}}for(var ue in c)_e=c[ue],c.hasOwnProperty(ue)&&_e!=null&&!f.hasOwnProperty(ue)&&Nt(s,a,ue,null,f,_e);for(Ie in f)_e=f[Ie],xe=c[Ie],!f.hasOwnProperty(Ie)||_e===xe||_e==null&&xe==null||Nt(s,a,Ie,_e,f,xe)}function Kv(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function u2(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var b=c[f],w=b.transferSize,z=b.initiatorType,Q=b.duration;if(w&&Q&&Kv(z)){for(z=0,Q=b.responseEnd,f+=1;f<c.length;f++){var re=c[f],ge=re.startTime;if(ge>Q)break;var Ee=re.transferSize,Ie=re.initiatorType;Ee&&Kv(Ie)&&(re=re.responseEnd,z+=Ee*(re<Q?1:(Q-ge)/(re-ge)))}if(--f,a+=8*(w+z)/(b.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var lg=null,cg=null;function Sh(s){return s.nodeType===9?s:s.ownerDocument}function Yv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Xv(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function ug(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var dg=null;function d2(){var s=window.event;return s&&s.type==="popstate"?s===dg?!1:(dg=s,!0):(dg=null,!1)}var Zv=typeof setTimeout=="function"?setTimeout:void 0,h2=typeof clearTimeout=="function"?clearTimeout:void 0,Jv=typeof Promise=="function"?Promise:void 0,f2=typeof queueMicrotask=="function"?queueMicrotask:typeof Jv<"u"?function(s){return Jv.resolve(null).then(s).catch(m2)}:Zv;function m2(s){setTimeout(function(){throw s})}function na(s){return s==="head"}function ex(s,a){var c=a,f=0;do{var b=c.nextSibling;if(s.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(f===0){s.removeChild(b),Rl(a);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")du(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,du(c);for(var w=c.firstChild;w;){var z=w.nextSibling,Q=w.nodeName;w[ws]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&w.rel.toLowerCase()==="stylesheet"||c.removeChild(w),w=z}}else c==="body"&&du(s.ownerDocument.body);c=b}while(c);Rl(a)}function tx(s,a){var c=s;s=0;do{var f=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=f}while(c)}function hg(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":hg(c),Ho(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function p2(s,a,c,f){for(;s.nodeType===1;){var b=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!f&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(f){if(!s[ws])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(w=s.getAttribute("rel"),w==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(w!==b.rel||s.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||s.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||s.getAttribute("title")!==(b.title==null?null:b.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(w=s.getAttribute("src"),(w!==(b.src==null?null:b.src)||s.getAttribute("type")!==(b.type==null?null:b.type)||s.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&w&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var w=b.name==null?null:""+b.name;if(b.type==="hidden"&&s.getAttribute("name")===w)return s}else return s;if(s=$r(s.nextSibling),s===null)break}return null}function g2(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=$r(s.nextSibling),s===null))return null;return s}function nx(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=$r(s.nextSibling),s===null))return null;return s}function fg(s){return s.data==="$?"||s.data==="$~"}function mg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function y2(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var f=function(){a(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),s._reactRetry=f}}function $r(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var pg=null;function rx(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return $r(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function sx(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function ix(s,a,c){switch(a=Sh(c),s){case"html":if(s=a.documentElement,!s)throw Error(r(452));return s;case"head":if(s=a.head,!s)throw Error(r(453));return s;case"body":if(s=a.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function du(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);Ho(s)}var qr=new Map,ax=new Set;function Ch(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var mi=G.d;G.d={f:_2,r:b2,D:v2,C:x2,L:w2,m:S2,X:E2,S:C2,M:T2};function _2(){var s=mi.f(),a=ph();return s||a}function b2(s){var a=Mr(s);a!==null&&a.tag===5&&a.type==="form"?Sb(a):mi.r(s)}var Tl=typeof document>"u"?null:document;function ox(s,a,c){var f=Tl;if(f&&typeof a=="string"&&a){var b=lr(a);b='link[rel="'+s+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),ax.has(b)||(ax.add(b),s={rel:s,crossOrigin:c,href:a},f.querySelector(b)===null&&(a=f.createElement("link"),Fn(a,"link",s),mn(a),f.head.appendChild(a)))}}function v2(s){mi.D(s),ox("dns-prefetch",s,null)}function x2(s,a){mi.C(s,a),ox("preconnect",s,a)}function w2(s,a,c){mi.L(s,a,c);var f=Tl;if(f&&s&&a){var b='link[rel="preload"][as="'+lr(a)+'"]';a==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+lr(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+lr(c.imageSizes)+'"]')):b+='[href="'+lr(s)+'"]';var w=b;switch(a){case"style":w=Al(s);break;case"script":w=jl(s)}qr.has(w)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),qr.set(w,s),f.querySelector(b)!==null||a==="style"&&f.querySelector(hu(w))||a==="script"&&f.querySelector(fu(w))||(a=f.createElement("link"),Fn(a,"link",s),mn(a),f.head.appendChild(a)))}}function S2(s,a){mi.m(s,a);var c=Tl;if(c&&s){var f=a&&typeof a.as=="string"?a.as:"script",b='link[rel="modulepreload"][as="'+lr(f)+'"][href="'+lr(s)+'"]',w=b;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=jl(s)}if(!qr.has(w)&&(s=g({rel:"modulepreload",href:s},a),qr.set(w,s),c.querySelector(b)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(fu(w)))return}f=c.createElement("link"),Fn(f,"link",s),mn(f),c.head.appendChild(f)}}}function C2(s,a,c){mi.S(s,a,c);var f=Tl;if(f&&s){var b=Cs(f).hoistableStyles,w=Al(s);a=a||"default";var z=b.get(w);if(!z){var Q={loading:0,preload:null};if(z=f.querySelector(hu(w)))Q.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=qr.get(w))&&gg(s,c);var re=z=f.createElement("link");mn(re),Fn(re,"link",s),re._p=new Promise(function(ge,Ee){re.onload=ge,re.onerror=Ee}),re.addEventListener("load",function(){Q.loading|=1}),re.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,Eh(z,a,f)}z={type:"stylesheet",instance:z,count:1,state:Q},b.set(w,z)}}}function E2(s,a){mi.X(s,a);var c=Tl;if(c&&s){var f=Cs(c).hoistableScripts,b=jl(s),w=f.get(b);w||(w=c.querySelector(fu(b)),w||(s=g({src:s,async:!0},a),(a=qr.get(b))&&yg(s,a),w=c.createElement("script"),mn(w),Fn(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(b,w))}}function T2(s,a){mi.M(s,a);var c=Tl;if(c&&s){var f=Cs(c).hoistableScripts,b=jl(s),w=f.get(b);w||(w=c.querySelector(fu(b)),w||(s=g({src:s,async:!0,type:"module"},a),(a=qr.get(b))&&yg(s,a),w=c.createElement("script"),mn(w),Fn(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(b,w))}}function lx(s,a,c,f){var b=(b=fe.current)?Ch(b):null;if(!b)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=Al(c.href),c=Cs(b).hoistableStyles,f=c.get(a),f||(f={type:"style",instance:null,count:0,state:null},c.set(a,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=Al(c.href);var w=Cs(b).hoistableStyles,z=w.get(s);if(z||(b=b.ownerDocument||b,z={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(s,z),(w=b.querySelector(hu(s)))&&!w._p&&(z.instance=w,z.state.loading=5),qr.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},qr.set(s,c),w||A2(b,s,c,z.state))),a&&f===null)throw Error(r(528,""));return z}if(a&&f!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=jl(c),c=Cs(b).hoistableScripts,f=c.get(a),f||(f={type:"script",instance:null,count:0,state:null},c.set(a,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function Al(s){return'href="'+lr(s)+'"'}function hu(s){return'link[rel="stylesheet"]['+s+"]"}function cx(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function A2(s,a,c,f){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?f.loading=1:(a=s.createElement("link"),f.preload=a,a.addEventListener("load",function(){return f.loading|=1}),a.addEventListener("error",function(){return f.loading|=2}),Fn(a,"link",c),mn(a),s.head.appendChild(a))}function jl(s){return'[src="'+lr(s)+'"]'}function fu(s){return"script[async]"+s}function ux(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var f=s.querySelector('style[data-href~="'+lr(c.href)+'"]');if(f)return a.instance=f,mn(f),f;var b=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(s.ownerDocument||s).createElement("style"),mn(f),Fn(f,"style",b),Eh(f,c.precedence,s),a.instance=f;case"stylesheet":b=Al(c.href);var w=s.querySelector(hu(b));if(w)return a.state.loading|=4,a.instance=w,mn(w),w;f=cx(c),(b=qr.get(b))&&gg(f,b),w=(s.ownerDocument||s).createElement("link"),mn(w);var z=w;return z._p=new Promise(function(Q,re){z.onload=Q,z.onerror=re}),Fn(w,"link",f),a.state.loading|=4,Eh(w,c.precedence,s),a.instance=w;case"script":return w=jl(c.src),(b=s.querySelector(fu(w)))?(a.instance=b,mn(b),b):(f=c,(b=qr.get(w))&&(f=g({},c),yg(f,b)),s=s.ownerDocument||s,b=s.createElement("script"),mn(b),Fn(b,"link",f),s.head.appendChild(b),a.instance=b);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(f=a.instance,a.state.loading|=4,Eh(f,c.precedence,s));return a.instance}function Eh(s,a,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=f.length?f[f.length-1]:null,w=b,z=0;z<f.length;z++){var Q=f[z];if(Q.dataset.precedence===a)w=Q;else if(w!==b)break}w?w.parentNode.insertBefore(s,w.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function gg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function yg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var Th=null;function dx(s,a,c){if(Th===null){var f=new Map,b=Th=new Map;b.set(c,f)}else b=Th,f=b.get(c),f||(f=new Map,b.set(c,f));if(f.has(s))return f;for(f.set(s,null),c=c.getElementsByTagName(s),b=0;b<c.length;b++){var w=c[b];if(!(w[ws]||w[fn]||s==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var z=w.getAttribute(a)||"";z=s+z;var Q=f.get(z);Q?Q.push(w):f.set(z,[w])}}return f}function hx(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function j2(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function fx(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function R2(s,a,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=Al(f.href),w=a.querySelector(hu(b));if(w){a=w._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=Ah.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=w,mn(w);return}w=a.ownerDocument||a,f=cx(f),(b=qr.get(b))&&gg(f,b),w=w.createElement("link"),mn(w);var z=w;z._p=new Promise(function(Q,re){z.onload=Q,z.onerror=re}),Fn(w,"link",f),c.instance=w}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Ah.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var _g=0;function I2(s,a){return s.stylesheets&&s.count===0&&Rh(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var f=setTimeout(function(){if(s.stylesheets&&Rh(s,s.stylesheets),s.unsuspend){var w=s.unsuspend;s.unsuspend=null,w()}},6e4+a);0<s.imgBytes&&_g===0&&(_g=62500*u2());var b=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Rh(s,s.stylesheets),s.unsuspend)){var w=s.unsuspend;s.unsuspend=null,w()}},(s.imgBytes>_g?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(f),clearTimeout(b)}}:null}function Ah(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Rh(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var jh=null;function Rh(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,jh=new Map,a.forEach(k2,s),jh=null,Ah.call(s))}function k2(s,a){if(!(a.state.loading&4)){var c=jh.get(s);if(c)var f=c.get(null);else{c=new Map,jh.set(s,c);for(var b=s.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<b.length;w++){var z=b[w];(z.nodeName==="LINK"||z.getAttribute("media")!=="not all")&&(c.set(z.dataset.precedence,z),f=z)}f&&c.set(null,f)}b=a.instance,z=b.getAttribute("data-precedence"),w=c.get(z)||f,w===f&&c.set(null,b),c.set(z,b),this.count++,f=Ah.bind(this),b.addEventListener("load",f),b.addEventListener("error",f),w?w.parentNode.insertBefore(b,w.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(b,s.firstChild)),a.state.loading|=4}}var mu={$$typeof:I,Provider:null,Consumer:null,_currentValue:J,_currentValue2:J,_threadCount:0};function D2(s,a,c,f,b,w,z,Q,re){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=vs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vs(0),this.hiddenUpdates=vs(null),this.identifierPrefix=f,this.onUncaughtError=b,this.onCaughtError=w,this.onRecoverableError=z,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=re,this.incompleteTransitions=new Map}function mx(s,a,c,f,b,w,z,Q,re,ge,Ee,Ie){return s=new D2(s,a,c,z,re,ge,Ee,Ie,Q),a=1,w===!0&&(a|=24),w=Sr(3,null,null,a),s.current=w,w.stateNode=s,a=Xm(),a.refCount++,s.pooledCache=a,a.refCount++,w.memoizedState={element:f,isDehydrated:c,cache:a},tp(w),s}function px(s){return s?(s=il,s):il}function gx(s,a,c,f,b,w){b=px(b),f.context===null?f.context=b:f.pendingContext=b,f=Hi(a),f.payload={element:c},w=w===void 0?null:w,w!==null&&(f.callback=w),c=Gi(s,f,a),c!==null&&(mr(c,s,a),Gc(c,s,a))}function yx(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function bg(s,a){yx(s,a),(s=s.alternate)&&yx(s,a)}function _x(s){if(s.tag===13||s.tag===31){var a=ro(s,67108864);a!==null&&mr(a,s,67108864),bg(s,67108864)}}function bx(s){if(s.tag===13||s.tag===31){var a=jr();a=Ha(a);var c=ro(s,a);c!==null&&mr(c,s,a),bg(s,a)}}var Ih=!0;function M2(s,a,c,f){var b=K.T;K.T=null;var w=G.p;try{G.p=2,vg(s,a,c,f)}finally{G.p=w,K.T=b}}function O2(s,a,c,f){var b=K.T;K.T=null;var w=G.p;try{G.p=8,vg(s,a,c,f)}finally{G.p=w,K.T=b}}function vg(s,a,c,f){if(Ih){var b=xg(f);if(b===null)ag(s,a,f,kh,c),xx(s,f);else if(P2(b,s,a,c,f))f.stopPropagation();else if(xx(s,f),a&4&&-1<N2.indexOf(s)){for(;b!==null;){var w=Mr(b);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var z=sr(w.pendingLanes);if(z!==0){var Q=w;for(Q.pendingLanes|=2,Q.entangledLanes|=2;z;){var re=1<<31-Tt(z);Q.entanglements[1]|=re,z&=~re}zs(w),(jt&6)===0&&(fh=Ne()+500,lu(0))}}break;case 31:case 13:Q=ro(w,2),Q!==null&&mr(Q,w,2),ph(),bg(w,2)}if(w=xg(f),w===null&&ag(s,a,f,kh,c),w===b)break;b=w}b!==null&&f.stopPropagation()}else ag(s,a,f,null,c)}}function xg(s){return s=Or(s),wg(s)}var kh=null;function wg(s){if(kh=null,s=Ss(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=l(a),s!==null)return s;s=null}else if(c===31){if(s=d(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return kh=s,null}function vx(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(De()){case He:return 2;case wt:return 8;case nt:case Yn:return 32;case gs:return 268435456;default:return 32}default:return 32}}var Sg=!1,ra=null,sa=null,ia=null,pu=new Map,gu=new Map,aa=[],N2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function xx(s,a){switch(s){case"focusin":case"focusout":ra=null;break;case"dragenter":case"dragleave":sa=null;break;case"mouseover":case"mouseout":ia=null;break;case"pointerover":case"pointerout":pu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":gu.delete(a.pointerId)}}function yu(s,a,c,f,b,w){return s===null||s.nativeEvent!==w?(s={blockedOn:a,domEventName:c,eventSystemFlags:f,nativeEvent:w,targetContainers:[b]},a!==null&&(a=Mr(a),a!==null&&_x(a)),s):(s.eventSystemFlags|=f,a=s.targetContainers,b!==null&&a.indexOf(b)===-1&&a.push(b),s)}function P2(s,a,c,f,b){switch(a){case"focusin":return ra=yu(ra,s,a,c,f,b),!0;case"dragenter":return sa=yu(sa,s,a,c,f,b),!0;case"mouseover":return ia=yu(ia,s,a,c,f,b),!0;case"pointerover":var w=b.pointerId;return pu.set(w,yu(pu.get(w)||null,s,a,c,f,b)),!0;case"gotpointercapture":return w=b.pointerId,gu.set(w,yu(gu.get(w)||null,s,a,c,f,b)),!0}return!1}function wx(s){var a=Ss(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){s.blockedOn=a,Xr(s.priority,function(){bx(c)});return}}else if(a===31){if(a=d(c),a!==null){s.blockedOn=a,Xr(s.priority,function(){bx(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Dh(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=xg(s.nativeEvent);if(c===null){c=s.nativeEvent;var f=new c.constructor(c.type,c);Ic=f,c.target.dispatchEvent(f),Ic=null}else return a=Mr(c),a!==null&&_x(a),s.blockedOn=c,!1;a.shift()}return!0}function Sx(s,a,c){Dh(s)&&c.delete(a)}function z2(){Sg=!1,ra!==null&&Dh(ra)&&(ra=null),sa!==null&&Dh(sa)&&(sa=null),ia!==null&&Dh(ia)&&(ia=null),pu.forEach(Sx),gu.forEach(Sx)}function Mh(s,a){s.blockedOn===a&&(s.blockedOn=null,Sg||(Sg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,z2)))}var Oh=null;function Cx(s){Oh!==s&&(Oh=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Oh===s&&(Oh=null);for(var a=0;a<s.length;a+=3){var c=s[a],f=s[a+1],b=s[a+2];if(typeof f!="function"){if(wg(f||c)===null)continue;break}var w=Mr(c);w!==null&&(s.splice(a,3),a-=3,xp(w,{pending:!0,data:b,method:c.method,action:f},f,b))}}))}function Rl(s){function a(re){return Mh(re,s)}ra!==null&&Mh(ra,s),sa!==null&&Mh(sa,s),ia!==null&&Mh(ia,s),pu.forEach(a),gu.forEach(a);for(var c=0;c<aa.length;c++){var f=aa[c];f.blockedOn===s&&(f.blockedOn=null)}for(;0<aa.length&&(c=aa[0],c.blockedOn===null);)wx(c),c.blockedOn===null&&aa.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var b=c[f],w=c[f+1],z=b[kn]||null;if(typeof w=="function")z||Cx(c);else if(z){var Q=null;if(w&&w.hasAttribute("formAction")){if(b=w,z=w[kn]||null)Q=z.formAction;else if(wg(b)!==null)continue}else Q=z.action;typeof Q=="function"?c[f+1]=Q:(c.splice(f,3),f-=3),Cx(c)}}}function Ex(){function s(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(z){return b=z})},focusReset:"manual",scroll:"manual"})}function a(){b!==null&&(b(),b=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,b=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),b!==null&&(b(),b=null)}}}function Cg(s){this._internalRoot=s}Nh.prototype.render=Cg.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,f=jr();gx(c,f,s,a,null,null)},Nh.prototype.unmount=Cg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;gx(s.current,2,null,s,null,null),ph(),a[xs]=null}};function Nh(s){this._internalRoot=s}Nh.prototype.unstable_scheduleHydration=function(s){if(s){var a=pd();s={blockedOn:null,target:s,priority:a};for(var c=0;c<aa.length&&a!==0&&a<aa[c].priority;c++);aa.splice(c,0,s),c===0&&wx(s)}};var Tx=e.version;if(Tx!=="19.2.3")throw Error(r(527,Tx,"19.2.3"));G.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=m(a),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var B2={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:K,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ph=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ph.isDisabled&&Ph.supportsFiber)try{xt=Ph.inject(B2),nn=Ph}catch{}}return bu.createRoot=function(s,a){if(!i(s))throw Error(r(299));var c=!1,f="",b=Mb,w=Ob,z=Nb;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onUncaughtError!==void 0&&(b=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(z=a.onRecoverableError)),a=mx(s,1,!1,null,null,c,f,null,b,w,z,Ex),s[xs]=a.current,ig(s),new Cg(a)},bu.hydrateRoot=function(s,a,c){if(!i(s))throw Error(r(299));var f=!1,b="",w=Mb,z=Ob,Q=Nb,re=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(w=c.onUncaughtError),c.onCaughtError!==void 0&&(z=c.onCaughtError),c.onRecoverableError!==void 0&&(Q=c.onRecoverableError),c.formState!==void 0&&(re=c.formState)),a=mx(s,1,!0,a,c??null,f,b,re,w,z,Q,Ex),a.context=px(null),c=a.current,f=jr(),f=Ha(f),b=Hi(f),b.callback=null,Gi(c,b,f),c=f,a.current.lanes=c,$a(a,c),zs(a),s[xs]=a.current,ig(s),new Nh(a)},bu.version="19.2.3",bu}var Px;function K2(){if(Px)return Ag.exports;Px=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ag.exports=W2(),Ag.exports}var Y2=K2();var zx="popstate";function X2(t={}){function e(r,i){let{pathname:o,search:l,hash:d}=r.location;return Jg("",{pathname:o,search:l,hash:d},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:Mu(i)}return J2(e,n,null,t)}function Zt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ir(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Z2(){return Math.random().toString(36).substring(2,10)}function Bx(t,e){return{usr:t.state,key:t.key,idx:e}}function Jg(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?ec(e):e,state:n,key:e&&e.key||r||Z2()}}function Mu({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function ec(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function J2(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,l=i.history,d="POP",h=null,m=p();m==null&&(m=0,l.replaceState({...l.state,idx:m},""));function p(){return(l.state||{idx:null}).idx}function g(){d="POP";let S=p(),E=S==null?null:S-m;m=S,h&&h({action:d,location:x.location,delta:E})}function v(S,E){d="PUSH";let T=Jg(x.location,S,E);m=p()+1;let I=Bx(T,m),D=x.createHref(T);try{l.pushState(I,"",D)}catch(B){if(B instanceof DOMException&&B.name==="DataCloneError")throw B;i.location.assign(D)}o&&h&&h({action:d,location:x.location,delta:1})}function _(S,E){d="REPLACE";let T=Jg(x.location,S,E);m=p();let I=Bx(T,m),D=x.createHref(T);l.replaceState(I,"",D),o&&h&&h({action:d,location:x.location,delta:0})}function C(S){return e5(S)}let x={get action(){return d},get location(){return t(i,l)},listen(S){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(zx,g),h=S,()=>{i.removeEventListener(zx,g),h=null}},createHref(S){return e(i,S)},createURL:C,encodeLocation(S){let E=C(S);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:v,replace:_,go(S){return l.go(S)}};return x}function e5(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Zt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Mu(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function mS(t,e,n="/"){return t5(t,e,n,!1)}function t5(t,e,n,r){let i=typeof e=="string"?ec(e):e,o=vi(i.pathname||"/",n);if(o==null)return null;let l=pS(t);n5(l);let d=null;for(let h=0;d==null&&h<l.length;++h){let m=f5(o);d=d5(l[h],m,r)}return d}function pS(t,e=[],n=[],r="",i=!1){let o=(l,d,h=i,m)=>{let p={relativePath:m===void 0?l.path||"":m,caseSensitive:l.caseSensitive===!0,childrenIndex:d,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;Zt(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=_i([r,p.relativePath]),v=n.concat(p);l.children&&l.children.length>0&&(Zt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),pS(l.children,e,v,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:c5(g,l.index),routesMeta:v})};return t.forEach((l,d)=>{if(l.path===""||!l.path?.includes("?"))o(l,d);else for(let h of gS(l.path))o(l,d,!0,h)}),e}function gS(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let l=gS(r.join("/")),d=[];return d.push(...l.map(h=>h===""?o:[o,h].join("/"))),i&&d.push(...l),d.map(h=>t.startsWith("/")&&h===""?"/":h)}function n5(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:u5(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var r5=/^:[\w-]+$/,s5=3,i5=2,a5=1,o5=10,l5=-2,Lx=t=>t==="*";function c5(t,e){let n=t.split("/"),r=n.length;return n.some(Lx)&&(r+=l5),e&&(r+=i5),n.filter(i=>!Lx(i)).reduce((i,o)=>i+(r5.test(o)?s5:o===""?a5:o5),r)}function u5(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function d5(t,e,n=!1){let{routesMeta:r}=t,i={},o="/",l=[];for(let d=0;d<r.length;++d){let h=r[d],m=d===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=lf({path:h.relativePath,caseSensitive:h.caseSensitive,end:m},p),v=h.route;if(!g&&m&&n&&!r[r.length-1].route.index&&(g=lf({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(i,g.params),l.push({params:i,pathname:_i([o,g.pathname]),pathnameBase:y5(_i([o,g.pathnameBase])),route:v}),g.pathnameBase!=="/"&&(o=_i([o,g.pathnameBase]))}return l}function lf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=h5(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],l=o.replace(/(.)\/+$/,"$1"),d=i.slice(1);return{params:r.reduce((m,{paramName:p,isOptional:g},v)=>{if(p==="*"){let C=d[v]||"";l=o.slice(0,o.length-C.length).replace(/(.)\/+$/,"$1")}const _=d[v];return g&&!_?m[p]=void 0:m[p]=(_||"").replace(/%2F/g,"/"),m},{}),pathname:o,pathnameBase:l,pattern:t}}function h5(t,e=!1,n=!0){Ir(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,d,h)=>(r.push({paramName:d,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function f5(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ir(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function vi(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var yS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,m5=t=>yS.test(t);function p5(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?ec(t):t,o;if(n)if(m5(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),Ir(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${n}`)}n.startsWith("/")?o=Ux(n.substring(1),"/"):o=Ux(n,e)}else o=e;return{pathname:o,search:_5(r),hash:b5(i)}}function Ux(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function kg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function g5(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function By(t){let e=g5(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Ly(t,e,n,r=!1){let i;typeof t=="string"?i=ec(t):(i={...t},Zt(!i.pathname||!i.pathname.includes("?"),kg("?","pathname","search",i)),Zt(!i.pathname||!i.pathname.includes("#"),kg("#","pathname","hash",i)),Zt(!i.search||!i.search.includes("#"),kg("#","search","hash",i)));let o=t===""||i.pathname==="",l=o?"/":i.pathname,d;if(l==null)d=n;else{let g=e.length-1;if(!r&&l.startsWith("..")){let v=l.split("/");for(;v[0]==="..";)v.shift(),g-=1;i.pathname=v.join("/")}d=g>=0?e[g]:"/"}let h=p5(i,d),m=l&&l!=="/"&&l.endsWith("/"),p=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(m||p)&&(h.pathname+="/"),h}var _i=t=>t.join("/").replace(/\/\/+/g,"/"),y5=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),_5=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,b5=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,v5=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function x5(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function w5(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var _S=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function bS(t,e){let n=t;if(typeof n!="string"||!yS.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(_S)try{let o=new URL(window.location.href),l=n.startsWith("//")?new URL(o.protocol+n):new URL(n),d=vi(l.pathname,e);l.origin===o.origin&&d!=null?n=d+l.search+l.hash:i=!0}catch{Ir(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var vS=["POST","PUT","PATCH","DELETE"];new Set(vS);var S5=["GET",...vS];new Set(S5);var tc=k.createContext(null);tc.displayName="DataRouter";var Uf=k.createContext(null);Uf.displayName="DataRouterState";var C5=k.createContext(!1),xS=k.createContext({isTransitioning:!1});xS.displayName="ViewTransition";var E5=k.createContext(new Map);E5.displayName="Fetchers";var T5=k.createContext(null);T5.displayName="Await";var kr=k.createContext(null);kr.displayName="Navigation";var Qu=k.createContext(null);Qu.displayName="Location";var Wr=k.createContext({outlet:null,matches:[],isDataRoute:!1});Wr.displayName="Route";var Uy=k.createContext(null);Uy.displayName="RouteError";var wS="REACT_ROUTER_ERROR",A5="REDIRECT",j5="ROUTE_ERROR_RESPONSE";function R5(t){if(t.startsWith(`${wS}:${A5}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function I5(t){if(t.startsWith(`${wS}:${j5}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new v5(e.status,e.statusText,e.data)}catch{}}function k5(t,{relative:e}={}){Zt(nc(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=k.useContext(kr),{hash:i,pathname:o,search:l}=Ku(t,{relative:e}),d=o;return n!=="/"&&(d=o==="/"?n:_i([n,o])),r.createHref({pathname:d,search:l,hash:i})}function nc(){return k.useContext(Qu)!=null}function Nn(){return Zt(nc(),"useLocation() may be used only in the context of a <Router> component."),k.useContext(Qu).location}var SS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function CS(t){k.useContext(kr).static||k.useLayoutEffect(t)}function Wu(){let{isDataRoute:t}=k.useContext(Wr);return t?Q5():D5()}function D5(){Zt(nc(),"useNavigate() may be used only in the context of a <Router> component.");let t=k.useContext(tc),{basename:e,navigator:n}=k.useContext(kr),{matches:r}=k.useContext(Wr),{pathname:i}=Nn(),o=JSON.stringify(By(r)),l=k.useRef(!1);return CS(()=>{l.current=!0}),k.useCallback((h,m={})=>{if(Ir(l.current,SS),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=Ly(h,JSON.parse(o),i,m.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:_i([e,p.pathname])),(m.replace?n.replace:n.push)(p,m.state,m)},[e,n,o,i,t])}var M5=k.createContext(null);function O5(t){let e=k.useContext(Wr).outlet;return k.useMemo(()=>e&&k.createElement(M5.Provider,{value:t},e),[e,t])}function N5(){let{matches:t}=k.useContext(Wr),e=t[t.length-1];return e?e.params:{}}function Ku(t,{relative:e}={}){let{matches:n}=k.useContext(Wr),{pathname:r}=Nn(),i=JSON.stringify(By(n));return k.useMemo(()=>Ly(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function P5(t,e){return ES(t,e)}function ES(t,e,n,r,i){Zt(nc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=k.useContext(kr),{matches:l}=k.useContext(Wr),d=l[l.length-1],h=d?d.params:{},m=d?d.pathname:"/",p=d?d.pathnameBase:"/",g=d&&d.route;{let T=g&&g.path||"";AS(m,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let v=Nn(),_;if(e){let T=typeof e=="string"?ec(e):e;Zt(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),_=T}else _=v;let C=_.pathname||"/",x=C;if(p!=="/"){let T=p.replace(/^\//,"").split("/");x="/"+C.replace(/^\//,"").split("/").slice(T.length).join("/")}let S=mS(t,{pathname:x});Ir(g||S!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),Ir(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let E=F5(S&&S.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:_i([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:_i([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),l,n,r,i);return e&&E?k.createElement(Qu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},E):E}function z5(){let t=G5(),e=x5(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=k.createElement(k.Fragment,null,k.createElement("p",null," Hey developer "),k.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",k.createElement("code",{style:o},"ErrorBoundary")," or"," ",k.createElement("code",{style:o},"errorElement")," prop on your route.")),k.createElement(k.Fragment,null,k.createElement("h2",null,"Unexpected Application Error!"),k.createElement("h3",{style:{fontStyle:"italic"}},e),n?k.createElement("pre",{style:i},n):null,l)}var B5=k.createElement(z5,null),TS=class extends k.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=I5(t.digest);n&&(t=n)}let e=t!==void 0?k.createElement(Wr.Provider,{value:this.props.routeContext},k.createElement(Uy.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?k.createElement(L5,{error:t},e):e}};TS.contextType=C5;var Dg=new WeakMap;function L5({children:t,error:e}){let{basename:n}=k.useContext(kr);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=R5(e.digest);if(r){let i=Dg.get(e);if(i)throw i;let o=bS(r.location,n);if(_S&&!Dg.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw Dg.set(e,l),l}return k.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function U5({routeContext:t,match:e,children:n}){let r=k.useContext(tc);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),k.createElement(Wr.Provider,{value:t},n)}function F5(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=n?.errors;if(l!=null){let p=o.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Zt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let d=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:v,errors:_}=n,C=g.route.loader&&!v.hasOwnProperty(g.route.id)&&(!_||_[g.route.id]===void 0);if(g.route.lazy||C){d=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let m=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:w5(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,v)=>{let _,C=!1,x=null,S=null;n&&(_=l&&g.route.id?l[g.route.id]:void 0,x=g.route.errorElement||B5,d&&(h<0&&v===0?(AS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),C=!0,S=null):h===v&&(C=!0,S=g.route.hydrateFallbackElement||null)));let E=e.concat(o.slice(0,v+1)),T=()=>{let I;return _?I=x:C?I=S:g.route.Component?I=k.createElement(g.route.Component,null):g.route.element?I=g.route.element:I=p,k.createElement(U5,{match:g,routeContext:{outlet:p,matches:E,isDataRoute:n!=null},children:I})};return n&&(g.route.ErrorBoundary||g.route.errorElement||v===0)?k.createElement(TS,{location:n.location,revalidation:n.revalidation,component:x,error:_,children:T(),routeContext:{outlet:null,matches:E,isDataRoute:!0},onError:m}):T()},null)}function Fy(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function V5(t){let e=k.useContext(tc);return Zt(e,Fy(t)),e}function $5(t){let e=k.useContext(Uf);return Zt(e,Fy(t)),e}function q5(t){let e=k.useContext(Wr);return Zt(e,Fy(t)),e}function Vy(t){let e=q5(t),n=e.matches[e.matches.length-1];return Zt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function H5(){return Vy("useRouteId")}function G5(){let t=k.useContext(Uy),e=$5("useRouteError"),n=Vy("useRouteError");return t!==void 0?t:e.errors?.[n]}function Q5(){let{router:t}=V5("useNavigate"),e=Vy("useNavigate"),n=k.useRef(!1);return CS(()=>{n.current=!0}),k.useCallback(async(i,o={})=>{Ir(n.current,SS),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...o}))},[t,e])}var Fx={};function AS(t,e,n){!e&&!Fx[t]&&(Fx[t]=!0,Ir(!1,n))}k.memo(W5);function W5({routes:t,future:e,state:n,onError:r}){return ES(t,void 0,n,r,e)}function Ff({to:t,replace:e,state:n,relative:r}){Zt(nc(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=k.useContext(kr);Ir(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=k.useContext(Wr),{pathname:l}=Nn(),d=Wu(),h=Ly(t,By(o),l,r==="path"),m=JSON.stringify(h);return k.useEffect(()=>{d(JSON.parse(m),{replace:e,state:n,relative:r})},[d,m,r,e,n]),null}function Vf(t){return O5(t.context)}function Tn(t){Zt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function K5({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:o=!1,unstable_useTransitions:l}){Zt(!nc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=t.replace(/^\/*/,"/"),h=k.useMemo(()=>({basename:d,navigator:i,static:o,unstable_useTransitions:l,future:{}}),[d,i,o,l]);typeof n=="string"&&(n=ec(n));let{pathname:m="/",search:p="",hash:g="",state:v=null,key:_="default"}=n,C=k.useMemo(()=>{let x=vi(m,d);return x==null?null:{location:{pathname:x,search:p,hash:g,state:v,key:_},navigationType:r}},[d,m,p,g,v,_,r]);return Ir(C!=null,`<Router basename="${d}"> is not able to match the URL "${m}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),C==null?null:k.createElement(kr.Provider,{value:h},k.createElement(Qu.Provider,{children:e,value:C}))}function Y5({children:t,location:e}){return P5(ey(t),e)}function ey(t,e=[]){let n=[];return k.Children.forEach(t,(r,i)=>{if(!k.isValidElement(r))return;let o=[...e,i];if(r.type===k.Fragment){n.push.apply(n,ey(r.props.children,o));return}Zt(r.type===Tn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Zt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=ey(r.props.children,o)),n.push(l)}),n}var Wh="get",Kh="application/x-www-form-urlencoded";function $f(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function X5(t){return $f(t)&&t.tagName.toLowerCase()==="button"}function Z5(t){return $f(t)&&t.tagName.toLowerCase()==="form"}function J5(t){return $f(t)&&t.tagName.toLowerCase()==="input"}function ej(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function tj(t,e){return t.button===0&&(!e||e==="_self")&&!ej(t)}function ty(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function nj(t,e){let n=ty(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(o=>{n.append(i,o)})}),n}var Bh=null;function rj(){if(Bh===null)try{new FormData(document.createElement("form"),0),Bh=!1}catch{Bh=!0}return Bh}var sj=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Mg(t){return t!=null&&!sj.has(t)?(Ir(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Kh}"`),null):t}function ij(t,e){let n,r,i,o,l;if(Z5(t)){let d=t.getAttribute("action");r=d?vi(d,e):null,n=t.getAttribute("method")||Wh,i=Mg(t.getAttribute("enctype"))||Kh,o=new FormData(t)}else if(X5(t)||J5(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||d.getAttribute("action");if(r=h?vi(h,e):null,n=t.getAttribute("formmethod")||d.getAttribute("method")||Wh,i=Mg(t.getAttribute("formenctype"))||Mg(d.getAttribute("enctype"))||Kh,o=new FormData(d,t),!rj()){let{name:m,type:p,value:g}=t;if(p==="image"){let v=m?`${m}.`:"";o.append(`${v}x`,"0"),o.append(`${v}y`,"0")}else m&&o.append(m,g)}}else{if($f(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Wh,r=null,i=Kh,l=t}return o&&i==="text/plain"&&(l=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function $y(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function aj(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&vi(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function oj(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function lj(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function cj(t,e,n){let r=await Promise.all(t.map(async i=>{let o=e.routes[i.route.id];if(o){let l=await oj(o,n);return l.links?l.links():[]}return[]}));return fj(r.flat(1).filter(lj).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Vx(t,e,n,r,i,o){let l=(h,m)=>n[m]?h.route.id!==n[m].route.id:!0,d=(h,m)=>n[m].pathname!==h.pathname||n[m].route.path?.endsWith("*")&&n[m].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,m)=>l(h,m)||d(h,m)):o==="data"?e.filter((h,m)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,m)||d(h,m))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function uj(t,e,{includeHydrateFallback:n}={}){return dj(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function dj(t){return[...new Set(t)]}function hj(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function fj(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let o=JSON.stringify(hj(i));return n.has(o)||(n.add(o),r.push({key:o,link:i})),r},[])}function jS(){let t=k.useContext(tc);return $y(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function mj(){let t=k.useContext(Uf);return $y(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var qy=k.createContext(void 0);qy.displayName="FrameworkContext";function RS(){let t=k.useContext(qy);return $y(t,"You must render this element inside a <HydratedRouter> element"),t}function pj(t,e){let n=k.useContext(qy),[r,i]=k.useState(!1),[o,l]=k.useState(!1),{onFocus:d,onBlur:h,onMouseEnter:m,onMouseLeave:p,onTouchStart:g}=e,v=k.useRef(null);k.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=E=>{E.forEach(T=>{l(T.isIntersecting)})},S=new IntersectionObserver(x,{threshold:.5});return v.current&&S.observe(v.current),()=>{S.disconnect()}}},[t]),k.useEffect(()=>{if(r){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[r]);let _=()=>{i(!0)},C=()=>{i(!1),l(!1)};return n?t!=="intent"?[o,v,{}]:[o,v,{onFocus:vu(d,_),onBlur:vu(h,C),onMouseEnter:vu(m,_),onMouseLeave:vu(p,C),onTouchStart:vu(g,_)}]:[!1,v,{}]}function vu(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function gj({page:t,...e}){let{router:n}=jS(),r=k.useMemo(()=>mS(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?k.createElement(_j,{page:t,matches:r,...e}):null}function yj(t){let{manifest:e,routeModules:n}=RS(),[r,i]=k.useState([]);return k.useEffect(()=>{let o=!1;return cj(t,e,n).then(l=>{o||i(l)}),()=>{o=!0}},[t,e,n]),r}function _j({page:t,matches:e,...n}){let r=Nn(),{manifest:i,routeModules:o}=RS(),{basename:l}=jS(),{loaderData:d,matches:h}=mj(),m=k.useMemo(()=>Vx(t,e,h,i,r,"data"),[t,e,h,i,r]),p=k.useMemo(()=>Vx(t,e,h,i,r,"assets"),[t,e,h,i,r]),g=k.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let C=new Set,x=!1;if(e.forEach(E=>{let T=i.routes[E.route.id];!T||!T.hasLoader||(!m.some(I=>I.route.id===E.route.id)&&E.route.id in d&&o[E.route.id]?.shouldRevalidate||T.hasClientLoader?x=!0:C.add(E.route.id))}),C.size===0)return[];let S=aj(t,l,"data");return x&&C.size>0&&S.searchParams.set("_routes",e.filter(E=>C.has(E.route.id)).map(E=>E.route.id).join(",")),[S.pathname+S.search]},[l,d,r,i,m,e,t,o]),v=k.useMemo(()=>uj(p,i),[p,i]),_=yj(p);return k.createElement(k.Fragment,null,g.map(C=>k.createElement("link",{key:C,rel:"prefetch",as:"fetch",href:C,...n})),v.map(C=>k.createElement("link",{key:C,rel:"modulepreload",href:C,...n})),_.map(({key:C,link:x})=>k.createElement("link",{key:C,nonce:n.nonce,...x})))}function bj(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var vj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{vj&&(window.__reactRouterVersion="7.11.0")}catch{}function xj({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=k.useRef();i.current==null&&(i.current=X2({window:r,v5Compat:!0}));let o=i.current,[l,d]=k.useState({action:o.action,location:o.location}),h=k.useCallback(m=>{n===!1?d(m):k.startTransition(()=>d(m))},[n]);return k.useLayoutEffect(()=>o.listen(h),[o,h]),k.createElement(K5,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:n})}var IS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,jn=k.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:o,replace:l,state:d,target:h,to:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,..._},C){let{basename:x,unstable_useTransitions:S}=k.useContext(kr),E=typeof m=="string"&&IS.test(m),T=bS(m,x);m=T.to;let I=k5(m,{relative:i}),[D,B,$]=pj(r,_),M=Ej(m,{replace:l,state:d,target:h,preventScrollReset:p,relative:i,viewTransition:g,unstable_defaultShouldRevalidate:v,unstable_useTransitions:S});function O(F){e&&e(F),F.defaultPrevented||M(F)}let N=k.createElement("a",{..._,...$,href:T.absoluteURL||I,onClick:T.isExternal||o?e:O,ref:bj(C,B),target:h,"data-discover":!E&&n==="render"?"true":void 0});return D&&!E?k.createElement(k.Fragment,null,N,k.createElement(gj,{page:I})):N});jn.displayName="Link";var wj=k.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:o,to:l,viewTransition:d,children:h,...m},p){let g=Ku(l,{relative:m.relative}),v=Nn(),_=k.useContext(Uf),{navigator:C,basename:x}=k.useContext(kr),S=_!=null&&Ij(g)&&d===!0,E=C.encodeLocation?C.encodeLocation(g).pathname:g.pathname,T=v.pathname,I=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;n||(T=T.toLowerCase(),I=I?I.toLowerCase():null,E=E.toLowerCase()),I&&x&&(I=vi(I,x)||I);const D=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let B=T===E||!i&&T.startsWith(E)&&T.charAt(D)==="/",$=I!=null&&(I===E||!i&&I.startsWith(E)&&I.charAt(E.length)==="/"),M={isActive:B,isPending:$,isTransitioning:S},O=B?e:void 0,N;typeof r=="function"?N=r(M):N=[r,B?"active":null,$?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let F=typeof o=="function"?o(M):o;return k.createElement(jn,{...m,"aria-current":O,className:N,ref:p,style:F,to:l,viewTransition:d},typeof h=="function"?h(M):h)});wj.displayName="NavLink";var Sj=k.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:o,method:l=Wh,action:d,onSubmit:h,relative:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,..._},C)=>{let{unstable_useTransitions:x}=k.useContext(kr),S=jj(),E=Rj(d,{relative:m}),T=l.toLowerCase()==="get"?"get":"post",I=typeof d=="string"&&IS.test(d),D=B=>{if(h&&h(B),B.defaultPrevented)return;B.preventDefault();let $=B.nativeEvent.submitter,M=$?.getAttribute("formmethod")||l,O=()=>S($||B.currentTarget,{fetcherKey:e,method:M,navigate:n,replace:i,state:o,relative:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v});x&&n!==!1?k.startTransition(()=>O()):O()};return k.createElement("form",{ref:C,method:T,action:E,onSubmit:r?h:D,..._,"data-discover":!I&&t==="render"?"true":void 0})});Sj.displayName="Form";function Cj(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function kS(t){let e=k.useContext(tc);return Zt(e,Cj(t)),e}function Ej(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d,unstable_useTransitions:h}={}){let m=Wu(),p=Nn(),g=Ku(t,{relative:o});return k.useCallback(v=>{if(tj(v,e)){v.preventDefault();let _=n!==void 0?n:Mu(p)===Mu(g),C=()=>m(t,{replace:_,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d});h?k.startTransition(()=>C()):C()}},[p,m,g,n,r,e,t,i,o,l,d,h])}function DS(t){Ir(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=k.useRef(ty(t)),n=k.useRef(!1),r=Nn(),i=k.useMemo(()=>nj(r.search,n.current?null:e.current),[r.search]),o=Wu(),l=k.useCallback((d,h)=>{const m=ty(typeof d=="function"?d(new URLSearchParams(i)):d);n.current=!0,o("?"+m,h)},[o,i]);return[i,l]}var Tj=0,Aj=()=>`__${String(++Tj)}__`;function jj(){let{router:t}=kS("useSubmit"),{basename:e}=k.useContext(kr),n=H5(),r=t.fetch,i=t.navigate;return k.useCallback(async(o,l={})=>{let{action:d,method:h,encType:m,formData:p,body:g}=ij(o,e);if(l.navigate===!1){let v=l.fetcherKey||Aj();await r(v,n,l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||m,flushSync:l.flushSync})}else await i(l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||m,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[r,i,e,n])}function Rj(t,{relative:e}={}){let{basename:n}=k.useContext(kr),r=k.useContext(Wr);Zt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...Ku(t||".",{relative:e})},l=Nn();if(t==null){o.search=l.search;let d=new URLSearchParams(o.search),h=d.getAll("index");if(h.some(p=>p==="")){d.delete("index"),h.filter(g=>g).forEach(g=>d.append("index",g));let p=d.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:_i([n,o.pathname])),Mu(o)}function Ij(t,{relative:e}={}){let n=k.useContext(xS);Zt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=kS("useViewTransitionState"),i=Ku(t,{relative:e});if(!n.isTransitioning)return!1;let o=vi(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=vi(n.nextLocation.pathname,r)||n.nextLocation.pathname;return lf(i.pathname,l)!=null||lf(i.pathname,o)!=null}var rc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},kj={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Dj=class{#e=kj;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},xo=new Dj;function Mj(t){setTimeout(t,0)}var Ao=typeof window>"u"||"Deno"in globalThis;function or(){}function Oj(t,e){return typeof t=="function"?t(e):t}function ny(t){return typeof t=="number"&&t>=0&&t!==1/0}function MS(t,e){return Math.max(t+(e||0)-Date.now(),0)}function _a(t,e){return typeof t=="function"?t(e):t}function Hr(t,e){return typeof t=="function"?t(e):t}function $x(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:o,queryKey:l,stale:d}=t;if(l){if(r){if(e.queryHash!==Hy(l,e.options))return!1}else if(!Ou(e.queryKey,l))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof d=="boolean"&&e.isStale()!==d||i&&i!==e.state.fetchStatus||o&&!o(e))}function qx(t,e){const{exact:n,status:r,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(jo(e.options.mutationKey)!==jo(o))return!1}else if(!Ou(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function Hy(t,e){return(e?.queryKeyHashFn||jo)(t)}function jo(t){return JSON.stringify(t,(e,n)=>ry(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function Ou(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Ou(t[n],e[n])):!1}var Nj=Object.prototype.hasOwnProperty;function OS(t,e){if(t===e)return t;const n=Hx(t)&&Hx(e);if(!n&&!(ry(t)&&ry(e)))return e;const i=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),l=o.length,d=n?new Array(l):{};let h=0;for(let m=0;m<l;m++){const p=n?m:o[m],g=t[p],v=e[p];if(g===v){d[p]=g,(n?m<i:Nj.call(t,p))&&h++;continue}if(g===null||v===null||typeof g!="object"||typeof v!="object"){d[p]=v;continue}const _=OS(g,v);d[p]=_,_===g&&h++}return i===l&&h===i?t:d}function cf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Hx(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function ry(t){if(!Gx(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Gx(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Gx(t){return Object.prototype.toString.call(t)==="[object Object]"}function Pj(t){return new Promise(e=>{xo.setTimeout(e,t)})}function sy(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?OS(t,e):e}function zj(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function Bj(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Gy=Symbol();function NS(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Gy?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function PS(t,e){return typeof t=="function"?t(...e):!!t}var Lj=class extends rc{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!Ao&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Qy=new Lj;function iy(){let t,e;const n=new Promise((i,o)=>{t=i,e=o});n.status="pending",n.catch(()=>{});function r(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},n.reject=i=>{r({status:"rejected",reason:i}),e(i)},n}var Uj=Mj;function Fj(){let t=[],e=0,n=d=>{d()},r=d=>{d()},i=Uj;const o=d=>{e?t.push(d):i(()=>{n(d)})},l=()=>{const d=t;t=[],d.length&&i(()=>{r(()=>{d.forEach(h=>{n(h)})})})};return{batch:d=>{let h;e++;try{h=d()}finally{e--,e||l()}return h},batchCalls:d=>(...h)=>{o(()=>{d(...h)})},schedule:o,setNotifyFunction:d=>{n=d},setBatchNotifyFunction:d=>{r=d},setScheduler:d=>{i=d}}}var An=Fj(),Vj=class extends rc{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!Ao&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},uf=new Vj;function $j(t){return Math.min(1e3*2**t,3e4)}function zS(t){return(t??"online")==="online"?uf.isOnline():!0}var ay=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function BS(t){let e=!1,n=0,r;const i=iy(),o=()=>i.status!=="pending",l=x=>{if(!o()){const S=new ay(x);v(S),t.onCancel?.(S)}},d=()=>{e=!0},h=()=>{e=!1},m=()=>Qy.isFocused()&&(t.networkMode==="always"||uf.isOnline())&&t.canRun(),p=()=>zS(t.networkMode)&&t.canRun(),g=x=>{o()||(r?.(),i.resolve(x))},v=x=>{o()||(r?.(),i.reject(x))},_=()=>new Promise(x=>{r=S=>{(o()||m())&&x(S)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),C=()=>{if(o())return;let x;const S=n===0?t.initialPromise:void 0;try{x=S??t.fn()}catch(E){x=Promise.reject(E)}Promise.resolve(x).then(g).catch(E=>{if(o())return;const T=t.retry??(Ao?0:3),I=t.retryDelay??$j,D=typeof I=="function"?I(n,E):I,B=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,E);if(e||!B){v(E);return}n++,t.onFail?.(n,E),Pj(D).then(()=>m()?void 0:_()).then(()=>{e?v(E):C()})})};return{promise:i,status:()=>i.status,cancel:l,continue:()=>(r?.(),i),cancelRetry:d,continueRetry:h,canStart:p,start:()=>(p()?C():_().then(C),i)}}var LS=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ny(this.gcTime)&&(this.#e=xo.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Ao?1/0:300*1e3))}clearGcTimeout(){this.#e&&(xo.clearTimeout(this.#e),this.#e=void 0)}},qj=class extends LS{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=Wx(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=Wx(this.options);n.data!==void 0&&(this.setState(Qx(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=sy(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(or).catch(or):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Hr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Gy||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>_a(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!MS(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(m=>m.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,i=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=NS(this.options,n),p=(()=>{const g={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},d=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return i(h),h})();this.options.behavior?.onFetch(d,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==d.fetchOptions?.meta)&&this.#i({type:"fetch",meta:d.fetchOptions?.meta}),this.#r=BS({initialPromise:n?.initialPromise,fn:d.fetchFn,onCancel:h=>{h instanceof ay&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,m)=>{this.#i({type:"failed",failureCount:h,error:m})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:d.options.retry,retryDelay:d.options.retryDelay,networkMode:d.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof ay){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#i({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...US(r.data,this.options),fetchMeta:e.meta??null};case"success":const i={...r,...Qx(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),An.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function US(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:zS(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Qx(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Wx(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Hj=class extends rc{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=iy(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Kx(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return oy(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return oy(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Hr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!cf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&Yx(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Hr(this.options.enabled,this.#t)!==Hr(e.enabled,this.#t)||_a(this.options.staleTime,this.#t)!==_a(e.staleTime,this.#t))&&this.#g();const i=this.#y();r&&(this.#t!==n||Hr(this.options.enabled,this.#t)!==Hr(e.enabled,this.#t)||i!==this.#l)&&this.#_(i)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return Qj(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(or)),e}#g(){this.#v();const t=_a(this.options.staleTime,this.#t);if(Ao||this.#s.isStale||!ny(t))return;const n=MS(this.#s.dataUpdatedAt,t)+1;this.#c=xo.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(Ao||Hr(this.options.enabled,this.#t)===!1||!ny(this.#l)||this.#l===0)&&(this.#u=xo.setInterval(()=>{(this.options.refetchIntervalInBackground||Qy.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(xo.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(xo.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,i=this.#s,o=this.#r,l=this.#a,h=t!==n?t.state:this.#n,{state:m}=t;let p={...m},g=!1,v;if(e._optimisticResults){const O=this.hasListeners(),N=!O&&Kx(t,e),F=O&&Yx(t,n,e,r);(N||F)&&(p={...p,...US(m.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:_,errorUpdatedAt:C,status:x}=p;v=p.data;let S=!1;if(e.placeholderData!==void 0&&v===void 0&&x==="pending"){let O;i?.isPlaceholderData&&e.placeholderData===l?.placeholderData?(O=i.data,S=!0):O=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,O!==void 0&&(x="success",v=sy(i?.data,O,e),g=!0)}if(e.select&&v!==void 0&&!S)if(i&&v===o?.data&&e.select===this.#p)v=this.#h;else try{this.#p=e.select,v=e.select(v),v=sy(i?.data,v,e),this.#h=v,this.#i=null}catch(O){this.#i=O}this.#i&&(_=this.#i,v=this.#h,C=Date.now(),x="error");const E=p.fetchStatus==="fetching",T=x==="pending",I=x==="error",D=T&&E,B=v!==void 0,M={status:x,fetchStatus:p.fetchStatus,isPending:T,isSuccess:x==="success",isError:I,isInitialLoading:D,isLoading:D,data:v,dataUpdatedAt:p.dataUpdatedAt,error:_,errorUpdatedAt:C,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:E,isRefetching:E&&!T,isLoadingError:I&&!B,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:I&&B,isStale:Wy(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Hr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const O=q=>{M.status==="error"?q.reject(M.error):M.data!==void 0&&q.resolve(M.data)},N=()=>{const q=this.#o=M.promise=iy();O(q)},F=this.#o;switch(F.status){case"pending":t.queryHash===n.queryHash&&O(F);break;case"fulfilled":(M.status==="error"||M.data!==F.value)&&N();break;case"rejected":(M.status!=="error"||M.error!==F.reason)&&N();break}}return M}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),cf(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#m.size)return!0;const o=new Set(i??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(l=>{const d=l;return this.#s[d]!==t[d]&&o.has(d)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){An.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function Gj(t,e){return Hr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Kx(t,e){return Gj(t,e)||t.state.data!==void 0&&oy(t,e,e.refetchOnMount)}function oy(t,e,n){if(Hr(e.enabled,t)!==!1&&_a(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&Wy(t,e)}return!1}function Yx(t,e,n,r){return(t!==e||Hr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&Wy(t,n)}function Wy(t,e){return Hr(e.enabled,t)!==!1&&t.isStaleByTime(_a(e.staleTime,t))}function Qj(t,e){return!cf(t.getCurrentResult(),e)}function Xx(t){return{onFetch:(e,n)=>{const r=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],l=e.state.data?.pageParams||[];let d={pages:[],pageParams:[]},h=0;const m=async()=>{let p=!1;const g=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},v=NS(e.options,e.fetchOptions),_=async(C,x,S)=>{if(p)return Promise.reject();if(x==null&&C.pages.length)return Promise.resolve(C);const T=(()=>{const $={client:e.client,queryKey:e.queryKey,pageParam:x,direction:S?"backward":"forward",meta:e.options.meta};return g($),$})(),I=await v(T),{maxPages:D}=e.options,B=S?Bj:zj;return{pages:B(C.pages,I,D),pageParams:B(C.pageParams,x,D)}};if(i&&o.length){const C=i==="backward",x=C?Wj:Zx,S={pages:o,pageParams:l},E=x(r,S);d=await _(S,E,C)}else{const C=t??o.length;do{const x=h===0?l[0]??r.initialPageParam:Zx(r,d);if(h>0&&x==null)break;d=await _(d,x),h++}while(h<C)}return d};e.options.persister?e.fetchFn=()=>e.options.persister?.(m,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=m}}}function Zx(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function Wj(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var Kj=class extends LS{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||FS(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=BS({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(l,d)=>{this.#r({type:"failed",failureCount:l,error:d})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",o=!this.#s.canStart();try{if(i)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const d=await this.options.onMutate?.(e,r);d!==this.state.context&&this.#r({type:"pending",context:d,variables:e,isPaused:o})}const l=await this.#s.start();return await this.#n.config.onSuccess?.(l,e,this.state.context,this,r),await this.options.onSuccess?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(l,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(l,null,e,this.state.context,r),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#n.config.onError?.(l,e,this.state.context,this,r),await this.options.onError?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,l,e,this.state.context,r),l}finally{this.#r({type:"error",error:l})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),An.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function FS(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Yj=class extends rc{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new Kj({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Lh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Lh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Lh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Lh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){An.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>qx(e,n))}findAll(t={}){return this.getAll().filter(e=>qx(t,e))}notify(t){An.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return An.batch(()=>Promise.all(t.map(e=>e.continue().catch(or))))}};function Lh(t){return t.options.scope?.id}var Xj=class extends rc{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),cf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&jo(n.mutationKey)!==jo(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??FS();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){An.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,i),this.#s.onSettled?.(e.data,null,n,r,i)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,i),this.#s.onSettled?.(void 0,e.error,n,r,i))}this.listeners.forEach(n=>{n(this.#t)})})}},Zj=class extends rc{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,i=e.queryHash??Hy(r,e);let o=this.get(i);return o||(o=new qj({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){An.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>$x(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>$x(t,n)):e}notify(t){An.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){An.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){An.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Jj=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new Zj,this.#t=t.mutationCache||new Yj,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=Qy.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=uf.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(_a(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,l=Oj(e,o);if(l!==void 0)return this.#e.build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return An.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;An.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return An.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=An.batch(()=>this.#e.findAll(t).map(i=>i.cancel(n)));return Promise.all(r).then(or).catch(or)}invalidateQueries(t,e={}){return An.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=An.batch(()=>this.#e.findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let o=i.fetch(void 0,n);return n.throwOnError||(o=o.catch(or)),i.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(or)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(_a(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(or).catch(or)}fetchInfiniteQuery(t){return t.behavior=Xx(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(or).catch(or)}ensureInfiniteQueryData(t){return t.behavior=Xx(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return uf.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(jo(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{Ou(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(jo(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{Ou(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Hy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Gy&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},VS=k.createContext(void 0),$t=t=>{const e=k.useContext(VS);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},eR=({client:t,children:e})=>(k.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),u.jsx(VS.Provider,{value:t,children:e})),$S=k.createContext(!1),tR=()=>k.useContext($S);$S.Provider;function nR(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var rR=k.createContext(nR()),sR=()=>k.useContext(rR),iR=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},aR=t=>{k.useEffect(()=>{t.clearReset()},[t])},oR=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||PS(n,[t.error,r])),lR=t=>{if(t.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...i)=>n(r(...i)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},cR=(t,e)=>t.isLoading&&t.isFetching&&!e,uR=(t,e)=>t?.suspense&&e.isPending,Jx=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function dR(t,e,n){const r=tR(),i=sR(),o=$t(),l=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=r?"isRestoring":"optimistic",lR(l),iR(l,i),aR(i);const d=!o.getQueryCache().get(l.queryHash),[h]=k.useState(()=>new e(o,l)),m=h.getOptimisticResult(l),p=!r&&t.subscribed!==!1;if(k.useSyncExternalStore(k.useCallback(g=>{const v=p?h.subscribe(An.batchCalls(g)):or;return h.updateResult(),v},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),k.useEffect(()=>{h.setOptions(l)},[l,h]),uR(l,m))throw Jx(l,h,i);if(oR({result:m,errorResetBoundary:i,throwOnError:l.throwOnError,query:o.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw m.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(l,m),l.experimental_prefetchInRender&&!Ao&&cR(m,r)&&(d?Jx(l,h,i):o.getQueryCache().get(l.queryHash)?.promise)?.catch(or).finally(()=>{h.updateResult()}),l.notifyOnChangeProps?m:h.trackResult(m)}function No(t,e){return dR(t,Hj)}function Kn(t,e){const n=$t(),[r]=k.useState(()=>new Xj(n,t));k.useEffect(()=>{r.setOptions(t)},[r,t]);const i=k.useSyncExternalStore(k.useCallback(l=>r.subscribe(An.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=k.useCallback((l,d)=>{r.mutate(l,d).catch(or)},[r]);if(i.error&&PS(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}const hR={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},qS=k.createContext(hR);function fR({children:t}){const[e,n]=k.useState(new Map),r=k.useCallback((h,m)=>{n(p=>new Map(p).set(h,m))},[]),i=k.useCallback(h=>{n(m=>{const p=new Map(m);return p.delete(h),p})},[]),o=e.size>0,l=e.size>0&&Array.from(e.values()).pop()||"Loading...",d={isLoading:o,loadingMessage:l,addLoadingHold:r,removeLoadingHold:i};return u.jsx(qS.Provider,{value:d,children:t})}function Pn(){const t=k.useContext(qS);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const mR=()=>{};var ew={};const HS=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},pR=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],l=t[n++],d=t[n++],h=((i&7)<<18|(o&63)<<12|(l&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|l&63)}}return e.join("")},GS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],l=i+1<t.length,d=l?t[i+1]:0,h=i+2<t.length,m=h?t[i+2]:0,p=o>>2,g=(o&3)<<4|d>>4;let v=(d&15)<<2|m>>6,_=m&63;h||(_=64,l||(v=64)),r.push(n[p],n[g],n[v],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(HS(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):pR(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],d=i<t.length?n[t.charAt(i)]:0;++i;const m=i<t.length?n[t.charAt(i)]:64;++i;const g=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||d==null||m==null||g==null)throw new gR;const v=o<<2|d>>4;if(r.push(v),m!==64){const _=d<<4&240|m>>2;if(r.push(_),g!==64){const C=m<<6&192|g;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class gR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const yR=function(t){const e=HS(t);return GS.encodeByteArray(e,!0)},df=function(t){return yR(t).replace(/\./g,"")},QS=function(t){try{return GS.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function _R(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const bR=()=>_R().__FIREBASE_DEFAULTS__,vR=()=>{if(typeof process>"u"||typeof ew>"u")return;const t=ew.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},xR=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&QS(t[1]);return e&&JSON.parse(e)},qf=()=>{try{return mR()||bR()||vR()||xR()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},WS=t=>qf()?.emulatorHosts?.[t],wR=t=>{const e=WS(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},KS=()=>qf()?.config,YS=t=>qf()?.[`_${t}`];class SR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function sc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function XS(t){return(await fetch(t,{credentials:"include"})).ok}function CR(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[df(JSON.stringify(n)),df(JSON.stringify(l)),""].join(".")}const Au={};function ER(){const t={prod:[],emulator:[]};for(const e of Object.keys(Au))Au[e]?t.emulator.push(e):t.prod.push(e);return t}function TR(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let tw=!1;function ZS(t,e){if(typeof window>"u"||typeof document>"u"||!sc(window.location.host)||Au[t]===e||Au[t]||tw)return;Au[t]=e;function n(v){return`__firebase__banner__${v}`}const r="__firebase__banner",o=ER().prod.length>0;function l(){const v=document.getElementById(r);v&&v.remove()}function d(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function h(v,_){v.setAttribute("width","24"),v.setAttribute("id",_),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function m(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{tw=!0,l()},v}function p(v,_){v.setAttribute("id",_),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function g(){const v=TR(r),_=n("text"),C=document.getElementById(_)||document.createElement("span"),x=n("learnmore"),S=document.getElementById(x)||document.createElement("a"),E=n("preprendIcon"),T=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const I=v.element;d(I),p(S,x);const D=m();h(T,E),I.append(T,C,S,D),document.body.appendChild(I)}o?(C.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function nr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function AR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(nr())}function jR(){const t=qf()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function RR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function IR(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function kR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function DR(){const t=nr();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function MR(){return!jR()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function OR(){try{return typeof indexedDB=="object"}catch{return!1}}function NR(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(n){e(n)}})}const PR="FirebaseError";class ji extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=PR,Object.setPrototypeOf(this,ji.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Yu.prototype.create)}}class Yu{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],l=o?zR(o,r):"Error",d=`${this.serviceName}: ${l} (${i}).`;return new ji(i,d,r)}}function zR(t,e){return t.replace(BR,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const BR=/\{\$([^}]+)}/g;function LR(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function xi(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],l=e[i];if(nw(o)&&nw(l)){if(!xi(o,l))return!1}else if(o!==l)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function nw(t){return t!==null&&typeof t=="object"}function Xu(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function xu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function wu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function UR(t,e){const n=new FR(t,e);return n.subscribe.bind(n)}class FR{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");VR(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=Og),i.error===void 0&&(i.error=Og),i.complete===void 0&&(i.complete=Og);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function VR(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Og(){}function Sn(t){return t&&t._delegate?t._delegate:t}class Ro{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const bo="[DEFAULT]";class $R{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new SR;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(HR(e))try{this.getOrInitializeService({instanceIdentifier:bo})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=bo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=bo){return this.instances.has(e)}getOptions(e=bo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);r===d&&l.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:qR(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=bo){return this.component?this.component.multipleInstances?e:bo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function qR(t){return t===bo?void 0:t}function HR(t){return t.instantiationMode==="EAGER"}class GR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new $R(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var pt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(pt||(pt={}));const QR={debug:pt.DEBUG,verbose:pt.VERBOSE,info:pt.INFO,warn:pt.WARN,error:pt.ERROR,silent:pt.SILENT},WR=pt.INFO,KR={[pt.DEBUG]:"log",[pt.VERBOSE]:"log",[pt.INFO]:"info",[pt.WARN]:"warn",[pt.ERROR]:"error"},YR=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=KR[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ky{constructor(e){this.name=e,this._logLevel=WR,this._logHandler=YR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in pt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?QR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,pt.DEBUG,...e),this._logHandler(this,pt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,pt.VERBOSE,...e),this._logHandler(this,pt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,pt.INFO,...e),this._logHandler(this,pt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,pt.WARN,...e),this._logHandler(this,pt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,pt.ERROR,...e),this._logHandler(this,pt.ERROR,...e)}}const XR=(t,e)=>e.some(n=>t instanceof n);let rw,sw;function ZR(){return rw||(rw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function JR(){return sw||(sw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const JS=new WeakMap,ly=new WeakMap,eC=new WeakMap,Ng=new WeakMap,Yy=new WeakMap;function eI(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(ba(t.result)),i()},l=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&JS.set(n,t)}).catch(()=>{}),Yy.set(e,t),e}function tI(t){if(ly.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),i()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});ly.set(t,e)}let cy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return ly.get(t);if(e==="objectStoreNames")return t.objectStoreNames||eC.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ba(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function nI(t){cy=t(cy)}function rI(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Pg(this),e,...n);return eC.set(r,e.sort?e.sort():[e]),ba(r)}:JR().includes(t)?function(...e){return t.apply(Pg(this),e),ba(JS.get(this))}:function(...e){return ba(t.apply(Pg(this),e))}}function sI(t){return typeof t=="function"?rI(t):(t instanceof IDBTransaction&&tI(t),XR(t,ZR())?new Proxy(t,cy):t)}function ba(t){if(t instanceof IDBRequest)return eI(t);if(Ng.has(t))return Ng.get(t);const e=sI(t);return e!==t&&(Ng.set(t,e),Yy.set(e,t)),e}const Pg=t=>Yy.get(t);function iI(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(t,e),d=ba(l);return r&&l.addEventListener("upgradeneeded",h=>{r(ba(l.result),h.oldVersion,h.newVersion,ba(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),d.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",m=>i(m.oldVersion,m.newVersion,m))}).catch(()=>{}),d}const aI=["get","getKey","getAll","getAllKeys","count"],oI=["put","add","delete","clear"],zg=new Map;function iw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(zg.get(e))return zg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=oI.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||aI.includes(n)))return;const o=async function(l,...d){const h=this.transaction(l,i?"readwrite":"readonly");let m=h.store;return r&&(m=m.index(d.shift())),(await Promise.all([m[n](...d),i&&h.done]))[0]};return zg.set(e,o),o}nI(t=>({...t,get:(e,n,r)=>iw(e,n)||t.get(e,n,r),has:(e,n)=>!!iw(e,n)||t.has(e,n)}));class lI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(cI(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function cI(t){return t.getComponent()?.type==="VERSION"}const uy="@firebase/app",aw="0.14.6";const wi=new Ky("@firebase/app"),uI="@firebase/app-compat",dI="@firebase/analytics-compat",hI="@firebase/analytics",fI="@firebase/app-check-compat",mI="@firebase/app-check",pI="@firebase/auth",gI="@firebase/auth-compat",yI="@firebase/database",_I="@firebase/data-connect",bI="@firebase/database-compat",vI="@firebase/functions",xI="@firebase/functions-compat",wI="@firebase/installations",SI="@firebase/installations-compat",CI="@firebase/messaging",EI="@firebase/messaging-compat",TI="@firebase/performance",AI="@firebase/performance-compat",jI="@firebase/remote-config",RI="@firebase/remote-config-compat",II="@firebase/storage",kI="@firebase/storage-compat",DI="@firebase/firestore",MI="@firebase/ai",OI="@firebase/firestore-compat",NI="firebase",PI="12.6.0";const dy="[DEFAULT]",zI={[uy]:"fire-core",[uI]:"fire-core-compat",[hI]:"fire-analytics",[dI]:"fire-analytics-compat",[mI]:"fire-app-check",[fI]:"fire-app-check-compat",[pI]:"fire-auth",[gI]:"fire-auth-compat",[yI]:"fire-rtdb",[_I]:"fire-data-connect",[bI]:"fire-rtdb-compat",[vI]:"fire-fn",[xI]:"fire-fn-compat",[wI]:"fire-iid",[SI]:"fire-iid-compat",[CI]:"fire-fcm",[EI]:"fire-fcm-compat",[TI]:"fire-perf",[AI]:"fire-perf-compat",[jI]:"fire-rc",[RI]:"fire-rc-compat",[II]:"fire-gcs",[kI]:"fire-gcs-compat",[DI]:"fire-fst",[OI]:"fire-fst-compat",[MI]:"fire-vertex","fire-js":"fire-js",[NI]:"fire-js-all"};const hf=new Map,BI=new Map,hy=new Map;function ow(t,e){try{t.container.addComponent(e)}catch(n){wi.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function ql(t){const e=t.name;if(hy.has(e))return wi.debug(`There were multiple attempts to register component ${e}.`),!1;hy.set(e,t);for(const n of hf.values())ow(n,t);for(const n of BI.values())ow(n,t);return!0}function Xy(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ls(t){return t==null?!1:t.settings!==void 0}const LI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},va=new Yu("app","Firebase",LI);class UI{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ro("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw va.create("app-deleted",{appName:this._name})}}const ic=PI;function tC(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:dy,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw va.create("bad-app-name",{appName:String(i)});if(n||(n=KS()),!n)throw va.create("no-options");const o=hf.get(i);if(o){if(xi(n,o.options)&&xi(r,o.config))return o;throw va.create("duplicate-app",{appName:i})}const l=new GR(i);for(const h of hy.values())l.addComponent(h);const d=new UI(n,r,l);return hf.set(i,d),d}function nC(t=dy){const e=hf.get(t);if(!e&&t===dy&&KS())return tC();if(!e)throw va.create("no-app",{appName:t});return e}function xa(t,e,n){let r=zI[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${e}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),wi.warn(l.join(" "));return}ql(new Ro(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const FI="firebase-heartbeat-database",VI=1,Nu="firebase-heartbeat-store";let Bg=null;function rC(){return Bg||(Bg=iI(FI,VI,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Nu)}catch(n){console.warn(n)}}}}).catch(t=>{throw va.create("idb-open",{originalErrorMessage:t.message})})),Bg}async function $I(t){try{const n=(await rC()).transaction(Nu),r=await n.objectStore(Nu).get(sC(t));return await n.done,r}catch(e){if(e instanceof ji)wi.warn(e.message);else{const n=va.create("idb-get",{originalErrorMessage:e?.message});wi.warn(n.message)}}}async function lw(t,e){try{const r=(await rC()).transaction(Nu,"readwrite");await r.objectStore(Nu).put(e,sC(t)),await r.done}catch(n){if(n instanceof ji)wi.warn(n.message);else{const r=va.create("idb-set",{originalErrorMessage:n?.message});wi.warn(r.message)}}}function sC(t){return`${t.name}!${t.options.appId}`}const qI=1024,HI=30;class GI{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new WI(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=cw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>HI){const i=KI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){wi.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=cw(),{heartbeatsToSend:n,unsentEntries:r}=QI(this._heartbeatsCache.heartbeats),i=df(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return wi.warn(e),""}}}function cw(){return new Date().toISOString().substring(0,10)}function QI(t,e=qI){const n=[];let r=t.slice();for(const i of t){const o=n.find(l=>l.agent===i.agent);if(o){if(o.dates.push(i.date),uw(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),uw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class WI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return OR()?NR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await $I(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return lw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return lw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function uw(t){return df(JSON.stringify({version:2,heartbeats:t})).length}function KI(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function YI(t){ql(new Ro("platform-logger",e=>new lI(e),"PRIVATE")),ql(new Ro("heartbeat",e=>new GI(e),"PRIVATE")),xa(uy,aw,t),xa(uy,aw,"esm2020"),xa("fire-js","")}YI("");function iC(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const XI=iC,aC=new Yu("auth","Firebase",iC());const ff=new Ky("@firebase/auth");function ZI(t,...e){ff.logLevel<=pt.WARN&&ff.warn(`Auth (${ic}): ${t}`,...e)}function Yh(t,...e){ff.logLevel<=pt.ERROR&&ff.error(`Auth (${ic}): ${t}`,...e)}function hs(t,...e){throw Zy(t,...e)}function Fs(t,...e){return Zy(t,...e)}function oC(t,e,n){const r={...XI(),[e]:n};return new Yu("auth","Firebase",r).create(e,{appName:t.name})}function wa(t){return oC(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Zy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return aC.create(t,...e)}function Ke(t,e,...n){if(!t)throw Zy(e,...n)}function gi(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Yh(e),new Error(e)}function Si(t,e){t||gi(e)}function fy(){return typeof self<"u"&&self.location?.href||""}function JI(){return dw()==="http:"||dw()==="https:"}function dw(){return typeof self<"u"&&self.location?.protocol||null}function ek(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(JI()||IR()||"connection"in navigator)?navigator.onLine:!0}function tk(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class Zu{constructor(e,n){this.shortDelay=e,this.longDelay=n,Si(n>e,"Short delay should be less than long delay!"),this.isMobile=AR()||kR()}get(){return ek()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Jy(t,e){Si(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class lC{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;gi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;gi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;gi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const nk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const rk=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],sk=new Zu(3e4,6e4);function Po(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Na(t,e,n,r,i={}){return cC(t,i,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const d=Xu({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const m={method:e,headers:h,...o};return RR()||(m.referrerPolicy="no-referrer"),t.emulatorConfig&&sc(t.emulatorConfig.host)&&(m.credentials="include"),lC.fetch()(await uC(t,t.config.apiHost,n,d),m)})}async function cC(t,e,n){t._canInitEmulator=!1;const r={...nk,...e};try{const i=new ak(t),o=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Uh(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const d=o.ok?l.errorMessage:l.error.message,[h,m]=d.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Uh(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Uh(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw Uh(t,"user-disabled",l);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(m)throw oC(t,p,m);hs(t,p)}}catch(i){if(i instanceof ji)throw i;hs(t,"network-request-failed",{message:String(i)})}}async function Hf(t,e,n,r,i={}){const o=await Na(t,e,n,r,i);return"mfaPendingCredential"in o&&hs(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function uC(t,e,n,r){const i=`${e}${n}?${r}`,o=t,l=o.config.emulator?Jy(t.config,i):`${t.config.apiScheme}://${i}`;return rk.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function ik(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ak{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Fs(this.auth,"network-request-failed")),sk.get())})}}function Uh(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Fs(t,e,r);return i.customData._tokenResponse=n,i}function hw(t){return t!==void 0&&t.enterprise!==void 0}class ok{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return ik(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function lk(t,e){return Na(t,"GET","/v2/recaptchaConfig",Po(t,e))}async function ck(t,e){return Na(t,"POST","/v1/accounts:delete",e)}async function mf(t,e){return Na(t,"POST","/v1/accounts:lookup",e)}function ju(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function uk(t,e=!1){const n=Sn(t),r=await n.getIdToken(e),i=e0(r);Ke(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,l=o?.sign_in_provider;return{claims:i,token:r,authTime:ju(Lg(i.auth_time)),issuedAtTime:ju(Lg(i.iat)),expirationTime:ju(Lg(i.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Lg(t){return Number(t)*1e3}function e0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Yh("JWT malformed, contained fewer than 3 sections"),null;try{const i=QS(n);return i?JSON.parse(i):(Yh("Failed to decode base64 JWT payload"),null)}catch(i){return Yh("Caught error parsing JWT payload as JSON",i?.toString()),null}}function fw(t){const e=e0(t);return Ke(e,"internal-error"),Ke(typeof e.exp<"u","internal-error"),Ke(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Pu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof ji&&dk(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function dk({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class hk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class my{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=ju(this.lastLoginAt),this.creationTime=ju(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function pf(t){const e=t.auth,n=await t.getIdToken(),r=await Pu(t,mf(e,{idToken:n}));Ke(r?.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=i.providerUserInfo?.length?dC(i.providerUserInfo):[],l=mk(t.providerData,o),d=t.isAnonymous,h=!(t.email&&i.passwordHash)&&!l?.length,m=d?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new my(i.createdAt,i.lastLoginAt),isAnonymous:m};Object.assign(t,p)}async function fk(t){const e=Sn(t);await pf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function mk(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function dC(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function pk(t,e){const n=await cC(t,{},async()=>{const r=Xu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=t.config,l=await uC(t,i,"/v1/token",`key=${o}`),d=await t._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:d,body:r};return t.emulatorConfig&&sc(t.emulatorConfig.host)&&(h.credentials="include"),lC.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function gk(t,e){return Na(t,"POST","/v2/accounts:revokeToken",Po(t,e))}class Ll{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ke(e.idToken,"internal-error"),Ke(typeof e.idToken<"u","internal-error"),Ke(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):fw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ke(e.length!==0,"internal-error");const n=fw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ke(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:o}=await pk(e,n);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:o}=n,l=new Ll;return r&&(Ke(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),i&&(Ke(typeof i=="string","internal-error",{appName:e}),l.accessToken=i),o&&(Ke(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ll,this.toJSON())}_performRefresh(){return gi("not implemented")}}function la(t,e){Ke(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class cs{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new hk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new my(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Pu(this,this.stsTokenManager.getToken(this.auth,e));return Ke(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return uk(this,e)}reload(){return fk(this)}_assign(e){this!==e&&(Ke(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new cs({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ke(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await pf(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ls(this.auth.app))return Promise.reject(wa(this.auth));const e=await this.getIdToken();return await Pu(this,ck(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,d=n.tenantId??void 0,h=n._redirectEventId??void 0,m=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:v,isAnonymous:_,providerData:C,stsTokenManager:x}=n;Ke(g&&x,e,"internal-error");const S=Ll.fromJSON(this.name,x);Ke(typeof g=="string",e,"internal-error"),la(r,e.name),la(i,e.name),Ke(typeof v=="boolean",e,"internal-error"),Ke(typeof _=="boolean",e,"internal-error"),la(o,e.name),la(l,e.name),la(d,e.name),la(h,e.name),la(m,e.name),la(p,e.name);const E=new cs({uid:g,auth:e,email:i,emailVerified:v,displayName:r,isAnonymous:_,photoURL:l,phoneNumber:o,tenantId:d,stsTokenManager:S,createdAt:m,lastLoginAt:p});return C&&Array.isArray(C)&&(E.providerData=C.map(T=>({...T}))),h&&(E._redirectEventId=h),E}static async _fromIdTokenResponse(e,n,r=!1){const i=new Ll;i.updateFromServerResponse(n);const o=new cs({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await pf(o),o}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];Ke(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?dC(i.providerUserInfo):[],l=!(i.email&&i.passwordHash)&&!o?.length,d=new Ll;d.updateFromIdToken(r);const h=new cs({uid:i.localId,auth:e,stsTokenManager:d,isAnonymous:l}),m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new my(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,m),h}}const mw=new Map;function yi(t){Si(t instanceof Function,"Expected a class definition");let e=mw.get(t);return e?(Si(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,mw.set(t,e),e)}class hC{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}hC.type="NONE";const pw=hC;function Xh(t,e,n){return`firebase:${t}:${e}:${n}`}class Ul{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=Xh(this.userKey,i.apiKey,o),this.fullPersistenceKey=Xh("persistence",i.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await mf(this.auth,{idToken:e}).catch(()=>{});return n?cs._fromGetAccountInfoResponse(this.auth,n,e):null}return cs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Ul(yi(pw),e,r);const i=(await Promise.all(n.map(async m=>{if(await m._isAvailable())return m}))).filter(m=>m);let o=i[0]||yi(pw);const l=Xh(r,e.config.apiKey,e.name);let d=null;for(const m of n)try{const p=await m._get(l);if(p){let g;if(typeof p=="string"){const v=await mf(e,{idToken:p}).catch(()=>{});if(!v)break;g=await cs._fromGetAccountInfoResponse(e,v,p)}else g=cs._fromJSON(e,p);m!==o&&(d=g),o=m;break}}catch{}const h=i.filter(m=>m._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Ul(o,e,r):(o=h[0],d&&await o._set(l,d.toJSON()),await Promise.all(n.map(async m=>{if(m!==o)try{await m._remove(l)}catch{}})),new Ul(o,e,r))}}function gw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(gC(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(fC(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(_C(e))return"Blackberry";if(bC(e))return"Webos";if(mC(e))return"Safari";if((e.includes("chrome/")||pC(e))&&!e.includes("edge/"))return"Chrome";if(yC(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function fC(t=nr()){return/firefox\//i.test(t)}function mC(t=nr()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function pC(t=nr()){return/crios\//i.test(t)}function gC(t=nr()){return/iemobile/i.test(t)}function yC(t=nr()){return/android/i.test(t)}function _C(t=nr()){return/blackberry/i.test(t)}function bC(t=nr()){return/webos/i.test(t)}function t0(t=nr()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function yk(t=nr()){return t0(t)&&!!window.navigator?.standalone}function _k(){return DR()&&document.documentMode===10}function vC(t=nr()){return t0(t)||yC(t)||bC(t)||_C(t)||/windows phone/i.test(t)||gC(t)}function xC(t,e=[]){let n;switch(t){case"Browser":n=gw(nr());break;case"Worker":n=`${gw(nr())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${ic}/${r}`}class bk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,d)=>{try{const h=e(o);l(h)}catch(h){d(h)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function vk(t,e={}){return Na(t,"GET","/v2/passwordPolicy",Po(t,e))}const xk=6;class wk{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??xk,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class Sk{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new yw(this),this.idTokenSubscription=new yw(this),this.beforeStateQueue=new bk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=aC,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=yi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Ul.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await mf(this,{idToken:e}),r=await cs._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(ls(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===l)&&d?.user&&(r=d.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ke(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await pf(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=tk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ls(this.app))return Promise.reject(wa(this));const n=e?Sn(e):null;return n&&Ke(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ke(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ls(this.app)?Promise.reject(wa(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ls(this.app)?Promise.reject(wa(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(yi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await vk(this),n=new wk(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Yu("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await gk(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&yi(e)||this._popupRedirectResolver;Ke(n,this,"argument-error"),this.redirectPersistenceManager=await Ul.create(this,[yi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ke(d,this,"internal-error"),d.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,i);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ke(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=xC(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(ls(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&ZI(`Error while retrieving App Check token: ${e.error}`),e?.token}}function ac(t){return Sn(t)}class yw{constructor(e){this.auth=e,this.observer=null,this.addObserver=UR(n=>this.observer=n)}get next(){return Ke(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Gf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ck(t){Gf=t}function wC(t){return Gf.loadJS(t)}function Ek(){return Gf.recaptchaEnterpriseScript}function Tk(){return Gf.gapiScript}function Ak(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class jk{constructor(){this.enterprise=new Rk}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class Rk{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const Ik="recaptcha-enterprise",SC="NO_RECAPTCHA";class kk{constructor(e){this.type=Ik,this.auth=ac(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,d)=>{lk(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)d(new Error("recaptcha Enterprise site key undefined"));else{const m=new ok(h);return o.tenantId==null?o._agentRecaptchaConfig=m:o._tenantRecaptchaConfigs[o.tenantId]=m,l(m.siteKey)}}).catch(h=>{d(h)})})}function i(o,l,d){const h=window.grecaptcha;hw(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(m=>{l(m)}).catch(()=>{l(SC)})}):d(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new jk().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(d=>{if(!n&&hw(window.grecaptcha))i(d,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=Ek();h.length!==0&&(h+=d),wC(h).then(()=>{i(d,o,l)}).catch(m=>{l(m)})}}).catch(d=>{l(d)})})}}async function _w(t,e,n,r=!1,i=!1){const o=new kk(t);let l;if(i)l=SC;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const d={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in d){const h=d.phoneEnrollmentInfo.phoneNumber,m=d.phoneEnrollmentInfo.recaptchaToken;Object.assign(d,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:m,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in d){const h=d.phoneSignInInfo.recaptchaToken;Object.assign(d,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return d}return r?Object.assign(d,{captchaResp:l}):Object.assign(d,{captchaResponse:l}),Object.assign(d,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(d,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),d}async function bw(t,e,n,r,i){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await _w(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await _w(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function Dk(t,e){const n=Xy(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),o=n.getOptions();if(xi(o,e??{}))return i;hs(i,"already-initialized")}return n.initialize({options:e})}function Mk(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(yi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function Ok(t,e,n){const r=ac(t);Ke(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=CC(e),{host:l,port:d}=Nk(e),h=d===null?"":`:${d}`,m={url:`${o}//${l}${h}/`},p=Object.freeze({host:l,port:d,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Ke(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ke(xi(m,r.config.emulator)&&xi(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=m,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,sc(l)?(XS(`${o}//${l}${h}`),ZS("Auth",!0)):Pk()}function CC(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Nk(t){const e=CC(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:vw(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:vw(l)}}}function vw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Pk(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class n0{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return gi("not implemented")}_getIdTokenResponse(e){return gi("not implemented")}_linkToIdToken(e,n){return gi("not implemented")}_getReauthenticationResolver(e){return gi("not implemented")}}async function zk(t,e){return Na(t,"POST","/v1/accounts:signUp",e)}async function Bk(t,e){return Hf(t,"POST","/v1/accounts:signInWithPassword",Po(t,e))}async function Lk(t,e){return Hf(t,"POST","/v1/accounts:signInWithEmailLink",Po(t,e))}async function Uk(t,e){return Hf(t,"POST","/v1/accounts:signInWithEmailLink",Po(t,e))}class zu extends n0{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new zu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new zu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return bw(e,n,"signInWithPassword",Bk);case"emailLink":return Lk(e,{email:this._email,oobCode:this._password});default:hs(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return bw(e,r,"signUpPassword",zk);case"emailLink":return Uk(e,{idToken:n,email:this._email,oobCode:this._password});default:hs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Fl(t,e){return Hf(t,"POST","/v1/accounts:signInWithIdp",Po(t,e))}const Fk="http://localhost";class Io extends n0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Io(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):hs("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...o}=n;if(!r||!i)return null;const l=new Io(r,i);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return Fl(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Fl(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Fl(e,n)}buildRequest(){const e={requestUri:Fk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Xu(n)}return e}}function Vk(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function $k(t){const e=xu(wu(t)).link,n=e?xu(wu(e)).deep_link_id:null,r=xu(wu(t)).deep_link_id;return(r?xu(wu(r)).link:null)||r||n||e||t}class r0{constructor(e){const n=xu(wu(e)),r=n.apiKey??null,i=n.oobCode??null,o=Vk(n.mode??null);Ke(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=$k(e);try{return new r0(n)}catch{return null}}}class oc{constructor(){this.providerId=oc.PROVIDER_ID}static credential(e,n){return zu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=r0.parseLink(n);return Ke(r,"argument-error"),zu._fromEmailAndCode(e,r.code,r.tenantId)}}oc.PROVIDER_ID="password";oc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";oc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class EC{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Ju extends EC{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ua extends Ju{constructor(){super("facebook.com")}static credential(e){return Io._fromParams({providerId:ua.PROVIDER_ID,signInMethod:ua.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ua.credentialFromTaggedObject(e)}static credentialFromError(e){return ua.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ua.credential(e.oauthAccessToken)}catch{return null}}}ua.FACEBOOK_SIGN_IN_METHOD="facebook.com";ua.PROVIDER_ID="facebook.com";class da extends Ju{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Io._fromParams({providerId:da.PROVIDER_ID,signInMethod:da.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return da.credentialFromTaggedObject(e)}static credentialFromError(e){return da.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return da.credential(n,r)}catch{return null}}}da.GOOGLE_SIGN_IN_METHOD="google.com";da.PROVIDER_ID="google.com";class ha extends Ju{constructor(){super("github.com")}static credential(e){return Io._fromParams({providerId:ha.PROVIDER_ID,signInMethod:ha.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ha.credentialFromTaggedObject(e)}static credentialFromError(e){return ha.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ha.credential(e.oauthAccessToken)}catch{return null}}}ha.GITHUB_SIGN_IN_METHOD="github.com";ha.PROVIDER_ID="github.com";class fa extends Ju{constructor(){super("twitter.com")}static credential(e,n){return Io._fromParams({providerId:fa.PROVIDER_ID,signInMethod:fa.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return fa.credentialFromTaggedObject(e)}static credentialFromError(e){return fa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return fa.credential(n,r)}catch{return null}}}fa.TWITTER_SIGN_IN_METHOD="twitter.com";fa.PROVIDER_ID="twitter.com";class Hl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const o=await cs._fromIdTokenResponse(e,r,i),l=xw(r);return new Hl({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=xw(r);return new Hl({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function xw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class gf extends ji{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,gf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new gf(e,n,r,i)}}function TC(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?gf._fromErrorAndOperation(t,o,e,r):o})}async function qk(t,e,n=!1){const r=await Pu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Hl._forOperation(t,"link",r)}async function Hk(t,e,n=!1){const{auth:r}=t;if(ls(r.app))return Promise.reject(wa(r));const i="reauthenticate";try{const o=await Pu(t,TC(r,i,e,t),n);Ke(o.idToken,r,"internal-error");const l=e0(o.idToken);Ke(l,r,"internal-error");const{sub:d}=l;return Ke(t.uid===d,r,"user-mismatch"),Hl._forOperation(t,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&hs(r,"user-mismatch"),o}}async function AC(t,e,n=!1){if(ls(t.app))return Promise.reject(wa(t));const r="signIn",i=await TC(t,r,e),o=await Hl._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(o.user),o}async function Gk(t,e){return AC(ac(t),e)}async function Qk(t){const e=ac(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function Wk(t,e,n){return ls(t.app)?Promise.reject(wa(t)):Gk(Sn(t),oc.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Qk(t),r})}function Kk(t,e,n,r){return Sn(t).onIdTokenChanged(e,n,r)}function Yk(t,e,n){return Sn(t).beforeAuthStateChanged(e,n)}function Xk(t,e,n,r){return Sn(t).onAuthStateChanged(e,n,r)}function Zk(t){return Sn(t).signOut()}const yf="__sak";class jC{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(yf,"1"),this.storage.removeItem(yf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Jk=1e3,eD=10;class RC extends jC{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=vC(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,d,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);_k()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,eD):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Jk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}RC.type="LOCAL";const tD=RC;class IC extends jC{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}IC.type="SESSION";const kC=IC;function nD(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class Qf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new Qf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:o}=n.data,l=this.handlersMap[i];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const d=Array.from(l).map(async m=>m(n.origin,o)),h=await nD(d);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Qf.receivers=[];function s0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class rD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,l;return new Promise((d,h)=>{const m=s0("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:i,onMessage(g){const v=g;if(v.data.eventId===m)switch(v.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),d(v.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),i.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:m,data:n},[i.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Vs(){return window}function sD(t){Vs().location.href=t}function DC(){return typeof Vs().WorkerGlobalScope<"u"&&typeof Vs().importScripts=="function"}async function iD(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function aD(){return navigator?.serviceWorker?.controller||null}function oD(){return DC()?self:null}const MC="firebaseLocalStorageDb",lD=1,_f="firebaseLocalStorage",OC="fbase_key";class ed{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Wf(t,e){return t.transaction([_f],e?"readwrite":"readonly").objectStore(_f)}function cD(){const t=indexedDB.deleteDatabase(MC);return new ed(t).toPromise()}function py(){const t=indexedDB.open(MC,lD);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(_f,{keyPath:OC})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(_f)?e(r):(r.close(),await cD(),e(await py()))})})}async function ww(t,e,n){const r=Wf(t,!0).put({[OC]:e,value:n});return new ed(r).toPromise()}async function uD(t,e){const n=Wf(t,!1).get(e),r=await new ed(n).toPromise();return r===void 0?null:r.value}function Sw(t,e){const n=Wf(t,!0).delete(e);return new ed(n).toPromise()}const dD=800,hD=3;class NC{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await py(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>hD)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return DC()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Qf._getInstance(oD()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await iD(),!this.activeServiceWorker)return;this.sender=new rD(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||aD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await py();return await ww(e,yf,"1"),await Sw(e,yf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>ww(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>uD(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Sw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=Wf(i,!1).getAll();return new ed(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),dD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}NC.type="LOCAL";const fD=NC;new Zu(3e4,6e4);function mD(t,e){return e?yi(e):(Ke(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class i0 extends n0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Fl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Fl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Fl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function pD(t){return AC(t.auth,new i0(t),t.bypassAuthState)}function gD(t){const{auth:e,user:n}=t;return Ke(n,e,"internal-error"),Hk(n,new i0(t),t.bypassAuthState)}async function yD(t){const{auth:e,user:n}=t;return Ke(n,e,"internal-error"),qk(n,new i0(t),t.bypassAuthState)}class PC{constructor(e,n,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:o,error:l,type:d}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(h))}catch(m){this.reject(m)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return pD;case"linkViaPopup":case"linkViaRedirect":return yD;case"reauthViaPopup":case"reauthViaRedirect":return gD;default:hs(this.auth,"internal-error")}}resolve(e){Si(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Si(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const _D=new Zu(2e3,1e4);class Bl extends PC{constructor(e,n,r,i,o){super(e,n,i,o),this.provider=r,this.authWindow=null,this.pollId=null,Bl.currentPopupAction&&Bl.currentPopupAction.cancel(),Bl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ke(e,this.auth,"internal-error"),e}async onExecution(){Si(this.filter.length===1,"Popup operations only handle one event");const e=s0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Fs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Fs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Bl.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Fs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,_D.get())};e()}}Bl.currentPopupAction=null;const bD="pendingRedirect",Zh=new Map;class vD extends PC{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Zh.get(this.auth._key());if(!e){try{const r=await xD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Zh.set(this.auth._key(),e)}return this.bypassAuthState||Zh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function xD(t,e){const n=CD(e),r=SD(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function wD(t,e){Zh.set(t._key(),e)}function SD(t){return yi(t._redirectPersistence)}function CD(t){return Xh(bD,t.config.apiKey,t.name)}async function ED(t,e,n=!1){if(ls(t.app))return Promise.reject(wa(t));const r=ac(t),i=mD(r,e),l=await new vD(r,i,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const TD=600*1e3;class AD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!jD(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!zC(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Fs(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=TD&&this.cachedEventUids.clear(),this.cachedEventUids.has(Cw(e))}saveEventToCache(e){this.cachedEventUids.add(Cw(e)),this.lastProcessedEventTime=Date.now()}}function Cw(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function zC({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function jD(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return zC(t);default:return!1}}async function RD(t,e={}){return Na(t,"GET","/v1/projects",e)}const ID=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,kD=/^https?/;async function DD(t){if(t.config.emulator)return;const{authorizedDomains:e}=await RD(t);for(const n of e)try{if(MD(n))return}catch{}hs(t,"unauthorized-domain")}function MD(t){const e=fy(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!kD.test(n))return!1;if(ID.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const OD=new Zu(3e4,6e4);function Ew(){const t=Vs().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function ND(t){return new Promise((e,n)=>{function r(){Ew(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ew(),n(Fs(t,"network-request-failed"))},timeout:OD.get()})}if(Vs().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Vs().gapi?.load)r();else{const i=Ak("iframefcb");return Vs()[i]=()=>{gapi.load?r():n(Fs(t,"network-request-failed"))},wC(`${Tk()}?onload=${i}`).catch(o=>n(o))}}).catch(e=>{throw Jh=null,e})}let Jh=null;function PD(t){return Jh=Jh||ND(t),Jh}const zD=new Zu(5e3,15e3),BD="__/auth/iframe",LD="emulator/auth/iframe",UD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},FD=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function VD(t){const e=t.config;Ke(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Jy(e,LD):`https://${t.config.authDomain}/${BD}`,r={apiKey:e.apiKey,appName:t.name,v:ic},i=FD.get(t.config.apiHost);i&&(r.eid=i);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${Xu(r).slice(1)}`}async function $D(t){const e=await PD(t),n=Vs().gapi;return Ke(n,t,"internal-error"),e.open({where:document.body,url:VD(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:UD,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const l=Fs(t,"network-request-failed"),d=Vs().setTimeout(()=>{o(l)},zD.get());function h(){Vs().clearTimeout(d),i(r)}r.ping(h).then(h,()=>{o(l)})}))}const qD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},HD=500,GD=600,QD="_blank",WD="http://localhost";class Tw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function KD(t,e,n,r=HD,i=GD){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const h={...qD,width:r.toString(),height:i.toString(),top:o,left:l},m=nr().toLowerCase();n&&(d=pC(m)?QD:n),fC(m)&&(e=e||WD,h.scrollbars="yes");const p=Object.entries(h).reduce((v,[_,C])=>`${v}${_}=${C},`,"");if(yk(m)&&d!=="_self")return YD(e||"",d),new Tw(null);const g=window.open(e||"",d,p);Ke(g,t,"popup-blocked");try{g.focus()}catch{}return new Tw(g)}function YD(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const XD="__/auth/handler",ZD="emulator/auth/handler",JD=encodeURIComponent("fac");async function Aw(t,e,n,r,i,o){Ke(t.config.authDomain,t,"auth-domain-config-required"),Ke(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:ic,eventId:i};if(e instanceof EC){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",LR(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))l[p]=g}if(e instanceof Ju){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(l.scopes=p.join(","))}t.tenantId&&(l.tid=t.tenantId);const d=l;for(const p of Object.keys(d))d[p]===void 0&&delete d[p];const h=await t._getAppCheckToken(),m=h?`#${JD}=${encodeURIComponent(h)}`:"";return`${eM(t)}?${Xu(d).slice(1)}${m}`}function eM({config:t}){return t.emulator?Jy(t,ZD):`https://${t.authDomain}/${XD}`}const Ug="webStorageSupport";class tM{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=kC,this._completeRedirectFn=ED,this._overrideRedirectResult=wD}async _openPopup(e,n,r,i){Si(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Aw(e,n,r,fy(),i);return KD(e,o,s0())}async _openRedirect(e,n,r,i){await this._originValidation(e);const o=await Aw(e,n,r,fy(),i);return sD(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:o}=this.eventManagers[n];return i?Promise.resolve(i):(Si(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await $D(e),r=new AD(e);return n.register("authEvent",i=>(Ke(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Ug,{type:Ug},i=>{const o=i?.[0]?.[Ug];o!==void 0&&n(!!o),hs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=DD(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return vC()||mC()||t0()}}const nM=tM;var jw="@firebase/auth",Rw="1.12.0";class rM{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ke(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function sM(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function iM(t){ql(new Ro("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:d}=r.options;Ke(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:d,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:xC(t)},m=new Sk(r,i,o,h);return Mk(m,n),m},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),ql(new Ro("auth-internal",e=>{const n=ac(e.getProvider("auth").getImmediate());return(r=>new rM(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),xa(jw,Rw,sM(t)),xa(jw,Rw,"esm2020")}const aM=300,oM=YS("authIdTokenMaxAge")||aM;let Iw=null;const lM=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>oM)return;const i=n?.token;Iw!==i&&(Iw=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function cM(t=nC()){const e=Xy(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Dk(t,{popupRedirectResolver:nM,persistence:[fD,tD,kC]}),r=YS("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=lM(o.toString());Yk(n,l,()=>l(n.currentUser)),Kk(n,d=>l(d))}}const i=WS("auth");return i&&Ok(n,`http://${i}`),n}function uM(){return document.getElementsByTagName("head")?.[0]??document}Ck({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const o=Fs("internal-error");o.customData=i,n(o)},r.type="text/javascript",r.charset="UTF-8",uM().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});iM("Browser");var dM="firebase",hM="12.7.0";xa(dM,hM,"app");const fM={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},BC=tC(fM);function Pa(){const t=cM(BC);async function e(){return!1}async function n(h,m){return Wk(t,h,m)}function r(){return Zk(t)}function i(h){Xk(t,m=>{h(m)})}function o(){return t.currentUser}function l(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:i,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:l}}const lc=300*1e3,mM=1800*1e3,Be=new Jj({defaultOptions:{queries:{staleTime:lc,gcTime:mM,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Be.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const Re={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};function pM({children:t}){return u.jsx(eR,{client:Be,children:t})}var kw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Sa,LC;(function(){var t;function e(M,O){function N(){}N.prototype=O.prototype,M.F=O.prototype,M.prototype=new N,M.prototype.constructor=M,M.D=function(F,q,R){for(var P=Array(arguments.length-2),A=2;A<arguments.length;A++)P[A-2]=arguments[A];return O.prototype[q].apply(F,P)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(M,O,N){N||(N=0);const F=Array(16);if(typeof O=="string")for(var q=0;q<16;++q)F[q]=O.charCodeAt(N++)|O.charCodeAt(N++)<<8|O.charCodeAt(N++)<<16|O.charCodeAt(N++)<<24;else for(q=0;q<16;++q)F[q]=O[N++]|O[N++]<<8|O[N++]<<16|O[N++]<<24;O=M.g[0],N=M.g[1],q=M.g[2];let R=M.g[3],P;P=O+(R^N&(q^R))+F[0]+3614090360&4294967295,O=N+(P<<7&4294967295|P>>>25),P=R+(q^O&(N^q))+F[1]+3905402710&4294967295,R=O+(P<<12&4294967295|P>>>20),P=q+(N^R&(O^N))+F[2]+606105819&4294967295,q=R+(P<<17&4294967295|P>>>15),P=N+(O^q&(R^O))+F[3]+3250441966&4294967295,N=q+(P<<22&4294967295|P>>>10),P=O+(R^N&(q^R))+F[4]+4118548399&4294967295,O=N+(P<<7&4294967295|P>>>25),P=R+(q^O&(N^q))+F[5]+1200080426&4294967295,R=O+(P<<12&4294967295|P>>>20),P=q+(N^R&(O^N))+F[6]+2821735955&4294967295,q=R+(P<<17&4294967295|P>>>15),P=N+(O^q&(R^O))+F[7]+4249261313&4294967295,N=q+(P<<22&4294967295|P>>>10),P=O+(R^N&(q^R))+F[8]+1770035416&4294967295,O=N+(P<<7&4294967295|P>>>25),P=R+(q^O&(N^q))+F[9]+2336552879&4294967295,R=O+(P<<12&4294967295|P>>>20),P=q+(N^R&(O^N))+F[10]+4294925233&4294967295,q=R+(P<<17&4294967295|P>>>15),P=N+(O^q&(R^O))+F[11]+2304563134&4294967295,N=q+(P<<22&4294967295|P>>>10),P=O+(R^N&(q^R))+F[12]+1804603682&4294967295,O=N+(P<<7&4294967295|P>>>25),P=R+(q^O&(N^q))+F[13]+4254626195&4294967295,R=O+(P<<12&4294967295|P>>>20),P=q+(N^R&(O^N))+F[14]+2792965006&4294967295,q=R+(P<<17&4294967295|P>>>15),P=N+(O^q&(R^O))+F[15]+1236535329&4294967295,N=q+(P<<22&4294967295|P>>>10),P=O+(q^R&(N^q))+F[1]+4129170786&4294967295,O=N+(P<<5&4294967295|P>>>27),P=R+(N^q&(O^N))+F[6]+3225465664&4294967295,R=O+(P<<9&4294967295|P>>>23),P=q+(O^N&(R^O))+F[11]+643717713&4294967295,q=R+(P<<14&4294967295|P>>>18),P=N+(R^O&(q^R))+F[0]+3921069994&4294967295,N=q+(P<<20&4294967295|P>>>12),P=O+(q^R&(N^q))+F[5]+3593408605&4294967295,O=N+(P<<5&4294967295|P>>>27),P=R+(N^q&(O^N))+F[10]+38016083&4294967295,R=O+(P<<9&4294967295|P>>>23),P=q+(O^N&(R^O))+F[15]+3634488961&4294967295,q=R+(P<<14&4294967295|P>>>18),P=N+(R^O&(q^R))+F[4]+3889429448&4294967295,N=q+(P<<20&4294967295|P>>>12),P=O+(q^R&(N^q))+F[9]+568446438&4294967295,O=N+(P<<5&4294967295|P>>>27),P=R+(N^q&(O^N))+F[14]+3275163606&4294967295,R=O+(P<<9&4294967295|P>>>23),P=q+(O^N&(R^O))+F[3]+4107603335&4294967295,q=R+(P<<14&4294967295|P>>>18),P=N+(R^O&(q^R))+F[8]+1163531501&4294967295,N=q+(P<<20&4294967295|P>>>12),P=O+(q^R&(N^q))+F[13]+2850285829&4294967295,O=N+(P<<5&4294967295|P>>>27),P=R+(N^q&(O^N))+F[2]+4243563512&4294967295,R=O+(P<<9&4294967295|P>>>23),P=q+(O^N&(R^O))+F[7]+1735328473&4294967295,q=R+(P<<14&4294967295|P>>>18),P=N+(R^O&(q^R))+F[12]+2368359562&4294967295,N=q+(P<<20&4294967295|P>>>12),P=O+(N^q^R)+F[5]+4294588738&4294967295,O=N+(P<<4&4294967295|P>>>28),P=R+(O^N^q)+F[8]+2272392833&4294967295,R=O+(P<<11&4294967295|P>>>21),P=q+(R^O^N)+F[11]+1839030562&4294967295,q=R+(P<<16&4294967295|P>>>16),P=N+(q^R^O)+F[14]+4259657740&4294967295,N=q+(P<<23&4294967295|P>>>9),P=O+(N^q^R)+F[1]+2763975236&4294967295,O=N+(P<<4&4294967295|P>>>28),P=R+(O^N^q)+F[4]+1272893353&4294967295,R=O+(P<<11&4294967295|P>>>21),P=q+(R^O^N)+F[7]+4139469664&4294967295,q=R+(P<<16&4294967295|P>>>16),P=N+(q^R^O)+F[10]+3200236656&4294967295,N=q+(P<<23&4294967295|P>>>9),P=O+(N^q^R)+F[13]+681279174&4294967295,O=N+(P<<4&4294967295|P>>>28),P=R+(O^N^q)+F[0]+3936430074&4294967295,R=O+(P<<11&4294967295|P>>>21),P=q+(R^O^N)+F[3]+3572445317&4294967295,q=R+(P<<16&4294967295|P>>>16),P=N+(q^R^O)+F[6]+76029189&4294967295,N=q+(P<<23&4294967295|P>>>9),P=O+(N^q^R)+F[9]+3654602809&4294967295,O=N+(P<<4&4294967295|P>>>28),P=R+(O^N^q)+F[12]+3873151461&4294967295,R=O+(P<<11&4294967295|P>>>21),P=q+(R^O^N)+F[15]+530742520&4294967295,q=R+(P<<16&4294967295|P>>>16),P=N+(q^R^O)+F[2]+3299628645&4294967295,N=q+(P<<23&4294967295|P>>>9),P=O+(q^(N|~R))+F[0]+4096336452&4294967295,O=N+(P<<6&4294967295|P>>>26),P=R+(N^(O|~q))+F[7]+1126891415&4294967295,R=O+(P<<10&4294967295|P>>>22),P=q+(O^(R|~N))+F[14]+2878612391&4294967295,q=R+(P<<15&4294967295|P>>>17),P=N+(R^(q|~O))+F[5]+4237533241&4294967295,N=q+(P<<21&4294967295|P>>>11),P=O+(q^(N|~R))+F[12]+1700485571&4294967295,O=N+(P<<6&4294967295|P>>>26),P=R+(N^(O|~q))+F[3]+2399980690&4294967295,R=O+(P<<10&4294967295|P>>>22),P=q+(O^(R|~N))+F[10]+4293915773&4294967295,q=R+(P<<15&4294967295|P>>>17),P=N+(R^(q|~O))+F[1]+2240044497&4294967295,N=q+(P<<21&4294967295|P>>>11),P=O+(q^(N|~R))+F[8]+1873313359&4294967295,O=N+(P<<6&4294967295|P>>>26),P=R+(N^(O|~q))+F[15]+4264355552&4294967295,R=O+(P<<10&4294967295|P>>>22),P=q+(O^(R|~N))+F[6]+2734768916&4294967295,q=R+(P<<15&4294967295|P>>>17),P=N+(R^(q|~O))+F[13]+1309151649&4294967295,N=q+(P<<21&4294967295|P>>>11),P=O+(q^(N|~R))+F[4]+4149444226&4294967295,O=N+(P<<6&4294967295|P>>>26),P=R+(N^(O|~q))+F[11]+3174756917&4294967295,R=O+(P<<10&4294967295|P>>>22),P=q+(O^(R|~N))+F[2]+718787259&4294967295,q=R+(P<<15&4294967295|P>>>17),P=N+(R^(q|~O))+F[9]+3951481745&4294967295,M.g[0]=M.g[0]+O&4294967295,M.g[1]=M.g[1]+(q+(P<<21&4294967295|P>>>11))&4294967295,M.g[2]=M.g[2]+q&4294967295,M.g[3]=M.g[3]+R&4294967295}r.prototype.v=function(M,O){O===void 0&&(O=M.length);const N=O-this.blockSize,F=this.C;let q=this.h,R=0;for(;R<O;){if(q==0)for(;R<=N;)i(this,M,R),R+=this.blockSize;if(typeof M=="string"){for(;R<O;)if(F[q++]=M.charCodeAt(R++),q==this.blockSize){i(this,F),q=0;break}}else for(;R<O;)if(F[q++]=M[R++],q==this.blockSize){i(this,F),q=0;break}}this.h=q,this.o+=O},r.prototype.A=function(){var M=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);M[0]=128;for(var O=1;O<M.length-8;++O)M[O]=0;O=this.o*8;for(var N=M.length-8;N<M.length;++N)M[N]=O&255,O/=256;for(this.v(M),M=Array(16),O=0,N=0;N<4;++N)for(let F=0;F<32;F+=8)M[O++]=this.g[N]>>>F&255;return M};function o(M,O){var N=d;return Object.prototype.hasOwnProperty.call(N,M)?N[M]:N[M]=O(M)}function l(M,O){this.h=O;const N=[];let F=!0;for(let q=M.length-1;q>=0;q--){const R=M[q]|0;F&&R==O||(N[q]=R,F=!1)}this.g=N}var d={};function h(M){return-128<=M&&M<128?o(M,function(O){return new l([O|0],O<0?-1:0)}):new l([M|0],M<0?-1:0)}function m(M){if(isNaN(M)||!isFinite(M))return g;if(M<0)return S(m(-M));const O=[];let N=1;for(let F=0;M>=N;F++)O[F]=M/N|0,N*=4294967296;return new l(O,0)}function p(M,O){if(M.length==0)throw Error("number format error: empty string");if(O=O||10,O<2||36<O)throw Error("radix out of range: "+O);if(M.charAt(0)=="-")return S(p(M.substring(1),O));if(M.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=m(Math.pow(O,8));let F=g;for(let R=0;R<M.length;R+=8){var q=Math.min(8,M.length-R);const P=parseInt(M.substring(R,R+q),O);q<8?(q=m(Math.pow(O,q)),F=F.j(q).add(m(P))):(F=F.j(N),F=F.add(m(P)))}return F}var g=h(0),v=h(1),_=h(16777216);t=l.prototype,t.m=function(){if(x(this))return-S(this).m();let M=0,O=1;for(let N=0;N<this.g.length;N++){const F=this.i(N);M+=(F>=0?F:4294967296+F)*O,O*=4294967296}return M},t.toString=function(M){if(M=M||10,M<2||36<M)throw Error("radix out of range: "+M);if(C(this))return"0";if(x(this))return"-"+S(this).toString(M);const O=m(Math.pow(M,6));var N=this;let F="";for(;;){const q=D(N,O).g;N=E(N,q.j(O));let R=((N.g.length>0?N.g[0]:N.h)>>>0).toString(M);if(N=q,C(N))return R+F;for(;R.length<6;)R="0"+R;F=R+F}},t.i=function(M){return M<0?0:M<this.g.length?this.g[M]:this.h};function C(M){if(M.h!=0)return!1;for(let O=0;O<M.g.length;O++)if(M.g[O]!=0)return!1;return!0}function x(M){return M.h==-1}t.l=function(M){return M=E(this,M),x(M)?-1:C(M)?0:1};function S(M){const O=M.g.length,N=[];for(let F=0;F<O;F++)N[F]=~M.g[F];return new l(N,~M.h).add(v)}t.abs=function(){return x(this)?S(this):this},t.add=function(M){const O=Math.max(this.g.length,M.g.length),N=[];let F=0;for(let q=0;q<=O;q++){let R=F+(this.i(q)&65535)+(M.i(q)&65535),P=(R>>>16)+(this.i(q)>>>16)+(M.i(q)>>>16);F=P>>>16,R&=65535,P&=65535,N[q]=P<<16|R}return new l(N,N[N.length-1]&-2147483648?-1:0)};function E(M,O){return M.add(S(O))}t.j=function(M){if(C(this)||C(M))return g;if(x(this))return x(M)?S(this).j(S(M)):S(S(this).j(M));if(x(M))return S(this.j(S(M)));if(this.l(_)<0&&M.l(_)<0)return m(this.m()*M.m());const O=this.g.length+M.g.length,N=[];for(var F=0;F<2*O;F++)N[F]=0;for(F=0;F<this.g.length;F++)for(let q=0;q<M.g.length;q++){const R=this.i(F)>>>16,P=this.i(F)&65535,A=M.i(q)>>>16,W=M.i(q)&65535;N[2*F+2*q]+=P*W,T(N,2*F+2*q),N[2*F+2*q+1]+=R*W,T(N,2*F+2*q+1),N[2*F+2*q+1]+=P*A,T(N,2*F+2*q+1),N[2*F+2*q+2]+=R*A,T(N,2*F+2*q+2)}for(M=0;M<O;M++)N[M]=N[2*M+1]<<16|N[2*M];for(M=O;M<2*O;M++)N[M]=0;return new l(N,0)};function T(M,O){for(;(M[O]&65535)!=M[O];)M[O+1]+=M[O]>>>16,M[O]&=65535,O++}function I(M,O){this.g=M,this.h=O}function D(M,O){if(C(O))throw Error("division by zero");if(C(M))return new I(g,g);if(x(M))return O=D(S(M),O),new I(S(O.g),S(O.h));if(x(O))return O=D(M,S(O)),new I(S(O.g),O.h);if(M.g.length>30){if(x(M)||x(O))throw Error("slowDivide_ only works with positive integers.");for(var N=v,F=O;F.l(M)<=0;)N=B(N),F=B(F);var q=$(N,1),R=$(F,1);for(F=$(F,2),N=$(N,2);!C(F);){var P=R.add(F);P.l(M)<=0&&(q=q.add(N),R=P),F=$(F,1),N=$(N,1)}return O=E(M,q.j(O)),new I(q,O)}for(q=g;M.l(O)>=0;){for(N=Math.max(1,Math.floor(M.m()/O.m())),F=Math.ceil(Math.log(N)/Math.LN2),F=F<=48?1:Math.pow(2,F-48),R=m(N),P=R.j(O);x(P)||P.l(M)>0;)N-=F,R=m(N),P=R.j(O);C(R)&&(R=v),q=q.add(R),M=E(M,P)}return new I(q,M)}t.B=function(M){return D(this,M).h},t.and=function(M){const O=Math.max(this.g.length,M.g.length),N=[];for(let F=0;F<O;F++)N[F]=this.i(F)&M.i(F);return new l(N,this.h&M.h)},t.or=function(M){const O=Math.max(this.g.length,M.g.length),N=[];for(let F=0;F<O;F++)N[F]=this.i(F)|M.i(F);return new l(N,this.h|M.h)},t.xor=function(M){const O=Math.max(this.g.length,M.g.length),N=[];for(let F=0;F<O;F++)N[F]=this.i(F)^M.i(F);return new l(N,this.h^M.h)};function B(M){const O=M.g.length+1,N=[];for(let F=0;F<O;F++)N[F]=M.i(F)<<1|M.i(F-1)>>>31;return new l(N,M.h)}function $(M,O){const N=O>>5;O%=32;const F=M.g.length-N,q=[];for(let R=0;R<F;R++)q[R]=O>0?M.i(R+N)>>>O|M.i(R+N+1)<<32-O:M.i(R+N);return new l(q,M.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,LC=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=m,l.fromString=p,Sa=l}).apply(typeof kw<"u"?kw:typeof self<"u"?self:typeof window<"u"?window:{});var Fh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var UC,Su,FC,ef,gy,VC,$C,qC;(function(){var t,e=Object.defineProperty;function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Fh=="object"&&Fh];for(var j=0;j<y.length;++j){var V=y[j];if(V&&V.Math==Math)return V}throw Error("Cannot find global object")}var r=n(this);function i(y,j){if(j)e:{var V=r;y=y.split(".");for(var Y=0;Y<y.length-1;Y++){var he=y[Y];if(!(he in V))break e;V=V[he]}y=y[y.length-1],Y=V[y],j=j(Y),j!=Y&&j!=null&&e(V,y,{configurable:!0,writable:!0,value:j})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(j){var V=[],Y;for(Y in j)Object.prototype.hasOwnProperty.call(j,Y)&&V.push([Y,j[Y]]);return V}});var o=o||{},l=this||self;function d(y){var j=typeof y;return j=="object"&&y!=null||j=="function"}function h(y,j,V){return y.call.apply(y.bind,arguments)}function m(y,j,V){return m=h,m.apply(null,arguments)}function p(y,j){var V=Array.prototype.slice.call(arguments,1);return function(){var Y=V.slice();return Y.push.apply(Y,arguments),y.apply(this,Y)}}function g(y,j){function V(){}V.prototype=j.prototype,y.Z=j.prototype,y.prototype=new V,y.prototype.constructor=y,y.Ob=function(Y,he,ve){for(var Pe=Array(arguments.length-2),it=2;it<arguments.length;it++)Pe[it-2]=arguments[it];return j.prototype[he].apply(Y,Pe)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function _(y){const j=y.length;if(j>0){const V=Array(j);for(let Y=0;Y<j;Y++)V[Y]=y[Y];return V}return[]}function C(y,j){for(let Y=1;Y<arguments.length;Y++){const he=arguments[Y];var V=typeof he;if(V=V!="object"?V:he?Array.isArray(he)?"array":V:"null",V=="array"||V=="object"&&typeof he.length=="number"){V=y.length||0;const ve=he.length||0;y.length=V+ve;for(let Pe=0;Pe<ve;Pe++)y[V+Pe]=he[Pe]}else y.push(he)}}class x{constructor(j,V){this.i=j,this.j=V,this.h=0,this.g=null}get(){let j;return this.h>0?(this.h--,j=this.g,this.g=j.next,j.next=null):j=this.i(),j}}function S(y){l.setTimeout(()=>{throw y},0)}function E(){var y=M;let j=null;return y.g&&(j=y.g,y.g=y.g.next,y.g||(y.h=null),j.next=null),j}class T{constructor(){this.h=this.g=null}add(j,V){const Y=I.get();Y.set(j,V),this.h?this.h.next=Y:this.g=Y,this.h=Y}}var I=new x(()=>new D,y=>y.reset());class D{constructor(){this.next=this.g=this.h=null}set(j,V){this.h=j,this.g=V,this.next=null}reset(){this.next=this.g=this.h=null}}let B,$=!1,M=new T,O=()=>{const y=Promise.resolve(void 0);B=()=>{y.then(N)}};function N(){for(var y;y=E();){try{y.h.call(y.g)}catch(V){S(V)}var j=I;j.j(y),j.h<100&&(j.h++,y.next=j.g,j.g=y)}$=!1}function F(){this.u=this.u,this.C=this.C}F.prototype.u=!1,F.prototype.dispose=function(){this.u||(this.u=!0,this.N())},F.prototype[Symbol.dispose]=function(){this.dispose()},F.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function q(y,j){this.type=y,this.g=this.target=j,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var R=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var y=!1,j=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const V=()=>{};l.addEventListener("test",V,j),l.removeEventListener("test",V,j)}catch{}return y})();function P(y){return/^[\s\xa0]*$/.test(y)}function A(y,j){q.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,j)}g(A,q),A.prototype.init=function(y,j){const V=this.type=y.type,Y=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=j,j=y.relatedTarget,j||(V=="mouseover"?j=y.fromElement:V=="mouseout"&&(j=y.toElement)),this.relatedTarget=j,Y?(this.clientX=Y.clientX!==void 0?Y.clientX:Y.pageX,this.clientY=Y.clientY!==void 0?Y.clientY:Y.pageY,this.screenX=Y.screenX||0,this.screenY=Y.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&A.Z.h.call(this)},A.prototype.h=function(){A.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var W="closure_listenable_"+(Math.random()*1e6|0),K=0;function G(y,j,V,Y,he){this.listener=y,this.proxy=null,this.src=j,this.type=V,this.capture=!!Y,this.ha=he,this.key=++K,this.da=this.fa=!1}function J(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function X(y,j,V){for(const Y in y)j.call(V,y[Y],Y,y)}function ie(y,j){for(const V in y)j.call(void 0,y[V],V,y)}function L(y){const j={};for(const V in y)j[V]=y[V];return j}const H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(y,j){let V,Y;for(let he=1;he<arguments.length;he++){Y=arguments[he];for(V in Y)y[V]=Y[V];for(let ve=0;ve<H.length;ve++)V=H[ve],Object.prototype.hasOwnProperty.call(Y,V)&&(y[V]=Y[V])}}function se(y){this.src=y,this.g={},this.h=0}se.prototype.add=function(y,j,V,Y,he){const ve=y.toString();y=this.g[ve],y||(y=this.g[ve]=[],this.h++);const Pe=fe(y,j,Y,he);return Pe>-1?(j=y[Pe],V||(j.fa=!1)):(j=new G(j,this.src,ve,!!Y,he),j.fa=V,y.push(j)),j};function ne(y,j){const V=j.type;if(V in y.g){var Y=y.g[V],he=Array.prototype.indexOf.call(Y,j,void 0),ve;(ve=he>=0)&&Array.prototype.splice.call(Y,he,1),ve&&(J(j),y.g[V].length==0&&(delete y.g[V],y.h--))}}function fe(y,j,V,Y){for(let he=0;he<y.length;++he){const ve=y[he];if(!ve.da&&ve.listener==j&&ve.capture==!!V&&ve.ha==Y)return he}return-1}var Ce="closure_lm_"+(Math.random()*1e6|0),de={};function be(y,j,V,Y,he){if(Array.isArray(j)){for(let ve=0;ve<j.length;ve++)be(y,j[ve],V,Y,he);return null}return V=Z(V),y&&y[W]?y.J(j,V,d(Y)?!!Y.capture:!1,he):Me(y,j,V,!1,Y,he)}function Me(y,j,V,Y,he,ve){if(!j)throw Error("Invalid event type");const Pe=d(he)?!!he.capture:!!he;let it=ye(y);if(it||(y[Ce]=it=new se(y)),V=it.add(j,V,Y,Pe,ve),V.proxy)return V;if(Y=Oe(),V.proxy=Y,Y.src=y,Y.listener=V,y.addEventListener)R||(he=Pe),he===void 0&&(he=!1),y.addEventListener(j.toString(),Y,he);else if(y.attachEvent)y.attachEvent(U(j.toString()),Y);else if(y.addListener&&y.removeListener)y.addListener(Y);else throw Error("addEventListener and attachEvent are unavailable.");return V}function Oe(){function y(V){return j.call(y.src,y.listener,V)}const j=ce;return y}function qe(y,j,V,Y,he){if(Array.isArray(j))for(var ve=0;ve<j.length;ve++)qe(y,j[ve],V,Y,he);else Y=d(Y)?!!Y.capture:!!Y,V=Z(V),y&&y[W]?(y=y.i,ve=String(j).toString(),ve in y.g&&(j=y.g[ve],V=fe(j,V,Y,he),V>-1&&(J(j[V]),Array.prototype.splice.call(j,V,1),j.length==0&&(delete y.g[ve],y.h--)))):y&&(y=ye(y))&&(j=y.g[j.toString()],y=-1,j&&(y=fe(j,V,Y,he)),(V=y>-1?j[y]:null)&&ot(V))}function ot(y){if(typeof y!="number"&&y&&!y.da){var j=y.src;if(j&&j[W])ne(j.i,y);else{var V=y.type,Y=y.proxy;j.removeEventListener?j.removeEventListener(V,Y,y.capture):j.detachEvent?j.detachEvent(U(V),Y):j.addListener&&j.removeListener&&j.removeListener(Y),(V=ye(j))?(ne(V,y),V.h==0&&(V.src=null,j[Ce]=null)):J(y)}}}function U(y){return y in de?de[y]:de[y]="on"+y}function ce(y,j){if(y.da)y=!0;else{j=new A(j,this);const V=y.listener,Y=y.ha||y.src;y.fa&&ot(y),y=V.call(Y,j)}return y}function ye(y){return y=y[Ce],y instanceof se?y:null}var ee="__closure_events_fn_"+(Math.random()*1e9>>>0);function Z(y){return typeof y=="function"?y:(y[ee]||(y[ee]=function(j){return y.handleEvent(j)}),y[ee])}function oe(){F.call(this),this.i=new se(this),this.M=this,this.G=null}g(oe,F),oe.prototype[W]=!0,oe.prototype.removeEventListener=function(y,j,V,Y){qe(this,y,j,V,Y)};function Se(y,j){var V,Y=y.G;if(Y)for(V=[];Y;Y=Y.G)V.push(Y);if(y=y.M,Y=j.type||j,typeof j=="string")j=new q(j,y);else if(j instanceof q)j.target=j.target||y;else{var he=j;j=new q(Y,y),te(j,he)}he=!0;let ve,Pe;if(V)for(Pe=V.length-1;Pe>=0;Pe--)ve=j.g=V[Pe],he=we(ve,Y,!0,j)&&he;if(ve=j.g=y,he=we(ve,Y,!0,j)&&he,he=we(ve,Y,!1,j)&&he,V)for(Pe=0;Pe<V.length;Pe++)ve=j.g=V[Pe],he=we(ve,Y,!1,j)&&he}oe.prototype.N=function(){if(oe.Z.N.call(this),this.i){var y=this.i;for(const j in y.g){const V=y.g[j];for(let Y=0;Y<V.length;Y++)J(V[Y]);delete y.g[j],y.h--}}this.G=null},oe.prototype.J=function(y,j,V,Y){return this.i.add(String(y),j,!1,V,Y)},oe.prototype.K=function(y,j,V,Y){return this.i.add(String(y),j,!0,V,Y)};function we(y,j,V,Y){if(j=y.i.g[String(j)],!j)return!0;j=j.concat();let he=!0;for(let ve=0;ve<j.length;++ve){const Pe=j[ve];if(Pe&&!Pe.da&&Pe.capture==V){const it=Pe.listener,an=Pe.ha||Pe.src;Pe.fa&&ne(y.i,Pe),he=it.call(an,Y)!==!1&&he}}return he&&!Y.defaultPrevented}function ae(y,j){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=m(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(j)>2147483647?-1:l.setTimeout(y,j||0)}function Ae(y){y.g=ae(()=>{y.g=null,y.i&&(y.i=!1,Ae(y))},y.l);const j=y.h;y.h=null,y.m.apply(null,j)}class Ne extends F{constructor(j,V){super(),this.m=j,this.l=V,this.h=null,this.i=!1,this.g=null}j(j){this.h=arguments,this.g?this.i=!0:Ae(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function De(y){F.call(this),this.h=y,this.g={}}g(De,F);var He=[];function wt(y){X(y.g,function(j,V){this.g.hasOwnProperty(V)&&ot(j)},y),y.g={}}De.prototype.N=function(){De.Z.N.call(this),wt(this)},De.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var nt=l.JSON.stringify,Yn=l.JSON.parse,gs=class{stringify(y){return l.JSON.stringify(y,void 0)}parse(y){return l.JSON.parse(y,void 0)}};function rr(){}function ys(){}var xt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function nn(){q.call(this,"d")}g(nn,q);function Xn(){q.call(this,"c")}g(Xn,q);var Tt={},Va=null;function Ii(){return Va=Va||new oe}Tt.Ia="serverreachability";function $o(y){q.call(this,Tt.Ia,y)}g($o,q);function Dr(y){const j=Ii();Se(j,new $o(j))}Tt.STAT_EVENT="statevent";function _s(y,j){q.call(this,Tt.STAT_EVENT,y),this.stat=j}g(_s,q);function Ft(y){const j=Ii();Se(j,new _s(j,y))}Tt.Ja="timingevent";function sr(y,j){q.call(this,Tt.Ja,y),this.size=j}g(sr,q);function bs(y,j){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){y()},j)}function Yr(){this.g=!0}Yr.prototype.ua=function(){this.g=!1};function Rm(y,j,V,Y,he,ve){y.info(function(){if(y.g)if(ve){var Pe="",it=ve.split("&");for(let At=0;At<it.length;At++){var an=it[At].split("=");if(an.length>1){const Wt=an[0];an=an[1];const Pr=Wt.split("_");Pe=Pr.length>=2&&Pr[1]=="type"?Pe+(Wt+"="+an+"&"):Pe+(Wt+"=redacted&")}}}else Pe=null;else Pe=ve;return"XMLHTTP REQ ("+Y+") [attempt "+he+"]: "+j+`
`+V+`
`+Pe})}function md(y,j,V,Y,he,ve,Pe){y.info(function(){return"XMLHTTP RESP ("+Y+") [ attempt "+he+"]: "+j+`
`+V+`
`+ve+" "+Pe})}function vs(y,j,V,Y){y.info(function(){return"XMLHTTP TEXT ("+j+"): "+Im(y,V)+(Y?" "+Y:"")})}function $a(y,j){y.info(function(){return"TIMEOUT: "+j})}Yr.prototype.info=function(){};function Im(y,j){if(!y.g)return j;if(!j)return null;try{const ve=JSON.parse(j);if(ve){for(y=0;y<ve.length;y++)if(Array.isArray(ve[y])){var V=ve[y];if(!(V.length<2)){var Y=V[1];if(Array.isArray(Y)&&!(Y.length<1)){var he=Y[0];if(he!="noop"&&he!="stop"&&he!="close")for(let Pe=1;Pe<Y.length;Pe++)Y[Pe]=""}}}}return nt(ve)}catch{return j}}var qa={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},bc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},vc;function Ha(){}g(Ha,rr),Ha.prototype.g=function(){return new XMLHttpRequest},vc=new Ha;function Ys(y){return encodeURIComponent(String(y))}function pd(y){var j=1;y=y.split(":");const V=[];for(;j>0&&y.length;)V.push(y.shift()),j--;return y.length&&V.push(y.join(":")),V}function Xr(y,j,V,Y){this.j=y,this.i=j,this.l=V,this.S=Y||1,this.V=new De(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Zr}function Zr(){this.i=null,this.g="",this.h=!1}var fn={},kn={};function xs(y,j,V){y.M=1,y.A=Ga(pn(j)),y.u=V,y.R=!0,qo(y,null)}function qo(y,j){y.F=Date.now(),ws(y),y.B=pn(y.A);var V=y.B,Y=y.S;Array.isArray(Y)||(Y=[String(Y)]),Wo(V.i,"t",Y),y.C=0,V=y.j.L,y.h=new Zr,y.g=Id(y.j,V?j:null,!y.u),y.P>0&&(y.O=new Ne(m(y.Y,y,y.g),y.P)),j=y.V,V=y.g,Y=y.ba;var he="readystatechange";Array.isArray(he)||(he&&(He[0]=he.toString()),he=He);for(let ve=0;ve<he.length;ve++){const Pe=be(V,he[ve],Y||j.handleEvent,!1,j.h||j);if(!Pe)break;j.g[Pe.key]=Pe}j=y.J?L(y.J):{},y.u?(y.v||(y.v="POST"),j["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,j)):(y.v="GET",y.g.ea(y.B,y.v,null,j)),Dr(),Rm(y.i,y.v,y.B,y.l,y.S,y.u)}Xr.prototype.ba=function(y){y=y.target;const j=this.O;j&&ts(y)==3?j.j():this.Y(y)},Xr.prototype.Y=function(y){try{if(y==this.g)e:{const it=ts(this.g),an=this.g.ya(),At=this.g.ca();if(!(it<3)&&(it!=3||this.g&&(this.h.h||this.g.la()||zn(this.g)))){this.K||it!=4||an==7||(an==8||At<=0?Dr(3):Dr(2)),Ss(this);var j=this.g.ca();this.X=j;var V=km(this);if(this.o=j==200,md(this.i,this.v,this.B,this.l,this.S,it,j),this.o){if(this.U&&!this.L){t:{if(this.g){var Y,he=this.g;if((Y=he.g?he.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(Y)){var ve=Y;break t}}ve=null}if(y=ve)vs(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Cs(this,y);else{this.o=!1,this.m=3,Ft(12),vr(this),Mr(this);break e}}if(this.R){y=!0;let Wt;for(;!this.K&&this.C<V.length;)if(Wt=yd(this,V),Wt==kn){it==4&&(this.m=4,Ft(14),y=!1),vs(this.i,this.l,null,"[Incomplete Response]");break}else if(Wt==fn){this.m=4,Ft(15),vs(this.i,this.l,V,"[Invalid Chunk]"),y=!1;break}else vs(this.i,this.l,Wt,null),Cs(this,Wt);if(gd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),it!=4||V.length!=0||this.h.h||(this.m=1,Ft(16),y=!1),this.o=this.o&&y,!y)vs(this.i,this.l,V,"[Invalid Chunked Response]"),vr(this),Mr(this);else if(V.length>0&&!this.W){this.W=!0;var Pe=this.j;Pe.g==this&&Pe.aa&&!Pe.P&&(Pe.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),Nc(Pe),Pe.P=!0,Ft(11))}}else vs(this.i,this.l,V,null),Cs(this,V);it==4&&vr(this),this.o&&!this.K&&(it==4?Td(this.j,this):(this.o=!1,ws(this)))}else Zs(this.g),j==400&&V.indexOf("Unknown SID")>0?(this.m=3,Ft(12)):(this.m=0,Ft(13)),vr(this),Mr(this)}}}catch{}};function km(y){if(!gd(y))return y.g.la();const j=zn(y.g);if(j==="")return"";let V="";const Y=j.length,he=ts(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return vr(y),Mr(y),"";y.h.i=new l.TextDecoder}for(let ve=0;ve<Y;ve++)y.h.h=!0,V+=y.h.i.decode(j[ve],{stream:!(he&&ve==Y-1)});return j.length=0,y.h.g+=V,y.C=0,y.h.g}function gd(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function yd(y,j){var V=y.C,Y=j.indexOf(`
`,V);return Y==-1?kn:(V=Number(j.substring(V,Y)),isNaN(V)?fn:(Y+=1,Y+V>j.length?kn:(j=j.slice(Y,Y+V),y.C=Y+V,j)))}Xr.prototype.cancel=function(){this.K=!0,vr(this)};function ws(y){y.T=Date.now()+y.H,Ho(y,y.H)}function Ho(y,j){if(y.D!=null)throw Error("WatchDog timer not null");y.D=bs(m(y.aa,y),j)}function Ss(y){y.D&&(l.clearTimeout(y.D),y.D=null)}Xr.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?($a(this.i,this.B),this.M!=2&&(Dr(),Ft(17)),vr(this),this.m=2,Mr(this)):Ho(this,this.T-y)};function Mr(y){y.j.I==0||y.K||Td(y.j,y)}function vr(y){Ss(y);var j=y.O;j&&typeof j.dispose=="function"&&j.dispose(),y.O=null,wt(y.V),y.g&&(j=y.g,y.g=null,j.abort(),j.dispose())}function Cs(y,j){try{var V=y.j;if(V.I!=0&&(V.g==y||Ts(V.h,y))){if(!y.L&&Ts(V.h,y)&&V.I==3){try{var Y=V.Ba.g.parse(j)}catch{Y=null}if(Array.isArray(Y)&&Y.length==3){var he=Y;if(he[0]==0){e:if(!V.v){if(V.g)if(V.g.F+3e3<y.F)Jo(V),Bi(V);else break e;Ja(V),Ft(18)}}else V.xa=he[1],0<V.xa-V.K&&he[2]<37500&&V.F&&V.A==0&&!V.C&&(V.C=bs(m(V.Va,V),6e3));Es(V.h)<=1&&V.ta&&(V.ta=void 0)}else Ds(V,11)}else if((y.L||V.g==y)&&Jo(V),!P(j))for(he=V.Ba.g.parse(j),j=0;j<he.length;j++){let At=he[j];const Wt=At[0];if(!(Wt<=V.K))if(V.K=Wt,At=At[1],V.I==2)if(At[0]=="c"){V.M=At[1],V.ba=At[2];const Pr=At[3];Pr!=null&&(V.ka=Pr,V.j.info("VER="+V.ka));const Ms=At[4];Ms!=null&&(V.za=Ms,V.j.info("SVER="+V.za));const ns=At[5];ns!=null&&typeof ns=="number"&&ns>0&&(Y=1.5*ns,V.O=Y,V.j.info("backChannelRequestTimeoutMs_="+Y)),Y=V;const rs=y.g;if(rs){const eo=rs.g?rs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(eo){var ve=Y.h;ve.g||eo.indexOf("spdy")==-1&&eo.indexOf("quic")==-1&&eo.indexOf("h2")==-1||(ve.j=ve.l,ve.g=new Set,ve.h&&(Sc(ve,ve.h),ve.h=null))}if(Y.G){const el=rs.g?rs.g.getResponseHeader("X-HTTP-Session-Id"):null;el&&(Y.wa=el,It(Y.J,Y.G,el))}}V.I=3,V.l&&V.l.ra(),V.aa&&(V.T=Date.now()-y.F,V.j.info("Handshake RTT: "+V.T+"ms")),Y=V;var Pe=y;if(Y.na=Rd(Y,Y.L?Y.ba:null,Y.W),Pe.L){Cc(Y.h,Pe);var it=Pe,an=Y.O;an&&(it.H=an),it.D&&(Ss(it),ws(it)),Y.g=Pe}else Cd(Y);V.i.length>0&&ks(V)}else At[0]!="stop"&&At[0]!="close"||Ds(V,7);else V.I==3&&(At[0]=="stop"||At[0]=="close"?At[0]=="stop"?Ds(V,7):Mc(V):At[0]!="noop"&&V.l&&V.l.qa(At),V.A=0)}}Dr(4)}catch{}}var mn=class{constructor(y,j){this.g=y,this.map=j}};function xc(y){this.l=y||10,l.PerformanceNavigationTiming?(y=l.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function wc(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function Es(y){return y.h?1:y.g?y.g.size:0}function Ts(y,j){return y.h?y.h==j:y.g?y.g.has(j):!1}function Sc(y,j){y.g?y.g.add(j):y.h=j}function Cc(y,j){y.h&&y.h==j?y.h=null:y.g&&y.g.has(j)&&y.g.delete(j)}xc.prototype.cancel=function(){if(this.i=Ec(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function Ec(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let j=y.i;for(const V of y.g.values())j=j.concat(V.G);return j}return _(y.i)}var _d=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Go(y,j){if(y){y=y.split("&");for(let V=0;V<y.length;V++){const Y=y[V].indexOf("=");let he,ve=null;Y>=0?(he=y[V].substring(0,Y),ve=y[V].substring(Y+1)):he=y[V],j(he,ve?decodeURIComponent(ve.replace(/\+/g," ")):"")}}}function xr(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let j;y instanceof xr?(this.l=y.l,Dn(this,y.j),this.o=y.o,this.g=y.g,ki(this,y.u),this.h=y.h,Tc(this,wd(y.i)),this.m=y.m):y&&(j=String(y).match(_d))?(this.l=!1,Dn(this,j[1]||"",!0),this.o=As(j[2]||""),this.g=As(j[3]||"",!0),ki(this,j[4]),this.h=As(j[5]||"",!0),Tc(this,j[6]||"",!0),this.m=As(j[7]||"")):(this.l=!1,this.i=new Mi(null,this.l))}xr.prototype.toString=function(){const y=[];var j=this.j;j&&y.push(Qa(j,Qo,!0),":");var V=this.g;return(V||j=="file")&&(y.push("//"),(j=this.o)&&y.push(Qa(j,Qo,!0),"@"),y.push(Ys(V).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),V=this.u,V!=null&&y.push(":",String(V))),(V=this.h)&&(this.g&&V.charAt(0)!="/"&&y.push("/"),y.push(Qa(V,V.charAt(0)=="/"?Ac:bd,!0))),(V=this.i.toString())&&y.push("?",V),(V=this.m)&&y.push("#",Qa(V,vd)),y.join("")},xr.prototype.resolve=function(y){const j=pn(this);let V=!!y.j;V?Dn(j,y.j):V=!!y.o,V?j.o=y.o:V=!!y.g,V?j.g=y.g:V=y.u!=null;var Y=y.h;if(V)ki(j,y.u);else if(V=!!y.h){if(Y.charAt(0)!="/")if(this.g&&!this.h)Y="/"+Y;else{var he=j.h.lastIndexOf("/");he!=-1&&(Y=j.h.slice(0,he+1)+Y)}if(he=Y,he==".."||he==".")Y="";else if(he.indexOf("./")!=-1||he.indexOf("/.")!=-1){Y=he.lastIndexOf("/",0)==0,he=he.split("/");const ve=[];for(let Pe=0;Pe<he.length;){const it=he[Pe++];it=="."?Y&&Pe==he.length&&ve.push(""):it==".."?((ve.length>1||ve.length==1&&ve[0]!="")&&ve.pop(),Y&&Pe==he.length&&ve.push("")):(ve.push(it),Y=!0)}Y=ve.join("/")}else Y=he}return V?j.h=Y:V=y.i.toString()!=="",V?Tc(j,wd(y.i)):V=!!y.m,V&&(j.m=y.m),j};function pn(y){return new xr(y)}function Dn(y,j,V){y.j=V?As(j,!0):j,y.j&&(y.j=y.j.replace(/:$/,""))}function ki(y,j){if(j){if(j=Number(j),isNaN(j)||j<0)throw Error("Bad port number "+j);y.u=j}else y.u=null}function Tc(y,j,V){j instanceof Mi?(y.i=j,Ko(y.i,y.l)):(V||(j=Qa(j,Di)),y.i=new Mi(j,y.l))}function It(y,j,V){y.i.set(j,V)}function Ga(y){return It(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function As(y,j){return y?j?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function Qa(y,j,V){return typeof y=="string"?(y=encodeURI(y).replace(j,lr),V&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function lr(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var Qo=/[#\/\?@]/g,bd=/[#\?:]/g,Ac=/[#\?]/g,Di=/[#\?@]/g,vd=/#/g;function Mi(y,j){this.h=this.g=null,this.i=y||null,this.j=!!j}function cr(y){y.g||(y.g=new Map,y.h=0,y.i&&Go(y.i,function(j,V){y.add(decodeURIComponent(j.replace(/\+/g," ")),V)}))}t=Mi.prototype,t.add=function(y,j){cr(this),this.i=null,y=Oi(this,y);let V=this.g.get(y);return V||this.g.set(y,V=[]),V.push(j),this.h+=1,this};function xd(y,j){cr(y),j=Oi(y,j),y.g.has(j)&&(y.i=null,y.h-=y.g.get(j).length,y.g.delete(j))}function jc(y,j){return cr(y),j=Oi(y,j),y.g.has(j)}t.forEach=function(y,j){cr(this),this.g.forEach(function(V,Y){V.forEach(function(he){y.call(j,he,Y,this)},this)},this)};function Rc(y,j){cr(y);let V=[];if(typeof j=="string")jc(y,j)&&(V=V.concat(y.g.get(Oi(y,j))));else for(y=Array.from(y.g.values()),j=0;j<y.length;j++)V=V.concat(y[j]);return V}t.set=function(y,j){return cr(this),this.i=null,y=Oi(this,y),jc(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[j]),this.h+=1,this},t.get=function(y,j){return y?(y=Rc(this,y),y.length>0?String(y[0]):j):j};function Wo(y,j,V){xd(y,j),V.length>0&&(y.i=null,y.g.set(Oi(y,j),_(V)),y.h+=V.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],j=Array.from(this.g.keys());for(let Y=0;Y<j.length;Y++){var V=j[Y];const he=Ys(V);V=Rc(this,V);for(let ve=0;ve<V.length;ve++){let Pe=he;V[ve]!==""&&(Pe+="="+Ys(V[ve])),y.push(Pe)}}return this.i=y.join("&")};function wd(y){const j=new Mi;return j.i=y.i,y.g&&(j.g=new Map(y.g),j.h=y.h),j}function Oi(y,j){return j=String(j),y.j&&(j=j.toLowerCase()),j}function Ko(y,j){j&&!y.j&&(cr(y),y.i=null,y.g.forEach(function(V,Y){const he=Y.toLowerCase();Y!=he&&(xd(this,Y),Wo(this,he,V))},y)),y.j=j}function Jr(y,j){const V=new Yr;if(l.Image){const Y=new Image;Y.onload=p(Or,V,"TestLoadImage: loaded",!0,j,Y),Y.onerror=p(Or,V,"TestLoadImage: error",!1,j,Y),Y.onabort=p(Or,V,"TestLoadImage: abort",!1,j,Y),Y.ontimeout=p(Or,V,"TestLoadImage: timeout",!1,j,Y),l.setTimeout(function(){Y.ontimeout&&Y.ontimeout()},1e4),Y.src=y}else j(!1)}function Ic(y,j){const V=new Yr,Y=new AbortController,he=setTimeout(()=>{Y.abort(),Or(V,"TestPingServer: timeout",!1,j)},1e4);fetch(y,{signal:Y.signal}).then(ve=>{clearTimeout(he),ve.ok?Or(V,"TestPingServer: ok",!0,j):Or(V,"TestPingServer: server error",!1,j)}).catch(()=>{clearTimeout(he),Or(V,"TestPingServer: error",!1,j)})}function Or(y,j,V,Y,he){try{he&&(he.onload=null,he.onerror=null,he.onabort=null,he.ontimeout=null),Y(V)}catch{}}function Ni(){this.g=new gs}function js(y){this.i=y.Sb||null,this.h=y.ab||!1}g(js,rr),js.prototype.g=function(){return new Wa(this.i,this.h)};function Wa(y,j){oe.call(this),this.H=y,this.o=j,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(Wa,oe),t=Wa.prototype,t.open=function(y,j){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=j,this.readyState=1,es(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const j={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(j.body=y),(this.H||l).fetch(new Request(this.D,j)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Pi(this)),this.readyState=0},t.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,es(this)),this.g&&(this.readyState=3,es(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Yo(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function Yo(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}t.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var j=y.value?y.value:new Uint8Array(0);(j=this.B.decode(j,{stream:!y.done}))&&(this.response=this.responseText+=j)}y.done?Pi(this):es(this),this.readyState==3&&Yo(this)}},t.Oa=function(y){this.g&&(this.response=this.responseText=y,Pi(this))},t.Na=function(y){this.g&&(this.response=y,Pi(this))},t.ga=function(){this.g&&Pi(this)};function Pi(y){y.readyState=4,y.l=null,y.j=null,y.B=null,es(y)}t.setRequestHeader=function(y,j){this.A.append(y,j)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],j=this.h.entries();for(var V=j.next();!V.done;)V=V.value,y.push(V[0]+": "+V[1]),V=j.next();return y.join(`\r
`)};function es(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(Wa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Nr(y){let j="";return X(y,function(V,Y){j+=Y,j+=":",j+=V,j+=`\r
`}),j}function Ka(y,j,V){e:{for(Y in V){var Y=!1;break e}Y=!0}Y||(V=Nr(V),typeof y=="string"?V!=null&&Ys(V):It(y,j,V))}function Mt(y){oe.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Mt,oe);var Rs=/^https?$/i,kc=["POST","PUT"];t=Mt.prototype,t.Fa=function(y){this.H=y},t.ea=function(y,j,V,Y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);j=j?j.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():vc.g(),this.g.onreadystatechange=v(m(this.Ca,this));try{this.B=!0,this.g.open(j,String(y),!0),this.B=!1}catch(ve){Ya(this,ve);return}if(y=V||"",V=new Map(this.headers),Y)if(Object.getPrototypeOf(Y)===Object.prototype)for(var he in Y)V.set(he,Y[he]);else if(typeof Y.keys=="function"&&typeof Y.get=="function")for(const ve of Y.keys())V.set(ve,Y.get(ve));else throw Error("Unknown input type for opt_headers: "+String(Y));Y=Array.from(V.keys()).find(ve=>ve.toLowerCase()=="content-type"),he=l.FormData&&y instanceof l.FormData,!(Array.prototype.indexOf.call(kc,j,void 0)>=0)||Y||he||V.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ve,Pe]of V)this.g.setRequestHeader(ve,Pe);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(ve){Ya(this,ve)}};function Ya(y,j){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=j,y.o=5,Dc(y),Xs(y)}function Dc(y){y.A||(y.A=!0,Se(y,"complete"),Se(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,Se(this,"complete"),Se(this,"abort"),Xs(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xs(this,!0)),Mt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Xa(this):this.Xa())},t.Xa=function(){Xa(this)};function Xa(y){if(y.h&&typeof o<"u"){if(y.v&&ts(y)==4)setTimeout(y.Ca.bind(y),0);else if(Se(y,"readystatechange"),ts(y)==4){y.h=!1;try{const ve=y.ca();e:switch(ve){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var j=!0;break e;default:j=!1}var V;if(!(V=j)){var Y;if(Y=ve===0){let Pe=String(y.D).match(_d)[1]||null;!Pe&&l.self&&l.self.location&&(Pe=l.self.location.protocol.slice(0,-1)),Y=!Rs.test(Pe?Pe.toLowerCase():"")}V=Y}if(V)Se(y,"complete"),Se(y,"success");else{y.o=6;try{var he=ts(y)>2?y.g.statusText:""}catch{he=""}y.l=he+" ["+y.ca()+"]",Dc(y)}}finally{Xs(y)}}}}function Xs(y,j){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const V=y.g;y.g=null,j||Se(y,"ready");try{V.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function ts(y){return y.g?y.g.readyState:0}t.ca=function(){try{return ts(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(y){if(this.g){var j=this.g.responseText;return y&&j.indexOf(y)==0&&(j=j.substring(y.length)),Yn(j)}};function zn(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function Zs(y){const j={};y=(y.g&&ts(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let Y=0;Y<y.length;Y++){if(P(y[Y]))continue;var V=pd(y[Y]);const he=V[0];if(V=V[1],typeof V!="string")continue;V=V.trim();const ve=j[he]||[];j[he]=ve,ve.push(V)}ie(j,function(Y){return Y.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Is(y,j,V){return V&&V.internalChannelParams&&V.internalChannelParams[y]||j}function zi(y){this.za=0,this.i=[],this.j=new Yr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Is("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Is("baseRetryDelayMs",5e3,y),this.Za=Is("retryDelaySeedMs",1e4,y),this.Ta=Is("forwardChannelMaxRetries",2,y),this.va=Is("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new xc(y&&y.concurrentRequestLimit),this.Ba=new Ni,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=zi.prototype,t.ka=8,t.I=1,t.connect=function(y,j,V,Y){Ft(0),this.W=y,this.H=j||{},V&&Y!==void 0&&(this.H.OSID=V,this.H.OAID=Y),this.F=this.X,this.J=Rd(this,null,this.W),ks(this)};function Mc(y){if(Xo(y),y.I==3){var j=y.V++,V=pn(y.J);if(It(V,"SID",y.M),It(V,"RID",j),It(V,"TYPE","terminate"),Za(y,V),j=new Xr(y,y.j,j),j.M=2,j.A=Ga(pn(V)),V=!1,l.navigator&&l.navigator.sendBeacon)try{V=l.navigator.sendBeacon(j.A.toString(),"")}catch{}!V&&l.Image&&(new Image().src=j.A,V=!0),V||(j.g=Id(j.j,null),j.g.ea(j.A)),j.F=Date.now(),ws(j)}jd(y)}function Bi(y){y.g&&(Nc(y),y.g.cancel(),y.g=null)}function Xo(y){Bi(y),y.v&&(l.clearTimeout(y.v),y.v=null),Jo(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&l.clearTimeout(y.m),y.m=null)}function ks(y){if(!wc(y.h)&&!y.m){y.m=!0;var j=y.Ea;B||O(),$||(B(),$=!0),M.add(j,y),y.D=0}}function Zo(y,j){return Es(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=j.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=bs(m(y.Ea,y,j),Ad(y,y.D)),y.D++,!0)}t.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const he=new Xr(this,this.j,y);let ve=this.o;if(this.U&&(ve?(ve=L(ve),te(ve,this.U)):ve=this.U),this.u!==null||this.R||(he.J=ve,ve=null),this.S)e:{for(var j=0,V=0;V<this.i.length;V++){t:{var Y=this.i[V];if("__data__"in Y.map&&(Y=Y.map.__data__,typeof Y=="string")){Y=Y.length;break t}Y=void 0}if(Y===void 0)break;if(j+=Y,j>4096){j=V;break e}if(j===4096||V===this.i.length-1){j=V+1;break e}}j=1e3}else j=1e3;j=Sd(this,he,j),V=pn(this.J),It(V,"RID",y),It(V,"CVER",22),this.G&&It(V,"X-HTTP-Session-Id",this.G),Za(this,V),ve&&(this.R?j="headers="+Ys(Nr(ve))+"&"+j:this.u&&Ka(V,this.u,ve)),Sc(this.h,he),this.Ra&&It(V,"TYPE","init"),this.S?(It(V,"$req",j),It(V,"SID","null"),he.U=!0,xs(he,V,null)):xs(he,V,j),this.I=2}}else this.I==3&&(y?Oc(this,y):this.i.length==0||wc(this.h)||Oc(this))};function Oc(y,j){var V;j?V=j.l:V=y.V++;const Y=pn(y.J);It(Y,"SID",y.M),It(Y,"RID",V),It(Y,"AID",y.K),Za(y,Y),y.u&&y.o&&Ka(Y,y.u,y.o),V=new Xr(y,y.j,V,y.D+1),y.u===null&&(V.J=y.o),j&&(y.i=j.G.concat(y.i)),j=Sd(y,V,1e3),V.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),Sc(y.h,V),xs(V,Y,j)}function Za(y,j){y.H&&X(y.H,function(V,Y){It(j,Y,V)}),y.l&&X({},function(V,Y){It(j,Y,V)})}function Sd(y,j,V){V=Math.min(y.i.length,V);const Y=y.l?m(y.l.Ka,y.l,y):null;e:{var he=y.i;let it=-1;for(;;){const an=["count="+V];it==-1?V>0?(it=he[0].g,an.push("ofs="+it)):it=0:an.push("ofs="+it);let At=!0;for(let Wt=0;Wt<V;Wt++){var ve=he[Wt].g;const Pr=he[Wt].map;if(ve-=it,ve<0)it=Math.max(0,he[Wt].g-100),At=!1;else try{ve="req"+ve+"_"||"";try{var Pe=Pr instanceof Map?Pr:Object.entries(Pr);for(const[Ms,ns]of Pe){let rs=ns;d(ns)&&(rs=nt(ns)),an.push(ve+Ms+"="+encodeURIComponent(rs))}}catch(Ms){throw an.push(ve+"type="+encodeURIComponent("_badmap")),Ms}}catch{Y&&Y(Pr)}}if(At){Pe=an.join("&");break e}}Pe=void 0}return y=y.i.splice(0,V),j.G=y,Pe}function Cd(y){if(!y.g&&!y.v){y.Y=1;var j=y.Da;B||O(),$||(B(),$=!0),M.add(j,y),y.A=0}}function Ja(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=bs(m(y.Da,y),Ad(y,y.A)),y.A++,!0)}t.Da=function(){if(this.v=null,Ed(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=bs(m(this.Wa,this),y)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ft(10),Bi(this),Ed(this))};function Nc(y){y.B!=null&&(l.clearTimeout(y.B),y.B=null)}function Ed(y){y.g=new Xr(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var j=pn(y.na);It(j,"RID","rpc"),It(j,"SID",y.M),It(j,"AID",y.K),It(j,"CI",y.F?"0":"1"),!y.F&&y.ia&&It(j,"TO",y.ia),It(j,"TYPE","xmlhttp"),Za(y,j),y.u&&y.o&&Ka(j,y.u,y.o),y.O&&(y.g.H=y.O);var V=y.g;y=y.ba,V.M=1,V.A=Ga(pn(j)),V.u=null,V.R=!0,qo(V,y)}t.Va=function(){this.C!=null&&(this.C=null,Bi(this),Ja(this),Ft(19))};function Jo(y){y.C!=null&&(l.clearTimeout(y.C),y.C=null)}function Td(y,j){var V=null;if(y.g==j){Jo(y),Nc(y),y.g=null;var Y=2}else if(Ts(y.h,j))V=j.G,Cc(y.h,j),Y=1;else return;if(y.I!=0){if(j.o)if(Y==1){V=j.u?j.u.length:0,j=Date.now()-j.F;var he=y.D;Y=Ii(),Se(Y,new sr(Y,V)),ks(y)}else Cd(y);else if(he=j.m,he==3||he==0&&j.X>0||!(Y==1&&Zo(y,j)||Y==2&&Ja(y)))switch(V&&V.length>0&&(j=y.h,j.i=j.i.concat(V)),he){case 1:Ds(y,5);break;case 4:Ds(y,10);break;case 3:Ds(y,6);break;default:Ds(y,2)}}}function Ad(y,j){let V=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(V*=2),V*j}function Ds(y,j){if(y.j.info("Error code "+j),j==2){var V=m(y.bb,y),Y=y.Ua;const he=!Y;Y=new xr(Y||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Dn(Y,"https"),Ga(Y),he?Jr(Y.toString(),V):Ic(Y.toString(),V)}else Ft(2);y.I=0,y.l&&y.l.pa(j),jd(y),Xo(y)}t.bb=function(y){y?(this.j.info("Successfully pinged google.com"),Ft(2)):(this.j.info("Failed to ping google.com"),Ft(1))};function jd(y){if(y.I=0,y.ja=[],y.l){const j=Ec(y.h);(j.length!=0||y.i.length!=0)&&(C(y.ja,j),C(y.ja,y.i),y.h.i.length=0,_(y.i),y.i.length=0),y.l.oa()}}function Rd(y,j,V){var Y=V instanceof xr?pn(V):new xr(V);if(Y.g!="")j&&(Y.g=j+"."+Y.g),ki(Y,Y.u);else{var he=l.location;Y=he.protocol,j=j?j+"."+he.hostname:he.hostname,he=+he.port;const ve=new xr(null);Y&&Dn(ve,Y),j&&(ve.g=j),he&&ki(ve,he),V&&(ve.h=V),Y=ve}return V=y.G,j=y.wa,V&&j&&It(Y,V,j),It(Y,"VER",y.ka),Za(y,Y),Y}function Id(y,j,V){if(j&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return j=y.Aa&&!y.ma?new Mt(new js({ab:V})):new Mt(y.ma),j.Fa(y.L),j}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function kd(){}t=kd.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Li(){}Li.prototype.g=function(y,j){return new ir(y,j)};function ir(y,j){oe.call(this),this.g=new zi(j),this.l=y,this.h=j&&j.messageUrlParams||null,y=j&&j.messageHeaders||null,j&&j.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=j&&j.initMessageHeaders||null,j&&j.messageContentType&&(y?y["X-WebChannel-Content-Type"]=j.messageContentType:y={"X-WebChannel-Content-Type":j.messageContentType}),j&&j.sa&&(y?y["X-WebChannel-Client-Profile"]=j.sa:y={"X-WebChannel-Client-Profile":j.sa}),this.g.U=y,(y=j&&j.Qb)&&!P(y)&&(this.g.u=y),this.A=j&&j.supportsCrossDomainXhr||!1,this.v=j&&j.sendRawJson||!1,(j=j&&j.httpSessionIdParam)&&!P(j)&&(this.g.G=j,y=this.h,y!==null&&j in y&&(y=this.h,j in y&&delete y[j])),this.j=new Js(this)}g(ir,oe),ir.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ir.prototype.close=function(){Mc(this.g)},ir.prototype.o=function(y){var j=this.g;if(typeof y=="string"){var V={};V.__data__=y,y=V}else this.v&&(V={},V.__data__=nt(y),y=V);j.i.push(new mn(j.Ya++,y)),j.I==3&&ks(j)},ir.prototype.N=function(){this.g.l=null,delete this.j,Mc(this.g),delete this.g,ir.Z.N.call(this)};function Dd(y){nn.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var j=y.__sm__;if(j){e:{for(const V in j){y=V;break e}y=void 0}(this.i=y)&&(y=this.i,j=j!==null&&y in j?j[y]:void 0),this.data=j}else this.data=y}g(Dd,nn);function Md(){Xn.call(this),this.status=1}g(Md,Xn);function Js(y){this.g=y}g(Js,kd),Js.prototype.ra=function(){Se(this.g,"a")},Js.prototype.qa=function(y){Se(this.g,new Dd(y))},Js.prototype.pa=function(y){Se(this.g,new Md)},Js.prototype.oa=function(){Se(this.g,"b")},Li.prototype.createWebChannel=Li.prototype.g,ir.prototype.send=ir.prototype.o,ir.prototype.open=ir.prototype.m,ir.prototype.close=ir.prototype.close,qC=function(){return new Li},$C=function(){return Ii()},VC=Tt,gy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},qa.NO_ERROR=0,qa.TIMEOUT=8,qa.HTTP_ERROR=6,ef=qa,bc.COMPLETE="complete",FC=bc,ys.EventType=xt,xt.OPEN="a",xt.CLOSE="b",xt.ERROR="c",xt.MESSAGE="d",oe.prototype.listen=oe.prototype.J,Su=ys,Mt.prototype.listenOnce=Mt.prototype.K,Mt.prototype.getLastError=Mt.prototype.Ha,Mt.prototype.getLastErrorCode=Mt.prototype.ya,Mt.prototype.getStatus=Mt.prototype.ca,Mt.prototype.getResponseJson=Mt.prototype.La,Mt.prototype.getResponseText=Mt.prototype.la,Mt.prototype.send=Mt.prototype.ea,Mt.prototype.setWithCredentials=Mt.prototype.Fa,UC=Mt}).apply(typeof Fh<"u"?Fh:typeof self<"u"?self:typeof window<"u"?window:{});const Dw="@firebase/firestore",Mw="4.9.3";class er{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}er.UNAUTHENTICATED=new er(null),er.GOOGLE_CREDENTIALS=new er("google-credentials-uid"),er.FIRST_PARTY=new er("first-party-uid"),er.MOCK_USER=new er("mock-user");let cc="12.7.0";const ko=new Ky("@firebase/firestore");function Ol(){return ko.logLevel}function Ue(t,...e){if(ko.logLevel<=pt.DEBUG){const n=e.map(a0);ko.debug(`Firestore (${cc}): ${t}`,...n)}}function Ci(t,...e){if(ko.logLevel<=pt.ERROR){const n=e.map(a0);ko.error(`Firestore (${cc}): ${t}`,...n)}}function Gl(t,...e){if(ko.logLevel<=pt.WARN){const n=e.map(a0);ko.warn(`Firestore (${cc}): ${t}`,...n)}}function a0(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Ye(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,HC(t,r,n)}function HC(t,e,n){let r=`FIRESTORE (${cc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Ci(r),new Error(r)}function Rt(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||HC(e,i,r)}function tt(t,e){return t}const je={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Le extends ji{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class bi{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class GC{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class gM{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(er.UNAUTHENTICATED)))}shutdown(){}}class yM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class _M{constructor(e){this.t=e,this.currentUser=er.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Rt(this.o===void 0,42304);let r=this.i;const i=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new bi;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new bi,e.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await i(this.currentUser)}))},d=h=>{Ue("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>d(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?d(h):(Ue("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new bi)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Ue("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Rt(typeof r.accessToken=="string",31837,{l:r}),new GC(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Rt(e===null||typeof e=="string",2055,{h:e}),new er(e)}}class bM{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=er.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class vM{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new bM(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(er.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ow{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class xM{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ls(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Rt(this.o===void 0,3512);const r=o=>{o.error!=null&&Ue("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Ue("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const i=o=>{Ue("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>i(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):Ue("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Ow(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(Rt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Ow(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function wM(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class o0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=wM(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%62))}return r}}function gt(t,e){return t<e?-1:t>e?1:0}function yy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),o=e.charAt(r);if(i!==o)return Fg(i)===Fg(o)?gt(i,o):Fg(i)?1:-1}return gt(t.length,e.length)}const SM=55296,CM=57343;function Fg(t){const e=t.charCodeAt(0);return e>=SM&&e<=CM}function Ql(t,e,n){return t.length===e.length&&t.every(((r,i)=>n(r,e[i])))}const Nw="__name__";class Ls{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ye(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Ye(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Ls.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Ls?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=Ls.compareSegments(e.get(i),n.get(i));if(o!==0)return o}return gt(e.length,n.length)}static compareSegments(e,n){const r=Ls.isNumericId(e),i=Ls.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?Ls.extractNumericId(e).compare(Ls.extractNumericId(n)):yy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Sa.fromString(e.substring(4,e.length-2))}}class Vt extends Ls{construct(e,n,r){return new Vt(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Le(je.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((i=>i.length>0)))}return new Vt(n)}static emptyPath(){return new Vt([])}}const EM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Hn extends Ls{construct(e,n,r){return new Hn(e,n,r)}static isValidIdentifier(e){return EM.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Hn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Nw}static keyField(){return new Hn([Nw])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new Le(je.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;i<e.length;){const d=e[i];if(d==="\\"){if(i+1===e.length)throw new Le(je.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Le(je.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else d==="`"?(l=!l,i++):d!=="."||l?(r+=d,i++):(o(),i++)}if(o(),l)throw new Le(je.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Hn(n)}static emptyPath(){return new Hn([])}}class Qe{constructor(e){this.path=e}static fromPath(e){return new Qe(Vt.fromString(e))}static fromName(e){return new Qe(Vt.fromString(e).popFirst(5))}static empty(){return new Qe(Vt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Vt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Vt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Qe(new Vt(e.slice()))}}function QC(t,e,n){if(!n)throw new Le(je.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function TM(t,e,n,r){if(e===!0&&r===!0)throw new Le(je.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Pw(t){if(!Qe.isDocumentKey(t))throw new Le(je.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function zw(t){if(Qe.isDocumentKey(t))throw new Le(je.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function WC(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Kf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ye(12329,{type:typeof t})}function fs(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Le(je.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Kf(t);throw new Le(je.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function wn(t,e){const n={typeString:t};return e&&(n.value=e),n}function td(t,e){if(!WC(t))throw new Le(je.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(i&&typeof l!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Le(je.INVALID_ARGUMENT,n);return!0}const Bw=-62135596800,Lw=1e6;class Qt{static now(){return Qt.fromMillis(Date.now())}static fromDate(e){return Qt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Lw);return new Qt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Le(je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Le(je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Bw)throw new Le(je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Le(je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Lw}_compareTo(e){return this.seconds===e.seconds?gt(this.nanoseconds,e.nanoseconds):gt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Qt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(td(e,Qt._jsonSchema))return new Qt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Bw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Qt._jsonSchemaVersion="firestore/timestamp/1.0",Qt._jsonSchema={type:wn("string",Qt._jsonSchemaVersion),seconds:wn("number"),nanoseconds:wn("number")};class Je{static fromTimestamp(e){return new Je(e)}static min(){return new Je(new Qt(0,0))}static max(){return new Je(new Qt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Bu=-1;function AM(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Je.fromTimestamp(r===1e9?new Qt(n+1,0):new Qt(n,r));return new Ea(i,Qe.empty(),e)}function jM(t){return new Ea(t.readTime,t.key,Bu)}class Ea{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Ea(Je.min(),Qe.empty(),Bu)}static max(){return new Ea(Je.max(),Qe.empty(),Bu)}}function RM(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Qe.comparator(t.documentKey,e.documentKey),n!==0?n:gt(t.largestBatchId,e.largestBatchId))}const IM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class kM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function uc(t){if(t.code!==je.FAILED_PRECONDITION||t.message!==IM)throw t;Ue("LocalStore","Unexpectedly lost primary lease")}class ke{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ye(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ke(((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof ke?n:ke.resolve(n)}catch(n){return ke.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):ke.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):ke.reject(n)}static resolve(e){return new ke(((n,r)=>{n(e)}))}static reject(e){return new ke(((n,r)=>{r(e)}))}static waitFor(e){return new ke(((n,r)=>{let i=0,o=0,l=!1;e.forEach((d=>{++i,d.next((()=>{++o,l&&o===i&&n()}),(h=>r(h)))})),l=!0,o===i&&n()}))}static or(e){let n=ke.resolve(!1);for(const r of e)n=n.next((i=>i?ke.resolve(i):r()));return n}static forEach(e,n){const r=[];return e.forEach(((i,o)=>{r.push(n.call(this,i,o))})),this.waitFor(r)}static mapArray(e,n){return new ke(((r,i)=>{const o=e.length,l=new Array(o);let d=0;for(let h=0;h<o;h++){const m=h;n(e[m]).next((p=>{l[m]=p,++d,d===o&&r(l)}),(p=>i(p)))}}))}static doWhile(e,n){return new ke(((r,i)=>{const o=()=>{e()===!0?n().next((()=>{o()}),i):r()};o()}))}}function DM(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function dc(t){return t.name==="IndexedDbTransactionError"}class Yf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Yf.ce=-1;const l0=-1;function Xf(t){return t==null}function bf(t){return t===0&&1/t==-1/0}function MM(t){return typeof t=="number"&&Number.isInteger(t)&&!bf(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const KC="";function OM(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Uw(e)),e=NM(t.get(n),e);return Uw(e)}function NM(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case KC:n+="";break;default:n+=o}}return n}function Uw(t){return t+KC+""}function Fw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function za(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function YC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class tn{constructor(e,n){this.comparator=e,this.root=n||Vn.EMPTY}insert(e,n){return new tn(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Vn.BLACK,null,null))}remove(e){return new tn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Vh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Vh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Vh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Vh(this.root,e,this.comparator,!0)}}class Vh{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Vn{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Vn.RED,this.left=i??Vn.EMPTY,this.right=o??Vn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new Vn(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Vn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Vn.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Vn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Vn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ye(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ye(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ye(27949);return e+(this.isRed()?0:1)}}Vn.EMPTY=null,Vn.RED=!0,Vn.BLACK=!1;Vn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ye(57766)}get value(){throw Ye(16141)}get color(){throw Ye(16727)}get left(){throw Ye(29726)}get right(){throw Ye(36894)}copy(e,n,r,i,o){return this}insert(e,n,r){return new Vn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Rn{constructor(e){this.comparator=e,this.data=new tn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Vw(this.data.getIterator())}getIteratorFrom(e){return new Vw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof Rn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new Rn(this.comparator);return n.data=e,n}}class Vw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Rr{constructor(e){this.fields=e,e.sort(Hn.comparator)}static empty(){return new Rr([])}unionWith(e){let n=new Rn(Hn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Rr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Ql(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class XC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Qn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new XC("Invalid base64 string: "+o):o}})(e);return new Qn(n)}static fromUint8Array(e){const n=(function(i){let o="";for(let l=0;l<i.length;++l)o+=String.fromCharCode(i[l]);return o})(e);return new Qn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return gt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qn.EMPTY_BYTE_STRING=new Qn("");const PM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ta(t){if(Rt(!!t,39018),typeof t=="string"){let e=0;const n=PM.exec(t);if(Rt(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:cn(t.seconds),nanos:cn(t.nanos)}}function cn(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Aa(t){return typeof t=="string"?Qn.fromBase64String(t):Qn.fromUint8Array(t)}const ZC="server_timestamp",JC="__type__",eE="__previous_value__",tE="__local_write_time__";function c0(t){return(t?.mapValue?.fields||{})[JC]?.stringValue===ZC}function Zf(t){const e=t.mapValue.fields[eE];return c0(e)?Zf(e):e}function Lu(t){const e=Ta(t.mapValue.fields[tE].timestampValue);return new Qt(e.seconds,e.nanos)}class zM{constructor(e,n,r,i,o,l,d,h,m,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=d,this.longPollingOptions=h,this.useFetchStreams=m,this.isUsingEmulator=p}}const vf="(default)";class Uu{constructor(e,n){this.projectId=e,this.database=n||vf}static empty(){return new Uu("","")}get isDefaultDatabase(){return this.database===vf}isEqual(e){return e instanceof Uu&&e.projectId===this.projectId&&e.database===this.database}}const nE="__type__",BM="__max__",$h={mapValue:{}},rE="__vector__",xf="value";function ja(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?c0(t)?4:UM(t)?9007199254740991:LM(t)?10:11:Ye(28295,{value:t})}function Qs(t,e){if(t===e)return!0;const n=ja(t);if(n!==ja(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Lu(t).isEqual(Lu(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const l=Ta(i.timestampValue),d=Ta(o.timestampValue);return l.seconds===d.seconds&&l.nanos===d.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(i,o){return Aa(i.bytesValue).isEqual(Aa(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(i,o){return cn(i.geoPointValue.latitude)===cn(o.geoPointValue.latitude)&&cn(i.geoPointValue.longitude)===cn(o.geoPointValue.longitude)})(t,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return cn(i.integerValue)===cn(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const l=cn(i.doubleValue),d=cn(o.doubleValue);return l===d?bf(l)===bf(d):isNaN(l)&&isNaN(d)}return!1})(t,e);case 9:return Ql(t.arrayValue.values||[],e.arrayValue.values||[],Qs);case 10:case 11:return(function(i,o){const l=i.mapValue.fields||{},d=o.mapValue.fields||{};if(Fw(l)!==Fw(d))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(d[h]===void 0||!Qs(l[h],d[h])))return!1;return!0})(t,e);default:return Ye(52216,{left:t})}}function Fu(t,e){return(t.values||[]).find((n=>Qs(n,e)))!==void 0}function Wl(t,e){if(t===e)return 0;const n=ja(t),r=ja(e);if(n!==r)return gt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return gt(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const d=cn(o.integerValue||o.doubleValue),h=cn(l.integerValue||l.doubleValue);return d<h?-1:d>h?1:d===h?0:isNaN(d)?isNaN(h)?0:-1:1})(t,e);case 3:return $w(t.timestampValue,e.timestampValue);case 4:return $w(Lu(t),Lu(e));case 5:return yy(t.stringValue,e.stringValue);case 6:return(function(o,l){const d=Aa(o),h=Aa(l);return d.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const d=o.split("/"),h=l.split("/");for(let m=0;m<d.length&&m<h.length;m++){const p=gt(d[m],h[m]);if(p!==0)return p}return gt(d.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const d=gt(cn(o.latitude),cn(l.latitude));return d!==0?d:gt(cn(o.longitude),cn(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return qw(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const d=o.fields||{},h=l.fields||{},m=d[xf]?.arrayValue,p=h[xf]?.arrayValue,g=gt(m?.values?.length||0,p?.values?.length||0);return g!==0?g:qw(m,p)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===$h.mapValue&&l===$h.mapValue)return 0;if(o===$h.mapValue)return 1;if(l===$h.mapValue)return-1;const d=o.fields||{},h=Object.keys(d),m=l.fields||{},p=Object.keys(m);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const v=yy(h[g],p[g]);if(v!==0)return v;const _=Wl(d[h[g]],m[p[g]]);if(_!==0)return _}return gt(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Ye(23264,{he:n})}}function $w(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return gt(t,e);const n=Ta(t),r=Ta(e),i=gt(n.seconds,r.seconds);return i!==0?i:gt(n.nanos,r.nanos)}function qw(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=Wl(n[i],r[i]);if(o)return o}return gt(n.length,r.length)}function Kl(t){return _y(t)}function _y(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=Ta(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return Aa(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return Qe.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=_y(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const l of r)o?o=!1:i+=",",i+=`${l}:${_y(n.fields[l])}`;return i+"}"})(t.mapValue):Ye(61005,{value:t})}function tf(t){switch(ja(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Zf(t);return e?16+tf(e):16;case 5:return 2*t.stringValue.length;case 6:return Aa(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,o)=>i+tf(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let i=0;return za(r.fields,((o,l)=>{i+=o.length+tf(l)})),i})(t.mapValue);default:throw Ye(13486,{value:t})}}function Hw(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function by(t){return!!t&&"integerValue"in t}function u0(t){return!!t&&"arrayValue"in t}function Gw(t){return!!t&&"nullValue"in t}function Qw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function nf(t){return!!t&&"mapValue"in t}function LM(t){return(t?.mapValue?.fields||{})[nE]?.stringValue===rE}function Ru(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return za(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Ru(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ru(t.arrayValue.values[n]);return e}return{...t}}function UM(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===BM}class gr{constructor(e){this.value=e}static empty(){return new gr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!nf(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ru(n)}setAll(e){let n=Hn.emptyPath(),r={},i=[];e.forEach(((l,d)=>{if(!n.isImmediateParentOf(d)){const h=this.getFieldsMap(n);this.applyChanges(h,r,i),r={},i=[],n=d.popLast()}l?r[d.lastSegment()]=Ru(l):i.push(d.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());nf(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Qs(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];nf(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){za(n,((i,o)=>e[i]=o));for(const i of r)delete e[i]}clone(){return new gr(Ru(this.value))}}function sE(t){const e=[];return za(t.fields,((n,r)=>{const i=new Hn([n]);if(nf(r)){const o=sE(r.mapValue).fields;if(o.length===0)e.push(i);else for(const l of o)e.push(i.child(l))}else e.push(i)})),new Rr(e)}class tr{constructor(e,n,r,i,o,l,d){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=l,this.documentState=d}static newInvalidDocument(e){return new tr(e,0,Je.min(),Je.min(),Je.min(),gr.empty(),0)}static newFoundDocument(e,n,r,i){return new tr(e,1,n,Je.min(),r,i,0)}static newNoDocument(e,n){return new tr(e,2,n,Je.min(),Je.min(),gr.empty(),0)}static newUnknownDocument(e,n){return new tr(e,3,n,Je.min(),Je.min(),gr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Je.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=gr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=gr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Je.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof tr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new tr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class wf{constructor(e,n){this.position=e,this.inclusive=n}}function Ww(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],l=t.position[i];if(o.field.isKeyField()?r=Qe.comparator(Qe.fromName(l.referenceValue),n.key):r=Wl(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Kw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Qs(t.position[n],e.position[n]))return!1;return!0}class Sf{constructor(e,n="asc"){this.field=e,this.dir=n}}function FM(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class iE{}class xn extends iE{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new $M(e,n,r):n==="array-contains"?new GM(e,r):n==="in"?new QM(e,r):n==="not-in"?new WM(e,r):n==="array-contains-any"?new KM(e,r):new xn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new qM(e,r):new HM(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Wl(n,this.value)):n!==null&&ja(this.value)===ja(n)&&this.matchesComparison(Wl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ye(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ms extends iE{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ms(e,n)}matches(e){return aE(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function aE(t){return t.op==="and"}function oE(t){return VM(t)&&aE(t)}function VM(t){for(const e of t.filters)if(e instanceof ms)return!1;return!0}function vy(t){if(t instanceof xn)return t.field.canonicalString()+t.op.toString()+Kl(t.value);if(oE(t))return t.filters.map((e=>vy(e))).join(",");{const e=t.filters.map((n=>vy(n))).join(",");return`${t.op}(${e})`}}function lE(t,e){return t instanceof xn?(function(r,i){return i instanceof xn&&r.op===i.op&&r.field.isEqual(i.field)&&Qs(r.value,i.value)})(t,e):t instanceof ms?(function(r,i){return i instanceof ms&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((o,l,d)=>o&&lE(l,i.filters[d])),!0):!1})(t,e):void Ye(19439)}function cE(t){return t instanceof xn?(function(n){return`${n.field.canonicalString()} ${n.op} ${Kl(n.value)}`})(t):t instanceof ms?(function(n){return n.op.toString()+" {"+n.getFilters().map(cE).join(" ,")+"}"})(t):"Filter"}class $M extends xn{constructor(e,n,r){super(e,n,r),this.key=Qe.fromName(r.referenceValue)}matches(e){const n=Qe.comparator(e.key,this.key);return this.matchesComparison(n)}}class qM extends xn{constructor(e,n){super(e,"in",n),this.keys=uE("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class HM extends xn{constructor(e,n){super(e,"not-in",n),this.keys=uE("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function uE(t,e){return(e.arrayValue?.values||[]).map((n=>Qe.fromName(n.referenceValue)))}class GM extends xn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return u0(n)&&Fu(n.arrayValue,this.value)}}class QM extends xn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Fu(this.value.arrayValue,n)}}class WM extends xn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Fu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Fu(this.value.arrayValue,n)}}class KM extends xn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!u0(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Fu(this.value.arrayValue,r)))}}class YM{constructor(e,n=null,r=[],i=[],o=null,l=null,d=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=l,this.endAt=d,this.Te=null}}function Yw(t,e=null,n=[],r=[],i=null,o=null,l=null){return new YM(t,e,n,r,i,o,l)}function d0(t){const e=tt(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>vy(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Xf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>Kl(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>Kl(r))).join(",")),e.Te=n}return e.Te}function h0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!FM(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!lE(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Kw(t.startAt,e.startAt)&&Kw(t.endAt,e.endAt)}function xy(t){return Qe.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class nd{constructor(e,n=null,r=[],i=[],o=null,l="F",d=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=l,this.startAt=d,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function XM(t,e,n,r,i,o,l,d){return new nd(t,e,n,r,i,o,l,d)}function f0(t){return new nd(t)}function Xw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function dE(t){return t.collectionGroup!==null}function Iu(t){const e=tt(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let d=new Rn(Hn.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((m=>{m.isInequality()&&(d=d.add(m.field))}))})),d})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Sf(o,r))})),n.has(Hn.keyField().canonicalString())||e.Ie.push(new Sf(Hn.keyField(),r))}return e.Ie}function $s(t){const e=tt(t);return e.Ee||(e.Ee=ZM(e,Iu(t))),e.Ee}function ZM(t,e){if(t.limitType==="F")return Yw(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((i=>{const o=i.dir==="desc"?"asc":"desc";return new Sf(i.field,o)}));const n=t.endAt?new wf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new wf(t.startAt.position,t.startAt.inclusive):null;return Yw(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function wy(t,e){const n=t.filters.concat([e]);return new nd(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Sy(t,e,n){return new nd(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Jf(t,e){return h0($s(t),$s(e))&&t.limitType===e.limitType}function hE(t){return`${d0($s(t))}|lt:${t.limitType}`}function Nl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((i=>cE(i))).join(", ")}]`),Xf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((i=>Kl(i))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((i=>Kl(i))).join(",")),`Target(${r})`})($s(t))}; limitType=${t.limitType})`}function em(t,e){return e.isFoundDocument()&&(function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):Qe.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,i){for(const o of Iu(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0})(t,e)&&(function(r,i){return!(r.startAt&&!(function(l,d,h){const m=Ww(l,d,h);return l.inclusive?m<=0:m<0})(r.startAt,Iu(r),i)||r.endAt&&!(function(l,d,h){const m=Ww(l,d,h);return l.inclusive?m>=0:m>0})(r.endAt,Iu(r),i))})(t,e)}function JM(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function fE(t){return(e,n)=>{let r=!1;for(const i of Iu(t)){const o=eO(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function eO(t,e,n){const r=t.field.isKeyField()?Qe.comparator(e.key,n.key):(function(o,l,d){const h=l.data.field(o),m=d.data.field(o);return h!==null&&m!==null?Wl(h,m):Ye(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ye(19790,{direction:t.dir})}}class zo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){za(this.inner,((n,r)=>{for(const[i,o]of r)e(i,o)}))}isEmpty(){return YC(this.inner)}size(){return this.innerSize}}const tO=new tn(Qe.comparator);function Ei(){return tO}const mE=new tn(Qe.comparator);function Cu(...t){let e=mE;for(const n of t)e=e.insert(n.key,n);return e}function pE(t){let e=mE;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function wo(){return ku()}function gE(){return ku()}function ku(){return new zo((t=>t.toString()),((t,e)=>t.isEqual(e)))}const nO=new tn(Qe.comparator),rO=new Rn(Qe.comparator);function yt(...t){let e=rO;for(const n of t)e=e.add(n);return e}const sO=new Rn(gt);function iO(){return sO}function m0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bf(e)?"-0":e}}function yE(t){return{integerValue:""+t}}function aO(t,e){return MM(e)?yE(e):m0(t,e)}class tm{constructor(){this._=void 0}}function oO(t,e,n){return t instanceof Cf?(function(i,o){const l={fields:{[JC]:{stringValue:ZC},[tE]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&c0(o)&&(o=Zf(o)),o&&(l.fields[eE]=o),{mapValue:l}})(n,e):t instanceof Yl?bE(t,e):t instanceof Xl?vE(t,e):(function(i,o){const l=_E(i,o),d=Zw(l)+Zw(i.Ae);return by(l)&&by(i.Ae)?yE(d):m0(i.serializer,d)})(t,e)}function lO(t,e,n){return t instanceof Yl?bE(t,e):t instanceof Xl?vE(t,e):n}function _E(t,e){return t instanceof Ef?(function(r){return by(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class Cf extends tm{}class Yl extends tm{constructor(e){super(),this.elements=e}}function bE(t,e){const n=xE(e);for(const r of t.elements)n.some((i=>Qs(i,r)))||n.push(r);return{arrayValue:{values:n}}}class Xl extends tm{constructor(e){super(),this.elements=e}}function vE(t,e){let n=xE(e);for(const r of t.elements)n=n.filter((i=>!Qs(i,r)));return{arrayValue:{values:n}}}class Ef extends tm{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function Zw(t){return cn(t.integerValue||t.doubleValue)}function xE(t){return u0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class wE{constructor(e,n){this.field=e,this.transform=n}}function cO(t,e){return t.field.isEqual(e.field)&&(function(r,i){return r instanceof Yl&&i instanceof Yl||r instanceof Xl&&i instanceof Xl?Ql(r.elements,i.elements,Qs):r instanceof Ef&&i instanceof Ef?Qs(r.Ae,i.Ae):r instanceof Cf&&i instanceof Cf})(t.transform,e.transform)}class uO{constructor(e,n){this.version=e,this.transformResults=n}}class _r{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new _r}static exists(e){return new _r(void 0,e)}static updateTime(e){return new _r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rf(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class nm{}function SE(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new rm(t.key,_r.none()):new rd(t.key,t.data,_r.none());{const n=t.data,r=gr.empty();let i=new Rn(Hn.comparator);for(let o of e.fields)if(!i.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),i=i.add(o)}return new Ba(t.key,r,new Rr(i.toArray()),_r.none())}}function dO(t,e,n){t instanceof rd?(function(i,o,l){const d=i.value.clone(),h=e1(i.fieldTransforms,o,l.transformResults);d.setAll(h),o.convertToFoundDocument(l.version,d).setHasCommittedMutations()})(t,e,n):t instanceof Ba?(function(i,o,l){if(!rf(i.precondition,o))return void o.convertToUnknownDocument(l.version);const d=e1(i.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(CE(i)),h.setAll(d),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(i,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function Du(t,e,n,r){return t instanceof rd?(function(o,l,d,h){if(!rf(o.precondition,l))return d;const m=o.value.clone(),p=t1(o.fieldTransforms,h,l);return m.setAll(p),l.convertToFoundDocument(l.version,m).setHasLocalMutations(),null})(t,e,n,r):t instanceof Ba?(function(o,l,d,h){if(!rf(o.precondition,l))return d;const m=t1(o.fieldTransforms,h,l),p=l.data;return p.setAll(CE(o)),p.setAll(m),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),d===null?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,l,d){return rf(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):d})(t,e,n)}function hO(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=_E(r.transform,i||null);o!=null&&(n===null&&(n=gr.empty()),n.set(r.field,o))}return n||null}function Jw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Ql(r,i,((o,l)=>cO(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class rd extends nm{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ba extends nm{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function CE(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function e1(t,e,n){const r=new Map;Rt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const o=t[i],l=o.transform,d=e.data.field(o.field);r.set(o.field,lO(l,d,n[i]))}return r}function t1(t,e,n){const r=new Map;for(const i of t){const o=i.transform,l=n.data.field(i.field);r.set(i.field,oO(o,l,e))}return r}class rm extends nm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class fO extends nm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class mO{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&dO(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Du(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Du(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=gE();return this.mutations.forEach((i=>{const o=e.get(i.key),l=o.overlayedDocument;let d=this.applyToLocalView(l,o.mutatedFields);d=n.has(i.key)?null:d;const h=SE(l,d);h!==null&&r.set(i.key,h),l.isValidDocument()||l.convertToNoDocument(Je.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),yt())}isEqual(e){return this.batchId===e.batchId&&Ql(this.mutations,e.mutations,((n,r)=>Jw(n,r)))&&Ql(this.baseMutations,e.baseMutations,((n,r)=>Jw(n,r)))}}class p0{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){Rt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return nO})();const o=e.mutations;for(let l=0;l<o.length;l++)i=i.insert(o[l].key,r[l].version);return new p0(e,n,r,i)}}class pO{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class gO{constructor(e,n){this.count=e,this.unchangedNames=n}}var vn,vt;function yO(t){switch(t){case je.OK:return Ye(64938);case je.CANCELLED:case je.UNKNOWN:case je.DEADLINE_EXCEEDED:case je.RESOURCE_EXHAUSTED:case je.INTERNAL:case je.UNAVAILABLE:case je.UNAUTHENTICATED:return!1;case je.INVALID_ARGUMENT:case je.NOT_FOUND:case je.ALREADY_EXISTS:case je.PERMISSION_DENIED:case je.FAILED_PRECONDITION:case je.ABORTED:case je.OUT_OF_RANGE:case je.UNIMPLEMENTED:case je.DATA_LOSS:return!0;default:return Ye(15467,{code:t})}}function EE(t){if(t===void 0)return Ci("GRPC error has no .code"),je.UNKNOWN;switch(t){case vn.OK:return je.OK;case vn.CANCELLED:return je.CANCELLED;case vn.UNKNOWN:return je.UNKNOWN;case vn.DEADLINE_EXCEEDED:return je.DEADLINE_EXCEEDED;case vn.RESOURCE_EXHAUSTED:return je.RESOURCE_EXHAUSTED;case vn.INTERNAL:return je.INTERNAL;case vn.UNAVAILABLE:return je.UNAVAILABLE;case vn.UNAUTHENTICATED:return je.UNAUTHENTICATED;case vn.INVALID_ARGUMENT:return je.INVALID_ARGUMENT;case vn.NOT_FOUND:return je.NOT_FOUND;case vn.ALREADY_EXISTS:return je.ALREADY_EXISTS;case vn.PERMISSION_DENIED:return je.PERMISSION_DENIED;case vn.FAILED_PRECONDITION:return je.FAILED_PRECONDITION;case vn.ABORTED:return je.ABORTED;case vn.OUT_OF_RANGE:return je.OUT_OF_RANGE;case vn.UNIMPLEMENTED:return je.UNIMPLEMENTED;case vn.DATA_LOSS:return je.DATA_LOSS;default:return Ye(39323,{code:t})}}(vt=vn||(vn={}))[vt.OK=0]="OK",vt[vt.CANCELLED=1]="CANCELLED",vt[vt.UNKNOWN=2]="UNKNOWN",vt[vt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",vt[vt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",vt[vt.NOT_FOUND=5]="NOT_FOUND",vt[vt.ALREADY_EXISTS=6]="ALREADY_EXISTS",vt[vt.PERMISSION_DENIED=7]="PERMISSION_DENIED",vt[vt.UNAUTHENTICATED=16]="UNAUTHENTICATED",vt[vt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",vt[vt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",vt[vt.ABORTED=10]="ABORTED",vt[vt.OUT_OF_RANGE=11]="OUT_OF_RANGE",vt[vt.UNIMPLEMENTED=12]="UNIMPLEMENTED",vt[vt.INTERNAL=13]="INTERNAL",vt[vt.UNAVAILABLE=14]="UNAVAILABLE",vt[vt.DATA_LOSS=15]="DATA_LOSS";function _O(){return new TextEncoder}const bO=new Sa([4294967295,4294967295],0);function n1(t){const e=_O().encode(t),n=new LC;return n.update(e),new Uint8Array(n.digest())}function r1(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Sa([n,r],0),new Sa([i,o],0)]}class g0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Eu(`Invalid padding: ${n}`);if(r<0)throw new Eu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Eu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Eu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=Sa.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(Sa.fromNumber(r)));return i.compare(bO)===1&&(i=new Sa([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=n1(e),[r,i]=r1(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new g0(o,i,n);return r.forEach((d=>l.insert(d))),l}insert(e){if(this.ge===0)return;const n=n1(e),[r,i]=r1(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Eu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class sm{constructor(e,n,r,i,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,sd.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new sm(Je.min(),i,new tn(gt),Ei(),yt())}}class sd{constructor(e,n,r,i,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new sd(r,n,yt(),yt(),yt())}}class sf{constructor(e,n,r,i){this.be=e,this.removedTargetIds=n,this.key=r,this.De=i}}class TE{constructor(e,n){this.targetId=e,this.Ce=n}}class AE{constructor(e,n,r=Qn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class s1{constructor(){this.ve=0,this.Fe=i1(),this.Me=Qn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=yt(),n=yt(),r=yt();return this.Fe.forEach(((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Ye(38017,{changeType:o})}})),new sd(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=i1()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Rt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class vO{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ei(),this.Je=qh(),this.He=qh(),this.Ye=new tn(gt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Ye(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,i)=>{this.rt(i)&&n(i)}))}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const o=i.target;if(xy(o))if(r===0){const l=new Qe(o.path);this.et(n,l,tr.newNoDocument(l,Je.min()))}else Rt(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const d=this.ut(e),h=d?this.ct(d,e,l):1;if(h!==0){this.it(n);const m=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,m)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let l,d;try{l=Aa(r).toUint8Array()}catch(h){if(h instanceof XC)return Gl("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{d=new g0(l,i,o)}catch(h){return Gl(h instanceof Eu?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return d.ge===0?null:d}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach((o=>{const l=this.Ge.ht(),d=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.et(n,o,null),i++)})),i}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const d=this.ot(l);if(d){if(o.current&&xy(d.target)){const h=new Qe(d.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,tr.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=yt();this.He.forEach(((o,l)=>{let d=!0;l.forEachWhile((h=>{const m=this.ot(h);return!m||m.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const i=new sm(e,n,this.Ye,this.je,r);return this.je=Ei(),this.Je=qh(),this.He=qh(),this.Ye=new tn(gt),i}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.Qe(n,1):i.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new s1,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new Rn(gt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new Rn(gt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Ue("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new s1),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function qh(){return new tn(Qe.comparator)}function i1(){return new tn(Qe.comparator)}const xO={asc:"ASCENDING",desc:"DESCENDING"},wO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},SO={and:"AND",or:"OR"};class CO{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Cy(t,e){return t.useProto3Json||Xf(e)?e:{value:e}}function Tf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function jE(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function EO(t,e){return Tf(t,e.toTimestamp())}function qs(t){return Rt(!!t,49232),Je.fromTimestamp((function(n){const r=Ta(n);return new Qt(r.seconds,r.nanos)})(t))}function y0(t,e){return Ey(t,e).canonicalString()}function Ey(t,e){const n=(function(i){return new Vt(["projects",i.projectId,"databases",i.database])})(t).child("documents");return e===void 0?n:n.child(e)}function RE(t){const e=Vt.fromString(t);return Rt(OE(e),10190,{key:e.toString()}),e}function Ty(t,e){return y0(t.databaseId,e.path)}function Vg(t,e){const n=RE(e);if(n.get(1)!==t.databaseId.projectId)throw new Le(je.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Le(je.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Qe(kE(n))}function IE(t,e){return y0(t.databaseId,e)}function TO(t){const e=RE(t);return e.length===4?Vt.emptyPath():kE(e)}function Ay(t){return new Vt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function kE(t){return Rt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function a1(t,e,n){return{name:Ty(t,e),fields:n.value.mapValue.fields}}function AO(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:Ye(39313,{state:m})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(m,p){return m.useProto3Json?(Rt(p===void 0||typeof p=="string",58123),Qn.fromBase64String(p||"")):(Rt(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Qn.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,d=l&&(function(m){const p=m.code===void 0?je.UNKNOWN:EE(m.code);return new Le(p,m.message||"")})(l);n=new AE(r,i,o,d||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Vg(t,r.document.name),o=qs(r.document.updateTime),l=r.document.createTime?qs(r.document.createTime):Je.min(),d=new gr({mapValue:{fields:r.document.fields}}),h=tr.newFoundDocument(i,o,l,d),m=r.targetIds||[],p=r.removedTargetIds||[];n=new sf(m,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Vg(t,r.document),o=r.readTime?qs(r.readTime):Je.min(),l=tr.newNoDocument(i,o),d=r.removedTargetIds||[];n=new sf([],d,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Vg(t,r.document),o=r.removedTargetIds||[];n=new sf([],o,i,null)}else{if(!("filter"in e))return Ye(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,l=new gO(i,o),d=r.targetId;n=new TE(d,l)}}return n}function jO(t,e){let n;if(e instanceof rd)n={update:a1(t,e.key,e.value)};else if(e instanceof rm)n={delete:Ty(t,e.key)};else if(e instanceof Ba)n={update:a1(t,e.key,e.data),updateMask:zO(e.fieldMask)};else{if(!(e instanceof fO))return Ye(16599,{Vt:e.type});n={verify:Ty(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const d=l.transform;if(d instanceof Cf)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Yl)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof Xl)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof Ef)return{fieldPath:l.field.canonicalString(),increment:d.Ae};throw Ye(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:EO(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Ye(27497)})(t,e.precondition)),n}function RO(t,e){return t&&t.length>0?(Rt(e!==void 0,14353),t.map((n=>(function(i,o){let l=i.updateTime?qs(i.updateTime):qs(o);return l.isEqual(Je.min())&&(l=qs(o)),new uO(l,i.transformResults||[])})(n,e)))):[]}function IO(t,e){return{documents:[IE(t,e.path)]}}function kO(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=IE(t,i);const o=(function(m){if(m.length!==0)return ME(ms.create(m,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(m){if(m.length!==0)return m.map((p=>(function(v){return{field:Pl(v.field),direction:OO(v.dir)}})(p)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const d=Cy(t,e.limit);return d!==null&&(n.structuredQuery.limit=d),e.startAt&&(n.structuredQuery.startAt=(function(m){return{before:m.inclusive,values:m.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(m){return{before:!m.inclusive,values:m.position}})(e.endAt)),{ft:n,parent:i}}function DO(t){let e=TO(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Rt(r===1,65062);const p=n.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const v=DE(g);return v instanceof ms&&oE(v)?v.getFilters():[v]})(n.where));let l=[];n.orderBy&&(l=(function(g){return g.map((v=>(function(C){return new Sf(zl(C.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(C.direction))})(v)))})(n.orderBy));let d=null;n.limit&&(d=(function(g){let v;return v=typeof g=="object"?g.value:g,Xf(v)?null:v})(n.limit));let h=null;n.startAt&&(h=(function(g){const v=!!g.before,_=g.values||[];return new wf(_,v)})(n.startAt));let m=null;return n.endAt&&(m=(function(g){const v=!g.before,_=g.values||[];return new wf(_,v)})(n.endAt)),XM(e,i,l,o,d,"F",h,m)}function MO(t,e){const n=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ye(28987,{purpose:i})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function DE(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=zl(n.unaryFilter.field);return xn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=zl(n.unaryFilter.field);return xn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=zl(n.unaryFilter.field);return xn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=zl(n.unaryFilter.field);return xn.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ye(61313);default:return Ye(60726)}})(t):t.fieldFilter!==void 0?(function(n){return xn.create(zl(n.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ye(58110);default:return Ye(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return ms.create(n.compositeFilter.filters.map((r=>DE(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ye(1026)}})(n.compositeFilter.op))})(t):Ye(30097,{filter:t})}function OO(t){return xO[t]}function NO(t){return wO[t]}function PO(t){return SO[t]}function Pl(t){return{fieldPath:t.canonicalString()}}function zl(t){return Hn.fromServerFormat(t.fieldPath)}function ME(t){return t instanceof xn?(function(n){if(n.op==="=="){if(Qw(n.value))return{unaryFilter:{field:Pl(n.field),op:"IS_NAN"}};if(Gw(n.value))return{unaryFilter:{field:Pl(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Qw(n.value))return{unaryFilter:{field:Pl(n.field),op:"IS_NOT_NAN"}};if(Gw(n.value))return{unaryFilter:{field:Pl(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Pl(n.field),op:NO(n.op),value:n.value}}})(t):t instanceof ms?(function(n){const r=n.getFilters().map((i=>ME(i)));return r.length===1?r[0]:{compositeFilter:{op:PO(n.op),filters:r}}})(t):Ye(54877,{filter:t})}function zO(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function OE(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class ma{constructor(e,n,r,i,o=Je.min(),l=Je.min(),d=Qn.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=d,this.expectedCount=h}withSequenceNumber(e){return new ma(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ma(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ma(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ma(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class BO{constructor(e){this.yt=e}}function LO(t){const e=DO({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Sy(e,e.limit,"L"):e}class UO{constructor(){this.Cn=new FO}addToCollectionParentIndex(e,n){return this.Cn.add(n),ke.resolve()}getCollectionParents(e,n){return ke.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return ke.resolve()}deleteFieldIndex(e,n){return ke.resolve()}deleteAllFieldIndexes(e){return ke.resolve()}createTargetIndexes(e,n){return ke.resolve()}getDocumentsMatchingTarget(e,n){return ke.resolve(null)}getIndexType(e,n){return ke.resolve(0)}getFieldIndexes(e,n){return ke.resolve([])}getNextCollectionGroupToUpdate(e){return ke.resolve(null)}getMinOffset(e,n){return ke.resolve(Ea.min())}getMinOffsetFromCollectionGroup(e,n){return ke.resolve(Ea.min())}updateCollectionGroup(e,n,r){return ke.resolve()}updateIndexEntries(e,n){return ke.resolve()}}class FO{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new Rn(Vt.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Rn(Vt.comparator)).toArray()}}const o1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},NE=41943040;class pr{static withCacheSize(e){return new pr(e,pr.DEFAULT_COLLECTION_PERCENTILE,pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}pr.DEFAULT_COLLECTION_PERCENTILE=10,pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pr.DEFAULT=new pr(NE,pr.DEFAULT_COLLECTION_PERCENTILE,pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pr.DISABLED=new pr(-1,0,0);class Zl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Zl(0)}static cr(){return new Zl(-1)}}const l1="LruGarbageCollector",VO=1048576;function c1([t,e],[n,r]){const i=gt(t,n);return i===0?gt(e,r):i}class $O{constructor(e){this.Ir=e,this.buffer=new Rn(c1),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();c1(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class qO{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ue(l1,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){dc(n)?Ue(l1,"Ignoring IndexedDB error during garbage collection: ",n):await uc(n)}await this.Vr(3e5)}))}}class HO{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return ke.resolve(Yf.ce);const r=new $O(n);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Ue("LruGarbageCollector","Garbage collection skipped; disabled"),ke.resolve(o1)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Ue("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),o1):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,o,l,d,h,m;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Ue("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,l=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,d=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(m=Date.now(),Ol()<=pt.DEBUG&&Ue("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-p}ms
	Determined least recently used ${i} in `+(d-l)+`ms
	Removed ${o} targets in `+(h-d)+`ms
	Removed ${g} documents in `+(m-h)+`ms
Total Duration: ${m-p}ms`),ke.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:g}))))}}function GO(t,e){return new HO(t,e)}class QO{constructor(){this.changes=new zo((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,tr.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ke.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class WO{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class KO{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,n)))).next((i=>(r!==null&&Du(r.mutation,i,Rr.empty(),Qt.now()),i)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,yt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=yt()){const i=wo();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,r).next((o=>{let l=Cu();return o.forEach(((d,h)=>{l=l.insert(d,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=wo();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,yt())))}populateOverlays(e,n,r){const i=[];return r.forEach((o=>{n.has(o)||i.push(o)})),this.documentOverlayCache.getOverlays(e,i).next((o=>{o.forEach(((l,d)=>{n.set(l,d)}))}))}computeViews(e,n,r,i){let o=Ei();const l=ku(),d=(function(){return ku()})();return n.forEach(((h,m)=>{const p=r.get(m.key);i.has(m.key)&&(p===void 0||p.mutation instanceof Ba)?o=o.insert(m.key,m):p!==void 0?(l.set(m.key,p.mutation.getFieldMask()),Du(p.mutation,m,p.mutation.getFieldMask(),Qt.now())):l.set(m.key,Rr.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((m,p)=>l.set(m,p))),n.forEach(((m,p)=>d.set(m,new WO(p,l.get(m)??null)))),d)))}recalculateAndSaveOverlays(e,n){const r=ku();let i=new tn(((l,d)=>l-d)),o=yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const d of l)d.keys().forEach((h=>{const m=n.get(h);if(m===null)return;let p=r.get(h)||Rr.empty();p=d.applyToLocalView(m,p),r.set(h,p);const g=(i.get(d.batchId)||yt()).add(h);i=i.insert(d.batchId,g)}))})).next((()=>{const l=[],d=i.getReverseIterator();for(;d.hasNext();){const h=d.getNext(),m=h.key,p=h.value,g=gE();p.forEach((v=>{if(!o.has(v)){const _=SE(n.get(v),r.get(v));_!==null&&g.set(v,_),o=o.add(v)}})),l.push(this.documentOverlayCache.saveOverlays(e,m,g))}return ke.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,i){return(function(l){return Qe.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):dE(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next((o=>{const l=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):ke.resolve(wo());let d=Bu,h=o;return l.next((m=>ke.forEach(m,((p,g)=>(d<g.largestBatchId&&(d=g.largestBatchId),o.get(p)?ke.resolve():this.remoteDocumentCache.getEntry(e,p).next((v=>{h=h.insert(p,v)}))))).next((()=>this.populateOverlays(e,m,o))).next((()=>this.computeViews(e,h,m,yt()))).next((p=>({batchId:d,changes:pE(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Qe(n)).next((r=>{let i=Cu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let l=Cu();return this.indexManager.getCollectionParents(e,o).next((d=>ke.forEach(d,(h=>{const m=(function(g,v){return new nd(v,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,r,i).next((p=>{p.forEach(((g,v)=>{l=l.insert(g,v)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i)))).next((l=>{o.forEach(((h,m)=>{const p=m.getKey();l.get(p)===null&&(l=l.insert(p,tr.newInvalidDocument(p)))}));let d=Cu();return l.forEach(((h,m)=>{const p=o.get(h);p!==void 0&&Du(p.mutation,m,Rr.empty(),Qt.now()),em(n,m)&&(d=d.insert(h,m))})),d}))}}class YO{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return ke.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(i){return{id:i.id,version:i.version,createTime:qs(i.createTime)}})(n)),ke.resolve()}getNamedQuery(e,n){return ke.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(i){return{name:i.name,query:LO(i.bundledQuery),readTime:qs(i.readTime)}})(n)),ke.resolve()}}class XO{constructor(){this.overlays=new tn(Qe.comparator),this.qr=new Map}getOverlay(e,n){return ke.resolve(this.overlays.get(n))}getOverlays(e,n){const r=wo();return ke.forEach(n,(i=>this.getOverlay(e,i).next((o=>{o!==null&&r.set(i,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((i,o)=>{this.St(e,n,o)})),ke.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),ke.resolve()}getOverlaysForCollection(e,n,r){const i=wo(),o=n.length+1,l=new Qe(n.child("")),d=this.overlays.getIteratorFrom(l);for(;d.hasNext();){const h=d.getNext().value,m=h.getKey();if(!n.isPrefixOf(m.path))break;m.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return ke.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new tn(((m,p)=>m-p));const l=this.overlays.getIterator();for(;l.hasNext();){const m=l.getNext().value;if(m.getKey().getCollectionGroup()===n&&m.largestBatchId>r){let p=o.get(m.largestBatchId);p===null&&(p=wo(),o=o.insert(m.largestBatchId,p)),p.set(m.getKey(),m)}}const d=wo(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((m,p)=>d.set(m,p))),!(d.size()>=i)););return ke.resolve(d)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const l=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new pO(n,r));let o=this.qr.get(n);o===void 0&&(o=yt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class ZO{constructor(){this.sessionToken=Qn.EMPTY_BYTE_STRING}getSessionToken(e){return ke.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ke.resolve()}}class _0{constructor(){this.Qr=new Rn(On.$r),this.Ur=new Rn(On.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new On(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new On(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new Qe(new Vt([])),r=new On(n,e),i=new On(n,e+1),o=[];return this.Ur.forEachInRange([r,i],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Qe(new Vt([])),r=new On(n,e),i=new On(n,e+1);let o=yt();return this.Ur.forEachInRange([r,i],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new On(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class On{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Qe.comparator(e.key,n.key)||gt(e.Yr,n.Yr)}static Kr(e,n){return gt(e.Yr,n.Yr)||Qe.comparator(e.key,n.key)}}class JO{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new Rn(On.$r)}checkEmpty(e){return ke.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new mO(o,n,r,i);this.mutationQueue.push(l);for(const d of i)this.Zr=this.Zr.add(new On(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return ke.resolve(l)}lookupMutationBatch(e,n){return ke.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),o=i<0?0:i;return ke.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return ke.resolve(this.mutationQueue.length===0?l0:this.tr-1)}getAllMutationBatches(e){return ke.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new On(n,0),i=new On(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],(l=>{const d=this.Xr(l.Yr);o.push(d)})),ke.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Rn(gt);return n.forEach((i=>{const o=new On(i,0),l=new On(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(d=>{r=r.add(d.Yr)}))})),ke.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;Qe.isDocumentKey(o)||(o=o.child(""));const l=new On(new Qe(o),0);let d=new Rn(gt);return this.Zr.forEachWhile((h=>{const m=h.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(d=d.add(h.Yr)),!0)}),l),ke.resolve(this.ti(d))}ti(e){const n=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&n.push(i)})),n}removeMutationBatch(e,n){Rt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return ke.forEach(n.mutations,(i=>{const o=new On(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new On(n,0),i=this.Zr.firstAfterOrEqual(r);return ke.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ke.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class eN{constructor(e){this.ri=e,this.docs=(function(){return new tn(Qe.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ke.resolve(r?r.document.mutableCopy():tr.newInvalidDocument(n))}getEntries(e,n){let r=Ei();return n.forEach((i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():tr.newInvalidDocument(i))})),ke.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=Ei();const l=n.path,d=new Qe(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(d);for(;h.hasNext();){const{key:m,value:{document:p}}=h.getNext();if(!l.isPrefixOf(m.path))break;m.path.length>l.length+1||RM(jM(p),r)<=0||(i.has(p.key)||em(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return ke.resolve(o)}getAllFromCollectionGroup(e,n,r,i){Ye(9500)}ii(e,n){return ke.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new tN(this)}getSize(e){return ke.resolve(this.size)}}class tN extends QO{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),ke.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class nN{constructor(e){this.persistence=e,this.si=new zo((n=>d0(n)),h0),this.lastRemoteSnapshotVersion=Je.min(),this.highestTargetId=0,this.oi=0,this._i=new _0,this.targetCount=0,this.ai=Zl.ur()}forEachTarget(e,n){return this.si.forEach(((r,i)=>n(i))),ke.resolve()}getLastRemoteSnapshotVersion(e){return ke.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ke.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ke.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),ke.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Zl(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,ke.resolve()}updateTargetData(e,n){return this.Pr(n),ke.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,ke.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.si.forEach(((l,d)=>{d.sequenceNumber<=n&&r.get(d.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)})),ke.waitFor(o).next((()=>i))}getTargetCount(e){return ke.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return ke.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),ke.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach((l=>{o.push(i.markPotentiallyOrphaned(e,l))})),ke.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),ke.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return ke.resolve(r)}containsKey(e,n){return ke.resolve(this._i.containsKey(n))}}class PE{constructor(e,n){this.ui={},this.overlays={},this.ci=new Yf(0),this.li=!1,this.li=!0,this.hi=new ZO,this.referenceDelegate=e(this),this.Pi=new nN(this),this.indexManager=new UO,this.remoteDocumentCache=(function(i){return new eN(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new BO(n),this.Ii=new YO(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new XO,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new JO(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Ue("MemoryPersistence","Starting transaction:",e);const i=new rN(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((o=>this.referenceDelegate.di(i).next((()=>o)))).toPromise().then((o=>(i.raiseOnCommittedEvent(),o)))}Ai(e,n){return ke.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class rN extends kM{constructor(e){super(),this.currentSequenceNumber=e}}class b0{constructor(e){this.persistence=e,this.Ri=new _0,this.Vi=null}static mi(e){return new b0(e)}get fi(){if(this.Vi)return this.Vi;throw Ye(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),ke.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),ke.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),ke.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((i=>{i.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ke.forEach(this.fi,(r=>{const i=Qe.fromPath(r);return this.gi(e,i).next((o=>{o||n.removeEntry(i,Je.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return ke.or([()=>ke.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Af{constructor(e,n){this.persistence=e,this.pi=new zo((r=>OM(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=GO(this,n)}static mi(e,n){return new Af(e,n)}Ei(){}di(e){return ke.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((i=>r+i))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return ke.forEach(this.pi,((r,i)=>this.br(e,r,i).next((o=>o?ke.resolve():n(i)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,(l=>this.br(e,l,n).next((d=>{d||(r++,o.removeEntry(l,Je.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ke.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ke.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=tf(e.data.value)),n}br(e,n,r){return ke.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return ke.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class v0{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=yt(),i=yt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new v0(e,n.fromCache,r,i)}}class sN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class iN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return MR()?8:DM(nr())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,i,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new sN;return this.Ss(e,n,l).next((d=>{if(o.result=d,this.Vs)return this.bs(e,n,l,d.size)}))})).next((()=>o.result))}bs(e,n,r,i){return r.documentReadCount<this.fs?(Ol()<=pt.DEBUG&&Ue("QueryEngine","SDK will not create cache indexes for query:",Nl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ke.resolve()):(Ol()<=pt.DEBUG&&Ue("QueryEngine","Query:",Nl(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Ol()<=pt.DEBUG&&Ue("QueryEngine","The SDK decides to create cache indexes for query:",Nl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$s(n))):ke.resolve())}ys(e,n){if(Xw(n))return ke.resolve(null);let r=$s(n);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(n.limit!==null&&i===1&&(n=Sy(n,null,"F"),r=$s(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=yt(...o);return this.ps.getDocuments(e,l).next((d=>this.indexManager.getMinOffset(e,r).next((h=>{const m=this.Ds(n,d);return this.Cs(n,m,l,h.readTime)?this.ys(e,Sy(n,null,"F")):this.vs(e,m,n,h)}))))})))))}ws(e,n,r,i){return Xw(n)||i.isEqual(Je.min())?ke.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,i)?ke.resolve(null):(Ol()<=pt.DEBUG&&Ue("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Nl(n)),this.vs(e,l,n,AM(i,Bu)).next((d=>d)))}))}Ds(e,n){let r=new Rn(fE(e));return n.forEach(((i,o)=>{em(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,n,r){return Ol()<=pt.DEBUG&&Ue("QueryEngine","Using full collection scan to execute query:",Nl(n)),this.ps.getDocumentsMatchingQuery(e,n,Ea.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const x0="LocalStore",aN=3e8;class oN{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new tn(gt),this.xs=new zo((o=>d0(o)),h0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new KO(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function lN(t,e,n,r){return new oN(t,e,n,r)}async function zE(t,e){const n=tt(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next((o=>(i=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],d=[];let h=yt();for(const m of i){l.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}for(const m of o){d.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((m=>({Ls:m,removedBatchIds:l,addedBatchIds:d})))}))}))}function cN(t,e){const n=tt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,h,m,p){const g=m.batch,v=g.keys();let _=ke.resolve();return v.forEach((C=>{_=_.next((()=>p.getEntry(h,C))).next((x=>{const S=m.docVersions.get(C);Rt(S!==null,48541),x.version.compareTo(S)<0&&(g.applyToRemoteDocument(x,m),x.isValidDocument()&&(x.setReadTime(m.commitVersion),p.addEntry(x)))}))})),_.next((()=>d.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(d){let h=yt();for(let m=0;m<d.mutationResults.length;++m)d.mutationResults[m].transformResults.length>0&&(h=h.add(d.batch.mutations[m].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,i)))}))}function BE(t){const e=tt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function uN(t,e){const n=tt(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const d=[];e.targetChanges.forEach(((p,g)=>{const v=i.get(g);if(!v)return;d.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let _=v.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?_=_.withResumeToken(Qn.EMPTY_BYTE_STRING,Je.min()).withLastLimboFreeSnapshotVersion(Je.min()):p.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(p.resumeToken,r)),i=i.insert(g,_),(function(x,S,E){return x.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=aN?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0})(v,_,p)&&d.push(n.Pi.updateTargetData(o,_))}));let h=Ei(),m=yt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&d.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),d.push(dN(o,l,e.documentUpdates).next((p=>{h=p.ks,m=p.qs}))),!r.isEqual(Je.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));d.push(p)}return ke.waitFor(d).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,m))).next((()=>h))})).then((o=>(n.Ms=i,o)))}function dN(t,e,n){let r=yt(),i=yt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=Ei();return n.forEach(((d,h)=>{const m=o.get(d);h.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(d)),h.isNoDocument()&&h.version.isEqual(Je.min())?(e.removeEntry(d,h.readTime),l=l.insert(d,h)):!m.isValidDocument()||h.version.compareTo(m.version)>0||h.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(h),l=l.insert(d,h)):Ue(x0,"Ignoring outdated watch update for ",d,". Current version:",m.version," Watch version:",h.version)})),{ks:l,qs:i}}))}function hN(t,e){const n=tt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=l0),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function fN(t,e){const n=tt(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return n.Pi.getTargetData(r,e).next((o=>o?(i=o,ke.resolve(i)):n.Pi.allocateTargetId(r).next((l=>(i=new ma(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=n.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function jy(t,e,n){const r=tt(t),i=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!dc(l))throw l;Ue(x0,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function u1(t,e,n){const r=tt(t);let i=Je.min(),o=yt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,m,p){const g=tt(h),v=g.xs.get(p);return v!==void 0?ke.resolve(g.Ms.get(v)):g.Pi.getTargetData(m,p)})(r,l,$s(e)).next((d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,d.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?i:Je.min(),n?o:yt()))).next((d=>(mN(r,JM(e),d),{documents:d,Qs:o})))))}function mN(t,e,n){let r=t.Os.get(e)||Je.min();n.forEach(((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class d1{constructor(){this.activeTargetIds=iO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class pN{constructor(){this.Mo=new d1,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new d1,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class gN{Oo(e){}shutdown(){}}const h1="ConnectivityMonitor";class f1{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ue(h1,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ue(h1,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Hh=null;function Ry(){return Hh===null?Hh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Hh++,"0x"+Hh.toString(16)}const $g="RestConnection",yN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class _N{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===vf?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,o){const l=Ry(),d=this.zo(e,n.toUriEncodedString());Ue($g,`Sending RPC '${e}' ${l}:`,d,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);const{host:m}=new URL(d),p=sc(m);return this.Jo(e,d,h,r,p).then((g=>(Ue($g,`Received RPC '${e}' ${l}: `,g),g)),(g=>{throw Gl($g,`RPC '${e}' ${l} failed with error: `,g,"url: ",d,"request:",r),g}))}Ho(e,n,r,i,o,l){return this.Go(e,n,r,i,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+cc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((i,o)=>e[o]=i)),r&&r.headers.forEach(((i,o)=>e[o]=i))}zo(e,n){const r=yN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class bN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Jn="WebChannelConnection";class vN extends _N{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,o){const l=Ry();return new Promise(((d,h)=>{const m=new UC;m.setWithCredentials(!0),m.listenOnce(FC.COMPLETE,(()=>{try{switch(m.getLastErrorCode()){case ef.NO_ERROR:const g=m.getResponseJson();Ue(Jn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),d(g);break;case ef.TIMEOUT:Ue(Jn,`RPC '${e}' ${l} timed out`),h(new Le(je.DEADLINE_EXCEEDED,"Request time out"));break;case ef.HTTP_ERROR:const v=m.getStatus();if(Ue(Jn,`RPC '${e}' ${l} failed with status:`,v,"response text:",m.getResponseText()),v>0){let _=m.getResponseJson();Array.isArray(_)&&(_=_[0]);const C=_?.error;if(C&&C.status&&C.message){const x=(function(E){const T=E.toLowerCase().replace(/_/g,"-");return Object.values(je).indexOf(T)>=0?T:je.UNKNOWN})(C.status);h(new Le(x,C.message))}else h(new Le(je.UNKNOWN,"Server responded with status "+m.getStatus()))}else h(new Le(je.UNAVAILABLE,"Connection failed."));break;default:Ye(9055,{l_:e,streamId:l,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{Ue(Jn,`RPC '${e}' ${l} completed.`)}}));const p=JSON.stringify(i);Ue(Jn,`RPC '${e}' ${l} sending request:`,i),m.send(n,"POST",p,r,15)}))}T_(e,n,r){const i=Ry(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=qC(),d=$C(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(h.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");Ue(Jn,`Creating RPC '${e}' stream ${i}: ${p}`,h);const g=l.createWebChannel(p,h);this.I_(g);let v=!1,_=!1;const C=new bN({Yo:S=>{_?Ue(Jn,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(v||(Ue(Jn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),v=!0),Ue(Jn,`RPC '${e}' stream ${i} sending:`,S),g.send(S))},Zo:()=>g.close()}),x=(S,E,T)=>{S.listen(E,(I=>{try{T(I)}catch(D){setTimeout((()=>{throw D}),0)}}))};return x(g,Su.EventType.OPEN,(()=>{_||(Ue(Jn,`RPC '${e}' stream ${i} transport opened.`),C.o_())})),x(g,Su.EventType.CLOSE,(()=>{_||(_=!0,Ue(Jn,`RPC '${e}' stream ${i} transport closed`),C.a_(),this.E_(g))})),x(g,Su.EventType.ERROR,(S=>{_||(_=!0,Gl(Jn,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),C.a_(new Le(je.UNAVAILABLE,"The operation could not be completed")))})),x(g,Su.EventType.MESSAGE,(S=>{if(!_){const E=S.data[0];Rt(!!E,16349);const T=E,I=T?.error||T[0]?.error;if(I){Ue(Jn,`RPC '${e}' stream ${i} received error:`,I);const D=I.status;let B=(function(O){const N=vn[O];if(N!==void 0)return EE(N)})(D),$=I.message;B===void 0&&(B=je.INTERNAL,$="Unknown error status: "+D+" with message "+I.message),_=!0,C.a_(new Le(B,$)),g.close()}else Ue(Jn,`RPC '${e}' stream ${i} received:`,E),C.u_(E)}})),x(d,VC.STAT_EVENT,(S=>{S.stat===gy.PROXY?Ue(Jn,`RPC '${e}' stream ${i} detected buffering proxy`):S.stat===gy.NOPROXY&&Ue(Jn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{C.__()}),0),C}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function qg(){return typeof document<"u"?document:null}function im(t){return new CO(t,!0)}class LE{constructor(e,n,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&Ue("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const m1="PersistentStream";class UE{constructor(e,n,r,i,o,l,d,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=d,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new LE(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===je.RESOURCE_EXHAUSTED?(Ci(n.toString()),Ci("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===je.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===n&&this.G_(r,i)}),(r=>{e((()=>{const i=new Le(je.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ue(m1,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Ue(m1,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class xN extends UE{constructor(e,n,r,i,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=AO(this.serializer,e),r=(function(o){if(!("targetChange"in o))return Je.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?Je.min():l.readTime?qs(l.readTime):Je.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Ay(this.serializer),n.addTarget=(function(o,l){let d;const h=l.target;if(d=xy(h)?{documents:IO(o,h)}:{query:kO(o,h).ft},d.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){d.resumeToken=jE(o,l.resumeToken);const m=Cy(o,l.expectedCount);m!==null&&(d.expectedCount=m)}else if(l.snapshotVersion.compareTo(Je.min())>0){d.readTime=Tf(o,l.snapshotVersion.toTimestamp());const m=Cy(o,l.expectedCount);m!==null&&(d.expectedCount=m)}return d})(this.serializer,e);const r=MO(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Ay(this.serializer),n.removeTarget=e,this.q_(n)}}class wN extends UE{constructor(e,n,r,i,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return Rt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Rt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Rt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=RO(e.writeResults,e.commitTime),r=qs(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Ay(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>jO(this.serializer,r)))};this.q_(n)}}class SN{}class CN extends SN{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Le(je.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,Ey(n,r),i,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Le(je.UNKNOWN,o.toString())}))}Ho(e,n,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,d])=>this.connection.Ho(e,Ey(n,r),i,l,d,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Le(je.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class EN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ci(n),this.aa=!1):Ue("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Do="RemoteStore";class TN{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{Bo(this)&&(Ue(Do,"Restarting streams for network reachability change."),await(async function(h){const m=tt(h);m.Ea.add(4),await id(m),m.Ra.set("Unknown"),m.Ea.delete(4),await am(m)})(this))}))})),this.Ra=new EN(r,i)}}async function am(t){if(Bo(t))for(const e of t.da)await e(!0)}async function id(t){for(const e of t.da)await e(!1)}function FE(t,e){const n=tt(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),E0(n)?C0(n):hc(n).O_()&&S0(n,e))}function w0(t,e){const n=tt(t),r=hc(n);n.Ia.delete(e),r.O_()&&VE(n,e),n.Ia.size===0&&(r.O_()?r.L_():Bo(n)&&n.Ra.set("Unknown"))}function S0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Je.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}hc(t).Y_(e)}function VE(t,e){t.Va.Ue(e),hc(t).Z_(e)}function C0(t){t.Va=new vO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),hc(t).start(),t.Ra.ua()}function E0(t){return Bo(t)&&!hc(t).x_()&&t.Ia.size>0}function Bo(t){return tt(t).Ea.size===0}function $E(t){t.Va=void 0}async function AN(t){t.Ra.set("Online")}async function jN(t){t.Ia.forEach(((e,n)=>{S0(t,e)}))}async function RN(t,e){$E(t),E0(t)?(t.Ra.ha(e),C0(t)):t.Ra.set("Unknown")}async function IN(t,e,n){if(t.Ra.set("Online"),e instanceof AE&&e.state===2&&e.cause)try{await(async function(i,o){const l=o.cause;for(const d of o.targetIds)i.Ia.has(d)&&(await i.remoteSyncer.rejectListen(d,l),i.Ia.delete(d),i.Va.removeTarget(d))})(t,e)}catch(r){Ue(Do,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await jf(t,r)}else if(e instanceof sf?t.Va.Ze(e):e instanceof TE?t.Va.st(e):t.Va.tt(e),!n.isEqual(Je.min()))try{const r=await BE(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const d=o.Va.Tt(l);return d.targetChanges.forEach(((h,m)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(m);p&&o.Ia.set(m,p.withResumeToken(h.resumeToken,l))}})),d.targetMismatches.forEach(((h,m)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Qn.EMPTY_BYTE_STRING,p.snapshotVersion)),VE(o,h);const g=new ma(p.target,h,m,p.sequenceNumber);S0(o,g)})),o.remoteSyncer.applyRemoteEvent(d)})(t,n)}catch(r){Ue(Do,"Failed to raise snapshot:",r),await jf(t,r)}}async function jf(t,e,n){if(!dc(e))throw e;t.Ea.add(1),await id(t),t.Ra.set("Offline"),n||(n=()=>BE(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ue(Do,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await am(t)}))}function qE(t,e){return e().catch((n=>jf(t,n,e)))}async function om(t){const e=tt(t),n=Ra(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:l0;for(;kN(e);)try{const i=await hN(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,DN(e,i)}catch(i){await jf(e,i)}HE(e)&&GE(e)}function kN(t){return Bo(t)&&t.Ta.length<10}function DN(t,e){t.Ta.push(e);const n=Ra(t);n.O_()&&n.X_&&n.ea(e.mutations)}function HE(t){return Bo(t)&&!Ra(t).x_()&&t.Ta.length>0}function GE(t){Ra(t).start()}async function MN(t){Ra(t).ra()}async function ON(t){const e=Ra(t);for(const n of t.Ta)e.ea(n.mutations)}async function NN(t,e,n){const r=t.Ta.shift(),i=p0.from(r,e,n);await qE(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await om(t)}async function PN(t,e){e&&Ra(t).X_&&await(async function(r,i){if((function(l){return yO(l)&&l!==je.ABORTED})(i.code)){const o=r.Ta.shift();Ra(r).B_(),await qE(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i))),await om(r)}})(t,e),HE(t)&&GE(t)}async function p1(t,e){const n=tt(t);n.asyncQueue.verifyOperationInProgress(),Ue(Do,"RemoteStore received new credentials");const r=Bo(n);n.Ea.add(3),await id(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await am(n)}async function zN(t,e){const n=tt(t);e?(n.Ea.delete(2),await am(n)):e||(n.Ea.add(2),await id(n),n.Ra.set("Unknown"))}function hc(t){return t.ma||(t.ma=(function(n,r,i){const o=tt(n);return o.sa(),new xN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:AN.bind(null,t),t_:jN.bind(null,t),r_:RN.bind(null,t),H_:IN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),E0(t)?C0(t):t.Ra.set("Unknown")):(await t.ma.stop(),$E(t))}))),t.ma}function Ra(t){return t.fa||(t.fa=(function(n,r,i){const o=tt(n);return o.sa(),new wN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:MN.bind(null,t),r_:PN.bind(null,t),ta:ON.bind(null,t),na:NN.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await om(t)):(await t.fa.stop(),t.Ta.length>0&&(Ue(Do,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class T0{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new bi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const l=Date.now()+r,d=new T0(e,n,l,i,o);return d.start(r),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Le(je.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function A0(t,e){if(Ci("AsyncQueue",`${e}: ${t}`),dc(t))return new Le(je.UNAVAILABLE,`${e}: ${t}`);throw t}class Vl{static emptySet(e){return new Vl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Qe.comparator(n.key,r.key):(n,r)=>Qe.comparator(n.key,r.key),this.keyedMap=Cu(),this.sortedSet=new tn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Vl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Vl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class g1{constructor(){this.ga=new tn(Qe.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Ye(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class Jl{constructor(e,n,r,i,o,l,d,h,m){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=d,this.excludesMetadataChanges=h,this.hasCachedResults=m}static fromInitialDocuments(e,n,r,i,o){const l=[];return n.forEach((d=>{l.push({type:0,doc:d})})),new Jl(e,n,Vl.emptySet(n),l,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Jf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}class BN{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class LN{constructor(){this.queries=y1(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=tt(n),o=i.queries;i.queries=y1(),o.forEach(((l,d)=>{for(const h of d.Sa)h.onError(r)}))})(this,new Le(je.ABORTED,"Firestore shutting down"))}}function y1(){return new zo((t=>hE(t)),Jf)}async function QE(t,e){const n=tt(t);let r=3;const i=e.query;let o=n.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new BN,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(i,!0);break;case 1:o.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(l){const d=A0(l,`Initialization of query '${Nl(e.query)}' failed`);return void e.onError(d)}n.queries.set(i,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&j0(n)}async function WE(t,e){const n=tt(t),r=e.query;let i=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function UN(t,e){const n=tt(t);let r=!1;for(const i of e){const o=i.query,l=n.queries.get(o);if(l){for(const d of l.Sa)d.Fa(i)&&(r=!0);l.wa=i}}r&&j0(n)}function FN(t,e,n){const r=tt(t),i=r.queries.get(e);if(i)for(const o of i.Sa)o.onError(n);r.queries.delete(e)}function j0(t){t.Ca.forEach((e=>{e.next()}))}var Iy,_1;(_1=Iy||(Iy={})).Ma="default",_1.Cache="cache";class KE{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Jl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Jl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Iy.Cache}}class YE{constructor(e){this.key=e}}class XE{constructor(e){this.key=e}}class VN{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=yt(),this.mutatedKeys=yt(),this.eu=fE(e),this.tu=new Vl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new g1,i=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=i,d=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,m=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((p,g)=>{const v=i.get(p),_=em(this.query,g)?g:null,C=!!v&&this.mutatedKeys.has(v.key),x=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let S=!1;v&&_?v.data.isEqual(_.data)?C!==x&&(r.track({type:3,doc:_}),S=!0):this.su(v,_)||(r.track({type:2,doc:_}),S=!0,(h&&this.eu(_,h)>0||m&&this.eu(_,m)<0)&&(d=!0)):!v&&_?(r.track({type:0,doc:_}),S=!0):v&&!_&&(r.track({type:1,doc:v}),S=!0,(h||m)&&(d=!0)),S&&(_?(l=l.add(_),o=x?o.add(p):o.delete(p)):(l=l.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const p=this.query.limitType==="F"?l.last():l.first();l=l.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:l,iu:r,Cs:d,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((p,g)=>(function(_,C){const x=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ye(20277,{Rt:S})}};return x(_)-x(C)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),i=i??!1;const d=n&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,m=h!==this.Za;return this.Za=h,l.length!==0||m?{snapshot:new Jl(this.query,e.tu,o,l,e.mutatedKeys,h===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new g1,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=yt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new XE(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new YE(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=yt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Jl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const R0="SyncEngine";class $N{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class qN{constructor(e){this.key=e,this.hu=!1}}class HN{constructor(e,n,r,i,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new zo((d=>hE(d)),Jf),this.Iu=new Map,this.Eu=new Set,this.du=new tn(Qe.comparator),this.Au=new Map,this.Ru=new _0,this.Vu={},this.mu=new Map,this.fu=Zl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function GN(t,e,n=!0){const r=rT(t);let i;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await ZE(r,e,n,!0),i}async function QN(t,e){const n=rT(t);await ZE(n,e,!0,!1)}async function ZE(t,e,n,r){const i=await fN(t.localStore,$s(e)),o=i.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let d;return r&&(d=await WN(t,e,o,l==="current",i.resumeToken)),t.isPrimaryClient&&n&&FE(t.remoteStore,i),d}async function WN(t,e,n,r,i){t.pu=(g,v,_)=>(async function(x,S,E,T){let I=S.view.ru(E);I.Cs&&(I=await u1(x.localStore,S.query,!1).then((({documents:M})=>S.view.ru(M,I))));const D=T&&T.targetChanges.get(S.targetId),B=T&&T.targetMismatches.get(S.targetId)!=null,$=S.view.applyChanges(I,x.isPrimaryClient,D,B);return v1(x,S.targetId,$.au),$.snapshot})(t,g,v,_);const o=await u1(t.localStore,e,!0),l=new VN(e,o.Qs),d=l.ru(o.documents),h=sd.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),m=l.applyChanges(d,t.isPrimaryClient,h);v1(t,n,m.au);const p=new $N(e,n,l);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),m.snapshot}async function KN(t,e,n){const r=tt(t),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter((l=>!Jf(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await jy(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&w0(r.remoteStore,i.targetId),ky(r,i.targetId)})).catch(uc)):(ky(r,i.targetId),await jy(r.localStore,i.targetId,!0))}async function YN(t,e){const n=tt(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),w0(n.remoteStore,r.targetId))}async function XN(t,e,n){const r=s6(t);try{const i=await(function(l,d){const h=tt(l),m=Qt.now(),p=d.reduce(((_,C)=>_.add(C.key)),yt());let g,v;return h.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let C=Ei(),x=yt();return h.Ns.getEntries(_,p).next((S=>{C=S,C.forEach(((E,T)=>{T.isValidDocument()||(x=x.add(E))}))})).next((()=>h.localDocuments.getOverlayedDocuments(_,C))).next((S=>{g=S;const E=[];for(const T of d){const I=hO(T,g.get(T.key).overlayedDocument);I!=null&&E.push(new Ba(T.key,I,sE(I.value.mapValue),_r.exists(!0)))}return h.mutationQueue.addMutationBatch(_,m,E,d)})).next((S=>{v=S;const E=S.applyToLocalDocumentSet(g,x);return h.documentOverlayCache.saveOverlays(_,S.batchId,E)}))})).then((()=>({batchId:v.batchId,changes:pE(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(l,d,h){let m=l.Vu[l.currentUser.toKey()];m||(m=new tn(gt)),m=m.insert(d,h),l.Vu[l.currentUser.toKey()]=m})(r,i.batchId,n),await ad(r,i.changes),await om(r.remoteStore)}catch(i){const o=A0(i,"Failed to persist write");n.reject(o)}}async function JE(t,e){const n=tt(t);try{const r=await uN(n.localStore,e);e.targetChanges.forEach(((i,o)=>{const l=n.Au.get(o);l&&(Rt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?l.hu=!0:i.modifiedDocuments.size>0?Rt(l.hu,14607):i.removedDocuments.size>0&&(Rt(l.hu,42227),l.hu=!1))})),await ad(n,r,e)}catch(r){await uc(r)}}function b1(t,e,n){const r=tt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach(((o,l)=>{const d=l.view.va(e);d.snapshot&&i.push(d.snapshot)})),(function(l,d){const h=tt(l);h.onlineState=d;let m=!1;h.queries.forEach(((p,g)=>{for(const v of g.Sa)v.va(d)&&(m=!0)})),m&&j0(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function ZN(t,e,n){const r=tt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),o=i&&i.key;if(o){let l=new tn(Qe.comparator);l=l.insert(o,tr.newNoDocument(o,Je.min()));const d=yt().add(o),h=new sm(Je.min(),new Map,new tn(gt),l,d);await JE(r,h),r.du=r.du.remove(o),r.Au.delete(e),I0(r)}else await jy(r.localStore,e,!1).then((()=>ky(r,e,n))).catch(uc)}async function JN(t,e){const n=tt(t),r=e.batch.batchId;try{const i=await cN(n.localStore,e);tT(n,r,null),eT(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await ad(n,i)}catch(i){await uc(i)}}async function e6(t,e,n){const r=tt(t);try{const i=await(function(l,d){const h=tt(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(m=>{let p;return h.mutationQueue.lookupMutationBatch(m,d).next((g=>(Rt(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(m,g)))).next((()=>h.mutationQueue.performConsistencyCheck(m))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(m,p,d))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,p))).next((()=>h.localDocuments.getDocuments(m,p)))}))})(r.localStore,e);tT(r,e,n),eT(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await ad(r,i)}catch(i){await uc(i)}}function eT(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function tT(t,e,n){const r=tt(t);let i=r.Vu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function ky(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||nT(t,r)}))}function nT(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(w0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),I0(t))}function v1(t,e,n){for(const r of n)r instanceof YE?(t.Ru.addReference(r.key,e),t6(t,r)):r instanceof XE?(Ue(R0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||nT(t,r.key)):Ye(19791,{wu:r})}function t6(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Ue(R0,"New document in limbo: "+n),t.Eu.add(r),I0(t))}function I0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Qe(Vt.fromString(e)),r=t.fu.next();t.Au.set(r,new qN(n)),t.du=t.du.insert(n,r),FE(t.remoteStore,new ma($s(f0(n.path)),r,"TargetPurposeLimboResolution",Yf.ce))}}async function ad(t,e,n){const r=tt(t),i=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((d,h)=>{l.push(r.pu(h,e,n).then((m=>{if((m||n)&&r.isPrimaryClient){const p=m?!m.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(m){i.push(m);const p=v0.As(h.targetId,m);o.push(p)}})))})),await Promise.all(l),r.Pu.H_(i),await(async function(h,m){const p=tt(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>ke.forEach(m,(v=>ke.forEach(v.Es,(_=>p.persistence.referenceDelegate.addReference(g,v.targetId,_))).next((()=>ke.forEach(v.ds,(_=>p.persistence.referenceDelegate.removeReference(g,v.targetId,_)))))))))}catch(g){if(!dc(g))throw g;Ue(x0,"Failed to update sequence numbers: "+g)}for(const g of m){const v=g.targetId;if(!g.fromCache){const _=p.Ms.get(v),C=_.snapshotVersion,x=_.withLastLimboFreeSnapshotVersion(C);p.Ms=p.Ms.insert(v,x)}}})(r.localStore,o))}async function n6(t,e){const n=tt(t);if(!n.currentUser.isEqual(e)){Ue(R0,"User change. New user:",e.toKey());const r=await zE(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((d=>{d.forEach((h=>{h.reject(new Le(je.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await ad(n,r.Ls)}}function r6(t,e){const n=tt(t),r=n.Au.get(e);if(r&&r.hu)return yt().add(r.key);{let i=yt();const o=n.Iu.get(e);if(!o)return i;for(const l of o){const d=n.Tu.get(l);i=i.unionWith(d.view.nu)}return i}}function rT(t){const e=tt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=JE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=r6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ZN.bind(null,e),e.Pu.H_=UN.bind(null,e.eventManager),e.Pu.yu=FN.bind(null,e.eventManager),e}function s6(t){const e=tt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=JN.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=e6.bind(null,e),e}class Rf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=im(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return lN(this.persistence,new iN,e.initialUser,this.serializer)}Cu(e){return new PE(b0.mi,this.serializer)}Du(e){return new pN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Rf.provider={build:()=>new Rf};class i6 extends Rf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Rt(this.persistence.referenceDelegate instanceof Af,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new qO(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?pr.withCacheSize(this.cacheSizeBytes):pr.DEFAULT;return new PE((r=>Af.mi(r,n)),this.serializer)}}class Dy{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>b1(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=n6.bind(null,this.syncEngine),await zN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new LN})()}createDatastore(e){const n=im(e.databaseInfo.databaseId),r=(function(o){return new vN(o)})(e.databaseInfo);return(function(o,l,d,h){return new CN(o,l,d,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,i,o,l,d){return new TN(r,i,o,l,d)})(this.localStore,this.datastore,e.asyncQueue,(n=>b1(this.syncEngine,n,0)),(function(){return f1.v()?new f1:new gN})())}createSyncEngine(e,n){return(function(i,o,l,d,h,m,p){const g=new HN(i,o,l,d,h,m);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=tt(n);Ue(Do,"RemoteStore shutting down."),r.Ea.add(5),await id(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Dy.provider={build:()=>new Dy};class sT{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ci("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const Ia="FirestoreClient";class a6{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=er.UNAUTHENTICATED,this.clientId=o0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{Ue(Ia,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(Ue(Ia,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new bi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=A0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Hg(t,e){t.asyncQueue.verifyOperationInProgress(),Ue(Ia,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async i=>{r.isEqual(i)||(await zE(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function x1(t,e){t.asyncQueue.verifyOperationInProgress();const n=await o6(t);Ue(Ia,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>p1(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,i)=>p1(e.remoteStore,i))),t._onlineComponents=e}async function o6(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ue(Ia,"Using user provided OfflineComponentProvider");try{await Hg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(i){return i.name==="FirebaseError"?i.code===je.FAILED_PRECONDITION||i.code===je.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(n))throw n;Gl("Error using user provided cache. Falling back to memory cache: "+n),await Hg(t,new Rf)}}else Ue(Ia,"Using default OfflineComponentProvider"),await Hg(t,new i6(void 0));return t._offlineComponents}async function iT(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ue(Ia,"Using user provided OnlineComponentProvider"),await x1(t,t._uninitializedComponentsProvider._online)):(Ue(Ia,"Using default OnlineComponentProvider"),await x1(t,new Dy))),t._onlineComponents}function l6(t){return iT(t).then((e=>e.syncEngine))}async function aT(t){const e=await iT(t),n=e.eventManager;return n.onListen=GN.bind(null,e.syncEngine),n.onUnlisten=KN.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=QN.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=YN.bind(null,e.syncEngine),n}function c6(t,e,n={}){const r=new bi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,m){const p=new sT({next:v=>{p.Nu(),l.enqueueAndForget((()=>WE(o,g)));const _=v.docs.has(d);!_&&v.fromCache?m.reject(new Le(je.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&v.fromCache&&h&&h.source==="server"?m.reject(new Le(je.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(v)},error:v=>m.reject(v)}),g=new KE(f0(d.path),p,{includeMetadataChanges:!0,qa:!0});return QE(o,g)})(await aT(t),t.asyncQueue,e,n,r))),r.promise}function u6(t,e,n={}){const r=new bi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,m){const p=new sT({next:v=>{p.Nu(),l.enqueueAndForget((()=>WE(o,g))),v.fromCache&&h.source==="server"?m.reject(new Le(je.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(v)},error:v=>m.reject(v)}),g=new KE(d,p,{includeMetadataChanges:!0,qa:!0});return QE(o,g)})(await aT(t),t.asyncQueue,e,n,r))),r.promise}function oT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const w1=new Map;const lT="firestore.googleapis.com",S1=!0;class C1{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Le(je.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=lT,this.ssl=S1}else this.host=e.host,this.ssl=e.ssl??S1;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=NE;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<VO)throw new Le(je.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}TM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=oT(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Le(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Le(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Le(je.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lm{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new C1({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Le(je.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Le(je.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new C1(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new gM;switch(r.type){case"firstParty":return new vM(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Le(je.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=w1.get(n);r&&(Ue("ComponentProvider","Removing Datastore"),w1.delete(n),r.terminate())})(this),Promise.resolve()}}function d6(t,e,n,r={}){t=fs(t,lm);const i=sc(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},d=`${e}:${n}`;i&&(XS(`https://${d}`),ZS("Firestore",!0)),o.host!==lT&&o.host!==d&&Gl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:d,ssl:i,emulatorOptions:r};if(!xi(h,l)&&(t._setSettings(h),r.mockUserToken)){let m,p;if(typeof r.mockUserToken=="string")m=r.mockUserToken,p=er.MOCK_USER;else{m=CR(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Le(je.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new er(g)}t._authCredentials=new yM(new GC(m,p))}}class fc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new fc(this.firestore,e,this._query)}}class dn{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ca(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new dn(this.firestore,e,this._key)}toJSON(){return{type:dn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(td(n,dn._jsonSchema))return new dn(e,r||null,new Qe(Vt.fromString(n.referencePath)))}}dn._jsonSchemaVersion="firestore/documentReference/1.0",dn._jsonSchema={type:wn("string",dn._jsonSchemaVersion),referencePath:wn("string")};class Ca extends fc{constructor(e,n,r){super(e,n,f0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new dn(this.firestore,null,new Qe(e))}withConverter(e){return new Ca(this.firestore,e,this._path)}}function h6(t,e,...n){if(t=Sn(t),QC("collection","path",e),t instanceof lm){const r=Vt.fromString(e,...n);return zw(r),new Ca(t,null,r)}{if(!(t instanceof dn||t instanceof Ca))throw new Le(je.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Vt.fromString(e,...n));return zw(r),new Ca(t.firestore,null,r)}}function mc(t,e,...n){if(t=Sn(t),arguments.length===1&&(e=o0.newId()),QC("doc","path",e),t instanceof lm){const r=Vt.fromString(e,...n);return Pw(r),new dn(t,null,new Qe(r))}{if(!(t instanceof dn||t instanceof Ca))throw new Le(je.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Vt.fromString(e,...n));return Pw(r),new dn(t.firestore,t instanceof Ca?t.converter:null,new Qe(r))}}const E1="AsyncQueue";class T1{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new LE(this,"async_queue_retry"),this._c=()=>{const r=qg();r&&Ue(E1,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=qg();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=qg();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new bi;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!dc(e))throw e;Ue(E1,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Ci("INTERNAL UNHANDLED ERROR: ",A1(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=T0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(i),i}uc(){this.nc&&Ye(47125,{Pc:A1(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function A1(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Lo extends lm{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new T1,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new T1(e),this._firestoreClient=void 0,await e}}}function f6(t,e){const n=typeof t=="object"?t:nC(),r=typeof t=="string"?t:vf,i=Xy(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=wR("firestore");o&&d6(i,...o)}return i}function cm(t){if(t._terminated)throw new Le(je.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||m6(t),t._firestoreClient}function m6(t){const e=t._freezeSettings(),n=(function(i,o,l,d){return new zM(i,o,l,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,oT(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new a6(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(i){const o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(t._componentsProvider))}class Qr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Qr(Qn.fromBase64String(e))}catch(n){throw new Le(je.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Qr(Qn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Qr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(td(e,Qr._jsonSchema))return Qr.fromBase64String(e.bytes)}}Qr._jsonSchemaVersion="firestore/bytes/1.0",Qr._jsonSchema={type:wn("string",Qr._jsonSchemaVersion),bytes:wn("string")};class od{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Le(je.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Hn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ld{constructor(e){this._methodName=e}}class Hs{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Le(je.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Le(je.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return gt(this._lat,e._lat)||gt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Hs._jsonSchemaVersion}}static fromJSON(e){if(td(e,Hs._jsonSchema))return new Hs(e.latitude,e.longitude)}}Hs._jsonSchemaVersion="firestore/geoPoint/1.0",Hs._jsonSchema={type:wn("string",Hs._jsonSchemaVersion),latitude:wn("number"),longitude:wn("number")};class Gs{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Gs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(td(e,Gs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Gs(e.vectorValues);throw new Le(je.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Gs._jsonSchemaVersion="firestore/vectorValue/1.0",Gs._jsonSchema={type:wn("string",Gs._jsonSchemaVersion),vectorValues:wn("object")};const p6=/^__.*__$/;class g6{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Ba(e,this.data,this.fieldMask,n,this.fieldTransforms):new rd(e,this.data,n,this.fieldTransforms)}}class cT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Ba(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function uT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ye(40011,{Ac:t})}}class um{constructor(e,n,r,i,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new um({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return If(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(uT(this.Ac)&&p6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class y6{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||im(e)}Cc(e,n,r,i=!1){return new um({Ac:e,methodName:n,Dc:r,path:Hn.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function dm(t){const e=t._freezeSettings(),n=im(t._databaseId);return new y6(t._databaseId,!!e.ignoreUndefinedProperties,n)}function dT(t,e,n,r,i,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,i);M0("Data must be an object, but it was:",l,r);const d=pT(r,l);let h,m;if(o.merge)h=new Rr(l.fieldMask),m=l.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const v=My(e,g,n);if(!l.contains(v))throw new Le(je.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);yT(p,v)||p.push(v)}h=new Rr(p),m=l.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,m=l.fieldTransforms;return new g6(new gr(d),h,m)}class hm extends ld{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof hm}}function hT(t,e,n){return new um({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class k0 extends ld{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=hT(this,e,!0),r=this.vc.map((o=>Uo(o,n))),i=new Yl(r);return new wE(e.path,i)}isEqual(e){return e instanceof k0&&xi(this.vc,e.vc)}}class D0 extends ld{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=hT(this,e,!0),r=this.vc.map((o=>Uo(o,n))),i=new Xl(r);return new wE(e.path,i)}isEqual(e){return e instanceof D0&&xi(this.vc,e.vc)}}function fT(t,e,n,r){const i=t.Cc(1,e,n);M0("Data must be an object, but it was:",i,r);const o=[],l=gr.empty();za(r,((h,m)=>{const p=O0(e,h,n);m=Sn(m);const g=i.yc(p);if(m instanceof hm)o.push(p);else{const v=Uo(m,g);v!=null&&(o.push(p),l.set(p,v))}}));const d=new Rr(o);return new cT(l,d,i.fieldTransforms)}function mT(t,e,n,r,i,o){const l=t.Cc(1,e,n),d=[My(e,r,n)],h=[i];if(o.length%2!=0)throw new Le(je.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)d.push(My(e,o[v])),h.push(o[v+1]);const m=[],p=gr.empty();for(let v=d.length-1;v>=0;--v)if(!yT(m,d[v])){const _=d[v];let C=h[v];C=Sn(C);const x=l.yc(_);if(C instanceof hm)m.push(_);else{const S=Uo(C,x);S!=null&&(m.push(_),p.set(_,S))}}const g=new Rr(m);return new cT(p,g,l.fieldTransforms)}function _6(t,e,n,r=!1){return Uo(n,t.Cc(r?4:3,e))}function Uo(t,e){if(gT(t=Sn(t)))return M0("Unsupported field value:",e,t),pT(t,e);if(t instanceof ld)return(function(r,i){if(!uT(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const o=[];let l=0;for(const d of r){let h=Uo(d,i.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,i){if((r=Sn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return aO(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Qt.fromDate(r);return{timestampValue:Tf(i.serializer,o)}}if(r instanceof Qt){const o=new Qt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Tf(i.serializer,o)}}if(r instanceof Hs)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Qr)return{bytesValue:jE(i.serializer,r._byteString)};if(r instanceof dn){const o=i.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw i.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:y0(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Gs)return(function(l,d){return{mapValue:{fields:{[nE]:{stringValue:rE},[xf]:{arrayValue:{values:l.toArray().map((m=>{if(typeof m!="number")throw d.Sc("VectorValues must only contain numeric values.");return m0(d.serializer,m)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Kf(r)}`)})(t,e)}function pT(t,e){const n={};return YC(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):za(t,((r,i)=>{const o=Uo(i,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function gT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Qt||t instanceof Hs||t instanceof Qr||t instanceof dn||t instanceof ld||t instanceof Gs)}function M0(t,e,n){if(!gT(n)||!WC(n)){const r=Kf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function My(t,e,n){if((e=Sn(e))instanceof od)return e._internalPath;if(typeof e=="string")return O0(t,e);throw If("Field path arguments must be of type string or ",t,!1,void 0,n)}const b6=new RegExp("[~\\*/\\[\\]]");function O0(t,e,n){if(e.search(b6)>=0)throw If(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new od(...e.split("."))._internalPath}catch{throw If(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function If(t,e,n,r,i){const o=r&&!r.isEmpty(),l=i!==void 0;let d=`Function ${e}() called with invalid data`;n&&(d+=" (via `toFirestore()`)"),d+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${i}`),h+=")"),new Le(je.INVALID_ARGUMENT,d+t+h)}function yT(t,e){return t.some((n=>n.isEqual(e)))}class _T{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new dn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new v6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(N0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class v6 extends _T{data(){return super.data()}}function N0(t,e){return typeof e=="string"?O0(t,e):e instanceof od?e._internalPath:e._delegate._internalPath}function x6(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Le(je.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class P0{}class w6 extends P0{}function S6(t,e,...n){let r=[];e instanceof P0&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof z0)).length,d=o.filter((h=>h instanceof fm)).length;if(l>1||l>0&&d>0)throw new Le(je.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)t=i._apply(t);return t}class fm extends w6{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new fm(e,n,r)}_apply(e){const n=this._parse(e);return bT(e._query,n),new fc(e.firestore,e.converter,wy(e._query,n))}_parse(e){const n=dm(e.firestore);return(function(o,l,d,h,m,p,g){let v;if(m.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Le(je.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){R1(g,p);const C=[];for(const x of g)C.push(j1(h,o,x));v={arrayValue:{values:C}}}else v=j1(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||R1(g,p),v=_6(d,l,g,p==="in"||p==="not-in");return xn.create(m,p,v)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function C6(t,e,n){const r=e,i=N0("where",t);return fm._create(i,r,n)}class z0 extends P0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new z0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:ms.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(i,o){let l=i;const d=o.getFlattenedFilters();for(const h of d)bT(l,h),l=wy(l,h)})(e._query,n),new fc(e.firestore,e.converter,wy(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function j1(t,e,n){if(typeof(n=Sn(n))=="string"){if(n==="")throw new Le(je.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!dE(e)&&n.indexOf("/")!==-1)throw new Le(je.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Vt.fromString(n));if(!Qe.isDocumentKey(r))throw new Le(je.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Hw(t,new Qe(r))}if(n instanceof dn)return Hw(t,n._key);throw new Le(je.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Kf(n)}.`)}function R1(t,e){if(!Array.isArray(t)||t.length===0)throw new Le(je.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function bT(t,e){const n=(function(i,o){for(const l of i)for(const d of l.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null})(t.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Le(je.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Le(je.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class E6{convertValue(e,n="none"){switch(ja(e)){case 0:return null;case 1:return e.booleanValue;case 2:return cn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Aa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ye(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return za(e,((i,o)=>{r[i]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[xf].arrayValue?.values?.map((r=>cn(r.doubleValue)));return new Gs(n)}convertGeoPoint(e){return new Hs(cn(e.latitude),cn(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Zf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Lu(e));default:return null}}convertTimestamp(e){const n=Ta(e);return new Qt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Vt.fromString(e);Rt(OE(r),9688,{name:e});const i=new Uu(r.get(1),r.get(3)),o=new Qe(r.popFirst(5));return i.isEqual(n)||Ci(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function vT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Tu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class To extends _T{constructor(e,n,r,i,o,l){super(e,n,r,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new af(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(N0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(je.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=To._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}To._jsonSchemaVersion="firestore/documentSnapshot/1.0",To._jsonSchema={type:wn("string",To._jsonSchemaVersion),bundleSource:wn("string","DocumentSnapshot"),bundleName:wn("string"),bundle:wn("string")};class af extends To{data(e={}){return super.data(e)}}class $l{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Tu(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new af(this._firestore,this._userDataWriter,r.key,r,new Tu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Le(je.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((d=>{const h=new af(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Tu(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);return d.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((d=>o||d.type!==3)).map((d=>{const h=new af(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Tu(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,p=-1;return d.type!==0&&(m=l.indexOf(d.doc.key),l=l.delete(d.doc.key)),d.type!==1&&(l=l.add(d.doc),p=l.indexOf(d.doc.key)),{type:T6(d.type),doc:h,oldIndex:m,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(je.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=$l._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=o0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function T6(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ye(61501,{type:t})}}function A6(t){t=fs(t,dn);const e=fs(t.firestore,Lo);return c6(cm(e),t._key).then((n=>D6(e,t,n)))}$l._jsonSchemaVersion="firestore/querySnapshot/1.0",$l._jsonSchema={type:wn("string",$l._jsonSchemaVersion),bundleSource:wn("string","QuerySnapshot"),bundleName:wn("string"),bundle:wn("string")};class xT extends E6{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new dn(this.firestore,null,n)}}function j6(t){t=fs(t,fc);const e=fs(t.firestore,Lo),n=cm(e),r=new xT(e);return x6(t._query),u6(n,t._query).then((i=>new $l(e,r,t,i)))}function R6(t,e,n){t=fs(t,dn);const r=fs(t.firestore,Lo),i=vT(t.converter,e,n);return mm(r,[dT(dm(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,_r.none())])}function I6(t,e,n,...r){t=fs(t,dn);const i=fs(t.firestore,Lo),o=dm(i);let l;return l=typeof(e=Sn(e))=="string"||e instanceof od?mT(o,"updateDoc",t._key,e,n,r):fT(o,"updateDoc",t._key,e),mm(i,[l.toMutation(t._key,_r.exists(!0))])}function k6(t){return mm(fs(t.firestore,Lo),[new rm(t._key,_r.none())])}function mm(t,e){return(function(r,i){const o=new bi;return r.asyncQueue.enqueueAndForget((async()=>XN(await l6(r),i,o))),o.promise})(cm(t),e)}function D6(t,e,n){const r=n.docs.get(e._key),i=new xT(t);return new To(t,i,e._key,r,new Tu(n.hasPendingWrites,n.fromCache),e.converter)}class M6{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=dm(e)}set(e,n,r){this._verifyNotCommitted();const i=Gg(e,this._firestore),o=vT(i.converter,n,r),l=dT(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(l.toMutation(i._key,_r.none())),this}update(e,n,r,...i){this._verifyNotCommitted();const o=Gg(e,this._firestore);let l;return l=typeof(n=Sn(n))=="string"||n instanceof od?mT(this._dataReader,"WriteBatch.update",o._key,n,r,i):fT(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,_r.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Gg(e,this._firestore);return this._mutations=this._mutations.concat(new rm(n._key,_r.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Le(je.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Gg(t,e){if((t=Sn(t)).firestore!==e)throw new Le(je.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Vu(...t){return new k0("arrayUnion",t)}function I1(...t){return new D0("arrayRemove",t)}function wT(t){return cm(t=fs(t,Lo)),new M6(t,(e=>mm(t,e)))}(function(e,n=!0){(function(i){cc=i})(ic),ql(new Ro("firestore",((r,{instanceIdentifier:i,options:o})=>{const l=r.getProvider("app").getImmediate(),d=new Lo(new _M(r.getProvider("auth-internal")),new xM(l,r.getProvider("app-check-internal")),(function(m,p){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new Le(je.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Uu(m.options.projectId,p)})(l,i),l);return o={useFetchStreams:n,...o},d._setSettings(o),d}),"PUBLIC").setMultipleInstances(!0)),xa(Dw,Mw,e),xa(Dw,Mw,"esm2020")})();function Fo(){return f6(BC)}const Yt={showGroupTotals:!1};function Vo(t,e,n,r=1,i,o){let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const p=e.replace("months/","").split("_");if(p.length>=2){const g=p[p.length-1];l=`months/${p[p.length-2]}/${g}`}}console.log(`[Firebase] ${t}(${r}): ${l}${i===!1?" [NOT FOUND]":""}`)}async function Et(t,e,n){const r=mc(Fo(),t,e),i=`${t}/${e}`,o=await A6(r),l=o.exists(),d=l?o.data():null;return Vo("READ",i,n,1,l),{exists:l,data:d,ref:r}}async function $n(t,e,n){const r=Fo(),i=h6(r,t);let o;if(n&&n.length>0){const m=n.map(p=>C6(p.field,p.op,p.value));o=S6(i,...m)}else o=i;const l=await j6(o),d=l.docs.map(m=>({id:m.id,data:m.data()}));let h=t;if(n&&n.length>0){const m=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${m}`}return Vo("QUERY",h,e,l.docs.length,void 0),{docs:d}}async function Wn(t,e,n,r,i){const o=mc(Fo(),t,e),l=`${t}/${e}`;return Vo("WRITE",l,r,1,void 0),R6(o,n,i??{})}async function pc(t,e){const r=Fo();for(let i=0;i<t.length;i+=500){const o=t.slice(i,i+500),l=wT(r);for(const{collectionPath:d,docId:h,data:m}of o){const p=mc(r,d,h);l.set(p,m)}Vo("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0);try{await l.commit()}catch(d){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,d),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(i/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),d}}}async function kf(t,e,n,r){const i=mc(Fo(),t,e),o=`${t}/${e}`;return Vo("UPDATE",o,r,1,void 0),I6(i,n)}async function Oy(t,e,n){const r=mc(Fo(),t,e),i=`${t}/${e}`;return Vo("DELETE",i),k6(r)}async function ST(t,e,n){const i=Fo();for(let o=0;o<t.length;o+=500){const l=t.slice(o,o+500),d=wT(i);for(const{collectionPath:h,docId:m}of l){const p=mc(i,h,m);d.delete(p)}Vo("BATCH_DELETE",`${l.length} docs`,e,l.length),await d.commit(),n?.(o+l.length)}}const vo={mobile:640,tablet:768,wide:1200},O6=vo.mobile,$u=["January","February","March","April","May","June","July","August","September","October","November","December"],ka=3,Df=3,Jt="ungrouped_accounts",un="ungrouped_categories";function N6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??Jt,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function P6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget!==void 0?r.on_budget:null,is_active:r.is_active!==void 0?r.is_active:null}}),e[Jt]||(e[Jt]={name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}),e}function z6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??un,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0,is_hidden:r.is_hidden??!1}}),e}function B6(t=[]){const e=t.map(r=>({id:r.id,name:r.name,sort_order:r.sort_order??0}));return e.some(r=>r.id===un)||e.push({id:un,name:"Uncategorized",sort_order:0}),e.sort((r,i)=>r.sort_order-i.sort_order),e}function L6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}async function B0(t){const{exists:e,data:n}=await Et("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=N6(n.accounts),i=P6(n.account_groups),o=z6(n.categories),l=B6(n.category_groups),d=n.total_available??0,h=L6(n.month_map),m=n.is_needs_recalculation??!1;return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:i,categories:o,category_groups:l,total_available:d,is_needs_recalculation:m,month_map:h},accounts:r,accountGroups:i,categories:o,categoryGroups:l,isNeedsRecalculation:m,monthMap:h}}function U6(t,e){const{initialDataLoadComplete:n}=Xe(),r=!!t&&e?.enabled!==!1&&n;return No({queryKey:t?Re.budget(t):["budget","none"],queryFn:()=>B0(t),enabled:r,staleTime:lc})}function ps(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function pm(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function CT(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function bt(t,e){return`${t}${e.toString().padStart(2,"0")}`}function Ny(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function gm(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1;if(t===r&&e===i){const o=n.getDate();return`${r}-${String(i).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function ym(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}function ze(t){return Math.round((t+Number.EPSILON)*100)/100}function ht(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function Ws(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>Ws(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=Ws(r));return e}return t}function F6(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??bt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function Kr(t,e,n,r){const i=ps(t,e,n);return(await Be.fetchQuery({queryKey:Re.month(t,e,n),queryFn:async()=>{const{exists:l,data:d}=await Et("months",i,r?.description??`reading month ${e}/${n}`);return!l||!d?null:{month:F6(d,t,e,n)}},staleTime:lc}))?.month??null}function V6(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}function $6(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let i=Df;i>0;i--){let o=e,l=n-i;for(;l<1;)l+=12,o-=1;r.push(bt(o,l))}r.push(bt(e,n));for(let i=1;i<=ka;i++){let o=e,l=n+i;for(;l>12;)l-=12,o+=1;r.push(bt(o,l))}return r}function q6(t,e){const n=Re.budget(t),r=Be.getQueryData(n);if(!r?.monthMap)return!1;for(const[i,o]of Object.entries(r.monthMap))if(i>=e&&!o.needs_recalculation)return!1;return!0}function H6(t,e,n){const r=Re.budget(t),i=Be.getQueryData(r);i&&Be.setQueryData(r,{...i,isNeedsRecalculation:!0,monthMap:n,budget:{...i.budget,is_needs_recalculation:!0,month_map:n}})}function G6(t,e,n){const r=Re.budget(t),i=Be.getQueryData(r);i&&Be.setQueryData(r,{...i,monthMap:e,budget:{...i.budget,month_map:e}})}function Q6(t,e,n,r){const i=bt(e,n),o=Re.budget(t),l=Be.getQueryData(o);if(!l)return console.warn(`[removeMonthFromMap] Budget ${t} not found in cache`),{};const d=l.monthMap||{},{[i]:h,...m}=d,p=m;return Be.setQueryData(o,{...l,monthMap:p,budget:{...l.budget,month_map:p}}),r&&r({type:"budget",budgetId:t}),p}async function W6(t,e,n,r){const{bypassDateLimit:i=!1}={},o=new Date,l=o.getFullYear(),d=o.getMonth()+1,h=(e-l)*12+(n-d);if(!i&&h>ka){const O=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${ka}). This likely indicates a bug in month navigation.`;throw console.error(O),new Error(O)}if(!i&&h<-Df){const O=`[createMonth] Refusing to create month ${e}/${n} - it's ${Math.abs(h)} months in the past (max allowed: ${Df}). Existing months can still be viewed, but new months cannot be created this far back.`;throw console.error(O),new Error(O)}const{exists:m,data:p}=await Et("budgets",t,"validating budget exists before creating month");if(!m||!p){Be.removeQueries({queryKey:Re.budget(t)});const O=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(O),new Error(O)}const g=o.toISOString(),v=ps(t,e,n);let _=0,C={},x={};if(n>1||e>new Date().getFullYear()-10){const{year:O,month:N}=pm(e,n),F=ps(t,O,N);try{const{exists:q,data:R}=await Et("months",F,"fetching previous month to create start balances for new month");if(q&&R){const P={budget_id:t,year_month_ordinal:R.year_month_ordinal??bt(O,N),year:R.year??O,month:R.month??N,income:R.income||[],total_income:R.total_income??0,previous_month_income:R.previous_month_income??0,expenses:R.expenses||[],total_expenses:R.total_expenses??0,transfers:R.transfers||[],adjustments:R.adjustments||[],account_balances:R.account_balances||[],category_balances:R.category_balances||[],are_allocations_finalized:R.are_allocations_finalized??!1,created_at:R.created_at,updated_at:R.updated_at};_=P.total_income;const{categoryEndBalances:A,accountEndBalances:W}=V6(P);C=A,x=W}}catch(q){if(q instanceof Error&&q.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${O}/${N}, starting with zero balances`);else throw q}}const S=Object.entries(C).map(([O,N])=>({category_id:O,start_balance:N,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:N})),E=Object.entries(x).map(([O,N])=>({account_id:O,start_balance:N,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:N})),T={budget_id:t,year_month_ordinal:bt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:_,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:E,category_balances:S,are_allocations_finalized:!1,created_at:g,updated_at:g},I={budget_id:t,year_month_ordinal:bt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:_,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:E,category_balances:S,are_allocations_finalized:!1,created_at:g,updated_at:g};await Wn("months",v,I,"creating new month document (first time viewing this month)"),Be.setQueryData(Re.month(t,e,n),{month:T});const D=bt(e,n),$={...p.month_map||{},[D]:{needs_recalculation:!1}},M=$;return G6(t,M),await kf("budgets",t,{month_map:M,updated_at:g},`adding month ${e}/${n} to budget month_map`),T}function K6(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??bt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function L0(t,e,n){const r=ps(t,e,n);try{const{exists:i,data:o}=await Et("months",r,`loading month ${e}/${n}`);return!i||!o?null:K6(o,t,e,n)}catch(i){if(i instanceof Error&&i.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw i}}async function Y6(t,e,n,r){const i=await L0(t,e,n);if(i)return i;let o=!1;if(r){const l=r.getQueryData(Re.budget(t));l?.monthMap&&(o=bt(e,n)in l.monthMap)}else{const{exists:l,data:d}=await Et("budgets",t,"checking month_map before creating month");if(l&&d?.month_map){const h=bt(e,n),m=d.month_map;o=h in m}}if(o)return W6(t,e,n);throw new Error(`Month ${e}/${n} does not exist in budget. Cannot create months that are not in month_map.`)}function X6(t,e,n,r){const i=$t(),{initialDataLoadComplete:o}=Xe(),l=t?Re.month(t,e,n):["month","none"],d=!!t&&r?.enabled!==!1&&o;return No({queryKey:l,queryFn:async()=>({month:await Y6(t,e,n,i)}),enabled:d,staleTime:lc})}async function U0(t){const{exists:e,data:n}=await Et("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function F0(t,e){const{initialDataLoadComplete:n}=Xe(),r=!!t&&e?.enabled!==!1&&n;return No({queryKey:t?Re.payees(t):["payees","none"],queryFn:()=>U0(t),enabled:r,staleTime:lc})}async function Z6(t,e){const{exists:n,data:r}=await Et("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const i={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await Wn("users",t,i,"creating new user document (first login)"),i}function J6(t,e,n){return No({queryKey:t?Re.user(t):["user","none"],queryFn:()=>Z6(t,e),enabled:!!t&&n?.enabled!==!1})}async function e4(t,e){const n=await $n("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],i=[];for(const o of n.docs){const l=o.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):i.push({budgetId:o.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}return{budgets:r,pendingInvites:i}}function t4(t,e,n){return No({queryKey:t?Re.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?e4(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function n4(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function r4(){const t=await $n("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=n4(n.data.items),i=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:i})})}return{items:e}}function s4(t){return No({queryKey:Re.feedback(),queryFn:r4,enabled:t?.enabled!==!1})}const Xt="__NO_CATEGORY__",Mo="No Category";function rt(t){return t===Xt}const Gt="__NO_ACCOUNT__",Da="No Account";function Ze(t){return t===Gt}const cd={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function ud(t,e){const n=t.income||[],r=t.expenses||[],i=ze(n.reduce((g,v)=>g+v.amount,0)),o=ze(r.reduce((g,v)=>g+v.amount,0)),l=i4(t),{transfersMap:d,adjustmentsMap:h}=a4(t),m=o4(t.category_balances,e.categoryEndBalances,l,d,h),p=l4(t,e.accountEndBalances);return{...t,total_income:i,total_expenses:o,previous_month_income:e.totalIncome,category_balances:m,account_balances:p,updated_at:new Date().toISOString()}}function i4(t){const e={};for(const n of t.transfers||[])rt(n.from_category_id)||(e[n.from_category_id]=(e[n.from_category_id]||0)-n.amount),rt(n.to_category_id)||(e[n.to_category_id]=(e[n.to_category_id]||0)+n.amount);for(const n of t.adjustments||[])rt(n.category_id)||(e[n.category_id]=(e[n.category_id]||0)+n.amount);for(const n of Object.keys(e))e[n]=ze(e[n]);return e}function a4(t){const e={},n={};for(const r of t.transfers||[])rt(r.from_category_id)||(e[r.from_category_id]=(e[r.from_category_id]||0)-r.amount),rt(r.to_category_id)||(e[r.to_category_id]=(e[r.to_category_id]||0)+r.amount);for(const r of t.adjustments||[])rt(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(e))e[r]=ze(e[r]);for(const r of Object.keys(n))n[r]=ze(n[r]);return{transfersMap:e,adjustmentsMap:n}}function o4(t,e,n,r,i){const o=new Map;for(const h of t)rt(h.category_id)||o.set(h.category_id,h);const l=new Set;for(const h of t)rt(h.category_id)||l.add(h.category_id);for(const h of Object.keys(e))rt(h)||l.add(h);for(const h of Object.keys(n))rt(h)||l.add(h);const d=[];for(const h of l){const m=o.get(h),p=ze(e[h]??0),g=ze(m?.allocated??0),v=ze(m?.spent??0),_=ze(r[h]??0),C=ze(i[h]??0);d.push({category_id:h,start_balance:p,allocated:g,spent:v,transfers:_,adjustments:C,end_balance:ze(p+g+v+_+C)})}return d}function l4(t,e){const n=new Set;for(const i of t.income||[])Ze(i.account_id)||n.add(i.account_id);for(const i of t.expenses||[])Ze(i.account_id)||n.add(i.account_id);for(const i of t.transfers||[])Ze(i.from_account_id)||n.add(i.from_account_id),Ze(i.to_account_id)||n.add(i.to_account_id);for(const i of t.adjustments||[])Ze(i.account_id)||n.add(i.account_id);for(const i of Object.keys(e))Ze(i)||n.add(i);for(const i of t.account_balances||[])Ze(i.account_id)||n.add(i.account_id);const r=[];for(const i of n){const o=ze(e[i]??0),l=ze((t.income||[]).filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0)),d=ze((t.expenses||[]).filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0)),h=ze((t.transfers||[]).filter(_=>_.from_account_id===i).reduce((_,C)=>_-C.amount,0)),m=ze((t.transfers||[]).filter(_=>_.to_account_id===i).reduce((_,C)=>_+C.amount,0)),p=ze(m+h),g=ze((t.adjustments||[]).filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0)),v=ze(l+d+p+g);r.push({account_id:i,start_balance:o,income:l,expenses:d,transfers:p,adjustments:g,net_change:v,end_balance:ze(o+v)})}return r}function Oo(t){const e={},n={};for(const r of t.category_balances||[])rt(r.category_id)||(e[r.category_id]=ze(r.end_balance));for(const r of t.account_balances||[])Ze(r.account_id)||(n[r.account_id]=ze(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:ze(t.total_income)}}async function c4(t,e){return Be.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await Et("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function Py(t,e,n){const r=await Kr(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function u4(t,e,n,r){const i={};e.forEach(v=>{i[v]=0});const o=await Py(t,n,r);if(o?.category_balances){for(const v of o.category_balances)e.includes(v.category_id)&&(i[v.category_id]=v.end_balance);return i}const l={};e.forEach(v=>{l[v]=0});const d=[];o&&d.push(o);let h=n,m=r,p=!1;const g=120;for(let v=0;v<g&&!p;v++){const _=pm(h,m);h=_.year,m=_.month;const C=await Py(t,h,m);if(!C)p=!0;else if(C.category_balances){p=!0;for(const x of C.category_balances)e.includes(x.category_id)&&(l[x.category_id]=x.end_balance)}else d.push(C)}d.reverse(),Object.assign(i,l);for(const v of d){if(v.are_allocations_finalized&&v.category_balances)for(const _ of v.category_balances)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)+_.allocated);if(v.expenses)for(const _ of v.expenses)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)-_.amount)}return i}async function _m(t,e,n,r,i){const o={...n},d=Be.getQueryData(Re.budget(t))?.monthMap||{},h=new Date,m=h.getFullYear(),p=h.getMonth()+1;let g=m,v=p+ka;for(;v>12;)v-=12,g+=1;const _=bt(g,v);let C=r,x=i;const S=ka*2;for(let E=0;E<S;E++){const T=CT(C,x);C=T.year,x=T.month;const I=bt(C,x);if(I>_||!(I in d))break;const D=await Py(t,C,x);if(!D)break;if(D.are_allocations_finalized&&D.category_balances)for(const B of D.category_balances)e.includes(B.category_id)&&(o[B.category_id]=(o[B.category_id]||0)+B.allocated);if(D.expenses)for(const B of D.expenses)e.includes(B.category_id)&&(o[B.category_id]=(o[B.category_id]||0)-B.amount)}return o}async function of(t,e,n,r){const i=await u4(t,e,n,r),o=await _m(t,e,i,n,r);return{current:i,total:o}}const me={primary:"#646cff",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},us={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},Ma="1px solid color-mix(in srgb, currentColor 20%, transparent)",Mf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},V0={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},d4={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},h4={display:"flex",flexDirection:"column",gap:"0.5rem"},f4={fontSize:"0.9rem",fontWeight:500},La={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},m4={...La,cursor:"pointer"},$0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},ET={...$0,background:me.primary,color:"white",border:"none"},p4={...ET,padding:"0.75rem 1.5rem",borderRadius:"8px"},g4={...$0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},y4={...$0,background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error},_4={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s"},pa={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},Of={display:"flex",flexDirection:"column",gap:"2px"},b4={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},v4={opacity:.4,cursor:"grab"},x4={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:me.primary,borderRadius:"2px",transition:"opacity 0.15s"},w4={position:"relative",height:"2rem",marginTop:"-0.25rem"},S4={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:me.primary,borderRadius:"2px",transition:"opacity 0.15s"},C4={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},E4={background:me.errorBg,border:`1px solid ${me.errorBorder}`,color:me.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},T4={background:"transparent",border:"none",color:me.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},TT={opacity:.7,marginBottom:"1.5rem"},k1={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"};function bm({message:t,children:e,onDismiss:n,style:r}){return u.jsxs("div",{style:{...E4,...r},children:[u.jsx("span",{children:e??t}),n&&u.jsx("button",{onClick:n,style:T4,children:""})]})}const A4={primary:ET,"primary-large":p4,secondary:g4,danger:y4,small:_4},j4={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:me.warning,color:"#1a1a1a",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",animation:"tooltipFadeIn 0.15s ease-out"},R4={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${me.warning}`};function Ve({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:i,style:o,actionName:l,disabledReason:d,onClick:h,...m}){const p=A4[t],g=i||e,[v,_]=k.useState(!1);function C(E){h?.(E)}function x(E){g&&d&&(E.preventDefault(),E.stopPropagation(),_(!0),setTimeout(()=>_(!1),3e3))}const S=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return u.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:x,children:[v&&d&&u.jsxs("div",{style:j4,children:[d,u.jsx("div",{style:R4})]}),u.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...S,...o},onClick:C,...m,children:e?n:r})]})}function AT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const d=r.indexOf(n);return{match:!0,score:d===0||/\s/.test(r[d-1])?100:90}}let i=0,o=0,l=0;for(let d=0;d<r.length&&i<n.length;d++)r[d]===n[i]?(i++,l++,o+=l*2):l=0;return i===n.length?{match:!0,score:o}:{match:!1,score:0}}function jT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function RT(t){const e=jT(t),n=[];let r="__initial__";return e.forEach(i=>{i.groupId!==r&&(r=i.groupId,n.push({groupId:i.groupId,groupName:i.groupName,groupSortOrder:i.groupSortOrder,items:[]})),n[n.length-1].items.push(i)}),n}function IT(t,e,n){return e.trim()?t.map(i=>{const o=n(i);let l=0,d=!1;for(const h of o){const m=AT(e,h);m.match&&(d=!0,l=Math.max(l,m.score))}return{item:i,score:l,hasMatch:d}}).filter(({hasMatch:i})=>i).sort((i,o)=>o.score!==i.score?o.score-i.score:!i.item.groupId&&o.item.groupId?1:i.item.groupId&&!o.item.groupId?-1:i.item.groupSortOrder!==o.item.groupSortOrder?i.item.groupSortOrder-o.item.groupSortOrder:i.item.sortOrder-o.item.sortOrder).map(({item:i})=>i):jT(t)}const q0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},qu={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function D1({id:t,value:e,onChange:n,payees:r,placeholder:i="Enter payee name",autoFocus:o}){const[l,d]=k.useState(!1),[h,m]=k.useState(-1),p=k.useRef(null),g=k.useRef(null),v=e.trim()?r.map(x=>({payee:x,...AT(e,x)})).filter(x=>x.match).sort((x,S)=>S.score-x.score).slice(0,8).map(x=>x.payee):[];k.useEffect(()=>{function x(S){p.current&&!p.current.contains(S.target)&&d(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function _(x){!l||v.length===0||(x.key==="ArrowDown"?(x.preventDefault(),m(S=>Math.min(S+1,v.length-1))):x.key==="ArrowUp"?(x.preventDefault(),m(S=>Math.max(S-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(v[h]),d(!1),m(-1)):x.key==="Escape"&&(d(!1),m(-1)))}function C(x){n(x),d(!1),m(-1),g.current?.focus()}return u.jsxs("div",{ref:p,style:{position:"relative"},children:[u.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),d(!0),m(-1)},onFocus:()=>d(!0),onKeyDown:_,placeholder:i,autoComplete:"off",autoFocus:o,style:La}),l&&v.length>0&&u.jsx("div",{style:{...q0,maxHeight:"200px",overflowY:"auto"},children:v.map((x,S)=>u.jsx("div",{onClick:()=>C(x),style:{...qu,background:S===h?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:S<v.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>m(S),children:x},x))})]})}function kT({id:t,value:e,onChange:n,categories:r,categoryGroups:i,placeholder:o="Search categories...",required:l,showNoCategoryOption:d=!1,showHiddenCategories:h=!1}){const m=Object.fromEntries(i.map(G=>[G.id,G.name])),p=Object.fromEntries(i.map(G=>[G.id,G.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,G])=>!G.is_hidden)),v=Object.entries(g).map(([G,J])=>({id:G,name:J.name,groupId:J.category_group_id,groupName:J.category_group_id&&m[J.category_group_id]||null,sortOrder:J.sort_order,groupSortOrder:J.category_group_id?p[J.category_group_id]??999:999})),_=e===Xt,C=_?null:e?r[e]:null,x=_?"":C?.name||"",[S,E]=k.useState(x),[T,I]=k.useState(!1),[D,B]=k.useState(-1),$=k.useRef(null),M=k.useRef(null);k.useEffect(()=>{if(e===Xt)E("");else if(e){const G=r[e];E(G?.name||"")}},[e,r]);const O=IT(v,S,G=>[G.name]),N=RT(O);k.useEffect(()=>{function G(J){if($.current&&!$.current.contains(J.target))if(I(!1),e===Xt)E("");else{const X=e?r[e]:null;E(X?.name||"")}}return document.addEventListener("mousedown",G),()=>document.removeEventListener("mousedown",G)},[e,r]);function F(G){if(G.key==="ArrowDown")G.preventDefault(),T?B(J=>Math.min(J+1,O.length-1)):(I(!0),B(0));else if(G.key==="ArrowUp")G.preventDefault(),B(J=>Math.max(J-1,0));else if(G.key==="Enter")G.preventDefault(),T&&D>=0&&O[D]&&q(O[D]);else if(G.key==="Escape")if(I(!1),B(-1),e===Xt)E("");else{const J=e?r[e]:null;E(J?.name||"")}else if(G.key==="Tab")if(T&&D>=0&&O[D])q(O[D]);else if(I(!1),B(-1),e===Xt)E("");else{const J=e?r[e]:null;E(J?.name||"")}}function q(G){n(G.id),E(G.id===Xt?"":G.name),I(!1),B(-1)}function R(){n(Xt),E(""),I(!1),B(-1)}function P(G){const J=G.target.value;E(J),I(!0),B(J.trim()?0:-1),J!==x&&(d&&J.trim()===""?n(Xt):n(""))}function A(){I(!0),d&&(e===Xt||S.trim()==="")?B(-1):O.length>0&&B(0)}let W=-1;const K=()=>++W;return u.jsxs("div",{ref:$,style:{position:"relative"},children:[u.jsx("input",{ref:M,id:t,type:"text",value:S,onChange:P,onFocus:A,onKeyDown:F,placeholder:o,autoComplete:"off",required:l&&!d,style:{...La,borderColor:l&&!e?me.error:void 0}}),T&&u.jsxs("div",{style:{...q0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:R,onMouseEnter:()=>B(-1),style:{...qu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:D===-1?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent"},children:Mo}),N.map((G,J)=>u.jsxs("div",{children:[G.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:G.groupName}),G.items.map(X=>{const ie=K();return u.jsx("div",{onClick:()=>q(X),style:{...qu,paddingLeft:G.groupName?"1.2rem":"0.8rem",background:ie===D?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>B(ie),children:X.name},X.id)})]},`group-${J}`)),O.length===0&&S.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function DT({id:t,value:e,onChange:n,accounts:r,accountGroups:i,placeholder:o="Search accounts...",required:l,showNoAccountOption:d=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,W])=>!W.is_hidden)).map(([W,K])=>({id:W,name:K.nickname,groupId:K.account_group_id,groupName:K.account_group_id&&i[K.account_group_id]?.name||null,sortOrder:K.sort_order,groupSortOrder:K.account_group_id?i[K.account_group_id]?.sort_order??999:999})),g=e===Gt,v=g?null:r.find(([W])=>W===e)?.[1],_=g?"":v?.nickname||"",[C,x]=k.useState(_),[S,E]=k.useState(!1),[T,I]=k.useState(-1),D=k.useRef(null),B=k.useRef(null);k.useEffect(()=>{if(e===Gt)x("");else if(e){const W=r.find(([K])=>K===e)?.[1];x(W?.nickname||"")}},[e,r]);const $=IT(p,C,W=>[W.name]),M=RT($);k.useEffect(()=>{function W(K){if(D.current&&!D.current.contains(K.target))if(E(!1),e===Gt)x("");else{const G=r.find(([J])=>J===e)?.[1];x(G?.nickname||"")}}return document.addEventListener("mousedown",W),()=>document.removeEventListener("mousedown",W)},[e,r]);function O(W){if(W.key==="ArrowDown")W.preventDefault(),S?I(K=>Math.min(K+1,$.length-1)):(E(!0),I(0));else if(W.key==="ArrowUp")W.preventDefault(),I(K=>Math.max(K-1,0));else if(W.key==="Enter")W.preventDefault(),S&&T>=0&&$[T]&&N($[T]);else if(W.key==="Escape")if(E(!1),I(-1),e===Gt)x("");else{const K=r.find(([G])=>G===e)?.[1];x(K?.nickname||"")}else if(W.key==="Tab")if(S&&T>=0&&$[T])N($[T]);else if(E(!1),I(-1),e===Gt)x("");else{const K=r.find(([G])=>G===e)?.[1];x(K?.nickname||"")}}function N(W){n(W.id),x(W.id===Gt?"":W.name),E(!1),I(-1)}function F(){n(Gt),x(""),E(!1),I(-1)}function q(W){const K=W.target.value;x(K),E(!0),I(K.trim()?0:-1),K!==_&&(d&&K.trim()===""?n(Gt):n(""))}function R(){E(!0),d&&(e===Gt||C.trim()==="")?I(-1):$.length>0&&I(0)}let P=-1;const A=()=>++P;return u.jsxs("div",{ref:D,style:{position:"relative"},children:[u.jsx("input",{ref:B,id:t,type:"text",value:C,onChange:q,onFocus:R,onKeyDown:O,placeholder:o,autoComplete:"off",required:l&&!d,style:{...La,borderColor:l&&!e?me.error:void 0}}),S&&u.jsxs("div",{style:{...q0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:F,onMouseEnter:()=>I(-1),style:{...qu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent"},children:Da}),M.map((W,K)=>u.jsxs("div",{children:[W.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:W.groupName}),W.items.map(G=>{const J=A();return u.jsx("div",{onClick:()=>N(G),style:{...qu,paddingLeft:W.groupName?"1.2rem":"0.8rem",background:J===T?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>I(J),children:G.name},G.id)})]},`group-${K}`)),$.length===0&&C.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function Ti({children:t,onSubmit:e,actionName:n}){function r(i){e(i)}return u.jsx("form",{onSubmit:r,style:d4,children:t})}function zt({label:t,htmlFor:e,children:n,hint:r,style:i}){return u.jsxs("div",{style:{...h4,...i},children:[u.jsx("label",{htmlFor:e,style:f4,children:t}),n,r&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function Ai(t){return u.jsx("input",{style:La,...t})}function I4(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function Nf({value:t,onChange:e,style:n,autoFocus:r,...i}){const o=k.useRef(null),l=k.useRef(null),d=I4(t);k.useEffect(()=>{r&&l.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function m(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...i}),u.jsx("div",{ref:l,tabIndex:0,onClick:h,onKeyDown:m,style:{...La,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:d||"Select date"})]})}function Hu({children:t,...e}){return u.jsx("select",{style:m4,...e,children:t})}function H0({minHeight:t="6rem",style:e,...n}){return u.jsx("textarea",{style:{...La,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function Ua({children:t}){return u.jsx("div",{style:b4,children:t})}function Qg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",i=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return i!==void 0?`$${o}.${i.slice(0,2)}`:o?`$${o}`:""}function k4(t){return t.replace(/[$,]/g,"")}function So({id:t,value:e,onChange:n,placeholder:r="$0.00",required:i,autoFocus:o,style:l}){const[d,h]=k.useState(()=>Qg(e)),m=k.useRef(null);k.useEffect(()=>{const g=Qg(e);k4(d)!==e&&h(g)},[e]);function p(g){const v=g.target.value;if(!v||v==="$"){h(""),n("");return}const C=v.replace(/[^\d.]/g,"").split(".");let x=C[0];C.length>1&&(x+="."+C.slice(1).join("").slice(0,2));const S=Qg(x);h(S),n(x)}return u.jsx("input",{ref:m,id:t,type:"text",inputMode:"decimal",value:d,onChange:p,placeholder:r,required:i,autoFocus:o,style:{...La,...l}})}function Ri(t=O6){const[e,n]=k.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return k.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function i(l){n(l.matches)}i(r),r.addEventListener("change",i);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",i),window.removeEventListener("resize",o)}},[t]),e}function MT(){const[t,e]=k.useState(()=>typeof window>"u"?1200:window.innerWidth);return k.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=vo.wide,isMedium:t>=vo.tablet&&t<vo.wide,isNarrowMedium:t>=vo.mobile&&t<vo.tablet,isMobile:t<vo.mobile}}function In(){const{selectedBudgetId:t,currentUserId:e}=Xe(),n=U6(t),r=n.data,i=r?.budget||null,o=k.useMemo(()=>r?.accounts||{},[r?.accounts]),l=k.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),d=k.useMemo(()=>r?.categories||{},[r?.categories]),h=k.useMemo(()=>r?.categoryGroups||[],[r?.categoryGroups]),m=i?.owner_id===e,p=k.useMemo(()=>i?.user_ids||[],[i?.user_ids]),g=k.useMemo(()=>i?.accepted_user_ids||[],[i?.accepted_user_ids]),v=i?.total_available??0,_=k.useMemo(()=>r?.monthMap||{},[r?.monthMap]),C=k.useCallback(D=>{if(!t)return;const B=Be.getQueryData(Re.budget(t));B&&Be.setQueryData(Re.budget(t),{...B,accounts:D})},[t]),x=k.useCallback(D=>{if(!t)return;const B=Be.getQueryData(Re.budget(t));B&&Be.setQueryData(Re.budget(t),{...B,accountGroups:D})},[t]),S=k.useCallback(D=>{if(!t)return;const B=Be.getQueryData(Re.budget(t));B&&Be.setQueryData(Re.budget(t),{...B,categories:D})},[t]),E=k.useCallback(D=>{if(!t)return;const B=Be.getQueryData(Re.budget(t));B&&Be.setQueryData(Re.budget(t),{...B,categoryGroups:D})},[t]),T=k.useCallback(async()=>{t&&await Be.invalidateQueries({queryKey:Re.budget(t)})},[t]),I=k.useCallback(()=>Object.entries(o).filter(([,D])=>{const B=D.account_group_id?l[D.account_group_id]:void 0,$=B&&B.on_budget!==null?B.on_budget:D.on_budget!==!1,M=B&&B.is_active!==null?B.is_active:D.is_active!==!1;return $&&M}).reduce((D,[,B])=>D+B.balance,0),[o,l]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:i,accounts:o,accountGroups:l,categories:d,categoryGroups:h,isOwner:m,budgetUserIds:p,acceptedUserIds:g,totalAvailable:v,monthMap:_,setAccountsOptimistic:C,setAccountGroupsOptimistic:x,setCategoriesOptimistic:S,setCategoryGroupsOptimistic:E,refreshBudget:T,getOnBudgetTotal:I}}function Ks(t,e,n){const{addLoadingHold:r,removeLoadingHold:i}=Pn(),o=$t(),l=X6(t,e,n,{enabled:!!t});k.useEffect(()=>{const T=t?Re.month(t,e,n):null;return!(T?o.getQueryData(T):null)&&l.isLoading?r("month-query","Loading month data..."):i("month-query"),()=>i("month-query")},[l.isLoading,t,e,n,o,r,i]);const d=l.data?.month||null,h=k.useMemo(()=>d?.income||[],[d?.income]),m=k.useMemo(()=>d?.expenses||[],[d?.expenses]),p=k.useMemo(()=>d?.transfers||[],[d?.transfers]),g=k.useMemo(()=>d?.adjustments||[],[d?.adjustments]),v=k.useMemo(()=>d?.category_balances||[],[d?.category_balances]),_=k.useMemo(()=>d?.account_balances||[],[d?.account_balances]),C=d?.total_income||0,x=d?.total_expenses||0,S=d?.are_allocations_finalized||!1,E=d?.previous_month_income??0;return{isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,month:d,income:h,expenses:m,transfers:p,adjustments:g,categoryBalances:v,accountBalances:_,totalIncome:C,totalExpenses:x,areAllocationsFinalized:S,previousMonthIncome:E}}async function OT(t,e,n){const r=ps(t,e.year,e.month);await Wn("months",r,e,`writeMonthData: ${n}`)}async function NT(t,e,n){await ZP(t,e,n)}async function D4(t){const{budgetId:e,month:n,description:r,cascadeRecalculation:i=!0}=t;await OT(e,n,r||`${n.year}/${n.month}`),Be.setQueryData(Re.month(e,n.year,n.month),{month:n}),i&&await NT(e,n.year,n.month)}function M4(){const t=$t();return{writeData:Kn({mutationFn:async({budgetId:n,month:r,description:i,cascadeRecalculation:o=!0})=>(await OT(n,r,i||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,cascadeRecalculation:o}),onMutate:async({budgetId:n,month:r})=>{const i=Re.month(n,r.year,r.month);await t.cancelQueries({queryKey:i});const o=t.getQueryData(i);return t.setQueryData(i,{month:r}),{oldMonthQueryData:o,monthKey:i}},onSuccess:async({budgetId:n,year:r,month:i,cascadeRecalculation:o})=>{o&&await NT(n,r,i)},onError:(n,r,i)=>{i?.oldMonthQueryData&&t.setQueryData(i.monthKey,i.oldMonthQueryData)}})}}async function vm(t){const{budgetId:e,updates:n,description:r}=t,i={...n,updated_at:new Date().toISOString()},o=Ws(i);await Wn("budgets",e,o,r,{merge:!0});const l=Be.getQueryData(Re.budget(e));l&&Be.setQueryData(Re.budget(e),{...l,budget:{...l.budget,...n}})}function xm(t){const e=t.income||[],n=t.expenses||[],r=ze(e.reduce((d,h)=>d+h.amount,0)),i=ze(n.reduce((d,h)=>d+h.amount,0)),o=O4(t),l=N4(t);return{...t,total_income:r,total_expenses:i,account_balances:o,category_balances:l}}function O4(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],i=t.adjustments||[],o=t.account_balances||[],l=new Map;for(const m of o)Ze(m.account_id)||l.set(m.account_id,m);const d=new Set;for(const m of e)Ze(m.account_id)||d.add(m.account_id);for(const m of n)Ze(m.account_id)||d.add(m.account_id);for(const m of r)Ze(m.from_account_id)||d.add(m.from_account_id),Ze(m.to_account_id)||d.add(m.to_account_id);for(const m of i)Ze(m.account_id)||d.add(m.account_id);for(const m of o)Ze(m.account_id)||d.add(m.account_id);const h=[];for(const m of d){const p=l.get(m),g=ze(p?.start_balance??0),v=ze(e.filter(I=>I.account_id===m).reduce((I,D)=>I+D.amount,0)),_=ze(n.filter(I=>I.account_id===m).reduce((I,D)=>I+D.amount,0)),C=ze(r.filter(I=>I.from_account_id===m).reduce((I,D)=>I-D.amount,0)),x=ze(r.filter(I=>I.to_account_id===m).reduce((I,D)=>I+D.amount,0)),S=ze(x+C),E=ze(i.filter(I=>I.account_id===m).reduce((I,D)=>I+D.amount,0)),T=ze(v+_+S+E);h.push({account_id:m,start_balance:g,income:v,expenses:_,transfers:S,adjustments:E,net_change:T,end_balance:ze(g+T)})}return h}function N4(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],i=t.category_balances||[],o=new Map;for(const g of i)rt(g.category_id)||o.set(g.category_id,g);const l=new Map;for(const g of e){if(rt(g.category_id))continue;const v=l.get(g.category_id)||0;l.set(g.category_id,v+g.amount)}const d=new Map;for(const g of n){if(!rt(g.from_category_id)){const v=d.get(g.from_category_id)||0;d.set(g.from_category_id,v-g.amount)}if(!rt(g.to_category_id)){const v=d.get(g.to_category_id)||0;d.set(g.to_category_id,v+g.amount)}}const h=new Map;for(const g of r)if(!rt(g.category_id)){const v=h.get(g.category_id)||0;h.set(g.category_id,v+g.amount)}const m=new Set;for(const g of i)rt(g.category_id)||m.add(g.category_id);for(const g of e)rt(g.category_id)||m.add(g.category_id);for(const g of n)rt(g.from_category_id)||m.add(g.from_category_id),rt(g.to_category_id)||m.add(g.to_category_id);for(const g of r)rt(g.category_id)||m.add(g.category_id);const p=[];for(const g of m){const v=o.get(g),_=ze(l.get(g)??0),C=ze(d.get(g)??0),x=ze(h.get(g)??0);if(v){const S=ze(v.start_balance),E=ze(v.allocated);p.push({category_id:g,start_balance:S,allocated:E,spent:_,transfers:C,adjustments:x,end_balance:ze(S+E+_+C+x)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:_,transfers:C,adjustments:x,end_balance:ze(_+C+x)})}return p}function P4(t){return{year:parseInt(t.slice(0,4),10),month:parseInt(t.slice(4,6),10)}}function PT(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}function zT(t){return Object.entries(t).filter(([,e])=>e.needs_recalculation).map(([e])=>e).sort()}function z4(t){return Object.keys(t).sort()}async function B4(t,e){const{year:n,month:r}=P4(e),i=ps(t,n,r),{exists:o,data:l}=await Et("months",i,`[recalc] fetching month ${n}/${r}`);return!o||!l?null:{id:i,budget_id:t,year_month_ordinal:l.year_month_ordinal??bt(n,r),year:l.year??n,month:l.month??r,income:l.income||[],total_income:l.total_income??0,previous_month_income:l.previous_month_income??0,expenses:l.expenses||[],total_expenses:l.total_expenses??0,transfers:l.transfers||[],adjustments:l.adjustments||[],account_balances:l.account_balances||[],category_balances:l.category_balances||[],are_allocations_finalized:l.are_allocations_finalized??!1,created_at:l.created_at,updated_at:l.updated_at}}async function L4(t,e,n){n?.(0,e.length);const r=await Promise.all(e.map(i=>B4(t,i)));return n?.(e.length,e.length),r.filter(i=>i!==null)}function G0(t){const e={};for(const n of Object.keys(t))e[n]={needs_recalculation:!1};return e}function Q0(t,e,n){const r=Object.entries(t).reduce((o,[,l])=>{const d=l.account_group_id?n[l.account_group_id]:void 0,h=d&&d.on_budget!==null?d.on_budget:l.on_budget!==!1,m=d&&d.is_active!==null?d.is_active:l.is_active!==!1;return h&&m?o+(l.balance??0):o},0),i=Object.values(e).reduce((o,l)=>{const d=l.balance??0;return o+(d>0?d:0)},0);return ze(r-i)}async function wm(t,e,n,r){const{exists:i,data:o}=await Et("budgets",t,"[recalc] reading budget for balance update");if(!i||!o)return;const l={...o.accounts};for(const[p,g]of Object.entries(e))l[p]&&(l[p]={...l[p],balance:ze(g)});const d={...o.categories};for(const[p,g]of Object.entries(n))d[p]&&(d[p]={...d[p],balance:ze(g)});const h=G0(r),m=Q0(l,d,o.account_groups||{});await Wn("budgets",t,{...o,accounts:l,categories:d,total_available:m,is_needs_recalculation:!1,month_map:h,updated_at:new Date().toISOString()},"[recalc] saving balances and clearing flags"),F4(t,l,d,m,h)}function U4(t,e){const n=Be.getQueryData(Re.budget(t));n&&Be.setQueryData(Re.budget(t),{...n,isNeedsRecalculation:!1,monthMap:e,budget:{...n.budget,is_needs_recalculation:!1,month_map:e}})}function F4(t,e,n,r,i){const o=Be.getQueryData(Re.budget(t));if(o){const l={};for(const[h,m]of Object.entries(o.accounts)){const p=e[h];l[h]=p?{...m,balance:p.balance??m.balance}:m}const d={};for(const[h,m]of Object.entries(o.categories)){const p=n[h];d[h]=p?{...m,balance:p.balance??m.balance}:m}Be.setQueryData(Re.budget(t),{...o,accounts:l,categories:d,isNeedsRecalculation:!1,monthMap:i,budget:{...o.budget,accounts:e,categories:n,total_available:r,is_needs_recalculation:!1,month_map:i}})}}async function M1(t,e){const{exists:n,data:r}=await Et("budgets",t,"[recalc] reading budget to clear flags");if(!n||!r)return;const i=G0(e);await Wn("budgets",t,{...r,total_available:Q0(r.accounts||{},r.categories||{},r.account_groups||{}),is_needs_recalculation:!1,month_map:i,updated_at:new Date().toISOString()},"[recalc] clearing flags"),U4(t,i)}function V4(t,e){const n={};Object.keys(e).forEach(l=>{n[l]=0});const r=Be.getQueryData(Re.budget(t));if(!r)return n;const i=r.budget.month_map||{},o=Object.keys(i).sort();for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),m=Re.month(t,d,h),p=Be.getQueryData(m);if(!p?.month)continue;const g=p.month;for(const v of g.account_balances||[])v.account_id&&!Ze(v.account_id)&&n[v.account_id]===0&&(n[v.account_id]=v.start_balance??0)}for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),m=Re.month(t,d,h),p=Be.getQueryData(m);if(!p?.month)continue;const g=p.month;for(const v of g.income||[])v.account_id&&!Ze(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount);for(const v of g.expenses||[])v.account_id&&!Ze(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount);for(const v of g.transfers||[])v.to_account_id&&!Ze(v.to_account_id)&&n[v.to_account_id]!==void 0&&(n[v.to_account_id]+=v.amount),v.from_account_id&&!Ze(v.from_account_id)&&n[v.from_account_id]!==void 0&&(n[v.from_account_id]-=v.amount);for(const v of g.adjustments||[])v.account_id&&!Ze(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount)}for(const l of Object.keys(n))n[l]=ze(n[l]);return n}function BT(t){const e=Be.getQueryData(Re.budget(t));if(!e){console.warn("[recalculateBudgetAccountBalancesFromCache] Budget not in cache");return}const n=V4(t,e.accounts),r={};for(const[o,l]of Object.entries(e.accounts))r[o]={...l,balance:n[o]??l.balance};const i=Q0(r,e.categories,e.accountGroups);Be.setQueryData(Re.budget(t),{...e,accounts:r,budget:{...e.budget,accounts:r,total_available:i}})}const $4=300*1e3;function Cn(){const{removeChange:t,getChanges:e,clearChanges:n,hasChanges:r,setIsSaving:i,setLastSaveTime:o,setSaveError:l}=gc(),d=k.useRef(null),h=k.useRef(!1),m=k.useCallback(async(C,x,S,E)=>{const T=Re.month(C,x,S),I=Be.getQueryData(T);if(!I?.month)throw new Error(`Month ${x}/${S} not found in cache`);await D4({budgetId:C,month:I.month,description:`${E}: ${x}/${S}`,cascadeRecalculation:!1})},[]),p=k.useCallback(async(C,x)=>{const S=Re.budget(C),E=Be.getQueryData(S);if(!E)throw new Error(`Budget ${C} not found in cache`);await vm({budgetId:C,updates:{name:E.budget.name,user_ids:E.budget.user_ids,accepted_user_ids:E.budget.accepted_user_ids,owner_id:E.budget.owner_id,owner_email:E.budget.owner_email,accounts:E.budget.accounts,account_groups:E.budget.account_groups,categories:E.budget.categories,category_groups:E.budget.category_groups,total_available:E.budget.total_available,is_needs_recalculation:E.budget.is_needs_recalculation,month_map:E.budget.month_map},description:`${x}: budget`})},[]),g=k.useCallback(async(C,x)=>{const S=Re.payees(C),E=Be.getQueryData(S);if(!E)throw new Error(`Payees for budget ${C} not found in cache`);await Wn("payees",C,{budget_id:C,payees:E,updated_at:new Date().toISOString()},`${x}: payees`)},[]),v=k.useCallback(async(C="periodic save")=>{if(h.current||!r())return;h.current=!0,i(!0),l(null);const x=e(),S=[];try{const E=[],T=new Set,I=new Set;for(const D of x)D.type==="month"&&D.year!==void 0&&D.month!==void 0?E.push({budgetId:D.budgetId,year:D.year,month:D.month}):D.type==="budget"?T.add(D.budgetId):D.type==="payees"&&I.add(D.budgetId);for(const{budgetId:D,year:B,month:$}of E){const M=Re.month(D,B,$),O=Be.getQueryData(M);if(O?.month){const N=xm(O.month);Be.setQueryData(M,{month:N})}}for(const{budgetId:D,year:B,month:$}of E)try{await m(D,B,$,C)}catch(M){const O=`Failed to save month ${B}/${$}: ${M instanceof Error?M.message:String(M)}`;S.push(O),console.error("[useBackgroundSave]",O,M)}for(const D of T)try{BT(D)}catch(B){console.warn("[useBackgroundSave] Failed to recalculate budget account balances from cache:",B)}for(const D of T)try{await p(D,C)}catch(B){const $=`Failed to save budget: ${B instanceof Error?B.message:String(B)}`;S.push($),console.error("[useBackgroundSave]",$,B)}for(const D of I)try{await g(D,C)}catch(B){const $=`Failed to save payees: ${B instanceof Error?B.message:String(B)}`;S.push($),console.error("[useBackgroundSave]",$,B)}if(S.length===0)n(),o(Date.now()),en.add({type:"success",message:"All changes saved successfully",autoDismissMs:2e3});else throw new Error(S.join("; "))}catch(E){const T=E instanceof Error?E.message:String(E);throw l(T),en.add({type:"error",message:`Failed to save changes: ${T}`,autoDismissMs:0}),E}finally{h.current=!1,i(!1)}},[r,e,n,m,p,g,i,o,l]),_=k.useCallback(async(C,x,S,E)=>{try{i(!0),l(null),x==="month"&&S!==void 0&&E!==void 0?(await m(C,S,E,"immediate save (current viewing document)"),t({type:"month",budgetId:C,year:S,month:E}),o(Date.now())):x==="budget"&&(await p(C,"immediate save (current viewing document)"),t({type:"budget",budgetId:C}),o(Date.now()))}catch(T){const I=T instanceof Error?T.message:String(T);throw l(I),en.add({type:"error",message:`Failed to save current document: ${I}`,autoDismissMs:0}),T}finally{i(!1)}},[m,p,t,i,o,l]);return k.useEffect(()=>(d.current&&clearInterval(d.current),d.current=setInterval(()=>{r()&&v("periodic save (5-minute timer)").catch(x=>{console.error("[useBackgroundSave] Periodic save failed:",x)})},$4),()=>{d.current&&clearInterval(d.current)}),[r,v]),{saveAllChanges:v,saveCurrentDocument:_}}const q4={trackChange:()=>{},clearChanges:()=>{},removeChange:()=>{},getChanges:()=>[],hasChanges:()=>!1,isSaving:!1,setIsSaving:()=>{},lastSaveTime:null,setLastSaveTime:()=>{},saveError:null,setSaveError:()=>{},clearSaveError:()=>{},syncError:null,setSyncError:()=>{}},LT=k.createContext(q4);function H4({children:t}){const[e,n]=k.useState(new Map),[r,i]=k.useState(!1),[o,l]=k.useState(null),[d,h]=k.useState(null),[m,p]=k.useState(null),g=k.useCallback($=>{i($)},[]),v=k.useCallback($=>{l($)},[]),_=k.useCallback($=>{h($)},[]),C=k.useCallback($=>$.type==="month"&&$.year!==void 0&&$.month!==void 0?`${$.type}:${$.budgetId}:${$.year}:${$.month}`:`${$.type}:${$.budgetId}`,[]),x=k.useCallback($=>{n(M=>{const O=new Map(M),N=C($);return O.set(N,{...$,timestamp:Date.now()}),O})},[C]),S=k.useCallback(()=>{n(new Map)},[]),E=k.useCallback($=>{n(M=>{const O=new Map(M),N=C($);return O.delete(N),O})},[C]),T=k.useCallback(()=>Array.from(e.values()),[e]),I=k.useCallback(()=>e.size>0,[e]),D=k.useCallback(()=>{h(null)},[]),B={trackChange:x,clearChanges:S,removeChange:E,getChanges:T,hasChanges:I,isSaving:r,lastSaveTime:o,saveError:d,clearSaveError:D,setIsSaving:g,setLastSaveTime:v,setSaveError:_,syncError:m,setSyncError:p};return u.jsx(LT.Provider,{value:B,children:t})}function gc(){const t=k.useContext(LT);if(!t)throw new Error("useSync must be used within a SyncProvider");return t}function Sm(){const{trackChange:t}=gc();return{updateBudgetCacheAndTrack:(n,r)=>{Be.setQueryData(Re.budget(n),r),t({type:"budget",budgetId:n})}}}function UT(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Cn(),{updateBudgetCacheAndTrack:r}=Sm(),i=Kn({onMutate:async l=>{const{budgetId:d,accounts:h}=l,m=Re.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,accounts:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateAccounts] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{accounts:d}=l;return{accounts:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Re.budget(d.budgetId),h.previousData)}});return{updateAccounts:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function G4(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Cn(),{updateBudgetCacheAndTrack:r}=Sm(),i=Kn({onMutate:async l=>{const{budgetId:d,accountGroups:h}=l,m=Re.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,accountGroups:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateAccountGroups] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{accountGroups:d}=l;return{accountGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Re.budget(d.budgetId),h.previousData)}});return{updateAccountGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function FT(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Cn(),{updateBudgetCacheAndTrack:r}=Sm(),i=Kn({onMutate:async l=>{const{budgetId:d,categories:h}=l,m=Re.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,categories:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateCategories] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{categories:d}=l;return{categories:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Re.budget(d.budgetId),h.previousData)}});return{updateCategories:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function Q4(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Cn(),{updateBudgetCacheAndTrack:r}=Sm(),i=Kn({onMutate:async l=>{const{budgetId:d,categoryGroups:h}=l,m=Re.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,categoryGroups:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateCategoryGroups] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{categoryGroups:d}=l;return{categoryGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Re.budget(d.budgetId),h.previousData)}});return{updateCategoryGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function W4(){const t=$t(),e=Kn({onMutate:async r=>{const{budgetId:i,newName:o}=r,l=Re.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,name:o.trim()}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,newName:o}=r,l=o.trim();return await vm({budgetId:i,updates:{name:l},description:`renaming budget to "${l}"`}),{newName:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Re.budget(i.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function K4({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:i,saveAccounts:o,saveAccountGroups:l,setError:d}){const h=k.useCallback(async(p,g,v)=>{const _=e[p];if(!_)return;const C=v==="ungrouped"?Jt:v,x=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===v),S={};Object.entries(e).forEach(([T,I])=>{T!==p&&(S[T]={...I})});let E;if(g==="__group_end__"||x.length===0||!x.find(([T])=>T===g))E=(x.length>0?Math.max(...x.filter(([I])=>I!==p).map(([,I])=>I.sort_order)):-1)+1;else{const T=x.find(([I])=>I===g);if(T){const[,I]=T;E=I.sort_order,Object.entries(S).forEach(([D,B])=>{(B.account_group_id||"ungrouped")===v&&B.sort_order>=E&&(S[D]={...B,sort_order:B.sort_order+1})})}else E=0}if(S[p]={..._,account_group_id:C,sort_order:E},r(S),!!t)try{await o(S)}catch(T){d(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,d]),m=k.useCallback(async(p,g)=>{if(p===g)return;const v=Object.entries(n).sort(([,E],[,T])=>E.sort_order-T.sort_order),_=v.findIndex(([E])=>E===p),C=[...v],[x]=C.splice(_,1);if(g==="__end__")C.push(x);else{const E=C.findIndex(([T])=>T===g);C.splice(E,0,x)}const S={};if(C.forEach(([E,T],I)=>{S[E]={...T,sort_order:I}}),i(S),!!t)try{await l(S)}catch(E){d(E instanceof Error?E.message:"Failed to save new order")}},[t,n,i,l,d]);return{reorderAccountsInGroup:h,reorderGroups:m}}function Y4(){const{selectedBudgetId:t}=Xe(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o}=In(),{updateAccounts:l}=UT(),{updateAccountGroups:d}=G4(),[h,m]=k.useState(null),p=k.useCallback(async F=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accounts:F})},[t,l]),g=k.useCallback(async F=>{if(!t)throw new Error("No budget selected");await d.mutateAsync({budgetId:t,accountGroups:F})},[t,d]),v=k.useCallback(async(F,q)=>{if(!t)throw new Error("No budget selected");await Promise.all([l.mutateAsync({budgetId:t,accounts:F}),d.mutateAsync({budgetId:t,accountGroups:q})])},[t,l,d]),_=k.useMemo(()=>Object.entries(n).filter(([,F])=>!F.is_hidden).reduce((F,[q,R])=>{const P=R.account_group_id||Jt;return F[P]||(F[P]=[]),F[P].push({...R,id:q}),F},{}),[n]),C=k.useMemo(()=>Object.entries(n).filter(([,F])=>F.is_hidden).map(([F,q])=>({...q,id:F})).sort((F,q)=>F.sort_order-q.sort_order),[n]),x=k.useMemo(()=>Object.entries(r).sort(([,F],[,q])=>F.sort_order-q.sort_order).map(([F,q])=>({...q,id:F})),[r]),S=k.useCallback((F,q)=>{if(!e)return;const R=q||Jt,P=Object.values(n).filter(J=>J.account_group_id===R),A=P.length>0?Math.max(...P.map(J=>J.sort_order)):-1,W=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,K={nickname:F.nickname,description:"",balance:0,account_group_id:R,sort_order:A+1,is_income_account:F.is_income_account??!1,is_income_default:F.is_income_default??!1,is_outgo_account:F.is_outgo_account??!1,is_outgo_default:F.is_outgo_default??!1,on_budget:F.on_budget!==!1,is_active:F.is_active!==!1,is_hidden:F.is_hidden??!1},G={...n};F.is_income_default&&Object.keys(G).forEach(J=>{G[J]={...G[J],is_income_default:!1}}),F.is_outgo_default&&Object.keys(G).forEach(J=>{G[J]={...G[J],is_outgo_default:!1}}),G[W]=K,i(G),p(G).catch(J=>m(J instanceof Error?J.message:"Failed to create account."))},[e,n,i,p]),E=k.useCallback((F,q)=>{if(!e)return;const R=n[F];if(!R)return;const P=R.account_group_id||Jt,A=q.account_group_id||Jt;let W=R.sort_order;if(P!==A){const G=Object.values(n).filter(J=>J.account_group_id===A);W=G.length>0?Math.max(...G.map(J=>J.sort_order))+1:0}const K={};Object.entries(n).forEach(([G,J])=>{G===F?K[G]={...J,nickname:q.nickname,account_group_id:A,sort_order:W,is_income_account:q.is_income_account??!1,is_income_default:q.is_income_default??!1,is_outgo_account:q.is_outgo_account??!1,is_outgo_default:q.is_outgo_default??!1,on_budget:q.on_budget!==!1,is_active:q.is_active!==!1,is_hidden:q.is_hidden??!1}:(K[G]={...J},q.is_income_default&&!R.is_income_default&&(K[G].is_income_default=!1),q.is_outgo_default&&!R.is_outgo_default&&(K[G].is_outgo_default=!1))}),i(K),p(K).catch(G=>m(G instanceof Error?G.message:"Failed to save account."))},[e,n,i,p]),T=k.useCallback(F=>{if(!confirm("Are you sure you want to delete this account?")||!e)return;const{[F]:q,...R}=n;i(R),p(R).catch(P=>m(P instanceof Error?P.message:"Failed to delete account."))},[e,n,i,p]),I=k.useCallback(async(F,q)=>{const R=n[F];if(!R)return;const P=R.account_group_id||Jt,A=Object.entries(n).filter(([,ie])=>ie.account_group_id===P).sort(([,ie],[,L])=>ie.sort_order-L.sort_order),W=A.findIndex(([ie])=>ie===F),K=q==="up"?W-1:W+1;if(K<0||K>=A.length)return;const[G,J]=A[K],X={};if(Object.entries(n).forEach(([ie,L])=>{ie===F?X[ie]={...L,sort_order:J.sort_order}:ie===G?X[ie]={...L,sort_order:R.sort_order}:X[ie]={...L}}),i(X),!!e)try{await p(X)}catch(ie){i(n),m(ie instanceof Error?ie.message:"Failed to move account")}},[e,n,i,p]),D=k.useCallback(F=>{if(!e)return;const q=Object.values(r).map(K=>K.sort_order),R=q.length>0?Math.max(...q):-1,P=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,A={name:F.name,sort_order:R+1,expected_balance:F.expected_balance,on_budget:F.on_budget??null,is_active:F.is_active??null},W={...r,[P]:A};o(W),g(W).catch(K=>m(K instanceof Error?K.message:"Failed to create account type."))},[e,r,o,g]),B=k.useCallback((F,q)=>{if(!e)return;const R={...r,[F]:{...r[F],name:q.name,expected_balance:q.expected_balance,on_budget:q.on_budget??null,is_active:q.is_active??null}};o(R),g(R).catch(P=>m(P instanceof Error?P.message:"Failed to update account type."))},[e,r,o,g]),$=k.useCallback(F=>{if(F===Jt){alert("Cannot delete the default Ungrouped account type.");return}if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e)return;const q={};Object.entries(n).forEach(([A,W])=>{q[A]=W.account_group_id===F?{...W,account_group_id:Jt}:W});const{[F]:R,...P}=r;i(q),o(P),v(q,P).catch(A=>m(A instanceof Error?A.message:"Failed to delete account type."))},[e,n,r,i,o,v]),M=k.useCallback(async(F,q)=>{const R=Object.entries(r).sort(([,G],[,J])=>G.sort_order-J.sort_order),P=R.findIndex(([G])=>G===F),A=q==="up"?P-1:P+1;if(A<0||A>=R.length)return;const[W]=R.splice(P,1);R.splice(A,0,W);const K={};if(R.forEach(([G,J],X)=>{K[G]={...J,sort_order:X}}),o(K),!!e)try{await g(K)}catch(G){o(r),m(G instanceof Error?G.message:"Failed to move account type")}},[e,r,o,g]),{reorderAccountsInGroup:O,reorderGroups:N}=K4({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o,saveAccounts:p,saveAccountGroups:g,setError:m});return{accounts:n,accountGroups:r,accountsByGroup:_,hiddenAccounts:C,sortedGroups:x,currentBudget:e,error:h,setError:m,handleCreateAccount:S,handleUpdateAccount:E,handleDeleteAccount:T,handleMoveAccount:I,handleCreateGroup:D,handleUpdateGroup:B,handleDeleteGroup:$,handleMoveGroup:M,reorderAccountsInGroup:O,reorderGroups:N}}function X4(t,e,n,r){const i={};t.category_balances&&t.category_balances.forEach(h=>{i[h.category_id]=h});const o=t.expenses??[],l={};for(const h of t.transfers||[])rt(h.from_category_id)||(l[h.from_category_id]=(l[h.from_category_id]||0)-h.amount),rt(h.to_category_id)||(l[h.to_category_id]=(l[h.to_category_id]||0)+h.amount);const d={};for(const h of t.adjustments||[])rt(h.category_id)||(d[h.category_id]=(d[h.category_id]||0)+h.amount);return e.map(h=>{const m=i[h],p=ze(m?.start_balance??0),g=ze(n[h]??0),v=ze(o.filter(x=>x.category_id===h).reduce((x,S)=>x+S.amount,0)),_=ze(l[h]??0),C=ze(d[h]??0);return{category_id:h,start_balance:p,allocated:g,spent:v,transfers:_,adjustments:C,end_balance:ze(p+g+v+_+C)}})}async function Cm(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const i=[...n,r].sort((o,l)=>o.toLowerCase().localeCompare(l.toLowerCase()));return await Wn("payees",t,{budget_id:t,payees:i,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),i}async function Z4(t,e,n,r){const i=Re.month(t,e,n),o=r.getQueryData(i);if(!o?.month)throw new Error(`Month ${e}/${n} not found in cache`);const l=o.month,d=await J4(t,e,n,r),h=ud(l,d);return r.setQueryData(i,{month:h}),h}async function J4(t,e,n,r){const{year:i,month:o}=pm(e,n),l=Re.month(t,i,o),d=r.getQueryData(l);if(d?.month)return Oo(d.month);try{const h=await L0(t,i,o);if(h)return r.setQueryData(l,{month:h}),Oo(h)}catch(h){console.warn(`[useLocalRecalculation] Could not fetch previous month ${i}/${o}:`,h)}return cd}async function e3(t,e,n,r){const i=Be.getQueryData(Re.budget(t));if(!i){console.warn("[mutationHelpers] Budget not in cache, skipping local recalculation");return}const o=i.budget.month_map,l=bt(e,n),d=[];for(const[h]of Object.entries(o))if(h>=l){const m=parseInt(h.substring(0,4),10),p=parseInt(h.substring(4,6),10);d.push({year:m,month:p})}d.sort((h,m)=>h.year!==m.year?h.year-m.year:h.month-m.month);for(const{year:h,month:m}of d)try{await Z4(t,h,m,Be),r&&r({type:"month",budgetId:t,year:h,month:m})}catch(p){console.warn(`[mutationHelpers] Failed to recalculate month ${h}/${m} locally:`,p)}}function br(){const{trackChange:t}=gc();return{updateMonthCacheAndTrack:(r,i,o,l)=>{Be.setQueryData(Re.month(r,i,o),{month:l}),t({type:"month",budgetId:r,year:i,month:o})},recalculateMonthAndCascade:async(r,i,o)=>{const l=Re.month(r,i,o),d=Be.getQueryData(l);if(d?.month){const h=xm(d.month);Be.setQueryData(l,{month:h})}await e3(r,i,o,t);try{BT(r),t({type:"budget",budgetId:r})}catch(h){console.warn("[mutationHelpers] Failed to recalculate budget account balances from cache:",h),t({type:"budget",budgetId:r})}},trackChange:t}}function t3(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function n3(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Cn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=br(),l=Kn({onMutate:async h=>{const{budgetId:m,year:p,month:g}=h,v=Re.month(m,p,g);await t.cancelQueries({queryKey:v});const _=t.getQueryData(v),C=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=t3(h,C);if(_?.month){const E={..._.month,income:[..._.month.income||[],x],updated_at:new Date().toISOString()};r(m,p,g,E)}try{await i(m,p,g)}catch(E){console.warn("[useAddIncome] Failed to recalculate month and cascade:",E)}if(h.payee?.trim()){const E=t.getQueryData(Re.payees(m))||[],T=await Cm(m,h.payee,E);T&&(t.setQueryData(Re.payees(m),T),o({type:"payees",budgetId:m}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(m,"month",p,g)}catch(E){console.warn("[useAddIncome] Failed to save current document immediately:",E)}return{previousData:_,incomeId:C,newIncome:x}},mutationFn:async h=>{const{budgetId:m,year:p,month:g}=h,v=Re.month(m,p,g),_=t.getQueryData(v);if(!_?.month)throw new Error("No month data in cache after optimistic update");const C=_.month,x=C.income?.[C.income.length-1];if(!x)throw new Error("Could not find new income in updated month");return{updatedMonth:C,newIncome:x}},onError:(h,m,p)=>{if(p?.previousData){const{budgetId:g,year:v,month:_}=m;t.setQueryData(Re.month(g,v,_),p.previousData)}}});return{addIncome:async(h,m,p,g,v,_,C,x)=>l.mutateAsync({budgetId:h,year:m,month:p,amount:g,accountId:v,date:_,payee:C,description:x}),isPending:l.isPending,isError:l.isError,error:l.error}}function r3(t,e,n,r,i,o){if(!t)return!0;const l=t.payee||void 0,d=i?.trim()||void 0,h=t.description||void 0,m=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||d!==l||m!==h}function s3(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Cn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=br();return{updateIncome:async(d,h,m,p,g,v,_,C,x)=>{const S=await Kr(d,h,m);if(!S)throw new Error(`Month not found: ${h}/${m}`);const E=(S.income||[]).find($=>$.id===p);if(!r3(E,g,v,_,C,x))return{updatedMonth:S,noOp:!0};const T={id:p,amount:g,account_id:v,date:_,created_at:(S.income||[]).find($=>$.id===p)?.created_at||new Date().toISOString()};C?.trim()&&(T.payee=C.trim()),x&&(T.description=x);const I=(S.income||[]).map($=>$.id===p?T:$),D={...S,income:I,updated_at:new Date().toISOString()};r(d,h,m,D);try{await i(d,h,m)}catch($){console.warn("[useUpdateIncome] Failed to recalculate month and cascade:",$)}if(C?.trim()){const $=t.getQueryData(Re.payees(d))||[],M=await Cm(d,C,$);M&&(t.setQueryData(Re.payees(d),M),o({type:"payees",budgetId:d}))}if(e.type==="month"&&e.year===h&&e.month===m)try{await n(d,"month",h,m)}catch($){console.warn("[useUpdateIncome] Failed to save current document immediately:",$)}return{updatedMonth:D}},isPending:!1,isError:!1,error:null}}function i3(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Cn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{deleteIncome:async(o,l,d,h)=>{const m=await Kr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.income||[]).filter(_=>_.id!==h),g={...m,income:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteIncome] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteIncome] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function a3(t,e){const n={id:e,amount:t.amount,category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function o3(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Cn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=br(),l=Kn({onMutate:async h=>{const{budgetId:m,year:p,month:g}=h,v=Re.month(m,p,g);await t.cancelQueries({queryKey:v});const _=t.getQueryData(v),C=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=a3(h,C);if(_?.month){const E={..._.month,expenses:[..._.month.expenses||[],x],updated_at:new Date().toISOString()};r(m,p,g,E)}try{await i(m,p,g)}catch(E){console.warn("[useAddExpense] Failed to recalculate month and cascade:",E)}if(h.payee?.trim()){const E=t.getQueryData(Re.payees(m))||[],T=await Cm(m,h.payee,E);T&&(t.setQueryData(Re.payees(m),T),o({type:"payees",budgetId:m}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(m,"month",p,g)}catch(E){console.warn("[useAddExpense] Failed to save current document immediately:",E)}return{previousData:_,expenseId:C,newExpense:x}},mutationFn:async h=>{const{budgetId:m,year:p,month:g}=h,v=Re.month(m,p,g),_=t.getQueryData(v);if(!_?.month)throw new Error("No month data in cache after optimistic update");const C=_.month,x=C.expenses?.[C.expenses.length-1];if(!x)throw new Error("Could not find new expense in updated month");return{updatedMonth:C,newExpense:x}},onError:(h,m,p)=>{if(p?.previousData){const{budgetId:g,year:v,month:_}=m;t.setQueryData(Re.month(g,v,_),p.previousData)}}});return{addExpense:async(h,m,p,g,v,_,C,x,S,E)=>l.mutateAsync({budgetId:h,year:m,month:p,amount:g,categoryId:v,accountId:_,date:C,payee:x,description:S,cleared:E}),isPending:l.isPending,isError:l.isError,error:l.error}}function l3(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,m=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||i!==t.date||m!==h||g!==p||d!==t.cleared}function c3(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Cn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=br();return{updateExpense:async(l,d,h,m,p,g,v,_,C,x,S)=>{const E=await Kr(l,d,h);if(!E)throw new Error(`Month not found: ${d}/${h}`);const T=(E.expenses||[]).find(M=>M.id===m);if(!l3(T,p,g,v,_,C,x,S))return{updatedMonth:E,noOp:!0};const I={id:m,amount:p,category_id:g,account_id:v,date:_,created_at:E.expenses?.find(M=>M.id===m)?.created_at||new Date().toISOString()};C?.trim()&&(I.payee=C.trim()),x&&(I.description=x),S!==void 0&&(I.cleared=S);const D=(E.expenses||[]).map(M=>M.id===m?I:M),B={...E,expenses:D,updated_at:new Date().toISOString()};r(l,d,h,B);try{await i(l,d,h)}catch(M){console.warn("[useUpdateExpense] Failed to recalculate month and cascade:",M)}if(C?.trim()){const M=t.getQueryData(Re.payees(l))||[],O=await Cm(l,C,M);O&&t.setQueryData(Re.payees(l),O)}if(e.type==="month"&&e.year===d&&e.month===h)try{await n(l,"month",d,h)}catch(M){console.warn("[useUpdateExpense] Failed to save current document immediately:",M)}return{updatedMonth:B}},isPending:!1,isError:!1,error:null}}function u3(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Cn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{deleteExpense:async(o,l,d,h)=>{const m=await Kr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.expenses||[]).filter(_=>_.id!==h),g={...m,expenses:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteExpense] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteExpense] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function d3(t,e){const n={id:e,amount:t.amount,from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function h3(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Cn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=br(),o=Kn({onMutate:async d=>{const{budgetId:h,year:m,month:p}=d,g=Re.month(h,m,p);await t.cancelQueries({queryKey:g});const v=t.getQueryData(g),_=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,C=d3(d,_);if(v?.month){const S={...v.month,transfers:[...v.month.transfers||[],C],updated_at:new Date().toISOString()};r(h,m,p,S)}try{await i(h,m,p)}catch(S){console.warn("[useAddTransfer] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===m&&e.month===p)try{await n(h,"month",m,p)}catch(S){console.warn("[useAddTransfer] Failed to save current document immediately:",S)}return{previousData:v,transferId:_,newTransfer:C}},mutationFn:async d=>{const{budgetId:h,year:m,month:p}=d,g=Re.month(h,m,p),v=t.getQueryData(g);if(!v?.month)throw new Error("No month data in cache after optimistic update");const _=v.month,C=_.transfers?.[_.transfers.length-1];if(!C)throw new Error("Could not find new transfer in updated month");return{updatedMonth:_,newTransfer:C}},onError:(d,h,m)=>{if(m?.previousData){const{budgetId:p,year:g,month:v}=h;t.setQueryData(Re.month(p,g,v),m.previousData)}}});return{addTransfer:async(d,h,m,p,g,v,_,C,x,S,E)=>o.mutateAsync({budgetId:d,year:h,month:m,amount:p,fromAccountId:g,toAccountId:v,fromCategoryId:_,toCategoryId:C,date:x,description:S,cleared:E}),isPending:o.isPending,isError:o.isError,error:o.error}}function f3(t,e,n,r,i,o,l,d,h){if(!t)return!0;const m=t.description||void 0,p=d||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||i!==t.from_category_id||o!==t.to_category_id||l!==t.date||p!==m||h!==t.cleared}function m3(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Cn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{updateTransfer:async(o,l,d,h,m,p,g,v,_,C,x,S)=>{const E=await Kr(o,l,d);if(!E)throw new Error(`Month not found: ${l}/${d}`);const T=(E.transfers||[]).find(M=>M.id===h);if(!f3(T,m,p,g,v,_,C,x,S))return{updatedMonth:E,noOp:!0};const I={id:h,amount:m,from_account_id:p,to_account_id:g,from_category_id:v,to_category_id:_,date:C,created_at:E.transfers?.find(M=>M.id===h)?.created_at||new Date().toISOString()};x&&(I.description=x),S!==void 0&&(I.cleared=S);const D=(E.transfers||[]).map(M=>M.id===h?I:M),B={...E,transfers:D,updated_at:new Date().toISOString()};n(o,l,d,B);try{await r(o,l,d)}catch(M){console.warn("[useUpdateTransfer] Failed to recalculate month and cascade:",M)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(M){console.warn("[useUpdateTransfer] Failed to save current document immediately:",M)}return{updatedMonth:B}},isPending:!1,isError:!1,error:null}}function p3(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Cn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{deleteTransfer:async(o,l,d,h)=>{const m=await Kr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.transfers||[]).filter(_=>_.id!==h),g={...m,transfers:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteTransfer] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteTransfer] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function g3(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function y3(){const t=$t(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Cn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=br(),o=Kn({onMutate:async d=>{const{budgetId:h,year:m,month:p}=d,g=Re.month(h,m,p);await t.cancelQueries({queryKey:g});const v=t.getQueryData(g),_=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,C=g3(d,_);if(v?.month){const S={...v.month,adjustments:[...v.month.adjustments||[],C],updated_at:new Date().toISOString()};r(h,m,p,S)}try{await i(h,m,p)}catch(S){console.warn("[useAddAdjustment] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===m&&e.month===p)try{await n(h,"month",m,p)}catch(S){console.warn("[useAddAdjustment] Failed to save current document immediately:",S)}return{previousData:v,adjustmentId:_,newAdjustment:C}},mutationFn:async d=>{const{budgetId:h,year:m,month:p}=d,g=Re.month(h,m,p),v=t.getQueryData(g);if(!v?.month)throw new Error("No month data in cache after optimistic update");const _=v.month,C=_.adjustments?.[_.adjustments.length-1];if(!C)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:_,newAdjustment:C}},onError:(d,h,m)=>{if(m?.previousData){const{budgetId:p,year:g,month:v}=h;t.setQueryData(Re.month(p,g,v),m.previousData)}}});return{addAdjustment:async(d,h,m,p,g,v,_,C,x,S)=>o.mutateAsync({budgetId:d,year:h,month:m,amount:p,accountId:g,categoryId:v,date:_,payee:C,description:x,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function _3(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,m=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||i!==t.date||m!==h||g!==p||d!==t.cleared}function b3(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Cn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{updateAdjustment:async(o,l,d,h,m,p,g,v,_,C,x)=>{const S=await Kr(o,l,d);if(!S)throw new Error(`Month not found: ${l}/${d}`);const E=(S.adjustments||[]).find($=>$.id===h);if(!_3(E,m,p,g,v,_,C,x))return{updatedMonth:S,noOp:!0};const T={id:h,amount:m,account_id:p,category_id:g,date:v,created_at:S.adjustments?.find($=>$.id===h)?.created_at||new Date().toISOString()};_?.trim()&&(T.payee=_.trim()),C&&(T.description=C),x!==void 0&&(T.cleared=x);const I=(S.adjustments||[]).map($=>$.id===h?T:$),D={...S,adjustments:I,updated_at:new Date().toISOString()};n(o,l,d,D);try{await r(o,l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to recalculate month and cascade:",$)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to save current document immediately:",$)}return{updatedMonth:D}},isPending:!1,isError:!1,error:null}}function v3(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Cn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{deleteAdjustment:async(o,l,d,h)=>{const m=await Kr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.adjustments||[]).filter(_=>_.id!==h),g={...m,adjustments:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteAdjustment] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteAdjustment] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function x3(){const{writeData:t}=M4();return{saveDraftAllocations:async(n,r,i,o)=>{const l=await Kr(n,r,i);if(!l)throw new Error(`Month not found: ${r}/${i}`);const d=l.category_balances.map(m=>({...m,allocated:o[m.category_id]??m.allocated})),h={...l,category_balances:d,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:h,cascadeRecalculation:!1}),{updatedMonth:h}},isPending:t.isPending,isError:t.isError,error:t.error}}function w3(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Cn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{finalizeAllocations:async o=>{const{budgetId:l,year:d,month:h,allocations:m,onProgress:p}=o;p?.({phase:"saving",message:"Saving allocations..."});const g=await Kr(l,d,h);if(!g)throw new Error(`Month not found: ${d}/${h}`);const v=g.category_balances?.map(E=>E.category_id)??[],_=v.length>0?v:Object.keys(m),C=_.length>0?X4(g,_,m):g.category_balances,x={...g,category_balances:C,are_allocations_finalized:!0,updated_at:new Date().toISOString()};n(l,d,h,x),p?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(E){console.warn("[useFinalizeAllocations] Failed to recalculate month and cascade:",E)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(E){console.warn("[useFinalizeAllocations] Failed to save current document immediately:",E)}return p?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:x}},isPending:!1,isError:!1,error:null}}function VT(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Cn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=br();return{deleteAllocations:async o=>{const{budgetId:l,year:d,month:h,onProgress:m}=o;m?.({phase:"saving",message:"Deleting allocations..."});const p=await Kr(l,d,h);if(!p)throw new Error(`Month not found: ${d}/${h}`);const g=p.category_balances.map(C=>({...C,allocated:0,end_balance:C.start_balance-C.spent})),v={...p,category_balances:g,are_allocations_finalized:!1,updated_at:new Date().toISOString()};n(l,d,h,v),m?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(C){console.warn("[useDeleteAllocations] Failed to recalculate month and cascade:",C)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(C){console.warn("[useDeleteAllocations] Failed to save current document immediately:",C)}return m?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:v}},isPending:!1,isError:!1,error:null}}function O1(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,i])=>{if(i.default_monthly_type==="percentage")return;const o=t.category_balances?.find(l=>l.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():i.default_monthly_amount!==void 0&&i.default_monthly_amount>0?n[r]=i.default_monthly_amount.toString():n[r]=""}),n}function S3(){const{addLoadingHold:t,removeLoadingHold:e}=Pn(),{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Xe(),{categories:o,getOnBudgetTotal:l,totalAvailable:d}=In(),{month:h,isLoading:m,previousMonthIncome:p,areAllocationsFinalized:g}=Ks(n,r,i),v=k.useMemo(()=>h?.income?h.income.reduce((L,H)=>L+H.amount,0):0,[h]),{saveDraftAllocations:_}=x3(),{finalizeAllocations:C}=w3(),{deleteAllocations:x}=VT(),S=k.useMemo(()=>O1(h,o),[h,o]),[E,T]=k.useState(S),[I,D]=k.useState(!1),[B,$]=k.useState(null),M=k.useRef(null);k.useMemo(()=>Object.values(o).reduce((L,H)=>L+(H.balance??0),0),[o]),k.useEffect(()=>{if(!h)return;const L=`${h.year}-${h.month}`;M.current!==L&&(D(!1),T(O1(h,o)),M.current=L)},[h,o]);const O=k.useCallback((L,H)=>{if(H.default_monthly_type==="percentage"&&H.default_monthly_amount!==void 0)return ze(H.default_monthly_amount/100*p);const te=E[L],se=parseFloat(te||"0");return isNaN(se)?0:ze(se)},[E,p]),N=k.useMemo(()=>Object.entries(o).reduce((L,[H,te])=>{const se=O(H,te),ne=te.balance??0;if(ne<0){const fe=Math.abs(ne),Ce=Math.max(0,se-fe);return L+Ce}return L+se},0),[o,O]),F=l(),q=g?(h?.category_balances||[]).reduce((L,H)=>{const te=o[H.category_id]?.balance??0,se=H.allocated,ne=te-se;if(ne<0){const fe=Math.abs(ne);return L+Math.max(0,se-fe)}return L+se},0):0,R=I?d+q:d,P=k.useMemo(()=>I?R-N:R-N+q,[R,N,q,I]),A=k.useCallback((L,H)=>{T(te=>({...te,[L]:H}))},[]),W=k.useCallback(()=>{if(!h)return;const L={};Object.entries(o).forEach(([H,te])=>{if(te.default_monthly_type==="percentage")return;const se=h.category_balances?.find(ne=>ne.category_id===H);se&&se.allocated>0?L[H]=se.allocated.toString():te.default_monthly_amount!==void 0&&te.default_monthly_amount>0?L[H]=te.default_monthly_amount.toString():L[H]=""}),T(L),D(!1)},[h,o]),K=k.useCallback(()=>{const L={};return Object.entries(o).forEach(([H,te])=>{const se=O(H,te);se>0&&(L[H]=se)}),L},[o,O]),G=k.useCallback(async()=>{if(n){$(null),t("allocations-save","Saving allocations...");try{await _(n,r,i,K()),D(!1)}catch(L){$(L instanceof Error?L.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,r,i,_,K,t,e]),J=k.useCallback(async()=>{if(n){$(null),t("allocations-finalize","Applying allocations...");try{await C({budgetId:n,year:r,month:i,allocations:K(),onProgress:L=>{t("allocations-finalize",L.message)}}),D(!1)}catch(L){$(L instanceof Error?L.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,r,i,C,K,t,e]),X=k.useCallback(async()=>{if(n){$(null),t("allocations-delete","Deleting allocations...");try{await x({budgetId:n,year:r,month:i,onProgress:H=>{t("allocations-delete",H.message)}});const L={};Object.entries(o).forEach(([H,te])=>{te.default_monthly_type!=="percentage"&&(te.default_monthly_amount!==void 0&&te.default_monthly_amount>0?L[H]=te.default_monthly_amount.toString():L[H]="")}),T(L),D(!1)}catch(L){$(L instanceof Error?L.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,r,i,x,o,t,e]),ie=N-q;return{localAllocations:E,isEditingAppliedAllocations:I,error:B,monthLoading:m,onBudgetTotal:F,availableNow:R,currentDraftTotal:N,draftChangeAmount:ie,availableAfterApply:P,previousMonthIncome:p,currentMonthIncome:v,allocationsFinalized:g,getAllocationAmount:O,handleAllocationChange:A,resetAllocationsToSaved:W,handleSaveAllocations:G,handleFinalizeAllocations:J,handleDeleteAllocations:X,setIsEditingAppliedAllocations:D,setError:$}}function C3({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:i}){const[o,l]=k.useState({}),[d,h]=k.useState(!1);k.useEffect(()=>{if(!t||Object.keys(e).length===0){l({});return}let E=!1;h(!0);const T=Object.keys(e);return of(t,T,n,r).then(({current:I,total:D})=>{if(E)return;const B={};T.forEach($=>{B[$]={current:I[$]??0,total:D[$]??0}}),l(B)}).catch(I=>{if(E)return;console.error("[useCategoryBalances] Error calculating balances:",I);const D={};Object.entries(e).forEach(([B,$])=>{D[B]={current:$.balance??0,total:$.balance??0}}),l(D)}).finally(()=>{E||h(!1)}),()=>{E=!0}},[t,n,r,e]);const m=k.useMemo(()=>{const E={};return Object.entries(e).forEach(([T,I])=>{o[T]?E[T]=o[T]:E[T]={current:I.balance??0,total:I.balance??0}}),E},[e,o]),[p,g]=k.useState(!1),v=p||d,[_,C]=k.useState(null),x=k.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const E=Object.keys(e),{total:T}=await of(t,E,n,r),I={};Object.entries(e).forEach(([B,$])=>{const M=$.balance,O=T[B]??0;Math.abs(M-O)>.01&&(I[B]={stored:M,calculated:O})});const D=Object.keys(I).length>0?I:null;return C(D),D},[t,e,n,r]),S=k.useCallback(async()=>{if(!(!t||Object.keys(e).length===0)){g(!0);try{const E=Object.keys(e),{total:T}=await of(t,E,n,r),I={};Object.entries(e).forEach(([D,B])=>{I[D]={...B,balance:T[D]??0}}),await i(I),C(null)}finally{g(!1)}}},[t,e,i,n,r]);return{categoryBalances:m,loadingBalances:v,categoryBalanceMismatch:_,checkCategoryBalanceMismatch:x,recalculateAndSaveCategoryBalances:S}}function E3({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:i,saveCategories:o,saveCategoryGroups:l,setError:d}){const[h,m]=k.useState(null),[p,g]=k.useState(null),[v,_]=k.useState(null),[C,x]=k.useState(null);function S(O,N){m("category"),g(N),O.dataTransfer.effectAllowed="move"}function E(O,N,F){O.preventDefault(),h==="category"&&(N!==p&&_(N),x(F))}function T(O,N){O.preventDefault(),h==="category"&&(x(N),_(null))}function I(){_(null)}function D(){x(null)}function B(){m(null),g(null),_(null),x(null)}async function $(O,N,F){if(O.preventDefault(),O.stopPropagation(),!p||h!=="category"){B();return}const q=t[p];if(!q)return;const R=F==="ungrouped"?un:F,P=Object.entries(t).filter(([,K])=>(K.category_group_id||"ungrouped")===F),A={};Object.entries(t).forEach(([K,G])=>{K!==p&&(A[K]=G)});let W;if(N==="__group_end__"||P.length===0||!P.find(([K])=>K===N))W=(P.length>0?Math.max(...P.filter(([G])=>G!==p).map(([,G])=>G.sort_order)):-1)+1;else{const K=P.find(([G])=>G===N);K?(W=K[1].sort_order,Object.entries(A).forEach(([G,J])=>{(J.category_group_id||"ungrouped")===F&&J.sort_order>=W&&(A[G]={...J,sort_order:J.sort_order+1})})):W=0}if(A[p]={...q,category_group_id:R,sort_order:W},r(A),B(),!!n)try{await o(A)}catch(K){d(K instanceof Error?K.message:"Failed to save changes")}}async function M(O,N){O.preventDefault(),h==="category"&&await $(O,"__group_end__",N)}return{dragType:h,draggedId:p,dragOverId:v,dragOverGroupId:C,setDragOverId:_,setDragOverGroupId:x,handleCategoryDragStart:S,handleCategoryDragOver:E,handleDragOverGroup:T,handleDragLeave:I,handleDragLeaveGroup:D,handleDragEnd:B,handleCategoryDrop:$,handleDropOnGroup:M}}function T3(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{budget:r,categories:i,categoryGroups:o,isLoading:l,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,getOnBudgetTotal:m}=In(),{updateCategories:p}=FT(),{updateCategoryGroups:g}=Q4(),[v,_]=k.useState(null),C=k.useCallback(async J=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:J})},[t,p]),x=k.useCallback(async J=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:J})},[t,g]),S=k.useCallback(async(J,X)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:J}),g.mutateAsync({budgetId:t,categoryGroups:X})])},[t,p,g]),{categoryBalances:E,loadingBalances:T,categoryBalanceMismatch:I,checkCategoryBalanceMismatch:D,recalculateAndSaveCategoryBalances:B}=C3({budgetId:t,categories:i,currentYear:e,currentMonth:n,updateCategoriesWithBalances:C}),$=E3({categories:i,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,saveCategories:C,saveCategoryGroups:x,setError:_});async function M(J,X){if(!r)return;const ie=X||un,L=Object.values(i).filter(fe=>fe.category_group_id===ie),H=L.length>0?Math.max(...L.map(fe=>fe.sort_order)):-1,te=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,se={name:J.name,description:J.description??"",category_group_id:ie,sort_order:H+1,default_monthly_amount:J.default_monthly_amount??0,default_monthly_type:J.default_monthly_type??"fixed",balance:0,is_hidden:J.is_hidden??!1},ne={...i,[te]:se};d(ne);try{await C(ne)}catch(fe){d(i),_(fe instanceof Error?fe.message:"Failed to create category")}}async function O(J,X){if(r)try{const ie=i[J];if(!ie)return;const L=ie.category_group_id||un,H=X.category_group_id||un;let te=ie.sort_order;if(L!==H){const ne=Object.values(i).filter(fe=>fe.category_group_id===H).filter((fe,Ce,de)=>i[J]!==de[Ce]);te=ne.length>0?Math.max(...ne.map(fe=>fe.sort_order))+1:0}const se={...i,[J]:{...ie,name:X.name,description:X.description??"",category_group_id:H,sort_order:te,default_monthly_amount:X.default_monthly_amount??0,default_monthly_type:X.default_monthly_type??"fixed",is_hidden:X.is_hidden??!1}};d(se),await C(se)}catch(ie){_(ie instanceof Error?ie.message:"Failed to update category")}}async function N(J){if(confirm("Are you sure you want to delete this category?")&&r)try{const{[J]:X,...ie}=i;d(ie),await C(ie)}catch(X){_(X instanceof Error?X.message:"Failed to delete category")}}async function F(J,X){const ie=i[J];if(!ie)return;const L=ie.category_group_id||un,H=Object.entries(i).filter(([,de])=>de.category_group_id===L).sort((de,be)=>de[1].sort_order-be[1].sort_order),te=H.findIndex(([de])=>de===J),se=X==="up"?te-1:te+1;if(se<0||se>=H.length)return;const[ne,fe]=H[se],Ce={};if(Object.entries(i).forEach(([de,be])=>{de===J?Ce[de]={...be,sort_order:fe.sort_order}:de===ne?Ce[de]={...be,sort_order:ie.sort_order}:Ce[de]=be}),d(Ce),!!r)try{await C(Ce)}catch(de){d(i),_(de instanceof Error?de.message:"Failed to move category")}}async function q(J){if(r)try{const X=o.length>0?Math.max(...o.map(H=>H.sort_order)):-1,ie={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:J.name,sort_order:X+1},L=[...o,ie];h(L),await x(L)}catch(X){_(X instanceof Error?X.message:"Failed to create group")}}async function R(J,X){if(r)try{const ie=o.map(L=>L.id===J?{...L,name:X.name}:L);h(ie),await x(ie)}catch(ie){_(ie instanceof Error?ie.message:"Failed to update group")}}async function P(J){if(J===un){alert("Cannot delete the default Uncategorized category group.");return}if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const X={};Object.entries(i).forEach(([L,H])=>{X[L]=H.category_group_id===J?{...H,category_group_id:un}:H});const ie=o.filter(L=>L.id!==J);d(X),h(ie),await S(X,ie)}catch(X){_(X instanceof Error?X.message:"Failed to delete group")}}async function A(J,X){const ie=[...o].sort((ne,fe)=>ne.sort_order-fe.sort_order),L=ie.findIndex(ne=>ne.id===J),H=X==="up"?L-1:L+1;if(H<0||H>=ie.length)return;const[te]=ie.splice(L,1);ie.splice(H,0,te);const se=ie.map((ne,fe)=>({...ne,sort_order:fe}));if(h(se),!!r)try{await x(se)}catch(ne){h(o),_(ne instanceof Error?ne.message:"Failed to move group")}}const W=Object.entries(i).filter(([,J])=>!J.is_hidden).reduce((J,[X,ie])=>{const L=ie.category_group_id||un;return J[L]||(J[L]=[]),J[L].push([X,ie]),J},{}),K=Object.entries(i).filter(([,J])=>J.is_hidden).map(([J,X])=>[J,X]).sort((J,X)=>J[1].sort_order-X[1].sort_order),G=[...o].sort((J,X)=>J.sort_order-X.sort_order);return{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:W,hiddenCategories:K,sortedGroups:G,categoryBalances:E,isLoading:l,loadingBalances:T,error:v,setError:_,getOnBudgetTotal:m,categoryBalanceMismatch:I,checkCategoryBalanceMismatch:D,recalculateAndSaveCategoryBalances:B,handleCreateCategory:M,handleUpdateCategory:O,handleDeleteCategory:N,handleMoveCategory:F,handleCreateGroup:q,handleUpdateGroup:R,handleDeleteGroup:P,handleMoveGroup:A,dragType:$.dragType,draggedId:$.draggedId,dragOverId:$.dragOverId,dragOverGroupId:$.dragOverGroupId,setDragOverId:$.setDragOverId,setDragOverGroupId:$.setDragOverGroupId,handleCategoryDragStart:$.handleCategoryDragStart,handleCategoryDragOver:$.handleCategoryDragOver,handleDragOverGroup:$.handleDragOverGroup,handleDragLeave:$.handleDragLeave,handleDragLeaveGroup:$.handleDragLeaveGroup,handleDragEnd:$.handleDragEnd,handleCategoryDrop:$.handleCategoryDrop,handleDropOnGroup:$.handleDropOnGroup}}function A3({categories:t,categoryBalances:e,totalAvailable:n,onBudgetTotal:r,isDataLoading:i,loadingBalances:o,currentBudget:l}){const d=k.useMemo(()=>Object.values(t).reduce((x,S)=>x+Math.max(0,S.balance??0),0),[t]),h=k.useMemo(()=>Object.values(e).reduce((x,S)=>x+Math.max(0,S.total),0),[e]),m=d,p=k.useMemo(()=>Object.values(t).reduce((x,S)=>x+Math.max(0,S.balance??0),0),[t]),g=n,v=k.useMemo(()=>Math.abs(d-h)>.01,[d,h]),_=k.useMemo(()=>Math.abs(r-(m+g))>.01,[r,m,g]),C=k.useMemo(()=>Math.abs(d-p)>.01,[d,p]);return k.useEffect(()=>{if(!(i||o||!l)){if(v){const x=Math.abs(d-h);console.error("[Settings/Categories] Calculation Mismatch:",{allocatedFromStored:d,allocatedFromCalculated:h,difference:x,message:"Stored category balances do not match calculated balances. Budget may need recalculation."}),en.add({type:"error",message:`Balance calculation mismatch: ${st(x)} difference between stored and calculated balances. Budget may need recalculation.`,autoDismissMs:1e4})}if(_){const x=m+g,S=Math.abs(r-x);console.error("[Settings/Categories] Relationship Mismatch:",{onBudgetTotal:r,allocated:m,unallocated:g,expectedSum:x,actualSum:m+g,difference:S,message:"On Budget  Allocated + Unallocated"}),en.add({type:"error",message:`Accounting relationship broken: On Budget (${st(r)})  Allocated (${st(m)}) + Unallocated (${st(g)}). Difference: ${st(S)}. Budget may need recalculation.`,autoDismissMs:0})}if(C){const x=Math.abs(d-p);console.error("[Settings/Categories] Month View Mismatch:",{allocatedFromStored:d,monthViewAllTime:p,difference:x,message:'Settings page "Allocated" does not match month view "ALL-TIME" total. These should always match.'}),en.add({type:"error",message:`Balance display mismatch: Settings "Allocated" (${st(d)})  Month view "ALL-TIME" (${st(p)}). Difference: ${st(x)}. Budget may need recalculation.`,autoDismissMs:1e4})}}},[v,_,C,d,h,m,g,r,p,i,o,l]),{allocatedFromStored:d,allocatedFromCalculated:h,allocated:m,unallocated:g,monthViewAllTime:p,calculationMismatch:v,relationshipMismatch:_,monthViewMismatch:C}}function j3(t){switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return t.totalMonthsToFetch?`Loading ${t.totalMonthsToFetch} months...`:"Loading months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating balances...";case"saving":return t.totalMonths?`Saving ${t.totalMonths} months...`:"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating..."}}function dd({budgetId:t,year:e,month:n,monthMap:r,checkAnyMonth:i=!1,requireMonthLoaded:o=!1,currentMonth:l,additionalCondition:d=!0,onProgress:h,onError:m,logPrefix:p="[AutoRecalc]"}){const[g,v]=k.useState(null),_=k.useRef(!1),C=k.useRef(null),x=k.useRef(null),S=Nn(),E=k.useRef(null),{addLoadingHold:T,removeLoadingHold:I}=Pn();return k.useEffect(()=>{if(!t||!d||o&&!l)return;let D;const B=S.pathname;if(i){E.current!==B&&(C.current=null,E.current=B);const O=zT(r);if(O.length===0||_.current||(D=`any-${O[0]}`,C.current===D))return}else{if(e===void 0||n===void 0){console.warn(`${p} year and month are required when checkAnyMonth is false`);return}const O=bt(e,n),N=r[O]?.needs_recalculation===!0;if(D=`${e}-${n}`,(E.current!==B||x.current!==D)&&(C.current=null,E.current=B,x.current=D),C.current===D)return;if(!N||_.current){C.current=D;return}`${e}${String(n).padStart(2,"0")}`}_.current=!0,C.current=D;const $=`recalc-${t}`;T($,"Recalculating balances..."),YP(t,{onProgress:O=>{v(O);const N=j3(O);T($,N),h?.(O)}}).then(()=>{Be.invalidateQueries({queryKey:["month",t]})}).catch(O=>{const N=O instanceof Error?O:new Error(String(O));m?m(N):console.error(`${p} Recalculation failed:`,N)}).finally(()=>{_.current=!1,v(null),I($)})},[t,e,n,r,i,o,l,d,h,m,p,S.pathname,T,I]),{recalcProgress:g,isRecalculating:g!==null}}function R3(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??bt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function I3(t){const e=new Date,n=e.getFullYear(),r=e.getMonth()+1;let i=n,o=r-3;for(;o<=0;)o+=12,i-=1;const l=bt(i,o);return(await $n("months","useInitialDataLoad: loading initial months",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:l}])).docs.map(m=>{const p=m.data,g=p.year,v=p.month;return R3(p,t,g,v)}).sort((m,p)=>m.year!==p.year?m.year-p.year:m.month-p.month)}async function k3(t){const[e,n,r]=await Promise.all([B0(t),U0(t),I3(t)]);return{budget:e,payees:n,months:r}}function D3(t,e){return No({queryKey:t?["initialDataLoad",t]:["initialDataLoad","none"],queryFn:()=>k3(t),enabled:!!t&&e?.enabled!==!1,staleTime:1/0})}function M3(){const t=Nn(),{saveAllChanges:e}=Cn(),{hasChanges:n}=gc(),r=k.useRef(null);k.useEffect(()=>{const i=t.pathname;if(r.current===null){r.current=i;return}r.current!==i&&n()&&queueMicrotask(()=>{e("navigation save (page change)").catch(o=>{console.error("[useNavigationSave] Failed to save on navigation:",o)})}),r.current=i},[t.pathname,n,e])}const N1=300*1e3;function O3(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??bt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}function P1(t,e){return e?t?new Date(e)>new Date(t):!0:!1}async function N3(t,e){const n=[],r=new Date,i=r.getFullYear(),o=r.getMonth()+1;let l=i,d=o-3;for(;d<=0;)d+=12,l-=1;const h=bt(l,d),[m,p,g]=await Promise.all([Be.fetchQuery({queryKey:Re.budget(t),queryFn:()=>B0(t),staleTime:0}).catch(()=>null),Be.fetchQuery({queryKey:Re.payees(t),queryFn:()=>U0(t),staleTime:0}).catch(()=>null),$n("months","useSyncCheck: checking for remote changes",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:h}]).catch(()=>({docs:[]}))]);if(m){const _=Be.getQueryData(Re.budget(t));if(_){const C=_.budget?.updated_at;P1(C,m.budget.updated_at)&&(e.some(S=>S.type==="budget"&&S.budgetId===t)?n.push("Budget document has been updated remotely (you have unsaved local changes)"):Be.setQueryData(Re.budget(t),m))}}p!==null&&Be.getQueryData(Re.payees(t));const v=g.docs.map(_=>{const C=_.data,x=C.year,S=C.month;return O3(C,t,x,S)});for(const _ of v){const C=Be.getQueryData(Re.month(t,_.year,_.month));C?.month&&P1(C.month.updated_at,_.updated_at)&&(e.some(S=>S.type==="month"&&S.budgetId===t&&S.year===_.year&&S.month===_.month)?n.push(`Month ${_.year}/${_.month} has been updated remotely (you have unsaved local changes)`):Be.setQueryData(Re.month(t,_.year,_.month),{month:_}))}return n}function P3(t,e){const{setSyncError:n,getChanges:r}=gc(),i=k.useRef(null),o=k.useRef(null),l=k.useRef(0),d=k.useRef(!1);k.useEffect(()=>{if(!t||!e||d.current)return;d.current=!0;const h=async()=>{try{const m=r(),p=await N3(t,m);if(p.length>0){const g=`Sync conflict detected: ${p.join("; ")}`;n(g),en.add({type:"error",message:g,autoDismissMs:0})}else n(null)}catch(m){console.error("[useSyncCheck] Sync check failed:",m);const p=`Failed to check for sync conflicts: ${m instanceof Error?m.message:String(m)}`;n(p),en.add({type:"error",message:p,autoDismissMs:0})}};return o.current=setTimeout(()=>{h(),l.current=Date.now(),i.current=setInterval(()=>{h(),l.current=Date.now()},N1)},N1),()=>{o.current&&clearTimeout(o.current),i.current&&clearInterval(i.current),d.current=!1}},[t,e,n,r])}function z3(t,e,n){const r=$t(),i=k.useRef(null),o=k.useRef(null);k.useEffect(()=>{if(i.current===null||o.current===null){i.current=e,o.current=n;return}if(i.current===e&&o.current===n)return;if(!t){i.current=e,o.current=n;return}const l=bt(i.current,o.current),m=bt(e,n)>l?CT(e,n):pm(e,n),p=Re.month(t,m.year,m.month);if(!r.getQueryData(p)){const v=r.getQueryData(Re.budget(t)),_=bt(m.year,m.month);v?.monthMap&&_ in v.monthMap&&r.prefetchQuery({queryKey:p,queryFn:async()=>{const x=await L0(t,m.year,m.month);return x?{month:x}:null},staleTime:lc}).catch(x=>{console.warn(`[useMonthPrefetch] Failed to prefetch month ${m.year}/${m.month}:`,x)})}i.current=e,o.current=n},[t,e,n,r])}function Oa(){Be.removeQueries({queryKey:["budget"]}),Be.removeQueries({queryKey:["month"]}),Be.removeQueries({queryKey:["accessibleBudgets"]}),Be.removeQueries({queryKey:["payees"]}),Be.removeQueries({queryKey:["user"]}),console.log("[Migration] All caches cleared")}async function Em(t){try{const e=await t();return Oa(),e}catch(e){throw Oa(),e}}const $T=k.createContext(null),z1={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function B3({children:t}){const[e,n]=k.useState(z1),r=k.useCallback(()=>({setStage:d=>{n(h=>({...h,stage:d}))},setProgress:d=>{n(h=>({...h,progress:d}))},setCurrentItem:d=>{n(h=>({...h,currentItem:d}))},setDetails:d=>{n(h=>({...h,details:d}))},updateItemProgress:(d,h,m)=>{const p=h>0?Math.round(d/h*100):0;n(g=>({...g,progress:p,currentItem:m||`Item ${d} of ${h}`,details:`${d} / ${h} complete`}))}}),[]),i=k.useCallback(async(d,h)=>{n({isOpen:!0,migrationName:d,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const m=r();try{const p=await h(m);return Oa(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){Oa();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(v=>({...v,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=k.useCallback(()=>{n(d=>d.isComplete?z1:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),d))},[]),l={state:e,runMigrationWithProgress:i,closeModal:o};return u.jsx($T.Provider,{value:l,children:t})}function L3(){const t=k.useContext($T);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function U3(t){return(await $n("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function qT(t,e){return(await $n("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(i=>({id:i.id,data:i.data,budgetId:i.data.budget_id,year:i.data.year,month:i.data.month})).sort((i,o)=>i.year!==o.year?i.year-o.year:i.month-o.month)}async function Fa(t){const e=await U3(t),n=await $n("months",`${t}: batch reading all months`),r=new Map;for(const i of n.docs){const o=i.data.budget_id,l={id:i.id,data:i.data,budgetId:o,year:i.data.year,month:i.data.month};r.has(o)||r.set(o,[]),r.get(o).push(l)}for(const i of r.values())i.sort((o,l)=>o.year!==l.year?o.year-l.year:o.month-l.month);return{budgets:e,monthsByBudget:r}}async function hd(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"months",docId:ps(r.budgetId,r.year,r.month),data:Ws({...r.data,updated_at:new Date().toISOString()})}));await pc(n,`${e}: batch writing ${t.length} months`)}async function HT(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"budgets",docId:r.budgetId,data:Ws({...r.data,updated_at:new Date().toISOString()})}));await pc(n,`${e}: batch writing ${t.length} budgets`)}async function GT(t,e,n){if(e.length===0)return;let r=cd;const i=[];for(const p of e){const g=ud(p,r);i.push(g),r=Oo(g)}const o=i.map(p=>({budgetId:t,year:p.year,month:p.month,data:p}));await hd(o,n);const l=r.accountEndBalances,d=r.categoryEndBalances,{exists:h,data:m}=await Et("budgets",t,`${n}: reading budget for final update`);if(h&&m){const p=PT(m.month_map||{}),g=G0(p),v={...d},_=m.categories||{};for(const C of Object.keys(_))C in v||(v[C]=0);await wm(t,l,v,g)}}async function F3(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,i]of n){i.sort((d,h)=>d.year!==h.year?d.year-h.year:d.month-h.month),await hd(i,e);const l=(await qT(r,e)).map(d=>d.data);await GT(r,l,e)}}async function V3(t){const{exists:e,data:n}=await Et("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r={...n.accounts};for(const o of Object.keys(r))r[o]&&typeof r[o]=="object"&&(r[o]={...r[o],balance:0});const i={...n.categories};for(const o of Object.keys(i))i[o]&&typeof i[o]=="object"&&(i[o]={...i[o],balance:0});await Wn("budgets",t,{...n,accounts:r,categories:i,month_map:{},total_available:0,is_needs_recalculation:!1,updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} balances to zero`)}function $3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,m]=k.useState(null),[p,g]=k.useState(null);async function v(){if(t){r(!0);try{const C=await $n("months","delete all months: scanning for all months"),x=[],S=new Set;for(const E of C.docs){const{budget_id:T,year:I,month:D}=E.data;S.add(T),x.push({docId:E.id,budgetId:T,year:I,month:D})}x.sort((E,T)=>E.budgetId!==T.budgetId?E.budgetId.localeCompare(T.budgetId):E.year!==T.year?E.year-T.year:E.month-T.month),d({monthsToDelete:x,monthsCount:x.length,budgetCount:S.size})}catch{}finally{r(!1)}}}async function _(){if(!t||!l||l.monthsToDelete.length===0)return;o(!0),m(null);const C=l.monthsToDelete.length,x=new Set,S=[];for(const B of l.monthsToDelete)x.add(B.budgetId);g({phase:"deleting",deleted:0,total:C,currentMonth:null,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:0});const E=l.monthsToDelete.map(B=>({collectionPath:"months",docId:B.docId}));let T=0;try{await ST(E,"delete all months: batch deleting all month documents",B=>{T=B,g({phase:"deleting",deleted:B,total:C,currentMonth:`Batch ${Math.ceil(B/500)} of ${Math.ceil(C/500)}`,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:Math.round(B/C*70)})}),T=C}catch(B){S.push(`Batch delete failed: ${B instanceof Error?B.message:"Unknown error"}`)}const I=Array.from(x);let D=0;for(const B of I){g({phase:"resetting-budgets",deleted:T,total:C,currentMonth:`Budget ${D+1}/${I.length}`,budgetsRecalculated:D,totalBudgets:I.length,percentComplete:70+Math.round(D/I.length*25)});try{await V3(B),D++}catch{D++}}g({phase:"clearing-cache",deleted:T,total:C,currentMonth:null,budgetsRecalculated:D,totalBudgets:I.length,percentComplete:95}),Oa(),g({phase:"complete",deleted:T,total:C,currentMonth:null,budgetsRecalculated:D,totalBudgets:I.length,percentComplete:100}),m({deleted:T,errors:S,budgetsRecalculated:D}),o(!1),g(null),S.length===0&&(d({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:i,deleteResult:h,deleteProgress:p,deleteAllMonths:_}}const Wg="sample@sample.com",yo="budget_1767746876726_xuj7nzl4l";function q3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,m]=k.useState(null),[p,g]=k.useState(null);async function v(){if(t){r(!0);try{let x=(await $n("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:Wg}])).docs;if(x.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const B=await Et("budgets",yo,"delete sample user budget: checking fallback budget ID");B.exists&&B.data&&(console.log("delete sample user budget: found fallback budget",yo),x=[{id:yo,data:B.data}])}const S=[];let E=0,T=!1;for(const B of x){const $=B.id,M=B.data.name,N=(await $n("months",`delete sample user budget: counting months for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length;E+=N,S.push({budgetId:$,budgetName:M,monthCount:N}),(await $n("payees",`delete sample user budget: checking payees for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length>0&&(T=!0)}const I=[],D=await $n("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:Wg}]);D.docs.length>0&&D.docs[0].data.budget_ids?.includes(yo)&&(S.some(O=>O.budgetId===yo)||(console.log("delete sample user budget: found stale budget reference in sample user document",yo),I.push(yo))),d({budgets:S,totalBudgets:S.length,totalMonths:E,hasPayees:T,staleBudgetIds:I})}catch(C){console.error("Error scanning for sample user budgets:",C)}finally{r(!1)}}}async function _(){if(!t||!l||l.budgets.length===0&&l.staleBudgetIds.length===0)return;o(!0),m(null);const C=[];let x=0,S=0,E=0;const T=l.totalMonths,I=l.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:I,percentComplete:0});for(const B of l.budgets)try{const M=(await $n("months",`delete sample user budget: fetching month IDs for budget ${B.budgetId}`)).docs.filter(O=>O.data.budget_id===B.budgetId).map(O=>({collectionPath:"months",docId:O.id}));M.length>0&&(await ST(M,`delete sample user budget: deleting ${M.length} months for budget ${B.budgetId}`,O=>{x=O,g({phase:"deleting-months",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:Math.round(x/Math.max(T,1)*60)})}),x=M.length)}catch($){C.push(`Failed to delete months for budget ${B.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:60});for(const B of l.budgets)try{await Oy("payees",B.budgetId,`delete sample user budget: deleting payees for budget ${B.budgetId}`),E++}catch{}g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:70});for(const B of l.budgets)try{await Oy("budgets",B.budgetId,`delete sample user budget: deleting budget ${B.budgetId}`),S++,g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:70+Math.round(S/I*10)})}catch($){C.push(`Failed to delete budget ${B.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:80});const D=[...l.budgets.map(B=>B.budgetId),...l.staleBudgetIds];try{const B=await $n("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:Wg}]);if(B.docs.length>0){const $=B.docs[0],M=$.id,O=$.data,N=(O.budget_ids||[]).filter(F=>!D.includes(F));await Wn("users",M,{...O,budget_ids:N,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${D.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(B){C.push(`Failed to update sample user document: ${B instanceof Error?B.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:95}),Oa(),g({phase:"complete",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:100}),m({budgetsDeleted:S,monthsDeleted:x,payeesDeleted:E,errors:C}),o(!1),g(null),C.length===0&&(d({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:i,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:_}}function B1(t){if(!t)return 0;let e=0;for(const n of t)ht(n.start_balance??0)&&e++,ht(n.end_balance??0)&&e++,ht(n.allocated??0)&&e++,ht(n.spent??0)&&e++,ht(n.income??0)&&e++,ht(n.expenses??0)&&e++,ht(n.net_change??0)&&e++;return e}function L1(t){if(!t)return 0;let e=0;for(const n of t)ht(n.amount??0)&&e++;return e}async function U1(){const t=await $n("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,i=0;for(const g of t.docs){const v=g.data;let _=!1;ht(v.total_available??0)&&(i++,_=!0);const C=v.accounts;if(C&&typeof C=="object")for(const S of Object.values(C))ht(S.balance??0)&&(n++,_=!0);const x=v.categories;if(x&&typeof x=="object")for(const S of Object.values(x))ht(S.balance??0)&&(r++,_=!0),ht(S.default_monthly_amount??0)&&(r++,_=!0);_&&e++}const o=await $n("months","precision cleanup: scanning all months");let l=0,d=0,h=0,m=0,p=0;for(const g of o.docs){const v=g.data;let _=!1;(ht(v.total_income??0)||ht(v.total_expenses??0)||ht(v.previous_month_income??0))&&(_=!0);const C=L1(v.income);C>0&&(d+=C,_=!0);const x=L1(v.expenses);x>0&&(h+=x,_=!0);const S=B1(v.category_balances);S>0&&(m+=S,_=!0);const E=B1(v.account_balances);E>0&&(p+=E,_=!0),_&&l++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:i,totalMonths:o.docs.length,monthsWithPrecisionIssues:l,incomeValuesWithPrecisionIssues:d,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:m,accountBalancesWithPrecisionIssues:p}}function F1(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=ze(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=ze(e.end_balance)),e.allocated!==void 0&&(e.allocated=ze(e.allocated)),e.spent!==void 0&&(e.spent=ze(e.spent)),e.income!==void 0&&(e.income=ze(e.income)),e.expenses!==void 0&&(e.expenses=ze(e.expenses)),e.transfers!==void 0&&(e.transfers=ze(e.transfers)),e.adjustments!==void 0&&(e.adjustments=ze(e.adjustments)),e.net_change!==void 0&&(e.net_change=ze(e.net_change)),e}function H3(t,e){let n=!1;ht(t.total_available??0)&&(t.total_available=ze(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,l]of Object.entries(r)){const d=l;ht(d.balance??0)&&(r[o].balance=ze(d.balance??0),e.accountsFixed++,n=!0)}const i=t.categories;if(i&&typeof i=="object")for(const[o,l]of Object.entries(i)){const d=l;ht(d.balance??0)&&(i[o].balance=ze(d.balance??0),e.categoriesFixed++,n=!0),ht(d.default_monthly_amount??0)&&(i[o].default_monthly_amount=ze(d.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function G3(t,e){let n=!1;if(ht(t.total_income??0)&&(t.total_income=ze(t.total_income??0),n=!0),ht(t.total_expenses??0)&&(t.total_expenses=ze(t.total_expenses??0),n=!0),ht(t.previous_month_income??0)&&(t.previous_month_income=ze(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const i of t.income)ht(i.amount??0)?(r.push({...i,amount:ze(i.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(i);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const i of t.expenses)ht(i.amount??0)?(r.push({...i,amount:ze(i.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(i);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const i of t.category_balances)ht(i.start_balance??0)||ht(i.end_balance??0)||ht(i.allocated??0)||ht(i.spent??0)||ht(i.transfers??0)||ht(i.adjustments??0)?(r.push(F1(i)),e.categoryBalancesFixed++,n=!0):r.push(i);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const i of t.account_balances)ht(i.start_balance??0)||ht(i.end_balance??0)||ht(i.income??0)||ht(i.expenses??0)||ht(i.transfers??0)||ht(i.adjustments??0)||ht(i.net_change??0)?(r.push(F1(i)),e.accountBalancesFixed++,n=!0):r.push(i);t.account_balances=r}return{fixed:n,data:t}}function Q3(t,e,n){const r={...t.data},{fixed:i,data:o}=H3(r,n),l=i?{budgetId:t.id,data:o}:null;i&&n.budgetsProcessed++;const d=[];let h=!1;for(const m of e){const p={...m.data},{fixed:g,data:v}=G3(p,n);g&&(n.monthsProcessed++,h=!0),d.push(v)}return{budgetUpdate:l,fixedMonths:d,hasMonthFixes:h}}async function W3(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await Fa("precision cleanup"),r=[],i=[];for(const o of e)try{const l=n.get(o.id)||[],{budgetUpdate:d,fixedMonths:h,hasMonthFixes:m}=Q3(o,l,t);d&&r.push(d),(m||h.length>0)&&i.push({budgetId:o.id,months:h})}catch(l){t.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}if(r.length>0)try{await HT(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:l}of i)try{await GT(o,l,"precision cleanup")}catch(d){t.errors.push(`Budget ${o} recalc: ${d instanceof Error?d.message:String(d)}`)}return t}function K3({currentUser:t,onComplete:e}){const[n,r]=k.useState(null),[i,o]=k.useState(!1),[l,d]=k.useState(!1),[h,m]=k.useState(null),[p,g]=k.useState(null),v=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,_=v>0,C=k.useCallback(async()=>{if(t){o(!0),g(null);try{const S=await U1();r(S),m(null)}catch(S){g(S instanceof Error?S.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),x=k.useCallback(async()=>{if(!(!t||!_)){d(!0),g(null);try{const S=await Em(()=>W3());m(S);const E=await U1();r(E),e?.()}catch(S){g(S instanceof Error?S.message:"Failed to run precision cleanup")}finally{d(!1)}}},[t,_,e]);return{status:n,isScanning:i,isRunning:l,result:h,error:p,totalIssues:v,hasIssues:_,hasData:n!==null,scan:C,runCleanup:x}}const Y3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],X3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function Tm(t){return!t||Ze(t)?!0:Y3.includes(t)}function Am(t){return!t||rt(t)?!0:X3.includes(t)}function QT(t){return Tm(t.account_id)||Am(t.category_id)}function Z3(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:Tm(t.account_id)?Gt:t.account_id,category_id:Am(t.category_id)?Xt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function J3(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],i=[],o=[];let l=0,d=0;for(const m of n)QT(m)?(Tm(m.account_id)&&!Ze(m.account_id)&&l++,Am(m.category_id)&&!rt(m.category_id)&&d++,o.push(Z3(m))):i.push(m);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:xm({...e,expenses:i,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:l,invalidCategoriesFixed:d}}}async function eP(){const{budgets:t,monthsByBudget:e}=await Fa("expense-to-adjustment-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.expenses||[];for(const g of p)QT(g)&&(r++,Tm(g.account_id)&&!Ze(g.account_id)&&i++,Am(g.category_id)&&!rt(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:i,invalidCategoriesToFix:o}}async function tP(){const{budgets:t,monthsByBudget:e}=await Fa("expense-to-adjustment-migration"),n=[];let r=0,i=0,o=0;const l=[];for(const d of t){const h=e.get(d.id)||[];for(const m of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=J3(m);p&&g&&(n.push({budgetId:d.id,year:m.year,month:m.month,data:g}),r+=v.expensesMigrated,i+=v.invalidAccountsFixed,o+=v.invalidCategoriesFixed)}catch(p){l.push(`Month ${m.year}/${m.month} in budget ${d.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await hd(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:i,invalidCategoriesFixed:o,errors:l}}function nP({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,m]=k.useState(null);async function p(){if(t){r(!0);try{const _=await eP();d(_)}catch(_){console.error("Failed to scan for expense to adjustment migration:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const _=await Em(()=>tP());m(_),e?.()}catch(_){m({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.expensesToMigrate>0;return{status:l,isScanning:n,scanStatus:p,hasItemsToMigrate:v,isRunning:i,result:h,runMigration:g}}function WT(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const i=t.accounts;if(i)for(const o of Object.keys(i))n.add(o);return{categoryIds:e,accountIds:n}}function ga(t,e){return!t||rt(t)?!1:!e.has(t)}function Us(t,e){return!t||Ze(t)?!1:!e.has(t)}function rP(t,e){const n=t.data;let r=0,i=0,o=0,l=0,d=0,h=0,m=!1;const p=(n.expenses||[]).map(x=>{const S={...x};let E=!1;return ga(x.category_id,e.categoryIds)&&(S.category_id=Xt,r++,E=!0),Us(x.account_id,e.accountIds)&&(S.account_id=Gt,i++,E=!0),E&&(o++,m=!0),S}),g=(n.income||[]).map(x=>{const S={...x};let E=!1;return Us(x.account_id,e.accountIds)&&(S.account_id=Gt,i++,E=!0),E&&(l++,m=!0),S}),v=(n.transfers||[]).map(x=>{const S={...x};let E=!1;return ga(x.from_category_id,e.categoryIds)&&(S.from_category_id=Xt,r++,E=!0),ga(x.to_category_id,e.categoryIds)&&(S.to_category_id=Xt,r++,E=!0),Us(x.from_account_id,e.accountIds)&&(S.from_account_id=Gt,i++,E=!0),Us(x.to_account_id,e.accountIds)&&(S.to_account_id=Gt,i++,E=!0),E&&(d++,m=!0),S}),_=(n.adjustments||[]).map(x=>{const S={...x};let E=!1;return ga(x.category_id,e.categoryIds)&&(S.category_id=Xt,r++,E=!0),Us(x.account_id,e.accountIds)&&(S.account_id=Gt,i++,E=!0),E&&(h++,m=!0),S});return m?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:v,adjustments:_,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function sP(){const{budgets:t,monthsByBudget:e}=await Fa("orphaned-id-scan");let n=0,r=0,i=0,o=0,l=0,d=0,h=0;for(const m of t){const p=WT(m.data),g=e.get(m.id)||[];n+=g.length;for(const v of g){const _=v.data;for(const C of _.expenses||[]){let x=!1;ga(C.category_id,p.categoryIds)&&(r++,x=!0),Us(C.account_id,p.accountIds)&&(i++,x=!0),x&&o++}for(const C of _.income||[])Us(C.account_id,p.accountIds)&&(i++,l++);for(const C of _.transfers||[]){let x=!1;ga(C.from_category_id,p.categoryIds)&&(r++,x=!0),ga(C.to_category_id,p.categoryIds)&&(r++,x=!0),Us(C.from_account_id,p.accountIds)&&(i++,x=!0),Us(C.to_account_id,p.accountIds)&&(i++,x=!0),x&&d++}for(const C of _.adjustments||[]){let x=!1;ga(C.category_id,p.categoryIds)&&(r++,x=!0),Us(C.account_id,p.accountIds)&&(i++,x=!0),x&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}async function iP(){const{budgets:t,monthsByBudget:e}=await Fa("orphaned-id-cleanup"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=WT(l.data),h=e.get(l.id)||[];for(const m of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=rP(m,d);p&&g&&(n.push({budgetId:l.id,year:m.year,month:m.month,data:g}),r+=v.categoryIdsFixed,i+=v.accountIdsFixed)}catch(p){o.push(`Month ${m.year}/${m.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await hd(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:i,errors:o}}function aP({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,m]=k.useState(null);async function p(){if(t){r(!0);try{const _=await sP();d(_)}catch(_){console.error("Failed to scan for orphaned IDs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const _=await Em(()=>iP());m(_),e?.()}catch(_){m({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&(l.orphanedCategoryIds>0||l.orphanedAccountIds>0);return{status:l,isScanning:n,scanStatus:p,hasItemsToFix:v,isRunning:i,result:h,runMigration:g}}function oP(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,i=rt(t.category_id)&&rt(e.category_id),o=!Ze(t.account_id)&&!Ze(e.account_id),l=t.account_id!==e.account_id;if(i&&o&&l)return{negative:n,positive:r,type:"account"};const d=Ze(t.account_id)&&Ze(e.account_id),h=!rt(t.category_id)&&!rt(e.category_id),m=t.category_id!==e.category_id;return d&&h&&m?{negative:n,positive:r,type:"category"}:null}function KT(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let i=r+1;i<t.length;i++){if(n.has(t[i].id))continue;const o=oP(t[r],t[i]);if(o){e.push(o),n.add(t[r].id),n.add(t[i].id);break}}return e}function lP(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Xt,to_category_id:Xt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Gt,to_account_id:Gt,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function cP(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],i=KT(n);if(i.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=i.map(lP),l=new Set;for(const m of i)l.add(m.negative.id),l.add(m.positive.id);const d=n.filter(m=>!l.has(m.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:d,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:i.length,adjustmentsRemoved:l.size}}}async function uP(){const{budgets:t,monthsByBudget:e}=await Fa("adjustments-to-transfers-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.adjustments||[],g=KT(p);r+=g.length;for(const v of g)v.type==="account"?i++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:i,categoryTransferPairs:o}}async function dP(){const{budgets:t,monthsByBudget:e}=await Fa("adjustments-to-transfers-migration"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=e.get(l.id)||[];for(const h of d)try{const{needsUpdate:m,updatedMonth:p,stats:g}=cP(h);m&&p&&(n.push({budgetId:l.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,i+=g.adjustmentsRemoved)}catch(m){o.push(`Month ${h.year}/${h.month} in budget ${l.id}: ${m instanceof Error?m.message:String(m)}`)}}return n.length>0&&await hd(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:i,errors:o}}function hP({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,m]=k.useState(null);async function p(){if(t){r(!0);try{const _=await uP();d(_)}catch(_){console.error("Failed to scan for adjustment pairs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const _=await Em(()=>dP());m(_),e?.()}catch(_){m({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.pairsFound>0;return{status:l,isScanning:n,scanStatus:p,hasPairsToConvert:v,isRunning:i,result:h,runMigration:g}}function fP(t){const e=[];let n="",r=!1;for(let i=0;i<t.length;i++){const o=t[i];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function mP(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function pP(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),i=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(i)||n<1||n>12||r<1||r>31?null:{year:i,month:n,day:r}}function gP(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function yP(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function _P(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const i=fP(r);if(i.length<5)continue;const[o,l,d,h,m,p,g]=i;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const v=pP(o);if(!v)continue;const _=yP(l,d),C=mP(m),x=gP(g||"");n.push({recordType:_,date:o,year:v.year,month:v.month,day:v.day,payee:l,category:d,account:h,amount:C,description:p||"",cleared:x,rawLine:r})}return n}function bP(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function vP(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function xP(t){const e=Ze(t.account_id)||!t.account_id||t.account_id.trim()==="",n=rt(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function wP(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const i=Ze(t.from_account_id),o=Ze(t.to_account_id),l=rt(t.from_category_id),d=rt(t.to_category_id);return i&&o&&l&&d?"All from/to account and category IDs are NO_* (must involve at least one real entity)":i&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":l&&d&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function Gh(t,e,n,r,i){return t.filter(o=>{const[l,d,h]=e.split("-").map(Number);return o.year!==l||o.month!==d||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||i&&o.description&&o.description.toLowerCase().includes(i.toLowerCase()),!0)})}async function SP(t){const e=[];let n=0,r=0,i=0,o=0;const l=t?_P(t):[],{budgets:d,monthsByBudget:h}=await Fa("account-category-validation");for(const m of d){const p=h.get(m.id)||[];for(const g of p){const v=g.data,_=`${v.year}-${String(v.month).padStart(2,"0")}`,C=v.income||[];n+=C.length;for(const T of C){const I=bP(T);I&&e.push({budgetId:m.id,monthKey:_,transactionType:"income",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:Gh(l,T.date,T.amount,T.payee,T.description)})}const x=v.expenses||[];r+=x.length;for(const T of x){const I=vP(T);I&&e.push({budgetId:m.id,monthKey:_,transactionType:"expense",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Gh(l,T.date,T.amount,T.payee,T.description)})}const S=v.adjustments||[];i+=S.length;for(const T of S){const I=xP(T);I&&e.push({budgetId:m.id,monthKey:_,transactionType:"adjustment",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Gh(l,T.date,T.amount,void 0,T.description)})}const E=v.transfers||[];o+=E.length;for(const T of E){const I=wP(T);I&&e.push({budgetId:m.id,monthKey:_,transactionType:"transfer",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:Gh(l,T.date,T.amount,void 0,T.description)})}}}return e.sort((m,p)=>{const g=m.monthKey.localeCompare(p.monthKey);return g!==0?g:m.transactionType.localeCompare(p.transactionType)}),{totalBudgets:d.length,totalMonths:Array.from(h.values()).reduce((m,p)=>m+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:i,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function CP(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,i]of n){e.push("",`## ${r.toUpperCase()} (${i.length} violations)`,"");for(const o of i){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const l of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${l.rawLine}`,`        Type: ${l.recordType}, Date: ${l.date}, Payee: ${l.payee}`,`        Category: ${l.category}, Account: ${l.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function EP({currentUser:t}){const[e,n]=k.useState(!1),[r,i]=k.useState(null),[o,l]=k.useState(null);async function d(h){if(t){n(!0),i(null),l(null);try{const m=await SP(h);i(m),l(CP(m))}catch(m){console.error("Failed to scan transactions:",m),l(`Error scanning: ${m instanceof Error?m.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:d,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}function Qh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Kg={exports:{}};var V1;function TP(){return V1||(V1=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,o){function l(m,p){if(!i[m]){if(!r[m]){var g=typeof Qh=="function"&&Qh;if(!p&&g)return g(m,!0);if(d)return d(m,!0);var v=new Error("Cannot find module '"+m+"'");throw v.code="MODULE_NOT_FOUND",v}var _=i[m]={exports:{}};r[m][0].call(_.exports,function(C){var x=r[m][1][C];return l(x||C)},_,_.exports,n,r,i,o)}return i[m].exports}for(var d=typeof Qh=="function"&&Qh,h=0;h<o.length;h++)l(o[h]);return l})({1:[function(n,r,i){var o=n("./utils"),l=n("./support"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(h){for(var m,p,g,v,_,C,x,S=[],E=0,T=h.length,I=T,D=o.getTypeOf(h)!=="string";E<h.length;)I=T-E,g=D?(m=h[E++],p=E<T?h[E++]:0,E<T?h[E++]:0):(m=h.charCodeAt(E++),p=E<T?h.charCodeAt(E++):0,E<T?h.charCodeAt(E++):0),v=m>>2,_=(3&m)<<4|p>>4,C=1<I?(15&p)<<2|g>>6:64,x=2<I?63&g:64,S.push(d.charAt(v)+d.charAt(_)+d.charAt(C)+d.charAt(x));return S.join("")},i.decode=function(h){var m,p,g,v,_,C,x=0,S=0,E="data:";if(h.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var T,I=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===d.charAt(64)&&I--,h.charAt(h.length-2)===d.charAt(64)&&I--,I%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=l.uint8array?new Uint8Array(0|I):new Array(0|I);x<h.length;)m=d.indexOf(h.charAt(x++))<<2|(v=d.indexOf(h.charAt(x++)))>>4,p=(15&v)<<4|(_=d.indexOf(h.charAt(x++)))>>2,g=(3&_)<<6|(C=d.indexOf(h.charAt(x++))),T[S++]=m,_!==64&&(T[S++]=p),C!==64&&(T[S++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var o=n("./external"),l=n("./stream/DataWorker"),d=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function m(p,g,v,_,C){this.compressedSize=p,this.uncompressedSize=g,this.crc32=v,this.compression=_,this.compressedContent=C}m.prototype={getContentWorker:function(){var p=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},m.createWorkerFrom=function(p,g,v){return p.pipe(new d).pipe(new h("uncompressedSize")).pipe(g.compressWorker(v)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=m},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var o=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var o=n("./utils"),l=(function(){for(var d,h=[],m=0;m<256;m++){d=m;for(var p=0;p<8;p++)d=1&d?3988292384^d>>>1:d>>>1;h[m]=d}return h})();r.exports=function(d,h){return d!==void 0&&d.length?o.getTypeOf(d)!=="string"?(function(m,p,g,v){var _=l,C=v+g;m^=-1;for(var x=v;x<C;x++)m=m>>>8^_[255&(m^p[x])];return-1^m})(0|h,d,d.length,0):(function(m,p,g,v){var _=l,C=v+g;m^=-1;for(var x=v;x<C;x++)m=m>>>8^_[255&(m^p.charCodeAt(x))];return-1^m})(0|h,d,d.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=n("pako"),d=n("./utils"),h=n("./stream/GenericWorker"),m=o?"uint8array":"array";function p(g,v){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=v,this.meta={}}i.magic="\b\0",d.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(d.transformTo(m,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(v){g.push({data:v,meta:g.meta})}},i.compressWorker=function(g){return new p("Deflate",g)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function o(_,C){var x,S="";for(x=0;x<C;x++)S+=String.fromCharCode(255&_),_>>>=8;return S}function l(_,C,x,S,E,T){var I,D,B=_.file,$=_.compression,M=T!==m.utf8encode,O=d.transformTo("string",T(B.name)),N=d.transformTo("string",m.utf8encode(B.name)),F=B.comment,q=d.transformTo("string",T(F)),R=d.transformTo("string",m.utf8encode(F)),P=N.length!==B.name.length,A=R.length!==F.length,W="",K="",G="",J=B.dir,X=B.date,ie={crc32:0,compressedSize:0,uncompressedSize:0};C&&!x||(ie.crc32=_.crc32,ie.compressedSize=_.compressedSize,ie.uncompressedSize=_.uncompressedSize);var L=0;C&&(L|=8),M||!P&&!A||(L|=2048);var H=0,te=0;J&&(H|=16),E==="UNIX"?(te=798,H|=(function(ne,fe){var Ce=ne;return ne||(Ce=fe?16893:33204),(65535&Ce)<<16})(B.unixPermissions,J)):(te=20,H|=(function(ne){return 63&(ne||0)})(B.dosPermissions)),I=X.getUTCHours(),I<<=6,I|=X.getUTCMinutes(),I<<=5,I|=X.getUTCSeconds()/2,D=X.getUTCFullYear()-1980,D<<=4,D|=X.getUTCMonth()+1,D<<=5,D|=X.getUTCDate(),P&&(K=o(1,1)+o(p(O),4)+N,W+="up"+o(K.length,2)+K),A&&(G=o(1,1)+o(p(q),4)+R,W+="uc"+o(G.length,2)+G);var se="";return se+=`
\0`,se+=o(L,2),se+=$.magic,se+=o(I,2),se+=o(D,2),se+=o(ie.crc32,4),se+=o(ie.compressedSize,4),se+=o(ie.uncompressedSize,4),se+=o(O.length,2),se+=o(W.length,2),{fileRecord:g.LOCAL_FILE_HEADER+se+O+W,dirRecord:g.CENTRAL_FILE_HEADER+o(te,2)+se+o(q.length,2)+"\0\0\0\0"+o(H,4)+o(S,4)+O+W+q}}var d=n("../utils"),h=n("../stream/GenericWorker"),m=n("../utf8"),p=n("../crc32"),g=n("../signature");function v(_,C,x,S){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=C,this.zipPlatform=x,this.encodeFileName=S,this.streamFiles=_,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}d.inherits(v,h),v.prototype.push=function(_){var C=_.meta.percent||0,x=this.entriesCount,S=this._sources.length;this.accumulate?this.contentBuffer.push(_):(this.bytesWritten+=_.data.length,h.prototype.push.call(this,{data:_.data,meta:{currentFile:this.currentFile,percent:x?(C+100*(x-S-1))/x:100}}))},v.prototype.openedSource=function(_){this.currentSourceOffset=this.bytesWritten,this.currentFile=_.file.name;var C=this.streamFiles&&!_.file.dir;if(C){var x=l(_,C,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},v.prototype.closedSource=function(_){this.accumulate=!1;var C=this.streamFiles&&!_.file.dir,x=l(_,C,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),C)this.push({data:(function(S){return g.DATA_DESCRIPTOR+o(S.crc32,4)+o(S.compressedSize,4)+o(S.uncompressedSize,4)})(_),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},v.prototype.flush=function(){for(var _=this.bytesWritten,C=0;C<this.dirRecords.length;C++)this.push({data:this.dirRecords[C],meta:{percent:100}});var x=this.bytesWritten-_,S=(function(E,T,I,D,B){var $=d.transformTo("string",B(D));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(E,2)+o(E,2)+o(T,4)+o(I,4)+o($.length,2)+$})(this.dirRecords.length,x,_,this.zipComment,this.encodeFileName);this.push({data:S,meta:{percent:100}})},v.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},v.prototype.registerPrevious=function(_){this._sources.push(_);var C=this;return _.on("data",function(x){C.processChunk(x)}),_.on("end",function(){C.closedSource(C.previous.streamInfo),C._sources.length?C.prepareNextSource():C.end()}),_.on("error",function(x){C.error(x)}),this},v.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},v.prototype.error=function(_){var C=this._sources;if(!h.prototype.error.call(this,_))return!1;for(var x=0;x<C.length;x++)try{C[x].error(_)}catch{}return!0},v.prototype.lock=function(){h.prototype.lock.call(this);for(var _=this._sources,C=0;C<_.length;C++)_[C].lock()},r.exports=v},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var o=n("../compressions"),l=n("./ZipFileWorker");i.generateWorker=function(d,h,m){var p=new l(h.streamFiles,m,h.platform,h.encodeFileName),g=0;try{d.forEach(function(v,_){g++;var C=(function(T,I){var D=T||I,B=o[D];if(!B)throw new Error(D+" is not a valid compression method !");return B})(_.options.compression,h.compression),x=_.options.compressionOptions||h.compressionOptions||{},S=_.dir,E=_.date;_._compressWorker(C,x).withStreamInfo("file",{name:v,dir:S,date:E,comment:_.comment||"",unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(v){p.error(v)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var d in this)typeof this[d]!="function"&&(l[d]=this[d]);return l}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(l,d){return new o().loadAsync(l,d)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var o=n("./utils"),l=n("./external"),d=n("./utf8"),h=n("./zipEntries"),m=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(v){return new l.Promise(function(_,C){var x=v.decompressed.getContentWorker().pipe(new m);x.on("error",function(S){C(S)}).on("end",function(){x.streamInfo.crc32!==v.decompressed.crc32?C(new Error("Corrupted zip : CRC32 mismatch")):_()}).resume()})}r.exports=function(v,_){var C=this;return _=o.extend(_||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:d.utf8decode}),p.isNode&&p.isStream(v)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",v,!0,_.optimizedBinaryString,_.base64).then(function(x){var S=new h(_);return S.load(x),S}).then(function(x){var S=[l.Promise.resolve(x)],E=x.files;if(_.checkCRC32)for(var T=0;T<E.length;T++)S.push(g(E[T]));return l.Promise.all(S)}).then(function(x){for(var S=x.shift(),E=S.files,T=0;T<E.length;T++){var I=E[T],D=I.fileNameStr,B=o.resolve(I.fileNameStr);C.file(B,I.decompressed,{binary:!0,optimizedBinaryString:!0,date:I.date,dir:I.dir,comment:I.fileCommentStr.length?I.fileCommentStr:null,unixPermissions:I.unixPermissions,dosPermissions:I.dosPermissions,createFolders:_.createFolders}),I.dir||(C.file(B).unsafeOriginalName=D)}return S.zipComment.length&&(C.comment=S.zipComment),C})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var o=n("../utils"),l=n("../stream/GenericWorker");function d(h,m){l.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(m)}o.inherits(d,l),d.prototype._bindStream=function(h){var m=this;(this._stream=h).pause(),h.on("data",function(p){m.push({data:p,meta:{percent:0}})}).on("error",function(p){m.isPaused?this.generatedError=p:m.error(p)}).on("end",function(){m.isPaused?m._upstreamEnded=!0:m.end()})},d.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var o=n("readable-stream").Readable;function l(d,h,m){o.call(this,h),this._helper=d;var p=this;d.on("data",function(g,v){p.push(g)||p._helper.pause(),m&&m(v)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},r.exports=l},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,i){function o(B,$,M){var O,N=d.getTypeOf($),F=d.extend(M||{},p);F.date=F.date||new Date,F.compression!==null&&(F.compression=F.compression.toUpperCase()),typeof F.unixPermissions=="string"&&(F.unixPermissions=parseInt(F.unixPermissions,8)),F.unixPermissions&&16384&F.unixPermissions&&(F.dir=!0),F.dosPermissions&&16&F.dosPermissions&&(F.dir=!0),F.dir&&(B=E(B)),F.createFolders&&(O=S(B))&&T.call(this,O,!0);var q=N==="string"&&F.binary===!1&&F.base64===!1;M&&M.binary!==void 0||(F.binary=!q),($ instanceof g&&$.uncompressedSize===0||F.dir||!$||$.length===0)&&(F.base64=!1,F.binary=!0,$="",F.compression="STORE",N="string");var R=null;R=$ instanceof g||$ instanceof h?$:C.isNode&&C.isStream($)?new x(B,$):d.prepareContent(B,$,F.binary,F.optimizedBinaryString,F.base64);var P=new v(B,R,F);this.files[B]=P}var l=n("./utf8"),d=n("./utils"),h=n("./stream/GenericWorker"),m=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),v=n("./zipObject"),_=n("./generate"),C=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),S=function(B){B.slice(-1)==="/"&&(B=B.substring(0,B.length-1));var $=B.lastIndexOf("/");return 0<$?B.substring(0,$):""},E=function(B){return B.slice(-1)!=="/"&&(B+="/"),B},T=function(B,$){return $=$!==void 0?$:p.createFolders,B=E(B),this.files[B]||o.call(this,B,null,{dir:!0,createFolders:$}),this.files[B]};function I(B){return Object.prototype.toString.call(B)==="[object RegExp]"}var D={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(B){var $,M,O;for($ in this.files)O=this.files[$],(M=$.slice(this.root.length,$.length))&&$.slice(0,this.root.length)===this.root&&B(M,O)},filter:function(B){var $=[];return this.forEach(function(M,O){B(M,O)&&$.push(O)}),$},file:function(B,$,M){if(arguments.length!==1)return B=this.root+B,o.call(this,B,$,M),this;if(I(B)){var O=B;return this.filter(function(F,q){return!q.dir&&O.test(F)})}var N=this.files[this.root+B];return N&&!N.dir?N:null},folder:function(B){if(!B)return this;if(I(B))return this.filter(function(N,F){return F.dir&&B.test(N)});var $=this.root+B,M=T.call(this,$),O=this.clone();return O.root=M.name,O},remove:function(B){B=this.root+B;var $=this.files[B];if($||(B.slice(-1)!=="/"&&(B+="/"),$=this.files[B]),$&&!$.dir)delete this.files[B];else for(var M=this.filter(function(N,F){return F.name.slice(0,B.length)===B}),O=0;O<M.length;O++)delete this.files[M[O].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(B){var $,M={};try{if((M=d.extend(B||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=M.type.toLowerCase(),M.compression=M.compression.toUpperCase(),M.type==="binarystring"&&(M.type="string"),!M.type)throw new Error("No output type specified.");d.checkSupport(M.type),M.platform!=="darwin"&&M.platform!=="freebsd"&&M.platform!=="linux"&&M.platform!=="sunos"||(M.platform="UNIX"),M.platform==="win32"&&(M.platform="DOS");var O=M.comment||this.comment||"";$=_.generateWorker(this,M,O)}catch(N){($=new h("error")).error(N)}return new m($,M.type||"string",M.mimeType)},generateAsync:function(B,$){return this.generateInternalStream(B).accumulate($)},generateNodeStream:function(B,$){return(B=B||{}).type||(B.type="nodebuffer"),this.generateInternalStream(B).toNodejsStream($)}};r.exports=D},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d);for(var h=0;h<this.data.length;h++)d[h]=255&d[h]}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data[this.zero+d]},l.prototype.lastIndexOfSignature=function(d){for(var h=d.charCodeAt(0),m=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.length-4;0<=v;--v)if(this.data[v]===h&&this.data[v+1]===m&&this.data[v+2]===p&&this.data[v+3]===g)return v-this.zero;return-1},l.prototype.readAndCheckSignature=function(d){var h=d.charCodeAt(0),m=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.readData(4);return h===v[0]&&m===v[1]&&p===v[2]&&g===v[3]},l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var o=n("../utils");function l(d){this.data=d,this.length=d.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(d){this.checkIndex(this.index+d)},checkIndex:function(d){if(this.length<this.zero+d||d<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+d+"). Corrupted zip ?")},setIndex:function(d){this.checkIndex(d),this.index=d},skip:function(d){this.setIndex(this.index+d)},byteAt:function(){},readInt:function(d){var h,m=0;for(this.checkOffset(d),h=this.index+d-1;h>=this.index;h--)m=(m<<8)+this.byteAt(h);return this.index+=d,m},readString:function(d){return o.transformTo("string",this.readData(d))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var d=this.readInt(4);return new Date(Date.UTC(1980+(d>>25&127),(d>>21&15)-1,d>>16&31,d>>11&31,d>>5&63,(31&d)<<1))}},r.exports=l},{"../utils":32}],19:[function(n,r,i){var o=n("./Uint8ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data.charCodeAt(this.zero+d)},l.prototype.lastIndexOfSignature=function(d){return this.data.lastIndexOf(d)-this.zero},l.prototype.readAndCheckSignature=function(d){return d===this.readData(4)},l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var o=n("./ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var o=n("../utils"),l=n("../support"),d=n("./ArrayReader"),h=n("./StringReader"),m=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var v=o.getTypeOf(g);return o.checkSupport(v),v!=="string"||l.uint8array?v==="nodebuffer"?new m(g):l.uint8array?new p(o.transformTo("uint8array",g)):new d(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var o=n("./GenericWorker"),l=n("../utils");function d(h){o.call(this,"ConvertWorker to "+h),this.destType=h}l.inherits(d,o),d.prototype.processChunk=function(h){this.push({data:l.transformTo(this.destType,h.data),meta:h.meta})},r.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var o=n("./GenericWorker"),l=n("../crc32");function d(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(d,o),d.prototype.processChunk=function(h){this.streamInfo.crc32=l(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(d,l),d.prototype.processChunk=function(h){if(h){var m=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=m+h.data.length}l.prototype.processChunk.call(this,h)},r.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataWorker");var m=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){m.dataIsReady=!0,m.data=p,m.max=p&&p.length||0,m.type=o.getTypeOf(p),m.isPaused||m._tickAndRepeat()},function(p){m.error(p)})}o.inherits(d,l),d.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,m=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,m);break;case"uint8array":h=this.data.subarray(this.index,m);break;case"array":case"nodebuffer":h=this.data.slice(this.index,m)}return this.index=m,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,d){return this._listeners[l].push(d),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,d){if(this._listeners[l])for(var h=0;h<this._listeners[l].length;h++)this._listeners[l][h].call(this,d)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var d=this;return l.on("data",function(h){d.processChunk(h)}),l.on("end",function(){d.end()}),l.on("error",function(h){d.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,d){return this.extraStreamInfo[l]=d,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},r.exports=o},{}],29:[function(n,r,i){var o=n("../utils"),l=n("./ConvertWorker"),d=n("./GenericWorker"),h=n("../base64"),m=n("../support"),p=n("../external"),g=null;if(m.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function v(C,x){return new p.Promise(function(S,E){var T=[],I=C._internalType,D=C._outputType,B=C._mimeType;C.on("data",function($,M){T.push($),x&&x(M)}).on("error",function($){T=[],E($)}).on("end",function(){try{var $=(function(M,O,N){switch(M){case"blob":return o.newBlob(o.transformTo("arraybuffer",O),N);case"base64":return h.encode(O);default:return o.transformTo(M,O)}})(D,(function(M,O){var N,F=0,q=null,R=0;for(N=0;N<O.length;N++)R+=O[N].length;switch(M){case"string":return O.join("");case"array":return Array.prototype.concat.apply([],O);case"uint8array":for(q=new Uint8Array(R),N=0;N<O.length;N++)q.set(O[N],F),F+=O[N].length;return q;case"nodebuffer":return Buffer.concat(O);default:throw new Error("concat : unsupported type '"+M+"'")}})(I,T),B);S($)}catch(M){E(M)}T=[]}).resume()})}function _(C,x,S){var E=x;switch(x){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=x,this._mimeType=S,o.checkSupport(E),this._worker=C.pipe(new l(E)),C.lock()}catch(T){this._worker=new d("error"),this._worker.error(T)}}_.prototype={accumulate:function(C){return v(this,C)},on:function(C,x){var S=this;return C==="data"?this._worker.on(C,function(E){x.call(S,E.data,E.meta)}):this._worker.on(C,function(){o.delay(x,arguments,S)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(C){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},C)}},r.exports=_},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),i.blob=l.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var o=n("./utils"),l=n("./support"),d=n("./nodejsUtils"),h=n("./stream/GenericWorker"),m=new Array(256),p=0;p<256;p++)m[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;m[254]=m[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function v(){h.call(this,"utf-8 encode")}i.utf8encode=function(_){return l.nodebuffer?d.newBufferFrom(_,"utf-8"):(function(C){var x,S,E,T,I,D=C.length,B=0;for(T=0;T<D;T++)(64512&(S=C.charCodeAt(T)))==55296&&T+1<D&&(64512&(E=C.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(E-56320),T++),B+=S<128?1:S<2048?2:S<65536?3:4;for(x=l.uint8array?new Uint8Array(B):new Array(B),T=I=0;I<B;T++)(64512&(S=C.charCodeAt(T)))==55296&&T+1<D&&(64512&(E=C.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(E-56320),T++),S<128?x[I++]=S:(S<2048?x[I++]=192|S>>>6:(S<65536?x[I++]=224|S>>>12:(x[I++]=240|S>>>18,x[I++]=128|S>>>12&63),x[I++]=128|S>>>6&63),x[I++]=128|63&S);return x})(_)},i.utf8decode=function(_){return l.nodebuffer?o.transformTo("nodebuffer",_).toString("utf-8"):(function(C){var x,S,E,T,I=C.length,D=new Array(2*I);for(x=S=0;x<I;)if((E=C[x++])<128)D[S++]=E;else if(4<(T=m[E]))D[S++]=65533,x+=T-1;else{for(E&=T===2?31:T===3?15:7;1<T&&x<I;)E=E<<6|63&C[x++],T--;1<T?D[S++]=65533:E<65536?D[S++]=E:(E-=65536,D[S++]=55296|E>>10&1023,D[S++]=56320|1023&E)}return D.length!==S&&(D.subarray?D=D.subarray(0,S):D.length=S),o.applyFromCharCode(D)})(_=o.transformTo(l.uint8array?"uint8array":"array",_))},o.inherits(g,h),g.prototype.processChunk=function(_){var C=o.transformTo(l.uint8array?"uint8array":"array",_.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var x=C;(C=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),C.set(x,this.leftOver.length)}else C=this.leftOver.concat(C);this.leftOver=null}var S=(function(T,I){var D;for((I=I||T.length)>T.length&&(I=T.length),D=I-1;0<=D&&(192&T[D])==128;)D--;return D<0||D===0?I:D+m[T[D]]>I?D:I})(C),E=C;S!==C.length&&(l.uint8array?(E=C.subarray(0,S),this.leftOver=C.subarray(S,C.length)):(E=C.slice(0,S),this.leftOver=C.slice(S,C.length))),this.push({data:i.utf8decode(E),meta:_.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,o.inherits(v,h),v.prototype.processChunk=function(_){this.push({data:i.utf8encode(_.data),meta:_.meta})},i.Utf8EncodeWorker=v},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var o=n("./support"),l=n("./base64"),d=n("./nodejsUtils"),h=n("./external");function m(x){return x}function p(x,S){for(var E=0;E<x.length;++E)S[E]=255&x.charCodeAt(E);return S}n("setimmediate"),i.newBlob=function(x,S){i.checkSupport("blob");try{return new Blob([x],{type:S})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(x),E.getBlob(S)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(x,S,E){var T=[],I=0,D=x.length;if(D<=E)return String.fromCharCode.apply(null,x);for(;I<D;)S==="array"||S==="nodebuffer"?T.push(String.fromCharCode.apply(null,x.slice(I,Math.min(I+E,D)))):T.push(String.fromCharCode.apply(null,x.subarray(I,Math.min(I+E,D)))),I+=E;return T.join("")},stringifyByChar:function(x){for(var S="",E=0;E<x.length;E++)S+=String.fromCharCode(x[E]);return S},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,d.allocBuffer(1)).length===1}catch{return!1}})()}};function v(x){var S=65536,E=i.getTypeOf(x),T=!0;if(E==="uint8array"?T=g.applyCanBeUsed.uint8array:E==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<S;)try{return g.stringifyByChunk(x,E,S)}catch{S=Math.floor(S/2)}return g.stringifyByChar(x)}function _(x,S){for(var E=0;E<x.length;E++)S[E]=x[E];return S}i.applyFromCharCode=v;var C={};C.string={string:m,array:function(x){return p(x,new Array(x.length))},arraybuffer:function(x){return C.string.uint8array(x).buffer},uint8array:function(x){return p(x,new Uint8Array(x.length))},nodebuffer:function(x){return p(x,d.allocBuffer(x.length))}},C.array={string:v,array:m,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(x)}},C.arraybuffer={string:function(x){return v(new Uint8Array(x))},array:function(x){return _(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:m,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(new Uint8Array(x))}},C.uint8array={string:v,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:m,nodebuffer:function(x){return d.newBufferFrom(x)}},C.nodebuffer={string:v,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return C.nodebuffer.uint8array(x).buffer},uint8array:function(x){return _(x,new Uint8Array(x.length))},nodebuffer:m},i.transformTo=function(x,S){if(S=S||"",!x)return S;i.checkSupport(x);var E=i.getTypeOf(S);return C[E][x](S)},i.resolve=function(x){for(var S=x.split("/"),E=[],T=0;T<S.length;T++){var I=S[T];I==="."||I===""&&T!==0&&T!==S.length-1||(I===".."?E.pop():E.push(I))}return E.join("/")},i.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":o.nodebuffer&&d.isBuffer(x)?"nodebuffer":o.uint8array&&x instanceof Uint8Array?"uint8array":o.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(x){if(!o[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(x){var S,E,T="";for(E=0;E<(x||"").length;E++)T+="\\x"+((S=x.charCodeAt(E))<16?"0":"")+S.toString(16).toUpperCase();return T},i.delay=function(x,S,E){setImmediate(function(){x.apply(E||null,S||[])})},i.inherits=function(x,S){function E(){}E.prototype=S.prototype,x.prototype=new E},i.extend=function(){var x,S,E={};for(x=0;x<arguments.length;x++)for(S in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],S)&&E[S]===void 0&&(E[S]=arguments[x][S]);return E},i.prepareContent=function(x,S,E,T,I){return h.Promise.resolve(S).then(function(D){return o.blob&&(D instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(D))!==-1)&&typeof FileReader<"u"?new h.Promise(function(B,$){var M=new FileReader;M.onload=function(O){B(O.target.result)},M.onerror=function(O){$(O.target.error)},M.readAsArrayBuffer(D)}):D}).then(function(D){var B=i.getTypeOf(D);return B?(B==="arraybuffer"?D=i.transformTo("uint8array",D):B==="string"&&(I?D=l.decode(D):E&&T!==!0&&(D=(function($){return p($,o.uint8array?new Uint8Array($.length):new Array($.length))})(D))),D):h.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./signature"),h=n("./zipEntry"),m=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var v=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(v)+", expected "+l.pretty(g)+")")}},isSignature:function(g,v){var _=this.reader.index;this.reader.setIndex(g);var C=this.reader.readString(4)===v;return this.reader.setIndex(_),C},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),v=m.uint8array?"uint8array":"array",_=l.transformTo(v,g);this.zipComment=this.loadOptions.decodeFileName(_)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,v,_,C=this.zip64EndOfCentralSize-44;0<C;)g=this.reader.readInt(2),v=this.reader.readInt(4),_=this.reader.readData(v),this.zip64ExtensibleData[g]={id:g,length:v,value:_}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,v;for(g=0;g<this.files.length;g++)v=this.files[g],this.reader.setIndex(v.localHeaderOffset),this.checkSignature(d.LOCAL_FILE_HEADER),v.readLocalPart(this.reader),v.handleUTF8(),v.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(d.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(d.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,d.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var v=g;if(this.checkSignature(d.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,d.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var _=this.centralDirOffset+this.centralDirSize;this.zip64&&(_+=20,_+=12+this.zip64EndOfCentralSize);var C=v-_;if(0<C)this.isSignature(v,d.CENTRAL_FILE_HEADER)||(this.reader.zero=C);else if(C<0)throw new Error("Corrupted zip: missing "+Math.abs(C)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./compressedObject"),h=n("./crc32"),m=n("./utf8"),p=n("./compressions"),g=n("./support");function v(_,C){this.options=_,this.loadOptions=C}v.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(_){var C,x;if(_.skip(22),this.fileNameLength=_.readInt(2),x=_.readInt(2),this.fileName=_.readData(this.fileNameLength),_.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((C=(function(S){for(var E in p)if(Object.prototype.hasOwnProperty.call(p,E)&&p[E].magic===S)return p[E];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new d(this.compressedSize,this.uncompressedSize,this.crc32,C,_.readData(this.compressedSize))},readCentralPart:function(_){this.versionMadeBy=_.readInt(2),_.skip(2),this.bitFlag=_.readInt(2),this.compressionMethod=_.readString(2),this.date=_.readDate(),this.crc32=_.readInt(4),this.compressedSize=_.readInt(4),this.uncompressedSize=_.readInt(4);var C=_.readInt(2);if(this.extraFieldsLength=_.readInt(2),this.fileCommentLength=_.readInt(2),this.diskNumberStart=_.readInt(2),this.internalFileAttributes=_.readInt(2),this.externalFileAttributes=_.readInt(4),this.localHeaderOffset=_.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");_.skip(C),this.readExtraFields(_),this.parseZIP64ExtraField(_),this.fileComment=_.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var _=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),_==0&&(this.dosPermissions=63&this.externalFileAttributes),_==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var _=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=_.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=_.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=_.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=_.readInt(4))}},readExtraFields:function(_){var C,x,S,E=_.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});_.index+4<E;)C=_.readInt(2),x=_.readInt(2),S=_.readData(x),this.extraFields[C]={id:C,length:x,value:S};_.setIndex(E)},handleUTF8:function(){var _=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=m.utf8decode(this.fileName),this.fileCommentStr=m.utf8decode(this.fileComment);else{var C=this.findExtraFieldUnicodePath();if(C!==null)this.fileNameStr=C;else{var x=l.transformTo(_,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var E=l.transformTo(_,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},findExtraFieldUnicodePath:function(){var _=this.extraFields[28789];if(_){var C=o(_.value);return C.readInt(1)!==1||h(this.fileName)!==C.readInt(4)?null:m.utf8decode(C.readData(_.length-5))}return null},findExtraFieldUnicodeComment:function(){var _=this.extraFields[25461];if(_){var C=o(_.value);return C.readInt(1)!==1||h(this.fileComment)!==C.readInt(4)?null:m.utf8decode(C.readData(_.length-5))}return null}},r.exports=v},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function o(C,x,S){this.name=C,this.dir=S.dir,this.date=S.date,this.comment=S.comment,this.unixPermissions=S.unixPermissions,this.dosPermissions=S.dosPermissions,this._data=x,this._dataBinary=S.binary,this.options={compression:S.compression,compressionOptions:S.compressionOptions}}var l=n("./stream/StreamHelper"),d=n("./stream/DataWorker"),h=n("./utf8"),m=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(C){var x=null,S="string";try{if(!C)throw new Error("No output type specified.");var E=(S=C.toLowerCase())==="string"||S==="text";S!=="binarystring"&&S!=="text"||(S="string"),x=this._decompressWorker();var T=!this._dataBinary;T&&!E&&(x=x.pipe(new h.Utf8EncodeWorker)),!T&&E&&(x=x.pipe(new h.Utf8DecodeWorker))}catch(I){(x=new p("error")).error(I)}return new l(x,S,"")},async:function(C,x){return this.internalStream(C).accumulate(x)},nodeStream:function(C,x){return this.internalStream(C||"nodebuffer").toNodejsStream(x)},_compressWorker:function(C,x){if(this._data instanceof m&&this._data.compression.magic===C.magic)return this._data.getCompressedWorker();var S=this._decompressWorker();return this._dataBinary||(S=S.pipe(new h.Utf8EncodeWorker)),m.createWorkerFrom(S,C,x)},_decompressWorker:function(){return this._data instanceof m?this._data.getContentWorker():this._data instanceof p?this._data:new d(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],v=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},_=0;_<g.length;_++)o.prototype[g[_]]=v;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(o){var l,d,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var m=0,p=new h(C),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=m=++m%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){C(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(C,0)};else{var v=new o.MessageChannel;v.port1.onmessage=C,l=function(){v.port2.postMessage(0)}}var _=[];function C(){var x,S;d=!0;for(var E=_.length;E;){for(S=_,_=[],x=-1;++x<E;)S[x]();E=_.length}d=!1}r.exports=function(x){_.push(x)!==1||d||l()}}).call(this,typeof zh<"u"?zh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var o=n("immediate");function l(){}var d={},h=["REJECTED"],m=["FULFILLED"],p=["PENDING"];function g(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,E!==l&&x(this,E)}function v(E,T,I){this.promise=E,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof I=="function"&&(this.onRejected=I,this.callRejected=this.otherCallRejected)}function _(E,T,I){o(function(){var D;try{D=T(I)}catch(B){return d.reject(E,B)}D===E?d.reject(E,new TypeError("Cannot resolve promise with itself")):d.resolve(E,D)})}function C(E){var T=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof T=="function")return function(){T.apply(E,arguments)}}function x(E,T){var I=!1;function D(M){I||(I=!0,d.reject(E,M))}function B(M){I||(I=!0,d.resolve(E,M))}var $=S(function(){T(B,D)});$.status==="error"&&D($.value)}function S(E,T){var I={};try{I.value=E(T),I.status="success"}catch(D){I.status="error",I.value=D}return I}(r.exports=g).prototype.finally=function(E){if(typeof E!="function")return this;var T=this.constructor;return this.then(function(I){return T.resolve(E()).then(function(){return I})},function(I){return T.resolve(E()).then(function(){throw I})})},g.prototype.catch=function(E){return this.then(null,E)},g.prototype.then=function(E,T){if(typeof E!="function"&&this.state===m||typeof T!="function"&&this.state===h)return this;var I=new this.constructor(l);return this.state!==p?_(I,this.state===m?E:T,this.outcome):this.queue.push(new v(I,E,T)),I},v.prototype.callFulfilled=function(E){d.resolve(this.promise,E)},v.prototype.otherCallFulfilled=function(E){_(this.promise,this.onFulfilled,E)},v.prototype.callRejected=function(E){d.reject(this.promise,E)},v.prototype.otherCallRejected=function(E){_(this.promise,this.onRejected,E)},d.resolve=function(E,T){var I=S(C,T);if(I.status==="error")return d.reject(E,I.value);var D=I.value;if(D)x(E,D);else{E.state=m,E.outcome=T;for(var B=-1,$=E.queue.length;++B<$;)E.queue[B].callFulfilled(T)}return E},d.reject=function(E,T){E.state=h,E.outcome=T;for(var I=-1,D=E.queue.length;++I<D;)E.queue[I].callRejected(T);return E},g.resolve=function(E){return E instanceof this?E:d.resolve(new this(l),E)},g.reject=function(E){var T=new this(l);return d.reject(T,E)},g.all=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var I=E.length,D=!1;if(!I)return this.resolve([]);for(var B=new Array(I),$=0,M=-1,O=new this(l);++M<I;)N(E[M],M);return O;function N(F,q){T.resolve(F).then(function(R){B[q]=R,++$!==I||D||(D=!0,d.resolve(O,B))},function(R){D||(D=!0,d.reject(O,R))})}},g.race=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var I=E.length,D=!1;if(!I)return this.resolve([]);for(var B=-1,$=new this(l);++B<I;)M=E[B],T.resolve(M).then(function(O){D||(D=!0,d.resolve($,O))},function(O){D||(D=!0,d.reject($,O))});var M;return $}},{immediate:36}],38:[function(n,r,i){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var o=n("./zlib/deflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/messages"),m=n("./zlib/zstream"),p=Object.prototype.toString,g=0,v=-1,_=0,C=8;function x(E){if(!(this instanceof x))return new x(E);this.options=l.assign({level:v,method:C,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},E||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var I=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(I!==g)throw new Error(h[I]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var D;if(D=typeof T.dictionary=="string"?d.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(I=o.deflateSetDictionary(this.strm,D))!==g)throw new Error(h[I]);this._dict_set=!0}}function S(E,T){var I=new x(T);if(I.push(E,!0),I.err)throw I.msg||h[I.err];return I.result}x.prototype.push=function(E,T){var I,D,B=this.strm,$=this.options.chunkSize;if(this.ended)return!1;D=T===~~T?T:T===!0?4:0,typeof E=="string"?B.input=d.string2buf(E):p.call(E)==="[object ArrayBuffer]"?B.input=new Uint8Array(E):B.input=E,B.next_in=0,B.avail_in=B.input.length;do{if(B.avail_out===0&&(B.output=new l.Buf8($),B.next_out=0,B.avail_out=$),(I=o.deflate(B,D))!==1&&I!==g)return this.onEnd(I),!(this.ended=!0);B.avail_out!==0&&(B.avail_in!==0||D!==4&&D!==2)||(this.options.to==="string"?this.onData(d.buf2binstring(l.shrinkBuf(B.output,B.next_out))):this.onData(l.shrinkBuf(B.output,B.next_out)))}while((0<B.avail_in||B.avail_out===0)&&I!==1);return D===4?(I=o.deflateEnd(this.strm),this.onEnd(I),this.ended=!0,I===g):D!==2||(this.onEnd(g),!(B.avail_out=0))},x.prototype.onData=function(E){this.chunks.push(E)},x.prototype.onEnd=function(E){E===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},i.Deflate=x,i.deflate=S,i.deflateRaw=function(E,T){return(T=T||{}).raw=!0,S(E,T)},i.gzip=function(E,T){return(T=T||{}).gzip=!0,S(E,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var o=n("./zlib/inflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/constants"),m=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),v=Object.prototype.toString;function _(x){if(!(this instanceof _))return new _(x);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},x||{});var S=this.options;S.raw&&0<=S.windowBits&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),!(0<=S.windowBits&&S.windowBits<16)||x&&x.windowBits||(S.windowBits+=32),15<S.windowBits&&S.windowBits<48&&(15&S.windowBits)==0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var E=o.inflateInit2(this.strm,S.windowBits);if(E!==h.Z_OK)throw new Error(m[E]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function C(x,S){var E=new _(S);if(E.push(x,!0),E.err)throw E.msg||m[E.err];return E.result}_.prototype.push=function(x,S){var E,T,I,D,B,$,M=this.strm,O=this.options.chunkSize,N=this.options.dictionary,F=!1;if(this.ended)return!1;T=S===~~S?S:S===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof x=="string"?M.input=d.binstring2buf(x):v.call(x)==="[object ArrayBuffer]"?M.input=new Uint8Array(x):M.input=x,M.next_in=0,M.avail_in=M.input.length;do{if(M.avail_out===0&&(M.output=new l.Buf8(O),M.next_out=0,M.avail_out=O),(E=o.inflate(M,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&N&&($=typeof N=="string"?d.string2buf(N):v.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,E=o.inflateSetDictionary(this.strm,$)),E===h.Z_BUF_ERROR&&F===!0&&(E=h.Z_OK,F=!1),E!==h.Z_STREAM_END&&E!==h.Z_OK)return this.onEnd(E),!(this.ended=!0);M.next_out&&(M.avail_out!==0&&E!==h.Z_STREAM_END&&(M.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(I=d.utf8border(M.output,M.next_out),D=M.next_out-I,B=d.buf2string(M.output,I),M.next_out=D,M.avail_out=O-D,D&&l.arraySet(M.output,M.output,I,D,0),this.onData(B)):this.onData(l.shrinkBuf(M.output,M.next_out)))),M.avail_in===0&&M.avail_out===0&&(F=!0)}while((0<M.avail_in||M.avail_out===0)&&E!==h.Z_STREAM_END);return E===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(E=o.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(M.avail_out=0))},_.prototype.onData=function(x){this.chunks.push(x)},_.prototype.onEnd=function(x){x===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},i.Inflate=_,i.inflate=C,i.inflateRaw=function(x,S){return(S=S||{}).raw=!0,C(x,S)},i.ungzip=C},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(h){for(var m=Array.prototype.slice.call(arguments,1);m.length;){var p=m.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},i.shrinkBuf=function(h,m){return h.length===m?h:h.subarray?h.subarray(0,m):(h.length=m,h)};var l={arraySet:function(h,m,p,g,v){if(m.subarray&&h.subarray)h.set(m.subarray(p,p+g),v);else for(var _=0;_<g;_++)h[v+_]=m[p+_]},flattenChunks:function(h){var m,p,g,v,_,C;for(m=g=0,p=h.length;m<p;m++)g+=h[m].length;for(C=new Uint8Array(g),m=v=0,p=h.length;m<p;m++)_=h[m],C.set(_,v),v+=_.length;return C}},d={arraySet:function(h,m,p,g,v){for(var _=0;_<g;_++)h[v+_]=m[p+_]},flattenChunks:function(h){return[].concat.apply([],h)}};i.setTyped=function(h){h?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,l)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,d))},i.setTyped(o)},{}],42:[function(n,r,i){var o=n("./common"),l=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var h=new o.Buf8(256),m=0;m<256;m++)h[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;function p(g,v){if(v<65537&&(g.subarray&&d||!g.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(g,v));for(var _="",C=0;C<v;C++)_+=String.fromCharCode(g[C]);return _}h[254]=h[254]=1,i.string2buf=function(g){var v,_,C,x,S,E=g.length,T=0;for(x=0;x<E;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<E&&(64512&(C=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(C-56320),x++),T+=_<128?1:_<2048?2:_<65536?3:4;for(v=new o.Buf8(T),x=S=0;S<T;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<E&&(64512&(C=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(C-56320),x++),_<128?v[S++]=_:(_<2048?v[S++]=192|_>>>6:(_<65536?v[S++]=224|_>>>12:(v[S++]=240|_>>>18,v[S++]=128|_>>>12&63),v[S++]=128|_>>>6&63),v[S++]=128|63&_);return v},i.buf2binstring=function(g){return p(g,g.length)},i.binstring2buf=function(g){for(var v=new o.Buf8(g.length),_=0,C=v.length;_<C;_++)v[_]=g.charCodeAt(_);return v},i.buf2string=function(g,v){var _,C,x,S,E=v||g.length,T=new Array(2*E);for(_=C=0;_<E;)if((x=g[_++])<128)T[C++]=x;else if(4<(S=h[x]))T[C++]=65533,_+=S-1;else{for(x&=S===2?31:S===3?15:7;1<S&&_<E;)x=x<<6|63&g[_++],S--;1<S?T[C++]=65533:x<65536?T[C++]=x:(x-=65536,T[C++]=55296|x>>10&1023,T[C++]=56320|1023&x)}return p(T,C)},i.utf8border=function(g,v){var _;for((v=v||g.length)>g.length&&(v=g.length),_=v-1;0<=_&&(192&g[_])==128;)_--;return _<0||_===0?v:_+h[g[_]]>v?_:v}},{"./common":41}],43:[function(n,r,i){r.exports=function(o,l,d,h){for(var m=65535&o|0,p=o>>>16&65535|0,g=0;d!==0;){for(d-=g=2e3<d?2e3:d;p=p+(m=m+l[h++]|0)|0,--g;);m%=65521,p%=65521}return m|p<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var o=(function(){for(var l,d=[],h=0;h<256;h++){l=h;for(var m=0;m<8;m++)l=1&l?3988292384^l>>>1:l>>>1;d[h]=l}return d})();r.exports=function(l,d,h,m){var p=o,g=m+h;l^=-1;for(var v=m;v<g;v++)l=l>>>8^p[255&(l^d[v])];return-1^l}},{}],46:[function(n,r,i){var o,l=n("../utils/common"),d=n("./trees"),h=n("./adler32"),m=n("./crc32"),p=n("./messages"),g=0,v=4,_=0,C=-2,x=-1,S=4,E=2,T=8,I=9,D=286,B=30,$=19,M=2*D+1,O=15,N=3,F=258,q=F+N+1,R=42,P=113,A=1,W=2,K=3,G=4;function J(U,ce){return U.msg=p[ce],ce}function X(U){return(U<<1)-(4<U?9:0)}function ie(U){for(var ce=U.length;0<=--ce;)U[ce]=0}function L(U){var ce=U.state,ye=ce.pending;ye>U.avail_out&&(ye=U.avail_out),ye!==0&&(l.arraySet(U.output,ce.pending_buf,ce.pending_out,ye,U.next_out),U.next_out+=ye,ce.pending_out+=ye,U.total_out+=ye,U.avail_out-=ye,ce.pending-=ye,ce.pending===0&&(ce.pending_out=0))}function H(U,ce){d._tr_flush_block(U,0<=U.block_start?U.block_start:-1,U.strstart-U.block_start,ce),U.block_start=U.strstart,L(U.strm)}function te(U,ce){U.pending_buf[U.pending++]=ce}function se(U,ce){U.pending_buf[U.pending++]=ce>>>8&255,U.pending_buf[U.pending++]=255&ce}function ne(U,ce){var ye,ee,Z=U.max_chain_length,oe=U.strstart,Se=U.prev_length,we=U.nice_match,ae=U.strstart>U.w_size-q?U.strstart-(U.w_size-q):0,Ae=U.window,Ne=U.w_mask,De=U.prev,He=U.strstart+F,wt=Ae[oe+Se-1],nt=Ae[oe+Se];U.prev_length>=U.good_match&&(Z>>=2),we>U.lookahead&&(we=U.lookahead);do if(Ae[(ye=ce)+Se]===nt&&Ae[ye+Se-1]===wt&&Ae[ye]===Ae[oe]&&Ae[++ye]===Ae[oe+1]){oe+=2,ye++;do;while(Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&Ae[++oe]===Ae[++ye]&&oe<He);if(ee=F-(He-oe),oe=He-F,Se<ee){if(U.match_start=ce,we<=(Se=ee))break;wt=Ae[oe+Se-1],nt=Ae[oe+Se]}}while((ce=De[ce&Ne])>ae&&--Z!=0);return Se<=U.lookahead?Se:U.lookahead}function fe(U){var ce,ye,ee,Z,oe,Se,we,ae,Ae,Ne,De=U.w_size;do{if(Z=U.window_size-U.lookahead-U.strstart,U.strstart>=De+(De-q)){for(l.arraySet(U.window,U.window,De,De,0),U.match_start-=De,U.strstart-=De,U.block_start-=De,ce=ye=U.hash_size;ee=U.head[--ce],U.head[ce]=De<=ee?ee-De:0,--ye;);for(ce=ye=De;ee=U.prev[--ce],U.prev[ce]=De<=ee?ee-De:0,--ye;);Z+=De}if(U.strm.avail_in===0)break;if(Se=U.strm,we=U.window,ae=U.strstart+U.lookahead,Ae=Z,Ne=void 0,Ne=Se.avail_in,Ae<Ne&&(Ne=Ae),ye=Ne===0?0:(Se.avail_in-=Ne,l.arraySet(we,Se.input,Se.next_in,Ne,ae),Se.state.wrap===1?Se.adler=h(Se.adler,we,Ne,ae):Se.state.wrap===2&&(Se.adler=m(Se.adler,we,Ne,ae)),Se.next_in+=Ne,Se.total_in+=Ne,Ne),U.lookahead+=ye,U.lookahead+U.insert>=N)for(oe=U.strstart-U.insert,U.ins_h=U.window[oe],U.ins_h=(U.ins_h<<U.hash_shift^U.window[oe+1])&U.hash_mask;U.insert&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[oe+N-1])&U.hash_mask,U.prev[oe&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=oe,oe++,U.insert--,!(U.lookahead+U.insert<N)););}while(U.lookahead<q&&U.strm.avail_in!==0)}function Ce(U,ce){for(var ye,ee;;){if(U.lookahead<q){if(fe(U),U.lookahead<q&&ce===g)return A;if(U.lookahead===0)break}if(ye=0,U.lookahead>=N&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+N-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),ye!==0&&U.strstart-ye<=U.w_size-q&&(U.match_length=ne(U,ye)),U.match_length>=N)if(ee=d._tr_tally(U,U.strstart-U.match_start,U.match_length-N),U.lookahead-=U.match_length,U.match_length<=U.max_lazy_match&&U.lookahead>=N){for(U.match_length--;U.strstart++,U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+N-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart,--U.match_length!=0;);U.strstart++}else U.strstart+=U.match_length,U.match_length=0,U.ins_h=U.window[U.strstart],U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+1])&U.hash_mask;else ee=d._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++;if(ee&&(H(U,!1),U.strm.avail_out===0))return A}return U.insert=U.strstart<N-1?U.strstart:N-1,ce===v?(H(U,!0),U.strm.avail_out===0?K:G):U.last_lit&&(H(U,!1),U.strm.avail_out===0)?A:W}function de(U,ce){for(var ye,ee,Z;;){if(U.lookahead<q){if(fe(U),U.lookahead<q&&ce===g)return A;if(U.lookahead===0)break}if(ye=0,U.lookahead>=N&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+N-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),U.prev_length=U.match_length,U.prev_match=U.match_start,U.match_length=N-1,ye!==0&&U.prev_length<U.max_lazy_match&&U.strstart-ye<=U.w_size-q&&(U.match_length=ne(U,ye),U.match_length<=5&&(U.strategy===1||U.match_length===N&&4096<U.strstart-U.match_start)&&(U.match_length=N-1)),U.prev_length>=N&&U.match_length<=U.prev_length){for(Z=U.strstart+U.lookahead-N,ee=d._tr_tally(U,U.strstart-1-U.prev_match,U.prev_length-N),U.lookahead-=U.prev_length-1,U.prev_length-=2;++U.strstart<=Z&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+N-1])&U.hash_mask,ye=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),--U.prev_length!=0;);if(U.match_available=0,U.match_length=N-1,U.strstart++,ee&&(H(U,!1),U.strm.avail_out===0))return A}else if(U.match_available){if((ee=d._tr_tally(U,0,U.window[U.strstart-1]))&&H(U,!1),U.strstart++,U.lookahead--,U.strm.avail_out===0)return A}else U.match_available=1,U.strstart++,U.lookahead--}return U.match_available&&(ee=d._tr_tally(U,0,U.window[U.strstart-1]),U.match_available=0),U.insert=U.strstart<N-1?U.strstart:N-1,ce===v?(H(U,!0),U.strm.avail_out===0?K:G):U.last_lit&&(H(U,!1),U.strm.avail_out===0)?A:W}function be(U,ce,ye,ee,Z){this.good_length=U,this.max_lazy=ce,this.nice_length=ye,this.max_chain=ee,this.func=Z}function Me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*M),this.dyn_dtree=new l.Buf16(2*(2*B+1)),this.bl_tree=new l.Buf16(2*(2*$+1)),ie(this.dyn_ltree),ie(this.dyn_dtree),ie(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(O+1),this.heap=new l.Buf16(2*D+1),ie(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*D+1),ie(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Oe(U){var ce;return U&&U.state?(U.total_in=U.total_out=0,U.data_type=E,(ce=U.state).pending=0,ce.pending_out=0,ce.wrap<0&&(ce.wrap=-ce.wrap),ce.status=ce.wrap?R:P,U.adler=ce.wrap===2?0:1,ce.last_flush=g,d._tr_init(ce),_):J(U,C)}function qe(U){var ce=Oe(U);return ce===_&&(function(ye){ye.window_size=2*ye.w_size,ie(ye.head),ye.max_lazy_match=o[ye.level].max_lazy,ye.good_match=o[ye.level].good_length,ye.nice_match=o[ye.level].nice_length,ye.max_chain_length=o[ye.level].max_chain,ye.strstart=0,ye.block_start=0,ye.lookahead=0,ye.insert=0,ye.match_length=ye.prev_length=N-1,ye.match_available=0,ye.ins_h=0})(U.state),ce}function ot(U,ce,ye,ee,Z,oe){if(!U)return C;var Se=1;if(ce===x&&(ce=6),ee<0?(Se=0,ee=-ee):15<ee&&(Se=2,ee-=16),Z<1||I<Z||ye!==T||ee<8||15<ee||ce<0||9<ce||oe<0||S<oe)return J(U,C);ee===8&&(ee=9);var we=new Me;return(U.state=we).strm=U,we.wrap=Se,we.gzhead=null,we.w_bits=ee,we.w_size=1<<we.w_bits,we.w_mask=we.w_size-1,we.hash_bits=Z+7,we.hash_size=1<<we.hash_bits,we.hash_mask=we.hash_size-1,we.hash_shift=~~((we.hash_bits+N-1)/N),we.window=new l.Buf8(2*we.w_size),we.head=new l.Buf16(we.hash_size),we.prev=new l.Buf16(we.w_size),we.lit_bufsize=1<<Z+6,we.pending_buf_size=4*we.lit_bufsize,we.pending_buf=new l.Buf8(we.pending_buf_size),we.d_buf=1*we.lit_bufsize,we.l_buf=3*we.lit_bufsize,we.level=ce,we.strategy=oe,we.method=ye,qe(U)}o=[new be(0,0,0,0,function(U,ce){var ye=65535;for(ye>U.pending_buf_size-5&&(ye=U.pending_buf_size-5);;){if(U.lookahead<=1){if(fe(U),U.lookahead===0&&ce===g)return A;if(U.lookahead===0)break}U.strstart+=U.lookahead,U.lookahead=0;var ee=U.block_start+ye;if((U.strstart===0||U.strstart>=ee)&&(U.lookahead=U.strstart-ee,U.strstart=ee,H(U,!1),U.strm.avail_out===0)||U.strstart-U.block_start>=U.w_size-q&&(H(U,!1),U.strm.avail_out===0))return A}return U.insert=0,ce===v?(H(U,!0),U.strm.avail_out===0?K:G):(U.strstart>U.block_start&&(H(U,!1),U.strm.avail_out),A)}),new be(4,4,8,4,Ce),new be(4,5,16,8,Ce),new be(4,6,32,32,Ce),new be(4,4,16,16,de),new be(8,16,32,32,de),new be(8,16,128,128,de),new be(8,32,128,256,de),new be(32,128,258,1024,de),new be(32,258,258,4096,de)],i.deflateInit=function(U,ce){return ot(U,ce,T,15,8,0)},i.deflateInit2=ot,i.deflateReset=qe,i.deflateResetKeep=Oe,i.deflateSetHeader=function(U,ce){return U&&U.state?U.state.wrap!==2?C:(U.state.gzhead=ce,_):C},i.deflate=function(U,ce){var ye,ee,Z,oe;if(!U||!U.state||5<ce||ce<0)return U?J(U,C):C;if(ee=U.state,!U.output||!U.input&&U.avail_in!==0||ee.status===666&&ce!==v)return J(U,U.avail_out===0?-5:C);if(ee.strm=U,ye=ee.last_flush,ee.last_flush=ce,ee.status===R)if(ee.wrap===2)U.adler=0,te(ee,31),te(ee,139),te(ee,8),ee.gzhead?(te(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),te(ee,255&ee.gzhead.time),te(ee,ee.gzhead.time>>8&255),te(ee,ee.gzhead.time>>16&255),te(ee,ee.gzhead.time>>24&255),te(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),te(ee,255&ee.gzhead.os),ee.gzhead.extra&&ee.gzhead.extra.length&&(te(ee,255&ee.gzhead.extra.length),te(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(U.adler=m(U.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=69):(te(ee,0),te(ee,0),te(ee,0),te(ee,0),te(ee,0),te(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),te(ee,3),ee.status=P);else{var Se=T+(ee.w_bits-8<<4)<<8;Se|=(2<=ee.strategy||ee.level<2?0:ee.level<6?1:ee.level===6?2:3)<<6,ee.strstart!==0&&(Se|=32),Se+=31-Se%31,ee.status=P,se(ee,Se),ee.strstart!==0&&(se(ee,U.adler>>>16),se(ee,65535&U.adler)),U.adler=1}if(ee.status===69)if(ee.gzhead.extra){for(Z=ee.pending;ee.gzindex<(65535&ee.gzhead.extra.length)&&(ee.pending!==ee.pending_buf_size||(ee.gzhead.hcrc&&ee.pending>Z&&(U.adler=m(U.adler,ee.pending_buf,ee.pending-Z,Z)),L(U),Z=ee.pending,ee.pending!==ee.pending_buf_size));)te(ee,255&ee.gzhead.extra[ee.gzindex]),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>Z&&(U.adler=m(U.adler,ee.pending_buf,ee.pending-Z,Z)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=73)}else ee.status=73;if(ee.status===73)if(ee.gzhead.name){Z=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>Z&&(U.adler=m(U.adler,ee.pending_buf,ee.pending-Z,Z)),L(U),Z=ee.pending,ee.pending===ee.pending_buf_size)){oe=1;break}oe=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0,te(ee,oe)}while(oe!==0);ee.gzhead.hcrc&&ee.pending>Z&&(U.adler=m(U.adler,ee.pending_buf,ee.pending-Z,Z)),oe===0&&(ee.gzindex=0,ee.status=91)}else ee.status=91;if(ee.status===91)if(ee.gzhead.comment){Z=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>Z&&(U.adler=m(U.adler,ee.pending_buf,ee.pending-Z,Z)),L(U),Z=ee.pending,ee.pending===ee.pending_buf_size)){oe=1;break}oe=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0,te(ee,oe)}while(oe!==0);ee.gzhead.hcrc&&ee.pending>Z&&(U.adler=m(U.adler,ee.pending_buf,ee.pending-Z,Z)),oe===0&&(ee.status=103)}else ee.status=103;if(ee.status===103&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&L(U),ee.pending+2<=ee.pending_buf_size&&(te(ee,255&U.adler),te(ee,U.adler>>8&255),U.adler=0,ee.status=P)):ee.status=P),ee.pending!==0){if(L(U),U.avail_out===0)return ee.last_flush=-1,_}else if(U.avail_in===0&&X(ce)<=X(ye)&&ce!==v)return J(U,-5);if(ee.status===666&&U.avail_in!==0)return J(U,-5);if(U.avail_in!==0||ee.lookahead!==0||ce!==g&&ee.status!==666){var we=ee.strategy===2?(function(ae,Ae){for(var Ne;;){if(ae.lookahead===0&&(fe(ae),ae.lookahead===0)){if(Ae===g)return A;break}if(ae.match_length=0,Ne=d._tr_tally(ae,0,ae.window[ae.strstart]),ae.lookahead--,ae.strstart++,Ne&&(H(ae,!1),ae.strm.avail_out===0))return A}return ae.insert=0,Ae===v?(H(ae,!0),ae.strm.avail_out===0?K:G):ae.last_lit&&(H(ae,!1),ae.strm.avail_out===0)?A:W})(ee,ce):ee.strategy===3?(function(ae,Ae){for(var Ne,De,He,wt,nt=ae.window;;){if(ae.lookahead<=F){if(fe(ae),ae.lookahead<=F&&Ae===g)return A;if(ae.lookahead===0)break}if(ae.match_length=0,ae.lookahead>=N&&0<ae.strstart&&(De=nt[He=ae.strstart-1])===nt[++He]&&De===nt[++He]&&De===nt[++He]){wt=ae.strstart+F;do;while(De===nt[++He]&&De===nt[++He]&&De===nt[++He]&&De===nt[++He]&&De===nt[++He]&&De===nt[++He]&&De===nt[++He]&&De===nt[++He]&&He<wt);ae.match_length=F-(wt-He),ae.match_length>ae.lookahead&&(ae.match_length=ae.lookahead)}if(ae.match_length>=N?(Ne=d._tr_tally(ae,1,ae.match_length-N),ae.lookahead-=ae.match_length,ae.strstart+=ae.match_length,ae.match_length=0):(Ne=d._tr_tally(ae,0,ae.window[ae.strstart]),ae.lookahead--,ae.strstart++),Ne&&(H(ae,!1),ae.strm.avail_out===0))return A}return ae.insert=0,Ae===v?(H(ae,!0),ae.strm.avail_out===0?K:G):ae.last_lit&&(H(ae,!1),ae.strm.avail_out===0)?A:W})(ee,ce):o[ee.level].func(ee,ce);if(we!==K&&we!==G||(ee.status=666),we===A||we===K)return U.avail_out===0&&(ee.last_flush=-1),_;if(we===W&&(ce===1?d._tr_align(ee):ce!==5&&(d._tr_stored_block(ee,0,0,!1),ce===3&&(ie(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),L(U),U.avail_out===0))return ee.last_flush=-1,_}return ce!==v?_:ee.wrap<=0?1:(ee.wrap===2?(te(ee,255&U.adler),te(ee,U.adler>>8&255),te(ee,U.adler>>16&255),te(ee,U.adler>>24&255),te(ee,255&U.total_in),te(ee,U.total_in>>8&255),te(ee,U.total_in>>16&255),te(ee,U.total_in>>24&255)):(se(ee,U.adler>>>16),se(ee,65535&U.adler)),L(U),0<ee.wrap&&(ee.wrap=-ee.wrap),ee.pending!==0?_:1)},i.deflateEnd=function(U){var ce;return U&&U.state?(ce=U.state.status)!==R&&ce!==69&&ce!==73&&ce!==91&&ce!==103&&ce!==P&&ce!==666?J(U,C):(U.state=null,ce===P?J(U,-3):_):C},i.deflateSetDictionary=function(U,ce){var ye,ee,Z,oe,Se,we,ae,Ae,Ne=ce.length;if(!U||!U.state||(oe=(ye=U.state).wrap)===2||oe===1&&ye.status!==R||ye.lookahead)return C;for(oe===1&&(U.adler=h(U.adler,ce,Ne,0)),ye.wrap=0,Ne>=ye.w_size&&(oe===0&&(ie(ye.head),ye.strstart=0,ye.block_start=0,ye.insert=0),Ae=new l.Buf8(ye.w_size),l.arraySet(Ae,ce,Ne-ye.w_size,ye.w_size,0),ce=Ae,Ne=ye.w_size),Se=U.avail_in,we=U.next_in,ae=U.input,U.avail_in=Ne,U.next_in=0,U.input=ce,fe(ye);ye.lookahead>=N;){for(ee=ye.strstart,Z=ye.lookahead-(N-1);ye.ins_h=(ye.ins_h<<ye.hash_shift^ye.window[ee+N-1])&ye.hash_mask,ye.prev[ee&ye.w_mask]=ye.head[ye.ins_h],ye.head[ye.ins_h]=ee,ee++,--Z;);ye.strstart=ee,ye.lookahead=N-1,fe(ye)}return ye.strstart+=ye.lookahead,ye.block_start=ye.strstart,ye.insert=ye.lookahead,ye.lookahead=0,ye.match_length=ye.prev_length=N-1,ye.match_available=0,U.next_in=we,U.input=ae,U.avail_in=Se,ye.wrap=oe,_},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(o,l){var d,h,m,p,g,v,_,C,x,S,E,T,I,D,B,$,M,O,N,F,q,R,P,A,W;d=o.state,h=o.next_in,A=o.input,m=h+(o.avail_in-5),p=o.next_out,W=o.output,g=p-(l-o.avail_out),v=p+(o.avail_out-257),_=d.dmax,C=d.wsize,x=d.whave,S=d.wnext,E=d.window,T=d.hold,I=d.bits,D=d.lencode,B=d.distcode,$=(1<<d.lenbits)-1,M=(1<<d.distbits)-1;e:do{I<15&&(T+=A[h++]<<I,I+=8,T+=A[h++]<<I,I+=8),O=D[T&$];t:for(;;){if(T>>>=N=O>>>24,I-=N,(N=O>>>16&255)===0)W[p++]=65535&O;else{if(!(16&N)){if((64&N)==0){O=D[(65535&O)+(T&(1<<N)-1)];continue t}if(32&N){d.mode=12;break e}o.msg="invalid literal/length code",d.mode=30;break e}F=65535&O,(N&=15)&&(I<N&&(T+=A[h++]<<I,I+=8),F+=T&(1<<N)-1,T>>>=N,I-=N),I<15&&(T+=A[h++]<<I,I+=8,T+=A[h++]<<I,I+=8),O=B[T&M];n:for(;;){if(T>>>=N=O>>>24,I-=N,!(16&(N=O>>>16&255))){if((64&N)==0){O=B[(65535&O)+(T&(1<<N)-1)];continue n}o.msg="invalid distance code",d.mode=30;break e}if(q=65535&O,I<(N&=15)&&(T+=A[h++]<<I,(I+=8)<N&&(T+=A[h++]<<I,I+=8)),_<(q+=T&(1<<N)-1)){o.msg="invalid distance too far back",d.mode=30;break e}if(T>>>=N,I-=N,(N=p-g)<q){if(x<(N=q-N)&&d.sane){o.msg="invalid distance too far back",d.mode=30;break e}if(P=E,(R=0)===S){if(R+=C-N,N<F){for(F-=N;W[p++]=E[R++],--N;);R=p-q,P=W}}else if(S<N){if(R+=C+S-N,(N-=S)<F){for(F-=N;W[p++]=E[R++],--N;);if(R=0,S<F){for(F-=N=S;W[p++]=E[R++],--N;);R=p-q,P=W}}}else if(R+=S-N,N<F){for(F-=N;W[p++]=E[R++],--N;);R=p-q,P=W}for(;2<F;)W[p++]=P[R++],W[p++]=P[R++],W[p++]=P[R++],F-=3;F&&(W[p++]=P[R++],1<F&&(W[p++]=P[R++]))}else{for(R=p-q;W[p++]=W[R++],W[p++]=W[R++],W[p++]=W[R++],2<(F-=3););F&&(W[p++]=W[R++],1<F&&(W[p++]=W[R++]))}break}}break}}while(h<m&&p<v);h-=F=I>>3,T&=(1<<(I-=F<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<m?m-h+5:5-(h-m),o.avail_out=p<v?v-p+257:257-(p-v),d.hold=T,d.bits=I}},{}],49:[function(n,r,i){var o=n("../utils/common"),l=n("./adler32"),d=n("./crc32"),h=n("./inffast"),m=n("./inftrees"),p=1,g=2,v=0,_=-2,C=1,x=852,S=592;function E(R){return(R>>>24&255)+(R>>>8&65280)+((65280&R)<<8)+((255&R)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function I(R){var P;return R&&R.state?(P=R.state,R.total_in=R.total_out=P.total=0,R.msg="",P.wrap&&(R.adler=1&P.wrap),P.mode=C,P.last=0,P.havedict=0,P.dmax=32768,P.head=null,P.hold=0,P.bits=0,P.lencode=P.lendyn=new o.Buf32(x),P.distcode=P.distdyn=new o.Buf32(S),P.sane=1,P.back=-1,v):_}function D(R){var P;return R&&R.state?((P=R.state).wsize=0,P.whave=0,P.wnext=0,I(R)):_}function B(R,P){var A,W;return R&&R.state?(W=R.state,P<0?(A=0,P=-P):(A=1+(P>>4),P<48&&(P&=15)),P&&(P<8||15<P)?_:(W.window!==null&&W.wbits!==P&&(W.window=null),W.wrap=A,W.wbits=P,D(R))):_}function $(R,P){var A,W;return R?(W=new T,(R.state=W).window=null,(A=B(R,P))!==v&&(R.state=null),A):_}var M,O,N=!0;function F(R){if(N){var P;for(M=new o.Buf32(512),O=new o.Buf32(32),P=0;P<144;)R.lens[P++]=8;for(;P<256;)R.lens[P++]=9;for(;P<280;)R.lens[P++]=7;for(;P<288;)R.lens[P++]=8;for(m(p,R.lens,0,288,M,0,R.work,{bits:9}),P=0;P<32;)R.lens[P++]=5;m(g,R.lens,0,32,O,0,R.work,{bits:5}),N=!1}R.lencode=M,R.lenbits=9,R.distcode=O,R.distbits=5}function q(R,P,A,W){var K,G=R.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new o.Buf8(G.wsize)),W>=G.wsize?(o.arraySet(G.window,P,A-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(W<(K=G.wsize-G.wnext)&&(K=W),o.arraySet(G.window,P,A-W,K,G.wnext),(W-=K)?(o.arraySet(G.window,P,A-W,W,0),G.wnext=W,G.whave=G.wsize):(G.wnext+=K,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=K))),0}i.inflateReset=D,i.inflateReset2=B,i.inflateResetKeep=I,i.inflateInit=function(R){return $(R,15)},i.inflateInit2=$,i.inflate=function(R,P){var A,W,K,G,J,X,ie,L,H,te,se,ne,fe,Ce,de,be,Me,Oe,qe,ot,U,ce,ye,ee,Z=0,oe=new o.Buf8(4),Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!R||!R.state||!R.output||!R.input&&R.avail_in!==0)return _;(A=R.state).mode===12&&(A.mode=13),J=R.next_out,K=R.output,ie=R.avail_out,G=R.next_in,W=R.input,X=R.avail_in,L=A.hold,H=A.bits,te=X,se=ie,ce=v;e:for(;;)switch(A.mode){case C:if(A.wrap===0){A.mode=13;break}for(;H<16;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}if(2&A.wrap&&L===35615){oe[A.check=0]=255&L,oe[1]=L>>>8&255,A.check=d(A.check,oe,2,0),H=L=0,A.mode=2;break}if(A.flags=0,A.head&&(A.head.done=!1),!(1&A.wrap)||(((255&L)<<8)+(L>>8))%31){R.msg="incorrect header check",A.mode=30;break}if((15&L)!=8){R.msg="unknown compression method",A.mode=30;break}if(H-=4,U=8+(15&(L>>>=4)),A.wbits===0)A.wbits=U;else if(U>A.wbits){R.msg="invalid window size",A.mode=30;break}A.dmax=1<<U,R.adler=A.check=1,A.mode=512&L?10:12,H=L=0;break;case 2:for(;H<16;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}if(A.flags=L,(255&A.flags)!=8){R.msg="unknown compression method",A.mode=30;break}if(57344&A.flags){R.msg="unknown header flags set",A.mode=30;break}A.head&&(A.head.text=L>>8&1),512&A.flags&&(oe[0]=255&L,oe[1]=L>>>8&255,A.check=d(A.check,oe,2,0)),H=L=0,A.mode=3;case 3:for(;H<32;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}A.head&&(A.head.time=L),512&A.flags&&(oe[0]=255&L,oe[1]=L>>>8&255,oe[2]=L>>>16&255,oe[3]=L>>>24&255,A.check=d(A.check,oe,4,0)),H=L=0,A.mode=4;case 4:for(;H<16;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}A.head&&(A.head.xflags=255&L,A.head.os=L>>8),512&A.flags&&(oe[0]=255&L,oe[1]=L>>>8&255,A.check=d(A.check,oe,2,0)),H=L=0,A.mode=5;case 5:if(1024&A.flags){for(;H<16;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}A.length=L,A.head&&(A.head.extra_len=L),512&A.flags&&(oe[0]=255&L,oe[1]=L>>>8&255,A.check=d(A.check,oe,2,0)),H=L=0}else A.head&&(A.head.extra=null);A.mode=6;case 6:if(1024&A.flags&&(X<(ne=A.length)&&(ne=X),ne&&(A.head&&(U=A.head.extra_len-A.length,A.head.extra||(A.head.extra=new Array(A.head.extra_len)),o.arraySet(A.head.extra,W,G,ne,U)),512&A.flags&&(A.check=d(A.check,W,ne,G)),X-=ne,G+=ne,A.length-=ne),A.length))break e;A.length=0,A.mode=7;case 7:if(2048&A.flags){if(X===0)break e;for(ne=0;U=W[G+ne++],A.head&&U&&A.length<65536&&(A.head.name+=String.fromCharCode(U)),U&&ne<X;);if(512&A.flags&&(A.check=d(A.check,W,ne,G)),X-=ne,G+=ne,U)break e}else A.head&&(A.head.name=null);A.length=0,A.mode=8;case 8:if(4096&A.flags){if(X===0)break e;for(ne=0;U=W[G+ne++],A.head&&U&&A.length<65536&&(A.head.comment+=String.fromCharCode(U)),U&&ne<X;);if(512&A.flags&&(A.check=d(A.check,W,ne,G)),X-=ne,G+=ne,U)break e}else A.head&&(A.head.comment=null);A.mode=9;case 9:if(512&A.flags){for(;H<16;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}if(L!==(65535&A.check)){R.msg="header crc mismatch",A.mode=30;break}H=L=0}A.head&&(A.head.hcrc=A.flags>>9&1,A.head.done=!0),R.adler=A.check=0,A.mode=12;break;case 10:for(;H<32;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}R.adler=A.check=E(L),H=L=0,A.mode=11;case 11:if(A.havedict===0)return R.next_out=J,R.avail_out=ie,R.next_in=G,R.avail_in=X,A.hold=L,A.bits=H,2;R.adler=A.check=1,A.mode=12;case 12:if(P===5||P===6)break e;case 13:if(A.last){L>>>=7&H,H-=7&H,A.mode=27;break}for(;H<3;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}switch(A.last=1&L,H-=1,3&(L>>>=1)){case 0:A.mode=14;break;case 1:if(F(A),A.mode=20,P!==6)break;L>>>=2,H-=2;break e;case 2:A.mode=17;break;case 3:R.msg="invalid block type",A.mode=30}L>>>=2,H-=2;break;case 14:for(L>>>=7&H,H-=7&H;H<32;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}if((65535&L)!=(L>>>16^65535)){R.msg="invalid stored block lengths",A.mode=30;break}if(A.length=65535&L,H=L=0,A.mode=15,P===6)break e;case 15:A.mode=16;case 16:if(ne=A.length){if(X<ne&&(ne=X),ie<ne&&(ne=ie),ne===0)break e;o.arraySet(K,W,G,ne,J),X-=ne,G+=ne,ie-=ne,J+=ne,A.length-=ne;break}A.mode=12;break;case 17:for(;H<14;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}if(A.nlen=257+(31&L),L>>>=5,H-=5,A.ndist=1+(31&L),L>>>=5,H-=5,A.ncode=4+(15&L),L>>>=4,H-=4,286<A.nlen||30<A.ndist){R.msg="too many length or distance symbols",A.mode=30;break}A.have=0,A.mode=18;case 18:for(;A.have<A.ncode;){for(;H<3;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}A.lens[Se[A.have++]]=7&L,L>>>=3,H-=3}for(;A.have<19;)A.lens[Se[A.have++]]=0;if(A.lencode=A.lendyn,A.lenbits=7,ye={bits:A.lenbits},ce=m(0,A.lens,0,19,A.lencode,0,A.work,ye),A.lenbits=ye.bits,ce){R.msg="invalid code lengths set",A.mode=30;break}A.have=0,A.mode=19;case 19:for(;A.have<A.nlen+A.ndist;){for(;be=(Z=A.lencode[L&(1<<A.lenbits)-1])>>>16&255,Me=65535&Z,!((de=Z>>>24)<=H);){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}if(Me<16)L>>>=de,H-=de,A.lens[A.have++]=Me;else{if(Me===16){for(ee=de+2;H<ee;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}if(L>>>=de,H-=de,A.have===0){R.msg="invalid bit length repeat",A.mode=30;break}U=A.lens[A.have-1],ne=3+(3&L),L>>>=2,H-=2}else if(Me===17){for(ee=de+3;H<ee;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}H-=de,U=0,ne=3+(7&(L>>>=de)),L>>>=3,H-=3}else{for(ee=de+7;H<ee;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}H-=de,U=0,ne=11+(127&(L>>>=de)),L>>>=7,H-=7}if(A.have+ne>A.nlen+A.ndist){R.msg="invalid bit length repeat",A.mode=30;break}for(;ne--;)A.lens[A.have++]=U}}if(A.mode===30)break;if(A.lens[256]===0){R.msg="invalid code -- missing end-of-block",A.mode=30;break}if(A.lenbits=9,ye={bits:A.lenbits},ce=m(p,A.lens,0,A.nlen,A.lencode,0,A.work,ye),A.lenbits=ye.bits,ce){R.msg="invalid literal/lengths set",A.mode=30;break}if(A.distbits=6,A.distcode=A.distdyn,ye={bits:A.distbits},ce=m(g,A.lens,A.nlen,A.ndist,A.distcode,0,A.work,ye),A.distbits=ye.bits,ce){R.msg="invalid distances set",A.mode=30;break}if(A.mode=20,P===6)break e;case 20:A.mode=21;case 21:if(6<=X&&258<=ie){R.next_out=J,R.avail_out=ie,R.next_in=G,R.avail_in=X,A.hold=L,A.bits=H,h(R,se),J=R.next_out,K=R.output,ie=R.avail_out,G=R.next_in,W=R.input,X=R.avail_in,L=A.hold,H=A.bits,A.mode===12&&(A.back=-1);break}for(A.back=0;be=(Z=A.lencode[L&(1<<A.lenbits)-1])>>>16&255,Me=65535&Z,!((de=Z>>>24)<=H);){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}if(be&&(240&be)==0){for(Oe=de,qe=be,ot=Me;be=(Z=A.lencode[ot+((L&(1<<Oe+qe)-1)>>Oe)])>>>16&255,Me=65535&Z,!(Oe+(de=Z>>>24)<=H);){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}L>>>=Oe,H-=Oe,A.back+=Oe}if(L>>>=de,H-=de,A.back+=de,A.length=Me,be===0){A.mode=26;break}if(32&be){A.back=-1,A.mode=12;break}if(64&be){R.msg="invalid literal/length code",A.mode=30;break}A.extra=15&be,A.mode=22;case 22:if(A.extra){for(ee=A.extra;H<ee;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}A.length+=L&(1<<A.extra)-1,L>>>=A.extra,H-=A.extra,A.back+=A.extra}A.was=A.length,A.mode=23;case 23:for(;be=(Z=A.distcode[L&(1<<A.distbits)-1])>>>16&255,Me=65535&Z,!((de=Z>>>24)<=H);){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}if((240&be)==0){for(Oe=de,qe=be,ot=Me;be=(Z=A.distcode[ot+((L&(1<<Oe+qe)-1)>>Oe)])>>>16&255,Me=65535&Z,!(Oe+(de=Z>>>24)<=H);){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}L>>>=Oe,H-=Oe,A.back+=Oe}if(L>>>=de,H-=de,A.back+=de,64&be){R.msg="invalid distance code",A.mode=30;break}A.offset=Me,A.extra=15&be,A.mode=24;case 24:if(A.extra){for(ee=A.extra;H<ee;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}A.offset+=L&(1<<A.extra)-1,L>>>=A.extra,H-=A.extra,A.back+=A.extra}if(A.offset>A.dmax){R.msg="invalid distance too far back",A.mode=30;break}A.mode=25;case 25:if(ie===0)break e;if(ne=se-ie,A.offset>ne){if((ne=A.offset-ne)>A.whave&&A.sane){R.msg="invalid distance too far back",A.mode=30;break}fe=ne>A.wnext?(ne-=A.wnext,A.wsize-ne):A.wnext-ne,ne>A.length&&(ne=A.length),Ce=A.window}else Ce=K,fe=J-A.offset,ne=A.length;for(ie<ne&&(ne=ie),ie-=ne,A.length-=ne;K[J++]=Ce[fe++],--ne;);A.length===0&&(A.mode=21);break;case 26:if(ie===0)break e;K[J++]=A.length,ie--,A.mode=21;break;case 27:if(A.wrap){for(;H<32;){if(X===0)break e;X--,L|=W[G++]<<H,H+=8}if(se-=ie,R.total_out+=se,A.total+=se,se&&(R.adler=A.check=A.flags?d(A.check,K,se,J-se):l(A.check,K,se,J-se)),se=ie,(A.flags?L:E(L))!==A.check){R.msg="incorrect data check",A.mode=30;break}H=L=0}A.mode=28;case 28:if(A.wrap&&A.flags){for(;H<32;){if(X===0)break e;X--,L+=W[G++]<<H,H+=8}if(L!==(4294967295&A.total)){R.msg="incorrect length check",A.mode=30;break}H=L=0}A.mode=29;case 29:ce=1;break e;case 30:ce=-3;break e;case 31:return-4;default:return _}return R.next_out=J,R.avail_out=ie,R.next_in=G,R.avail_in=X,A.hold=L,A.bits=H,(A.wsize||se!==R.avail_out&&A.mode<30&&(A.mode<27||P!==4))&&q(R,R.output,R.next_out,se-R.avail_out)?(A.mode=31,-4):(te-=R.avail_in,se-=R.avail_out,R.total_in+=te,R.total_out+=se,A.total+=se,A.wrap&&se&&(R.adler=A.check=A.flags?d(A.check,K,se,R.next_out-se):l(A.check,K,se,R.next_out-se)),R.data_type=A.bits+(A.last?64:0)+(A.mode===12?128:0)+(A.mode===20||A.mode===15?256:0),(te==0&&se===0||P===4)&&ce===v&&(ce=-5),ce)},i.inflateEnd=function(R){if(!R||!R.state)return _;var P=R.state;return P.window&&(P.window=null),R.state=null,v},i.inflateGetHeader=function(R,P){var A;return R&&R.state?(2&(A=R.state).wrap)==0?_:((A.head=P).done=!1,v):_},i.inflateSetDictionary=function(R,P){var A,W=P.length;return R&&R.state?(A=R.state).wrap!==0&&A.mode!==11?_:A.mode===11&&l(1,P,W,0)!==A.check?-3:q(R,P,W,W)?(A.mode=31,-4):(A.havedict=1,v):_},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var o=n("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,v,_,C,x,S,E){var T,I,D,B,$,M,O,N,F,q=E.bits,R=0,P=0,A=0,W=0,K=0,G=0,J=0,X=0,ie=0,L=0,H=null,te=0,se=new o.Buf16(16),ne=new o.Buf16(16),fe=null,Ce=0;for(R=0;R<=15;R++)se[R]=0;for(P=0;P<_;P++)se[g[v+P]]++;for(K=q,W=15;1<=W&&se[W]===0;W--);if(W<K&&(K=W),W===0)return C[x++]=20971520,C[x++]=20971520,E.bits=1,0;for(A=1;A<W&&se[A]===0;A++);for(K<A&&(K=A),R=X=1;R<=15;R++)if(X<<=1,(X-=se[R])<0)return-1;if(0<X&&(p===0||W!==1))return-1;for(ne[1]=0,R=1;R<15;R++)ne[R+1]=ne[R]+se[R];for(P=0;P<_;P++)g[v+P]!==0&&(S[ne[g[v+P]]++]=P);if(M=p===0?(H=fe=S,19):p===1?(H=l,te-=257,fe=d,Ce-=257,256):(H=h,fe=m,-1),R=A,$=x,J=P=L=0,D=-1,B=(ie=1<<(G=K))-1,p===1&&852<ie||p===2&&592<ie)return 1;for(;;){for(O=R-J,F=S[P]<M?(N=0,S[P]):S[P]>M?(N=fe[Ce+S[P]],H[te+S[P]]):(N=96,0),T=1<<R-J,A=I=1<<G;C[$+(L>>J)+(I-=T)]=O<<24|N<<16|F|0,I!==0;);for(T=1<<R-1;L&T;)T>>=1;if(T!==0?(L&=T-1,L+=T):L=0,P++,--se[R]==0){if(R===W)break;R=g[v+S[P]]}if(K<R&&(L&B)!==D){for(J===0&&(J=K),$+=A,X=1<<(G=R-J);G+J<W&&!((X-=se[G+J])<=0);)G++,X<<=1;if(ie+=1<<G,p===1&&852<ie||p===2&&592<ie)return 1;C[D=L&B]=K<<24|G<<16|$-x|0}}return L!==0&&(C[$+L]=R-J<<24|64<<16|0),E.bits=K,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var o=n("../utils/common"),l=0,d=1;function h(Z){for(var oe=Z.length;0<=--oe;)Z[oe]=0}var m=0,p=29,g=256,v=g+1+p,_=30,C=19,x=2*v+1,S=15,E=16,T=7,I=256,D=16,B=17,$=18,M=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],O=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(v+2));h(q);var R=new Array(2*_);h(R);var P=new Array(512);h(P);var A=new Array(256);h(A);var W=new Array(p);h(W);var K,G,J,X=new Array(_);function ie(Z,oe,Se,we,ae){this.static_tree=Z,this.extra_bits=oe,this.extra_base=Se,this.elems=we,this.max_length=ae,this.has_stree=Z&&Z.length}function L(Z,oe){this.dyn_tree=Z,this.max_code=0,this.stat_desc=oe}function H(Z){return Z<256?P[Z]:P[256+(Z>>>7)]}function te(Z,oe){Z.pending_buf[Z.pending++]=255&oe,Z.pending_buf[Z.pending++]=oe>>>8&255}function se(Z,oe,Se){Z.bi_valid>E-Se?(Z.bi_buf|=oe<<Z.bi_valid&65535,te(Z,Z.bi_buf),Z.bi_buf=oe>>E-Z.bi_valid,Z.bi_valid+=Se-E):(Z.bi_buf|=oe<<Z.bi_valid&65535,Z.bi_valid+=Se)}function ne(Z,oe,Se){se(Z,Se[2*oe],Se[2*oe+1])}function fe(Z,oe){for(var Se=0;Se|=1&Z,Z>>>=1,Se<<=1,0<--oe;);return Se>>>1}function Ce(Z,oe,Se){var we,ae,Ae=new Array(S+1),Ne=0;for(we=1;we<=S;we++)Ae[we]=Ne=Ne+Se[we-1]<<1;for(ae=0;ae<=oe;ae++){var De=Z[2*ae+1];De!==0&&(Z[2*ae]=fe(Ae[De]++,De))}}function de(Z){var oe;for(oe=0;oe<v;oe++)Z.dyn_ltree[2*oe]=0;for(oe=0;oe<_;oe++)Z.dyn_dtree[2*oe]=0;for(oe=0;oe<C;oe++)Z.bl_tree[2*oe]=0;Z.dyn_ltree[2*I]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0}function be(Z){8<Z.bi_valid?te(Z,Z.bi_buf):0<Z.bi_valid&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0}function Me(Z,oe,Se,we){var ae=2*oe,Ae=2*Se;return Z[ae]<Z[Ae]||Z[ae]===Z[Ae]&&we[oe]<=we[Se]}function Oe(Z,oe,Se){for(var we=Z.heap[Se],ae=Se<<1;ae<=Z.heap_len&&(ae<Z.heap_len&&Me(oe,Z.heap[ae+1],Z.heap[ae],Z.depth)&&ae++,!Me(oe,we,Z.heap[ae],Z.depth));)Z.heap[Se]=Z.heap[ae],Se=ae,ae<<=1;Z.heap[Se]=we}function qe(Z,oe,Se){var we,ae,Ae,Ne,De=0;if(Z.last_lit!==0)for(;we=Z.pending_buf[Z.d_buf+2*De]<<8|Z.pending_buf[Z.d_buf+2*De+1],ae=Z.pending_buf[Z.l_buf+De],De++,we===0?ne(Z,ae,oe):(ne(Z,(Ae=A[ae])+g+1,oe),(Ne=M[Ae])!==0&&se(Z,ae-=W[Ae],Ne),ne(Z,Ae=H(--we),Se),(Ne=O[Ae])!==0&&se(Z,we-=X[Ae],Ne)),De<Z.last_lit;);ne(Z,I,oe)}function ot(Z,oe){var Se,we,ae,Ae=oe.dyn_tree,Ne=oe.stat_desc.static_tree,De=oe.stat_desc.has_stree,He=oe.stat_desc.elems,wt=-1;for(Z.heap_len=0,Z.heap_max=x,Se=0;Se<He;Se++)Ae[2*Se]!==0?(Z.heap[++Z.heap_len]=wt=Se,Z.depth[Se]=0):Ae[2*Se+1]=0;for(;Z.heap_len<2;)Ae[2*(ae=Z.heap[++Z.heap_len]=wt<2?++wt:0)]=1,Z.depth[ae]=0,Z.opt_len--,De&&(Z.static_len-=Ne[2*ae+1]);for(oe.max_code=wt,Se=Z.heap_len>>1;1<=Se;Se--)Oe(Z,Ae,Se);for(ae=He;Se=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],Oe(Z,Ae,1),we=Z.heap[1],Z.heap[--Z.heap_max]=Se,Z.heap[--Z.heap_max]=we,Ae[2*ae]=Ae[2*Se]+Ae[2*we],Z.depth[ae]=(Z.depth[Se]>=Z.depth[we]?Z.depth[Se]:Z.depth[we])+1,Ae[2*Se+1]=Ae[2*we+1]=ae,Z.heap[1]=ae++,Oe(Z,Ae,1),2<=Z.heap_len;);Z.heap[--Z.heap_max]=Z.heap[1],(function(nt,Yn){var gs,rr,ys,xt,nn,Xn,Tt=Yn.dyn_tree,Va=Yn.max_code,Ii=Yn.stat_desc.static_tree,$o=Yn.stat_desc.has_stree,Dr=Yn.stat_desc.extra_bits,_s=Yn.stat_desc.extra_base,Ft=Yn.stat_desc.max_length,sr=0;for(xt=0;xt<=S;xt++)nt.bl_count[xt]=0;for(Tt[2*nt.heap[nt.heap_max]+1]=0,gs=nt.heap_max+1;gs<x;gs++)Ft<(xt=Tt[2*Tt[2*(rr=nt.heap[gs])+1]+1]+1)&&(xt=Ft,sr++),Tt[2*rr+1]=xt,Va<rr||(nt.bl_count[xt]++,nn=0,_s<=rr&&(nn=Dr[rr-_s]),Xn=Tt[2*rr],nt.opt_len+=Xn*(xt+nn),$o&&(nt.static_len+=Xn*(Ii[2*rr+1]+nn)));if(sr!==0){do{for(xt=Ft-1;nt.bl_count[xt]===0;)xt--;nt.bl_count[xt]--,nt.bl_count[xt+1]+=2,nt.bl_count[Ft]--,sr-=2}while(0<sr);for(xt=Ft;xt!==0;xt--)for(rr=nt.bl_count[xt];rr!==0;)Va<(ys=nt.heap[--gs])||(Tt[2*ys+1]!==xt&&(nt.opt_len+=(xt-Tt[2*ys+1])*Tt[2*ys],Tt[2*ys+1]=xt),rr--)}})(Z,oe),Ce(Ae,wt,Z.bl_count)}function U(Z,oe,Se){var we,ae,Ae=-1,Ne=oe[1],De=0,He=7,wt=4;for(Ne===0&&(He=138,wt=3),oe[2*(Se+1)+1]=65535,we=0;we<=Se;we++)ae=Ne,Ne=oe[2*(we+1)+1],++De<He&&ae===Ne||(De<wt?Z.bl_tree[2*ae]+=De:ae!==0?(ae!==Ae&&Z.bl_tree[2*ae]++,Z.bl_tree[2*D]++):De<=10?Z.bl_tree[2*B]++:Z.bl_tree[2*$]++,Ae=ae,wt=(De=0)===Ne?(He=138,3):ae===Ne?(He=6,3):(He=7,4))}function ce(Z,oe,Se){var we,ae,Ae=-1,Ne=oe[1],De=0,He=7,wt=4;for(Ne===0&&(He=138,wt=3),we=0;we<=Se;we++)if(ae=Ne,Ne=oe[2*(we+1)+1],!(++De<He&&ae===Ne)){if(De<wt)for(;ne(Z,ae,Z.bl_tree),--De!=0;);else ae!==0?(ae!==Ae&&(ne(Z,ae,Z.bl_tree),De--),ne(Z,D,Z.bl_tree),se(Z,De-3,2)):De<=10?(ne(Z,B,Z.bl_tree),se(Z,De-3,3)):(ne(Z,$,Z.bl_tree),se(Z,De-11,7));Ae=ae,wt=(De=0)===Ne?(He=138,3):ae===Ne?(He=6,3):(He=7,4)}}h(X);var ye=!1;function ee(Z,oe,Se,we){se(Z,(m<<1)+(we?1:0),3),(function(ae,Ae,Ne,De){be(ae),te(ae,Ne),te(ae,~Ne),o.arraySet(ae.pending_buf,ae.window,Ae,Ne,ae.pending),ae.pending+=Ne})(Z,oe,Se)}i._tr_init=function(Z){ye||((function(){var oe,Se,we,ae,Ae,Ne=new Array(S+1);for(ae=we=0;ae<p-1;ae++)for(W[ae]=we,oe=0;oe<1<<M[ae];oe++)A[we++]=ae;for(A[we-1]=ae,ae=Ae=0;ae<16;ae++)for(X[ae]=Ae,oe=0;oe<1<<O[ae];oe++)P[Ae++]=ae;for(Ae>>=7;ae<_;ae++)for(X[ae]=Ae<<7,oe=0;oe<1<<O[ae]-7;oe++)P[256+Ae++]=ae;for(Se=0;Se<=S;Se++)Ne[Se]=0;for(oe=0;oe<=143;)q[2*oe+1]=8,oe++,Ne[8]++;for(;oe<=255;)q[2*oe+1]=9,oe++,Ne[9]++;for(;oe<=279;)q[2*oe+1]=7,oe++,Ne[7]++;for(;oe<=287;)q[2*oe+1]=8,oe++,Ne[8]++;for(Ce(q,v+1,Ne),oe=0;oe<_;oe++)R[2*oe+1]=5,R[2*oe]=fe(oe,5);K=new ie(q,M,g+1,v,S),G=new ie(R,O,0,_,S),J=new ie(new Array(0),N,0,C,T)})(),ye=!0),Z.l_desc=new L(Z.dyn_ltree,K),Z.d_desc=new L(Z.dyn_dtree,G),Z.bl_desc=new L(Z.bl_tree,J),Z.bi_buf=0,Z.bi_valid=0,de(Z)},i._tr_stored_block=ee,i._tr_flush_block=function(Z,oe,Se,we){var ae,Ae,Ne=0;0<Z.level?(Z.strm.data_type===2&&(Z.strm.data_type=(function(De){var He,wt=4093624447;for(He=0;He<=31;He++,wt>>>=1)if(1&wt&&De.dyn_ltree[2*He]!==0)return l;if(De.dyn_ltree[18]!==0||De.dyn_ltree[20]!==0||De.dyn_ltree[26]!==0)return d;for(He=32;He<g;He++)if(De.dyn_ltree[2*He]!==0)return d;return l})(Z)),ot(Z,Z.l_desc),ot(Z,Z.d_desc),Ne=(function(De){var He;for(U(De,De.dyn_ltree,De.l_desc.max_code),U(De,De.dyn_dtree,De.d_desc.max_code),ot(De,De.bl_desc),He=C-1;3<=He&&De.bl_tree[2*F[He]+1]===0;He--);return De.opt_len+=3*(He+1)+5+5+4,He})(Z),ae=Z.opt_len+3+7>>>3,(Ae=Z.static_len+3+7>>>3)<=ae&&(ae=Ae)):ae=Ae=Se+5,Se+4<=ae&&oe!==-1?ee(Z,oe,Se,we):Z.strategy===4||Ae===ae?(se(Z,2+(we?1:0),3),qe(Z,q,R)):(se(Z,4+(we?1:0),3),(function(De,He,wt,nt){var Yn;for(se(De,He-257,5),se(De,wt-1,5),se(De,nt-4,4),Yn=0;Yn<nt;Yn++)se(De,De.bl_tree[2*F[Yn]+1],3);ce(De,De.dyn_ltree,He-1),ce(De,De.dyn_dtree,wt-1)})(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,Ne+1),qe(Z,Z.dyn_ltree,Z.dyn_dtree)),de(Z),we&&be(Z)},i._tr_tally=function(Z,oe,Se){return Z.pending_buf[Z.d_buf+2*Z.last_lit]=oe>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&oe,Z.pending_buf[Z.l_buf+Z.last_lit]=255&Se,Z.last_lit++,oe===0?Z.dyn_ltree[2*Se]++:(Z.matches++,oe--,Z.dyn_ltree[2*(A[Se]+g+1)]++,Z.dyn_dtree[2*H(oe)]++),Z.last_lit===Z.lit_bufsize-1},i._tr_align=function(Z){se(Z,2,3),ne(Z,I,q),(function(oe){oe.bi_valid===16?(te(oe,oe.bi_buf),oe.bi_buf=0,oe.bi_valid=0):8<=oe.bi_valid&&(oe.pending_buf[oe.pending++]=255&oe.bi_buf,oe.bi_buf>>=8,oe.bi_valid-=8)})(Z)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(o){(function(l,d){if(!l.setImmediate){var h,m,p,g,v=1,_={},C=!1,x=l.document,S=Object.getPrototypeOf&&Object.getPrototypeOf(l);S=S&&S.setTimeout?S:l,h={}.toString.call(l.process)==="[object process]"?function(D){process.nextTick(function(){T(D)})}:(function(){if(l.postMessage&&!l.importScripts){var D=!0,B=l.onmessage;return l.onmessage=function(){D=!1},l.postMessage("","*"),l.onmessage=B,D}})()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",I,!1):l.attachEvent("onmessage",I),function(D){l.postMessage(g+D,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(D){T(D.data)},function(D){p.port2.postMessage(D)}):x&&"onreadystatechange"in x.createElement("script")?(m=x.documentElement,function(D){var B=x.createElement("script");B.onreadystatechange=function(){T(D),B.onreadystatechange=null,m.removeChild(B),B=null},m.appendChild(B)}):function(D){setTimeout(T,0,D)},S.setImmediate=function(D){typeof D!="function"&&(D=new Function(""+D));for(var B=new Array(arguments.length-1),$=0;$<B.length;$++)B[$]=arguments[$+1];var M={callback:D,args:B};return _[v]=M,h(v),v++},S.clearImmediate=E}function E(D){delete _[D]}function T(D){if(C)setTimeout(T,0,D);else{var B=_[D];if(B){C=!0;try{(function($){var M=$.callback,O=$.args;switch(O.length){case 0:M();break;case 1:M(O[0]);break;case 2:M(O[0],O[1]);break;case 3:M(O[0],O[1],O[2]);break;default:M.apply(d,O)}})(B)}finally{E(D),C=!1}}}}function I(D){D.source===l&&typeof D.data=="string"&&D.data.indexOf(g)===0&&T(+D.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof zh<"u"?zh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Kg)),Kg.exports}var AP=TP();const jm=U2(AP);function jP({currentUser:t,budgetId:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(null),[l,d]=k.useState(null);async function h(){if(!t){d("Must be logged in to download budget");return}if(!e){d("No budget selected");return}r(!0),d(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:m,data:p}=await Et("budgets",e,`downloading budget ${e}`);if(!m||!p){d(`Budget ${e} not found`);return}const g=await qT(e,"download-budget");let v=null;try{const{exists:R,data:P}=await Et("payees",e,`downloading payees for budget ${e}`);R&&P&&(v=P)}catch(R){console.warn(`Could not read payees for budget ${e}:`,R)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const _=new jm,C=new Date,x=C.toISOString().split("T")[0],S=`budget_${e}`,{accounts:E,account_groups:T,categories:I,category_groups:D,...B}=p;_.file(`${S}/budget.json`,JSON.stringify(B,null,2)),_.file(`${S}/accounts.json`,JSON.stringify(E||{},null,2)),_.file(`${S}/account_groups.json`,JSON.stringify(T||{},null,2)),_.file(`${S}/categories.json`,JSON.stringify(I||{},null,2)),_.file(`${S}/category_groups.json`,JSON.stringify(D||[],null,2)),v&&_.file(`${S}/payees.json`,JSON.stringify(v,null,2));let $=0;for(const R of g){const P=R.data,A=`${S}/months/month_${P.year}_${String(P.month).padStart(2,"0")}`,W={};if(P.are_allocations_finalized&&P.category_balances)for(const K of P.category_balances)K.allocated!==void 0&&(W[K.category_id]=K.allocated);_.file(`${A}/metadata.json`,JSON.stringify({budget_id:P.budget_id,year_month_ordinal:P.year_month_ordinal,year:P.year,month:P.month,total_income:P.total_income,previous_month_income:P.previous_month_income,total_expenses:P.total_expenses,are_allocations_finalized:P.are_allocations_finalized,created_at:P.created_at,updated_at:P.updated_at,...P.are_allocations_finalized&&{allocations:W},downloaded_at:C.toISOString()},null,2)),_.file(`${A}/income.json`,JSON.stringify(P.income||[],null,2)),_.file(`${A}/expenses.json`,JSON.stringify(P.expenses||[],null,2)),_.file(`${A}/transfers.json`,JSON.stringify(P.transfers||[],null,2)),_.file(`${A}/adjustments.json`,JSON.stringify(P.adjustments||[],null,2)),_.file(`${A}/account_balances.json`,JSON.stringify(P.account_balances||[],null,2)),_.file(`${A}/category_balances.json`,JSON.stringify(P.category_balances||[],null,2)),$++,o({phase:"processing",current:$,total:g.length,percentComplete:20+Math.round($/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const M=await _.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const N=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),F=URL.createObjectURL(M),q=document.createElement("a");q.href=F,q.download=`${x}_${N}_${e}.zip`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(F)}catch(m){d(m instanceof Error?m.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:i,error:l,downloadBudget:h}}async function RP(t){const n=await new jm().loadAsync(t),r=new Set,i=new Set;for(const[o]of Object.entries(n.files)){const l=o.match(/^budget_([^/]+)\//);if(l){const d=l[1];r.add(d),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&i.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:i.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function IP(t,e,n){const i=`${`${e}/months/`}${n}/`,o=`${i}metadata.json`,l=t.files[o];if(!l)return null;const d=await l.async("string"),h=JSON.parse(d),{downloaded_at:m,allocations:p,...g}=h,v=async S=>{const E=`${i}${S}`,T=t.files[E];if(T){const I=await T.async("string");return JSON.parse(I)}return[]},_={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await v("income.json"),expenses:await v("expenses.json"),transfers:await v("transfers.json"),adjustments:await v("adjustments.json"),account_balances:[],category_balances:[]},C=Ws(_);let x=xm(C);if(h.are_allocations_finalized&&p!==void 0){const S=new Map;for(const I of x.category_balances)S.set(I.category_id,I);const E=[],T=new Set;for(const I of x.category_balances){const D=p[I.category_id];if(D!==void 0){const B=ze(D);E.push({...I,allocated:B,end_balance:ze(I.start_balance+B+I.spent+I.transfers+I.adjustments)})}else E.push(I);T.add(I.category_id)}for(const[I,D]of Object.entries(p))if(!T.has(I)){const B=ze(D);E.push({category_id:I,start_balance:0,allocated:B,spent:0,transfers:0,adjustments:0,end_balance:B})}x={...x,category_balances:E}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:x}}async function kP(t,e){const n=`budget_${e}`,r=async $=>{const M=t.files[$];if(M){const O=await M.async("string");return JSON.parse(O)}return null},i=`${n}/budget.json`,o=`${n}/accounts.json`,l=`${n}/account_groups.json`,d=`${n}/categories.json`,h=`${n}/category_groups.json`,m=await r(i);if(!m)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(l)||{},v=await r(d)||{},_=await r(h)||[],C=Ws({...m,accounts:p,account_groups:g,categories:v,category_groups:_}),x={budgetId:e,data:C},S=`${n}/payees.json`,E=await r(S);let T=null;if(E){const $={...E,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:Ws($)}}const I=`${n}/months/`,D=new Set;for(const $ of Object.keys(t.files))if($.startsWith(I)&&$.includes("/metadata.json")){const M=$.split("/months/")[1].split("/")[0];D.add(M)}const B=[];for(const $ of D){const M=await IP(t,n,$);M&&B.push(M)}return{budgetUpdate:x,monthUpdates:B,payeeWrite:T}}function DP({currentUser:t}){const[e,n]=k.useState(!1),[r,i]=k.useState(!1),[o,l]=k.useState(null),[d,h]=k.useState(null),[m,p]=k.useState(null),[g,v]=k.useState(null);async function _(x){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),l(null),v(null);try{const S=await RP(x);l(S)}catch(S){p(S instanceof Error?S.message:"Failed to parse zip file")}finally{n(!1)}}async function C(x){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}i(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const S=[];let E=0,T=0,I=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const B=await new jm().loadAsync(x);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const $=[],M=[],O=[];for(let N=0;N<o.budgetsToRestore.length;N++){const F=o.budgetsToRestore[N];try{const{budgetUpdate:q,monthUpdates:R,payeeWrite:P}=await kP(B,F);$.push(q),M.push(...R),P&&O.push(P),h({phase:"uploading",current:N+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((N+1)/o.budgetsToRestore.length*50)})}catch(q){S.push(`Budget ${F}: ${q instanceof Error?q.message:String(q)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),$.length>0)try{console.log(`[Upload] Writing ${$.length} budget(s)...`),await HT($,"upload-budget"),E=$.length,console.log(`[Upload] Successfully wrote ${E} budget(s)`)}catch(N){const F=`Failed to write budgets: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${F}`,N),S.push(F),N}if(O.length>0)try{console.log(`[Upload] Writing ${O.length} payee doc(s)...`),await pc(O,"upload-budget: writing payees"),I=O.length,console.log(`[Upload] Successfully wrote ${I} payee doc(s)`)}catch(N){const F=`Failed to write payees: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${F}`,N),S.push(F),N}if(M.length>0)try{console.log(`[Upload] Writing ${M.length} month(s) and recalculating...`),await F3(M,"upload-budget"),T=M.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(N){const F=`Failed to write months: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${F}`,N),S.push(F),N}h({phase:"complete",current:1,total:1,percentComplete:100}),v({success:S.length===0,budgetsRestored:E,monthsRestored:T,payeesRestored:I,errors:S}),console.log("[Upload] Clearing all caches after upload..."),Oa()}catch(D){const B=D instanceof Error?D.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",D),console.error("[Upload] Error details:",{errorMessage:B,budgetsRestored:E,monthsRestored:T,payeesRestored:I,errorsSoFar:S}),p(B),v({success:!1,budgetsRestored:E,monthsRestored:T,payeesRestored:I,errors:[...S,B]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),Oa()}finally{i(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:d,error:m,result:g,scanZipFile:_,uploadBudget:C}}function MP({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:i="Move to end"}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:w4,children:[u.jsx("div",{style:{...S4,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&u.jsx("span",{style:C4,children:i})]})}function st(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function yr(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function qn(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Bt(t){return t===0?"$0.00":`${t>0?"+":"-"}${st(t)}`}function Lt(t){return`${t>=0?"+":"-"}${st(t)}`}function ct(t){return t===0?me.zero:t>0?me.success:me.danger}function hn(t){return t===0?me.zero:t>0?me.success:me.debt}function yc(t){return t===0?me.zero:t<0?me.error:me.success}function _c(t){return t===0?me.zero:t>0?me.success:me.error}async function YT(t,e){const{exists:n,data:r}=await Et("feedback",t,`VALIDATION-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function W0(t){const{docId:e,items:n,description:r}=t;await Wn("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function OP(t,e,n,r){const{exists:i}=await Et("feedback",t,"checking if user has existing feedback document");i?await Wn("feedback",t,{items:Vu(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await Wn("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}function XT(){const t=$t(),e=Kn({onMutate:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,m=o||i,p=Re.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),v=`feedback_optimistic_${Date.now()}`,_={id:v,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d,doc_id:m,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,_]}),{previousData:g,optimisticId:v}},mutationFn:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,m=o||i,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d};return await OP(m,p,o,"submitting new feedback"),{feedbackItem:p,docId:m}},onSuccess:(r,i,o)=>{if(!o?.optimisticId)return;const l=t.getQueryData(Re.feedback());l&&t.setQueryData(Re.feedback(),{items:l.items.map(d=>d.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:i.userEmail}:d)})},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Re.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function NP(){const t=$t(),e=Kn({onMutate:async r=>{const{item:i}=r,o=Re.feedback(),l=!i.is_done,d=l?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(m=>m.id===i.id?{...m,is_done:l,completed_at:d}:m)}),{previousData:h}},mutationFn:async r=>{const{item:i}=r,o=!i.is_done,l=o?new Date().toISOString():null,d=await YT(i.doc_id,"toggle feedback");let h=!1;const m=d.items.map(p=>p.id===i.id?(h=!0,{...p,is_done:o,completed_at:l}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:i.id,inDocument:i.doc_id,availableIds:d.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${i.id}, Doc ID: ${i.doc_id}`);return await W0({docId:i.doc_id,items:m,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:i.id,isDone:o,completedAt:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Re.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function PP(){const t=$t(),e=Kn({onMutate:async r=>{const{docId:i,items:o}=r,l=Re.feedback();await t.cancelQueries({queryKey:l});const d=t.getQueryData(l),h=new Map;return o.forEach(m=>{h.set(m.id,m.sort_order)}),d&&t.setQueryData(l,{items:d.items.map(m=>m.doc_id===i&&h.has(m.id)?{...m,sort_order:h.get(m.id)}:m)}),{previousData:d}},mutationFn:async r=>{const{docId:i,items:o}=r;return await W0({docId:i,items:o,description:"saving reordered feedback items"}),{docId:i,items:o}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Re.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function ds({isOpen:t,onClose:e,title:n,children:r,width:i="28rem"}){if(!t)return null;function o(){e()}return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:i,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:l=>l.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[u.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const zP=2e3,BP={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function LP(){const[t,e]=k.useState(!1),[n,r]=k.useState(""),[i,o]=k.useState("bug"),[l,d]=k.useState(!1),h=k.useContext(fd),p=Pa().get_current_firebase_user(),g=Nn(),{submitFeedback:v}=XT();if(k.useEffect(()=>{if(l){const x=setTimeout(()=>d(!1),zP);return()=>clearTimeout(x)}},[l]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function C(x){x.preventDefault(),!(!n.trim()||!h.username||!p)&&(v.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:i,currentPath:g.pathname}),r(""),o("bug"),e(!1),d(!0))}return u.jsxs(u.Fragment,{children:[l&&u.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[u.jsx("span",{children:""}),u.jsx("span",{children:"Feedback submitted!"})]}),u.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:me.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:x=>{x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),u.jsx(ds,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:u.jsxs("form",{onSubmit:C,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(x=>{const S=BP[x],E=i===x;return u.jsxs("button",{type:"button",onClick:()=>{S.label,o(x)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${S.color}`,borderRadius:"0.5rem",background:E?S.bgColor:"transparent",color:E?S.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:E?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:E?1:.5,boxShadow:E?`0 0 12px ${S.bgColor}`:"none",position:"relative"},children:[S.label,E&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},x)})}),u.jsx(H0,{value:n,onChange:x=>r(x.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),u.jsxs(Ua,{children:[u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),u.jsx(Ve,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function Gr({children:t,labelStyle:e,...n}){return u.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[u.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:me.primary},...n}),t]})}function K0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[i,o]=k.useState(r);return u.jsxs("div",{style:{marginTop:"2rem"},children:[u.jsxs("button",{onClick:()=>o(!i),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[u.jsx("span",{style:{transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),i&&n]})}const UP=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},FP=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Pf(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,i=e.filter(S=>!S.hidden),o=i.length,l=UP(o),d=FP(o),h=Math.floor(100/d),m=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",v=r==="segmented",_=S=>{const E="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return v?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:S?E:T,cursor:"pointer",fontWeight:S?600:400,fontSize:"0.95rem",color:"inherit",opacity:S?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:S?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:S?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:S?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:S?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:S?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},C=(S,E)=>u.jsxs(u.Fragment,{children:[u.jsx("span",{children:S.label}),S.checkmark&&u.jsx("span",{style:{color:me.success,fontWeight:600},children:""}),p&&E&&u.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),x=()=>v?`
        .${m} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${m} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${m} > button,
        .${m} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${m} > button:last-child,
        .${m} > a:last-child {
          margin-right: 0;
        }
        .${m} > button::before,
        .${m} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 #242424, 1px 0 0 #242424;
        }
        .${m} > button:nth-child(1),
        .${m} > a:nth-child(1) {
          z-index: 4;
        }
        .${m} > button:nth-child(2),
        .${m} > a:nth-child(2) {
          z-index: 3;
        }
        .${m} > button:nth-child(3),
        .${m} > a:nth-child(3) {
          z-index: 2;
        }
        .${m} > button:nth-child(4),
        .${m} > a:nth-child(4) {
          z-index: 1;
        }
        .${m} > button.tab-active,
        .${m} > a.tab-active {
          z-index: 10;
        }
        .${m} > button.tab-active::before,
        .${m} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${m} > button:not(.tab-active):hover,
        .${m} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${m} > button:not(.tab-active):hover::before,
        .${m} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${m} {
            padding-left: 0;
            padding-right: 0;
          }
          .${m} > button,
          .${m} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${m} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${l}px) {
        .${m} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return u.jsxs(u.Fragment,{children:[u.jsx("style",{children:`
        ${x()}
        .${m} > button,
        .${m} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${m} > button:hover,
        .${m} > button:focus,
        .${m} > a:hover,
        .${m} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${v?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),u.jsx("div",{className:m,children:i.map(S=>{const E=n===S.id;return t.mode==="link"?u.jsx(jn,{to:`${t.linkPrefix}/${S.id}`,onClick:()=>(`${S.label}`,void 0),style:_(E),className:E?"tab-active":"",children:C(S,E)},S.id):u.jsx("button",{onClick:()=>{`${S.label}`,t.onTabChange(S.id)},style:_(E),className:E?"tab-active":"",children:C(S,E)},S.id)})})]})}function ZT({items:t}){const[e,n]=k.useState(!1),r=k.useRef(null),o=Nn().pathname;k.useEffect(()=>{function d(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[e]),k.useEffect(()=>{function d(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[e]);const l=t.filter(d=>d.hidden?!1:d.to?d.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):d.to==="/account"||d.to==="/"?o!==d.to:!o.startsWith(d.to):!0);return u.jsxs("div",{ref:r,style:{position:"relative"},children:[u.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&u.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:l.map((d,h)=>{if(d.divider)return u.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const m=u.jsxs(u.Fragment,{children:[d.icon&&u.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:d.icon}),u.jsx("span",{children:d.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return d.to?u.jsx(jn,{to:d.to,style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",onClick:()=>{`${d.label}`,n(!1)},children:m},h):u.jsx("button",{onClick:()=>{`${d.label}`,d.onClick?.(),n(!1)},style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",children:m},h)})})]})}function VP({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Xe(),i=Nn(),l=[...i.pathname==="/budget"||i.pathname.startsWith("/budget/")&&!i.pathname.startsWith("/budget/settings")&&!i.pathname.startsWith("/budget/admin")&&!i.pathname.startsWith("/budget/analytics")&&!i.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return u.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[u.jsx("div",{style:{flex:"0 0 auto"},children:e?u.jsx(jn,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):u.jsx(jn,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:u.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),u.jsx("div",{style:{flex:"0 0 auto"},children:n?u.jsx("div",{style:{width:"1.5rem"}}):u.jsx(ZT,{items:l})})]})}function JT({children:t,style:e}){return u.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function Gu({message:t,linkText:e,linkTo:n}){return u.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${me.warning} 12%, transparent)`,border:`2px solid ${me.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsx("p",{style:{margin:0,fontWeight:500,color:me.warning,fontSize:"0.95rem"},children:t}),u.jsxs(jn,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:me.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}const $P={success:{bgColor:"rgba(46, 213, 115, 0.95)",color:"white",icon:""},error:{bgColor:"rgba(255, 71, 87, 0.95)",color:"white",icon:""},warning:{bgColor:"rgba(255, 165, 2, 0.95)",color:"white",icon:""},info:{bgColor:"rgba(30, 144, 255, 0.95)",color:"white",icon:""}};function qP({item:t,onDismiss:e}){const[n,r]=k.useState(!1);if(k.useEffect(()=>{if(t){if(r(!0),t.autoDismissMs&&t.autoDismissMs>0){const o=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),200)},t.autoDismissMs);return()=>clearTimeout(o)}}else r(!1)},[t,e]),!t||!n)return null;const i=$P[t.type];return u.jsxs("div",{style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",left:"1.5rem",maxWidth:"600px",margin:"0 auto",background:i.bgColor,color:i.color,padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:n?"fadeInUp 0.2s ease-out":"fadeOut 0.2s ease-out",cursor:"pointer"},onClick:()=>{r(!1),setTimeout(()=>e(t.id),200)},children:[u.jsx("span",{children:i.icon}),u.jsx("span",{style:{flex:1},children:t.message}),u.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:""})]})}class HP{items=[];listeners=new Set;nextId=1;add(e){const n=`banner-${this.nextId++}`,r={...e,id:n};return this.items.push(r),this.notify(),n}remove(e){this.items=this.items.filter(n=>n.id!==e),this.notify()}getCurrent(){return this.items[0]||null}subscribe(e){return this.listeners.add(e),e(this.getCurrent()),()=>{this.listeners.delete(e)}}notify(){const e=this.getCurrent();this.listeners.forEach(n=>n(e))}}const en=new HP;async function GP(t,e,n,r){const i=Object.keys(e),{total:o}=await of(t,i,n,r),l=Object.values(e).reduce((p,g)=>p+Math.max(0,g.balance??0),0),d=Object.values(o).reduce((p,g)=>p+Math.max(0,g),0),h=Math.abs(l-d),m=h<=.01;return{name:"Stored balances match calculated balances",passed:m,message:m?"Stored and calculated balances match":`Balance calculation mismatch: ${st(h)} difference between stored and calculated balances`,details:{allocatedFromStored:l,allocatedFromCalculated:d,difference:h}}}function QP(t,e){const n=Object.values(t).reduce((d,h)=>d+Math.max(0,h.balance??0),0),r=e,i=n+r,o=Math.abs(e-i),l=o<=.01;return{name:"Accounting relationship (On Budget = Allocated + Unallocated)",passed:l,message:l?"Accounting relationship holds":`Accounting relationship broken: On Budget (${st(e)})  Allocated (${st(n)}) + Unallocated (${st(r)}). Difference: ${st(o)}`,details:{onBudgetTotal:e,allocated:n,unallocated:r,expectedSum:i,actualSum:n+r,difference:o}}}function WP(t){const e=Object.values(t).reduce((o,l)=>o+Math.max(0,l.balance??0),0),n=Object.values(t).reduce((o,l)=>o+Math.max(0,l.balance??0),0),r=Math.abs(e-n),i=r<=.01;return{name:"Month view ALL-TIME matches settings Allocated",passed:i,message:i?"Month view and settings page totals match":`Balance display mismatch: Settings "Allocated" (${st(n)})  Month view "ALL-TIME" (${st(e)}). Difference: ${st(r)}`,details:{monthViewAllTime:e,settingsPageAllocated:n,difference:r}}}async function Y0(t){const{budgetId:e,categories:n,totalAvailable:r,currentYear:i,currentMonth:o}=t,l=[];l.push(await GP(e,n,i,o)),l.push(QP(n,r)),l.push(WP(n));const d=l.filter(m=>m.passed),h=l.filter(m=>!m.passed);return{passed:d,failed:h}}function X0(t,e="[Recalculation Assertions]"){const n=[];return t.failed.length>0&&(console.error(`${e} ${t.failed.length} assertion(s) failed:`),t.failed.forEach(r=>{console.error(`   ${r.name}: ${r.message}`,r.details);const i=r.name.includes("Accounting relationship");n.push({type:"error",message:r.message+". Budget may need recalculation.",autoDismissMs:i?0:1e4})})),n}const KP=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Yg=new Map;async function YP(t,e={}){const n=Yg.get(t);if(n)return n;const r=XP(t,e);Yg.set(t,r);try{return await r}finally{Yg.delete(t)}}async function XP(t,e={}){const{onProgress:n}=e;n?.({phase:"reading-budget",monthsProcessed:0,totalMonths:0,percentComplete:5});const{exists:r,data:i}=await Et("budgets",t,"[recalc] reading budget for month_map");if(!r||!i)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const o=PT(i.month_map),l=zT(o);if(l.length===0&&!i.is_needs_recalculation)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const d=z4(o),h=l.length>0?l[0]:null;if(!h)return await M1(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const m=d.indexOf(h),p=m>0;let g=p?d.slice(m-1):d.slice(m);const v=new Date,_=v.getFullYear(),C=v.getMonth()+1,x=bt(_+Math.floor((C+ka-1)/12),(C+ka-1)%12+1);g=g.filter(A=>A<=x);const S=p?g.length-1:g.length;n?.({phase:"fetching-months",monthsFetched:0,totalMonthsToFetch:g.length,monthsProcessed:0,totalMonths:S,percentComplete:10});const E=await L4(t,g,(A,W)=>{n?.({phase:"fetching-months",monthsFetched:A,totalMonthsToFetch:W,monthsProcessed:0,totalMonths:S,percentComplete:A===0?10:30})});if(E.length===0)return await M1(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const T=p?1:0,I=E.length-1,D=I-T+1;let B=cd;p&&E.length>0&&(B=Oo(E[0]));const $=[];let M=0;for(let A=T;A<=I;A++){const W=E[A],K=`${KP[W.month-1]} ${W.year}`;n?.({phase:"recalculating",currentMonth:K,monthsProcessed:M,totalMonths:D,percentComplete:Math.round(30+M/D*40)});const G=ud(W,B);$.push(G),B=Oo(G),M++}n?.({phase:"saving",monthsProcessed:M,totalMonths:D,percentComplete:75});const O=$.map(A=>({collectionPath:"months",docId:ps(t,A.year,A.month),data:A}));await pc(O,`[recalc] batch write ${$.length} months`);for(const A of $)Be.setQueryData(Re.month(t,A.year,A.month),{month:A});n?.({phase:"saving",monthsProcessed:M,totalMonths:D,percentComplete:92});const N=B.accountEndBalances,F=B.categoryEndBalances,q=Object.keys(i.categories||{}),R=await _m(t,q,F,_,C);await wm(t,N,R,o),n?.({phase:"validating",monthsProcessed:M,totalMonths:D,percentComplete:95});const{data:P}=await Et("budgets",t,"[recalc] reading budget for assertions");if(P){const A=await Y0({budgetId:t,categories:P.categories||{},totalAvailable:P.total_available??0,currentYear:_,currentMonth:C});X0(A,"[Recalculation]").forEach(K=>en.add(K))}return n?.({phase:"complete",monthsProcessed:M,totalMonths:D,percentComplete:100}),{monthsRecalculated:M,budgetUpdated:!0,finalAccountBalances:N}}async function ZP(t,e,n){const r=bt(e,n);if(q6(t,r))return{markedCount:0,budgetUpdated:!1};const{exists:i,data:o}=await Et("budgets",t,"reading budget for month_map update");if(!i||!o)return console.warn(`[markMonthsNeedRecalculation] Budget ${t} not found`),{markedCount:0,budgetUpdated:!1};const d={...o.month_map||{}},h=$6();for(const v of h)d[v]||(d[v]={needs_recalculation:!1});let m=0;for(const v of h)v>=r&&(d[v]?.needs_recalculation||(d[v]={needs_recalculation:!0},m++));const p=o.is_needs_recalculation===!0;if(m===0&&p)return{markedCount:0,budgetUpdated:!1};const g=d;return H6(t,r,g),await kf("budgets",t,{is_needs_recalculation:!0,month_map:g,updated_at:new Date().toISOString()},`marking budget and ${m} future months as needing recalculation`),{markedCount:m,budgetUpdated:!0}}function $1(t,e){if(t.length!==e.length)return!1;const n=new Map,r=new Map;for(const i of t){const o="account_id"in i?i.account_id:i.category_id;o&&n.set(o,i)}for(const i of e){const o="account_id"in i?i.account_id:i.category_id;o&&r.set(o,i)}if(n.size!==r.size)return!1;for(const[i,o]of n){const l=r.get(i);if(!l)return!1;const d=Object.keys(o);for(const h of d)if(o[h]!==l[h])return!1}return!0}function JP(t,e){return t.total_income!==e.total_income||t.total_expenses!==e.total_expenses||t.previous_month_income!==e.previous_month_income||!$1(t.account_balances,e.account_balances)||!$1(t.category_balances,e.category_balances)}function ez(t,e,n,r){for(const[i,o]of Object.entries(n)){const l=t[i];if(!l||l.balance!==o.balance)return!0}for(const[i,o]of Object.entries(r)){const l=e[i];if(!l||l.balance!==o.balance)return!0}return!1}function tz({budgetId:t,enabled:e,initialDataLoadComplete:n,months:r}){const{addLoadingHold:i,removeLoadingHold:o}=Pn(),{updateAccounts:l}=UT(),{updateCategories:d}=FT(),h=k.useRef(!1);k.useEffect(()=>{if(!e||!t||!n||r.length===0||h.current)return;h.current=!0,(async()=>{try{i("initial-balance-calculation","Calculating balances...");const p=Be.getQueryData(Re.budget(t));if(!p){console.warn("[useInitialBalanceCalculation] No budget data in cache"),o("initial-balance-calculation");return}const{budget:g,accounts:v,categories:_}=p,C=Object.keys(_),x=[...r].sort((A,W)=>A.year!==W.year?A.year-W.year:A.month-W.month),S=x[0];let E=cd;if(S){const A={},W={};for(const K of S.category_balances||[])rt(K.category_id)||(A[K.category_id]=ze(K.start_balance??0));for(const K of S.account_balances||[])Ze(K.account_id)||(W[K.account_id]=ze(K.start_balance??0));E={categoryEndBalances:A,accountEndBalances:W,totalIncome:ze(S.previous_month_income??0)}}const T=[],I=[];for(const A of x){const W=ud(A,E);T.push(W),JP(A,W)&&I.push(W),E=Oo(W)}const D=E.accountEndBalances,B=E.categoryEndBalances,$=T[T.length-1],M=await _m(t,C,B,$.year,$.month),O={};Object.entries(v).forEach(([A,W])=>{O[A]={...W,balance:D[A]??0}});const N={};Object.entries(_).forEach(([A,W])=>{N[A]={...W,balance:M[A]??0}});const F=g.month_map||{},q=new Set(x.map(A=>bt(A.year,A.month))),R={};for(const A of Object.keys(F))q.has(A)?R[A]={needs_recalculation:!1}:R[A]=F[A];if(I.length>0){i("initial-balance-calculation","Saving month balances...");const A=I.map(W=>({collectionPath:"months",docId:ps(t,W.year,W.month),data:Ws({...W,updated_at:new Date().toISOString()})}));await pc(A,"initial balance calculation: batch write months")}for(const A of T)Be.setQueryData(Re.month(t,A.year,A.month),{month:A});if(ez(v,_,O,N)||JSON.stringify(g.month_map)!==JSON.stringify(R)){i("initial-balance-calculation","Saving budget balances..."),await wm(t,D,M,R),await l.mutateAsync({budgetId:t,accounts:O}),await d.mutateAsync({budgetId:t,categories:N});const{data:A}=await Et("budgets",t,"[initial balance calculation] reading budget for assertions");if(A&&T.length>0){const W=T[T.length-1],K=await Y0({budgetId:t,categories:A.categories||{},totalAvailable:A.total_available??0,currentYear:W.year,currentMonth:W.month});X0(K,"[Initial Balance Calculation]").forEach(J=>en.add(J))}}else Be.setQueryData(Re.budget(t),{...p,budget:{...g,month_map:R},accounts:O,categories:N})}catch(p){const g=p instanceof Error?p.message:"Failed to calculate initial balances";console.error("[useInitialBalanceCalculation] Error calculating balances:",p),en.add({type:"error",message:`Initial balance calculation failed: ${g}`,autoDismissMs:1e4})}finally{o("initial-balance-calculation")}})()},[e,t,n,r,i,o,l,d]),k.useEffect(()=>{t||(h.current=!1)},[t])}const nz={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",currentViewingDocument:{type:null},setCurrentViewingDocument:()=>{},setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,initialDataLoadComplete:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},eA=k.createContext(nz);function rz({children:t}){const n=Pa().get_current_firebase_user(),[r,i]=k.useState(null),[o,l]=k.useState(new Date().getFullYear()),[d,h]=k.useState(new Date().getMonth()+1),[m,p]=k.useState("categories"),[g,v]=k.useState("categories"),[_,C]=k.useState("budget"),[x,S]=k.useState("Budget"),E=k.useCallback(fe=>{S(Ce=>Ce===fe?Ce:fe)},[]),[T,I]=k.useState({type:null}),[D,B]=k.useState(!1),[$,M]=k.useState(!1),O=J6(n?.uid||null,n?.email||null),N=O.data&&O.data.budget_ids.length===0,F=t4(n?.uid||null,O.data||null,{enabled:!!n?.uid&&!!O.data&&N}),q=D3(r,{enabled:!!r&&D}),[R,P]=k.useState(!1);k.useEffect(()=>{if(!q.data){P(!1);return}const{budget:fe,payees:Ce,months:de}=q.data,be=Date.now();Be.setQueryData(Re.budget(r),fe,{updatedAt:be}),Be.setQueryData(Re.payees(r),Ce,{updatedAt:be});for(const Me of de)Be.setQueryData(Re.month(r,Me.year,Me.month),{month:Me},{updatedAt:be});P(!0)},[q.data,r]),tz({budgetId:r,enabled:!!r&&D&&R,initialDataLoadComplete:R,months:q.data?.months||[]}),k.useEffect(()=>{r||P(!1)},[r]);const A=O.data?.permission_flags?.is_admin===!0,W=O.data?.permission_flags?.is_test===!0,K=F.data?.pendingInvites||[],G=F.data?.budgets||[],J=K.length>0;k.useEffect(()=>{if(!n||D||O.isLoading)return;const fe=O.data;if(!(!fe&&!O.isError))if(fe&&fe.budget_ids.length>0)i(fe.budget_ids[0]),M(!1),B(!0);else{if(F.isLoading)return;const Ce=F.data;M(!(Ce?.pendingInvites&&Ce.pendingInvites.length>0)),B(!0)}},[n,D,O.data,O.isLoading,O.isError,F.data,F.isLoading]);const X=k.useCallback(()=>{d===1?(l(fe=>fe-1),h(12)):h(fe=>fe-1)},[d]),ie=k.useCallback(()=>{d===12?(l(fe=>fe+1),h(1)):h(fe=>fe+1)},[d]),L=k.useCallback(async fe=>{(fe?.force||!F.data)&&await F.refetch()},[F]),H=k.useCallback(fe=>{i(fe),M(!1)},[]),te=k.useCallback(async fe=>{if(!n)return null;try{const Ce=await c4(fe,n.uid);return Ce&&Ce.isInvited&&!Ce.hasAccepted?{budgetId:fe,budgetName:Ce.budgetName,ownerEmail:Ce.ownerEmail}:null}catch(Ce){return console.error("[BudgetContext] Error checking budget invite:",Ce),null}},[n]),se=k.useCallback(()=>{Be.clear()},[]),ne={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:d,lastActiveTab:m,lastSettingsTab:g,lastAdminTab:_,currentViewingDocument:T,setCurrentViewingDocument:I,setSelectedBudgetId:i,setCurrentYear:l,setCurrentMonthNumber:h,setLastActiveTab:p,setLastSettingsTab:v,setLastAdminTab:C,pageTitle:x,setPageTitle:E,isInitialized:D,needsFirstBudget:$,initialDataLoadComplete:R,goToPreviousMonth:X,goToNextMonth:ie,pendingInvites:K,hasPendingInvites:J,accessibleBudgets:G,isAdmin:A,isTest:W,loadAccessibleBudgets:L,switchToBudget:H,checkBudgetInvite:te,clearCache:se};return u.jsx(eA.Provider,{value:ne,children:t})}function Xe(){const t=k.useContext(eA);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const sz=function(){},iz={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:sz},fd=k.createContext(iz);function q1({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:i,editName:o,isRenaming:l,onAccept:d,onSwitch:h,onStartEdit:m,onCancelEdit:p,onEditNameChange:g,onSaveEdit:v}){const _=e&&t.isOwner;return u.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:i?u.jsxs("form",{onSubmit:v,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:u.jsx("input",{type:"text",value:o,onChange:C=>g(C.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[u.jsx("button",{type:"submit",disabled:l||!o.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:l||!o.trim()?.7:1,fontSize:"0.8rem"},children:l?"Saving...":"Save"}),u.jsx("button",{type:"button",onClick:p,disabled:l,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontWeight:500,opacity:l?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[u.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),_&&u.jsx("button",{onClick:m,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),u.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?u.jsx("button",{onClick:d,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:u.jsx("button",{onClick:h,disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}const zf={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function tA({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in zf?n:"bug",i=zf[r];return u.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:i.bgColor,color:i.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:i.label})}function az({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:d,onToggleDone:h,onTypeClick:m}){return u.jsxs("div",{onDragOver:p=>{p.stopPropagation(),i(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),d(p)},style:{position:"relative"},children:[u.jsx("div",{style:{...x4,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),u.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:l,style:{...V0,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{...v4},children:""}),u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:me.primary,flexShrink:0}}),u.jsx(tA,{type:t.feedback_type,onClick:m})]}),u.jsxs("div",{style:{marginLeft:"3.25rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",Ny(t.created_at)]})]})]})]})}function oz({item:t,onToggleDone:e,onTypeClick:n}){return u.jsxs("div",{style:{...V0,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:me.primary,flexShrink:0}}),u.jsx(tA,{type:t.feedback_type,onClick:n})]}),u.jsxs("div",{style:{marginLeft:"2rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",Ny(t.created_at)]}),t.completed_at&&u.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:me.success},children:[" Completed: ",Ny(t.completed_at)]})]})]})}function Gn({noMargin:t}={}){return u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function nA(){const{state:t,closeModal:e}=L3();if(!t.isOpen)return null;const n=t.isComplete;return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:r=>r.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&u.jsx(Gn,{noMargin:!0}),t.migrationName]}),n&&u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),u.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"#ef4444":t.isComplete?"#22c55e":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?u.jsx("div",{style:{background:t.error?"#ef4444":t.isComplete?"#22c55e":"#646cff",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):u.jsx("div",{style:{background:t.error?"#ef4444":"#646cff",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&u.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&u.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&u.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"#ef4444"},children:t.error}),t.isComplete&&u.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"rgba(239, 68, 68, 0.2)":"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&u.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),u.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function Co({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:i=!1,onDownloadBackup:o,isDownloading:l=!1}){const[d,h]=k.useState(!1),m=k.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=k.useCallback(()=>{n(d?"downloaded":"already-have")},[d,n]),g=k.useCallback(()=>{n("cancelled"),e()},[n,e]);return u.jsxs(ds,{isOpen:t,onClose:g,title:" Backup Recommended",children:[u.jsx("div",{style:{background:i?"color-mix(in srgb, #ef4444 15%, transparent)":"color-mix(in srgb, #f59e0b 15%, transparent)",border:`1px solid ${i?"color-mix(in srgb, #ef4444 40%, transparent)":"color-mix(in srgb, #f59e0b 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:i?"#fca5a5":"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:i?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",u.jsx("strong",{children:r})]}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx(Ve,{variant:"secondary",onClick:m,disabled:l,actionName:"Download Backup Before Migration",style:{width:"100%"},children:l?u.jsxs(u.Fragment,{children:[u.jsx(Gn,{noMargin:!0})," Downloading Backup..."]}):d?" Backup Downloaded":" Download Backup Now"})}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),u.jsx(Ve,{variant:i?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:l,children:d?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function Eo({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,i]=k.useState(!1),[o,l]=k.useState(!1),[d,h]=k.useState(null),m=k.useCallback(_=>{h(()=>_),i(!0)},[]),p=k.useCallback(_=>{_!=="cancelled"&&d&&d(),h(null),i(!1)},[d]),g=k.useCallback(()=>{h(null),i(!1)},[]),v=k.useCallback(async()=>{if(n){l(!0);try{await n()}finally{l(!1)}}},[n]);return{promptBeforeAction:m,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?v:void 0,isDownloading:o}}}const lz={onetime:{borderColor:"color-mix(in srgb, #a855f7 30%, transparent)",iconBg:"color-mix(in srgb, #a855f7 15%, transparent)",headerBg:"color-mix(in srgb, #a855f7 8%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, #3b82f6 30%, transparent)",iconBg:"color-mix(in srgb, #3b82f6 15%, transparent)",headerBg:"color-mix(in srgb, #3b82f6 8%, transparent)"},utility:{borderColor:"color-mix(in srgb, #22c55e 30%, transparent)",iconBg:"color-mix(in srgb, #22c55e 15%, transparent)",headerBg:"color-mix(in srgb, #22c55e 8%, transparent)"}};function Z0({title:t,icon:e,description:n,type:r,children:i,onValidateAll:o,isValidating:l=!1,isAnyRunning:d=!1}){const h=lz[r],m=l||d,p=()=>{o&&!m&&o()};return u.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[u.jsxs("div",{style:{background:h.headerBg,padding:"1.25rem 1.5rem",borderBottom:`2px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.875rem",flex:1},children:[u.jsx("span",{style:{fontSize:"1.75rem",background:h.iconBg,padding:"0.625rem",borderRadius:"10px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"48px",minHeight:"48px"},children:e}),u.jsxs("div",{children:[u.jsx("h3",{style:{margin:"0 0 0.375rem 0",fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em"},children:t}),u.jsx("p",{style:{margin:0,opacity:.75,fontSize:"0.9rem",lineHeight:1.4},children:n})]})]}),o&&u.jsx("button",{onClick:p,disabled:m,style:{background:"color-mix(in srgb, #3b82f6 20%, transparent)",color:"#60a5fa",border:"1px solid color-mix(in srgb, #3b82f6 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:m?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:m?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:l?u.jsxs(u.Fragment,{children:[u.jsx(Gn,{noMargin:!0})," Validating..."]}):" Validate All"})]}),u.jsx("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 1%, transparent)"},children:i})]})}const cz={unknown:{color:"#9ca3af",icon:"",text:"Unknown"},clean:{color:"#22c55e",icon:"",text:"Clean"},"needs-action":{color:"#f59e0b",icon:"",text:"Needs Action"},running:{color:"#60a5fa",icon:"",text:"Running"},complete:{color:"#22c55e",icon:"",text:"Complete"},error:{color:"#ef4444",icon:"",text:"Error"}};function J0({name:t,description:e,status:n,statusText:r,onCheck:i,isChecking:o,onRun:l,isRunning:d=!1,actionText:h="Run",disabled:m=!1,itemCount:p,details:g,isDestructive:v=!1}){const[_,C]=k.useState(!1),x=cz[n],S=r||x.text,E=m||d||o,T=()=>{i()},I=()=>{l&&l()},D=()=>{g&&C(!_)};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${x.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||o?u.jsx(Gn,{noMargin:!0}):x.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),u.jsxs("div",{style:{color:x.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[S,p!==void 0&&p>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${x.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:T,disabled:E,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:E?"not-allowed":"pointer",fontSize:"0.8rem",opacity:E?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?u.jsx(Gn,{noMargin:!0}):""}),l&&n==="needs-action"&&u.jsx("button",{onClick:I,disabled:E,style:{background:v?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:E?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:E?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:d?u.jsx(Gn,{noMargin:!0}):h}),g&&u.jsx("button",{onClick:D,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:_?"Collapse details":"Expand details",children:_?"":""})]})]}),_&&g&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function uz({name:t,description:e,onAction:n,actionText:r,actionIcon:i,isRunning:o=!1,disabled:l=!1,progress:d,error:h,isDestructive:m=!1}){const p=l||o,g=()=>{n()};return u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&u.jsx("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.25rem"},children:h})]}),d!==void 0&&o&&u.jsxs("div",{style:{width:"100px",flexShrink:0},children:[u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:u.jsx("div",{style:{background:m?"#ef4444":"#646cff",height:"100%",width:`${d}%`,transition:"width 0.3s"}})}),u.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[d,"%"]})]}),u.jsx("button",{onClick:g,disabled:p,style:{background:m?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?u.jsxs(u.Fragment,{children:[u.jsx(Gn,{noMargin:!0})," Running..."]}):u.jsxs(u.Fragment,{children:[i&&u.jsx("span",{children:i}),r]})})]})})}function dz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n}){return u.jsx(u.Fragment,{children:u.jsx(Z0,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:!1,children:null})})}const rA={unknown:{color:"#9ca3af",icon:""},clean:{color:"#22c55e",icon:""},"needs-action":{color:"#f59e0b",icon:""},running:{color:"#60a5fa",icon:""},complete:{color:"#22c55e",icon:""},error:{color:"#ef4444",icon:""}};function hz({check:t,disabled:e}){const n=rA[t.status],r=e||t.isRunning||t.isChecking;return u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?u.jsx(Gn,{noMargin:!0}):n.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&u.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),u.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?u.jsx(Gn,{noMargin:!0}):""}),t.canFix&&t.onFix&&u.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?u.jsx(Gn,{noMargin:!0}):"Fix"})]})]})}function fz({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:i,totalIssues:o,isScanning:l,isRunning:d,disabled:h,onRunOrphaned:m,onRunExpense:p,onRunTransfers:g}){const[v,_]=k.useState(!1),x=d?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?i?"needs-action":"clean":"unknown",S=rA[x],E=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(D=>D.transactionType==="income").length>0&&u.jsxs("span",{children:["Income: ",t.status.violations.filter(D=>D.transactionType==="income").length," "]}),t.status.violations.filter(D=>D.transactionType==="expense").length>0&&u.jsxs("span",{children:["Expenses: ",t.status.violations.filter(D=>D.transactionType==="expense").length," "]}),t.status.violations.filter(D=>D.transactionType==="adjustment").length>0&&u.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(D=>D.transactionType==="adjustment").length," "]}),t.status.violations.filter(D=>D.transactionType==="transfer").length>0&&u.jsxs("span",{children:["Transfers: ",t.status.violations.filter(D=>D.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:Xg(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:m,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&u.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&u.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:Xg(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:Xg(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&u.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&u.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||d||l,I=()=>{E.forEach(D=>D.onCheck())};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${S.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||l?u.jsx(Gn,{noMargin:!0}):S.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),u.jsxs("div",{style:{color:S.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[x==="unknown"?"Unknown":x==="clean"?"Clean":x==="running"?"Running":"Needs Action",o>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${S.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:I,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:l?u.jsx(Gn,{noMargin:!0}):""}),u.jsx("button",{onClick:()=>_(!v),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:v?"Collapse":"Expand",children:v?"":""})]})]}),v&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:E.map(D=>u.jsx(hz,{check:D,disabled:h},D.id))})]})}function Xg(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function mz({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:m}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return _>0?`Fixed ${_}`:"Complete"}},v=()=>{if(l){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsFixed>0&&u.jsxs("li",{children:[l.accountsFixed," account balance(s) fixed"]}),l.categoriesFixed>0&&u.jsxs("li",{children:[l.categoriesFixed," category value(s) fixed"]}),l.totalAvailableFixed>0&&u.jsxs("li",{children:[l.totalAvailableFixed," total_available value(s) fixed"]}),l.monthsProcessed>0&&u.jsxs("li",{children:[l.monthsProcessed," month(s) updated"]}),l.incomeValuesFixed>0&&u.jsxs("li",{children:[l.incomeValuesFixed," income amount(s) fixed"]}),l.expenseValuesFixed>0&&u.jsxs("li",{children:[l.expenseValuesFixed," expense amount(s) fixed"]}),l.categoryBalancesFixed>0&&u.jsxs("li",{children:[l.categoryBalancesFixed," category balance(s) fixed"]}),l.accountBalancesFixed>0&&u.jsxs("li",{children:[l.accountBalancesFixed," account balance(s) fixed"]}),_===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((C,x)=>u.jsx("li",{children:C},x)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Precision issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&u.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return u.jsx(J0,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:d,isChecking:i,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:m,itemCount:n?r:void 0,details:v(),isDestructive:!0})}function pz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,precisionCleanup:d}){const h=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning,m=i.isRunning||o.isRunning||l.isRunning||d.isRunning,p=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan()])},g=Eo({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),v=Eo({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),_=Eo({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),C=Eo({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),x=r.hasViolations||i.hasItemsToFix||o.hasItemsToMigrate||l.hasPairsToConvert,S=(r.violationCount||0)+(i.totalOrphaned||0)+(o.totalToMigrate||0)+(l.totalPairs||0);return u.jsxs(u.Fragment,{children:[u.jsxs(Z0,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:p,isValidating:h,isAnyRunning:m,children:[u.jsx(fz,{accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,needsAction:x,totalIssues:S,isScanning:r.isScanning||i.isScanning||o.isScanning||l.isScanning,isRunning:i.isRunning||o.isRunning||l.isRunning,disabled:t,onRunOrphaned:()=>g.promptBeforeAction(i.runMigration),onRunExpense:()=>v.promptBeforeAction(o.runMigration),onRunTransfers:()=>_.promptBeforeAction(l.runMigration)}),u.jsx(mz,{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isChecking:d.isScanning,isRunning:d.isRunning,result:d.result,onCheck:d.scan,onRun:()=>C.promptBeforeAction(d.runCleanup),disabled:t})]}),u.jsx(Co,{...g.promptProps,isDownloading:n}),u.jsx(Co,{...v.promptProps,isDownloading:n}),u.jsx(Co,{..._.promptProps,isDownloading:n}),u.jsx(Co,{...C.promptProps,isDownloading:n})]})}function gz({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:i,isUploading:o,uploadStatus:l,uploadProgress:d,uploadError:h,uploadResult:m,onScan:p,onUpload:g,disabled:v}){const _=k.useRef(null),[C,x]=k.useState(null),[S,E]=k.useState(!1),T=async q=>{const R=q.target.files?.[0];R&&(x(R),await p(R))},I=l!==null,D=I&&(l.budgetsFound>0||l.monthsFound>0),B=v||t||i||o,$=m?.success?"#22c55e":D?"#f59e0b":I?"#22c55e":"#9ca3af",M=m?.success?"":o||i||t?"":D?"":I?"":"",O=m?.success?"Uploaded":o?"Uploading":i?"Scanning":t?"Downloading":D?`${l.budgetsFound} budget(s), ${l.monthsFound} month(s) ready`:I?"Nothing to upload":"Select file",N=t?e?.percentComplete:d?.percentComplete,F=n||h;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${$} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||i||t?u.jsx(Gn,{noMargin:!0}):M}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),u.jsx("div",{style:{color:$,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:O}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{r()},disabled:B,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:B?"not-allowed":"pointer",fontSize:"0.8rem",opacity:B?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?u.jsx(Gn,{noMargin:!0}):""}),u.jsx("input",{ref:_,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),u.jsx("button",{onClick:()=>_.current?.click(),disabled:B,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:B?"not-allowed":"pointer",fontSize:"0.8rem",opacity:B?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:i?u.jsx(Gn,{noMargin:!0}):""}),D&&C&&u.jsx("button",{onClick:async()=>{await g(C)},disabled:B,style:{background:"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:B?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:B?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?u.jsx(Gn,{noMargin:!0}):"Upload"}),(I||m||F)&&u.jsx("button",{onClick:()=>E(!S),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:S?"Collapse":"Expand",children:S?"":""})]})]}),(t||o)&&N!==void 0&&u.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[u.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${N}%`,height:"100%",background:"#646cff",transition:"width 0.3s ease"}})}),u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:d?.phase,": ",N,"%"]})]}),S&&(I||m||F)&&u.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[F&&u.jsxs("div",{style:{marginBottom:"0.75rem",color:"#ef4444"},children:[" Error: ",F]}),m&&u.jsx("div",{style:{marginBottom:l?"0.75rem":0,color:m.success?"#22c55e":"#ef4444"},children:m.success?u.jsxs(u.Fragment,{children:[" Restored ",m.budgetsRestored," budget(s), ",m.monthsRestored," month(s), ",m.payeesRestored," payee doc(s)"]}):u.jsxs(u.Fragment,{children:[" Upload failed: ",m.errors.join(", ")]})}),l&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:[u.jsx("strong",{children:"Found in zip:"})," ",l.budgetsFound," budget(s), ",l.monthsFound," month(s), ",l.payeesFound," payee doc(s)"]}),l.budgetsToRestore.length>0&&u.jsxs("div",{children:[u.jsx("strong",{children:"Budgets to restore:"})," ",l.budgetsToRestore.join(", ")]})]})]})]})}function yz({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:i,deleteResult:o,onCheck:l,onDelete:d,disabled:h}){const[m,p]=k.useState(!1),g=()=>i?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",v=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,_=()=>{p(!0)},C=()=>{p(!1),d()},x=()=>o?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&u.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((S,E)=>u.jsx("li",{children:S},E)),o.errors.length>3&&u.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?u.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#ef4444"},children:" DESTRUCTIVE ACTION"}),u.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return u.jsxs(u.Fragment,{children:[u.jsx(J0,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:v(),onCheck:l,isChecking:r,onRun:e>0?_:void 0,isRunning:i,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:x(),isDestructive:!0}),u.jsxs(ds,{isOpen:m,onClose:()=>p(!1),title:" Delete All Months?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#ef4444"},children:[e," month(s)"]})," across"," ",u.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget(s)"]}),"."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"All account balances  $0"}),u.jsx("li",{children:"All category balances  $0"}),u.jsx("li",{children:"Month history cleared"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),u.jsxs(Ve,{variant:"danger",actionName:"Confirm Delete All Months",onClick:C,children:[" Delete All ",e," Months"]})]})]})]})}function _z({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:i,isDeleting:o,deleteResult:l,onCheck:d,onDelete:h,disabled:m}){const[p,g]=k.useState(!1),v=t?.staleBudgetIds??[],_=v.length>0,C=()=>o?"running":e?l&&l.errors.length===0?"complete":n===0&&!_?"clean":"needs-action":"unknown",x=()=>l&&l.errors.length===0?`Deleted ${l.budgetsDeleted}`:n===0&&!_?"Clean":_?`${v.length} stale ref(s)`:`${n} budget(s)`,S=()=>{g(!0)},E=()=>{g(!1),h()},T=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsDeleted>0&&u.jsxs("li",{children:[l.budgetsDeleted," budget(s) deleted"]}),l.monthsDeleted>0&&u.jsxs("li",{children:[l.monthsDeleted," month(s) deleted"]}),l.payeesDeleted>0&&u.jsxs("li",{children:[l.payeesDeleted," payee doc(s) deleted"]})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((D,B)=>u.jsx("li",{children:D},B)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n===0&&!_?u.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):_?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Found stale budget references:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[v.slice(0,3).map(D=>u.jsx("li",{style:{opacity:.8},children:D},D)),v.length>3&&u.jsxs("li",{style:{opacity:.6},children:["...and ",v.length-3," more"]})]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Sample user budget found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[n," budget(s)"]}),u.jsxs("li",{children:[r," month(s)"]})]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),I=n>0||_;return u.jsxs(u.Fragment,{children:[u.jsx(J0,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:C(),statusText:x(),onCheck:d,isChecking:i,onRun:I?S:void 0,isRunning:o,actionText:"Delete",disabled:m,itemCount:I?n||v.length:void 0,details:T(),isDestructive:!0}),u.jsxs(ds,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #f59e0b 15%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[n," budget(s)"]})," and"," ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[r," month(s)"]}),"."]}),_&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[v.length," stale reference(s)"]})," from the user document."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"Budget document deleted"}),u.jsx("li",{children:"All month documents deleted"}),u.jsx("li",{children:"Payees document deleted"}),u.jsx("li",{children:"User will see onboarding flow"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:E,children:" Delete Sample User Data"})]})]})]})}function bz({onClearCache:t,disabled:e}){const[n,r]=k.useState(!1),i=()=>{r(!0)},o=()=>{r(!1),t()};return u.jsxs(u.Fragment,{children:[u.jsx(uz,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:i,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),u.jsxs(ds,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data and reload the page. The app will fetch fresh data from Firestore for everything."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function vz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,deleteAllMonths:i,deleteSampleUserBudget:o,onClearCache:l}){const d=r.isDownloading||r.isUploading||i.isDeleting||o.isDeleting,h=Eo({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),m=Eo({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),p=Eo({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e});return u.jsxs(u.Fragment,{children:[u.jsxs(Z0,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:d,children:[u.jsx(gz,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async g=>{p.promptBeforeAction(()=>{r.uploadBudget(g).catch(v=>console.error("Upload failed:",v))})},disabled:t}),u.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[u.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),u.jsx(yz,{status:i.status,hasData:i.hasData,monthsCount:i.monthsCount,budgetCount:i.budgetCount,isChecking:i.isScanning,isDeleting:i.isDeleting,deleteResult:i.deleteResult,deleteProgress:i.deleteProgress,onCheck:i.scanStatus,onDelete:()=>h.promptBeforeAction(i.deleteAllMonths),disabled:t}),u.jsx(_z,{status:o.status,hasData:o.hasData,totalBudgets:o.totalBudgets,totalMonths:o.totalMonths,isChecking:o.isScanning,isDeleting:o.isDeleting,deleteResult:o.deleteResult,deleteProgress:o.deleteProgress,onCheck:o.scanStatus,onDelete:()=>m.promptBeforeAction(o.deleteSampleUserBudget),disabled:t}),u.jsx(bz,{onClearCache:l,disabled:t})]})]}),u.jsx(Co,{...h.promptProps,isDownloading:n}),u.jsx(Co,{...m.promptProps,isDownloading:n}),u.jsx(Co,{...p.promptProps,isDownloading:n})]})}function e_({message:t="Loading...",spinnerColor:e=me.primary,children:n,spinnerSize:r=4}){return u.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[u.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,u.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function sA({percent:t,gradient:e="linear-gradient(90deg, #646cff, #8b5cf6)",width:n=300}){return u.jsx("div",{style:{width:`${n}px`,height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${t}%`,height:"100%",background:e,borderRadius:"4px",transition:"width 0.3s ease-out"}})})}function Bf({value:t,label:e,color:n="#646cff"}){return u.jsxs("div",{style:{textAlign:"center"},children:[u.jsx("p",{style:{color:n,fontSize:"1.5rem",fontWeight:700,margin:0},children:t}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.8rem",margin:"0.25rem 0 0",textTransform:"uppercase",letterSpacing:"0.05em"},children:e})]})}function iA({percent:t}){return u.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:"0.9rem",margin:0},children:[t,"% complete"]})}function xz(){return u.jsxs("div",{style:Mf,children:[u.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:u.jsx(jn,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),u.jsx("h1",{children:"Tarron Lane Homepage"}),u.jsx("nav",{children:u.jsxs("ul",{children:[u.jsx("li",{children:u.jsx(jn,{to:"/sql-test",children:"SQL Test"})}),u.jsx("li",{children:u.jsx(jn,{to:"/budget",children:"Budget"})}),u.jsx("li",{children:u.jsx(jn,{to:"/account",children:"Account"})})]})})]})}function wz(){const t=k.useContext(fd),e=Pa(),[n,r]=k.useState(!1),i=Nn(),o=Wu(),l=i.state?.from||"/";k.useEffect(()=>{t.is_logged_in&&l!=="/"&&o(l,{replace:!0})},[t.is_logged_in,l,o]);function d(){r(!0),e.logout_firebase_user().then(function(){Be.clear(),window.location.href="/"})}return u.jsxs("div",{style:Mf,children:[u.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx(jn,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),u.jsxs(jn,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),u.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:u.jsx(ZT,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),u.jsx("h1",{children:"Account"}),t.is_logged_in?n?u.jsx("p",{children:"Logging Out..."}):u.jsxs(u.Fragment,{children:[u.jsxs("p",{children:["You are logged in as ",t.username]}),u.jsx("button",{onClick:d,style:{marginTop:"1rem"},children:"Logout"})]}):u.jsx(Sz,{})]})}function Sz(){const t=Pa(),[e,n]=k.useState(""),[r,i]=k.useState(""),[o,l]=k.useState(!1),[d,h]=k.useState(!1),[m,p]=k.useState("");function g(C){n(C.target.value)}function v(C){i(C.target.value)}function _(C){C.preventDefault(),h(!0),p(""),Be.clear(),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return u.jsxs("form",{onSubmit:_,children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"username",children:"Email: "}),u.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"password",children:"Password: "}),u.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[u.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:v,style:{paddingRight:"2rem"}}),u.jsx("button",{type:"button",onClick:()=>l(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),d?u.jsx("p",{children:"Logging in..."}):u.jsx("button",{children:"Login"}),m&&u.jsx("p",{style:{color:"red"},children:m})]})}const Cz={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"},Ez={balances:"categories",transactions:"income"};function Tz({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const r=Cz[t],i=k.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),o=k.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"}],[n]),l=k.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),d=m=>{e(Ez[m])},h=r==="balances"?o:l;return u.jsxs("div",{children:[u.jsx(Pf,{mode:"button",tabs:i,activeTab:r,onTabChange:d,variant:"segmented"}),u.jsx(Pf,{mode:"button",tabs:h,activeTab:t,onTabChange:m=>e(m),variant:"secondary"})]})}function Az({isOpen:t,onClose:e,onProceed:n,results:r}){const[i,o]=k.useState("from_current"),l=!r||r.status==="confirming",d=r&&!["confirming","done","error"].includes(r.status),h=l||r?.status==="done"||r?.status==="error";function m(){h&&(e(),o("from_current"))}function p(){n(i)}return u.jsx(ds,{isOpen:t,onClose:m,title:"Recalculate Balances",width:"540px",children:u.jsxs("div",{style:{padding:"0.5rem 0"},children:[l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.95rem",lineHeight:1.5},children:"Choose what to recalculate:"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(G1,{selected:i==="from_current",onClick:()=>o("from_current"),title:"From current month forward",description:"Recalculate from this month onward. Use for quick fixes."}),u.jsx(G1,{selected:i==="all_months",onClick:()=>o("all_months"),title:"All months from beginning",description:"Recalculate entire history. Use after migrations or data repairs.",recommended:!0})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(Il,{status:"waiting",label:"Find all months to process"}),u.jsx(Il,{status:"waiting",label:"Process months"}),u.jsx(Il,{status:"waiting",label:"Update budget totals"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Recalculation",onClick:e,children:"Cancel"}),u.jsx(Ve,{actionName:"Proceed with Recalculation",onClick:p,children:"Proceed"})]})]}),!l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Recalculating category balances and account balances..."}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx(Il,{status:r?.status==="pending"?"waiting":"complete",label:"Find all months to process",detail:r&&r.status!=="pending"?`Found ${r.monthsFound||0} month${r.monthsFound!==1?"s":""}`:void 0}),u.jsx(Il,{status:H1(r?.status,["pending","finding_months"],"processing_months"),label:"Process months",detail:r?.status==="processing_months"?`Processing: ${r.currentMonthLabel} (${(r.currentMonthIndex||0)+1}/${r.monthsFound||0})`:r?.monthsProcessed!==void 0?`Processed ${r.monthsProcessed} month${r.monthsProcessed!==1?"s":""}`:void 0}),u.jsx(Il,{status:r?.status==="error"?"error":H1(r?.status,["pending","finding_months","processing_months"],"updating_budget"),label:"Update budget totals",detail:r?.status==="error"?r.error:void 0,isError:r?.status==="error"})]}),r?.status==="done"&&u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:`color-mix(in srgb, ${me.success} 10%, transparent)`,border:`1px solid ${me.success}`,borderRadius:"8px",textAlign:"center"},children:[u.jsx("p",{style:{margin:0,fontWeight:600,color:me.success},children:" Recalculation complete!"}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",opacity:.8},children:[r.monthsProcessed," month",r.monthsProcessed!==1?"s":""," processed",u.jsx("br",{}),"Total Income: ",st(r.totalIncomeRecalculated||0),u.jsx("br",{}),"Total Expenses: ",st(r.totalExpensesRecalculated||0)]})]}),(r?.status==="done"||r?.status==="error")&&u.jsx("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"center"},children:u.jsx(Ve,{actionName:"Close Recalculation Modal",onClick:e,children:"Done"})}),d&&u.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"Please wait, do not close this window..."})]})]})})}function H1(t,e,n){return!t||e.includes(t)?t===n?"active":"waiting":t===n?"active":"complete"}function Il({status:t,label:e,detail:n,isError:r}){const i=t==="waiting"?"":t==="active"?"":t==="error"?"":"";return u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{fontSize:"1.1rem",width:"1.5rem",textAlign:"center"},children:i}),u.jsxs("div",{style:{flex:1},children:[u.jsx("p",{style:{margin:0,fontWeight:500},children:e}),n&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:r?1:.6,color:r?me.error:"inherit"},children:n})]})]})}function G1({selected:t,onClick:e,title:n,description:r,recommended:i}){return u.jsxs("button",{type:"button",onClick:e,style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem 1rem",background:t?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",border:t?"2px solid #646cff":"2px solid transparent",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.15s ease"},children:[u.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",border:t?"6px solid #646cff":"2px solid rgba(128,128,128,0.5)",flexShrink:0,marginTop:"2px",background:t?"white":"transparent"}}),u.jsxs("div",{style:{flex:1},children:[u.jsxs("p",{style:{margin:0,fontWeight:600,fontSize:"0.95rem"},children:[n,i&&u.jsx("span",{style:{marginLeft:"0.5rem",padding:"0.15rem 0.5rem",background:me.success,color:"white",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,verticalAlign:"middle"},children:"RECOMMENDED"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:r})]})]})}function t_({isDisabled:t,onCloseMenu:e}){const{selectedBudgetId:n}=Xe(),{categories:r}=In(),[i,o]=k.useState(!1),[l,d]=k.useState(!1),[h,m]=k.useState(null);function p(){d(!0),m({status:"confirming"})}async function g(_){if(n){o(!0),m({status:"pending"});try{m({status:"finding_months"});const x=(await $n("months","recalculate all: querying all months",[{field:"budget_id",op:"==",value:n}])).docs.map(P=>{const A=P.data;return{budget_id:n,year_month_ordinal:A.year_month_ordinal??`${A.year}${String(A.month).padStart(2,"0")}`,year:A.year,month:A.month,income:A.income||[],total_income:A.total_income??0,previous_month_income:A.previous_month_income??0,expenses:A.expenses||[],total_expenses:A.total_expenses??0,transfers:A.transfers||[],adjustments:A.adjustments||[],account_balances:A.account_balances||[],category_balances:A.category_balances||[],are_allocations_finalized:A.are_allocations_finalized??!1,created_at:A.created_at,updated_at:A.updated_at}}).sort((P,A)=>P.year!==A.year?P.year-A.year:P.month-A.month);if(m({status:"finding_months",monthsFound:x.length}),x.length===0){m({status:"done",monthsFound:0,monthsProcessed:0,totalIncomeRecalculated:0,totalExpensesRecalculated:0});return}const S=x[0];let E=cd;if(S){const P={},A={};for(const W of S.category_balances||[])rt(W.category_id)||(P[W.category_id]=ze(W.start_balance??0));for(const W of S.account_balances||[])Ze(W.account_id)||(A[W.account_id]=ze(W.start_balance??0));E={categoryEndBalances:P,accountEndBalances:A,totalIncome:ze(S.previous_month_income??0)}}m({status:"processing_months",monthsFound:x.length,currentMonthIndex:0});const T=[];let I=0,D=0;for(let P=0;P<x.length;P++){const A=x[P],W=`${$u[A.month-1]} ${A.year}`;m({status:"processing_months",monthsFound:x.length,currentMonthIndex:P,currentMonthLabel:W});const K=ud(A,E);T.push(K),I+=K.total_income,D+=K.total_expenses,E=Oo(K)}if(m({status:"updating_budget",monthsFound:x.length,monthsProcessed:x.length}),T.length>0){const P=T.map(A=>({collectionPath:"months",docId:ps(n,A.year,A.month),data:Ws({...A,updated_at:new Date().toISOString()})}));await pc(P,"recalculate all: batch write months");for(const A of T)Be.setQueryData(Re.month(n,A.year,A.month),{month:A})}m({status:"updating_budget",monthsFound:x.length,monthsProcessed:x.length,totalIncomeRecalculated:I,totalExpensesRecalculated:D});const B=E.accountEndBalances,$=E.categoryEndBalances,M=T[T.length-1],O=Object.keys(r),N=await _m(n,O,$,M.year,M.month),q=Be.getQueryData(Re.budget(n))?.budget?.month_map||{};await wm(n,B,N,q);const{data:R}=await Et("budgets",n,"[recalculate all] reading budget for assertions");if(R&&T.length>0){const P=T[T.length-1],A=await Y0({budgetId:n,categories:R.categories||{},totalAvailable:R.total_available??0,currentYear:P.year,currentMonth:P.month});X0(A,"[Recalculate All]").forEach(K=>en.add(K))}m({status:"done",monthsFound:x.length,monthsProcessed:x.length,totalIncomeRecalculated:I,totalExpensesRecalculated:D})}catch(C){const x=C instanceof Error?C.message:"Failed to recalculate";console.error("[RecalculateAllButton] Recalculate error:",C),m({status:"error",error:x}),en.add({type:"error",message:`Recalculation failed: ${x}`,autoDismissMs:1e4})}finally{o(!1)}}}function v(){d(!1),m(null),e?.()}return u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:p,disabled:t||i,style:{background:"color-mix(in srgb, currentColor 15%, transparent)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"6px",padding:"0.4rem 0.75rem",cursor:t||i?"not-allowed":"pointer",opacity:t||i?.5:1,fontSize:"0.9rem",fontWeight:500,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",transition:"all 0.15s ease"},onMouseEnter:_=>{!t&&!i&&(_.currentTarget.style.background="color-mix(in srgb, currentColor 20%, transparent)",_.currentTarget.style.borderColor="rgba(255,255,255,0.3)")},onMouseLeave:_=>{!t&&!i&&(_.currentTarget.style.background="color-mix(in srgb, currentColor 15%, transparent)",_.currentTarget.style.borderColor="rgba(255,255,255,0.2)")},title:"Recalculate all months from the beginning",children:[i?"":""," Recalculate"]}),u.jsx(Az,{isOpen:l,onClose:v,onProceed:g,results:h})]})}function Q1({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:i}){const[o,l]=k.useState(!1),d=n||e,h=t==="prev"?"":"",m=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(l(!0),setTimeout(()=>l(!1),2e3)):i())};return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("button",{onClick:p,onMouseEnter:()=>e&&l(!0),onMouseLeave:()=>l(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:d?"not-allowed":"pointer",fontSize:"1.25rem",opacity:d?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:m,children:h}),o&&e&&u.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:me.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r})]})}function jz({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:i,maxOrdinal:o,minAllowed:l,maxAllowed:d,onYearChange:h,onMonthChange:m,onGo:p}){const g=t>l.year,v=t<d.year,_=Number(bt(t,e)),C=_>=i&&_<=o;return u.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[u.jsx("button",{onClick:()=>h(t-1),disabled:!g,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:g?"pointer":"not-allowed",fontSize:"0.8rem",opacity:g?1:.3},title:g?"Previous year":"Cannot go further back",children:""}),u.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),u.jsx("button",{onClick:()=>h(t+1),disabled:!v,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:v?"pointer":"not-allowed",fontSize:"0.8rem",opacity:v?1:.3},title:v?"Next year":"Cannot go further ahead",children:""})]}),u.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:$u.map((x,S)=>{const E=S+1,T=E===e,I=t===n&&E===r,D=Number(bt(t,E)),B=D<i,$=D>o,M=B||$;let O=x;return B?O="Too far in the past":$&&(O="Too far in the future"),u.jsx("button",{onClick:()=>m(E),disabled:M,style:{background:T?me.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:I?`1px solid ${me.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:M?"not-allowed":"pointer",fontSize:"0.7rem",color:T?"#fff":"inherit",opacity:M?.3:1,transition:"background 0.15s"},title:O,children:x.slice(0,3)},E)})}),u.jsxs("button",{onClick:p,disabled:!C,style:{width:"100%",background:C?me.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:C?"pointer":"not-allowed",fontSize:"0.85rem",color:C?"#fff":"inherit",fontWeight:500,opacity:C?1:.5},children:["Go to ",$u[e-1]," ",t]})]})}function Rz({isOpen:t,onClose:e,year:n,month:r,isDeleting:i,onConfirm:o}){return u.jsxs(ds,{isOpen:t,onClose:e,title:" Delete Month?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsxs("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",$u[r-1]," ",n,"!"]})}),u.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:i,children:"Cancel"}),u.jsx(Ve,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:i,children:i?"Deleting...":" Delete Month"})]})]})}function Iz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+ka;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function kz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-Df;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function Dz(t){return Object.keys(t).sort()[0]}function Mz(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function Oz(t){const e=kz(),n=Dz(t);if(!n)return e;const r=bt(e.year,e.month);return n<r?Mz(n):e}function W1(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function Nz(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function Pz({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=Pn(),{currentYear:r,currentMonthNumber:i,isAdmin:o,selectedBudgetId:l,setCurrentYear:d,setCurrentMonthNumber:h}=Xe(),{budget:m,monthMap:p}=In(),{month:g}=Ks(l,r,i),v=W1(r,i),_=Nz(r,i),C=Oz(p),x=Iz(),S=Number(bt(C.year,C.month)),E=Number(bt(x.year,x.month)),T=Number(bt(v.year,v.month)),I=Number(bt(_.year,_.month)),D=T<S,B=I>E,[$,M]=k.useState(!1),[O,N]=k.useState(!1),[F,q]=k.useState(r),[R,P]=k.useState(i),[A,W]=k.useState(!1),[K,G]=k.useState(!1),J=k.useRef(null),X=(()=>{if(!p||Object.keys(p).length===0)return!1;const ne=bt(r,i),fe=Math.max(...Object.keys(p).map(Number));return Number(ne)===fe})(),{trackChange:ie}=gc();async function L(){if(l){G(!0);try{const ne=ps(l,r,i);Q6(l,r,i,ie),await Oy("months",ne,`deleting month ${r}/${i}`),`${r}${i}`,Be.removeQueries({queryKey:Re.month(l,r,i)});const fe=W1(r,i);W(!1),M(!1),window.location.href=`/budget/${fe.year}/${fe.month}/categories`}catch(ne){console.error("Failed to delete month:",ne),alert(`Failed to delete month: ${ne instanceof Error?ne.message:"Unknown error"}`)}finally{G(!1)}}}k.useEffect(()=>{if(!$)return;function ne(fe){J.current&&!J.current.contains(fe.target)&&(M(!1),N(!1))}return document.addEventListener("mousedown",ne),()=>document.removeEventListener("mousedown",ne)},[$]);function H(){O||(q(r),P(i)),N(!O)}function te(){d(F),h(R),N(!1),M(!1)}async function se(){if(!g||!m)return;const ne=new Date,Ce=`${ne.toISOString().split("T")[0]}_month_${r}_${String(i).padStart(2,"0")}`,de=new jm,be=[{name:`${Ce}_income.json`,data:g.income||[]},{name:`${Ce}_expenses.json`,data:g.expenses||[]},{name:`${Ce}_transfers.json`,data:g.transfers||[]},{name:`${Ce}_adjustments.json`,data:g.adjustments||[]},{name:`${Ce}_account_balances.json`,data:g.account_balances||[]},{name:`${Ce}_category_balances.json`,data:g.category_balances||[]}],Me={budget_id:m.id,budget_name:m.name,year_month_ordinal:g.year_month_ordinal,year:g.year,month:g.month,total_income:g.total_income,previous_month_income:g.previous_month_income,total_expenses:g.total_expenses,are_allocations_finalized:g.are_allocations_finalized,created_at:g.created_at,updated_at:g.updated_at,downloaded_at:ne.toISOString()};be.push({name:`${Ce}_metadata.json`,data:Me});for(const U of be)de.file(U.name,JSON.stringify(U.data,null,2));const Oe=await de.generateAsync({type:"blob"}),qe=URL.createObjectURL(Oe),ot=document.createElement("a");ot.href=qe,ot.download=`${Ce}.zip`,document.body.appendChild(ot),ot.click(),document.body.removeChild(ot),URL.revokeObjectURL(qe),M(!1)}return u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[u.jsx(Q1,{direction:"prev",isDisabled:D,isLoading:n,disabledReason:"Cannot create months more than 3 months into the past",onNavigate:t}),u.jsxs("div",{ref:J,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[$u[i-1]," ",r]}),u.jsx("button",{onClick:()=>M(!$),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:$?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&u.jsxs(u.Fragment,{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:me.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),u.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),$&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[u.jsx(t_,{isDisabled:n,onCloseMenu:()=>M(!1)}),u.jsx("button",{onClick:H,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),O&&u.jsx(jz,{pickerYear:F,pickerMonth:R,currentYear:r,currentMonthNumber:i,minOrdinal:S,maxOrdinal:E,minAllowed:C,maxAllowed:x,onYearChange:q,onMonthChange:P,onGo:te}),o&&g&&u.jsx("button",{onClick:()=>{se()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&g&&X&&u.jsx("button",{onClick:()=>W(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"#ef4444",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),u.jsx(Q1,{direction:"next",isDisabled:B,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),u.jsx(Rz,{isOpen:A,onClose:()=>W(!1),year:r,month:i,isDeleting:K,onConfirm:L})]})}const n_={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},zz={...n_,background:me.primary,border:"none",color:"white"},Bz={...n_,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},Lz={...n_,background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error},K1=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${me.error} 15%, transparent)`:`color-mix(in srgb, ${me.success} 15%, transparent)`,border:`1px solid ${t?me.errorBorder:"rgba(74, 222, 128, 0.4)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?me.error:me.success,transition:"all 0.15s ease",flexShrink:0});function r_({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,config:h,onSubmit:m,onCancel:p,onDelete:g,extraContent:v}){const{isWide:_}=MT(),{showCategory:C=!1,showCleared:x=!1,showSignToggle:S=!1,accountLabel:E="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:I="Optional note",submitLabel:D}=h,B=new Date().toISOString().split("T")[0],[$,M]=k.useState(o?.date||d||B),[O,N]=k.useState(o?.payee||""),[F,q]=k.useState(o?.categoryId||(h.showNoCategoryOption?Xt:"")),[R,P]=k.useState(o?.accountId||l||(h.showNoAccountOption?Gt:t[0]?t[0][0]:"")),A=o?.amount!==void 0?Math.abs(o.amount):void 0,[W,K]=k.useState(A?.toString()||""),[G,J]=k.useState(o?.description||""),[X,ie]=k.useState(o?.cleared||!1),[L,H]=k.useState(()=>S?o?.amount!==void 0?o.amount<0:!1:!0),[te,se]=k.useState(!1),ne={},fe=[];t.forEach(([we,ae])=>{ae.account_group_id?(ne[ae.account_group_id]||(ne[ae.account_group_id]=[]),ne[ae.account_group_id].push([we,ae])):fe.push([we,ae])});function Ce(we){we.preventDefault();const ae=parseFloat(W);if(isNaN(ae)||ae<=0||C&&!F||!R||!$)return;if(F===Xt&&R===Gt){se(!0);return}se(!1);const De=S&&L?-ae:ae;m({date:$,payee:O.trim()||void 0,categoryId:C?F:void 0,accountId:R,amount:De,description:G.trim()||void 0,cleared:x?X:void 0})}!(F===Xt&&R===Gt)&&te&&se(!1);const Oe=h.showNoAccountOption?u.jsx(DT,{id:"txn-account",value:R,onChange:P,accounts:t,accountGroups:e,placeholder:Da,required:!0,showNoAccountOption:!0}):u.jsxs(Hu,{id:"txn-account",value:R,onChange:we=>P(we.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([we,ae])=>{const Ae=ne[we];return Ae?.length?u.jsx("optgroup",{label:ae.name,children:Ae.map(([Ne,De])=>u.jsx("option",{value:Ne,children:De.nickname},Ne))},we):null}),fe.length>0&&u.jsx("optgroup",{label:"Other",children:fe.map(([we,ae])=>u.jsx("option",{value:we,children:ae.nickname},we))})]}),qe=C&&n&&r?u.jsx(zt,{label:"Category",htmlFor:"txn-category",children:u.jsx(kT,{id:"txn-category",value:F,onChange:q,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?Mo:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,ot=x?u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Gr,{id:"txn-cleared",checked:X,onChange:we=>ie(we.target.checked)})]}):null,U=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:D,style:zz,children:""}),u.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:Bz,children:""}),g&&u.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:Lz,children:""})]})]}),ce=te?u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:me.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,ye=u.jsxs(Ua,{children:[u.jsx(Ve,{type:"submit",actionName:D,children:D}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&u.jsx(Ve,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),ee=C&&n&&r,Z={fontSize:"0.85rem",padding:"0.5rem"};if(!_)return u.jsxs(Ti,{actionName:D,onSubmit:Ce,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(zt,{label:"Date",htmlFor:"txn-date",children:u.jsx(Nf,{id:"txn-date",value:$,onChange:we=>M(we.target.value),required:!0,autoFocus:!0})}),u.jsx(zt,{label:S?L?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>H(!L),style:K1(L),title:L?"Click to make this a refund (+)":"Click to make this an expense (-)",children:L?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(So,{id:"txn-amount",value:W,onChange:K,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:L?me.error:me.success}})})]}):u.jsx(So,{id:"txn-amount",value:W,onChange:K,placeholder:"$0.00",required:!0})})]}),u.jsx(zt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(D1,{id:"txn-payee",value:O,onChange:N,payees:i,placeholder:T})}),qe,u.jsx(zt,{label:E,htmlFor:"txn-account",children:Oe}),u.jsx(zt,{label:"Description (optional)",htmlFor:"txn-description",children:u.jsx(Ai,{id:"txn-description",value:G,onChange:we=>J(we.target.value),placeholder:I})}),x&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Gr,{id:"txn-cleared-stacked",checked:X,onChange:we=>ie(we.target.checked)}),u.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),ce,v]}),ye]});const oe=S?"8.25rem":"6rem",Se=ee?x?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto`:x?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto`;return u.jsxs(Ti,{actionName:D,onSubmit:Ce,children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:Se,gap:"1rem",alignItems:"end"},children:[u.jsx(zt,{label:"Date",htmlFor:"txn-date",children:u.jsx(Nf,{id:"txn-date",value:$,onChange:we=>M(we.target.value),required:!0,style:Z,autoFocus:!0})}),u.jsx(zt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(D1,{id:"txn-payee",value:O,onChange:N,payees:i,placeholder:T})}),qe,u.jsx(zt,{label:E,htmlFor:"txn-account",children:Oe}),u.jsx(zt,{label:S?L?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>H(!L),style:K1(L),title:L?"Click to make this a refund (+)":"Click to make this an expense (-)",children:L?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(So,{id:"txn-amount",value:W,onChange:K,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:L?me.error:me.success}})})]}):u.jsx(So,{id:"txn-amount",value:W,onChange:K,placeholder:"$0.00",required:!0})}),u.jsx(zt,{label:"Description",htmlFor:"txn-description",children:u.jsx(Ai,{id:"txn-description",value:G,onChange:we=>J(we.target.value),placeholder:I,style:Z})}),ot,U]}),ce,v]})}function Y1({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:m}){function p(g){l(g.amount,g.accountId,g.date,g.payee,g.description)}return u.jsx(r_,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:i,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:m},onSubmit:p,onCancel:d,onDelete:h})}function Uz({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:i,isMobile:o,isEvenRow:l}){const d=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,m=l?"transparent":"rgba(255,255,255,0.04)";if(o)return u.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:m,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:d}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsxs("span",{style:{fontWeight:600,color:me.success,fontFamily:"monospace"},children:["+",st(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:m,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:d})}),u.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...p,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:me.success,fontFamily:"monospace"},children:["+",st(t.amount)]}),u.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const kl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Fz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l}=In(),{month:d,isLoading:h}=Ks(t,e,n),{addIncome:m}=n3(),{updateIncome:p}=s3(),{deleteIncome:g}=i3(),v=Ri(),[_,C]=k.useState(null),[x,S]=k.useState(!1),[E,T]=k.useState(null),B=F0(t,{enabled:x||E!==null}).data||[];function $(G){const J=G.account_group_id?l[G.account_group_id]:void 0;return J&&J.is_active!==null?J.is_active:G.is_active!==!1}function M(G){const J=G.account_group_id?l[G.account_group_id]:void 0;return J&&J.on_budget!==null?J.on_budget:G.on_budget!==!1}const O=Object.entries(o).filter(([,G])=>$(G)&&M(G)),N=O.filter(([,G])=>G.is_income_account),F=N.length>0?N:O,q=O.find(([,G])=>G.is_income_default),R=q?q[0]:void 0,P=d?.income.reduce((G,J)=>G+J.amount,0)||0;function A(G,J,X,ie,L){if(!t)return;C(null),S(!1);const{year:H,month:te}=ym(X);(H!==e||te!==n)&&(r(H),i(te)),m(t,H,te,G,J,X,ie,L).catch(se=>{C(se instanceof Error?se.message:"Failed to add income")})}function W(G,J,X,ie,L,H){t&&(C(null),T(null),p(t,e,n,G,J,X,ie,L,H).catch(te=>{C(te instanceof Error?te.message:"Failed to update income")}))}function K(G){t&&confirm("Are you sure you want to delete this income entry?")&&(C(null),g(t,e,n,G).catch(J=>{C(J instanceof Error?J.message:"Failed to delete income")}))}return u.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[_&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:_}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:v?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:v?"block":"grid",gridTemplateColumns:v?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Income:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ct(P),fontWeight:600},children:st(P)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!x&&u.jsx(Ve,{actionName:"Open Add Income Form",onClick:()=>S(!0),disabled:F.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!v&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:kl,children:"Date"}),u.jsx("div",{style:kl,children:"Payee"}),u.jsx("div",{style:kl,children:"Account"}),u.jsx("div",{style:{...kl,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:kl,children:"Description"}),u.jsx("div",{style:kl})]})]}),u.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),F.length===0&&u.jsx(Gu,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),x&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(Y1,{accounts:F,accountGroups:l,payees:B,defaultAccountId:R,defaultDate:gm(e,n),onSubmit:A,onCancel:()=>S(!1),submitLabel:"Add Income",isMobile:v})}),d?.income.slice().sort((G,J)=>(G.date||"").localeCompare(J.date||"")).map((G,J)=>E===G.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(Y1,{accounts:F,accountGroups:l,payees:B,initialData:G,onSubmit:(X,ie,L,H,te)=>W(G.id,X,ie,L,H,te),onCancel:()=>T(null),onDelete:()=>K(G.id),submitLabel:"Save",isMobile:v})},G.id):u.jsx(Uz,{income:G,accountName:Ze(G.account_id)?Da:o[G.account_id]?.nickname||"Unknown Account",accountGroupName:Ze(G.account_id)?void 0:o[G.account_id]?.account_group_id?l[o[G.account_id].account_group_id]?.name:void 0,onEdit:()=>{G.payee||`${G.amount}`,T(G.id)},onDelete:()=>K(G.id),isMobile:v,isEvenRow:J%2===0},G.id)),(!d?.income||d.income.length===0)&&!x&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function X1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:m,onDelete:p,submitLabel:g}){function v(_){h(_.amount,_.categoryId,_.accountId,_.date,_.payee,_.description,_.cleared)}return u.jsx(r_,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:v,onCancel:m,onDelete:p})}function Vz({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",m]})]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx("span",{style:{fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Lt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Lt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const ca={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function $z(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=In(),{month:m,isLoading:p}=Ks(t,e,n),{addExpense:g}=o3(),{updateExpense:v}=c3(),{deleteExpense:_}=u3(),C=Ri(),[x,S]=k.useState(null),[E,T]=k.useState(!1),[I,D]=k.useState(null),M=F0(t,{enabled:E||I!==null}).data||[];function O(X){const ie=X.account_group_id?l[X.account_group_id]:void 0;return ie&&ie.is_active!==null?ie.is_active:X.is_active!==!1}function N(X){const ie=X.account_group_id?l[X.account_group_id]:void 0;return ie&&ie.on_budget!==null?ie.on_budget:X.on_budget!==!1}const F=Object.entries(o).filter(([,X])=>O(X)&&N(X)),q=F.filter(([,X])=>X.is_outgo_account),R=q.length>0?q:F,P=F.find(([,X])=>X.is_outgo_default),A=P?P[0]:void 0,W=m?.expenses?.reduce((X,ie)=>X+ie.amount,0)||0;function K(X,ie,L,H,te,se,ne){if(!t)return;S(null),T(!1);const{year:fe,month:Ce}=ym(H);(fe!==e||Ce!==n)&&(r(fe),i(Ce)),g(t,fe,Ce,X,ie,L,H,te,se,ne).catch(de=>{S(de instanceof Error?de.message:"Failed to add expense")})}function G(X,ie,L,H,te,se,ne,fe){t&&(S(null),D(null),v(t,e,n,X,ie,L,H,te,se,ne,fe).catch(Ce=>{S(Ce instanceof Error?Ce.message:"Failed to update expense")}))}function J(X){t&&confirm("Are you sure you want to delete this expense?")&&(S(null),_(t,e,n,X).catch(ie=>{S(ie instanceof Error?ie.message:"Failed to delete expense")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:C?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:C?"block":"grid",gridTemplateColumns:C?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ct(W),fontWeight:600},children:Lt(W)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&u.jsx(Ve,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:R.length===0||Object.keys(d).length===0,disabledReason:R.length===0&&Object.keys(d).length===0?"Create accounts and categories first":R.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!C&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ca,children:"Date"}),u.jsx("div",{style:ca,children:"Payee"}),u.jsx("div",{style:{...ca,textAlign:"center"},children:"Category"}),u.jsx("div",{style:ca,children:"Account"}),u.jsx("div",{style:{...ca,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:ca,children:"Description"}),u.jsx("div",{style:{...ca,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:ca})]})]}),R.length===0&&u.jsx(Gu,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(d).length===0&&u.jsx(Gu,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),E&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(X1,{accounts:R,accountGroups:l,categories:d,categoryGroups:h,payees:M,defaultAccountId:A,defaultDate:gm(e,n),onSubmit:K,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:C})}),m?.expenses?.slice().sort((X,ie)=>(X.date||"").localeCompare(ie.date||"")).map((X,ie)=>I===X.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(X1,{accounts:R,accountGroups:l,categories:d,categoryGroups:h,payees:M,initialData:X,onSubmit:(L,H,te,se,ne,fe,Ce)=>G(X.id,L,H,te,se,ne,fe,Ce),onCancel:()=>D(null),onDelete:()=>J(X.id),submitLabel:"Save",isMobile:C})},X.id):u.jsx(Vz,{expense:X,categoryName:rt(X.category_id)?Mo:d[X.category_id]?.name||"Unknown Category",accountName:Ze(X.account_id)?Da:o[X.account_id]?.nickname||"Unknown Account",accountGroupName:Ze(X.account_id)?void 0:o[X.account_id]?.account_group_id?l[o[X.account_id].account_group_id]?.name:void 0,onEdit:()=>{X.payee||`${X.amount}`,D(X.id)},onDelete:()=>J(X.id),isMobile:C,isEvenRow:ie%2===0},X.id)),(!m?.expenses||m.expenses.length===0)&&!E&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const qz={background:me.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},Hz={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},Gz={background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function Z1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:m}){const{isWide:p}=MT(),g=new Date().toISOString().split("T")[0],[v,_]=k.useState(i?.date||o||g),[C,x]=k.useState(i?.amount?.toString()||""),[S,E]=k.useState(i?.from_account_id||Gt),[T,I]=k.useState(i?.to_account_id||Gt),[D,B]=k.useState(i?.from_category_id||Xt),[$,M]=k.useState(i?.to_category_id||Xt),[O,N]=k.useState(i?.description||""),[F,q]=k.useState(i?.cleared||!1),[R,P]=k.useState(null),A=D===Xt,W=$===Xt,K=S===Gt,G=T===Gt;function J(){return A&&W&&(K&&G)?'A transfer must move between real categories or real accounts  not all "No" options.':K!==G?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':A!==W?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}J()===null&&R!==null&&P(null);function ie(de){de.preventDefault();const be=parseFloat(C);if(isNaN(be)||be<=0||!S||!T||!D||!$||!v)return;const Me=J();if(Me){P(Me);return}P(null),l(be,S,T,D,$,v,O.trim()||void 0,F)}const L=R?u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:me.error,marginTop:"0.5rem"},children:R}):null,H=(de,be,Me,Oe)=>u.jsx(zt,{label:Oe,htmlFor:de,children:u.jsx(DT,{id:de,value:be,onChange:Me,accounts:t,accountGroups:e,placeholder:Da,required:!0,showNoAccountOption:!0})}),te=(de,be,Me,Oe)=>u.jsx(zt,{label:Oe,htmlFor:de,children:u.jsx(kT,{id:de,value:be,onChange:Me,categories:n,categoryGroups:r,placeholder:Mo,required:!0,showNoCategoryOption:!0})}),se=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Gr,{id:"transfer-cleared",checked:F,onChange:de=>q(de.target.checked)})]}),ne=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:m,style:qz,children:""}),u.jsx("button",{type:"button",onClick:()=>{d()},title:"Cancel",style:Hz,children:""}),h&&u.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:Gz,children:""})]})]}),fe=u.jsxs(Ua,{children:[u.jsx(Ve,{type:"submit",actionName:m,children:m}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:d,children:"Cancel"}),h&&u.jsx(Ve,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),Ce={fontSize:"0.85rem",padding:"0.5rem"};return p?u.jsx(Ti,{actionName:m,onSubmit:ie,children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx(zt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(Nf,{id:"transfer-date",value:v,onChange:de=>_(de.target.value),required:!0,style:Ce,autoFocus:!0})}),u.jsx(zt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(So,{id:"transfer-amount",value:C,onChange:x,placeholder:"$0.00",required:!0})}),te("from-category",D,B,"From Category"),H("from-account",S,E,"From Account"),u.jsx(zt,{label:"Description",htmlFor:"transfer-description",children:u.jsx(Ai,{id:"transfer-description",value:O,onChange:de=>N(de.target.value),placeholder:"e.g., Transfer",style:Ce})})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),u.jsx("div",{}),te("to-category",$,M,"To Category"),H("to-account",T,I,"To Account"),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[se,ne]})]}),L]})}):u.jsxs(Ti,{actionName:m,onSubmit:ie,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(zt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(Nf,{id:"transfer-date",value:v,onChange:de=>_(de.target.value),required:!0,autoFocus:!0})}),u.jsx(zt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(So,{id:"transfer-amount",value:C,onChange:x,placeholder:"$0.00",required:!0})})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[te("from-category",D,B,"From Cat."),H("from-account",S,E,"From Acct.")]}),u.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[te("to-category",$,M,"To Cat."),H("to-account",T,I,"To Acct.")]})]}),u.jsx(zt,{label:"Description (optional)",htmlFor:"transfer-description",children:u.jsx(Ai,{id:"transfer-description",value:O,onChange:de=>N(de.target.value),placeholder:"e.g., Transfer to savings"})}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Gr,{id:"transfer-cleared-stacked",checked:F,onChange:de=>q(de.target.checked)}),u.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),L]}),fe]})}function Qz({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:i,fromAccountGroupName:o,toAccountGroupName:l,isFromCategoryNo:d,isToCategoryNo:h,isFromAccountNo:m,isToAccountNo:p,onEdit:g,onDelete:v,isMobile:_,isEvenRow:C}){const x=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",S=C?"transparent":"rgba(255,255,255,0.04)";if(_)return u.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:S,cursor:"pointer",transition:"background 0.15s"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:x}),u.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:st(t.amount)}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:d?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),m?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),u.jsx("span",{children:r})]})]}),u.jsx("span",{style:{opacity:.5},children:""}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:i}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[l&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:l}),u.jsx("span",{children:i})]})]})]}),t.description&&u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const E={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...E,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:x})}),u.jsx("div",{style:{...E,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:st(t.amount)}),u.jsx("div",{style:{...E,justifyContent:"center"},children:u.jsx("span",{style:d?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...E,overflow:"hidden"},children:m?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),u.jsx("div",{style:{...E,justifyContent:"center",fontSize:"1rem"},children:u.jsx("span",{style:{opacity:.5},children:""})}),u.jsx("div",{style:{...E,justifyContent:"center"},children:u.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),u.jsx("div",{style:{...E,overflow:"hidden"},children:p?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:i}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[l&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i})]})}),u.jsx("div",{style:{...E,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...E,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...E,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:v,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Bs={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Wz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=In(),{month:m,isLoading:p}=Ks(t,e,n),{addTransfer:g}=h3(),{updateTransfer:v}=m3(),{deleteTransfer:_}=p3(),C=Ri(),[x,S]=k.useState(null),[E,T]=k.useState(!1),[I,D]=k.useState(null);function B(R){const P=R.account_group_id?l[R.account_group_id]:void 0;return P&&P.is_active!==null?P.is_active:R.is_active!==!1}function $(R){const P=R.account_group_id?l[R.account_group_id]:void 0;return P&&P.on_budget!==null?P.on_budget:R.on_budget!==!1}const M=Object.entries(o).filter(([,R])=>B(R)&&$(R));function O(R,P,A,W,K,G,J,X){if(!t)return;S(null),T(!1);const{year:ie,month:L}=ym(G);(ie!==e||L!==n)&&(r(ie),i(L)),g(t,ie,L,R,P,A,W,K,G,J,X).catch(H=>{S(H instanceof Error?H.message:"Failed to add transfer")})}function N(R,P,A,W,K,G,J,X,ie){t&&(S(null),D(null),v(t,e,n,R,P,A,W,K,G,J,X,ie).catch(L=>{S(L instanceof Error?L.message:"Failed to update transfer")}))}function F(R){t&&confirm("Are you sure you want to delete this transfer?")&&(S(null),_(t,e,n,R).catch(P=>{S(P instanceof Error?P.message:"Failed to delete transfer")}))}const q=M.length>=1&&Object.keys(d).length>=1;return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:C?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:C?"block":"grid",gridTemplateColumns:C?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&u.jsx(Ve,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!q,disabledReason:M.length===0&&Object.keys(d).length===0?"Create accounts and categories first":M.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!C&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Bs,children:"Date"}),u.jsx("div",{style:{...Bs,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:{...Bs,textAlign:"center"},children:"From Cat"}),u.jsx("div",{style:Bs,children:"From Acct"}),u.jsx("div",{style:Bs}),u.jsx("div",{style:{...Bs,textAlign:"center"},children:"To Cat"}),u.jsx("div",{style:Bs,children:"To Acct"}),u.jsx("div",{style:Bs,children:"Description"}),u.jsx("div",{style:{...Bs,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:Bs})]})]}),!q&&u.jsx(Gu,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),E&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(Z1,{accounts:M,accountGroups:l,categories:d,categoryGroups:h,defaultDate:gm(e,n),onSubmit:O,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),m?.transfers?.slice().sort((R,P)=>(R.date||"").localeCompare(P.date||"")).map((R,P)=>I===R.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(Z1,{accounts:M,accountGroups:l,categories:d,categoryGroups:h,initialData:R,onSubmit:(A,W,K,G,J,X,ie,L)=>N(R.id,A,W,K,G,J,X,ie,L),onCancel:()=>D(null),onDelete:()=>F(R.id),submitLabel:"Save"})},R.id):u.jsx(Qz,{transfer:R,fromCategoryName:rt(R.from_category_id)?Mo:d[R.from_category_id]?.name||"Unknown",toCategoryName:rt(R.to_category_id)?Mo:d[R.to_category_id]?.name||"Unknown",fromAccountName:Ze(R.from_account_id)?Da:o[R.from_account_id]?.nickname||"Unknown",toAccountName:Ze(R.to_account_id)?Da:o[R.to_account_id]?.nickname||"Unknown",fromAccountGroupName:Ze(R.from_account_id)?void 0:o[R.from_account_id]?.account_group_id?l[o[R.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:Ze(R.to_account_id)?void 0:o[R.to_account_id]?.account_group_id?l[o[R.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:rt(R.from_category_id),isToCategoryNo:rt(R.to_category_id),isFromAccountNo:Ze(R.from_account_id),isToAccountNo:Ze(R.to_account_id),onEdit:()=>{R.description||`${R.amount}`,D(R.id)},onDelete:()=>F(R.id),isMobile:C,isEvenRow:P%2===0},R.id)),(!m?.transfers||m.transfers.length===0)&&!E&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function J1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:m,onDelete:p,submitLabel:g}){function v(_){h(_.amount,_.accountId,_.categoryId,_.date,_.payee,_.description,_.cleared)}return u.jsx(r_,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:v,onCancel:m,onDelete:p})}function Kz({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]}),u.jsx("span",{style:{fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Lt(t.amount)})]}),u.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:m})]})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Lt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const _o={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Yz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=In(),{month:m,isLoading:p}=Ks(t,e,n),{addAdjustment:g}=y3(),{updateAdjustment:v}=b3(),{deleteAdjustment:_}=v3(),C=Ri(),[x,S]=k.useState(null),[E,T]=k.useState(!1),[I,D]=k.useState(null),M=F0(t,{enabled:E||I!==null}).data||[];function O(A){const W=A.account_group_id?l[A.account_group_id]:void 0;return W&&W.is_active!==null?W.is_active:A.is_active!==!1}function N(A){const W=A.account_group_id?l[A.account_group_id]:void 0;return W&&W.on_budget!==null?W.on_budget:A.on_budget!==!1}const F=Object.entries(o).filter(([,A])=>O(A)&&N(A));function q(A,W,K,G,J,X,ie){if(!t)return;S(null),T(!1);const{year:L,month:H}=ym(G);(L!==e||H!==n)&&(r(L),i(H)),g(t,L,H,A,W,K,G,J,X,ie).catch(te=>{S(te instanceof Error?te.message:"Failed to add adjustment")})}function R(A,W,K,G,J,X,ie,L){t&&(S(null),D(null),v(t,e,n,A,W,K,G,J,X,ie,L).catch(H=>{S(H instanceof Error?H.message:"Failed to update adjustment")}))}function P(A){t&&confirm("Are you sure you want to delete this adjustment?")&&(S(null),_(t,e,n,A).catch(W=>{S(W instanceof Error?W.message:"Failed to delete adjustment")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:C?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:C?"block":"grid",gridTemplateColumns:C?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&u.jsx(Ve,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(d).length===0&&F.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!C&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:_o,children:"Date"}),u.jsx("div",{style:{..._o,textAlign:"center"},children:"Category"}),u.jsx("div",{style:_o,children:"Account"}),u.jsx("div",{style:{..._o,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:_o,children:"Description"}),u.jsx("div",{style:{..._o,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:_o})]})]}),F.length===0&&Object.keys(d).length===0&&u.jsx(Gu,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),E&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(J1,{accounts:F,accountGroups:l,categories:d,categoryGroups:h,payees:M,defaultDate:gm(e,n),onSubmit:q,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),m?.adjustments?.slice().sort((A,W)=>(A.date||"").localeCompare(W.date||"")).map((A,W)=>I===A.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(J1,{accounts:F,accountGroups:l,categories:d,categoryGroups:h,payees:M,initialData:A,onSubmit:(K,G,J,X,ie,L,H)=>R(A.id,K,G,J,X,ie,L,H),onCancel:()=>D(null),onDelete:()=>P(A.id),submitLabel:"Save"})},A.id):u.jsx(Kz,{adjustment:A,categoryName:rt(A.category_id)?Mo:d[A.category_id]?.name||"Unknown Category",accountName:Ze(A.account_id)?Da:o[A.account_id]?.nickname||"Unknown Account",accountGroupName:Ze(A.account_id)?void 0:o[A.account_id]?.account_group_id?l[o[A.account_id].account_group_id]?.name:void 0,onEdit:()=>{A.description||`${A.amount}`,D(A.id)},onDelete:()=>P(A.id),isMobile:C,isEvenRow:W%2===0},A.id)),(!m?.adjustments||m.adjustments.length===0)&&!E&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function Xz({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:i}=Pn(),{selectedBudgetId:o,currentYear:l,currentMonthNumber:d}=Xe(),{deleteAllocations:h}=VT(),[m,p]=k.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:l,month:d}),e(),n?.()}catch(v){p(v instanceof Error?v.message:"Failed to delete allocations")}finally{i("allocations-delete")}}};return u.jsxs(ds,{isOpen:t,onClose:e,title:"Delete Allocations",children:[m&&u.jsx(bm,{message:m,onDismiss:()=>p(null)}),u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),u.jsx(Ve,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function aA({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:i,draftChangeAmount:o,availableAfterApply:l,currentDraftTotal:d}){const h=t&&d!==void 0?d:i.allocated;return u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?u.jsx("span",{style:{color:ct(n),fontWeight:600},children:qn(n)}):u.jsx("span",{style:{color:me.success,fontWeight:600},children:qn(r)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:" "}),u.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),u.jsx("span",{style:{color:_c(t?h:i.allocated),fontWeight:600,...t?us:{}},children:qn(t?h:i.allocated)}),e&&o!==0&&u.jsxs("span",{style:{fontSize:"0.85em",color:o>0?me.warning:me.success,marginLeft:"0.25rem"},children:["(",Lt(o),")"]})]}),!t&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Spent: "}),u.jsx("span",{style:{color:yc(i.spent),fontWeight:600},children:qn(i.spent)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:"= "}),u.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?u.jsx("span",{style:{color:ct(l),fontWeight:600,...us},children:qn(l)}):u.jsx("span",{style:{color:ct(i.allocated+i.spent),fontWeight:600},children:qn(i.allocated+i.spent)})]})]})}function Zz({totals:t}){return u.jsxs(u.Fragment,{children:[u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Start: "}),u.jsx("span",{style:{color:ct(t.start),fontWeight:600},children:qn(t.start)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Inc: "}),u.jsx("span",{style:{color:me.success,fontWeight:600},children:qn(t.income)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Exp: "}),u.jsx("span",{style:{color:yc(t.expenses),fontWeight:600},children:qn(t.expenses)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"End: "}),u.jsx("span",{style:{color:ct(t.end),fontWeight:600},children:qn(t.end)})]})]})}function s_({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:i,onEdit:o,onCancel:l,onDelete:d}){return u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),u.jsx(Ve,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&u.jsx(Ve,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),u.jsx(Ve,{actionName:"Cancel Edit Allocations",onClick:l,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),u.jsx(Ve,{actionName:"Open Delete Allocations Modal",onClick:d,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:me.error},children:""})]})]})}function eS(t){return t===0?me.zero:t>0?me.success:me.error}function Jz({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,projectedAllTime:l}){const d=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=d?t.default_monthly_amount/100*r:0,m=d?h.toFixed(2):n,p=i&&!d,g=i?l:t.balance??0,v=t.balance??0,_=v<0,C=_?Math.abs(v):0,x=d?h:parseFloat(n)||0,S=_?Math.min(x,C):0,E=_?Math.max(0,x-C):0,T=_&&x>0&&E>0;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.name})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{style:{color:hn(e.start_balance)},children:yr(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:m?`$${m}`:"",onChange:I=>{const D=I.target.value.replace(/[^\d.]/g,"");o(D)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),_&&x>0&&u.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[u.jsxs("span",{style:{color:me.debt,display:"block"},children:[st(S),"  debt"]}),T&&u.jsxs("span",{style:{color:me.success,display:"block"},children:[st(E),"  balance"]})]})]}):u.jsx("span",{style:{color:_c(e.allocated)},children:Lt(e.allocated)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),u.jsx("span",{style:{color:yc(e.spent)},children:Bt(e.spent)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:hn(e.end_balance),...i&&!d?us:{}},children:yr(e.end_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:i?"Proj. All-Time":"All-Time"}),u.jsx("span",{style:{color:hn(g),...i&&!d?us:{}},children:yr(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&u.jsxs("span",{style:{color:eS(e.transfers)},children:[Lt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{style:{color:eS(e.adjustments)},children:[Lt(e.adjustments)," adjust"]})]}),i&&d&&u.jsx("div",{style:{marginTop:"0.5rem"},children:u.jsxs("span",{style:{fontSize:"0.8rem"},children:[u.jsxs("span",{style:{opacity:.6},children:[st(r),"  "]}),u.jsxs("span",{style:{color:me.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.6},children:" = "}),u.jsx("span",{style:{color:me.success},children:st(h)})]})})]})}function Lf(t){return t===0?me.zero:t>0?me.success:me.error}function tS({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:i,savedAllocations:o,previousMonthIncome:l,isDraftMode:d,onAllocationChange:h,isMobile:m,isUngrouped:p,getAllocationAmount:g,gridTemplateColumns:v}){const _={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ma,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},C=n.allocated+n.spent+n.transfers+n.adjustments,x=e.reduce((S,[E,T])=>{const I=T.balance??0;let D=I;if(d){const B=g(E,T),$=o[E]??0,M=B-$;D=I+M}return S+Math.max(0,D)},0);return u.jsxs("div",{style:{display:"contents"},children:[!m&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{..._,paddingLeft:"0.5rem",opacity:p?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:hn(n.start)},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:d?"center":"flex-end",color:_c(n.allocated)},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:yc(n.spent)},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:Lf(n.transfers)},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:Lf(n.adjustments)},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:hn(C)},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:hn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:Yt.showGroupTotals}),u.jsx("div",{style:{..._,justifyContent:"flex-end",color:hn(x)},children:Yt.showGroupTotals})]}),!d&&m&&u.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ma,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:p?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Yt.showGroupTotals]}),e.map(([S,E],T)=>{const I=r(S);if(!I)return null;const D=E.balance??0;let B=D;if(d){const $=g(S,E),M=o[S]??0,O=$-M;B=D+O}return m?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(Jz,{category:E,balance:I,localAllocation:i[S]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:$=>h(S,$),projectedAllTime:B})},S):u.jsx(eB,{category:E,balance:I,localAllocation:i[S]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:$=>h(S,$),allTimeBalance:B,isEvenRow:T%2===0,gridTemplateColumns:v},S)})]})}function eB({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,allTimeBalance:l,isEvenRow:d,gridTemplateColumns:h}){const m=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,p=m?t.default_monthly_amount/100*r:0,g=m?p.toFixed(2):n,v=t.balance??0,_=v<0,C=_?Math.abs(v):0,x=m?p:parseFloat(n)||0,S=_?Math.min(x,C):0,E=_?Math.max(0,x-C):0,T=_&&x>0&&E>0,I=d?"transparent":"rgba(255,255,255,0.04)",D={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},B=e.allocated+e.spent+e.transfers+e.adjustments;return u.jsxs("div",{style:{gridColumn:"1 / -1",background:I,display:"grid",gridTemplateColumns:h},children:[u.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:hn(e.start_balance)},children:yr(e.start_balance)}),i?u.jsx("div",{style:{...D,justifyContent:"center",flexDirection:"column",gap:"0.1rem",paddingTop:"0.35rem",paddingBottom:"0.35rem"},children:m?u.jsxs("span",{style:{fontSize:"0.85rem"},children:[u.jsxs("span",{style:{color:me.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.5},children:" = "}),u.jsx("span",{style:{color:me.success},children:st(p)})]}):u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:g?`$${g}`:"",onChange:$=>{const M=$.target.value.replace(/[^\d.]/g,"");o(M)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),_&&x>0&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[u.jsxs("span",{style:{color:me.debt},children:[st(S),"  debt"]}),T&&u.jsxs("span",{style:{color:me.success},children:[st(E),"  bal"]})]})]})}):(()=>{const $=e.start_balance<0,M=$?Math.abs(e.start_balance):0,O=$?Math.min(e.allocated,M):0,N=$?Math.max(0,e.allocated-M):0,F=$&&e.allocated>0;return u.jsxs("div",{style:{...D,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:_c(e.allocated)},children:[u.jsxs("span",{children:["+",st(e.allocated)]}),F&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsxs("span",{style:{color:me.debt},children:[st(O),"  debt"]}),N>0&&u.jsxs("span",{style:{color:me.success},children:[st(N),"  bal"]})]})]})})(),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:yc(e.spent)},children:Bt(e.spent)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:Lf(e.transfers)},children:Lt(e.transfers)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:Lf(e.adjustments)},children:Lt(e.adjustments)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:hn(B),...i&&!m?us:{}},children:Lt(B)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",fontWeight:600,color:hn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...i&&!m?us:{}},children:yr(e.end_balance)}),u.jsx("div",{style:{...D,justifyContent:"flex-end",color:hn(l),...i&&!m?us:{}},children:yr(l)})]})}function tB(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,i])=>n||!i.is_hidden).reduce((i,[o,l])=>{const d=l.category_group_id||"ungrouped";return i[d]||(i[d]=[]),i[d].push([o,l]),i},{});return Object.keys(r).forEach(i=>{r[i].sort((o,l)=>o[1].sort_order-l[1].sort_order)}),r}function nB(t,e,n,r,i){const o={};t?.category_balances&&t.category_balances.forEach(d=>{o[d.category_id]=d});const l={};return Object.entries(e).forEach(([d,h])=>{const m=o[d],p=m?.start_balance??0,g=m?.spent??0;let v=0;n?v=i(d,h):r&&m&&(v=m.allocated);let _=0;t?.transfers&&t.transfers.forEach(x=>{x.to_category_id===d&&(_+=x.amount),x.from_category_id===d&&(_-=x.amount)});let C=0;t?.adjustments&&(C=t.adjustments.filter(x=>x.category_id===d).reduce((x,S)=>x+S.amount,0)),l[d]={category_id:d,start_balance:p,allocated:v,spent:g,transfers:_,adjustments:C,end_balance:p+v+g+_+C}}),l}function rB(t,e){const n={};t?.account_balances&&t.account_balances.forEach(i=>{n[i.account_id]=i});const r={};return Object.entries(e).forEach(([i,o])=>{const d=n[i]?.start_balance??o.balance;let h=0;t?.income&&(h=t.income.filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0));let m=0;t?.expenses&&(m=t.expenses.filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0));let p=0;t?.transfers&&t.transfers.forEach(_=>{_.to_account_id===i&&(p+=_.amount),_.from_account_id===i&&(p-=_.amount)});let g=0;t?.adjustments&&(g=t.adjustments.filter(_=>_.account_id===i).reduce((_,C)=>_+C.amount,0));const v=h+m+p+g;r[i]={account_id:i,start_balance:d,income:h,expenses:m,transfers:p,adjustments:g,net_change:v,end_balance:d+v}}),r}function sB(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function iB(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+Math.max(0,n.end_balance)}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function oA(t,e){const n={},r={};return t?.account_balances&&t.account_balances.forEach(i=>{r[i.account_id]=i}),t?(Object.entries(e).forEach(([i,o])=>{const d=r[i]?.start_balance??o.balance;let h=0,m=0;t?.income&&t.income.filter(T=>T.account_id===i).forEach(T=>{m+=T.amount,h+=T.amount});let p=0,g=0;t?.expenses&&t.expenses.filter(T=>T.account_id===i).forEach(T=>{g+=T.amount,T.cleared===!0&&(p+=T.amount)});let v=0,_=0;t?.transfers&&t.transfers.forEach(T=>{T.to_account_id===i&&(_+=T.amount,T.cleared===!0&&(v+=T.amount)),T.from_account_id===i&&(_-=T.amount,T.cleared===!0&&(v-=T.amount))});let C=0,x=0;t?.adjustments&&t.adjustments.filter(T=>T.account_id===i).forEach(T=>{x+=T.amount,T.cleared===!0&&(C+=T.amount)});const S=h+p+v+C,E=m+g+_+x;n[i]={account_id:i,cleared_balance:d+S,uncleared_balance:d+E}}),n):(Object.entries(e).forEach(([i,o])=>{n[i]={account_id:i,cleared_balance:o.balance??0,uncleared_balance:o.balance??0}}),n)}function nS(t){return t===0?me.zero:t>0?me.success:me.error}function aB({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h}){const m={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...m,gap:"0.75rem"},children:["Grand Totals",!t&&u.jsx(s_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h})]}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:hn(n.start)},children:yr(n.start)}),u.jsxs("div",{style:{...m,justifyContent:t?"center":"flex-end",color:_c(n.allocated),...t?us:{}},children:["+",st(n.allocated)]}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:yc(n.spent)},children:Bt(n.spent)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:nS(n.transfers)},children:Lt(n.transfers)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:nS(n.adjustments)},children:Lt(n.adjustments)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:hn(p),...t?us:{}},children:Lt(p)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:hn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...t?us:{}},children:yr(n.end)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:hn(r),...t?us:{}},children:yr(r)})]})}function oB({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l,onSave:d,onApply:h,onEdit:m,onCancel:p,onDelete:g}){return u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(aA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l}),u.jsx(s_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:d,onApply:h,onEdit:m,onCancel:p,onDelete:g})]})}const pi={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function lB(t){if(!t)return"";switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}}function cB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{categories:r,categoryGroups:i,monthMap:o}=In(),{month:l}=Ks(t,e,n),d=Ri(),[h,m]=k.useState(null);dd({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:te=>m(te),logPrefix:"[MonthCategories]"});const[p,g]=k.useState(!1),{localAllocations:v,isEditingAppliedAllocations:_,error:C,availableNow:x,currentDraftTotal:S,draftChangeAmount:E,availableAfterApply:T,previousMonthIncome:I,currentMonthIncome:D,allocationsFinalized:B,getAllocationAmount:$,handleAllocationChange:M,resetAllocationsToSaved:O,handleSaveAllocations:N,handleFinalizeAllocations:F,setIsEditingAppliedAllocations:q,setError:R}=S3(),P=[...i].sort((te,se)=>te.sort_order-se.sort_order),A=k.useMemo(()=>tB(r),[r]),W=!B||_,K=k.useMemo(()=>nB(l,r,W,B,$),[l,r,W,B,$]),G=te=>K[te],J=k.useMemo(()=>iB(K),[K]),X=k.useMemo(()=>{const te={};if(l?.category_balances)for(const se of l.category_balances)te[se.category_id]=se.allocated;return te},[l]),ie=k.useMemo(()=>Object.entries(r).reduce((te,[se,ne])=>{const fe=ne.balance??0;let Ce=fe;if(W){const de=$(se,ne),be=X[se]??0,Me=de-be;Ce=fe+Me}return te+Math.max(0,Ce)},0),[r,W,$,X]),L=k.useMemo(()=>Object.values(r).reduce((te,se)=>te+Math.max(0,se.balance??0),0),[r]);k.useEffect(()=>{if(!t||W)return;if(Math.abs(ie-L)>.01){const se=Math.abs(ie-L);console.error("[MonthCategories] Month View vs Settings Mismatch:",{grandAllTime:ie,settingsPageAllocated:L,difference:se,message:'Month view "ALL-TIME" does not match settings page "Allocated" total. These should always match.'}),en.add({type:"error",message:`Balance display mismatch: Month view "ALL-TIME" (${st(ie)})  Settings "Allocated" (${st(L)}). Difference: ${st(se)}. Budget may need recalculation.`,autoDismissMs:1e4})}},[ie,L,W,t]);const H={onSave:N,onApply:F,onEdit:()=>q(!0),onCancel:O,onDelete:()=>g(!0)};return u.jsxs(u.Fragment,{children:[h&&u.jsxs(e_,{message:lB(h),spinnerColor:"#22c55e",children:[u.jsx(sA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),u.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&u.jsx(Bf,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&u.jsx(Bf,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),u.jsx(iA,{percent:h.percentComplete})]}),C&&u.jsx(bm,{message:C,onDismiss:()=>R(null)}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":W?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:d?"block":"grid",gridTemplateColumns:d?void 0:"subgrid"},children:[W&&u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:d?"column":"row",flexWrap:"wrap",alignItems:d?"stretch":"center",gap:d?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:d?"0.5rem":"0.25rem"},children:[u.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:d?void 0:1,alignItems:"center"},children:u.jsx(aA,{isDraftMode:W,isEditingAppliedAllocations:_,availableNow:x,currentMonthIncome:D,balanceTotals:J,draftChangeAmount:E,availableAfterApply:T,currentDraftTotal:S})}),u.jsx(s_,{isDraftMode:W,isEditingAppliedAllocations:_,allocationsFinalized:B,...H})]}),!d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:pi,children:"Category"}),u.jsx("div",{style:{...pi,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...pi,textAlign:W?"center":"right"},children:"Allocated"}),u.jsx("div",{style:{...pi,textAlign:"right"},children:"Spent"}),u.jsx("div",{style:{...pi,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...pi,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...pi,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...pi,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),u.jsx("div",{style:{...pi,textAlign:"right"},children:"All-Time"})]}),!d&&u.jsx(aB,{isDraftMode:W,allocationsFinalized:B,balanceTotals:J,grandAllTime:ie,...H}),!W&&d&&u.jsx(oB,{allocationsFinalized:B,availableNow:x,currentMonthIncome:D,balanceTotals:J,draftChangeAmount:E,availableAfterApply:T,currentDraftTotal:S,...H})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",u.jsx(jn,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),P.map(te=>{const se=A[te.id]||[];if(se.length===0)return null;const ne=se.reduce((fe,[Ce])=>{const de=G(Ce);return de?{start:fe.start+de.start_balance,allocated:fe.allocated+de.allocated,spent:fe.spent+de.spent,transfers:fe.transfers+de.transfers,adjustments:fe.adjustments+de.adjustments,end:fe.end+de.end_balance}:fe},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(tS,{name:te.name,categories:se,groupTotals:ne,getCategoryBalance:G,localAllocations:v,savedAllocations:X,previousMonthIncome:I,isDraftMode:W,onAllocationChange:M,isMobile:d,getAllocationAmount:$,gridTemplateColumns:W?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},te.id)}),A[un]?.length>0&&(()=>{const te=A[un],se=te.reduce((ne,[fe])=>{const Ce=G(fe);return Ce?{start:ne.start+Ce.start_balance,allocated:ne.allocated+Ce.allocated,spent:ne.spent+Ce.spent,transfers:ne.transfers+Ce.transfers,adjustments:ne.adjustments+Ce.adjustments,end:ne.end+Ce.end_balance}:ne},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(tS,{name:"Uncategorized",categories:te,groupTotals:se,getCategoryBalance:G,localAllocations:v,savedAllocations:X,previousMonthIncome:I,isDraftMode:W,onAllocationChange:M,isMobile:d,isUngrouped:!0,getAllocationAmount:$,gridTemplateColumns:W?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},un)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),u.jsx(Xz,{isOpen:p,onClose:()=>g(!1),onDeleted:()=>q(!1)})]})}function lA(t){return t===0?me.zero:t>0?me.success:me.error}function cA(t){return t===0?me.zero:t<0?me.error:me.success}function ya(t){return t===0?me.zero:t>0?me.success:me.error}function rS({name:t,accounts:e,groupTotals:n,accountBalances:r,accountClearedBalances:i,isMobile:o,isUngrouped:l}){const d={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ma,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!o&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...d,opacity:l?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ct(n.start)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:lA(n.income)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:cA(n.expenses)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ya(n.transfers)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ya(n.adjustments)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ya(n.netChange)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end",color:ct(n.end)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end"},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end"},children:Yt.showGroupTotals}),u.jsx("div",{style:{...d,justifyContent:"flex-end"},children:Yt.showGroupTotals})]}),o&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ma,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:l?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Yt.showGroupTotals]}),e.map(([h,m],p)=>{const g=r[h];if(!g)return null;const v=i?.[h];return o?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(dB,{account:m,balance:g,clearedBalance:v})},h):u.jsx(uB,{account:m,balance:g,clearedBalance:v,isEvenRow:p%2===0},h)})]})}function uB({account:t,balance:e,clearedBalance:n,isEvenRow:r}){const i=r?"transparent":"rgba(255,255,255,0.04)",o={padding:"0.5rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:i,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsx("div",{style:{...o,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(e.start_balance)},children:Bt(e.start_balance)}),u.jsxs("div",{style:{...o,justifyContent:"flex-end",color:lA(e.income)},children:["+",st(e.income)]}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:cA(e.expenses)},children:Bt(e.expenses)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ya(e.transfers)},children:Lt(e.transfers)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ya(e.adjustments)},children:Lt(e.adjustments)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ya(e.net_change)},children:Lt(e.net_change)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",fontWeight:600,color:ct(e.end_balance)},children:Bt(e.end_balance)}),n?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(n.uncleared_balance),fontWeight:600},children:Bt(n.uncleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),n?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(n.cleared_balance)},children:Math.abs(n.uncleared_balance-n.cleared_balance)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Bt(n.cleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ya(n.uncleared_balance-n.cleared_balance)},children:Lt(n.uncleared_balance-n.cleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""})]})}function dB({account:t,balance:e,clearedBalance:n}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.nickname})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?"1fr 1fr 1fr 1fr":"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{children:Bt(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),u.jsx("span",{style:{color:ct(e.net_change)},children:Lt(e.net_change)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:ct(e.end_balance)},children:Bt(e.end_balance)})]}),n&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Total"}),u.jsx("span",{style:{color:ct(n.uncleared_balance),fontWeight:600},children:Bt(n.uncleared_balance)})]}),Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),u.jsx("span",{style:{color:ct(n.cleared_balance)},children:Bt(n.cleared_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),u.jsx("span",{style:{color:ya(n.uncleared_balance-n.cleared_balance)},children:Lt(n.uncleared_balance-n.cleared_balance)})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]})]})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&u.jsxs("span",{children:[Lt(e.income)," income"]}),e.expenses!==0&&u.jsxs("span",{children:[Bt(e.expenses)," expenses"]}),e.transfers!==0&&u.jsxs("span",{children:[Lt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{children:[Lt(e.adjustments)," adjust"]})]})]})}const os={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function hB(t){return t===0?me.zero:t>0?me.success:me.error}function fB(t){return t===0?me.zero:t<0?me.error:me.success}function Zg(t){return t===0?me.zero:t>0?me.success:me.error}function mB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{accounts:r,accountGroups:i,monthMap:o}=In(),{month:l}=Ks(t,e,n),d=Ri(),[h,m]=k.useState(null);dd({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:I=>m(I),logPrefix:"[MonthAccounts]"});const p=k.useMemo(()=>Object.entries(i).map(([I,D])=>({id:I,...D})).sort((I,D)=>I.sort_order-D.sort_order),[i]),g=k.useMemo(()=>{const I={};return Object.entries(r).filter(([,D])=>!D.is_hidden).forEach(([D,B])=>{const $=B.account_group_id||Jt;I[$]||(I[$]=[]),I[$].push([D,B])}),Object.keys(I).forEach(D=>{I[D].sort((B,$)=>B[1].sort_order-$[1].sort_order)}),I},[r]),v=k.useMemo(()=>rB(l,r),[l,r]),_=k.useMemo(()=>oA(l,r),[l,r]),C=k.useMemo(()=>sB(v),[v]),x=C.income+C.expenses,E={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600},T=()=>{if(!h)return"";switch(h.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return h.currentMonth?`Recalculating ${h.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}};return u.jsxs(u.Fragment,{children:[h&&u.jsxs(e_,{message:T(),spinnerColor:"#22c55e",children:[u.jsx(sA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),u.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&u.jsx(Bf,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&u.jsx(Bf,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),u.jsx(iA,{percent:h.percentComplete})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:d?"block":"grid",gridTemplateColumns:d?void 0:"subgrid"},children:[!d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:os,children:"Account"}),u.jsx("div",{style:{...os,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...os,textAlign:"right"},children:"Income"}),u.jsx("div",{style:{...os,textAlign:"right"},children:"Expenses"}),u.jsx("div",{style:{...os,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...os,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...os,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...os,textAlign:"right"},children:"End"}),u.jsx("div",{style:{...os,textAlign:"right"},children:"Total"}),u.jsx("div",{style:{...os,textAlign:"right"},children:"Cleared"}),u.jsx("div",{style:{...os,textAlign:"right"},children:"Uncleared"})]}),d?u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(Zz,{totals:C})]}):u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{...E},children:"Grand Totals"}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ct(C.start)},children:Bt(C.start)}),u.jsxs("div",{style:{...E,justifyContent:"flex-end",color:hB(C.income)},children:["+",st(C.income)]}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:fB(C.expenses)},children:Bt(C.expenses)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Zg(C.transfers)},children:Lt(C.transfers)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Zg(C.adjustments)},children:Lt(C.adjustments)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:Zg(x)},children:Lt(x)}),u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ct(C.end)},children:Bt(C.end)}),u.jsx("div",{style:{...E,justifyContent:"flex-end"},children:Object.keys(_).length>0?Bt(Object.values(_).reduce((I,D)=>I+D.uncleared_balance,0)):u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})}),u.jsx("div",{style:{...E,justifyContent:"flex-end"},children:(()=>{if(Object.keys(_).length===0)return u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""});const I=Object.values(_).reduce((B,$)=>B+$.cleared_balance,0),D=Object.values(_).reduce((B,$)=>B+$.uncleared_balance,0);return Math.abs(D-I)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Bt(I)})()}),u.jsx("div",{style:{...E,justifyContent:"flex-end"},children:(()=>{if(Object.keys(_).length===0)return u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""});const I=Object.values(_).reduce(($,M)=>$+M.cleared_balance,0),B=Object.values(_).reduce(($,M)=>$+M.uncleared_balance,0)-I;return Math.abs(B)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Lt(B)})()})]})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",u.jsx(jn,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),p.map(I=>{const D=g[I.id]||[];if(D.length===0)return null;const B=D.reduce(($,[M])=>{const O=v[M];return O?{start:$.start+O.start_balance,income:$.income+O.income,expenses:$.expenses+O.expenses,transfers:$.transfers+O.transfers,adjustments:$.adjustments+O.adjustments,netChange:$.netChange+O.net_change,end:$.end+O.end_balance}:$},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(rS,{name:I.name,accounts:D,groupTotals:B,accountBalances:v,accountClearedBalances:_,isMobile:d},I.id)}),g[Jt]?.length>0&&(()=>{const I=g[Jt],D=I.reduce((B,[$])=>{const M=v[$];return M?{start:B.start+M.start_balance,income:B.income+M.income,expenses:B.expenses+M.expenses,transfers:B.transfers+M.transfers,adjustments:B.adjustments+M.adjustments,netChange:B.netChange+M.net_change,end:B.end+M.end_balance}:B},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(rS,{name:"Ungrouped",accounts:I,groupTotals:D,accountBalances:v,accountClearedBalances:_,isMobile:d,isUngrouped:!0},Jt)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const pB=["income","categories","accounts","spend","transfers","adjustments"];function sS(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&pB.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function gB(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function iS(){const t=N5(),e=Wu(),[n,r]=DS(),{addLoadingHold:i,removeLoadingHold:o}=Pn(),{selectedBudgetId:l,setSelectedBudgetId:d,currentYear:h,currentMonthNumber:m,lastActiveTab:p,setCurrentYear:g,setCurrentMonthNumber:v,setLastActiveTab:_,setPageTitle:C,goToPreviousMonth:x,goToNextMonth:S,hasPendingInvites:E,needsFirstBudget:T,initialDataLoadComplete:I}=Xe(),{budget:D,isLoading:B,monthMap:$}=In(),M=!B,[O,N]=k.useState(!1);k.useEffect(()=>(!M||!I?i("budget-data","Loading budget data..."):o("budget-data"),()=>o("budget-data")),[M,I,i,o]);const F=k.useRef(!1),q=n.get("error"),[R,P]=k.useState(q);k.useEffect(()=>{q&&(n.delete("error"),r(n,{replace:!0}))},[q,n,r]);const[A,W]=k.useState(()=>{const{tab:te}=sS(t);return te??p}),K=te=>{W(te),_(te)};k.useEffect(()=>{if(F.current)return;const{year:te,month:se}=sS(t);te&&g(te),se&&v(se),F.current=!0},[t,g,v]),k.useEffect(()=>{if(!F.current)return;const te=`/budget/${h}/${m}/${A}`,se=`/budget/${t.year}/${t.month}/${t.tab}`;te!==se&&e(te,{replace:!0})},[h,m,A,e,t]);const{month:G,error:J,isLoading:X}=Ks(M?l:null,h,m);k.useEffect(()=>{if(!J||O)return;const te=J.message||"";if(te.includes("Budget")&&te.includes("does not exist")){queueMicrotask(()=>{d(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(te.includes("months in the past")||te.includes("Refusing to create month"))&&queueMicrotask(()=>{i("month-redirect","Redirecting to current month..."),N(!0);const{year:se,month:ne}=gB();P(`Cannot create month ${h}/${m} - it's too far in the past. Redirected to current month.`),g(se),v(ne)})},[J,O,h,m,g,v,i,d,e]),k.useEffect(()=>{O&&G&&!X&&queueMicrotask(()=>{N(!1),o("month-redirect")})},[O,G,X,o]),k.useLayoutEffect(()=>{C(D?.name||"Budget")},[D?.name,C]);const{setCurrentViewingDocument:ie}=Xe();if(k.useEffect(()=>(D&&h&&m&&ie({type:"month",year:h,month:m}),()=>{ie({type:null})}),[D,h,m,ie]),k.useEffect(()=>{if(M&&!O){if(!D&&!l){e("/budget/my-budgets",{replace:!0});return}if(!D&&E){e("/budget/my-budgets",{replace:!0});return}if(T){e("/budget/my-budgets",{replace:!0});return}}},[M,O,D,l,E,T,e]),z3(l,h,m),dd({budgetId:l,year:h,month:m,monthMap:$,additionalCondition:M&&!!D,logPrefix:"[Budget]"}),!M||!I||O||!D)return null;function L(){P(null),x()}function H(){P(null),S()}return u.jsxs(u.Fragment,{children:[R&&u.jsx(bm,{message:R,onDismiss:()=>P(null)}),u.jsx(Pz,{onPreviousMonth:L,onNextMonth:H}),u.jsx(Tz,{activeTab:A,setActiveTab:K,allocationsFinalized:G?.are_allocations_finalized}),A==="income"&&u.jsx(Fz,{},`${h}-${m}`),A==="categories"&&u.jsx(cB,{},`${h}-${m}`),A==="accounts"&&u.jsx(mB,{},`${h}-${m}`),A==="spend"&&u.jsx($z,{},`${h}-${m}`),A==="transfers"&&u.jsx(Wz,{},`${h}-${m}`),A==="adjustments"&&u.jsx(Yz,{},`${h}-${m}`)]})}function yB(){const{setPageTitle:t}=Xe();return k.useLayoutEffect(()=>{t("Analytics")},[t]),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[u.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),u.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),u.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),u.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),u.jsx(jn,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:me.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function _B(){const t=$t();return{createBudget:Kn({mutationFn:async({name:n,userId:r,userEmail:i})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString(),d={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:i,accounts:{},account_groups:{[Jt]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},categories:{},category_groups:[{id:un,name:"Uncategorized",sort_order:0}],total_available:0,is_needs_recalculation:!1,month_map:{},created_at:l,updated_at:l};return await Wn("budgets",o,d,"creating new budget document"),await Wn("users",r,{uid:r,email:i,budget_ids:Vu(o),updated_at:l},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...d}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Re.user(r)}),t.invalidateQueries({queryKey:Re.accessibleBudgets(r)})}})}}function bB(){const t=$t();return{acceptInvite:Kn({mutationFn:async({budgetId:n,userId:r})=>{const i=new Date().toISOString(),{exists:o,data:l}=await Et("budgets",n,"validating user was invited to this budget");if(!o||!l)throw new Error("Budget not found");if(!l.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(l.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await Wn("users",r,{uid:r,budget_ids:Vu(n),updated_at:i},"adding accepted budget to user's budget list",{merge:!0}),await Wn("budgets",n,{accepted_user_ids:Vu(r),updated_at:i},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Re.user(r)}),t.invalidateQueries({queryKey:Re.accessibleBudgets(r)}),t.invalidateQueries({queryKey:Re.budget(n.budgetId)})}})}}function vB(){const t=$t(),e=Kn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=Re.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:[...d.budget.user_ids,o]}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r,{exists:l,data:d}=await Et("budgets",i,"validating user is not already invited");if(!l||!d)throw new Error("Budget not found");if(d.user_ids?.includes(o))throw new Error("User is already invited");return await vm({budgetId:i,updates:{user_ids:Vu(o)},description:"adding user to budget's invited users list"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Re.budget(i.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function xB(){const t=$t(),e=Kn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=Re.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:d.budget.user_ids.filter(h=>h!==o),accepted_user_ids:d.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r;return await vm({budgetId:i,updates:{user_ids:I1(o),accepted_user_ids:I1(o)},description:"removing user from budget's access lists"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Re.budget(i.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function wB({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function SB({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function CB({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:i,onCheckInvite:o,onAcceptInvite:l,onCancel:d}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Join Budget by ID"]}),u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?u.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[u.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&u.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[u.jsx("button",{onClick:l,disabled:i===r.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:1},children:i===r.budgetId?"Accepting...":"Accept Invitation"}),u.jsx("button",{onClick:d,disabled:i===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:.8},children:"Cancel"})]})]}):u.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function EB({currentUserId:t}){return u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[u.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),u.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function TB(){const{addLoadingHold:t,removeLoadingHold:e}=Pn(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:i,loadAccessibleBudgets:o,switchToBudget:l,checkBudgetInvite:d,isInitialized:h,setPageTitle:m,needsFirstBudget:p}=Xe(),{requireUserEmail:g}=Pa(),v=k.useRef(!1),[_,C]=DS(),x=_.get("context");k.useEffect(()=>{x&&(_.delete("context"),C(_,{replace:!0}))},[x,_,C]);const S=x==="budget-not-found",E=p&&i.length===0;k.useLayoutEffect(()=>{m("My Budgets")},[m]),k.useEffect(()=>{h&&!v.current&&(v.current=!0,o())},[h,o]);const{budget:T,isLoading:I}=In(),{renameBudget:D}=W4(),{acceptInvite:B}=bB(),{createBudget:$}=_B(),[M,O]=k.useState(null),[N,F]=k.useState(null),[q,R]=k.useState(null),[P,A]=k.useState(null),[W,K]=k.useState(null),[G,J]=k.useState(""),[X,ie]=k.useState(!1),[L,H]=k.useState(""),[te,se]=k.useState(!1),[ne,fe]=k.useState(null),[Ce,de]=k.useState(""),[be,Me]=k.useState(!1);async function Oe(ae){if(ae!==T?.id){O(ae),R(null),A(null);try{await l(ae),A("Switched to budget successfully!"),await o({force:!0})}catch(Ae){R(Ae instanceof Error?Ae.message:"Failed to switch budget")}finally{O(null)}}}async function qe(ae){if(r){F(ae),R(null),A(null);try{await B.mutateAsync({budgetId:ae,userId:r}),A("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(Ae){R(Ae instanceof Error?Ae.message:"Failed to accept invitation")}finally{F(null)}}}async function ot(ae){if(ae.preventDefault(),!!L.trim()){se(!0),R(null),fe(null);try{const Ae=await d(L.trim());Ae?fe(Ae):R("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Ae){R(Ae instanceof Error?Ae.message:"Failed to check invitation")}finally{se(!1)}}}async function U(){if(!(!ne||!r)){ne.budgetName,F(ne.budgetId),R(null);try{await B.mutateAsync({budgetId:ne.budgetId,userId:r}),A(`Successfully joined "${ne.budgetName}"!`),fe(null),H(""),await o({force:!0})}catch(ae){R(ae instanceof Error?ae.message:"Failed to accept invitation")}finally{F(null)}}}function ce(ae,Ae){J(Ae),K(ae)}async function ye(ae){if(ae.preventDefault(),!(!G.trim()||!W||!n)){G.trim(),ie(!0),R(null),A(null);try{await D.mutateAsync({budgetId:n,newName:G.trim()}),A("Budget renamed successfully!"),K(null),await o({force:!0})}catch(Ae){R(Ae instanceof Error?Ae.message:"Failed to rename budget")}finally{ie(!1)}}}async function ee(ae){if(ae.preventDefault(),!!r){Ce.trim(),Me(!0),R(null),A(null);try{const Ae=await $.mutateAsync({name:Ce.trim()||"My Budget",userId:r,userEmail:g()});await l(Ae.budgetId),A("Budget created successfully!"),de(""),await o({force:!0})}catch(Ae){R(Ae instanceof Error?Ae.message:"Failed to create budget")}finally{Me(!1)}}}const Z=i.filter(ae=>!ae.isPending),oe=i.filter(ae=>ae.isPending);if(k.useEffect(()=>(I||!h?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[I,h,t,e]),I||!h)return null;let Se="My Budgets",we="Switch between budgets, accept invitations, or create a new budget.";return S?(Se="Budget Not Found",we="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):E&&(Se="Welcome!",we="Get started by creating your first budget or accepting an invitation."),u.jsxs("div",{children:[u.jsx("h1",{children:Se}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:we}),q&&u.jsx(wB,{message:q,onDismiss:()=>R(null)}),P&&u.jsx(SB,{message:P,onDismiss:()=>A(null)}),oe.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Pending Invitations (",oe.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:oe.map(ae=>u.jsx(q1,{budget:ae,isCurrent:!1,isAccepting:N===ae.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>qe(ae.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},ae.id))})]}),Z.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Your Budgets (",Z.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:Z.map(ae=>u.jsx(q1,{budget:ae,isCurrent:ae.id===n,isAccepting:!1,isSwitching:M===ae.id,isEditing:W===ae.id,editName:W===ae.id?G:"",isRenaming:X,onAccept:()=>{},onSwitch:()=>Oe(ae.id),onStartEdit:()=>ce(ae.id,ae.name),onCancelEdit:()=>{K(null),J("")},onEditNameChange:J,onSaveEdit:ye},ae.id))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Create New Budget"]}),u.jsxs("form",{onSubmit:ee,children:[u.jsxs("div",{style:{marginBottom:"1rem"},children:[u.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),u.jsx("input",{type:"text",value:Ce,onChange:ae=>de(ae.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),u.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),u.jsx("button",{type:"submit",disabled:be,style:{background:me.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:be?"not-allowed":"pointer",fontWeight:500,opacity:be?.7:1,fontSize:"0.9rem"},children:be?"Creating...":"Create Budget"})]})]}),u.jsx(CB,{budgetIdInput:L,setBudgetIdInput:H,isCheckingManual:te,manualInvite:ne,isAccepting:N,onCheckInvite:ot,onAcceptInvite:U,onCancel:()=>{fe(null),H("")}}),r&&u.jsx(EB,{currentUserId:r})]})}const AB=["accounts","categories","users"];function jB(){const{addLoadingHold:t,removeLoadingHold:e}=Pn(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:i,selectedBudgetId:o,setCurrentViewingDocument:l}=Xe();k.useLayoutEffect(()=>{i("Budget Settings")},[i]),k.useEffect(()=>(o&&l({type:"budget"}),()=>{l({type:null})}),[o,l]);const{isOwner:d,isLoading:h}=In();k.useEffect(()=>(h?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[h,t,e]);const m=Nn(),p=m.pathname==="/budget/settings",g=k.useMemo(()=>{const S=m.pathname;return S.includes("/settings/accounts")?"accounts":S.includes("/settings/categories")?"categories":S.includes("/settings/users")?"users":"categories"},[m.pathname]),v=g==="users";k.useEffect(()=>{p||r(g)},[g,p,r]);function _(){return!AB.includes(n)||n==="users"&&!d?"categories":n}const C=k.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!d}],[d]);return h?null:!d&&v?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(jn,{to:"/budget/settings/categories",children:"Go to Categories "})})]}):u.jsxs("div",{children:[u.jsx(Pf,{mode:"link",linkPrefix:"/budget/settings",tabs:C,activeTab:p?_():g}),p?u.jsx(Ff,{to:`/budget/settings/${_()}`,replace:!0}):u.jsx(JT,{children:u.jsx(Vf,{})})]})}function i_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:i,showGroupSelector:o=!1,showIncomeSettings:l=!1,hasExistingIncomeDefault:d=!1,hasExistingOutgoDefault:h=!1,currentGroupId:m,onDelete:p}){const[g,v]=k.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),_=g.account_group_id||m,C=_?i.find(D=>D.id===_):null,x=!!(C&&C.is_active!==null),S=!!(C&&C.on_budget!==null);function E(D){D.preventDefault(),g.nickname.trim()&&e(g)}function T(D){v({...g,is_income_account:D,is_income_default:D?g.is_income_default:!1})}function I(D){v({...g,is_outgo_account:D,is_outgo_default:D?g.is_outgo_default:!1})}return u.jsxs(Ti,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:E,children:[u.jsx(zt,{label:"Account Nickname",htmlFor:"account-nickname",children:u.jsx(Ai,{id:"account-nickname",type:"text",value:g.nickname,onChange:D=>v({...g,nickname:D.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&u.jsx(zt,{label:"Account Type",htmlFor:"account-group",children:u.jsxs(Hu,{id:"account-group",value:g.account_group_id||Jt,onChange:D=>v({...g,account_group_id:D.target.value===Jt?null:D.target.value}),children:[u.jsx("option",{value:Jt,children:"Ungrouped"}),i.map(D=>u.jsx("option",{value:D.id,children:D.name},D.id))]})}),l&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Gr,{id:"is-active",checked:(()=>{if(x&&C){const D=C.is_active;return D===null||D===void 0?!1:D}return g.is_active??!0})(),onChange:D=>v({...g,is_active:D.target.checked}),disabled:x,children:u.jsx("span",{style:{opacity:x?.5:1},children:"Active account"})}),x&&C&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:me.warning},children:['Set by account type "',C.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Gr,{id:"on-budget",checked:(()=>{if(S&&C){const D=C.on_budget;return D===null||D===void 0?!1:D}return g.on_budget??!0})(),onChange:D=>v({...g,on_budget:D.target.checked}),disabled:S,children:u.jsx("span",{style:{opacity:S?.5:1},children:"On budget (affects budget totals)"})}),S&&C&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:me.warning},children:['Set by account type "',C.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Gr,{id:"is-hidden",checked:g.is_hidden||!1,onChange:D=>v({...g,is_hidden:D.target.checked}),children:"Hidden account"}),u.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),u.jsx(Gr,{id:"is-income-account",checked:g.is_income_account||!1,onChange:D=>T(D.target.checked),children:"Show in income deposit list"}),g.is_income_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Gr,{id:"is-income-default",checked:g.is_income_default||!1,onChange:D=>v({...g,is_income_default:D.target.checked}),disabled:d&&!t?.is_income_default,children:"Default account for new income"}),d&&!t?.is_income_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),u.jsx(Gr,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:D=>I(D.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Gr,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:D=>v({...g,is_outgo_default:D.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),u.jsxs(Ua,{children:[u.jsx(Ve,{type:"submit",actionName:r,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"}),p&&u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Delete Account",onClick:D=>{D.preventDefault(),p()},style:{color:"#ff6b6b",borderColor:"#ff6b6b"},children:" Delete"})]})]})}function aS({label:t,value:e,onChange:n,trueLabel:r,falseLabel:i,undefinedLabel:o}){function l(){n(e===void 0?!0:e===!0?!1:void 0)}const d=e===!0?r:e===!1?i:o,h=e===!0?me.success:e===!1?me.warning:"inherit",m=e===!0?"":e===!1?"":"";return u.jsxs("button",{type:"button",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[u.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:m}),u.jsxs("span",{style:{flex:1},children:[u.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",u.jsx("span",{style:{fontWeight:500,color:h},children:d})]}),u.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function oS({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=k.useState(t||{name:"",expected_balance:"positive"});function l(d){d.preventDefault(),i.name.trim()&&e(i)}return u.jsxs(Ti,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:l,children:[u.jsx(zt,{label:"Account Type Name",htmlFor:"group-name",children:u.jsx(Ai,{id:"group-name",type:"text",value:i.name,onChange:d=>o({...i,name:d.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),u.jsx(zt,{label:"Expected Balance",htmlFor:"expected-balance",children:u.jsxs(Hu,{id:"expected-balance",value:i.expected_balance,onChange:d=>o({...i,expected_balance:d.target.value}),children:[u.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),u.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),u.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),u.jsx(aS,{label:"Active status",value:i.is_active,onChange:d=>o({...i,is_active:d}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),u.jsx(aS,{label:"Budget status",value:i.on_budget,onChange:d=>o({...i,on_budget:d}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),u.jsxs(Ua,{children:[u.jsx(Ve,{type:"submit",actionName:r,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function Dl({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${me.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${me.success} 40%, transparent)`,color:me.success,opacity:1},warning:{background:`color-mix(in srgb, ${me.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${me.warning} 35%, transparent)`,color:me.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${me.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${me.success} 25%, transparent)`,color:me.success,opacity:.7},expense:{background:`color-mix(in srgb, ${me.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${me.warning} 25%, transparent)`,color:me.warning,opacity:.7}}[n];return u.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[u.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function lS({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(l=>l.id===t.account_group_id):null,i=r&&r.is_active!==null?r.is_active:t.is_active!==!1,o=r&&r.on_budget!==null?r.on_budget:t.on_budget!==!1;if(!i){const l=r&&r.is_active!==null;n.push(u.jsx(Dl,{icon:"",label:l?"Inactive (type)":"Inactive",variant:"warning",title:l?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const l=r&&r.on_budget!==null;n.push(u.jsx(Dl,{icon:"",label:l?"Off Budget (type)":"Off Budget",variant:"warning",title:l?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(u.jsx(Dl,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(u.jsx(Dl,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(u.jsx(Dl,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(u.jsx(Dl,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:u.jsx(u.Fragment,{children:n})}function RB({account:t,accountIndex:e,allGroups:n,allAccounts:r,clearedBalance:i,onEdit:o,onDelete:l,onMoveUp:d,onMoveDown:h,canMoveUp:m,canMoveDown:p,editingAccountId:g,setEditingAccountId:v,onUpdateAccount:_,isMobile:C}){if(g===t.id)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(i_,{initialData:{nickname:t.nickname,account_group_id:t.account_group_id,is_income_account:t.is_income_account,is_income_default:t.is_income_default,is_outgo_account:t.is_outgo_account,is_outgo_default:t.is_outgo_default,on_budget:t.on_budget,is_active:t.is_active},onSubmit:T=>{_(t.id,T),v(null)},onCancel:()=>v(null),onDelete:()=>{t.nickname,l(t.id),v(null)},submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:t.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([T,I])=>I.is_income_default&&T!==t.id),hasExistingOutgoDefault:Object.entries(r).some(([T,I])=>I.is_outgo_default&&T!==t.id)})});if(C)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.nickname}),u.jsx("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:i?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total"}),u.jsx("span",{style:{color:ct(i.uncleared_balance),fontWeight:600},children:Bt(i.uncleared_balance)})]}),Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),u.jsx("span",{style:{color:ct(i.cleared_balance)},children:Bt(i.cleared_balance)})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),u.jsx("span",{style:{color:ct(i.uncleared_balance-i.cleared_balance)},children:Bt(i.uncleared_balance-i.cleared_balance)})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""})]})]})]}):u.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:u.jsx("span",{style:{color:ct(t.balance),fontWeight:600},children:Bt(t.balance)})})})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.5rem"},children:u.jsx(lS,{account:t,accountGroups:n})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),d()},disabled:!m,style:{background:"transparent",border:"none",cursor:m?"pointer":"default",opacity:m?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const S=e%2===0?"transparent":"rgba(255,255,255,0.04)",E={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1.5fr 1fr"},children:[u.jsx("div",{style:{...E,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),i?u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ct(i.uncleared_balance),fontWeight:600},children:Bt(i.uncleared_balance)}):u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ct(t.balance),fontWeight:600},children:Bt(t.balance)}),i?u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ct(i.cleared_balance)},children:Math.abs(i.uncleared_balance-i.cleared_balance)<.01?u.jsx("span",{style:{opacity:.3,color:"#9ca3af"},children:""}):Bt(i.cleared_balance)}):u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ct(t.balance),fontWeight:600},children:Bt(t.balance)}),i&&Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?u.jsx("div",{style:{...E,justifyContent:"flex-end",color:ct(i.uncleared_balance-i.cleared_balance)},children:Bt(i.uncleared_balance-i.cleared_balance)}):u.jsx("div",{style:{...E,justifyContent:"flex-end",opacity:.3,color:"#9ca3af"},children:""}),u.jsx("div",{style:{...E,gap:"0.25rem",flexWrap:"wrap"},children:u.jsx(lS,{account:t,accountGroups:n})}),u.jsxs("div",{style:{...E,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),d()},disabled:!m,style:{background:"transparent",border:"none",cursor:m?"pointer":"default",opacity:m?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function cS({group:t,accounts:e,allGroups:n,allAccounts:r,accountClearedBalances:i,editingAccountId:o,createForGroupId:l,setEditingAccountId:d,setCreateForGroupId:h,onUpdateAccount:m,onDeleteAccount:p,onMoveAccount:g,onCreateAccount:v,isMobile:_,isUngrouped:C,canMoveGroupUp:x,canMoveGroupDown:S,onEditGroup:E,onDeleteGroup:T,onMoveGroupUp:I,onMoveGroupDown:D}){const B=[...e].sort((M,O)=>M.sort_order-O.sort_order);B.reduce((M,O)=>M+O.balance,0);const $={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ma,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!_&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...$,opacity:C?.7:1,justifyContent:"space-between"},children:[u.jsxs("span",{children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",B.length,")"]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!C&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,E()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:Of,children:[u.jsx("button",{onClick:I,disabled:!x,style:{...pa,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:D,disabled:!S,style:{...pa,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})})]}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$})]}),_&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ma,background:"rgba(255,255,255,0.04)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:C?.7:1},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",B.length,")"]})]}),Yt.showGroupTotals]}),!C&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,E()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:Of,children:[u.jsx("button",{onClick:I,disabled:!x,style:{...pa,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:D,disabled:!S,style:{...pa,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]}),B.map((M,O)=>u.jsx(RB,{account:M,accountIndex:O,totalAccounts:B.length,allGroups:n,allAccounts:r,clearedBalance:i?.[M.id],onEdit:d,onDelete:p,onMoveUp:()=>g(M.id,"up"),onMoveDown:()=>g(M.id,"down"),canMoveUp:O>0,canMoveDown:O<B.length-1,editingAccountId:o,setEditingAccountId:d,onUpdateAccount:m,isMobile:_},M.id)),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(i_,{initialData:{nickname:"",account_group_id:t.id},onSubmit:M=>v(M,t.id),onCancel:()=>h(null),submitLabel:"Create",accountGroups:n,showIncomeSettings:!0,currentGroupId:t.id})})]})}function IB({hiddenAccounts:t,accounts:e,sortedGroups:n,editingAccountId:r,setEditingAccountId:i,onUpdateAccount:o}){return t.length===0?null:u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(K0,{title:"Hidden Accounts",count:t.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.map(l=>r===l.id?u.jsx(i_,{initialData:{nickname:l.nickname,account_group_id:l.account_group_id,is_income_account:l.is_income_account,is_income_default:l.is_income_default,is_outgo_account:l.is_outgo_account,is_outgo_default:l.is_outgo_default,on_budget:l.on_budget,is_active:l.is_active,is_hidden:l.is_hidden},onSubmit:d=>{o(l.id,d),i(null)},onCancel:()=>i(null),submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:l.account_group_id,hasExistingIncomeDefault:Object.entries(e).some(([d,h])=>h.is_income_default&&d!==l.id),hasExistingOutgoDefault:Object.entries(e).some(([d,h])=>h.is_outgo_default&&d!==l.id)},l.id):u.jsxs("div",{onClick:()=>i(l.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:l.nickname}),u.jsx("span",{style:{color:ct(l.balance),fontWeight:500},children:Bt(l.balance)})]},l.id))})]})})}function kB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{monthMap:r,isLoading:i,isFetching:o,accounts:l}=In(),{month:d}=Ks(t,e,n),{accounts:h,accountsByGroup:m,hiddenAccounts:p,sortedGroups:g,currentBudget:v,error:_,setError:C,handleCreateAccount:x,handleUpdateAccount:S,handleDeleteAccount:E,handleMoveAccount:T,handleCreateGroup:I,handleUpdateGroup:D,handleDeleteGroup:B,handleMoveGroup:$}=Y4(),M=Ri(),{addLoadingHold:O,removeLoadingHold:N}=Pn(),F=i||o||!v;dd({budgetId:t,monthMap:r,checkAnyMonth:!0,additionalCondition:!F&&!!v,logPrefix:"[Settings/Accounts]"}),k.useEffect(()=>(F?O("accounts","Loading accounts..."):N("accounts"),()=>N("accounts")),[F,O,N]);const[q,R]=k.useState(null),[P,A]=k.useState(null),[W,K]=k.useState(null),[G,J]=k.useState(!1),X=k.useMemo(()=>{const ne=Object.values(h),fe=ne.reduce((be,Me)=>be+(Me.balance??0),0);let Ce=0,de=0;for(const be of ne){const Me=g.find(qe=>qe.id===be.account_group_id);be.on_budget===!0||be.on_budget===void 0&&Me?.on_budget!==!1?Ce+=be.balance??0:de+=be.balance??0}return{count:ne.length,groupCount:g.filter(be=>be.id!==Jt).length,totalBalance:fe,onBudgetTotal:Ce,offBudgetTotal:de}},[h,g]),ie=k.useMemo(()=>g.filter(ne=>ne.id!==Jt),[g]),L=k.useMemo(()=>({id:Jt,name:"Ungrouped",sort_order:ie.length,expected_balance:"any",on_budget:null,is_active:null}),[ie.length]),H=m[Jt]||[],te=k.useMemo(()=>d?oA(d,l):{},[d,l]),se={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};return k.useEffect(()=>{_&&(console.error("[Settings/Accounts] Error:",_),en.add({type:"error",message:"Failed to update accounts. See console for details.",autoDismissMs:0}),C(null))},[_,C]),F||!v?F?null:u.jsx("p",{children:"No budget found. Please log in."}):u.jsxs("div",{children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:M?"1fr":"2fr 1fr 1fr 1fr 1.5fr 1fr",marginBottom:"1.5rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",display:M?"block":"grid",gridTemplateColumns:M?void 0:"subgrid"},children:[u.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:ct(X.onBudgetTotal),fontWeight:600},children:qn(X.onBudgetTotal)})]}),X.offBudgetTotal!==0&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),u.jsx("span",{style:{fontWeight:600,opacity:.7},children:qn(X.offBudgetTotal)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ct(X.totalBalance),fontWeight:600},children:qn(X.totalBalance)})]}),u.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:"Use  buttons to reorder accounts."})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:u.jsx(t_,{})})]})}),!M&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:se,children:"Account"}),u.jsx("div",{style:{...se,textAlign:"right"},children:"Total"}),u.jsx("div",{style:{...se,textAlign:"right"},children:"Cleared"}),u.jsx("div",{style:{...se,textAlign:"right"},children:"Uncleared"}),u.jsx("div",{style:se,children:"Flags"}),u.jsx("div",{style:{...se,textAlign:"right"},children:"Actions"})]})]}),Object.keys(h).length===0&&ie.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No accounts yet. Create an account type first, then add accounts!"}),ie.map((ne,fe)=>{const Ce=m[ne.id]||[];return Ce.length===0&&W!==ne.id&&P!==ne.id?null:W===ne.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(oS,{initialData:{name:ne.name,expected_balance:ne.expected_balance||"positive",on_budget:ne.on_budget??void 0,is_active:ne.is_active??void 0},onSubmit:de=>{D(ne.id,de),K(null)},onCancel:()=>K(null),submitLabel:"Save"})},ne.id):u.jsx(cS,{group:ne,accounts:Ce,allGroups:ie,allAccounts:h,accountClearedBalances:te,editingAccountId:q,createForGroupId:P,setEditingAccountId:R,setCreateForGroupId:A,onUpdateAccount:(de,be)=>{S(de,be),R(null)},onDeleteAccount:E,onMoveAccount:T,onCreateAccount:x,isMobile:M,canMoveGroupUp:fe>0,canMoveGroupDown:fe<ie.length-1,onEditGroup:()=>K(ne.id),onDeleteGroup:()=>B(ne.id),onMoveGroupUp:()=>$(ne.id,"up"),onMoveGroupDown:()=>$(ne.id,"down")},ne.id)}),(H.length>0||P==="ungrouped")&&u.jsx(cS,{group:L,accounts:H,allGroups:ie,allAccounts:h,accountClearedBalances:te,editingAccountId:q,createForGroupId:P,setEditingAccountId:R,setCreateForGroupId:A,onUpdateAccount:(ne,fe)=>{S(ne,fe),R(null)},onDeleteAccount:E,onMoveAccount:T,onCreateAccount:x,isMobile:M,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{}}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),u.jsx(IB,{hiddenAccounts:p,accounts:h,sortedGroups:ie,editingAccountId:q,setEditingAccountId:R,onUpdateAccount:S}),G?u.jsx(oS,{onSubmit:ne=>{I(ne),J(!1)},onCancel:()=>J(!1),submitLabel:"Create Account Type"}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>J(!0),children:"+ Add Account Type"})]})}function a_({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:i=[],showGroupSelector:o=!1,onDelete:l}){const[d,h]=k.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[m,p]=k.useState(t?.default_monthly_amount?.toString()||""),[g,v]=k.useState(t?.default_monthly_type||"fixed"),[_,C]=k.useState(!1);function x(S){if(S.preventDefault(),!d.name.trim())return;C(!0);const E=parseFloat(m),T=!isNaN(E)&&E>0;e({...d,description:d.description?.trim()||void 0,default_monthly_amount:T?E:void 0,default_monthly_type:T?g:void 0})}return u.jsxs(Ti,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:x,children:[u.jsx(zt,{label:"Category Name",htmlFor:"category-name",children:u.jsx(Ai,{id:"category-name",type:"text",value:d.name,onChange:S=>h({...d,name:S.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),u.jsx(zt,{label:"Description (optional)",htmlFor:"category-description",children:u.jsx(H0,{id:"category-description",value:d.description||"",onChange:S=>h({...d,description:S.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&u.jsx(zt,{label:"Category Group",htmlFor:"category-group",children:u.jsxs(Hu,{id:"category-group",value:d.category_group_id||un,onChange:S=>h({...d,category_group_id:S.target.value===un?null:S.target.value}),children:[u.jsx("option",{value:un,children:"Uncategorized"}),i.map(S=>u.jsx("option",{value:S.id,children:S.name},S.id))]})}),u.jsxs(zt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[u.jsxs(Hu,{id:"default-type",value:g,onChange:S=>v(S.target.value),style:{width:"auto",flex:"0 0 auto"},children:[u.jsx("option",{value:"fixed",children:"Fixed $"}),u.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?u.jsx(So,{id:"default-amount",value:m,onChange:p,placeholder:"$0.00"}):u.jsx(Ai,{id:"default-amount",type:"number",value:m,onChange:S=>p(S.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&u.jsx("span",{style:{opacity:.6},children:"%"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[u.jsx(Gr,{id:"is-hidden",checked:d.is_hidden||!1,onChange:S=>h({...d,is_hidden:S.target.checked}),children:"Hidden category"}),u.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),u.jsxs(Ua,{children:[u.jsx(Ve,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:_,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"}),l&&u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Delete Category",onClick:S=>{S.preventDefault(),l()},style:{color:"#ff6b6b",borderColor:"#ff6b6b"},children:" Delete"})]})]})}function uS({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=k.useState(t||{name:""}),[l,d]=k.useState(!1);function h(m){m.preventDefault(),i.name.trim()&&(d(!0),e(i))}return u.jsxs(Ti,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[u.jsx(zt,{label:"Group Name",htmlFor:"group-name",children:u.jsx(Ai,{id:"group-name",type:"text",value:i.name,onChange:m=>o({...i,name:m.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),u.jsxs(Ua,{children:[u.jsx(Ve,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:l,children:r}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function DB({category:t,catId:e,categoryIndex:n,categoryGroups:r,categoryBalances:i,loadingBalances:o,onEdit:l,onDelete:d,onMoveUp:h,onMoveDown:m,canMoveUp:p,canMoveDown:g,editingCategoryId:v,setEditingCategoryId:_,onUpdateCategory:C,isMobile:x}){const S=i[e]||{current:0,total:0};if(v===e)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(a_,{initialData:{name:t.name,description:t.description,category_group_id:t.category_group_id,default_monthly_amount:t.default_monthly_amount,default_monthly_type:t.default_monthly_type,is_hidden:t.is_hidden},onSubmit:D=>{C(e,D),_(null)},onCancel:()=>_(null),onDelete:()=>{t.name,d(e),_(null)},submitLabel:"Save",categoryGroups:r,showGroupSelector:!0})});if(x)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.name}),u.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:[t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Default"}),u.jsx("span",{style:{opacity:.7},children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${st(t.default_monthly_amount)}/mo`})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Available Now"}),u.jsx("span",{style:{color:hn(S.current),fontWeight:600},children:o?"...":yr(S.current)})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total Allocated"}),u.jsx("span",{style:{color:hn(S.total)},children:o?"...":yr(S.total)})]})]})]}),t.description&&u.jsx("p",{style:{fontSize:"0.8rem",opacity:.6,margin:"0 0 0.5rem 0"},children:t.description}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.8,marginBottom:"0.5rem"},children:["Default: ",t.default_monthly_type==="percentage"?u.jsxs(u.Fragment,{children:[u.jsxs("span",{style:{color:me.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{color:me.success,fontWeight:500},children:t.default_monthly_amount}),"/mo"]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:D=>{D.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:D=>{D.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:D=>{D.stopPropagation(),m()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const T=n%2===0?"transparent":"rgba(255,255,255,0.04)",I={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:T,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 2fr 1fr"},children:[u.jsx("div",{style:{...I,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...I,justifyContent:"flex-end",opacity:.7,fontSize:"0.85rem"},children:t.default_monthly_amount!==void 0&&t.default_monthly_amount>0?u.jsx("span",{children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${yr(t.default_monthly_amount)}/mo`}):u.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"#9ca3af"},children:""})}),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:hn(S.current),fontWeight:600},children:o?"...":yr(S.current)}),u.jsx("div",{style:{...I,justifyContent:"flex-end",color:hn(S.total)},children:o?"...":yr(S.total)}),u.jsx("div",{style:{...I,opacity:.7,fontSize:"0.85rem"},children:t.description?u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description}):u.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"#9ca3af"},children:""})}),u.jsxs("div",{style:{...I,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:D=>{D.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:D=>{D.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:D=>{D.stopPropagation(),m()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function dS({group:t,categories:e,categoryGroups:n,categoryBalances:r,loadingBalances:i,editingCategoryId:o,createForGroupId:l,setEditingCategoryId:d,setCreateForGroupId:h,handleUpdateCategory:m,handleDeleteCategory:p,handleMoveCategory:g,handleCreateCategory:v,isMobile:_,isUngrouped:C,startRowIndex:x=0,canMoveGroupUp:S,canMoveGroupDown:E,onEditGroup:T,onDeleteGroup:I,onMoveGroupUp:D,onMoveGroupDown:B}){const $=[...e].sort((F,q)=>F[1].sort_order-q[1].sort_order),M=$.reduce((F,[q])=>{const R=r[q];return F+(R?.current||0)},0),O=x===0,N={padding:"0.6rem 0.5rem",marginTop:O?0:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ma,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!_&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...N,opacity:C?.7:1,justifyContent:"space-between"},children:[u.jsxs("span",{children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",$.length,")"]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!C&&u.jsxs(u.Fragment,{children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,I()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:Of,children:[u.jsx("button",{onClick:D,disabled:!S,style:{...pa,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:B,disabled:!E,style:{...pa,opacity:E?.6:.2,cursor:E?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})})]}),u.jsx("div",{style:N}),u.jsx("div",{style:{...N,justifyContent:"flex-end",color:hn(M)},children:Yt.showGroupTotals}),u.jsx("div",{style:{...N,justifyContent:"flex-end",color:hn($.reduce((F,[q])=>{const R=r[q];return F+(R?.total||0)},0))},children:Yt.showGroupTotals}),u.jsx("div",{style:N}),u.jsx("div",{style:N})]}),_&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:O?0:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Ma,background:"rgba(255,255,255,0.04)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:C?.7:1},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",$.length,")"]})]}),Yt.showGroupTotals]}),!C&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx(Ve,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,I()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:Of,children:[u.jsx("button",{onClick:D,disabled:!S,style:{...pa,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:B,disabled:!E,style:{...pa,opacity:E?.6:.2,cursor:E?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]}),$.map(([F,q],R)=>{const P=x+R;return u.jsx(DB,{category:q,catId:F,categoryIndex:P,totalCategories:$.length,categoryGroups:n,categoryBalances:r,loadingBalances:i,onEdit:d,onDelete:p,onMoveUp:()=>g(F,"up"),onMoveDown:()=>g(F,"down"),canMoveUp:R>0,canMoveDown:R<$.length-1,editingCategoryId:o,setEditingCategoryId:d,onUpdateCategory:m,isMobile:_},F)}),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(a_,{initialData:{name:"",category_group_id:t.id},onSubmit:F=>v(F,t.id),onCancel:()=>h(null),submitLabel:"Create",categoryGroups:n})})]})}function MB({onBudgetTotal:t,allocated:e,unallocated:n,relationshipMismatch:r,calculationMismatch:i}){return u.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:u.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Categories:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On Budget: "}),u.jsx("span",{style:{color:ct(t),fontWeight:600},children:qn(t)})]}),u.jsx("span",{style:{opacity:r?1:.5,color:r?"#ef4444":void 0,fontWeight:r?700:void 0},children:r?"":"="}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Allocated: "}),u.jsx("span",{style:{color:_c(e),fontWeight:600},children:qn(e)})]}),u.jsx("span",{style:{opacity:r?1:.5,color:r?"#ef4444":void 0,fontWeight:r?700:void 0},children:"+"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Unallocated: "}),u.jsx("span",{style:{color:ct(n),fontWeight:600},children:qn(n)})]}),r&&u.jsxs("span",{style:{color:"#ef4444",fontSize:"0.75rem",fontWeight:600},children:[" Mismatch: ",st(Math.abs(t-(e+n)))]}),i&&!r&&u.jsx("span",{style:{color:"#f59e0b",fontSize:"0.75rem",fontWeight:600},children:" Balance sync issue"}),u.jsx("span",{style:{opacity:.6},children:"Use  buttons to reorder categories."})]})})})}function OB(){const{selectedBudgetId:t}=Xe(),{monthMap:e,isLoading:n,isFetching:r,totalAvailable:i}=In(),{currentBudget:o,categories:l,categoryGroups:d,categoriesByGroup:h,hiddenCategories:m,sortedGroups:p,categoryBalances:g,isLoading:v,loadingBalances:_,error:C,setError:x,getOnBudgetTotal:S,handleCreateCategory:E,handleUpdateCategory:T,handleDeleteCategory:I,handleMoveCategory:D,handleCreateGroup:B,handleUpdateGroup:$,handleDeleteGroup:M,handleMoveGroup:O}=T3(),N=Ri(),{addLoadingHold:F,removeLoadingHold:q}=Pn(),R=n||v||r||!o;dd({budgetId:t,monthMap:e,checkAnyMonth:!0,additionalCondition:!R&&!!o,logPrefix:"[Settings/Categories]"}),k.useEffect(()=>(R?F("categories","Loading categories..."):q("categories"),()=>q("categories")),[R,F,q]);const[P,A]=k.useState(null),[W,K]=k.useState(null),[G,J]=k.useState(null),[X,ie]=k.useState(!1),L=k.useMemo(()=>p.filter(Me=>Me.id!==un),[p]),H=k.useMemo(()=>({id:un,name:"Uncategorized",sort_order:L.length}),[L.length]),te=(h[un]||[]).sort((Me,Oe)=>Me[1].sort_order-Oe[1].sort_order);k.useEffect(()=>{C&&(console.error("[Settings/Categories] Error:",C),en.add({type:"error",message:"Failed to update categories. See console for details.",autoDismissMs:0}),x(null))},[C,x]);const se=k.useMemo(()=>S(),[S]),{allocated:ne,unallocated:fe,calculationMismatch:Ce,relationshipMismatch:de}=A3({categories:l,categoryBalances:g,totalAvailable:i,onBudgetTotal:se,isDataLoading:R,loadingBalances:_,currentBudget:o});if(R||!o)return R?null:u.jsx("p",{children:"No budget found. Please log in."});const be={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};return u.jsxs("div",{children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:N?"1fr":"2fr 1fr 1fr 1fr 2fr 1fr",marginBottom:"1.5rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",display:N?"block":"grid",gridTemplateColumns:N?void 0:"subgrid"},children:[u.jsx(MB,{onBudgetTotal:se,allocated:ne,unallocated:fe,relationshipMismatch:de,calculationMismatch:Ce}),u.jsx("div",{style:{gridColumn:"1 / -1",display:"flex",gap:"0.5rem",flexShrink:0,justifyContent:"flex-end",paddingRight:"var(--page-padding, 2rem)",marginTop:"-0.5rem",marginBottom:"0.5rem"},children:u.jsx(t_,{})}),!N&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:be,children:"Category"}),u.jsx("div",{style:{...be,textAlign:"right"},children:"Default"}),u.jsx("div",{style:{...be,textAlign:"right"},children:"Available Now"}),u.jsx("div",{style:{...be,textAlign:"right"},children:"Total Allocated"}),u.jsx("div",{style:be,children:"Description"}),u.jsx("div",{style:{...be,textAlign:"right"},children:"Actions"})]})]}),Object.keys(l).length===0&&d.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No categories yet. Create a group first, then add categories!"}),(()=>{const Me={};let Oe=0;return L.forEach(qe=>{const ot=(h[qe.id]||[]).sort((U,ce)=>U[1].sort_order-ce[1].sort_order);Me[qe.id]=Oe,Oe+=ot.length}),L.map((qe,ot)=>{const U=(h[qe.id]||[]).sort((ce,ye)=>ce[1].sort_order-ye[1].sort_order);return U.length===0&&G!==qe.id&&W!==qe.id?null:G===qe.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(uS,{initialData:{name:qe.name},onSubmit:ce=>{$(qe.id,ce),J(null)},onCancel:()=>J(null),submitLabel:"Save"})},qe.id):u.jsx(dS,{group:qe,categories:U,categoryGroups:d,categoryBalances:g,loadingBalances:_,editingCategoryId:P,createForGroupId:W,setEditingCategoryId:A,setCreateForGroupId:K,handleUpdateCategory:T,handleDeleteCategory:I,handleMoveCategory:D,handleCreateCategory:E,isMobile:N,canMoveGroupUp:ot>0,canMoveGroupDown:ot<L.length-1,onEditGroup:()=>J(qe.id),onDeleteGroup:()=>M(qe.id),onMoveGroupUp:()=>O(qe.id,"up"),onMoveGroupDown:()=>O(qe.id,"down"),startRowIndex:Me[qe.id]??0},qe.id)})})(),(te.length>0||W==="ungrouped")&&(()=>{const Me=L.reduce((Oe,qe)=>{const ot=(h[qe.id]||[]).sort((U,ce)=>U[1].sort_order-ce[1].sort_order);return Oe+ot.length},0);return u.jsx(dS,{group:H,categories:te,categoryGroups:d,categoryBalances:g,loadingBalances:_,editingCategoryId:P,createForGroupId:W,setEditingCategoryId:A,setCreateForGroupId:K,handleUpdateCategory:T,handleDeleteCategory:I,handleMoveCategory:D,handleCreateCategory:E,isMobile:N,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{},startRowIndex:Me})})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),m.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(K0,{title:"Hidden Categories",count:m.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:m.map(([Me,Oe])=>P===Me?u.jsx(a_,{initialData:{name:Oe.name,description:Oe.description,category_group_id:Oe.category_group_id,default_monthly_amount:Oe.default_monthly_amount,default_monthly_type:Oe.default_monthly_type,is_hidden:Oe.is_hidden},onSubmit:qe=>{T(Me,qe),A(null)},onCancel:()=>A(null),submitLabel:"Save",categoryGroups:d,showGroupSelector:!0},Me):u.jsxs("div",{onClick:()=>A(Me),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:Oe.name}),u.jsx("span",{style:{color:ct(Oe.balance),fontWeight:500},children:qn(Oe.balance)})]},Me))})]})}),X?u.jsx(uS,{onSubmit:Me=>{B(Me),ie(!1)},onCancel:()=>ie(!1),submitLabel:"Create Group"}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>ie(!0),children:"+ Add Category Group"})]})}function NB(){const{selectedBudgetId:t,currentUserId:e}=Xe(),{addLoadingHold:n,removeLoadingHold:r}=Pn(),{budget:i,budgetUserIds:o,acceptedUserIds:l,isLoading:d}=In();k.useEffect(()=>(d||!i?n("users","Loading users..."):r("users"),()=>r("users")),[d,i,n,r]);const{inviteUser:h}=vB(),{revokeUser:m}=xB(),[p,g]=k.useState(""),[v,_]=k.useState(!1),[C,x]=k.useState(null),[S,E]=k.useState(null);if(d)return null;if(!i)return u.jsx("p",{children:"No budget found."});async function T($){if($.preventDefault(),!(!p.trim()||!i||!t)){_(!0),x(null),E(null);try{await h.mutateAsync({budgetId:t,userId:p.trim()}),g(""),E("Invite sent! The user can now accept the invitation from their account.")}catch(M){x(M instanceof Error?M.message:"Failed to invite user")}finally{_(!1)}}}async function I($){if(!i||!t)return;if($===i.owner_id){x("Cannot revoke the budget owner");return}if($===e){x("Cannot revoke yourself from the budget");return}const M=l.includes($);if(confirm(M?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){x(null),E(null);try{await m.mutateAsync({budgetId:t,userId:$}),E(M?"User access revoked.":"Invitation cancelled.")}catch(N){x(N instanceof Error?N.message:"Failed to revoke user")}}}const D=o.filter($=>l.includes($)),B=o.filter($=>!l.includes($));return u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),C&&u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:C}),u.jsx("button",{onClick:()=>x(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),S&&u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:S}),u.jsx("button",{onClick:()=>E(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",D.length,")"]}),D.length===0?u.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:D.map($=>{const M=$===i.owner_id,O=$===e;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),M&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),O&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!M&&!O&&u.jsx("button",{onClick:()=>I($),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},$)})})]}),B.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",B.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:B.map($=>u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),u.jsx("button",{onClick:()=>I($),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},$))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),u.jsxs("form",{onSubmit:T,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:p,onChange:$=>g($.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:v||!p.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:v||!p.trim()?"not-allowed":"pointer",fontWeight:500,opacity:v||!p.trim()?.7:1,whiteSpace:"nowrap"},children:v?"Inviting...":"Send Invite"})]}),u.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),u.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:i.id})]})]})}const PB=["budget","feedback","migration","tests"];function zB(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:i}=Xe();k.useLayoutEffect(()=>{i("Budget Admin")},[i]);const o=Nn(),l=o.pathname==="/budget/admin",d=k.useMemo(()=>{const g=o.pathname;return g.includes("/admin/budget")?"budget":g.includes("/admin/feedback")?"feedback":g.includes("/admin/migration")?"migration":g.includes("/admin/tests")?"tests":"budget"},[o.pathname]),h=d==="tests";k.useEffect(()=>{l||r(d)},[d,l,r]);function m(){return!PB.includes(n)||n==="tests"&&!e?"budget":n}const p=k.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return t?!e&&h?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(jn,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):u.jsxs("div",{children:[u.jsx(Pf,{mode:"link",linkPrefix:"/budget/admin",tabs:p,activeTab:d}),l?u.jsx(Ff,{to:`/budget/admin/${m()}`,replace:!0}):u.jsx(Vf,{})]}):u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(jn,{to:"/budget",children:"Go to Budget "})})]})}function BB(){const{addLoadingHold:t,removeLoadingHold:e}=Pn(),{isAdmin:n}=Xe(),{budget:r,accounts:i,accountGroups:o,categories:l,categoryGroups:d,isOwner:h,isLoading:m}=In();return k.useEffect(()=>(m?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[m,t,e]),m?null:r?u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),u.jsx("strong",{children:r.name})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),u.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),u.jsx("strong",{children:r.owner_email||r.owner_id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),u.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",u.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),u.jsx("button",{onClick:()=>{const p={...r,accounts:i,account_groups:o,categories:l,category_groups:d,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),v=URL.createObjectURL(g),_=document.createElement("a");_.href=v,_.download=`budget_${r.id}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(v)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):u.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function hS({selectedType:t,onSelect:e}){return u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=zf[n],i=t==="feature"?"new_feature":t,o=i===n||!i&&n==="bug";return u.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function LB(){const[t,e]=k.useState(null),[n,r]=k.useState(null),[i,o]=k.useState(!1),[l,d]=k.useState(""),[h,m]=k.useState("bug"),[p,g]=k.useState(null),[v,_]=k.useState(!1),[C,x]=k.useState(null),S=k.useContext(fd),T=Pa().get_current_firebase_user(),I=$t(),D=s4(),{submitFeedback:B}=XT(),{toggleFeedback:$}=NP(),{updateSortOrder:M}=PP(),O=D.data?.items||[],N=Ri(),{addLoadingHold:F,removeLoadingHold:q}=Pn();k.useEffect(()=>(D.isLoading?F("settings-feedback","Loading feedback..."):q("settings-feedback"),()=>q("settings-feedback")),[D.isLoading,F,q]);function R(de){de.preventDefault(),!(!l.trim()||!S.username||!T)&&(B.mutate({userId:T.uid,userEmail:S.username,text:l.trim(),feedbackType:h,currentPath:"/settings/feedback"}),d(""),m("bug"),o(!1))}function P(de){de.is_done?A(de):g(de)}async function A(de){try{await $.mutateAsync({item:de})}catch(be){console.error("[Feedback] Error updating feedback:",be),en.add({type:"error",message:"Failed to update feedback",autoDismissMs:5e3})}}function W(){p&&(A(p),g(null))}async function K(){_(!1);const de="mark-all-feedback-complete";F(de,`Marking ${X.length} item${X.length!==1?"s":""} as complete...`);try{const be=new Date().toISOString(),Me=new Set(X.map(ce=>ce.id)),Oe=new Map;for(const ce of X)Oe.has(ce.doc_id)||Oe.set(ce.doc_id,[]),Oe.get(ce.doc_id).push(ce);const qe=[];for(const[ce,ye]of Oe){const ee=(async()=>{const oe=(await YT(ce,"mark all feedback complete")).items.map(Se=>Me.has(Se.id)?{...Se,is_done:!0,completed_at:be}:Se);await W0({docId:ce,items:oe,description:`marking ${ye.length} feedback item${ye.length!==1?"s":""} as complete`})})();qe.push(ee)}await Promise.all(qe);const ot=Re.feedback(),U=I.getQueryData(ot);U&&I.setQueryData(ot,{items:U.items.map(ce=>Me.has(ce.id)?{...ce,is_done:!0,completed_at:be}:ce)}),await I.invalidateQueries({queryKey:ot}),en.add({type:"success",message:`Marked ${X.length} item${X.length!==1?"s":""} as complete`,autoDismissMs:3e3})}catch(be){console.error("[Feedback] Error marking all as complete:",be),en.add({type:"error",message:"Failed to mark all items as complete",autoDismissMs:5e3}),await I.invalidateQueries({queryKey:Re.feedback()})}finally{q(de)}}function G(){K()}async function J(de){if(C){try{const Me=O.filter(Oe=>Oe.doc_id===C.doc_id).map(Oe=>({id:Oe.id,text:Oe.text,created_at:Oe.created_at,is_done:Oe.is_done,completed_at:Oe.completed_at,sort_order:Oe.sort_order,feedback_type:Oe.id===C.id?de:Oe.feedback_type}));await M.mutateAsync({docId:C.doc_id,items:Me})}catch(be){console.error("[Feedback] Error updating feedback type:",be),en.add({type:"error",message:"Failed to update feedback type",autoDismissMs:5e3})}x(null)}}const X=O.filter(de=>!de.is_done).sort((de,be)=>de.sort_order-be.sort_order),ie=O.filter(de=>de.is_done).sort((de,be)=>new Date(be.completed_at||0).getTime()-new Date(de.completed_at||0).getTime());function L(de,be){e(be),de.dataTransfer.effectAllowed="move"}function H(de,be){de.preventDefault(),be!==t&&r(be)}function te(){r(null)}function se(){e(null),r(null)}async function ne(de,be){if(de.preventDefault(),!t||t===be){se();return}const Me=X.findIndex(ce=>ce.id===t),Oe=[...X],[qe]=Oe.splice(Me,1);if(be==="__end__")Oe.push(qe);else{const ce=Oe.findIndex(ye=>ye.id===be);Oe.splice(ce,0,qe)}const ot=Oe.map((ce,ye)=>({...ce,sort_order:ye}));se();const U=new Map;for(const ce of ot)U.has(ce.doc_id)||U.set(ce.doc_id,[]),U.get(ce.doc_id).push({id:ce.id,text:ce.text,created_at:ce.created_at,is_done:ce.is_done,completed_at:ce.completed_at,sort_order:ce.sort_order,feedback_type:ce.feedback_type});for(const ce of ie)U.has(ce.doc_id)||U.set(ce.doc_id,[]),U.get(ce.doc_id).push({id:ce.id,text:ce.text,created_at:ce.created_at,is_done:ce.is_done,completed_at:ce.completed_at,sort_order:ce.sort_order,feedback_type:ce.feedback_type});try{for(const[ce,ye]of U)await M.mutateAsync({docId:ce,items:ye})}catch(ce){console.error("[Feedback] Error saving order:",ce),en.add({type:"error",message:"Failed to save order",autoDismissMs:5e3})}}function fe(){const de=Ce(X),be=new Blob([de],{type:"text/markdown"}),Me=URL.createObjectURL(be),Oe=document.createElement("a");Oe.href=Me,Oe.download=`feedback-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(Oe),Oe.click(),document.body.removeChild(Oe),URL.revokeObjectURL(Me)}function Ce(de){let be=`# Feedback Export

`;return be+=`Generated: ${new Date().toISOString()}

`,de.length>0&&(be+=`## Pending

`,de.forEach((Me,Oe)=>{const qe=Me.feedback_type?zf[Me.feedback_type]?.label||Me.feedback_type:"Unknown";be+=`### ${Oe+1}. [${qe}] ${Me.text.split(`
`)[0].substring(0,60)}${Me.text.split(`
`)[0].length>60?"...":""}

`,be+=`- **Type:** ${qe}
`,be+=`- **Created:** ${Me.created_at}
`,be+=`- **User:** ${Me.user_email||Me.doc_id}
`,be+=`- **ID:** ${Me.id}

`,be+=`${Me.text}

`,be+=`---

`})),be}return D.isLoading?null:u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",flexDirection:N?"column":"row",justifyContent:"space-between",alignItems:N?"stretch":"flex-start",gap:N?"0.75rem":"1rem",marginTop:"1.5rem",marginBottom:"0.5rem"},children:[u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Feedback"}),u.jsx("p",{style:{...TT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexDirection:N?"column":"row"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Download Feedback as Markdown",onClick:fe,disabled:X.length===0,style:N?{width:"100%"}:void 0,children:"Download Markdown"}),u.jsx(Ve,{variant:"secondary",actionName:"Mark All Complete",onClick:()=>_(!0),disabled:X.length===0,style:N?{width:"100%"}:void 0,children:"Mark All Complete"})]})]}),u.jsxs("div",{style:k1,children:[X.length===0&&!i&&u.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),X.map(de=>u.jsx(az,{item:de,isDragging:t===de.id,isDragOver:n===de.id,onDragStart:be=>L(be,de.id),onDragOver:be=>H(be,de.id),onDragLeave:te,onDragEnd:se,onDrop:be=>ne(be,de.id),onToggleDone:()=>P(de),onTypeClick:()=>x(de)},de.id)),t&&X.length>0&&u.jsx(MP,{isActive:n==="__end__",onDragOver:de=>H(de,"__end__"),onDragLeave:te,onDrop:de=>ne(de,"__end__")})]}),i?u.jsxs(Ti,{actionName:"Add Feedback",onSubmit:R,children:[u.jsx(hS,{selectedType:h,onSelect:m}),u.jsx(H0,{value:l,onChange:de=>d(de.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),u.jsxs(Ua,{children:[u.jsx(Ve,{type:"submit",actionName:"Add Feedback",disabled:!l.trim(),children:"Add Feedback"}),u.jsx(Ve,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{o(!1),d(""),m("bug")},children:"Cancel"})]})]}):u.jsx(Ve,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>o(!0),children:"+ Add Feedback"}),ie.length>0&&u.jsx(K0,{title:"Completed",count:ie.length,children:u.jsx("div",{style:{...k1,marginTop:"0.5rem"},children:ie.map(de=>u.jsx(oz,{item:de,onToggleDone:()=>P(de),onTypeClick:()=>x(de)},de.id))})}),u.jsxs(ds,{isOpen:p!==null,onClose:()=>g(null),title:"Mark as Complete",children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),p&&u.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',p.text,'"']}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>g(null),children:"Cancel"}),u.jsx(Ve,{variant:"primary",actionName:"Confirm Mark Complete",onClick:W,children:"Mark Complete"})]})]}),u.jsxs(ds,{isOpen:v,onClose:()=>_(!1),title:"Mark All as Complete",children:[u.jsxs("p",{style:{margin:"0 0 1.5rem 0"},children:["Are you sure you want to mark all ",X.length," pending feedback item",X.length!==1?"s":""," as complete?"]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Ve,{variant:"secondary",actionName:"Cancel Mark All Complete",onClick:()=>_(!1),children:"Cancel"}),u.jsx(Ve,{variant:"primary",actionName:"Confirm Mark All Complete",onClick:G,children:"Mark All Complete"})]})]}),u.jsxs(ds,{isOpen:C!==null,onClose:()=>x(null),title:"Change Feedback Type",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),u.jsx(hS,{selectedType:C?.feedback_type||"bug",onSelect:J}),u.jsx(Ve,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>x(null),style:{width:"100%"},children:"Cancel"})]})]})}function UB(){Be.clear(),window.location.reload()}function FB(){const e=Pa().get_current_firebase_user(),{selectedBudgetId:n}=Xe(),r=EP({currentUser:e}),i=aP({currentUser:e}),o=nP({currentUser:e}),l=hP({currentUser:e}),d=K3({currentUser:e}),h=jP({currentUser:e,budgetId:n}),m=DP({currentUser:e}),p=$3({currentUser:e}),g=q3({currentUser:e}),v=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning||p.isScanning||g.isScanning,_=i.isRunning||o.isRunning||l.isRunning||d.isRunning||p.isDeleting||g.isDeleting||h.isDownloading||m.isUploading,C=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan(),p.scanStatus(),g.scanStatus()])};return u.jsxs("div",{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("h2",{style:{margin:0},children:"Data Migrations"}),u.jsxs("button",{onClick:C,disabled:v||_,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:v||_?"not-allowed":"pointer",fontWeight:500,opacity:v||_?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[u.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:v?u.jsx(Gn,{noMargin:!0}):""}),"Refresh All"]})]}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),u.jsx(dz,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading}),u.jsx(pz,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading,accountCategoryValidation:{status:r.status,hasData:!!r.status,hasViolations:r.hasViolations,violationCount:r.violationCount,isScanning:r.isScanning,report:r.report,scan:r.scan},orphanedIdCleanup:{status:i.status,hasData:!!i.status,hasItemsToFix:i.hasItemsToFix,totalOrphaned:i.status?i.status.orphanedCategoryIds+i.status.orphanedAccountIds:0,isScanning:i.isScanning,isRunning:i.isRunning,result:i.result,scanStatus:i.scanStatus,runMigration:i.runMigration},expenseToAdjustment:{status:o.status,hasData:!!o.status,hasItemsToMigrate:o.hasItemsToMigrate,totalToMigrate:o.status?.expensesToMigrate??0,isScanning:o.isScanning,isRunning:o.isRunning,result:o.result,scanStatus:o.scanStatus,runMigration:o.runMigration},adjustmentsToTransfers:{status:l.status,hasData:!!l.status,hasPairsToConvert:l.hasPairsToConvert,totalPairs:l.status?.pairsFound??0,isScanning:l.isScanning,isRunning:l.isRunning,result:l.result,scanStatus:l.scanStatus,runMigration:l.runMigration},precisionCleanup:{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isScanning:d.isScanning,isRunning:d.isRunning,result:d.result,scan:d.scan,runCleanup:d.runCleanup}}),u.jsx(vz,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading,budgetDownloadUpload:{isDownloading:h.isDownloading,downloadProgress:h.progress,downloadError:h.error,downloadBudget:h.downloadBudget,isScanning:m.isScanning,isUploading:m.isUploading,uploadStatus:m.status,uploadProgress:m.progress,uploadError:m.error,uploadResult:m.result,scanZipFile:m.scanZipFile,uploadBudget:m.uploadBudget},deleteAllMonths:{status:p.status,hasData:!!p.status,monthsCount:p.status?.monthsCount??0,budgetCount:p.status?.budgetCount??0,isScanning:p.isScanning,isDeleting:p.isDeleting,deleteResult:p.deleteResult,deleteProgress:p.deleteProgress,scanStatus:p.scanStatus,deleteAllMonths:p.deleteAllMonths},deleteSampleUserBudget:{status:g.status,hasData:!!g.status,totalBudgets:g.status?.totalBudgets??0,totalMonths:g.status?.totalMonths??0,isScanning:g.isScanning,isDeleting:g.isDeleting,deleteResult:g.deleteResult,deleteProgress:g.deleteProgress,scanStatus:g.scanStatus,deleteSampleUserBudget:g.deleteSampleUserBudget},onClearCache:UB}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:u.jsxs("p",{style:{margin:0,opacity:.7},children:[u.jsx("strong",{children:"Note:"})," These migrations will process ",u.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),u.jsx(nA,{})]})}function Ml({name:t,description:e,expectedBehavior:n,result:r,onRun:i,disabled:o,expectedToSucceed:l}){const d=r?.status==="passed"?me.success:r?.status==="failed"?me.danger:r?.status==="running"?me.warning:"inherit";return u.jsxs("div",{style:{...V0,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1},children:[u.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),u.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),u.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:l?me.success:me.warning},children:["Expected: ",n]})]}),u.jsx(Ve,{onClick:i,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&u.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,fontSize:"0.85rem",color:d},children:r.message})]})}function VB({totalCount:t,passedCount:e,failedCount:n}){return u.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[u.jsxs("span",{children:["Total: ",u.jsx("strong",{children:t})]}),u.jsxs("span",{style:{color:me.success},children:["Passed: ",u.jsx("strong",{children:e})]}),u.jsxs("span",{style:{color:me.danger},children:["Failed: ",u.jsx("strong",{children:n})]})]})}const fS=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function $B(){const{currentUserId:t}=Xe(),[e,n]=k.useState([]),[r,i]=k.useState(!1);function o(_,C){n(x=>x.map(S=>S.name===_?{...S,...C}:S))}async function l(_,C,x){o(_,{status:"running",message:"Running..."});try{const S=await C();x?o(_,{status:"failed",message:` ${S}`}):o(_,{status:"passed",message:` ${S}`})}catch(S){const E=S instanceof Error?S.message:"Unknown error";x?o(_,{status:"passed",message:` Blocked as expected: ${E}`}):o(_,{status:"failed",message:` ${E}`})}}async function d(){i(!0),n(fS.map(_=>({..._,status:"pending",message:""})));for(const _ of fS)await h(_.name);i(!1)}async function h(_){switch(_){case"Read unauthorized budget":await l(_,async()=>(await Et("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await l(_,async()=>(await Et("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await l(_,async()=>(await Et("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:C}=await Et("users",t,"security test: reading own user to get current is_admin value"),x=C?.permission_flags?.is_admin??!1;return await kf("users",t,{"permission_flags.is_admin":!x},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:C}=await Et("users",t,"security test: reading own user to get current is_test value"),x=C?.permission_flags?.is_test??!1;return await kf("users",t,{"permission_flags.is_test":!x},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{exists:C}=await Et("users",t,"security test: reading own user document (should succeed)");if(C)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function m(_){e.find(x=>x.name===_)||n(x=>[...x,{name:_,status:"pending",message:"",expectedToFail:!0}]),i(!0),await h(_),i(!1)}const p=e.filter(_=>_.status==="passed").length,g=e.filter(_=>_.status==="failed").length,v=e.length;return u.jsxs("div",{children:[u.jsx("p",{style:TT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),u.jsx("div",{style:{marginBottom:"1.5rem"},children:u.jsx(Ve,{onClick:d,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&u.jsx(VB,{totalCount:v,passedCount:p,failedCount:g}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),u.jsx(Ml,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read unauthorized budget"),onRun:()=>m("Read unauthorized budget"),disabled:r}),u.jsx(Ml,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read another user's document"),onRun:()=>m("Read another user's document"),disabled:r}),u.jsx(Ml,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(_=>_.name==="Read unauthorized budget month"),onRun:()=>m("Read unauthorized budget month"),disabled:r}),u.jsx(Ml,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_admin in own permission_flags"),onRun:()=>m("Toggle is_admin in own permission_flags"),disabled:r}),u.jsx(Ml,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_test in own permission_flags"),onRun:()=>m("Toggle is_test in own permission_flags"),disabled:r}),u.jsx(Ml,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(_=>_.name==="Read own user document"),onRun:()=>m("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&u.jsxs(bm,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function qB({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=Pn(),r=k.useContext(fd),i=Nn();return k.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?u.jsx(u.Fragment,{children:t}):u.jsx(Vf,{}):u.jsx(Ff,{to:"/account",state:{from:i.pathname},replace:!0}):null}function HB(){const{addLoadingHold:t,removeLoadingHold:e}=Pn(),{isInitialized:n,pageTitle:r}=Xe(),{isLoading:i,error:o}=In();return k.useEffect(()=>{n?e("budget-init"):t("budget-init",i?"Fetching data from server...":"Loading budget...")},[n,i,t,e]),k.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),u.jsx("div",{style:Mf,children:u.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",o.message]})})):u.jsx("div",{style:{...Mf,paddingBottom:"5rem"},children:u.jsxs(JT,{children:[u.jsx(VP,{title:r}),n&&u.jsx(Vf,{})]})})}const GB={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function QB(){const{isLoading:t,loadingMessage:e}=Pn();return t?u.jsx(e_,{message:e}):null}function WB(){const[t,e]=k.useState(null);return k.useEffect(()=>en.subscribe(e),[]),t?u.jsx(qP,{item:t,onDismiss:n=>en.remove(n)}):null}function KB(){const{selectedBudgetId:t,isInitialized:e}=Xe(),n=$t(),r=t?["initialDataLoad",t]:null,i=r?n.getQueryState(r)?.status==="success":!1;return Cn(),M3(),P3(t,i&&e),u.jsxs(u.Fragment,{children:[u.jsxs(Y5,{children:[u.jsx(Tn,{path:"/",element:u.jsx(xz,{})}),u.jsx(Tn,{path:"/account",element:u.jsx(wz,{})}),u.jsx(Tn,{path:"/budget",element:u.jsx(qB,{}),children:u.jsxs(Tn,{element:u.jsx(HB,{}),children:[u.jsx(Tn,{index:!0,element:u.jsx(iS,{})}),u.jsx(Tn,{path:":year/:month/:tab/:view?",element:u.jsx(iS,{})}),u.jsx(Tn,{path:"analytics",element:u.jsx(yB,{})}),u.jsx(Tn,{path:"my-budgets",element:u.jsx(TB,{})}),u.jsxs(Tn,{path:"settings",element:u.jsx(jB,{}),children:[u.jsx(Tn,{index:!0,element:u.jsx(Ff,{to:"categories",replace:!0})}),u.jsx(Tn,{path:"accounts",element:u.jsx(kB,{})}),u.jsx(Tn,{path:"categories",element:u.jsx(OB,{})}),u.jsx(Tn,{path:"users",element:u.jsx(NB,{})})]}),u.jsxs(Tn,{path:"admin",element:u.jsx(zB,{}),children:[u.jsx(Tn,{path:"budget",element:u.jsx(BB,{})}),u.jsx(Tn,{path:"feedback",element:u.jsx(LB,{})}),u.jsx(Tn,{path:"migration",element:u.jsx(FB,{})}),u.jsx(Tn,{path:"tests",element:u.jsx($B,{})})]})]})})]}),u.jsx(LP,{}),u.jsx(nA,{}),u.jsx(WB,{})]})}function YB(){const[t,e]=k.useState(GB),n=Pa(),r=k.useRef(!1),{addLoadingHold:i,removeLoadingHold:o}=Pn();return k.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(l=>{e({is_logged_in:l!=null,is_auth_checked:!0,username:l?.email??"",set_user_context:e})}))},[n]),k.useEffect(()=>{t.is_auth_checked?o("auth"):i("auth","Authenticating...")},[t.is_auth_checked,i,o]),t.is_auth_checked?u.jsx(fd.Provider,{value:t,children:u.jsx(pM,{children:u.jsx(rz,{children:u.jsx(H4,{children:u.jsx(B3,{children:u.jsx(xj,{children:u.jsx(KB,{})})})})})})}):null}function XB(){return u.jsxs(fR,{children:[u.jsx(QB,{}),u.jsx(YB,{})]})}Y2.createRoot(document.getElementById("root")).render(u.jsx(k.StrictMode,{children:u.jsx(XB,{})}));
