(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();var vg={exports:{}},uu={};var px;function Yj(){if(px)return uu;px=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,a,o){var u=null;if(o!==void 0&&(u=""+o),a.key!==void 0&&(u=""+a.key),"key"in a){o={};for(var h in a)h!=="key"&&(o[h]=a[h])}else o=a;return a=o.ref,{$$typeof:t,type:r,key:u,ref:a!==void 0?a:null,props:o}}return uu.Fragment=e,uu.jsx=n,uu.jsxs=n,uu}var gx;function Xj(){return gx||(gx=1,vg.exports=Yj()),vg.exports}var c=Xj(),xg={exports:{}},qe={};var yx;function Jj(){if(yx)return qe;yx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),v=Symbol.iterator;function x(z){return z===null||typeof z!="object"?null:(z=v&&z[v]||z["@@iterator"],typeof z=="function"?z:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,T={};function I(z,q,te){this.props=z,this.context=q,this.refs=T,this.updater=te||S}I.prototype.isReactComponent={},I.prototype.setState=function(z,q){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,q,"setState")},I.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function j(){}j.prototype=I.prototype;function M(z,q,te){this.props=z,this.context=q,this.refs=T,this.updater=te||S}var Q=M.prototype=new j;Q.constructor=M,E(Q,I.prototype),Q.isPureReactComponent=!0;var H=Array.isArray;function W(){}var D={H:null,A:null,T:null,S:null},A=Object.prototype.hasOwnProperty;function N(z,q,te){var ie=te.ref;return{$$typeof:t,type:z,key:q,ref:ie!==void 0?ie:null,props:te}}function P(z,q){return N(z.type,q,z.props)}function L(z){return typeof z=="object"&&z!==null&&z.$$typeof===t}function B(z){var q={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(te){return q[te]})}var O=/\/+/g;function G(z,q){return typeof z=="object"&&z!==null&&z.key!=null?B(""+z.key):q.toString(36)}function Y(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then(W,W):(z.status="pending",z.then(function(q){z.status==="pending"&&(z.status="fulfilled",z.value=q)},function(q){z.status==="pending"&&(z.status="rejected",z.reason=q)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function U(z,q,te,ie,ee){var le=typeof z;(le==="undefined"||le==="boolean")&&(z=null);var pe=!1;if(z===null)pe=!0;else switch(le){case"bigint":case"string":case"number":pe=!0;break;case"object":switch(z.$$typeof){case t:case e:pe=!0;break;case g:return pe=z._init,U(pe(z._payload),q,te,ie,ee)}}if(pe)return ee=ee(z),pe=ie===""?"."+G(z,0):ie,H(ee)?(te="",pe!=null&&(te=pe.replace(O,"$&/")+"/"),U(ee,q,te,"",function(J){return J})):ee!=null&&(L(ee)&&(ee=P(ee,te+(ee.key==null||z&&z.key===ee.key?"":(""+ee.key).replace(O,"$&/")+"/")+pe)),q.push(ee)),1;pe=0;var xe=ie===""?".":ie+":";if(H(z))for(var ve=0;ve<z.length;ve++)ie=z[ve],le=xe+G(ie,ve),pe+=U(ie,q,te,le,ee);else if(ve=x(z),typeof ve=="function")for(z=ve.call(z),ve=0;!(ie=z.next()).done;)ie=ie.value,le=xe+G(ie,ve++),pe+=U(ie,q,te,le,ee);else if(le==="object"){if(typeof z.then=="function")return U(Y(z),q,te,ie,ee);throw q=String(z),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return pe}function F(z,q,te){if(z==null)return z;var ie=[],ee=0;return U(z,ie,"","",function(le){return q.call(te,le,ee++)}),ie}function K(z){if(z._status===-1){var q=z._result;q=q(),q.then(function(te){(z._status===0||z._status===-1)&&(z._status=1,z._result=te)},function(te){(z._status===0||z._status===-1)&&(z._status=2,z._result=te)}),z._status===-1&&(z._status=0,z._result=q)}if(z._status===1)return z._result.default;throw z._result}var Z=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)},re={map:F,forEach:function(z,q,te){F(z,function(){q.apply(this,arguments)},te)},count:function(z){var q=0;return F(z,function(){q++}),q},toArray:function(z){return F(z,function(q){return q})||[]},only:function(z){if(!L(z))throw Error("React.Children.only expected to receive a single React element child.");return z}};return qe.Activity=_,qe.Children=re,qe.Component=I,qe.Fragment=n,qe.Profiler=a,qe.PureComponent=M,qe.StrictMode=r,qe.Suspense=f,qe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,qe.__COMPILER_RUNTIME={__proto__:null,c:function(z){return D.H.useMemoCache(z)}},qe.cache=function(z){return function(){return z.apply(null,arguments)}},qe.cacheSignal=function(){return null},qe.cloneElement=function(z,q,te){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var ie=E({},z.props),ee=z.key;if(q!=null)for(le in q.key!==void 0&&(ee=""+q.key),q)!A.call(q,le)||le==="key"||le==="__self"||le==="__source"||le==="ref"&&q.ref===void 0||(ie[le]=q[le]);var le=arguments.length-2;if(le===1)ie.children=te;else if(1<le){for(var pe=Array(le),xe=0;xe<le;xe++)pe[xe]=arguments[xe+2];ie.children=pe}return N(z.type,ee,ie)},qe.createContext=function(z){return z={$$typeof:u,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:o,_context:z},z},qe.createElement=function(z,q,te){var ie,ee={},le=null;if(q!=null)for(ie in q.key!==void 0&&(le=""+q.key),q)A.call(q,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(ee[ie]=q[ie]);var pe=arguments.length-2;if(pe===1)ee.children=te;else if(1<pe){for(var xe=Array(pe),ve=0;ve<pe;ve++)xe[ve]=arguments[ve+2];ee.children=xe}if(z&&z.defaultProps)for(ie in pe=z.defaultProps,pe)ee[ie]===void 0&&(ee[ie]=pe[ie]);return N(z,le,ee)},qe.createRef=function(){return{current:null}},qe.forwardRef=function(z){return{$$typeof:h,render:z}},qe.isValidElement=L,qe.lazy=function(z){return{$$typeof:g,_payload:{_status:-1,_result:z},_init:K}},qe.memo=function(z,q){return{$$typeof:m,type:z,compare:q===void 0?null:q}},qe.startTransition=function(z){var q=D.T,te={};D.T=te;try{var ie=z(),ee=D.S;ee!==null&&ee(te,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(W,Z)}catch(le){Z(le)}finally{q!==null&&te.types!==null&&(q.types=te.types),D.T=q}},qe.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},qe.use=function(z){return D.H.use(z)},qe.useActionState=function(z,q,te){return D.H.useActionState(z,q,te)},qe.useCallback=function(z,q){return D.H.useCallback(z,q)},qe.useContext=function(z){return D.H.useContext(z)},qe.useDebugValue=function(){},qe.useDeferredValue=function(z,q){return D.H.useDeferredValue(z,q)},qe.useEffect=function(z,q){return D.H.useEffect(z,q)},qe.useEffectEvent=function(z){return D.H.useEffectEvent(z)},qe.useId=function(){return D.H.useId()},qe.useImperativeHandle=function(z,q,te){return D.H.useImperativeHandle(z,q,te)},qe.useInsertionEffect=function(z,q){return D.H.useInsertionEffect(z,q)},qe.useLayoutEffect=function(z,q){return D.H.useLayoutEffect(z,q)},qe.useMemo=function(z,q){return D.H.useMemo(z,q)},qe.useOptimistic=function(z,q){return D.H.useOptimistic(z,q)},qe.useReducer=function(z,q,te){return D.H.useReducer(z,q,te)},qe.useRef=function(z){return D.H.useRef(z)},qe.useState=function(z){return D.H.useState(z)},qe.useSyncExternalStore=function(z,q,te){return D.H.useSyncExternalStore(z,q,te)},qe.useTransition=function(){return D.H.useTransition()},qe.version="19.2.3",qe}var _x;function My(){return _x||(_x=1,xg.exports=Jj()),xg.exports}var C=My(),Sg={exports:{}},du={},wg={exports:{}},Eg={};var bx;function Zj(){return bx||(bx=1,(function(t){function e(U,F){var K=U.length;U.push(F);e:for(;0<K;){var Z=K-1>>>1,re=U[Z];if(0<a(re,F))U[Z]=F,U[K]=re,K=Z;else break e}}function n(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var F=U[0],K=U.pop();if(K!==F){U[0]=K;e:for(var Z=0,re=U.length,z=re>>>1;Z<z;){var q=2*(Z+1)-1,te=U[q],ie=q+1,ee=U[ie];if(0>a(te,K))ie<re&&0>a(ee,te)?(U[Z]=ee,U[ie]=K,Z=ie):(U[Z]=te,U[q]=K,Z=q);else if(ie<re&&0>a(ee,K))U[Z]=ee,U[ie]=K,Z=ie;else break e}}return F}function a(U,F){var K=U.sortIndex-F.sortIndex;return K!==0?K:U.id-F.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var u=Date,h=u.now();t.unstable_now=function(){return u.now()-h}}var f=[],m=[],g=1,_=null,v=3,x=!1,S=!1,E=!1,T=!1,I=typeof setTimeout=="function"?setTimeout:null,j=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function Q(U){for(var F=n(m);F!==null;){if(F.callback===null)r(m);else if(F.startTime<=U)r(m),F.sortIndex=F.expirationTime,e(f,F);else break;F=n(m)}}function H(U){if(E=!1,Q(U),!S)if(n(f)!==null)S=!0,W||(W=!0,B());else{var F=n(m);F!==null&&Y(H,F.startTime-U)}}var W=!1,D=-1,A=5,N=-1;function P(){return T?!0:!(t.unstable_now()-N<A)}function L(){if(T=!1,W){var U=t.unstable_now();N=U;var F=!0;try{e:{S=!1,E&&(E=!1,j(D),D=-1),x=!0;var K=v;try{t:{for(Q(U),_=n(f);_!==null&&!(_.expirationTime>U&&P());){var Z=_.callback;if(typeof Z=="function"){_.callback=null,v=_.priorityLevel;var re=Z(_.expirationTime<=U);if(U=t.unstable_now(),typeof re=="function"){_.callback=re,Q(U),F=!0;break t}_===n(f)&&r(f),Q(U)}else r(f);_=n(f)}if(_!==null)F=!0;else{var z=n(m);z!==null&&Y(H,z.startTime-U),F=!1}}break e}finally{_=null,v=K,x=!1}F=void 0}}finally{F?B():W=!1}}}var B;if(typeof M=="function")B=function(){M(L)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,G=O.port2;O.port1.onmessage=L,B=function(){G.postMessage(null)}}else B=function(){I(L,0)};function Y(U,F){D=I(function(){U(t.unstable_now())},F)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(U){switch(v){case 1:case 2:case 3:var F=3;break;default:F=v}var K=v;v=F;try{return U()}finally{v=K}},t.unstable_requestPaint=function(){T=!0},t.unstable_runWithPriority=function(U,F){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var K=v;v=U;try{return F()}finally{v=K}},t.unstable_scheduleCallback=function(U,F,K){var Z=t.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?Z+K:Z):K=Z,U){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=K+re,U={id:g++,callback:F,priorityLevel:U,startTime:K,expirationTime:re,sortIndex:-1},K>Z?(U.sortIndex=K,e(m,U),n(f)===null&&U===n(m)&&(E?(j(D),D=-1):E=!0,Y(H,K-Z))):(U.sortIndex=re,e(f,U),S||x||(S=!0,W||(W=!0,B()))),U},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(U){var F=v;return function(){var K=v;v=F;try{return U.apply(this,arguments)}finally{v=K}}}})(Eg)),Eg}var vx;function eR(){return vx||(vx=1,wg.exports=Zj()),wg.exports}var Cg={exports:{}},On={};var xx;function tR(){if(xx)return On;xx=1;var t=My();function e(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)m+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(f,m,g){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:_==null?null:""+_,children:f,containerInfo:m,implementation:g}}var u=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,m){if(f==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return On.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,On.createPortal=function(f,m){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return o(f,m,null,g)},On.flushSync=function(f){var m=u.T,g=r.p;try{if(u.T=null,r.p=2,f)return f()}finally{u.T=m,r.p=g,r.d.f()}},On.preconnect=function(f,m){typeof f=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,r.d.C(f,m))},On.prefetchDNS=function(f){typeof f=="string"&&r.d.D(f)},On.preinit=function(f,m){if(typeof f=="string"&&m&&typeof m.as=="string"){var g=m.as,_=h(g,m.crossOrigin),v=typeof m.integrity=="string"?m.integrity:void 0,x=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;g==="style"?r.d.S(f,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:_,integrity:v,fetchPriority:x}):g==="script"&&r.d.X(f,{crossOrigin:_,integrity:v,fetchPriority:x,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},On.preinitModule=function(f,m){if(typeof f=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var g=h(m.as,m.crossOrigin);r.d.M(f,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&r.d.M(f)},On.preload=function(f,m){if(typeof f=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var g=m.as,_=h(g,m.crossOrigin);r.d.L(f,g,{crossOrigin:_,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},On.preloadModule=function(f,m){if(typeof f=="string")if(m){var g=h(m.as,m.crossOrigin);r.d.m(f,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else r.d.m(f)},On.requestFormReset=function(f){r.d.r(f)},On.unstable_batchedUpdates=function(f,m){return f(m)},On.useFormState=function(f,m,g){return u.H.useFormState(f,m,g)},On.useFormStatus=function(){return u.H.useHostTransitionStatus()},On.version="19.2.3",On}var Sx;function nR(){if(Sx)return Cg.exports;Sx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Cg.exports=tR(),Cg.exports}var wx;function rR(){if(wx)return du;wx=1;var t=eR(),e=My(),n=nR();function r(s){var i="https://react.dev/errors/"+s;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+s+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var i=s,l=s;if(s.alternate)for(;i.return;)i=i.return;else{s=i;do i=s,(i.flags&4098)!==0&&(l=i.return),s=i.return;while(s)}return i.tag===3?l:null}function u(s){if(s.tag===13){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function h(s){if(s.tag===31){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function f(s){if(o(s)!==s)throw Error(r(188))}function m(s){var i=s.alternate;if(!i){if(i=o(s),i===null)throw Error(r(188));return i!==s?null:s}for(var l=s,d=i;;){var y=l.return;if(y===null)break;var b=y.alternate;if(b===null){if(d=y.return,d!==null){l=d;continue}break}if(y.child===b.child){for(b=y.child;b;){if(b===l)return f(y),s;if(b===d)return f(y),i;b=b.sibling}throw Error(r(188))}if(l.return!==d.return)l=y,d=b;else{for(var R=!1,V=y.child;V;){if(V===l){R=!0,l=y,d=b;break}if(V===d){R=!0,d=y,l=b;break}V=V.sibling}if(!R){for(V=b.child;V;){if(V===l){R=!0,l=b,d=y;break}if(V===d){R=!0,d=b,l=y;break}V=V.sibling}if(!R)throw Error(r(189))}}if(l.alternate!==d)throw Error(r(190))}if(l.tag!==3)throw Error(r(188));return l.stateNode.current===l?s:i}function g(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s;for(s=s.child;s!==null;){if(i=g(s),i!==null)return i;s=s.sibling}return null}var _=Object.assign,v=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),j=Symbol.for("react.consumer"),M=Symbol.for("react.context"),Q=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),L=Symbol.iterator;function B(s){return s===null||typeof s!="object"?null:(s=L&&s[L]||s["@@iterator"],typeof s=="function"?s:null)}var O=Symbol.for("react.client.reference");function G(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===O?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case E:return"Fragment";case I:return"Profiler";case T:return"StrictMode";case H:return"Suspense";case W:return"SuspenseList";case N:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case S:return"Portal";case M:return s.displayName||"Context";case j:return(s._context.displayName||"Context")+".Consumer";case Q:var i=s.render;return s=s.displayName,s||(s=i.displayName||i.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case D:return i=s.displayName||null,i!==null?i:G(s.type)||"Memo";case A:i=s._payload,s=s._init;try{return G(s(i))}catch{}}return null}var Y=Array.isArray,U=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K={pending:!1,data:null,method:null,action:null},Z=[],re=-1;function z(s){return{current:s}}function q(s){0>re||(s.current=Z[re],Z[re]=null,re--)}function te(s,i){re++,Z[re]=s.current,s.current=i}var ie=z(null),ee=z(null),le=z(null),pe=z(null);function xe(s,i){switch(te(le,i),te(ee,s),te(ie,null),i.nodeType){case 9:case 11:s=(s=i.documentElement)&&(s=s.namespaceURI)?Lv(s):0;break;default:if(s=i.tagName,i=i.namespaceURI)i=Lv(i),s=Uv(i,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}q(ie),te(ie,s)}function ve(){q(ie),q(ee),q(le)}function J(s){s.memoizedState!==null&&te(pe,s);var i=ie.current,l=Uv(i,s.type);i!==l&&(te(ee,s),te(ie,l))}function Se(s){ee.current===s&&(q(ie),q(ee)),pe.current===s&&(q(pe),au._currentValue=K)}var je,at;function Me(s){if(je===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);je=i&&i[1]||"",at=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+je+s+at}var Ne=!1;function lt(s,i){if(!s||Ne)return"";Ne=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(i){var _e=function(){throw Error()};if(Object.defineProperty(_e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_e,[])}catch(fe){var de=fe}Reflect.construct(s,[],_e)}else{try{_e.call()}catch(fe){de=fe}s.call(_e.prototype)}}else{try{throw Error()}catch(fe){de=fe}(_e=s())&&typeof _e.catch=="function"&&_e.catch(function(){})}}catch(fe){if(fe&&de&&typeof fe.stack=="string")return[fe.stack,de.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=d.DetermineComponentFrameRoot(),R=b[0],V=b[1];if(R&&V){var X=R.split(`
`),ue=V.split(`
`);for(y=d=0;d<X.length&&!X[d].includes("DetermineComponentFrameRoot");)d++;for(;y<ue.length&&!ue[y].includes("DetermineComponentFrameRoot");)y++;if(d===X.length||y===ue.length)for(d=X.length-1,y=ue.length-1;1<=d&&0<=y&&X[d]!==ue[y];)y--;for(;1<=d&&0<=y;d--,y--)if(X[d]!==ue[y]){if(d!==1||y!==1)do if(d--,y--,0>y||X[d]!==ue[y]){var me=`
`+X[d].replace(" at new "," at ");return s.displayName&&me.includes("<anonymous>")&&(me=me.replace("<anonymous>",s.displayName)),me}while(1<=d&&0<=y);break}}}finally{Ne=!1,Error.prepareStackTrace=l}return(l=s?s.displayName||s.name:"")?Me(l):""}function Sn(s,i){switch(s.tag){case 26:case 27:case 5:return Me(s.type);case 16:return Me("Lazy");case 13:return s.child!==i&&i!==null?Me("Suspense Fallback"):Me("Suspense");case 19:return Me("SuspenseList");case 0:case 15:return lt(s.type,!1);case 11:return lt(s.type.render,!1);case 1:return lt(s.type,!0);case 31:return Me("Activity");default:return""}}function Gn(s){try{var i="",l=null;do i+=Sn(s,l),l=s,s=s.return;while(s);return i}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var ft=Object.prototype.hasOwnProperty,Mt=t.unstable_scheduleCallback,Ae=t.unstable_cancelCallback,Ke=t.unstable_shouldYield,_i=t.unstable_requestPaint,dn=t.unstable_now,Br=t.unstable_getCurrentPriorityLevel,cc=t.unstable_ImmediatePriority,uc=t.unstable_UserBlockingPriority,bi=t.unstable_NormalPriority,wm=t.unstable_LowPriority,cd=t.unstable_IdlePriority,ud=t.log,dd=t.unstable_setDisableYieldValue,Lr=null,wn=null;function vr(s){if(typeof ud=="function"&&dd(s),wn&&typeof wn.setStrictMode=="function")try{wn.setStrictMode(Lr,s)}catch{}}var qt=Math.clz32?Math.clz32:fd,hd=Math.log,Ro=Math.LN2;function fd(s){return s>>>=0,s===0?32:31-(hd(s)/Ro|0)|0}var is=256,Ra=262144,Xt=4194304;function as(s){var i=s&42;if(i!==0)return i;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function os(s,i,l){var d=s.pendingLanes;if(d===0)return 0;var y=0,b=s.suspendedLanes,R=s.pingedLanes;s=s.warmLanes;var V=d&134217727;return V!==0?(d=V&~b,d!==0?y=as(d):(R&=V,R!==0?y=as(R):l||(l=V&~s,l!==0&&(y=as(l))))):(V=d&~b,V!==0?y=as(V):R!==0?y=as(R):l||(l=d&~s,l!==0&&(y=as(l)))),y===0?0:i!==0&&i!==y&&(i&b)===0&&(b=y&-y,l=i&-i,b>=l||b===32&&(l&4194048)!==0)?i:y}function Ur(s,i){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&i)===0}function Em(s,i){switch(s){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function md(){var s=Xt;return Xt<<=1,(Xt&62914560)===0&&(Xt=4194304),s}function ls(s){for(var i=[],l=0;31>l;l++)i.push(s);return i}function Ia(s,i){s.pendingLanes|=i,i!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Cm(s,i,l,d,y,b){var R=s.pendingLanes;s.pendingLanes=l,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=l,s.entangledLanes&=l,s.errorRecoveryDisabledLanes&=l,s.shellSuspendCounter=0;var V=s.entanglements,X=s.expirationTimes,ue=s.hiddenUpdates;for(l=R&~l;0<l;){var me=31-qt(l),_e=1<<me;V[me]=0,X[me]=-1;var de=ue[me];if(de!==null)for(ue[me]=null,me=0;me<de.length;me++){var fe=de[me];fe!==null&&(fe.lane&=-536870913)}l&=~_e}d!==0&&Da(s,d,0),b!==0&&y===0&&s.tag!==0&&(s.suspendedLanes|=b&~(R&~i))}function Da(s,i,l){s.pendingLanes|=i,s.suspendedLanes&=~i;var d=31-qt(i);s.entangledLanes|=i,s.entanglements[d]=s.entanglements[d]|1073741824|l&261930}function dc(s,i){var l=s.entangledLanes|=i;for(s=s.entanglements;l;){var d=31-qt(l),y=1<<d;y&i|s[d]&i&&(s[d]|=i),l&=~y}}function hc(s,i){var l=i&-i;return l=(l&42)!==0?1:Ma(l),(l&(s.suspendedLanes|i))!==0?0:l}function Ma(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Us(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function pd(){var s=F.p;return s!==0?s:(s=window.event,s===void 0?32:lx(s.type))}function zr(s,i){var l=F.p;try{return F.p=s,i()}finally{F.p=l}}var Fr=Math.random().toString(36).slice(2),Jt="__reactFiber$"+Fr,_n="__reactProps$"+Fr,cs="__reactContainer$"+Fr,Io="__reactEvents$"+Fr,Tm="__reactListeners$"+Fr,gd="__reactHandles$"+Fr,yd="__reactResources$"+Fr,us="__reactMarker$"+Fr;function Do(s){delete s[Jt],delete s[_n],delete s[Io],delete s[Tm],delete s[gd]}function ds(s){var i=s[Jt];if(i)return i;for(var l=s.parentNode;l;){if(i=l[cs]||l[Jt]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(s=Gv(s);s!==null;){if(l=s[Jt])return l;s=Gv(s)}return i}s=l,l=s.parentNode}return null}function xr(s){if(s=s[Jt]||s[cs]){var i=s.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return s}return null}function ir(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s.stateNode;throw Error(r(33))}function hs(s){var i=s[yd];return i||(i=s[yd]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function Zt(s){s[us]=!0}var fc=new Set,mc={};function fs(s,i){ms(s,i),ms(s+"Capture",i)}function ms(s,i){for(mc[s]=i,s=0;s<i.length;s++)fc.add(i[s])}var pc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),gc={},yc={};function _d(s){return ft.call(yc,s)?!0:ft.call(gc,s)?!1:pc.test(s)?yc[s]=!0:(gc[s]=!0,!1)}function Mo(s,i,l){if(_d(i))if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":s.removeAttribute(i);return;case"boolean":var d=i.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){s.removeAttribute(i);return}}s.setAttribute(i,""+l)}}function ar(s,i,l){if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(i);return}s.setAttribute(i,""+l)}}function en(s,i,l,d){if(d===null)s.removeAttribute(l);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(l);return}s.setAttributeNS(i,l,""+d)}}function bn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function vi(s){var i=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function _c(s,i,l){var d=Object.getOwnPropertyDescriptor(s.constructor.prototype,i);if(!s.hasOwnProperty(i)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var y=d.get,b=d.set;return Object.defineProperty(s,i,{configurable:!0,get:function(){return y.call(this)},set:function(R){l=""+R,b.call(this,R)}}),Object.defineProperty(s,i,{enumerable:d.enumerable}),{getValue:function(){return l},setValue:function(R){l=""+R},stopTracking:function(){s._valueTracker=null,delete s[i]}}}}function yt(s){if(!s._valueTracker){var i=vi(s)?"checked":"value";s._valueTracker=_c(s,i,""+s[i])}}function ka(s){if(!s)return!1;var i=s._valueTracker;if(!i)return!0;var l=i.getValue(),d="";return s&&(d=vi(s)?s.checked?"true":"false":s.value),s=d,s!==l?(i.setValue(s),!0):!1}function ps(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Oa=/[\n"\\]/g;function Qn(s){return s.replace(Oa,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function ko(s,i,l,d,y,b,R,V){s.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?s.type=R:s.removeAttribute("type"),i!=null?R==="number"?(i===0&&s.value===""||s.value!=i)&&(s.value=""+bn(i)):s.value!==""+bn(i)&&(s.value=""+bn(i)):R!=="submit"&&R!=="reset"||s.removeAttribute("value"),i!=null?bc(s,R,bn(i)):l!=null?bc(s,R,bn(l)):d!=null&&s.removeAttribute("value"),y==null&&b!=null&&(s.defaultChecked=!!b),y!=null&&(s.checked=y&&typeof y!="function"&&typeof y!="symbol"),V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?s.name=""+bn(V):s.removeAttribute("name")}function bd(s,i,l,d,y,b,R,V){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(s.type=b),i!=null||l!=null){if(!(b!=="submit"&&b!=="reset"||i!=null)){yt(s);return}l=l!=null?""+bn(l):"",i=i!=null?""+bn(i):l,V||i===s.value||(s.value=i),s.defaultValue=i}d=d??y,d=typeof d!="function"&&typeof d!="symbol"&&!!d,s.checked=V?s.checked:!!d,s.defaultChecked=!!d,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(s.name=R),yt(s)}function bc(s,i,l){i==="number"&&ps(s.ownerDocument)===s||s.defaultValue===""+l||(s.defaultValue=""+l)}function xi(s,i,l,d){if(s=s.options,i){i={};for(var y=0;y<l.length;y++)i["$"+l[y]]=!0;for(l=0;l<s.length;l++)y=i.hasOwnProperty("$"+s[l].value),s[l].selected!==y&&(s[l].selected=y),y&&d&&(s[l].defaultSelected=!0)}else{for(l=""+bn(l),i=null,y=0;y<s.length;y++){if(s[y].value===l){s[y].selected=!0,d&&(s[y].defaultSelected=!0);return}i!==null||s[y].disabled||(i=s[y])}i!==null&&(i.selected=!0)}}function vd(s,i,l){if(i!=null&&(i=""+bn(i),i!==s.value&&(s.value=i),l==null)){s.defaultValue!==i&&(s.defaultValue=i);return}s.defaultValue=l!=null?""+bn(l):""}function Si(s,i,l,d){if(i==null){if(d!=null){if(l!=null)throw Error(r(92));if(Y(d)){if(1<d.length)throw Error(r(93));d=d[0]}l=d}l==null&&(l=""),i=l}l=bn(i),s.defaultValue=l,d=s.textContent,d===l&&d!==""&&d!==null&&(s.value=d),yt(s)}function Wn(s,i){if(i){var l=s.firstChild;if(l&&l===s.lastChild&&l.nodeType===3){l.nodeValue=i;return}}s.textContent=i}var xd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function vc(s,i,l){var d=i.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?d?s.setProperty(i,""):i==="float"?s.cssFloat="":s[i]="":d?s.setProperty(i,l):typeof l!="number"||l===0||xd.has(i)?i==="float"?s.cssFloat=l:s[i]=(""+l).trim():s[i]=l+"px"}function xc(s,i,l){if(i!=null&&typeof i!="object")throw Error(r(62));if(s=s.style,l!=null){for(var d in l)!l.hasOwnProperty(d)||i!=null&&i.hasOwnProperty(d)||(d.indexOf("--")===0?s.setProperty(d,""):d==="float"?s.cssFloat="":s[d]="");for(var y in i)d=i[y],i.hasOwnProperty(y)&&l[y]!==d&&vc(s,y,d)}else for(var b in i)i.hasOwnProperty(b)&&vc(s,b,i[b])}function Oo(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),wi=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function No(s){return wi.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Vr(){}var Sc=null;function Sr(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Ei=null,gs=null;function Na(s){var i=xr(s);if(i&&(s=i.stateNode)){var l=s[_n]||null;e:switch(s=i.stateNode,i.type){case"input":if(ko(s,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),i=l.name,l.type==="radio"&&i!=null){for(l=s;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Qn(""+i)+'"][type="radio"]'),i=0;i<l.length;i++){var d=l[i];if(d!==s&&d.form===s.form){var y=d[_n]||null;if(!y)throw Error(r(90));ko(d,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(i=0;i<l.length;i++)d=l[i],d.form===s.form&&ka(d)}break e;case"textarea":vd(s,l.value,l.defaultValue);break e;case"select":i=l.value,i!=null&&xi(s,!!l.multiple,i,!1)}}}var Po=!1;function Ci(s,i,l){if(Po)return s(i,l);Po=!0;try{var d=s(i);return d}finally{if(Po=!1,(Ei!==null||gs!==null)&&(ph(),Ei&&(i=Ei,s=gs,gs=Ei=null,Na(i),s)))for(i=0;i<s.length;i++)Na(s[i])}}function $r(s,i){var l=s.stateNode;if(l===null)return null;var d=l[_n]||null;if(d===null)return null;l=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(s=s.type,d=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!d;break e;default:s=!1}if(s)return null;if(l&&typeof l!="function")throw Error(r(231,i,typeof l));return l}var wr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Pa=!1;if(wr)try{var vt={};Object.defineProperty(vt,"passive",{get:function(){Pa=!0}}),window.addEventListener("test",vt,vt),window.removeEventListener("test",vt,vt)}catch{Pa=!1}var ys=null,wc=null,Ba=null;function Ec(){if(Ba)return Ba;var s,i=wc,l=i.length,d,y="value"in ys?ys.value:ys.textContent,b=y.length;for(s=0;s<l&&i[s]===y[s];s++);var R=l-s;for(d=1;d<=R&&i[l-d]===y[b-d];d++);return Ba=y.slice(s,1<d?1-d:void 0)}function La(s){var i=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&i===13&&(s=13)):s=i,s===10&&(s=13),32<=s||s===13?s:0}function zs(){return!0}function Hr(){return!1}function En(s){function i(l,d,y,b,R){this._reactName=l,this._targetInst=y,this.type=d,this.nativeEvent=b,this.target=R,this.currentTarget=null;for(var V in s)s.hasOwnProperty(V)&&(l=s[V],this[V]=l?l(b):b[V]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?zs:Hr,this.isPropagationStopped=Hr,this}return _(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=zs)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=zs)},persist:function(){},isPersistent:zs}),i}var Fs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_s=En(Fs),Ti=_({},Fs,{view:0,detail:0}),Cc=En(Ti),Ai,Bo,bs,Lo=_({},Ti,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ji,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==bs&&(bs&&s.type==="mousemove"?(Ai=s.screenX-bs.screenX,Bo=s.screenY-bs.screenY):Bo=Ai=0,bs=s),Ai)},movementY:function(s){return"movementY"in s?s.movementY:Bo}}),Tc=En(Lo),Ua=_({},Lo,{dataTransfer:0}),wd=En(Ua),Ed=_({},Ti,{relatedTarget:0}),za=En(Ed),Ac=_({},Fs,{animationName:0,elapsedTime:0,pseudoElement:0}),Cd=En(Ac),Uo=_({},Fs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Td=En(Uo),Ad=_({},Fs,{data:0}),vs=En(Ad),jd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Id={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Dd(s){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(s):(s=Id[s])?!!i[s]:!1}function ji(){return Dd}var Vn=_({},Ti,{key:function(s){if(s.key){var i=jd[s.key]||s.key;if(i!=="Unidentified")return i}return s.type==="keypress"?(s=La(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Rd[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ji,charCode:function(s){return s.type==="keypress"?La(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?La(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Md=En(Vn),kd=_({},Lo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Vs=En(kd),p=_({},Ti,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ji}),w=En(p),k=_({},Fs,{propertyName:0,elapsedTime:0,pseudoElement:0}),$=En(k),oe=_({},Lo,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),he=En(oe),Ee=_({},Fs,{newState:0,oldState:0}),Qe=En(Ee),Gt=[9,13,27,32],mt=wr&&"CompositionEvent"in window,Bt=null;wr&&"documentMode"in document&&(Bt=document.documentMode);var Er=wr&&"TextEvent"in window&&!Bt,xs=wr&&(!mt||Bt&&8<Bt&&11>=Bt),qr=" ",Gr=!1;function Fa(s,i){switch(s){case"keyup":return Gt.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zo(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Fo=!1;function vA(s,i){switch(s){case"compositionend":return zo(i);case"keypress":return i.which!==32?null:(Gr=!0,qr);case"textInput":return s=i.data,s===qr&&Gr?null:s;default:return null}}function xA(s,i){if(Fo)return s==="compositionend"||!mt&&Fa(s,i)?(s=Ec(),Ba=wc=ys=null,Fo=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return xs&&i.locale!=="ko"?null:i.data;default:return null}}var SA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function K0(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i==="input"?!!SA[s.type]:i==="textarea"}function Y0(s,i,l,d){Ei?gs?gs.push(d):gs=[d]:Ei=d,i=Sh(i,"onChange"),0<i.length&&(l=new _s("onChange","change",null,l,d),s.push({event:l,listeners:i}))}var jc=null,Rc=null;function wA(s){Mv(s,0)}function Od(s){var i=ir(s);if(ka(i))return s}function X0(s,i){if(s==="change")return i}var J0=!1;if(wr){var Am;if(wr){var jm="oninput"in document;if(!jm){var Z0=document.createElement("div");Z0.setAttribute("oninput","return;"),jm=typeof Z0.oninput=="function"}Am=jm}else Am=!1;J0=Am&&(!document.documentMode||9<document.documentMode)}function e_(){jc&&(jc.detachEvent("onpropertychange",t_),Rc=jc=null)}function t_(s){if(s.propertyName==="value"&&Od(Rc)){var i=[];Y0(i,Rc,s,Sr(s)),Ci(wA,i)}}function EA(s,i,l){s==="focusin"?(e_(),jc=i,Rc=l,jc.attachEvent("onpropertychange",t_)):s==="focusout"&&e_()}function CA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Od(Rc)}function TA(s,i){if(s==="click")return Od(i)}function AA(s,i){if(s==="input"||s==="change")return Od(i)}function jA(s,i){return s===i&&(s!==0||1/s===1/i)||s!==s&&i!==i}var or=typeof Object.is=="function"?Object.is:jA;function Ic(s,i){if(or(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;var l=Object.keys(s),d=Object.keys(i);if(l.length!==d.length)return!1;for(d=0;d<l.length;d++){var y=l[d];if(!ft.call(i,y)||!or(s[y],i[y]))return!1}return!0}function n_(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function r_(s,i){var l=n_(s);s=0;for(var d;l;){if(l.nodeType===3){if(d=s+l.textContent.length,s<=i&&d>=i)return{node:l,offset:i-s};s=d}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=n_(l)}}function s_(s,i){return s&&i?s===i?!0:s&&s.nodeType===3?!1:i&&i.nodeType===3?s_(s,i.parentNode):"contains"in s?s.contains(i):s.compareDocumentPosition?!!(s.compareDocumentPosition(i)&16):!1:!1}function i_(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var i=ps(s.document);i instanceof s.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)s=i.contentWindow;else break;i=ps(s.document)}return i}function Rm(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i&&(i==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||i==="textarea"||s.contentEditable==="true")}var RA=wr&&"documentMode"in document&&11>=document.documentMode,Vo=null,Im=null,Dc=null,Dm=!1;function a_(s,i,l){var d=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Dm||Vo==null||Vo!==ps(d)||(d=Vo,"selectionStart"in d&&Rm(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Dc&&Ic(Dc,d)||(Dc=d,d=Sh(Im,"onSelect"),0<d.length&&(i=new _s("onSelect","select",null,i,l),s.push({event:i,listeners:d}),i.target=Vo)))}function Va(s,i){var l={};return l[s.toLowerCase()]=i.toLowerCase(),l["Webkit"+s]="webkit"+i,l["Moz"+s]="moz"+i,l}var $o={animationend:Va("Animation","AnimationEnd"),animationiteration:Va("Animation","AnimationIteration"),animationstart:Va("Animation","AnimationStart"),transitionrun:Va("Transition","TransitionRun"),transitionstart:Va("Transition","TransitionStart"),transitioncancel:Va("Transition","TransitionCancel"),transitionend:Va("Transition","TransitionEnd")},Mm={},o_={};wr&&(o_=document.createElement("div").style,"AnimationEvent"in window||(delete $o.animationend.animation,delete $o.animationiteration.animation,delete $o.animationstart.animation),"TransitionEvent"in window||delete $o.transitionend.transition);function $a(s){if(Mm[s])return Mm[s];if(!$o[s])return s;var i=$o[s],l;for(l in i)if(i.hasOwnProperty(l)&&l in o_)return Mm[s]=i[l];return s}var l_=$a("animationend"),c_=$a("animationiteration"),u_=$a("animationstart"),IA=$a("transitionrun"),DA=$a("transitionstart"),MA=$a("transitioncancel"),d_=$a("transitionend"),h_=new Map,km="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");km.push("scrollEnd");function Qr(s,i){h_.set(s,i),fs(i,[s])}var Nd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Cr=[],Ho=0,Om=0;function Pd(){for(var s=Ho,i=Om=Ho=0;i<s;){var l=Cr[i];Cr[i++]=null;var d=Cr[i];Cr[i++]=null;var y=Cr[i];Cr[i++]=null;var b=Cr[i];if(Cr[i++]=null,d!==null&&y!==null){var R=d.pending;R===null?y.next=y:(y.next=R.next,R.next=y),d.pending=y}b!==0&&f_(l,y,b)}}function Bd(s,i,l,d){Cr[Ho++]=s,Cr[Ho++]=i,Cr[Ho++]=l,Cr[Ho++]=d,Om|=d,s.lanes|=d,s=s.alternate,s!==null&&(s.lanes|=d)}function Nm(s,i,l,d){return Bd(s,i,l,d),Ld(s)}function Ha(s,i){return Bd(s,null,null,i),Ld(s)}function f_(s,i,l){s.lanes|=l;var d=s.alternate;d!==null&&(d.lanes|=l);for(var y=!1,b=s.return;b!==null;)b.childLanes|=l,d=b.alternate,d!==null&&(d.childLanes|=l),b.tag===22&&(s=b.stateNode,s===null||s._visibility&1||(y=!0)),s=b,b=b.return;return s.tag===3?(b=s.stateNode,y&&i!==null&&(y=31-qt(l),s=b.hiddenUpdates,d=s[y],d===null?s[y]=[i]:d.push(i),i.lane=l|536870912),b):null}function Ld(s){if(50<Zc)throw Zc=0,Hp=null,Error(r(185));for(var i=s.return;i!==null;)s=i,i=s.return;return s.tag===3?s.stateNode:null}var qo={};function kA(s,i,l,d){this.tag=s,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function lr(s,i,l,d){return new kA(s,i,l,d)}function Pm(s){return s=s.prototype,!(!s||!s.isReactComponent)}function $s(s,i){var l=s.alternate;return l===null?(l=lr(s.tag,i,s.key,s.mode),l.elementType=s.elementType,l.type=s.type,l.stateNode=s.stateNode,l.alternate=s,s.alternate=l):(l.pendingProps=i,l.type=s.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=s.flags&65011712,l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,i=s.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=s.sibling,l.index=s.index,l.ref=s.ref,l.refCleanup=s.refCleanup,l}function m_(s,i){s.flags&=65011714;var l=s.alternate;return l===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,i=l.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),s}function Ud(s,i,l,d,y,b){var R=0;if(d=s,typeof s=="function")Pm(s)&&(R=1);else if(typeof s=="string")R=Lj(s,l,ie.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case N:return s=lr(31,l,i,y),s.elementType=N,s.lanes=b,s;case E:return qa(l.children,y,b,i);case T:R=8,y|=24;break;case I:return s=lr(12,l,i,y|2),s.elementType=I,s.lanes=b,s;case H:return s=lr(13,l,i,y),s.elementType=H,s.lanes=b,s;case W:return s=lr(19,l,i,y),s.elementType=W,s.lanes=b,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case M:R=10;break e;case j:R=9;break e;case Q:R=11;break e;case D:R=14;break e;case A:R=16,d=null;break e}R=29,l=Error(r(130,s===null?"null":typeof s,"")),d=null}return i=lr(R,l,i,y),i.elementType=s,i.type=d,i.lanes=b,i}function qa(s,i,l,d){return s=lr(7,s,d,i),s.lanes=l,s}function Bm(s,i,l){return s=lr(6,s,null,i),s.lanes=l,s}function p_(s){var i=lr(18,null,null,0);return i.stateNode=s,i}function Lm(s,i,l){return i=lr(4,s.children!==null?s.children:[],s.key,i),i.lanes=l,i.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},i}var g_=new WeakMap;function Tr(s,i){if(typeof s=="object"&&s!==null){var l=g_.get(s);return l!==void 0?l:(i={value:s,source:i,stack:Gn(i)},g_.set(s,i),i)}return{value:s,source:i,stack:Gn(i)}}var Go=[],Qo=0,zd=null,Mc=0,Ar=[],jr=0,Ri=null,Ss=1,ws="";function Hs(s,i){Go[Qo++]=Mc,Go[Qo++]=zd,zd=s,Mc=i}function y_(s,i,l){Ar[jr++]=Ss,Ar[jr++]=ws,Ar[jr++]=Ri,Ri=s;var d=Ss;s=ws;var y=32-qt(d)-1;d&=~(1<<y),l+=1;var b=32-qt(i)+y;if(30<b){var R=y-y%5;b=(d&(1<<R)-1).toString(32),d>>=R,y-=R,Ss=1<<32-qt(i)+y|l<<y|d,ws=b+s}else Ss=1<<b|l<<y|d,ws=s}function Um(s){s.return!==null&&(Hs(s,1),y_(s,1,0))}function zm(s){for(;s===zd;)zd=Go[--Qo],Go[Qo]=null,Mc=Go[--Qo],Go[Qo]=null;for(;s===Ri;)Ri=Ar[--jr],Ar[jr]=null,ws=Ar[--jr],Ar[jr]=null,Ss=Ar[--jr],Ar[jr]=null}function __(s,i){Ar[jr++]=Ss,Ar[jr++]=ws,Ar[jr++]=Ri,Ss=i.id,ws=i.overflow,Ri=s}var Cn=null,kt=null,ot=!1,Ii=null,Rr=!1,Fm=Error(r(519));function Di(s){var i=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw kc(Tr(i,s)),Fm}function b_(s){var i=s.stateNode,l=s.type,d=s.memoizedProps;switch(i[Jt]=s,i[_n]=d,l){case"dialog":Je("cancel",i),Je("close",i);break;case"iframe":case"object":case"embed":Je("load",i);break;case"video":case"audio":for(l=0;l<tu.length;l++)Je(tu[l],i);break;case"source":Je("error",i);break;case"img":case"image":case"link":Je("error",i),Je("load",i);break;case"details":Je("toggle",i);break;case"input":Je("invalid",i),bd(i,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":Je("invalid",i);break;case"textarea":Je("invalid",i),Si(i,d.value,d.defaultValue,d.children)}l=d.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||i.textContent===""+l||d.suppressHydrationWarning===!0||Pv(i.textContent,l)?(d.popover!=null&&(Je("beforetoggle",i),Je("toggle",i)),d.onScroll!=null&&Je("scroll",i),d.onScrollEnd!=null&&Je("scrollend",i),d.onClick!=null&&(i.onclick=Vr),i=!0):i=!1,i||Di(s,!0)}function v_(s){for(Cn=s.return;Cn;)switch(Cn.tag){case 5:case 31:case 13:Rr=!1;return;case 27:case 3:Rr=!0;return;default:Cn=Cn.return}}function Wo(s){if(s!==Cn)return!1;if(!ot)return v_(s),ot=!0,!1;var i=s.tag,l;if((l=i!==3&&i!==27)&&((l=i===5)&&(l=s.type,l=!(l!=="form"&&l!=="button")||ig(s.type,s.memoizedProps)),l=!l),l&&kt&&Di(s),v_(s),i===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));kt=qv(s)}else if(i===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));kt=qv(s)}else i===27?(i=kt,qi(s.type)?(s=ug,ug=null,kt=s):kt=i):kt=Cn?Dr(s.stateNode.nextSibling):null;return!0}function Ga(){kt=Cn=null,ot=!1}function Vm(){var s=Ii;return s!==null&&(Jn===null?Jn=s:Jn.push.apply(Jn,s),Ii=null),s}function kc(s){Ii===null?Ii=[s]:Ii.push(s)}var $m=z(null),Qa=null,qs=null;function Mi(s,i,l){te($m,i._currentValue),i._currentValue=l}function Gs(s){s._currentValue=$m.current,q($m)}function Hm(s,i,l){for(;s!==null;){var d=s.alternate;if((s.childLanes&i)!==i?(s.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),s===l)break;s=s.return}}function qm(s,i,l,d){var y=s.child;for(y!==null&&(y.return=s);y!==null;){var b=y.dependencies;if(b!==null){var R=y.child;b=b.firstContext;e:for(;b!==null;){var V=b;b=y;for(var X=0;X<i.length;X++)if(V.context===i[X]){b.lanes|=l,V=b.alternate,V!==null&&(V.lanes|=l),Hm(b.return,l,s),d||(R=null);break e}b=V.next}}else if(y.tag===18){if(R=y.return,R===null)throw Error(r(341));R.lanes|=l,b=R.alternate,b!==null&&(b.lanes|=l),Hm(R,l,s),R=null}else R=y.child;if(R!==null)R.return=y;else for(R=y;R!==null;){if(R===s){R=null;break}if(y=R.sibling,y!==null){y.return=R.return,R=y;break}R=R.return}y=R}}function Ko(s,i,l,d){s=null;for(var y=i,b=!1;y!==null;){if(!b){if((y.flags&524288)!==0)b=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var R=y.alternate;if(R===null)throw Error(r(387));if(R=R.memoizedProps,R!==null){var V=y.type;or(y.pendingProps.value,R.value)||(s!==null?s.push(V):s=[V])}}else if(y===pe.current){if(R=y.alternate,R===null)throw Error(r(387));R.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(s!==null?s.push(au):s=[au])}y=y.return}s!==null&&qm(i,s,l,d),i.flags|=262144}function Fd(s){for(s=s.firstContext;s!==null;){if(!or(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Wa(s){Qa=s,qs=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Tn(s){return x_(Qa,s)}function Vd(s,i){return Qa===null&&Wa(s),x_(s,i)}function x_(s,i){var l=i._currentValue;if(i={context:i,memoizedValue:l,next:null},qs===null){if(s===null)throw Error(r(308));qs=i,s.dependencies={lanes:0,firstContext:i},s.flags|=524288}else qs=qs.next=i;return l}var OA=typeof AbortController<"u"?AbortController:function(){var s=[],i=this.signal={aborted:!1,addEventListener:function(l,d){s.push(d)}};this.abort=function(){i.aborted=!0,s.forEach(function(l){return l()})}},NA=t.unstable_scheduleCallback,PA=t.unstable_NormalPriority,tn={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Gm(){return{controller:new OA,data:new Map,refCount:0}}function Oc(s){s.refCount--,s.refCount===0&&NA(PA,function(){s.controller.abort()})}var Nc=null,Qm=0,Yo=0,Xo=null;function BA(s,i){if(Nc===null){var l=Nc=[];Qm=0,Yo=Yp(),Xo={status:"pending",value:void 0,then:function(d){l.push(d)}}}return Qm++,i.then(S_,S_),i}function S_(){if(--Qm===0&&Nc!==null){Xo!==null&&(Xo.status="fulfilled");var s=Nc;Nc=null,Yo=0,Xo=null;for(var i=0;i<s.length;i++)(0,s[i])()}}function LA(s,i){var l=[],d={status:"pending",value:null,reason:null,then:function(y){l.push(y)}};return s.then(function(){d.status="fulfilled",d.value=i;for(var y=0;y<l.length;y++)(0,l[y])(i)},function(y){for(d.status="rejected",d.reason=y,y=0;y<l.length;y++)(0,l[y])(void 0)}),d}var w_=U.S;U.S=function(s,i){av=dn(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&BA(s,i),w_!==null&&w_(s,i)};var Ka=z(null);function Wm(){var s=Ka.current;return s!==null?s:Ct.pooledCache}function $d(s,i){i===null?te(Ka,Ka.current):te(Ka,i.pool)}function E_(){var s=Wm();return s===null?null:{parent:tn._currentValue,pool:s}}var Jo=Error(r(460)),Km=Error(r(474)),Hd=Error(r(542)),qd={then:function(){}};function C_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function T_(s,i,l){switch(l=s[l],l===void 0?s.push(i):l!==i&&(i.then(Vr,Vr),i=l),i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,j_(s),s;default:if(typeof i.status=="string")i.then(Vr,Vr);else{if(s=Ct,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=i,s.status="pending",s.then(function(d){if(i.status==="pending"){var y=i;y.status="fulfilled",y.value=d}},function(d){if(i.status==="pending"){var y=i;y.status="rejected",y.reason=d}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,j_(s),s}throw Xa=i,Jo}}function Ya(s){try{var i=s._init;return i(s._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Xa=l,Jo):l}}var Xa=null;function A_(){if(Xa===null)throw Error(r(459));var s=Xa;return Xa=null,s}function j_(s){if(s===Jo||s===Hd)throw Error(r(483))}var Zo=null,Pc=0;function Gd(s){var i=Pc;return Pc+=1,Zo===null&&(Zo=[]),T_(Zo,s,i)}function Bc(s,i){i=i.props.ref,s.ref=i!==void 0?i:null}function Qd(s,i){throw i.$$typeof===v?Error(r(525)):(s=Object.prototype.toString.call(i),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)))}function R_(s){function i(se,ne){if(s){var ce=se.deletions;ce===null?(se.deletions=[ne],se.flags|=16):ce.push(ne)}}function l(se,ne){if(!s)return null;for(;ne!==null;)i(se,ne),ne=ne.sibling;return null}function d(se){for(var ne=new Map;se!==null;)se.key!==null?ne.set(se.key,se):ne.set(se.index,se),se=se.sibling;return ne}function y(se,ne){return se=$s(se,ne),se.index=0,se.sibling=null,se}function b(se,ne,ce){return se.index=ce,s?(ce=se.alternate,ce!==null?(ce=ce.index,ce<ne?(se.flags|=67108866,ne):ce):(se.flags|=67108866,ne)):(se.flags|=1048576,ne)}function R(se){return s&&se.alternate===null&&(se.flags|=67108866),se}function V(se,ne,ce,ge){return ne===null||ne.tag!==6?(ne=Bm(ce,se.mode,ge),ne.return=se,ne):(ne=y(ne,ce),ne.return=se,ne)}function X(se,ne,ce,ge){var Pe=ce.type;return Pe===E?me(se,ne,ce.props.children,ge,ce.key):ne!==null&&(ne.elementType===Pe||typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===A&&Ya(Pe)===ne.type)?(ne=y(ne,ce.props),Bc(ne,ce),ne.return=se,ne):(ne=Ud(ce.type,ce.key,ce.props,null,se.mode,ge),Bc(ne,ce),ne.return=se,ne)}function ue(se,ne,ce,ge){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==ce.containerInfo||ne.stateNode.implementation!==ce.implementation?(ne=Lm(ce,se.mode,ge),ne.return=se,ne):(ne=y(ne,ce.children||[]),ne.return=se,ne)}function me(se,ne,ce,ge,Pe){return ne===null||ne.tag!==7?(ne=qa(ce,se.mode,ge,Pe),ne.return=se,ne):(ne=y(ne,ce),ne.return=se,ne)}function _e(se,ne,ce){if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return ne=Bm(""+ne,se.mode,ce),ne.return=se,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case x:return ce=Ud(ne.type,ne.key,ne.props,null,se.mode,ce),Bc(ce,ne),ce.return=se,ce;case S:return ne=Lm(ne,se.mode,ce),ne.return=se,ne;case A:return ne=Ya(ne),_e(se,ne,ce)}if(Y(ne)||B(ne))return ne=qa(ne,se.mode,ce,null),ne.return=se,ne;if(typeof ne.then=="function")return _e(se,Gd(ne),ce);if(ne.$$typeof===M)return _e(se,Vd(se,ne),ce);Qd(se,ne)}return null}function de(se,ne,ce,ge){var Pe=ne!==null?ne.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return Pe!==null?null:V(se,ne,""+ce,ge);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case x:return ce.key===Pe?X(se,ne,ce,ge):null;case S:return ce.key===Pe?ue(se,ne,ce,ge):null;case A:return ce=Ya(ce),de(se,ne,ce,ge)}if(Y(ce)||B(ce))return Pe!==null?null:me(se,ne,ce,ge,null);if(typeof ce.then=="function")return de(se,ne,Gd(ce),ge);if(ce.$$typeof===M)return de(se,ne,Vd(se,ce),ge);Qd(se,ce)}return null}function fe(se,ne,ce,ge,Pe){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return se=se.get(ce)||null,V(ne,se,""+ge,Pe);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case x:return se=se.get(ge.key===null?ce:ge.key)||null,X(ne,se,ge,Pe);case S:return se=se.get(ge.key===null?ce:ge.key)||null,ue(ne,se,ge,Pe);case A:return ge=Ya(ge),fe(se,ne,ce,ge,Pe)}if(Y(ge)||B(ge))return se=se.get(ce)||null,me(ne,se,ge,Pe,null);if(typeof ge.then=="function")return fe(se,ne,ce,Gd(ge),Pe);if(ge.$$typeof===M)return fe(se,ne,ce,Vd(ne,ge),Pe);Qd(ne,ge)}return null}function De(se,ne,ce,ge){for(var Pe=null,dt=null,ke=ne,Ye=ne=0,nt=null;ke!==null&&Ye<ce.length;Ye++){ke.index>Ye?(nt=ke,ke=null):nt=ke.sibling;var ht=de(se,ke,ce[Ye],ge);if(ht===null){ke===null&&(ke=nt);break}s&&ke&&ht.alternate===null&&i(se,ke),ne=b(ht,ne,Ye),dt===null?Pe=ht:dt.sibling=ht,dt=ht,ke=nt}if(Ye===ce.length)return l(se,ke),ot&&Hs(se,Ye),Pe;if(ke===null){for(;Ye<ce.length;Ye++)ke=_e(se,ce[Ye],ge),ke!==null&&(ne=b(ke,ne,Ye),dt===null?Pe=ke:dt.sibling=ke,dt=ke);return ot&&Hs(se,Ye),Pe}for(ke=d(ke);Ye<ce.length;Ye++)nt=fe(ke,se,Ye,ce[Ye],ge),nt!==null&&(s&&nt.alternate!==null&&ke.delete(nt.key===null?Ye:nt.key),ne=b(nt,ne,Ye),dt===null?Pe=nt:dt.sibling=nt,dt=nt);return s&&ke.forEach(function(Yi){return i(se,Yi)}),ot&&Hs(se,Ye),Pe}function ze(se,ne,ce,ge){if(ce==null)throw Error(r(151));for(var Pe=null,dt=null,ke=ne,Ye=ne=0,nt=null,ht=ce.next();ke!==null&&!ht.done;Ye++,ht=ce.next()){ke.index>Ye?(nt=ke,ke=null):nt=ke.sibling;var Yi=de(se,ke,ht.value,ge);if(Yi===null){ke===null&&(ke=nt);break}s&&ke&&Yi.alternate===null&&i(se,ke),ne=b(Yi,ne,Ye),dt===null?Pe=Yi:dt.sibling=Yi,dt=Yi,ke=nt}if(ht.done)return l(se,ke),ot&&Hs(se,Ye),Pe;if(ke===null){for(;!ht.done;Ye++,ht=ce.next())ht=_e(se,ht.value,ge),ht!==null&&(ne=b(ht,ne,Ye),dt===null?Pe=ht:dt.sibling=ht,dt=ht);return ot&&Hs(se,Ye),Pe}for(ke=d(ke);!ht.done;Ye++,ht=ce.next())ht=fe(ke,se,Ye,ht.value,ge),ht!==null&&(s&&ht.alternate!==null&&ke.delete(ht.key===null?Ye:ht.key),ne=b(ht,ne,Ye),dt===null?Pe=ht:dt.sibling=ht,dt=ht);return s&&ke.forEach(function(Kj){return i(se,Kj)}),ot&&Hs(se,Ye),Pe}function wt(se,ne,ce,ge){if(typeof ce=="object"&&ce!==null&&ce.type===E&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case x:e:{for(var Pe=ce.key;ne!==null;){if(ne.key===Pe){if(Pe=ce.type,Pe===E){if(ne.tag===7){l(se,ne.sibling),ge=y(ne,ce.props.children),ge.return=se,se=ge;break e}}else if(ne.elementType===Pe||typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===A&&Ya(Pe)===ne.type){l(se,ne.sibling),ge=y(ne,ce.props),Bc(ge,ce),ge.return=se,se=ge;break e}l(se,ne);break}else i(se,ne);ne=ne.sibling}ce.type===E?(ge=qa(ce.props.children,se.mode,ge,ce.key),ge.return=se,se=ge):(ge=Ud(ce.type,ce.key,ce.props,null,se.mode,ge),Bc(ge,ce),ge.return=se,se=ge)}return R(se);case S:e:{for(Pe=ce.key;ne!==null;){if(ne.key===Pe)if(ne.tag===4&&ne.stateNode.containerInfo===ce.containerInfo&&ne.stateNode.implementation===ce.implementation){l(se,ne.sibling),ge=y(ne,ce.children||[]),ge.return=se,se=ge;break e}else{l(se,ne);break}else i(se,ne);ne=ne.sibling}ge=Lm(ce,se.mode,ge),ge.return=se,se=ge}return R(se);case A:return ce=Ya(ce),wt(se,ne,ce,ge)}if(Y(ce))return De(se,ne,ce,ge);if(B(ce)){if(Pe=B(ce),typeof Pe!="function")throw Error(r(150));return ce=Pe.call(ce),ze(se,ne,ce,ge)}if(typeof ce.then=="function")return wt(se,ne,Gd(ce),ge);if(ce.$$typeof===M)return wt(se,ne,Vd(se,ce),ge);Qd(se,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint"?(ce=""+ce,ne!==null&&ne.tag===6?(l(se,ne.sibling),ge=y(ne,ce),ge.return=se,se=ge):(l(se,ne),ge=Bm(ce,se.mode,ge),ge.return=se,se=ge),R(se)):l(se,ne)}return function(se,ne,ce,ge){try{Pc=0;var Pe=wt(se,ne,ce,ge);return Zo=null,Pe}catch(ke){if(ke===Jo||ke===Hd)throw ke;var dt=lr(29,ke,null,se.mode);return dt.lanes=ge,dt.return=se,dt}}}var Ja=R_(!0),I_=R_(!1),ki=!1;function Ym(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Xm(s,i){s=s.updateQueue,i.updateQueue===s&&(i.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Oi(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Ni(s,i,l){var d=s.updateQueue;if(d===null)return null;if(d=d.shared,(pt&2)!==0){var y=d.pending;return y===null?i.next=i:(i.next=y.next,y.next=i),d.pending=i,i=Ld(s),f_(s,null,l),i}return Bd(s,d,i,l),Ld(s)}function Lc(s,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194048)!==0)){var d=i.lanes;d&=s.pendingLanes,l|=d,i.lanes=l,dc(s,l)}}function Jm(s,i){var l=s.updateQueue,d=s.alternate;if(d!==null&&(d=d.updateQueue,l===d)){var y=null,b=null;if(l=l.firstBaseUpdate,l!==null){do{var R={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};b===null?y=b=R:b=b.next=R,l=l.next}while(l!==null);b===null?y=b=i:b=b.next=i}else y=b=i;l={baseState:d.baseState,firstBaseUpdate:y,lastBaseUpdate:b,shared:d.shared,callbacks:d.callbacks},s.updateQueue=l;return}s=l.lastBaseUpdate,s===null?l.firstBaseUpdate=i:s.next=i,l.lastBaseUpdate=i}var Zm=!1;function Uc(){if(Zm){var s=Xo;if(s!==null)throw s}}function zc(s,i,l,d){Zm=!1;var y=s.updateQueue;ki=!1;var b=y.firstBaseUpdate,R=y.lastBaseUpdate,V=y.shared.pending;if(V!==null){y.shared.pending=null;var X=V,ue=X.next;X.next=null,R===null?b=ue:R.next=ue,R=X;var me=s.alternate;me!==null&&(me=me.updateQueue,V=me.lastBaseUpdate,V!==R&&(V===null?me.firstBaseUpdate=ue:V.next=ue,me.lastBaseUpdate=X))}if(b!==null){var _e=y.baseState;R=0,me=ue=X=null,V=b;do{var de=V.lane&-536870913,fe=de!==V.lane;if(fe?(tt&de)===de:(d&de)===de){de!==0&&de===Yo&&(Zm=!0),me!==null&&(me=me.next={lane:0,tag:V.tag,payload:V.payload,callback:null,next:null});e:{var De=s,ze=V;de=i;var wt=l;switch(ze.tag){case 1:if(De=ze.payload,typeof De=="function"){_e=De.call(wt,_e,de);break e}_e=De;break e;case 3:De.flags=De.flags&-65537|128;case 0:if(De=ze.payload,de=typeof De=="function"?De.call(wt,_e,de):De,de==null)break e;_e=_({},_e,de);break e;case 2:ki=!0}}de=V.callback,de!==null&&(s.flags|=64,fe&&(s.flags|=8192),fe=y.callbacks,fe===null?y.callbacks=[de]:fe.push(de))}else fe={lane:de,tag:V.tag,payload:V.payload,callback:V.callback,next:null},me===null?(ue=me=fe,X=_e):me=me.next=fe,R|=de;if(V=V.next,V===null){if(V=y.shared.pending,V===null)break;fe=V,V=fe.next,fe.next=null,y.lastBaseUpdate=fe,y.shared.pending=null}}while(!0);me===null&&(X=_e),y.baseState=X,y.firstBaseUpdate=ue,y.lastBaseUpdate=me,b===null&&(y.shared.lanes=0),zi|=R,s.lanes=R,s.memoizedState=_e}}function D_(s,i){if(typeof s!="function")throw Error(r(191,s));s.call(i)}function M_(s,i){var l=s.callbacks;if(l!==null)for(s.callbacks=null,s=0;s<l.length;s++)D_(l[s],i)}var el=z(null),Wd=z(0);function k_(s,i){s=ti,te(Wd,s),te(el,i),ti=s|i.baseLanes}function ep(){te(Wd,ti),te(el,el.current)}function tp(){ti=Wd.current,q(el),q(Wd)}var cr=z(null),Ir=null;function Pi(s){var i=s.alternate;te(Qt,Qt.current&1),te(cr,s),Ir===null&&(i===null||el.current!==null||i.memoizedState!==null)&&(Ir=s)}function np(s){te(Qt,Qt.current),te(cr,s),Ir===null&&(Ir=s)}function O_(s){s.tag===22?(te(Qt,Qt.current),te(cr,s),Ir===null&&(Ir=s)):Bi()}function Bi(){te(Qt,Qt.current),te(cr,cr.current)}function ur(s){q(cr),Ir===s&&(Ir=null),q(Qt)}var Qt=z(0);function Kd(s){for(var i=s;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||lg(l)||cg(l)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Qs=0,We=null,xt=null,nn=null,Yd=!1,tl=!1,Za=!1,Xd=0,Fc=0,nl=null,UA=0;function $t(){throw Error(r(321))}function rp(s,i){if(i===null)return!1;for(var l=0;l<i.length&&l<s.length;l++)if(!or(s[l],i[l]))return!1;return!0}function sp(s,i,l,d,y,b){return Qs=b,We=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,U.H=s===null||s.memoizedState===null?yb:bp,Za=!1,b=l(d,y),Za=!1,tl&&(b=P_(i,l,d,y)),N_(s),b}function N_(s){U.H=Hc;var i=xt!==null&&xt.next!==null;if(Qs=0,nn=xt=We=null,Yd=!1,Fc=0,nl=null,i)throw Error(r(300));s===null||rn||(s=s.dependencies,s!==null&&Fd(s)&&(rn=!0))}function P_(s,i,l,d){We=s;var y=0;do{if(tl&&(nl=null),Fc=0,tl=!1,25<=y)throw Error(r(301));if(y+=1,nn=xt=null,s.updateQueue!=null){var b=s.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}U.H=_b,b=i(l,d)}while(tl);return b}function zA(){var s=U.H,i=s.useState()[0];return i=typeof i.then=="function"?Vc(i):i,s=s.useState()[0],(xt!==null?xt.memoizedState:null)!==s&&(We.flags|=1024),i}function ip(){var s=Xd!==0;return Xd=0,s}function ap(s,i,l){i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~l}function op(s){if(Yd){for(s=s.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}Yd=!1}Qs=0,nn=xt=We=null,tl=!1,Fc=Xd=0,nl=null}function $n(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nn===null?We.memoizedState=nn=s:nn=nn.next=s,nn}function Wt(){if(xt===null){var s=We.alternate;s=s!==null?s.memoizedState:null}else s=xt.next;var i=nn===null?We.memoizedState:nn.next;if(i!==null)nn=i,xt=s;else{if(s===null)throw We.alternate===null?Error(r(467)):Error(r(310));xt=s,s={memoizedState:xt.memoizedState,baseState:xt.baseState,baseQueue:xt.baseQueue,queue:xt.queue,next:null},nn===null?We.memoizedState=nn=s:nn=nn.next=s}return nn}function Jd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Vc(s){var i=Fc;return Fc+=1,nl===null&&(nl=[]),s=T_(nl,s,i),i=We,(nn===null?i.memoizedState:nn.next)===null&&(i=i.alternate,U.H=i===null||i.memoizedState===null?yb:bp),s}function Zd(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Vc(s);if(s.$$typeof===M)return Tn(s)}throw Error(r(438,String(s)))}function lp(s){var i=null,l=We.updateQueue;if(l!==null&&(i=l.memoCache),i==null){var d=We.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(i={data:d.data.map(function(y){return y.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),l===null&&(l=Jd(),We.updateQueue=l),l.memoCache=i,l=i.data[i.index],l===void 0)for(l=i.data[i.index]=Array(s),d=0;d<s;d++)l[d]=P;return i.index++,l}function Ws(s,i){return typeof i=="function"?i(s):i}function eh(s){var i=Wt();return cp(i,xt,s)}function cp(s,i,l){var d=s.queue;if(d===null)throw Error(r(311));d.lastRenderedReducer=l;var y=s.baseQueue,b=d.pending;if(b!==null){if(y!==null){var R=y.next;y.next=b.next,b.next=R}i.baseQueue=y=b,d.pending=null}if(b=s.baseState,y===null)s.memoizedState=b;else{i=y.next;var V=R=null,X=null,ue=i,me=!1;do{var _e=ue.lane&-536870913;if(_e!==ue.lane?(tt&_e)===_e:(Qs&_e)===_e){var de=ue.revertLane;if(de===0)X!==null&&(X=X.next={lane:0,revertLane:0,gesture:null,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),_e===Yo&&(me=!0);else if((Qs&de)===de){ue=ue.next,de===Yo&&(me=!0);continue}else _e={lane:0,revertLane:ue.revertLane,gesture:null,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},X===null?(V=X=_e,R=b):X=X.next=_e,We.lanes|=de,zi|=de;_e=ue.action,Za&&l(b,_e),b=ue.hasEagerState?ue.eagerState:l(b,_e)}else de={lane:_e,revertLane:ue.revertLane,gesture:ue.gesture,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},X===null?(V=X=de,R=b):X=X.next=de,We.lanes|=_e,zi|=_e;ue=ue.next}while(ue!==null&&ue!==i);if(X===null?R=b:X.next=V,!or(b,s.memoizedState)&&(rn=!0,me&&(l=Xo,l!==null)))throw l;s.memoizedState=b,s.baseState=R,s.baseQueue=X,d.lastRenderedState=b}return y===null&&(d.lanes=0),[s.memoizedState,d.dispatch]}function up(s){var i=Wt(),l=i.queue;if(l===null)throw Error(r(311));l.lastRenderedReducer=s;var d=l.dispatch,y=l.pending,b=i.memoizedState;if(y!==null){l.pending=null;var R=y=y.next;do b=s(b,R.action),R=R.next;while(R!==y);or(b,i.memoizedState)||(rn=!0),i.memoizedState=b,i.baseQueue===null&&(i.baseState=b),l.lastRenderedState=b}return[b,d]}function B_(s,i,l){var d=We,y=Wt(),b=ot;if(b){if(l===void 0)throw Error(r(407));l=l()}else l=i();var R=!or((xt||y).memoizedState,l);if(R&&(y.memoizedState=l,rn=!0),y=y.queue,fp(z_.bind(null,d,y,s),[s]),y.getSnapshot!==i||R||nn!==null&&nn.memoizedState.tag&1){if(d.flags|=2048,rl(9,{destroy:void 0},U_.bind(null,d,y,l,i),null),Ct===null)throw Error(r(349));b||(Qs&127)!==0||L_(d,i,l)}return l}function L_(s,i,l){s.flags|=16384,s={getSnapshot:i,value:l},i=We.updateQueue,i===null?(i=Jd(),We.updateQueue=i,i.stores=[s]):(l=i.stores,l===null?i.stores=[s]:l.push(s))}function U_(s,i,l,d){i.value=l,i.getSnapshot=d,F_(i)&&V_(s)}function z_(s,i,l){return l(function(){F_(i)&&V_(s)})}function F_(s){var i=s.getSnapshot;s=s.value;try{var l=i();return!or(s,l)}catch{return!0}}function V_(s){var i=Ha(s,2);i!==null&&Zn(i,s,2)}function dp(s){var i=$n();if(typeof s=="function"){var l=s;if(s=l(),Za){vr(!0);try{l()}finally{vr(!1)}}}return i.memoizedState=i.baseState=s,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ws,lastRenderedState:s},i}function $_(s,i,l,d){return s.baseState=l,cp(s,xt,typeof d=="function"?d:Ws)}function FA(s,i,l,d,y){if(rh(s))throw Error(r(485));if(s=i.action,s!==null){var b={payload:y,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){b.listeners.push(R)}};U.T!==null?l(!0):b.isTransition=!1,d(b),l=i.pending,l===null?(b.next=i.pending=b,H_(i,b)):(b.next=l.next,i.pending=l.next=b)}}function H_(s,i){var l=i.action,d=i.payload,y=s.state;if(i.isTransition){var b=U.T,R={};U.T=R;try{var V=l(y,d),X=U.S;X!==null&&X(R,V),q_(s,i,V)}catch(ue){hp(s,i,ue)}finally{b!==null&&R.types!==null&&(b.types=R.types),U.T=b}}else try{b=l(y,d),q_(s,i,b)}catch(ue){hp(s,i,ue)}}function q_(s,i,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(d){G_(s,i,d)},function(d){return hp(s,i,d)}):G_(s,i,l)}function G_(s,i,l){i.status="fulfilled",i.value=l,Q_(i),s.state=l,i=s.pending,i!==null&&(l=i.next,l===i?s.pending=null:(l=l.next,i.next=l,H_(s,l)))}function hp(s,i,l){var d=s.pending;if(s.pending=null,d!==null){d=d.next;do i.status="rejected",i.reason=l,Q_(i),i=i.next;while(i!==d)}s.action=null}function Q_(s){s=s.listeners;for(var i=0;i<s.length;i++)(0,s[i])()}function W_(s,i){return i}function K_(s,i){if(ot){var l=Ct.formState;if(l!==null){e:{var d=We;if(ot){if(kt){t:{for(var y=kt,b=Rr;y.nodeType!==8;){if(!b){y=null;break t}if(y=Dr(y.nextSibling),y===null){y=null;break t}}b=y.data,y=b==="F!"||b==="F"?y:null}if(y){kt=Dr(y.nextSibling),d=y.data==="F!";break e}}Di(d)}d=!1}d&&(i=l[0])}}return l=$n(),l.memoizedState=l.baseState=i,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:W_,lastRenderedState:i},l.queue=d,l=mb.bind(null,We,d),d.dispatch=l,d=dp(!1),b=_p.bind(null,We,!1,d.queue),d=$n(),y={state:i,dispatch:null,action:s,pending:null},d.queue=y,l=FA.bind(null,We,y,b,l),y.dispatch=l,d.memoizedState=s,[i,l,!1]}function Y_(s){var i=Wt();return X_(i,xt,s)}function X_(s,i,l){if(i=cp(s,i,W_)[0],s=eh(Ws)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var d=Vc(i)}catch(R){throw R===Jo?Hd:R}else d=i;i=Wt();var y=i.queue,b=y.dispatch;return l!==i.memoizedState&&(We.flags|=2048,rl(9,{destroy:void 0},VA.bind(null,y,l),null)),[d,b,s]}function VA(s,i){s.action=i}function J_(s){var i=Wt(),l=xt;if(l!==null)return X_(i,l,s);Wt(),i=i.memoizedState,l=Wt();var d=l.queue.dispatch;return l.memoizedState=s,[i,d,!1]}function rl(s,i,l,d){return s={tag:s,create:l,deps:d,inst:i,next:null},i=We.updateQueue,i===null&&(i=Jd(),We.updateQueue=i),l=i.lastEffect,l===null?i.lastEffect=s.next=s:(d=l.next,l.next=s,s.next=d,i.lastEffect=s),s}function Z_(){return Wt().memoizedState}function th(s,i,l,d){var y=$n();We.flags|=s,y.memoizedState=rl(1|i,{destroy:void 0},l,d===void 0?null:d)}function nh(s,i,l,d){var y=Wt();d=d===void 0?null:d;var b=y.memoizedState.inst;xt!==null&&d!==null&&rp(d,xt.memoizedState.deps)?y.memoizedState=rl(i,b,l,d):(We.flags|=s,y.memoizedState=rl(1|i,b,l,d))}function eb(s,i){th(8390656,8,s,i)}function fp(s,i){nh(2048,8,s,i)}function $A(s){We.flags|=4;var i=We.updateQueue;if(i===null)i=Jd(),We.updateQueue=i,i.events=[s];else{var l=i.events;l===null?i.events=[s]:l.push(s)}}function tb(s){var i=Wt().memoizedState;return $A({ref:i,nextImpl:s}),function(){if((pt&2)!==0)throw Error(r(440));return i.impl.apply(void 0,arguments)}}function nb(s,i){return nh(4,2,s,i)}function rb(s,i){return nh(4,4,s,i)}function sb(s,i){if(typeof i=="function"){s=s();var l=i(s);return function(){typeof l=="function"?l():i(null)}}if(i!=null)return s=s(),i.current=s,function(){i.current=null}}function ib(s,i,l){l=l!=null?l.concat([s]):null,nh(4,4,sb.bind(null,i,s),l)}function mp(){}function ab(s,i){var l=Wt();i=i===void 0?null:i;var d=l.memoizedState;return i!==null&&rp(i,d[1])?d[0]:(l.memoizedState=[s,i],s)}function ob(s,i){var l=Wt();i=i===void 0?null:i;var d=l.memoizedState;if(i!==null&&rp(i,d[1]))return d[0];if(d=s(),Za){vr(!0);try{s()}finally{vr(!1)}}return l.memoizedState=[d,i],d}function pp(s,i,l){return l===void 0||(Qs&1073741824)!==0&&(tt&261930)===0?s.memoizedState=i:(s.memoizedState=l,s=lv(),We.lanes|=s,zi|=s,l)}function lb(s,i,l,d){return or(l,i)?l:el.current!==null?(s=pp(s,l,d),or(s,i)||(rn=!0),s):(Qs&42)===0||(Qs&1073741824)!==0&&(tt&261930)===0?(rn=!0,s.memoizedState=l):(s=lv(),We.lanes|=s,zi|=s,i)}function cb(s,i,l,d,y){var b=F.p;F.p=b!==0&&8>b?b:8;var R=U.T,V={};U.T=V,_p(s,!1,i,l);try{var X=y(),ue=U.S;if(ue!==null&&ue(V,X),X!==null&&typeof X=="object"&&typeof X.then=="function"){var me=LA(X,d);$c(s,i,me,fr(s))}else $c(s,i,d,fr(s))}catch(_e){$c(s,i,{then:function(){},status:"rejected",reason:_e},fr())}finally{F.p=b,R!==null&&V.types!==null&&(R.types=V.types),U.T=R}}function HA(){}function gp(s,i,l,d){if(s.tag!==5)throw Error(r(476));var y=ub(s).queue;cb(s,y,i,K,l===null?HA:function(){return db(s),l(d)})}function ub(s){var i=s.memoizedState;if(i!==null)return i;i={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ws,lastRenderedState:K},next:null};var l={};return i.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ws,lastRenderedState:l},next:null},s.memoizedState=i,s=s.alternate,s!==null&&(s.memoizedState=i),i}function db(s){var i=ub(s);i.next===null&&(i=s.alternate.memoizedState),$c(s,i.next.queue,{},fr())}function yp(){return Tn(au)}function hb(){return Wt().memoizedState}function fb(){return Wt().memoizedState}function qA(s){for(var i=s.return;i!==null;){switch(i.tag){case 24:case 3:var l=fr();s=Oi(l);var d=Ni(i,s,l);d!==null&&(Zn(d,i,l),Lc(d,i,l)),i={cache:Gm()},s.payload=i;return}i=i.return}}function GA(s,i,l){var d=fr();l={lane:d,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},rh(s)?pb(i,l):(l=Nm(s,i,l,d),l!==null&&(Zn(l,s,d),gb(l,i,d)))}function mb(s,i,l){var d=fr();$c(s,i,l,d)}function $c(s,i,l,d){var y={lane:d,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(rh(s))pb(i,y);else{var b=s.alternate;if(s.lanes===0&&(b===null||b.lanes===0)&&(b=i.lastRenderedReducer,b!==null))try{var R=i.lastRenderedState,V=b(R,l);if(y.hasEagerState=!0,y.eagerState=V,or(V,R))return Bd(s,i,y,0),Ct===null&&Pd(),!1}catch{}if(l=Nm(s,i,y,d),l!==null)return Zn(l,s,d),gb(l,i,d),!0}return!1}function _p(s,i,l,d){if(d={lane:2,revertLane:Yp(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},rh(s)){if(i)throw Error(r(479))}else i=Nm(s,l,d,2),i!==null&&Zn(i,s,2)}function rh(s){var i=s.alternate;return s===We||i!==null&&i===We}function pb(s,i){tl=Yd=!0;var l=s.pending;l===null?i.next=i:(i.next=l.next,l.next=i),s.pending=i}function gb(s,i,l){if((l&4194048)!==0){var d=i.lanes;d&=s.pendingLanes,l|=d,i.lanes=l,dc(s,l)}}var Hc={readContext:Tn,use:Zd,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useLayoutEffect:$t,useInsertionEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useSyncExternalStore:$t,useId:$t,useHostTransitionStatus:$t,useFormState:$t,useActionState:$t,useOptimistic:$t,useMemoCache:$t,useCacheRefresh:$t};Hc.useEffectEvent=$t;var yb={readContext:Tn,use:Zd,useCallback:function(s,i){return $n().memoizedState=[s,i===void 0?null:i],s},useContext:Tn,useEffect:eb,useImperativeHandle:function(s,i,l){l=l!=null?l.concat([s]):null,th(4194308,4,sb.bind(null,i,s),l)},useLayoutEffect:function(s,i){return th(4194308,4,s,i)},useInsertionEffect:function(s,i){th(4,2,s,i)},useMemo:function(s,i){var l=$n();i=i===void 0?null:i;var d=s();if(Za){vr(!0);try{s()}finally{vr(!1)}}return l.memoizedState=[d,i],d},useReducer:function(s,i,l){var d=$n();if(l!==void 0){var y=l(i);if(Za){vr(!0);try{l(i)}finally{vr(!1)}}}else y=i;return d.memoizedState=d.baseState=y,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:y},d.queue=s,s=s.dispatch=GA.bind(null,We,s),[d.memoizedState,s]},useRef:function(s){var i=$n();return s={current:s},i.memoizedState=s},useState:function(s){s=dp(s);var i=s.queue,l=mb.bind(null,We,i);return i.dispatch=l,[s.memoizedState,l]},useDebugValue:mp,useDeferredValue:function(s,i){var l=$n();return pp(l,s,i)},useTransition:function(){var s=dp(!1);return s=cb.bind(null,We,s.queue,!0,!1),$n().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,i,l){var d=We,y=$n();if(ot){if(l===void 0)throw Error(r(407));l=l()}else{if(l=i(),Ct===null)throw Error(r(349));(tt&127)!==0||L_(d,i,l)}y.memoizedState=l;var b={value:l,getSnapshot:i};return y.queue=b,eb(z_.bind(null,d,b,s),[s]),d.flags|=2048,rl(9,{destroy:void 0},U_.bind(null,d,b,l,i),null),l},useId:function(){var s=$n(),i=Ct.identifierPrefix;if(ot){var l=ws,d=Ss;l=(d&~(1<<32-qt(d)-1)).toString(32)+l,i="_"+i+"R_"+l,l=Xd++,0<l&&(i+="H"+l.toString(32)),i+="_"}else l=UA++,i="_"+i+"r_"+l.toString(32)+"_";return s.memoizedState=i},useHostTransitionStatus:yp,useFormState:K_,useActionState:K_,useOptimistic:function(s){var i=$n();i.memoizedState=i.baseState=s;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=l,i=_p.bind(null,We,!0,l),l.dispatch=i,[s,i]},useMemoCache:lp,useCacheRefresh:function(){return $n().memoizedState=qA.bind(null,We)},useEffectEvent:function(s){var i=$n(),l={impl:s};return i.memoizedState=l,function(){if((pt&2)!==0)throw Error(r(440));return l.impl.apply(void 0,arguments)}}},bp={readContext:Tn,use:Zd,useCallback:ab,useContext:Tn,useEffect:fp,useImperativeHandle:ib,useInsertionEffect:nb,useLayoutEffect:rb,useMemo:ob,useReducer:eh,useRef:Z_,useState:function(){return eh(Ws)},useDebugValue:mp,useDeferredValue:function(s,i){var l=Wt();return lb(l,xt.memoizedState,s,i)},useTransition:function(){var s=eh(Ws)[0],i=Wt().memoizedState;return[typeof s=="boolean"?s:Vc(s),i]},useSyncExternalStore:B_,useId:hb,useHostTransitionStatus:yp,useFormState:Y_,useActionState:Y_,useOptimistic:function(s,i){var l=Wt();return $_(l,xt,s,i)},useMemoCache:lp,useCacheRefresh:fb};bp.useEffectEvent=tb;var _b={readContext:Tn,use:Zd,useCallback:ab,useContext:Tn,useEffect:fp,useImperativeHandle:ib,useInsertionEffect:nb,useLayoutEffect:rb,useMemo:ob,useReducer:up,useRef:Z_,useState:function(){return up(Ws)},useDebugValue:mp,useDeferredValue:function(s,i){var l=Wt();return xt===null?pp(l,s,i):lb(l,xt.memoizedState,s,i)},useTransition:function(){var s=up(Ws)[0],i=Wt().memoizedState;return[typeof s=="boolean"?s:Vc(s),i]},useSyncExternalStore:B_,useId:hb,useHostTransitionStatus:yp,useFormState:J_,useActionState:J_,useOptimistic:function(s,i){var l=Wt();return xt!==null?$_(l,xt,s,i):(l.baseState=s,[s,l.queue.dispatch])},useMemoCache:lp,useCacheRefresh:fb};_b.useEffectEvent=tb;function vp(s,i,l,d){i=s.memoizedState,l=l(d,i),l=l==null?i:_({},i,l),s.memoizedState=l,s.lanes===0&&(s.updateQueue.baseState=l)}var xp={enqueueSetState:function(s,i,l){s=s._reactInternals;var d=fr(),y=Oi(d);y.payload=i,l!=null&&(y.callback=l),i=Ni(s,y,d),i!==null&&(Zn(i,s,d),Lc(i,s,d))},enqueueReplaceState:function(s,i,l){s=s._reactInternals;var d=fr(),y=Oi(d);y.tag=1,y.payload=i,l!=null&&(y.callback=l),i=Ni(s,y,d),i!==null&&(Zn(i,s,d),Lc(i,s,d))},enqueueForceUpdate:function(s,i){s=s._reactInternals;var l=fr(),d=Oi(l);d.tag=2,i!=null&&(d.callback=i),i=Ni(s,d,l),i!==null&&(Zn(i,s,l),Lc(i,s,l))}};function bb(s,i,l,d,y,b,R){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(d,b,R):i.prototype&&i.prototype.isPureReactComponent?!Ic(l,d)||!Ic(y,b):!0}function vb(s,i,l,d){s=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,d),i.state!==s&&xp.enqueueReplaceState(i,i.state,null)}function eo(s,i){var l=i;if("ref"in i){l={};for(var d in i)d!=="ref"&&(l[d]=i[d])}if(s=s.defaultProps){l===i&&(l=_({},l));for(var y in s)l[y]===void 0&&(l[y]=s[y])}return l}function xb(s){Nd(s)}function Sb(s){console.error(s)}function wb(s){Nd(s)}function sh(s,i){try{var l=s.onUncaughtError;l(i.value,{componentStack:i.stack})}catch(d){setTimeout(function(){throw d})}}function Eb(s,i,l){try{var d=s.onCaughtError;d(l.value,{componentStack:l.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function Sp(s,i,l){return l=Oi(l),l.tag=3,l.payload={element:null},l.callback=function(){sh(s,i)},l}function Cb(s){return s=Oi(s),s.tag=3,s}function Tb(s,i,l,d){var y=l.type.getDerivedStateFromError;if(typeof y=="function"){var b=d.value;s.payload=function(){return y(b)},s.callback=function(){Eb(i,l,d)}}var R=l.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(s.callback=function(){Eb(i,l,d),typeof y!="function"&&(Fi===null?Fi=new Set([this]):Fi.add(this));var V=d.stack;this.componentDidCatch(d.value,{componentStack:V!==null?V:""})})}function QA(s,i,l,d,y){if(l.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(i=l.alternate,i!==null&&Ko(i,l,y,!0),l=cr.current,l!==null){switch(l.tag){case 31:case 13:return Ir===null?gh():l.alternate===null&&Ht===0&&(Ht=3),l.flags&=-257,l.flags|=65536,l.lanes=y,d===qd?l.flags|=16384:(i=l.updateQueue,i===null?l.updateQueue=new Set([d]):i.add(d),Qp(s,d,y)),!1;case 22:return l.flags|=65536,d===qd?l.flags|=16384:(i=l.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([d])},l.updateQueue=i):(l=i.retryQueue,l===null?i.retryQueue=new Set([d]):l.add(d)),Qp(s,d,y)),!1}throw Error(r(435,l.tag))}return Qp(s,d,y),gh(),!1}if(ot)return i=cr.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=y,d!==Fm&&(s=Error(r(422),{cause:d}),kc(Tr(s,l)))):(d!==Fm&&(i=Error(r(423),{cause:d}),kc(Tr(i,l))),s=s.current.alternate,s.flags|=65536,y&=-y,s.lanes|=y,d=Tr(d,l),y=Sp(s.stateNode,d,y),Jm(s,y),Ht!==4&&(Ht=2)),!1;var b=Error(r(520),{cause:d});if(b=Tr(b,l),Jc===null?Jc=[b]:Jc.push(b),Ht!==4&&(Ht=2),i===null)return!0;d=Tr(d,l),l=i;do{switch(l.tag){case 3:return l.flags|=65536,s=y&-y,l.lanes|=s,s=Sp(l.stateNode,d,s),Jm(l,s),!1;case 1:if(i=l.type,b=l.stateNode,(l.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Fi===null||!Fi.has(b))))return l.flags|=65536,y&=-y,l.lanes|=y,y=Cb(y),Tb(y,s,l,d),Jm(l,y),!1}l=l.return}while(l!==null);return!1}var wp=Error(r(461)),rn=!1;function An(s,i,l,d){i.child=s===null?I_(i,null,l,d):Ja(i,s.child,l,d)}function Ab(s,i,l,d,y){l=l.render;var b=i.ref;if("ref"in d){var R={};for(var V in d)V!=="ref"&&(R[V]=d[V])}else R=d;return Wa(i),d=sp(s,i,l,R,b,y),V=ip(),s!==null&&!rn?(ap(s,i,y),Ks(s,i,y)):(ot&&V&&Um(i),i.flags|=1,An(s,i,d,y),i.child)}function jb(s,i,l,d,y){if(s===null){var b=l.type;return typeof b=="function"&&!Pm(b)&&b.defaultProps===void 0&&l.compare===null?(i.tag=15,i.type=b,Rb(s,i,b,d,y)):(s=Ud(l.type,null,d,i,i.mode,y),s.ref=i.ref,s.return=i,i.child=s)}if(b=s.child,!Dp(s,y)){var R=b.memoizedProps;if(l=l.compare,l=l!==null?l:Ic,l(R,d)&&s.ref===i.ref)return Ks(s,i,y)}return i.flags|=1,s=$s(b,d),s.ref=i.ref,s.return=i,i.child=s}function Rb(s,i,l,d,y){if(s!==null){var b=s.memoizedProps;if(Ic(b,d)&&s.ref===i.ref)if(rn=!1,i.pendingProps=d=b,Dp(s,y))(s.flags&131072)!==0&&(rn=!0);else return i.lanes=s.lanes,Ks(s,i,y)}return Ep(s,i,l,d,y)}function Ib(s,i,l,d){var y=d.children,b=s!==null?s.memoizedState:null;if(s===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((i.flags&128)!==0){if(b=b!==null?b.baseLanes|l:l,s!==null){for(d=i.child=s.child,y=0;d!==null;)y=y|d.lanes|d.childLanes,d=d.sibling;d=y&~b}else d=0,i.child=null;return Db(s,i,b,l,d)}if((l&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},s!==null&&$d(i,b!==null?b.cachePool:null),b!==null?k_(i,b):ep(),O_(i);else return d=i.lanes=536870912,Db(s,i,b!==null?b.baseLanes|l:l,l,d)}else b!==null?($d(i,b.cachePool),k_(i,b),Bi(),i.memoizedState=null):(s!==null&&$d(i,null),ep(),Bi());return An(s,i,y,l),i.child}function qc(s,i){return s!==null&&s.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function Db(s,i,l,d,y){var b=Wm();return b=b===null?null:{parent:tn._currentValue,pool:b},i.memoizedState={baseLanes:l,cachePool:b},s!==null&&$d(i,null),ep(),O_(i),s!==null&&Ko(s,i,d,!0),i.childLanes=y,null}function ih(s,i){return i=oh({mode:i.mode,children:i.children},s.mode),i.ref=s.ref,s.child=i,i.return=s,i}function Mb(s,i,l){return Ja(i,s.child,null,l),s=ih(i,i.pendingProps),s.flags|=2,ur(i),i.memoizedState=null,s}function WA(s,i,l){var d=i.pendingProps,y=(i.flags&128)!==0;if(i.flags&=-129,s===null){if(ot){if(d.mode==="hidden")return s=ih(i,d),i.lanes=536870912,qc(null,s);if(np(i),(s=kt)?(s=Hv(s,Rr),s=s!==null&&s.data==="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:Ri!==null?{id:Ss,overflow:ws}:null,retryLane:536870912,hydrationErrors:null},l=p_(s),l.return=i,i.child=l,Cn=i,kt=null)):s=null,s===null)throw Di(i);return i.lanes=536870912,null}return ih(i,d)}var b=s.memoizedState;if(b!==null){var R=b.dehydrated;if(np(i),y)if(i.flags&256)i.flags&=-257,i=Mb(s,i,l);else if(i.memoizedState!==null)i.child=s.child,i.flags|=128,i=null;else throw Error(r(558));else if(rn||Ko(s,i,l,!1),y=(l&s.childLanes)!==0,rn||y){if(d=Ct,d!==null&&(R=hc(d,l),R!==0&&R!==b.retryLane))throw b.retryLane=R,Ha(s,R),Zn(d,s,R),wp;gh(),i=Mb(s,i,l)}else s=b.treeContext,kt=Dr(R.nextSibling),Cn=i,ot=!0,Ii=null,Rr=!1,s!==null&&__(i,s),i=ih(i,d),i.flags|=4096;return i}return s=$s(s.child,{mode:d.mode,children:d.children}),s.ref=i.ref,i.child=s,s.return=i,s}function ah(s,i){var l=i.ref;if(l===null)s!==null&&s.ref!==null&&(i.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(r(284));(s===null||s.ref!==l)&&(i.flags|=4194816)}}function Ep(s,i,l,d,y){return Wa(i),l=sp(s,i,l,d,void 0,y),d=ip(),s!==null&&!rn?(ap(s,i,y),Ks(s,i,y)):(ot&&d&&Um(i),i.flags|=1,An(s,i,l,y),i.child)}function kb(s,i,l,d,y,b){return Wa(i),i.updateQueue=null,l=P_(i,d,l,y),N_(s),d=ip(),s!==null&&!rn?(ap(s,i,b),Ks(s,i,b)):(ot&&d&&Um(i),i.flags|=1,An(s,i,l,b),i.child)}function Ob(s,i,l,d,y){if(Wa(i),i.stateNode===null){var b=qo,R=l.contextType;typeof R=="object"&&R!==null&&(b=Tn(R)),b=new l(d,b),i.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=xp,i.stateNode=b,b._reactInternals=i,b=i.stateNode,b.props=d,b.state=i.memoizedState,b.refs={},Ym(i),R=l.contextType,b.context=typeof R=="object"&&R!==null?Tn(R):qo,b.state=i.memoizedState,R=l.getDerivedStateFromProps,typeof R=="function"&&(vp(i,l,R,d),b.state=i.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(R=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),R!==b.state&&xp.enqueueReplaceState(b,b.state,null),zc(i,d,b,y),Uc(),b.state=i.memoizedState),typeof b.componentDidMount=="function"&&(i.flags|=4194308),d=!0}else if(s===null){b=i.stateNode;var V=i.memoizedProps,X=eo(l,V);b.props=X;var ue=b.context,me=l.contextType;R=qo,typeof me=="object"&&me!==null&&(R=Tn(me));var _e=l.getDerivedStateFromProps;me=typeof _e=="function"||typeof b.getSnapshotBeforeUpdate=="function",V=i.pendingProps!==V,me||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(V||ue!==R)&&vb(i,b,d,R),ki=!1;var de=i.memoizedState;b.state=de,zc(i,d,b,y),Uc(),ue=i.memoizedState,V||de!==ue||ki?(typeof _e=="function"&&(vp(i,l,_e,d),ue=i.memoizedState),(X=ki||bb(i,l,X,d,de,ue,R))?(me||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(i.flags|=4194308)):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=ue),b.props=d,b.state=ue,b.context=R,d=X):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{b=i.stateNode,Xm(s,i),R=i.memoizedProps,me=eo(l,R),b.props=me,_e=i.pendingProps,de=b.context,ue=l.contextType,X=qo,typeof ue=="object"&&ue!==null&&(X=Tn(ue)),V=l.getDerivedStateFromProps,(ue=typeof V=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(R!==_e||de!==X)&&vb(i,b,d,X),ki=!1,de=i.memoizedState,b.state=de,zc(i,d,b,y),Uc();var fe=i.memoizedState;R!==_e||de!==fe||ki||s!==null&&s.dependencies!==null&&Fd(s.dependencies)?(typeof V=="function"&&(vp(i,l,V,d),fe=i.memoizedState),(me=ki||bb(i,l,me,d,de,fe,X)||s!==null&&s.dependencies!==null&&Fd(s.dependencies))?(ue||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(d,fe,X),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(d,fe,X)),typeof b.componentDidUpdate=="function"&&(i.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof b.componentDidUpdate!="function"||R===s.memoizedProps&&de===s.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||R===s.memoizedProps&&de===s.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=fe),b.props=d,b.state=fe,b.context=X,d=me):(typeof b.componentDidUpdate!="function"||R===s.memoizedProps&&de===s.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||R===s.memoizedProps&&de===s.memoizedState||(i.flags|=1024),d=!1)}return b=d,ah(s,i),d=(i.flags&128)!==0,b||d?(b=i.stateNode,l=d&&typeof l.getDerivedStateFromError!="function"?null:b.render(),i.flags|=1,s!==null&&d?(i.child=Ja(i,s.child,null,y),i.child=Ja(i,null,l,y)):An(s,i,l,y),i.memoizedState=b.state,s=i.child):s=Ks(s,i,y),s}function Nb(s,i,l,d){return Ga(),i.flags|=256,An(s,i,l,d),i.child}var Cp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Tp(s){return{baseLanes:s,cachePool:E_()}}function Ap(s,i,l){return s=s!==null?s.childLanes&~l:0,i&&(s|=hr),s}function Pb(s,i,l){var d=i.pendingProps,y=!1,b=(i.flags&128)!==0,R;if((R=b)||(R=s!==null&&s.memoizedState===null?!1:(Qt.current&2)!==0),R&&(y=!0,i.flags&=-129),R=(i.flags&32)!==0,i.flags&=-33,s===null){if(ot){if(y?Pi(i):Bi(),(s=kt)?(s=Hv(s,Rr),s=s!==null&&s.data!=="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:Ri!==null?{id:Ss,overflow:ws}:null,retryLane:536870912,hydrationErrors:null},l=p_(s),l.return=i,i.child=l,Cn=i,kt=null)):s=null,s===null)throw Di(i);return cg(s)?i.lanes=32:i.lanes=536870912,null}var V=d.children;return d=d.fallback,y?(Bi(),y=i.mode,V=oh({mode:"hidden",children:V},y),d=qa(d,y,l,null),V.return=i,d.return=i,V.sibling=d,i.child=V,d=i.child,d.memoizedState=Tp(l),d.childLanes=Ap(s,R,l),i.memoizedState=Cp,qc(null,d)):(Pi(i),jp(i,V))}var X=s.memoizedState;if(X!==null&&(V=X.dehydrated,V!==null)){if(b)i.flags&256?(Pi(i),i.flags&=-257,i=Rp(s,i,l)):i.memoizedState!==null?(Bi(),i.child=s.child,i.flags|=128,i=null):(Bi(),V=d.fallback,y=i.mode,d=oh({mode:"visible",children:d.children},y),V=qa(V,y,l,null),V.flags|=2,d.return=i,V.return=i,d.sibling=V,i.child=d,Ja(i,s.child,null,l),d=i.child,d.memoizedState=Tp(l),d.childLanes=Ap(s,R,l),i.memoizedState=Cp,i=qc(null,d));else if(Pi(i),cg(V)){if(R=V.nextSibling&&V.nextSibling.dataset,R)var ue=R.dgst;R=ue,d=Error(r(419)),d.stack="",d.digest=R,kc({value:d,source:null,stack:null}),i=Rp(s,i,l)}else if(rn||Ko(s,i,l,!1),R=(l&s.childLanes)!==0,rn||R){if(R=Ct,R!==null&&(d=hc(R,l),d!==0&&d!==X.retryLane))throw X.retryLane=d,Ha(s,d),Zn(R,s,d),wp;lg(V)||gh(),i=Rp(s,i,l)}else lg(V)?(i.flags|=192,i.child=s.child,i=null):(s=X.treeContext,kt=Dr(V.nextSibling),Cn=i,ot=!0,Ii=null,Rr=!1,s!==null&&__(i,s),i=jp(i,d.children),i.flags|=4096);return i}return y?(Bi(),V=d.fallback,y=i.mode,X=s.child,ue=X.sibling,d=$s(X,{mode:"hidden",children:d.children}),d.subtreeFlags=X.subtreeFlags&65011712,ue!==null?V=$s(ue,V):(V=qa(V,y,l,null),V.flags|=2),V.return=i,d.return=i,d.sibling=V,i.child=d,qc(null,d),d=i.child,V=s.child.memoizedState,V===null?V=Tp(l):(y=V.cachePool,y!==null?(X=tn._currentValue,y=y.parent!==X?{parent:X,pool:X}:y):y=E_(),V={baseLanes:V.baseLanes|l,cachePool:y}),d.memoizedState=V,d.childLanes=Ap(s,R,l),i.memoizedState=Cp,qc(s.child,d)):(Pi(i),l=s.child,s=l.sibling,l=$s(l,{mode:"visible",children:d.children}),l.return=i,l.sibling=null,s!==null&&(R=i.deletions,R===null?(i.deletions=[s],i.flags|=16):R.push(s)),i.child=l,i.memoizedState=null,l)}function jp(s,i){return i=oh({mode:"visible",children:i},s.mode),i.return=s,s.child=i}function oh(s,i){return s=lr(22,s,null,i),s.lanes=0,s}function Rp(s,i,l){return Ja(i,s.child,null,l),s=jp(i,i.pendingProps.children),s.flags|=2,i.memoizedState=null,s}function Bb(s,i,l){s.lanes|=i;var d=s.alternate;d!==null&&(d.lanes|=i),Hm(s.return,i,l)}function Ip(s,i,l,d,y,b){var R=s.memoizedState;R===null?s.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:l,tailMode:y,treeForkCount:b}:(R.isBackwards=i,R.rendering=null,R.renderingStartTime=0,R.last=d,R.tail=l,R.tailMode=y,R.treeForkCount=b)}function Lb(s,i,l){var d=i.pendingProps,y=d.revealOrder,b=d.tail;d=d.children;var R=Qt.current,V=(R&2)!==0;if(V?(R=R&1|2,i.flags|=128):R&=1,te(Qt,R),An(s,i,d,l),d=ot?Mc:0,!V&&s!==null&&(s.flags&128)!==0)e:for(s=i.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Bb(s,l,i);else if(s.tag===19)Bb(s,l,i);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(y){case"forwards":for(l=i.child,y=null;l!==null;)s=l.alternate,s!==null&&Kd(s)===null&&(y=l),l=l.sibling;l=y,l===null?(y=i.child,i.child=null):(y=l.sibling,l.sibling=null),Ip(i,!1,y,l,b,d);break;case"backwards":case"unstable_legacy-backwards":for(l=null,y=i.child,i.child=null;y!==null;){if(s=y.alternate,s!==null&&Kd(s)===null){i.child=y;break}s=y.sibling,y.sibling=l,l=y,y=s}Ip(i,!0,l,null,b,d);break;case"together":Ip(i,!1,null,null,void 0,d);break;default:i.memoizedState=null}return i.child}function Ks(s,i,l){if(s!==null&&(i.dependencies=s.dependencies),zi|=i.lanes,(l&i.childLanes)===0)if(s!==null){if(Ko(s,i,l,!1),(l&i.childLanes)===0)return null}else return null;if(s!==null&&i.child!==s.child)throw Error(r(153));if(i.child!==null){for(s=i.child,l=$s(s,s.pendingProps),i.child=l,l.return=i;s.sibling!==null;)s=s.sibling,l=l.sibling=$s(s,s.pendingProps),l.return=i;l.sibling=null}return i.child}function Dp(s,i){return(s.lanes&i)!==0?!0:(s=s.dependencies,!!(s!==null&&Fd(s)))}function KA(s,i,l){switch(i.tag){case 3:xe(i,i.stateNode.containerInfo),Mi(i,tn,s.memoizedState.cache),Ga();break;case 27:case 5:J(i);break;case 4:xe(i,i.stateNode.containerInfo);break;case 10:Mi(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,np(i),null;break;case 13:var d=i.memoizedState;if(d!==null)return d.dehydrated!==null?(Pi(i),i.flags|=128,null):(l&i.child.childLanes)!==0?Pb(s,i,l):(Pi(i),s=Ks(s,i,l),s!==null?s.sibling:null);Pi(i);break;case 19:var y=(s.flags&128)!==0;if(d=(l&i.childLanes)!==0,d||(Ko(s,i,l,!1),d=(l&i.childLanes)!==0),y){if(d)return Lb(s,i,l);i.flags|=128}if(y=i.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),te(Qt,Qt.current),d)break;return null;case 22:return i.lanes=0,Ib(s,i,l,i.pendingProps);case 24:Mi(i,tn,s.memoizedState.cache)}return Ks(s,i,l)}function Ub(s,i,l){if(s!==null)if(s.memoizedProps!==i.pendingProps)rn=!0;else{if(!Dp(s,l)&&(i.flags&128)===0)return rn=!1,KA(s,i,l);rn=(s.flags&131072)!==0}else rn=!1,ot&&(i.flags&1048576)!==0&&y_(i,Mc,i.index);switch(i.lanes=0,i.tag){case 16:e:{var d=i.pendingProps;if(s=Ya(i.elementType),i.type=s,typeof s=="function")Pm(s)?(d=eo(s,d),i.tag=1,i=Ob(null,i,s,d,l)):(i.tag=0,i=Ep(null,i,s,d,l));else{if(s!=null){var y=s.$$typeof;if(y===Q){i.tag=11,i=Ab(null,i,s,d,l);break e}else if(y===D){i.tag=14,i=jb(null,i,s,d,l);break e}}throw i=G(s)||s,Error(r(306,i,""))}}return i;case 0:return Ep(s,i,i.type,i.pendingProps,l);case 1:return d=i.type,y=eo(d,i.pendingProps),Ob(s,i,d,y,l);case 3:e:{if(xe(i,i.stateNode.containerInfo),s===null)throw Error(r(387));d=i.pendingProps;var b=i.memoizedState;y=b.element,Xm(s,i),zc(i,d,null,l);var R=i.memoizedState;if(d=R.cache,Mi(i,tn,d),d!==b.cache&&qm(i,[tn],l,!0),Uc(),d=R.element,b.isDehydrated)if(b={element:d,isDehydrated:!1,cache:R.cache},i.updateQueue.baseState=b,i.memoizedState=b,i.flags&256){i=Nb(s,i,d,l);break e}else if(d!==y){y=Tr(Error(r(424)),i),kc(y),i=Nb(s,i,d,l);break e}else for(s=i.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,kt=Dr(s.firstChild),Cn=i,ot=!0,Ii=null,Rr=!0,l=I_(i,null,d,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Ga(),d===y){i=Ks(s,i,l);break e}An(s,i,d,l)}i=i.child}return i;case 26:return ah(s,i),s===null?(l=Yv(i.type,null,i.pendingProps,null))?i.memoizedState=l:ot||(l=i.type,s=i.pendingProps,d=wh(le.current).createElement(l),d[Jt]=i,d[_n]=s,jn(d,l,s),Zt(d),i.stateNode=d):i.memoizedState=Yv(i.type,s.memoizedProps,i.pendingProps,s.memoizedState),null;case 27:return J(i),s===null&&ot&&(d=i.stateNode=Qv(i.type,i.pendingProps,le.current),Cn=i,Rr=!0,y=kt,qi(i.type)?(ug=y,kt=Dr(d.firstChild)):kt=y),An(s,i,i.pendingProps.children,l),ah(s,i),s===null&&(i.flags|=4194304),i.child;case 5:return s===null&&ot&&((y=d=kt)&&(d=Cj(d,i.type,i.pendingProps,Rr),d!==null?(i.stateNode=d,Cn=i,kt=Dr(d.firstChild),Rr=!1,y=!0):y=!1),y||Di(i)),J(i),y=i.type,b=i.pendingProps,R=s!==null?s.memoizedProps:null,d=b.children,ig(y,b)?d=null:R!==null&&ig(y,R)&&(i.flags|=32),i.memoizedState!==null&&(y=sp(s,i,zA,null,null,l),au._currentValue=y),ah(s,i),An(s,i,d,l),i.child;case 6:return s===null&&ot&&((s=l=kt)&&(l=Tj(l,i.pendingProps,Rr),l!==null?(i.stateNode=l,Cn=i,kt=null,s=!0):s=!1),s||Di(i)),null;case 13:return Pb(s,i,l);case 4:return xe(i,i.stateNode.containerInfo),d=i.pendingProps,s===null?i.child=Ja(i,null,d,l):An(s,i,d,l),i.child;case 11:return Ab(s,i,i.type,i.pendingProps,l);case 7:return An(s,i,i.pendingProps,l),i.child;case 8:return An(s,i,i.pendingProps.children,l),i.child;case 12:return An(s,i,i.pendingProps.children,l),i.child;case 10:return d=i.pendingProps,Mi(i,i.type,d.value),An(s,i,d.children,l),i.child;case 9:return y=i.type._context,d=i.pendingProps.children,Wa(i),y=Tn(y),d=d(y),i.flags|=1,An(s,i,d,l),i.child;case 14:return jb(s,i,i.type,i.pendingProps,l);case 15:return Rb(s,i,i.type,i.pendingProps,l);case 19:return Lb(s,i,l);case 31:return WA(s,i,l);case 22:return Ib(s,i,l,i.pendingProps);case 24:return Wa(i),d=Tn(tn),s===null?(y=Wm(),y===null&&(y=Ct,b=Gm(),y.pooledCache=b,b.refCount++,b!==null&&(y.pooledCacheLanes|=l),y=b),i.memoizedState={parent:d,cache:y},Ym(i),Mi(i,tn,y)):((s.lanes&l)!==0&&(Xm(s,i),zc(i,null,null,l),Uc()),y=s.memoizedState,b=i.memoizedState,y.parent!==d?(y={parent:d,cache:d},i.memoizedState=y,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=y),Mi(i,tn,d)):(d=b.cache,Mi(i,tn,d),d!==y.cache&&qm(i,[tn],l,!0))),An(s,i,i.pendingProps.children,l),i.child;case 29:throw i.pendingProps}throw Error(r(156,i.tag))}function Ys(s){s.flags|=4}function Mp(s,i,l,d,y){if((i=(s.mode&32)!==0)&&(i=!1),i){if(s.flags|=16777216,(y&335544128)===y)if(s.stateNode.complete)s.flags|=8192;else if(hv())s.flags|=8192;else throw Xa=qd,Km}else s.flags&=-16777217}function zb(s,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!tx(i))if(hv())s.flags|=8192;else throw Xa=qd,Km}function lh(s,i){i!==null&&(s.flags|=4),s.flags&16384&&(i=s.tag!==22?md():536870912,s.lanes|=i,ol|=i)}function Gc(s,i){if(!ot)switch(s.tailMode){case"hidden":i=s.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?s.tail=null:l.sibling=null;break;case"collapsed":l=s.tail;for(var d=null;l!==null;)l.alternate!==null&&(d=l),l=l.sibling;d===null?i||s.tail===null?s.tail=null:s.tail.sibling=null:d.sibling=null}}function Ot(s){var i=s.alternate!==null&&s.alternate.child===s.child,l=0,d=0;if(i)for(var y=s.child;y!==null;)l|=y.lanes|y.childLanes,d|=y.subtreeFlags&65011712,d|=y.flags&65011712,y.return=s,y=y.sibling;else for(y=s.child;y!==null;)l|=y.lanes|y.childLanes,d|=y.subtreeFlags,d|=y.flags,y.return=s,y=y.sibling;return s.subtreeFlags|=d,s.childLanes=l,i}function YA(s,i,l){var d=i.pendingProps;switch(zm(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ot(i),null;case 1:return Ot(i),null;case 3:return l=i.stateNode,d=null,s!==null&&(d=s.memoizedState.cache),i.memoizedState.cache!==d&&(i.flags|=2048),Gs(tn),ve(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(Wo(i)?Ys(i):s===null||s.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,Vm())),Ot(i),null;case 26:var y=i.type,b=i.memoizedState;return s===null?(Ys(i),b!==null?(Ot(i),zb(i,b)):(Ot(i),Mp(i,y,null,d,l))):b?b!==s.memoizedState?(Ys(i),Ot(i),zb(i,b)):(Ot(i),i.flags&=-16777217):(s=s.memoizedProps,s!==d&&Ys(i),Ot(i),Mp(i,y,s,d,l)),null;case 27:if(Se(i),l=le.current,y=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==d&&Ys(i);else{if(!d){if(i.stateNode===null)throw Error(r(166));return Ot(i),null}s=ie.current,Wo(i)?b_(i):(s=Qv(y,d,l),i.stateNode=s,Ys(i))}return Ot(i),null;case 5:if(Se(i),y=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==d&&Ys(i);else{if(!d){if(i.stateNode===null)throw Error(r(166));return Ot(i),null}if(b=ie.current,Wo(i))b_(i);else{var R=wh(le.current);switch(b){case 1:b=R.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:b=R.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":b=R.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":b=R.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":b=R.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof d.is=="string"?R.createElement("select",{is:d.is}):R.createElement("select"),d.multiple?b.multiple=!0:d.size&&(b.size=d.size);break;default:b=typeof d.is=="string"?R.createElement(y,{is:d.is}):R.createElement(y)}}b[Jt]=i,b[_n]=d;e:for(R=i.child;R!==null;){if(R.tag===5||R.tag===6)b.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===i)break e;for(;R.sibling===null;){if(R.return===null||R.return===i)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}i.stateNode=b;e:switch(jn(b,y,d),y){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&Ys(i)}}return Ot(i),Mp(i,i.type,s===null?null:s.memoizedProps,i.pendingProps,l),null;case 6:if(s&&i.stateNode!=null)s.memoizedProps!==d&&Ys(i);else{if(typeof d!="string"&&i.stateNode===null)throw Error(r(166));if(s=le.current,Wo(i)){if(s=i.stateNode,l=i.memoizedProps,d=null,y=Cn,y!==null)switch(y.tag){case 27:case 5:d=y.memoizedProps}s[Jt]=i,s=!!(s.nodeValue===l||d!==null&&d.suppressHydrationWarning===!0||Pv(s.nodeValue,l)),s||Di(i,!0)}else s=wh(s).createTextNode(d),s[Jt]=i,i.stateNode=s}return Ot(i),null;case 31:if(l=i.memoizedState,s===null||s.memoizedState!==null){if(d=Wo(i),l!==null){if(s===null){if(!d)throw Error(r(318));if(s=i.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[Jt]=i}else Ga(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Ot(i),s=!1}else l=Vm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=l),s=!0;if(!s)return i.flags&256?(ur(i),i):(ur(i),null);if((i.flags&128)!==0)throw Error(r(558))}return Ot(i),null;case 13:if(d=i.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(y=Wo(i),d!==null&&d.dehydrated!==null){if(s===null){if(!y)throw Error(r(318));if(y=i.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(r(317));y[Jt]=i}else Ga(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Ot(i),y=!1}else y=Vm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=y),y=!0;if(!y)return i.flags&256?(ur(i),i):(ur(i),null)}return ur(i),(i.flags&128)!==0?(i.lanes=l,i):(l=d!==null,s=s!==null&&s.memoizedState!==null,l&&(d=i.child,y=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(y=d.alternate.memoizedState.cachePool.pool),b=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(b=d.memoizedState.cachePool.pool),b!==y&&(d.flags|=2048)),l!==s&&l&&(i.child.flags|=8192),lh(i,i.updateQueue),Ot(i),null);case 4:return ve(),s===null&&eg(i.stateNode.containerInfo),Ot(i),null;case 10:return Gs(i.type),Ot(i),null;case 19:if(q(Qt),d=i.memoizedState,d===null)return Ot(i),null;if(y=(i.flags&128)!==0,b=d.rendering,b===null)if(y)Gc(d,!1);else{if(Ht!==0||s!==null&&(s.flags&128)!==0)for(s=i.child;s!==null;){if(b=Kd(s),b!==null){for(i.flags|=128,Gc(d,!1),s=b.updateQueue,i.updateQueue=s,lh(i,s),i.subtreeFlags=0,s=l,l=i.child;l!==null;)m_(l,s),l=l.sibling;return te(Qt,Qt.current&1|2),ot&&Hs(i,d.treeForkCount),i.child}s=s.sibling}d.tail!==null&&dn()>fh&&(i.flags|=128,y=!0,Gc(d,!1),i.lanes=4194304)}else{if(!y)if(s=Kd(b),s!==null){if(i.flags|=128,y=!0,s=s.updateQueue,i.updateQueue=s,lh(i,s),Gc(d,!0),d.tail===null&&d.tailMode==="hidden"&&!b.alternate&&!ot)return Ot(i),null}else 2*dn()-d.renderingStartTime>fh&&l!==536870912&&(i.flags|=128,y=!0,Gc(d,!1),i.lanes=4194304);d.isBackwards?(b.sibling=i.child,i.child=b):(s=d.last,s!==null?s.sibling=b:i.child=b,d.last=b)}return d.tail!==null?(s=d.tail,d.rendering=s,d.tail=s.sibling,d.renderingStartTime=dn(),s.sibling=null,l=Qt.current,te(Qt,y?l&1|2:l&1),ot&&Hs(i,d.treeForkCount),s):(Ot(i),null);case 22:case 23:return ur(i),tp(),d=i.memoizedState!==null,s!==null?s.memoizedState!==null!==d&&(i.flags|=8192):d&&(i.flags|=8192),d?(l&536870912)!==0&&(i.flags&128)===0&&(Ot(i),i.subtreeFlags&6&&(i.flags|=8192)):Ot(i),l=i.updateQueue,l!==null&&lh(i,l.retryQueue),l=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),d=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(d=i.memoizedState.cachePool.pool),d!==l&&(i.flags|=2048),s!==null&&q(Ka),null;case 24:return l=null,s!==null&&(l=s.memoizedState.cache),i.memoizedState.cache!==l&&(i.flags|=2048),Gs(tn),Ot(i),null;case 25:return null;case 30:return null}throw Error(r(156,i.tag))}function XA(s,i){switch(zm(i),i.tag){case 1:return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 3:return Gs(tn),ve(),s=i.flags,(s&65536)!==0&&(s&128)===0?(i.flags=s&-65537|128,i):null;case 26:case 27:case 5:return Se(i),null;case 31:if(i.memoizedState!==null){if(ur(i),i.alternate===null)throw Error(r(340));Ga()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 13:if(ur(i),s=i.memoizedState,s!==null&&s.dehydrated!==null){if(i.alternate===null)throw Error(r(340));Ga()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 19:return q(Qt),null;case 4:return ve(),null;case 10:return Gs(i.type),null;case 22:case 23:return ur(i),tp(),s!==null&&q(Ka),s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 24:return Gs(tn),null;case 25:return null;default:return null}}function Fb(s,i){switch(zm(i),i.tag){case 3:Gs(tn),ve();break;case 26:case 27:case 5:Se(i);break;case 4:ve();break;case 31:i.memoizedState!==null&&ur(i);break;case 13:ur(i);break;case 19:q(Qt);break;case 10:Gs(i.type);break;case 22:case 23:ur(i),tp(),s!==null&&q(Ka);break;case 24:Gs(tn)}}function Qc(s,i){try{var l=i.updateQueue,d=l!==null?l.lastEffect:null;if(d!==null){var y=d.next;l=y;do{if((l.tag&s)===s){d=void 0;var b=l.create,R=l.inst;d=b(),R.destroy=d}l=l.next}while(l!==y)}}catch(V){bt(i,i.return,V)}}function Li(s,i,l){try{var d=i.updateQueue,y=d!==null?d.lastEffect:null;if(y!==null){var b=y.next;d=b;do{if((d.tag&s)===s){var R=d.inst,V=R.destroy;if(V!==void 0){R.destroy=void 0,y=i;var X=l,ue=V;try{ue()}catch(me){bt(y,X,me)}}}d=d.next}while(d!==b)}}catch(me){bt(i,i.return,me)}}function Vb(s){var i=s.updateQueue;if(i!==null){var l=s.stateNode;try{M_(i,l)}catch(d){bt(s,s.return,d)}}}function $b(s,i,l){l.props=eo(s.type,s.memoizedProps),l.state=s.memoizedState;try{l.componentWillUnmount()}catch(d){bt(s,i,d)}}function Wc(s,i){try{var l=s.ref;if(l!==null){switch(s.tag){case 26:case 27:case 5:var d=s.stateNode;break;case 30:d=s.stateNode;break;default:d=s.stateNode}typeof l=="function"?s.refCleanup=l(d):l.current=d}}catch(y){bt(s,i,y)}}function Es(s,i){var l=s.ref,d=s.refCleanup;if(l!==null)if(typeof d=="function")try{d()}catch(y){bt(s,i,y)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(y){bt(s,i,y)}else l.current=null}function Hb(s){var i=s.type,l=s.memoizedProps,d=s.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":l.autoFocus&&d.focus();break e;case"img":l.src?d.src=l.src:l.srcSet&&(d.srcset=l.srcSet)}}catch(y){bt(s,s.return,y)}}function kp(s,i,l){try{var d=s.stateNode;bj(d,s.type,l,i),d[_n]=i}catch(y){bt(s,s.return,y)}}function qb(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&qi(s.type)||s.tag===4}function Op(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||qb(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&qi(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Np(s,i,l){var d=s.tag;if(d===5||d===6)s=s.stateNode,i?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(s,i):(i=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,i.appendChild(s),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=Vr));else if(d!==4&&(d===27&&qi(s.type)&&(l=s.stateNode,i=null),s=s.child,s!==null))for(Np(s,i,l),s=s.sibling;s!==null;)Np(s,i,l),s=s.sibling}function ch(s,i,l){var d=s.tag;if(d===5||d===6)s=s.stateNode,i?l.insertBefore(s,i):l.appendChild(s);else if(d!==4&&(d===27&&qi(s.type)&&(l=s.stateNode),s=s.child,s!==null))for(ch(s,i,l),s=s.sibling;s!==null;)ch(s,i,l),s=s.sibling}function Gb(s){var i=s.stateNode,l=s.memoizedProps;try{for(var d=s.type,y=i.attributes;y.length;)i.removeAttributeNode(y[0]);jn(i,d,l),i[Jt]=s,i[_n]=l}catch(b){bt(s,s.return,b)}}var Xs=!1,sn=!1,Pp=!1,Qb=typeof WeakSet=="function"?WeakSet:Set,vn=null;function JA(s,i){if(s=s.containerInfo,rg=Ih,s=i_(s),Rm(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else e:{l=(l=s.ownerDocument)&&l.defaultView||window;var d=l.getSelection&&l.getSelection();if(d&&d.rangeCount!==0){l=d.anchorNode;var y=d.anchorOffset,b=d.focusNode;d=d.focusOffset;try{l.nodeType,b.nodeType}catch{l=null;break e}var R=0,V=-1,X=-1,ue=0,me=0,_e=s,de=null;t:for(;;){for(var fe;_e!==l||y!==0&&_e.nodeType!==3||(V=R+y),_e!==b||d!==0&&_e.nodeType!==3||(X=R+d),_e.nodeType===3&&(R+=_e.nodeValue.length),(fe=_e.firstChild)!==null;)de=_e,_e=fe;for(;;){if(_e===s)break t;if(de===l&&++ue===y&&(V=R),de===b&&++me===d&&(X=R),(fe=_e.nextSibling)!==null)break;_e=de,de=_e.parentNode}_e=fe}l=V===-1||X===-1?null:{start:V,end:X}}else l=null}l=l||{start:0,end:0}}else l=null;for(sg={focusedElem:s,selectionRange:l},Ih=!1,vn=i;vn!==null;)if(i=vn,s=i.child,(i.subtreeFlags&1028)!==0&&s!==null)s.return=i,vn=s;else for(;vn!==null;){switch(i=vn,b=i.alternate,s=i.flags,i.tag){case 0:if((s&4)!==0&&(s=i.updateQueue,s=s!==null?s.events:null,s!==null))for(l=0;l<s.length;l++)y=s[l],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&b!==null){s=void 0,l=i,y=b.memoizedProps,b=b.memoizedState,d=l.stateNode;try{var De=eo(l.type,y);s=d.getSnapshotBeforeUpdate(De,b),d.__reactInternalSnapshotBeforeUpdate=s}catch(ze){bt(l,l.return,ze)}}break;case 3:if((s&1024)!==0){if(s=i.stateNode.containerInfo,l=s.nodeType,l===9)og(s);else if(l===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":og(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=i.sibling,s!==null){s.return=i.return,vn=s;break}vn=i.return}}function Wb(s,i,l){var d=l.flags;switch(l.tag){case 0:case 11:case 15:Zs(s,l),d&4&&Qc(5,l);break;case 1:if(Zs(s,l),d&4)if(s=l.stateNode,i===null)try{s.componentDidMount()}catch(R){bt(l,l.return,R)}else{var y=eo(l.type,i.memoizedProps);i=i.memoizedState;try{s.componentDidUpdate(y,i,s.__reactInternalSnapshotBeforeUpdate)}catch(R){bt(l,l.return,R)}}d&64&&Vb(l),d&512&&Wc(l,l.return);break;case 3:if(Zs(s,l),d&64&&(s=l.updateQueue,s!==null)){if(i=null,l.child!==null)switch(l.child.tag){case 27:case 5:i=l.child.stateNode;break;case 1:i=l.child.stateNode}try{M_(s,i)}catch(R){bt(l,l.return,R)}}break;case 27:i===null&&d&4&&Gb(l);case 26:case 5:Zs(s,l),i===null&&d&4&&Hb(l),d&512&&Wc(l,l.return);break;case 12:Zs(s,l);break;case 31:Zs(s,l),d&4&&Xb(s,l);break;case 13:Zs(s,l),d&4&&Jb(s,l),d&64&&(s=l.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(l=oj.bind(null,l),Aj(s,l))));break;case 22:if(d=l.memoizedState!==null||Xs,!d){i=i!==null&&i.memoizedState!==null||sn,y=Xs;var b=sn;Xs=d,(sn=i)&&!b?ei(s,l,(l.subtreeFlags&8772)!==0):Zs(s,l),Xs=y,sn=b}break;case 30:break;default:Zs(s,l)}}function Kb(s){var i=s.alternate;i!==null&&(s.alternate=null,Kb(i)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(i=s.stateNode,i!==null&&Do(i)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Lt=null,Kn=!1;function Js(s,i,l){for(l=l.child;l!==null;)Yb(s,i,l),l=l.sibling}function Yb(s,i,l){if(wn&&typeof wn.onCommitFiberUnmount=="function")try{wn.onCommitFiberUnmount(Lr,l)}catch{}switch(l.tag){case 26:sn||Es(l,i),Js(s,i,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:sn||Es(l,i);var d=Lt,y=Kn;qi(l.type)&&(Lt=l.stateNode,Kn=!1),Js(s,i,l),ru(l.stateNode),Lt=d,Kn=y;break;case 5:sn||Es(l,i);case 6:if(d=Lt,y=Kn,Lt=null,Js(s,i,l),Lt=d,Kn=y,Lt!==null)if(Kn)try{(Lt.nodeType===9?Lt.body:Lt.nodeName==="HTML"?Lt.ownerDocument.body:Lt).removeChild(l.stateNode)}catch(b){bt(l,i,b)}else try{Lt.removeChild(l.stateNode)}catch(b){bt(l,i,b)}break;case 18:Lt!==null&&(Kn?(s=Lt,Vv(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,l.stateNode),pl(s)):Vv(Lt,l.stateNode));break;case 4:d=Lt,y=Kn,Lt=l.stateNode.containerInfo,Kn=!0,Js(s,i,l),Lt=d,Kn=y;break;case 0:case 11:case 14:case 15:Li(2,l,i),sn||Li(4,l,i),Js(s,i,l);break;case 1:sn||(Es(l,i),d=l.stateNode,typeof d.componentWillUnmount=="function"&&$b(l,i,d)),Js(s,i,l);break;case 21:Js(s,i,l);break;case 22:sn=(d=sn)||l.memoizedState!==null,Js(s,i,l),sn=d;break;default:Js(s,i,l)}}function Xb(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{pl(s)}catch(l){bt(i,i.return,l)}}}function Jb(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{pl(s)}catch(l){bt(i,i.return,l)}}function ZA(s){switch(s.tag){case 31:case 13:case 19:var i=s.stateNode;return i===null&&(i=s.stateNode=new Qb),i;case 22:return s=s.stateNode,i=s._retryCache,i===null&&(i=s._retryCache=new Qb),i;default:throw Error(r(435,s.tag))}}function uh(s,i){var l=ZA(s);i.forEach(function(d){if(!l.has(d)){l.add(d);var y=lj.bind(null,s,d);d.then(y,y)}})}function Yn(s,i){var l=i.deletions;if(l!==null)for(var d=0;d<l.length;d++){var y=l[d],b=s,R=i,V=R;e:for(;V!==null;){switch(V.tag){case 27:if(qi(V.type)){Lt=V.stateNode,Kn=!1;break e}break;case 5:Lt=V.stateNode,Kn=!1;break e;case 3:case 4:Lt=V.stateNode.containerInfo,Kn=!0;break e}V=V.return}if(Lt===null)throw Error(r(160));Yb(b,R,y),Lt=null,Kn=!1,b=y.alternate,b!==null&&(b.return=null),y.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)Zb(i,s),i=i.sibling}var Wr=null;function Zb(s,i){var l=s.alternate,d=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Yn(i,s),Xn(s),d&4&&(Li(3,s,s.return),Qc(3,s),Li(5,s,s.return));break;case 1:Yn(i,s),Xn(s),d&512&&(sn||l===null||Es(l,l.return)),d&64&&Xs&&(s=s.updateQueue,s!==null&&(d=s.callbacks,d!==null&&(l=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=l===null?d:l.concat(d))));break;case 26:var y=Wr;if(Yn(i,s),Xn(s),d&512&&(sn||l===null||Es(l,l.return)),d&4){var b=l!==null?l.memoizedState:null;if(d=s.memoizedState,l===null)if(d===null)if(s.stateNode===null){e:{d=s.type,l=s.memoizedProps,y=y.ownerDocument||y;t:switch(d){case"title":b=y.getElementsByTagName("title")[0],(!b||b[us]||b[Jt]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=y.createElement(d),y.head.insertBefore(b,y.querySelector("head > title"))),jn(b,d,l),b[Jt]=s,Zt(b),d=b;break e;case"link":var R=Zv("link","href",y).get(d+(l.href||""));if(R){for(var V=0;V<R.length;V++)if(b=R[V],b.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&b.getAttribute("rel")===(l.rel==null?null:l.rel)&&b.getAttribute("title")===(l.title==null?null:l.title)&&b.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){R.splice(V,1);break t}}b=y.createElement(d),jn(b,d,l),y.head.appendChild(b);break;case"meta":if(R=Zv("meta","content",y).get(d+(l.content||""))){for(V=0;V<R.length;V++)if(b=R[V],b.getAttribute("content")===(l.content==null?null:""+l.content)&&b.getAttribute("name")===(l.name==null?null:l.name)&&b.getAttribute("property")===(l.property==null?null:l.property)&&b.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&b.getAttribute("charset")===(l.charSet==null?null:l.charSet)){R.splice(V,1);break t}}b=y.createElement(d),jn(b,d,l),y.head.appendChild(b);break;default:throw Error(r(468,d))}b[Jt]=s,Zt(b),d=b}s.stateNode=d}else ex(y,s.type,s.stateNode);else s.stateNode=Jv(y,d,s.memoizedProps);else b!==d?(b===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):b.count--,d===null?ex(y,s.type,s.stateNode):Jv(y,d,s.memoizedProps)):d===null&&s.stateNode!==null&&kp(s,s.memoizedProps,l.memoizedProps)}break;case 27:Yn(i,s),Xn(s),d&512&&(sn||l===null||Es(l,l.return)),l!==null&&d&4&&kp(s,s.memoizedProps,l.memoizedProps);break;case 5:if(Yn(i,s),Xn(s),d&512&&(sn||l===null||Es(l,l.return)),s.flags&32){y=s.stateNode;try{Wn(y,"")}catch(De){bt(s,s.return,De)}}d&4&&s.stateNode!=null&&(y=s.memoizedProps,kp(s,y,l!==null?l.memoizedProps:y)),d&1024&&(Pp=!0);break;case 6:if(Yn(i,s),Xn(s),d&4){if(s.stateNode===null)throw Error(r(162));d=s.memoizedProps,l=s.stateNode;try{l.nodeValue=d}catch(De){bt(s,s.return,De)}}break;case 3:if(Th=null,y=Wr,Wr=Eh(i.containerInfo),Yn(i,s),Wr=y,Xn(s),d&4&&l!==null&&l.memoizedState.isDehydrated)try{pl(i.containerInfo)}catch(De){bt(s,s.return,De)}Pp&&(Pp=!1,ev(s));break;case 4:d=Wr,Wr=Eh(s.stateNode.containerInfo),Yn(i,s),Xn(s),Wr=d;break;case 12:Yn(i,s),Xn(s);break;case 31:Yn(i,s),Xn(s),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,uh(s,d)));break;case 13:Yn(i,s),Xn(s),s.child.flags&8192&&s.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(hh=dn()),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,uh(s,d)));break;case 22:y=s.memoizedState!==null;var X=l!==null&&l.memoizedState!==null,ue=Xs,me=sn;if(Xs=ue||y,sn=me||X,Yn(i,s),sn=me,Xs=ue,Xn(s),d&8192)e:for(i=s.stateNode,i._visibility=y?i._visibility&-2:i._visibility|1,y&&(l===null||X||Xs||sn||to(s)),l=null,i=s;;){if(i.tag===5||i.tag===26){if(l===null){X=l=i;try{if(b=X.stateNode,y)R=b.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{V=X.stateNode;var _e=X.memoizedProps.style,de=_e!=null&&_e.hasOwnProperty("display")?_e.display:null;V.style.display=de==null||typeof de=="boolean"?"":(""+de).trim()}}catch(De){bt(X,X.return,De)}}}else if(i.tag===6){if(l===null){X=i;try{X.stateNode.nodeValue=y?"":X.memoizedProps}catch(De){bt(X,X.return,De)}}}else if(i.tag===18){if(l===null){X=i;try{var fe=X.stateNode;y?$v(fe,!0):$v(X.stateNode,!1)}catch(De){bt(X,X.return,De)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===s)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;l===i&&(l=null),i=i.return}l===i&&(l=null),i.sibling.return=i.return,i=i.sibling}d&4&&(d=s.updateQueue,d!==null&&(l=d.retryQueue,l!==null&&(d.retryQueue=null,uh(s,l))));break;case 19:Yn(i,s),Xn(s),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,uh(s,d)));break;case 30:break;case 21:break;default:Yn(i,s),Xn(s)}}function Xn(s){var i=s.flags;if(i&2){try{for(var l,d=s.return;d!==null;){if(qb(d)){l=d;break}d=d.return}if(l==null)throw Error(r(160));switch(l.tag){case 27:var y=l.stateNode,b=Op(s);ch(s,b,y);break;case 5:var R=l.stateNode;l.flags&32&&(Wn(R,""),l.flags&=-33);var V=Op(s);ch(s,V,R);break;case 3:case 4:var X=l.stateNode.containerInfo,ue=Op(s);Np(s,ue,X);break;default:throw Error(r(161))}}catch(me){bt(s,s.return,me)}s.flags&=-3}i&4096&&(s.flags&=-4097)}function ev(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var i=s;ev(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),s=s.sibling}}function Zs(s,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Wb(s,i.alternate,i),i=i.sibling}function to(s){for(s=s.child;s!==null;){var i=s;switch(i.tag){case 0:case 11:case 14:case 15:Li(4,i,i.return),to(i);break;case 1:Es(i,i.return);var l=i.stateNode;typeof l.componentWillUnmount=="function"&&$b(i,i.return,l),to(i);break;case 27:ru(i.stateNode);case 26:case 5:Es(i,i.return),to(i);break;case 22:i.memoizedState===null&&to(i);break;case 30:to(i);break;default:to(i)}s=s.sibling}}function ei(s,i,l){for(l=l&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var d=i.alternate,y=s,b=i,R=b.flags;switch(b.tag){case 0:case 11:case 15:ei(y,b,l),Qc(4,b);break;case 1:if(ei(y,b,l),d=b,y=d.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(ue){bt(d,d.return,ue)}if(d=b,y=d.updateQueue,y!==null){var V=d.stateNode;try{var X=y.shared.hiddenCallbacks;if(X!==null)for(y.shared.hiddenCallbacks=null,y=0;y<X.length;y++)D_(X[y],V)}catch(ue){bt(d,d.return,ue)}}l&&R&64&&Vb(b),Wc(b,b.return);break;case 27:Gb(b);case 26:case 5:ei(y,b,l),l&&d===null&&R&4&&Hb(b),Wc(b,b.return);break;case 12:ei(y,b,l);break;case 31:ei(y,b,l),l&&R&4&&Xb(y,b);break;case 13:ei(y,b,l),l&&R&4&&Jb(y,b);break;case 22:b.memoizedState===null&&ei(y,b,l),Wc(b,b.return);break;case 30:break;default:ei(y,b,l)}i=i.sibling}}function Bp(s,i){var l=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),s=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==l&&(s!=null&&s.refCount++,l!=null&&Oc(l))}function Lp(s,i){s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&Oc(s))}function Kr(s,i,l,d){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)tv(s,i,l,d),i=i.sibling}function tv(s,i,l,d){var y=i.flags;switch(i.tag){case 0:case 11:case 15:Kr(s,i,l,d),y&2048&&Qc(9,i);break;case 1:Kr(s,i,l,d);break;case 3:Kr(s,i,l,d),y&2048&&(s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&Oc(s)));break;case 12:if(y&2048){Kr(s,i,l,d),s=i.stateNode;try{var b=i.memoizedProps,R=b.id,V=b.onPostCommit;typeof V=="function"&&V(R,i.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(X){bt(i,i.return,X)}}else Kr(s,i,l,d);break;case 31:Kr(s,i,l,d);break;case 13:Kr(s,i,l,d);break;case 23:break;case 22:b=i.stateNode,R=i.alternate,i.memoizedState!==null?b._visibility&2?Kr(s,i,l,d):Kc(s,i):b._visibility&2?Kr(s,i,l,d):(b._visibility|=2,sl(s,i,l,d,(i.subtreeFlags&10256)!==0||!1)),y&2048&&Bp(R,i);break;case 24:Kr(s,i,l,d),y&2048&&Lp(i.alternate,i);break;default:Kr(s,i,l,d)}}function sl(s,i,l,d,y){for(y=y&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var b=s,R=i,V=l,X=d,ue=R.flags;switch(R.tag){case 0:case 11:case 15:sl(b,R,V,X,y),Qc(8,R);break;case 23:break;case 22:var me=R.stateNode;R.memoizedState!==null?me._visibility&2?sl(b,R,V,X,y):Kc(b,R):(me._visibility|=2,sl(b,R,V,X,y)),y&&ue&2048&&Bp(R.alternate,R);break;case 24:sl(b,R,V,X,y),y&&ue&2048&&Lp(R.alternate,R);break;default:sl(b,R,V,X,y)}i=i.sibling}}function Kc(s,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var l=s,d=i,y=d.flags;switch(d.tag){case 22:Kc(l,d),y&2048&&Bp(d.alternate,d);break;case 24:Kc(l,d),y&2048&&Lp(d.alternate,d);break;default:Kc(l,d)}i=i.sibling}}var Yc=8192;function il(s,i,l){if(s.subtreeFlags&Yc)for(s=s.child;s!==null;)nv(s,i,l),s=s.sibling}function nv(s,i,l){switch(s.tag){case 26:il(s,i,l),s.flags&Yc&&s.memoizedState!==null&&Uj(l,Wr,s.memoizedState,s.memoizedProps);break;case 5:il(s,i,l);break;case 3:case 4:var d=Wr;Wr=Eh(s.stateNode.containerInfo),il(s,i,l),Wr=d;break;case 22:s.memoizedState===null&&(d=s.alternate,d!==null&&d.memoizedState!==null?(d=Yc,Yc=16777216,il(s,i,l),Yc=d):il(s,i,l));break;default:il(s,i,l)}}function rv(s){var i=s.alternate;if(i!==null&&(s=i.child,s!==null)){i.child=null;do i=s.sibling,s.sibling=null,s=i;while(s!==null)}}function Xc(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var d=i[l];vn=d,iv(d,s)}rv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)sv(s),s=s.sibling}function sv(s){switch(s.tag){case 0:case 11:case 15:Xc(s),s.flags&2048&&Li(9,s,s.return);break;case 3:Xc(s);break;case 12:Xc(s);break;case 22:var i=s.stateNode;s.memoizedState!==null&&i._visibility&2&&(s.return===null||s.return.tag!==13)?(i._visibility&=-3,dh(s)):Xc(s);break;default:Xc(s)}}function dh(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var d=i[l];vn=d,iv(d,s)}rv(s)}for(s=s.child;s!==null;){switch(i=s,i.tag){case 0:case 11:case 15:Li(8,i,i.return),dh(i);break;case 22:l=i.stateNode,l._visibility&2&&(l._visibility&=-3,dh(i));break;default:dh(i)}s=s.sibling}}function iv(s,i){for(;vn!==null;){var l=vn;switch(l.tag){case 0:case 11:case 15:Li(8,l,i);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var d=l.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Oc(l.memoizedState.cache)}if(d=l.child,d!==null)d.return=l,vn=d;else e:for(l=s;vn!==null;){d=vn;var y=d.sibling,b=d.return;if(Kb(d),d===l){vn=null;break e}if(y!==null){y.return=b,vn=y;break e}vn=b}}}var ej={getCacheForType:function(s){var i=Tn(tn),l=i.data.get(s);return l===void 0&&(l=s(),i.data.set(s,l)),l},cacheSignal:function(){return Tn(tn).controller.signal}},tj=typeof WeakMap=="function"?WeakMap:Map,pt=0,Ct=null,Xe=null,tt=0,_t=0,dr=null,Ui=!1,al=!1,Up=!1,ti=0,Ht=0,zi=0,no=0,zp=0,hr=0,ol=0,Jc=null,Jn=null,Fp=!1,hh=0,av=0,fh=1/0,mh=null,Fi=null,hn=0,Vi=null,ll=null,ni=0,Vp=0,$p=null,ov=null,Zc=0,Hp=null;function fr(){return(pt&2)!==0&&tt!==0?tt&-tt:U.T!==null?Yp():pd()}function lv(){if(hr===0)if((tt&536870912)===0||ot){var s=Ra;Ra<<=1,(Ra&3932160)===0&&(Ra=262144),hr=s}else hr=536870912;return s=cr.current,s!==null&&(s.flags|=32),hr}function Zn(s,i,l){(s===Ct&&(_t===2||_t===9)||s.cancelPendingCommit!==null)&&(cl(s,0),$i(s,tt,hr,!1)),Ia(s,l),((pt&2)===0||s!==Ct)&&(s===Ct&&((pt&2)===0&&(no|=l),Ht===4&&$i(s,tt,hr,!1)),Cs(s))}function cv(s,i,l){if((pt&6)!==0)throw Error(r(327));var d=!l&&(i&127)===0&&(i&s.expiredLanes)===0||Ur(s,i),y=d?sj(s,i):Gp(s,i,!0),b=d;do{if(y===0){al&&!d&&$i(s,i,0,!1);break}else{if(l=s.current.alternate,b&&!nj(l)){y=Gp(s,i,!1),b=!1;continue}if(y===2){if(b=i,s.errorRecoveryDisabledLanes&b)var R=0;else R=s.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){i=R;e:{var V=s;y=Jc;var X=V.current.memoizedState.isDehydrated;if(X&&(cl(V,R).flags|=256),R=Gp(V,R,!1),R!==2){if(Up&&!X){V.errorRecoveryDisabledLanes|=b,no|=b,y=4;break e}b=Jn,Jn=y,b!==null&&(Jn===null?Jn=b:Jn.push.apply(Jn,b))}y=R}if(b=!1,y!==2)continue}}if(y===1){cl(s,0),$i(s,i,0,!0);break}e:{switch(d=s,b=y,b){case 0:case 1:throw Error(r(345));case 4:if((i&4194048)!==i)break;case 6:$i(d,i,hr,!Ui);break e;case 2:Jn=null;break;case 3:case 5:break;default:throw Error(r(329))}if((i&62914560)===i&&(y=hh+300-dn(),10<y)){if($i(d,i,hr,!Ui),os(d,0,!0)!==0)break e;ni=i,d.timeoutHandle=zv(uv.bind(null,d,l,Jn,mh,Fp,i,hr,no,ol,Ui,b,"Throttled",-0,0),y);break e}uv(d,l,Jn,mh,Fp,i,hr,no,ol,Ui,b,null,-0,0)}}break}while(!0);Cs(s)}function uv(s,i,l,d,y,b,R,V,X,ue,me,_e,de,fe){if(s.timeoutHandle=-1,_e=i.subtreeFlags,_e&8192||(_e&16785408)===16785408){_e={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Vr},nv(i,b,_e);var De=(b&62914560)===b?hh-dn():(b&4194048)===b?av-dn():0;if(De=zj(_e,De),De!==null){ni=b,s.cancelPendingCommit=De(_v.bind(null,s,i,b,l,d,y,R,V,X,me,_e,null,de,fe)),$i(s,b,R,!ue);return}}_v(s,i,b,l,d,y,R,V,X)}function nj(s){for(var i=s;;){var l=i.tag;if((l===0||l===11||l===15)&&i.flags&16384&&(l=i.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var d=0;d<l.length;d++){var y=l[d],b=y.getSnapshot;y=y.value;try{if(!or(b(),y))return!1}catch{return!1}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function $i(s,i,l,d){i&=~zp,i&=~no,s.suspendedLanes|=i,s.pingedLanes&=~i,d&&(s.warmLanes|=i),d=s.expirationTimes;for(var y=i;0<y;){var b=31-qt(y),R=1<<b;d[b]=-1,y&=~R}l!==0&&Da(s,l,i)}function ph(){return(pt&6)===0?(eu(0),!1):!0}function qp(){if(Xe!==null){if(_t===0)var s=Xe.return;else s=Xe,qs=Qa=null,op(s),Zo=null,Pc=0,s=Xe;for(;s!==null;)Fb(s.alternate,s),s=s.return;Xe=null}}function cl(s,i){var l=s.timeoutHandle;l!==-1&&(s.timeoutHandle=-1,Sj(l)),l=s.cancelPendingCommit,l!==null&&(s.cancelPendingCommit=null,l()),ni=0,qp(),Ct=s,Xe=l=$s(s.current,null),tt=i,_t=0,dr=null,Ui=!1,al=Ur(s,i),Up=!1,ol=hr=zp=no=zi=Ht=0,Jn=Jc=null,Fp=!1,(i&8)!==0&&(i|=i&32);var d=s.entangledLanes;if(d!==0)for(s=s.entanglements,d&=i;0<d;){var y=31-qt(d),b=1<<y;i|=s[y],d&=~b}return ti=i,Pd(),l}function dv(s,i){We=null,U.H=Hc,i===Jo||i===Hd?(i=A_(),_t=3):i===Km?(i=A_(),_t=4):_t=i===wp?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,dr=i,Xe===null&&(Ht=1,sh(s,Tr(i,s.current)))}function hv(){var s=cr.current;return s===null?!0:(tt&4194048)===tt?Ir===null:(tt&62914560)===tt||(tt&536870912)!==0?s===Ir:!1}function fv(){var s=U.H;return U.H=Hc,s===null?Hc:s}function mv(){var s=U.A;return U.A=ej,s}function gh(){Ht=4,Ui||(tt&4194048)!==tt&&cr.current!==null||(al=!0),(zi&134217727)===0&&(no&134217727)===0||Ct===null||$i(Ct,tt,hr,!1)}function Gp(s,i,l){var d=pt;pt|=2;var y=fv(),b=mv();(Ct!==s||tt!==i)&&(mh=null,cl(s,i)),i=!1;var R=Ht;e:do try{if(_t!==0&&Xe!==null){var V=Xe,X=dr;switch(_t){case 8:qp(),R=6;break e;case 3:case 2:case 9:case 6:cr.current===null&&(i=!0);var ue=_t;if(_t=0,dr=null,ul(s,V,X,ue),l&&al){R=0;break e}break;default:ue=_t,_t=0,dr=null,ul(s,V,X,ue)}}rj(),R=Ht;break}catch(me){dv(s,me)}while(!0);return i&&s.shellSuspendCounter++,qs=Qa=null,pt=d,U.H=y,U.A=b,Xe===null&&(Ct=null,tt=0,Pd()),R}function rj(){for(;Xe!==null;)pv(Xe)}function sj(s,i){var l=pt;pt|=2;var d=fv(),y=mv();Ct!==s||tt!==i?(mh=null,fh=dn()+500,cl(s,i)):al=Ur(s,i);e:do try{if(_t!==0&&Xe!==null){i=Xe;var b=dr;t:switch(_t){case 1:_t=0,dr=null,ul(s,i,b,1);break;case 2:case 9:if(C_(b)){_t=0,dr=null,gv(i);break}i=function(){_t!==2&&_t!==9||Ct!==s||(_t=7),Cs(s)},b.then(i,i);break e;case 3:_t=7;break e;case 4:_t=5;break e;case 7:C_(b)?(_t=0,dr=null,gv(i)):(_t=0,dr=null,ul(s,i,b,7));break;case 5:var R=null;switch(Xe.tag){case 26:R=Xe.memoizedState;case 5:case 27:var V=Xe;if(R?tx(R):V.stateNode.complete){_t=0,dr=null;var X=V.sibling;if(X!==null)Xe=X;else{var ue=V.return;ue!==null?(Xe=ue,yh(ue)):Xe=null}break t}}_t=0,dr=null,ul(s,i,b,5);break;case 6:_t=0,dr=null,ul(s,i,b,6);break;case 8:qp(),Ht=6;break e;default:throw Error(r(462))}}ij();break}catch(me){dv(s,me)}while(!0);return qs=Qa=null,U.H=d,U.A=y,pt=l,Xe!==null?0:(Ct=null,tt=0,Pd(),Ht)}function ij(){for(;Xe!==null&&!Ke();)pv(Xe)}function pv(s){var i=Ub(s.alternate,s,ti);s.memoizedProps=s.pendingProps,i===null?yh(s):Xe=i}function gv(s){var i=s,l=i.alternate;switch(i.tag){case 15:case 0:i=kb(l,i,i.pendingProps,i.type,void 0,tt);break;case 11:i=kb(l,i,i.pendingProps,i.type.render,i.ref,tt);break;case 5:op(i);default:Fb(l,i),i=Xe=m_(i,ti),i=Ub(l,i,ti)}s.memoizedProps=s.pendingProps,i===null?yh(s):Xe=i}function ul(s,i,l,d){qs=Qa=null,op(i),Zo=null,Pc=0;var y=i.return;try{if(QA(s,y,i,l,tt)){Ht=1,sh(s,Tr(l,s.current)),Xe=null;return}}catch(b){if(y!==null)throw Xe=y,b;Ht=1,sh(s,Tr(l,s.current)),Xe=null;return}i.flags&32768?(ot||d===1?s=!0:al||(tt&536870912)!==0?s=!1:(Ui=s=!0,(d===2||d===9||d===3||d===6)&&(d=cr.current,d!==null&&d.tag===13&&(d.flags|=16384))),yv(i,s)):yh(i)}function yh(s){var i=s;do{if((i.flags&32768)!==0){yv(i,Ui);return}s=i.return;var l=YA(i.alternate,i,ti);if(l!==null){Xe=l;return}if(i=i.sibling,i!==null){Xe=i;return}Xe=i=s}while(i!==null);Ht===0&&(Ht=5)}function yv(s,i){do{var l=XA(s.alternate,s);if(l!==null){l.flags&=32767,Xe=l;return}if(l=s.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!i&&(s=s.sibling,s!==null)){Xe=s;return}Xe=s=l}while(s!==null);Ht=6,Xe=null}function _v(s,i,l,d,y,b,R,V,X){s.cancelPendingCommit=null;do _h();while(hn!==0);if((pt&6)!==0)throw Error(r(327));if(i!==null){if(i===s.current)throw Error(r(177));if(b=i.lanes|i.childLanes,b|=Om,Cm(s,l,b,R,V,X),s===Ct&&(Xe=Ct=null,tt=0),ll=i,Vi=s,ni=l,Vp=b,$p=y,ov=d,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,cj(bi,function(){return wv(),null})):(s.callbackNode=null,s.callbackPriority=0),d=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||d){d=U.T,U.T=null,y=F.p,F.p=2,R=pt,pt|=4;try{JA(s,i,l)}finally{pt=R,F.p=y,U.T=d}}hn=1,bv(),vv(),xv()}}function bv(){if(hn===1){hn=0;var s=Vi,i=ll,l=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||l){l=U.T,U.T=null;var d=F.p;F.p=2;var y=pt;pt|=4;try{Zb(i,s);var b=sg,R=i_(s.containerInfo),V=b.focusedElem,X=b.selectionRange;if(R!==V&&V&&V.ownerDocument&&s_(V.ownerDocument.documentElement,V)){if(X!==null&&Rm(V)){var ue=X.start,me=X.end;if(me===void 0&&(me=ue),"selectionStart"in V)V.selectionStart=ue,V.selectionEnd=Math.min(me,V.value.length);else{var _e=V.ownerDocument||document,de=_e&&_e.defaultView||window;if(de.getSelection){var fe=de.getSelection(),De=V.textContent.length,ze=Math.min(X.start,De),wt=X.end===void 0?ze:Math.min(X.end,De);!fe.extend&&ze>wt&&(R=wt,wt=ze,ze=R);var se=r_(V,ze),ne=r_(V,wt);if(se&&ne&&(fe.rangeCount!==1||fe.anchorNode!==se.node||fe.anchorOffset!==se.offset||fe.focusNode!==ne.node||fe.focusOffset!==ne.offset)){var ce=_e.createRange();ce.setStart(se.node,se.offset),fe.removeAllRanges(),ze>wt?(fe.addRange(ce),fe.extend(ne.node,ne.offset)):(ce.setEnd(ne.node,ne.offset),fe.addRange(ce))}}}}for(_e=[],fe=V;fe=fe.parentNode;)fe.nodeType===1&&_e.push({element:fe,left:fe.scrollLeft,top:fe.scrollTop});for(typeof V.focus=="function"&&V.focus(),V=0;V<_e.length;V++){var ge=_e[V];ge.element.scrollLeft=ge.left,ge.element.scrollTop=ge.top}}Ih=!!rg,sg=rg=null}finally{pt=y,F.p=d,U.T=l}}s.current=i,hn=2}}function vv(){if(hn===2){hn=0;var s=Vi,i=ll,l=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||l){l=U.T,U.T=null;var d=F.p;F.p=2;var y=pt;pt|=4;try{Wb(s,i.alternate,i)}finally{pt=y,F.p=d,U.T=l}}hn=3}}function xv(){if(hn===4||hn===3){hn=0,_i();var s=Vi,i=ll,l=ni,d=ov;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?hn=5:(hn=0,ll=Vi=null,Sv(s,s.pendingLanes));var y=s.pendingLanes;if(y===0&&(Fi=null),Us(l),i=i.stateNode,wn&&typeof wn.onCommitFiberRoot=="function")try{wn.onCommitFiberRoot(Lr,i,void 0,(i.current.flags&128)===128)}catch{}if(d!==null){i=U.T,y=F.p,F.p=2,U.T=null;try{for(var b=s.onRecoverableError,R=0;R<d.length;R++){var V=d[R];b(V.value,{componentStack:V.stack})}}finally{U.T=i,F.p=y}}(ni&3)!==0&&_h(),Cs(s),y=s.pendingLanes,(l&261930)!==0&&(y&42)!==0?s===Hp?Zc++:(Zc=0,Hp=s):Zc=0,eu(0)}}function Sv(s,i){(s.pooledCacheLanes&=i)===0&&(i=s.pooledCache,i!=null&&(s.pooledCache=null,Oc(i)))}function _h(){return bv(),vv(),xv(),wv()}function wv(){if(hn!==5)return!1;var s=Vi,i=Vp;Vp=0;var l=Us(ni),d=U.T,y=F.p;try{F.p=32>l?32:l,U.T=null,l=$p,$p=null;var b=Vi,R=ni;if(hn=0,ll=Vi=null,ni=0,(pt&6)!==0)throw Error(r(331));var V=pt;if(pt|=4,sv(b.current),tv(b,b.current,R,l),pt=V,eu(0,!1),wn&&typeof wn.onPostCommitFiberRoot=="function")try{wn.onPostCommitFiberRoot(Lr,b)}catch{}return!0}finally{F.p=y,U.T=d,Sv(s,i)}}function Ev(s,i,l){i=Tr(l,i),i=Sp(s.stateNode,i,2),s=Ni(s,i,2),s!==null&&(Ia(s,2),Cs(s))}function bt(s,i,l){if(s.tag===3)Ev(s,s,l);else for(;i!==null;){if(i.tag===3){Ev(i,s,l);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Fi===null||!Fi.has(d))){s=Tr(l,s),l=Cb(2),d=Ni(i,l,2),d!==null&&(Tb(l,d,i,s),Ia(d,2),Cs(d));break}}i=i.return}}function Qp(s,i,l){var d=s.pingCache;if(d===null){d=s.pingCache=new tj;var y=new Set;d.set(i,y)}else y=d.get(i),y===void 0&&(y=new Set,d.set(i,y));y.has(l)||(Up=!0,y.add(l),s=aj.bind(null,s,i,l),i.then(s,s))}function aj(s,i,l){var d=s.pingCache;d!==null&&d.delete(i),s.pingedLanes|=s.suspendedLanes&l,s.warmLanes&=~l,Ct===s&&(tt&l)===l&&(Ht===4||Ht===3&&(tt&62914560)===tt&&300>dn()-hh?(pt&2)===0&&cl(s,0):zp|=l,ol===tt&&(ol=0)),Cs(s)}function Cv(s,i){i===0&&(i=md()),s=Ha(s,i),s!==null&&(Ia(s,i),Cs(s))}function oj(s){var i=s.memoizedState,l=0;i!==null&&(l=i.retryLane),Cv(s,l)}function lj(s,i){var l=0;switch(s.tag){case 31:case 13:var d=s.stateNode,y=s.memoizedState;y!==null&&(l=y.retryLane);break;case 19:d=s.stateNode;break;case 22:d=s.stateNode._retryCache;break;default:throw Error(r(314))}d!==null&&d.delete(i),Cv(s,l)}function cj(s,i){return Mt(s,i)}var bh=null,dl=null,Wp=!1,vh=!1,Kp=!1,Hi=0;function Cs(s){s!==dl&&s.next===null&&(dl===null?bh=dl=s:dl=dl.next=s),vh=!0,Wp||(Wp=!0,dj())}function eu(s,i){if(!Kp&&vh){Kp=!0;do for(var l=!1,d=bh;d!==null;){if(s!==0){var y=d.pendingLanes;if(y===0)var b=0;else{var R=d.suspendedLanes,V=d.pingedLanes;b=(1<<31-qt(42|s)+1)-1,b&=y&~(R&~V),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(l=!0,Rv(d,b))}else b=tt,b=os(d,d===Ct?b:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(b&3)===0||Ur(d,b)||(l=!0,Rv(d,b));d=d.next}while(l);Kp=!1}}function uj(){Tv()}function Tv(){vh=Wp=!1;var s=0;Hi!==0&&xj()&&(s=Hi);for(var i=dn(),l=null,d=bh;d!==null;){var y=d.next,b=Av(d,i);b===0?(d.next=null,l===null?bh=y:l.next=y,y===null&&(dl=l)):(l=d,(s!==0||(b&3)!==0)&&(vh=!0)),d=y}hn!==0&&hn!==5||eu(s),Hi!==0&&(Hi=0)}function Av(s,i){for(var l=s.suspendedLanes,d=s.pingedLanes,y=s.expirationTimes,b=s.pendingLanes&-62914561;0<b;){var R=31-qt(b),V=1<<R,X=y[R];X===-1?((V&l)===0||(V&d)!==0)&&(y[R]=Em(V,i)):X<=i&&(s.expiredLanes|=V),b&=~V}if(i=Ct,l=tt,l=os(s,s===i?l:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),d=s.callbackNode,l===0||s===i&&(_t===2||_t===9)||s.cancelPendingCommit!==null)return d!==null&&d!==null&&Ae(d),s.callbackNode=null,s.callbackPriority=0;if((l&3)===0||Ur(s,l)){if(i=l&-l,i===s.callbackPriority)return i;switch(d!==null&&Ae(d),Us(l)){case 2:case 8:l=uc;break;case 32:l=bi;break;case 268435456:l=cd;break;default:l=bi}return d=jv.bind(null,s),l=Mt(l,d),s.callbackPriority=i,s.callbackNode=l,i}return d!==null&&d!==null&&Ae(d),s.callbackPriority=2,s.callbackNode=null,2}function jv(s,i){if(hn!==0&&hn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var l=s.callbackNode;if(_h()&&s.callbackNode!==l)return null;var d=tt;return d=os(s,s===Ct?d:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),d===0?null:(cv(s,d,i),Av(s,dn()),s.callbackNode!=null&&s.callbackNode===l?jv.bind(null,s):null)}function Rv(s,i){if(_h())return null;cv(s,i,!0)}function dj(){wj(function(){(pt&6)!==0?Mt(cc,uj):Tv()})}function Yp(){if(Hi===0){var s=Yo;s===0&&(s=is,is<<=1,(is&261888)===0&&(is=256)),Hi=s}return Hi}function Iv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:No(""+s)}function Dv(s,i){var l=i.ownerDocument.createElement("input");return l.name=i.name,l.value=i.value,s.id&&l.setAttribute("form",s.id),i.parentNode.insertBefore(l,i),s=new FormData(s),l.parentNode.removeChild(l),s}function hj(s,i,l,d,y){if(i==="submit"&&l&&l.stateNode===y){var b=Iv((y[_n]||null).action),R=d.submitter;R&&(i=(i=R[_n]||null)?Iv(i.formAction):R.getAttribute("formAction"),i!==null&&(b=i,R=null));var V=new _s("action","action",null,d,y);s.push({event:V,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Hi!==0){var X=R?Dv(y,R):new FormData(y);gp(l,{pending:!0,data:X,method:y.method,action:b},null,X)}}else typeof b=="function"&&(V.preventDefault(),X=R?Dv(y,R):new FormData(y),gp(l,{pending:!0,data:X,method:y.method,action:b},b,X))},currentTarget:y}]})}}for(var Xp=0;Xp<km.length;Xp++){var Jp=km[Xp],fj=Jp.toLowerCase(),mj=Jp[0].toUpperCase()+Jp.slice(1);Qr(fj,"on"+mj)}Qr(l_,"onAnimationEnd"),Qr(c_,"onAnimationIteration"),Qr(u_,"onAnimationStart"),Qr("dblclick","onDoubleClick"),Qr("focusin","onFocus"),Qr("focusout","onBlur"),Qr(IA,"onTransitionRun"),Qr(DA,"onTransitionStart"),Qr(MA,"onTransitionCancel"),Qr(d_,"onTransitionEnd"),ms("onMouseEnter",["mouseout","mouseover"]),ms("onMouseLeave",["mouseout","mouseover"]),ms("onPointerEnter",["pointerout","pointerover"]),ms("onPointerLeave",["pointerout","pointerover"]),fs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fs("onBeforeInput",["compositionend","keypress","textInput","paste"]),fs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var tu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pj=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(tu));function Mv(s,i){i=(i&4)!==0;for(var l=0;l<s.length;l++){var d=s[l],y=d.event;d=d.listeners;e:{var b=void 0;if(i)for(var R=d.length-1;0<=R;R--){var V=d[R],X=V.instance,ue=V.currentTarget;if(V=V.listener,X!==b&&y.isPropagationStopped())break e;b=V,y.currentTarget=ue;try{b(y)}catch(me){Nd(me)}y.currentTarget=null,b=X}else for(R=0;R<d.length;R++){if(V=d[R],X=V.instance,ue=V.currentTarget,V=V.listener,X!==b&&y.isPropagationStopped())break e;b=V,y.currentTarget=ue;try{b(y)}catch(me){Nd(me)}y.currentTarget=null,b=X}}}}function Je(s,i){var l=i[Io];l===void 0&&(l=i[Io]=new Set);var d=s+"__bubble";l.has(d)||(kv(i,s,2,!1),l.add(d))}function Zp(s,i,l){var d=0;i&&(d|=4),kv(l,s,d,i)}var xh="_reactListening"+Math.random().toString(36).slice(2);function eg(s){if(!s[xh]){s[xh]=!0,fc.forEach(function(l){l!=="selectionchange"&&(pj.has(l)||Zp(l,!1,s),Zp(l,!0,s))});var i=s.nodeType===9?s:s.ownerDocument;i===null||i[xh]||(i[xh]=!0,Zp("selectionchange",!1,i))}}function kv(s,i,l,d){switch(lx(i)){case 2:var y=$j;break;case 8:y=Hj;break;default:y=pg}l=y.bind(null,i,l,s),y=void 0,!Pa||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(y=!0),d?y!==void 0?s.addEventListener(i,l,{capture:!0,passive:y}):s.addEventListener(i,l,!0):y!==void 0?s.addEventListener(i,l,{passive:y}):s.addEventListener(i,l,!1)}function tg(s,i,l,d,y){var b=d;if((i&1)===0&&(i&2)===0&&d!==null)e:for(;;){if(d===null)return;var R=d.tag;if(R===3||R===4){var V=d.stateNode.containerInfo;if(V===y)break;if(R===4)for(R=d.return;R!==null;){var X=R.tag;if((X===3||X===4)&&R.stateNode.containerInfo===y)return;R=R.return}for(;V!==null;){if(R=ds(V),R===null)return;if(X=R.tag,X===5||X===6||X===26||X===27){d=b=R;continue e}V=V.parentNode}}d=d.return}Ci(function(){var ue=b,me=Sr(l),_e=[];e:{var de=h_.get(s);if(de!==void 0){var fe=_s,De=s;switch(s){case"keypress":if(La(l)===0)break e;case"keydown":case"keyup":fe=Md;break;case"focusin":De="focus",fe=za;break;case"focusout":De="blur",fe=za;break;case"beforeblur":case"afterblur":fe=za;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":fe=Tc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":fe=wd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":fe=w;break;case l_:case c_:case u_:fe=Cd;break;case d_:fe=$;break;case"scroll":case"scrollend":fe=Cc;break;case"wheel":fe=he;break;case"copy":case"cut":case"paste":fe=Td;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":fe=Vs;break;case"toggle":case"beforetoggle":fe=Qe}var ze=(i&4)!==0,wt=!ze&&(s==="scroll"||s==="scrollend"),se=ze?de!==null?de+"Capture":null:de;ze=[];for(var ne=ue,ce;ne!==null;){var ge=ne;if(ce=ge.stateNode,ge=ge.tag,ge!==5&&ge!==26&&ge!==27||ce===null||se===null||(ge=$r(ne,se),ge!=null&&ze.push(nu(ne,ge,ce))),wt)break;ne=ne.return}0<ze.length&&(de=new fe(de,De,null,l,me),_e.push({event:de,listeners:ze}))}}if((i&7)===0){e:{if(de=s==="mouseover"||s==="pointerover",fe=s==="mouseout"||s==="pointerout",de&&l!==Sc&&(De=l.relatedTarget||l.fromElement)&&(ds(De)||De[cs]))break e;if((fe||de)&&(de=me.window===me?me:(de=me.ownerDocument)?de.defaultView||de.parentWindow:window,fe?(De=l.relatedTarget||l.toElement,fe=ue,De=De?ds(De):null,De!==null&&(wt=o(De),ze=De.tag,De!==wt||ze!==5&&ze!==27&&ze!==6)&&(De=null)):(fe=null,De=ue),fe!==De)){if(ze=Tc,ge="onMouseLeave",se="onMouseEnter",ne="mouse",(s==="pointerout"||s==="pointerover")&&(ze=Vs,ge="onPointerLeave",se="onPointerEnter",ne="pointer"),wt=fe==null?de:ir(fe),ce=De==null?de:ir(De),de=new ze(ge,ne+"leave",fe,l,me),de.target=wt,de.relatedTarget=ce,ge=null,ds(me)===ue&&(ze=new ze(se,ne+"enter",De,l,me),ze.target=ce,ze.relatedTarget=wt,ge=ze),wt=ge,fe&&De)t:{for(ze=gj,se=fe,ne=De,ce=0,ge=se;ge;ge=ze(ge))ce++;ge=0;for(var Pe=ne;Pe;Pe=ze(Pe))ge++;for(;0<ce-ge;)se=ze(se),ce--;for(;0<ge-ce;)ne=ze(ne),ge--;for(;ce--;){if(se===ne||ne!==null&&se===ne.alternate){ze=se;break t}se=ze(se),ne=ze(ne)}ze=null}else ze=null;fe!==null&&Ov(_e,de,fe,ze,!1),De!==null&&wt!==null&&Ov(_e,wt,De,ze,!0)}}e:{if(de=ue?ir(ue):window,fe=de.nodeName&&de.nodeName.toLowerCase(),fe==="select"||fe==="input"&&de.type==="file")var dt=X0;else if(K0(de))if(J0)dt=AA;else{dt=CA;var ke=EA}else fe=de.nodeName,!fe||fe.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?ue&&Oo(ue.elementType)&&(dt=X0):dt=TA;if(dt&&(dt=dt(s,ue))){Y0(_e,dt,l,me);break e}ke&&ke(s,de,ue),s==="focusout"&&ue&&de.type==="number"&&ue.memoizedProps.value!=null&&bc(de,"number",de.value)}switch(ke=ue?ir(ue):window,s){case"focusin":(K0(ke)||ke.contentEditable==="true")&&(Vo=ke,Im=ue,Dc=null);break;case"focusout":Dc=Im=Vo=null;break;case"mousedown":Dm=!0;break;case"contextmenu":case"mouseup":case"dragend":Dm=!1,a_(_e,l,me);break;case"selectionchange":if(RA)break;case"keydown":case"keyup":a_(_e,l,me)}var Ye;if(mt)e:{switch(s){case"compositionstart":var nt="onCompositionStart";break e;case"compositionend":nt="onCompositionEnd";break e;case"compositionupdate":nt="onCompositionUpdate";break e}nt=void 0}else Fo?Fa(s,l)&&(nt="onCompositionEnd"):s==="keydown"&&l.keyCode===229&&(nt="onCompositionStart");nt&&(xs&&l.locale!=="ko"&&(Fo||nt!=="onCompositionStart"?nt==="onCompositionEnd"&&Fo&&(Ye=Ec()):(ys=me,wc="value"in ys?ys.value:ys.textContent,Fo=!0)),ke=Sh(ue,nt),0<ke.length&&(nt=new vs(nt,s,null,l,me),_e.push({event:nt,listeners:ke}),Ye?nt.data=Ye:(Ye=zo(l),Ye!==null&&(nt.data=Ye)))),(Ye=Er?vA(s,l):xA(s,l))&&(nt=Sh(ue,"onBeforeInput"),0<nt.length&&(ke=new vs("onBeforeInput","beforeinput",null,l,me),_e.push({event:ke,listeners:nt}),ke.data=Ye)),hj(_e,s,ue,l,me)}Mv(_e,i)})}function nu(s,i,l){return{instance:s,listener:i,currentTarget:l}}function Sh(s,i){for(var l=i+"Capture",d=[];s!==null;){var y=s,b=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||b===null||(y=$r(s,l),y!=null&&d.unshift(nu(s,y,b)),y=$r(s,i),y!=null&&d.push(nu(s,y,b))),s.tag===3)return d;s=s.return}return[]}function gj(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Ov(s,i,l,d,y){for(var b=i._reactName,R=[];l!==null&&l!==d;){var V=l,X=V.alternate,ue=V.stateNode;if(V=V.tag,X!==null&&X===d)break;V!==5&&V!==26&&V!==27||ue===null||(X=ue,y?(ue=$r(l,b),ue!=null&&R.unshift(nu(l,ue,X))):y||(ue=$r(l,b),ue!=null&&R.push(nu(l,ue,X)))),l=l.return}R.length!==0&&s.push({event:i,listeners:R})}var yj=/\r\n?/g,_j=/\u0000|\uFFFD/g;function Nv(s){return(typeof s=="string"?s:""+s).replace(yj,`
`).replace(_j,"")}function Pv(s,i){return i=Nv(i),Nv(s)===i}function St(s,i,l,d,y,b){switch(l){case"children":typeof d=="string"?i==="body"||i==="textarea"&&d===""||Wn(s,d):(typeof d=="number"||typeof d=="bigint")&&i!=="body"&&Wn(s,""+d);break;case"className":ar(s,"class",d);break;case"tabIndex":ar(s,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":ar(s,l,d);break;case"style":xc(s,d,b);break;case"data":if(i!=="object"){ar(s,"data",d);break}case"src":case"href":if(d===""&&(i!=="a"||l!=="href")){s.removeAttribute(l);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){s.removeAttribute(l);break}d=No(""+d),s.setAttribute(l,d);break;case"action":case"formAction":if(typeof d=="function"){s.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(l==="formAction"?(i!=="input"&&St(s,i,"name",y.name,y,null),St(s,i,"formEncType",y.formEncType,y,null),St(s,i,"formMethod",y.formMethod,y,null),St(s,i,"formTarget",y.formTarget,y,null)):(St(s,i,"encType",y.encType,y,null),St(s,i,"method",y.method,y,null),St(s,i,"target",y.target,y,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){s.removeAttribute(l);break}d=No(""+d),s.setAttribute(l,d);break;case"onClick":d!=null&&(s.onclick=Vr);break;case"onScroll":d!=null&&Je("scroll",s);break;case"onScrollEnd":d!=null&&Je("scrollend",s);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(r(61));if(l=d.__html,l!=null){if(y.children!=null)throw Error(r(60));s.innerHTML=l}}break;case"multiple":s.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":s.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){s.removeAttribute("xlink:href");break}l=No(""+d),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(l,""+d):s.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(l,""):s.removeAttribute(l);break;case"capture":case"download":d===!0?s.setAttribute(l,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(l,d):s.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?s.setAttribute(l,d):s.removeAttribute(l);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?s.removeAttribute(l):s.setAttribute(l,d);break;case"popover":Je("beforetoggle",s),Je("toggle",s),Mo(s,"popover",d);break;case"xlinkActuate":en(s,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":en(s,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":en(s,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":en(s,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":en(s,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":en(s,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":en(s,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":en(s,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":en(s,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Mo(s,"is",d);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=Sd.get(l)||l,Mo(s,l,d))}}function ng(s,i,l,d,y,b){switch(l){case"style":xc(s,d,b);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(r(61));if(l=d.__html,l!=null){if(y.children!=null)throw Error(r(60));s.innerHTML=l}}break;case"children":typeof d=="string"?Wn(s,d):(typeof d=="number"||typeof d=="bigint")&&Wn(s,""+d);break;case"onScroll":d!=null&&Je("scroll",s);break;case"onScrollEnd":d!=null&&Je("scrollend",s);break;case"onClick":d!=null&&(s.onclick=Vr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!mc.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(y=l.endsWith("Capture"),i=l.slice(2,y?l.length-7:void 0),b=s[_n]||null,b=b!=null?b[l]:null,typeof b=="function"&&s.removeEventListener(i,b,y),typeof d=="function")){typeof b!="function"&&b!==null&&(l in s?s[l]=null:s.hasAttribute(l)&&s.removeAttribute(l)),s.addEventListener(i,d,y);break e}l in s?s[l]=d:d===!0?s.setAttribute(l,""):Mo(s,l,d)}}}function jn(s,i,l){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Je("error",s),Je("load",s);var d=!1,y=!1,b;for(b in l)if(l.hasOwnProperty(b)){var R=l[b];if(R!=null)switch(b){case"src":d=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:St(s,i,b,R,l,null)}}y&&St(s,i,"srcSet",l.srcSet,l,null),d&&St(s,i,"src",l.src,l,null);return;case"input":Je("invalid",s);var V=b=R=y=null,X=null,ue=null;for(d in l)if(l.hasOwnProperty(d)){var me=l[d];if(me!=null)switch(d){case"name":y=me;break;case"type":R=me;break;case"checked":X=me;break;case"defaultChecked":ue=me;break;case"value":b=me;break;case"defaultValue":V=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(r(137,i));break;default:St(s,i,d,me,l,null)}}bd(s,b,V,X,ue,R,y,!1);return;case"select":Je("invalid",s),d=R=b=null;for(y in l)if(l.hasOwnProperty(y)&&(V=l[y],V!=null))switch(y){case"value":b=V;break;case"defaultValue":R=V;break;case"multiple":d=V;default:St(s,i,y,V,l,null)}i=b,l=R,s.multiple=!!d,i!=null?xi(s,!!d,i,!1):l!=null&&xi(s,!!d,l,!0);return;case"textarea":Je("invalid",s),b=y=d=null;for(R in l)if(l.hasOwnProperty(R)&&(V=l[R],V!=null))switch(R){case"value":d=V;break;case"defaultValue":y=V;break;case"children":b=V;break;case"dangerouslySetInnerHTML":if(V!=null)throw Error(r(91));break;default:St(s,i,R,V,l,null)}Si(s,d,y,b);return;case"option":for(X in l)l.hasOwnProperty(X)&&(d=l[X],d!=null)&&(X==="selected"?s.selected=d&&typeof d!="function"&&typeof d!="symbol":St(s,i,X,d,l,null));return;case"dialog":Je("beforetoggle",s),Je("toggle",s),Je("cancel",s),Je("close",s);break;case"iframe":case"object":Je("load",s);break;case"video":case"audio":for(d=0;d<tu.length;d++)Je(tu[d],s);break;case"image":Je("error",s),Je("load",s);break;case"details":Je("toggle",s);break;case"embed":case"source":case"link":Je("error",s),Je("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ue in l)if(l.hasOwnProperty(ue)&&(d=l[ue],d!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:St(s,i,ue,d,l,null)}return;default:if(Oo(i)){for(me in l)l.hasOwnProperty(me)&&(d=l[me],d!==void 0&&ng(s,i,me,d,l,void 0));return}}for(V in l)l.hasOwnProperty(V)&&(d=l[V],d!=null&&St(s,i,V,d,l,null))}function bj(s,i,l,d){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,b=null,R=null,V=null,X=null,ue=null,me=null;for(fe in l){var _e=l[fe];if(l.hasOwnProperty(fe)&&_e!=null)switch(fe){case"checked":break;case"value":break;case"defaultValue":X=_e;default:d.hasOwnProperty(fe)||St(s,i,fe,null,d,_e)}}for(var de in d){var fe=d[de];if(_e=l[de],d.hasOwnProperty(de)&&(fe!=null||_e!=null))switch(de){case"type":b=fe;break;case"name":y=fe;break;case"checked":ue=fe;break;case"defaultChecked":me=fe;break;case"value":R=fe;break;case"defaultValue":V=fe;break;case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(r(137,i));break;default:fe!==_e&&St(s,i,de,fe,d,_e)}}ko(s,R,V,X,ue,me,b,y);return;case"select":fe=R=V=de=null;for(b in l)if(X=l[b],l.hasOwnProperty(b)&&X!=null)switch(b){case"value":break;case"multiple":fe=X;default:d.hasOwnProperty(b)||St(s,i,b,null,d,X)}for(y in d)if(b=d[y],X=l[y],d.hasOwnProperty(y)&&(b!=null||X!=null))switch(y){case"value":de=b;break;case"defaultValue":V=b;break;case"multiple":R=b;default:b!==X&&St(s,i,y,b,d,X)}i=V,l=R,d=fe,de!=null?xi(s,!!l,de,!1):!!d!=!!l&&(i!=null?xi(s,!!l,i,!0):xi(s,!!l,l?[]:"",!1));return;case"textarea":fe=de=null;for(V in l)if(y=l[V],l.hasOwnProperty(V)&&y!=null&&!d.hasOwnProperty(V))switch(V){case"value":break;case"children":break;default:St(s,i,V,null,d,y)}for(R in d)if(y=d[R],b=l[R],d.hasOwnProperty(R)&&(y!=null||b!=null))switch(R){case"value":de=y;break;case"defaultValue":fe=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(r(91));break;default:y!==b&&St(s,i,R,y,d,b)}vd(s,de,fe);return;case"option":for(var De in l)de=l[De],l.hasOwnProperty(De)&&de!=null&&!d.hasOwnProperty(De)&&(De==="selected"?s.selected=!1:St(s,i,De,null,d,de));for(X in d)de=d[X],fe=l[X],d.hasOwnProperty(X)&&de!==fe&&(de!=null||fe!=null)&&(X==="selected"?s.selected=de&&typeof de!="function"&&typeof de!="symbol":St(s,i,X,de,d,fe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ze in l)de=l[ze],l.hasOwnProperty(ze)&&de!=null&&!d.hasOwnProperty(ze)&&St(s,i,ze,null,d,de);for(ue in d)if(de=d[ue],fe=l[ue],d.hasOwnProperty(ue)&&de!==fe&&(de!=null||fe!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(r(137,i));break;default:St(s,i,ue,de,d,fe)}return;default:if(Oo(i)){for(var wt in l)de=l[wt],l.hasOwnProperty(wt)&&de!==void 0&&!d.hasOwnProperty(wt)&&ng(s,i,wt,void 0,d,de);for(me in d)de=d[me],fe=l[me],!d.hasOwnProperty(me)||de===fe||de===void 0&&fe===void 0||ng(s,i,me,de,d,fe);return}}for(var se in l)de=l[se],l.hasOwnProperty(se)&&de!=null&&!d.hasOwnProperty(se)&&St(s,i,se,null,d,de);for(_e in d)de=d[_e],fe=l[_e],!d.hasOwnProperty(_e)||de===fe||de==null&&fe==null||St(s,i,_e,de,d,fe)}function Bv(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function vj(){if(typeof performance.getEntriesByType=="function"){for(var s=0,i=0,l=performance.getEntriesByType("resource"),d=0;d<l.length;d++){var y=l[d],b=y.transferSize,R=y.initiatorType,V=y.duration;if(b&&V&&Bv(R)){for(R=0,V=y.responseEnd,d+=1;d<l.length;d++){var X=l[d],ue=X.startTime;if(ue>V)break;var me=X.transferSize,_e=X.initiatorType;me&&Bv(_e)&&(X=X.responseEnd,R+=me*(X<V?1:(V-ue)/(X-ue)))}if(--d,i+=8*(b+R)/(y.duration/1e3),s++,10<s)break}}if(0<s)return i/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var rg=null,sg=null;function wh(s){return s.nodeType===9?s:s.ownerDocument}function Lv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Uv(s,i){if(s===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&i==="foreignObject"?0:s}function ig(s,i){return s==="textarea"||s==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var ag=null;function xj(){var s=window.event;return s&&s.type==="popstate"?s===ag?!1:(ag=s,!0):(ag=null,!1)}var zv=typeof setTimeout=="function"?setTimeout:void 0,Sj=typeof clearTimeout=="function"?clearTimeout:void 0,Fv=typeof Promise=="function"?Promise:void 0,wj=typeof queueMicrotask=="function"?queueMicrotask:typeof Fv<"u"?function(s){return Fv.resolve(null).then(s).catch(Ej)}:zv;function Ej(s){setTimeout(function(){throw s})}function qi(s){return s==="head"}function Vv(s,i){var l=i,d=0;do{var y=l.nextSibling;if(s.removeChild(l),y&&y.nodeType===8)if(l=y.data,l==="/$"||l==="/&"){if(d===0){s.removeChild(y),pl(i);return}d--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")d++;else if(l==="html")ru(s.ownerDocument.documentElement);else if(l==="head"){l=s.ownerDocument.head,ru(l);for(var b=l.firstChild;b;){var R=b.nextSibling,V=b.nodeName;b[us]||V==="SCRIPT"||V==="STYLE"||V==="LINK"&&b.rel.toLowerCase()==="stylesheet"||l.removeChild(b),b=R}}else l==="body"&&ru(s.ownerDocument.body);l=y}while(l);pl(i)}function $v(s,i){var l=s;s=0;do{var d=l.nextSibling;if(l.nodeType===1?i?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(i?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),d&&d.nodeType===8)if(l=d.data,l==="/$"){if(s===0)break;s--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||s++;l=d}while(l)}function og(s){var i=s.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var l=i;switch(i=i.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":og(l),Do(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}s.removeChild(l)}}function Cj(s,i,l,d){for(;s.nodeType===1;){var y=l;if(s.nodeName.toLowerCase()!==i.toLowerCase()){if(!d&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(d){if(!s[us])switch(i){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(b=s.getAttribute("rel"),b==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(b!==y.rel||s.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||s.getAttribute("title")!==(y.title==null?null:y.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(b=s.getAttribute("src"),(b!==(y.src==null?null:y.src)||s.getAttribute("type")!==(y.type==null?null:y.type)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&b&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(i==="input"&&s.type==="hidden"){var b=y.name==null?null:""+y.name;if(y.type==="hidden"&&s.getAttribute("name")===b)return s}else return s;if(s=Dr(s.nextSibling),s===null)break}return null}function Tj(s,i,l){if(i==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!l||(s=Dr(s.nextSibling),s===null))return null;return s}function Hv(s,i){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!i||(s=Dr(s.nextSibling),s===null))return null;return s}function lg(s){return s.data==="$?"||s.data==="$~"}function cg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function Aj(s,i){var l=s.ownerDocument;if(s.data==="$~")s._reactRetry=i;else if(s.data!=="$?"||l.readyState!=="loading")i();else{var d=function(){i(),l.removeEventListener("DOMContentLoaded",d)};l.addEventListener("DOMContentLoaded",d),s._reactRetry=d}}function Dr(s){for(;s!=null;s=s.nextSibling){var i=s.nodeType;if(i===1||i===3)break;if(i===8){if(i=s.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return s}var ug=null;function qv(s){s=s.nextSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="/$"||l==="/&"){if(i===0)return Dr(s.nextSibling);i--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||i++}s=s.nextSibling}return null}function Gv(s){s=s.previousSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(i===0)return s;i--}else l!=="/$"&&l!=="/&"||i++}s=s.previousSibling}return null}function Qv(s,i,l){switch(i=wh(l),s){case"html":if(s=i.documentElement,!s)throw Error(r(452));return s;case"head":if(s=i.head,!s)throw Error(r(453));return s;case"body":if(s=i.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function ru(s){for(var i=s.attributes;i.length;)s.removeAttributeNode(i[0]);Do(s)}var Mr=new Map,Wv=new Set;function Eh(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var ri=F.d;F.d={f:jj,r:Rj,D:Ij,C:Dj,L:Mj,m:kj,X:Nj,S:Oj,M:Pj};function jj(){var s=ri.f(),i=ph();return s||i}function Rj(s){var i=xr(s);i!==null&&i.tag===5&&i.type==="form"?db(i):ri.r(s)}var hl=typeof document>"u"?null:document;function Kv(s,i,l){var d=hl;if(d&&typeof i=="string"&&i){var y=Qn(i);y='link[rel="'+s+'"][href="'+y+'"]',typeof l=="string"&&(y+='[crossorigin="'+l+'"]'),Wv.has(y)||(Wv.add(y),s={rel:s,crossOrigin:l,href:i},d.querySelector(y)===null&&(i=d.createElement("link"),jn(i,"link",s),Zt(i),d.head.appendChild(i)))}}function Ij(s){ri.D(s),Kv("dns-prefetch",s,null)}function Dj(s,i){ri.C(s,i),Kv("preconnect",s,i)}function Mj(s,i,l){ri.L(s,i,l);var d=hl;if(d&&s&&i){var y='link[rel="preload"][as="'+Qn(i)+'"]';i==="image"&&l&&l.imageSrcSet?(y+='[imagesrcset="'+Qn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(y+='[imagesizes="'+Qn(l.imageSizes)+'"]')):y+='[href="'+Qn(s)+'"]';var b=y;switch(i){case"style":b=fl(s);break;case"script":b=ml(s)}Mr.has(b)||(s=_({rel:"preload",href:i==="image"&&l&&l.imageSrcSet?void 0:s,as:i},l),Mr.set(b,s),d.querySelector(y)!==null||i==="style"&&d.querySelector(su(b))||i==="script"&&d.querySelector(iu(b))||(i=d.createElement("link"),jn(i,"link",s),Zt(i),d.head.appendChild(i)))}}function kj(s,i){ri.m(s,i);var l=hl;if(l&&s){var d=i&&typeof i.as=="string"?i.as:"script",y='link[rel="modulepreload"][as="'+Qn(d)+'"][href="'+Qn(s)+'"]',b=y;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=ml(s)}if(!Mr.has(b)&&(s=_({rel:"modulepreload",href:s},i),Mr.set(b,s),l.querySelector(y)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(iu(b)))return}d=l.createElement("link"),jn(d,"link",s),Zt(d),l.head.appendChild(d)}}}function Oj(s,i,l){ri.S(s,i,l);var d=hl;if(d&&s){var y=hs(d).hoistableStyles,b=fl(s);i=i||"default";var R=y.get(b);if(!R){var V={loading:0,preload:null};if(R=d.querySelector(su(b)))V.loading=5;else{s=_({rel:"stylesheet",href:s,"data-precedence":i},l),(l=Mr.get(b))&&dg(s,l);var X=R=d.createElement("link");Zt(X),jn(X,"link",s),X._p=new Promise(function(ue,me){X.onload=ue,X.onerror=me}),X.addEventListener("load",function(){V.loading|=1}),X.addEventListener("error",function(){V.loading|=2}),V.loading|=4,Ch(R,i,d)}R={type:"stylesheet",instance:R,count:1,state:V},y.set(b,R)}}}function Nj(s,i){ri.X(s,i);var l=hl;if(l&&s){var d=hs(l).hoistableScripts,y=ml(s),b=d.get(y);b||(b=l.querySelector(iu(y)),b||(s=_({src:s,async:!0},i),(i=Mr.get(y))&&hg(s,i),b=l.createElement("script"),Zt(b),jn(b,"link",s),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},d.set(y,b))}}function Pj(s,i){ri.M(s,i);var l=hl;if(l&&s){var d=hs(l).hoistableScripts,y=ml(s),b=d.get(y);b||(b=l.querySelector(iu(y)),b||(s=_({src:s,async:!0,type:"module"},i),(i=Mr.get(y))&&hg(s,i),b=l.createElement("script"),Zt(b),jn(b,"link",s),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},d.set(y,b))}}function Yv(s,i,l,d){var y=(y=le.current)?Eh(y):null;if(!y)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(i=fl(l.href),l=hs(y).hoistableStyles,d=l.get(i),d||(d={type:"style",instance:null,count:0,state:null},l.set(i,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){s=fl(l.href);var b=hs(y).hoistableStyles,R=b.get(s);if(R||(y=y.ownerDocument||y,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(s,R),(b=y.querySelector(su(s)))&&!b._p&&(R.instance=b,R.state.loading=5),Mr.has(s)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Mr.set(s,l),b||Bj(y,s,l,R.state))),i&&d===null)throw Error(r(528,""));return R}if(i&&d!==null)throw Error(r(529,""));return null;case"script":return i=l.async,l=l.src,typeof l=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=ml(l),l=hs(y).hoistableScripts,d=l.get(i),d||(d={type:"script",instance:null,count:0,state:null},l.set(i,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function fl(s){return'href="'+Qn(s)+'"'}function su(s){return'link[rel="stylesheet"]['+s+"]"}function Xv(s){return _({},s,{"data-precedence":s.precedence,precedence:null})}function Bj(s,i,l,d){s.querySelector('link[rel="preload"][as="style"]['+i+"]")?d.loading=1:(i=s.createElement("link"),d.preload=i,i.addEventListener("load",function(){return d.loading|=1}),i.addEventListener("error",function(){return d.loading|=2}),jn(i,"link",l),Zt(i),s.head.appendChild(i))}function ml(s){return'[src="'+Qn(s)+'"]'}function iu(s){return"script[async]"+s}function Jv(s,i,l){if(i.count++,i.instance===null)switch(i.type){case"style":var d=s.querySelector('style[data-href~="'+Qn(l.href)+'"]');if(d)return i.instance=d,Zt(d),d;var y=_({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return d=(s.ownerDocument||s).createElement("style"),Zt(d),jn(d,"style",y),Ch(d,l.precedence,s),i.instance=d;case"stylesheet":y=fl(l.href);var b=s.querySelector(su(y));if(b)return i.state.loading|=4,i.instance=b,Zt(b),b;d=Xv(l),(y=Mr.get(y))&&dg(d,y),b=(s.ownerDocument||s).createElement("link"),Zt(b);var R=b;return R._p=new Promise(function(V,X){R.onload=V,R.onerror=X}),jn(b,"link",d),i.state.loading|=4,Ch(b,l.precedence,s),i.instance=b;case"script":return b=ml(l.src),(y=s.querySelector(iu(b)))?(i.instance=y,Zt(y),y):(d=l,(y=Mr.get(b))&&(d=_({},l),hg(d,y)),s=s.ownerDocument||s,y=s.createElement("script"),Zt(y),jn(y,"link",d),s.head.appendChild(y),i.instance=y);case"void":return null;default:throw Error(r(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(d=i.instance,i.state.loading|=4,Ch(d,l.precedence,s));return i.instance}function Ch(s,i,l){for(var d=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=d.length?d[d.length-1]:null,b=y,R=0;R<d.length;R++){var V=d[R];if(V.dataset.precedence===i)b=V;else if(b!==y)break}b?b.parentNode.insertBefore(s,b.nextSibling):(i=l.nodeType===9?l.head:l,i.insertBefore(s,i.firstChild))}function dg(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.title==null&&(s.title=i.title)}function hg(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.integrity==null&&(s.integrity=i.integrity)}var Th=null;function Zv(s,i,l){if(Th===null){var d=new Map,y=Th=new Map;y.set(l,d)}else y=Th,d=y.get(l),d||(d=new Map,y.set(l,d));if(d.has(s))return d;for(d.set(s,null),l=l.getElementsByTagName(s),y=0;y<l.length;y++){var b=l[y];if(!(b[us]||b[Jt]||s==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var R=b.getAttribute(i)||"";R=s+R;var V=d.get(R);V?V.push(b):d.set(R,[b])}}return d}function ex(s,i,l){s=s.ownerDocument||s,s.head.insertBefore(l,i==="title"?s.querySelector("head > title"):null)}function Lj(s,i,l){if(l===1||i.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;return i.rel==="stylesheet"?(s=i.disabled,typeof i.precedence=="string"&&s==null):!0;case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function tx(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function Uj(s,i,l,d){if(l.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var y=fl(d.href),b=i.querySelector(su(y));if(b){i=b._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(s.count++,s=Ah.bind(s),i.then(s,s)),l.state.loading|=4,l.instance=b,Zt(b);return}b=i.ownerDocument||i,d=Xv(d),(y=Mr.get(y))&&dg(d,y),b=b.createElement("link"),Zt(b);var R=b;R._p=new Promise(function(V,X){R.onload=V,R.onerror=X}),jn(b,"link",d),l.instance=b}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(l,i),(i=l.state.preload)&&(l.state.loading&3)===0&&(s.count++,l=Ah.bind(s),i.addEventListener("load",l),i.addEventListener("error",l))}}var fg=0;function zj(s,i){return s.stylesheets&&s.count===0&&Rh(s,s.stylesheets),0<s.count||0<s.imgCount?function(l){var d=setTimeout(function(){if(s.stylesheets&&Rh(s,s.stylesheets),s.unsuspend){var b=s.unsuspend;s.unsuspend=null,b()}},6e4+i);0<s.imgBytes&&fg===0&&(fg=62500*vj());var y=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Rh(s,s.stylesheets),s.unsuspend)){var b=s.unsuspend;s.unsuspend=null,b()}},(s.imgBytes>fg?50:800)+i);return s.unsuspend=l,function(){s.unsuspend=null,clearTimeout(d),clearTimeout(y)}}:null}function Ah(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Rh(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var jh=null;function Rh(s,i){s.stylesheets=null,s.unsuspend!==null&&(s.count++,jh=new Map,i.forEach(Fj,s),jh=null,Ah.call(s))}function Fj(s,i){if(!(i.state.loading&4)){var l=jh.get(s);if(l)var d=l.get(null);else{l=new Map,jh.set(s,l);for(var y=s.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<y.length;b++){var R=y[b];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(l.set(R.dataset.precedence,R),d=R)}d&&l.set(null,d)}y=i.instance,R=y.getAttribute("data-precedence"),b=l.get(R)||d,b===d&&l.set(null,y),l.set(R,y),this.count++,d=Ah.bind(this),y.addEventListener("load",d),y.addEventListener("error",d),b?b.parentNode.insertBefore(y,b.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(y,s.firstChild)),i.state.loading|=4}}var au={$$typeof:M,Provider:null,Consumer:null,_currentValue:K,_currentValue2:K,_threadCount:0};function Vj(s,i,l,d,y,b,R,V,X){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ls(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ls(0),this.hiddenUpdates=ls(null),this.identifierPrefix=d,this.onUncaughtError=y,this.onCaughtError=b,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=X,this.incompleteTransitions=new Map}function nx(s,i,l,d,y,b,R,V,X,ue,me,_e){return s=new Vj(s,i,l,R,X,ue,me,_e,V),i=1,b===!0&&(i|=24),b=lr(3,null,null,i),s.current=b,b.stateNode=s,i=Gm(),i.refCount++,s.pooledCache=i,i.refCount++,b.memoizedState={element:d,isDehydrated:l,cache:i},Ym(b),s}function rx(s){return s?(s=qo,s):qo}function sx(s,i,l,d,y,b){y=rx(y),d.context===null?d.context=y:d.pendingContext=y,d=Oi(i),d.payload={element:l},b=b===void 0?null:b,b!==null&&(d.callback=b),l=Ni(s,d,i),l!==null&&(Zn(l,s,i),Lc(l,s,i))}function ix(s,i){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var l=s.retryLane;s.retryLane=l!==0&&l<i?l:i}}function mg(s,i){ix(s,i),(s=s.alternate)&&ix(s,i)}function ax(s){if(s.tag===13||s.tag===31){var i=Ha(s,67108864);i!==null&&Zn(i,s,67108864),mg(s,67108864)}}function ox(s){if(s.tag===13||s.tag===31){var i=fr();i=Ma(i);var l=Ha(s,i);l!==null&&Zn(l,s,i),mg(s,i)}}var Ih=!0;function $j(s,i,l,d){var y=U.T;U.T=null;var b=F.p;try{F.p=2,pg(s,i,l,d)}finally{F.p=b,U.T=y}}function Hj(s,i,l,d){var y=U.T;U.T=null;var b=F.p;try{F.p=8,pg(s,i,l,d)}finally{F.p=b,U.T=y}}function pg(s,i,l,d){if(Ih){var y=gg(d);if(y===null)tg(s,i,d,Dh,l),cx(s,d);else if(Gj(y,s,i,l,d))d.stopPropagation();else if(cx(s,d),i&4&&-1<qj.indexOf(s)){for(;y!==null;){var b=xr(y);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var R=as(b.pendingLanes);if(R!==0){var V=b;for(V.pendingLanes|=2,V.entangledLanes|=2;R;){var X=1<<31-qt(R);V.entanglements[1]|=X,R&=~X}Cs(b),(pt&6)===0&&(fh=dn()+500,eu(0))}}break;case 31:case 13:V=Ha(b,2),V!==null&&Zn(V,b,2),ph(),mg(b,2)}if(b=gg(d),b===null&&tg(s,i,d,Dh,l),b===y)break;y=b}y!==null&&d.stopPropagation()}else tg(s,i,d,null,l)}}function gg(s){return s=Sr(s),yg(s)}var Dh=null;function yg(s){if(Dh=null,s=ds(s),s!==null){var i=o(s);if(i===null)s=null;else{var l=i.tag;if(l===13){if(s=u(i),s!==null)return s;s=null}else if(l===31){if(s=h(i),s!==null)return s;s=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;s=null}else i!==s&&(s=null)}}return Dh=s,null}function lx(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Br()){case cc:return 2;case uc:return 8;case bi:case wm:return 32;case cd:return 268435456;default:return 32}default:return 32}}var _g=!1,Gi=null,Qi=null,Wi=null,ou=new Map,lu=new Map,Ki=[],qj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function cx(s,i){switch(s){case"focusin":case"focusout":Gi=null;break;case"dragenter":case"dragleave":Qi=null;break;case"mouseover":case"mouseout":Wi=null;break;case"pointerover":case"pointerout":ou.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":lu.delete(i.pointerId)}}function cu(s,i,l,d,y,b){return s===null||s.nativeEvent!==b?(s={blockedOn:i,domEventName:l,eventSystemFlags:d,nativeEvent:b,targetContainers:[y]},i!==null&&(i=xr(i),i!==null&&ax(i)),s):(s.eventSystemFlags|=d,i=s.targetContainers,y!==null&&i.indexOf(y)===-1&&i.push(y),s)}function Gj(s,i,l,d,y){switch(i){case"focusin":return Gi=cu(Gi,s,i,l,d,y),!0;case"dragenter":return Qi=cu(Qi,s,i,l,d,y),!0;case"mouseover":return Wi=cu(Wi,s,i,l,d,y),!0;case"pointerover":var b=y.pointerId;return ou.set(b,cu(ou.get(b)||null,s,i,l,d,y)),!0;case"gotpointercapture":return b=y.pointerId,lu.set(b,cu(lu.get(b)||null,s,i,l,d,y)),!0}return!1}function ux(s){var i=ds(s.target);if(i!==null){var l=o(i);if(l!==null){if(i=l.tag,i===13){if(i=u(l),i!==null){s.blockedOn=i,zr(s.priority,function(){ox(l)});return}}else if(i===31){if(i=h(l),i!==null){s.blockedOn=i,zr(s.priority,function(){ox(l)});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){s.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Mh(s){if(s.blockedOn!==null)return!1;for(var i=s.targetContainers;0<i.length;){var l=gg(s.nativeEvent);if(l===null){l=s.nativeEvent;var d=new l.constructor(l.type,l);Sc=d,l.target.dispatchEvent(d),Sc=null}else return i=xr(l),i!==null&&ax(i),s.blockedOn=l,!1;i.shift()}return!0}function dx(s,i,l){Mh(s)&&l.delete(i)}function Qj(){_g=!1,Gi!==null&&Mh(Gi)&&(Gi=null),Qi!==null&&Mh(Qi)&&(Qi=null),Wi!==null&&Mh(Wi)&&(Wi=null),ou.forEach(dx),lu.forEach(dx)}function kh(s,i){s.blockedOn===i&&(s.blockedOn=null,_g||(_g=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Qj)))}var Oh=null;function hx(s){Oh!==s&&(Oh=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Oh===s&&(Oh=null);for(var i=0;i<s.length;i+=3){var l=s[i],d=s[i+1],y=s[i+2];if(typeof d!="function"){if(yg(d||l)===null)continue;break}var b=xr(l);b!==null&&(s.splice(i,3),i-=3,gp(b,{pending:!0,data:y,method:l.method,action:d},d,y))}}))}function pl(s){function i(X){return kh(X,s)}Gi!==null&&kh(Gi,s),Qi!==null&&kh(Qi,s),Wi!==null&&kh(Wi,s),ou.forEach(i),lu.forEach(i);for(var l=0;l<Ki.length;l++){var d=Ki[l];d.blockedOn===s&&(d.blockedOn=null)}for(;0<Ki.length&&(l=Ki[0],l.blockedOn===null);)ux(l),l.blockedOn===null&&Ki.shift();if(l=(s.ownerDocument||s).$$reactFormReplay,l!=null)for(d=0;d<l.length;d+=3){var y=l[d],b=l[d+1],R=y[_n]||null;if(typeof b=="function")R||hx(l);else if(R){var V=null;if(b&&b.hasAttribute("formAction")){if(y=b,R=b[_n]||null)V=R.formAction;else if(yg(y)!==null)continue}else V=R.action;typeof V=="function"?l[d+1]=V:(l.splice(d,3),d-=3),hx(l)}}}function fx(){function s(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(R){return y=R})},focusReset:"manual",scroll:"manual"})}function i(){y!==null&&(y(),y=null),d||setTimeout(l,20)}function l(){if(!d&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,y=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(l,100),function(){d=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),y!==null&&(y(),y=null)}}}function bg(s){this._internalRoot=s}Nh.prototype.render=bg.prototype.render=function(s){var i=this._internalRoot;if(i===null)throw Error(r(409));var l=i.current,d=fr();sx(l,d,s,i,null,null)},Nh.prototype.unmount=bg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var i=s.containerInfo;sx(s.current,2,null,s,null,null),ph(),i[cs]=null}};function Nh(s){this._internalRoot=s}Nh.prototype.unstable_scheduleHydration=function(s){if(s){var i=pd();s={blockedOn:null,target:s,priority:i};for(var l=0;l<Ki.length&&i!==0&&i<Ki[l].priority;l++);Ki.splice(l,0,s),l===0&&ux(s)}};var mx=e.version;if(mx!=="19.2.3")throw Error(r(527,mx,"19.2.3"));F.findDOMNode=function(s){var i=s._reactInternals;if(i===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=m(i),s=s!==null?g(s):null,s=s===null?null:s.stateNode,s};var Wj={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:U,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ph=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ph.isDisabled&&Ph.supportsFiber)try{Lr=Ph.inject(Wj),wn=Ph}catch{}}return du.createRoot=function(s,i){if(!a(s))throw Error(r(299));var l=!1,d="",y=xb,b=Sb,R=wb;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onUncaughtError!==void 0&&(y=i.onUncaughtError),i.onCaughtError!==void 0&&(b=i.onCaughtError),i.onRecoverableError!==void 0&&(R=i.onRecoverableError)),i=nx(s,1,!1,null,null,l,d,null,y,b,R,fx),s[cs]=i.current,eg(s),new bg(i)},du.hydrateRoot=function(s,i,l){if(!a(s))throw Error(r(299));var d=!1,y="",b=xb,R=Sb,V=wb,X=null;return l!=null&&(l.unstable_strictMode===!0&&(d=!0),l.identifierPrefix!==void 0&&(y=l.identifierPrefix),l.onUncaughtError!==void 0&&(b=l.onUncaughtError),l.onCaughtError!==void 0&&(R=l.onCaughtError),l.onRecoverableError!==void 0&&(V=l.onRecoverableError),l.formState!==void 0&&(X=l.formState)),i=nx(s,1,!0,i,l??null,d,y,X,b,R,V,fx),i.context=rx(null),l=i.current,d=fr(),d=Ma(d),y=Oi(d),y.callback=null,Ni(l,y,d),l=d,i.current.lanes=l,Ia(i,l),Cs(i),s[cs]=i.current,eg(s),new Nh(i)},du.version="19.2.3",du}var Ex;function sR(){if(Ex)return Sg.exports;Ex=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Sg.exports=rR(),Sg.exports}var iR=sR();var Cx="popstate";function aR(t={}){function e(r,a){let{pathname:o,search:u,hash:h}=r.location;return Qg("",{pathname:o,search:u,hash:h},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(r,a){return typeof a=="string"?a:Cu(a)}return lR(e,n,null,t)}function Ut(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function pr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function oR(){return Math.random().toString(36).substring(2,10)}function Tx(t,e){return{usr:t.state,key:t.key,idx:e}}function Qg(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?$l(e):e,state:n,key:e&&e.key||r||oR()}}function Cu({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function $l(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function lR(t,e,n,r={}){let{window:a=document.defaultView,v5Compat:o=!1}=r,u=a.history,h="POP",f=null,m=g();m==null&&(m=0,u.replaceState({...u.state,idx:m},""));function g(){return(u.state||{idx:null}).idx}function _(){h="POP";let T=g(),I=T==null?null:T-m;m=T,f&&f({action:h,location:E.location,delta:I})}function v(T,I){h="PUSH";let j=Qg(E.location,T,I);m=g()+1;let M=Tx(j,m),Q=E.createHref(j);try{u.pushState(M,"",Q)}catch(H){if(H instanceof DOMException&&H.name==="DataCloneError")throw H;a.location.assign(Q)}o&&f&&f({action:h,location:E.location,delta:1})}function x(T,I){h="REPLACE";let j=Qg(E.location,T,I);m=g();let M=Tx(j,m),Q=E.createHref(j);u.replaceState(M,"",Q),o&&f&&f({action:h,location:E.location,delta:0})}function S(T){return cR(T)}let E={get action(){return h},get location(){return t(a,u)},listen(T){if(f)throw new Error("A history only accepts one active listener");return a.addEventListener(Cx,_),f=T,()=>{a.removeEventListener(Cx,_),f=null}},createHref(T){return e(a,T)},createURL:S,encodeLocation(T){let I=S(T);return{pathname:I.pathname,search:I.search,hash:I.hash}},push:v,replace:x,go(T){return u.go(T)}};return E}function cR(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Ut(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Cu(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function nE(t,e,n="/"){return uR(t,e,n,!1)}function uR(t,e,n,r){let a=typeof e=="string"?$l(e):e,o=ci(a.pathname||"/",n);if(o==null)return null;let u=rE(t);dR(u);let h=null;for(let f=0;h==null&&f<u.length;++f){let m=SR(o);h=vR(u[f],m,r)}return h}function rE(t,e=[],n=[],r="",a=!1){let o=(u,h,f=a,m)=>{let g={relativePath:m===void 0?u.path||"":m,caseSensitive:u.caseSensitive===!0,childrenIndex:h,route:u};if(g.relativePath.startsWith("/")){if(!g.relativePath.startsWith(r)&&f)return;Ut(g.relativePath.startsWith(r),`Absolute route path "${g.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),g.relativePath=g.relativePath.slice(r.length)}let _=oi([r,g.relativePath]),v=n.concat(g);u.children&&u.children.length>0&&(Ut(u.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${_}".`),rE(u.children,e,v,_,f)),!(u.path==null&&!u.index)&&e.push({path:_,score:_R(_,u.index),routesMeta:v})};return t.forEach((u,h)=>{if(u.path===""||!u.path?.includes("?"))o(u,h);else for(let f of sE(u.path))o(u,h,!0,f)}),e}function sE(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,a=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return a?[o,""]:[o];let u=sE(r.join("/")),h=[];return h.push(...u.map(f=>f===""?o:[o,f].join("/"))),a&&h.push(...u),h.map(f=>t.startsWith("/")&&f===""?"/":f)}function dR(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:bR(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var hR=/^:[\w-]+$/,fR=3,mR=2,pR=1,gR=10,yR=-2,Ax=t=>t==="*";function _R(t,e){let n=t.split("/"),r=n.length;return n.some(Ax)&&(r+=yR),e&&(r+=mR),n.filter(a=>!Ax(a)).reduce((a,o)=>a+(hR.test(o)?fR:o===""?pR:gR),r)}function bR(t,e){return t.length===e.length&&t.slice(0,-1).every((r,a)=>r===e[a])?t[t.length-1]-e[e.length-1]:0}function vR(t,e,n=!1){let{routesMeta:r}=t,a={},o="/",u=[];for(let h=0;h<r.length;++h){let f=r[h],m=h===r.length-1,g=o==="/"?e:e.slice(o.length)||"/",_=lf({path:f.relativePath,caseSensitive:f.caseSensitive,end:m},g),v=f.route;if(!_&&m&&n&&!r[r.length-1].route.index&&(_=lf({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},g)),!_)return null;Object.assign(a,_.params),u.push({params:a,pathname:oi([o,_.pathname]),pathnameBase:TR(oi([o,_.pathnameBase])),route:v}),_.pathnameBase!=="/"&&(o=oi([o,_.pathnameBase]))}return u}function lf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=xR(t.path,t.caseSensitive,t.end),a=e.match(n);if(!a)return null;let o=a[0],u=o.replace(/(.)\/+$/,"$1"),h=a.slice(1);return{params:r.reduce((m,{paramName:g,isOptional:_},v)=>{if(g==="*"){let S=h[v]||"";u=o.slice(0,o.length-S.length).replace(/(.)\/+$/,"$1")}const x=h[v];return _&&!x?m[g]=void 0:m[g]=(x||"").replace(/%2F/g,"/"),m},{}),pathname:o,pathnameBase:u,pattern:t}}function xR(t,e=!1,n=!0){pr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],a="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,h,f)=>(r.push({paramName:h,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),a+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":t!==""&&t!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),r]}function SR(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return pr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function ci(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var iE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,wR=t=>iE.test(t);function ER(t,e="/"){let{pathname:n,search:r="",hash:a=""}=typeof t=="string"?$l(t):t,o;if(n)if(wR(n))o=n;else{if(n.includes("//")){let u=n;n=n.replace(/\/\/+/g,"/"),pr(!1,`Pathnames cannot have embedded double slashes - normalizing ${u} -> ${n}`)}n.startsWith("/")?o=jx(n.substring(1),"/"):o=jx(n,e)}else o=e;return{pathname:o,search:AR(r),hash:jR(a)}}function jx(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function Tg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function CR(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function ky(t){let e=CR(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Oy(t,e,n,r=!1){let a;typeof t=="string"?a=$l(t):(a={...t},Ut(!a.pathname||!a.pathname.includes("?"),Tg("?","pathname","search",a)),Ut(!a.pathname||!a.pathname.includes("#"),Tg("#","pathname","hash",a)),Ut(!a.search||!a.search.includes("#"),Tg("#","search","hash",a)));let o=t===""||a.pathname==="",u=o?"/":a.pathname,h;if(u==null)h=n;else{let _=e.length-1;if(!r&&u.startsWith("..")){let v=u.split("/");for(;v[0]==="..";)v.shift(),_-=1;a.pathname=v.join("/")}h=_>=0?e[_]:"/"}let f=ER(a,h),m=u&&u!=="/"&&u.endsWith("/"),g=(o||u===".")&&n.endsWith("/");return!f.pathname.endsWith("/")&&(m||g)&&(f.pathname+="/"),f}var oi=t=>t.join("/").replace(/\/\/+/g,"/"),TR=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),AR=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,jR=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,RR=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function IR(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function DR(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var aE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function oE(t,e){let n=t;if(typeof n!="string"||!iE.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,a=!1;if(aE)try{let o=new URL(window.location.href),u=n.startsWith("//")?new URL(o.protocol+n):new URL(n),h=ci(u.pathname,e);u.origin===o.origin&&h!=null?n=h+u.search+u.hash:a=!0}catch{pr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:a,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var lE=["POST","PUT","PATCH","DELETE"];new Set(lE);var MR=["GET",...lE];new Set(MR);var Hl=C.createContext(null);Hl.displayName="DataRouter";var Uf=C.createContext(null);Uf.displayName="DataRouterState";var kR=C.createContext(!1),cE=C.createContext({isTransitioning:!1});cE.displayName="ViewTransition";var OR=C.createContext(new Map);OR.displayName="Fetchers";var NR=C.createContext(null);NR.displayName="Await";var _r=C.createContext(null);_r.displayName="Navigation";var Fu=C.createContext(null);Fu.displayName="Location";var Pr=C.createContext({outlet:null,matches:[],isDataRoute:!1});Pr.displayName="Route";var Ny=C.createContext(null);Ny.displayName="RouteError";var uE="REACT_ROUTER_ERROR",PR="REDIRECT",BR="ROUTE_ERROR_RESPONSE";function LR(t){if(t.startsWith(`${uE}:${PR}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function UR(t){if(t.startsWith(`${uE}:${BR}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new RR(e.status,e.statusText,e.data)}catch{}}function zR(t,{relative:e}={}){Ut(ql(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=C.useContext(_r),{hash:a,pathname:o,search:u}=$u(t,{relative:e}),h=o;return n!=="/"&&(h=o==="/"?n:oi([n,o])),r.createHref({pathname:h,search:u,hash:a})}function ql(){return C.useContext(Fu)!=null}function Un(){return Ut(ql(),"useLocation() may be used only in the context of a <Router> component."),C.useContext(Fu).location}var dE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function hE(t){C.useContext(_r).static||C.useLayoutEffect(t)}function Vu(){let{isDataRoute:t}=C.useContext(Pr);return t?nI():FR()}function FR(){Ut(ql(),"useNavigate() may be used only in the context of a <Router> component.");let t=C.useContext(Hl),{basename:e,navigator:n}=C.useContext(_r),{matches:r}=C.useContext(Pr),{pathname:a}=Un(),o=JSON.stringify(ky(r)),u=C.useRef(!1);return hE(()=>{u.current=!0}),C.useCallback((f,m={})=>{if(pr(u.current,dE),!u.current)return;if(typeof f=="number"){n.go(f);return}let g=Oy(f,JSON.parse(o),a,m.relative==="path");t==null&&e!=="/"&&(g.pathname=g.pathname==="/"?e:oi([e,g.pathname])),(m.replace?n.replace:n.push)(g,m.state,m)},[e,n,o,a,t])}var VR=C.createContext(null);function $R(t){let e=C.useContext(Pr).outlet;return C.useMemo(()=>e&&C.createElement(VR.Provider,{value:t},e),[e,t])}function HR(){let{matches:t}=C.useContext(Pr),e=t[t.length-1];return e?e.params:{}}function $u(t,{relative:e}={}){let{matches:n}=C.useContext(Pr),{pathname:r}=Un(),a=JSON.stringify(ky(n));return C.useMemo(()=>Oy(t,JSON.parse(a),r,e==="path"),[t,a,r,e])}function qR(t,e){return fE(t,e)}function fE(t,e,n,r,a){Ut(ql(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=C.useContext(_r),{matches:u}=C.useContext(Pr),h=u[u.length-1],f=h?h.params:{},m=h?h.pathname:"/",g=h?h.pathnameBase:"/",_=h&&h.route;{let j=_&&_.path||"";pE(m,!_||j.endsWith("*")||j.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${j}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${j}"> to <Route path="${j==="/"?"*":`${j}/*`}">.`)}let v=Un(),x;if(e){let j=typeof e=="string"?$l(e):e;Ut(g==="/"||j.pathname?.startsWith(g),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${g}" but pathname "${j.pathname}" was given in the \`location\` prop.`),x=j}else x=v;let S=x.pathname||"/",E=S;if(g!=="/"){let j=g.replace(/^\//,"").split("/");E="/"+S.replace(/^\//,"").split("/").slice(j.length).join("/")}let T=nE(t,{pathname:E});pr(_||T!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),pr(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let I=YR(T&&T.map(j=>Object.assign({},j,{params:Object.assign({},f,j.params),pathname:oi([g,o.encodeLocation?o.encodeLocation(j.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:j.pathname]),pathnameBase:j.pathnameBase==="/"?g:oi([g,o.encodeLocation?o.encodeLocation(j.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:j.pathnameBase])})),u,n,r,a);return e&&I?C.createElement(Fu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},I):I}function GR(){let t=tI(),e=IR(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},u=null;return console.error("Error handled by React Router default ErrorBoundary:",t),u=C.createElement(C.Fragment,null,C.createElement("p",null," Hey developer "),C.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",C.createElement("code",{style:o},"ErrorBoundary")," or"," ",C.createElement("code",{style:o},"errorElement")," prop on your route.")),C.createElement(C.Fragment,null,C.createElement("h2",null,"Unexpected Application Error!"),C.createElement("h3",{style:{fontStyle:"italic"}},e),n?C.createElement("pre",{style:a},n):null,u)}var QR=C.createElement(GR,null),mE=class extends C.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=UR(t.digest);n&&(t=n)}let e=t!==void 0?C.createElement(Pr.Provider,{value:this.props.routeContext},C.createElement(Ny.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?C.createElement(WR,{error:t},e):e}};mE.contextType=kR;var Ag=new WeakMap;function WR({children:t,error:e}){let{basename:n}=C.useContext(_r);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=LR(e.digest);if(r){let a=Ag.get(e);if(a)throw a;let o=oE(r.location,n);if(aE&&!Ag.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const u=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw Ag.set(e,u),u}return C.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function KR({routeContext:t,match:e,children:n}){let r=C.useContext(Hl);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),C.createElement(Pr.Provider,{value:t},n)}function YR(t,e=[],n=null,r=null,a=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,u=n?.errors;if(u!=null){let g=o.findIndex(_=>_.route.id&&u?.[_.route.id]!==void 0);Ut(g>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),o=o.slice(0,Math.min(o.length,g+1))}let h=!1,f=-1;if(n)for(let g=0;g<o.length;g++){let _=o[g];if((_.route.HydrateFallback||_.route.hydrateFallbackElement)&&(f=g),_.route.id){let{loaderData:v,errors:x}=n,S=_.route.loader&&!v.hasOwnProperty(_.route.id)&&(!x||x[_.route.id]===void 0);if(_.route.lazy||S){h=!0,f>=0?o=o.slice(0,f+1):o=[o[0]];break}}}let m=n&&r?(g,_)=>{r(g,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:DR(n.matches),errorInfo:_})}:void 0;return o.reduceRight((g,_,v)=>{let x,S=!1,E=null,T=null;n&&(x=u&&_.route.id?u[_.route.id]:void 0,E=_.route.errorElement||QR,h&&(f<0&&v===0?(pE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,T=null):f===v&&(S=!0,T=_.route.hydrateFallbackElement||null)));let I=e.concat(o.slice(0,v+1)),j=()=>{let M;return x?M=E:S?M=T:_.route.Component?M=C.createElement(_.route.Component,null):_.route.element?M=_.route.element:M=g,C.createElement(KR,{match:_,routeContext:{outlet:g,matches:I,isDataRoute:n!=null},children:M})};return n&&(_.route.ErrorBoundary||_.route.errorElement||v===0)?C.createElement(mE,{location:n.location,revalidation:n.revalidation,component:E,error:x,children:j(),routeContext:{outlet:null,matches:I,isDataRoute:!0},onError:m}):j()},null)}function Py(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function XR(t){let e=C.useContext(Hl);return Ut(e,Py(t)),e}function JR(t){let e=C.useContext(Uf);return Ut(e,Py(t)),e}function ZR(t){let e=C.useContext(Pr);return Ut(e,Py(t)),e}function By(t){let e=ZR(t),n=e.matches[e.matches.length-1];return Ut(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function eI(){return By("useRouteId")}function tI(){let t=C.useContext(Ny),e=JR("useRouteError"),n=By("useRouteError");return t!==void 0?t:e.errors?.[n]}function nI(){let{router:t}=XR("useNavigate"),e=By("useNavigate"),n=C.useRef(!1);return hE(()=>{n.current=!0}),C.useCallback(async(a,o={})=>{pr(n.current,dE),n.current&&(typeof a=="number"?await t.navigate(a):await t.navigate(a,{fromRouteId:e,...o}))},[t,e])}var Rx={};function pE(t,e,n){!e&&!Rx[t]&&(Rx[t]=!0,pr(!1,n))}C.memo(rI);function rI({routes:t,future:e,state:n,onError:r}){return fE(t,void 0,n,r,e)}function zf({to:t,replace:e,state:n,relative:r}){Ut(ql(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=C.useContext(_r);pr(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=C.useContext(Pr),{pathname:u}=Un(),h=Vu(),f=Oy(t,ky(o),u,r==="path"),m=JSON.stringify(f);return C.useEffect(()=>{h(JSON.parse(m),{replace:e,state:n,relative:r})},[h,m,r,e,n]),null}function Ff(t){return $R(t.context)}function fn(t){Ut(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function sI({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:a,static:o=!1,unstable_useTransitions:u}){Ut(!ql(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let h=t.replace(/^\/*/,"/"),f=C.useMemo(()=>({basename:h,navigator:a,static:o,unstable_useTransitions:u,future:{}}),[h,a,o,u]);typeof n=="string"&&(n=$l(n));let{pathname:m="/",search:g="",hash:_="",state:v=null,key:x="default"}=n,S=C.useMemo(()=>{let E=ci(m,h);return E==null?null:{location:{pathname:E,search:g,hash:_,state:v,key:x},navigationType:r}},[h,m,g,_,v,x,r]);return pr(S!=null,`<Router basename="${h}"> is not able to match the URL "${m}${g}${_}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:C.createElement(_r.Provider,{value:f},C.createElement(Fu.Provider,{children:e,value:S}))}function iI({children:t,location:e}){return qR(Wg(t),e)}function Wg(t,e=[]){let n=[];return C.Children.forEach(t,(r,a)=>{if(!C.isValidElement(r))return;let o=[...e,a];if(r.type===C.Fragment){n.push.apply(n,Wg(r.props.children,o));return}Ut(r.type===fn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ut(!r.props.index||!r.props.children,"An index route cannot have child routes.");let u={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(u.children=Wg(r.props.children,o)),n.push(u)}),n}var Qh="get",Wh="application/x-www-form-urlencoded";function Vf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function aI(t){return Vf(t)&&t.tagName.toLowerCase()==="button"}function oI(t){return Vf(t)&&t.tagName.toLowerCase()==="form"}function lI(t){return Vf(t)&&t.tagName.toLowerCase()==="input"}function cI(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function uI(t,e){return t.button===0&&(!e||e==="_self")&&!cI(t)}function Kg(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(a=>[n,a]):[[n,r]])},[]))}function dI(t,e){let n=Kg(t);return e&&e.forEach((r,a)=>{n.has(a)||e.getAll(a).forEach(o=>{n.append(a,o)})}),n}var Bh=null;function hI(){if(Bh===null)try{new FormData(document.createElement("form"),0),Bh=!1}catch{Bh=!0}return Bh}var fI=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function jg(t){return t!=null&&!fI.has(t)?(pr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Wh}"`),null):t}function mI(t,e){let n,r,a,o,u;if(oI(t)){let h=t.getAttribute("action");r=h?ci(h,e):null,n=t.getAttribute("method")||Qh,a=jg(t.getAttribute("enctype"))||Wh,o=new FormData(t)}else if(aI(t)||lI(t)&&(t.type==="submit"||t.type==="image")){let h=t.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=t.getAttribute("formaction")||h.getAttribute("action");if(r=f?ci(f,e):null,n=t.getAttribute("formmethod")||h.getAttribute("method")||Qh,a=jg(t.getAttribute("formenctype"))||jg(h.getAttribute("enctype"))||Wh,o=new FormData(h,t),!hI()){let{name:m,type:g,value:_}=t;if(g==="image"){let v=m?`${m}.`:"";o.append(`${v}x`,"0"),o.append(`${v}y`,"0")}else m&&o.append(m,_)}}else{if(Vf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Qh,r=null,a=Wh,u=t}return o&&a==="text/plain"&&(u=o,o=void 0),{action:r,method:n.toLowerCase(),encType:a,formData:o,body:u}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Ly(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function pI(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&ci(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function gI(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function yI(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function _I(t,e,n){let r=await Promise.all(t.map(async a=>{let o=e.routes[a.route.id];if(o){let u=await gI(o,n);return u.links?u.links():[]}return[]}));return SI(r.flat(1).filter(yI).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function Ix(t,e,n,r,a,o){let u=(f,m)=>n[m]?f.route.id!==n[m].route.id:!0,h=(f,m)=>n[m].pathname!==f.pathname||n[m].route.path?.endsWith("*")&&n[m].params["*"]!==f.params["*"];return o==="assets"?e.filter((f,m)=>u(f,m)||h(f,m)):o==="data"?e.filter((f,m)=>{let g=r.routes[f.route.id];if(!g||!g.hasLoader)return!1;if(u(f,m)||h(f,m))return!0;if(f.route.shouldRevalidate){let _=f.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof _=="boolean")return _}return!0}):[]}function bI(t,e,{includeHydrateFallback:n}={}){return vI(t.map(r=>{let a=e.routes[r.route.id];if(!a)return[];let o=[a.module];return a.clientActionModule&&(o=o.concat(a.clientActionModule)),a.clientLoaderModule&&(o=o.concat(a.clientLoaderModule)),n&&a.hydrateFallbackModule&&(o=o.concat(a.hydrateFallbackModule)),a.imports&&(o=o.concat(a.imports)),o}).flat(1))}function vI(t){return[...new Set(t)]}function xI(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function SI(t,e){let n=new Set;return new Set(e),t.reduce((r,a)=>{let o=JSON.stringify(xI(a));return n.has(o)||(n.add(o),r.push({key:o,link:a})),r},[])}function gE(){let t=C.useContext(Hl);return Ly(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function wI(){let t=C.useContext(Uf);return Ly(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Uy=C.createContext(void 0);Uy.displayName="FrameworkContext";function yE(){let t=C.useContext(Uy);return Ly(t,"You must render this element inside a <HydratedRouter> element"),t}function EI(t,e){let n=C.useContext(Uy),[r,a]=C.useState(!1),[o,u]=C.useState(!1),{onFocus:h,onBlur:f,onMouseEnter:m,onMouseLeave:g,onTouchStart:_}=e,v=C.useRef(null);C.useEffect(()=>{if(t==="render"&&u(!0),t==="viewport"){let E=I=>{I.forEach(j=>{u(j.isIntersecting)})},T=new IntersectionObserver(E,{threshold:.5});return v.current&&T.observe(v.current),()=>{T.disconnect()}}},[t]),C.useEffect(()=>{if(r){let E=setTimeout(()=>{u(!0)},100);return()=>{clearTimeout(E)}}},[r]);let x=()=>{a(!0)},S=()=>{a(!1),u(!1)};return n?t!=="intent"?[o,v,{}]:[o,v,{onFocus:hu(h,x),onBlur:hu(f,S),onMouseEnter:hu(m,x),onMouseLeave:hu(g,S),onTouchStart:hu(_,x)}]:[!1,v,{}]}function hu(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function CI({page:t,...e}){let{router:n}=gE(),r=C.useMemo(()=>nE(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?C.createElement(AI,{page:t,matches:r,...e}):null}function TI(t){let{manifest:e,routeModules:n}=yE(),[r,a]=C.useState([]);return C.useEffect(()=>{let o=!1;return _I(t,e,n).then(u=>{o||a(u)}),()=>{o=!0}},[t,e,n]),r}function AI({page:t,matches:e,...n}){let r=Un(),{manifest:a,routeModules:o}=yE(),{basename:u}=gE(),{loaderData:h,matches:f}=wI(),m=C.useMemo(()=>Ix(t,e,f,a,r,"data"),[t,e,f,a,r]),g=C.useMemo(()=>Ix(t,e,f,a,r,"assets"),[t,e,f,a,r]),_=C.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let S=new Set,E=!1;if(e.forEach(I=>{let j=a.routes[I.route.id];!j||!j.hasLoader||(!m.some(M=>M.route.id===I.route.id)&&I.route.id in h&&o[I.route.id]?.shouldRevalidate||j.hasClientLoader?E=!0:S.add(I.route.id))}),S.size===0)return[];let T=pI(t,u,"data");return E&&S.size>0&&T.searchParams.set("_routes",e.filter(I=>S.has(I.route.id)).map(I=>I.route.id).join(",")),[T.pathname+T.search]},[u,h,r,a,m,e,t,o]),v=C.useMemo(()=>bI(g,a),[g,a]),x=TI(g);return C.createElement(C.Fragment,null,_.map(S=>C.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...n})),v.map(S=>C.createElement("link",{key:S,rel:"modulepreload",href:S,...n})),x.map(({key:S,link:E})=>C.createElement("link",{key:S,nonce:n.nonce,...E})))}function jI(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var RI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{RI&&(window.__reactRouterVersion="7.11.0")}catch{}function II({basename:t,children:e,unstable_useTransitions:n,window:r}){let a=C.useRef();a.current==null&&(a.current=aR({window:r,v5Compat:!0}));let o=a.current,[u,h]=C.useState({action:o.action,location:o.location}),f=C.useCallback(m=>{n===!1?h(m):C.startTransition(()=>h(m))},[n]);return C.useLayoutEffect(()=>o.listen(f),[o,f]),C.createElement(sI,{basename:t,children:e,location:u.location,navigationType:u.action,navigator:o,unstable_useTransitions:n})}var _E=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ft=C.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:a,reloadDocument:o,replace:u,state:h,target:f,to:m,preventScrollReset:g,viewTransition:_,unstable_defaultShouldRevalidate:v,...x},S){let{basename:E,unstable_useTransitions:T}=C.useContext(_r),I=typeof m=="string"&&_E.test(m),j=oE(m,E);m=j.to;let M=zR(m,{relative:a}),[Q,H,W]=EI(r,x),D=OI(m,{replace:u,state:h,target:f,preventScrollReset:g,relative:a,viewTransition:_,unstable_defaultShouldRevalidate:v,unstable_useTransitions:T});function A(P){e&&e(P),P.defaultPrevented||D(P)}let N=C.createElement("a",{...x,...W,href:j.absoluteURL||M,onClick:j.isExternal||o?e:A,ref:jI(S,H),target:f,"data-discover":!I&&n==="render"?"true":void 0});return Q&&!I?C.createElement(C.Fragment,null,N,C.createElement(CI,{page:M})):N});Ft.displayName="Link";var DI=C.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:a=!1,style:o,to:u,viewTransition:h,children:f,...m},g){let _=$u(u,{relative:m.relative}),v=Un(),x=C.useContext(Uf),{navigator:S,basename:E}=C.useContext(_r),T=x!=null&&UI(_)&&h===!0,I=S.encodeLocation?S.encodeLocation(_).pathname:_.pathname,j=v.pathname,M=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;n||(j=j.toLowerCase(),M=M?M.toLowerCase():null,I=I.toLowerCase()),M&&E&&(M=ci(M,E)||M);const Q=I!=="/"&&I.endsWith("/")?I.length-1:I.length;let H=j===I||!a&&j.startsWith(I)&&j.charAt(Q)==="/",W=M!=null&&(M===I||!a&&M.startsWith(I)&&M.charAt(I.length)==="/"),D={isActive:H,isPending:W,isTransitioning:T},A=H?e:void 0,N;typeof r=="function"?N=r(D):N=[r,H?"active":null,W?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let P=typeof o=="function"?o(D):o;return C.createElement(Ft,{...m,"aria-current":A,className:N,ref:g,style:P,to:u,viewTransition:h},typeof f=="function"?f(D):f)});DI.displayName="NavLink";var MI=C.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:a,state:o,method:u=Qh,action:h,onSubmit:f,relative:m,preventScrollReset:g,viewTransition:_,unstable_defaultShouldRevalidate:v,...x},S)=>{let{unstable_useTransitions:E}=C.useContext(_r),T=BI(),I=LI(h,{relative:m}),j=u.toLowerCase()==="get"?"get":"post",M=typeof h=="string"&&_E.test(h),Q=H=>{if(f&&f(H),H.defaultPrevented)return;H.preventDefault();let W=H.nativeEvent.submitter,D=W?.getAttribute("formmethod")||u,A=()=>T(W||H.currentTarget,{fetcherKey:e,method:D,navigate:n,replace:a,state:o,relative:m,preventScrollReset:g,viewTransition:_,unstable_defaultShouldRevalidate:v});E&&n!==!1?C.startTransition(()=>A()):A()};return C.createElement("form",{ref:S,method:j,action:I,onSubmit:r?f:Q,...x,"data-discover":!M&&t==="render"?"true":void 0})});MI.displayName="Form";function kI(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function bE(t){let e=C.useContext(Hl);return Ut(e,kI(t)),e}function OI(t,{target:e,replace:n,state:r,preventScrollReset:a,relative:o,viewTransition:u,unstable_defaultShouldRevalidate:h,unstable_useTransitions:f}={}){let m=Vu(),g=Un(),_=$u(t,{relative:o});return C.useCallback(v=>{if(uI(v,e)){v.preventDefault();let x=n!==void 0?n:Cu(g)===Cu(_),S=()=>m(t,{replace:x,state:r,preventScrollReset:a,relative:o,viewTransition:u,unstable_defaultShouldRevalidate:h});f?C.startTransition(()=>S()):S()}},[g,m,_,n,r,e,t,a,o,u,h,f])}function vE(t){pr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=C.useRef(Kg(t)),n=C.useRef(!1),r=Un(),a=C.useMemo(()=>dI(r.search,n.current?null:e.current),[r.search]),o=Vu(),u=C.useCallback((h,f)=>{const m=Kg(typeof h=="function"?h(new URLSearchParams(a)):h);n.current=!0,o("?"+m,f)},[o,a]);return[a,u]}var NI=0,PI=()=>`__${String(++NI)}__`;function BI(){let{router:t}=bE("useSubmit"),{basename:e}=C.useContext(_r),n=eI(),r=t.fetch,a=t.navigate;return C.useCallback(async(o,u={})=>{let{action:h,method:f,encType:m,formData:g,body:_}=mI(o,e);if(u.navigate===!1){let v=u.fetcherKey||PI();await r(v,n,u.action||h,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:g,body:_,formMethod:u.method||f,formEncType:u.encType||m,flushSync:u.flushSync})}else await a(u.action||h,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:g,body:_,formMethod:u.method||f,formEncType:u.encType||m,replace:u.replace,state:u.state,fromRouteId:n,flushSync:u.flushSync,viewTransition:u.viewTransition})},[r,a,e,n])}function LI(t,{relative:e}={}){let{basename:n}=C.useContext(_r),r=C.useContext(Pr);Ut(r,"useFormAction must be used inside a RouteContext");let[a]=r.matches.slice(-1),o={...$u(t||".",{relative:e})},u=Un();if(t==null){o.search=u.search;let h=new URLSearchParams(o.search),f=h.getAll("index");if(f.some(g=>g==="")){h.delete("index"),f.filter(_=>_).forEach(_=>h.append("index",_));let g=h.toString();o.search=g?`?${g}`:""}}return(!t||t===".")&&a.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:oi([n,o.pathname])),Cu(o)}function UI(t,{relative:e}={}){let n=C.useContext(cE);Ut(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=bE("useViewTransitionState"),a=$u(t,{relative:e});if(!n.isTransitioning)return!1;let o=ci(n.currentLocation.pathname,r)||n.currentLocation.pathname,u=ci(n.nextLocation.pathname,r)||n.nextLocation.pathname;return lf(a.pathname,u)!=null||lf(a.pathname,o)!=null}const zI={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},xE=C.createContext(zI);function FI({children:t}){const[e,n]=C.useState(new Map),r=C.useCallback((f,m)=>{n(g=>new Map(g).set(f,m))},[]),a=C.useCallback(f=>{n(m=>{const g=new Map(m);return g.delete(f),g})},[]),o=e.size>0,u=e.size>0&&Array.from(e.values()).pop()||"Loading...",h={isLoading:o,loadingMessage:u,addLoadingHold:r,removeLoadingHold:a};return c.jsx(xE.Provider,{value:h,children:t})}function sr(){const t=C.useContext(xE);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const VI=()=>{};var Dx={};const SE=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let a=t.charCodeAt(r);a<128?e[n++]=a:a<2048?(e[n++]=a>>6|192,e[n++]=a&63|128):(a&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(a=65536+((a&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=a>>18|240,e[n++]=a>>12&63|128,e[n++]=a>>6&63|128,e[n++]=a&63|128):(e[n++]=a>>12|224,e[n++]=a>>6&63|128,e[n++]=a&63|128)}return e},$I=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const a=t[n++];if(a<128)e[r++]=String.fromCharCode(a);else if(a>191&&a<224){const o=t[n++];e[r++]=String.fromCharCode((a&31)<<6|o&63)}else if(a>239&&a<365){const o=t[n++],u=t[n++],h=t[n++],f=((a&7)<<18|(o&63)<<12|(u&63)<<6|h&63)-65536;e[r++]=String.fromCharCode(55296+(f>>10)),e[r++]=String.fromCharCode(56320+(f&1023))}else{const o=t[n++],u=t[n++];e[r++]=String.fromCharCode((a&15)<<12|(o&63)<<6|u&63)}}return e.join("")},wE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let a=0;a<t.length;a+=3){const o=t[a],u=a+1<t.length,h=u?t[a+1]:0,f=a+2<t.length,m=f?t[a+2]:0,g=o>>2,_=(o&3)<<4|h>>4;let v=(h&15)<<2|m>>6,x=m&63;f||(x=64,u||(v=64)),r.push(n[g],n[_],n[v],n[x])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(SE(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):$I(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let a=0;a<t.length;){const o=n[t.charAt(a++)],h=a<t.length?n[t.charAt(a)]:0;++a;const m=a<t.length?n[t.charAt(a)]:64;++a;const _=a<t.length?n[t.charAt(a)]:64;if(++a,o==null||h==null||m==null||_==null)throw new HI;const v=o<<2|h>>4;if(r.push(v),m!==64){const x=h<<4&240|m>>2;if(r.push(x),_!==64){const S=m<<6&192|_;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class HI extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const qI=function(t){const e=SE(t);return wE.encodeByteArray(e,!0)},cf=function(t){return qI(t).replace(/\./g,"")},EE=function(t){try{return wE.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function GI(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const QI=()=>GI().__FIREBASE_DEFAULTS__,WI=()=>{if(typeof process>"u"||typeof Dx>"u")return;const t=Dx.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},KI=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&EE(t[1]);return e&&JSON.parse(e)},$f=()=>{try{return VI()||QI()||WI()||KI()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},CE=t=>$f()?.emulatorHosts?.[t],YI=t=>{const e=CE(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},TE=()=>$f()?.config,AE=t=>$f()?.[`_${t}`];class XI{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function Gl(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function jE(t){return(await fetch(t,{credentials:"include"})).ok}function JI(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",a=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const u={iss:`https://securetoken.google.com/${r}`,aud:r,iat:a,exp:a+3600,auth_time:a,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[cf(JSON.stringify(n)),cf(JSON.stringify(u)),""].join(".")}const bu={};function ZI(){const t={prod:[],emulator:[]};for(const e of Object.keys(bu))bu[e]?t.emulator.push(e):t.prod.push(e);return t}function e5(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Mx=!1;function RE(t,e){if(typeof window>"u"||typeof document>"u"||!Gl(window.location.host)||bu[t]===e||bu[t]||Mx)return;bu[t]=e;function n(v){return`__firebase__banner__${v}`}const r="__firebase__banner",o=ZI().prod.length>0;function u(){const v=document.getElementById(r);v&&v.remove()}function h(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function f(v,x){v.setAttribute("width","24"),v.setAttribute("id",x),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function m(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Mx=!0,u()},v}function g(v,x){v.setAttribute("id",x),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function _(){const v=e5(r),x=n("text"),S=document.getElementById(x)||document.createElement("span"),E=n("learnmore"),T=document.getElementById(E)||document.createElement("a"),I=n("preprendIcon"),j=document.getElementById(I)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const M=v.element;h(M),g(T,E);const Q=m();f(j,I),M.append(j,S,T,Q),document.body.appendChild(M)}o?(S.innerText="Preview backend disconnected.",j.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(j.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",x)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}function Ln(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function t5(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ln())}function n5(){const t=$f()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function r5(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function s5(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function i5(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function a5(){const t=Ln();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function o5(){return!n5()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function l5(){try{return typeof indexedDB=="object"}catch{return!1}}function c5(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(r);a.onsuccess=()=>{a.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},a.onupgradeneeded=()=>{n=!1},a.onerror=()=>{e(a.error?.message||"")}}catch(n){e(n)}})}const u5="FirebaseError";class gi extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=u5,Object.setPrototypeOf(this,gi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Hu.prototype.create)}}class Hu{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},a=`${this.service}/${e}`,o=this.errors[e],u=o?d5(o,r):"Error",h=`${this.serviceName}: ${u} (${a}).`;return new gi(a,h,r)}}function d5(t,e){return t.replace(h5,(n,r)=>{const a=e[r];return a!=null?String(a):`<${r}?>`})}const h5=/\{\$([^}]+)}/g;function f5(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function ha(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const a of n){if(!r.includes(a))return!1;const o=t[a],u=e[a];if(kx(o)&&kx(u)){if(!ha(o,u))return!1}else if(o!==u)return!1}for(const a of r)if(!n.includes(a))return!1;return!0}function kx(t){return t!==null&&typeof t=="object"}function qu(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(a=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function fu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[a,o]=r.split("=");e[decodeURIComponent(a)]=decodeURIComponent(o)}}),e}function mu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function m5(t,e){const n=new p5(t,e);return n.subscribe.bind(n)}class p5{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let a;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");g5(e,["next","error","complete"])?a=e:a={next:e,error:n,complete:r},a.next===void 0&&(a.next=Rg),a.error===void 0&&(a.error=Rg),a.complete===void 0&&(a.complete=Rg);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function g5(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Rg(){}function un(t){return t&&t._delegate?t._delegate:t}class fo{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ao="[DEFAULT]";class y5{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new XI;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:n});a&&r.resolve(a)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(r)return null;throw a}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(b5(e))try{this.getOrInitializeService({instanceIdentifier:ao})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:a});r.resolve(o)}catch{}}}}clearInstance(e=ao){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ao){return this.instances.has(e)}getOptions(e=ao){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,u]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(o);r===h&&u.resolve(a)}return a}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),a=this.onInitCallbacks.get(r)??new Set;a.add(e),this.onInitCallbacks.set(r,a);const o=this.instances.get(r);return o&&e(o,r),()=>{a.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const a of r)try{a(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:_5(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ao){return this.component?this.component.multipleInstances?e:ao:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function _5(t){return t===ao?void 0:t}function b5(t){return t.instantiationMode==="EAGER"}class v5{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new y5(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var rt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(rt||(rt={}));const x5={debug:rt.DEBUG,verbose:rt.VERBOSE,info:rt.INFO,warn:rt.WARN,error:rt.ERROR,silent:rt.SILENT},S5=rt.INFO,w5={[rt.DEBUG]:"log",[rt.VERBOSE]:"log",[rt.INFO]:"info",[rt.WARN]:"warn",[rt.ERROR]:"error"},E5=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),a=w5[e];if(a)console[a](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class zy{constructor(e){this.name=e,this._logLevel=S5,this._logHandler=E5,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in rt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?x5[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,rt.DEBUG,...e),this._logHandler(this,rt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,rt.VERBOSE,...e),this._logHandler(this,rt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,rt.INFO,...e),this._logHandler(this,rt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,rt.WARN,...e),this._logHandler(this,rt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,rt.ERROR,...e),this._logHandler(this,rt.ERROR,...e)}}const C5=(t,e)=>e.some(n=>t instanceof n);let Ox,Nx;function T5(){return Ox||(Ox=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function A5(){return Nx||(Nx=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const IE=new WeakMap,Yg=new WeakMap,DE=new WeakMap,Ig=new WeakMap,Fy=new WeakMap;function j5(t){const e=new Promise((n,r)=>{const a=()=>{t.removeEventListener("success",o),t.removeEventListener("error",u)},o=()=>{n(ia(t.result)),a()},u=()=>{r(t.error),a()};t.addEventListener("success",o),t.addEventListener("error",u)});return e.then(n=>{n instanceof IDBCursor&&IE.set(n,t)}).catch(()=>{}),Fy.set(e,t),e}function R5(t){if(Yg.has(t))return;const e=new Promise((n,r)=>{const a=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",u),t.removeEventListener("abort",u)},o=()=>{n(),a()},u=()=>{r(t.error||new DOMException("AbortError","AbortError")),a()};t.addEventListener("complete",o),t.addEventListener("error",u),t.addEventListener("abort",u)});Yg.set(t,e)}let Xg={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Yg.get(t);if(e==="objectStoreNames")return t.objectStoreNames||DE.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ia(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function I5(t){Xg=t(Xg)}function D5(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Dg(this),e,...n);return DE.set(r,e.sort?e.sort():[e]),ia(r)}:A5().includes(t)?function(...e){return t.apply(Dg(this),e),ia(IE.get(this))}:function(...e){return ia(t.apply(Dg(this),e))}}function M5(t){return typeof t=="function"?D5(t):(t instanceof IDBTransaction&&R5(t),C5(t,T5())?new Proxy(t,Xg):t)}function ia(t){if(t instanceof IDBRequest)return j5(t);if(Ig.has(t))return Ig.get(t);const e=M5(t);return e!==t&&(Ig.set(t,e),Fy.set(e,t)),e}const Dg=t=>Fy.get(t);function k5(t,e,{blocked:n,upgrade:r,blocking:a,terminated:o}={}){const u=indexedDB.open(t,e),h=ia(u);return r&&u.addEventListener("upgradeneeded",f=>{r(ia(u.result),f.oldVersion,f.newVersion,ia(u.transaction),f)}),n&&u.addEventListener("blocked",f=>n(f.oldVersion,f.newVersion,f)),h.then(f=>{o&&f.addEventListener("close",()=>o()),a&&f.addEventListener("versionchange",m=>a(m.oldVersion,m.newVersion,m))}).catch(()=>{}),h}const O5=["get","getKey","getAll","getAllKeys","count"],N5=["put","add","delete","clear"],Mg=new Map;function Px(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Mg.get(e))return Mg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,a=N5.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(a||O5.includes(n)))return;const o=async function(u,...h){const f=this.transaction(u,a?"readwrite":"readonly");let m=f.store;return r&&(m=m.index(h.shift())),(await Promise.all([m[n](...h),a&&f.done]))[0]};return Mg.set(e,o),o}I5(t=>({...t,get:(e,n,r)=>Px(e,n)||t.get(e,n,r),has:(e,n)=>!!Px(e,n)||t.has(e,n)}));class P5{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(B5(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function B5(t){return t.getComponent()?.type==="VERSION"}const Jg="@firebase/app",Bx="0.14.6";const ui=new zy("@firebase/app"),L5="@firebase/app-compat",U5="@firebase/analytics-compat",z5="@firebase/analytics",F5="@firebase/app-check-compat",V5="@firebase/app-check",$5="@firebase/auth",H5="@firebase/auth-compat",q5="@firebase/database",G5="@firebase/data-connect",Q5="@firebase/database-compat",W5="@firebase/functions",K5="@firebase/functions-compat",Y5="@firebase/installations",X5="@firebase/installations-compat",J5="@firebase/messaging",Z5="@firebase/messaging-compat",eD="@firebase/performance",tD="@firebase/performance-compat",nD="@firebase/remote-config",rD="@firebase/remote-config-compat",sD="@firebase/storage",iD="@firebase/storage-compat",aD="@firebase/firestore",oD="@firebase/ai",lD="@firebase/firestore-compat",cD="firebase",uD="12.6.0";const Zg="[DEFAULT]",dD={[Jg]:"fire-core",[L5]:"fire-core-compat",[z5]:"fire-analytics",[U5]:"fire-analytics-compat",[V5]:"fire-app-check",[F5]:"fire-app-check-compat",[$5]:"fire-auth",[H5]:"fire-auth-compat",[q5]:"fire-rtdb",[G5]:"fire-data-connect",[Q5]:"fire-rtdb-compat",[W5]:"fire-fn",[K5]:"fire-fn-compat",[Y5]:"fire-iid",[X5]:"fire-iid-compat",[J5]:"fire-fcm",[Z5]:"fire-fcm-compat",[eD]:"fire-perf",[tD]:"fire-perf-compat",[nD]:"fire-rc",[rD]:"fire-rc-compat",[sD]:"fire-gcs",[iD]:"fire-gcs-compat",[aD]:"fire-fst",[lD]:"fire-fst-compat",[oD]:"fire-vertex","fire-js":"fire-js",[cD]:"fire-js-all"};const uf=new Map,hD=new Map,ey=new Map;function Lx(t,e){try{t.container.addComponent(e)}catch(n){ui.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Dl(t){const e=t.name;if(ey.has(e))return ui.debug(`There were multiple attempts to register component ${e}.`),!1;ey.set(e,t);for(const n of uf.values())Lx(n,t);for(const n of hD.values())Lx(n,t);return!0}function Vy(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Yr(t){return t==null?!1:t.settings!==void 0}const fD={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},aa=new Hu("app","Firebase",fD);class mD{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new fo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw aa.create("app-deleted",{appName:this._name})}}const Ql=uD;function ME(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Zg,automaticDataCollectionEnabled:!0,...e},a=r.name;if(typeof a!="string"||!a)throw aa.create("bad-app-name",{appName:String(a)});if(n||(n=TE()),!n)throw aa.create("no-options");const o=uf.get(a);if(o){if(ha(n,o.options)&&ha(r,o.config))return o;throw aa.create("duplicate-app",{appName:a})}const u=new v5(a);for(const f of ey.values())u.addComponent(f);const h=new mD(n,r,u);return uf.set(a,h),h}function kE(t=Zg){const e=uf.get(t);if(!e&&t===Zg&&TE())return ME();if(!e)throw aa.create("no-app",{appName:t});return e}function oa(t,e,n){let r=dD[t]??t;n&&(r+=`-${n}`);const a=r.match(/\s|\//),o=e.match(/\s|\//);if(a||o){const u=[`Unable to register library "${r}" with version "${e}":`];a&&u.push(`library name "${r}" contains illegal characters (whitespace or "/")`),a&&o&&u.push("and"),o&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ui.warn(u.join(" "));return}Dl(new fo(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const pD="firebase-heartbeat-database",gD=1,Tu="firebase-heartbeat-store";let kg=null;function OE(){return kg||(kg=k5(pD,gD,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Tu)}catch(n){console.warn(n)}}}}).catch(t=>{throw aa.create("idb-open",{originalErrorMessage:t.message})})),kg}async function yD(t){try{const n=(await OE()).transaction(Tu),r=await n.objectStore(Tu).get(NE(t));return await n.done,r}catch(e){if(e instanceof gi)ui.warn(e.message);else{const n=aa.create("idb-get",{originalErrorMessage:e?.message});ui.warn(n.message)}}}async function Ux(t,e){try{const r=(await OE()).transaction(Tu,"readwrite");await r.objectStore(Tu).put(e,NE(t)),await r.done}catch(n){if(n instanceof gi)ui.warn(n.message);else{const r=aa.create("idb-set",{originalErrorMessage:n?.message});ui.warn(r.message)}}}function NE(t){return`${t.name}!${t.options.appId}`}const _D=1024,bD=30;class vD{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new SD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=zx();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(a=>a.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>bD){const a=wD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ui.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=zx(),{heartbeatsToSend:n,unsentEntries:r}=xD(this._heartbeatsCache.heartbeats),a=cf(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(e){return ui.warn(e),""}}}function zx(){return new Date().toISOString().substring(0,10)}function xD(t,e=_D){const n=[];let r=t.slice();for(const a of t){const o=n.find(u=>u.agent===a.agent);if(o){if(o.dates.push(a.date),Fx(n)>e){o.dates.pop();break}}else if(n.push({agent:a.agent,dates:[a.date]}),Fx(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class SD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return l5()?c5().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await yD(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ux(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ux(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Fx(t){return cf(JSON.stringify({version:2,heartbeats:t})).length}function wD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function ED(t){Dl(new fo("platform-logger",e=>new P5(e),"PRIVATE")),Dl(new fo("heartbeat",e=>new vD(e),"PRIVATE")),oa(Jg,Bx,t),oa(Jg,Bx,"esm2020"),oa("fire-js","")}ED("");function PE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const CD=PE,BE=new Hu("auth","Firebase",PE());const df=new zy("@firebase/auth");function TD(t,...e){df.logLevel<=rt.WARN&&df.warn(`Auth (${Ql}): ${t}`,...e)}function Kh(t,...e){df.logLevel<=rt.ERROR&&df.error(`Auth (${Ql}): ${t}`,...e)}function es(t,...e){throw $y(t,...e)}function Rs(t,...e){return $y(t,...e)}function LE(t,e,n){const r={...CD(),[e]:n};return new Hu("auth","Firebase",r).create(e,{appName:t.name})}function la(t){return LE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function $y(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return BE.create(t,...e)}function Fe(t,e,...n){if(!t)throw $y(e,...n)}function si(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Kh(e),new Error(e)}function di(t,e){t||si(e)}function ty(){return typeof self<"u"&&self.location?.href||""}function AD(){return Vx()==="http:"||Vx()==="https:"}function Vx(){return typeof self<"u"&&self.location?.protocol||null}function jD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(AD()||s5()||"connection"in navigator)?navigator.onLine:!0}function RD(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class Gu{constructor(e,n){this.shortDelay=e,this.longDelay=n,di(n>e,"Short delay should be less than long delay!"),this.isMobile=t5()||i5()}get(){return jD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Hy(t,e){di(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class UE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;si("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;si("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;si("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ID={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const DD=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],MD=new Gu(3e4,6e4);function xo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function xa(t,e,n,r,a={}){return zE(t,a,async()=>{let o={},u={};r&&(e==="GET"?u=r:o={body:JSON.stringify(r)});const h=qu({key:t.config.apiKey,...u}).slice(1),f=await t._getAdditionalHeaders();f["Content-Type"]="application/json",t.languageCode&&(f["X-Firebase-Locale"]=t.languageCode);const m={method:e,headers:f,...o};return r5()||(m.referrerPolicy="no-referrer"),t.emulatorConfig&&Gl(t.emulatorConfig.host)&&(m.credentials="include"),UE.fetch()(await FE(t,t.config.apiHost,n,h),m)})}async function zE(t,e,n){t._canInitEmulator=!1;const r={...ID,...e};try{const a=new OD(t),o=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();const u=await o.json();if("needConfirmation"in u)throw Lh(t,"account-exists-with-different-credential",u);if(o.ok&&!("errorMessage"in u))return u;{const h=o.ok?u.errorMessage:u.error.message,[f,m]=h.split(" : ");if(f==="FEDERATED_USER_ID_ALREADY_LINKED")throw Lh(t,"credential-already-in-use",u);if(f==="EMAIL_EXISTS")throw Lh(t,"email-already-in-use",u);if(f==="USER_DISABLED")throw Lh(t,"user-disabled",u);const g=r[f]||f.toLowerCase().replace(/[_\s]+/g,"-");if(m)throw LE(t,g,m);es(t,g)}}catch(a){if(a instanceof gi)throw a;es(t,"network-request-failed",{message:String(a)})}}async function Hf(t,e,n,r,a={}){const o=await xa(t,e,n,r,a);return"mfaPendingCredential"in o&&es(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function FE(t,e,n,r){const a=`${e}${n}?${r}`,o=t,u=o.config.emulator?Hy(t.config,a):`${t.config.apiScheme}://${a}`;return DD.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(u).toString():u}function kD(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class OD{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Rs(this.auth,"network-request-failed")),MD.get())})}}function Lh(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const a=Rs(t,e,r);return a.customData._tokenResponse=n,a}function $x(t){return t!==void 0&&t.enterprise!==void 0}class ND{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return kD(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function PD(t,e){return xa(t,"GET","/v2/recaptchaConfig",xo(t,e))}async function BD(t,e){return xa(t,"POST","/v1/accounts:delete",e)}async function hf(t,e){return xa(t,"POST","/v1/accounts:lookup",e)}function vu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function LD(t,e=!1){const n=un(t),r=await n.getIdToken(e),a=qy(r);Fe(a&&a.exp&&a.auth_time&&a.iat,n.auth,"internal-error");const o=typeof a.firebase=="object"?a.firebase:void 0,u=o?.sign_in_provider;return{claims:a,token:r,authTime:vu(Og(a.auth_time)),issuedAtTime:vu(Og(a.iat)),expirationTime:vu(Og(a.exp)),signInProvider:u||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Og(t){return Number(t)*1e3}function qy(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Kh("JWT malformed, contained fewer than 3 sections"),null;try{const a=EE(n);return a?JSON.parse(a):(Kh("Failed to decode base64 JWT payload"),null)}catch(a){return Kh("Caught error parsing JWT payload as JSON",a?.toString()),null}}function Hx(t){const e=qy(t);return Fe(e,"internal-error"),Fe(typeof e.exp<"u","internal-error"),Fe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Au(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof gi&&UD(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function UD({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class zD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class ny{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=vu(this.lastLoginAt),this.creationTime=vu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ff(t){const e=t.auth,n=await t.getIdToken(),r=await Au(t,hf(e,{idToken:n}));Fe(r?.users.length,e,"internal-error");const a=r.users[0];t._notifyReloadListener(a);const o=a.providerUserInfo?.length?VE(a.providerUserInfo):[],u=VD(t.providerData,o),h=t.isAnonymous,f=!(t.email&&a.passwordHash)&&!u?.length,m=h?f:!1,g={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:u,metadata:new ny(a.createdAt,a.lastLoginAt),isAnonymous:m};Object.assign(t,g)}async function FD(t){const e=un(t);await ff(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function VD(t,e){return[...t.filter(r=>!e.some(a=>a.providerId===r.providerId)),...e]}function VE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function $D(t,e){const n=await zE(t,{},async()=>{const r=qu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:o}=t.config,u=await FE(t,a,"/v1/token",`key=${o}`),h=await t._getAdditionalHeaders();h["Content-Type"]="application/x-www-form-urlencoded";const f={method:"POST",headers:h,body:r};return t.emulatorConfig&&Gl(t.emulatorConfig.host)&&(f.credentials="include"),UE.fetch()(u,f)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function HD(t,e){return xa(t,"POST","/v2/accounts:revokeToken",xo(t,e))}class Tl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Fe(e.idToken,"internal-error"),Fe(typeof e.idToken<"u","internal-error"),Fe(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Hx(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Fe(e.length!==0,"internal-error");const n=Hx(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Fe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:a,expiresIn:o}=await $D(e,n);this.updateTokensAndExpiration(r,a,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:a,expirationTime:o}=n,u=new Tl;return r&&(Fe(typeof r=="string","internal-error",{appName:e}),u.refreshToken=r),a&&(Fe(typeof a=="string","internal-error",{appName:e}),u.accessToken=a),o&&(Fe(typeof o=="number","internal-error",{appName:e}),u.expirationTime=o),u}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Tl,this.toJSON())}_performRefresh(){return si("not implemented")}}function Xi(t,e){Fe(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Xr{constructor({uid:e,auth:n,stsTokenManager:r,...a}){this.providerId="firebase",this.proactiveRefresh=new zD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new ny(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const n=await Au(this,this.stsTokenManager.getToken(this.auth,e));return Fe(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return LD(this,e)}reload(){return FD(this)}_assign(e){this!==e&&(Fe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Xr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Fe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await ff(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Yr(this.auth.app))return Promise.reject(la(this.auth));const e=await this.getIdToken();return await Au(this,BD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,a=n.email??void 0,o=n.phoneNumber??void 0,u=n.photoURL??void 0,h=n.tenantId??void 0,f=n._redirectEventId??void 0,m=n.createdAt??void 0,g=n.lastLoginAt??void 0,{uid:_,emailVerified:v,isAnonymous:x,providerData:S,stsTokenManager:E}=n;Fe(_&&E,e,"internal-error");const T=Tl.fromJSON(this.name,E);Fe(typeof _=="string",e,"internal-error"),Xi(r,e.name),Xi(a,e.name),Fe(typeof v=="boolean",e,"internal-error"),Fe(typeof x=="boolean",e,"internal-error"),Xi(o,e.name),Xi(u,e.name),Xi(h,e.name),Xi(f,e.name),Xi(m,e.name),Xi(g,e.name);const I=new Xr({uid:_,auth:e,email:a,emailVerified:v,displayName:r,isAnonymous:x,photoURL:u,phoneNumber:o,tenantId:h,stsTokenManager:T,createdAt:m,lastLoginAt:g});return S&&Array.isArray(S)&&(I.providerData=S.map(j=>({...j}))),f&&(I._redirectEventId=f),I}static async _fromIdTokenResponse(e,n,r=!1){const a=new Tl;a.updateFromServerResponse(n);const o=new Xr({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:r});return await ff(o),o}static async _fromGetAccountInfoResponse(e,n,r){const a=n.users[0];Fe(a.localId!==void 0,"internal-error");const o=a.providerUserInfo!==void 0?VE(a.providerUserInfo):[],u=!(a.email&&a.passwordHash)&&!o?.length,h=new Tl;h.updateFromIdToken(r);const f=new Xr({uid:a.localId,auth:e,stsTokenManager:h,isAnonymous:u}),m={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:o,metadata:new ny(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!o?.length};return Object.assign(f,m),f}}const qx=new Map;function ii(t){di(t instanceof Function,"Expected a class definition");let e=qx.get(t);return e?(di(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,qx.set(t,e),e)}class $E{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}$E.type="NONE";const Gx=$E;function Yh(t,e,n){return`firebase:${t}:${e}:${n}`}class Al{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:a,name:o}=this.auth;this.fullUserKey=Yh(this.userKey,a.apiKey,o),this.fullPersistenceKey=Yh("persistence",a.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await hf(this.auth,{idToken:e}).catch(()=>{});return n?Xr._fromGetAccountInfoResponse(this.auth,n,e):null}return Xr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Al(ii(Gx),e,r);const a=(await Promise.all(n.map(async m=>{if(await m._isAvailable())return m}))).filter(m=>m);let o=a[0]||ii(Gx);const u=Yh(r,e.config.apiKey,e.name);let h=null;for(const m of n)try{const g=await m._get(u);if(g){let _;if(typeof g=="string"){const v=await hf(e,{idToken:g}).catch(()=>{});if(!v)break;_=await Xr._fromGetAccountInfoResponse(e,v,g)}else _=Xr._fromJSON(e,g);m!==o&&(h=_),o=m;break}}catch{}const f=a.filter(m=>m._shouldAllowMigration);return!o._shouldAllowMigration||!f.length?new Al(o,e,r):(o=f[0],h&&await o._set(u,h.toJSON()),await Promise.all(n.map(async m=>{if(m!==o)try{await m._remove(u)}catch{}})),new Al(o,e,r))}}function Qx(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(QE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(HE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(KE(e))return"Blackberry";if(YE(e))return"Webos";if(qE(e))return"Safari";if((e.includes("chrome/")||GE(e))&&!e.includes("edge/"))return"Chrome";if(WE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function HE(t=Ln()){return/firefox\//i.test(t)}function qE(t=Ln()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function GE(t=Ln()){return/crios\//i.test(t)}function QE(t=Ln()){return/iemobile/i.test(t)}function WE(t=Ln()){return/android/i.test(t)}function KE(t=Ln()){return/blackberry/i.test(t)}function YE(t=Ln()){return/webos/i.test(t)}function Gy(t=Ln()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function qD(t=Ln()){return Gy(t)&&!!window.navigator?.standalone}function GD(){return a5()&&document.documentMode===10}function XE(t=Ln()){return Gy(t)||WE(t)||YE(t)||KE(t)||/windows phone/i.test(t)||QE(t)}function JE(t,e=[]){let n;switch(t){case"Browser":n=Qx(Ln());break;case"Worker":n=`${Qx(Ln())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ql}/${r}`}class QD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((u,h)=>{try{const f=e(o);u(f)}catch(f){h(f)}});r.onAbort=n,this.queue.push(r);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const a of n)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function WD(t,e={}){return xa(t,"GET","/v2/passwordPolicy",xo(t,e))}const KD=6;class YD{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??KD,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),a&&(n.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let a=0;a<e.length;a++)r=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,a,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class XD{constructor(e,n,r,a){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Wx(this),this.idTokenSubscription=new Wx(this),this.beforeStateQueue=new QD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=BE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=ii(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Al.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await hf(this,{idToken:e}),r=await Xr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Yr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(u,u))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,u=r?._redirectEventId,h=await this.tryRedirectSignIn(e);(!o||o===u)&&h?.user&&(r=h.user,a=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Fe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await ff(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=RD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Yr(this.app))return Promise.reject(la(this));const n=e?un(e):null;return n&&Fe(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Fe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Yr(this.app)?Promise.reject(la(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Yr(this.app)?Promise.reject(la(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ii(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await WD(this),n=new YD(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Hu("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await HD(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&ii(e)||this._popupRedirectResolver;Fe(n,this,"argument-error"),this.redirectPersistenceManager=await Al.create(this,[ii(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,a){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let u=!1;const h=this._isInitialized?Promise.resolve():this._initializationPromise;if(Fe(h,this,"internal-error"),h.then(()=>{u||o(this.currentUser)}),typeof n=="function"){const f=e.addObserver(n,r,a);return()=>{u=!0,f()}}else{const f=e.addObserver(n);return()=>{u=!0,f()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Fe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=JE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Yr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&TD(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Wl(t){return un(t)}class Wx{constructor(e){this.auth=e,this.observer=null,this.addObserver=m5(n=>this.observer=n)}get next(){return Fe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let qf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function JD(t){qf=t}function ZE(t){return qf.loadJS(t)}function ZD(){return qf.recaptchaEnterpriseScript}function eM(){return qf.gapiScript}function tM(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class nM{constructor(){this.enterprise=new rM}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class rM{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const sM="recaptcha-enterprise",e1="NO_RECAPTCHA";class iM{constructor(e){this.type=sM,this.auth=Wl(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(u,h)=>{PD(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(f=>{if(f.recaptchaKey===void 0)h(new Error("recaptcha Enterprise site key undefined"));else{const m=new ND(f);return o.tenantId==null?o._agentRecaptchaConfig=m:o._tenantRecaptchaConfigs[o.tenantId]=m,u(m.siteKey)}}).catch(f=>{h(f)})})}function a(o,u,h){const f=window.grecaptcha;$x(f)?f.enterprise.ready(()=>{f.enterprise.execute(o,{action:e}).then(m=>{u(m)}).catch(()=>{u(e1)})}):h(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new nM().execute("siteKey",{action:"verify"}):new Promise((o,u)=>{r(this.auth).then(h=>{if(!n&&$x(window.grecaptcha))a(h,o,u);else{if(typeof window>"u"){u(new Error("RecaptchaVerifier is only supported in browser"));return}let f=ZD();f.length!==0&&(f+=h),ZE(f).then(()=>{a(h,o,u)}).catch(m=>{u(m)})}}).catch(h=>{u(h)})})}}async function Kx(t,e,n,r=!1,a=!1){const o=new iM(t);let u;if(a)u=e1;else try{u=await o.verify(n)}catch{u=await o.verify(n,!0)}const h={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in h){const f=h.phoneEnrollmentInfo.phoneNumber,m=h.phoneEnrollmentInfo.recaptchaToken;Object.assign(h,{phoneEnrollmentInfo:{phoneNumber:f,recaptchaToken:m,captchaResponse:u,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in h){const f=h.phoneSignInInfo.recaptchaToken;Object.assign(h,{phoneSignInInfo:{recaptchaToken:f,captchaResponse:u,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return h}return r?Object.assign(h,{captchaResp:u}):Object.assign(h,{captchaResponse:u}),Object.assign(h,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(h,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),h}async function Yx(t,e,n,r,a){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Kx(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const u=await Kx(t,e,n,n==="getOobCode");return r(t,u)}else return Promise.reject(o)})}function aM(t,e){const n=Vy(t,"auth");if(n.isInitialized()){const a=n.getImmediate(),o=n.getOptions();if(ha(o,e??{}))return a;es(a,"already-initialized")}return n.initialize({options:e})}function oM(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(ii);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function lM(t,e,n){const r=Wl(t);Fe(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const a=!1,o=t1(e),{host:u,port:h}=cM(e),f=h===null?"":`:${h}`,m={url:`${o}//${u}${f}/`},g=Object.freeze({host:u,port:h,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!r._canInitEmulator){Fe(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Fe(ha(m,r.config.emulator)&&ha(g,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=m,r.emulatorConfig=g,r.settings.appVerificationDisabledForTesting=!0,Gl(u)?(jE(`${o}//${u}${f}`),RE("Auth",!0)):uM()}function t1(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function cM(t){const e=t1(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(r);if(a){const o=a[1];return{host:o,port:Xx(r.substr(o.length+1))}}else{const[o,u]=r.split(":");return{host:o,port:Xx(u)}}}function Xx(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function uM(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class Qy{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return si("not implemented")}_getIdTokenResponse(e){return si("not implemented")}_linkToIdToken(e,n){return si("not implemented")}_getReauthenticationResolver(e){return si("not implemented")}}async function dM(t,e){return xa(t,"POST","/v1/accounts:signUp",e)}async function hM(t,e){return Hf(t,"POST","/v1/accounts:signInWithPassword",xo(t,e))}async function fM(t,e){return Hf(t,"POST","/v1/accounts:signInWithEmailLink",xo(t,e))}async function mM(t,e){return Hf(t,"POST","/v1/accounts:signInWithEmailLink",xo(t,e))}class ju extends Qy{constructor(e,n,r,a=null){super("password",r),this._email=e,this._password=n,this._tenantId=a}static _fromEmailAndPassword(e,n){return new ju(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new ju(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Yx(e,n,"signInWithPassword",hM);case"emailLink":return fM(e,{email:this._email,oobCode:this._password});default:es(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Yx(e,r,"signUpPassword",dM);case"emailLink":return mM(e,{idToken:n,email:this._email,oobCode:this._password});default:es(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function jl(t,e){return Hf(t,"POST","/v1/accounts:signInWithIdp",xo(t,e))}const pM="http://localhost";class mo extends Qy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new mo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):es("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:a,...o}=n;if(!r||!a)return null;const u=new mo(r,a);return u.idToken=o.idToken||void 0,u.accessToken=o.accessToken||void 0,u.secret=o.secret,u.nonce=o.nonce,u.pendingToken=o.pendingToken||null,u}_getIdTokenResponse(e){const n=this.buildRequest();return jl(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,jl(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,jl(e,n)}buildRequest(){const e={requestUri:pM,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=qu(n)}return e}}function gM(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function yM(t){const e=fu(mu(t)).link,n=e?fu(mu(e)).deep_link_id:null,r=fu(mu(t)).deep_link_id;return(r?fu(mu(r)).link:null)||r||n||e||t}class Wy{constructor(e){const n=fu(mu(e)),r=n.apiKey??null,a=n.oobCode??null,o=gM(n.mode??null);Fe(r&&a&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=a,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=yM(e);try{return new Wy(n)}catch{return null}}}class Kl{constructor(){this.providerId=Kl.PROVIDER_ID}static credential(e,n){return ju._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Wy.parseLink(n);return Fe(r,"argument-error"),ju._fromEmailAndCode(e,r.code,r.tenantId)}}Kl.PROVIDER_ID="password";Kl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Kl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class n1{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Qu extends n1{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Zi extends Qu{constructor(){super("facebook.com")}static credential(e){return mo._fromParams({providerId:Zi.PROVIDER_ID,signInMethod:Zi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zi.credentialFromTaggedObject(e)}static credentialFromError(e){return Zi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zi.credential(e.oauthAccessToken)}catch{return null}}}Zi.FACEBOOK_SIGN_IN_METHOD="facebook.com";Zi.PROVIDER_ID="facebook.com";class ea extends Qu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return mo._fromParams({providerId:ea.PROVIDER_ID,signInMethod:ea.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return ea.credentialFromTaggedObject(e)}static credentialFromError(e){return ea.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return ea.credential(n,r)}catch{return null}}}ea.GOOGLE_SIGN_IN_METHOD="google.com";ea.PROVIDER_ID="google.com";class ta extends Qu{constructor(){super("github.com")}static credential(e){return mo._fromParams({providerId:ta.PROVIDER_ID,signInMethod:ta.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ta.credentialFromTaggedObject(e)}static credentialFromError(e){return ta.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ta.credential(e.oauthAccessToken)}catch{return null}}}ta.GITHUB_SIGN_IN_METHOD="github.com";ta.PROVIDER_ID="github.com";class na extends Qu{constructor(){super("twitter.com")}static credential(e,n){return mo._fromParams({providerId:na.PROVIDER_ID,signInMethod:na.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return na.credentialFromTaggedObject(e)}static credentialFromError(e){return na.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return na.credential(n,r)}catch{return null}}}na.TWITTER_SIGN_IN_METHOD="twitter.com";na.PROVIDER_ID="twitter.com";class Ml{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,a=!1){const o=await Xr._fromIdTokenResponse(e,r,a),u=Jx(r);return new Ml({user:o,providerId:u,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const a=Jx(r);return new Ml({user:e,providerId:a,_tokenResponse:r,operationType:n})}}function Jx(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class mf extends gi{constructor(e,n,r,a){super(n.code,n.message),this.operationType=r,this.user=a,Object.setPrototypeOf(this,mf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,a){return new mf(e,n,r,a)}}function r1(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?mf._fromErrorAndOperation(t,o,e,r):o})}async function _M(t,e,n=!1){const r=await Au(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Ml._forOperation(t,"link",r)}async function bM(t,e,n=!1){const{auth:r}=t;if(Yr(r.app))return Promise.reject(la(r));const a="reauthenticate";try{const o=await Au(t,r1(r,a,e,t),n);Fe(o.idToken,r,"internal-error");const u=qy(o.idToken);Fe(u,r,"internal-error");const{sub:h}=u;return Fe(t.uid===h,r,"user-mismatch"),Ml._forOperation(t,a,o)}catch(o){throw o?.code==="auth/user-not-found"&&es(r,"user-mismatch"),o}}async function s1(t,e,n=!1){if(Yr(t.app))return Promise.reject(la(t));const r="signIn",a=await r1(t,r,e),o=await Ml._fromIdTokenResponse(t,r,a);return n||await t._updateCurrentUser(o.user),o}async function vM(t,e){return s1(Wl(t),e)}async function xM(t){const e=Wl(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function SM(t,e,n){return Yr(t.app)?Promise.reject(la(t)):vM(un(t),Kl.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&xM(t),r})}function wM(t,e,n,r){return un(t).onIdTokenChanged(e,n,r)}function EM(t,e,n){return un(t).beforeAuthStateChanged(e,n)}function CM(t,e,n,r){return un(t).onAuthStateChanged(e,n,r)}function TM(t){return un(t).signOut()}const pf="__sak";class i1{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(pf,"1"),this.storage.removeItem(pf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const AM=1e3,jM=10;class a1 extends i1{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=XE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),a=this.localCache[n];r!==a&&e(n,a,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((u,h,f)=>{this.notifyListeners(u,f)});return}const r=e.key;n?this.detachListener():this.stopPolling();const a=()=>{const u=this.storage.getItem(r);!n&&this.localCache[r]===u||this.notifyListeners(r,u)},o=this.storage.getItem(r);GD()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,jM):a()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const a of Array.from(r))a(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},AM)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}a1.type="LOCAL";const RM=a1;class o1 extends i1{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}o1.type="SESSION";const l1=o1;function IM(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class Gf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(a=>a.isListeningto(e));if(n)return n;const r=new Gf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:a,data:o}=n.data,u=this.handlersMap[a];if(!u?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:a});const h=Array.from(u).map(async m=>m(n.origin,o)),f=await IM(h);n.ports[0].postMessage({status:"done",eventId:r,eventType:a,response:f})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Gf.receivers=[];function Ky(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class DM{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let o,u;return new Promise((h,f)=>{const m=Ky("",20);a.port1.start();const g=setTimeout(()=>{f(new Error("unsupported_event"))},r);u={messageChannel:a,onMessage(_){const v=_;if(v.data.eventId===m)switch(v.data.status){case"ack":clearTimeout(g),o=setTimeout(()=>{f(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),h(v.data.response);break;default:clearTimeout(g),clearTimeout(o),f(new Error("invalid_response"));break}}},this.handlers.add(u),a.port1.addEventListener("message",u.onMessage),this.target.postMessage({eventType:e,eventId:m,data:n},[a.port2])}).finally(()=>{u&&this.removeMessageHandler(u)})}}function Is(){return window}function MM(t){Is().location.href=t}function c1(){return typeof Is().WorkerGlobalScope<"u"&&typeof Is().importScripts=="function"}async function kM(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function OM(){return navigator?.serviceWorker?.controller||null}function NM(){return c1()?self:null}const u1="firebaseLocalStorageDb",PM=1,gf="firebaseLocalStorage",d1="fbase_key";class Wu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Qf(t,e){return t.transaction([gf],e?"readwrite":"readonly").objectStore(gf)}function BM(){const t=indexedDB.deleteDatabase(u1);return new Wu(t).toPromise()}function ry(){const t=indexedDB.open(u1,PM);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(gf,{keyPath:d1})}catch(a){n(a)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(gf)?e(r):(r.close(),await BM(),e(await ry()))})})}async function Zx(t,e,n){const r=Qf(t,!0).put({[d1]:e,value:n});return new Wu(r).toPromise()}async function LM(t,e){const n=Qf(t,!1).get(e),r=await new Wu(n).toPromise();return r===void 0?null:r.value}function eS(t,e){const n=Qf(t,!0).delete(e);return new Wu(n).toPromise()}const UM=800,zM=3;class h1{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ry(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>zM)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return c1()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Gf._getInstance(NM()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await kM(),!this.activeServiceWorker)return;this.sender=new DM(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||OM()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ry();return await Zx(e,pf,"1"),await eS(e,pf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Zx(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>LM(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>eS(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const o=Qf(a,!1).getAll();return new Wu(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:a,value:o}of e)r.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(o)&&(this.notifyListeners(a,o),n.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!r.has(a)&&(this.notifyListeners(a,null),n.push(a));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const a of Array.from(r))a(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),UM)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}h1.type="LOCAL";const FM=h1;new Gu(3e4,6e4);function VM(t,e){return e?ii(e):(Fe(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class Yy extends Qy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return jl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return jl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return jl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function $M(t){return s1(t.auth,new Yy(t),t.bypassAuthState)}function HM(t){const{auth:e,user:n}=t;return Fe(n,e,"internal-error"),bM(n,new Yy(t),t.bypassAuthState)}async function qM(t){const{auth:e,user:n}=t;return Fe(n,e,"internal-error"),_M(n,new Yy(t),t.bypassAuthState)}class f1{constructor(e,n,r,a,o=!1){this.auth=e,this.resolver=r,this.user=a,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:a,tenantId:o,error:u,type:h}=e;if(u){this.reject(u);return}const f={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(h)(f))}catch(m){this.reject(m)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return $M;case"linkViaPopup":case"linkViaRedirect":return qM;case"reauthViaPopup":case"reauthViaRedirect":return HM;default:es(this.auth,"internal-error")}}resolve(e){di(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){di(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const GM=new Gu(2e3,1e4);class Cl extends f1{constructor(e,n,r,a,o){super(e,n,a,o),this.provider=r,this.authWindow=null,this.pollId=null,Cl.currentPopupAction&&Cl.currentPopupAction.cancel(),Cl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Fe(e,this.auth,"internal-error"),e}async onExecution(){di(this.filter.length===1,"Popup operations only handle one event");const e=Ky();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Rs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Rs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Cl.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Rs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,GM.get())};e()}}Cl.currentPopupAction=null;const QM="pendingRedirect",Xh=new Map;class WM extends f1{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Xh.get(this.auth._key());if(!e){try{const r=await KM(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Xh.set(this.auth._key(),e)}return this.bypassAuthState||Xh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function KM(t,e){const n=JM(e),r=XM(t);if(!await r._isAvailable())return!1;const a=await r._get(n)==="true";return await r._remove(n),a}function YM(t,e){Xh.set(t._key(),e)}function XM(t){return ii(t._redirectPersistence)}function JM(t){return Yh(QM,t.config.apiKey,t.name)}async function ZM(t,e,n=!1){if(Yr(t.app))return Promise.reject(la(t));const r=Wl(t),a=VM(r,e),u=await new WM(r,a,n).execute();return u&&!n&&(delete u.user._redirectEventId,await r._persistUserIfCurrent(u.user),await r._setRedirectUser(null,e)),u}const e2=600*1e3;class t2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!n2(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!m1(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Rs(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=e2&&this.cachedEventUids.clear(),this.cachedEventUids.has(tS(e))}saveEventToCache(e){this.cachedEventUids.add(tS(e)),this.lastProcessedEventTime=Date.now()}}function tS(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function m1({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function n2(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return m1(t);default:return!1}}async function r2(t,e={}){return xa(t,"GET","/v1/projects",e)}const s2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,i2=/^https?/;async function a2(t){if(t.config.emulator)return;const{authorizedDomains:e}=await r2(t);for(const n of e)try{if(o2(n))return}catch{}es(t,"unauthorized-domain")}function o2(t){const e=ty(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const u=new URL(t);return u.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&u.hostname===r}if(!i2.test(n))return!1;if(s2.test(t))return r===t;const a=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(r)}const l2=new Gu(3e4,6e4);function nS(){const t=Is().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function c2(t){return new Promise((e,n)=>{function r(){nS(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{nS(),n(Rs(t,"network-request-failed"))},timeout:l2.get()})}if(Is().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Is().gapi?.load)r();else{const a=tM("iframefcb");return Is()[a]=()=>{gapi.load?r():n(Rs(t,"network-request-failed"))},ZE(`${eM()}?onload=${a}`).catch(o=>n(o))}}).catch(e=>{throw Jh=null,e})}let Jh=null;function u2(t){return Jh=Jh||c2(t),Jh}const d2=new Gu(5e3,15e3),h2="__/auth/iframe",f2="emulator/auth/iframe",m2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},p2=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function g2(t){const e=t.config;Fe(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Hy(e,f2):`https://${t.config.authDomain}/${h2}`,r={apiKey:e.apiKey,appName:t.name,v:Ql},a=p2.get(t.config.apiHost);a&&(r.eid=a);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${qu(r).slice(1)}`}async function y2(t){const e=await u2(t),n=Is().gapi;return Fe(n,t,"internal-error"),e.open({where:document.body,url:g2(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:m2,dontclear:!0},r=>new Promise(async(a,o)=>{await r.restyle({setHideOnLeave:!1});const u=Rs(t,"network-request-failed"),h=Is().setTimeout(()=>{o(u)},d2.get());function f(){Is().clearTimeout(h),a(r)}r.ping(f).then(f,()=>{o(u)})}))}const _2={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},b2=500,v2=600,x2="_blank",S2="http://localhost";class rS{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function w2(t,e,n,r=b2,a=v2){const o=Math.max((window.screen.availHeight-a)/2,0).toString(),u=Math.max((window.screen.availWidth-r)/2,0).toString();let h="";const f={..._2,width:r.toString(),height:a.toString(),top:o,left:u},m=Ln().toLowerCase();n&&(h=GE(m)?x2:n),HE(m)&&(e=e||S2,f.scrollbars="yes");const g=Object.entries(f).reduce((v,[x,S])=>`${v}${x}=${S},`,"");if(qD(m)&&h!=="_self")return E2(e||"",h),new rS(null);const _=window.open(e||"",h,g);Fe(_,t,"popup-blocked");try{_.focus()}catch{}return new rS(_)}function E2(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const C2="__/auth/handler",T2="emulator/auth/handler",A2=encodeURIComponent("fac");async function sS(t,e,n,r,a,o){Fe(t.config.authDomain,t,"auth-domain-config-required"),Fe(t.config.apiKey,t,"invalid-api-key");const u={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Ql,eventId:a};if(e instanceof n1){e.setDefaultLanguage(t.languageCode),u.providerId=e.providerId||"",f5(e.getCustomParameters())||(u.customParameters=JSON.stringify(e.getCustomParameters()));for(const[g,_]of Object.entries({}))u[g]=_}if(e instanceof Qu){const g=e.getScopes().filter(_=>_!=="");g.length>0&&(u.scopes=g.join(","))}t.tenantId&&(u.tid=t.tenantId);const h=u;for(const g of Object.keys(h))h[g]===void 0&&delete h[g];const f=await t._getAppCheckToken(),m=f?`#${A2}=${encodeURIComponent(f)}`:"";return`${j2(t)}?${qu(h).slice(1)}${m}`}function j2({config:t}){return t.emulator?Hy(t,T2):`https://${t.authDomain}/${C2}`}const Ng="webStorageSupport";class R2{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=l1,this._completeRedirectFn=ZM,this._overrideRedirectResult=YM}async _openPopup(e,n,r,a){di(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await sS(e,n,r,ty(),a);return w2(e,o,Ky())}async _openRedirect(e,n,r,a){await this._originValidation(e);const o=await sS(e,n,r,ty(),a);return MM(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:a,promise:o}=this.eventManagers[n];return a?Promise.resolve(a):(di(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await y2(e),r=new t2(e);return n.register("authEvent",a=>(Fe(a?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Ng,{type:Ng},a=>{const o=a?.[0]?.[Ng];o!==void 0&&n(!!o),es(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=a2(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return XE()||qE()||Gy()}}const I2=R2;var iS="@firebase/auth",aS="1.12.0";class D2{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Fe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function M2(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function k2(t){Dl(new fo("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:u,authDomain:h}=r.options;Fe(u&&!u.includes(":"),"invalid-api-key",{appName:r.name});const f={apiKey:u,authDomain:h,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:JE(t)},m=new XD(r,a,o,f);return oM(m,n),m},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Dl(new fo("auth-internal",e=>{const n=Wl(e.getProvider("auth").getImmediate());return(r=>new D2(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),oa(iS,aS,M2(t)),oa(iS,aS,"esm2020")}const O2=300,N2=AE("authIdTokenMaxAge")||O2;let oS=null;const P2=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>N2)return;const a=n?.token;oS!==a&&(oS=a,await fetch(t,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function B2(t=kE()){const e=Vy(t,"auth");if(e.isInitialized())return e.getImmediate();const n=aM(t,{popupRedirectResolver:I2,persistence:[FM,RM,l1]}),r=AE("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const u=P2(o.toString());EM(n,u,()=>u(n.currentUser)),wM(n,h=>u(h))}}const a=CE("auth");return a&&lM(n,`http://${a}`),n}function L2(){return document.getElementsByTagName("head")?.[0]??document}JD({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=a=>{const o=Rs("internal-error");o.customData=a,n(o)},r.type="text/javascript",r.charset="UTF-8",L2().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});k2("Browser");var U2="firebase",z2="12.7.0";oa(U2,z2,"app");const F2={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},p1=ME(F2);function Sa(){const t=B2(p1);async function e(){return!1}async function n(f,m){return SM(t,f,m)}function r(){return TM(t)}function a(f){CM(t,m=>{f(m)})}function o(){return t.currentUser}function u(){const f=t.currentUser;if(!f)throw new Error("Not authenticated");if(!f.email)throw new Error("Email is required but not available for this account");return f.email}return{set_user_listener:a,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:u}}var Yl=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},V2={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},$2=class{#e=V2;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},ai=new $2;function H2(t){setTimeout(t,0)}var po=typeof window>"u"||"Deno"in globalThis;function mn(){}function q2(t,e){return typeof t=="function"?t(e):t}function sy(t){return typeof t=="number"&&t>=0&&t!==1/0}function g1(t,e){return Math.max(t+(e||0)-Date.now(),0)}function ca(t,e){return typeof t=="function"?t(e):t}function kr(t,e){return typeof t=="function"?t(e):t}function lS(t,e){const{type:n="all",exact:r,fetchStatus:a,predicate:o,queryKey:u,stale:h}=t;if(u){if(r){if(e.queryHash!==Xy(u,e.options))return!1}else if(!Ru(e.queryKey,u))return!1}if(n!=="all"){const f=e.isActive();if(n==="active"&&!f||n==="inactive"&&f)return!1}return!(typeof h=="boolean"&&e.isStale()!==h||a&&a!==e.state.fetchStatus||o&&!o(e))}function cS(t,e){const{exact:n,status:r,predicate:a,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(go(e.options.mutationKey)!==go(o))return!1}else if(!Ru(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||a&&!a(e))}function Xy(t,e){return(e?.queryKeyHashFn||go)(t)}function go(t){return JSON.stringify(t,(e,n)=>iy(n)?Object.keys(n).sort().reduce((r,a)=>(r[a]=n[a],r),{}):n)}function Ru(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Ru(t[n],e[n])):!1}var G2=Object.prototype.hasOwnProperty;function y1(t,e){if(t===e)return t;const n=uS(t)&&uS(e);if(!n&&!(iy(t)&&iy(e)))return e;const a=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),u=o.length,h=n?new Array(u):{};let f=0;for(let m=0;m<u;m++){const g=n?m:o[m],_=t[g],v=e[g];if(_===v){h[g]=_,(n?m<a:G2.call(t,g))&&f++;continue}if(_===null||v===null||typeof _!="object"||typeof v!="object"){h[g]=v;continue}const x=y1(_,v);h[g]=x,x===_&&f++}return a===u&&f===a?t:h}function yf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function uS(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function iy(t){if(!dS(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!dS(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function dS(t){return Object.prototype.toString.call(t)==="[object Object]"}function Q2(t){return new Promise(e=>{ai.setTimeout(e,t)})}function ay(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?y1(t,e):e}function W2(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function K2(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Jy=Symbol();function _1(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Jy?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function b1(t,e){return typeof t=="function"?t(...e):!!t}var Y2=class extends Yl{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!po&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Zy=new Y2;function oy(){let t,e;const n=new Promise((a,o)=>{t=a,e=o});n.status="pending",n.catch(()=>{});function r(a){Object.assign(n,a),delete n.resolve,delete n.reject}return n.resolve=a=>{r({status:"fulfilled",value:a}),t(a)},n.reject=a=>{r({status:"rejected",reason:a}),e(a)},n}function X2(t){let e;if(t.then(n=>(e=n,n),mn)?.catch(mn),e!==void 0)return{data:e}}function v1(t){return t}function J2(t){return{mutationKey:t.options.mutationKey,state:t.state,...t.options.scope&&{scope:t.options.scope},...t.meta&&{meta:t.meta}}}function Z2(t,e,n){const r=()=>{const a=t.promise?.then(e).catch(o=>n(o)?Promise.reject(new Error("redacted")):Promise.reject(o));return a?.catch(mn),a};return{dehydratedAt:Date.now(),state:{...t.state,...t.state.data!==void 0&&{data:e(t.state.data)}},queryKey:t.queryKey,queryHash:t.queryHash,...t.state.status==="pending"&&{promise:r()},...t.meta&&{meta:t.meta}}}function ek(t){return t.state.isPaused}function tk(t){return t.state.status==="success"}function nk(t){return!0}function rk(t,e={}){const n=e.shouldDehydrateMutation??t.getDefaultOptions().dehydrate?.shouldDehydrateMutation??ek,r=t.getMutationCache().getAll().flatMap(f=>n(f)?[J2(f)]:[]),a=e.shouldDehydrateQuery??t.getDefaultOptions().dehydrate?.shouldDehydrateQuery??tk,o=e.shouldRedactErrors??t.getDefaultOptions().dehydrate?.shouldRedactErrors??nk,u=e.serializeData??t.getDefaultOptions().dehydrate?.serializeData??v1,h=t.getQueryCache().getAll().flatMap(f=>a(f)?[Z2(f,u,o)]:[]);return{mutations:r,queries:h}}function sk(t,e,n){if(typeof e!="object"||e===null)return;const r=t.getMutationCache(),a=t.getQueryCache(),o=n?.defaultOptions?.deserializeData??t.getDefaultOptions().hydrate?.deserializeData??v1,u=e.mutations||[],h=e.queries||[];u.forEach(({state:f,...m})=>{r.build(t,{...t.getDefaultOptions().hydrate?.mutations,...n?.defaultOptions?.mutations,...m},f)}),h.forEach(({queryKey:f,state:m,queryHash:g,meta:_,promise:v,dehydratedAt:x})=>{const S=v?X2(v):void 0,E=m.data===void 0?S?.data:m.data,T=E===void 0?E:o(E);let I=a.get(g);const j=I?.state.status==="pending",M=I?.state.fetchStatus==="fetching";if(I){const Q=S&&x!==void 0&&x>I.state.dataUpdatedAt;if(m.dataUpdatedAt>I.state.dataUpdatedAt||Q){const{fetchStatus:H,...W}=m;I.setState({...W,data:T})}}else I=a.build(t,{...t.getDefaultOptions().hydrate?.queries,...n?.defaultOptions?.queries,queryKey:f,queryHash:g,meta:_},{...m,data:T,fetchStatus:"idle",status:T!==void 0?"success":m.status});v&&!j&&!M&&(x===void 0||x>I.state.dataUpdatedAt)&&I.fetch(void 0,{initialPromise:Promise.resolve(v).then(o)}).catch(mn)})}var ik=H2;function ak(){let t=[],e=0,n=h=>{h()},r=h=>{h()},a=ik;const o=h=>{e?t.push(h):a(()=>{n(h)})},u=()=>{const h=t;t=[],h.length&&a(()=>{r(()=>{h.forEach(f=>{n(f)})})})};return{batch:h=>{let f;e++;try{f=h()}finally{e--,e||u()}return f},batchCalls:h=>(...f)=>{o(()=>{h(...f)})},schedule:o,setNotifyFunction:h=>{n=h},setBatchNotifyFunction:h=>{r=h},setScheduler:h=>{a=h}}}var pn=ak(),ok=class extends Yl{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!po&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},_f=new ok;function lk(t){return Math.min(1e3*2**t,3e4)}function x1(t){return(t??"online")==="online"?_f.isOnline():!0}var ly=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function S1(t){let e=!1,n=0,r;const a=oy(),o=()=>a.status!=="pending",u=E=>{if(!o()){const T=new ly(E);v(T),t.onCancel?.(T)}},h=()=>{e=!0},f=()=>{e=!1},m=()=>Zy.isFocused()&&(t.networkMode==="always"||_f.isOnline())&&t.canRun(),g=()=>x1(t.networkMode)&&t.canRun(),_=E=>{o()||(r?.(),a.resolve(E))},v=E=>{o()||(r?.(),a.reject(E))},x=()=>new Promise(E=>{r=T=>{(o()||m())&&E(T)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),S=()=>{if(o())return;let E;const T=n===0?t.initialPromise:void 0;try{E=T??t.fn()}catch(I){E=Promise.reject(I)}Promise.resolve(E).then(_).catch(I=>{if(o())return;const j=t.retry??(po?0:3),M=t.retryDelay??lk,Q=typeof M=="function"?M(n,I):M,H=j===!0||typeof j=="number"&&n<j||typeof j=="function"&&j(n,I);if(e||!H){v(I);return}n++,t.onFail?.(n,I),Q2(Q).then(()=>m()?void 0:x()).then(()=>{e?v(I):S()})})};return{promise:a,status:()=>a.status,cancel:u,continue:()=>(r?.(),a),cancelRetry:h,continueRetry:f,canStart:g,start:()=>(g()?S():x().then(S),a)}}var w1=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),sy(this.gcTime)&&(this.#e=ai.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(po?1/0:300*1e3))}clearGcTimeout(){this.#e&&(ai.clearTimeout(this.#e),this.#e=void 0)}},ck=class extends w1{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=fS(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=fS(this.options);n.data!==void 0&&(this.setState(hS(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=ay(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(mn).catch(mn):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>kr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Jy||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ca(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!g1(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const f=this.observers.find(m=>m.options.queryFn);f&&this.setOptions(f.options)}const r=new AbortController,a=f=>{Object.defineProperty(f,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const f=_1(this.options,n),g=(()=>{const _={client:this.#s,queryKey:this.queryKey,meta:this.meta};return a(_),_})();return this.#o=!1,this.options.persister?this.options.persister(f,g,this):f(g)},h=(()=>{const f={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return a(f),f})();this.options.behavior?.onFetch(h,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==h.fetchOptions?.meta)&&this.#i({type:"fetch",meta:h.fetchOptions?.meta}),this.#r=S1({initialPromise:n?.initialPromise,fn:h.fetchFn,onCancel:f=>{f instanceof ly&&f.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(f,m)=>{this.#i({type:"failed",failureCount:f,error:m})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:h.options.retry,retryDelay:h.options.retryDelay,networkMode:h.options.networkMode,canRun:()=>!0});try{const f=await this.#r.start();if(f===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(f),this.#n.config.onSuccess?.(f,this),this.#n.config.onSettled?.(f,this.state.error,this),f}catch(f){if(f instanceof ly){if(f.silent)return this.#r.promise;if(f.revert){if(this.state.data===void 0)throw f;return this.state.data}}throw this.#i({type:"error",error:f}),this.#n.config.onError?.(f,this),this.#n.config.onSettled?.(this.state.data,f,this),f}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...E1(r.data,this.options),fetchMeta:e.meta??null};case"success":const a={...r,...hS(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?a:void 0,a;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),pn.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function E1(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:x1(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function hS(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function fS(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var uk=class extends Yl{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=oy(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),mS(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return cy(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return cy(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof kr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#S(),this.#t.setOptions(this.options),e._defaulted&&!yf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&pS(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||kr(this.options.enabled,this.#t)!==kr(e.enabled,this.#t)||ca(this.options.staleTime,this.#t)!==ca(e.staleTime,this.#t))&&this.#g();const a=this.#y();r&&(this.#t!==n||kr(this.options.enabled,this.#t)!==kr(e.enabled,this.#t)||a!==this.#l)&&this.#_(a)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return hk(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#S();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(mn)),e}#g(){this.#v();const t=ca(this.options.staleTime,this.#t);if(po||this.#s.isStale||!sy(t))return;const n=g1(this.#s.dataUpdatedAt,t)+1;this.#c=ai.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(po||kr(this.options.enabled,this.#t)===!1||!sy(this.#l)||this.#l===0)&&(this.#u=ai.setInterval(()=>{(this.options.refetchIntervalInBackground||Zy.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(ai.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(ai.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,a=this.#s,o=this.#r,u=this.#a,f=t!==n?t.state:this.#n,{state:m}=t;let g={...m},_=!1,v;if(e._optimisticResults){const A=this.hasListeners(),N=!A&&mS(t,e),P=A&&pS(t,n,e,r);(N||P)&&(g={...g,...E1(m.data,t.options)}),e._optimisticResults==="isRestoring"&&(g.fetchStatus="idle")}let{error:x,errorUpdatedAt:S,status:E}=g;v=g.data;let T=!1;if(e.placeholderData!==void 0&&v===void 0&&E==="pending"){let A;a?.isPlaceholderData&&e.placeholderData===u?.placeholderData?(A=a.data,T=!0):A=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,A!==void 0&&(E="success",v=ay(a?.data,A,e),_=!0)}if(e.select&&v!==void 0&&!T)if(a&&v===o?.data&&e.select===this.#p)v=this.#h;else try{this.#p=e.select,v=e.select(v),v=ay(a?.data,v,e),this.#h=v,this.#i=null}catch(A){this.#i=A}this.#i&&(x=this.#i,v=this.#h,S=Date.now(),E="error");const I=g.fetchStatus==="fetching",j=E==="pending",M=E==="error",Q=j&&I,H=v!==void 0,D={status:E,fetchStatus:g.fetchStatus,isPending:j,isSuccess:E==="success",isError:M,isInitialLoading:Q,isLoading:Q,data:v,dataUpdatedAt:g.dataUpdatedAt,error:x,errorUpdatedAt:S,failureCount:g.fetchFailureCount,failureReason:g.fetchFailureReason,errorUpdateCount:g.errorUpdateCount,isFetched:g.dataUpdateCount>0||g.errorUpdateCount>0,isFetchedAfterMount:g.dataUpdateCount>f.dataUpdateCount||g.errorUpdateCount>f.errorUpdateCount,isFetching:I,isRefetching:I&&!j,isLoadingError:M&&!H,isPaused:g.fetchStatus==="paused",isPlaceholderData:_,isRefetchError:M&&H,isStale:e0(t,e),refetch:this.refetch,promise:this.#o,isEnabled:kr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const A=L=>{D.status==="error"?L.reject(D.error):D.data!==void 0&&L.resolve(D.data)},N=()=>{const L=this.#o=D.promise=oy();A(L)},P=this.#o;switch(P.status){case"pending":t.queryHash===n.queryHash&&A(P);break;case"fulfilled":(D.status==="error"||D.data!==P.value)&&N();break;case"rejected":(D.status!=="error"||D.error!==P.reason)&&N();break}}return D}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),yf(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,a=typeof r=="function"?r():r;if(a==="all"||!a&&!this.#m.size)return!0;const o=new Set(a??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(u=>{const h=u;return this.#s[h]!==t[h]&&o.has(h)})};this.#w({listeners:n()})}#S(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#w(t){pn.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function dk(t,e){return kr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function mS(t,e){return dk(t,e)||t.state.data!==void 0&&cy(t,e,e.refetchOnMount)}function cy(t,e,n){if(kr(e.enabled,t)!==!1&&ca(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&e0(t,e)}return!1}function pS(t,e,n,r){return(t!==e||kr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&e0(t,n)}function e0(t,e){return kr(e.enabled,t)!==!1&&t.isStaleByTime(ca(e.staleTime,t))}function hk(t,e){return!yf(t.getCurrentResult(),e)}function gS(t){return{onFetch:(e,n)=>{const r=e.options,a=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],u=e.state.data?.pageParams||[];let h={pages:[],pageParams:[]},f=0;const m=async()=>{let g=!1;const _=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(e.signal.aborted?g=!0:e.signal.addEventListener("abort",()=>{g=!0}),e.signal)})},v=_1(e.options,e.fetchOptions),x=async(S,E,T)=>{if(g)return Promise.reject();if(E==null&&S.pages.length)return Promise.resolve(S);const j=(()=>{const W={client:e.client,queryKey:e.queryKey,pageParam:E,direction:T?"backward":"forward",meta:e.options.meta};return _(W),W})(),M=await v(j),{maxPages:Q}=e.options,H=T?K2:W2;return{pages:H(S.pages,M,Q),pageParams:H(S.pageParams,E,Q)}};if(a&&o.length){const S=a==="backward",E=S?fk:yS,T={pages:o,pageParams:u},I=E(r,T);h=await x(T,I,S)}else{const S=t??o.length;do{const E=f===0?u[0]??r.initialPageParam:yS(r,h);if(f>0&&E==null)break;h=await x(h,E),f++}while(f<S)}return h};e.options.persister?e.fetchFn=()=>e.options.persister?.(m,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=m}}}function yS(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function fk(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var mk=class extends w1{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||C1(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=S1({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(u,h)=>{this.#r({type:"failed",failureCount:u,error:h})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const a=this.state.status==="pending",o=!this.#s.canStart();try{if(a)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const h=await this.options.onMutate?.(e,r);h!==this.state.context&&this.#r({type:"pending",context:h,variables:e,isPaused:o})}const u=await this.#s.start();return await this.#n.config.onSuccess?.(u,e,this.state.context,this,r),await this.options.onSuccess?.(u,e,this.state.context,r),await this.#n.config.onSettled?.(u,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(u,null,e,this.state.context,r),this.#r({type:"success",data:u}),u}catch(u){try{throw await this.#n.config.onError?.(u,e,this.state.context,this,r),await this.options.onError?.(u,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,u,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,u,e,this.state.context,r),u}finally{this.#r({type:"error",error:u})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),pn.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function C1(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var pk=class extends Yl{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new mk({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Uh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Uh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Uh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(a=>a.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Uh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){pn.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>cS(e,n))}findAll(t={}){return this.getAll().filter(e=>cS(t,e))}notify(t){pn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return pn.batch(()=>Promise.all(t.map(e=>e.continue().catch(mn))))}};function Uh(t){return t.options.scope?.id}var gk=class extends Yl{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),yf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&go(n.mutationKey)!==go(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??C1();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){pn.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,a={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,a),this.#s.onSettled?.(e.data,null,n,r,a)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,a),this.#s.onSettled?.(void 0,e.error,n,r,a))}this.listeners.forEach(n=>{n(this.#t)})})}},yk=class extends Yl{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,a=e.queryHash??Xy(r,e);let o=this.get(a);return o||(o=new ck({client:t,queryKey:r,queryHash:a,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){pn.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>lS(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>lS(t,n)):e}notify(t){pn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){pn.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){pn.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},_k=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new yk,this.#t=t.mutationCache||new pk,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=Zy.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=_f.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(ca(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,u=q2(e,o);if(u!==void 0)return this.#e.build(this,r).setData(u,{...n,manual:!0})}setQueriesData(t,e,n){return pn.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;pn.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return pn.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=pn.batch(()=>this.#e.findAll(t).map(a=>a.cancel(n)));return Promise.all(r).then(mn).catch(mn)}invalidateQueries(t,e={}){return pn.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=pn.batch(()=>this.#e.findAll(t).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let o=a.fetch(void 0,n);return n.throwOnError||(o=o.catch(mn)),a.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(mn)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(ca(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(mn).catch(mn)}fetchInfiniteQuery(t){return t.behavior=gS(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(mn).catch(mn)}ensureInfiniteQueryData(t){return t.behavior=gS(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return _f.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(go(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{Ru(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(go(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{Ru(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Xy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Jy&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},T1=C.createContext(void 0),So=t=>{const e=C.useContext(T1);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},A1=({client:t,children:e})=>(C.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),c.jsx(T1.Provider,{value:t,children:e})),j1=C.createContext(!1),bk=()=>C.useContext(j1),vk=j1.Provider;function xk(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Sk=C.createContext(xk()),wk=()=>C.useContext(Sk),Ek=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},Ck=t=>{C.useEffect(()=>{t.clearReset()},[t])},Tk=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:a})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(a&&t.data===void 0||b1(n,[t.error,r])),Ak=t=>{if(t.suspense){const n=a=>a==="static"?a:Math.max(a??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...a)=>n(r(...a)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},jk=(t,e)=>t.isLoading&&t.isFetching&&!e,Rk=(t,e)=>t?.suspense&&e.isPending,_S=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function Ik(t,e,n){const r=bk(),a=wk(),o=So(),u=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(u),u._optimisticResults=r?"isRestoring":"optimistic",Ak(u),Ek(u,a),Ck(a);const h=!o.getQueryCache().get(u.queryHash),[f]=C.useState(()=>new e(o,u)),m=f.getOptimisticResult(u),g=!r&&t.subscribed!==!1;if(C.useSyncExternalStore(C.useCallback(_=>{const v=g?f.subscribe(pn.batchCalls(_)):mn;return f.updateResult(),v},[f,g]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),C.useEffect(()=>{f.setOptions(u)},[u,f]),Rk(u,m))throw _S(u,f,a);if(Tk({result:m,errorResetBoundary:a,throwOnError:u.throwOnError,query:o.getQueryCache().get(u.queryHash),suspense:u.suspense}))throw m.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(u,m),u.experimental_prefetchInRender&&!po&&jk(m,r)&&(h?_S(u,f,a):o.getQueryCache().get(u.queryHash)?.promise)?.catch(mn).finally(()=>{f.updateResult()}),u.notifyOnChangeProps?m:f.trackResult(m)}function Xl(t,e){return Ik(t,uk)}function t0(t,e){const n=So(),[r]=C.useState(()=>new gk(n,t));C.useEffect(()=>{r.setOptions(t)},[r,t]);const a=C.useSyncExternalStore(C.useCallback(u=>r.subscribe(pn.batchCalls(u)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=C.useCallback((u,h)=>{r.mutate(u,h).catch(mn)},[r]);if(a.error&&b1(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:o,mutateAsync:a.mutate}}function uy(){}function Dk(t,{interval:e=1e3,onError:n=uy}={}){if(typeof t!="function")throw new Error("argument is not function.");let r=0,a=null,o=!1,u=!1;return async(...h)=>{if(a=h,!u){for(u=!0;o;)await new Promise(f=>ai.setTimeout(f,e));for(;Date.now()<r;)await new Promise(f=>ai.setTimeout(f,r-Date.now()));u=!1,o=!0;try{await t(...a)}catch(f){try{n(f)}catch{}}r=Date.now()+e,o=!1}}}var Mk=({storage:t,key:e="REACT_QUERY_OFFLINE_CACHE",throttleTime:n=1e3,serialize:r=JSON.stringify,deserialize:a=JSON.parse,retry:o})=>{if(t){const u=async h=>{try{const f=await r(h);await t.setItem(e,f);return}catch(f){return f}};return{persistClient:Dk(async h=>{let f=h,m=await u(f),g=0;for(;m&&f;)g++,f=await o?.({persistedClient:f,error:m,errorCount:g}),f&&(m=await u(f))},{interval:n}),restoreClient:async()=>{const h=await t.getItem(e);if(h)return await a(h)},removeClient:()=>t.removeItem(e)}}return{persistClient:uy,restoreClient:()=>Promise.resolve(void 0),removeClient:uy}};const R1=300*1e3,kk=1800*1e3,Oe=new _k({defaultOptions:{queries:{staleTime:R1,gcTime:kk,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Oe.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const Ok=Mk({storage:typeof window<"u"?{getItem:t=>Promise.resolve(localStorage.getItem(t)),setItem:(t,e)=>Promise.resolve(localStorage.setItem(t,e)),removeItem:t=>Promise.resolve(localStorage.removeItem(t))}:void 0,key:"BUDGET_APP_QUERY_CACHE"}),Ce={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};var Nk=["added","removed","updated"];function bS(t){return Nk.includes(t)}async function Pk({queryClient:t,persister:e,maxAge:n=1e3*60*60*24,buster:r="",hydrateOptions:a}){try{const o=await e.restoreClient();if(o)if(o.timestamp){const u=Date.now()-o.timestamp>n,h=o.buster!==r;if(u||h)return e.removeClient();sk(t,o.clientState,a)}else return e.removeClient()}catch(o){throw await e.removeClient(),o}}async function vS({queryClient:t,persister:e,buster:n="",dehydrateOptions:r}){const a={buster:n,timestamp:Date.now(),clientState:rk(t,r)};await e.persistClient(a)}function Bk(t){const e=t.queryClient.getQueryCache().subscribe(r=>{bS(r.type)&&vS(t)}),n=t.queryClient.getMutationCache().subscribe(r=>{bS(r.type)&&vS(t)});return()=>{e(),n()}}var Lk=({children:t,persistOptions:e,onSuccess:n,onError:r,...a})=>{const[o,u]=C.useState(!0),h=C.useRef({persistOptions:e,onSuccess:n,onError:r}),f=C.useRef(!1);return C.useEffect(()=>{h.current={persistOptions:e,onSuccess:n,onError:r}}),C.useEffect(()=>{const m={...h.current.persistOptions,queryClient:a.client};return f.current||(f.current=!0,Pk(m).then(()=>h.current.onSuccess?.()).catch(()=>h.current.onError?.()).finally(()=>{u(!1)})),o?void 0:Bk(m)},[a.client,o]),c.jsx(A1,{...a,children:c.jsx(vk,{value:o,children:t})})};function Uk(){return typeof window>"u"?!1:new URLSearchParams(window.location.search).get("cacheBust")==="1"}function zk(){if(typeof window>"u")return;const t=new URL(window.location.href);t.searchParams.has("cacheBust")&&(t.searchParams.delete("cacheBust"),window.history.replaceState({},"",t.toString()))}function Fk({children:t}){const[e]=C.useState(()=>Uk());return C.useEffect(()=>{e&&zk()},[e]),e?c.jsx(A1,{client:Oe,children:t}):c.jsx(Lk,{client:Oe,persistOptions:{persister:Ok,maxAge:300*1e3,buster:"v3"},children:t})}var xS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ua,I1;(function(){var t;function e(D,A){function N(){}N.prototype=A.prototype,D.F=A.prototype,D.prototype=new N,D.prototype.constructor=D,D.D=function(P,L,B){for(var O=Array(arguments.length-2),G=2;G<arguments.length;G++)O[G-2]=arguments[G];return A.prototype[L].apply(P,O)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(D,A,N){N||(N=0);const P=Array(16);if(typeof A=="string")for(var L=0;L<16;++L)P[L]=A.charCodeAt(N++)|A.charCodeAt(N++)<<8|A.charCodeAt(N++)<<16|A.charCodeAt(N++)<<24;else for(L=0;L<16;++L)P[L]=A[N++]|A[N++]<<8|A[N++]<<16|A[N++]<<24;A=D.g[0],N=D.g[1],L=D.g[2];let B=D.g[3],O;O=A+(B^N&(L^B))+P[0]+3614090360&4294967295,A=N+(O<<7&4294967295|O>>>25),O=B+(L^A&(N^L))+P[1]+3905402710&4294967295,B=A+(O<<12&4294967295|O>>>20),O=L+(N^B&(A^N))+P[2]+606105819&4294967295,L=B+(O<<17&4294967295|O>>>15),O=N+(A^L&(B^A))+P[3]+3250441966&4294967295,N=L+(O<<22&4294967295|O>>>10),O=A+(B^N&(L^B))+P[4]+4118548399&4294967295,A=N+(O<<7&4294967295|O>>>25),O=B+(L^A&(N^L))+P[5]+1200080426&4294967295,B=A+(O<<12&4294967295|O>>>20),O=L+(N^B&(A^N))+P[6]+2821735955&4294967295,L=B+(O<<17&4294967295|O>>>15),O=N+(A^L&(B^A))+P[7]+4249261313&4294967295,N=L+(O<<22&4294967295|O>>>10),O=A+(B^N&(L^B))+P[8]+1770035416&4294967295,A=N+(O<<7&4294967295|O>>>25),O=B+(L^A&(N^L))+P[9]+2336552879&4294967295,B=A+(O<<12&4294967295|O>>>20),O=L+(N^B&(A^N))+P[10]+4294925233&4294967295,L=B+(O<<17&4294967295|O>>>15),O=N+(A^L&(B^A))+P[11]+2304563134&4294967295,N=L+(O<<22&4294967295|O>>>10),O=A+(B^N&(L^B))+P[12]+1804603682&4294967295,A=N+(O<<7&4294967295|O>>>25),O=B+(L^A&(N^L))+P[13]+4254626195&4294967295,B=A+(O<<12&4294967295|O>>>20),O=L+(N^B&(A^N))+P[14]+2792965006&4294967295,L=B+(O<<17&4294967295|O>>>15),O=N+(A^L&(B^A))+P[15]+1236535329&4294967295,N=L+(O<<22&4294967295|O>>>10),O=A+(L^B&(N^L))+P[1]+4129170786&4294967295,A=N+(O<<5&4294967295|O>>>27),O=B+(N^L&(A^N))+P[6]+3225465664&4294967295,B=A+(O<<9&4294967295|O>>>23),O=L+(A^N&(B^A))+P[11]+643717713&4294967295,L=B+(O<<14&4294967295|O>>>18),O=N+(B^A&(L^B))+P[0]+3921069994&4294967295,N=L+(O<<20&4294967295|O>>>12),O=A+(L^B&(N^L))+P[5]+3593408605&4294967295,A=N+(O<<5&4294967295|O>>>27),O=B+(N^L&(A^N))+P[10]+38016083&4294967295,B=A+(O<<9&4294967295|O>>>23),O=L+(A^N&(B^A))+P[15]+3634488961&4294967295,L=B+(O<<14&4294967295|O>>>18),O=N+(B^A&(L^B))+P[4]+3889429448&4294967295,N=L+(O<<20&4294967295|O>>>12),O=A+(L^B&(N^L))+P[9]+568446438&4294967295,A=N+(O<<5&4294967295|O>>>27),O=B+(N^L&(A^N))+P[14]+3275163606&4294967295,B=A+(O<<9&4294967295|O>>>23),O=L+(A^N&(B^A))+P[3]+4107603335&4294967295,L=B+(O<<14&4294967295|O>>>18),O=N+(B^A&(L^B))+P[8]+1163531501&4294967295,N=L+(O<<20&4294967295|O>>>12),O=A+(L^B&(N^L))+P[13]+2850285829&4294967295,A=N+(O<<5&4294967295|O>>>27),O=B+(N^L&(A^N))+P[2]+4243563512&4294967295,B=A+(O<<9&4294967295|O>>>23),O=L+(A^N&(B^A))+P[7]+1735328473&4294967295,L=B+(O<<14&4294967295|O>>>18),O=N+(B^A&(L^B))+P[12]+2368359562&4294967295,N=L+(O<<20&4294967295|O>>>12),O=A+(N^L^B)+P[5]+4294588738&4294967295,A=N+(O<<4&4294967295|O>>>28),O=B+(A^N^L)+P[8]+2272392833&4294967295,B=A+(O<<11&4294967295|O>>>21),O=L+(B^A^N)+P[11]+1839030562&4294967295,L=B+(O<<16&4294967295|O>>>16),O=N+(L^B^A)+P[14]+4259657740&4294967295,N=L+(O<<23&4294967295|O>>>9),O=A+(N^L^B)+P[1]+2763975236&4294967295,A=N+(O<<4&4294967295|O>>>28),O=B+(A^N^L)+P[4]+1272893353&4294967295,B=A+(O<<11&4294967295|O>>>21),O=L+(B^A^N)+P[7]+4139469664&4294967295,L=B+(O<<16&4294967295|O>>>16),O=N+(L^B^A)+P[10]+3200236656&4294967295,N=L+(O<<23&4294967295|O>>>9),O=A+(N^L^B)+P[13]+681279174&4294967295,A=N+(O<<4&4294967295|O>>>28),O=B+(A^N^L)+P[0]+3936430074&4294967295,B=A+(O<<11&4294967295|O>>>21),O=L+(B^A^N)+P[3]+3572445317&4294967295,L=B+(O<<16&4294967295|O>>>16),O=N+(L^B^A)+P[6]+76029189&4294967295,N=L+(O<<23&4294967295|O>>>9),O=A+(N^L^B)+P[9]+3654602809&4294967295,A=N+(O<<4&4294967295|O>>>28),O=B+(A^N^L)+P[12]+3873151461&4294967295,B=A+(O<<11&4294967295|O>>>21),O=L+(B^A^N)+P[15]+530742520&4294967295,L=B+(O<<16&4294967295|O>>>16),O=N+(L^B^A)+P[2]+3299628645&4294967295,N=L+(O<<23&4294967295|O>>>9),O=A+(L^(N|~B))+P[0]+4096336452&4294967295,A=N+(O<<6&4294967295|O>>>26),O=B+(N^(A|~L))+P[7]+1126891415&4294967295,B=A+(O<<10&4294967295|O>>>22),O=L+(A^(B|~N))+P[14]+2878612391&4294967295,L=B+(O<<15&4294967295|O>>>17),O=N+(B^(L|~A))+P[5]+4237533241&4294967295,N=L+(O<<21&4294967295|O>>>11),O=A+(L^(N|~B))+P[12]+1700485571&4294967295,A=N+(O<<6&4294967295|O>>>26),O=B+(N^(A|~L))+P[3]+2399980690&4294967295,B=A+(O<<10&4294967295|O>>>22),O=L+(A^(B|~N))+P[10]+4293915773&4294967295,L=B+(O<<15&4294967295|O>>>17),O=N+(B^(L|~A))+P[1]+2240044497&4294967295,N=L+(O<<21&4294967295|O>>>11),O=A+(L^(N|~B))+P[8]+1873313359&4294967295,A=N+(O<<6&4294967295|O>>>26),O=B+(N^(A|~L))+P[15]+4264355552&4294967295,B=A+(O<<10&4294967295|O>>>22),O=L+(A^(B|~N))+P[6]+2734768916&4294967295,L=B+(O<<15&4294967295|O>>>17),O=N+(B^(L|~A))+P[13]+1309151649&4294967295,N=L+(O<<21&4294967295|O>>>11),O=A+(L^(N|~B))+P[4]+4149444226&4294967295,A=N+(O<<6&4294967295|O>>>26),O=B+(N^(A|~L))+P[11]+3174756917&4294967295,B=A+(O<<10&4294967295|O>>>22),O=L+(A^(B|~N))+P[2]+718787259&4294967295,L=B+(O<<15&4294967295|O>>>17),O=N+(B^(L|~A))+P[9]+3951481745&4294967295,D.g[0]=D.g[0]+A&4294967295,D.g[1]=D.g[1]+(L+(O<<21&4294967295|O>>>11))&4294967295,D.g[2]=D.g[2]+L&4294967295,D.g[3]=D.g[3]+B&4294967295}r.prototype.v=function(D,A){A===void 0&&(A=D.length);const N=A-this.blockSize,P=this.C;let L=this.h,B=0;for(;B<A;){if(L==0)for(;B<=N;)a(this,D,B),B+=this.blockSize;if(typeof D=="string"){for(;B<A;)if(P[L++]=D.charCodeAt(B++),L==this.blockSize){a(this,P),L=0;break}}else for(;B<A;)if(P[L++]=D[B++],L==this.blockSize){a(this,P),L=0;break}}this.h=L,this.o+=A},r.prototype.A=function(){var D=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);D[0]=128;for(var A=1;A<D.length-8;++A)D[A]=0;A=this.o*8;for(var N=D.length-8;N<D.length;++N)D[N]=A&255,A/=256;for(this.v(D),D=Array(16),A=0,N=0;N<4;++N)for(let P=0;P<32;P+=8)D[A++]=this.g[N]>>>P&255;return D};function o(D,A){var N=h;return Object.prototype.hasOwnProperty.call(N,D)?N[D]:N[D]=A(D)}function u(D,A){this.h=A;const N=[];let P=!0;for(let L=D.length-1;L>=0;L--){const B=D[L]|0;P&&B==A||(N[L]=B,P=!1)}this.g=N}var h={};function f(D){return-128<=D&&D<128?o(D,function(A){return new u([A|0],A<0?-1:0)}):new u([D|0],D<0?-1:0)}function m(D){if(isNaN(D)||!isFinite(D))return _;if(D<0)return T(m(-D));const A=[];let N=1;for(let P=0;D>=N;P++)A[P]=D/N|0,N*=4294967296;return new u(A,0)}function g(D,A){if(D.length==0)throw Error("number format error: empty string");if(A=A||10,A<2||36<A)throw Error("radix out of range: "+A);if(D.charAt(0)=="-")return T(g(D.substring(1),A));if(D.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=m(Math.pow(A,8));let P=_;for(let B=0;B<D.length;B+=8){var L=Math.min(8,D.length-B);const O=parseInt(D.substring(B,B+L),A);L<8?(L=m(Math.pow(A,L)),P=P.j(L).add(m(O))):(P=P.j(N),P=P.add(m(O)))}return P}var _=f(0),v=f(1),x=f(16777216);t=u.prototype,t.m=function(){if(E(this))return-T(this).m();let D=0,A=1;for(let N=0;N<this.g.length;N++){const P=this.i(N);D+=(P>=0?P:4294967296+P)*A,A*=4294967296}return D},t.toString=function(D){if(D=D||10,D<2||36<D)throw Error("radix out of range: "+D);if(S(this))return"0";if(E(this))return"-"+T(this).toString(D);const A=m(Math.pow(D,6));var N=this;let P="";for(;;){const L=Q(N,A).g;N=I(N,L.j(A));let B=((N.g.length>0?N.g[0]:N.h)>>>0).toString(D);if(N=L,S(N))return B+P;for(;B.length<6;)B="0"+B;P=B+P}},t.i=function(D){return D<0?0:D<this.g.length?this.g[D]:this.h};function S(D){if(D.h!=0)return!1;for(let A=0;A<D.g.length;A++)if(D.g[A]!=0)return!1;return!0}function E(D){return D.h==-1}t.l=function(D){return D=I(this,D),E(D)?-1:S(D)?0:1};function T(D){const A=D.g.length,N=[];for(let P=0;P<A;P++)N[P]=~D.g[P];return new u(N,~D.h).add(v)}t.abs=function(){return E(this)?T(this):this},t.add=function(D){const A=Math.max(this.g.length,D.g.length),N=[];let P=0;for(let L=0;L<=A;L++){let B=P+(this.i(L)&65535)+(D.i(L)&65535),O=(B>>>16)+(this.i(L)>>>16)+(D.i(L)>>>16);P=O>>>16,B&=65535,O&=65535,N[L]=O<<16|B}return new u(N,N[N.length-1]&-2147483648?-1:0)};function I(D,A){return D.add(T(A))}t.j=function(D){if(S(this)||S(D))return _;if(E(this))return E(D)?T(this).j(T(D)):T(T(this).j(D));if(E(D))return T(this.j(T(D)));if(this.l(x)<0&&D.l(x)<0)return m(this.m()*D.m());const A=this.g.length+D.g.length,N=[];for(var P=0;P<2*A;P++)N[P]=0;for(P=0;P<this.g.length;P++)for(let L=0;L<D.g.length;L++){const B=this.i(P)>>>16,O=this.i(P)&65535,G=D.i(L)>>>16,Y=D.i(L)&65535;N[2*P+2*L]+=O*Y,j(N,2*P+2*L),N[2*P+2*L+1]+=B*Y,j(N,2*P+2*L+1),N[2*P+2*L+1]+=O*G,j(N,2*P+2*L+1),N[2*P+2*L+2]+=B*G,j(N,2*P+2*L+2)}for(D=0;D<A;D++)N[D]=N[2*D+1]<<16|N[2*D];for(D=A;D<2*A;D++)N[D]=0;return new u(N,0)};function j(D,A){for(;(D[A]&65535)!=D[A];)D[A+1]+=D[A]>>>16,D[A]&=65535,A++}function M(D,A){this.g=D,this.h=A}function Q(D,A){if(S(A))throw Error("division by zero");if(S(D))return new M(_,_);if(E(D))return A=Q(T(D),A),new M(T(A.g),T(A.h));if(E(A))return A=Q(D,T(A)),new M(T(A.g),A.h);if(D.g.length>30){if(E(D)||E(A))throw Error("slowDivide_ only works with positive integers.");for(var N=v,P=A;P.l(D)<=0;)N=H(N),P=H(P);var L=W(N,1),B=W(P,1);for(P=W(P,2),N=W(N,2);!S(P);){var O=B.add(P);O.l(D)<=0&&(L=L.add(N),B=O),P=W(P,1),N=W(N,1)}return A=I(D,L.j(A)),new M(L,A)}for(L=_;D.l(A)>=0;){for(N=Math.max(1,Math.floor(D.m()/A.m())),P=Math.ceil(Math.log(N)/Math.LN2),P=P<=48?1:Math.pow(2,P-48),B=m(N),O=B.j(A);E(O)||O.l(D)>0;)N-=P,B=m(N),O=B.j(A);S(B)&&(B=v),L=L.add(B),D=I(D,O)}return new M(L,D)}t.B=function(D){return Q(this,D).h},t.and=function(D){const A=Math.max(this.g.length,D.g.length),N=[];for(let P=0;P<A;P++)N[P]=this.i(P)&D.i(P);return new u(N,this.h&D.h)},t.or=function(D){const A=Math.max(this.g.length,D.g.length),N=[];for(let P=0;P<A;P++)N[P]=this.i(P)|D.i(P);return new u(N,this.h|D.h)},t.xor=function(D){const A=Math.max(this.g.length,D.g.length),N=[];for(let P=0;P<A;P++)N[P]=this.i(P)^D.i(P);return new u(N,this.h^D.h)};function H(D){const A=D.g.length+1,N=[];for(let P=0;P<A;P++)N[P]=D.i(P)<<1|D.i(P-1)>>>31;return new u(N,D.h)}function W(D,A){const N=A>>5;A%=32;const P=D.g.length-N,L=[];for(let B=0;B<P;B++)L[B]=A>0?D.i(B+N)>>>A|D.i(B+N+1)<<32-A:D.i(B+N);return new u(L,D.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,I1=r,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.B,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=m,u.fromString=g,ua=u}).apply(typeof xS<"u"?xS:typeof self<"u"?self:typeof window<"u"?window:{});var zh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var D1,pu,M1,Zh,dy,k1,O1,N1;(function(){var t,e=Object.defineProperty;function n(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof zh=="object"&&zh];for(var w=0;w<p.length;++w){var k=p[w];if(k&&k.Math==Math)return k}throw Error("Cannot find global object")}var r=n(this);function a(p,w){if(w)e:{var k=r;p=p.split(".");for(var $=0;$<p.length-1;$++){var oe=p[$];if(!(oe in k))break e;k=k[oe]}p=p[p.length-1],$=k[p],w=w($),w!=$&&w!=null&&e(k,p,{configurable:!0,writable:!0,value:w})}}a("Symbol.dispose",function(p){return p||Symbol("Symbol.dispose")}),a("Array.prototype.values",function(p){return p||function(){return this[Symbol.iterator]()}}),a("Object.entries",function(p){return p||function(w){var k=[],$;for($ in w)Object.prototype.hasOwnProperty.call(w,$)&&k.push([$,w[$]]);return k}});var o=o||{},u=this||self;function h(p){var w=typeof p;return w=="object"&&p!=null||w=="function"}function f(p,w,k){return p.call.apply(p.bind,arguments)}function m(p,w,k){return m=f,m.apply(null,arguments)}function g(p,w){var k=Array.prototype.slice.call(arguments,1);return function(){var $=k.slice();return $.push.apply($,arguments),p.apply(this,$)}}function _(p,w){function k(){}k.prototype=w.prototype,p.Z=w.prototype,p.prototype=new k,p.prototype.constructor=p,p.Ob=function($,oe,he){for(var Ee=Array(arguments.length-2),Qe=2;Qe<arguments.length;Qe++)Ee[Qe-2]=arguments[Qe];return w.prototype[oe].apply($,Ee)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?p=>p&&AsyncContext.Snapshot.wrap(p):p=>p;function x(p){const w=p.length;if(w>0){const k=Array(w);for(let $=0;$<w;$++)k[$]=p[$];return k}return[]}function S(p,w){for(let $=1;$<arguments.length;$++){const oe=arguments[$];var k=typeof oe;if(k=k!="object"?k:oe?Array.isArray(oe)?"array":k:"null",k=="array"||k=="object"&&typeof oe.length=="number"){k=p.length||0;const he=oe.length||0;p.length=k+he;for(let Ee=0;Ee<he;Ee++)p[k+Ee]=oe[Ee]}else p.push(oe)}}class E{constructor(w,k){this.i=w,this.j=k,this.h=0,this.g=null}get(){let w;return this.h>0?(this.h--,w=this.g,this.g=w.next,w.next=null):w=this.i(),w}}function T(p){u.setTimeout(()=>{throw p},0)}function I(){var p=D;let w=null;return p.g&&(w=p.g,p.g=p.g.next,p.g||(p.h=null),w.next=null),w}class j{constructor(){this.h=this.g=null}add(w,k){const $=M.get();$.set(w,k),this.h?this.h.next=$:this.g=$,this.h=$}}var M=new E(()=>new Q,p=>p.reset());class Q{constructor(){this.next=this.g=this.h=null}set(w,k){this.h=w,this.g=k,this.next=null}reset(){this.next=this.g=this.h=null}}let H,W=!1,D=new j,A=()=>{const p=Promise.resolve(void 0);H=()=>{p.then(N)}};function N(){for(var p;p=I();){try{p.h.call(p.g)}catch(k){T(k)}var w=M;w.j(p),w.h<100&&(w.h++,p.next=w.g,w.g=p)}W=!1}function P(){this.u=this.u,this.C=this.C}P.prototype.u=!1,P.prototype.dispose=function(){this.u||(this.u=!0,this.N())},P.prototype[Symbol.dispose]=function(){this.dispose()},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function L(p,w){this.type=p,this.g=this.target=w,this.defaultPrevented=!1}L.prototype.h=function(){this.defaultPrevented=!0};var B=(function(){if(!u.addEventListener||!Object.defineProperty)return!1;var p=!1,w=Object.defineProperty({},"passive",{get:function(){p=!0}});try{const k=()=>{};u.addEventListener("test",k,w),u.removeEventListener("test",k,w)}catch{}return p})();function O(p){return/^[\s\xa0]*$/.test(p)}function G(p,w){L.call(this,p?p.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,p&&this.init(p,w)}_(G,L),G.prototype.init=function(p,w){const k=this.type=p.type,$=p.changedTouches&&p.changedTouches.length?p.changedTouches[0]:null;this.target=p.target||p.srcElement,this.g=w,w=p.relatedTarget,w||(k=="mouseover"?w=p.fromElement:k=="mouseout"&&(w=p.toElement)),this.relatedTarget=w,$?(this.clientX=$.clientX!==void 0?$.clientX:$.pageX,this.clientY=$.clientY!==void 0?$.clientY:$.pageY,this.screenX=$.screenX||0,this.screenY=$.screenY||0):(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0),this.button=p.button,this.key=p.key||"",this.ctrlKey=p.ctrlKey,this.altKey=p.altKey,this.shiftKey=p.shiftKey,this.metaKey=p.metaKey,this.pointerId=p.pointerId||0,this.pointerType=p.pointerType,this.state=p.state,this.i=p,p.defaultPrevented&&G.Z.h.call(this)},G.prototype.h=function(){G.Z.h.call(this);const p=this.i;p.preventDefault?p.preventDefault():p.returnValue=!1};var Y="closure_listenable_"+(Math.random()*1e6|0),U=0;function F(p,w,k,$,oe){this.listener=p,this.proxy=null,this.src=w,this.type=k,this.capture=!!$,this.ha=oe,this.key=++U,this.da=this.fa=!1}function K(p){p.da=!0,p.listener=null,p.proxy=null,p.src=null,p.ha=null}function Z(p,w,k){for(const $ in p)w.call(k,p[$],$,p)}function re(p,w){for(const k in p)w.call(void 0,p[k],k,p)}function z(p){const w={};for(const k in p)w[k]=p[k];return w}const q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(p,w){let k,$;for(let oe=1;oe<arguments.length;oe++){$=arguments[oe];for(k in $)p[k]=$[k];for(let he=0;he<q.length;he++)k=q[he],Object.prototype.hasOwnProperty.call($,k)&&(p[k]=$[k])}}function ie(p){this.src=p,this.g={},this.h=0}ie.prototype.add=function(p,w,k,$,oe){const he=p.toString();p=this.g[he],p||(p=this.g[he]=[],this.h++);const Ee=le(p,w,$,oe);return Ee>-1?(w=p[Ee],k||(w.fa=!1)):(w=new F(w,this.src,he,!!$,oe),w.fa=k,p.push(w)),w};function ee(p,w){const k=w.type;if(k in p.g){var $=p.g[k],oe=Array.prototype.indexOf.call($,w,void 0),he;(he=oe>=0)&&Array.prototype.splice.call($,oe,1),he&&(K(w),p.g[k].length==0&&(delete p.g[k],p.h--))}}function le(p,w,k,$){for(let oe=0;oe<p.length;++oe){const he=p[oe];if(!he.da&&he.listener==w&&he.capture==!!k&&he.ha==$)return oe}return-1}var pe="closure_lm_"+(Math.random()*1e6|0),xe={};function ve(p,w,k,$,oe){if(Array.isArray(w)){for(let he=0;he<w.length;he++)ve(p,w[he],k,$,oe);return null}return k=Gn(k),p&&p[Y]?p.J(w,k,h($)?!!$.capture:!1,oe):J(p,w,k,!1,$,oe)}function J(p,w,k,$,oe,he){if(!w)throw Error("Invalid event type");const Ee=h(oe)?!!oe.capture:!!oe;let Qe=lt(p);if(Qe||(p[pe]=Qe=new ie(p)),k=Qe.add(w,k,$,Ee,he),k.proxy)return k;if($=Se(),k.proxy=$,$.src=p,$.listener=k,p.addEventListener)B||(oe=Ee),oe===void 0&&(oe=!1),p.addEventListener(w.toString(),$,oe);else if(p.attachEvent)p.attachEvent(Me(w.toString()),$);else if(p.addListener&&p.removeListener)p.addListener($);else throw Error("addEventListener and attachEvent are unavailable.");return k}function Se(){function p(k){return w.call(p.src,p.listener,k)}const w=Ne;return p}function je(p,w,k,$,oe){if(Array.isArray(w))for(var he=0;he<w.length;he++)je(p,w[he],k,$,oe);else $=h($)?!!$.capture:!!$,k=Gn(k),p&&p[Y]?(p=p.i,he=String(w).toString(),he in p.g&&(w=p.g[he],k=le(w,k,$,oe),k>-1&&(K(w[k]),Array.prototype.splice.call(w,k,1),w.length==0&&(delete p.g[he],p.h--)))):p&&(p=lt(p))&&(w=p.g[w.toString()],p=-1,w&&(p=le(w,k,$,oe)),(k=p>-1?w[p]:null)&&at(k))}function at(p){if(typeof p!="number"&&p&&!p.da){var w=p.src;if(w&&w[Y])ee(w.i,p);else{var k=p.type,$=p.proxy;w.removeEventListener?w.removeEventListener(k,$,p.capture):w.detachEvent?w.detachEvent(Me(k),$):w.addListener&&w.removeListener&&w.removeListener($),(k=lt(w))?(ee(k,p),k.h==0&&(k.src=null,w[pe]=null)):K(p)}}}function Me(p){return p in xe?xe[p]:xe[p]="on"+p}function Ne(p,w){if(p.da)p=!0;else{w=new G(w,this);const k=p.listener,$=p.ha||p.src;p.fa&&at(p),p=k.call($,w)}return p}function lt(p){return p=p[pe],p instanceof ie?p:null}var Sn="__closure_events_fn_"+(Math.random()*1e9>>>0);function Gn(p){return typeof p=="function"?p:(p[Sn]||(p[Sn]=function(w){return p.handleEvent(w)}),p[Sn])}function ft(){P.call(this),this.i=new ie(this),this.M=this,this.G=null}_(ft,P),ft.prototype[Y]=!0,ft.prototype.removeEventListener=function(p,w,k,$){je(this,p,w,k,$)};function Mt(p,w){var k,$=p.G;if($)for(k=[];$;$=$.G)k.push($);if(p=p.M,$=w.type||w,typeof w=="string")w=new L(w,p);else if(w instanceof L)w.target=w.target||p;else{var oe=w;w=new L($,p),te(w,oe)}oe=!0;let he,Ee;if(k)for(Ee=k.length-1;Ee>=0;Ee--)he=w.g=k[Ee],oe=Ae(he,$,!0,w)&&oe;if(he=w.g=p,oe=Ae(he,$,!0,w)&&oe,oe=Ae(he,$,!1,w)&&oe,k)for(Ee=0;Ee<k.length;Ee++)he=w.g=k[Ee],oe=Ae(he,$,!1,w)&&oe}ft.prototype.N=function(){if(ft.Z.N.call(this),this.i){var p=this.i;for(const w in p.g){const k=p.g[w];for(let $=0;$<k.length;$++)K(k[$]);delete p.g[w],p.h--}}this.G=null},ft.prototype.J=function(p,w,k,$){return this.i.add(String(p),w,!1,k,$)},ft.prototype.K=function(p,w,k,$){return this.i.add(String(p),w,!0,k,$)};function Ae(p,w,k,$){if(w=p.i.g[String(w)],!w)return!0;w=w.concat();let oe=!0;for(let he=0;he<w.length;++he){const Ee=w[he];if(Ee&&!Ee.da&&Ee.capture==k){const Qe=Ee.listener,Gt=Ee.ha||Ee.src;Ee.fa&&ee(p.i,Ee),oe=Qe.call(Gt,$)!==!1&&oe}}return oe&&!$.defaultPrevented}function Ke(p,w){if(typeof p!="function")if(p&&typeof p.handleEvent=="function")p=m(p.handleEvent,p);else throw Error("Invalid listener argument");return Number(w)>2147483647?-1:u.setTimeout(p,w||0)}function _i(p){p.g=Ke(()=>{p.g=null,p.i&&(p.i=!1,_i(p))},p.l);const w=p.h;p.h=null,p.m.apply(null,w)}class dn extends P{constructor(w,k){super(),this.m=w,this.l=k,this.h=null,this.i=!1,this.g=null}j(w){this.h=arguments,this.g?this.i=!0:_i(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Br(p){P.call(this),this.h=p,this.g={}}_(Br,P);var cc=[];function uc(p){Z(p.g,function(w,k){this.g.hasOwnProperty(k)&&at(w)},p),p.g={}}Br.prototype.N=function(){Br.Z.N.call(this),uc(this)},Br.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var bi=u.JSON.stringify,wm=u.JSON.parse,cd=class{stringify(p){return u.JSON.stringify(p,void 0)}parse(p){return u.JSON.parse(p,void 0)}};function ud(){}function dd(){}var Lr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function wn(){L.call(this,"d")}_(wn,L);function vr(){L.call(this,"c")}_(vr,L);var qt={},hd=null;function Ro(){return hd=hd||new ft}qt.Ia="serverreachability";function fd(p){L.call(this,qt.Ia,p)}_(fd,L);function is(p){const w=Ro();Mt(w,new fd(w))}qt.STAT_EVENT="statevent";function Ra(p,w){L.call(this,qt.STAT_EVENT,p),this.stat=w}_(Ra,L);function Xt(p){const w=Ro();Mt(w,new Ra(w,p))}qt.Ja="timingevent";function as(p,w){L.call(this,qt.Ja,p),this.size=w}_(as,L);function os(p,w){if(typeof p!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){p()},w)}function Ur(){this.g=!0}Ur.prototype.ua=function(){this.g=!1};function Em(p,w,k,$,oe,he){p.info(function(){if(p.g)if(he){var Ee="",Qe=he.split("&");for(let mt=0;mt<Qe.length;mt++){var Gt=Qe[mt].split("=");if(Gt.length>1){const Bt=Gt[0];Gt=Gt[1];const Er=Bt.split("_");Ee=Er.length>=2&&Er[1]=="type"?Ee+(Bt+"="+Gt+"&"):Ee+(Bt+"=redacted&")}}}else Ee=null;else Ee=he;return"XMLHTTP REQ ("+$+") [attempt "+oe+"]: "+w+`
`+k+`
`+Ee})}function md(p,w,k,$,oe,he,Ee){p.info(function(){return"XMLHTTP RESP ("+$+") [ attempt "+oe+"]: "+w+`
`+k+`
`+he+" "+Ee})}function ls(p,w,k,$){p.info(function(){return"XMLHTTP TEXT ("+w+"): "+Cm(p,k)+($?" "+$:"")})}function Ia(p,w){p.info(function(){return"TIMEOUT: "+w})}Ur.prototype.info=function(){};function Cm(p,w){if(!p.g)return w;if(!w)return null;try{const he=JSON.parse(w);if(he){for(p=0;p<he.length;p++)if(Array.isArray(he[p])){var k=he[p];if(!(k.length<2)){var $=k[1];if(Array.isArray($)&&!($.length<1)){var oe=$[0];if(oe!="noop"&&oe!="stop"&&oe!="close")for(let Ee=1;Ee<$.length;Ee++)$[Ee]=""}}}}return bi(he)}catch{return w}}var Da={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},dc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},hc;function Ma(){}_(Ma,ud),Ma.prototype.g=function(){return new XMLHttpRequest},hc=new Ma;function Us(p){return encodeURIComponent(String(p))}function pd(p){var w=1;p=p.split(":");const k=[];for(;w>0&&p.length;)k.push(p.shift()),w--;return p.length&&k.push(p.join(":")),k}function zr(p,w,k,$){this.j=p,this.i=w,this.l=k,this.S=$||1,this.V=new Br(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Fr}function Fr(){this.i=null,this.g="",this.h=!1}var Jt={},_n={};function cs(p,w,k){p.M=1,p.A=ka(en(w)),p.u=k,p.R=!0,Io(p,null)}function Io(p,w){p.F=Date.now(),us(p),p.B=en(p.A);var k=p.B,$=p.S;Array.isArray($)||($=[String($)]),Oo(k.i,"t",$),p.C=0,k=p.j.L,p.h=new Fr,p.g=Id(p.j,k?w:null,!p.u),p.P>0&&(p.O=new dn(m(p.Y,p,p.g),p.P)),w=p.V,k=p.g,$=p.ba;var oe="readystatechange";Array.isArray(oe)||(oe&&(cc[0]=oe.toString()),oe=cc);for(let he=0;he<oe.length;he++){const Ee=ve(k,oe[he],$||w.handleEvent,!1,w.h||w);if(!Ee)break;w.g[Ee.key]=Ee}w=p.J?z(p.J):{},p.u?(p.v||(p.v="POST"),w["Content-Type"]="application/x-www-form-urlencoded",p.g.ea(p.B,p.v,p.u,w)):(p.v="GET",p.g.ea(p.B,p.v,null,w)),is(),Em(p.i,p.v,p.B,p.l,p.S,p.u)}zr.prototype.ba=function(p){p=p.target;const w=this.O;w&&Hr(p)==3?w.j():this.Y(p)},zr.prototype.Y=function(p){try{if(p==this.g)e:{const Qe=Hr(this.g),Gt=this.g.ya(),mt=this.g.ca();if(!(Qe<3)&&(Qe!=3||this.g&&(this.h.h||this.g.la()||En(this.g)))){this.K||Qe!=4||Gt==7||(Gt==8||mt<=0?is(3):is(2)),ds(this);var w=this.g.ca();this.X=w;var k=Tm(this);if(this.o=w==200,md(this.i,this.v,this.B,this.l,this.S,Qe,w),this.o){if(this.U&&!this.L){t:{if(this.g){var $,oe=this.g;if(($=oe.g?oe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O($)){var he=$;break t}}he=null}if(p=he)ls(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,hs(this,p);else{this.o=!1,this.m=3,Xt(12),ir(this),xr(this);break e}}if(this.R){p=!0;let Bt;for(;!this.K&&this.C<k.length;)if(Bt=yd(this,k),Bt==_n){Qe==4&&(this.m=4,Xt(14),p=!1),ls(this.i,this.l,null,"[Incomplete Response]");break}else if(Bt==Jt){this.m=4,Xt(15),ls(this.i,this.l,k,"[Invalid Chunk]"),p=!1;break}else ls(this.i,this.l,Bt,null),hs(this,Bt);if(gd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Qe!=4||k.length!=0||this.h.h||(this.m=1,Xt(16),p=!1),this.o=this.o&&p,!p)ls(this.i,this.l,k,"[Invalid Chunked Response]"),ir(this),xr(this);else if(k.length>0&&!this.W){this.W=!0;var Ee=this.j;Ee.g==this&&Ee.aa&&!Ee.P&&(Ee.j.info("Great, no buffering proxy detected. Bytes received: "+k.length),Ac(Ee),Ee.P=!0,Xt(11))}}else ls(this.i,this.l,k,null),hs(this,k);Qe==4&&ir(this),this.o&&!this.K&&(Qe==4?Td(this.j,this):(this.o=!1,us(this)))}else Fs(this.g),w==400&&k.indexOf("Unknown SID")>0?(this.m=3,Xt(12)):(this.m=0,Xt(13)),ir(this),xr(this)}}}catch{}};function Tm(p){if(!gd(p))return p.g.la();const w=En(p.g);if(w==="")return"";let k="";const $=w.length,oe=Hr(p.g)==4;if(!p.h.i){if(typeof TextDecoder>"u")return ir(p),xr(p),"";p.h.i=new u.TextDecoder}for(let he=0;he<$;he++)p.h.h=!0,k+=p.h.i.decode(w[he],{stream:!(oe&&he==$-1)});return w.length=0,p.h.g+=k,p.C=0,p.h.g}function gd(p){return p.g?p.v=="GET"&&p.M!=2&&p.j.Aa:!1}function yd(p,w){var k=p.C,$=w.indexOf(`
`,k);return $==-1?_n:(k=Number(w.substring(k,$)),isNaN(k)?Jt:($+=1,$+k>w.length?_n:(w=w.slice($,$+k),p.C=$+k,w)))}zr.prototype.cancel=function(){this.K=!0,ir(this)};function us(p){p.T=Date.now()+p.H,Do(p,p.H)}function Do(p,w){if(p.D!=null)throw Error("WatchDog timer not null");p.D=os(m(p.aa,p),w)}function ds(p){p.D&&(u.clearTimeout(p.D),p.D=null)}zr.prototype.aa=function(){this.D=null;const p=Date.now();p-this.T>=0?(Ia(this.i,this.B),this.M!=2&&(is(),Xt(17)),ir(this),this.m=2,xr(this)):Do(this,this.T-p)};function xr(p){p.j.I==0||p.K||Td(p.j,p)}function ir(p){ds(p);var w=p.O;w&&typeof w.dispose=="function"&&w.dispose(),p.O=null,uc(p.V),p.g&&(w=p.g,p.g=null,w.abort(),w.dispose())}function hs(p,w){try{var k=p.j;if(k.I!=0&&(k.g==p||ms(k.h,p))){if(!p.L&&ms(k.h,p)&&k.I==3){try{var $=k.Ba.g.parse(w)}catch{$=null}if(Array.isArray($)&&$.length==3){var oe=$;if(oe[0]==0){e:if(!k.v){if(k.g)if(k.g.F+3e3<p.F)Uo(k),Ai(k);else break e;za(k),Xt(18)}}else k.xa=oe[1],0<k.xa-k.K&&oe[2]<37500&&k.F&&k.A==0&&!k.C&&(k.C=os(m(k.Va,k),6e3));fs(k.h)<=1&&k.ta&&(k.ta=void 0)}else vs(k,11)}else if((p.L||k.g==p)&&Uo(k),!O(w))for(oe=k.Ba.g.parse(w),w=0;w<oe.length;w++){let mt=oe[w];const Bt=mt[0];if(!(Bt<=k.K))if(k.K=Bt,mt=mt[1],k.I==2)if(mt[0]=="c"){k.M=mt[1],k.ba=mt[2];const Er=mt[3];Er!=null&&(k.ka=Er,k.j.info("VER="+k.ka));const xs=mt[4];xs!=null&&(k.za=xs,k.j.info("SVER="+k.za));const qr=mt[5];qr!=null&&typeof qr=="number"&&qr>0&&($=1.5*qr,k.O=$,k.j.info("backChannelRequestTimeoutMs_="+$)),$=k;const Gr=p.g;if(Gr){const Fa=Gr.g?Gr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Fa){var he=$.h;he.g||Fa.indexOf("spdy")==-1&&Fa.indexOf("quic")==-1&&Fa.indexOf("h2")==-1||(he.j=he.l,he.g=new Set,he.h&&(pc(he,he.h),he.h=null))}if($.G){const zo=Gr.g?Gr.g.getResponseHeader("X-HTTP-Session-Id"):null;zo&&($.wa=zo,yt($.J,$.G,zo))}}k.I=3,k.l&&k.l.ra(),k.aa&&(k.T=Date.now()-p.F,k.j.info("Handshake RTT: "+k.T+"ms")),$=k;var Ee=p;if($.na=Rd($,$.L?$.ba:null,$.W),Ee.L){gc($.h,Ee);var Qe=Ee,Gt=$.O;Gt&&(Qe.H=Gt),Qe.D&&(ds(Qe),us(Qe)),$.g=Ee}else Ed($);k.i.length>0&&bs(k)}else mt[0]!="stop"&&mt[0]!="close"||vs(k,7);else k.I==3&&(mt[0]=="stop"||mt[0]=="close"?mt[0]=="stop"?vs(k,7):Cc(k):mt[0]!="noop"&&k.l&&k.l.qa(mt),k.A=0)}}is(4)}catch{}}var Zt=class{constructor(p,w){this.g=p,this.map=w}};function fc(p){this.l=p||10,u.PerformanceNavigationTiming?(p=u.performance.getEntriesByType("navigation"),p=p.length>0&&(p[0].nextHopProtocol=="hq"||p[0].nextHopProtocol=="h2")):p=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=p?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function mc(p){return p.h?!0:p.g?p.g.size>=p.j:!1}function fs(p){return p.h?1:p.g?p.g.size:0}function ms(p,w){return p.h?p.h==w:p.g?p.g.has(w):!1}function pc(p,w){p.g?p.g.add(w):p.h=w}function gc(p,w){p.h&&p.h==w?p.h=null:p.g&&p.g.has(w)&&p.g.delete(w)}fc.prototype.cancel=function(){if(this.i=yc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const p of this.g.values())p.cancel();this.g.clear()}};function yc(p){if(p.h!=null)return p.i.concat(p.h.G);if(p.g!=null&&p.g.size!==0){let w=p.i;for(const k of p.g.values())w=w.concat(k.G);return w}return x(p.i)}var _d=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Mo(p,w){if(p){p=p.split("&");for(let k=0;k<p.length;k++){const $=p[k].indexOf("=");let oe,he=null;$>=0?(oe=p[k].substring(0,$),he=p[k].substring($+1)):oe=p[k],w(oe,he?decodeURIComponent(he.replace(/\+/g," ")):"")}}}function ar(p){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let w;p instanceof ar?(this.l=p.l,bn(this,p.j),this.o=p.o,this.g=p.g,vi(this,p.u),this.h=p.h,_c(this,Sd(p.i)),this.m=p.m):p&&(w=String(p).match(_d))?(this.l=!1,bn(this,w[1]||"",!0),this.o=ps(w[2]||""),this.g=ps(w[3]||"",!0),vi(this,w[4]),this.h=ps(w[5]||"",!0),_c(this,w[6]||"",!0),this.m=ps(w[7]||"")):(this.l=!1,this.i=new Si(null,this.l))}ar.prototype.toString=function(){const p=[];var w=this.j;w&&p.push(Oa(w,ko,!0),":");var k=this.g;return(k||w=="file")&&(p.push("//"),(w=this.o)&&p.push(Oa(w,ko,!0),"@"),p.push(Us(k).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),k=this.u,k!=null&&p.push(":",String(k))),(k=this.h)&&(this.g&&k.charAt(0)!="/"&&p.push("/"),p.push(Oa(k,k.charAt(0)=="/"?bc:bd,!0))),(k=this.i.toString())&&p.push("?",k),(k=this.m)&&p.push("#",Oa(k,vd)),p.join("")},ar.prototype.resolve=function(p){const w=en(this);let k=!!p.j;k?bn(w,p.j):k=!!p.o,k?w.o=p.o:k=!!p.g,k?w.g=p.g:k=p.u!=null;var $=p.h;if(k)vi(w,p.u);else if(k=!!p.h){if($.charAt(0)!="/")if(this.g&&!this.h)$="/"+$;else{var oe=w.h.lastIndexOf("/");oe!=-1&&($=w.h.slice(0,oe+1)+$)}if(oe=$,oe==".."||oe==".")$="";else if(oe.indexOf("./")!=-1||oe.indexOf("/.")!=-1){$=oe.lastIndexOf("/",0)==0,oe=oe.split("/");const he=[];for(let Ee=0;Ee<oe.length;){const Qe=oe[Ee++];Qe=="."?$&&Ee==oe.length&&he.push(""):Qe==".."?((he.length>1||he.length==1&&he[0]!="")&&he.pop(),$&&Ee==oe.length&&he.push("")):(he.push(Qe),$=!0)}$=he.join("/")}else $=oe}return k?w.h=$:k=p.i.toString()!=="",k?_c(w,Sd(p.i)):k=!!p.m,k&&(w.m=p.m),w};function en(p){return new ar(p)}function bn(p,w,k){p.j=k?ps(w,!0):w,p.j&&(p.j=p.j.replace(/:$/,""))}function vi(p,w){if(w){if(w=Number(w),isNaN(w)||w<0)throw Error("Bad port number "+w);p.u=w}else p.u=null}function _c(p,w,k){w instanceof Si?(p.i=w,No(p.i,p.l)):(k||(w=Oa(w,xi)),p.i=new Si(w,p.l))}function yt(p,w,k){p.i.set(w,k)}function ka(p){return yt(p,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),p}function ps(p,w){return p?w?decodeURI(p.replace(/%25/g,"%2525")):decodeURIComponent(p):""}function Oa(p,w,k){return typeof p=="string"?(p=encodeURI(p).replace(w,Qn),k&&(p=p.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p):null}function Qn(p){return p=p.charCodeAt(0),"%"+(p>>4&15).toString(16)+(p&15).toString(16)}var ko=/[#\/\?@]/g,bd=/[#\?:]/g,bc=/[#\?]/g,xi=/[#\?@]/g,vd=/#/g;function Si(p,w){this.h=this.g=null,this.i=p||null,this.j=!!w}function Wn(p){p.g||(p.g=new Map,p.h=0,p.i&&Mo(p.i,function(w,k){p.add(decodeURIComponent(w.replace(/\+/g," ")),k)}))}t=Si.prototype,t.add=function(p,w){Wn(this),this.i=null,p=wi(this,p);let k=this.g.get(p);return k||this.g.set(p,k=[]),k.push(w),this.h+=1,this};function xd(p,w){Wn(p),w=wi(p,w),p.g.has(w)&&(p.i=null,p.h-=p.g.get(w).length,p.g.delete(w))}function vc(p,w){return Wn(p),w=wi(p,w),p.g.has(w)}t.forEach=function(p,w){Wn(this),this.g.forEach(function(k,$){k.forEach(function(oe){p.call(w,oe,$,this)},this)},this)};function xc(p,w){Wn(p);let k=[];if(typeof w=="string")vc(p,w)&&(k=k.concat(p.g.get(wi(p,w))));else for(p=Array.from(p.g.values()),w=0;w<p.length;w++)k=k.concat(p[w]);return k}t.set=function(p,w){return Wn(this),this.i=null,p=wi(this,p),vc(this,p)&&(this.h-=this.g.get(p).length),this.g.set(p,[w]),this.h+=1,this},t.get=function(p,w){return p?(p=xc(this,p),p.length>0?String(p[0]):w):w};function Oo(p,w,k){xd(p,w),k.length>0&&(p.i=null,p.g.set(wi(p,w),x(k)),p.h+=k.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const p=[],w=Array.from(this.g.keys());for(let $=0;$<w.length;$++){var k=w[$];const oe=Us(k);k=xc(this,k);for(let he=0;he<k.length;he++){let Ee=oe;k[he]!==""&&(Ee+="="+Us(k[he])),p.push(Ee)}}return this.i=p.join("&")};function Sd(p){const w=new Si;return w.i=p.i,p.g&&(w.g=new Map(p.g),w.h=p.h),w}function wi(p,w){return w=String(w),p.j&&(w=w.toLowerCase()),w}function No(p,w){w&&!p.j&&(Wn(p),p.i=null,p.g.forEach(function(k,$){const oe=$.toLowerCase();$!=oe&&(xd(this,$),Oo(this,oe,k))},p)),p.j=w}function Vr(p,w){const k=new Ur;if(u.Image){const $=new Image;$.onload=g(Sr,k,"TestLoadImage: loaded",!0,w,$),$.onerror=g(Sr,k,"TestLoadImage: error",!1,w,$),$.onabort=g(Sr,k,"TestLoadImage: abort",!1,w,$),$.ontimeout=g(Sr,k,"TestLoadImage: timeout",!1,w,$),u.setTimeout(function(){$.ontimeout&&$.ontimeout()},1e4),$.src=p}else w(!1)}function Sc(p,w){const k=new Ur,$=new AbortController,oe=setTimeout(()=>{$.abort(),Sr(k,"TestPingServer: timeout",!1,w)},1e4);fetch(p,{signal:$.signal}).then(he=>{clearTimeout(oe),he.ok?Sr(k,"TestPingServer: ok",!0,w):Sr(k,"TestPingServer: server error",!1,w)}).catch(()=>{clearTimeout(oe),Sr(k,"TestPingServer: error",!1,w)})}function Sr(p,w,k,$,oe){try{oe&&(oe.onload=null,oe.onerror=null,oe.onabort=null,oe.ontimeout=null),$(k)}catch{}}function Ei(){this.g=new cd}function gs(p){this.i=p.Sb||null,this.h=p.ab||!1}_(gs,ud),gs.prototype.g=function(){return new Na(this.i,this.h)};function Na(p,w){ft.call(this),this.H=p,this.o=w,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}_(Na,ft),t=Na.prototype,t.open=function(p,w){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=p,this.D=w,this.readyState=1,$r(this)},t.send=function(p){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const w={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};p&&(w.body=p),(this.H||u).fetch(new Request(this.D,w)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Ci(this)),this.readyState=0},t.Pa=function(p){if(this.g&&(this.l=p,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=p.headers,this.readyState=2,$r(this)),this.g&&(this.readyState=3,$r(this),this.g)))if(this.responseType==="arraybuffer")p.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in p){if(this.j=p.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Po(this)}else p.text().then(this.Oa.bind(this),this.ga.bind(this))};function Po(p){p.j.read().then(p.Ma.bind(p)).catch(p.ga.bind(p))}t.Ma=function(p){if(this.g){if(this.o&&p.value)this.response.push(p.value);else if(!this.o){var w=p.value?p.value:new Uint8Array(0);(w=this.B.decode(w,{stream:!p.done}))&&(this.response=this.responseText+=w)}p.done?Ci(this):$r(this),this.readyState==3&&Po(this)}},t.Oa=function(p){this.g&&(this.response=this.responseText=p,Ci(this))},t.Na=function(p){this.g&&(this.response=p,Ci(this))},t.ga=function(){this.g&&Ci(this)};function Ci(p){p.readyState=4,p.l=null,p.j=null,p.B=null,$r(p)}t.setRequestHeader=function(p,w){this.A.append(p,w)},t.getResponseHeader=function(p){return this.h&&this.h.get(p.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const p=[],w=this.h.entries();for(var k=w.next();!k.done;)k=k.value,p.push(k[0]+": "+k[1]),k=w.next();return p.join(`\r
`)};function $r(p){p.onreadystatechange&&p.onreadystatechange.call(p)}Object.defineProperty(Na.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(p){this.m=p?"include":"same-origin"}});function wr(p){let w="";return Z(p,function(k,$){w+=$,w+=":",w+=k,w+=`\r
`}),w}function Pa(p,w,k){e:{for($ in k){var $=!1;break e}$=!0}$||(k=wr(k),typeof p=="string"?k!=null&&Us(k):yt(p,w,k))}function vt(p){ft.call(this),this.headers=new Map,this.L=p||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}_(vt,ft);var ys=/^https?$/i,wc=["POST","PUT"];t=vt.prototype,t.Fa=function(p){this.H=p},t.ea=function(p,w,k,$){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+p);w=w?w.toUpperCase():"GET",this.D=p,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():hc.g(),this.g.onreadystatechange=v(m(this.Ca,this));try{this.B=!0,this.g.open(w,String(p),!0),this.B=!1}catch(he){Ba(this,he);return}if(p=k||"",k=new Map(this.headers),$)if(Object.getPrototypeOf($)===Object.prototype)for(var oe in $)k.set(oe,$[oe]);else if(typeof $.keys=="function"&&typeof $.get=="function")for(const he of $.keys())k.set(he,$.get(he));else throw Error("Unknown input type for opt_headers: "+String($));$=Array.from(k.keys()).find(he=>he.toLowerCase()=="content-type"),oe=u.FormData&&p instanceof u.FormData,!(Array.prototype.indexOf.call(wc,w,void 0)>=0)||$||oe||k.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[he,Ee]of k)this.g.setRequestHeader(he,Ee);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(p),this.v=!1}catch(he){Ba(this,he)}};function Ba(p,w){p.h=!1,p.g&&(p.j=!0,p.g.abort(),p.j=!1),p.l=w,p.o=5,Ec(p),zs(p)}function Ec(p){p.A||(p.A=!0,Mt(p,"complete"),Mt(p,"error"))}t.abort=function(p){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=p||7,Mt(this,"complete"),Mt(this,"abort"),zs(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),zs(this,!0)),vt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?La(this):this.Xa())},t.Xa=function(){La(this)};function La(p){if(p.h&&typeof o<"u"){if(p.v&&Hr(p)==4)setTimeout(p.Ca.bind(p),0);else if(Mt(p,"readystatechange"),Hr(p)==4){p.h=!1;try{const he=p.ca();e:switch(he){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var w=!0;break e;default:w=!1}var k;if(!(k=w)){var $;if($=he===0){let Ee=String(p.D).match(_d)[1]||null;!Ee&&u.self&&u.self.location&&(Ee=u.self.location.protocol.slice(0,-1)),$=!ys.test(Ee?Ee.toLowerCase():"")}k=$}if(k)Mt(p,"complete"),Mt(p,"success");else{p.o=6;try{var oe=Hr(p)>2?p.g.statusText:""}catch{oe=""}p.l=oe+" ["+p.ca()+"]",Ec(p)}}finally{zs(p)}}}}function zs(p,w){if(p.g){p.m&&(clearTimeout(p.m),p.m=null);const k=p.g;p.g=null,w||Mt(p,"ready");try{k.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Hr(p){return p.g?p.g.readyState:0}t.ca=function(){try{return Hr(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(p){if(this.g){var w=this.g.responseText;return p&&w.indexOf(p)==0&&(w=w.substring(p.length)),wm(w)}};function En(p){try{if(!p.g)return null;if("response"in p.g)return p.g.response;switch(p.F){case"":case"text":return p.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in p.g)return p.g.mozResponseArrayBuffer}return null}catch{return null}}function Fs(p){const w={};p=(p.g&&Hr(p)>=2&&p.g.getAllResponseHeaders()||"").split(`\r
`);for(let $=0;$<p.length;$++){if(O(p[$]))continue;var k=pd(p[$]);const oe=k[0];if(k=k[1],typeof k!="string")continue;k=k.trim();const he=w[oe]||[];w[oe]=he,he.push(k)}re(w,function($){return $.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function _s(p,w,k){return k&&k.internalChannelParams&&k.internalChannelParams[p]||w}function Ti(p){this.za=0,this.i=[],this.j=new Ur,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=_s("failFast",!1,p),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=_s("baseRetryDelayMs",5e3,p),this.Za=_s("retryDelaySeedMs",1e4,p),this.Ta=_s("forwardChannelMaxRetries",2,p),this.va=_s("forwardChannelRequestTimeoutMs",2e4,p),this.ma=p&&p.xmlHttpFactory||void 0,this.Ua=p&&p.Rb||void 0,this.Aa=p&&p.useFetchStreams||!1,this.O=void 0,this.L=p&&p.supportsCrossDomainXhr||!1,this.M="",this.h=new fc(p&&p.concurrentRequestLimit),this.Ba=new Ei,this.S=p&&p.fastHandshake||!1,this.R=p&&p.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=p&&p.Pb||!1,p&&p.ua&&this.j.ua(),p&&p.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&p&&p.detectBufferingProxy||!1,this.ia=void 0,p&&p.longPollingTimeout&&p.longPollingTimeout>0&&(this.ia=p.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Ti.prototype,t.ka=8,t.I=1,t.connect=function(p,w,k,$){Xt(0),this.W=p,this.H=w||{},k&&$!==void 0&&(this.H.OSID=k,this.H.OAID=$),this.F=this.X,this.J=Rd(this,null,this.W),bs(this)};function Cc(p){if(Bo(p),p.I==3){var w=p.V++,k=en(p.J);if(yt(k,"SID",p.M),yt(k,"RID",w),yt(k,"TYPE","terminate"),Ua(p,k),w=new zr(p,p.j,w),w.M=2,w.A=ka(en(k)),k=!1,u.navigator&&u.navigator.sendBeacon)try{k=u.navigator.sendBeacon(w.A.toString(),"")}catch{}!k&&u.Image&&(new Image().src=w.A,k=!0),k||(w.g=Id(w.j,null),w.g.ea(w.A)),w.F=Date.now(),us(w)}jd(p)}function Ai(p){p.g&&(Ac(p),p.g.cancel(),p.g=null)}function Bo(p){Ai(p),p.v&&(u.clearTimeout(p.v),p.v=null),Uo(p),p.h.cancel(),p.m&&(typeof p.m=="number"&&u.clearTimeout(p.m),p.m=null)}function bs(p){if(!mc(p.h)&&!p.m){p.m=!0;var w=p.Ea;H||A(),W||(H(),W=!0),D.add(w,p),p.D=0}}function Lo(p,w){return fs(p.h)>=p.h.j-(p.m?1:0)?!1:p.m?(p.i=w.G.concat(p.i),!0):p.I==1||p.I==2||p.D>=(p.Sa?0:p.Ta)?!1:(p.m=os(m(p.Ea,p,w),Ad(p,p.D)),p.D++,!0)}t.Ea=function(p){if(this.m)if(this.m=null,this.I==1){if(!p){this.V=Math.floor(Math.random()*1e5),p=this.V++;const oe=new zr(this,this.j,p);let he=this.o;if(this.U&&(he?(he=z(he),te(he,this.U)):he=this.U),this.u!==null||this.R||(oe.J=he,he=null),this.S)e:{for(var w=0,k=0;k<this.i.length;k++){t:{var $=this.i[k];if("__data__"in $.map&&($=$.map.__data__,typeof $=="string")){$=$.length;break t}$=void 0}if($===void 0)break;if(w+=$,w>4096){w=k;break e}if(w===4096||k===this.i.length-1){w=k+1;break e}}w=1e3}else w=1e3;w=wd(this,oe,w),k=en(this.J),yt(k,"RID",p),yt(k,"CVER",22),this.G&&yt(k,"X-HTTP-Session-Id",this.G),Ua(this,k),he&&(this.R?w="headers="+Us(wr(he))+"&"+w:this.u&&Pa(k,this.u,he)),pc(this.h,oe),this.Ra&&yt(k,"TYPE","init"),this.S?(yt(k,"$req",w),yt(k,"SID","null"),oe.U=!0,cs(oe,k,null)):cs(oe,k,w),this.I=2}}else this.I==3&&(p?Tc(this,p):this.i.length==0||mc(this.h)||Tc(this))};function Tc(p,w){var k;w?k=w.l:k=p.V++;const $=en(p.J);yt($,"SID",p.M),yt($,"RID",k),yt($,"AID",p.K),Ua(p,$),p.u&&p.o&&Pa($,p.u,p.o),k=new zr(p,p.j,k,p.D+1),p.u===null&&(k.J=p.o),w&&(p.i=w.G.concat(p.i)),w=wd(p,k,1e3),k.H=Math.round(p.va*.5)+Math.round(p.va*.5*Math.random()),pc(p.h,k),cs(k,$,w)}function Ua(p,w){p.H&&Z(p.H,function(k,$){yt(w,$,k)}),p.l&&Z({},function(k,$){yt(w,$,k)})}function wd(p,w,k){k=Math.min(p.i.length,k);const $=p.l?m(p.l.Ka,p.l,p):null;e:{var oe=p.i;let Qe=-1;for(;;){const Gt=["count="+k];Qe==-1?k>0?(Qe=oe[0].g,Gt.push("ofs="+Qe)):Qe=0:Gt.push("ofs="+Qe);let mt=!0;for(let Bt=0;Bt<k;Bt++){var he=oe[Bt].g;const Er=oe[Bt].map;if(he-=Qe,he<0)Qe=Math.max(0,oe[Bt].g-100),mt=!1;else try{he="req"+he+"_"||"";try{var Ee=Er instanceof Map?Er:Object.entries(Er);for(const[xs,qr]of Ee){let Gr=qr;h(qr)&&(Gr=bi(qr)),Gt.push(he+xs+"="+encodeURIComponent(Gr))}}catch(xs){throw Gt.push(he+"type="+encodeURIComponent("_badmap")),xs}}catch{$&&$(Er)}}if(mt){Ee=Gt.join("&");break e}}Ee=void 0}return p=p.i.splice(0,k),w.G=p,Ee}function Ed(p){if(!p.g&&!p.v){p.Y=1;var w=p.Da;H||A(),W||(H(),W=!0),D.add(w,p),p.A=0}}function za(p){return p.g||p.v||p.A>=3?!1:(p.Y++,p.v=os(m(p.Da,p),Ad(p,p.A)),p.A++,!0)}t.Da=function(){if(this.v=null,Cd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var p=4*this.T;this.j.info("BP detection timer enabled: "+p),this.B=os(m(this.Wa,this),p)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Xt(10),Ai(this),Cd(this))};function Ac(p){p.B!=null&&(u.clearTimeout(p.B),p.B=null)}function Cd(p){p.g=new zr(p,p.j,"rpc",p.Y),p.u===null&&(p.g.J=p.o),p.g.P=0;var w=en(p.na);yt(w,"RID","rpc"),yt(w,"SID",p.M),yt(w,"AID",p.K),yt(w,"CI",p.F?"0":"1"),!p.F&&p.ia&&yt(w,"TO",p.ia),yt(w,"TYPE","xmlhttp"),Ua(p,w),p.u&&p.o&&Pa(w,p.u,p.o),p.O&&(p.g.H=p.O);var k=p.g;p=p.ba,k.M=1,k.A=ka(en(w)),k.u=null,k.R=!0,Io(k,p)}t.Va=function(){this.C!=null&&(this.C=null,Ai(this),za(this),Xt(19))};function Uo(p){p.C!=null&&(u.clearTimeout(p.C),p.C=null)}function Td(p,w){var k=null;if(p.g==w){Uo(p),Ac(p),p.g=null;var $=2}else if(ms(p.h,w))k=w.G,gc(p.h,w),$=1;else return;if(p.I!=0){if(w.o)if($==1){k=w.u?w.u.length:0,w=Date.now()-w.F;var oe=p.D;$=Ro(),Mt($,new as($,k)),bs(p)}else Ed(p);else if(oe=w.m,oe==3||oe==0&&w.X>0||!($==1&&Lo(p,w)||$==2&&za(p)))switch(k&&k.length>0&&(w=p.h,w.i=w.i.concat(k)),oe){case 1:vs(p,5);break;case 4:vs(p,10);break;case 3:vs(p,6);break;default:vs(p,2)}}}function Ad(p,w){let k=p.Qa+Math.floor(Math.random()*p.Za);return p.isActive()||(k*=2),k*w}function vs(p,w){if(p.j.info("Error code "+w),w==2){var k=m(p.bb,p),$=p.Ua;const oe=!$;$=new ar($||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||bn($,"https"),ka($),oe?Vr($.toString(),k):Sc($.toString(),k)}else Xt(2);p.I=0,p.l&&p.l.pa(w),jd(p),Bo(p)}t.bb=function(p){p?(this.j.info("Successfully pinged google.com"),Xt(2)):(this.j.info("Failed to ping google.com"),Xt(1))};function jd(p){if(p.I=0,p.ja=[],p.l){const w=yc(p.h);(w.length!=0||p.i.length!=0)&&(S(p.ja,w),S(p.ja,p.i),p.h.i.length=0,x(p.i),p.i.length=0),p.l.oa()}}function Rd(p,w,k){var $=k instanceof ar?en(k):new ar(k);if($.g!="")w&&($.g=w+"."+$.g),vi($,$.u);else{var oe=u.location;$=oe.protocol,w=w?w+"."+oe.hostname:oe.hostname,oe=+oe.port;const he=new ar(null);$&&bn(he,$),w&&(he.g=w),oe&&vi(he,oe),k&&(he.h=k),$=he}return k=p.G,w=p.wa,k&&w&&yt($,k,w),yt($,"VER",p.ka),Ua(p,$),$}function Id(p,w,k){if(w&&!p.L)throw Error("Can't create secondary domain capable XhrIo object.");return w=p.Aa&&!p.ma?new vt(new gs({ab:k})):new vt(p.ma),w.Fa(p.L),w}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Dd(){}t=Dd.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function ji(){}ji.prototype.g=function(p,w){return new Vn(p,w)};function Vn(p,w){ft.call(this),this.g=new Ti(w),this.l=p,this.h=w&&w.messageUrlParams||null,p=w&&w.messageHeaders||null,w&&w.clientProtocolHeaderRequired&&(p?p["X-Client-Protocol"]="webchannel":p={"X-Client-Protocol":"webchannel"}),this.g.o=p,p=w&&w.initMessageHeaders||null,w&&w.messageContentType&&(p?p["X-WebChannel-Content-Type"]=w.messageContentType:p={"X-WebChannel-Content-Type":w.messageContentType}),w&&w.sa&&(p?p["X-WebChannel-Client-Profile"]=w.sa:p={"X-WebChannel-Client-Profile":w.sa}),this.g.U=p,(p=w&&w.Qb)&&!O(p)&&(this.g.u=p),this.A=w&&w.supportsCrossDomainXhr||!1,this.v=w&&w.sendRawJson||!1,(w=w&&w.httpSessionIdParam)&&!O(w)&&(this.g.G=w,p=this.h,p!==null&&w in p&&(p=this.h,w in p&&delete p[w])),this.j=new Vs(this)}_(Vn,ft),Vn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Vn.prototype.close=function(){Cc(this.g)},Vn.prototype.o=function(p){var w=this.g;if(typeof p=="string"){var k={};k.__data__=p,p=k}else this.v&&(k={},k.__data__=bi(p),p=k);w.i.push(new Zt(w.Ya++,p)),w.I==3&&bs(w)},Vn.prototype.N=function(){this.g.l=null,delete this.j,Cc(this.g),delete this.g,Vn.Z.N.call(this)};function Md(p){wn.call(this),p.__headers__&&(this.headers=p.__headers__,this.statusCode=p.__status__,delete p.__headers__,delete p.__status__);var w=p.__sm__;if(w){e:{for(const k in w){p=k;break e}p=void 0}(this.i=p)&&(p=this.i,w=w!==null&&p in w?w[p]:void 0),this.data=w}else this.data=p}_(Md,wn);function kd(){vr.call(this),this.status=1}_(kd,vr);function Vs(p){this.g=p}_(Vs,Dd),Vs.prototype.ra=function(){Mt(this.g,"a")},Vs.prototype.qa=function(p){Mt(this.g,new Md(p))},Vs.prototype.pa=function(p){Mt(this.g,new kd)},Vs.prototype.oa=function(){Mt(this.g,"b")},ji.prototype.createWebChannel=ji.prototype.g,Vn.prototype.send=Vn.prototype.o,Vn.prototype.open=Vn.prototype.m,Vn.prototype.close=Vn.prototype.close,N1=function(){return new ji},O1=function(){return Ro()},k1=qt,dy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Da.NO_ERROR=0,Da.TIMEOUT=8,Da.HTTP_ERROR=6,Zh=Da,dc.COMPLETE="complete",M1=dc,dd.EventType=Lr,Lr.OPEN="a",Lr.CLOSE="b",Lr.ERROR="c",Lr.MESSAGE="d",ft.prototype.listen=ft.prototype.J,pu=dd,vt.prototype.listenOnce=vt.prototype.K,vt.prototype.getLastError=vt.prototype.Ha,vt.prototype.getLastErrorCode=vt.prototype.ya,vt.prototype.getStatus=vt.prototype.ca,vt.prototype.getResponseJson=vt.prototype.La,vt.prototype.getResponseText=vt.prototype.la,vt.prototype.send=vt.prototype.ea,vt.prototype.setWithCredentials=vt.prototype.Fa,D1=vt}).apply(typeof zh<"u"?zh:typeof self<"u"?self:typeof window<"u"?window:{});const SS="@firebase/firestore",wS="4.9.3";class Pn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Pn.UNAUTHENTICATED=new Pn(null),Pn.GOOGLE_CREDENTIALS=new Pn("google-credentials-uid"),Pn.FIRST_PARTY=new Pn("first-party-uid"),Pn.MOCK_USER=new Pn("mock-user");let Jl="12.7.0";const yo=new zy("@firebase/firestore");function xl(){return yo.logLevel}function Re(t,...e){if(yo.logLevel<=rt.DEBUG){const n=e.map(n0);yo.debug(`Firestore (${Jl}): ${t}`,...n)}}function hi(t,...e){if(yo.logLevel<=rt.ERROR){const n=e.map(n0);yo.error(`Firestore (${Jl}): ${t}`,...n)}}function kl(t,...e){if(yo.logLevel<=rt.WARN){const n=e.map(n0);yo.warn(`Firestore (${Jl}): ${t}`,...n)}}function n0(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Ve(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,P1(t,r,n)}function P1(t,e,n){let r=`FIRESTORE (${Jl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw hi(r),new Error(r)}function gt(t,e,n,r){let a="Unexpected state";typeof n=="string"?a=n:r=n,t||P1(e,a,r)}function Ge(t,e){return t}const ye={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Te extends gi{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class li{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class B1{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Vk{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Pn.UNAUTHENTICATED)))}shutdown(){}}class $k{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class Hk{constructor(e){this.t=e,this.currentUser=Pn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){gt(this.o===void 0,42304);let r=this.i;const a=f=>this.i!==r?(r=this.i,n(f)):Promise.resolve();let o=new li;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new li,e.enqueueRetryable((()=>a(this.currentUser)))};const u=()=>{const f=o;e.enqueueRetryable((async()=>{await f.promise,await a(this.currentUser)}))},h=f=>{Re("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit((f=>h(f))),setTimeout((()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?h(f):(Re("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new li)}}),0),u()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Re("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(gt(typeof r.accessToken=="string",31837,{l:r}),new B1(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return gt(e===null||typeof e=="string",2055,{h:e}),new Pn(e)}}class qk{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Pn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Gk{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new qk(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Pn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ES{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Qk{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Yr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){gt(this.o===void 0,3512);const r=o=>{o.error!=null&&Re("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const u=o.token!==this.m;return this.m=o.token,Re("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const a=o=>{Re("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>a(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?a(o):Re("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new ES(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(gt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new ES(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Wk(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class r0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const a=Wk(40);for(let o=0;o<a.length;++o)r.length<20&&a[o]<n&&(r+=e.charAt(a[o]%62))}return r}}function st(t,e){return t<e?-1:t>e?1:0}function hy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const a=t.charAt(r),o=e.charAt(r);if(a!==o)return Pg(a)===Pg(o)?st(a,o):Pg(a)?1:-1}return st(t.length,e.length)}const Kk=55296,Yk=57343;function Pg(t){const e=t.charCodeAt(0);return e>=Kk&&e<=Yk}function Ol(t,e,n){return t.length===e.length&&t.every(((r,a)=>n(r,e[a])))}const CS="__name__";class As{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ve(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Ve(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return As.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof As?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let a=0;a<r;a++){const o=As.compareSegments(e.get(a),n.get(a));if(o!==0)return o}return st(e.length,n.length)}static compareSegments(e,n){const r=As.isNumericId(e),a=As.isNumericId(n);return r&&!a?-1:!r&&a?1:r&&a?As.extractNumericId(e).compare(As.extractNumericId(n)):hy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ua.fromString(e.substring(4,e.length-2))}}class It extends As{construct(e,n,r){return new It(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Te(ye.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((a=>a.length>0)))}return new It(n)}static emptyPath(){return new It([])}}const Xk=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class In extends As{construct(e,n,r){return new In(e,n,r)}static isValidIdentifier(e){return Xk.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),In.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===CS}static keyField(){return new In([CS])}static fromServerFormat(e){const n=[];let r="",a=0;const o=()=>{if(r.length===0)throw new Te(ye.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let u=!1;for(;a<e.length;){const h=e[a];if(h==="\\"){if(a+1===e.length)throw new Te(ye.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[a+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new Te(ye.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=f,a+=2}else h==="`"?(u=!u,a++):h!=="."||u?(r+=h,a++):(o(),a++)}if(o(),u)throw new Te(ye.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new In(n)}static emptyPath(){return new In([])}}class Be{constructor(e){this.path=e}static fromPath(e){return new Be(It.fromString(e))}static fromName(e){return new Be(It.fromString(e).popFirst(5))}static empty(){return new Be(It.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&It.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return It.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Be(new It(e.slice()))}}function L1(t,e,n){if(!n)throw new Te(ye.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Jk(t,e,n,r){if(e===!0&&r===!0)throw new Te(ye.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function TS(t){if(!Be.isDocumentKey(t))throw new Te(ye.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function AS(t){if(Be.isDocumentKey(t))throw new Te(ye.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function U1(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Wf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ve(12329,{type:typeof t})}function ts(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Te(ye.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Wf(t);throw new Te(ye.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function cn(t,e){const n={typeString:t};return e&&(n.value=e),n}function Ku(t,e){if(!U1(t))throw new Te(ye.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const a=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const u=t[r];if(a&&typeof u!==a){n=`JSON field '${r}' must be a ${a}.`;break}if(o!==void 0&&u!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Te(ye.INVALID_ARGUMENT,n);return!0}const jS=-62135596800,RS=1e6;class Nt{static now(){return Nt.fromMillis(Date.now())}static fromDate(e){return Nt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*RS);return new Nt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Te(ye.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Te(ye.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<jS)throw new Te(ye.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Te(ye.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/RS}_compareTo(e){return this.seconds===e.seconds?st(this.nanoseconds,e.nanoseconds):st(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Nt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ku(e,Nt._jsonSchema))return new Nt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-jS;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Nt._jsonSchemaVersion="firestore/timestamp/1.0",Nt._jsonSchema={type:cn("string",Nt._jsonSchemaVersion),seconds:cn("number"),nanoseconds:cn("number")};class He{static fromTimestamp(e){return new He(e)}static min(){return new He(new Nt(0,0))}static max(){return new He(new Nt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Iu=-1;function Zk(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,a=He.fromTimestamp(r===1e9?new Nt(n+1,0):new Nt(n,r));return new fa(a,Be.empty(),e)}function eO(t){return new fa(t.readTime,t.key,Iu)}class fa{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new fa(He.min(),Be.empty(),Iu)}static max(){return new fa(He.max(),Be.empty(),Iu)}}function tO(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Be.comparator(t.documentKey,e.documentKey),n!==0?n:st(t.largestBatchId,e.largestBatchId))}const nO="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rO{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Zl(t){if(t.code!==ye.FAILED_PRECONDITION||t.message!==nO)throw t;Re("LocalStore","Unexpectedly lost primary lease")}class be{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ve(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new be(((r,a)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,a)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,a)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof be?n:be.resolve(n)}catch(n){return be.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):be.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):be.reject(n)}static resolve(e){return new be(((n,r)=>{n(e)}))}static reject(e){return new be(((n,r)=>{r(e)}))}static waitFor(e){return new be(((n,r)=>{let a=0,o=0,u=!1;e.forEach((h=>{++a,h.next((()=>{++o,u&&o===a&&n()}),(f=>r(f)))})),u=!0,o===a&&n()}))}static or(e){let n=be.resolve(!1);for(const r of e)n=n.next((a=>a?be.resolve(a):r()));return n}static forEach(e,n){const r=[];return e.forEach(((a,o)=>{r.push(n.call(this,a,o))})),this.waitFor(r)}static mapArray(e,n){return new be(((r,a)=>{const o=e.length,u=new Array(o);let h=0;for(let f=0;f<o;f++){const m=f;n(e[m]).next((g=>{u[m]=g,++h,h===o&&r(u)}),(g=>a(g)))}}))}static doWhile(e,n){return new be(((r,a)=>{const o=()=>{e()===!0?n().next((()=>{o()}),a):r()};o()}))}}function sO(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function ec(t){return t.name==="IndexedDbTransactionError"}class Kf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Kf.ce=-1;const s0=-1;function Yf(t){return t==null}function bf(t){return t===0&&1/t==-1/0}function iO(t){return typeof t=="number"&&Number.isInteger(t)&&!bf(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const z1="";function aO(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=IS(e)),e=oO(t.get(n),e);return IS(e)}function oO(t,e){let n=e;const r=t.length;for(let a=0;a<r;a++){const o=t.charAt(a);switch(o){case"\0":n+="";break;case z1:n+="";break;default:n+=o}}return n}function IS(t){return t+z1+""}function DS(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function wa(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function F1(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Vt{constructor(e,n){this.comparator=e,this.root=n||Rn.EMPTY}insert(e,n){return new Vt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Rn.BLACK,null,null))}remove(e){return new Vt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Rn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const a=this.comparator(e,r.key);if(a===0)return n+r.left.size;a<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Fh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Fh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Fh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Fh(this.root,e,this.comparator,!0)}}class Fh{constructor(e,n,r,a){this.isReverse=a,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&a&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Rn{constructor(e,n,r,a,o){this.key=e,this.value=n,this.color=r??Rn.RED,this.left=a??Rn.EMPTY,this.right=o??Rn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,a,o){return new Rn(e??this.key,n??this.value,r??this.color,a??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let a=this;const o=r(e,a.key);return a=o<0?a.copy(null,null,null,a.left.insert(e,n,r),null):o===0?a.copy(null,n,null,null,null):a.copy(null,null,null,null,a.right.insert(e,n,r)),a.fixUp()}removeMin(){if(this.left.isEmpty())return Rn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,a=this;if(n(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,n),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),n(e,a.key)===0){if(a.right.isEmpty())return Rn.EMPTY;r=a.right.min(),a=a.copy(r.key,r.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,n))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Rn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Rn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ve(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ve(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ve(27949);return e+(this.isRed()?0:1)}}Rn.EMPTY=null,Rn.RED=!0,Rn.BLACK=!1;Rn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ve(57766)}get value(){throw Ve(16141)}get color(){throw Ve(16727)}get left(){throw Ve(29726)}get right(){throw Ve(36894)}copy(e,n,r,a,o){return this}insert(e,n,r){return new Rn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class gn{constructor(e){this.comparator=e,this.data=new Vt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const a=r.getNext();if(this.comparator(a.key,e[1])>=0)return;n(a.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new MS(this.data.getIterator())}getIteratorFrom(e){return new MS(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof gn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const a=n.getNext().key,o=r.getNext().key;if(this.comparator(a,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new gn(this.comparator);return n.data=e,n}}class MS{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class mr{constructor(e){this.fields=e,e.sort(In.comparator)}static empty(){return new mr([])}unionWith(e){let n=new gn(In.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new mr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Ol(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class V1 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Mn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(a){try{return atob(a)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new V1("Invalid base64 string: "+o):o}})(e);return new Mn(n)}static fromUint8Array(e){const n=(function(a){let o="";for(let u=0;u<a.length;++u)o+=String.fromCharCode(a[u]);return o})(e);return new Mn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let a=0;a<n.length;a++)r[a]=n.charCodeAt(a);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return st(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Mn.EMPTY_BYTE_STRING=new Mn("");const lO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ma(t){if(gt(!!t,39018),typeof t=="string"){let e=0;const n=lO.exec(t);if(gt(!!n,46558,{timestamp:t}),n[1]){let a=n[1];a=(a+"000000000").substr(0,9),e=Number(a)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Kt(t.seconds),nanos:Kt(t.nanos)}}function Kt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function pa(t){return typeof t=="string"?Mn.fromBase64String(t):Mn.fromUint8Array(t)}const $1="server_timestamp",H1="__type__",q1="__previous_value__",G1="__local_write_time__";function i0(t){return(t?.mapValue?.fields||{})[H1]?.stringValue===$1}function Xf(t){const e=t.mapValue.fields[q1];return i0(e)?Xf(e):e}function Du(t){const e=ma(t.mapValue.fields[G1].timestampValue);return new Nt(e.seconds,e.nanos)}class cO{constructor(e,n,r,a,o,u,h,f,m,g){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=a,this.ssl=o,this.forceLongPolling=u,this.autoDetectLongPolling=h,this.longPollingOptions=f,this.useFetchStreams=m,this.isUsingEmulator=g}}const vf="(default)";class Mu{constructor(e,n){this.projectId=e,this.database=n||vf}static empty(){return new Mu("","")}get isDefaultDatabase(){return this.database===vf}isEqual(e){return e instanceof Mu&&e.projectId===this.projectId&&e.database===this.database}}const Q1="__type__",uO="__max__",Vh={mapValue:{}},W1="__vector__",xf="value";function ga(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?i0(t)?4:hO(t)?9007199254740991:dO(t)?10:11:Ve(28295,{value:t})}function Ns(t,e){if(t===e)return!0;const n=ga(t);if(n!==ga(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Du(t).isEqual(Du(e));case 3:return(function(a,o){if(typeof a.timestampValue=="string"&&typeof o.timestampValue=="string"&&a.timestampValue.length===o.timestampValue.length)return a.timestampValue===o.timestampValue;const u=ma(a.timestampValue),h=ma(o.timestampValue);return u.seconds===h.seconds&&u.nanos===h.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(a,o){return pa(a.bytesValue).isEqual(pa(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(a,o){return Kt(a.geoPointValue.latitude)===Kt(o.geoPointValue.latitude)&&Kt(a.geoPointValue.longitude)===Kt(o.geoPointValue.longitude)})(t,e);case 2:return(function(a,o){if("integerValue"in a&&"integerValue"in o)return Kt(a.integerValue)===Kt(o.integerValue);if("doubleValue"in a&&"doubleValue"in o){const u=Kt(a.doubleValue),h=Kt(o.doubleValue);return u===h?bf(u)===bf(h):isNaN(u)&&isNaN(h)}return!1})(t,e);case 9:return Ol(t.arrayValue.values||[],e.arrayValue.values||[],Ns);case 10:case 11:return(function(a,o){const u=a.mapValue.fields||{},h=o.mapValue.fields||{};if(DS(u)!==DS(h))return!1;for(const f in u)if(u.hasOwnProperty(f)&&(h[f]===void 0||!Ns(u[f],h[f])))return!1;return!0})(t,e);default:return Ve(52216,{left:t})}}function ku(t,e){return(t.values||[]).find((n=>Ns(n,e)))!==void 0}function Nl(t,e){if(t===e)return 0;const n=ga(t),r=ga(e);if(n!==r)return st(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return st(t.booleanValue,e.booleanValue);case 2:return(function(o,u){const h=Kt(o.integerValue||o.doubleValue),f=Kt(u.integerValue||u.doubleValue);return h<f?-1:h>f?1:h===f?0:isNaN(h)?isNaN(f)?0:-1:1})(t,e);case 3:return kS(t.timestampValue,e.timestampValue);case 4:return kS(Du(t),Du(e));case 5:return hy(t.stringValue,e.stringValue);case 6:return(function(o,u){const h=pa(o),f=pa(u);return h.compareTo(f)})(t.bytesValue,e.bytesValue);case 7:return(function(o,u){const h=o.split("/"),f=u.split("/");for(let m=0;m<h.length&&m<f.length;m++){const g=st(h[m],f[m]);if(g!==0)return g}return st(h.length,f.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,u){const h=st(Kt(o.latitude),Kt(u.latitude));return h!==0?h:st(Kt(o.longitude),Kt(u.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return OS(t.arrayValue,e.arrayValue);case 10:return(function(o,u){const h=o.fields||{},f=u.fields||{},m=h[xf]?.arrayValue,g=f[xf]?.arrayValue,_=st(m?.values?.length||0,g?.values?.length||0);return _!==0?_:OS(m,g)})(t.mapValue,e.mapValue);case 11:return(function(o,u){if(o===Vh.mapValue&&u===Vh.mapValue)return 0;if(o===Vh.mapValue)return 1;if(u===Vh.mapValue)return-1;const h=o.fields||{},f=Object.keys(h),m=u.fields||{},g=Object.keys(m);f.sort(),g.sort();for(let _=0;_<f.length&&_<g.length;++_){const v=hy(f[_],g[_]);if(v!==0)return v;const x=Nl(h[f[_]],m[g[_]]);if(x!==0)return x}return st(f.length,g.length)})(t.mapValue,e.mapValue);default:throw Ve(23264,{he:n})}}function kS(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return st(t,e);const n=ma(t),r=ma(e),a=st(n.seconds,r.seconds);return a!==0?a:st(n.nanos,r.nanos)}function OS(t,e){const n=t.values||[],r=e.values||[];for(let a=0;a<n.length&&a<r.length;++a){const o=Nl(n[a],r[a]);if(o)return o}return st(n.length,r.length)}function Pl(t){return fy(t)}function fy(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=ma(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return pa(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return Be.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",a=!0;for(const o of n.values||[])a?a=!1:r+=",",r+=fy(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let a="{",o=!0;for(const u of r)o?o=!1:a+=",",a+=`${u}:${fy(n.fields[u])}`;return a+"}"})(t.mapValue):Ve(61005,{value:t})}function ef(t){switch(ga(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Xf(t);return e?16+ef(e):16;case 5:return 2*t.stringValue.length;case 6:return pa(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((a,o)=>a+ef(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let a=0;return wa(r.fields,((o,u)=>{a+=o.length+ef(u)})),a})(t.mapValue);default:throw Ve(13486,{value:t})}}function NS(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function my(t){return!!t&&"integerValue"in t}function a0(t){return!!t&&"arrayValue"in t}function PS(t){return!!t&&"nullValue"in t}function BS(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function tf(t){return!!t&&"mapValue"in t}function dO(t){return(t?.mapValue?.fields||{})[Q1]?.stringValue===W1}function xu(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return wa(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=xu(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=xu(t.arrayValue.values[n]);return e}return{...t}}function hO(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===uO}class tr{constructor(e){this.value=e}static empty(){return new tr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!tf(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=xu(n)}setAll(e){let n=In.emptyPath(),r={},a=[];e.forEach(((u,h)=>{if(!n.isImmediateParentOf(h)){const f=this.getFieldsMap(n);this.applyChanges(f,r,a),r={},a=[],n=h.popLast()}u?r[h.lastSegment()]=xu(u):a.push(h.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,a)}delete(e){const n=this.field(e.popLast());tf(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Ns(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let a=n.mapValue.fields[e.get(r)];tf(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=a),n=a}return n.mapValue.fields}applyChanges(e,n,r){wa(n,((a,o)=>e[a]=o));for(const a of r)delete e[a]}clone(){return new tr(xu(this.value))}}function K1(t){const e=[];return wa(t.fields,((n,r)=>{const a=new In([n]);if(tf(r)){const o=K1(r.mapValue).fields;if(o.length===0)e.push(a);else for(const u of o)e.push(a.child(u))}else e.push(a)})),new mr(e)}class Bn{constructor(e,n,r,a,o,u,h){this.key=e,this.documentType=n,this.version=r,this.readTime=a,this.createTime=o,this.data=u,this.documentState=h}static newInvalidDocument(e){return new Bn(e,0,He.min(),He.min(),He.min(),tr.empty(),0)}static newFoundDocument(e,n,r,a){return new Bn(e,1,n,He.min(),r,a,0)}static newNoDocument(e,n){return new Bn(e,2,n,He.min(),He.min(),tr.empty(),0)}static newUnknownDocument(e,n){return new Bn(e,3,n,He.min(),He.min(),tr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(He.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=tr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=tr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=He.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Bn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Bn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Sf{constructor(e,n){this.position=e,this.inclusive=n}}function LS(t,e,n){let r=0;for(let a=0;a<t.position.length;a++){const o=e[a],u=t.position[a];if(o.field.isKeyField()?r=Be.comparator(Be.fromName(u.referenceValue),n.key):r=Nl(u,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function US(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ns(t.position[n],e.position[n]))return!1;return!0}class wf{constructor(e,n="asc"){this.field=e,this.dir=n}}function fO(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Y1{}class ln extends Y1{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new pO(e,n,r):n==="array-contains"?new _O(e,r):n==="in"?new bO(e,r):n==="not-in"?new vO(e,r):n==="array-contains-any"?new xO(e,r):new ln(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new gO(e,r):new yO(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Nl(n,this.value)):n!==null&&ga(this.value)===ga(n)&&this.matchesComparison(Nl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ve(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ns extends Y1{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ns(e,n)}matches(e){return X1(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function X1(t){return t.op==="and"}function J1(t){return mO(t)&&X1(t)}function mO(t){for(const e of t.filters)if(e instanceof ns)return!1;return!0}function py(t){if(t instanceof ln)return t.field.canonicalString()+t.op.toString()+Pl(t.value);if(J1(t))return t.filters.map((e=>py(e))).join(",");{const e=t.filters.map((n=>py(n))).join(",");return`${t.op}(${e})`}}function Z1(t,e){return t instanceof ln?(function(r,a){return a instanceof ln&&r.op===a.op&&r.field.isEqual(a.field)&&Ns(r.value,a.value)})(t,e):t instanceof ns?(function(r,a){return a instanceof ns&&r.op===a.op&&r.filters.length===a.filters.length?r.filters.reduce(((o,u,h)=>o&&Z1(u,a.filters[h])),!0):!1})(t,e):void Ve(19439)}function eC(t){return t instanceof ln?(function(n){return`${n.field.canonicalString()} ${n.op} ${Pl(n.value)}`})(t):t instanceof ns?(function(n){return n.op.toString()+" {"+n.getFilters().map(eC).join(" ,")+"}"})(t):"Filter"}class pO extends ln{constructor(e,n,r){super(e,n,r),this.key=Be.fromName(r.referenceValue)}matches(e){const n=Be.comparator(e.key,this.key);return this.matchesComparison(n)}}class gO extends ln{constructor(e,n){super(e,"in",n),this.keys=tC("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class yO extends ln{constructor(e,n){super(e,"not-in",n),this.keys=tC("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function tC(t,e){return(e.arrayValue?.values||[]).map((n=>Be.fromName(n.referenceValue)))}class _O extends ln{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return a0(n)&&ku(n.arrayValue,this.value)}}class bO extends ln{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&ku(this.value.arrayValue,n)}}class vO extends ln{constructor(e,n){super(e,"not-in",n)}matches(e){if(ku(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!ku(this.value.arrayValue,n)}}class xO extends ln{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!a0(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>ku(this.value.arrayValue,r)))}}class SO{constructor(e,n=null,r=[],a=[],o=null,u=null,h=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=a,this.limit=o,this.startAt=u,this.endAt=h,this.Te=null}}function zS(t,e=null,n=[],r=[],a=null,o=null,u=null){return new SO(t,e,n,r,a,o,u)}function o0(t){const e=Ge(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>py(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Yf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>Pl(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>Pl(r))).join(",")),e.Te=n}return e.Te}function l0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!fO(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Z1(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!US(t.startAt,e.startAt)&&US(t.endAt,e.endAt)}function gy(t){return Be.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class Yu{constructor(e,n=null,r=[],a=[],o=null,u="F",h=null,f=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=a,this.limit=o,this.limitType=u,this.startAt=h,this.endAt=f,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function wO(t,e,n,r,a,o,u,h){return new Yu(t,e,n,r,a,o,u,h)}function c0(t){return new Yu(t)}function FS(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function nC(t){return t.collectionGroup!==null}function Su(t){const e=Ge(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(u){let h=new gn(In.comparator);return u.filters.forEach((f=>{f.getFlattenedFilters().forEach((m=>{m.isInequality()&&(h=h.add(m.field))}))})),h})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new wf(o,r))})),n.has(In.keyField().canonicalString())||e.Ie.push(new wf(In.keyField(),r))}return e.Ie}function Ds(t){const e=Ge(t);return e.Ee||(e.Ee=EO(e,Su(t))),e.Ee}function EO(t,e){if(t.limitType==="F")return zS(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((a=>{const o=a.dir==="desc"?"asc":"desc";return new wf(a.field,o)}));const n=t.endAt?new Sf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Sf(t.startAt.position,t.startAt.inclusive):null;return zS(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function yy(t,e){const n=t.filters.concat([e]);return new Yu(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function _y(t,e,n){return new Yu(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Jf(t,e){return l0(Ds(t),Ds(e))&&t.limitType===e.limitType}function rC(t){return`${o0(Ds(t))}|lt:${t.limitType}`}function Sl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((a=>eC(a))).join(", ")}]`),Yf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((a=>(function(u){return`${u.field.canonicalString()} (${u.dir})`})(a))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((a=>Pl(a))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((a=>Pl(a))).join(",")),`Target(${r})`})(Ds(t))}; limitType=${t.limitType})`}function Zf(t,e){return e.isFoundDocument()&&(function(r,a){const o=a.key.path;return r.collectionGroup!==null?a.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):Be.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,a){for(const o of Su(r))if(!o.field.isKeyField()&&a.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,a){for(const o of r.filters)if(!o.matches(a))return!1;return!0})(t,e)&&(function(r,a){return!(r.startAt&&!(function(u,h,f){const m=LS(u,h,f);return u.inclusive?m<=0:m<0})(r.startAt,Su(r),a)||r.endAt&&!(function(u,h,f){const m=LS(u,h,f);return u.inclusive?m>=0:m>0})(r.endAt,Su(r),a))})(t,e)}function CO(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function sC(t){return(e,n)=>{let r=!1;for(const a of Su(t)){const o=TO(a,e,n);if(o!==0)return o;r=r||a.field.isKeyField()}return 0}}function TO(t,e,n){const r=t.field.isKeyField()?Be.comparator(e.key,n.key):(function(o,u,h){const f=u.data.field(o),m=h.data.field(o);return f!==null&&m!==null?Nl(f,m):Ve(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ve(19790,{direction:t.dir})}}class wo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[a,o]of r)if(this.equalsFn(a,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),a=this.inner[r];if(a===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<a.length;o++)if(this.equalsFn(a[o][0],e))return void(a[o]=[e,n]);a.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let a=0;a<r.length;a++)if(this.equalsFn(r[a][0],e))return r.length===1?delete this.inner[n]:r.splice(a,1),this.innerSize--,!0;return!1}forEach(e){wa(this.inner,((n,r)=>{for(const[a,o]of r)e(a,o)}))}isEmpty(){return F1(this.inner)}size(){return this.innerSize}}const AO=new Vt(Be.comparator);function fi(){return AO}const iC=new Vt(Be.comparator);function gu(...t){let e=iC;for(const n of t)e=e.insert(n.key,n);return e}function aC(t){let e=iC;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function lo(){return wu()}function oC(){return wu()}function wu(){return new wo((t=>t.toString()),((t,e)=>t.isEqual(e)))}const jO=new Vt(Be.comparator),RO=new gn(Be.comparator);function it(...t){let e=RO;for(const n of t)e=e.add(n);return e}const IO=new gn(st);function DO(){return IO}function u0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bf(e)?"-0":e}}function lC(t){return{integerValue:""+t}}function MO(t,e){return iO(e)?lC(e):u0(t,e)}class em{constructor(){this._=void 0}}function kO(t,e,n){return t instanceof Ef?(function(a,o){const u={fields:{[H1]:{stringValue:$1},[G1]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return o&&i0(o)&&(o=Xf(o)),o&&(u.fields[q1]=o),{mapValue:u}})(n,e):t instanceof Bl?uC(t,e):t instanceof Ou?dC(t,e):(function(a,o){const u=cC(a,o),h=VS(u)+VS(a.Ae);return my(u)&&my(a.Ae)?lC(h):u0(a.serializer,h)})(t,e)}function OO(t,e,n){return t instanceof Bl?uC(t,e):t instanceof Ou?dC(t,e):n}function cC(t,e){return t instanceof Cf?(function(r){return my(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class Ef extends em{}class Bl extends em{constructor(e){super(),this.elements=e}}function uC(t,e){const n=hC(e);for(const r of t.elements)n.some((a=>Ns(a,r)))||n.push(r);return{arrayValue:{values:n}}}class Ou extends em{constructor(e){super(),this.elements=e}}function dC(t,e){let n=hC(e);for(const r of t.elements)n=n.filter((a=>!Ns(a,r)));return{arrayValue:{values:n}}}class Cf extends em{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function VS(t){return Kt(t.integerValue||t.doubleValue)}function hC(t){return a0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class NO{constructor(e,n){this.field=e,this.transform=n}}function PO(t,e){return t.field.isEqual(e.field)&&(function(r,a){return r instanceof Bl&&a instanceof Bl||r instanceof Ou&&a instanceof Ou?Ol(r.elements,a.elements,Ns):r instanceof Cf&&a instanceof Cf?Ns(r.Ae,a.Ae):r instanceof Ef&&a instanceof Ef})(t.transform,e.transform)}class BO{constructor(e,n){this.version=e,this.transformResults=n}}class nr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new nr}static exists(e){return new nr(void 0,e)}static updateTime(e){return new nr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function nf(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class tm{}function fC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new nm(t.key,nr.none()):new Xu(t.key,t.data,nr.none());{const n=t.data,r=tr.empty();let a=new gn(In.comparator);for(let o of e.fields)if(!a.has(o)){let u=n.field(o);u===null&&o.length>1&&(o=o.popLast(),u=n.field(o)),u===null?r.delete(o):r.set(o,u),a=a.add(o)}return new Ea(t.key,r,new mr(a.toArray()),nr.none())}}function LO(t,e,n){t instanceof Xu?(function(a,o,u){const h=a.value.clone(),f=HS(a.fieldTransforms,o,u.transformResults);h.setAll(f),o.convertToFoundDocument(u.version,h).setHasCommittedMutations()})(t,e,n):t instanceof Ea?(function(a,o,u){if(!nf(a.precondition,o))return void o.convertToUnknownDocument(u.version);const h=HS(a.fieldTransforms,o,u.transformResults),f=o.data;f.setAll(mC(a)),f.setAll(h),o.convertToFoundDocument(u.version,f).setHasCommittedMutations()})(t,e,n):(function(a,o,u){o.convertToNoDocument(u.version).setHasCommittedMutations()})(0,e,n)}function Eu(t,e,n,r){return t instanceof Xu?(function(o,u,h,f){if(!nf(o.precondition,u))return h;const m=o.value.clone(),g=qS(o.fieldTransforms,f,u);return m.setAll(g),u.convertToFoundDocument(u.version,m).setHasLocalMutations(),null})(t,e,n,r):t instanceof Ea?(function(o,u,h,f){if(!nf(o.precondition,u))return h;const m=qS(o.fieldTransforms,f,u),g=u.data;return g.setAll(mC(o)),g.setAll(m),u.convertToFoundDocument(u.version,g).setHasLocalMutations(),h===null?null:h.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((_=>_.field)))})(t,e,n,r):(function(o,u,h){return nf(o.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):h})(t,e,n)}function UO(t,e){let n=null;for(const r of t.fieldTransforms){const a=e.data.field(r.field),o=cC(r.transform,a||null);o!=null&&(n===null&&(n=tr.empty()),n.set(r.field,o))}return n||null}function $S(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,a){return r===void 0&&a===void 0||!(!r||!a)&&Ol(r,a,((o,u)=>PO(o,u)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Xu extends tm{constructor(e,n,r,a=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class Ea extends tm{constructor(e,n,r,a,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=a,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function mC(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function HS(t,e,n){const r=new Map;gt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let a=0;a<n.length;a++){const o=t[a],u=o.transform,h=e.data.field(o.field);r.set(o.field,OO(u,h,n[a]))}return r}function qS(t,e,n){const r=new Map;for(const a of t){const o=a.transform,u=n.data.field(a.field);r.set(a.field,kO(o,u,e))}return r}class nm extends tm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class zO extends tm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class FO{constructor(e,n,r,a){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=a}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let a=0;a<this.mutations.length;a++){const o=this.mutations[a];o.key.isEqual(e.key)&&LO(o,e,r[a])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Eu(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Eu(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=oC();return this.mutations.forEach((a=>{const o=e.get(a.key),u=o.overlayedDocument;let h=this.applyToLocalView(u,o.mutatedFields);h=n.has(a.key)?null:h;const f=fC(u,h);f!==null&&r.set(a.key,f),u.isValidDocument()||u.convertToNoDocument(He.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),it())}isEqual(e){return this.batchId===e.batchId&&Ol(this.mutations,e.mutations,((n,r)=>$S(n,r)))&&Ol(this.baseMutations,e.baseMutations,((n,r)=>$S(n,r)))}}class d0{constructor(e,n,r,a){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=a}static from(e,n,r){gt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let a=(function(){return jO})();const o=e.mutations;for(let u=0;u<o.length;u++)a=a.insert(o[u].key,r[u].version);return new d0(e,n,r,a)}}class VO{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class $O{constructor(e,n){this.count=e,this.unchangedNames=n}}var an,ct;function HO(t){switch(t){case ye.OK:return Ve(64938);case ye.CANCELLED:case ye.UNKNOWN:case ye.DEADLINE_EXCEEDED:case ye.RESOURCE_EXHAUSTED:case ye.INTERNAL:case ye.UNAVAILABLE:case ye.UNAUTHENTICATED:return!1;case ye.INVALID_ARGUMENT:case ye.NOT_FOUND:case ye.ALREADY_EXISTS:case ye.PERMISSION_DENIED:case ye.FAILED_PRECONDITION:case ye.ABORTED:case ye.OUT_OF_RANGE:case ye.UNIMPLEMENTED:case ye.DATA_LOSS:return!0;default:return Ve(15467,{code:t})}}function pC(t){if(t===void 0)return hi("GRPC error has no .code"),ye.UNKNOWN;switch(t){case an.OK:return ye.OK;case an.CANCELLED:return ye.CANCELLED;case an.UNKNOWN:return ye.UNKNOWN;case an.DEADLINE_EXCEEDED:return ye.DEADLINE_EXCEEDED;case an.RESOURCE_EXHAUSTED:return ye.RESOURCE_EXHAUSTED;case an.INTERNAL:return ye.INTERNAL;case an.UNAVAILABLE:return ye.UNAVAILABLE;case an.UNAUTHENTICATED:return ye.UNAUTHENTICATED;case an.INVALID_ARGUMENT:return ye.INVALID_ARGUMENT;case an.NOT_FOUND:return ye.NOT_FOUND;case an.ALREADY_EXISTS:return ye.ALREADY_EXISTS;case an.PERMISSION_DENIED:return ye.PERMISSION_DENIED;case an.FAILED_PRECONDITION:return ye.FAILED_PRECONDITION;case an.ABORTED:return ye.ABORTED;case an.OUT_OF_RANGE:return ye.OUT_OF_RANGE;case an.UNIMPLEMENTED:return ye.UNIMPLEMENTED;case an.DATA_LOSS:return ye.DATA_LOSS;default:return Ve(39323,{code:t})}}(ct=an||(an={}))[ct.OK=0]="OK",ct[ct.CANCELLED=1]="CANCELLED",ct[ct.UNKNOWN=2]="UNKNOWN",ct[ct.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ct[ct.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ct[ct.NOT_FOUND=5]="NOT_FOUND",ct[ct.ALREADY_EXISTS=6]="ALREADY_EXISTS",ct[ct.PERMISSION_DENIED=7]="PERMISSION_DENIED",ct[ct.UNAUTHENTICATED=16]="UNAUTHENTICATED",ct[ct.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ct[ct.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ct[ct.ABORTED=10]="ABORTED",ct[ct.OUT_OF_RANGE=11]="OUT_OF_RANGE",ct[ct.UNIMPLEMENTED=12]="UNIMPLEMENTED",ct[ct.INTERNAL=13]="INTERNAL",ct[ct.UNAVAILABLE=14]="UNAVAILABLE",ct[ct.DATA_LOSS=15]="DATA_LOSS";function qO(){return new TextEncoder}const GO=new ua([4294967295,4294967295],0);function GS(t){const e=qO().encode(t),n=new I1;return n.update(e),new Uint8Array(n.digest())}function QS(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),a=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new ua([n,r],0),new ua([a,o],0)]}class h0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new yu(`Invalid padding: ${n}`);if(r<0)throw new yu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new yu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new yu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=ua.fromNumber(this.ge)}ye(e,n,r){let a=e.add(n.multiply(ua.fromNumber(r)));return a.compare(GO)===1&&(a=new ua([a.getBits(0),a.getBits(1)],0)),a.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=GS(e),[r,a]=QS(n);for(let o=0;o<this.hashCount;o++){const u=this.ye(r,a,o);if(!this.we(u))return!1}return!0}static create(e,n,r){const a=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),u=new h0(o,a,n);return r.forEach((h=>u.insert(h))),u}insert(e){if(this.ge===0)return;const n=GS(e),[r,a]=QS(n);for(let o=0;o<this.hashCount;o++){const u=this.ye(r,a,o);this.Se(u)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class yu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class rm{constructor(e,n,r,a,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=a,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const a=new Map;return a.set(e,Ju.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new rm(He.min(),a,new Vt(st),fi(),it())}}class Ju{constructor(e,n,r,a,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=a,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Ju(r,n,it(),it(),it())}}class rf{constructor(e,n,r,a){this.be=e,this.removedTargetIds=n,this.key=r,this.De=a}}class gC{constructor(e,n){this.targetId=e,this.Ce=n}}class yC{constructor(e,n,r=Mn.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=a}}class WS{constructor(){this.ve=0,this.Fe=KS(),this.Me=Mn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=it(),n=it(),r=it();return this.Fe.forEach(((a,o)=>{switch(o){case 0:e=e.add(a);break;case 2:n=n.add(a);break;case 1:r=r.add(a);break;default:Ve(38017,{changeType:o})}})),new Ju(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=KS()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,gt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class QO{constructor(e){this.Ge=e,this.ze=new Map,this.je=fi(),this.Je=$h(),this.He=$h(),this.Ye=new Vt(st)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Ve(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,a)=>{this.rt(a)&&n(a)}))}st(e){const n=e.targetId,r=e.Ce.count,a=this.ot(n);if(a){const o=a.target;if(gy(o))if(r===0){const u=new Be(o.path);this.et(n,u,Bn.newNoDocument(u,He.min()))}else gt(r===1,20013,{expectedCount:r});else{const u=this._t(n);if(u!==r){const h=this.ut(e),f=h?this.ct(h,e,u):1;if(f!==0){this.it(n);const m=f===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,m)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:a=0},hashCount:o=0}=n;let u,h;try{u=pa(r).toUint8Array()}catch(f){if(f instanceof V1)return kl("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{h=new h0(u,a,o)}catch(f){return kl(f instanceof yu?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return h.ge===0?null:h}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let a=0;return r.forEach((o=>{const u=this.Ge.ht(),h=`projects/${u.projectId}/databases/${u.database}/documents/${o.path.canonicalString()}`;e.mightContain(h)||(this.et(n,o,null),a++)})),a}Tt(e){const n=new Map;this.ze.forEach(((o,u)=>{const h=this.ot(u);if(h){if(o.current&&gy(h.target)){const f=new Be(h.target.path);this.It(f).has(u)||this.Et(u,f)||this.et(u,f,Bn.newNoDocument(f,e))}o.Be&&(n.set(u,o.ke()),o.qe())}}));let r=it();this.He.forEach(((o,u)=>{let h=!0;u.forEachWhile((f=>{const m=this.ot(f);return!m||m.purpose==="TargetPurposeLimboResolution"||(h=!1,!1)})),h&&(r=r.add(o))})),this.je.forEach(((o,u)=>u.setReadTime(e)));const a=new rm(e,n,this.Ye,this.je,r);return this.je=fi(),this.Je=$h(),this.He=$h(),this.Ye=new Vt(st),a}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const a=this.nt(e);this.Et(e,n)?a.Qe(n,1):a.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new WS,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new gn(st),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new gn(st),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Re("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new WS),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function $h(){return new Vt(Be.comparator)}function KS(){return new Vt(Be.comparator)}const WO={asc:"ASCENDING",desc:"DESCENDING"},KO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},YO={and:"AND",or:"OR"};class XO{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function by(t,e){return t.useProto3Json||Yf(e)?e:{value:e}}function Tf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function _C(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function JO(t,e){return Tf(t,e.toTimestamp())}function Ms(t){return gt(!!t,49232),He.fromTimestamp((function(n){const r=ma(n);return new Nt(r.seconds,r.nanos)})(t))}function f0(t,e){return vy(t,e).canonicalString()}function vy(t,e){const n=(function(a){return new It(["projects",a.projectId,"databases",a.database])})(t).child("documents");return e===void 0?n:n.child(e)}function bC(t){const e=It.fromString(t);return gt(EC(e),10190,{key:e.toString()}),e}function xy(t,e){return f0(t.databaseId,e.path)}function Bg(t,e){const n=bC(e);if(n.get(1)!==t.databaseId.projectId)throw new Te(ye.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Te(ye.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Be(xC(n))}function vC(t,e){return f0(t.databaseId,e)}function ZO(t){const e=bC(t);return e.length===4?It.emptyPath():xC(e)}function Sy(t){return new It(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function xC(t){return gt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function YS(t,e,n){return{name:xy(t,e),fields:n.value.mapValue.fields}}function eN(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:Ve(39313,{state:m})})(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],o=(function(m,g){return m.useProto3Json?(gt(g===void 0||typeof g=="string",58123),Mn.fromBase64String(g||"")):(gt(g===void 0||g instanceof Buffer||g instanceof Uint8Array,16193),Mn.fromUint8Array(g||new Uint8Array))})(t,e.targetChange.resumeToken),u=e.targetChange.cause,h=u&&(function(m){const g=m.code===void 0?ye.UNKNOWN:pC(m.code);return new Te(g,m.message||"")})(u);n=new yC(r,a,o,h||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const a=Bg(t,r.document.name),o=Ms(r.document.updateTime),u=r.document.createTime?Ms(r.document.createTime):He.min(),h=new tr({mapValue:{fields:r.document.fields}}),f=Bn.newFoundDocument(a,o,u,h),m=r.targetIds||[],g=r.removedTargetIds||[];n=new rf(m,g,f.key,f)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const a=Bg(t,r.document),o=r.readTime?Ms(r.readTime):He.min(),u=Bn.newNoDocument(a,o),h=r.removedTargetIds||[];n=new rf([],h,u.key,u)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const a=Bg(t,r.document),o=r.removedTargetIds||[];n=new rf([],o,a,null)}else{if(!("filter"in e))return Ve(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:a=0,unchangedNames:o}=r,u=new $O(a,o),h=r.targetId;n=new gC(h,u)}}return n}function tN(t,e){let n;if(e instanceof Xu)n={update:YS(t,e.key,e.value)};else if(e instanceof nm)n={delete:xy(t,e.key)};else if(e instanceof Ea)n={update:YS(t,e.key,e.data),updateMask:uN(e.fieldMask)};else{if(!(e instanceof zO))return Ve(16599,{Vt:e.type});n={verify:xy(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,u){const h=u.transform;if(h instanceof Ef)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof Bl)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof Ou)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof Cf)return{fieldPath:u.field.canonicalString(),increment:h.Ae};throw Ve(20930,{transform:u.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(a,o){return o.updateTime!==void 0?{updateTime:JO(a,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Ve(27497)})(t,e.precondition)),n}function nN(t,e){return t&&t.length>0?(gt(e!==void 0,14353),t.map((n=>(function(a,o){let u=a.updateTime?Ms(a.updateTime):Ms(o);return u.isEqual(He.min())&&(u=Ms(o)),new BO(u,a.transformResults||[])})(n,e)))):[]}function rN(t,e){return{documents:[vC(t,e.path)]}}function sN(t,e){const n={structuredQuery:{}},r=e.path;let a;e.collectionGroup!==null?(a=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=vC(t,a);const o=(function(m){if(m.length!==0)return wC(ns.create(m,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const u=(function(m){if(m.length!==0)return m.map((g=>(function(v){return{field:wl(v.field),direction:oN(v.dir)}})(g)))})(e.orderBy);u&&(n.structuredQuery.orderBy=u);const h=by(t,e.limit);return h!==null&&(n.structuredQuery.limit=h),e.startAt&&(n.structuredQuery.startAt=(function(m){return{before:m.inclusive,values:m.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(m){return{before:!m.inclusive,values:m.position}})(e.endAt)),{ft:n,parent:a}}function iN(t){let e=ZO(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let a=null;if(r>0){gt(r===1,65062);const g=n.from[0];g.allDescendants?a=g.collectionId:e=e.child(g.collectionId)}let o=[];n.where&&(o=(function(_){const v=SC(_);return v instanceof ns&&J1(v)?v.getFilters():[v]})(n.where));let u=[];n.orderBy&&(u=(function(_){return _.map((v=>(function(S){return new wf(El(S.field),(function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(v)))})(n.orderBy));let h=null;n.limit&&(h=(function(_){let v;return v=typeof _=="object"?_.value:_,Yf(v)?null:v})(n.limit));let f=null;n.startAt&&(f=(function(_){const v=!!_.before,x=_.values||[];return new Sf(x,v)})(n.startAt));let m=null;return n.endAt&&(m=(function(_){const v=!_.before,x=_.values||[];return new Sf(x,v)})(n.endAt)),wO(e,a,u,o,h,"F",f,m)}function aN(t,e){const n=(function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ve(28987,{purpose:a})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function SC(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=El(n.unaryFilter.field);return ln.create(r,"==",{doubleValue:NaN});case"IS_NULL":const a=El(n.unaryFilter.field);return ln.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=El(n.unaryFilter.field);return ln.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const u=El(n.unaryFilter.field);return ln.create(u,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ve(61313);default:return Ve(60726)}})(t):t.fieldFilter!==void 0?(function(n){return ln.create(El(n.fieldFilter.field),(function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ve(58110);default:return Ve(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return ns.create(n.compositeFilter.filters.map((r=>SC(r))),(function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return Ve(1026)}})(n.compositeFilter.op))})(t):Ve(30097,{filter:t})}function oN(t){return WO[t]}function lN(t){return KO[t]}function cN(t){return YO[t]}function wl(t){return{fieldPath:t.canonicalString()}}function El(t){return In.fromServerFormat(t.fieldPath)}function wC(t){return t instanceof ln?(function(n){if(n.op==="=="){if(BS(n.value))return{unaryFilter:{field:wl(n.field),op:"IS_NAN"}};if(PS(n.value))return{unaryFilter:{field:wl(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(BS(n.value))return{unaryFilter:{field:wl(n.field),op:"IS_NOT_NAN"}};if(PS(n.value))return{unaryFilter:{field:wl(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wl(n.field),op:lN(n.op),value:n.value}}})(t):t instanceof ns?(function(n){const r=n.getFilters().map((a=>wC(a)));return r.length===1?r[0]:{compositeFilter:{op:cN(n.op),filters:r}}})(t):Ve(54877,{filter:t})}function uN(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function EC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class ra{constructor(e,n,r,a,o=He.min(),u=He.min(),h=Mn.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=a,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=h,this.expectedCount=f}withSequenceNumber(e){return new ra(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ra(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ra(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ra(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class dN{constructor(e){this.yt=e}}function hN(t){const e=iN({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?_y(e,e.limit,"L"):e}class fN{constructor(){this.Cn=new mN}addToCollectionParentIndex(e,n){return this.Cn.add(n),be.resolve()}getCollectionParents(e,n){return be.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return be.resolve()}deleteFieldIndex(e,n){return be.resolve()}deleteAllFieldIndexes(e){return be.resolve()}createTargetIndexes(e,n){return be.resolve()}getDocumentsMatchingTarget(e,n){return be.resolve(null)}getIndexType(e,n){return be.resolve(0)}getFieldIndexes(e,n){return be.resolve([])}getNextCollectionGroupToUpdate(e){return be.resolve(null)}getMinOffset(e,n){return be.resolve(fa.min())}getMinOffsetFromCollectionGroup(e,n){return be.resolve(fa.min())}updateCollectionGroup(e,n,r){return be.resolve()}updateIndexEntries(e,n){return be.resolve()}}class mN{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),a=this.index[n]||new gn(It.comparator),o=!a.has(r);return this.index[n]=a.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),a=this.index[n];return a&&a.has(r)}getEntries(e){return(this.index[e]||new gn(It.comparator)).toArray()}}const XS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},CC=41943040;class er{static withCacheSize(e){return new er(e,er.DEFAULT_COLLECTION_PERCENTILE,er.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}er.DEFAULT_COLLECTION_PERCENTILE=10,er.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,er.DEFAULT=new er(CC,er.DEFAULT_COLLECTION_PERCENTILE,er.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),er.DISABLED=new er(-1,0,0);class Ll{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ll(0)}static cr(){return new Ll(-1)}}const JS="LruGarbageCollector",pN=1048576;function ZS([t,e],[n,r]){const a=st(t,n);return a===0?st(e,r):a}class gN{constructor(e){this.Ir=e,this.buffer=new gn(ZS),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();ZS(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class yN{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Re(JS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){ec(n)?Re(JS,"Ignoring IndexedDB error during garbage collection: ",n):await Zl(n)}await this.Vr(3e5)}))}}class _N{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return be.resolve(Kf.ce);const r=new gN(n);return this.mr.forEachTarget(e,(a=>r.Ar(a.sequenceNumber))).next((()=>this.mr.pr(e,(a=>r.Ar(a))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Re("LruGarbageCollector","Garbage collection skipped; disabled"),be.resolve(XS)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Re("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),XS):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,a,o,u,h,f,m;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((_=>(_>this.params.maximumSequenceNumbersToCollect?(Re("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),a=this.params.maximumSequenceNumbersToCollect):a=_,u=Date.now(),this.nthSequenceNumber(e,a)))).next((_=>(r=_,h=Date.now(),this.removeTargets(e,r,n)))).next((_=>(o=_,f=Date.now(),this.removeOrphanedDocuments(e,r)))).next((_=>(m=Date.now(),xl()<=rt.DEBUG&&Re("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-g}ms
	Determined least recently used ${a} in `+(h-u)+`ms
	Removed ${o} targets in `+(f-h)+`ms
	Removed ${_} documents in `+(m-f)+`ms
Total Duration: ${m-g}ms`),be.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:o,documentsRemoved:_}))))}}function bN(t,e){return new _N(t,e)}class vN{constructor(){this.changes=new wo((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Bn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?be.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class xN{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class SN{constructor(e,n,r,a){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=a}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((a=>(r=a,this.remoteDocumentCache.getEntry(e,n)))).next((a=>(r!==null&&Eu(r.mutation,a,mr.empty(),Nt.now()),a)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,it()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=it()){const a=lo();return this.populateOverlays(e,a,n).next((()=>this.computeViews(e,n,a,r).next((o=>{let u=gu();return o.forEach(((h,f)=>{u=u.insert(h,f.overlayedDocument)})),u}))))}getOverlayedDocuments(e,n){const r=lo();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,it())))}populateOverlays(e,n,r){const a=[];return r.forEach((o=>{n.has(o)||a.push(o)})),this.documentOverlayCache.getOverlays(e,a).next((o=>{o.forEach(((u,h)=>{n.set(u,h)}))}))}computeViews(e,n,r,a){let o=fi();const u=wu(),h=(function(){return wu()})();return n.forEach(((f,m)=>{const g=r.get(m.key);a.has(m.key)&&(g===void 0||g.mutation instanceof Ea)?o=o.insert(m.key,m):g!==void 0?(u.set(m.key,g.mutation.getFieldMask()),Eu(g.mutation,m,g.mutation.getFieldMask(),Nt.now())):u.set(m.key,mr.empty())})),this.recalculateAndSaveOverlays(e,o).next((f=>(f.forEach(((m,g)=>u.set(m,g))),n.forEach(((m,g)=>h.set(m,new xN(g,u.get(m)??null)))),h)))}recalculateAndSaveOverlays(e,n){const r=wu();let a=new Vt(((u,h)=>u-h)),o=it();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((u=>{for(const h of u)h.keys().forEach((f=>{const m=n.get(f);if(m===null)return;let g=r.get(f)||mr.empty();g=h.applyToLocalView(m,g),r.set(f,g);const _=(a.get(h.batchId)||it()).add(f);a=a.insert(h.batchId,_)}))})).next((()=>{const u=[],h=a.getReverseIterator();for(;h.hasNext();){const f=h.getNext(),m=f.key,g=f.value,_=oC();g.forEach((v=>{if(!o.has(v)){const x=fC(n.get(v),r.get(v));x!==null&&_.set(v,x),o=o.add(v)}})),u.push(this.documentOverlayCache.saveOverlays(e,m,_))}return be.waitFor(u)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,a){return(function(u){return Be.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):nC(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,a):this.getDocumentsMatchingCollectionQuery(e,n,r,a)}getNextDocuments(e,n,r,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,a).next((o=>{const u=a-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,a-o.size):be.resolve(lo());let h=Iu,f=o;return u.next((m=>be.forEach(m,((g,_)=>(h<_.largestBatchId&&(h=_.largestBatchId),o.get(g)?be.resolve():this.remoteDocumentCache.getEntry(e,g).next((v=>{f=f.insert(g,v)}))))).next((()=>this.populateOverlays(e,m,o))).next((()=>this.computeViews(e,f,m,it()))).next((g=>({batchId:h,changes:aC(g)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Be(n)).next((r=>{let a=gu();return r.isFoundDocument()&&(a=a.insert(r.key,r)),a}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,a){const o=n.collectionGroup;let u=gu();return this.indexManager.getCollectionParents(e,o).next((h=>be.forEach(h,(f=>{const m=(function(_,v){return new Yu(v,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)})(n,f.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,r,a).next((g=>{g.forEach(((_,v)=>{u=u.insert(_,v)}))}))})).next((()=>u))))}getDocumentsMatchingCollectionQuery(e,n,r,a){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((u=>(o=u,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,a)))).next((u=>{o.forEach(((f,m)=>{const g=m.getKey();u.get(g)===null&&(u=u.insert(g,Bn.newInvalidDocument(g)))}));let h=gu();return u.forEach(((f,m)=>{const g=o.get(f);g!==void 0&&Eu(g.mutation,m,mr.empty(),Nt.now()),Zf(n,m)&&(h=h.insert(f,m))})),h}))}}class wN{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return be.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(a){return{id:a.id,version:a.version,createTime:Ms(a.createTime)}})(n)),be.resolve()}getNamedQuery(e,n){return be.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(a){return{name:a.name,query:hN(a.bundledQuery),readTime:Ms(a.readTime)}})(n)),be.resolve()}}class EN{constructor(){this.overlays=new Vt(Be.comparator),this.qr=new Map}getOverlay(e,n){return be.resolve(this.overlays.get(n))}getOverlays(e,n){const r=lo();return be.forEach(n,(a=>this.getOverlay(e,a).next((o=>{o!==null&&r.set(a,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((a,o)=>{this.St(e,n,o)})),be.resolve()}removeOverlaysForBatchId(e,n,r){const a=this.qr.get(r);return a!==void 0&&(a.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),be.resolve()}getOverlaysForCollection(e,n,r){const a=lo(),o=n.length+1,u=new Be(n.child("")),h=this.overlays.getIteratorFrom(u);for(;h.hasNext();){const f=h.getNext().value,m=f.getKey();if(!n.isPrefixOf(m.path))break;m.path.length===o&&f.largestBatchId>r&&a.set(f.getKey(),f)}return be.resolve(a)}getOverlaysForCollectionGroup(e,n,r,a){let o=new Vt(((m,g)=>m-g));const u=this.overlays.getIterator();for(;u.hasNext();){const m=u.getNext().value;if(m.getKey().getCollectionGroup()===n&&m.largestBatchId>r){let g=o.get(m.largestBatchId);g===null&&(g=lo(),o=o.insert(m.largestBatchId,g)),g.set(m.getKey(),m)}}const h=lo(),f=o.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach(((m,g)=>h.set(m,g))),!(h.size()>=a)););return be.resolve(h)}St(e,n,r){const a=this.overlays.get(r.key);if(a!==null){const u=this.qr.get(a.largestBatchId).delete(r.key);this.qr.set(a.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new VO(n,r));let o=this.qr.get(n);o===void 0&&(o=it(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class CN{constructor(){this.sessionToken=Mn.EMPTY_BYTE_STRING}getSessionToken(e){return be.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,be.resolve()}}class m0{constructor(){this.Qr=new gn(xn.$r),this.Ur=new gn(xn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new xn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new xn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new Be(new It([])),r=new xn(n,e),a=new xn(n,e+1),o=[];return this.Ur.forEachInRange([r,a],(u=>{this.Gr(u),o.push(u.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Be(new It([])),r=new xn(n,e),a=new xn(n,e+1);let o=it();return this.Ur.forEachInRange([r,a],(u=>{o=o.add(u.key)})),o}containsKey(e){const n=new xn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class xn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Be.comparator(e.key,n.key)||st(e.Yr,n.Yr)}static Kr(e,n){return st(e.Yr,n.Yr)||Be.comparator(e.key,n.key)}}class TN{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new gn(xn.$r)}checkEmpty(e){return be.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,a){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const u=new FO(o,n,r,a);this.mutationQueue.push(u);for(const h of a)this.Zr=this.Zr.add(new xn(h.key,o)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return be.resolve(u)}lookupMutationBatch(e,n){return be.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,a=this.ei(r),o=a<0?0:a;return be.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return be.resolve(this.mutationQueue.length===0?s0:this.tr-1)}getAllMutationBatches(e){return be.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new xn(n,0),a=new xn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,a],(u=>{const h=this.Xr(u.Yr);o.push(h)})),be.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new gn(st);return n.forEach((a=>{const o=new xn(a,0),u=new xn(a,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,u],(h=>{r=r.add(h.Yr)}))})),be.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,a=r.length+1;let o=r;Be.isDocumentKey(o)||(o=o.child(""));const u=new xn(new Be(o),0);let h=new gn(st);return this.Zr.forEachWhile((f=>{const m=f.key.path;return!!r.isPrefixOf(m)&&(m.length===a&&(h=h.add(f.Yr)),!0)}),u),be.resolve(this.ti(h))}ti(e){const n=[];return e.forEach((r=>{const a=this.Xr(r);a!==null&&n.push(a)})),n}removeMutationBatch(e,n){gt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return be.forEach(n.mutations,(a=>{const o=new xn(a.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new xn(n,0),a=this.Zr.firstAfterOrEqual(r);return be.resolve(n.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,be.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class AN{constructor(e){this.ri=e,this.docs=(function(){return new Vt(Be.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,a=this.docs.get(r),o=a?a.size:0,u=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:u}),this.size+=u-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return be.resolve(r?r.document.mutableCopy():Bn.newInvalidDocument(n))}getEntries(e,n){let r=fi();return n.forEach((a=>{const o=this.docs.get(a);r=r.insert(a,o?o.document.mutableCopy():Bn.newInvalidDocument(a))})),be.resolve(r)}getDocumentsMatchingQuery(e,n,r,a){let o=fi();const u=n.path,h=new Be(u.child("__id-9223372036854775808__")),f=this.docs.getIteratorFrom(h);for(;f.hasNext();){const{key:m,value:{document:g}}=f.getNext();if(!u.isPrefixOf(m.path))break;m.path.length>u.length+1||tO(eO(g),r)<=0||(a.has(g.key)||Zf(n,g))&&(o=o.insert(g.key,g.mutableCopy()))}return be.resolve(o)}getAllFromCollectionGroup(e,n,r,a){Ve(9500)}ii(e,n){return be.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new jN(this)}getSize(e){return be.resolve(this.size)}}class jN extends vN{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,a)=>{a.isValidDocument()?n.push(this.Nr.addEntry(e,a)):this.Nr.removeEntry(r)})),be.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class RN{constructor(e){this.persistence=e,this.si=new wo((n=>o0(n)),l0),this.lastRemoteSnapshotVersion=He.min(),this.highestTargetId=0,this.oi=0,this._i=new m0,this.targetCount=0,this.ai=Ll.ur()}forEachTarget(e,n){return this.si.forEach(((r,a)=>n(a))),be.resolve()}getLastRemoteSnapshotVersion(e){return be.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return be.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),be.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),be.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Ll(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,be.resolve()}updateTargetData(e,n){return this.Pr(n),be.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,be.resolve()}removeTargets(e,n,r){let a=0;const o=[];return this.si.forEach(((u,h)=>{h.sequenceNumber<=n&&r.get(h.targetId)===null&&(this.si.delete(u),o.push(this.removeMatchingKeysForTargetId(e,h.targetId)),a++)})),be.waitFor(o).next((()=>a))}getTargetCount(e){return be.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return be.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),be.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const a=this.persistence.referenceDelegate,o=[];return a&&n.forEach((u=>{o.push(a.markPotentiallyOrphaned(e,u))})),be.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),be.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return be.resolve(r)}containsKey(e,n){return be.resolve(this._i.containsKey(n))}}class TC{constructor(e,n){this.ui={},this.overlays={},this.ci=new Kf(0),this.li=!1,this.li=!0,this.hi=new CN,this.referenceDelegate=e(this),this.Pi=new RN(this),this.indexManager=new fN,this.remoteDocumentCache=(function(a){return new AN(a)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new dN(n),this.Ii=new wN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new EN,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new TN(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Re("MemoryPersistence","Starting transaction:",e);const a=new IN(this.ci.next());return this.referenceDelegate.Ei(),r(a).next((o=>this.referenceDelegate.di(a).next((()=>o)))).toPromise().then((o=>(a.raiseOnCommittedEvent(),o)))}Ai(e,n){return be.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class IN extends rO{constructor(e){super(),this.currentSequenceNumber=e}}class p0{constructor(e){this.persistence=e,this.Ri=new m0,this.Vi=null}static mi(e){return new p0(e)}get fi(){if(this.Vi)return this.Vi;throw Ve(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),be.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),be.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),be.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((a=>this.fi.add(a.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((a=>{a.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return be.forEach(this.fi,(r=>{const a=Be.fromPath(r);return this.gi(e,a).next((o=>{o||n.removeEntry(a,He.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return be.or([()=>be.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Af{constructor(e,n){this.persistence=e,this.pi=new wo((r=>aO(r.path)),((r,a)=>r.isEqual(a))),this.garbageCollector=bN(this,n)}static mi(e,n){return new Af(e,n)}Ei(){}di(e){return be.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((a=>r+a))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return be.forEach(this.pi,((r,a)=>this.br(e,r,a).next((o=>o?be.resolve():n(a)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const a=this.persistence.getRemoteDocumentCache(),o=a.newChangeBuffer();return a.ii(e,(u=>this.br(e,u,n).next((h=>{h||(r++,o.removeEntry(u,He.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),be.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),be.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),be.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),be.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=ef(e.data.value)),n}br(e,n,r){return be.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const a=this.pi.get(n);return be.resolve(a!==void 0&&a>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class g0{constructor(e,n,r,a){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=a}static As(e,n){let r=it(),a=it();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:a=a.add(o.doc.key)}return new g0(e,n.fromCache,r,a)}}class DN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class MN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return o5()?8:sO(Ln())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,a){const o={result:null};return this.ys(e,n).next((u=>{o.result=u})).next((()=>{if(!o.result)return this.ws(e,n,a,r).next((u=>{o.result=u}))})).next((()=>{if(o.result)return;const u=new DN;return this.Ss(e,n,u).next((h=>{if(o.result=h,this.Vs)return this.bs(e,n,u,h.size)}))})).next((()=>o.result))}bs(e,n,r,a){return r.documentReadCount<this.fs?(xl()<=rt.DEBUG&&Re("QueryEngine","SDK will not create cache indexes for query:",Sl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),be.resolve()):(xl()<=rt.DEBUG&&Re("QueryEngine","Query:",Sl(n),"scans",r.documentReadCount,"local documents and returns",a,"documents as results."),r.documentReadCount>this.gs*a?(xl()<=rt.DEBUG&&Re("QueryEngine","The SDK decides to create cache indexes for query:",Sl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ds(n))):be.resolve())}ys(e,n){if(FS(n))return be.resolve(null);let r=Ds(n);return this.indexManager.getIndexType(e,r).next((a=>a===0?null:(n.limit!==null&&a===1&&(n=_y(n,null,"F"),r=Ds(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const u=it(...o);return this.ps.getDocuments(e,u).next((h=>this.indexManager.getMinOffset(e,r).next((f=>{const m=this.Ds(n,h);return this.Cs(n,m,u,f.readTime)?this.ys(e,_y(n,null,"F")):this.vs(e,m,n,f)}))))})))))}ws(e,n,r,a){return FS(n)||a.isEqual(He.min())?be.resolve(null):this.ps.getDocuments(e,r).next((o=>{const u=this.Ds(n,o);return this.Cs(n,u,r,a)?be.resolve(null):(xl()<=rt.DEBUG&&Re("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),Sl(n)),this.vs(e,u,n,Zk(a,Iu)).next((h=>h)))}))}Ds(e,n){let r=new gn(sC(e));return n.forEach(((a,o)=>{Zf(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,a){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(a)>0)}Ss(e,n,r){return xl()<=rt.DEBUG&&Re("QueryEngine","Using full collection scan to execute query:",Sl(n)),this.ps.getDocumentsMatchingQuery(e,n,fa.min(),r)}vs(e,n,r,a){return this.ps.getDocumentsMatchingQuery(e,r,a).next((o=>(n.forEach((u=>{o=o.insert(u.key,u)})),o)))}}const y0="LocalStore",kN=3e8;class ON{constructor(e,n,r,a){this.persistence=e,this.Fs=n,this.serializer=a,this.Ms=new Vt(st),this.xs=new wo((o=>o0(o)),l0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new SN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function NN(t,e,n,r){return new ON(t,e,n,r)}async function AC(t,e){const n=Ge(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let a;return n.mutationQueue.getAllMutationBatches(r).next((o=>(a=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const u=[],h=[];let f=it();for(const m of a){u.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}for(const m of o){h.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}return n.localDocuments.getDocuments(r,f).next((m=>({Ls:m,removedBatchIds:u,addedBatchIds:h})))}))}))}function PN(t,e){const n=Ge(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const a=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(h,f,m,g){const _=m.batch,v=_.keys();let x=be.resolve();return v.forEach((S=>{x=x.next((()=>g.getEntry(f,S))).next((E=>{const T=m.docVersions.get(S);gt(T!==null,48541),E.version.compareTo(T)<0&&(_.applyToRemoteDocument(E,m),E.isValidDocument()&&(E.setReadTime(m.commitVersion),g.addEntry(E)))}))})),x.next((()=>h.mutationQueue.removeMutationBatch(f,_)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,a,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(h){let f=it();for(let m=0;m<h.mutationResults.length;++m)h.mutationResults[m].transformResults.length>0&&(f=f.add(h.batch.mutations[m].key));return f})(e)))).next((()=>n.localDocuments.getDocuments(r,a)))}))}function jC(t){const e=Ge(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function BN(t,e){const n=Ge(t),r=e.snapshotVersion;let a=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const u=n.Ns.newChangeBuffer({trackRemovals:!0});a=n.Ms;const h=[];e.targetChanges.forEach(((g,_)=>{const v=a.get(_);if(!v)return;h.push(n.Pi.removeMatchingKeys(o,g.removedDocuments,_).next((()=>n.Pi.addMatchingKeys(o,g.addedDocuments,_))));let x=v.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(_)!==null?x=x.withResumeToken(Mn.EMPTY_BYTE_STRING,He.min()).withLastLimboFreeSnapshotVersion(He.min()):g.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(g.resumeToken,r)),a=a.insert(_,x),(function(E,T,I){return E.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=kN?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0})(v,x,g)&&h.push(n.Pi.updateTargetData(o,x))}));let f=fi(),m=it();if(e.documentUpdates.forEach((g=>{e.resolvedLimboDocuments.has(g)&&h.push(n.persistence.referenceDelegate.updateLimboDocument(o,g))})),h.push(LN(o,u,e.documentUpdates).next((g=>{f=g.ks,m=g.qs}))),!r.isEqual(He.min())){const g=n.Pi.getLastRemoteSnapshotVersion(o).next((_=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));h.push(g)}return be.waitFor(h).next((()=>u.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,f,m))).next((()=>f))})).then((o=>(n.Ms=a,o)))}function LN(t,e,n){let r=it(),a=it();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let u=fi();return n.forEach(((h,f)=>{const m=o.get(h);f.isFoundDocument()!==m.isFoundDocument()&&(a=a.add(h)),f.isNoDocument()&&f.version.isEqual(He.min())?(e.removeEntry(h,f.readTime),u=u.insert(h,f)):!m.isValidDocument()||f.version.compareTo(m.version)>0||f.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(f),u=u.insert(h,f)):Re(y0,"Ignoring outdated watch update for ",h,". Current version:",m.version," Watch version:",f.version)})),{ks:u,qs:a}}))}function UN(t,e){const n=Ge(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=s0),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function zN(t,e){const n=Ge(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let a;return n.Pi.getTargetData(r,e).next((o=>o?(a=o,be.resolve(a)):n.Pi.allocateTargetId(r).next((u=>(a=new ra(e,u,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,a).next((()=>a)))))))})).then((r=>{const a=n.Ms.get(r.targetId);return(a===null||r.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function wy(t,e,n){const r=Ge(t),a=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(u=>r.persistence.referenceDelegate.removeTarget(u,a)))}catch(u){if(!ec(u))throw u;Re(y0,`Failed to update sequence numbers for target ${e}: ${u}`)}r.Ms=r.Ms.remove(e),r.xs.delete(a.target)}function ew(t,e,n){const r=Ge(t);let a=He.min(),o=it();return r.persistence.runTransaction("Execute query","readwrite",(u=>(function(f,m,g){const _=Ge(f),v=_.xs.get(g);return v!==void 0?be.resolve(_.Ms.get(v)):_.Pi.getTargetData(m,g)})(r,u,Ds(e)).next((h=>{if(h)return a=h.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(u,h.targetId).next((f=>{o=f}))})).next((()=>r.Fs.getDocumentsMatchingQuery(u,e,n?a:He.min(),n?o:it()))).next((h=>(FN(r,CO(e),h),{documents:h,Qs:o})))))}function FN(t,e,n){let r=t.Os.get(e)||He.min();n.forEach(((a,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class tw{constructor(){this.activeTargetIds=DO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class VN{constructor(){this.Mo=new tw,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new tw,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class $N{Oo(e){}shutdown(){}}const nw="ConnectivityMonitor";class rw{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Re(nw,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Re(nw,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Hh=null;function Ey(){return Hh===null?Hh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Hh++,"0x"+Hh.toString(16)}const Lg="RestConnection",HN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class qN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${a}`,this.Wo=this.databaseId.database===vf?`project_id=${r}`:`project_id=${r}&database_id=${a}`}Go(e,n,r,a,o){const u=Ey(),h=this.zo(e,n.toUriEncodedString());Re(Lg,`Sending RPC '${e}' ${u}:`,h,r);const f={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(f,a,o);const{host:m}=new URL(h),g=Gl(m);return this.Jo(e,h,f,r,g).then((_=>(Re(Lg,`Received RPC '${e}' ${u}: `,_),_)),(_=>{throw kl(Lg,`RPC '${e}' ${u} failed with error: `,_,"url: ",h,"request:",r),_}))}Ho(e,n,r,a,o,u){return this.Go(e,n,r,a,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Jl})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((a,o)=>e[o]=a)),r&&r.headers.forEach(((a,o)=>e[o]=a))}zo(e,n){const r=HN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class GN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Nn="WebChannelConnection";class QN extends qN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,a,o){const u=Ey();return new Promise(((h,f)=>{const m=new D1;m.setWithCredentials(!0),m.listenOnce(M1.COMPLETE,(()=>{try{switch(m.getLastErrorCode()){case Zh.NO_ERROR:const _=m.getResponseJson();Re(Nn,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(_)),h(_);break;case Zh.TIMEOUT:Re(Nn,`RPC '${e}' ${u} timed out`),f(new Te(ye.DEADLINE_EXCEEDED,"Request time out"));break;case Zh.HTTP_ERROR:const v=m.getStatus();if(Re(Nn,`RPC '${e}' ${u} failed with status:`,v,"response text:",m.getResponseText()),v>0){let x=m.getResponseJson();Array.isArray(x)&&(x=x[0]);const S=x?.error;if(S&&S.status&&S.message){const E=(function(I){const j=I.toLowerCase().replace(/_/g,"-");return Object.values(ye).indexOf(j)>=0?j:ye.UNKNOWN})(S.status);f(new Te(E,S.message))}else f(new Te(ye.UNKNOWN,"Server responded with status "+m.getStatus()))}else f(new Te(ye.UNAVAILABLE,"Connection failed."));break;default:Ve(9055,{l_:e,streamId:u,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{Re(Nn,`RPC '${e}' ${u} completed.`)}}));const g=JSON.stringify(a);Re(Nn,`RPC '${e}' ${u} sending request:`,a),m.send(n,"POST",g,r,15)}))}T_(e,n,r){const a=Ey(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],u=N1(),h=O1(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(f.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(f.useFetchStreams=!0),this.jo(f.initMessageHeaders,n,r),f.encodeInitMessageHeaders=!0;const g=o.join("");Re(Nn,`Creating RPC '${e}' stream ${a}: ${g}`,f);const _=u.createWebChannel(g,f);this.I_(_);let v=!1,x=!1;const S=new GN({Yo:T=>{x?Re(Nn,`Not sending because RPC '${e}' stream ${a} is closed:`,T):(v||(Re(Nn,`Opening RPC '${e}' stream ${a} transport.`),_.open(),v=!0),Re(Nn,`RPC '${e}' stream ${a} sending:`,T),_.send(T))},Zo:()=>_.close()}),E=(T,I,j)=>{T.listen(I,(M=>{try{j(M)}catch(Q){setTimeout((()=>{throw Q}),0)}}))};return E(_,pu.EventType.OPEN,(()=>{x||(Re(Nn,`RPC '${e}' stream ${a} transport opened.`),S.o_())})),E(_,pu.EventType.CLOSE,(()=>{x||(x=!0,Re(Nn,`RPC '${e}' stream ${a} transport closed`),S.a_(),this.E_(_))})),E(_,pu.EventType.ERROR,(T=>{x||(x=!0,kl(Nn,`RPC '${e}' stream ${a} transport errored. Name:`,T.name,"Message:",T.message),S.a_(new Te(ye.UNAVAILABLE,"The operation could not be completed")))})),E(_,pu.EventType.MESSAGE,(T=>{if(!x){const I=T.data[0];gt(!!I,16349);const j=I,M=j?.error||j[0]?.error;if(M){Re(Nn,`RPC '${e}' stream ${a} received error:`,M);const Q=M.status;let H=(function(A){const N=an[A];if(N!==void 0)return pC(N)})(Q),W=M.message;H===void 0&&(H=ye.INTERNAL,W="Unknown error status: "+Q+" with message "+M.message),x=!0,S.a_(new Te(H,W)),_.close()}else Re(Nn,`RPC '${e}' stream ${a} received:`,I),S.u_(I)}})),E(h,k1.STAT_EVENT,(T=>{T.stat===dy.PROXY?Re(Nn,`RPC '${e}' stream ${a} detected buffering proxy`):T.stat===dy.NOPROXY&&Re(Nn,`RPC '${e}' stream ${a} detected no buffering proxy`)})),setTimeout((()=>{S.__()}),0),S}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function Ug(){return typeof document<"u"?document:null}function sm(t){return new XO(t,!0)}class RC{constructor(e,n,r=1e3,a=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=a,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),a=Math.max(0,n-r);a>0&&Re("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,a,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const sw="PersistentStream";class IC{constructor(e,n,r,a,o,u,h,f){this.Mi=e,this.S_=r,this.b_=a,this.connection=o,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=h,this.listener=f,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new RC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===ye.RESOURCE_EXHAUSTED?(hi(n.toString()),hi("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===ye.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,a])=>{this.D_===n&&this.G_(r,a)}),(r=>{e((()=>{const a=new Te(ye.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(a)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((a=>{r((()=>this.z_(a)))})),this.stream.onMessage((a=>{r((()=>++this.F_==1?this.J_(a):this.onNext(a)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Re(sw,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Re(sw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class WN extends IC{constructor(e,n,r,a,o,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,a,u),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=eN(this.serializer,e),r=(function(o){if(!("targetChange"in o))return He.min();const u=o.targetChange;return u.targetIds&&u.targetIds.length?He.min():u.readTime?Ms(u.readTime):He.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Sy(this.serializer),n.addTarget=(function(o,u){let h;const f=u.target;if(h=gy(f)?{documents:rN(o,f)}:{query:sN(o,f).ft},h.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){h.resumeToken=_C(o,u.resumeToken);const m=by(o,u.expectedCount);m!==null&&(h.expectedCount=m)}else if(u.snapshotVersion.compareTo(He.min())>0){h.readTime=Tf(o,u.snapshotVersion.toTimestamp());const m=by(o,u.expectedCount);m!==null&&(h.expectedCount=m)}return h})(this.serializer,e);const r=aN(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Sy(this.serializer),n.removeTarget=e,this.q_(n)}}class KN extends IC{constructor(e,n,r,a,o,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,a,u),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return gt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,gt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){gt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=nN(e.writeResults,e.commitTime),r=Ms(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Sy(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>tN(this.serializer,r)))};this.q_(n)}}class YN{}class XN extends YN{constructor(e,n,r,a){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=a,this.ia=!1}sa(){if(this.ia)throw new Te(ye.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,u])=>this.connection.Go(e,vy(n,r),a,o,u))).catch((o=>{throw o.name==="FirebaseError"?(o.code===ye.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Te(ye.UNKNOWN,o.toString())}))}Ho(e,n,r,a,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,h])=>this.connection.Ho(e,vy(n,r),a,u,h,o))).catch((u=>{throw u.name==="FirebaseError"?(u.code===ye.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new Te(ye.UNKNOWN,u.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class JN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(hi(n),this.aa=!1):Re("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const _o="RemoteStore";class ZN{constructor(e,n,r,a,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((u=>{r.enqueueAndForget((async()=>{Eo(this)&&(Re(_o,"Restarting streams for network reachability change."),await(async function(f){const m=Ge(f);m.Ea.add(4),await Zu(m),m.Ra.set("Unknown"),m.Ea.delete(4),await im(m)})(this))}))})),this.Ra=new JN(r,a)}}async function im(t){if(Eo(t))for(const e of t.da)await e(!0)}async function Zu(t){for(const e of t.da)await e(!1)}function DC(t,e){const n=Ge(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),x0(n)?v0(n):tc(n).O_()&&b0(n,e))}function _0(t,e){const n=Ge(t),r=tc(n);n.Ia.delete(e),r.O_()&&MC(n,e),n.Ia.size===0&&(r.O_()?r.L_():Eo(n)&&n.Ra.set("Unknown"))}function b0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(He.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}tc(t).Y_(e)}function MC(t,e){t.Va.Ue(e),tc(t).Z_(e)}function v0(t){t.Va=new QO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),tc(t).start(),t.Ra.ua()}function x0(t){return Eo(t)&&!tc(t).x_()&&t.Ia.size>0}function Eo(t){return Ge(t).Ea.size===0}function kC(t){t.Va=void 0}async function eP(t){t.Ra.set("Online")}async function tP(t){t.Ia.forEach(((e,n)=>{b0(t,e)}))}async function nP(t,e){kC(t),x0(t)?(t.Ra.ha(e),v0(t)):t.Ra.set("Unknown")}async function rP(t,e,n){if(t.Ra.set("Online"),e instanceof yC&&e.state===2&&e.cause)try{await(async function(a,o){const u=o.cause;for(const h of o.targetIds)a.Ia.has(h)&&(await a.remoteSyncer.rejectListen(h,u),a.Ia.delete(h),a.Va.removeTarget(h))})(t,e)}catch(r){Re(_o,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await jf(t,r)}else if(e instanceof rf?t.Va.Ze(e):e instanceof gC?t.Va.st(e):t.Va.tt(e),!n.isEqual(He.min()))try{const r=await jC(t.localStore);n.compareTo(r)>=0&&await(function(o,u){const h=o.Va.Tt(u);return h.targetChanges.forEach(((f,m)=>{if(f.resumeToken.approximateByteSize()>0){const g=o.Ia.get(m);g&&o.Ia.set(m,g.withResumeToken(f.resumeToken,u))}})),h.targetMismatches.forEach(((f,m)=>{const g=o.Ia.get(f);if(!g)return;o.Ia.set(f,g.withResumeToken(Mn.EMPTY_BYTE_STRING,g.snapshotVersion)),MC(o,f);const _=new ra(g.target,f,m,g.sequenceNumber);b0(o,_)})),o.remoteSyncer.applyRemoteEvent(h)})(t,n)}catch(r){Re(_o,"Failed to raise snapshot:",r),await jf(t,r)}}async function jf(t,e,n){if(!ec(e))throw e;t.Ea.add(1),await Zu(t),t.Ra.set("Offline"),n||(n=()=>jC(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Re(_o,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await im(t)}))}function OC(t,e){return e().catch((n=>jf(t,n,e)))}async function am(t){const e=Ge(t),n=ya(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:s0;for(;sP(e);)try{const a=await UN(e.localStore,r);if(a===null){e.Ta.length===0&&n.L_();break}r=a.batchId,iP(e,a)}catch(a){await jf(e,a)}NC(e)&&PC(e)}function sP(t){return Eo(t)&&t.Ta.length<10}function iP(t,e){t.Ta.push(e);const n=ya(t);n.O_()&&n.X_&&n.ea(e.mutations)}function NC(t){return Eo(t)&&!ya(t).x_()&&t.Ta.length>0}function PC(t){ya(t).start()}async function aP(t){ya(t).ra()}async function oP(t){const e=ya(t);for(const n of t.Ta)e.ea(n.mutations)}async function lP(t,e,n){const r=t.Ta.shift(),a=d0.from(r,e,n);await OC(t,(()=>t.remoteSyncer.applySuccessfulWrite(a))),await am(t)}async function cP(t,e){e&&ya(t).X_&&await(async function(r,a){if((function(u){return HO(u)&&u!==ye.ABORTED})(a.code)){const o=r.Ta.shift();ya(r).B_(),await OC(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,a))),await am(r)}})(t,e),NC(t)&&PC(t)}async function iw(t,e){const n=Ge(t);n.asyncQueue.verifyOperationInProgress(),Re(_o,"RemoteStore received new credentials");const r=Eo(n);n.Ea.add(3),await Zu(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await im(n)}async function uP(t,e){const n=Ge(t);e?(n.Ea.delete(2),await im(n)):e||(n.Ea.add(2),await Zu(n),n.Ra.set("Unknown"))}function tc(t){return t.ma||(t.ma=(function(n,r,a){const o=Ge(n);return o.sa(),new WN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,a)})(t.datastore,t.asyncQueue,{Xo:eP.bind(null,t),t_:tP.bind(null,t),r_:nP.bind(null,t),H_:rP.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),x0(t)?v0(t):t.Ra.set("Unknown")):(await t.ma.stop(),kC(t))}))),t.ma}function ya(t){return t.fa||(t.fa=(function(n,r,a){const o=Ge(n);return o.sa(),new KN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,a)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:aP.bind(null,t),r_:cP.bind(null,t),ta:oP.bind(null,t),na:lP.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await am(t)):(await t.fa.stop(),t.Ta.length>0&&(Re(_o,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class S0{constructor(e,n,r,a,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=a,this.removalCallback=o,this.deferred=new li,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((u=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,a,o){const u=Date.now()+r,h=new S0(e,n,u,a,o);return h.start(r),h}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Te(ye.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function w0(t,e){if(hi("AsyncQueue",`${e}: ${t}`),ec(t))return new Te(ye.UNAVAILABLE,`${e}: ${t}`);throw t}class Rl{static emptySet(e){return new Rl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Be.comparator(n.key,r.key):(n,r)=>Be.comparator(n.key,r.key),this.keyedMap=gu(),this.sortedSet=new Vt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Rl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const a=n.getNext().key,o=r.getNext().key;if(!a.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Rl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class aw{constructor(){this.ga=new Vt(Be.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Ve(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class Ul{constructor(e,n,r,a,o,u,h,f,m){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=a,this.mutatedKeys=o,this.fromCache=u,this.syncStateChanged=h,this.excludesMetadataChanges=f,this.hasCachedResults=m}static fromInitialDocuments(e,n,r,a,o){const u=[];return n.forEach((h=>{u.push({type:0,doc:h})})),new Ul(e,n,Rl.emptySet(n),u,r,a,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Jf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let a=0;a<n.length;a++)if(n[a].type!==r[a].type||!n[a].doc.isEqual(r[a].doc))return!1;return!0}}class dP{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class hP{constructor(){this.queries=ow(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const a=Ge(n),o=a.queries;a.queries=ow(),o.forEach(((u,h)=>{for(const f of h.Sa)f.onError(r)}))})(this,new Te(ye.ABORTED,"Firestore shutting down"))}}function ow(){return new wo((t=>rC(t)),Jf)}async function BC(t,e){const n=Ge(t);let r=3;const a=e.query;let o=n.queries.get(a);o?!o.ba()&&e.Da()&&(r=2):(o=new dP,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(a,!0);break;case 1:o.wa=await n.onListen(a,!1);break;case 2:await n.onFirstRemoteStoreListen(a)}}catch(u){const h=w0(u,`Initialization of query '${Sl(e.query)}' failed`);return void e.onError(h)}n.queries.set(a,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&E0(n)}async function LC(t,e){const n=Ge(t),r=e.query;let a=3;const o=n.queries.get(r);if(o){const u=o.Sa.indexOf(e);u>=0&&(o.Sa.splice(u,1),o.Sa.length===0?a=e.Da()?0:1:!o.ba()&&e.Da()&&(a=2))}switch(a){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function fP(t,e){const n=Ge(t);let r=!1;for(const a of e){const o=a.query,u=n.queries.get(o);if(u){for(const h of u.Sa)h.Fa(a)&&(r=!0);u.wa=a}}r&&E0(n)}function mP(t,e,n){const r=Ge(t),a=r.queries.get(e);if(a)for(const o of a.Sa)o.onError(n);r.queries.delete(e)}function E0(t){t.Ca.forEach((e=>{e.next()}))}var Cy,lw;(lw=Cy||(Cy={})).Ma="default",lw.Cache="cache";class UC{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const a of e.docChanges)a.type!==3&&r.push(a);e=new Ul(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Ul.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Cy.Cache}}class zC{constructor(e){this.key=e}}class FC{constructor(e){this.key=e}}class pP{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=it(),this.mutatedKeys=it(),this.eu=sC(e),this.tu=new Rl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new aw,a=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,u=a,h=!1;const f=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,m=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal(((g,_)=>{const v=a.get(g),x=Zf(this.query,_)?_:null,S=!!v&&this.mutatedKeys.has(v.key),E=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let T=!1;v&&x?v.data.isEqual(x.data)?S!==E&&(r.track({type:3,doc:x}),T=!0):this.su(v,x)||(r.track({type:2,doc:x}),T=!0,(f&&this.eu(x,f)>0||m&&this.eu(x,m)<0)&&(h=!0)):!v&&x?(r.track({type:0,doc:x}),T=!0):v&&!x&&(r.track({type:1,doc:v}),T=!0,(f||m)&&(h=!0)),T&&(x?(u=u.add(x),o=E?o.add(g):o.delete(g)):(u=u.delete(g),o=o.delete(g)))})),this.query.limit!==null)for(;u.size>this.query.limit;){const g=this.query.limitType==="F"?u.last():u.first();u=u.delete(g.key),o=o.delete(g.key),r.track({type:1,doc:g})}return{tu:u,iu:r,Cs:h,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,a){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const u=e.iu.ya();u.sort(((g,_)=>(function(x,S){const E=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ve(20277,{Rt:T})}};return E(x)-E(S)})(g.type,_.type)||this.eu(g.doc,_.doc))),this.ou(r),a=a??!1;const h=n&&!a?this._u():[],f=this.Xa.size===0&&this.current&&!a?1:0,m=f!==this.Za;return this.Za=f,u.length!==0||m?{snapshot:new Ul(this.query,e.tu,o,u,e.mutatedKeys,f===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:h}:{au:h}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new aw,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=it(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new FC(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new zC(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=it();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Ul.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const C0="SyncEngine";class gP{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class yP{constructor(e){this.key=e,this.hu=!1}}class _P{constructor(e,n,r,a,o,u){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=a,this.currentUser=o,this.maxConcurrentLimboResolutions=u,this.Pu={},this.Tu=new wo((h=>rC(h)),Jf),this.Iu=new Map,this.Eu=new Set,this.du=new Vt(Be.comparator),this.Au=new Map,this.Ru=new m0,this.Vu={},this.mu=new Map,this.fu=Ll.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function bP(t,e,n=!0){const r=QC(t);let a;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),a=o.view.lu()):a=await VC(r,e,n,!0),a}async function vP(t,e){const n=QC(t);await VC(n,e,!0,!1)}async function VC(t,e,n,r){const a=await zN(t.localStore,Ds(e)),o=a.targetId,u=t.sharedClientState.addLocalQueryTarget(o,n);let h;return r&&(h=await xP(t,e,o,u==="current",a.resumeToken)),t.isPrimaryClient&&n&&DC(t.remoteStore,a),h}async function xP(t,e,n,r,a){t.pu=(_,v,x)=>(async function(E,T,I,j){let M=T.view.ru(I);M.Cs&&(M=await ew(E.localStore,T.query,!1).then((({documents:D})=>T.view.ru(D,M))));const Q=j&&j.targetChanges.get(T.targetId),H=j&&j.targetMismatches.get(T.targetId)!=null,W=T.view.applyChanges(M,E.isPrimaryClient,Q,H);return uw(E,T.targetId,W.au),W.snapshot})(t,_,v,x);const o=await ew(t.localStore,e,!0),u=new pP(e,o.Qs),h=u.ru(o.documents),f=Ju.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",a),m=u.applyChanges(h,t.isPrimaryClient,f);uw(t,n,m.au);const g=new gP(e,n,u);return t.Tu.set(e,g),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),m.snapshot}async function SP(t,e,n){const r=Ge(t),a=r.Tu.get(e),o=r.Iu.get(a.targetId);if(o.length>1)return r.Iu.set(a.targetId,o.filter((u=>!Jf(u,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(a.targetId),r.sharedClientState.isActiveQueryTarget(a.targetId)||await wy(r.localStore,a.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(a.targetId),n&&_0(r.remoteStore,a.targetId),Ty(r,a.targetId)})).catch(Zl)):(Ty(r,a.targetId),await wy(r.localStore,a.targetId,!0))}async function wP(t,e){const n=Ge(t),r=n.Tu.get(e),a=n.Iu.get(r.targetId);n.isPrimaryClient&&a.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),_0(n.remoteStore,r.targetId))}async function EP(t,e,n){const r=DP(t);try{const a=await(function(u,h){const f=Ge(u),m=Nt.now(),g=h.reduce(((x,S)=>x.add(S.key)),it());let _,v;return f.persistence.runTransaction("Locally write mutations","readwrite",(x=>{let S=fi(),E=it();return f.Ns.getEntries(x,g).next((T=>{S=T,S.forEach(((I,j)=>{j.isValidDocument()||(E=E.add(I))}))})).next((()=>f.localDocuments.getOverlayedDocuments(x,S))).next((T=>{_=T;const I=[];for(const j of h){const M=UO(j,_.get(j.key).overlayedDocument);M!=null&&I.push(new Ea(j.key,M,K1(M.value.mapValue),nr.exists(!0)))}return f.mutationQueue.addMutationBatch(x,m,I,h)})).next((T=>{v=T;const I=T.applyToLocalDocumentSet(_,E);return f.documentOverlayCache.saveOverlays(x,T.batchId,I)}))})).then((()=>({batchId:v.batchId,changes:aC(_)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(a.batchId),(function(u,h,f){let m=u.Vu[u.currentUser.toKey()];m||(m=new Vt(st)),m=m.insert(h,f),u.Vu[u.currentUser.toKey()]=m})(r,a.batchId,n),await ed(r,a.changes),await am(r.remoteStore)}catch(a){const o=w0(a,"Failed to persist write");n.reject(o)}}async function $C(t,e){const n=Ge(t);try{const r=await BN(n.localStore,e);e.targetChanges.forEach(((a,o)=>{const u=n.Au.get(o);u&&(gt(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?u.hu=!0:a.modifiedDocuments.size>0?gt(u.hu,14607):a.removedDocuments.size>0&&(gt(u.hu,42227),u.hu=!1))})),await ed(n,r,e)}catch(r){await Zl(r)}}function cw(t,e,n){const r=Ge(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const a=[];r.Tu.forEach(((o,u)=>{const h=u.view.va(e);h.snapshot&&a.push(h.snapshot)})),(function(u,h){const f=Ge(u);f.onlineState=h;let m=!1;f.queries.forEach(((g,_)=>{for(const v of _.Sa)v.va(h)&&(m=!0)})),m&&E0(f)})(r.eventManager,e),a.length&&r.Pu.H_(a),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function CP(t,e,n){const r=Ge(t);r.sharedClientState.updateQueryState(e,"rejected",n);const a=r.Au.get(e),o=a&&a.key;if(o){let u=new Vt(Be.comparator);u=u.insert(o,Bn.newNoDocument(o,He.min()));const h=it().add(o),f=new rm(He.min(),new Map,new Vt(st),u,h);await $C(r,f),r.du=r.du.remove(o),r.Au.delete(e),T0(r)}else await wy(r.localStore,e,!1).then((()=>Ty(r,e,n))).catch(Zl)}async function TP(t,e){const n=Ge(t),r=e.batch.batchId;try{const a=await PN(n.localStore,e);qC(n,r,null),HC(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await ed(n,a)}catch(a){await Zl(a)}}async function AP(t,e,n){const r=Ge(t);try{const a=await(function(u,h){const f=Ge(u);return f.persistence.runTransaction("Reject batch","readwrite-primary",(m=>{let g;return f.mutationQueue.lookupMutationBatch(m,h).next((_=>(gt(_!==null,37113),g=_.keys(),f.mutationQueue.removeMutationBatch(m,_)))).next((()=>f.mutationQueue.performConsistencyCheck(m))).next((()=>f.documentOverlayCache.removeOverlaysForBatchId(m,g,h))).next((()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,g))).next((()=>f.localDocuments.getDocuments(m,g)))}))})(r.localStore,e);qC(r,e,n),HC(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await ed(r,a)}catch(a){await Zl(a)}}function HC(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function qC(t,e,n){const r=Ge(t);let a=r.Vu[r.currentUser.toKey()];if(a){const o=a.get(e);o&&(n?o.reject(n):o.resolve(),a=a.remove(e)),r.Vu[r.currentUser.toKey()]=a}}function Ty(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||GC(t,r)}))}function GC(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(_0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),T0(t))}function uw(t,e,n){for(const r of n)r instanceof zC?(t.Ru.addReference(r.key,e),jP(t,r)):r instanceof FC?(Re(C0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||GC(t,r.key)):Ve(19791,{wu:r})}function jP(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Re(C0,"New document in limbo: "+n),t.Eu.add(r),T0(t))}function T0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Be(It.fromString(e)),r=t.fu.next();t.Au.set(r,new yP(n)),t.du=t.du.insert(n,r),DC(t.remoteStore,new ra(Ds(c0(n.path)),r,"TargetPurposeLimboResolution",Kf.ce))}}async function ed(t,e,n){const r=Ge(t),a=[],o=[],u=[];r.Tu.isEmpty()||(r.Tu.forEach(((h,f)=>{u.push(r.pu(f,e,n).then((m=>{if((m||n)&&r.isPrimaryClient){const g=m?!m.fromCache:n?.targetChanges.get(f.targetId)?.current;r.sharedClientState.updateQueryState(f.targetId,g?"current":"not-current")}if(m){a.push(m);const g=g0.As(f.targetId,m);o.push(g)}})))})),await Promise.all(u),r.Pu.H_(a),await(async function(f,m){const g=Ge(f);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",(_=>be.forEach(m,(v=>be.forEach(v.Es,(x=>g.persistence.referenceDelegate.addReference(_,v.targetId,x))).next((()=>be.forEach(v.ds,(x=>g.persistence.referenceDelegate.removeReference(_,v.targetId,x)))))))))}catch(_){if(!ec(_))throw _;Re(y0,"Failed to update sequence numbers: "+_)}for(const _ of m){const v=_.targetId;if(!_.fromCache){const x=g.Ms.get(v),S=x.snapshotVersion,E=x.withLastLimboFreeSnapshotVersion(S);g.Ms=g.Ms.insert(v,E)}}})(r.localStore,o))}async function RP(t,e){const n=Ge(t);if(!n.currentUser.isEqual(e)){Re(C0,"User change. New user:",e.toKey());const r=await AC(n.localStore,e);n.currentUser=e,(function(o,u){o.mu.forEach((h=>{h.forEach((f=>{f.reject(new Te(ye.CANCELLED,u))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await ed(n,r.Ls)}}function IP(t,e){const n=Ge(t),r=n.Au.get(e);if(r&&r.hu)return it().add(r.key);{let a=it();const o=n.Iu.get(e);if(!o)return a;for(const u of o){const h=n.Tu.get(u);a=a.unionWith(h.view.nu)}return a}}function QC(t){const e=Ge(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=$C.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=IP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=CP.bind(null,e),e.Pu.H_=fP.bind(null,e.eventManager),e.Pu.yu=mP.bind(null,e.eventManager),e}function DP(t){const e=Ge(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=TP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=AP.bind(null,e),e}class Rf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return NN(this.persistence,new MN,e.initialUser,this.serializer)}Cu(e){return new TC(p0.mi,this.serializer)}Du(e){return new VN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Rf.provider={build:()=>new Rf};class MP extends Rf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){gt(this.persistence.referenceDelegate instanceof Af,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new yN(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?er.withCacheSize(this.cacheSizeBytes):er.DEFAULT;return new TC((r=>Af.mi(r,n)),this.serializer)}}class Ay{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>cw(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=RP.bind(null,this.syncEngine),await uP(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new hP})()}createDatastore(e){const n=sm(e.databaseInfo.databaseId),r=(function(o){return new QN(o)})(e.databaseInfo);return(function(o,u,h,f){return new XN(o,u,h,f)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,a,o,u,h){return new ZN(r,a,o,u,h)})(this.localStore,this.datastore,e.asyncQueue,(n=>cw(this.syncEngine,n,0)),(function(){return rw.v()?new rw:new $N})())}createSyncEngine(e,n){return(function(a,o,u,h,f,m,g){const _=new _P(a,o,u,h,f,m);return g&&(_.gu=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=Ge(n);Re(_o,"RemoteStore shutting down."),r.Ea.add(5),await Zu(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ay.provider={build:()=>new Ay};class WC{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):hi("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const _a="FirestoreClient";class kP{constructor(e,n,r,a,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=a,this.user=Pn.UNAUTHENTICATED,this.clientId=r0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async u=>{Re(_a,"Received user=",u.uid),await this.authCredentialListener(u),this.user=u})),this.appCheckCredentials.start(r,(u=>(Re(_a,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new li;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=w0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function zg(t,e){t.asyncQueue.verifyOperationInProgress(),Re(_a,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async a=>{r.isEqual(a)||(await AC(e.localStore,a),r=a)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function dw(t,e){t.asyncQueue.verifyOperationInProgress();const n=await OP(t);Re(_a,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>iw(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,a)=>iw(e.remoteStore,a))),t._onlineComponents=e}async function OP(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Re(_a,"Using user provided OfflineComponentProvider");try{await zg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(a){return a.name==="FirebaseError"?a.code===ye.FAILED_PRECONDITION||a.code===ye.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(n))throw n;kl("Error using user provided cache. Falling back to memory cache: "+n),await zg(t,new Rf)}}else Re(_a,"Using default OfflineComponentProvider"),await zg(t,new MP(void 0));return t._offlineComponents}async function KC(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Re(_a,"Using user provided OnlineComponentProvider"),await dw(t,t._uninitializedComponentsProvider._online)):(Re(_a,"Using default OnlineComponentProvider"),await dw(t,new Ay))),t._onlineComponents}function NP(t){return KC(t).then((e=>e.syncEngine))}async function YC(t){const e=await KC(t),n=e.eventManager;return n.onListen=bP.bind(null,e.syncEngine),n.onUnlisten=SP.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=vP.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=wP.bind(null,e.syncEngine),n}function PP(t,e,n={}){const r=new li;return t.asyncQueue.enqueueAndForget((async()=>(function(o,u,h,f,m){const g=new WC({next:v=>{g.Nu(),u.enqueueAndForget((()=>LC(o,_)));const x=v.docs.has(h);!x&&v.fromCache?m.reject(new Te(ye.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&v.fromCache&&f&&f.source==="server"?m.reject(new Te(ye.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(v)},error:v=>m.reject(v)}),_=new UC(c0(h.path),g,{includeMetadataChanges:!0,qa:!0});return BC(o,_)})(await YC(t),t.asyncQueue,e,n,r))),r.promise}function BP(t,e,n={}){const r=new li;return t.asyncQueue.enqueueAndForget((async()=>(function(o,u,h,f,m){const g=new WC({next:v=>{g.Nu(),u.enqueueAndForget((()=>LC(o,_))),v.fromCache&&f.source==="server"?m.reject(new Te(ye.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(v)},error:v=>m.reject(v)}),_=new UC(h,g,{includeMetadataChanges:!0,qa:!0});return BC(o,_)})(await YC(t),t.asyncQueue,e,n,r))),r.promise}function XC(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const hw=new Map;const JC="firestore.googleapis.com",fw=!0;class mw{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Te(ye.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=JC,this.ssl=fw}else this.host=e.host,this.ssl=e.ssl??fw;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=CC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<pN)throw new Te(ye.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Jk("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=XC(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Te(ye.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Te(ye.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Te(ye.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,a){return r.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class om{constructor(e,n,r,a){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new mw({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Te(ye.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Te(ye.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new mw(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Vk;switch(r.type){case"firstParty":return new Gk(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Te(ye.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=hw.get(n);r&&(Re("ComponentProvider","Removing Datastore"),hw.delete(n),r.terminate())})(this),Promise.resolve()}}function LP(t,e,n,r={}){t=ts(t,om);const a=Gl(e),o=t._getSettings(),u={...o,emulatorOptions:t._getEmulatorOptions()},h=`${e}:${n}`;a&&(jE(`https://${h}`),RE("Firestore",!0)),o.host!==JC&&o.host!==h&&kl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const f={...o,host:h,ssl:a,emulatorOptions:r};if(!ha(f,u)&&(t._setSettings(f),r.mockUserToken)){let m,g;if(typeof r.mockUserToken=="string")m=r.mockUserToken,g=Pn.MOCK_USER;else{m=JI(r.mockUserToken,t._app?.options.projectId);const _=r.mockUserToken.sub||r.mockUserToken.user_id;if(!_)throw new Te(ye.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new Pn(_)}t._authCredentials=new $k(new B1(m,g))}}class nc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new nc(this.firestore,e,this._query)}}class Yt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new da(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Yt(this.firestore,e,this._key)}toJSON(){return{type:Yt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(Ku(n,Yt._jsonSchema))return new Yt(e,r||null,new Be(It.fromString(n.referencePath)))}}Yt._jsonSchemaVersion="firestore/documentReference/1.0",Yt._jsonSchema={type:cn("string",Yt._jsonSchemaVersion),referencePath:cn("string")};class da extends nc{constructor(e,n,r){super(e,n,c0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Yt(this.firestore,null,new Be(e))}withConverter(e){return new da(this.firestore,e,this._path)}}function UP(t,e,...n){if(t=un(t),L1("collection","path",e),t instanceof om){const r=It.fromString(e,...n);return AS(r),new da(t,null,r)}{if(!(t instanceof Yt||t instanceof da))throw new Te(ye.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(It.fromString(e,...n));return AS(r),new da(t.firestore,null,r)}}function rc(t,e,...n){if(t=un(t),arguments.length===1&&(e=r0.newId()),L1("doc","path",e),t instanceof om){const r=It.fromString(e,...n);return TS(r),new Yt(t,null,new Be(r))}{if(!(t instanceof Yt||t instanceof da))throw new Te(ye.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(It.fromString(e,...n));return TS(r),new Yt(t.firestore,t instanceof da?t.converter:null,new Be(r))}}const pw="AsyncQueue";class gw{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new RC(this,"async_queue_retry"),this._c=()=>{const r=Ug();r&&Re(pw,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Ug();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Ug();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new li;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ec(e))throw e;Re(pw,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,hi("INTERNAL UNHANDLED ERROR: ",yw(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const a=S0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(a),a}uc(){this.nc&&Ve(47125,{Pc:yw(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function yw(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Co extends om{constructor(e,n,r,a){super(e,n,r,a),this.type="firestore",this._queue=new gw,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new gw(e),this._firestoreClient=void 0,await e}}}function zP(t,e){const n=typeof t=="object"?t:kE(),r=typeof t=="string"?t:vf,a=Vy(n,"firestore").getImmediate({identifier:r});if(!a._initialized){const o=YI("firestore");o&&LP(a,...o)}return a}function lm(t){if(t._terminated)throw new Te(ye.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||FP(t),t._firestoreClient}function FP(t){const e=t._freezeSettings(),n=(function(a,o,u,h){return new cO(a,o,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,XC(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new kP(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(a){const o=a?._online.build();return{_offline:a?._offline.build(o),_online:o}})(t._componentsProvider))}class Nr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Nr(Mn.fromBase64String(e))}catch(n){throw new Te(ye.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Nr(Mn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Nr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ku(e,Nr._jsonSchema))return Nr.fromBase64String(e.bytes)}}Nr._jsonSchemaVersion="firestore/bytes/1.0",Nr._jsonSchema={type:cn("string",Nr._jsonSchemaVersion),bytes:cn("string")};class td{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Te(ye.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new In(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class cm{constructor(e){this._methodName=e}}class ks{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Te(ye.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Te(ye.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return st(this._lat,e._lat)||st(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ks._jsonSchemaVersion}}static fromJSON(e){if(Ku(e,ks._jsonSchema))return new ks(e.latitude,e.longitude)}}ks._jsonSchemaVersion="firestore/geoPoint/1.0",ks._jsonSchema={type:cn("string",ks._jsonSchemaVersion),latitude:cn("number"),longitude:cn("number")};class Os{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,a){if(r.length!==a.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==a[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Os._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ku(e,Os._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Os(e.vectorValues);throw new Te(ye.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Os._jsonSchemaVersion="firestore/vectorValue/1.0",Os._jsonSchema={type:cn("string",Os._jsonSchemaVersion),vectorValues:cn("object")};const VP=/^__.*__$/;class $P{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Ea(e,this.data,this.fieldMask,n,this.fieldTransforms):new Xu(e,this.data,n,this.fieldTransforms)}}class ZC{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Ea(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function eT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ve(40011,{Ac:t})}}class um{constructor(e,n,r,a,o,u){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=a,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new um({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return If(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(eT(this.Ac)&&VP.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class HP{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||sm(e)}Cc(e,n,r,a=!1){return new um({Ac:e,methodName:n,Dc:r,path:In.emptyPath(),fc:!1,bc:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function dm(t){const e=t._freezeSettings(),n=sm(t._databaseId);return new HP(t._databaseId,!!e.ignoreUndefinedProperties,n)}function tT(t,e,n,r,a,o={}){const u=t.Cc(o.merge||o.mergeFields?2:0,e,n,a);j0("Data must be an object, but it was:",u,r);const h=sT(r,u);let f,m;if(o.merge)f=new mr(u.fieldMask),m=u.fieldTransforms;else if(o.mergeFields){const g=[];for(const _ of o.mergeFields){const v=jy(e,_,n);if(!u.contains(v))throw new Te(ye.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);aT(g,v)||g.push(v)}f=new mr(g),m=u.fieldTransforms.filter((_=>f.covers(_.field)))}else f=null,m=u.fieldTransforms;return new $P(new tr(h),f,m)}class nd extends cm{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof nd}}function qP(t,e,n){return new um({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class A0 extends cm{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=qP(this,e,!0),r=this.vc.map((o=>sc(o,n))),a=new Bl(r);return new NO(e.path,a)}isEqual(e){return e instanceof A0&&ha(this.vc,e.vc)}}function nT(t,e,n,r){const a=t.Cc(1,e,n);j0("Data must be an object, but it was:",a,r);const o=[],u=tr.empty();wa(r,((f,m)=>{const g=R0(e,f,n);m=un(m);const _=a.yc(g);if(m instanceof nd)o.push(g);else{const v=sc(m,_);v!=null&&(o.push(g),u.set(g,v))}}));const h=new mr(o);return new ZC(u,h,a.fieldTransforms)}function rT(t,e,n,r,a,o){const u=t.Cc(1,e,n),h=[jy(e,r,n)],f=[a];if(o.length%2!=0)throw new Te(ye.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)h.push(jy(e,o[v])),f.push(o[v+1]);const m=[],g=tr.empty();for(let v=h.length-1;v>=0;--v)if(!aT(m,h[v])){const x=h[v];let S=f[v];S=un(S);const E=u.yc(x);if(S instanceof nd)m.push(x);else{const T=sc(S,E);T!=null&&(m.push(x),g.set(x,T))}}const _=new mr(m);return new ZC(g,_,u.fieldTransforms)}function GP(t,e,n,r=!1){return sc(n,t.Cc(r?4:3,e))}function sc(t,e){if(iT(t=un(t)))return j0("Unsupported field value:",e,t),sT(t,e);if(t instanceof cm)return(function(r,a){if(!eT(a.Ac))throw a.Sc(`${r._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(a);o&&a.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,a){const o=[];let u=0;for(const h of r){let f=sc(h,a.wc(u));f==null&&(f={nullValue:"NULL_VALUE"}),o.push(f),u++}return{arrayValue:{values:o}}})(t,e)}return(function(r,a){if((r=un(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return MO(a.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Nt.fromDate(r);return{timestampValue:Tf(a.serializer,o)}}if(r instanceof Nt){const o=new Nt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Tf(a.serializer,o)}}if(r instanceof ks)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Nr)return{bytesValue:_C(a.serializer,r._byteString)};if(r instanceof Yt){const o=a.databaseId,u=r.firestore._databaseId;if(!u.isEqual(o))throw a.Sc(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:f0(r.firestore._databaseId||a.databaseId,r._key.path)}}if(r instanceof Os)return(function(u,h){return{mapValue:{fields:{[Q1]:{stringValue:W1},[xf]:{arrayValue:{values:u.toArray().map((m=>{if(typeof m!="number")throw h.Sc("VectorValues must only contain numeric values.");return u0(h.serializer,m)}))}}}}}})(r,a);throw a.Sc(`Unsupported field value: ${Wf(r)}`)})(t,e)}function sT(t,e){const n={};return F1(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):wa(t,((r,a)=>{const o=sc(a,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function iT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Nt||t instanceof ks||t instanceof Nr||t instanceof Yt||t instanceof cm||t instanceof Os)}function j0(t,e,n){if(!iT(n)||!U1(n)){const r=Wf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function jy(t,e,n){if((e=un(e))instanceof td)return e._internalPath;if(typeof e=="string")return R0(t,e);throw If("Field path arguments must be of type string or ",t,!1,void 0,n)}const QP=new RegExp("[~\\*/\\[\\]]");function R0(t,e,n){if(e.search(QP)>=0)throw If(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new td(...e.split("."))._internalPath}catch{throw If(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function If(t,e,n,r,a){const o=r&&!r.isEmpty(),u=a!==void 0;let h=`Function ${e}() called with invalid data`;n&&(h+=" (via `toFirestore()`)"),h+=". ";let f="";return(o||u)&&(f+=" (found",o&&(f+=` in field ${r}`),u&&(f+=` in document ${a}`),f+=")"),new Te(ye.INVALID_ARGUMENT,h+t+f)}function aT(t,e){return t.some((n=>n.isEqual(e)))}class oT{constructor(e,n,r,a,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=a,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Yt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new WP(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(I0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class WP extends oT{data(){return super.data()}}function I0(t,e){return typeof e=="string"?R0(t,e):e instanceof td?e._internalPath:e._delegate._internalPath}function KP(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Te(ye.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class D0{}class YP extends D0{}function XP(t,e,...n){let r=[];e instanceof D0&&r.push(e),r=r.concat(n),(function(o){const u=o.filter((f=>f instanceof M0)).length,h=o.filter((f=>f instanceof hm)).length;if(u>1||u>0&&h>0)throw new Te(ye.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const a of r)t=a._apply(t);return t}class hm extends YP{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new hm(e,n,r)}_apply(e){const n=this._parse(e);return lT(e._query,n),new nc(e.firestore,e.converter,yy(e._query,n))}_parse(e){const n=dm(e.firestore);return(function(o,u,h,f,m,g,_){let v;if(m.isKeyField()){if(g==="array-contains"||g==="array-contains-any")throw new Te(ye.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if(g==="in"||g==="not-in"){bw(_,g);const S=[];for(const E of _)S.push(_w(f,o,E));v={arrayValue:{values:S}}}else v=_w(f,o,_)}else g!=="in"&&g!=="not-in"&&g!=="array-contains-any"||bw(_,g),v=GP(h,u,_,g==="in"||g==="not-in");return ln.create(m,g,v)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function JP(t,e,n){const r=e,a=I0("where",t);return hm._create(a,r,n)}class M0 extends D0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new M0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:ns.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(a,o){let u=a;const h=o.getFlattenedFilters();for(const f of h)lT(u,f),u=yy(u,f)})(e._query,n),new nc(e.firestore,e.converter,yy(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function _w(t,e,n){if(typeof(n=un(n))=="string"){if(n==="")throw new Te(ye.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!nC(e)&&n.indexOf("/")!==-1)throw new Te(ye.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(It.fromString(n));if(!Be.isDocumentKey(r))throw new Te(ye.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return NS(t,new Be(r))}if(n instanceof Yt)return NS(t,n._key);throw new Te(ye.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Wf(n)}.`)}function bw(t,e){if(!Array.isArray(t)||t.length===0)throw new Te(ye.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function lT(t,e){const n=(function(a,o){for(const u of a)for(const h of u.getFlattenedFilters())if(o.indexOf(h.op)>=0)return h.op;return null})(t.filters,(function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Te(ye.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Te(ye.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class ZP{convertValue(e,n="none"){switch(ga(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Kt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(pa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ve(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return wa(e,((a,o)=>{r[a]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[xf].arrayValue?.values?.map((r=>Kt(r.doubleValue)));return new Os(n)}convertGeoPoint(e){return new ks(Kt(e.latitude),Kt(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Xf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Du(e));default:return null}}convertTimestamp(e){const n=ma(e);return new Nt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=It.fromString(e);gt(EC(r),9688,{name:e});const a=new Mu(r.get(1),r.get(3)),o=new Be(r.popFirst(5));return a.isEqual(n)||hi(`Document ${o} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function cT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class _u{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class uo extends oT{constructor(e,n,r,a,o,u){super(e,n,r,a,u),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new sf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(I0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Te(ye.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=uo._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}uo._jsonSchemaVersion="firestore/documentSnapshot/1.0",uo._jsonSchema={type:cn("string",uo._jsonSchemaVersion),bundleSource:cn("string","DocumentSnapshot"),bundleName:cn("string"),bundle:cn("string")};class sf extends uo{data(e={}){return super.data(e)}}class Il{constructor(e,n,r,a){this._firestore=e,this._userDataWriter=n,this._snapshot=a,this.metadata=new _u(a.hasPendingWrites,a.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new sf(this._firestore,this._userDataWriter,r.key,r,new _u(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Te(ye.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(a,o){if(a._snapshot.oldDocs.isEmpty()){let u=0;return a._snapshot.docChanges.map((h=>{const f=new sf(a._firestore,a._userDataWriter,h.doc.key,h.doc,new _u(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);return h.doc,{type:"added",doc:f,oldIndex:-1,newIndex:u++}}))}{let u=a._snapshot.oldDocs;return a._snapshot.docChanges.filter((h=>o||h.type!==3)).map((h=>{const f=new sf(a._firestore,a._userDataWriter,h.doc.key,h.doc,new _u(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);let m=-1,g=-1;return h.type!==0&&(m=u.indexOf(h.doc.key),u=u.delete(h.doc.key)),h.type!==1&&(u=u.add(h.doc),g=u.indexOf(h.doc.key)),{type:e4(h.type),doc:f,oldIndex:m,newIndex:g}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Te(ye.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Il._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=r0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],a=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),a.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function e4(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ve(61501,{type:t})}}function t4(t){t=ts(t,Yt);const e=ts(t.firestore,Co);return PP(lm(e),t._key).then((n=>a4(e,t,n)))}Il._jsonSchemaVersion="firestore/querySnapshot/1.0",Il._jsonSchema={type:cn("string",Il._jsonSchemaVersion),bundleSource:cn("string","QuerySnapshot"),bundleName:cn("string"),bundle:cn("string")};class uT extends ZP{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Yt(this.firestore,null,n)}}function n4(t){t=ts(t,nc);const e=ts(t.firestore,Co),n=lm(e),r=new uT(e);return KP(t._query),BP(n,t._query).then((a=>new Il(e,r,t,a)))}function r4(t,e,n){t=ts(t,Yt);const r=ts(t.firestore,Co),a=cT(t.converter,e,n);return fm(r,[tT(dm(r),"setDoc",t._key,a,t.converter!==null,n).toMutation(t._key,nr.none())])}function s4(t,e,n,...r){t=ts(t,Yt);const a=ts(t.firestore,Co),o=dm(a);let u;return u=typeof(e=un(e))=="string"||e instanceof td?rT(o,"updateDoc",t._key,e,n,r):nT(o,"updateDoc",t._key,e),fm(a,[u.toMutation(t._key,nr.exists(!0))])}function i4(t){return fm(ts(t.firestore,Co),[new nm(t._key,nr.none())])}function fm(t,e){return(function(r,a){const o=new li;return r.asyncQueue.enqueueAndForget((async()=>EP(await NP(r),a,o))),o.promise})(lm(t),e)}function a4(t,e,n){const r=n.docs.get(e._key),a=new uT(t);return new uo(t,a,e._key,r,new _u(n.hasPendingWrites,n.fromCache),e.converter)}class o4{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=dm(e)}set(e,n,r){this._verifyNotCommitted();const a=Fg(e,this._firestore),o=cT(a.converter,n,r),u=tT(this._dataReader,"WriteBatch.set",a._key,o,a.converter!==null,r);return this._mutations.push(u.toMutation(a._key,nr.none())),this}update(e,n,r,...a){this._verifyNotCommitted();const o=Fg(e,this._firestore);let u;return u=typeof(n=un(n))=="string"||n instanceof td?rT(this._dataReader,"WriteBatch.update",o._key,n,r,a):nT(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(u.toMutation(o._key,nr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Fg(e,this._firestore);return this._mutations=this._mutations.concat(new nm(n._key,nr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Te(ye.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Fg(t,e){if((t=un(t)).firestore!==e)throw new Te(ye.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function vw(){return new nd("deleteField")}function l4(...t){return new A0("arrayUnion",t)}function dT(t){return lm(t=ts(t,Co)),new o4(t,(e=>fm(t,e)))}(function(e,n=!0){(function(a){Jl=a})(Ql),Dl(new fo("firestore",((r,{instanceIdentifier:a,options:o})=>{const u=r.getProvider("app").getImmediate(),h=new Co(new Hk(r.getProvider("auth-internal")),new Qk(u,r.getProvider("app-check-internal")),(function(m,g){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new Te(ye.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Mu(m.options.projectId,g)})(u,a),u);return o={useFetchStreams:n,...o},h._setSettings(o),h}),"PUBLIC").setMultipleInstances(!0)),oa(SS,wS,e),oa(SS,wS,"esm2020")})();function To(){return zP(p1)}const Hn={showGroupTotals:!1};function Ao(t,e,n,r=1,a,o){let u=e;if(e.startsWith("budgets/"))u="budgets";else if(e.startsWith("months/")){const g=e.replace("months/","").split("_");if(g.length>=2){const _=g[g.length-1];u=`months/${g[g.length-2]}/${_}`}}console.log(`[Firebase] ${t}(${r}): ${u}${a===!1?" [NOT FOUND]":""}`)}async function et(t,e,n){const r=rc(To(),t,e),a=`${t}/${e}`,o=await t4(r),u=o.exists(),h=u?o.data():null;return Ao("READ",a,n,1,u),{exists:u,data:h,ref:r}}async function Pt(t,e,n){const r=To(),a=UP(r,t);let o;if(n&&n.length>0){const m=n.map(g=>JP(g.field,g.op,g.value));o=XP(a,...m)}else o=a;const u=await n4(o),h=u.docs.map(m=>({id:m.id,data:m.data()}));let f=t;if(n&&n.length>0){const m=n.map(g=>`${g.field} ${g.op} ${JSON.stringify(g.value)}`).join(", ");f+=` WHERE ${m}`}return Ao("QUERY",f,e,u.docs.length,void 0),{docs:h}}async function Dt(t,e,n,r,a){const o=rc(To(),t,e),u=`${t}/${e}`;return Ao("WRITE",u,r,1,void 0),r4(o,n,a??{})}async function mm(t,e){const r=To();for(let a=0;a<t.length;a+=500){const o=t.slice(a,a+500),u=dT(r);for(const{collectionPath:h,docId:f,data:m}of o){const g=rc(r,h,f);u.set(g,m)}Ao("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0),await u.commit()}}async function zl(t,e,n,r){const a=rc(To(),t,e),o=`${t}/${e}`;return Ao("UPDATE",o,r,1,void 0),s4(a,n)}async function Nu(t,e,n){const r=rc(To(),t,e),a=`${t}/${e}`;return Ao("DELETE",a),i4(r)}async function hT(t,e,n){const a=To();for(let o=0;o<t.length;o+=500){const u=t.slice(o,o+500),h=dT(a);for(const{collectionPath:f,docId:m}of u){const g=rc(a,f,m);h.delete(g)}Ao("BATCH_DELETE",`${u.length} docs`,e,u.length),await h.commit(),n?.(o+u.length)}}function c4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??null,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function u4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget,is_active:r.is_active}}),e}function d4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??null,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0}}),e}function h4(t=[]){const e=t.map(n=>({id:n.id,name:n.name,sort_order:n.sort_order??0}));return e.sort((n,r)=>n.sort_order-r.sort_order),e}function f4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}async function m4(t){const{exists:e,data:n}=await et("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=c4(n.accounts),a=u4(n.account_groups),o=d4(n.categories),u=h4(n.category_groups),h=n.total_available??0,f=f4(n.month_map),m=n.is_needs_recalculation??!1;return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:a,categories:o,category_groups:u,total_available:h,is_needs_recalculation:m,month_map:f},accounts:r,accountGroups:a,categories:o,categoryGroups:u,isNeedsRecalculation:m,monthMap:f}}function fT(t,e){return Xl({queryKey:t?Ce.budget(t):["budget","none"],queryFn:()=>m4(t),enabled:!!t&&e?.enabled!==!1})}function gr(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function Df(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function p4(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function At(t,e){return`${t}${e.toString().padStart(2,"0")}`}function Ry(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function pm(t,e){const n=new Date,r=n.getFullYear(),a=n.getMonth()+1;if(t===r&&e===a){const o=n.getDate();return`${r}-${String(a).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function we(t){return Math.round((t+Number.EPSILON)*100)/100}function ut(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function g4(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??At(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function y4(t,e,n,r){const a=gr(t,e,n);return(await Oe.fetchQuery({queryKey:Ce.month(t,e,n),queryFn:async()=>{const{exists:u,data:h}=await et("months",a,r?.description??`reading month ${e}/${n}`);return!u||!h?null:{month:g4(h,t,e,n)}},staleTime:R1}))?.month??null}function _4(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??At(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function zn(t,e,n,r){const a=gr(t,e,n),o=r?`PRE-EDIT-READ: ${r}`:"PRE-EDIT-READ",{exists:u,data:h}=await et("months",a,o);if(!u||!h)throw new Error(`Month data not found for ${e}/${n}`);return _4(h,t,e,n)}async function b4(t,e,n){const r=At(e,n);return(await Pt("months","getFutureMonths: querying months after specified month",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">",value:r}])).docs.map(u=>({id:u.id,...u.data})).sort((u,h)=>u.year!==h.year?u.year-h.year:u.month-h.month)}function v4(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}const oo={mobile:640,tablet:768,wide:1200},x4=oo.mobile,bo=["January","February","March","April","May","June","July","August","September","October","November","December"],Pu=3,Mf=3;function S4(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let a=Mf;a>0;a--){let o=e,u=n-a;for(;u<1;)u+=12,o-=1;r.push(At(o,u))}r.push(At(e,n));for(let a=1;a<=Pu;a++){let o=e,u=n+a;for(;u>12;)u-=12,o+=1;r.push(At(o,u))}return r}function w4(t,e){const n=Ce.budget(t),r=Oe.getQueryData(n);if(!r?.monthMap)return!1;for(const[a,o]of Object.entries(r.monthMap))if(a>=e&&!o.needs_recalculation)return!1;return!0}function E4(t,e,n){const r=Ce.budget(t),a=Oe.getQueryData(r);a&&Oe.setQueryData(r,{...a,isNeedsRecalculation:!0,monthMap:n,budget:{...a.budget,is_needs_recalculation:!0,month_map:n}})}function C4(t,e){const n=Ce.budget(t),r=Oe.getQueryData(n);r&&Oe.setQueryData(n,{...r,monthMap:e,budget:{...r.budget,month_map:e}})}async function mT(t,e,n,r){const{bypassDateLimit:a=!1}=r??{},o=new Date,u=o.getFullYear(),h=o.getMonth()+1,f=(e-u)*12+(n-h);if(!a&&f>Pu){const A=`[createMonth] Refusing to create month ${e}/${n} - it's ${f} months in the future (max allowed: ${Pu}). This likely indicates a bug in month navigation.`;throw console.error(A),new Error(A)}if(!a&&f<-Mf){const A=`[createMonth] Refusing to create month ${e}/${n} - it's ${Math.abs(f)} months in the past (max allowed: ${Mf}). Existing months can still be viewed, but new months cannot be created this far back.`;throw console.error(A),new Error(A)}const{exists:m,data:g}=await et("budgets",t,"validating budget exists before creating month");if(!m||!g){Oe.removeQueries({queryKey:Ce.budget(t)}),localStorage.removeItem("BUDGET_APP_QUERY_CACHE");const A=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(A),new Error(A)}const _=o.toISOString(),v=gr(t,e,n);let x=0,S={},E={};if(n>1||e>new Date().getFullYear()-10){const{year:A,month:N}=Df(e,n),P=gr(t,A,N);try{const{exists:L,data:B}=await et("months",P,"fetching previous month to create start balances for new month");if(L&&B){const O={budget_id:t,year_month_ordinal:B.year_month_ordinal??At(A,N),year:B.year??A,month:B.month??N,income:B.income||[],total_income:B.total_income??0,previous_month_income:B.previous_month_income??0,expenses:B.expenses||[],total_expenses:B.total_expenses??0,transfers:B.transfers||[],adjustments:B.adjustments||[],account_balances:B.account_balances||[],category_balances:B.category_balances||[],are_allocations_finalized:B.are_allocations_finalized??!1,created_at:B.created_at,updated_at:B.updated_at};x=O.total_income;const{categoryEndBalances:G,accountEndBalances:Y}=v4(O);S=G,E=Y}}catch(L){if(L instanceof Error&&L.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${A}/${N}, starting with zero balances`);else throw L}}const T=Object.entries(S).map(([A,N])=>({category_id:A,start_balance:N,allocated:0,spent:0,end_balance:N})),I=Object.entries(E).map(([A,N])=>({account_id:A,start_balance:N,income:0,expenses:0,net_change:0,end_balance:N})),j={budget_id:t,year_month_ordinal:At(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:x,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:I,category_balances:T,are_allocations_finalized:!1,created_at:_,updated_at:_},M={budget_id:t,year_month_ordinal:At(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:x,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:I,category_balances:T,are_allocations_finalized:!1,created_at:_,updated_at:_};await Dt("months",v,M,"creating new month document (first time viewing this month)"),Oe.setQueryData(Ce.month(t,e,n),{month:j});const Q=At(e,n),W={...g.month_map||{},[Q]:{needs_recalculation:!1}},D=W;return C4(t,D),await zl("budgets",t,{month_map:D,updated_at:_},`adding month ${e}/${n} to budget month_map`),j}function T4(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??At(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function A4(t,e,n){const r=gr(t,e,n);try{const{exists:a,data:o}=await et("months",r,`loading month ${e}/${n}`);return!a||!o?null:T4(o,t,e,n)}catch(a){if(a instanceof Error&&a.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw a}}async function j4(t,e,n){const r=await A4(t,e,n);return r||mT(t,e,n)}function R4(t,e,n,r){const a=!!t&&r?.enabled!==!1;return Xl({queryKey:t?Ce.month(t,e,n):["month","none"],queryFn:async()=>({month:await j4(t,e,n)}),enabled:a})}async function I4(t){const{exists:e,data:n}=await et("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function k0(t,e){return Xl({queryKey:t?Ce.payees(t):["payees","none"],queryFn:()=>I4(t),enabled:!!t&&e?.enabled!==!1})}async function D4(t,e){const{exists:n,data:r}=await et("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const a={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await Dt("users",t,a,"creating new user document (first login)"),a}function M4(t,e,n){return Xl({queryKey:t?Ce.user(t):["user","none"],queryFn:()=>D4(t,e),enabled:!!t&&n?.enabled!==!1})}async function k4(t,e){const n=await Pt("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],a=[];for(const o of n.docs){const u=o.data;u.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:u.name||"Unnamed Budget",ownerEmail:u.owner_email||null,isOwner:u.owner_id===t,isPending:!1}):a.push({budgetId:o.id,budgetName:u.name||"Unnamed Budget",ownerEmail:u.owner_email||null})}return{budgets:r,pendingInvites:a}}function O4(t,e,n){return Xl({queryKey:t?Ce.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?k4(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function N4(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function P4(){const t=await Pt("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=N4(n.data.items),a=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:a})})}return{items:e}}function B4(t){return Xl({queryKey:Ce.feedback(),queryFn:P4,enabled:t?.enabled!==!1})}const Rt="__NO_CATEGORY__",ba="No Category";function Ze(t){return t===Rt}const Tt="__NO_ACCOUNT__",Ps="No Account";function Le(t){return t===Tt}const O0={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function N0(t,e){const n=L4(t),r=U4(t.category_balances,e.categoryEndBalances,n),a=z4(t,e.accountEndBalances);return{...t,previous_month_income:e.totalIncome,category_balances:r,account_balances:a,updated_at:new Date().toISOString()}}function L4(t){const e={};for(const n of t.transfers||[])Ze(n.from_category_id)||(e[n.from_category_id]=(e[n.from_category_id]||0)-n.amount),Ze(n.to_category_id)||(e[n.to_category_id]=(e[n.to_category_id]||0)+n.amount);for(const n of t.adjustments||[])Ze(n.category_id)||(e[n.category_id]=(e[n.category_id]||0)+n.amount);for(const n of Object.keys(e))e[n]=we(e[n]);return e}function U4(t,e,n){const r=new Map;for(const u of t)Ze(u.category_id)||r.set(u.category_id,u);const a=new Set;for(const u of t)Ze(u.category_id)||a.add(u.category_id);for(const u of Object.keys(e))Ze(u)||a.add(u);for(const u of Object.keys(n))Ze(u)||a.add(u);const o=[];for(const u of a){const h=r.get(u),f=we(e[u]??0),m=we(h?.allocated??0),g=we(h?.spent??0),_=we(n[u]??0);o.push({category_id:u,start_balance:f,allocated:m,spent:g,end_balance:we(f+m+g+_)})}return o}function z4(t,e){const n=new Set;for(const a of t.income||[])Le(a.account_id)||n.add(a.account_id);for(const a of t.expenses||[])Le(a.account_id)||n.add(a.account_id);for(const a of t.transfers||[])Le(a.from_account_id)||n.add(a.from_account_id),Le(a.to_account_id)||n.add(a.to_account_id);for(const a of t.adjustments||[])Le(a.account_id)||n.add(a.account_id);for(const a of Object.keys(e))Le(a)||n.add(a);for(const a of t.account_balances||[])Le(a.account_id)||n.add(a.account_id);const r=[];for(const a of n){const o=we(e[a]??0),u=we((t.income||[]).filter(v=>v.account_id===a).reduce((v,x)=>v+x.amount,0)),h=we((t.expenses||[]).filter(v=>v.account_id===a).reduce((v,x)=>v+x.amount,0)),f=we((t.transfers||[]).filter(v=>v.from_account_id===a).reduce((v,x)=>v-x.amount,0)),m=we((t.transfers||[]).filter(v=>v.to_account_id===a).reduce((v,x)=>v+x.amount,0)),g=we((t.adjustments||[]).filter(v=>v.account_id===a).reduce((v,x)=>v+x.amount,0)),_=we(u+h+f+m+g);r.push({account_id:a,start_balance:o,income:u,expenses:h,net_change:_,end_balance:we(o+_)})}return r}function kf(t){const e={},n={};for(const r of t.category_balances||[])Ze(r.category_id)||(e[r.category_id]=we(r.end_balance));for(const r of t.account_balances||[])Le(r.account_id)||(n[r.account_id]=we(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:we(t.total_income)}}const F4=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function V4(t){return{year:parseInt(t.slice(0,4),10),month:parseInt(t.slice(4,6),10)}}function pT(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}function $4(t){return Object.entries(t).filter(([,e])=>e.needs_recalculation).map(([e])=>e).sort()}function H4(t){return Object.keys(t).sort()}async function q4(t,e){const{year:n,month:r}=V4(e),a=gr(t,n,r),{exists:o,data:u}=await et("months",a,`[recalc] fetching month ${n}/${r}`);return!o||!u?null:{id:a,budget_id:t,year_month_ordinal:u.year_month_ordinal??At(n,r),year:u.year??n,month:u.month??r,income:u.income||[],total_income:u.total_income??0,previous_month_income:u.previous_month_income??0,expenses:u.expenses||[],total_expenses:u.total_expenses??0,transfers:u.transfers||[],adjustments:u.adjustments||[],account_balances:u.account_balances||[],category_balances:u.category_balances||[],are_allocations_finalized:u.are_allocations_finalized??!1,created_at:u.created_at,updated_at:u.updated_at}}async function G4(t,e,n){n?.(0,e.length);const r=await Promise.all(e.map(a=>q4(t,a)));return n?.(e.length,e.length),r.filter(a=>a!==null)}function P0(t){const e={};for(const n of Object.keys(t))e[n]={needs_recalculation:!1};return e}function gT(t,e,n){const r=Object.entries(t).reduce((o,[,u])=>{const h=u.account_group_id?n[u.account_group_id]:void 0,f=h?.on_budget!==void 0?h.on_budget:u.on_budget!==!1,m=h?.is_active!==void 0?h.is_active:u.is_active!==!1;return f&&m?o+(u.balance??0):o},0),a=Object.values(e).reduce((o,u)=>{const h=u.balance??0;return o+(h>0?h:0)},0);return we(r-a)}async function yT(t,e,n,r){const{exists:a,data:o}=await et("budgets",t,"[recalc] reading budget for balance update");if(!a||!o)return;const u={...o.accounts};for(const[g,_]of Object.entries(e))u[g]&&(u[g]={...u[g],balance:we(_)});const h={...o.categories};for(const[g,_]of Object.entries(n))h[g]&&(h[g]={...h[g],balance:we(_)});const f=P0(r),m=gT(u,h,o.account_groups||{});await Dt("budgets",t,{...o,accounts:u,categories:h,total_available:m,is_needs_recalculation:!1,month_map:f,updated_at:new Date().toISOString()},"[recalc] saving balances and clearing flags"),W4(t,u,h,m,f)}function Q4(t,e){const n=Oe.getQueryData(Ce.budget(t));n&&Oe.setQueryData(Ce.budget(t),{...n,isNeedsRecalculation:!1,monthMap:e,budget:{...n.budget,is_needs_recalculation:!1,month_map:e}})}function W4(t,e,n,r,a){const o=Oe.getQueryData(Ce.budget(t));if(o){const u={};for(const[f,m]of Object.entries(o.accounts)){const g=e[f];u[f]=g?{...m,balance:g.balance??m.balance}:m}const h={};for(const[f,m]of Object.entries(o.categories)){const g=n[f];h[f]=g?{...m,balance:g.balance??m.balance}:m}Oe.setQueryData(Ce.budget(t),{...o,accounts:u,categories:h,isNeedsRecalculation:!1,monthMap:a,budget:{...o.budget,accounts:e,categories:n,total_available:r,is_needs_recalculation:!1,month_map:a}})}}async function xw(t,e){const{exists:n,data:r}=await et("budgets",t,"[recalc] reading budget to clear flags");if(!n||!r)return;const a=P0(e);await Dt("budgets",t,{...r,total_available:gT(r.accounts||{},r.categories||{},r.account_groups||{}),is_needs_recalculation:!1,month_map:a,updated_at:new Date().toISOString()},"[recalc] clearing flags"),Q4(t,a)}const Vg=new Map;async function gm(t,e={}){const n=Vg.get(t);if(n)return n;const r=K4(t,e);Vg.set(t,r);try{return await r}finally{Vg.delete(t)}}async function K4(t,e={}){const{onProgress:n}=e;n?.({phase:"reading-budget",monthsProcessed:0,totalMonths:0,percentComplete:5});const{exists:r,data:a}=await et("budgets",t,"[recalc] reading budget for month_map");if(!r||!a)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const o=pT(a.month_map),u=$4(o);if(u.length===0&&!a.is_needs_recalculation)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const h=H4(o),f=u.length>0?u[0]:null;if(!f)return await xw(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const m=h.indexOf(f),g=m>0,_=g?h.slice(m-1):h.slice(m),v=g?_.length-1:_.length;n?.({phase:"fetching-months",monthsFetched:0,totalMonthsToFetch:_.length,monthsProcessed:0,totalMonths:v,percentComplete:10});const x=await G4(t,_,(D,A)=>{n?.({phase:"fetching-months",monthsFetched:D,totalMonthsToFetch:A,monthsProcessed:0,totalMonths:v,percentComplete:D===0?10:30})});if(x.length===0)return await xw(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const S=g?1:0,E=x.length-1,T=E-S+1;let I=O0;g&&x.length>0&&(I=kf(x[0]));const j=[];let M=0;for(let D=S;D<=E;D++){const A=x[D],N=`${F4[A.month-1]} ${A.year}`;n?.({phase:"recalculating",currentMonth:N,monthsProcessed:M,totalMonths:T,percentComplete:Math.round(30+M/T*40)});const P=N0(A,I);j.push(P),I=kf(P),M++}n?.({phase:"saving",monthsProcessed:M,totalMonths:T,percentComplete:75});const Q=j.map(D=>({collectionPath:"months",docId:gr(t,D.year,D.month),data:D}));await mm(Q,`[recalc] batch write ${j.length} months`);for(const D of j)Oe.setQueryData(Ce.month(t,D.year,D.month),{month:D});n?.({phase:"saving",monthsProcessed:M,totalMonths:T,percentComplete:92});const H=I.accountEndBalances,W=I.categoryEndBalances;return await yT(t,H,W,o),n?.({phase:"complete",monthsProcessed:M,totalMonths:T,percentComplete:100}),{monthsRecalculated:M,budgetUpdated:!0,finalAccountBalances:H}}async function Y4(t,e,n){const r=At(e,n);if(w4(t,r))return{markedCount:0,budgetUpdated:!1};const{exists:a,data:o}=await et("budgets",t,"reading budget for month_map update");if(!a||!o)return console.warn(`[markMonthsNeedRecalculation] Budget ${t} not found`),{markedCount:0,budgetUpdated:!1};const h={...o.month_map||{}},f=S4();for(const v of f)h[v]||(h[v]={needs_recalculation:!1});let m=0;for(const v of f)v>=r&&(h[v]?.needs_recalculation||(h[v]={needs_recalculation:!0},m++));const g=o.is_needs_recalculation===!0;if(m===0&&g)return{markedCount:0,budgetUpdated:!1};const _=h;return E4(t,r,_),await zl("budgets",t,{is_needs_recalculation:!0,month_map:_,updated_at:new Date().toISOString()},`marking budget and ${m} future months as needing recalculation`),{markedCount:m,budgetUpdated:!0}}async function X4(t,e){return Oe.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await et("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function Iy(t,e,n){const r=await y4(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function J4(t,e,n,r){const a={};e.forEach(v=>{a[v]=0});const o=await Iy(t,n,r);if(o?.category_balances){for(const v of o.category_balances)e.includes(v.category_id)&&(a[v.category_id]=v.end_balance);return a}const u={};e.forEach(v=>{u[v]=0});const h=[];o&&h.push(o);let f=n,m=r,g=!1;const _=120;for(let v=0;v<_&&!g;v++){const x=Df(f,m);f=x.year,m=x.month;const S=await Iy(t,f,m);if(!S)g=!0;else if(S.category_balances){g=!0;for(const E of S.category_balances)e.includes(E.category_id)&&(u[E.category_id]=E.end_balance)}else h.push(S)}h.reverse(),Object.assign(a,u);for(const v of h){if(v.are_allocations_finalized&&v.category_balances)for(const x of v.category_balances)e.includes(x.category_id)&&(a[x.category_id]=(a[x.category_id]||0)+x.allocated);if(v.expenses)for(const x of v.expenses)e.includes(x.category_id)&&(a[x.category_id]=(a[x.category_id]||0)-x.amount)}return a}async function Z4(t,e,n,r,a){const o={...n};let u=r,h=a;const f=24;for(let m=0;m<f;m++){const g=p4(u,h);u=g.year,h=g.month;const _=await Iy(t,u,h);if(!_)break;if(_.are_allocations_finalized&&_.category_balances)for(const v of _.category_balances)e.includes(v.category_id)&&(o[v.category_id]=(o[v.category_id]||0)+v.allocated);if(_.expenses)for(const v of _.expenses)e.includes(v.category_id)&&(o[v.category_id]=(o[v.category_id]||0)-v.amount)}return o}async function Sw(t,e,n,r){const a=await J4(t,e,n,r),o=await Z4(t,e,a,n,r);return{current:a,total:o}}async function _T(t,e,n){const r=gr(t,e.year,e.month);await Dt("months",r,e,`writeMonthData: ${n}`)}async function bT(t,e,n){await Y4(t,e,n)}async function rd(t){const{budgetId:e,month:n,description:r,cascadeRecalculation:a=!0}=t;await _T(e,n,r||`${n.year}/${n.month}`),Oe.setQueryData(Ce.month(e,n.year,n.month),{month:n}),a&&await bT(e,n.year,n.month)}function rs(){const t=So();return{writeData:t0({mutationFn:async({budgetId:n,month:r,description:a,cascadeRecalculation:o=!0})=>(await _T(n,r,a||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,cascadeRecalculation:o}),onMutate:async({budgetId:n,month:r})=>{const a=Ce.month(n,r.year,r.month);await t.cancelQueries({queryKey:a});const o=t.getQueryData(a);return t.setQueryData(a,{month:r}),{oldMonthQueryData:o,monthKey:a}},onSuccess:async({budgetId:n,year:r,month:a,cascadeRecalculation:o})=>{o&&await bT(n,r,a)},onError:(n,r,a)=>{a?.oldMonthQueryData&&t.setQueryData(a.monthKey,a.oldMonthQueryData)}})}}function eB(t,e,n,r){const a={};t.category_balances&&t.category_balances.forEach(u=>{a[u.category_id]=u});const o=t.expenses??[];return e.map(u=>{const h=a[u],f=we(h?.start_balance??0),m=we(n[u]??0),g=we(o.filter(_=>_.category_id===u).reduce((_,v)=>_+v.amount,0));return{category_id:u,start_balance:f,allocated:m,spent:g,end_balance:we(f+m+g)}})}function tB(){const{writeData:t}=rs();return{saveDraftAllocations:async(n,r,a,o)=>{const u=await zn(n,r,a,"save draft allocations"),h=u.category_balances.map(m=>({...m,allocated:o[m.category_id]??m.allocated})),f={...u,category_balances:h,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:f,cascadeRecalculation:!1}),{updatedMonth:f}},isPending:t.isPending,isError:t.isError,error:t.error}}function nB(){const{writeData:t}=rs();return{finalizeAllocations:async n=>{const{budgetId:r,year:a,month:o,allocations:u,onProgress:h}=n;h?.({phase:"saving",message:"Saving allocations..."});const f=await zn(r,a,o,"finalize allocations"),m=f.category_balances?.map(x=>x.category_id)??[],g=m.length>0?m:Object.keys(u),_=g.length>0?eB(f,g,u):f.category_balances,v={...f,category_balances:_,are_allocations_finalized:!0,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:r,month:v,description:"finalize allocations"}),h?.({phase:"recalculating",message:"Recalculating month balances..."}),await gm(r,{triggeringMonthOrdinal:`${a}${String(o).padStart(2,"0")}`,onProgress:x=>{let S="Recalculating balances...";x.phase==="fetching-months"?S=`Loading month data (${x.monthsFetched}/${x.totalMonthsToFetch})...`:x.phase==="recalculating"&&x.currentMonth?S=`Recalculating ${x.currentMonth}...`:x.phase==="saving"&&(S="Saving recalculated balances..."),h?.({phase:"recalculating",message:S,recalcProgress:x})}}),await Oe.refetchQueries({queryKey:Ce.month(r,a,o)}),await Oe.refetchQueries({queryKey:Ce.budget(r)}),h?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:v}},isPending:t.isPending,isError:t.isError,error:t.error}}function vT(){const{writeData:t}=rs();return{deleteAllocations:async n=>{const{budgetId:r,year:a,month:o,onProgress:u}=n;u?.({phase:"saving",message:"Deleting allocations..."});const h=await zn(r,a,o,"delete allocations"),f=h.category_balances.map(g=>({...g,allocated:0,end_balance:g.start_balance-g.spent})),m={...h,category_balances:f,are_allocations_finalized:!1,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:r,month:m,description:"delete allocations"}),u?.({phase:"recalculating",message:"Recalculating month balances..."}),await gm(r,{triggeringMonthOrdinal:`${a}${String(o).padStart(2,"0")}`,onProgress:g=>{let _="Recalculating balances...";g.phase==="fetching-months"?_=`Loading month data (${g.monthsFetched}/${g.totalMonthsToFetch})...`:g.phase==="recalculating"&&g.currentMonth?_=`Recalculating ${g.currentMonth}...`:g.phase==="saving"&&(_="Saving recalculated balances..."),u?.({phase:"recalculating",message:_,recalcProgress:g})}}),await Oe.refetchQueries({queryKey:Ce.month(r,a,o)}),await Oe.refetchQueries({queryKey:Ce.budget(r)}),u?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:m}},isPending:t.isPending,isError:t.isError,error:t.error}}function Fn(t){if(typeof t.optimisticUpdate!="function")throw new Error("[createOptimisticMutation] optimisticUpdate is REQUIRED. All mutations must define how they optimistically update the cache.");if(typeof t.mutationFn!="function")throw new Error("[createOptimisticMutation] mutationFn is REQUIRED. All mutations must define the actual mutation function.");return function(){const[n,r]=C.useState(!1),[a,o]=C.useState(null),u=C.useCallback(()=>{o(null)},[]),h=C.useCallback(async m=>{o(null),r(!0);const{cacheKey:g,transform:_}=t.optimisticUpdate(m),v=Oe.getQueryData(g),x=_(v);Oe.setQueryData(g,x);try{const S=await t.mutationFn(m);return t.onSuccess?.(S,m),r(!1),S}catch(S){v!==void 0?Oe.setQueryData(g,v):Oe.removeQueries({queryKey:g});const E=S instanceof Error?S:new Error("Mutation failed");throw o(E),r(!1),t.onError?.(E,m),E}},[]);return{mutate:C.useCallback(m=>h(m).catch(()=>{}),[h]),mutateAsync:h,isPending:n,isError:!!a,error:a,reset:u}}}async function ym(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const a=[...n,r].sort((o,u)=>o.toLowerCase().localeCompare(u.toLowerCase()));return await Dt("payees",t,{budget_id:t,payees:a,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),a}function yn(t){const e=t.income||[],n=t.expenses||[],r=we(e.reduce((h,f)=>h+f.amount,0)),a=we(n.reduce((h,f)=>h+f.amount,0)),o=rB(t),u=sB(t);return{...t,total_income:r,total_expenses:a,account_balances:o,category_balances:u}}function rB(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],a=t.adjustments||[],o=t.account_balances||[],u=new Map;for(const m of o)Le(m.account_id)||u.set(m.account_id,m);const h=new Set;for(const m of e)Le(m.account_id)||h.add(m.account_id);for(const m of n)Le(m.account_id)||h.add(m.account_id);for(const m of r)Le(m.from_account_id)||h.add(m.from_account_id),Le(m.to_account_id)||h.add(m.to_account_id);for(const m of a)Le(m.account_id)||h.add(m.account_id);for(const m of o)Le(m.account_id)||h.add(m.account_id);const f=[];for(const m of h){const g=u.get(m),_=we(g?.start_balance??0),v=we(e.filter(j=>j.account_id===m).reduce((j,M)=>j+M.amount,0)),x=we(n.filter(j=>j.account_id===m).reduce((j,M)=>j+M.amount,0)),S=we(r.filter(j=>j.from_account_id===m).reduce((j,M)=>j-M.amount,0)),E=we(r.filter(j=>j.to_account_id===m).reduce((j,M)=>j+M.amount,0)),T=we(a.filter(j=>j.account_id===m).reduce((j,M)=>j+M.amount,0)),I=we(v+x+S+E+T);f.push({account_id:m,start_balance:_,income:v,expenses:x,net_change:I,end_balance:we(_+I)})}return f}function sB(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],a=t.category_balances||[],o=new Map;for(const g of a)Ze(g.category_id)||o.set(g.category_id,g);const u=new Map;for(const g of e){if(Ze(g.category_id))continue;const _=u.get(g.category_id)||0;u.set(g.category_id,_+g.amount)}const h=new Map;for(const g of n){if(!Ze(g.from_category_id)){const _=h.get(g.from_category_id)||0;h.set(g.from_category_id,_-g.amount)}if(!Ze(g.to_category_id)){const _=h.get(g.to_category_id)||0;h.set(g.to_category_id,_+g.amount)}}for(const g of r)if(!Ze(g.category_id)){const _=h.get(g.category_id)||0;h.set(g.category_id,_+g.amount)}const f=new Set;for(const g of a)Ze(g.category_id)||f.add(g.category_id);for(const g of e)Ze(g.category_id)||f.add(g.category_id);for(const g of n)Ze(g.from_category_id)||f.add(g.from_category_id),Ze(g.to_category_id)||f.add(g.to_category_id);for(const g of r)Ze(g.category_id)||f.add(g.category_id);const m=[];for(const g of f){const _=o.get(g),v=we(u.get(g)??0),x=we(h.get(g)??0);if(_){const S=we(_.start_balance),E=we(_.allocated);m.push({..._,start_balance:S,allocated:E,spent:v,end_balance:we(S+E+v+x)})}else m.push({category_id:g,start_balance:0,allocated:0,spent:v,end_balance:we(v+x)})}return m}function iB(t,e){let n=0;for(const{accountId:r,delta:a}of e){const o=t.accounts[r];if(!o)continue;const u=o.account_group_id?t.accountGroups[o.account_group_id]:void 0,h=u?.on_budget!==void 0?u.on_budget:o.on_budget!==!1,f=u?.is_active!==void 0?u.is_active:o.is_active!==!1;h&&f&&(n+=a)}return n}async function qn(t,e){if(e.length===0)return;const n=e.filter(h=>h.delta!==0);if(n.length===0)return;const r=Oe.getQueryData(Ce.budget(t));if(!r)return;const a=iB(r,n),o={...r.accounts};for(const{accountId:h,delta:f}of n)o[h]&&(o[h]={...o[h],balance:o[h].balance+f});const u=r.budget?{...r.budget,total_available:r.budget.total_available+a}:r.budget;Oe.setQueryData(Ce.budget(t),{...r,accounts:o,budget:u})}function ww(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}const aB=Fn({optimisticUpdate:t=>{const{budgetId:e,year:n,month:r}=t,a=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;t._incomeId=a;const o=ww(t,a);return{cacheKey:Ce.month(e,n,r),transform:u=>u?.month?{month:yn({...u.month,income:[...u.month.income||[],o],updated_at:new Date().toISOString()})}:u}},mutationFn:async t=>{const{budgetId:e,year:n,month:r,accountId:a,payee:o,amount:u,_incomeId:h}=t,m=ww(t,h),g=await zn(e,n,r,"add income"),_=[...g.income||[],m],v=yn({...g,income:_,updated_at:new Date().toISOString()});if(await rd({budgetId:e,month:v,description:"add income"}),await qn(e,[{accountId:a,delta:u}]),o?.trim()){const x=Oe.getQueryData(Ce.payees(e))||[],S=await ym(e,o,x);S&&Oe.setQueryData(Ce.payees(e),S)}return{updatedMonth:v,newIncome:m}}});function oB(){const{mutateAsync:t,isPending:e,isError:n,error:r}=aB();return{addIncome:async(o,u,h,f,m,g,_,v)=>t({budgetId:o,year:u,month:h,amount:f,accountId:m,date:g,payee:_,description:v}),isPending:e,isError:n,error:r}}function lB(t,e,n,r,a,o){if(!t)return!0;const u=t.payee||void 0,h=a?.trim()||void 0,f=t.description||void 0,m=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||h!==u||m!==f}function cB(){const t=So(),{writeData:e}=rs();return{updateIncome:async(r,a,o,u,h,f,m,g,_)=>{const v=await zn(r,a,o,"update income"),x=(v.income||[]).find(M=>M.id===u);if(!lB(x,h,f,m,g,_))return{updatedMonth:v,noOp:!0};const S=x?.amount??0,E=x?.account_id??f,T={id:u,amount:h,account_id:f,date:m,created_at:(v.income||[]).find(M=>M.id===u)?.created_at||new Date().toISOString()};g?.trim()&&(T.payee=g.trim()),_&&(T.description=_);const I=(v.income||[]).map(M=>M.id===u?T:M),j=yn({...v,income:I,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:r,month:j,description:"update income"}),E===f?await qn(r,[{accountId:f,delta:h-S}]):await qn(r,[{accountId:E,delta:-S},{accountId:f,delta:h}]),g?.trim()){const M=t.getQueryData(Ce.payees(r))||[],Q=await ym(r,g,M);Q&&t.setQueryData(Ce.payees(r),Q)}return{updatedMonth:j}},isPending:e.isPending,isError:e.isError,error:e.error}}function uB(){const{writeData:t}=rs();return{deleteIncome:async(n,r,a,o)=>{const u=await zn(n,r,a,"delete income"),h=(u.income||[]).find(v=>v.id===o),f=h?.amount??0,m=h?.account_id,g=(u.income||[]).filter(v=>v.id!==o),_=yn({...u,income:g,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:_,description:"delete income"}),m&&f>0&&await qn(n,[{accountId:m,delta:-f}]),{updatedMonth:_}},isPending:t.isPending,isError:t.isError,error:t.error}}function Ew(t,e){const n={id:e,amount:t.amount,category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}const dB=Fn({optimisticUpdate:t=>{const{budgetId:e,year:n,month:r}=t,a=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;t._expenseId=a;const o=Ew(t,a);return{cacheKey:Ce.month(e,n,r),transform:u=>u?.month?{month:yn({...u.month,expenses:[...u.month.expenses||[],o],updated_at:new Date().toISOString()})}:u}},mutationFn:async t=>{const{budgetId:e,year:n,month:r,accountId:a,payee:o,amount:u,_expenseId:h}=t,m=Ew(t,h),g=await zn(e,n,r,"add expense"),_=[...g.expenses||[],m],v=yn({...g,expenses:_,updated_at:new Date().toISOString()});if(await rd({budgetId:e,month:v,description:"add expense"}),await qn(e,[{accountId:a,delta:u}]),o?.trim()){const x=Oe.getQueryData(Ce.payees(e))||[],S=await ym(e,o,x);S&&Oe.setQueryData(Ce.payees(e),S)}return{updatedMonth:v,newExpense:m}}});function hB(){const{mutateAsync:t,isPending:e,isError:n,error:r}=dB();return{addExpense:async(o,u,h,f,m,g,_,v,x,S)=>t({budgetId:o,year:u,month:h,amount:f,categoryId:m,accountId:g,date:_,payee:v,description:x,cleared:S}),isPending:e,isError:n,error:r}}function fB(t,e,n,r,a,o,u,h){if(!t)return!0;const f=t.payee||void 0,m=o?.trim()||void 0,g=t.description||void 0,_=u||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||a!==t.date||m!==f||_!==g||h!==t.cleared}function mB(){const t=So(),{writeData:e}=rs();return{updateExpense:async(r,a,o,u,h,f,m,g,_,v,x)=>{const S=await zn(r,a,o,"update expense"),E=(S.expenses||[]).find(H=>H.id===u);if(!fB(E,h,f,m,g,_,v,x))return{updatedMonth:S,noOp:!0};const T=E?.amount??0,I=E?.account_id??m,j={id:u,amount:h,category_id:f,account_id:m,date:g,created_at:S.expenses?.find(H=>H.id===u)?.created_at||new Date().toISOString()};_?.trim()&&(j.payee=_.trim()),v&&(j.description=v),x!==void 0&&(j.cleared=x);const M=(S.expenses||[]).map(H=>H.id===u?j:H),Q=yn({...S,expenses:M,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:r,month:Q,description:"update expense"}),I===m?await qn(r,[{accountId:m,delta:h-T}]):await qn(r,[{accountId:I,delta:-T},{accountId:m,delta:h}]),_?.trim()){const H=t.getQueryData(Ce.payees(r))||[],W=await ym(r,_,H);W&&t.setQueryData(Ce.payees(r),W)}return{updatedMonth:Q}},isPending:e.isPending,isError:e.isError,error:e.error}}function pB(){const{writeData:t}=rs();return{deleteExpense:async(n,r,a,o)=>{const u=await zn(n,r,a,"delete expense"),h=(u.expenses||[]).find(v=>v.id===o),f=h?.amount??0,m=h?.account_id,g=(u.expenses||[]).filter(v=>v.id!==o),_=yn({...u,expenses:g,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:_,description:"delete expense"}),m&&f!==0&&await qn(n,[{accountId:m,delta:-f}]),{updatedMonth:_}},isPending:t.isPending,isError:t.isError,error:t.error}}function Cw(t,e){const n={id:e,amount:t.amount,from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}const gB=Fn({optimisticUpdate:t=>{const{budgetId:e,year:n,month:r}=t,a=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;t._transferId=a;const o=Cw(t,a);return{cacheKey:Ce.month(e,n,r),transform:u=>u?.month?{month:yn({...u.month,transfers:[...u.month.transfers||[],o],updated_at:new Date().toISOString()})}:u}},mutationFn:async t=>{const{budgetId:e,year:n,month:r,fromAccountId:a,toAccountId:o,amount:u,_transferId:h}=t,m=Cw(t,h),g=await zn(e,n,r,"add transfer"),_=[...g.transfers||[],m],v=yn({...g,transfers:_,updated_at:new Date().toISOString()});await rd({budgetId:e,month:v,description:"add transfer"});const x=[];return Le(a)||x.push({accountId:a,delta:-u}),Le(o)||x.push({accountId:o,delta:u}),x.length>0&&await qn(e,x),{updatedMonth:v,newTransfer:m}}});function yB(){const{mutateAsync:t,isPending:e,isError:n,error:r}=gB();return{addTransfer:async(o,u,h,f,m,g,_,v,x,S,E)=>t({budgetId:o,year:u,month:h,amount:f,fromAccountId:m,toAccountId:g,fromCategoryId:_,toCategoryId:v,date:x,description:S,cleared:E}),isPending:e,isError:n,error:r}}function _B(t,e,n,r,a,o,u,h,f){if(!t)return!0;const m=t.description||void 0,g=h||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||a!==t.from_category_id||o!==t.to_category_id||u!==t.date||g!==m||f!==t.cleared}function bB(){const{writeData:t}=rs();return{updateTransfer:async(n,r,a,o,u,h,f,m,g,_,v,x)=>{const S=await zn(n,r,a,"update transfer"),E=(S.transfers||[]).find(D=>D.id===o);if(!_B(E,u,h,f,m,g,_,v,x))return{updatedMonth:S,noOp:!0};const T=E?.amount??0,I=E?.from_account_id??h,j=E?.to_account_id??f,M={id:o,amount:u,from_account_id:h,to_account_id:f,from_category_id:m,to_category_id:g,date:_,created_at:S.transfers?.find(D=>D.id===o)?.created_at||new Date().toISOString()};v&&(M.description=v),x!==void 0&&(M.cleared=x);const Q=(S.transfers||[]).map(D=>D.id===o?M:D),H=yn({...S,transfers:Q,updated_at:new Date().toISOString()});await t.mutateAsync({budgetId:n,month:H,description:"update transfer"});const W=[];return Le(I)||W.push({accountId:I,delta:T}),Le(j)||W.push({accountId:j,delta:-T}),Le(h)||W.push({accountId:h,delta:-u}),Le(f)||W.push({accountId:f,delta:u}),W.length>0&&await qn(n,W),{updatedMonth:H}},isPending:t.isPending,isError:t.isError,error:t.error}}function vB(){const{writeData:t}=rs();return{deleteTransfer:async(n,r,a,o)=>{const u=await zn(n,r,a,"delete transfer"),h=(u.transfers||[]).find(S=>S.id===o),f=h?.amount??0,m=h?.from_account_id,g=h?.to_account_id,_=(u.transfers||[]).filter(S=>S.id!==o),v=yn({...u,transfers:_,updated_at:new Date().toISOString()});await t.mutateAsync({budgetId:n,month:v,description:"delete transfer"});const x=[];return m&&!Le(m)&&f!==0&&x.push({accountId:m,delta:f}),g&&!Le(g)&&f!==0&&x.push({accountId:g,delta:-f}),x.length>0&&await qn(n,x),{updatedMonth:v}},isPending:t.isPending,isError:t.isError,error:t.error}}function Tw(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}const xB=Fn({optimisticUpdate:t=>{const{budgetId:e,year:n,month:r}=t,a=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;t._adjustmentId=a;const o=Tw(t,a);return{cacheKey:Ce.month(e,n,r),transform:u=>u?.month?{month:yn({...u.month,adjustments:[...u.month.adjustments||[],o],updated_at:new Date().toISOString()})}:u}},mutationFn:async t=>{const{budgetId:e,year:n,month:r,accountId:a,amount:o,_adjustmentId:u}=t,f=Tw(t,u),m=await zn(e,n,r,"add adjustment"),g=[...m.adjustments||[],f],_=yn({...m,adjustments:g,updated_at:new Date().toISOString()});return await rd({budgetId:e,month:_,description:"add adjustment"}),Le(a)||await qn(e,[{accountId:a,delta:o}]),{updatedMonth:_,newAdjustment:f}}});function SB(){const{mutateAsync:t,isPending:e,isError:n,error:r}=xB();return{addAdjustment:async(o,u,h,f,m,g,_,v,x,S)=>t({budgetId:o,year:u,month:h,amount:f,accountId:m,categoryId:g,date:_,payee:v,description:x,cleared:S}),isPending:e,isError:n,error:r}}function wB(t,e,n,r,a,o,u,h){if(!t)return!0;const f=t.payee||void 0,m=o?.trim()||void 0,g=t.description||void 0,_=u||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||a!==t.date||m!==f||_!==g||h!==t.cleared}function EB(){const{writeData:t}=rs();return{updateAdjustment:async(n,r,a,o,u,h,f,m,g,_,v)=>{const x=await zn(n,r,a,"update adjustment"),S=(x.adjustments||[]).find(Q=>Q.id===o);if(!wB(S,u,h,f,m,g,_,v))return{updatedMonth:x,noOp:!0};const E=S?.amount??0,T=S?.account_id??h,I={id:o,amount:u,account_id:h,category_id:f,date:m,created_at:x.adjustments?.find(Q=>Q.id===o)?.created_at||new Date().toISOString()};g?.trim()&&(I.payee=g.trim()),_&&(I.description=_),v!==void 0&&(I.cleared=v);const j=(x.adjustments||[]).map(Q=>Q.id===o?I:Q),M=yn({...x,adjustments:j,updated_at:new Date().toISOString()});if(await t.mutateAsync({budgetId:n,month:M,description:"update adjustment"}),!Le(T)&&T===h)await qn(n,[{accountId:h,delta:u-E}]);else{const Q=[];Le(T)||Q.push({accountId:T,delta:-E}),Le(h)||Q.push({accountId:h,delta:u}),Q.length>0&&await qn(n,Q)}return{updatedMonth:M}},isPending:t.isPending,isError:t.isError,error:t.error}}function CB(){const{writeData:t}=rs();return{deleteAdjustment:async(n,r,a,o)=>{const u=await zn(n,r,a,"delete adjustment"),h=(u.adjustments||[]).find(v=>v.id===o),f=h?.amount??0,m=h?.account_id,g=(u.adjustments||[]).filter(v=>v.id!==o),_=yn({...u,adjustments:g,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:_,description:"delete adjustment"}),m&&!Le(m)&&f!==0&&await qn(n,[{accountId:m,delta:-f}]),{updatedMonth:_}},isPending:t.isPending,isError:t.isError,error:t.error}}const TB={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},xT=C.createContext(TB);function AB({children:t}){const n=Sa().get_current_firebase_user(),[r,a]=C.useState(null),[o,u]=C.useState(new Date().getFullYear()),[h,f]=C.useState(new Date().getMonth()+1),[m,g]=C.useState("categories"),[_,v]=C.useState("categories"),[x,S]=C.useState("budget"),[E,T]=C.useState("Budget"),I=C.useCallback(z=>{T(q=>q===z?q:z)},[]),[j,M]=C.useState(!1),[Q,H]=C.useState(!1),W=M4(n?.uid||null,n?.email||null),D=W.data&&W.data.budget_ids.length===0,A=O4(n?.uid||null,W.data||null,{enabled:!!n?.uid&&!!W.data&&D}),N=W.data?.permission_flags?.is_admin===!0,P=W.data?.permission_flags?.is_test===!0,L=A.data?.pendingInvites||[],B=A.data?.budgets||[],O=L.length>0;C.useEffect(()=>{if(!n||j||W.isLoading)return;const z=W.data;if(!(!z&&!W.isError))if(z&&z.budget_ids.length>0)a(z.budget_ids[0]),H(!1),M(!0);else{if(A.isLoading)return;const q=A.data;q?.pendingInvites&&q.pendingInvites.length>0?H(!1):H(!0),M(!0)}},[n,j,W.data,W.isLoading,W.isError,A.data,A.isLoading]);const G=C.useCallback(()=>{h===1?(u(z=>z-1),f(12)):f(z=>z-1)},[h]),Y=C.useCallback(()=>{h===12?(u(z=>z+1),f(1)):f(z=>z+1)},[h]),U=C.useCallback(async z=>{(z?.force||!A.data)&&await A.refetch()},[A]),F=C.useCallback(z=>{a(z),H(!1)},[]),K=C.useCallback(async z=>{if(!n)return null;try{const q=await X4(z,n.uid);return q&&q.isInvited&&!q.hasAccepted?{budgetId:z,budgetName:q.budgetName,ownerEmail:q.ownerEmail}:null}catch(q){return console.error("[BudgetContext] Error checking budget invite:",q),null}},[n]),Z=C.useCallback(()=>{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")},[]),re={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:h,lastActiveTab:m,lastSettingsTab:_,lastAdminTab:x,setSelectedBudgetId:a,setCurrentYear:u,setCurrentMonthNumber:f,setLastActiveTab:g,setLastSettingsTab:v,setLastAdminTab:S,pageTitle:E,setPageTitle:I,isInitialized:j,needsFirstBudget:Q,goToPreviousMonth:G,goToNextMonth:Y,pendingInvites:L,hasPendingInvites:O,accessibleBudgets:B,isAdmin:N,isTest:P,loadAccessibleBudgets:U,switchToBudget:F,checkBudgetInvite:K,clearCache:Z};return c.jsx(xT.Provider,{value:re,children:t})}function zt(){const t=C.useContext(xT);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const jB=function(){},RB={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:jB},sd=C.createContext(RB);function Ls(t=x4){const[e,n]=C.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return C.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function a(u){n(u.matches)}a(r),r.addEventListener("change",a);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",a),window.removeEventListener("resize",o)}},[t]),e}function ST(){const[t,e]=C.useState(()=>typeof window>"u"?1200:window.innerWidth);return C.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=oo.wide,isMedium:t>=oo.tablet&&t<oo.wide,isNarrowMedium:t>=oo.mobile&&t<oo.tablet,isMobile:t<oo.mobile}}async function _m(t,e){const{exists:n,data:r}=await et("budgets",t,`PRE-EDIT-READ: ${e}`);if(!n||!r)throw new Error("Budget not found");return r}async function Ca(t){const{budgetId:e,updates:n,description:r}=t,o={...await _m(e,r),...n};await Dt("budgets",e,o,r);const u=Oe.getQueryData(Ce.budget(e));u&&Oe.setQueryData(Ce.budget(e),{...u,budget:{...u.budget,...n}})}const IB=Fn({optimisticUpdate:t=>{const{budgetId:e,accounts:n}=t;return{cacheKey:Ce.budget(e),transform:r=>r&&{...r,accounts:n}}},mutationFn:async t=>{const{budgetId:e,accounts:n}=t;return await Ca({budgetId:e,updates:{accounts:n},description:"saving updated accounts (user edited account settings)"}),{accounts:n}}});function DB(){const{mutate:t,mutateAsync:e,isPending:n,isError:r,error:a,reset:o}=IB();return{updateAccounts:{mutate:h=>t(h),mutateAsync:h=>e(h),isPending:n,isError:r,error:a,reset:o}}}function MB(t){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order},r.expected_balance!==void 0&&(e[n].expected_balance=r.expected_balance),r.on_budget!==void 0&&(e[n].on_budget=r.on_budget),r.is_active!==void 0&&(e[n].is_active=r.is_active)}),e}const kB=Fn({optimisticUpdate:t=>{const{budgetId:e,accountGroups:n}=t;return{cacheKey:Ce.budget(e),transform:r=>r&&{...r,accountGroups:n}}},mutationFn:async t=>{const{budgetId:e,accountGroups:n}=t,r=MB(n);return await Ca({budgetId:e,updates:{account_groups:r},description:"saving updated account groups (user edited group settings)"}),{accountGroups:n}}});function OB(){const{mutate:t,mutateAsync:e,isPending:n,isError:r,error:a,reset:o}=kB();return{updateAccountGroups:{mutate:h=>t(h),mutateAsync:h=>e(h),isPending:n,isError:r,error:a,reset:o}}}Fn({optimisticUpdate:t=>{const{budgetId:e,accountId:n,delta:r}=t;return{cacheKey:Ce.budget(e),transform:a=>{if(!a?.accounts?.[n])return a;const o={...a.accounts,[n]:{...a.accounts[n],balance:a.accounts[n].balance+r}};return{...a,accounts:o}}}},mutationFn:async t=>{const{budgetId:e,accountId:n,delta:r}=t,o=(await _m(e,"update account balance")).accounts||{};if(!o[n])throw new Error("Account not found");const u=o[n].balance+r,h={...o,[n]:{...o[n],balance:u}};return await Ca({budgetId:e,updates:{accounts:h},description:"saving updated account balance"}),{accountId:n,newBalance:u}}});function NB(t){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,category_group_id:r.category_group_id??null,sort_order:r.sort_order,balance:r.balance??0},r.description!==void 0&&(e[n].description=r.description),r.default_monthly_amount!==void 0&&(e[n].default_monthly_amount=r.default_monthly_amount),r.default_monthly_type!==void 0&&(e[n].default_monthly_type=r.default_monthly_type),r.is_hidden!==void 0&&(e[n].is_hidden=r.is_hidden)}),e}const PB=Fn({optimisticUpdate:t=>{const{budgetId:e,categories:n}=t;return{cacheKey:Ce.budget(e),transform:r=>r&&{...r,categories:n}}},mutationFn:async t=>{const{budgetId:e,categories:n}=t,r=NB(n);return await Ca({budgetId:e,updates:{categories:r},description:"saving updated categories (user edited category settings)"}),{categories:n}}});function BB(){const{mutate:t,mutateAsync:e,isPending:n,isError:r,error:a,reset:o}=PB();return{updateCategories:{mutate:h=>t(h),mutateAsync:h=>e(h),isPending:n,isError:r,error:a,reset:o}}}const LB=Fn({optimisticUpdate:t=>{const{budgetId:e,categoryGroups:n}=t;return{cacheKey:Ce.budget(e),transform:r=>r&&{...r,categoryGroups:n}}},mutationFn:async t=>{const{budgetId:e,categoryGroups:n}=t;return await Ca({budgetId:e,updates:{category_groups:n},description:"saving updated category groups (user edited group settings)"}),{categoryGroups:n}}});function UB(){const{mutate:t,mutateAsync:e,isPending:n,isError:r,error:a,reset:o}=LB();return{updateCategoryGroups:{mutate:h=>t(h),mutateAsync:h=>e(h),isPending:n,isError:r,error:a,reset:o}}}const zB=Fn({optimisticUpdate:t=>{const{budgetId:e,newName:n}=t;return{cacheKey:Ce.budget(e),transform:r=>r&&{...r,budget:{...r.budget,name:n.trim()}}}},mutationFn:async t=>{const{budgetId:e,newName:n}=t,r=n.trim();return await Ca({budgetId:e,updates:{name:r},description:`renaming budget to "${r}"`}),{newName:r}}});function FB(){const{mutate:t,mutateAsync:e,isPending:n,isError:r,error:a,reset:o}=zB();return{renameBudget:{mutate:h=>t(h),mutateAsync:h=>e(h),isPending:n,isError:r,error:a,reset:o}}}function VB(){const t=So();return{createBudget:t0({mutationFn:async({name:n,userId:r,userEmail:a})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,u=new Date().toISOString(),h={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:a,accounts:{},account_groups:{},categories:{},category_groups:[],total_available:0,is_needs_recalculation:!1,month_map:{},created_at:u,updated_at:u};await Dt("budgets",o,h,"creating new budget document");const{exists:f,data:m}=await et("users",r,"reading user document to add new budget to their list");return f&&m?await Dt("users",r,{...m,budget_ids:[o,...m.budget_ids],updated_at:u},"adding new budget to user's budget list"):await Dt("users",r,{uid:r,email:a,budget_ids:[o],created_at:u,updated_at:u},"creating new user document with first budget"),{budgetId:o,budget:{id:o,...h}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Ce.user(r)}),t.invalidateQueries({queryKey:Ce.accessibleBudgets(r)})}})}}function $B(){const t=So();return{acceptInvite:t0({mutationFn:async({budgetId:n,userId:r})=>{const a=new Date().toISOString(),{exists:o,data:u}=await et("budgets",n,"verifying user was invited to this budget");if(!o||!u)throw new Error("Budget not found");if(!u.user_ids?.includes(r))throw new Error("You have not been invited to this budget");const{data:h}=await et("users",r,"PRE-EDIT-READ");if(h?.budget_ids?.includes(n))throw new Error("You have already accepted this invite");return await Dt("users",r,{...h||{uid:r,email:null},budget_ids:[n,...h?.budget_ids||[]],updated_at:a},"adding accepted budget to user's budget list"),await Dt("budgets",n,{...u,accepted_user_ids:[...u.accepted_user_ids||[],r]},"marking user as accepted in budget's accepted_user_ids"),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Ce.user(r)}),t.invalidateQueries({queryKey:Ce.accessibleBudgets(r)}),t.invalidateQueries({queryKey:Ce.budget(n.budgetId)})}})}}const HB=Fn({optimisticUpdate:t=>{const{budgetId:e,userId:n}=t;return{cacheKey:Ce.budget(e),transform:r=>r&&{...r,budget:{...r.budget,user_ids:[...r.budget.user_ids,n]}}}},mutationFn:async t=>{const{budgetId:e,userId:n}=t,r=await _m(e,"invite user");if(r.user_ids?.includes(n))throw new Error("User is already invited");return await Ca({budgetId:e,updates:{user_ids:[...r.user_ids||[],n]},description:"adding user to budget's invited users list"}),{budgetId:e}}});function qB(){const{mutate:t,mutateAsync:e,isPending:n,isError:r,error:a,reset:o}=HB();return{inviteUser:{mutate:h=>t(h),mutateAsync:h=>e(h),isPending:n,isError:r,error:a,reset:o}}}const GB=Fn({optimisticUpdate:t=>{const{budgetId:e,userId:n}=t;return{cacheKey:Ce.budget(e),transform:r=>r&&{...r,budget:{...r.budget,user_ids:r.budget.user_ids.filter(a=>a!==n),accepted_user_ids:r.budget.accepted_user_ids.filter(a=>a!==n)}}}},mutationFn:async t=>{const{budgetId:e,userId:n}=t,r=await _m(e,"revoke user");return await Ca({budgetId:e,updates:{user_ids:(r.user_ids||[]).filter(a=>a!==n),accepted_user_ids:(r.accepted_user_ids||[]).filter(a=>a!==n)},description:"removing user from budget's access lists"}),{budgetId:e}}});function QB(){const{mutate:t,mutateAsync:e,isPending:n,isError:r,error:a,reset:o}=GB();return{revokeUser:{mutate:h=>t(h),mutateAsync:h=>e(h),isPending:n,isError:r,error:a,reset:o}}}async function wT(t,e){const{exists:n,data:r}=await et("users",t,`PRE-EDIT-READ: ${e}`);if(!n||!r)throw new Error("User document not found");return r}async function WB(t){const{userId:e,updates:n,description:r}=t,o={...await wT(e,r),...n,updated_at:new Date().toISOString()};await Dt("users",e,o,r),Oe.setQueryData(Ce.user(e),o)}Fn({optimisticUpdate:t=>{const{budgetId:e,userId:n}=t;return{cacheKey:Ce.user(n),transform:r=>r&&{...r,budget_ids:[e,...r.budget_ids.filter(a=>a!==e)]}}},mutationFn:async t=>{const{budgetId:e,userId:n}=t,r=await wT(n,"switch budget"),a=[e,...r.budget_ids.filter(o=>o!==e)];return await WB({userId:n,updates:{budget_ids:a},description:"reordering budget list to make selected budget active"}),{budgetId:e}}});function kn(){const{selectedBudgetId:t,currentUserId:e}=zt(),{requireUserEmail:n}=Sa(),r=fT(t),{updateAccounts:a}=DB(),{updateAccountGroups:o}=OB(),{updateCategories:u}=BB(),{updateCategoryGroups:h}=UB(),{renameBudget:f}=FB(),{createBudget:m}=VB(),{acceptInvite:g}=$B(),{inviteUser:_}=qB(),{revokeUser:v}=QB(),x=r.data,S=x?.budget||null,E=C.useMemo(()=>x?.accounts||{},[x?.accounts]),T=C.useMemo(()=>x?.accountGroups||{},[x?.accountGroups]),I=C.useMemo(()=>x?.categories||{},[x?.categories]),j=C.useMemo(()=>x?.categoryGroups||[],[x?.categoryGroups]),M=S?.owner_id===e,Q=C.useMemo(()=>S?.user_ids||[],[S?.user_ids]),H=C.useMemo(()=>S?.accepted_user_ids||[],[S?.accepted_user_ids]),W=S?.total_available??0,D=C.useMemo(()=>x?.monthMap||{},[x?.monthMap]),A=C.useCallback(async ee=>{if(!t)throw new Error("No budget selected");await a.mutateAsync({budgetId:t,accounts:ee})},[t,a]),N=C.useCallback(async ee=>{if(!t)throw new Error("No budget selected");await o.mutateAsync({budgetId:t,accountGroups:ee})},[t,o]),P=C.useCallback(async ee=>{if(!t)throw new Error("No budget selected");await u.mutateAsync({budgetId:t,categories:ee})},[t,u]),L=C.useCallback(async ee=>{if(!t)throw new Error("No budget selected");await h.mutateAsync({budgetId:t,categoryGroups:ee})},[t,h]),B=C.useCallback(async(ee,le)=>{if(!t)throw new Error("No budget selected");await Promise.all([a.mutateAsync({budgetId:t,accounts:ee}),o.mutateAsync({budgetId:t,accountGroups:le})])},[t,a,o]),O=C.useCallback(async(ee,le)=>{if(!t)throw new Error("No budget selected");await Promise.all([u.mutateAsync({budgetId:t,categories:ee}),h.mutateAsync({budgetId:t,categoryGroups:le})])},[t,u,h]),G=C.useCallback(async ee=>{if(!t)throw new Error("No budget selected");await f.mutateAsync({budgetId:t,newName:ee})},[t,f]),Y=C.useCallback(async ee=>{if(!e)throw new Error("Not authenticated");return await m.mutateAsync({name:ee.trim()||"My Budget",userId:e,userEmail:n()})},[e,n,m]),U=C.useCallback(async ee=>{if(!t)throw new Error("No budget selected");await _.mutateAsync({budgetId:t,userId:ee})},[t,_]),F=C.useCallback(async ee=>{if(!t)throw new Error("No budget selected");await v.mutateAsync({budgetId:t,userId:ee})},[t,v]),K=C.useCallback(async ee=>{if(!e)throw new Error("Not authenticated");await g.mutateAsync({budgetId:ee,userId:e})},[e,g]),Z=C.useCallback(ee=>{if(!t)return;const le=Oe.getQueryData(Ce.budget(t));le&&Oe.setQueryData(Ce.budget(t),{...le,accounts:ee})},[t]),re=C.useCallback(ee=>{if(!t)return;const le=Oe.getQueryData(Ce.budget(t));le&&Oe.setQueryData(Ce.budget(t),{...le,accountGroups:ee})},[t]),z=C.useCallback(ee=>{if(!t)return;const le=Oe.getQueryData(Ce.budget(t));le&&Oe.setQueryData(Ce.budget(t),{...le,categories:ee})},[t]),q=C.useCallback(ee=>{if(!t)return;const le=Oe.getQueryData(Ce.budget(t));le&&Oe.setQueryData(Ce.budget(t),{...le,categoryGroups:ee})},[t]),te=C.useCallback(async()=>{t&&await Oe.invalidateQueries({queryKey:Ce.budget(t)})},[t]),ie=C.useCallback(()=>Object.entries(E).filter(([,ee])=>{const le=ee.account_group_id?T[ee.account_group_id]:void 0,pe=le?.on_budget!==void 0?le.on_budget:ee.on_budget!==!1,xe=le?.is_active!==void 0?le.is_active:ee.is_active!==!1;return pe&&xe}).reduce((ee,[,le])=>ee+le.balance,0),[E,T]);return{isLoading:r.isLoading,isFetching:r.isFetching,error:r.error,budget:S,accounts:E,accountGroups:T,categories:I,categoryGroups:j,isOwner:M,budgetUserIds:Q,acceptedUserIds:H,totalAvailable:W,monthMap:D,saveAccounts:A,saveAccountGroups:N,saveCategories:P,saveCategoryGroups:L,saveAccountsAndGroups:B,saveCategoriesAndGroups:O,renameBudget:G,createBudget:Y,inviteUser:U,revokeUser:F,acceptInvite:K,setAccountsOptimistic:Z,setAccountGroupsOptimistic:re,setCategoriesOptimistic:z,setCategoryGroupsOptimistic:q,refreshBudget:te,getOnBudgetTotal:ie}}function yi(t,e,n){const{addLoadingHold:r,removeLoadingHold:a}=sr(),o=R4(t,e,n,{enabled:!!t});C.useEffect(()=>(o.isLoading?r("month-query","Loading month data..."):a("month-query"),()=>a("month-query")),[o.isLoading,r,a]);const{addIncome:u}=oB(),{updateIncome:h}=cB(),{deleteIncome:f}=uB(),{addExpense:m}=hB(),{updateExpense:g}=mB(),{deleteExpense:_}=pB(),{addTransfer:v}=yB(),{updateTransfer:x}=bB(),{deleteTransfer:S}=vB(),{addAdjustment:E}=SB(),{updateAdjustment:T}=EB(),{deleteAdjustment:I}=CB(),j=o.data?.month||null,M=j?.income||[],Q=j?.expenses||[],H=j?.transfers||[],W=j?.adjustments||[],D=j?.category_balances||[],A=j?.total_income||0,N=j?.total_expenses||0,P=j?.are_allocations_finalized||!1,L=j?.previous_month_income??0,B=C.useCallback(async(ee,le,pe,xe,ve)=>{if(!t)throw new Error("No budget selected");const[J,Se]=pe.split("-").map(Number);await u(t,J,Se,ee,le,pe,xe,ve)},[t,u]),O=C.useCallback(async(ee,le,pe,xe,ve,J)=>{if(!t)throw new Error("No budget selected");await h(t,e,n,ee,le,pe,xe,ve,J)},[t,e,n,h]),G=C.useCallback(async ee=>{if(!t)throw new Error("No budget selected");await f(t,e,n,ee)},[t,e,n,f]),Y=C.useCallback(async(ee,le,pe,xe,ve,J,Se)=>{if(!t)throw new Error("No budget selected");const[je,at]=xe.split("-").map(Number);await m(t,je,at,ee,le,pe,xe,ve,J,Se)},[t,m]),U=C.useCallback(async(ee,le,pe,xe,ve,J,Se,je)=>{if(!t)throw new Error("No budget selected");await g(t,e,n,ee,le,pe,xe,ve,J,Se,je)},[t,e,n,g]),F=C.useCallback(async ee=>{if(!t)throw new Error("No budget selected");await _(t,e,n,ee)},[t,e,n,_]),K=C.useCallback(async(ee,le,pe,xe,ve,J,Se,je)=>{if(!t)throw new Error("No budget selected");const[at,Me]=J.split("-").map(Number);await v(t,at,Me,ee,le,pe,xe,ve,J,Se,je)},[t,v]),Z=C.useCallback(async(ee,le,pe,xe,ve,J,Se,je,at)=>{if(!t)throw new Error("No budget selected");await x(t,e,n,ee,le,pe,xe,ve,J,Se,je,at)},[t,e,n,x]),re=C.useCallback(async ee=>{if(!t)throw new Error("No budget selected");await S(t,e,n,ee)},[t,e,n,S]),z=C.useCallback(async(ee,le,pe,xe,ve,J,Se)=>{if(!t)throw new Error("No budget selected");const[je,at]=xe.split("-").map(Number);await E(t,je,at,ee,le,pe,xe,ve,J,Se)},[t,E]),q=C.useCallback(async(ee,le,pe,xe,ve,J,Se,je)=>{if(!t)throw new Error("No budget selected");await T(t,e,n,ee,le,pe,xe,ve,J,Se,je)},[t,e,n,T]),te=C.useCallback(async ee=>{if(!t)throw new Error("No budget selected");await I(t,e,n,ee)},[t,e,n,I]),ie=C.useCallback(async()=>{t&&await Oe.invalidateQueries({queryKey:Ce.month(t,e,n)})},[t,e,n]);return{isLoading:o.isLoading,isFetching:o.isFetching,error:o.error,month:j,income:M,expenses:Q,transfers:H,adjustments:W,categoryBalances:D,totalIncome:A,totalExpenses:N,areAllocationsFinalized:P,previousMonthIncome:L,addIncome:B,updateIncome:O,deleteIncome:G,addExpense:Y,updateExpense:U,deleteExpense:F,addTransfer:K,updateTransfer:Z,deleteTransfer:re,addAdjustment:z,updateAdjustment:q,deleteAdjustment:te,refreshMonth:ie}}function KB({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:a,saveAccounts:o,saveAccountGroups:u,setError:h}){const f=C.useCallback(async(g,_,v)=>{const x=e[g];if(!x)return;const S=v==="ungrouped"?null:v,E=Object.entries(e).filter(([,j])=>(j.account_group_id||"ungrouped")===v),T={};Object.entries(e).forEach(([j,M])=>{j!==g&&(T[j]={...M})});let I;if(_==="__group_end__"||E.length===0||!E.find(([j])=>j===_))I=(E.length>0?Math.max(...E.filter(([M])=>M!==g).map(([,M])=>M.sort_order)):-1)+1;else{const j=E.find(([M])=>M===_);if(j){const[,M]=j;I=M.sort_order,Object.entries(T).forEach(([Q,H])=>{(H.account_group_id||"ungrouped")===v&&H.sort_order>=I&&(T[Q]={...H,sort_order:H.sort_order+1})})}else I=0}if(T[g]={...x,account_group_id:S,sort_order:I},r(T),!!t)try{await o(T)}catch(j){h(j instanceof Error?j.message:"Failed to save changes")}},[t,e,r,o,h]),m=C.useCallback(async(g,_)=>{if(g===_)return;const v=Object.entries(n).sort(([,I],[,j])=>I.sort_order-j.sort_order),x=v.findIndex(([I])=>I===g),S=[...v],[E]=S.splice(x,1);if(_==="__end__")S.push(E);else{const I=S.findIndex(([j])=>j===_);S.splice(I,0,E)}const T={};if(S.forEach(([I,j],M)=>{T[I]={...j,sort_order:M}}),a(T),!!t)try{await u(T)}catch(I){h(I instanceof Error?I.message:"Failed to save new order")}},[t,n,a,u,h]);return{reorderAccountsInGroup:f,reorderGroups:m}}function YB(){const{budget:t,accounts:e,accountGroups:n,saveAccounts:r,saveAccountGroups:a,saveAccountsAndGroups:o,setAccountsOptimistic:u,setAccountGroupsOptimistic:h}=kn(),[f,m]=C.useState(null),g=C.useMemo(()=>Object.entries(e).filter(([,D])=>!D.is_hidden).reduce((D,[A,N])=>{const P=N.account_group_id||"ungrouped";return D[P]||(D[P]=[]),D[P].push({...N,id:A}),D},{}),[e]),_=C.useMemo(()=>Object.entries(e).filter(([,D])=>D.is_hidden).map(([D,A])=>({...A,id:D})).sort((D,A)=>D.sort_order-A.sort_order),[e]),v=C.useMemo(()=>Object.entries(n).sort(([,D],[,A])=>D.sort_order-A.sort_order).map(([D,A])=>({...A,id:D})),[n]),x=C.useCallback((D,A)=>{if(!t)return;const N=Object.values(e).filter(G=>A==="ungrouped"?!G.account_group_id:G.account_group_id===A),P=N.length>0?Math.max(...N.map(G=>G.sort_order)):-1,L=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,B={nickname:D.nickname,description:"",balance:0,account_group_id:A==="ungrouped"?null:A,sort_order:P+1,is_income_account:D.is_income_account??!1,is_income_default:D.is_income_default??!1,is_outgo_account:D.is_outgo_account??!1,is_outgo_default:D.is_outgo_default??!1,on_budget:D.on_budget!==!1,is_active:D.is_active!==!1,is_hidden:D.is_hidden??!1},O={...e};D.is_income_default&&Object.keys(O).forEach(G=>{O[G]={...O[G],is_income_default:!1}}),D.is_outgo_default&&Object.keys(O).forEach(G=>{O[G]={...O[G],is_outgo_default:!1}}),O[L]=B,u(O),r(O).catch(G=>m(G instanceof Error?G.message:"Failed to create account."))},[t,e,u,r]),S=C.useCallback((D,A)=>{if(!t)return;const N=e[D];if(!N)return;const P=N.account_group_id||"ungrouped",L=A.account_group_id;let B=N.sort_order;if(P!==(L||"ungrouped")){const G=Object.values(e).filter(Y=>(Y.account_group_id||"ungrouped")===(L||"ungrouped"));B=G.length>0?Math.max(...G.map(Y=>Y.sort_order))+1:0}const O={};Object.entries(e).forEach(([G,Y])=>{G===D?O[G]={...Y,nickname:A.nickname,account_group_id:L,sort_order:B,is_income_account:A.is_income_account??!1,is_income_default:A.is_income_default??!1,is_outgo_account:A.is_outgo_account??!1,is_outgo_default:A.is_outgo_default??!1,on_budget:A.on_budget!==!1,is_active:A.is_active!==!1,is_hidden:A.is_hidden??!1}:(O[G]={...Y},A.is_income_default&&!N.is_income_default&&(O[G].is_income_default=!1),A.is_outgo_default&&!N.is_outgo_default&&(O[G].is_outgo_default=!1))}),u(O),r(O).catch(G=>m(G instanceof Error?G.message:"Failed to save account."))},[t,e,u,r]),E=C.useCallback(D=>{if(!confirm("Are you sure you want to delete this account?")||!t)return;const{[D]:A,...N}=e;u(N),r(N).catch(P=>m(P instanceof Error?P.message:"Failed to delete account."))},[t,e,u,r]),T=C.useCallback(async(D,A)=>{const N=e[D];if(!N)return;const P=N.account_group_id||"ungrouped",L=Object.entries(e).filter(([,F])=>(F.account_group_id||"ungrouped")===P).sort(([,F],[,K])=>F.sort_order-K.sort_order),B=L.findIndex(([F])=>F===D),O=A==="up"?B-1:B+1;if(O<0||O>=L.length)return;const[G,Y]=L[O],U={};if(Object.entries(e).forEach(([F,K])=>{F===D?U[F]={...K,sort_order:Y.sort_order}:F===G?U[F]={...K,sort_order:N.sort_order}:U[F]={...K}}),u(U),!!t)try{await r(U)}catch(F){u(e),m(F instanceof Error?F.message:"Failed to move account")}},[t,e,u,r]),I=C.useCallback(D=>{if(!t)return;const A=Object.values(n).map(O=>O.sort_order),N=A.length>0?Math.max(...A):-1,P=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,L={name:D.name,sort_order:N+1,expected_balance:D.expected_balance,on_budget:D.on_budget,is_active:D.is_active},B={...n,[P]:L};h(B),a(B).catch(O=>m(O instanceof Error?O.message:"Failed to create account type."))},[t,n,h,a]),j=C.useCallback((D,A)=>{if(!t)return;const N={...n,[D]:{...n[D],name:A.name,expected_balance:A.expected_balance,on_budget:A.on_budget,is_active:A.is_active}};h(N),a(N).catch(P=>m(P instanceof Error?P.message:"Failed to update account type."))},[t,n,h,a]),M=C.useCallback(D=>{if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!t)return;const A={};Object.entries(e).forEach(([L,B])=>{A[L]=B.account_group_id===D?{...B,account_group_id:null}:B});const{[D]:N,...P}=n;u(A),h(P),o(A,P).catch(L=>m(L instanceof Error?L.message:"Failed to delete account type."))},[t,e,n,u,h,o]),Q=C.useCallback(async(D,A)=>{const N=Object.entries(n).sort(([,G],[,Y])=>G.sort_order-Y.sort_order),P=N.findIndex(([G])=>G===D),L=A==="up"?P-1:P+1;if(L<0||L>=N.length)return;const[B]=N.splice(P,1);N.splice(L,0,B);const O={};if(N.forEach(([G,Y],U)=>{O[G]={...Y,sort_order:U}}),h(O),!!t)try{await a(O)}catch(G){h(n),m(G instanceof Error?G.message:"Failed to move account type")}},[t,n,h,a]),{reorderAccountsInGroup:H,reorderGroups:W}=KB({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:u,setAccountGroupsOptimistic:h,saveAccounts:r,saveAccountGroups:a,setError:m});return{accounts:e,accountGroups:n,accountsByGroup:g,hiddenAccounts:_,sortedGroups:v,currentBudget:t,error:f,setError:m,handleCreateAccount:x,handleUpdateAccount:S,handleDeleteAccount:E,handleMoveAccount:T,handleCreateGroup:I,handleUpdateGroup:j,handleDeleteGroup:M,handleMoveGroup:Q,reorderAccountsInGroup:H,reorderGroups:W}}function Aw(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,a])=>{if(a.default_monthly_type==="percentage")return;const o=t.category_balances?.find(u=>u.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():a.default_monthly_amount!==void 0&&a.default_monthly_amount>0?n[r]=a.default_monthly_amount.toString():n[r]=""}),n}function XB(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{selectedBudgetId:n,currentYear:r,currentMonthNumber:a}=zt(),{categories:o,getOnBudgetTotal:u,totalAvailable:h}=kn(),{month:f,isLoading:m,previousMonthIncome:g,areAllocationsFinalized:_}=yi(n,r,a),v=C.useMemo(()=>f?.income?f.income.reduce((z,q)=>z+q.amount,0):0,[f]),{saveDraftAllocations:x}=tB(),{finalizeAllocations:S}=nB(),{deleteAllocations:E}=vT(),T=C.useMemo(()=>Aw(f,o),[f,o]),[I,j]=C.useState(T),[M,Q]=C.useState(!1),[H,W]=C.useState(null),D=C.useRef(null);C.useMemo(()=>Object.values(o).reduce((z,q)=>z+(q.balance??0),0),[o]),C.useEffect(()=>{if(!f)return;const z=`${f.year}-${f.month}`;D.current!==z&&(Q(!1),j(Aw(f,o)),D.current=z)},[f,o]);const A=C.useCallback((z,q)=>{if(q.default_monthly_type==="percentage"&&q.default_monthly_amount!==void 0)return we(q.default_monthly_amount/100*g);const te=I[z],ie=parseFloat(te||"0");return isNaN(ie)?0:we(ie)},[I,g]),N=C.useMemo(()=>Object.entries(o).reduce((z,[q,te])=>{const ie=A(q,te),ee=te.balance??0;if(ee<0){const le=Math.abs(ee),pe=Math.max(0,ie-le);return z+pe}return z+ie},0),[o,A]),P=u(),L=_?(f?.category_balances||[]).reduce((z,q)=>{const te=o[q.category_id]?.balance??0,ie=q.allocated,ee=te-ie;if(ee<0){const le=Math.abs(ee);return z+Math.max(0,ie-le)}return z+ie},0):0,B=M?h+L:h,O=C.useMemo(()=>M?B-N:B-N+L,[B,N,L,M]),G=C.useCallback((z,q)=>{j(te=>({...te,[z]:q}))},[]),Y=C.useCallback(()=>{if(!f)return;const z={};Object.entries(o).forEach(([q,te])=>{if(te.default_monthly_type==="percentage")return;const ie=f.category_balances?.find(ee=>ee.category_id===q);ie&&ie.allocated>0?z[q]=ie.allocated.toString():te.default_monthly_amount!==void 0&&te.default_monthly_amount>0?z[q]=te.default_monthly_amount.toString():z[q]=""}),j(z),Q(!1)},[f,o]),U=C.useCallback(()=>{const z={};return Object.entries(o).forEach(([q,te])=>{const ie=A(q,te);ie>0&&(z[q]=ie)}),z},[o,A]),F=C.useCallback(async()=>{if(n){W(null),t("allocations-save","Saving allocations...");try{await x(n,r,a,U()),Q(!1)}catch(z){W(z instanceof Error?z.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,r,a,x,U,t,e]),K=C.useCallback(async()=>{if(n){W(null),t("allocations-finalize","Applying allocations...");try{await S({budgetId:n,year:r,month:a,allocations:U(),onProgress:z=>{t("allocations-finalize",z.message)}}),Q(!1)}catch(z){W(z instanceof Error?z.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,r,a,S,U,t,e]),Z=C.useCallback(async()=>{if(n){W(null),t("allocations-delete","Deleting allocations...");try{await E({budgetId:n,year:r,month:a,onProgress:q=>{t("allocations-delete",q.message)}});const z={};Object.entries(o).forEach(([q,te])=>{te.default_monthly_type!=="percentage"&&(te.default_monthly_amount!==void 0&&te.default_monthly_amount>0?z[q]=te.default_monthly_amount.toString():z[q]="")}),j(z),Q(!1)}catch(z){W(z instanceof Error?z.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,r,a,E,o,t,e]),re=N-L;return{localAllocations:I,isEditingAppliedAllocations:M,error:H,monthLoading:m,onBudgetTotal:P,availableNow:B,currentDraftTotal:N,draftChangeAmount:re,availableAfterApply:O,previousMonthIncome:g,currentMonthIncome:v,allocationsFinalized:_,getAllocationAmount:A,handleAllocationChange:G,resetAllocationsToSaved:Y,handleSaveAllocations:F,handleFinalizeAllocations:K,handleDeleteAllocations:Z,setIsEditingAppliedAllocations:Q,setError:W}}function JB({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:a}){const o=C.useMemo(()=>{const v={};return Object.entries(e).forEach(([x,S])=>{v[x]={current:S.balance??0,total:S.balance??0}}),v},[e]),[u,h]=C.useState(!1),[f,m]=C.useState(null),g=C.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const v=Object.keys(e),{total:x}=await Sw(t,v,n,r),S={};Object.entries(e).forEach(([T,I])=>{const j=I.balance,M=x[T]??0;Math.abs(j-M)>.01&&(S[T]={stored:j,calculated:M})});const E=Object.keys(S).length>0?S:null;return m(E),E},[t,e,n,r]),_=C.useCallback(async()=>{if(!(!t||Object.keys(e).length===0)){h(!0);try{const v=Object.keys(e),{total:x}=await Sw(t,v,n,r),S={};Object.entries(e).forEach(([E,T])=>{S[E]={...T,balance:x[E]??0}}),await a(S),m(null)}finally{h(!1)}}},[t,e,a,n,r]);return{categoryBalances:o,loadingBalances:u,categoryBalanceMismatch:f,checkCategoryBalanceMismatch:g,recalculateAndSaveCategoryBalances:_}}function ZB({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:a,saveCategories:o,saveCategoryGroups:u,setError:h}){const[f,m]=C.useState(null),[g,_]=C.useState(null),[v,x]=C.useState(null),[S,E]=C.useState(null);function T(P,L){m("category"),_(L),P.dataTransfer.effectAllowed="move"}function I(P,L,B){P.preventDefault(),f==="category"&&(L!==g&&x(L),E(B))}function j(P,L){P.preventDefault(),f==="category"?(E(L),x(null)):f==="group"&&L!==g&&x(L)}function M(){x(null)}function Q(){E(null)}function H(){m(null),_(null),x(null),E(null)}async function W(P,L,B){if(P.preventDefault(),P.stopPropagation(),!g||f!=="category"){H();return}const O=t[g];if(!O)return;const G=B==="ungrouped"?null:B,Y=Object.entries(t).filter(([,K])=>(K.category_group_id||"ungrouped")===B),U={};Object.entries(t).forEach(([K,Z])=>{K!==g&&(U[K]=Z)});let F;if(L==="__group_end__"||Y.length===0||!Y.find(([K])=>K===L))F=(Y.length>0?Math.max(...Y.filter(([Z])=>Z!==g).map(([,Z])=>Z.sort_order)):-1)+1;else{const K=Y.find(([Z])=>Z===L);K?(F=K[1].sort_order,Object.entries(U).forEach(([Z,re])=>{(re.category_group_id||"ungrouped")===B&&re.sort_order>=F&&(U[Z]={...re,sort_order:re.sort_order+1})})):F=0}if(U[g]={...O,category_group_id:G,sort_order:F},r(U),H(),!!n)try{await o(U)}catch(K){h(K instanceof Error?K.message:"Failed to save changes")}}async function D(P,L){P.preventDefault(),f==="category"?await W(P,"__group_end__",L):f==="group"&&await N(P,L)}function A(P,L){P.stopPropagation(),m("group"),_(L),P.dataTransfer.effectAllowed="move"}async function N(P,L){if(P.preventDefault(),!g||f!=="group"||g===L){H();return}const B=e.findIndex(U=>U.id===g),O=[...e],[G]=O.splice(B,1);if(L==="__end__")O.push(G);else{const U=O.findIndex(F=>F.id===L);O.splice(U,0,G)}const Y=O.map((U,F)=>({...U,sort_order:F}));if(a(Y),H(),!!n)try{await u(Y)}catch(U){h(U instanceof Error?U.message:"Failed to save new order")}}return{dragType:f,draggedId:g,dragOverId:v,dragOverGroupId:S,setDragOverId:x,setDragOverGroupId:E,handleCategoryDragStart:T,handleCategoryDragOver:I,handleDragOverGroup:j,handleDragLeave:M,handleDragLeaveGroup:Q,handleDragEnd:H,handleCategoryDrop:W,handleDropOnGroup:D,handleGroupDragStart:A,handleGroupDrop:N}}function eL(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=zt(),{budget:r,categories:a,categoryGroups:o,isLoading:u,saveCategories:h,saveCategoryGroups:f,saveCategoriesAndGroups:m,setCategoriesOptimistic:g,setCategoryGroupsOptimistic:_,getOnBudgetTotal:v}=kn(),[x,S]=C.useState(null),{categoryBalances:E,loadingBalances:T,categoryBalanceMismatch:I,checkCategoryBalanceMismatch:j,recalculateAndSaveCategoryBalances:M}=JB({budgetId:t,categories:a,currentYear:e,currentMonth:n,updateCategoriesWithBalances:h}),Q=ZB({categories:a,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:g,setCategoryGroupsOptimistic:_,saveCategories:h,saveCategoryGroups:f,setError:S});async function H(U,F){if(!r)return;const K=F==="ungrouped"?null:F,Z=Object.values(a).filter(ie=>F==="ungrouped"?!ie.category_group_id:ie.category_group_id===F),re=Z.length>0?Math.max(...Z.map(ie=>ie.sort_order)):-1,z=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,q={name:U.name,description:U.description??"",category_group_id:K,sort_order:re+1,default_monthly_amount:U.default_monthly_amount??0,default_monthly_type:U.default_monthly_type??"fixed",balance:0,is_hidden:U.is_hidden??!1},te={...a,[z]:q};g(te);try{await h(te)}catch(ie){g(a),S(ie instanceof Error?ie.message:"Failed to create category")}}async function W(U,F){if(r)try{const K=a[U];if(!K)return;const Z=K.category_group_id||"ungrouped",re=F.category_group_id;let z=K.sort_order;if(Z!==(re||"ungrouped")){const te=Object.values(a).filter(ie=>(ie.category_group_id||"ungrouped")===(re||"ungrouped")).filter((ie,ee,le)=>a[U]!==le[ee]);z=te.length>0?Math.max(...te.map(ie=>ie.sort_order))+1:0}const q={...a,[U]:{...K,name:F.name,description:F.description??"",category_group_id:re,sort_order:z,default_monthly_amount:F.default_monthly_amount??0,default_monthly_type:F.default_monthly_type??"fixed",is_hidden:F.is_hidden??!1}};g(q),await h(q)}catch(K){S(K instanceof Error?K.message:"Failed to update category")}}async function D(U){if(confirm("Are you sure you want to delete this category?")&&r)try{const{[U]:F,...K}=a;g(K),await h(K)}catch(F){S(F instanceof Error?F.message:"Failed to delete category")}}async function A(U,F){const K=a[U];if(!K)return;const Z=K.category_group_id||"ungrouped",re=Object.entries(a).filter(([,le])=>(le.category_group_id||"ungrouped")===Z).sort((le,pe)=>le[1].sort_order-pe[1].sort_order),z=re.findIndex(([le])=>le===U),q=F==="up"?z-1:z+1;if(q<0||q>=re.length)return;const[te,ie]=re[q],ee={};if(Object.entries(a).forEach(([le,pe])=>{le===U?ee[le]={...pe,sort_order:ie.sort_order}:le===te?ee[le]={...pe,sort_order:K.sort_order}:ee[le]=pe}),g(ee),!!r)try{await h(ee)}catch(le){g(a),S(le instanceof Error?le.message:"Failed to move category")}}async function N(U){if(r)try{const F=o.length>0?Math.max(...o.map(re=>re.sort_order)):-1,K={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:U.name,sort_order:F+1},Z=[...o,K];_(Z),await f(Z)}catch(F){S(F instanceof Error?F.message:"Failed to create group")}}async function P(U,F){if(r)try{const K=o.map(Z=>Z.id===U?{...Z,name:F.name}:Z);_(K),await f(K)}catch(K){S(K instanceof Error?K.message:"Failed to update group")}}async function L(U){if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const F={};Object.entries(a).forEach(([Z,re])=>{F[Z]=re.category_group_id===U?{...re,category_group_id:null}:re});const K=o.filter(Z=>Z.id!==U);g(F),_(K),await m(F,K)}catch(F){S(F instanceof Error?F.message:"Failed to delete group")}}async function B(U,F){const K=[...o].sort((te,ie)=>te.sort_order-ie.sort_order),Z=K.findIndex(te=>te.id===U),re=F==="up"?Z-1:Z+1;if(re<0||re>=K.length)return;const[z]=K.splice(Z,1);K.splice(re,0,z);const q=K.map((te,ie)=>({...te,sort_order:ie}));if(_(q),!!r)try{await f(q)}catch(te){_(o),S(te instanceof Error?te.message:"Failed to move group")}}const O=Object.entries(a).filter(([,U])=>!U.is_hidden).reduce((U,[F,K])=>{const Z=K.category_group_id||"ungrouped";return U[Z]||(U[Z]=[]),U[Z].push([F,K]),U},{}),G=Object.entries(a).filter(([,U])=>U.is_hidden).map(([U,F])=>[U,F]).sort((U,F)=>U[1].sort_order-F[1].sort_order),Y=[...o].sort((U,F)=>U.sort_order-F.sort_order);return{currentBudget:r,categories:a,categoryGroups:o,categoriesByGroup:O,hiddenCategories:G,sortedGroups:Y,categoryBalances:E,isLoading:u,loadingBalances:T,error:x,setError:S,getOnBudgetTotal:v,categoryBalanceMismatch:I,checkCategoryBalanceMismatch:j,recalculateAndSaveCategoryBalances:M,handleCreateCategory:H,handleUpdateCategory:W,handleDeleteCategory:D,handleMoveCategory:A,handleCreateGroup:N,handleUpdateGroup:P,handleDeleteGroup:L,handleMoveGroup:B,dragType:Q.dragType,draggedId:Q.draggedId,dragOverId:Q.dragOverId,dragOverGroupId:Q.dragOverGroupId,setDragOverId:Q.setDragOverId,setDragOverGroupId:Q.setDragOverGroupId,handleCategoryDragStart:Q.handleCategoryDragStart,handleCategoryDragOver:Q.handleCategoryDragOver,handleDragOverGroup:Q.handleDragOverGroup,handleDragLeave:Q.handleDragLeave,handleDragLeaveGroup:Q.handleDragLeaveGroup,handleDragEnd:Q.handleDragEnd,handleCategoryDrop:Q.handleCategoryDrop,handleDropOnGroup:Q.handleDropOnGroup,handleGroupDragStart:Q.handleGroupDragStart,handleGroupDrop:Q.handleGroupDrop}}function vo(){Oe.removeQueries({queryKey:["budget"]}),Oe.removeQueries({queryKey:["month"]}),Oe.removeQueries({queryKey:["accessibleBudgets"]}),Oe.removeQueries({queryKey:["payees"]}),Oe.removeQueries({queryKey:["user"]});try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")}catch{}console.log("[Migration] All caches cleared")}async function ic(t){try{const e=await t();return vo(),e}catch(e){throw vo(),e}}const ET=C.createContext(null),jw={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function tL({children:t}){const[e,n]=C.useState(jw),r=C.useCallback(()=>({setStage:h=>{n(f=>({...f,stage:h}))},setProgress:h=>{n(f=>({...f,progress:h}))},setCurrentItem:h=>{n(f=>({...f,currentItem:h}))},setDetails:h=>{n(f=>({...f,details:h}))},updateItemProgress:(h,f,m)=>{const g=f>0?Math.round(h/f*100):0;n(_=>({..._,progress:g,currentItem:m||`Item ${h} of ${f}`,details:`${h} / ${f} complete`}))}}),[]),a=C.useCallback(async(h,f)=>{n({isOpen:!0,migrationName:h,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const m=r();try{const g=await f(m);return vo(),n(_=>({..._,isComplete:!0,stage:"Migration complete",progress:100,details:g.errors.length>0?`Completed with ${g.errors.length} error(s)`:"All operations successful"})),g}catch(g){vo();const _=g instanceof Error?g.message:"Unknown error occurred";throw n(v=>({...v,isComplete:!0,error:_,stage:"Migration failed",progress:null})),g}},[r]),o=C.useCallback(()=>{n(h=>h.isComplete?jw:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),h))},[]),u={state:e,runMigrationWithProgress:a,closeModal:o};return c.jsx(ET.Provider,{value:u,children:t})}function B0(){const t=C.useContext(ET);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function nL(t){return(await Pt("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function rL(t,e){return(await Pt("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(a=>({id:a.id,data:a.data,budgetId:a.data.budget_id,year:a.data.year,month:a.data.month})).sort((a,o)=>a.year!==o.year?a.year-o.year:a.month-o.month)}async function br(t){const e=await nL(t),n=await Pt("months",`${t}: batch reading all months`),r=new Map;for(const a of n.docs){const o=a.data.budget_id,u={id:a.id,data:a.data,budgetId:o,year:a.data.year,month:a.data.month};r.has(o)||r.set(o,[]),r.get(o).push(u)}for(const a of r.values())a.sort((o,u)=>o.year!==u.year?o.year-u.year:o.month-u.month);return{budgets:e,monthsByBudget:r}}async function id(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"months",docId:gr(r.budgetId,r.year,r.month),data:{...r.data,updated_at:new Date().toISOString()}}));await mm(n,`${e}: batch writing ${t.length} months`)}async function CT(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"budgets",docId:r.budgetId,data:{...r.data,updated_at:new Date().toISOString()}}));await mm(n,`${e}: batch writing ${t.length} budgets`)}async function TT(t,e,n){if(e.length===0)return;let r=O0;const a=[];for(const g of e){const _=N0(g,r);a.push(_),r=kf(_)}const o=a.map(g=>({budgetId:t,year:g.year,month:g.month,data:g}));await id(o,n);const u=r.accountEndBalances,h=r.categoryEndBalances,{exists:f,data:m}=await et("budgets",t,`${n}: reading budget for final update`);if(f&&m){const g=pT(m.month_map||{}),_=P0(g);await yT(t,u,h,_)}}async function AT(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,a]of n){a.sort((h,f)=>h.year!==f.year?h.year-f.year:h.month-f.month),await id(a,e);const u=(await rL(r,e)).map(h=>h.data);await TT(r,u,e)}}function jT(t){return t.nickname===void 0||t.description===void 0||t.balance===void 0||t.sort_order===void 0||t.is_income_account===void 0||t.is_income_default===void 0||t.is_outgo_account===void 0||t.is_outgo_default===void 0||t.on_budget===void 0||t.is_active===void 0}function RT(t){return t.name===void 0||t.description===void 0||t.sort_order===void 0||t.default_monthly_amount===void 0||t.default_monthly_type===void 0||t.balance===void 0}function IT(t){return t.name===void 0||t.sort_order===void 0}function DT(t){return t.budget_id===void 0||t.year_month_ordinal===void 0||t.year===void 0||t.month===void 0||!Array.isArray(t.income)||t.total_income===void 0||t.previous_month_income===void 0||!Array.isArray(t.expenses)||t.total_expenses===void 0||!Array.isArray(t.account_balances)||!Array.isArray(t.category_balances)||t.are_allocations_finalized===void 0||t.created_at===void 0||t.updated_at===void 0}function MT(){const t=new Date,e=t.getFullYear();let r=t.getMonth()+1+Pu,a=e;for(;r>12;)r-=12,a+=1;return{year:a,month:r}}function kT(t,e,n){return t>n.year||t===n.year&&e>n.month}async function sL(){const t=await Pt("budgets","database cleanup: scanning all budgets");let e=0,n=0,r=0,a=0,o=0,u=0,h=0,f=0,m=0;const g=new Set;for(const j of t.docs){const M=j.data;if(Array.isArray(M.accounts)||Array.isArray(M.categories)||Array.isArray(M.account_groups)){e++;continue}g.add(j.id),M.month_map===void 0&&f++,M.earliest_month!==void 0&&m++;const Q=M.accounts;if(Q&&typeof Q=="object"){let D=!1;for(const A of Object.values(Q))jT(A)&&(o++,D=!0);D&&n++}const H=M.categories;if(H&&typeof H=="object"){let D=!1;for(const A of Object.values(H))RT(A)&&(u++,D=!0);D&&r++}const W=M.account_groups;if(W&&typeof W=="object"){let D=!1;for(const A of Object.values(W))IT(A)&&(h++,D=!0);D&&a++}}const _=await Pt("months","database cleanup: scanning all months"),v=MT(),x=[];let S=0,E=0;for(const j of _.docs){const M=j.data,Q=M.year,H=M.month;Q&&H&&kT(Q,H,v)&&x.push({docId:j.id,budgetId:M.budget_id,year:Q,month:H}),DT(M)&&S++,M.is_needs_recalculation!==void 0&&E++}x.sort((j,M)=>j.year!==M.year?j.year-M.year:j.month-M.month);const T=await Pt("data_mappings","database cleanup: scanning all data mappings");let I=0;for(const j of T.docs)j.data.budget_id===void 0&&I++;return{totalBudgets:t.docs.length,budgetsWithArrays:e,budgetsWithMissingAccountDefaults:n,budgetsWithMissingCategoryDefaults:r,budgetsWithMissingGroupDefaults:a,accountsNeedingDefaults:o,categoriesNeedingDefaults:u,groupsNeedingDefaults:h,budgetsNeedingMonthMapUpdate:f,budgetsWithDeprecatedEarliestMonth:m,totalMonths:_.docs.length,futureMonthsToDelete:x,monthsWithSchemaIssues:S,monthsWithOldRecalcField:E,totalDataMappings:T.docs.length,dataMappingsMissingBudgetId:I}}function Rw(t){return{nickname:t.nickname??"",description:t.description??"",balance:t.balance??0,account_group_id:t.account_group_id??null,sort_order:t.sort_order??0,is_income_account:t.is_income_account??!1,is_income_default:t.is_income_default??!1,is_outgo_account:t.is_outgo_account??!1,is_outgo_default:t.is_outgo_default??!1,on_budget:t.on_budget??!0,is_active:t.is_active??!0,is_hidden:t.is_hidden??!1}}function Iw(t){return{name:t.name??"",description:t.description??"",category_group_id:t.category_group_id??null,sort_order:t.sort_order??0,default_monthly_amount:t.default_monthly_amount??0,default_monthly_type:t.default_monthly_type??"fixed",balance:t.balance??0,is_hidden:t.is_hidden??!1}}function Dw(t){return{name:t.name??"",sort_order:t.sort_order??0,...t.expected_balance!==void 0&&{expected_balance:t.expected_balance},...t.on_budget!==void 0&&{on_budget:t.on_budget},...t.is_active!==void 0&&{is_active:t.is_active}}}function iL(t,e){const n=e.match(/_(\d{4})(\d{2})$/),r=n?parseInt(n[1]):new Date().getFullYear(),a=n?parseInt(n[2]):new Date().getMonth()+1,o=`${r}${String(a).padStart(2,"0")}`;return{budget_id:t.budget_id??"",year_month_ordinal:t.year_month_ordinal??o,year:t.year??r,month:t.month??a,income:Array.isArray(t.income)?t.income:[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:Array.isArray(t.expenses)?t.expenses:[],total_expenses:t.total_expenses??0,transfers:Array.isArray(t.transfers)?t.transfers:[],adjustments:Array.isArray(t.adjustments)?t.adjustments:[],account_balances:Array.isArray(t.account_balances)?t.account_balances:[],category_balances:Array.isArray(t.category_balances)?t.category_balances:[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at??new Date().toISOString(),updated_at:t.updated_at??new Date().toISOString()}}async function aL(t){const e={},n=await Pt("months",`database cleanup: querying all months for budget ${t}`,[{field:"budget_id",op:"==",value:t}]);for(const r of n.docs){const a=r.data;if(a.year&&a.month){const o=At(a.year,a.month);e[o]={needs_recalculation:!1}}}return e}async function oL(){const t=[];let e=0,n=0,r=0,a=0,o=0,u=0,h=0,f=0,m=0,g=0;const _=await Pt("budgets","database cleanup: reading all budgets to fix");for(const T of _.docs)try{const{exists:I,data:j}=await et("budgets",T.id,"database cleanup: reading budget for update");if(!I||!j)continue;let M=!1;const Q={...j};if(Array.isArray(j.accounts)){const H=j.accounts,W={};for(const D of H){const A=D.id||`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;W[A]=Rw(D),n++}Q.accounts=W,M=!0,o++}if(Array.isArray(j.categories)){const H=j.categories,W={};for(const D of H){const A=D.id||`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;W[A]=Iw(D),r++}Q.categories=W,M=!0,o++}if(Array.isArray(j.account_groups)){const H=j.account_groups,W={};for(const D of H){const A=D.id||`group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;W[A]=Dw(D),a++}Q.account_groups=W,M=!0,o++}if(!Array.isArray(j.accounts)&&j.accounts&&typeof j.accounts=="object"){const H=j.accounts,W={};for(const[D,A]of Object.entries(H))jT(A)?(W[D]=Rw(A),n++,M=!0):W[D]=A;M&&(Q.accounts=W)}if(!Array.isArray(j.categories)&&j.categories&&typeof j.categories=="object"){const H=j.categories,W={};let D=!1;for(const[A,N]of Object.entries(H))RT(N)?(W[A]=Iw(N),r++,D=!0):W[A]=N;D&&(Q.categories=W,M=!0)}if(!Array.isArray(j.account_groups)&&j.account_groups&&typeof j.account_groups=="object"){const H=j.account_groups,W={};let D=!1;for(const[A,N]of Object.entries(H))IT(N)?(W[A]=Dw(N),a++,D=!0):W[A]=N;D&&(Q.account_groups=W,M=!0)}if(j.month_map===void 0){const H=await aL(T.id);Q.month_map=H,M=!0,u++}delete Q.category_balances,delete Q.allocations,delete Q.allocations_finalized,delete Q.is_needs_recalculation,delete Q.earliest_month,M&&(await Dt("budgets",T.id,Q,"database cleanup: saving fixed budget"),e++),j.earliest_month!==void 0&&(await zl("budgets",T.id,{earliest_month:vw(),updated_at:new Date().toISOString()},`database cleanup: removing deprecated earliest_month from budget ${T.id}`),h++)}catch(I){t.push(`Budget ${T.id}: ${I instanceof Error?I.message:"Unknown error"}`)}const v=await Pt("months","database cleanup: reading all months"),x=MT();for(const T of v.docs)try{const I=T.data,j=I.year,M=I.month;if(j&&M&&kT(j,M,x)){await Nu("months",T.id,`database cleanup: deleting future month ${j}-${M}`),f++;continue}if(DT(I)){const Q=iL(I,T.id);await Dt("months",T.id,Q,"database cleanup: saving fixed month"),m++}I.is_needs_recalculation!==void 0&&(await zl("months",T.id,{is_needs_recalculation:vw(),updated_at:new Date().toISOString()},`database cleanup: removing is_needs_recalculation from month ${j}/${M}`),g++)}catch(I){t.push(`Month ${T.id}: ${I instanceof Error?I.message:"Unknown error"}`)}let S=0;const E=await Pt("data_mappings","database cleanup: reading all data mappings");for(const T of E.docs)try{const I=T.data;if(I.budget_id!==void 0)continue;const j=T.id,M=j.lastIndexOf("_import_data_map");if(M===-1){t.push(`Data mapping ${j}: Cannot extract budget_id from document ID (unexpected format)`);continue}const Q=j.substring(0,M),{exists:H}=await et("budgets",Q,`database cleanup: verifying budget exists for data mapping ${j}`);if(!H){t.push(`Data mapping ${j}: Referenced budget ${Q} does not exist`);continue}await Dt("data_mappings",j,{...I,budget_id:Q},`database cleanup: adding budget_id to data mapping ${j}`),S++}catch(I){t.push(`Data mapping ${T.id}: ${I instanceof Error?I.message:"Unknown error"}`)}return{budgetsProcessed:e,accountsFixed:n,categoriesFixed:r,groupsFixed:a,arraysConverted:o,monthMapsUpdated:u,deprecatedFieldsRemoved:h,futureMonthsDeleted:f,monthsFixed:m,oldRecalcFieldsRemoved:g,dataMappingsFixed:S,errors:t}}function lL({currentUser:t,onComplete:e}){const[n,r]=C.useState(!1),[a,o]=C.useState(!1),[u,h]=C.useState(null),[f,m]=C.useState(null);async function g(){if(t){r(!0);try{const S=await sL();h(S)}catch(S){console.error("Failed to scan database:",S)}finally{r(!1)}}}async function _(){if(t){o(!0),m(null);try{const S=await ic(()=>oL());m(S),e?.()}catch(S){m({budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,groupsFixed:0,arraysConverted:0,monthMapsUpdated:0,deprecatedFieldsRemoved:0,futureMonthsDeleted:0,monthsFixed:0,oldRecalcFieldsRemoved:0,dataMappingsFixed:0,errors:[S instanceof Error?S.message:"Unknown error"]})}finally{o(!1)}}}const v=u!==null&&(u.budgetsWithArrays>0||u.accountsNeedingDefaults>0||u.categoriesNeedingDefaults>0||u.groupsNeedingDefaults>0||u.budgetsNeedingMonthMapUpdate>0||u.budgetsWithDeprecatedEarliestMonth>0||u.futureMonthsToDelete.length>0||u.monthsWithSchemaIssues>0||u.monthsWithOldRecalcField>0||u.dataMappingsMissingBudgetId>0),x=u!==null?u.budgetsWithArrays+u.accountsNeedingDefaults+u.categoriesNeedingDefaults+u.groupsNeedingDefaults+u.budgetsNeedingMonthMapUpdate+u.budgetsWithDeprecatedEarliestMonth+u.futureMonthsToDelete.length+u.monthsWithSchemaIssues+u.monthsWithOldRecalcField+u.dataMappingsMissingBudgetId:0;return{status:u,isScanning:n,scanStatus:g,hasIssues:v,totalIssues:x,isRunning:a,result:f,runCleanup:_}}function $g(t){return t.includes("@")?!1:!!(/_[a-z0-9]+_(com|org|net|edu|io|co|uk|gov|mil|biz|info)$/i.test(t)&&(t.match(/_/g)||[]).length>=2||/_[a-z0-9]+\.(com|org|net|edu|io|co|uk|gov|mil|biz|info)$/i.test(t)&&(t.match(/_/g)||[]).length>=1)}function cL(t){let e=t;const n=/^(.+)_(gmail|yahoo|hotmail|outlook|icloud|aol|proton|protonmail)\.(.+)$/i,r=e.match(n);return r?`${r[1]}@${r[2]}.${r[3]}`:(e=e.replace(/_com$/,".com").replace(/_net$/,".net").replace(/_org$/,".org").replace(/_edu$/,".edu").replace(/_io$/,".io"),e=e.replace(/_gmail_/,"@gmail.").replace(/_yahoo_/,"@yahoo.").replace(/_hotmail_/,"@hotmail.").replace(/_outlook_/,"@outlook.").replace(/_icloud_/,"@icloud."),e)}function af(t){if(t===null||typeof t!="object"||Array.isArray(t))return!1;const e=t;return e._methodName==="arrayUnion"&&Array.isArray(e.vc)}function OT(t){return t.vc||[]}function Mw(t){return Array.isArray(t.items)?t.items:af(t.items)?OT(t.items):[]}function uL({currentUser:t}){const[e,n]=C.useState(!1),[r,a]=C.useState(!1),[o,u]=C.useState(null),[h,f]=C.useState(null);async function m(){if(!t)return;n(!0);const _={documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],isHealthy:!0};try{const v=await Pt("feedback","feedback migration: scanning for issues");_.documentsFound=v.docs.length;for(const x of v.docs)$g(x.id)&&_.sanitizedDocuments.push(x.id),af(x.data.items)&&_.corruptedDocuments.push(x.id);_.isHealthy=_.sanitizedDocuments.length===0&&_.corruptedDocuments.length===0,u(_)}catch(v){console.error("Failed to scan feedback:",v)}finally{n(!1)}}async function g(){if(t){a(!0);try{const _=await ic(async()=>{const v={documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],mergedItems:0,deletedDocuments:0,fixedDocuments:0,errors:[]},x=await Pt("feedback","feedback migration: listing all documents");v.documentsFound=x.docs.length;for(const S of x.docs){const E=$g(S.id);if(af(S.data.items)&&!E){v.corruptedDocuments.push(S.id);const I=OT(S.data.items);try{await Dt("feedback",S.id,{items:I,user_email:S.data.user_email||S.id,created_at:S.data.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},`feedback migration: fixing corrupted arrayUnion in ${S.id}`),v.fixedDocuments++}catch(j){v.errors.push(`Failed to fix ${S.id}: ${j instanceof Error?j.message:"Unknown error"}`)}}}for(const S of x.docs)if($g(S.id)){v.sanitizedDocuments.push(S.id);const E=S.id,T=cL(E),I=Mw(S.data),{exists:j,data:M}=await et("feedback",T,`feedback migration: checking if ${T} exists`);if(j&&M){const Q=Mw(M),H=new Set(Q.map(D=>D.id)),W=I.filter(D=>!H.has(D.id));if(W.length>0||af(M.items)){const D=[...Q,...W];await Dt("feedback",T,{...M,items:D,updated_at:new Date().toISOString()},`feedback migration: merging ${W.length} items from ${E}`),v.mergedItems+=W.length}}else I.length>0&&(await Dt("feedback",T,{items:I,user_email:T,created_at:S.data.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},`feedback migration: creating ${T} from ${E}`),v.mergedItems+=I.length);try{await Nu("feedback",E,`feedback migration: deleting sanitized document ${E}`),v.deletedDocuments++}catch(Q){v.errors.push(`Failed to delete ${E}: ${Q instanceof Error?Q.message:"Unknown error"}`)}}return v});f(_)}catch(_){f({documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],mergedItems:0,deletedDocuments:0,fixedDocuments:0,errors:[_ instanceof Error?_.message:"Migration failed"]})}finally{a(!1)}}}return{status:o,isScanning:e,scanStatus:m,isMigratingFeedback:r,feedbackMigrationResult:h,migrateFeedbackDocuments:g}}async function dL(t){const{exists:e,data:n}=await et("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r={...n.accounts};for(const o of Object.keys(r))r[o]&&typeof r[o]=="object"&&(r[o]={...r[o],balance:0});const a={...n.categories};for(const o of Object.keys(a))a[o]&&typeof a[o]=="object"&&(a[o]={...a[o],balance:0});await Dt("budgets",t,{...n,accounts:r,categories:a,month_map:{},total_available:0,is_needs_recalculation:!1,updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} balances to zero`)}function hL({currentUser:t,onComplete:e}){const[n,r]=C.useState(!1),[a,o]=C.useState(!1),[u,h]=C.useState(null),[f,m]=C.useState(null),[g,_]=C.useState(null);async function v(){if(t){r(!0);try{const S=await Pt("months","delete all months: scanning for all months"),E=[],T=new Set;for(const I of S.docs){const{budget_id:j,year:M,month:Q}=I.data;T.add(j),E.push({docId:I.id,budgetId:j,year:M,month:Q})}E.sort((I,j)=>I.budgetId!==j.budgetId?I.budgetId.localeCompare(j.budgetId):I.year!==j.year?I.year-j.year:I.month-j.month),h({monthsToDelete:E,monthsCount:E.length,budgetCount:T.size})}catch{}finally{r(!1)}}}async function x(){if(!t||!u||u.monthsToDelete.length===0)return;o(!0),m(null);const S=u.monthsToDelete.length,E=new Set,T=[];for(const H of u.monthsToDelete)E.add(H.budgetId);_({phase:"deleting",deleted:0,total:S,currentMonth:null,budgetsRecalculated:0,totalBudgets:u.budgetCount,percentComplete:0});const I=u.monthsToDelete.map(H=>({collectionPath:"months",docId:H.docId}));let j=0;try{await hT(I,"delete all months: batch deleting all month documents",H=>{j=H,_({phase:"deleting",deleted:H,total:S,currentMonth:`Batch ${Math.ceil(H/500)} of ${Math.ceil(S/500)}`,budgetsRecalculated:0,totalBudgets:u.budgetCount,percentComplete:Math.round(H/S*70)})}),j=S}catch(H){T.push(`Batch delete failed: ${H instanceof Error?H.message:"Unknown error"}`)}const M=Array.from(E);let Q=0;for(const H of M){_({phase:"resetting-budgets",deleted:j,total:S,currentMonth:`Budget ${Q+1}/${M.length}`,budgetsRecalculated:Q,totalBudgets:M.length,percentComplete:70+Math.round(Q/M.length*25)});try{await dL(H),Q++}catch{Q++}}_({phase:"clearing-cache",deleted:j,total:S,currentMonth:null,budgetsRecalculated:Q,totalBudgets:M.length,percentComplete:95}),vo(),_({phase:"complete",deleted:j,total:S,currentMonth:null,budgetsRecalculated:Q,totalBudgets:M.length,percentComplete:100}),m({deleted:j,errors:T,budgetsRecalculated:Q}),o(!1),_(null),T.length===0&&(h({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:u,isScanning:n,scanStatus:v,isDeleting:a,deleteResult:f,deleteProgress:g,deleteAllMonths:x}}const Hg="sample@sample.com",ro="budget_1767746876726_xuj7nzl4l";function fL({currentUser:t,onComplete:e}){const[n,r]=C.useState(!1),[a,o]=C.useState(!1),[u,h]=C.useState(null),[f,m]=C.useState(null),[g,_]=C.useState(null);async function v(){if(t){r(!0);try{let E=(await Pt("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:Hg}])).docs;if(E.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const H=await et("budgets",ro,"delete sample user budget: checking fallback budget ID");H.exists&&H.data&&(console.log("delete sample user budget: found fallback budget",ro),E=[{id:ro,data:H.data}])}const T=[];let I=0,j=!1;for(const H of E){const W=H.id,D=H.data.name,N=(await Pt("months",`delete sample user budget: counting months for budget ${W}`,[{field:"budget_id",op:"==",value:W}])).docs.length;I+=N,T.push({budgetId:W,budgetName:D,monthCount:N}),(await Pt("payees",`delete sample user budget: checking payees for budget ${W}`,[{field:"budget_id",op:"==",value:W}])).docs.length>0&&(j=!0)}const M=[],Q=await Pt("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:Hg}]);Q.docs.length>0&&Q.docs[0].data.budget_ids?.includes(ro)&&(T.some(A=>A.budgetId===ro)||(console.log("delete sample user budget: found stale budget reference in sample user document",ro),M.push(ro))),h({budgets:T,totalBudgets:T.length,totalMonths:I,hasPayees:j,staleBudgetIds:M})}catch(S){console.error("Error scanning for sample user budgets:",S)}finally{r(!1)}}}async function x(){if(!t||!u||u.budgets.length===0&&u.staleBudgetIds.length===0)return;o(!0),m(null);const S=[];let E=0,T=0,I=0;const j=u.totalMonths,M=u.totalBudgets;_({phase:"deleting-months",monthsDeleted:0,totalMonths:j,budgetsDeleted:0,totalBudgets:M,percentComplete:0});for(const H of u.budgets)try{const D=(await Pt("months",`delete sample user budget: fetching month IDs for budget ${H.budgetId}`)).docs.filter(A=>A.data.budget_id===H.budgetId).map(A=>({collectionPath:"months",docId:A.id}));D.length>0&&(await hT(D,`delete sample user budget: deleting ${D.length} months for budget ${H.budgetId}`,A=>{E=A,_({phase:"deleting-months",monthsDeleted:E,totalMonths:j,budgetsDeleted:T,totalBudgets:M,percentComplete:Math.round(E/Math.max(j,1)*60)})}),E=D.length)}catch(W){S.push(`Failed to delete months for budget ${H.budgetId}: ${W instanceof Error?W.message:"Unknown error"}`)}_({phase:"deleting-payees",monthsDeleted:E,totalMonths:j,budgetsDeleted:T,totalBudgets:M,percentComplete:60});for(const H of u.budgets)try{await Nu("payees",H.budgetId,`delete sample user budget: deleting payees for budget ${H.budgetId}`),I++}catch{}_({phase:"deleting-budgets",monthsDeleted:E,totalMonths:j,budgetsDeleted:T,totalBudgets:M,percentComplete:70});for(const H of u.budgets)try{await Nu("budgets",H.budgetId,`delete sample user budget: deleting budget ${H.budgetId}`),T++,_({phase:"deleting-budgets",monthsDeleted:E,totalMonths:j,budgetsDeleted:T,totalBudgets:M,percentComplete:70+Math.round(T/M*10)})}catch(W){S.push(`Failed to delete budget ${H.budgetId}: ${W instanceof Error?W.message:"Unknown error"}`)}_({phase:"updating-user",monthsDeleted:E,totalMonths:j,budgetsDeleted:T,totalBudgets:M,percentComplete:80});const Q=[...u.budgets.map(H=>H.budgetId),...u.staleBudgetIds];try{const H=await Pt("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:Hg}]);if(H.docs.length>0){const W=H.docs[0],D=W.id,A=W.data,N=(A.budget_ids||[]).filter(P=>!Q.includes(P));await Dt("users",D,{...A,budget_ids:N,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${Q.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(H){S.push(`Failed to update sample user document: ${H instanceof Error?H.message:"Unknown error"}`)}_({phase:"clearing-cache",monthsDeleted:E,totalMonths:j,budgetsDeleted:T,totalBudgets:M,percentComplete:95}),vo(),_({phase:"complete",monthsDeleted:E,totalMonths:j,budgetsDeleted:T,totalBudgets:M,percentComplete:100}),m({budgetsDeleted:T,monthsDeleted:E,payeesDeleted:I,errors:S}),o(!1),_(null),S.length===0&&(h({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:u,isScanning:n,scanStatus:v,isDeleting:a,deleteResult:f,deleteProgress:g,deleteSampleUserBudget:x}}function kw(t){if(!t)return 0;let e=0;for(const n of t)ut(n.start_balance??0)&&e++,ut(n.end_balance??0)&&e++,ut(n.allocated??0)&&e++,ut(n.spent??0)&&e++,ut(n.income??0)&&e++,ut(n.expenses??0)&&e++,ut(n.net_change??0)&&e++;return e}function Ow(t){if(!t)return 0;let e=0;for(const n of t)ut(n.amount??0)&&e++;return e}async function Nw(){const t=await Pt("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,a=0;for(const _ of t.docs){const v=_.data;let x=!1;ut(v.total_available??0)&&(a++,x=!0);const S=v.accounts;if(S&&typeof S=="object")for(const T of Object.values(S))ut(T.balance??0)&&(n++,x=!0);const E=v.categories;if(E&&typeof E=="object")for(const T of Object.values(E))ut(T.balance??0)&&(r++,x=!0),ut(T.default_monthly_amount??0)&&(r++,x=!0);x&&e++}const o=await Pt("months","precision cleanup: scanning all months");let u=0,h=0,f=0,m=0,g=0;for(const _ of o.docs){const v=_.data;let x=!1;(ut(v.total_income??0)||ut(v.total_expenses??0)||ut(v.previous_month_income??0))&&(x=!0);const S=Ow(v.income);S>0&&(h+=S,x=!0);const E=Ow(v.expenses);E>0&&(f+=E,x=!0);const T=kw(v.category_balances);T>0&&(m+=T,x=!0);const I=kw(v.account_balances);I>0&&(g+=I,x=!0),x&&u++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:a,totalMonths:o.docs.length,monthsWithPrecisionIssues:u,incomeValuesWithPrecisionIssues:h,expenseValuesWithPrecisionIssues:f,categoryBalancesWithPrecisionIssues:m,accountBalancesWithPrecisionIssues:g}}function Pw(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=we(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=we(e.end_balance)),e.allocated!==void 0&&(e.allocated=we(e.allocated)),e.spent!==void 0&&(e.spent=we(e.spent)),e.income!==void 0&&(e.income=we(e.income)),e.expenses!==void 0&&(e.expenses=we(e.expenses)),e.net_change!==void 0&&(e.net_change=we(e.net_change)),e}function mL(t,e){let n=!1;ut(t.total_available??0)&&(t.total_available=we(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,u]of Object.entries(r)){const h=u;ut(h.balance??0)&&(r[o].balance=we(h.balance??0),e.accountsFixed++,n=!0)}const a=t.categories;if(a&&typeof a=="object")for(const[o,u]of Object.entries(a)){const h=u;ut(h.balance??0)&&(a[o].balance=we(h.balance??0),e.categoriesFixed++,n=!0),ut(h.default_monthly_amount??0)&&(a[o].default_monthly_amount=we(h.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function pL(t,e){let n=!1;if(ut(t.total_income??0)&&(t.total_income=we(t.total_income??0),n=!0),ut(t.total_expenses??0)&&(t.total_expenses=we(t.total_expenses??0),n=!0),ut(t.previous_month_income??0)&&(t.previous_month_income=we(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const a of t.income)ut(a.amount??0)?(r.push({...a,amount:we(a.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(a);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const a of t.expenses)ut(a.amount??0)?(r.push({...a,amount:we(a.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(a);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const a of t.category_balances)ut(a.start_balance??0)||ut(a.end_balance??0)||ut(a.allocated??0)||ut(a.spent??0)?(r.push(Pw(a)),e.categoryBalancesFixed++,n=!0):r.push(a);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const a of t.account_balances)ut(a.start_balance??0)||ut(a.end_balance??0)||ut(a.income??0)||ut(a.expenses??0)||ut(a.net_change??0)?(r.push(Pw(a)),e.accountBalancesFixed++,n=!0):r.push(a);t.account_balances=r}return{fixed:n,data:t}}function gL(t,e,n){const r={...t.data},{fixed:a,data:o}=mL(r,n),u=a?{budgetId:t.id,data:o}:null;a&&n.budgetsProcessed++;const h=[];let f=!1;for(const m of e){const g={...m.data},{fixed:_,data:v}=pL(g,n);_&&(n.monthsProcessed++,f=!0),h.push(v)}return{budgetUpdate:u,fixedMonths:h,hasMonthFixes:f}}async function yL(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await br("precision cleanup"),r=[],a=[];for(const o of e)try{const u=n.get(o.id)||[],{budgetUpdate:h,fixedMonths:f,hasMonthFixes:m}=gL(o,u,t);h&&r.push(h),(m||f.length>0)&&a.push({budgetId:o.id,months:f})}catch(u){t.errors.push(`Budget ${o.id}: ${u instanceof Error?u.message:String(u)}`)}if(r.length>0)try{await CT(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:u}of a)try{await TT(o,u,"precision cleanup")}catch(h){t.errors.push(`Budget ${o} recalc: ${h instanceof Error?h.message:String(h)}`)}return t}function _L({currentUser:t,onComplete:e}){const[n,r]=C.useState(null),[a,o]=C.useState(!1),[u,h]=C.useState(!1),[f,m]=C.useState(null),[g,_]=C.useState(null),v=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,x=v>0,S=C.useCallback(async()=>{if(t){o(!0),_(null);try{const T=await Nw();r(T),m(null)}catch(T){_(T instanceof Error?T.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),E=C.useCallback(async()=>{if(!(!t||!x)){h(!0),_(null);try{const T=await ic(()=>yL());m(T);const I=await Nw();r(I),e?.()}catch(T){_(T instanceof Error?T.message:"Failed to run precision cleanup")}finally{h(!1)}}},[t,x,e]);return C.useEffect(()=>{t&&!n&&!a&&S()},[t,n,a,S]),{status:n,isScanning:a,isRunning:u,result:f,error:g,totalIssues:v,hasIssues:x,hasData:n!==null,scan:S,runCleanup:E}}const bL=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],vL=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function bm(t){return!t||Le(t)?!0:bL.includes(t)}function vm(t){return!t||Ze(t)?!0:vL.includes(t)}function NT(t){return bm(t.account_id)||vm(t.category_id)}function xL(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:bm(t.account_id)?Tt:t.account_id,category_id:vm(t.category_id)?Rt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function SL(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],a=[],o=[];let u=0,h=0;for(const m of n)NT(m)?(bm(m.account_id)&&!Le(m.account_id)&&u++,vm(m.category_id)&&!Ze(m.category_id)&&h++,o.push(xL(m))):a.push(m);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:yn({...e,expenses:a,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:u,invalidCategoriesFixed:h}}}async function wL(){const{budgets:t,monthsByBudget:e}=await br("expense-to-adjustment-scan");let n=0,r=0,a=0,o=0;for(const u of t){const h=e.get(u.id)||[];n+=h.length;for(const f of h){const g=f.data.expenses||[];for(const _ of g)NT(_)&&(r++,bm(_.account_id)&&!Le(_.account_id)&&a++,vm(_.category_id)&&!Ze(_.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:a,invalidCategoriesToFix:o}}async function EL(){const{budgets:t,monthsByBudget:e}=await br("expense-to-adjustment-migration"),n=[];let r=0,a=0,o=0;const u=[];for(const h of t){const f=e.get(h.id)||[];for(const m of f)try{const{needsUpdate:g,updatedMonth:_,stats:v}=SL(m);g&&_&&(n.push({budgetId:h.id,year:m.year,month:m.month,data:_}),r+=v.expensesMigrated,a+=v.invalidAccountsFixed,o+=v.invalidCategoriesFixed)}catch(g){u.push(`Month ${m.year}/${m.month} in budget ${h.id}: ${g instanceof Error?g.message:String(g)}`)}}return n.length>0&&await id(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:a,invalidCategoriesFixed:o,errors:u}}function CL({currentUser:t,onComplete:e}){const[n,r]=C.useState(!1),[a,o]=C.useState(!1),[u,h]=C.useState(null),[f,m]=C.useState(null);async function g(){if(t){r(!0);try{const x=await wL();h(x)}catch(x){console.error("Failed to scan for expense to adjustment migration:",x)}finally{r(!1)}}}async function _(){if(t){o(!0),m(null);try{const x=await ic(()=>EL());m(x),e?.()}catch(x){m({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{o(!1)}}}const v=u!==null&&u.expensesToMigrate>0;return{status:u,isScanning:n,scanStatus:g,hasItemsToMigrate:v,isRunning:a,result:f,runMigration:_}}function PT(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const a=t.accounts;if(a)for(const o of Object.keys(a))n.add(o);return{categoryIds:e,accountIds:n}}function sa(t,e){return!t||Ze(t)?!1:!e.has(t)}function js(t,e){return!t||Le(t)?!1:!e.has(t)}function TL(t,e){const n=t.data;let r=0,a=0,o=0,u=0,h=0,f=0,m=!1;const g=(n.expenses||[]).map(E=>{const T={...E};let I=!1;return sa(E.category_id,e.categoryIds)&&(T.category_id=Rt,r++,I=!0),js(E.account_id,e.accountIds)&&(T.account_id=Tt,a++,I=!0),I&&(o++,m=!0),T}),_=(n.income||[]).map(E=>{const T={...E};let I=!1;return js(E.account_id,e.accountIds)&&(T.account_id=Tt,a++,I=!0),I&&(u++,m=!0),T}),v=(n.transfers||[]).map(E=>{const T={...E};let I=!1;return sa(E.from_category_id,e.categoryIds)&&(T.from_category_id=Rt,r++,I=!0),sa(E.to_category_id,e.categoryIds)&&(T.to_category_id=Rt,r++,I=!0),js(E.from_account_id,e.accountIds)&&(T.from_account_id=Tt,a++,I=!0),js(E.to_account_id,e.accountIds)&&(T.to_account_id=Tt,a++,I=!0),I&&(h++,m=!0),T}),x=(n.adjustments||[]).map(E=>{const T={...E};let I=!1;return sa(E.category_id,e.categoryIds)&&(T.category_id=Rt,r++,I=!0),js(E.account_id,e.accountIds)&&(T.account_id=Tt,a++,I=!0),I&&(f++,m=!0),T});return m?{needsUpdate:!0,updatedMonth:{...n,expenses:g,income:_,transfers:v,adjustments:x,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:a,affectedExpenses:o,affectedIncome:u,affectedTransfers:h,affectedAdjustments:f}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function AL(){const{budgets:t,monthsByBudget:e}=await br("orphaned-id-scan");let n=0,r=0,a=0,o=0,u=0,h=0,f=0;for(const m of t){const g=PT(m.data),_=e.get(m.id)||[];n+=_.length;for(const v of _){const x=v.data;for(const S of x.expenses||[]){let E=!1;sa(S.category_id,g.categoryIds)&&(r++,E=!0),js(S.account_id,g.accountIds)&&(a++,E=!0),E&&o++}for(const S of x.income||[])js(S.account_id,g.accountIds)&&(a++,u++);for(const S of x.transfers||[]){let E=!1;sa(S.from_category_id,g.categoryIds)&&(r++,E=!0),sa(S.to_category_id,g.categoryIds)&&(r++,E=!0),js(S.from_account_id,g.accountIds)&&(a++,E=!0),js(S.to_account_id,g.accountIds)&&(a++,E=!0),E&&h++}for(const S of x.adjustments||[]){let E=!1;sa(S.category_id,g.categoryIds)&&(r++,E=!0),js(S.account_id,g.accountIds)&&(a++,E=!0),E&&f++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:a,affectedExpenses:o,affectedIncome:u,affectedTransfers:h,affectedAdjustments:f}}async function jL(){const{budgets:t,monthsByBudget:e}=await br("orphaned-id-cleanup"),n=[];let r=0,a=0;const o=[];for(const u of t){const h=PT(u.data),f=e.get(u.id)||[];for(const m of f)try{const{needsUpdate:g,updatedMonth:_,stats:v}=TL(m,h);g&&_&&(n.push({budgetId:u.id,year:m.year,month:m.month,data:_}),r+=v.categoryIdsFixed,a+=v.accountIdsFixed)}catch(g){o.push(`Month ${m.year}/${m.month} in budget ${u.id}: ${g instanceof Error?g.message:String(g)}`)}}return n.length>0&&await id(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:a,errors:o}}function RL({currentUser:t,onComplete:e}){const[n,r]=C.useState(!1),[a,o]=C.useState(!1),[u,h]=C.useState(null),[f,m]=C.useState(null);async function g(){if(t){r(!0);try{const x=await AL();h(x)}catch(x){console.error("Failed to scan for orphaned IDs:",x)}finally{r(!1)}}}async function _(){if(t){o(!0),m(null);try{const x=await ic(()=>jL());m(x),e?.()}catch(x){m({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{o(!1)}}}const v=u!==null&&(u.orphanedCategoryIds>0||u.orphanedAccountIds>0);return{status:u,isScanning:n,scanStatus:g,hasItemsToFix:v,isRunning:a,result:f,runMigration:_}}function IL(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,a=Ze(t.category_id)&&Ze(e.category_id),o=!Le(t.account_id)&&!Le(e.account_id),u=t.account_id!==e.account_id;if(a&&o&&u)return{negative:n,positive:r,type:"account"};const h=Le(t.account_id)&&Le(e.account_id),f=!Ze(t.category_id)&&!Ze(e.category_id),m=t.category_id!==e.category_id;return h&&f&&m?{negative:n,positive:r,type:"category"}:null}function BT(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let a=r+1;a<t.length;a++){if(n.has(t[a].id))continue;const o=IL(t[r],t[a]);if(o){e.push(o),n.add(t[r].id),n.add(t[a].id);break}}return e}function DL(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Rt,to_category_id:Rt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Tt,to_account_id:Tt,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function ML(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],a=BT(n);if(a.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=a.map(DL),u=new Set;for(const m of a)u.add(m.negative.id),u.add(m.positive.id);const h=n.filter(m=>!u.has(m.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:h,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:a.length,adjustmentsRemoved:u.size}}}async function kL(){const{budgets:t,monthsByBudget:e}=await br("adjustments-to-transfers-scan");let n=0,r=0,a=0,o=0;for(const u of t){const h=e.get(u.id)||[];n+=h.length;for(const f of h){const g=f.data.adjustments||[],_=BT(g);r+=_.length;for(const v of _)v.type==="account"?a++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:a,categoryTransferPairs:o}}async function OL(){const{budgets:t,monthsByBudget:e}=await br("adjustments-to-transfers-migration"),n=[];let r=0,a=0;const o=[];for(const u of t){const h=e.get(u.id)||[];for(const f of h)try{const{needsUpdate:m,updatedMonth:g,stats:_}=ML(f);m&&g&&(n.push({budgetId:u.id,year:f.year,month:f.month,data:g}),r+=_.pairsConverted,a+=_.adjustmentsRemoved)}catch(m){o.push(`Month ${f.year}/${f.month} in budget ${u.id}: ${m instanceof Error?m.message:String(m)}`)}}return n.length>0&&await id(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:a,errors:o}}function NL({currentUser:t,onComplete:e}){const[n,r]=C.useState(!1),[a,o]=C.useState(!1),[u,h]=C.useState(null),[f,m]=C.useState(null);async function g(){if(t){r(!0);try{const x=await kL();h(x)}catch(x){console.error("Failed to scan for adjustment pairs:",x)}finally{r(!1)}}}async function _(){if(t){o(!0),m(null);try{const x=await ic(()=>OL());m(x),e?.()}catch(x){m({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{o(!1)}}}const v=u!==null&&u.pairsFound>0;return{status:u,isScanning:n,scanStatus:g,hasPairsToConvert:v,isRunning:a,result:f,runMigration:_}}function LT(t){const e=[];let n="",r=!1;for(let a=0;a<t.length;a++){const o=t[a];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function UT(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function zT(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),a=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(a)||n<1||n>12||r<1||r>31?null:{year:a,month:n,day:r}}function PL(t){const e=t.toLowerCase().trim();return e==="income"?"income":e==="spend"?"spend":e==="allocation"||e==="allocations"?"allocation":null}function FT(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function BL(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const a=LT(r);if(a.length<6)continue;const[o,u,h,f,m,g,_,v]=a;if(o.toLowerCase()==="type")continue;const x=PL(o);if(!x)continue;const S=zT(u);if(!S)continue;const E=UT(g),T=FT(v||"");n.push({recordType:x,date:u,year:S.year,month:S.month,day:S.day,payee:h,category:f,account:m,amount:E,description:_||"",cleared:T,rawLine:r})}return n}function VT(t,e,n){const r=e.toString().padStart(2,"0"),a=n.toString().padStart(2,"0");return`${t}-${r}-${a}`}function LL(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function $T(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const a=LT(r);if(a.length<5)continue;const[o,u,h,f,m,g,_]=a;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const v=zT(o);if(!v)continue;const x=LL(u,h),S=UT(m),E=FT(_||"");n.push({recordType:x,date:o,year:v.year,month:v.month,day:v.day,payee:u,category:h,account:f,amount:S,description:g||"",cleared:E,rawLine:r})}return n}function UL(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function zL(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function FL(t){const e=Le(t.account_id)||!t.account_id||t.account_id.trim()==="",n=Ze(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function VL(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const a=Le(t.from_account_id),o=Le(t.to_account_id),u=Ze(t.from_category_id),h=Ze(t.to_category_id);return a&&o&&u&&h?"All from/to account and category IDs are NO_* (must involve at least one real entity)":a&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":u&&h&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function qh(t,e,n,r,a){return t.filter(o=>{const[u,h,f]=e.split("-").map(Number);return o.year!==u||o.month!==h||o.day!==f||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||a&&o.description&&o.description.toLowerCase().includes(a.toLowerCase()),!0)})}async function $L(t){const e=[];let n=0,r=0,a=0,o=0;const u=t?$T(t):[],{budgets:h,monthsByBudget:f}=await br("account-category-validation");for(const m of h){const g=f.get(m.id)||[];for(const _ of g){const v=_.data,x=`${v.year}-${String(v.month).padStart(2,"0")}`,S=v.income||[];n+=S.length;for(const j of S){const M=UL(j);M&&e.push({budgetId:m.id,monthKey:x,transactionType:"income",transactionId:j.id,violation:M,transactionDetails:{date:j.date,amount:j.amount,payee:j.payee,description:j.description,accountId:j.account_id},potentialSeedMatches:qh(u,j.date,j.amount,j.payee,j.description)})}const E=v.expenses||[];r+=E.length;for(const j of E){const M=zL(j);M&&e.push({budgetId:m.id,monthKey:x,transactionType:"expense",transactionId:j.id,violation:M,transactionDetails:{date:j.date,amount:j.amount,payee:j.payee,description:j.description,accountId:j.account_id,categoryId:j.category_id},potentialSeedMatches:qh(u,j.date,j.amount,j.payee,j.description)})}const T=v.adjustments||[];a+=T.length;for(const j of T){const M=FL(j);M&&e.push({budgetId:m.id,monthKey:x,transactionType:"adjustment",transactionId:j.id,violation:M,transactionDetails:{date:j.date,amount:j.amount,description:j.description,accountId:j.account_id,categoryId:j.category_id},potentialSeedMatches:qh(u,j.date,j.amount,void 0,j.description)})}const I=v.transfers||[];o+=I.length;for(const j of I){const M=VL(j);M&&e.push({budgetId:m.id,monthKey:x,transactionType:"transfer",transactionId:j.id,violation:M,transactionDetails:{date:j.date,amount:j.amount,description:j.description,fromAccountId:j.from_account_id,toAccountId:j.to_account_id,fromCategoryId:j.from_category_id,toCategoryId:j.to_category_id},potentialSeedMatches:qh(u,j.date,j.amount,void 0,j.description)})}}}return e.sort((m,g)=>{const _=m.monthKey.localeCompare(g.monthKey);return _!==0?_:m.transactionType.localeCompare(g.transactionType)}),{totalBudgets:h.length,totalMonths:Array.from(f.values()).reduce((m,g)=>m+g.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:a,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function HL(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,a]of n){e.push("",`## ${r.toUpperCase()} (${a.length} violations)`,"");for(const o of a){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const u of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${u.rawLine}`,`        Type: ${u.recordType}, Date: ${u.date}, Payee: ${u.payee}`,`        Category: ${u.category}, Account: ${u.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function qL({currentUser:t}){const[e,n]=C.useState(!1),[r,a]=C.useState(null),[o,u]=C.useState(null);async function h(f){if(t){n(!0),a(null),u(null);try{const m=await $L(f);a(m),u(HL(m))}catch(m){console.error("Failed to scan transactions:",m),u(`Error scanning: ${m instanceof Error?m.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:h,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}const GL=[{id:"adjustment_import_1767473622525_qzkq34i7r",amount:14877.86,date:"2020-08-23",description:"Starting Balance on app switchover",targetAccount:"Alerus 401K Eide Bailly",targetCategory:null},{id:"adjustment_import_1767473622530_nj6pnwlb2",amount:-2e3,date:"2022-03-01",description:"Transfer",targetAccount:null,targetCategory:"House"}];async function QL(){const{budgets:t,monthsByBudget:e}=await br("hidden-field-migration-scan");let n=0,r=0,a=0,o=0;const u=[];for(const h of t){const f=h.data,m=f.accounts;if(m&&typeof m=="object")for(const v of Object.values(m))v.is_hidden===void 0&&n++;const g=f.categories;if(g&&typeof g=="object")for(const v of Object.values(g))v.is_hidden===void 0&&r++;const _=e.get(h.id)||[];o+=_.length;for(const v of _){const x=v.data,S=`${x.year}-${String(x.month).padStart(2,"0")}`;for(const E of x.adjustments||[]){const T=Le(E.account_id)||!E.account_id,I=Ze(E.category_id)||!E.category_id;T&&I&&(a++,u.push({monthKey:S,id:E.id,description:E.description||"",amount:E.amount,accountId:E.account_id,categoryId:E.category_id}))}}}return{totalBudgets:t.length,totalMonths:o,accountsNeedingField:n,categoriesNeedingField:r,adjustmentsToFix:a,adjustmentDetails:u}}async function WL(t){const e={budgetsProcessed:0,accountsUpdated:0,categoriesUpdated:0,hiddenAccountsCreated:0,hiddenCategoriesCreated:0,adjustmentsFixed:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await br("hidden-field-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const a=[],o=[];t.setStage("Processing budgets...");for(let u=0;u<n.length;u++){const h=n[u];t.updateItemProgress(u+1,n.length,`Budget: ${h.data.name||h.id}`);try{const f={...h.data};let m=!1;const g={...f.accounts||{}},_={...f.categories||{}};for(const[I,j]of Object.entries(g))j.is_hidden===void 0&&(g[I]={...j,is_hidden:!1},e.accountsUpdated++,m=!0);for(const[I,j]of Object.entries(_))j.is_hidden===void 0&&(_[I]={...j,is_hidden:!1},e.categoriesUpdated++,m=!0);let v=null;const x="Alerus 401K Eide Bailly";for(const[I,j]of Object.entries(g))if(j.nickname?.toLowerCase()===x.toLowerCase()){v=I;break}if(v)g[v].is_hidden||(g[v]={...g[v],is_hidden:!0},m=!0);else{v=`account_hidden_${Date.now()}_alerus`;const I=Math.max(0,...Object.values(g).map(j=>j.sort_order||0));g[v]={nickname:x,description:"Historical 401K account (hidden)",balance:0,account_group_id:null,sort_order:I+1,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!1,is_active:!0,is_hidden:!0},e.hiddenAccountsCreated++,m=!0}let S=null;const E="House";for(const[I,j]of Object.entries(_))if(j.name?.toLowerCase()===E.toLowerCase()){S=I;break}if(S)_[S].is_hidden||(_[S]={..._[S],is_hidden:!0},m=!0);else{S=`category_hidden_${Date.now()}_house`;const I=Math.max(0,...Object.values(_).map(j=>j.sort_order||0));_[S]={name:E,description:"Historical house-related transactions (hidden)",category_group_id:null,sort_order:I+1,default_monthly_amount:0,default_monthly_type:"fixed",balance:0,is_hidden:!0},e.hiddenCategoriesCreated++,m=!0}const T=r.get(h.id)||[];for(const I of T){const j=I.data;let M=!1;const Q=(j.adjustments||[]).map(H=>{const W=Le(H.account_id)||!H.account_id,D=Ze(H.category_id)||!H.category_id;if(W&&D){const A=GL.find(N=>N.id===H.id||Math.abs(N.amount-H.amount)<.01&&N.date===H.date&&N.description.toLowerCase()===(H.description||"").toLowerCase());if(A){const N={...H};return A.targetAccount&&(N.account_id=v),A.targetCategory&&(N.category_id=S),e.adjustmentsFixed++,M=!0,N}}return H});M&&o.push({budgetId:h.id,year:j.year,month:j.month,data:{...j,adjustments:Q}})}m&&(a.push({budgetId:h.id,data:{...f,accounts:g,categories:_,updated_at:new Date().toISOString()}}),e.budgetsProcessed++)}catch(f){e.errors.push(`Budget ${h.id}: ${f instanceof Error?f.message:String(f)}`)}}return a.length>0&&(t.setStage("Writing budget updates..."),t.setProgress(null),t.setCurrentItem(`${a.length} budget(s) to update`),await CT(a,"hidden-field-migration")),o.length>0&&(t.setStage("Writing month updates and recalculating..."),t.setCurrentItem(`${o.length} month(s) to update`),await AT(o,"hidden-field-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function KL({currentUser:t}){const[e,n]=C.useState(!1),[r,a]=C.useState(!1),[o,u]=C.useState(null),[h,f]=C.useState(null),{runMigrationWithProgress:m}=B0();async function g(){if(t){n(!0);try{const S=await QL();u(S)}catch(S){console.error("Failed to scan hidden field status:",S)}finally{n(!1)}}}async function _(){if(t){a(!0),f(null);try{const S=await m("Hidden Field Migration",E=>WL(E));f(S)}catch(S){f({budgetsProcessed:0,accountsUpdated:0,categoriesUpdated:0,hiddenAccountsCreated:0,hiddenCategoriesCreated:0,adjustmentsFixed:0,errors:[S instanceof Error?S.message:"Unknown error"]})}finally{a(!1)}}}const v=o!==null&&(o.accountsNeedingField>0||o.categoriesNeedingField>0||o.adjustmentsToFix>0),x=o!==null?o.accountsNeedingField+o.categoriesNeedingField+o.adjustmentsToFix:0;return{isScanning:e,isRunning:r,status:o,result:h,scanStatus:g,runMigration:_,needsMigration:v,totalItemsToFix:x}}function of(t){return t==="no_category"||t==="NO_CATEGORY"}function YL(t,e){const n={};for(const r of t)r.from_category_id&&!of(r.from_category_id)&&(n[r.from_category_id]=(n[r.from_category_id]||0)-r.amount),r.to_category_id&&!of(r.to_category_id)&&(n[r.to_category_id]=(n[r.to_category_id]||0)+r.amount);for(const r of e)r.category_id&&!of(r.category_id)&&(n[r.category_id]=(n[r.category_id]||0)+r.amount);return n}function XL(t,e,n){const r=Object.keys(e).filter(v=>!of(v)),a=Object.keys(n),o={},u={};r.forEach(v=>{o[v]=0}),a.forEach(v=>{u[v]=0});const h={};r.forEach(v=>{h[v]=[]});const f=[],m=[];for(const v of t){const x=v.data,S=`${v.year}-${String(v.month).padStart(2,"0")}`,E=x.income||[],T=x.expenses||[],I=x.transfers||[],j=x.adjustments||[],M=x.category_balances||[],Q=x.account_balances||[],H=x.are_allocations_finalized===!0,W={};for(const O of M)W[O.category_id]=O;const D=YL(I,j);for(const O of r){const G=we(o[O]||0);let Y=0;H&&W[O]&&(Y=we(W[O].allocated||0));const U=we(T.filter(re=>re.category_id===O).reduce((re,z)=>re+z.amount,0)),F=we(D[O]||0),K=we(G+Y+U+F),Z=we(W[O]?.end_balance??0);h[O].push({month:S,startBalance:G,allocated:Y,spent:U,adjustment:F,calculatedEnd:K,storedEnd:Z,endDiscrepancy:we(K-Z)}),o[O]=Z}for(const O of a){const G=we(E.filter(Z=>Z.account_id===O).reduce((Z,re)=>Z+re.amount,0)),Y=we(T.filter(Z=>Z.account_id===O).reduce((Z,re)=>Z+re.amount,0)),U=we(I.filter(Z=>Z.to_account_id===O).reduce((Z,re)=>Z+re.amount,0)),F=we(I.filter(Z=>Z.from_account_id===O).reduce((Z,re)=>Z+re.amount,0)),K=we(j.filter(Z=>Z.account_id===O).reduce((Z,re)=>Z+re.amount,0));u[O]+=G+Y+U-F+K}const A=we(E.reduce((O,G)=>O+G.amount,0)),N=we(T.reduce((O,G)=>O+G.amount,0)),P=we(M.reduce((O,G)=>O+(G.allocated||0),0)),L=we(I.reduce((O,G)=>O+G.amount,0)),B=we(j.reduce((O,G)=>O+G.amount,0));f.push({year:v.year,month:v.month,monthKey:S,totalIncome:A,totalExpenses:N,totalAllocated:P,totalTransfers:L,totalAdjustments:B,allocationsFinalized:H,expenseCount:T.length,incomeCount:E.length,transferCount:I.length,adjustmentCount:j.length}),m.push({year:v.year,month:v.month,income:E,expenses:T,transfers:I,adjustments:j,categoryBalances:M,accountBalances:Q,areAllocationsFinalized:H})}const g=r.map(v=>{const x=we(e[v]?.balance??0),S=we(o[v]);return{categoryId:v,categoryName:e[v]?.name||"Unknown",storedAllTimeBalance:x,calculatedAllTimeBalance:S,discrepancy:we(S-x),monthBreakdown:h[v]}}),_=a.map(v=>{const x=we(n[v]?.balance??0),S=we(u[v]);return{accountId:v,accountName:n[v]?.name||"Unknown",storedBalance:x,calculatedBalance:S,discrepancy:we(S-x)}});return{categoryBalances:g,accountBalances:_,monthSummaries:f,rawMonthData:m}}function JL({currentUser:t}){const[e,n]=C.useState(!1),[r,a]=C.useState(null),[o,u]=C.useState(null);async function h(){if(!t){u("Must be logged in to download diagnostics");return}n(!0),u(null),a({phase:"reading",current:0,total:1,percentComplete:0});try{a({phase:"reading",current:0,total:1,percentComplete:10});const{budgets:f,monthsByBudget:m}=await br("diagnostic-download");a({phase:"analyzing",current:0,total:f.length,percentComplete:30});const g=[];let _=0,v=0,x=0,S=0;for(let M=0;M<f.length;M++){const Q=f[M],H=m.get(Q.id)||[];_+=H.length;const W=Q.data,D=W.categories||{},A=W.accounts||{};v+=Object.keys(D).length,x+=Object.keys(A).length;const{categoryBalances:N,accountBalances:P,monthSummaries:L,rawMonthData:B}=XL(H,D,A),O=N.filter(F=>Math.abs(F.discrepancy)>.01).length,G=P.filter(F=>Math.abs(F.discrepancy)>.01).length,Y=we(N.reduce((F,K)=>F+K.discrepancy,0)),U=we(P.reduce((F,K)=>F+K.discrepancy,0));(O>0||G>0)&&S++,g.push({budgetId:Q.id,budgetName:W.name||"Unknown Budget",totalAvailable:W.total_available??0,categoryBalances:N,accountBalances:P,monthSummaries:L,rawMonthData:B,discrepancySummary:{totalCategoryDiscrepancy:Y,totalAccountDiscrepancy:U,categoriesWithDiscrepancies:O,accountsWithDiscrepancies:G}}),a({phase:"analyzing",current:M+1,total:f.length,percentComplete:30+Math.round((M+1)/f.length*60)})}const E={timestamp:new Date().toISOString(),budgets:g,globalSummary:{totalBudgets:f.length,totalMonths:_,totalCategories:v,totalAccounts:x,budgetsWithDiscrepancies:S}};a({phase:"complete",current:1,total:1,percentComplete:100});const T=new Blob([JSON.stringify(E,null,2)],{type:"application/json"}),I=URL.createObjectURL(T),j=document.createElement("a");j.href=I,j.download=`budget-diagnostic-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(I)}catch(f){u(f instanceof Error?f.message:"Unknown error during download")}finally{n(!1),a(null)}}return{isDownloading:e,progress:r,error:o,downloadDiagnostics:h}}async function ZL(t){const e=JSON.parse(t),{budgets:n,monthsByBudget:r}=await br("restore-diagnostic-scan"),a={diagnosticTimestamp:e.timestamp,budgetsInFile:e.budgets.length,monthsToRestore:0,transfersToRestore:0,adjustmentsToRestore:0,monthDetails:[]};for(const o of e.budgets){if(!n.find(f=>f.id===o.budgetId))continue;const h=r.get(o.budgetId)||[];for(const f of o.rawMonthData){const m=f.transfers||[],g=f.adjustments||[];if(m.length===0&&g.length===0)continue;const v=h.find(I=>I.year===f.year&&I.month===f.month)?.data,x=(v?.transfers||[]).length,S=(v?.adjustments||[]).length,E=m.length>x,T=g.length>S;(E||T)&&(a.monthsToRestore++,a.transfersToRestore+=Math.max(0,m.length-x),a.adjustmentsToRestore+=Math.max(0,g.length-S),a.monthDetails.push({budgetId:o.budgetId,year:f.year,month:f.month,currentTransfers:x,diagnosticTransfers:m.length,currentAdjustments:S,diagnosticAdjustments:g.length}))}}return a}async function e6(t,e){const n={success:!1,monthsUpdated:0,transfersRestored:0,adjustmentsRestored:0,errors:[]};try{e.setStage("Parsing diagnostic file..."),e.setProgress(null);const r=JSON.parse(t);e.setDetails(`Loaded diagnostic from ${r.timestamp}`),e.setStage("Reading current database state...");const{budgets:a,monthsByBudget:o}=await br("restore-diagnostic-run");e.setDetails(`Found ${a.length} budget(s)`);const u=[];e.setStage("Preparing updates...");for(const h of r.budgets){if(!a.find(g=>g.id===h.budgetId)){n.errors.push(`Budget ${h.budgetId} not found in database`);continue}const m=o.get(h.budgetId)||[];for(const g of h.rawMonthData){const _=g.transfers||[],v=g.adjustments||[];if(_.length===0&&v.length===0)continue;const x=m.find(M=>M.year===g.year&&M.month===g.month);if(!x)continue;const S=x.data,E=S.transfers||[],T=S.adjustments||[],I=_.length>E.length,j=v.length>T.length;if(I||j){const M={budget_id:h.budgetId,year_month_ordinal:S.year_month_ordinal,year:g.year,month:g.month,income:S.income||[],total_income:S.total_income??0,previous_month_income:S.previous_month_income??0,expenses:S.expenses||[],total_expenses:S.total_expenses??0,transfers:I?_:E,adjustments:j?v:T,account_balances:S.account_balances||[],category_balances:S.category_balances||[],are_allocations_finalized:S.are_allocations_finalized??!1,created_at:S.created_at,updated_at:new Date().toISOString()};u.push({budgetId:h.budgetId,year:g.year,month:g.month,data:M}),I&&(n.transfersRestored+=_.length-E.length),j&&(n.adjustmentsRestored+=v.length-T.length)}}}if(u.length===0)return e.setStage("No updates needed"),e.setDetails("Database already matches diagnostic file"),n.success=!0,n;e.setStage("Writing updates and recalculating..."),e.setDetails(`Updating ${u.length} month(s)`),await AT(u,"restore-from-diagnostic"),n.monthsUpdated=u.length,n.success=!0,e.setStage("Complete!"),e.setDetails(`Restored ${n.transfersRestored} transfers and ${n.adjustmentsRestored} adjustments`)}catch(r){n.errors.push(r instanceof Error?r.message:String(r))}return n}function t6(){const[t,e]=C.useState(null),[n,r]=C.useState(null),[a,o]=C.useState(!1),[u,h]=C.useState(!1),[f,m]=C.useState(null),{runMigrationWithProgress:g}=B0();return{status:t,result:n,isScanning:a,isRunning:u,scan:async x=>{o(!0),r(null),m(x);try{const S=await ZL(x);e(S)}catch(S){throw e(null),S}finally{o(!1)}},run:async()=>{if(f){h(!0);try{const x=await g("Restore from Diagnostic",S=>e6(f,S));r(x)}catch(x){r({success:!1,monthsUpdated:0,transfersRestored:0,adjustmentsRestored:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{h(!1)}}}}}const Of=["n/a","na","none","-",""];function HT(t,e,n){const r=t.toLowerCase();for(const[a,o]of Object.entries(e))if((n?o.nickname:o.name).toLowerCase()===r)return a;return null}function qT(t,e,n){if(Of.includes(t.toLowerCase().trim()))return Rt;const r=n.get(t);return r?r.newId:HT(t,e,!1)}function GT(t,e,n){if(Of.includes(t.toLowerCase().trim()))return Tt;const r=n.get(t);return r?r.newId:HT(t,e,!0)}function n6(t,e,n,r){const a=[];let o=0,u=0;const h=e.income.length,f=[];for(const g of t){const _=GT(g.account,n,r);if(!_){a.push(`Unknown account "${g.account}" for income on ${g.date}`),u++;continue}const v={id:`income_import_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:g.amount,account_id:_,date:VT(g.year,g.month,g.day),payee:g.payee,description:g.description,cleared:g.cleared,created_at:new Date().toISOString()};f.push(v),o++}return{monthData:yn({...e,income:f,updated_at:new Date().toISOString()}),imported:o,skipped:u,errors:a,cleared:h}}function r6(t,e,n,r,a,o){const u=[];let h=0,f=0;const m=e.expenses.length,g=[];for(const v of t){const x=qT(v.category,n,a);if(!x){u.push(`Unknown category "${v.category}" for expense on ${v.date}`),f++;continue}const S=GT(v.account,r,o);if(!S){u.push(`Unknown account "${v.account}" for expense on ${v.date}`),f++;continue}const E={id:`expense_import_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:v.amount,category_id:x,account_id:S,date:VT(v.year,v.month,v.day),payee:v.payee,description:v.description,cleared:v.cleared,created_at:new Date().toISOString()};g.push(E),h++}return{monthData:yn({...e,expenses:g,updated_at:new Date().toISOString()}),imported:h,skipped:f,errors:u,cleared:m}}function s6(t,e,n,r){const a=[];let o=0,u=0;const h=e.category_balances.filter(g=>g.allocated>0).length,f=new Map;for(const g of t){const _=qT(g.category,n,r);if(!_){a.push(`Unknown category "${g.category}" for allocation on ${g.date}`),u++;continue}const v=f.get(_)||0;f.set(_,v+g.amount),o++}const m=e.category_balances.map(g=>{const _=f.get(g.category_id);return _!==void 0?{...g,allocated:_,end_balance:g.start_balance+_-g.spent}:{...g,allocated:0,end_balance:g.start_balance-g.spent}});for(const[g,_]of f)m.find(v=>v.category_id===g)||m.push({category_id:g,start_balance:0,allocated:_,spent:0,end_balance:_});return{monthData:{...e,category_balances:m,are_allocations_finalized:!0,updated_at:new Date().toISOString()},imported:o,skipped:u,errors:a,cleared:h}}function i6(t,e,n,r,a){const o=new Set(Object.values(e).map(m=>m.name.toLowerCase())),u=new Set(Object.values(n).map(m=>m.nickname.toLowerCase())),h=new Set,f=new Set;for(const m of t){if(m.recordType==="spend"||m.recordType==="allocation"){const g=m.category.toLowerCase().trim(),_=o.has(g),v=r.has(m.category),x=Of.includes(g);!_&&!v&&!x&&m.category&&h.add(m.category)}if(m.recordType==="spend"||m.recordType==="income"){const g=m.account.toLowerCase().trim(),_=u.has(g),v=a.has(m.account),x=Of.includes(g);!_&&!v&&!x&&m.account&&f.add(m.account)}}return{unmappedCategories:Array.from(h).sort(),unmappedAccounts:Array.from(f).sort()}}const Bw=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function a6(t,e,n){const r=Object.entries(t).reduce((o,[,u])=>{const h=u.account_group_id?n[u.account_group_id]:void 0,f=h?.on_budget!==void 0?h.on_budget:u.on_budget!==!1,m=h?.is_active!==void 0?h.is_active:u.is_active!==!1;return f&&m?o+(u.balance??0):o},0),a=Object.values(e).reduce((o,u)=>{const h=u.balance??0;return o+(h>0?h:0)},0);return r-a}async function o6(t,e,n){const{exists:r,data:a}=await et("budgets",t,"[seed import] reading budget for final update");if(!r||!a)throw new Error(`Budget ${t} not found`);const o={...a.accounts};for(const[_,v]of Object.entries(e.accountEndBalances))o[_]&&(o[_]={...o[_],balance:v});const u={...a.categories};for(const[_,v]of Object.entries(e.categoryEndBalances))u[_]&&(u[_]={...u[_],balance:v});const f={...a.month_map||{}};for(const{info:_}of n)f[_.ordinal]={needs_recalculation:!1};const m=a6(o,u,a.account_groups||{});await Dt("budgets",t,{...a,accounts:o,categories:u,total_available:m,is_needs_recalculation:!1,month_map:f,updated_at:new Date().toISOString()},"[seed import] saving final balances");const g=Oe.getQueryData(Ce.budget(t));if(g){const _={};for(const[x,S]of Object.entries(g.accounts)){const E=o[x];_[x]=E?{...S,balance:E.balance??S.balance}:S}const v={};for(const[x,S]of Object.entries(g.categories)){const E=u[x];v[x]=E?{...S,balance:E.balance??S.balance}:S}Oe.setQueryData(Ce.budget(t),{...g,accounts:_,categories:v,isNeedsRecalculation:!1,monthMap:f,budget:{...g.budget,accounts:o,categories:u,total_available:m,is_needs_recalculation:!1,month_map:f}})}}async function l6(t,e,n,r,a,o,u){const h=[];let f=0,m=0,g=0,_=0,v=0,x=0;const S=[],E=new Map;for(const P of e){const L=`${P.year}-${P.month}`;E.has(L)||E.set(L,[]),E.get(L).push(P)}for(const[P,L]of E){const[B,O]=P.split("-"),G=parseInt(B,10),Y=parseInt(O,10);S.push({key:P,year:G,month:Y,ordinal:At(G,Y),name:`${Bw[Y-1]} ${G}`,rows:L})}if(S.sort((P,L)=>P.ordinal.localeCompare(L.ordinal)),S.length>0){const P=new Set(S.map(Y=>Y.ordinal)),L=S[0],B=S[S.length-1];let O=L.year,G=L.month;for(;O<B.year||O===B.year&&G<=B.month;){const Y=At(O,G);P.has(Y)||S.push({key:`${O}-${G}`,year:O,month:G,ordinal:Y,name:`${Bw[G-1]} ${O}`,rows:[]}),G++,G>12&&(G=1,O++)}S.sort((Y,U)=>Y.ordinal.localeCompare(U.ordinal))}const T=S.filter(P=>P.rows.length===0).length,I=S.length;u({phase:"reading-months",currentMonth:null,monthsProcessed:0,totalMonths:I,recordsImported:0,totalRecords:e.length,monthsCreated:0,monthsToCreate:0,gapMonths:T,percentComplete:5,incomeImported:0,spendImported:0,allocationsImported:0});const j=await Promise.all(S.map(async P=>{try{const L=await zn(t,P.year,P.month,"seed import combined");return{info:P,data:L,needsCreation:!1}}catch{return{info:P,data:null,needsCreation:!0}}})),M=new Map(j.map(P=>[P.info.ordinal,P])),Q=S.map(P=>M.get(P.ordinal)),H=Q.filter(P=>P.needsCreation).length;if(H>0){u({phase:"creating-months",currentMonth:null,monthsProcessed:0,totalMonths:I,recordsImported:0,totalRecords:e.length,monthsCreated:0,monthsToCreate:H,gapMonths:T,percentComplete:15,incomeImported:0,spendImported:0,allocationsImported:0});for(const P of Q)if(P.needsCreation)try{P.data=await mT(t,P.info.year,P.info.month,{bypassDateLimit:!0}),g++,u({phase:"creating-months",currentMonth:P.info.name,monthsProcessed:0,totalMonths:I,recordsImported:0,totalRecords:e.length,monthsCreated:g,monthsToCreate:H,gapMonths:T,percentComplete:15+Math.round(g/H*10),incomeImported:0,spendImported:0,allocationsImported:0})}catch(L){P.error=`Failed to create month ${P.info.month}/${P.info.year}: ${L instanceof Error?L.message:"Unknown error"}`,h.push(P.error),m+=P.info.rows.length}}u({phase:"processing-months",currentMonth:null,monthsProcessed:0,totalMonths:I,recordsImported:0,totalRecords:e.length,monthsCreated:g,monthsToCreate:H,gapMonths:T,percentComplete:30,incomeImported:0,spendImported:0,allocationsImported:0});const W=[];let D=0,A=O0;for(const P of Q){if(!P.data||P.error){D++;continue}let L=P.data;const B=P.info.rows,O=B.filter(U=>U.recordType==="income"),G=B.filter(U=>U.recordType==="spend"),Y=B.filter(U=>U.recordType==="allocation");if(O.length>0){const U=n6(O,L,r,o);L=U.monthData,f+=U.imported,_+=U.imported,m+=U.skipped,h.push(...U.errors)}if(G.length>0){const U=r6(G,L,n,r,a,o);L=U.monthData,f+=U.imported,v+=U.imported,m+=U.skipped,h.push(...U.errors)}if(Y.length>0){const U=s6(Y,L,n,a);L=U.monthData,f+=U.imported,x+=U.imported,m+=U.skipped,h.push(...U.errors)}L=N0(L,A),A=kf(L),W.push({info:P.info,data:L}),D++,u({phase:"processing-months",currentMonth:P.info.name,monthsProcessed:D,totalMonths:I,recordsImported:f,totalRecords:e.length,monthsCreated:g,monthsToCreate:H,gapMonths:T,percentComplete:30+Math.round(D/I*30),incomeImported:_,spendImported:v,allocationsImported:x})}u({phase:"saving-months",currentMonth:null,monthsProcessed:W.length,totalMonths:W.length,recordsImported:f,totalRecords:e.length,monthsCreated:g,monthsToCreate:H,gapMonths:T,percentComplete:65,incomeImported:_,spendImported:v,allocationsImported:x});const N=W.map(({info:P,data:L})=>({collectionPath:"months",docId:gr(t,P.year,P.month),data:L}));try{await mm(N,`seed import combined (${W.length} months)`)}catch(P){h.push(`Error batch saving months: ${P instanceof Error?P.message:"Unknown error"}`)}u({phase:"updating-budget",currentMonth:null,monthsProcessed:W.length,totalMonths:W.length,recordsImported:f,totalRecords:e.length,monthsCreated:g,monthsToCreate:H,gapMonths:T,percentComplete:85,incomeImported:_,spendImported:v,allocationsImported:x});try{await o6(t,A,W)}catch(P){h.push(`Error updating budget: ${P instanceof Error?P.message:"Unknown error"}`)}return{success:h.length===0,imported:f,skipped:m,errors:h}}function c6(t){const e=t.split(`
`)[0]?.toLowerCase().trim()||"";return e.startsWith("cash flow")||e.startsWith("date,")?"raw_cash_flow":(e.startsWith("type,")||e.startsWith("income,")||e.startsWith("spend,")||e.startsWith("allocation,"),"combined")}async function u6(t){if(!t)return{categoryMappings:new Map,accountMappings:new Map};try{const{exists:e,data:n}=await et("data_mappings",`${t}_import_data_map`,"loading existing import mappings");if(!e||!n)return{categoryMappings:new Map,accountMappings:new Map};const r=new Map,a=new Map;if(n.category_mappings)for(const[o,u]of Object.entries(n.category_mappings))r.set(o,{oldName:o,newId:u.id,newName:u.name});if(n.account_mappings)for(const[o,u]of Object.entries(n.account_mappings))a.set(o,{oldName:o,newId:u.id,newName:u.name});return{categoryMappings:r,accountMappings:a}}catch(e){return console.error("[useSeedImport] Failed to load existing mappings:",e),{categoryMappings:new Map,accountMappings:new Map}}}async function d6(t,e,n){if(!t)return;const r={},a={};for(const[u,h]of e)r[u]={id:h.newId,name:h.newName};for(const[u,h]of n)a[u]={id:h.newId,name:h.newName};const o={budget_id:t,category_mappings:r,account_mappings:a,last_updated:new Date().toISOString()};await Dt("data_mappings",`${t}_import_data_map`,o,"saving import mappings")}function h6(t){const[e,n]=C.useState("idle"),[r,a]=C.useState(null),[o,u]=C.useState([]),[h,f]=C.useState([]),[m,g]=C.useState([]),[_,v]=C.useState([]),[x,S]=C.useState(new Map),[E,T]=C.useState(new Map),[I,j]=C.useState(null),[M,Q]=C.useState(null),H=e==="parsing",W=e==="importing",D=o.length>0||h.length>0,A=C.useCallback(async(O,G,Y)=>{n("parsing"),j(null);try{const U=await O.text(),K=c6(U)==="raw_cash_flow"?$T(U):BL(U);if(K.length===0){n("error"),a(null);return}a(K);const Z=new Set,re=new Set,z=["n/a","na","none","-",""];for(const Me of K){if((Me.recordType==="spend"||Me.recordType==="allocation")&&Me.category){const Ne=Me.category.toLowerCase().trim();z.includes(Ne)||Z.add(Me.category)}if((Me.recordType==="spend"||Me.recordType==="income")&&Me.account){const Ne=Me.account.toLowerCase().trim();z.includes(Ne)||re.add(Me.account)}}const q=Array.from(Z).sort(),te=Array.from(re).sort(),{categoryMappings:ie,accountMappings:ee}=await u6(t),le=new Map;for(const[Me,Ne]of Object.entries(G))le.set(Ne.name.toLowerCase(),{id:Me,name:Ne.name});const pe=new Map;for(const[Me,Ne]of Object.entries(Y))pe.set(Ne.nickname.toLowerCase(),{id:Me,name:Ne.nickname});const xe=[],ve=[];for(const Me of q)if(ie.has(Me)){const Ne=le.get(Me.toLowerCase()),lt=ie.get(Me);(!Ne||Ne.id!==lt.newId)&&xe.push(Me)}for(const Me of te)if(ee.has(Me)){const Ne=pe.get(Me.toLowerCase()),lt=ee.get(Me);(!Ne||Ne.id!==lt.newId)&&ve.push(Me)}g(xe),v(ve);const J=new Map(ie);for(const Me of q)if(!J.has(Me)){const Ne=le.get(Me.toLowerCase());Ne&&J.set(Me,{oldName:Me,newId:Ne.id,newName:Ne.name})}const Se=new Map(ee);for(const Me of te)if(!Se.has(Me)){const Ne=pe.get(Me.toLowerCase());Ne&&Se.set(Me,{oldName:Me,newId:Ne.id,newName:Ne.name})}S(J),T(Se);const{unmappedCategories:je,unmappedAccounts:at}=i6(K,G,Y,J,Se);u(je),f(at),je.length>0||at.length>0?n("mapping"):n("ready")}catch(U){console.error("[useSeedImport] Parse error:",U),n("error"),a(null)}},[t]),N=C.useCallback((O,G,Y)=>{S(U=>{const F=new Map(U);return F.set(O,{oldName:O,newId:G,newName:Y}),F}),u(U=>{const F=U.filter(K=>K===O?!1:!x.has(K));return F.length===0&&h.length===0&&n("ready"),F})},[x,h.length]),P=C.useCallback((O,G,Y)=>{T(U=>{const F=new Map(U);return F.set(O,{oldName:O,newId:G,newName:Y}),F}),f(U=>{const F=U.filter(K=>K===O?!1:!E.has(K));return F.length===0&&o.length===0&&n("ready"),F})},[E,o.length]),L=C.useCallback(async(O,G)=>{if(!t||!r)return;n("importing"),Q({phase:"saving-mappings",currentMonth:null,monthsProcessed:0,totalMonths:0,recordsImported:0,totalRecords:r.length,monthsCreated:0,monthsToCreate:0,gapMonths:0,percentComplete:0,incomeImported:0,spendImported:0,allocationsImported:0}),await d6(t,x,E);const Y=await l6(t,r,O,G,x,E,U=>Q(U));vo(),Q(U=>U?{...U,phase:"complete",percentComplete:100}:null),j(Y),n(Y.success?"complete":"error")},[t,r,x,E]),B=C.useCallback(()=>{n("idle"),a(null),u([]),f([]),g([]),v([]),j(null),Q(null)},[]);return{status:e,parsedData:r,unmappedCategories:o,unmappedAccounts:h,customMappedCategories:m,customMappedAccounts:_,categoryMappings:x,accountMappings:E,importResult:I,importProgress:M,parseFile:A,setCategoryMapping:N,setAccountMapping:P,runImport:L,reset:B,isParsing:H,isImporting:W,hasUnmappedEntities:D}}function Lw({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:a,editName:o,isRenaming:u,onAccept:h,onSwitch:f,onStartEdit:m,onCancelEdit:g,onEditNameChange:_,onSaveEdit:v}){const x=e&&t.isOwner;return c.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:a?c.jsxs("form",{onSubmit:v,children:[c.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:c.jsx("input",{type:"text",value:o,onChange:S=>_(S.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[c.jsx("button",{type:"submit",disabled:u||!o.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:u||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:u||!o.trim()?.7:1,fontSize:"0.8rem"},children:u?"Saving...":"Save"}),c.jsx("button",{type:"button",onClick:g,disabled:u,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:u?"not-allowed":"pointer",fontWeight:500,opacity:u?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[c.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[c.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&c.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&c.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&c.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),x&&c.jsx("button",{onClick:m,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),c.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?c.jsx("button",{onClick:h,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:c.jsx("button",{onClick:f,disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}const ae={primary:"#646cff",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},Jr={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},Nf="1px solid color-mix(in srgb, currentColor 20%, transparent)",Pf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},ad={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},f6={...ad,padding:"0.6rem 0.875rem",gap:"0.5rem"},m6={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},p6={display:"flex",flexDirection:"column",gap:"0.5rem"},g6={fontSize:"0.9rem",fontWeight:500},Ta={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},y6={...Ta,cursor:"pointer"},L0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},QT={...L0,background:ae.primary,color:"white",border:"none"},_6={...QT,padding:"0.75rem 1.5rem",borderRadius:"8px"},b6={...L0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},v6={...L0,background:"transparent",border:`1px solid ${ae.errorBorder}`,color:ae.error},x6={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s"},S6={display:"flex",gap:"0.5rem"},w6={display:"flex",gap:"0.25rem"},WT={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.9rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"2rem",minHeight:"2rem",transition:"opacity 0.15s, border-color 0.15s"},E6={...WT,borderColor:ae.errorBorder,color:ae.error},Fl={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},U0={display:"flex",flexDirection:"column",gap:"2px"},C6={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},KT={opacity:.4,cursor:"grab"},YT={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:ae.primary,borderRadius:"2px",transition:"opacity 0.15s"},T6={position:"relative",height:"2rem",marginTop:"-0.25rem"},A6={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ae.primary,borderRadius:"2px",transition:"opacity 0.15s"},j6={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},R6={background:ae.errorBg,border:`1px solid ${ae.errorBorder}`,color:ae.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},I6={background:"transparent",border:"none",color:ae.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},XT={opacity:.7,marginBottom:"1.5rem"},xm={margin:0,fontSize:"0.85rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6},z0={fontWeight:500,fontSize:"1.1rem"},Vl={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"},Dy={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function JT({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in Dy?n:"bug",a=Dy[r];return c.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:a.bgColor,color:a.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:a.label})}function D6({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:a,onDragLeave:o,onDragEnd:u,onDrop:h,onToggleDone:f,onTypeClick:m}){return c.jsxs("div",{onDragOver:g=>{g.stopPropagation(),a(g)},onDragLeave:g=>{g.stopPropagation(),o()},onDrop:g=>{g.stopPropagation(),h(g)},style:{position:"relative"},children:[c.jsx("div",{style:{...YT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),c.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:u,style:{...ad,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[c.jsx("span",{style:{...KT},children:""}),c.jsx("input",{type:"checkbox",checked:t.is_done,onChange:f,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ae.primary,flexShrink:0}}),c.jsx(JT,{type:t.feedback_type,onClick:m})]}),c.jsxs("div",{style:{marginLeft:"3.25rem"},children:[c.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",Ry(t.created_at)]})]})]})]})}function M6({item:t,onToggleDone:e,onTypeClick:n}){return c.jsxs("div",{style:{...ad,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[c.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ae.primary,flexShrink:0}}),c.jsx(JT,{type:t.feedback_type,onClick:n})]}),c.jsxs("div",{style:{marginLeft:"2rem"},children:[c.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",Ry(t.created_at)]}),t.completed_at&&c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:ae.success},children:[" Completed: ",Ry(t.completed_at)]})]})]})}function va({noMargin:t}={}){return c.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function ss({title:t,description:e,status:n,statusText:r,onRefresh:a,isRefreshing:o,isBusy:u=!1,children:h,cardName:f}){const g=(()=>{switch(n){case"unknown":return{color:"#9ca3af",text:r??"Unknown"};case"clean":case"complete":return{color:"#22c55e",text:r??" Clean"};case"needs-action":return{color:"#f59e0b",text:r??"Action Needed"}}})(),_=o||u;return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1.5rem",marginBottom:"1rem"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.75rem"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("h3",{style:{margin:"0 0 0.5rem 0"},children:t}),c.jsx("p",{style:{margin:0,opacity:.7,fontSize:"0.9rem"},children:e})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexShrink:0},children:[n!=="unknown"&&c.jsx("span",{style:{color:g.color,fontWeight:600,fontSize:"0.9rem"},children:g.text}),c.jsxs("button",{onClick:()=>{a()},disabled:_,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.65rem",borderRadius:"6px",cursor:_?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:_?.6:1,display:"flex",alignItems:"center",gap:"0.3rem"},title:"Refresh status",children:[o?c.jsx(va,{noMargin:!0}):""," Refresh"]})]})]}),h]})}const k6={unknown:{bg:"rgba(100, 100, 100, 0.1)",border:"rgba(100, 100, 100, 0.3)",color:"#9ca3af"},clean:{bg:"rgba(34, 197, 94, 0.1)",border:"rgba(34, 197, 94, 0.3)",color:"#4ade80"},warning:{bg:"rgba(245, 158, 11, 0.1)",border:"rgba(245, 158, 11, 0.3)",color:"#fbbf24"},running:{bg:"rgba(200, 200, 200, 0.1)",border:"rgba(200, 200, 200, 0.3)",color:"rgba(255, 255, 255, 0.7)"},success:{bg:"rgba(34, 197, 94, 0.1)",border:"rgba(34, 197, 94, 0.3)",color:"#4ade80"}};function Ue({type:t,children:e}){const n=k6[t];return c.jsx("div",{style:{background:n.bg,border:`1px solid ${n.border}`,color:n.color,padding:"0.75rem 1rem",borderRadius:"8px",display:"flex",alignItems:"center"},children:e})}function rr({onClick:t,disabled:e,isBusy:n,busyText:r,children:a,actionName:o}){const u=e||n;return c.jsx("button",{onClick:()=>{t()},disabled:u,style:{marginTop:"1rem",background:"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:u?"not-allowed":"pointer",fontWeight:500,opacity:u?.7:1,display:"flex",alignItems:"center",gap:"0.4rem"},children:n?c.jsxs(c.Fragment,{children:[c.jsx(va,{noMargin:!0})," ",r??"Running..."]}):a})}function O6({hasData:t,status:e,hasIssues:n,totalIssues:r,isRunning:a,result:o,onRunCleanup:u,onRefresh:h,isRefreshing:f,disabled:m}){const g=()=>t?o&&o.errors.length===0&&(o.accountsFixed>0||o.categoriesFixed>0||o.groupsFixed>0||o.monthMapsUpdated>0||o.deprecatedFieldsRemoved>0||o.futureMonthsDeleted>0||o.monthsFixed>0||o.oldRecalcFieldsRemoved>0||o.dataMappingsFixed>0)?"complete":n?"needs-action":"clean":"unknown",_=o?o.accountsFixed+o.categoriesFixed+o.groupsFixed+o.monthMapsUpdated+o.deprecatedFieldsRemoved+o.futureMonthsDeleted+o.monthsFixed+o.oldRecalcFieldsRemoved+o.dataMappingsFixed:0;return c.jsx(ss,{title:" Database Cleanup",description:"Validates and fixes all budget, month, and data mapping documents to match the expected schema. Converts legacy formats, adds missing default values, removes invalid future months, and ensures data mappings have required security fields.",status:g(),onRefresh:h,isRefreshing:f,isBusy:a,children:a?c.jsx(Ue,{type:"running",children:"Running database cleanup..."}):o?c.jsx(Ue,{type:o.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[o.errors.length>0?"":""," Cleanup complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[o.budgetsProcessed>0&&c.jsxs("li",{children:[o.budgetsProcessed," budget",o.budgetsProcessed!==1?"s":""," updated"]}),o.arraysConverted>0&&c.jsxs("li",{children:[o.arraysConverted," array",o.arraysConverted!==1?"s":""," converted to maps"]}),o.accountsFixed>0&&c.jsxs("li",{children:[o.accountsFixed," account",o.accountsFixed!==1?"s":""," fixed"]}),o.categoriesFixed>0&&c.jsxs("li",{children:[o.categoriesFixed," categor",o.categoriesFixed!==1?"ies":"y"," fixed"]}),o.groupsFixed>0&&c.jsxs("li",{children:[o.groupsFixed," group",o.groupsFixed!==1?"s":""," fixed"]}),o.monthMapsUpdated>0&&c.jsxs("li",{children:[o.monthMapsUpdated," budget",o.monthMapsUpdated!==1?"s":""," got month_map updated"]}),o.deprecatedFieldsRemoved>0&&c.jsxs("li",{children:[o.deprecatedFieldsRemoved," budget",o.deprecatedFieldsRemoved!==1?"s":""," had deprecated fields removed"]}),o.futureMonthsDeleted>0&&c.jsxs("li",{children:[o.futureMonthsDeleted," future month",o.futureMonthsDeleted!==1?"s":""," deleted"]}),o.monthsFixed>0&&c.jsxs("li",{children:[o.monthsFixed," month",o.monthsFixed!==1?"s":""," schema fixed"]}),o.oldRecalcFieldsRemoved>0&&c.jsxs("li",{children:[o.oldRecalcFieldsRemoved," month",o.oldRecalcFieldsRemoved!==1?"s":""," had old recalc field removed"]}),o.dataMappingsFixed>0&&c.jsxs("li",{children:[o.dataMappingsFixed," data mapping",o.dataMappingsFixed!==1?"s":""," had budget_id added"]}),_===0&&c.jsx("li",{children:"No changes needed"})]}),o.errors.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[o.errors.slice(0,5).map((v,x)=>c.jsx("li",{children:v},x)),o.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",o.errors.length-5," more errors"]})]})]})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",r," issue",r!==1?"s":""," to fix:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.budgetsWithArrays>0&&c.jsxs("li",{children:[e.budgetsWithArrays," budget",e.budgetsWithArrays!==1?"s":""," using legacy array format"]}),e.accountsNeedingDefaults>0&&c.jsxs("li",{children:[e.accountsNeedingDefaults," account",e.accountsNeedingDefaults!==1?"s":""," missing default values"]}),e.categoriesNeedingDefaults>0&&c.jsxs("li",{children:[e.categoriesNeedingDefaults," categor",e.categoriesNeedingDefaults!==1?"ies":"y"," missing default values"]}),e.groupsNeedingDefaults>0&&c.jsxs("li",{children:[e.groupsNeedingDefaults," account group",e.groupsNeedingDefaults!==1?"s":""," missing default values"]}),e.budgetsNeedingMonthMapUpdate>0&&c.jsxs("li",{children:[e.budgetsNeedingMonthMapUpdate," budget",e.budgetsNeedingMonthMapUpdate!==1?"s":""," missing month_map"]}),e.budgetsWithDeprecatedEarliestMonth>0&&c.jsxs("li",{children:[e.budgetsWithDeprecatedEarliestMonth," budget",e.budgetsWithDeprecatedEarliestMonth!==1?"s":""," with deprecated earliest_month field to remove"]}),e.futureMonthsToDelete.length>0&&c.jsxs("li",{children:[e.futureMonthsToDelete.length," future month",e.futureMonthsToDelete.length!==1?"s":""," to delete",c.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.85rem",opacity:.8},children:[e.futureMonthsToDelete.slice(0,3).map(v=>c.jsxs("li",{children:[bo[v.month-1]," ",v.year]},v.docId)),e.futureMonthsToDelete.length>3&&c.jsxs("li",{style:{opacity:.7},children:["...and ",e.futureMonthsToDelete.length-3," more"]})]})]}),e.monthsWithSchemaIssues>0&&c.jsxs("li",{children:[e.monthsWithSchemaIssues," month",e.monthsWithSchemaIssues!==1?"s":""," with schema issues"]}),e.monthsWithOldRecalcField>0&&c.jsxs("li",{children:[e.monthsWithOldRecalcField," month",e.monthsWithOldRecalcField!==1?"s":""," with deprecated is_needs_recalculation field"]}),e.dataMappingsMissingBudgetId>0&&c.jsxs("li",{children:[e.dataMappingsMissingBudgetId," data mapping",e.dataMappingsMissingBudgetId!==1?"s":""," missing budget_id (security fix)"]})]}),c.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budgets, ",e.totalMonths," months, and ",e.totalDataMappings," data mappings."]})]})}),c.jsxs(rr,{onClick:u,disabled:m,isBusy:a,busyText:"Running...",actionName:"Run Database Cleanup",children:[" Fix ",r," Issue",r!==1?"s":""]})]}):c.jsx(Ue,{type:"clean",children:c.jsxs("div",{children:[" Database is clean",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalBudgets," budgets, ",e.totalMonths," months, and ",e.totalDataMappings," data mappings match expected schema."]})]})}):c.jsx(Ue,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function N6({hasData:t,status:e,isMigrating:n,onMigrate:r,onRefresh:a,isRefreshing:o,disabled:u,migrationResult:h}){const f=e&&(e.sanitizedDocuments.length>0||e.corruptedDocuments.length>0),m=h&&(h.deletedDocuments>0||h.fixedDocuments>0),g=()=>t?m?"complete":f?"needs-action":"clean":"unknown";return c.jsx(ss,{title:" Consolidate Feedback Documents",description:"Fixes corrupted feedback data and merges documents with sanitized IDs into proper email format.",status:g(),onRefresh:a,isRefreshing:o,isBusy:n,children:n?c.jsx(Ue,{type:"running",children:"Migrating feedback documents..."}):t?m?c.jsx(Ue,{type:"success",children:c.jsxs("div",{children:[" Migration complete:",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[h.fixedDocuments>0&&c.jsxs("li",{children:["Fixed ",h.fixedDocuments," corrupted document(s)"]}),h.deletedDocuments>0&&c.jsxs("li",{children:["Merged & deleted ",h.deletedDocuments," sanitized document(s)"]}),h.mergedItems>0&&c.jsxs("li",{children:["Merged ",h.mergedItems," feedback item(s)"]})]}),h.errors.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:{marginTop:"0.5rem"},children:" Errors:"}),c.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem",fontSize:"0.9rem"},children:h.errors.map((_,v)=>c.jsx("li",{children:_},v))})]})]})}):f?c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"warning",children:c.jsxs("div",{children:[e?.corruptedDocuments&&e.corruptedDocuments.length>0&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.corruptedDocuments.length," corrupted document(s):"]}),c.jsx("ul",{style:{margin:"0 0 0.75rem 0",paddingLeft:"1.25rem",fontSize:"0.9rem"},children:e.corruptedDocuments.map(_=>c.jsxs("li",{children:[_," ",c.jsx("span",{style:{opacity:.6},children:"(broken arrayUnion)"})]},_))})]}),e?.sanitizedDocuments&&e.sanitizedDocuments.length>0&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.sanitizedDocuments.length," sanitized document(s) to merge:"]}),c.jsx("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:e.sanitizedDocuments.map(_=>c.jsx("li",{children:_},_))})]})]})}),c.jsx(rr,{onClick:r,disabled:u,isBusy:n,busyText:"Migrating...",actionName:"Run Feedback Migration",children:"Run Migration"})]}):c.jsxs(Ue,{type:"clean",children:[" No issues found. All feedback documents are healthy.",c.jsxs("span",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginTop:"0.25rem"},children:["Found ",e?.documentsFound??0," document(s) total."]})]}):c.jsx(Ue,{type:"unknown",children:" Status unknown  click Refresh to scan for issues"})})}function ac({message:t="Loading...",spinnerColor:e=ae.primary,children:n,spinnerSize:r=4}){return c.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[c.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),c.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,c.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function od({percent:t,gradient:e="linear-gradient(90deg, #646cff, #8b5cf6)",width:n=300}){return c.jsx("div",{style:{width:`${n}px`,height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden"},children:c.jsx("div",{style:{width:`${t}%`,height:"100%",background:e,borderRadius:"4px",transition:"width 0.3s ease-out"}})})}function on({value:t,label:e,color:n="#646cff"}){return c.jsxs("div",{style:{textAlign:"center"},children:[c.jsx("p",{style:{color:n,fontSize:"1.5rem",fontWeight:700,margin:0},children:t}),c.jsx("p",{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.8rem",margin:"0.25rem 0 0",textTransform:"uppercase",letterSpacing:"0.05em"},children:e})]})}function ho({children:t,columns:e=3}){return c.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${e}, 1fr)`,gap:"2rem",textAlign:"center"},children:t})}function ld({percent:t}){return c.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:"0.9rem",margin:0},children:[t,"% complete"]})}function jo({message:t,children:e,onDismiss:n,style:r}){return c.jsxs("div",{style:{...R6,...r},children:[c.jsx("span",{children:e??t}),n&&c.jsx("button",{onClick:n,style:I6,children:""})]})}const P6={primary:QT,"primary-large":_6,secondary:b6,danger:v6,small:x6};function Ie({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:a,style:o,actionName:u,onClick:h,...f}){const m=P6[t],g=a||e;function _(v){h?.(v)}return c.jsx("button",{disabled:g,style:{...m,cursor:g?"not-allowed":"pointer",opacity:g?.7:1,...o},onClick:_,...f,children:e?n:r})}function ZT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const h=r.indexOf(n);return{match:!0,score:h===0||/\s/.test(r[h-1])?100:90}}let a=0,o=0,u=0;for(let h=0;h<r.length&&a<n.length;h++)r[h]===n[a]?(a++,u++,o+=u*2):u=0;return a===n.length?{match:!0,score:o}:{match:!1,score:0}}function eA(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function tA(t){const e=eA(t),n=[];let r="__initial__";return e.forEach(a=>{a.groupId!==r&&(r=a.groupId,n.push({groupId:a.groupId,groupName:a.groupName,groupSortOrder:a.groupSortOrder,items:[]})),n[n.length-1].items.push(a)}),n}function nA(t,e,n){return e.trim()?t.map(a=>{const o=n(a);let u=0,h=!1;for(const f of o){const m=ZT(e,f);m.match&&(h=!0,u=Math.max(u,m.score))}return{item:a,score:u,hasMatch:h}}).filter(({hasMatch:a})=>a).sort((a,o)=>o.score!==a.score?o.score-a.score:!a.item.groupId&&o.item.groupId?1:a.item.groupId&&!o.item.groupId?-1:a.item.groupSortOrder!==o.item.groupSortOrder?a.item.groupSortOrder-o.item.groupSortOrder:a.item.sortOrder-o.item.sortOrder).map(({item:a})=>a):eA(t)}const F0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},Bu={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function Uw({id:t,value:e,onChange:n,payees:r,placeholder:a="Enter payee name"}){const[o,u]=C.useState(!1),[h,f]=C.useState(-1),m=C.useRef(null),g=C.useRef(null),_=e.trim()?r.map(S=>({payee:S,...ZT(e,S)})).filter(S=>S.match).sort((S,E)=>E.score-S.score).slice(0,8).map(S=>S.payee):[];C.useEffect(()=>{function S(E){m.current&&!m.current.contains(E.target)&&u(!1)}return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[]);function v(S){!o||_.length===0||(S.key==="ArrowDown"?(S.preventDefault(),f(E=>Math.min(E+1,_.length-1))):S.key==="ArrowUp"?(S.preventDefault(),f(E=>Math.max(E-1,-1))):S.key==="Enter"&&h>=0?(S.preventDefault(),n(_[h]),u(!1),f(-1)):S.key==="Escape"&&(u(!1),f(-1)))}function x(S){n(S),u(!1),f(-1),g.current?.focus()}return c.jsxs("div",{ref:m,style:{position:"relative"},children:[c.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:S=>{n(S.target.value),u(!0),f(-1)},onFocus:()=>u(!0),onKeyDown:v,placeholder:a,autoComplete:"off",style:Ta}),o&&_.length>0&&c.jsx("div",{style:{...F0,maxHeight:"200px",overflowY:"auto"},children:_.map((S,E)=>c.jsx("div",{onClick:()=>x(S),style:{...Bu,background:E===h?`color-mix(in srgb, ${ae.primary} 20%, transparent)`:"transparent",borderBottom:E<_.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>f(E),children:S},S))})]})}function rA({id:t,value:e,onChange:n,categories:r,categoryGroups:a,placeholder:o="Search categories...",required:u,showNoCategoryOption:h=!1,showHiddenCategories:f=!1}){const m=Object.fromEntries(a.map(F=>[F.id,F.name])),g=Object.fromEntries(a.map(F=>[F.id,F.sort_order])),_=f?r:Object.fromEntries(Object.entries(r).filter(([,F])=>!F.is_hidden)),v=Object.entries(_).map(([F,K])=>({id:F,name:K.name,groupId:K.category_group_id,groupName:K.category_group_id&&m[K.category_group_id]||null,sortOrder:K.sort_order,groupSortOrder:K.category_group_id?g[K.category_group_id]??999:999})),x=e===Rt,S=x?null:e?r[e]:null,E=x?"":S?.name||"",[T,I]=C.useState(E),[j,M]=C.useState(!1),[Q,H]=C.useState(-1),W=C.useRef(null),D=C.useRef(null);C.useEffect(()=>{if(e===Rt)I("");else if(e){const F=r[e];I(F?.name||"")}},[e,r]);const A=nA(v,T,F=>[F.name]),N=tA(A);C.useEffect(()=>{function F(K){if(W.current&&!W.current.contains(K.target))if(M(!1),e===Rt)I("");else{const Z=e?r[e]:null;I(Z?.name||"")}}return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[e,r]);function P(F){if(F.key==="ArrowDown")F.preventDefault(),j?H(K=>Math.min(K+1,A.length-1)):(M(!0),H(0));else if(F.key==="ArrowUp")F.preventDefault(),H(K=>Math.max(K-1,0));else if(F.key==="Enter")F.preventDefault(),j&&Q>=0&&A[Q]&&L(A[Q]);else if(F.key==="Escape")if(M(!1),H(-1),e===Rt)I("");else{const K=e?r[e]:null;I(K?.name||"")}else if(F.key==="Tab")if(j&&Q>=0&&A[Q])L(A[Q]);else if(M(!1),H(-1),e===Rt)I("");else{const K=e?r[e]:null;I(K?.name||"")}}function L(F){n(F.id),I(F.id===Rt?"":F.name),M(!1),H(-1)}function B(){n(Rt),I(""),M(!1),H(-1)}function O(F){const K=F.target.value;I(K),M(!0),H(K.trim()?0:-1),K!==E&&(h&&K.trim()===""?n(Rt):n(""))}function G(){M(!0),h&&(e===Rt||T.trim()==="")?H(-1):A.length>0&&H(0)}let Y=-1;const U=()=>++Y;return c.jsxs("div",{ref:W,style:{position:"relative"},children:[c.jsx("input",{ref:D,id:t,type:"text",value:T,onChange:O,onFocus:G,onKeyDown:P,placeholder:o,autoComplete:"off",required:u&&!h,style:{...Ta,borderColor:u&&!e?ae.error:void 0}}),j&&c.jsxs("div",{style:{...F0,maxHeight:"250px",overflowY:"auto"},children:[h&&c.jsx("div",{onClick:B,onMouseEnter:()=>H(-1),style:{...Bu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:Q===-1?`color-mix(in srgb, ${ae.primary} 20%, transparent)`:"transparent"},children:ba}),N.map((F,K)=>c.jsxs("div",{children:[F.groupName&&c.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:F.groupName}),F.items.map(Z=>{const re=U();return c.jsx("div",{onClick:()=>L(Z),style:{...Bu,paddingLeft:F.groupName?"1.2rem":"0.8rem",background:re===Q?`color-mix(in srgb, ${ae.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>H(re),children:Z.name},Z.id)})]},`group-${K}`)),A.length===0&&T.trim()&&!h&&c.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function sA({id:t,value:e,onChange:n,accounts:r,accountGroups:a,placeholder:o="Search accounts...",required:u,showNoAccountOption:h=!1,showHiddenAccounts:f=!1}){const g=(f?r:r.filter(([,Y])=>!Y.is_hidden)).map(([Y,U])=>({id:Y,name:U.nickname,groupId:U.account_group_id,groupName:U.account_group_id&&a[U.account_group_id]?.name||null,sortOrder:U.sort_order,groupSortOrder:U.account_group_id?a[U.account_group_id]?.sort_order??999:999})),_=e===Tt,v=_?null:r.find(([Y])=>Y===e)?.[1],x=_?"":v?.nickname||"",[S,E]=C.useState(x),[T,I]=C.useState(!1),[j,M]=C.useState(-1),Q=C.useRef(null),H=C.useRef(null);C.useEffect(()=>{if(e===Tt)E("");else if(e){const Y=r.find(([U])=>U===e)?.[1];E(Y?.nickname||"")}},[e,r]);const W=nA(g,S,Y=>[Y.name]),D=tA(W);C.useEffect(()=>{function Y(U){if(Q.current&&!Q.current.contains(U.target))if(I(!1),e===Tt)E("");else{const F=r.find(([K])=>K===e)?.[1];E(F?.nickname||"")}}return document.addEventListener("mousedown",Y),()=>document.removeEventListener("mousedown",Y)},[e,r]);function A(Y){if(Y.key==="ArrowDown")Y.preventDefault(),T?M(U=>Math.min(U+1,W.length-1)):(I(!0),M(0));else if(Y.key==="ArrowUp")Y.preventDefault(),M(U=>Math.max(U-1,0));else if(Y.key==="Enter")Y.preventDefault(),T&&j>=0&&W[j]&&N(W[j]);else if(Y.key==="Escape")if(I(!1),M(-1),e===Tt)E("");else{const U=r.find(([F])=>F===e)?.[1];E(U?.nickname||"")}else if(Y.key==="Tab")if(T&&j>=0&&W[j])N(W[j]);else if(I(!1),M(-1),e===Tt)E("");else{const U=r.find(([F])=>F===e)?.[1];E(U?.nickname||"")}}function N(Y){n(Y.id),E(Y.id===Tt?"":Y.name),I(!1),M(-1)}function P(){n(Tt),E(""),I(!1),M(-1)}function L(Y){const U=Y.target.value;E(U),I(!0),M(U.trim()?0:-1),U!==x&&(h&&U.trim()===""?n(Tt):n(""))}function B(){I(!0),h&&(e===Tt||S.trim()==="")?M(-1):W.length>0&&M(0)}let O=-1;const G=()=>++O;return c.jsxs("div",{ref:Q,style:{position:"relative"},children:[c.jsx("input",{ref:H,id:t,type:"text",value:S,onChange:L,onFocus:B,onKeyDown:A,placeholder:o,autoComplete:"off",required:u&&!h,style:{...Ta,borderColor:u&&!e?ae.error:void 0}}),T&&c.jsxs("div",{style:{...F0,maxHeight:"250px",overflowY:"auto"},children:[h&&c.jsx("div",{onClick:P,onMouseEnter:()=>M(-1),style:{...Bu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:j===-1?`color-mix(in srgb, ${ae.primary} 20%, transparent)`:"transparent"},children:Ps}),D.map((Y,U)=>c.jsxs("div",{children:[Y.groupName&&c.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:Y.groupName}),Y.items.map(F=>{const K=G();return c.jsx("div",{onClick:()=>N(F),style:{...Bu,paddingLeft:Y.groupName?"1.2rem":"0.8rem",background:K===j?`color-mix(in srgb, ${ae.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>M(K),children:F.name},F.id)})]},`group-${U}`)),W.length===0&&S.trim()&&!h&&c.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function mi({children:t,onSubmit:e,actionName:n}){function r(a){e(a)}return c.jsx("form",{onSubmit:r,style:m6,children:t})}function Et({label:t,htmlFor:e,children:n,hint:r,style:a}){return c.jsxs("div",{style:{...p6,...a},children:[c.jsx("label",{htmlFor:e,style:g6,children:t}),n,r&&c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function pi(t){return c.jsx("input",{style:Ta,...t})}function B6(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function Bf({value:t,onChange:e,style:n,...r}){const a=C.useRef(null),o=B6(t);function u(){a.current?.showPicker?.()}return c.jsxs("div",{style:{position:"relative"},children:[c.jsx("input",{ref:a,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...r}),c.jsx("div",{onClick:u,style:{...Ta,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:o||"Select date"})]})}function Lu({children:t,...e}){return c.jsx("select",{style:y6,...e,children:t})}function V0({minHeight:t="6rem",style:e,...n}){return c.jsx("textarea",{style:{...Ta,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function Aa({children:t}){return c.jsx("div",{style:C6,children:t})}function qg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",a=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return a!==void 0?`$${o}.${a.slice(0,2)}`:o?`$${o}`:""}function L6(t){return t.replace(/[$,]/g,"")}function co({id:t,value:e,onChange:n,placeholder:r="$0.00",required:a,autoFocus:o,style:u}){const[h,f]=C.useState(()=>qg(e)),m=C.useRef(null);C.useEffect(()=>{const _=qg(e);L6(h)!==e&&f(_)},[e]);function g(_){const v=_.target.value;if(!v||v==="$"){f(""),n("");return}const S=v.replace(/[^\d.]/g,"").split(".");let E=S[0];S.length>1&&(E+="."+S.slice(1).join("").slice(0,2));const T=qg(E);f(T),n(E)}return c.jsx("input",{ref:m,id:t,type:"text",inputMode:"decimal",value:h,onChange:g,placeholder:r,required:a,autoFocus:o,style:{...Ta,...u}})}function Sm({children:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:a,onDragLeave:o,onDragEnd:u,onDrop:h,onEdit:f,onDelete:m,onMoveUp:g,onMoveDown:_,canMoveUp:v=!0,canMoveDown:x=!0,itemName:S}){const E=Ls(),T=g||_;return c.jsxs("div",{onDragOver:I=>{I.stopPropagation(),a(I)},onDragLeave:I=>{I.stopPropagation(),o()},onDrop:I=>{I.stopPropagation(),h(I)},style:{position:"relative"},children:[c.jsx("div",{style:{...YT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),c.jsxs("div",{style:{...E?f6:ad,opacity:e?.5:1},children:[c.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:E?"0.5rem":"0.75rem",minWidth:0},children:[c.jsx("span",{draggable:!0,onDragStart:I=>{r(I)},onDragEnd:()=>{u()},style:{...KT,fontSize:E?"0.9rem":void 0,cursor:"grab",padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder",children:""}),c.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis"},children:t})]}),c.jsxs("div",{style:E?w6:S6,children:[E?c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:()=>{f()},style:WT,title:"Edit","aria-label":"Edit",children:""}),c.jsx("button",{onClick:()=>{m()},style:E6,title:"Delete","aria-label":"Delete",children:""})]}):c.jsxs(c.Fragment,{children:[c.jsx(Ie,{variant:"secondary",actionName:`Edit ${S||"Item"}`,onClick:f,children:"Edit"}),c.jsx(Ie,{variant:"danger",actionName:`Delete ${S||"Item"}`,onClick:m,children:"Delete"})]}),T&&c.jsxs("div",{style:U0,children:[c.jsx("button",{onClick:I=>{I.stopPropagation(),g?.()},disabled:!v,style:{...Fl,opacity:v?.6:.2,cursor:v?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),c.jsx("button",{onClick:I=>{I.stopPropagation(),_?.()},disabled:!x,style:{...Fl,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})]})}function $0({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:a="Move to end"}){return c.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:T6,children:[c.jsx("div",{style:{...A6,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&c.jsx("span",{style:j6,children:a})]})}function $e(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Zr(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function ja(t){return t===0?"$0.00":`${t>0?"+":"-"}${$e(t)}`}function yr(t){return`${t>=0?"+":"-"}${$e(t)}`}function jt(t){return t===0?ae.zero:t>0?ae.success:ae.danger}function Dn(t){return t===0?ae.zero:t>0?ae.success:ae.debt}function oc(t){return t===0?ae.zero:t<0?ae.error:ae.success}function lc(t){return t===0?ae.zero:t>0?ae.success:ae.error}async function iA(t,e){const{exists:n,data:r}=await et("feedback",t,`PRE-EDIT-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function aA(t){const{docId:e,items:n,description:r}=t,a=await iA(e,r);await Dt("feedback",e,{...a,items:n,updated_at:new Date().toISOString()},r)}async function U6(t,e,n,r){const{exists:a}=await et("feedback",t,"checking if user has existing feedback document");a?await Dt("feedback",t,{items:l4(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await Dt("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}const z6=Fn({optimisticUpdate:t=>{const{userId:e,userEmail:n,text:r,feedbackType:a,currentPath:o}=t,u=n||e,h={id:`feedback_optimistic_${Date.now()}`,text:`${r}

(Submitted from: ${o})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:a,doc_id:u,user_email:n};return t._optimisticId=h.id,{cacheKey:Ce.feedback(),transform:f=>f&&{items:[...f.items,h]}}},mutationFn:async t=>{const{userId:e,userEmail:n,text:r,feedbackType:a,currentPath:o}=t,u=n||e,h={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${r}

(Submitted from: ${o})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:a};return await U6(u,h,n,"submitting new feedback"),{feedbackItem:h,docId:u}},onSuccess:(t,e)=>{const n=e._optimisticId;if(!n)return;const r=Oe.getQueryData(Ce.feedback());r&&Oe.setQueryData(Ce.feedback(),{items:r.items.map(a=>a.id===n?{...t.feedbackItem,doc_id:t.docId,user_email:e.userEmail}:a)})}});function oA(){const{mutate:t,mutateAsync:e,isPending:n,isError:r,error:a,reset:o}=z6();return{submitFeedback:{mutate:h=>t(h),mutateAsync:h=>e(h),isPending:n,isError:r,error:a,reset:o}}}const F6=Fn({optimisticUpdate:t=>{const{item:e}=t,n=!e.is_done,r=n?new Date().toISOString():null;return{cacheKey:Ce.feedback(),transform:a=>a&&{items:a.items.map(o=>o.id===e.id?{...o,is_done:n,completed_at:r}:o)}}},mutationFn:async t=>{const{item:e}=t,n=!e.is_done,r=n?new Date().toISOString():null,a=await iA(e.doc_id,"toggle feedback");let o=!1;const u=a.items.map(h=>h.id===e.id?(o=!0,{...h,is_done:n,completed_at:r}):h);if(!o)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:e.id,inDocument:e.doc_id,availableIds:a.items.map(h=>h.id)}),new Error(`Feedback item not found in document. Item ID: ${e.id}, Doc ID: ${e.doc_id}`);return await aA({docId:e.doc_id,items:u,description:`marking feedback item as ${n?"done":"not done"}`}),{itemId:e.id,isDone:n,completedAt:r}}});function V6(){const{mutate:t,mutateAsync:e,isPending:n,isError:r,error:a,reset:o}=F6();return{toggleFeedback:{mutate:h=>t(h),mutateAsync:h=>e(h),isPending:n,isError:r,error:a,reset:o}}}const $6=Fn({optimisticUpdate:t=>{const{docId:e,items:n}=t,r=new Map;return n.forEach(a=>{r.set(a.id,a.sort_order)}),{cacheKey:Ce.feedback(),transform:a=>a&&{items:a.items.map(o=>o.doc_id===e&&r.has(o.id)?{...o,sort_order:r.get(o.id)}:o)}}},mutationFn:async t=>{const{docId:e,items:n}=t;return await aA({docId:e,items:n,description:"saving reordered feedback items"}),{docId:e,items:n}}});function H6(){const{mutate:t,mutateAsync:e,isPending:n,isError:r,error:a,reset:o}=$6();return{updateSortOrder:{mutate:h=>t(h),mutateAsync:h=>e(h),isPending:n,isError:r,error:a,reset:o}}}function Bs({isOpen:t,onClose:e,title:n,children:r,width:a="28rem"}){if(!t)return null;function o(){e()}return c.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:c.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:a,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:u=>u.stopPropagation(),children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[c.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),c.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const q6=2e3,G6={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function Q6(){const[t,e]=C.useState(!1),[n,r]=C.useState(""),[a,o]=C.useState("bug"),[u,h]=C.useState(!1),f=C.useContext(sd),g=Sa().get_current_firebase_user(),_=Un(),{submitFeedback:v}=oA();if(C.useEffect(()=>{if(u){const E=setTimeout(()=>h(!1),q6);return()=>clearTimeout(E)}},[u]),_.pathname.includes("/admin/feedback")||!f.is_logged_in)return null;function S(E){E.preventDefault(),!(!n.trim()||!f.username||!g)&&(v.mutate({userId:g.uid,userEmail:f.username,text:n.trim(),feedbackType:a,currentPath:_.pathname}),r(""),o("bug"),e(!1),h(!0))}return c.jsxs(c.Fragment,{children:[u&&c.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Feedback submitted!"})]}),c.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:ae.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:E=>{E.currentTarget.style.transform="scale(1.1)",E.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:E=>{E.currentTarget.style.transform="scale(1)",E.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),c.jsx(Bs,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:c.jsxs("form",{onSubmit:S,children:[c.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(E=>{const T=G6[E],I=a===E;return c.jsxs("button",{type:"button",onClick:()=>{T.label,o(E)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${T.color}`,borderRadius:"0.5rem",background:I?T.bgColor:"transparent",color:I?T.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:I?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:I?1:.5,boxShadow:I?`0 0 12px ${T.bgColor}`:"none",position:"relative"},children:[T.label,I&&c.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},E)})}),c.jsx(V0,{value:n,onChange:E=>r(E.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),c.jsxs(Aa,{children:[c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),c.jsx(Ie,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}const W6=1500;function K6(){console.info("[CacheInvalidate] Starting full cache invalidation..."),Oe.cancelQueries(),Oe.clear(),console.info("[CacheInvalidate] Cleared in-memory cache");try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE"),console.info("[CacheInvalidate] Cleared localStorage cache")}catch(e){console.warn("[CacheInvalidate] Failed to clear localStorage:",e)}const t=new URL(window.location.href);t.searchParams.set("cacheBust","1"),console.info("[CacheInvalidate] Reloading with cache bust..."),window.location.href=t.toString()}function Y6(){const[t,e]=C.useState(!1),{isAdmin:n}=zt();if(C.useEffect(()=>{if(t){const a=setTimeout(()=>e(!1),W6);return()=>clearTimeout(a)}},[t]),!n)return null;function r(){e(!0),K6()}return c.jsxs(c.Fragment,{children:[t&&c.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"5.5rem",background:"rgba(100, 108, 255, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Cache cleared & refetching..."})]}),c.jsx("button",{onClick:r,style:{position:"fixed",bottom:"1.5rem",right:"5.25rem",width:"3rem",height:"3rem",borderRadius:"50%",background:"#4a4a4a",color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Clear Cache & Reload",onMouseEnter:a=>{a.currentTarget.style.transform="scale(1.1)",a.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:a=>{a.currentTarget.style.transform="scale(1)",a.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""})]})}function Or({children:t,labelStyle:e,...n}){return c.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[c.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:ae.primary},...n}),t]})}function H0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[a,o]=C.useState(r);return c.jsxs("div",{style:{marginTop:"2rem"},children:[c.jsxs("button",{onClick:()=>o(!a),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[c.jsx("span",{style:{transition:"transform 0.2s",transform:a?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),a&&n]})}const X6=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},J6=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Lf(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,a=e.filter(T=>!T.hidden),o=a.length,u=X6(o),h=J6(o),f=Math.floor(100/h),m=`tab-nav-${o}-${r}`,g=r==="primary",_=r==="secondary",v=r==="segmented",x=T=>{const I="color-mix(in srgb, currentColor 10%, transparent)",j="color-mix(in srgb, currentColor 3%, transparent)";return v?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:T?I:j,cursor:"pointer",fontWeight:T?600:400,fontSize:"0.95rem",color:"inherit",opacity:T?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:T?"2px solid currentColor":"2px solid transparent"}:_?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:T?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:T?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:T?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:T?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},S=(T,I)=>c.jsxs(c.Fragment,{children:[c.jsx("span",{children:T.label}),T.checkmark&&c.jsx("span",{style:{color:ae.success,fontWeight:600},children:""}),g&&I&&c.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),E=()=>v?`
        .${m} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:_?`
        .${m} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${m} > button,
        .${m} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${m} > button:last-child,
        .${m} > a:last-child {
          margin-right: 0;
        }
        .${m} > button::before,
        .${m} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 #242424, 1px 0 0 #242424;
        }
        .${m} > button:nth-child(1),
        .${m} > a:nth-child(1) {
          z-index: 4;
        }
        .${m} > button:nth-child(2),
        .${m} > a:nth-child(2) {
          z-index: 3;
        }
        .${m} > button:nth-child(3),
        .${m} > a:nth-child(3) {
          z-index: 2;
        }
        .${m} > button:nth-child(4),
        .${m} > a:nth-child(4) {
          z-index: 1;
        }
        .${m} > button.tab-active,
        .${m} > a.tab-active {
          z-index: 10;
        }
        .${m} > button.tab-active::before,
        .${m} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${m} > button:not(.tab-active):hover,
        .${m} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${m} > button:not(.tab-active):hover::before,
        .${m} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${m} {
            padding-left: 0;
            padding-right: 0;
          }
          .${m} > button,
          .${m} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${m} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${u}px) {
        .${m} > * {
          flex: 1 1 ${f}% !important;
          min-width: ${f}% !important;
        }
      }
    `;return c.jsxs(c.Fragment,{children:[c.jsx("style",{children:`
        ${E()}
        .${m} > button,
        .${m} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${m} > button:hover,
        .${m} > button:focus,
        .${m} > a:hover,
        .${m} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${g?"opacity: 0.85;":""}
          ${v?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),c.jsx("div",{className:m,children:a.map(T=>{const I=n===T.id;return t.mode==="link"?c.jsx(Ft,{to:`${t.linkPrefix}/${T.id}`,onClick:()=>(`${T.label}`,void 0),style:x(I),className:I?"tab-active":"",children:S(T,I)},T.id):c.jsx("button",{onClick:()=>{`${T.label}`,t.onTabChange(T.id)},style:x(I),className:I?"tab-active":"",children:S(T,I)},T.id)})})]})}function lA({items:t}){const[e,n]=C.useState(!1),r=C.useRef(null),o=Un().pathname;C.useEffect(()=>{function h(f){r.current&&!r.current.contains(f.target)&&n(!1)}if(e)return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[e]),C.useEffect(()=>{function h(f){f.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[e]);const u=t.filter(h=>h.hidden?!1:h.to?h.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):h.to==="/account"||h.to==="/"?o!==h.to:!o.startsWith(h.to):!0);return c.jsxs("div",{ref:r,style:{position:"relative"},children:[c.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&c.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:u.map((h,f)=>{if(h.divider)return c.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},f);const m=c.jsxs(c.Fragment,{children:[h.icon&&c.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:h.icon}),c.jsx("span",{children:h.label})]}),g={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},_={background:"color-mix(in srgb, currentColor 10%, transparent)"};return h.to?c.jsx(Ft,{to:h.to,style:g,onMouseEnter:v=>Object.assign(v.currentTarget.style,_),onMouseLeave:v=>v.currentTarget.style.background="transparent",onClick:()=>{`${h.label}`,n(!1)},children:m},f):c.jsx("button",{onClick:()=>{`${h.label}`,h.onClick?.(),n(!1)},style:g,onMouseEnter:v=>Object.assign(v.currentTarget.style,_),onMouseLeave:v=>v.currentTarget.style.background="transparent",children:m},f)})})]})}function Z6({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=zt(),a=Un(),u=[...a.pathname==="/budget"||a.pathname.startsWith("/budget/")&&!a.pathname.startsWith("/budget/settings")&&!a.pathname.startsWith("/budget/admin")&&!a.pathname.startsWith("/budget/analytics")&&!a.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return c.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[c.jsx("div",{style:{flex:"0 0 auto"},children:e?c.jsx(Ft,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):c.jsx(Ft,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:c.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),c.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),c.jsx("div",{style:{flex:"0 0 auto"},children:n?c.jsx("div",{style:{width:"1.5rem"}}):c.jsx(lA,{items:u})})]})}function cA({children:t,style:e}){return c.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function eU({hasData:t,monthsCount:e,budgetCount:n,monthsToDelete:r,isDeleting:a,onDelete:o,onRefresh:u,isRefreshing:h,disabled:f,deleteResult:m,deleteProgress:g}){const[_,v]=C.useState(!1),x=()=>{v(!0)},S=()=>{v(!1),o()},E=()=>t?m&&m.deleted>0&&m.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",T=r.reduce((I,j)=>{const M=j.budgetId;return I[M]||(I[M]=[]),I[M].push(j),I},{});return c.jsxs(ss,{title:" Delete ALL Months",description:"DESTRUCTIVE: Deletes ALL month documents from Firebase for ALL budgets. This will reset all income, expenses, and allocations. Use with extreme caution!",status:E(),onRefresh:u,isRefreshing:h,isBusy:a,children:[a?c.jsx(Ue,{type:"running",children:"Deleting all months..."}):m?c.jsx(Ue,{type:m.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[m.errors.length>0?"":""," Deleted ",m.deleted," month",m.deleted!==1?"s":"",m.budgetsRecalculated>0&&c.jsxs("span",{children:[", reset ",m.budgetsRecalculated," budget",m.budgetsRecalculated!==1?"s":""]}),c.jsx("span",{style:{opacity:.8},children:", cache cleared"}),m.errors.length>0&&c.jsx("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.85rem"},children:m.errors.map((I,j)=>c.jsx("li",{children:I},j))})]})}):t?e>0?c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",c.jsx("strong",{children:e})," month",e!==1?"s":""," across ",c.jsx("strong",{children:n})," budget",n!==1?"s":"",":"]}),c.jsxs("div",{style:{maxHeight:"200px",overflowY:"auto"},children:[Object.entries(T).slice(0,5).map(([I,j])=>c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[c.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:["Budget: ",I.slice(0,12),"..."]}),c.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem",fontSize:"0.85rem"},children:[j.slice(0,3).map(M=>c.jsxs("li",{children:[bo[M.month-1]," ",M.year]},M.docId)),j.length>3&&c.jsxs("li",{style:{opacity:.7},children:["...and ",j.length-3," more"]})]})]},I)),Object.keys(T).length>5&&c.jsxs("div",{style:{opacity:.7,fontSize:"0.85rem",marginTop:"0.5rem"},children:["...and ",Object.keys(T).length-5," more budgets"]})]})]})}),c.jsxs(rr,{onClick:x,disabled:f,isBusy:a,busyText:"Deleting...",actionName:"Delete All Months",children:[" Delete ALL ",e," Month",e!==1?"s":""]}),c.jsx("p",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.5rem",fontWeight:500},children:" This action cannot be undone!"})]}):c.jsx(Ue,{type:"clean",children:" No month documents found in Firebase."}):c.jsx(Ue,{type:"unknown",children:" Status unknown  click Refresh to scan for months"}),c.jsxs(Bs,{isOpen:_,onClose:()=>v(!1),title:" Delete All Months?",children:[c.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:c.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),c.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",c.jsxs("strong",{style:{color:"#ef4444"},children:[e," month",e!==1?"s":""]})," across"," ",c.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget",n!==1?"s":""]}),"."]}),c.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, all affected budgets will be reset:"}),c.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[c.jsx("li",{children:"All account balances  $0"}),c.jsx("li",{children:"All category balances  $0"}),c.jsx("li",{children:"Month history cleared"}),c.jsx("li",{children:"Cache cleared automatically"})]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>v(!1),children:"Cancel"}),c.jsxs(Ie,{variant:"danger",actionName:"Confirm Delete All Months",onClick:S,children:[" Delete All ",e," Months"]})]})]}),a&&g&&c.jsx(tU,{progress:g})]})}function tU({progress:t}){const e=()=>{switch(t.phase){case"deleting":return t.currentMonth?`Deleting ${t.currentMonth}...`:"Deleting months...";case"resetting-budgets":return t.currentMonth?`Resetting ${t.currentMonth}...`:"Resetting budgets...";case"clearing-cache":return"Clearing cache...";case"complete":return"Complete!";default:return"Processing..."}},n=()=>t.phase==="resetting-budgets"||t.phase==="clearing-cache"?"linear-gradient(90deg, #22c55e, #10b981)":"linear-gradient(90deg, #ef4444, #dc2626)",r=()=>t.phase==="resetting-budgets"||t.phase==="clearing-cache"?"#22c55e":"#ef4444";return c.jsxs(ac,{message:e(),spinnerColor:r(),children:[c.jsx(od,{percent:t.percentComplete,gradient:n()}),t.phase==="deleting"&&c.jsxs(ho,{columns:2,children:[c.jsx(on,{value:`${t.deleted}/${t.total}`,label:"Months Deleted",color:"#ef4444"}),c.jsx(on,{value:t.total-t.deleted,label:"Remaining",color:"rgba(255, 255, 255, 0.6)"})]}),t.phase==="resetting-budgets"&&c.jsxs(ho,{columns:2,children:[c.jsx(on,{value:t.deleted,label:"Months Deleted",color:"#ef4444"}),c.jsx(on,{value:`${t.budgetsRecalculated}/${t.totalBudgets}`,label:"Budgets Reset",color:"#22c55e"})]}),(t.phase==="clearing-cache"||t.phase==="complete")&&c.jsxs(ho,{columns:2,children:[c.jsx(on,{value:t.deleted,label:"Months Deleted",color:"#ef4444"}),c.jsx(on,{value:t.budgetsRecalculated,label:"Budgets Reset",color:"#22c55e"})]}),c.jsx(ld,{percent:t.percentComplete})]})}function nU({hasData:t,status:e,isDeleting:n,onDelete:r,onRefresh:a,isRefreshing:o,disabled:u,deleteResult:h,deleteProgress:f}){const[m,g]=C.useState(!1),_=()=>{g(!0)},v=()=>{g(!1),r()},x=()=>t?h&&(h.budgetsDeleted>0||e?.staleBudgetIds.length===0)&&h.errors.length===0?"complete":!e||e.totalBudgets===0&&e.staleBudgetIds.length===0?"clean":"needs-action":"unknown",S=e?.totalBudgets??0,E=e?.totalMonths??0,T=e?.budgets??[],I=e?.staleBudgetIds??[];return c.jsxs(ss,{title:" Delete Sample User Budget",description:"Deletes the budget for sample@sample.com user (budget document, all months, and payees). This resets the sample user to a brand new state for testing the new user flow.",status:x(),onRefresh:a,isRefreshing:o,isBusy:n,children:[n?c.jsx(Ue,{type:"running",children:"Deleting sample user budget..."}):h?c.jsx(Ue,{type:h.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[h.errors.length>0?"":""," Deleted ",h.budgetsDeleted," budget",h.budgetsDeleted!==1?"s":"",h.monthsDeleted>0&&c.jsxs("span",{children:[", ",h.monthsDeleted," month",h.monthsDeleted!==1?"s":""]}),h.payeesDeleted>0&&c.jsxs("span",{children:[", ",h.payeesDeleted," payee doc",h.payeesDeleted!==1?"s":""]}),c.jsx("span",{style:{opacity:.8},children:", cache cleared"}),h.errors.length>0&&c.jsx("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.85rem"},children:h.errors.map((j,M)=>c.jsx("li",{children:j},M))})]})}):t?S>0?c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",c.jsx("strong",{children:S})," budget",S!==1?"s":""," with"," ",c.jsx("strong",{children:E})," month",E!==1?"s":""," for sample@sample.com:"]}),c.jsx("div",{style:{maxHeight:"200px",overflowY:"auto"},children:T.map(j=>c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[c.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:['"',j.budgetName,'" (',j.monthCount," month",j.monthCount!==1?"s":"",")"]}),c.jsxs("div",{style:{fontSize:"0.75rem",opacity:.7},children:["ID: ",j.budgetId.slice(0,20),"..."]})]},j.budgetId))})]})}),c.jsx(rr,{onClick:_,disabled:u,isBusy:n,busyText:"Deleting...",actionName:"Delete Sample User Budget",children:" Delete Sample User Data"}),c.jsx("p",{style:{fontSize:"0.8rem",color:"#f59e0b",marginTop:"0.5rem",fontWeight:500},children:" This resets sample@sample.com to a new user state"})]}):I.length>0?c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",c.jsx("strong",{children:I.length})," stale budget reference",I.length!==1?"s":""," in user document:"]}),c.jsx("div",{style:{maxHeight:"200px",overflowY:"auto"},children:I.map(j=>c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[c.jsx("div",{style:{fontSize:"0.85rem",opacity:.9},children:"Budget document no longer exists but ID is still in user's budget_ids"}),c.jsxs("div",{style:{fontSize:"0.75rem",opacity:.7},children:["ID: ",j]})]},j))})]})}),c.jsx(rr,{onClick:_,disabled:u,isBusy:n,busyText:"Cleaning up...",actionName:"Clean Stale Budget Reference",children:" Remove Stale Reference"}),c.jsx("p",{style:{fontSize:"0.8rem",color:"#f59e0b",marginTop:"0.5rem",fontWeight:500},children:" This will remove the orphaned budget ID from the user document"})]}):c.jsx(Ue,{type:"clean",children:' No budget found for sample@sample.com  user is already in "new user" state.'}):c.jsx(Ue,{type:"unknown",children:" Status unknown  click Refresh to scan for sample user budget"}),c.jsxs(Bs,{isOpen:m,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[c.jsx("div",{style:{background:"color-mix(in srgb, #f59e0b 15%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:c.jsx("p",{style:{margin:0,color:"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),c.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",c.jsxs("strong",{style:{color:"#f59e0b"},children:[S," budget",S!==1?"s":""]})," and"," ",c.jsxs("strong",{style:{color:"#f59e0b"},children:[E," month",E!==1?"s":""]}),"."]}),c.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, sample@sample.com will be treated as a brand new user:"}),c.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[c.jsx("li",{children:"Budget document deleted"}),c.jsx("li",{children:"All month documents deleted"}),c.jsx("li",{children:"Payees document deleted"}),c.jsx("li",{children:"User will see onboarding flow"})]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),c.jsx(Ie,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:v,children:" Delete Sample User Data"})]})]}),n&&f&&c.jsx(rU,{progress:f})]})}function rU({progress:t}){const e=()=>{switch(t.phase){case"deleting-months":return"Deleting months...";case"deleting-payees":return"Deleting payees...";case"deleting-budgets":return"Deleting budgets...";case"updating-user":return"Updating user document...";case"clearing-cache":return"Clearing cache...";case"complete":return"Complete!";default:return"Processing..."}},n=()=>t.phase==="updating-user"||t.phase==="clearing-cache"||t.phase==="complete"?"linear-gradient(90deg, #22c55e, #10b981)":"linear-gradient(90deg, #f59e0b, #d97706)",r=()=>t.phase==="updating-user"||t.phase==="clearing-cache"||t.phase==="complete"?"#22c55e":"#f59e0b";return c.jsxs(ac,{message:e(),spinnerColor:r(),children:[c.jsx(od,{percent:t.percentComplete,gradient:n()}),c.jsxs(ho,{columns:2,children:[c.jsx(on,{value:`${t.monthsDeleted}/${t.totalMonths}`,label:"Months Deleted",color:"#f59e0b"}),c.jsx(on,{value:`${t.budgetsDeleted}/${t.totalBudgets}`,label:"Budgets Deleted",color:"#f59e0b"})]}),c.jsx(ld,{percent:t.percentComplete})]})}function sU({result:t}){return c.jsx("div",{style:{marginTop:"1rem"},children:c.jsx(Ue,{type:t.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[t.errors.length>0?"":""," Import ",t.success?"complete":"finished with errors",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[c.jsxs("li",{children:[t.imported," records imported"]}),t.skipped>0&&c.jsxs("li",{children:[t.skipped," records skipped"]})]}),t.errors.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[t.errors.slice(0,5).map((e,n)=>c.jsx("li",{children:e},n)),t.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",t.errors.length-5," more errors"]})]})]})]})})})}function iU({recordCount:t,recordTypeCounts:e,monthRange:n,onCancel:r,onConfirm:a}){const o=()=>n?n.isSingleMonth?n.start:`${n.start} to ${n.end}`:"";return c.jsxs("div",{children:[c.jsxs("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:[c.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" Warning: Destructive Operation"}),c.jsxs("p",{style:{margin:"0.5rem 0 0",color:"rgba(255, 255, 255, 0.8)",fontSize:"0.9rem"},children:["This will ",c.jsx("strong",{children:"REPLACE"})," all existing income, expenses, and allocations in"," ",c.jsx("strong",{style:{color:"#fbbf24"},children:n?.count===1?"1 month":`${n?.count} months`})," ","(",o(),")."]})]}),c.jsxs("p",{style:{margin:"0 0 0.5rem",opacity:.8},children:["You are about to import ",c.jsx("strong",{children:t.toLocaleString()})," records:"]}),c.jsxs("ul",{style:{margin:"0 0 1rem",paddingLeft:"1.5rem",fontSize:"0.9rem",opacity:.9},children:[e.income>0&&c.jsxs("li",{children:[e.income.toLocaleString()," income transactions"]}),e.spend>0&&c.jsxs("li",{children:[e.spend.toLocaleString()," expense transactions"]}),e.allocations>0&&c.jsxs("li",{children:[e.allocations.toLocaleString()," budget allocations"]})]}),c.jsxs("p",{style:{margin:"0 0 1.5rem",opacity:.8},children:["Any existing data of these types in the affected months will be ",c.jsx("strong",{style:{color:"#fca5a5"},children:"deleted and replaced"}),". This cannot be undone."]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{variant:"secondary",actionName:"Cancel Seed Import",onClick:r,children:"Cancel"}),c.jsx(Ie,{variant:"danger",actionName:"Confirm Seed Import",onClick:a,children:"Replace & Import"})]})]})}function aU({progress:t}){const e=()=>{switch(t.phase){case"saving-mappings":return"Saving mappings...";case"reading-months":return`Reading ${t.totalMonths} months (parallel)...`;case"creating-months":return t.currentMonth?`Creating ${t.currentMonth}...`:`Creating ${t.monthsToCreate} new months...`;case"processing-months":return t.currentMonth?`Processing & recalculating ${t.currentMonth}...`:`Processing ${t.totalRecords.toLocaleString()} records...`;case"saving-months":return`Saving ${t.totalMonths} months (batch)...`;case"updating-budget":return"Updating budget balances...";case"complete":return"Import complete!";default:return"Importing..."}},n=t.phase==="creating-months"&&t.monthsToCreate>0,r=t.phase==="processing-months"||t.phase==="saving-months"||t.phase==="updating-budget"||t.phase==="complete";return c.jsxs(ac,{message:e(),spinnerColor:"#646cff",children:[c.jsx(od,{percent:t.percentComplete,gradient:"linear-gradient(90deg, #646cff, #8b5cf6)"}),n&&c.jsxs(ho,{columns:2,children:[c.jsx(on,{value:`${t.monthsCreated}/${t.monthsToCreate}`,label:"Months Created",color:"#f59e0b"}),c.jsx(on,{value:t.totalMonths,label:"Total Months",color:"#646cff"})]}),!n&&c.jsxs(ho,{columns:t.gapMonths>0?3:2,children:[c.jsx(on,{value:t.totalMonths,label:"Months",color:"#646cff"}),t.monthsCreated>0&&c.jsx(on,{value:t.monthsCreated,label:"New",color:"#f59e0b"}),t.gapMonths>0&&c.jsx(on,{value:t.gapMonths,label:"Gap Filled",color:"#8b5cf6"})]}),r&&c.jsxs(ho,{columns:3,children:[c.jsx(on,{value:t.incomeImported,label:"Income",color:"#22c55e"}),c.jsx(on,{value:t.spendImported,label:"Expenses",color:"#ef4444"}),c.jsx(on,{value:t.allocationsImported,label:"Allocations",color:"#3b82f6"})]}),c.jsx(ld,{percent:t.percentComplete})]})}function oU(t,e){return t.account_group_id&&e[t.account_group_id]?e[t.account_group_id].name:"Ungrouped"}function Gh({oldName:t,currentMapping:e,options:n,onMap:r,placeholder:a,isAutoMapped:o}){const u=h=>{const f=h.target.value,m=n.find(g=>g.id===f);if(m){const g=m.rawName??m.name;r(f,g)}};return c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem",padding:"0.5rem",background:o?"color-mix(in srgb, #22c55e 8%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"6px",borderLeft:o?"3px solid #22c55e":"none"},children:[c.jsxs("span",{style:{flex:"0 0 40%",fontSize:"0.85rem",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"0.35rem"},title:t,children:['"',t,'"',o&&c.jsx("span",{style:{fontSize:"0.7rem",opacity:.6},children:"(auto)"})]}),c.jsx("span",{style:{opacity:.5},children:""}),c.jsxs("select",{value:e?.newId??"",onChange:u,style:{flex:1,padding:"0.4rem",borderRadius:"4px",border:e?"1px solid #22c55e":"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:e?"color-mix(in srgb, #22c55e 10%, transparent)":"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",fontSize:"0.85rem"},children:[c.jsx("option",{value:"",children:a}),n.map(h=>c.jsx("option",{value:h.id,children:h.name},h.id))]})]})}function lU({unmappedCategories:t,unmappedAccounts:e,customMappedCategories:n,customMappedAccounts:r,categoryMappings:a,accountMappings:o,categories:u,accounts:h,accountGroups:f,onCategoryMap:m,onAccountMap:g}){const _=C.useMemo(()=>{const S=Object.entries(u).sort((E,T)=>E[1].name.localeCompare(T[1].name));return[[Rt,{name:ba,category_group_id:null,sort_order:-1}],...S]},[u]),v=C.useMemo(()=>{const S=Object.entries(h).sort((E,T)=>E[1].nickname.localeCompare(T[1].nickname)).map(([E,T])=>({id:E,acc:T,displayName:`${T.nickname} (${oU(T,f)})`}));return[{id:Tt,acc:{nickname:Ps},displayName:Ps},...S]},[h,f]),x=t.length>0||e.length>0;return c.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:[c.jsx("h4",{style:{margin:"0 0 0.75rem 0",fontSize:"0.95rem"},children:" Entity Mappings"}),c.jsxs("p",{style:{margin:"0 0 1rem 0",fontSize:"0.85rem",opacity:.8},children:[x?"Map unknown entities to existing categories/accounts.":"Review saved mappings (names that don't exactly match existing entities)."," ","These mappings will be saved for future imports."]}),t.length>0&&c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#ef4444"},children:[" Unmapped Categories (",t.length,")"]}),t.map(S=>c.jsx(Gh,{oldName:S,currentMapping:a.get(S),options:_.map(([E,T])=>({id:E,name:T.name})),onMap:(E,T)=>m(S,E,T),placeholder:"Select a category..."},`cat-unmapped-${S}`))]}),n.length>0&&c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#60a5fa"},children:[" Saved Category Mappings (",n.length,")"]}),n.map(S=>c.jsx(Gh,{oldName:S,currentMapping:a.get(S),options:_.map(([E,T])=>({id:E,name:T.name})),onMap:(E,T)=>m(S,E,T),placeholder:"Select a category...",isAutoMapped:!0},`cat-custom-${S}`))]}),e.length>0&&c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#ef4444"},children:[" Unmapped Accounts (",e.length,")"]}),e.map(S=>c.jsx(Gh,{oldName:S,currentMapping:o.get(S),options:v.map(({id:E,acc:T,displayName:I})=>({id:E,name:I,rawName:T.nickname})),onMap:(E,T)=>g(S,E,T),placeholder:"Select an account..."},`acc-unmapped-${S}`))]}),r.length>0&&c.jsxs("div",{children:[c.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#60a5fa"},children:[" Saved Account Mappings (",r.length,")"]}),r.map(S=>c.jsx(Gh,{oldName:S,currentMapping:o.get(S),options:v.map(({id:E,acc:T,displayName:I})=>({id:E,name:I,rawName:T.nickname})),onMap:(E,T)=>g(S,E,T),placeholder:"Select an account...",isAutoMapped:!0},`acc-custom-${S}`))]})]})}function cU({disabled:t}){const{selectedBudgetId:e}=zt(),{data:n}=fT(e),r=C.useRef(null),[a,o]=C.useState(null),[u,h]=C.useState(!1),{status:f,parsedData:m,unmappedCategories:g,unmappedAccounts:_,customMappedCategories:v,customMappedAccounts:x,categoryMappings:S,accountMappings:E,importResult:T,importProgress:I,parseFile:j,setCategoryMapping:M,setAccountMapping:Q,runImport:H,reset:W,isParsing:D,isImporting:A,hasUnmappedEntities:N}=h6(e),P=v.length>0||x.length>0,L=C.useMemo(()=>n?.budget?.categories??{},[n?.budget?.categories]),B=C.useMemo(()=>n?.budget?.accounts??{},[n?.budget?.accounts]),O=C.useMemo(()=>n?.budget?.account_groups??{},[n?.budget?.account_groups]),G=C.useCallback(q=>{const te=q.target.files?.[0];te&&(o(te),j(te,L,B))},[j,L,B]),Y=C.useCallback(()=>{!e||!m||h(!0)},[e,m]),U=C.useCallback(async()=>{h(!1),!(!e||!m)&&await H(L,B)},[e,m,H,L,B]),F=C.useCallback(()=>{o(null),W(),r.current&&(r.current.value="")},[W]),K=C.useMemo(()=>T&&T.errors.length===0?"complete":f==="ready"||f==="mapping"?"needs-action":"unknown",[f,T]),Z=C.useMemo(()=>T&&T.errors.length===0?" Import Complete":f==="ready"?"Ready to Import":f==="mapping"?"Mapping Required":"Select a File",[f,T]),{monthRange:re,recordTypeCounts:z}=C.useMemo(()=>{if(!m||m.length===0)return{monthRange:null,recordTypeCounts:{income:0,spend:0,allocations:0}};const q=new Set;let te=1/0,ie=-1/0,ee=12,le=1;const pe={income:0,spend:0,allocations:0};for(const Se of m)q.add(`${Se.year}-${Se.month}`),(Se.year<te||Se.year===te&&Se.month<ee)&&(te=Se.year,ee=Se.month),(Se.year>ie||Se.year===ie&&Se.month>le)&&(ie=Se.year,le=Se.month),Se.recordType==="income"?pe.income++:Se.recordType==="spend"?pe.spend++:Se.recordType==="allocation"&&pe.allocations++;const xe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ve=`${xe[ee-1]} ${te}`,J=`${xe[le-1]} ${ie}`;return{monthRange:{start:ve,end:J,count:q.size,isSingleMonth:q.size===1},recordTypeCounts:pe}},[m]);return c.jsxs(ss,{title:" Seed Data Import",description:"Import historical data from a combined CSV file. The file should have a 'type' column (income, spend, or allocation) as the first column. Unknown categories and accounts will be mapped to existing ones.",status:K,statusText:Z,onRefresh:F,isRefreshing:!1,isBusy:D||A,cardName:"Seed Import",children:[A&&I&&c.jsx(aU,{progress:I}),c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:500,fontSize:"0.9rem"},children:"CSV File"}),c.jsx("input",{ref:r,type:"file",accept:".csv",onChange:G,disabled:t||D||A,style:{display:"block",width:"100%",padding:"0.5rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",color:"inherit",cursor:t||D||A?"not-allowed":"pointer"}}),a&&c.jsxs("p",{style:{margin:"0.5rem 0 0",fontSize:"0.85rem",opacity:.7},children:["Selected: ",a.name]})]}),D&&c.jsxs(Ue,{type:"running",children:[c.jsx(va,{})," Parsing CSV file..."]}),m&&m.length>0&&!D&&c.jsx("div",{style:{marginBottom:"1rem"},children:c.jsx(Ue,{type:N?"warning":"clean",children:c.jsxs("div",{children:[N?"":""," Parsed ",m.length," rows",c.jsxs("ul",{style:{margin:"0.5rem 0 0",paddingLeft:"1.5rem",fontSize:"0.85rem"},children:[z.income>0&&c.jsxs("li",{children:[z.income," income"]}),z.spend>0&&c.jsxs("li",{children:[z.spend," spend"]}),z.allocations>0&&c.jsxs("li",{children:[z.allocations," allocations"]})]}),N&&c.jsx("span",{style:{display:"block",fontSize:"0.85rem",marginTop:"0.25rem"},children:"Some categories or accounts need to be mapped"})]})})}),(N||P)&&!D&&c.jsx(lU,{unmappedCategories:g,unmappedAccounts:_,customMappedCategories:v,customMappedAccounts:x,categoryMappings:S,accountMappings:E,categories:L,accounts:B,accountGroups:O,onCategoryMap:M,onAccountMap:Q}),f==="ready"&&!D&&c.jsxs(rr,{onClick:Y,disabled:t||!e,isBusy:A,busyText:"Importing...",actionName:"Run Seed Import",children:[" Import ",m?.length??0," Records"]}),T&&c.jsx(sU,{result:T}),c.jsx(Bs,{isOpen:u,onClose:()=>h(!1),title:" Confirm Import",children:c.jsx(iU,{recordCount:m?.length??0,recordTypeCounts:z,monthRange:re,onCancel:()=>h(!1),onConfirm:U})})]})}function uU({hasData:t,status:e,hasIssues:n,totalIssues:r,isRunning:a,result:o,onRunCleanup:u,onRefresh:h,isRefreshing:f,disabled:m}){const g=()=>t?o&&o.errors.length===0&&(o.budgetsProcessed>0||o.monthsProcessed>0)?"complete":n?"needs-action":"clean":"unknown",_=o?o.accountsFixed+o.categoriesFixed+o.totalAvailableFixed+o.incomeValuesFixed+o.expenseValuesFixed+o.categoryBalancesFixed+o.accountBalancesFixed:0;return c.jsx(ss,{title:" Currency Precision Cleanup",description:"Fixes floating-point precision issues by rounding all currency values to exactly 2 decimal places. Processes all months in batches, recalculates budget balances, and clears all caches. This prevents display issues like '$0.00' showing as orange (slightly negative) or totals not summing correctly.",status:g(),onRefresh:h,isRefreshing:f,isBusy:a,children:a?c.jsx(Ue,{type:"running",children:"Running precision cleanup..."}):o?c.jsx(Ue,{type:o.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[o.errors.length>0?"":""," Cleanup complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[o.budgetsProcessed>0&&c.jsxs("li",{children:[o.budgetsProcessed," budget",o.budgetsProcessed!==1?"s":""," updated"]}),o.accountsFixed>0&&c.jsxs("li",{children:[o.accountsFixed," account balance",o.accountsFixed!==1?"s":""," fixed"]}),o.categoriesFixed>0&&c.jsxs("li",{children:[o.categoriesFixed," category value",o.categoriesFixed!==1?"s":""," fixed"]}),o.totalAvailableFixed>0&&c.jsxs("li",{children:[o.totalAvailableFixed," total_available value",o.totalAvailableFixed!==1?"s":""," fixed"]}),o.monthsProcessed>0&&c.jsxs("li",{children:[o.monthsProcessed," month",o.monthsProcessed!==1?"s":""," updated"]}),o.incomeValuesFixed>0&&c.jsxs("li",{children:[o.incomeValuesFixed," income amount",o.incomeValuesFixed!==1?"s":""," fixed"]}),o.expenseValuesFixed>0&&c.jsxs("li",{children:[o.expenseValuesFixed," expense amount",o.expenseValuesFixed!==1?"s":""," fixed"]}),o.categoryBalancesFixed>0&&c.jsxs("li",{children:[o.categoryBalancesFixed," category balance",o.categoryBalancesFixed!==1?"s":""," fixed"]}),o.accountBalancesFixed>0&&c.jsxs("li",{children:[o.accountBalancesFixed," account balance",o.accountBalancesFixed!==1?"s":""," fixed"]}),_===0&&c.jsx("li",{children:"No changes needed"})]}),o.errors.length>0?c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[o.errors.slice(0,5).map((v,x)=>c.jsx("li",{children:v},x)),o.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",o.errors.length-5," more errors"]})]})]}):c.jsx("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:" All budgets recalculated and cache cleared."})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",r," precision issue",r!==1?"s":""," to fix:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.budgetsWithPrecisionIssues>0&&c.jsxs("li",{children:[e.budgetsWithPrecisionIssues," budget",e.budgetsWithPrecisionIssues!==1?"s":""," with precision issues",c.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.85rem",opacity:.8},children:[e.accountsWithPrecisionIssues>0&&c.jsxs("li",{children:[e.accountsWithPrecisionIssues," account balance",e.accountsWithPrecisionIssues!==1?"s":""]}),e.categoriesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.categoriesWithPrecisionIssues," category value",e.categoriesWithPrecisionIssues!==1?"s":""]}),e.totalAvailableWithPrecisionIssues>0&&c.jsxs("li",{children:[e.totalAvailableWithPrecisionIssues," total_available value",e.totalAvailableWithPrecisionIssues!==1?"s":""]})]})]}),e.monthsWithPrecisionIssues>0&&c.jsxs("li",{children:[e.monthsWithPrecisionIssues," month",e.monthsWithPrecisionIssues!==1?"s":""," with precision issues",c.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.85rem",opacity:.8},children:[e.incomeValuesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.incomeValuesWithPrecisionIssues," income amount",e.incomeValuesWithPrecisionIssues!==1?"s":""]}),e.expenseValuesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.expenseValuesWithPrecisionIssues," expense amount",e.expenseValuesWithPrecisionIssues!==1?"s":""]}),e.categoryBalancesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.categoryBalancesWithPrecisionIssues," category balance value",e.categoryBalancesWithPrecisionIssues!==1?"s":""]}),e.accountBalancesWithPrecisionIssues>0&&c.jsxs("li",{children:[e.accountBalancesWithPrecisionIssues," account balance value",e.accountBalancesWithPrecisionIssues!==1?"s":""]})]})]})]}),c.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budgets and ",e.totalMonths," months."]})]})}),c.jsxs(rr,{onClick:u,disabled:m,isBusy:a,busyText:"Running...",actionName:"Run Precision Cleanup",children:[" Fix ",r," Issue",r!==1?"s":""]})]}):c.jsx(Ue,{type:"clean",children:c.jsxs("div",{children:[" All currency values have proper precision",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalBudgets," budgets and ",e.totalMonths," months have values rounded to 2 decimal places."]})]})}):c.jsx(Ue,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function dU({hasData:t,status:e,hasItemsToMigrate:n,isRunning:r,result:a,onRunMigration:o,onRefresh:u,isRefreshing:h,disabled:f}){const m=()=>t?a&&a.errors.length===0&&a.expensesMigrated>0?"complete":n?"needs-action":"clean":"unknown";return c.jsx(ss,{title:" Expense to Adjustment Migration",description:"Migrates expense entries with 'No Account' or 'No Category' to the new Adjustments tab. Also fixes invalid account/category IDs like 'unknown' by converting them to proper no-account/no-category values. After this migration, the Spend tab will require both a real account AND category.",status:m(),onRefresh:u,isRefreshing:h,isBusy:r,children:r?c.jsx(Ue,{type:"running",children:"Running expense to adjustment migration..."}):a?c.jsx(Ue,{type:a.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[a.errors.length>0?"":""," Migration complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[a.budgetsProcessed>0&&c.jsxs("li",{children:[a.budgetsProcessed," budget",a.budgetsProcessed!==1?"s":""," scanned"]}),a.monthsProcessed>0&&c.jsxs("li",{children:[a.monthsProcessed," month",a.monthsProcessed!==1?"s":""," updated"]}),a.expensesMigrated>0&&c.jsxs("li",{children:[a.expensesMigrated," expense",a.expensesMigrated!==1?"s":""," migrated to adjustments"]}),a.invalidAccountsFixed>0&&c.jsxs("li",{children:[a.invalidAccountsFixed," invalid account ID",a.invalidAccountsFixed!==1?"s":""," fixed"]}),a.invalidCategoriesFixed>0&&c.jsxs("li",{children:[a.invalidCategoriesFixed," invalid category ID",a.invalidCategoriesFixed!==1?"s":""," fixed"]}),a.expensesMigrated===0&&c.jsx("li",{children:"No changes needed"})]}),a.errors.length>0?c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[a.errors.slice(0,5).map((g,_)=>c.jsx("li",{children:g},_)),a.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",a.errors.length-5," more errors"]})]})]}):c.jsx("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:' All data migrated successfully. Run "Database Cleanup" to recalculate balances.'})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.expensesToMigrate," expense",e.expensesToMigrate!==1?"s":""," to migrate:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[c.jsxs("li",{children:[e.expensesToMigrate," expense",e.expensesToMigrate!==1?"s":""," with No Account or No Category"]}),e.invalidAccountsToFix>0&&c.jsxs("li",{children:[e.invalidAccountsToFix," invalid account ID",e.invalidAccountsToFix!==1?"s":"",' (e.g., "unknown")']}),e.invalidCategoriesToFix>0&&c.jsxs("li",{children:[e.invalidCategoriesToFix," invalid category ID",e.invalidCategoriesToFix!==1?"s":"",' (e.g., "unknown")']})]}),c.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," and ",e.totalMonths," month",e.totalMonths!==1?"s":"","."]})]})}),c.jsxs(rr,{onClick:o,disabled:f,isBusy:r,busyText:"Migrating...",actionName:"Run Expense to Adjustment Migration",children:[" Migrate ",e.expensesToMigrate," Expense",e.expensesToMigrate!==1?"s":""]})]}):c.jsx(Ue,{type:"clean",children:c.jsxs("div",{children:[" No expenses need migration",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalMonths," month",e.totalMonths!==1?"s":""," across ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," have valid expense data."]})]})}):c.jsx(Ue,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function hU({hasData:t,status:e,hasItemsToFix:n,isRunning:r,result:a,onRunMigration:o,onRefresh:u,isRefreshing:h,disabled:f}){const m=()=>t?a&&a.errors.length===0&&(a.categoryIdsFixed>0||a.accountIdsFixed>0)?"complete":n?"needs-action":"clean":"unknown",g=e?e.orphanedCategoryIds+e.orphanedAccountIds:0,_=a?a.categoryIdsFixed+a.accountIdsFixed:0;return c.jsx(ss,{title:" Orphaned ID Cleanup",description:"Finds transactions referencing deleted or non-existent categories/accounts and converts them to 'No Category' / 'No Account'. Run this BEFORE the Expense to Adjustment migration.",status:m(),onRefresh:u,isRefreshing:h,isBusy:r,children:r?c.jsx(Ue,{type:"running",children:"Running orphaned ID cleanup..."}):a?c.jsx(Ue,{type:a.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[a.errors.length>0?"":""," Cleanup complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[a.budgetsProcessed>0&&c.jsxs("li",{children:[a.budgetsProcessed," budget",a.budgetsProcessed!==1?"s":""," scanned"]}),a.monthsProcessed>0&&c.jsxs("li",{children:[a.monthsProcessed," month",a.monthsProcessed!==1?"s":""," updated"]}),a.categoryIdsFixed>0&&c.jsxs("li",{children:[a.categoryIdsFixed," orphaned category ID",a.categoryIdsFixed!==1?"s":"","  No Category"]}),a.accountIdsFixed>0&&c.jsxs("li",{children:[a.accountIdsFixed," orphaned account ID",a.accountIdsFixed!==1?"s":"","  No Account"]}),_===0&&c.jsx("li",{children:"No changes needed"})]}),a.errors.length>0?c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[a.errors.slice(0,5).map((v,x)=>c.jsx("li",{children:v},x)),a.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",a.errors.length-5," more errors"]})]})]}):c.jsx("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:' Now run "Expense to Adjustment Migration" to move these to the Adjustments tab.'})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",g," orphaned ID",g!==1?"s":""," to fix:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.orphanedCategoryIds>0&&c.jsxs("li",{children:[e.orphanedCategoryIds," orphaned category ID",e.orphanedCategoryIds!==1?"s":""]}),e.orphanedAccountIds>0&&c.jsxs("li",{children:[e.orphanedAccountIds," orphaned account ID",e.orphanedAccountIds!==1?"s":""]})]}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Affected transactions: ",e.affectedExpenses," expense",e.affectedExpenses!==1?"s":"",", ",e.affectedIncome," income, ",e.affectedTransfers," transfer",e.affectedTransfers!==1?"s":"",", ",e.affectedAdjustments," adjustment",e.affectedAdjustments!==1?"s":""]}),c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," and ",e.totalMonths," month",e.totalMonths!==1?"s":"","."]})]})}),c.jsxs(rr,{onClick:o,disabled:f,isBusy:r,busyText:"Cleaning up...",actionName:"Run Orphaned ID Cleanup",children:[" Fix ",g," Orphaned ID",g!==1?"s":""]})]}):c.jsx(Ue,{type:"clean",children:c.jsxs("div",{children:[" No orphaned IDs found",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalMonths," month",e.totalMonths!==1?"s":""," across ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," have valid category/account references."]})]})}):c.jsx(Ue,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function fU({hasData:t,status:e,hasPairsToConvert:n,isRunning:r,result:a,onRunMigration:o,onRefresh:u,isRefreshing:h,disabled:f}){const m=()=>t?a&&a.errors.length===0&&a.transfersCreated>0?"complete":n?"needs-action":"clean":"unknown";return c.jsx(ss,{title:" Adjustments to Transfers",description:"Finds pairs of adjustments with exact opposite amounts on the same date and converts them to transfers. Only converts valid pairs: account-to-account (both No Category) or category-to-category (both No Account).",status:m(),onRefresh:u,isRefreshing:h,isBusy:r,children:r?c.jsx(Ue,{type:"running",children:"Converting adjustment pairs to transfers..."}):a?c.jsx(Ue,{type:a.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[a.errors.length>0?"":""," Migration complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[a.budgetsProcessed>0&&c.jsxs("li",{children:[a.budgetsProcessed," budget",a.budgetsProcessed!==1?"s":""," scanned"]}),a.monthsProcessed>0&&c.jsxs("li",{children:[a.monthsProcessed," month",a.monthsProcessed!==1?"s":""," updated"]}),a.transfersCreated>0&&c.jsxs("li",{children:[a.transfersCreated," transfer",a.transfersCreated!==1?"s":""," created"]}),a.adjustmentsRemoved>0&&c.jsxs("li",{children:[a.adjustmentsRemoved," adjustment",a.adjustmentsRemoved!==1?"s":""," removed"]}),a.transfersCreated===0&&c.jsx("li",{children:"No changes needed"})]}),a.errors.length>0?c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[a.errors.slice(0,5).map((g,_)=>c.jsx("li",{children:g},_)),a.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",a.errors.length-5," more errors"]})]})]}):c.jsx("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:" Adjustment pairs converted to transfers successfully."})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.pairsFound," adjustment pair",e.pairsFound!==1?"s":""," to convert:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.accountTransferPairs>0&&c.jsxs("li",{children:[e.accountTransferPairs," account-to-account transfer",e.accountTransferPairs!==1?"s":""]}),e.categoryTransferPairs>0&&c.jsxs("li",{children:[e.categoryTransferPairs," category-to-category transfer",e.categoryTransferPairs!==1?"s":""]})]}),c.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," and ",e.totalMonths," month",e.totalMonths!==1?"s":"","."]})]})}),c.jsxs(rr,{onClick:o,disabled:f,isBusy:r,busyText:"Converting...",actionName:"Run Adjustments to Transfers Migration",children:[" Convert ",e.pairsFound," Pair",e.pairsFound!==1?"s":""," to Transfer",e.pairsFound!==1?"s":""]})]}):c.jsx(Ue,{type:"clean",children:c.jsxs("div",{children:[" No adjustment pairs found to convert",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalMonths," month",e.totalMonths!==1?"s":""," across ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," checked."]})]})}):c.jsx(Ue,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function mU({hasData:t,status:e,report:n,hasViolations:r,violationCount:a,isScanning:o,onScan:u,disabled:h}){const[f,m]=C.useState(!1),[g,_]=C.useState(null),[v,x]=C.useState(!1),S=C.useRef(null),E=()=>t?r?"needs-action":"clean":"unknown",T=M=>{const Q=M.target.files?.[0];if(!Q)return;const H=new FileReader;H.onload=W=>{_(W.target?.result)},H.readAsText(Q)},I=()=>{u(f&&g?g:void 0)},j=()=>{n&&navigator.clipboard.writeText(n)};return c.jsxs(ss,{title:" Account/Category Validation",description:"Scans all transactions for invalid account/category combinations. Can compare against seed CSV to identify source rows.",status:E(),onRefresh:I,isRefreshing:o,isBusy:o,children:[c.jsxs("div",{style:{marginBottom:"0.75rem",padding:"0.75rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px"},children:[c.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",marginBottom:"0.5rem"},children:[c.jsx("input",{type:"checkbox",checked:f,onChange:M=>m(M.target.checked)}),c.jsx("span",{style:{fontSize:"0.9rem"},children:"Compare against seed CSV (optional)"})]}),f&&c.jsxs("div",{style:{marginTop:"0.5rem"},children:[c.jsx("input",{ref:S,type:"file",accept:".csv",onChange:T,style:{fontSize:"0.85rem"}}),g&&c.jsxs("div",{style:{marginTop:"0.25rem",fontSize:"0.8rem",opacity:.7},children:[" Seed file loaded (",g.split(`
`).length," lines)"]})]})]}),o?c.jsx(Ue,{type:"running",children:"Scanning transactions..."}):t?r?c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",a," transaction",a!==1?"s":""," with invalid account/category configuration"]}),e&&c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.violations.filter(M=>M.transactionType==="income").length>0&&c.jsxs("li",{children:[e.violations.filter(M=>M.transactionType==="income").length," income transaction",e.violations.filter(M=>M.transactionType==="income").length!==1?"s":""]}),e.violations.filter(M=>M.transactionType==="expense").length>0&&c.jsxs("li",{children:[e.violations.filter(M=>M.transactionType==="expense").length," expense transaction",e.violations.filter(M=>M.transactionType==="expense").length!==1?"s":""]}),e.violations.filter(M=>M.transactionType==="adjustment").length>0&&c.jsxs("li",{children:[e.violations.filter(M=>M.transactionType==="adjustment").length," adjustment transaction",e.violations.filter(M=>M.transactionType==="adjustment").length!==1?"s":""]}),e.violations.filter(M=>M.transactionType==="transfer").length>0&&c.jsxs("li",{children:[e.violations.filter(M=>M.transactionType==="transfer").length," transfer transaction",e.violations.filter(M=>M.transactionType==="transfer").length!==1?"s":""]})]}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e?.totalMonths," month",e?.totalMonths!==1?"s":""," (",e?.totalIncome," income, ",e?.totalExpenses," expenses, ",e?.totalAdjustments," adjustments, ",e?.totalTransfers," transfers)"]})]})}),c.jsxs("div",{style:{marginTop:"0.5rem"},children:[c.jsxs("button",{onClick:()=>x(!v),style:{background:"none",border:"none",color:"#646cff",cursor:"pointer",fontSize:"0.9rem",textDecoration:"underline"},children:[v?"Hide":"Show"," Detailed Report"]}),n&&c.jsx("button",{onClick:j,style:{background:"none",border:"none",color:"#646cff",cursor:"pointer",fontSize:"0.9rem",textDecoration:"underline",marginLeft:"1rem"},children:" Copy Report"})]}),v&&n&&c.jsx("pre",{style:{marginTop:"0.5rem",padding:"1rem",background:"#1a1a2e",color:"#eee",borderRadius:"6px",fontSize:"0.75rem",overflow:"auto",maxHeight:"400px",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:n}),c.jsx(rr,{onClick:I,disabled:h||f&&!g,isBusy:o,busyText:"Scanning...",actionName:"Re-scan Transaction Validation",children:" Re-scan Transactions"})]}):c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"clean",children:c.jsxs("div",{children:[" All transactions have valid account/category configurations",c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e?.totalMonths," month",e?.totalMonths!==1?"s":""," (",e?.totalIncome," income, ",e?.totalExpenses," expenses, ",e?.totalAdjustments," adjustments, ",e?.totalTransfers," transfers)"]})]})}),c.jsx(rr,{onClick:I,disabled:h||f&&!g,isBusy:o,busyText:"Scanning...",actionName:"Re-scan Transaction Validation",children:" Re-scan Transactions"})]}):c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"unknown",children:" Click Scan to check all transactions for validation issues"}),c.jsx(rr,{onClick:I,disabled:h||f&&!g,isBusy:o,busyText:"Scanning...",actionName:"Scan Transaction Validation",children:" Scan All Transactions"})]})]})}function pU({hasData:t,status:e,needsMigration:n,totalItemsToFix:r,isRunning:a,result:o,onRunMigration:u,onRefresh:h,isRefreshing:f,disabled:m}){const g=()=>t?o&&o.errors.length===0?"complete":n?"needs-action":"clean":"unknown",_=o?o.accountsUpdated+o.categoriesUpdated+o.hiddenAccountsCreated+o.hiddenCategoriesCreated+o.adjustmentsFixed:0;return c.jsx(ss,{title:" Hidden Field Migration",description:"Adds is_hidden field to accounts/categories, creates hidden account 'Alerus 401K Eide Bailly' and category 'House', and fixes adjustment transactions missing both account and category.",status:g(),onRefresh:h,isRefreshing:f,isBusy:a,children:a?c.jsx(Ue,{type:"running",children:"Running hidden field migration..."}):o?c.jsx(Ue,{type:o.errors.length>0?"warning":"success",children:c.jsxs("div",{children:[o.errors.length>0?"":""," Migration complete",c.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[o.budgetsProcessed>0&&c.jsxs("li",{children:[o.budgetsProcessed," budget",o.budgetsProcessed!==1?"s":""," updated"]}),o.accountsUpdated>0&&c.jsxs("li",{children:[o.accountsUpdated," account",o.accountsUpdated!==1?"s":""," got is_hidden field"]}),o.categoriesUpdated>0&&c.jsxs("li",{children:[o.categoriesUpdated," categor",o.categoriesUpdated!==1?"ies":"y"," got is_hidden field"]}),o.hiddenAccountsCreated>0&&c.jsxs("li",{children:[o.hiddenAccountsCreated," hidden account",o.hiddenAccountsCreated!==1?"s":""," created"]}),o.hiddenCategoriesCreated>0&&c.jsxs("li",{children:[o.hiddenCategoriesCreated," hidden categor",o.hiddenCategoriesCreated!==1?"ies":"y"," created"]}),o.adjustmentsFixed>0&&c.jsxs("li",{children:[o.adjustmentsFixed," adjustment",o.adjustmentsFixed!==1?"s":""," fixed"]}),_===0&&c.jsx("li",{children:"No changes needed"})]}),o.errors.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[o.errors.slice(0,5).map((v,x)=>c.jsx("li",{children:v},x)),o.errors.length>5&&c.jsxs("li",{style:{opacity:.7},children:["...and ",o.errors.length-5," more errors"]})]})]})]})}):t?n?c.jsxs(c.Fragment,{children:[c.jsx(Ue,{type:"warning",children:c.jsxs("div",{children:[c.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",r," item",r!==1?"s":""," to migrate:"]}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.accountsNeedingField>0&&c.jsxs("li",{children:[e.accountsNeedingField," account",e.accountsNeedingField!==1?"s":""," need is_hidden field"]}),e.categoriesNeedingField>0&&c.jsxs("li",{children:[e.categoriesNeedingField," categor",e.categoriesNeedingField!==1?"ies":"y"," need is_hidden field"]}),e.adjustmentsToFix>0&&c.jsxs("li",{children:[e.adjustmentsToFix," adjustment",e.adjustmentsToFix!==1?"s":""," with missing account/category"]})]}),e.adjustmentDetails.length>0&&c.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",opacity:.8},children:[c.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:500},children:"Adjustments to fix:"}),c.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[e.adjustmentDetails.slice(0,3).map((v,x)=>c.jsxs("li",{children:["[",v.monthKey,"] $",v.amount.toFixed(2)," - ",v.description||"(no description)"]},x)),e.adjustmentDetails.length>3&&c.jsxs("li",{style:{opacity:.7},children:["...and ",e.adjustmentDetails.length-3," more"]})]})]}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budget",e.totalBudgets!==1?"s":""," and ",e.totalMonths," month",e.totalMonths!==1?"s":"","."]})]})}),c.jsxs(rr,{onClick:u,disabled:m,isBusy:a,busyText:"Migrating...",actionName:"Run Hidden Field Migration",children:[" Run Migration (",r," item",r!==1?"s":"",")"]})]}):c.jsx(Ue,{type:"clean",children:c.jsxs("div",{children:[" All accounts and categories have is_hidden field",c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:"No adjustment transactions with missing account/category found."})]})}):c.jsx(Ue,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function gU({status:t,result:e,isScanning:n,isRunning:r,onScan:a,onRun:o,disabled:u}){const h=C.useRef(null),f=async m=>{const g=m.target.files?.[0];if(!g)return;const _=await g.text();await a(_),h.current&&(h.current.value="")};return c.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem",border:`1px solid color-mix(in srgb, ${t?.monthsToRestore?"#ffc107":"#6c757d"} 30%, transparent)`},children:c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("h3",{style:{margin:"0 0 0.25rem 0",fontSize:"1rem",color:t?.monthsToRestore?"#ffc107":"#6c757d"},children:" Restore from Diagnostic"}),c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Restore lost transfers and adjustments from a diagnostic JSON file. Use this to recover data that was accidentally deleted."}),t&&c.jsxs("div",{style:{marginTop:"0.75rem",fontSize:"0.85rem"},children:[c.jsxs("p",{style:{margin:0},children:[c.jsx("strong",{children:"Diagnostic from:"})," ",new Date(t.diagnosticTimestamp).toLocaleString()]}),c.jsxs("p",{style:{margin:"0.25rem 0 0 0"},children:[c.jsx("strong",{children:"Months to restore:"})," ",t.monthsToRestore,t.monthsToRestore>0&&c.jsxs("span",{style:{opacity:.7},children:[" ","(",t.transfersToRestore," transfers, ",t.adjustmentsToRestore," adjustments)"]})]}),t.monthDetails.length>0&&c.jsxs("details",{style:{marginTop:"0.5rem"},children:[c.jsx("summary",{style:{cursor:"pointer",opacity:.8},children:"Show affected months"}),c.jsx("ul",{style:{margin:"0.5rem 0 0 1rem",padding:0,listStyle:"disc"},children:t.monthDetails.map((m,g)=>c.jsxs("li",{style:{marginBottom:"0.25rem"},children:[m.year,"-",String(m.month).padStart(2,"0"),": ",m.currentTransfers,"",m.diagnosticTransfers," transfers, ",m.currentAdjustments,"",m.diagnosticAdjustments," adjustments"]},g))})]})]}),e&&c.jsx("div",{style:{marginTop:"0.75rem",fontSize:"0.85rem",color:e.success?"#28a745":"#dc3545"},children:e.success?c.jsxs("p",{style:{margin:0},children:[" Restored ",e.monthsUpdated," month(s): ",e.transfersRestored," transfers, ",e.adjustmentsRestored," adjustments"]}):c.jsxs("p",{style:{margin:0},children:[" Restore failed: ",e.errors.join(", ")]})})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",flexShrink:0},children:[c.jsx("input",{ref:h,type:"file",accept:".json",onChange:f,style:{display:"none"}}),c.jsx(Ie,{variant:"secondary",actionName:"Select Diagnostic File",onClick:()=>h.current?.click(),disabled:u||n||r,children:n?c.jsxs(c.Fragment,{children:[c.jsx(va,{noMargin:!0})," Scanning..."]}):" Select File"}),t&&t.monthsToRestore>0&&c.jsx(Ie,{variant:"primary",actionName:"Run Restore from Diagnostic",onClick:o,disabled:u||r,children:r?c.jsxs(c.Fragment,{children:[c.jsx(va,{noMargin:!0})," Restoring..."]}):" Restore Data"})]})]})})}function yU(){const{state:t,closeModal:e}=B0();if(!t.isOpen)return null;const n=t.isComplete;return c.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:c.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:r=>r.stopPropagation(),children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[c.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&c.jsx(va,{noMargin:!0}),t.migrationName]}),n&&c.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),c.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"#ef4444":t.isComplete?"#22c55e":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),c.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?c.jsx("div",{style:{background:t.error?"#ef4444":t.isComplete?"#22c55e":"#646cff",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):c.jsx("div",{style:{background:t.error?"#ef4444":"#646cff",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&c.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&c.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&c.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"#ef4444"},children:t.error}),t.isComplete&&c.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"rgba(239, 68, 68, 0.2)":"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&c.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),c.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function _U(){return c.jsxs("div",{style:Pf,children:[c.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:c.jsx(Ft,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:c.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),c.jsx("h1",{children:"Tarron Lane Homepage"}),c.jsx("nav",{children:c.jsxs("ul",{children:[c.jsx("li",{children:c.jsx(Ft,{to:"/sql-test",children:"SQL Test"})}),c.jsx("li",{children:c.jsx(Ft,{to:"/budget",children:"Budget"})}),c.jsx("li",{children:c.jsx(Ft,{to:"/account",children:"Account"})})]})})]})}function bU(){const t=C.useContext(sd),e=Sa(),[n,r]=C.useState(!1),a=Un(),o=Vu(),u=a.state?.from||"/";C.useEffect(()=>{t.is_logged_in&&u!=="/"&&o(u,{replace:!0})},[t.is_logged_in,u,o]);function h(){r(!0),e.logout_firebase_user().then(function(){r(!1)})}return c.jsxs("div",{style:Pf,children:[c.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[c.jsx("div",{style:{display:"flex",alignItems:"center"},children:c.jsx(Ft,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),c.jsxs(Ft,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[c.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),c.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),c.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:c.jsx(lA,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),c.jsx("h1",{children:"Account"}),t.is_logged_in?n?c.jsx("p",{children:"Logging Out..."}):c.jsxs(c.Fragment,{children:[c.jsxs("p",{children:["You are logged in as ",t.username]}),c.jsx("button",{onClick:h,style:{marginTop:"1rem"},children:"Logout"})]}):c.jsx(vU,{})]})}function vU(){const t=Sa(),[e,n]=C.useState(""),[r,a]=C.useState(""),[o,u]=C.useState(!1),[h,f]=C.useState("");function m(v){n(v.target.value)}function g(v){a(v.target.value)}function _(v){v.preventDefault(),u(!0),f(""),t.login_firebase_user(e,r).then(function(){}).catch(function(){f("Incorrect login credentials")}).finally(function(){u(!1)})}return c.jsxs("form",{onSubmit:_,children:[c.jsxs("div",{children:[c.jsx("label",{htmlFor:"username",children:"Email: "}),c.jsx("input",{id:"username",type:"email",value:e,onChange:m})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"password",children:"Password: "}),c.jsx("input",{id:"password",type:"password",value:r,onChange:g})]}),o?c.jsx("p",{children:"Logging in..."}):c.jsx("button",{children:"Login"}),h&&c.jsx("p",{style:{color:"red"},children:h})]})}const xU={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"},SU={balances:"categories",transactions:"income"};function wU({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const r=xU[t],a=C.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),o=C.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"}],[n]),u=C.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),h=m=>{e(SU[m])},f=r==="balances"?o:u;return c.jsxs("div",{children:[c.jsx(Lf,{mode:"button",tabs:a,activeTab:r,onTabChange:h,variant:"segmented"}),c.jsx(Lf,{mode:"button",tabs:f,activeTab:t,onTabChange:m=>e(m),variant:"secondary"})]})}function EU({isOpen:t,onClose:e,onProceed:n,results:r}){const[a,o]=C.useState("from_current"),u=!r||r.status==="confirming",h=r&&!["confirming","done","error"].includes(r.status),f=u||r?.status==="done"||r?.status==="error";function m(){f&&(e(),o("from_current"))}function g(){n(a)}return c.jsx(Bs,{isOpen:t,onClose:m,title:"Recalculate Balances",width:"540px",children:c.jsxs("div",{style:{padding:"0.5rem 0"},children:[u&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.95rem",lineHeight:1.5},children:"Choose what to recalculate:"}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[c.jsx(Fw,{selected:a==="from_current",onClick:()=>o("from_current"),title:"From current month forward",description:"Recalculate from this month onward. Use for quick fixes."}),c.jsx(Fw,{selected:a==="all_months",onClick:()=>o("all_months"),title:"All months from beginning",description:"Recalculate entire history. Use after migrations or data repairs.",recommended:!0})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[c.jsx(gl,{status:"waiting",label:"Find all months to process"}),c.jsx(gl,{status:"waiting",label:"Process months"}),c.jsx(gl,{status:"waiting",label:"Update budget totals"})]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{variant:"secondary",actionName:"Cancel Recalculation",onClick:e,children:"Cancel"}),c.jsx(Ie,{actionName:"Proceed with Recalculation",onClick:g,children:"Proceed"})]})]}),!u&&c.jsxs(c.Fragment,{children:[c.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Recalculating category balances and account balances..."}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[c.jsx(gl,{status:r?.status==="pending"?"waiting":"complete",label:"Find all months to process",detail:r&&r.status!=="pending"?`Found ${r.monthsFound||0} month${r.monthsFound!==1?"s":""}`:void 0}),c.jsx(gl,{status:zw(r?.status,["pending","finding_months"],"processing_months"),label:"Process months",detail:r?.status==="processing_months"?`Processing: ${r.currentMonthLabel} (${(r.currentMonthIndex||0)+1}/${r.monthsFound||0})`:r?.monthsProcessed!==void 0?`Processed ${r.monthsProcessed} month${r.monthsProcessed!==1?"s":""}`:void 0}),c.jsx(gl,{status:r?.status==="error"?"error":zw(r?.status,["pending","finding_months","processing_months"],"updating_budget"),label:"Update budget totals",detail:r?.status==="error"?r.error:void 0,isError:r?.status==="error"})]}),r?.status==="done"&&c.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:`color-mix(in srgb, ${ae.success} 10%, transparent)`,border:`1px solid ${ae.success}`,borderRadius:"8px",textAlign:"center"},children:[c.jsx("p",{style:{margin:0,fontWeight:600,color:ae.success},children:" Recalculation complete!"}),c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",opacity:.8},children:[r.monthsProcessed," month",r.monthsProcessed!==1?"s":""," processed",c.jsx("br",{}),"Total Income: ",$e(r.totalIncomeRecalculated||0),c.jsx("br",{}),"Total Expenses: ",$e(r.totalExpensesRecalculated||0)]})]}),(r?.status==="done"||r?.status==="error")&&c.jsx("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"center"},children:c.jsx(Ie,{actionName:"Close Recalculation Modal",onClick:e,children:"Done"})}),h&&c.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"Please wait, do not close this window..."})]})]})})}function zw(t,e,n){return!t||e.includes(t)?t===n?"active":"waiting":t===n?"active":"complete"}function gl({status:t,label:e,detail:n,isError:r}){const a=t==="waiting"?"":t==="active"?"":t==="error"?"":"";return c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[c.jsx("span",{style:{fontSize:"1.1rem",width:"1.5rem",textAlign:"center"},children:a}),c.jsxs("div",{style:{flex:1},children:[c.jsx("p",{style:{margin:0,fontWeight:500},children:e}),n&&c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:r?1:.6,color:r?ae.error:"inherit"},children:n})]})]})}function Fw({selected:t,onClick:e,title:n,description:r,recommended:a}){return c.jsxs("button",{type:"button",onClick:e,style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem 1rem",background:t?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",border:t?"2px solid #646cff":"2px solid transparent",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.15s ease"},children:[c.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",border:t?"6px solid #646cff":"2px solid rgba(128,128,128,0.5)",flexShrink:0,marginTop:"2px",background:t?"white":"transparent"}}),c.jsxs("div",{style:{flex:1},children:[c.jsxs("p",{style:{margin:0,fontWeight:600,fontSize:"0.95rem"},children:[n,a&&c.jsx("span",{style:{marginLeft:"0.5rem",padding:"0.15rem 0.5rem",background:ae.success,color:"white",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,verticalAlign:"middle"},children:"RECOMMENDED"})]}),c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:r})]})]})}function Gg(t){return t==="no_category"||t==="NO_CATEGORY"}function CU(t,e){const n={};for(const r of t)Gg(r.from_category_id)||(n[r.from_category_id]=(n[r.from_category_id]||0)-r.amount),Gg(r.to_category_id)||(n[r.to_category_id]=(n[r.to_category_id]||0)+r.amount);for(const r of e)Gg(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(n))n[r]=we(n[r]);return n}async function TU(t,e,n,r,a,o,u){const h=gr(t,e.year,e.month),{exists:f,data:m}=await et("months",h,"recalculate: reading full month data");if(!f||!m)return null;const g=m.income||[],_=m.expenses||[],v=m.transfers||[],x=m.adjustments||[],S=m.are_allocations_finalized||!1,E=we(g.reduce((A,N)=>A+N.amount,0)),T=we(_.reduce((A,N)=>A+N.amount,0)),I={};if(m.category_balances)for(const A of m.category_balances)I[A.category_id]={allocated:A.allocated??0};const j=CU(v,x),M=n.map(A=>{const N=we(a[A]??0);let P=0;S&&I[A]&&(P=we(I[A].allocated));let L=0;_.length>0&&(L=we(_.filter(G=>G.category_id===A).reduce((G,Y)=>G+Y.amount,0)));const B=j[A]??0,O=we(N+P+L+B);return{category_id:A,start_balance:N,allocated:P,spent:L,end_balance:O}});M.forEach(A=>{a[A.category_id]=A.end_balance});const Q=Object.keys(r),H={},W=Q.map(A=>{const N=we(g.filter(U=>U.account_id===A).reduce((U,F)=>U+F.amount,0)),P=we(_.filter(U=>U.account_id===A).reduce((U,F)=>U+F.amount,0)),L=we(v.filter(U=>U.from_account_id===A).reduce((U,F)=>U-F.amount,0)),B=we(v.filter(U=>U.to_account_id===A).reduce((U,F)=>U+F.amount,0)),O=we(x.filter(U=>U.account_id===A).reduce((U,F)=>U+F.amount,0)),G=we(N+P+L+B+O);H[A]=G;const Y=we(o[A]??0);return{account_id:A,start_balance:Y,income:N,expenses:P,net_change:G,end_balance:we(Y+G)}});for(const A of W)o[A.account_id]=A.end_balance;return{updatedMonth:{budget_id:t,year_month_ordinal:At(e.year,e.month),year:e.year,month:e.month,income:g,total_income:E,previous_month_income:u,expenses:_,total_expenses:T,transfers:v,adjustments:x,account_balances:W,category_balances:M,are_allocations_finalized:S,created_at:m.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},totalIncome:E,totalExpenses:T,accountNetChanges:H}}function q0({isDisabled:t,onCloseMenu:e}){const{selectedBudgetId:n,currentYear:r,currentMonthNumber:a}=zt(),{categories:o,accounts:u,saveCategories:h,saveAccounts:f}=kn(),[m,g]=C.useState(!1),[_,v]=C.useState(!1),[x,S]=C.useState(null);function E(){v(!0),S({status:"confirming"})}async function T(j){if(n){g(!0),S({status:"pending"});try{S({status:"finding_months"});let M;if(j==="all_months")M=(await Pt("months","recalculate: querying all months for full recalculation",[{field:"budget_id",op:"==",value:n}])).docs.map(O=>({year:O.data.year,month:O.data.month})).sort((O,G)=>O.year!==G.year?O.year-G.year:O.month-G.month);else{const B=new Date,O=r||B.getFullYear(),G=a||B.getMonth()+1,{year:Y,month:U}=Df(O,G);M=await b4(n,Y,U)}const Q=Object.keys(o);S({status:"finding_months",monthsFound:M.length}),await new Promise(B=>setTimeout(B,100));const H={},W={};if(j==="from_current"){const B=new Date,O=r||B.getFullYear(),G=a||B.getMonth()+1,{year:Y,month:U}=Df(O,G),F=gr(n,Y,U),{exists:K,data:Z}=await et("months",F,"recalculate: reading previous month for starting balances");if(K&&Z?.category_balances)for(const re of Z.category_balances)H[re.category_id]=re.end_balance??0;if(K&&Z?.account_balances)for(const re of Z.account_balances)W[re.account_id]=re.end_balance??0}Q.forEach(B=>{H[B]===void 0&&(H[B]=0)}),Object.keys(u).forEach(B=>{W[B]===void 0&&(W[B]=0)});let D=0,A=0,N=0;for(let B=0;B<M.length;B++){const O=M[B],G=`${bo[O.month-1]} ${O.year}`;S({status:"processing_months",monthsFound:M.length,currentMonthIndex:B,currentMonthLabel:G});const Y=await TU(n,O,Q,u,H,W,N);Y&&(D+=Y.totalIncome,A+=Y.totalExpenses,N=Y.totalIncome,await rd({budgetId:n,month:Y.updatedMonth,description:"recalculate all months"}),await new Promise(U=>setTimeout(U,50)))}const P={};Object.entries(u).forEach(([B,O])=>{P[B]={...O,balance:W[B]??0}}),await f(P),S({status:"updating_budget",monthsFound:M.length,monthsProcessed:M.length,totalIncomeRecalculated:D,totalExpensesRecalculated:A});const L={};Object.entries(o).forEach(([B,O])=>{L[B]={...O,balance:H[B]??0}}),await h(L);for(const B of M)Oe.invalidateQueries({queryKey:Ce.month(n,B.year,B.month)});S({status:"done",monthsFound:M.length,monthsProcessed:M.length,totalIncomeRecalculated:D,totalExpensesRecalculated:A})}catch(M){console.error("Recalculate error:",M),S({status:"error",error:M instanceof Error?M.message:"Failed to recalculate"})}finally{g(!1)}}}function I(){v(!1),S(null),e?.()}return c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:E,disabled:t||m,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.5rem",cursor:t||m?"not-allowed":"pointer",opacity:t||m?.5:1,fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center"},title:"Recalculate balances from this month forward",children:[m?"":""," Recalculate"]}),c.jsx(EU,{isOpen:_,onClose:I,onProceed:T,results:x})]})}function Vw({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:a}){const[o,u]=C.useState(!1),h=n||e,f=t==="prev"?"":"",m=t==="prev"?"Previous month":"Next month",g=()=>{n||(e?(u(!0),setTimeout(()=>u(!1),2e3)):a())};return c.jsxs("div",{style:{position:"relative"},children:[c.jsx("button",{onClick:g,onMouseEnter:()=>e&&u(!0),onMouseLeave:()=>u(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:h?"not-allowed":"pointer",fontSize:"1.25rem",opacity:h?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:m,children:f}),o&&e&&c.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:ae.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r})]})}function AU({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:a,maxOrdinal:o,minAllowed:u,maxAllowed:h,onYearChange:f,onMonthChange:m,onGo:g}){const _=t>u.year,v=t<h.year,x=Number(At(t,e)),S=x>=a&&x<=o;return c.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[c.jsx("button",{onClick:()=>f(t-1),disabled:!_,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:_?"pointer":"not-allowed",fontSize:"0.8rem",opacity:_?1:.3},title:_?"Previous year":"Cannot go further back",children:""}),c.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),c.jsx("button",{onClick:()=>f(t+1),disabled:!v,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:v?"pointer":"not-allowed",fontSize:"0.8rem",opacity:v?1:.3},title:v?"Next year":"Cannot go further ahead",children:""})]}),c.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:bo.map((E,T)=>{const I=T+1,j=I===e,M=t===n&&I===r,Q=Number(At(t,I)),H=Q<a,W=Q>o,D=H||W;let A=E;return H?A="Too far in the past":W&&(A="Too far in the future"),c.jsx("button",{onClick:()=>m(I),disabled:D,style:{background:j?ae.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:M?`1px solid ${ae.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:D?"not-allowed":"pointer",fontSize:"0.7rem",color:j?"#fff":"inherit",opacity:D?.3:1,transition:"background 0.15s"},title:A,children:E.slice(0,3)},I)})}),c.jsxs("button",{onClick:g,disabled:!S,style:{width:"100%",background:S?ae.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:S?"pointer":"not-allowed",fontSize:"0.85rem",color:S?"#fff":"inherit",fontWeight:500,opacity:S?1:.5},children:["Go to ",bo[e-1]," ",t]})]})}function jU({isOpen:t,onClose:e,year:n,month:r,isDeleting:a,onConfirm:o}){return c.jsxs(Bs,{isOpen:t,onClose:e,title:" Delete Month?",children:[c.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:c.jsxs("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",bo[r-1]," ",n,"!"]})}),c.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),c.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:a,children:"Cancel"}),c.jsx(Ie,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:a,children:a?"Deleting...":" Delete Month"})]})]})}function RU(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Pu;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function IU(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-Mf;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function DU(t){return Object.keys(t).sort()[0]}function MU(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function kU(t){const e=IU(),n=DU(t);if(!n)return e;const r=At(e.year,e.month);return n<r?MU(n):e}function $w(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function OU(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function NU({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=sr(),{currentYear:r,currentMonthNumber:a,isAdmin:o,selectedBudgetId:u,setCurrentYear:h,setCurrentMonthNumber:f}=zt(),{budget:m,monthMap:g}=kn(),{month:_}=yi(u,r,a),v=$w(r,a),x=OU(r,a),S=kU(g),E=RU(),T=Number(At(S.year,S.month)),I=Number(At(E.year,E.month)),j=Number(At(v.year,v.month)),M=Number(At(x.year,x.month)),Q=j<T,H=M>I,[W,D]=C.useState(!1),[A,N]=C.useState(!1),[P,L]=C.useState(r),[B,O]=C.useState(a),[G,Y]=C.useState(!1),[U,F]=C.useState(!1),K=C.useRef(null),Z=(()=>{if(!g||Object.keys(g).length===0)return!1;const ie=At(r,a),ee=Math.max(...Object.keys(g).map(Number));return Number(ie)===ee})();async function re(){if(u){F(!0);try{const ie=gr(u,r,a);await Nu("months",ie,`deleting month ${r}/${a}`),`${r}${a}`,Oe.removeQueries({queryKey:Ce.month(u,r,a)}),Oe.invalidateQueries({queryKey:Ce.budget(u)}),localStorage.removeItem("BUDGET_APP_QUERY_CACHE");const ee=$w(r,a);Y(!1),D(!1),window.location.href=`/budget/${ee.year}/${ee.month}/categories`}catch(ie){console.error("Failed to delete month:",ie),alert(`Failed to delete month: ${ie instanceof Error?ie.message:"Unknown error"}`)}finally{F(!1)}}}C.useEffect(()=>{if(!W)return;function ie(ee){K.current&&!K.current.contains(ee.target)&&(D(!1),N(!1))}return document.addEventListener("mousedown",ie),()=>document.removeEventListener("mousedown",ie)},[W]);function z(){A||(L(r),O(a)),N(!A)}function q(){h(P),f(B),N(!1),D(!1)}function te(){if(!_||!m)return;const ie={..._,_meta:{downloaded_at:new Date().toISOString(),budget_id:m.id,budget_name:m.name}},ee=new Blob([JSON.stringify(ie,null,2)],{type:"application/json"}),le=URL.createObjectURL(ee),pe=document.createElement("a");pe.href=le,pe.download=`month_${r}_${String(a).padStart(2,"0")}.json`,document.body.appendChild(pe),pe.click(),document.body.removeChild(pe),URL.revokeObjectURL(le),D(!1)}return c.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[c.jsx(Vw,{direction:"prev",isDisabled:Q,isLoading:n,disabledReason:"Cannot create months more than 3 months into the past",onNavigate:t}),c.jsxs("div",{ref:K,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[c.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[bo[a-1]," ",r]}),c.jsx("button",{onClick:()=>D(!W),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:W?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&c.jsxs(c.Fragment,{children:[c.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),c.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[c.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:ae.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),c.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),W&&c.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[c.jsx(q0,{isDisabled:n,onCloseMenu:()=>D(!1)}),c.jsx("button",{onClick:z,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),A&&c.jsx(AU,{pickerYear:P,pickerMonth:B,currentYear:r,currentMonthNumber:a,minOrdinal:T,maxOrdinal:I,minAllowed:S,maxAllowed:E,onYearChange:L,onMonthChange:O,onGo:q}),o&&_&&c.jsx("button",{onClick:()=>{te()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&_&&Z&&c.jsx("button",{onClick:()=>Y(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"#ef4444",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),c.jsx(Vw,{direction:"next",isDisabled:H,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),c.jsx(jU,{isOpen:G,onClose:()=>Y(!1),year:r,month:a,isDeleting:U,onConfirm:re})]})}const G0={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},PU={...G0,background:ae.primary,border:"none",color:"white"},BU={...G0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},LU={...G0,background:"transparent",border:`1px solid ${ae.errorBorder}`,color:ae.error},Hw=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${ae.error} 15%, transparent)`:`color-mix(in srgb, ${ae.success} 15%, transparent)`,border:`1px solid ${t?ae.errorBorder:"rgba(74, 222, 128, 0.4)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?ae.error:ae.success,transition:"all 0.15s ease",flexShrink:0});function Q0({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:a,initialData:o,defaultAccountId:u,defaultDate:h,config:f,onSubmit:m,onCancel:g,onDelete:_,extraContent:v}){const{isWide:x}=ST(),{showCategory:S=!1,showCleared:E=!1,showSignToggle:T=!1,accountLabel:I="Account",payeePlaceholder:j="Payee name",descriptionPlaceholder:M="Optional note",submitLabel:Q}=f,H=new Date().toISOString().split("T")[0],[W,D]=C.useState(o?.date||h||H),[A,N]=C.useState(o?.payee||""),[P,L]=C.useState(o?.categoryId||(f.showNoCategoryOption?Rt:"")),[B,O]=C.useState(o?.accountId||u||(f.showNoAccountOption?Tt:t[0]?t[0][0]:"")),G=o?.amount!==void 0?Math.abs(o.amount):void 0,[Y,U]=C.useState(G?.toString()||""),[F,K]=C.useState(o?.description||""),[Z,re]=C.useState(o?.cleared||!1),[z,q]=C.useState(()=>T?o?.amount!==void 0?o.amount<0:!1:!0),[te,ie]=C.useState(!1),ee={},le=[];t.forEach(([Ae,Ke])=>{Ke.account_group_id?(ee[Ke.account_group_id]||(ee[Ke.account_group_id]=[]),ee[Ke.account_group_id].push([Ae,Ke])):le.push([Ae,Ke])});function pe(Ae){Ae.preventDefault();const Ke=parseFloat(Y);if(isNaN(Ke)||Ke<=0||S&&!P||!B||!W)return;if(P===Rt&&B===Tt){ie(!0);return}ie(!1);const Br=T&&z?-Ke:Ke;m({date:W,payee:A.trim()||void 0,categoryId:S?P:void 0,accountId:B,amount:Br,description:F.trim()||void 0,cleared:E?Z:void 0})}!(P===Rt&&B===Tt)&&te&&ie(!1);const Se=f.showNoAccountOption?c.jsx(sA,{id:"txn-account",value:B,onChange:O,accounts:t,accountGroups:e,placeholder:Ps,required:!0,showNoAccountOption:!0}):c.jsxs(Lu,{id:"txn-account",value:B,onChange:Ae=>O(Ae.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([Ae,Ke])=>{const _i=ee[Ae];return _i?.length?c.jsx("optgroup",{label:Ke.name,children:_i.map(([dn,Br])=>c.jsx("option",{value:dn,children:Br.nickname},dn))},Ae):null}),le.length>0&&c.jsx("optgroup",{label:"Other",children:le.map(([Ae,Ke])=>c.jsx("option",{value:Ae,children:Ke.nickname},Ae))})]}),je=S&&n&&r?c.jsx(Et,{label:"Category",htmlFor:"txn-category",children:c.jsx(rA,{id:"txn-category",value:P,onChange:L,categories:n,categoryGroups:r,placeholder:f.showNoCategoryOption?ba:"Search...",required:!0,showNoCategoryOption:f.showNoCategoryOption})}):null,at=E?c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[c.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),c.jsx(Or,{id:"txn-cleared",checked:Z,onChange:Ae=>re(Ae.target.checked)})]}):null,Me=c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),c.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[c.jsx("button",{type:"submit",title:Q,style:PU,children:""}),c.jsx("button",{type:"button",onClick:()=>{g()},title:"Cancel",style:BU,children:""}),_&&c.jsx("button",{type:"button",onClick:()=>{_()},title:"Delete",style:LU,children:""})]})]}),Ne=te?c.jsx("div",{style:{background:`color-mix(in srgb, ${ae.error} 15%, transparent)`,border:`1px solid ${ae.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ae.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,lt=c.jsxs(Aa,{children:[c.jsx(Ie,{type:"submit",actionName:Q,children:Q}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:g,children:"Cancel"}),_&&c.jsx(Ie,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:_,children:" Delete"})]}),Sn=S&&n&&r,Gn={fontSize:"0.85rem",padding:"0.5rem"};if(!x)return c.jsxs(mi,{actionName:Q,onSubmit:pe,children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[c.jsx(Et,{label:"Date",htmlFor:"txn-date",children:c.jsx(Bf,{id:"txn-date",value:W,onChange:Ae=>D(Ae.target.value),required:!0})}),c.jsx(Et,{label:T?z?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:T?c.jsxs("div",{style:{display:"flex",alignItems:"stretch"},children:[c.jsx("button",{type:"button",onClick:()=>q(!z),style:Hw(z),title:z?"Click to make this a refund (+)":"Click to make this an expense (-)",children:z?"":"+"}),c.jsx("div",{style:{flex:1},children:c.jsx(co,{id:"txn-amount",value:Y,onChange:U,placeholder:"$0.00",required:!0,autoFocus:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:z?ae.error:ae.success}})})]}):c.jsx(co,{id:"txn-amount",value:Y,onChange:U,placeholder:"$0.00",required:!0,autoFocus:!0})})]}),c.jsx(Et,{label:"Payee",htmlFor:"txn-payee",children:c.jsx(Uw,{id:"txn-payee",value:A,onChange:N,payees:a,placeholder:j})}),je,c.jsx(Et,{label:I,htmlFor:"txn-account",children:Se}),c.jsx(Et,{label:"Description (optional)",htmlFor:"txn-description",children:c.jsx(pi,{id:"txn-description",value:F,onChange:Ae=>K(Ae.target.value),placeholder:M})}),E&&c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx(Or,{id:"txn-cleared-stacked",checked:Z,onChange:Ae=>re(Ae.target.checked)}),c.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),Ne,v]}),lt]});const ft=T?"8.25rem":"6rem",Mt=Sn?E?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${ft} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${ft} minmax(10rem, 2fr) auto`:E?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${ft} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${ft} minmax(12rem, 2fr) auto`;return c.jsxs(mi,{actionName:Q,onSubmit:pe,children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:Mt,gap:"1rem",alignItems:"end"},children:[c.jsx(Et,{label:"Date",htmlFor:"txn-date",children:c.jsx(Bf,{id:"txn-date",value:W,onChange:Ae=>D(Ae.target.value),required:!0,style:Gn})}),c.jsx(Et,{label:"Payee",htmlFor:"txn-payee",children:c.jsx(Uw,{id:"txn-payee",value:A,onChange:N,payees:a,placeholder:j})}),je,c.jsx(Et,{label:I,htmlFor:"txn-account",children:Se}),c.jsx(Et,{label:T?z?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:T?c.jsxs("div",{style:{display:"flex",alignItems:"stretch"},children:[c.jsx("button",{type:"button",onClick:()=>q(!z),style:Hw(z),title:z?"Click to make this a refund (+)":"Click to make this an expense (-)",children:z?"":"+"}),c.jsx("div",{style:{flex:1},children:c.jsx(co,{id:"txn-amount",value:Y,onChange:U,placeholder:"$0.00",required:!0,autoFocus:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:z?ae.error:ae.success}})})]}):c.jsx(co,{id:"txn-amount",value:Y,onChange:U,placeholder:"$0.00",required:!0,autoFocus:!0})}),c.jsx(Et,{label:"Description",htmlFor:"txn-description",children:c.jsx(pi,{id:"txn-description",value:F,onChange:Ae=>K(Ae.target.value),placeholder:M,style:Gn})}),at,Me]}),Ne,v]})}function qw({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:a,defaultDate:o,onSubmit:u,onCancel:h,onDelete:f,submitLabel:m}){function g(_){u(_.amount,_.accountId,_.date,_.payee,_.description)}return c.jsx(Q0,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:a,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:m},onSubmit:g,onCancel:h,onDelete:f})}function UU({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:a,isMobile:o,isEvenRow:u}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=n?`${n} / ${e}`:e,m=u?"transparent":"rgba(255,255,255,0.04)";if(o)return c.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:m,cursor:"pointer",transition:"background 0.15s"},children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),c.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),c.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",f]})]}),c.jsx("div",{style:{display:"flex",alignItems:"center"},children:c.jsxs("span",{style:{fontWeight:600,color:ae.success,fontFamily:"monospace"},children:["+",$e(t.amount)]})})]});const g={padding:"0.6rem 0.5rem",background:m,display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:c.jsx("span",{style:{opacity:.6},children:h})}),c.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),c.jsx("div",{style:{...g,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),c.jsxs("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ae.success,fontFamily:"monospace"},children:["+",$e(t.amount)]}),c.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),c.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[c.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Edit",children:""}),c.jsx("button",{onClick:a,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const yl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function zU(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:a}=zt(),{accounts:o,accountGroups:u}=kn(),{month:h,isLoading:f,addIncome:m,updateIncome:g,deleteIncome:_}=yi(t,e,n),v=Ls(),[x,S]=C.useState(null),[E,T]=C.useState(!1),[I,j]=C.useState(null),H=k0(t,{enabled:E||I!==null}).data||[];function W(F){const K=F.account_group_id?u[F.account_group_id]:void 0;return K?.is_active!==void 0?K.is_active:F.is_active!==!1}function D(F){const K=F.account_group_id?u[F.account_group_id]:void 0;return K?.on_budget!==void 0?K.on_budget:F.on_budget!==!1}const A=Object.entries(o).filter(([,F])=>W(F)&&D(F)),N=A.filter(([,F])=>F.is_income_account),P=N.length>0?N:A,L=A.find(([,F])=>F.is_income_default),B=L?L[0]:void 0,O=h?.income.reduce((F,K)=>F+K.amount,0)||0;function G(F,K,Z,re,z){S(null),T(!1);const[q,te]=Z.split("-").map(Number);(q!==e||te!==n)&&(r(q),a(te)),m(F,K,Z,re,z).catch(ie=>{S(ie instanceof Error?ie.message:"Failed to add income")})}function Y(F,K,Z,re,z,q){S(null),j(null),g(F,K,Z,re,z,q).catch(te=>{S(te instanceof Error?te.message:"Failed to update income")})}function U(F){confirm("Are you sure you want to delete this income entry?")&&(S(null),_(F).catch(K=>{S(K instanceof Error?K.message:"Failed to delete income")}))}return c.jsxs("div",{style:{opacity:f?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:f?"none":"auto"},children:[x&&c.jsx("div",{style:{background:`color-mix(in srgb, ${ae.error} 15%, transparent)`,border:`1px solid ${ae.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ae.error},children:x}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:v?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:v?"block":"grid",gridTemplateColumns:v?void 0:"subgrid"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Income:"}),c.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Total: "}),c.jsx("span",{style:{color:jt(O),fontWeight:600},children:$e(O)})]})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&c.jsx(Ie,{actionName:"Open Add Income Form",onClick:()=>T(!0),disabled:P.length===0,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!v&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:yl,children:"Date"}),c.jsx("div",{style:yl,children:"Payee"}),c.jsx("div",{style:yl,children:"Account"}),c.jsx("div",{style:{...yl,textAlign:"right"},children:"Amount"}),c.jsx("div",{style:yl,children:"Description"}),c.jsx("div",{style:yl})]})]}),c.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),P.length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:[Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".'," ",c.jsx(Ft,{to:"/budget/accounts",style:{opacity:1},children:"Manage accounts "})]}),E&&c.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:c.jsx(qw,{accounts:P,accountGroups:u,payees:H,defaultAccountId:B,defaultDate:pm(e,n),onSubmit:G,onCancel:()=>T(!1),submitLabel:"Add Income",isMobile:v})}),h?.income.slice().sort((F,K)=>(F.date||"").localeCompare(K.date||"")).map((F,K)=>I===F.id?c.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:c.jsx(qw,{accounts:P,accountGroups:u,payees:H,initialData:F,onSubmit:(Z,re,z,q,te)=>Y(F.id,Z,re,z,q,te),onCancel:()=>j(null),onDelete:()=>U(F.id),submitLabel:"Save",isMobile:v})},F.id):c.jsx(UU,{income:F,accountName:Le(F.account_id)?Ps:o[F.account_id]?.nickname||"Unknown Account",accountGroupName:Le(F.account_id)?void 0:o[F.account_id]?.account_group_id?u[o[F.account_id].account_group_id]?.name:void 0,onEdit:()=>{F.payee||`${F.amount}`,j(F.id)},onDelete:()=>U(F.id),isMobile:v,isEvenRow:K%2===0},F.id)),(!h?.income||h.income.length===0)&&!E&&c.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function Gw({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:a,initialData:o,defaultAccountId:u,defaultDate:h,onSubmit:f,onCancel:m,onDelete:g,submitLabel:_}){function v(x){f(x.amount,x.categoryId,x.accountId,x.date,x.payee,x.description,x.cleared)}return c.jsx(Q0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:a,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:u,defaultDate:h,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:_},onSubmit:v,onCancel:m,onDelete:g})}function FU({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:a,onDelete:o,isMobile:u,isEvenRow:h}){const f=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,g=h?"transparent":"rgba(255,255,255,0.04)";if(u)return c.jsxs("div",{onClick:a,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:g,cursor:"pointer",transition:"background 0.15s"},children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:f}),c.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&c.jsx("span",{style:{fontSize:"0.7rem",color:ae.success},title:"Cleared",children:""})]}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),c.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",m]})]})]}),c.jsx("div",{style:{display:"flex",alignItems:"center"},children:c.jsx("span",{style:{fontWeight:600,color:jt(t.amount),fontFamily:"monospace"},children:yr(t.amount)})})]});const _={padding:"0.6rem 0.5rem",background:g,display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{..._,fontSize:"0.85rem",fontFamily:"monospace"},children:c.jsx("span",{style:{opacity:.6},children:f})}),c.jsx("div",{style:{..._,fontWeight:500,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),c.jsx("div",{style:{..._,justifyContent:"center"},children:c.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),c.jsx("div",{style:{..._,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),c.jsx("div",{style:{..._,justifyContent:"flex-end",fontWeight:600,color:jt(t.amount),fontFamily:"monospace"},children:yr(t.amount)}),c.jsx("div",{style:{..._,paddingLeft:"0.5rem",overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),c.jsx("div",{style:{..._,justifyContent:"center",color:t.cleared?ae.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),c.jsxs("div",{style:{..._,justifyContent:"flex-end",gap:"0.25rem"},children:[c.jsx("button",{onClick:a,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),c.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Ji={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function VU(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:a}=zt(),{accounts:o,accountGroups:u,categories:h,categoryGroups:f}=kn(),{month:m,isLoading:g,addExpense:_,updateExpense:v,deleteExpense:x}=yi(t,e,n),S=Ls(),[E,T]=C.useState(null),[I,j]=C.useState(!1),[M,Q]=C.useState(null),D=k0(t,{enabled:I||M!==null}).data||[];function A(Z){const re=Z.account_group_id?u[Z.account_group_id]:void 0;return re?.is_active!==void 0?re.is_active:Z.is_active!==!1}function N(Z){const re=Z.account_group_id?u[Z.account_group_id]:void 0;return re?.on_budget!==void 0?re.on_budget:Z.on_budget!==!1}const P=Object.entries(o).filter(([,Z])=>A(Z)&&N(Z)),L=P.filter(([,Z])=>Z.is_outgo_account),B=L.length>0?L:P,O=P.find(([,Z])=>Z.is_outgo_default),G=O?O[0]:void 0,Y=m?.expenses?.reduce((Z,re)=>Z+re.amount,0)||0;function U(Z,re,z,q,te,ie,ee){T(null),j(!1);const[le,pe]=q.split("-").map(Number);(le!==e||pe!==n)&&(r(le),a(pe)),_(Z,re,z,q,te,ie,ee).catch(xe=>{T(xe instanceof Error?xe.message:"Failed to add expense")})}function F(Z,re,z,q,te,ie,ee,le){T(null),Q(null),v(Z,re,z,q,te,ie,ee,le).catch(pe=>{T(pe instanceof Error?pe.message:"Failed to update expense")})}function K(Z){confirm("Are you sure you want to delete this expense?")&&(T(null),x(Z).catch(re=>{T(re instanceof Error?re.message:"Failed to delete expense")}))}return c.jsxs("div",{style:{opacity:g?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:g?"none":"auto"},children:[E&&c.jsx("div",{style:{background:`color-mix(in srgb, ${ae.error} 15%, transparent)`,border:`1px solid ${ae.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ae.error},children:E}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:S?"block":"grid",gridTemplateColumns:S?void 0:"subgrid"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),c.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Total: "}),c.jsx("span",{style:{color:jt(Y),fontWeight:600},children:yr(Y)})]})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!I&&c.jsx(Ie,{actionName:"Open Add Expense Form",onClick:()=>j(!0),disabled:B.length===0||Object.keys(h).length===0,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!S&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:Ji,children:"Date"}),c.jsx("div",{style:Ji,children:"Payee"}),c.jsx("div",{style:{...Ji,textAlign:"center"},children:"Category"}),c.jsx("div",{style:Ji,children:"Account"}),c.jsx("div",{style:{...Ji,textAlign:"right"},children:"Amount"}),c.jsx("div",{style:Ji,children:"Description"}),c.jsx("div",{style:{...Ji,textAlign:"center"},children:"Clr"}),c.jsx("div",{style:Ji})]})]}),B.length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:[Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".'," ",c.jsx(Ft,{to:"/budget/accounts",style:{opacity:1},children:"Manage accounts "})]}),Object.keys(h).length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:["You need to create at least one category before adding expenses."," ",c.jsx(Ft,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),I&&c.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:c.jsx(Gw,{accounts:B,accountGroups:u,categories:h,categoryGroups:f,payees:D,defaultAccountId:G,defaultDate:pm(e,n),onSubmit:U,onCancel:()=>j(!1),submitLabel:"Add Expense",isMobile:S})}),m?.expenses?.slice().sort((Z,re)=>(Z.date||"").localeCompare(re.date||"")).map((Z,re)=>M===Z.id?c.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:c.jsx(Gw,{accounts:B,accountGroups:u,categories:h,categoryGroups:f,payees:D,initialData:Z,onSubmit:(z,q,te,ie,ee,le,pe)=>F(Z.id,z,q,te,ie,ee,le,pe),onCancel:()=>Q(null),onDelete:()=>K(Z.id),submitLabel:"Save",isMobile:S})},Z.id):c.jsx(FU,{expense:Z,categoryName:Ze(Z.category_id)?ba:h[Z.category_id]?.name||"Unknown Category",accountName:Le(Z.account_id)?Ps:o[Z.account_id]?.nickname||"Unknown Account",accountGroupName:Le(Z.account_id)?void 0:o[Z.account_id]?.account_group_id?u[o[Z.account_id].account_group_id]?.name:void 0,onEdit:()=>{Z.payee||`${Z.amount}`,Q(Z.id)},onDelete:()=>K(Z.id),isMobile:S,isEvenRow:re%2===0},Z.id)),(!m?.expenses||m.expenses.length===0)&&!I&&c.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const $U={background:ae.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},HU={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},qU={background:"transparent",border:`1px solid ${ae.errorBorder}`,color:ae.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function Qw({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:a,defaultDate:o,onSubmit:u,onCancel:h,onDelete:f,submitLabel:m}){const{isWide:g}=ST(),_=new Date().toISOString().split("T")[0],[v,x]=C.useState(a?.date||o||_),[S,E]=C.useState(a?.amount?.toString()||""),[T,I]=C.useState(a?.from_account_id||Tt),[j,M]=C.useState(a?.to_account_id||Tt),[Q,H]=C.useState(a?.from_category_id||Rt),[W,D]=C.useState(a?.to_category_id||Rt),[A,N]=C.useState(a?.description||""),[P,L]=C.useState(a?.cleared||!1),[B,O]=C.useState(null),G=Q===Rt,Y=W===Rt,U=T===Tt,F=j===Tt;function K(){return G&&Y&&(U&&F)?'A transfer must move between real categories or real accounts  not all "No" options.':U!==F?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':G!==Y?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}K()===null&&B!==null&&O(null);function re(xe){xe.preventDefault();const ve=parseFloat(S);if(isNaN(ve)||ve<=0||!T||!j||!Q||!W||!v)return;const J=K();if(J){O(J);return}O(null),u(ve,T,j,Q,W,v,A.trim()||void 0,P)}const z=B?c.jsx("div",{style:{background:`color-mix(in srgb, ${ae.error} 15%, transparent)`,border:`1px solid ${ae.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ae.error,marginTop:"0.5rem"},children:B}):null,q=(xe,ve,J,Se)=>c.jsx(Et,{label:Se,htmlFor:xe,children:c.jsx(sA,{id:xe,value:ve,onChange:J,accounts:t,accountGroups:e,placeholder:Ps,required:!0,showNoAccountOption:!0})}),te=(xe,ve,J,Se)=>c.jsx(Et,{label:Se,htmlFor:xe,children:c.jsx(rA,{id:xe,value:ve,onChange:J,categories:n,categoryGroups:r,placeholder:ba,required:!0,showNoCategoryOption:!0})}),ie=c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[c.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),c.jsx(Or,{id:"transfer-cleared",checked:P,onChange:xe=>L(xe.target.checked)})]}),ee=c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),c.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[c.jsx("button",{type:"submit",title:m,style:$U,children:""}),c.jsx("button",{type:"button",onClick:()=>{h()},title:"Cancel",style:HU,children:""}),f&&c.jsx("button",{type:"button",onClick:()=>{f()},title:"Delete",style:qU,children:""})]})]}),le=c.jsxs(Aa,{children:[c.jsx(Ie,{type:"submit",actionName:m,children:m}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:h,children:"Cancel"}),f&&c.jsx(Ie,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:f,children:" Delete"})]}),pe={fontSize:"0.85rem",padding:"0.5rem"};return g?c.jsx(mi,{actionName:m,onSubmit:re,children:c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[c.jsx(Et,{label:"Date",htmlFor:"transfer-date",children:c.jsx(Bf,{id:"transfer-date",value:v,onChange:xe=>x(xe.target.value),required:!0,style:pe})}),c.jsx(Et,{label:"Amount",htmlFor:"transfer-amount",children:c.jsx(co,{id:"transfer-amount",value:S,onChange:E,placeholder:"$0.00",required:!0,autoFocus:!0})}),te("from-category",Q,H,"From Category"),q("from-account",T,I,"From Account"),c.jsx(Et,{label:"Description",htmlFor:"transfer-description",children:c.jsx(pi,{id:"transfer-description",value:A,onChange:xe=>N(xe.target.value),placeholder:"e.g., Transfer",style:pe})})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[c.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),c.jsx("div",{}),te("to-category",W,D,"To Category"),q("to-account",j,M,"To Account"),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[ie,ee]})]}),z]})}):c.jsxs(mi,{actionName:m,onSubmit:re,children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[c.jsx(Et,{label:"Date",htmlFor:"transfer-date",children:c.jsx(Bf,{id:"transfer-date",value:v,onChange:xe=>x(xe.target.value),required:!0})}),c.jsx(Et,{label:"Amount",htmlFor:"transfer-amount",children:c.jsx(co,{id:"transfer-amount",value:S,onChange:E,placeholder:"$0.00",required:!0,autoFocus:!0})})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[te("from-category",Q,H,"From Cat."),q("from-account",T,I,"From Acct.")]}),c.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[te("to-category",W,D,"To Cat."),q("to-account",j,M,"To Acct.")]})]}),c.jsx(Et,{label:"Description (optional)",htmlFor:"transfer-description",children:c.jsx(pi,{id:"transfer-description",value:A,onChange:xe=>N(xe.target.value),placeholder:"e.g., Transfer to savings"})}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx(Or,{id:"transfer-cleared-stacked",checked:P,onChange:xe=>L(xe.target.checked)}),c.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),z]}),le]})}function GU({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:a,fromAccountGroupName:o,toAccountGroupName:u,isFromCategoryNo:h,isToCategoryNo:f,isFromAccountNo:m,isToAccountNo:g,onEdit:_,onDelete:v,isMobile:x,isEvenRow:S}){const E=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",T=S?"transparent":"rgba(255,255,255,0.04)";if(x)return c.jsxs("div",{onClick:_,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:T,cursor:"pointer",transition:"background 0.15s"},children:[c.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:E}),c.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:$e(t.amount)}),t.cleared&&c.jsx("span",{style:{fontSize:"0.7rem",color:ae.success},title:"Cleared",children:""})]})}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),m?c.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):c.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&c.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),c.jsx("span",{children:r})]})]}),c.jsx("span",{style:{opacity:.5},children:""}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx("span",{style:f?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),g?c.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:a}):c.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[u&&c.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:u}),c.jsx("span",{children:a})]})]})]}),t.description&&c.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const I={padding:"0.6rem 0.5rem",background:T,display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{...I,fontSize:"0.85rem",fontFamily:"monospace"},children:c.jsx("span",{style:{opacity:.6},children:E})}),c.jsx("div",{style:{...I,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:$e(t.amount)}),c.jsx("div",{style:{...I,justifyContent:"center"},children:c.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),c.jsx("div",{style:{...I,overflow:"hidden"},children:m?c.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&c.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),c.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),c.jsx("div",{style:{...I,justifyContent:"center",fontSize:"1rem"},children:c.jsx("span",{style:{opacity:.5},children:""})}),c.jsx("div",{style:{...I,justifyContent:"center"},children:c.jsx("span",{style:f?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),c.jsx("div",{style:{...I,overflow:"hidden"},children:g?c.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:a}):c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[u&&c.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:u}),c.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a})]})}),c.jsx("div",{style:{...I,paddingLeft:"0.5rem",overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),c.jsx("div",{style:{...I,justifyContent:"center",color:t.cleared?ae.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),c.jsxs("div",{style:{...I,justifyContent:"flex-end",gap:"0.25rem"},children:[c.jsx("button",{onClick:_,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:j=>j.currentTarget.style.opacity="1",onMouseLeave:j=>j.currentTarget.style.opacity="0.5",title:"Edit",children:""}),c.jsx("button",{onClick:v,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:j=>j.currentTarget.style.opacity="1",onMouseLeave:j=>j.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Ts={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function QU(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:a}=zt(),{accounts:o,accountGroups:u,categories:h,categoryGroups:f}=kn(),{month:m,isLoading:g,addTransfer:_,updateTransfer:v,deleteTransfer:x}=yi(t,e,n),S=Ls(),[E,T]=C.useState(null),[I,j]=C.useState(!1),[M,Q]=C.useState(null);function H(B){const O=B.account_group_id?u[B.account_group_id]:void 0;return O?.is_active!==void 0?O.is_active:B.is_active!==!1}function W(B){const O=B.account_group_id?u[B.account_group_id]:void 0;return O?.on_budget!==void 0?O.on_budget:B.on_budget!==!1}const D=Object.entries(o).filter(([,B])=>H(B)&&W(B));function A(B,O,G,Y,U,F,K,Z){T(null),j(!1);const[re,z]=F.split("-").map(Number);(re!==e||z!==n)&&(r(re),a(z)),_(B,O,G,Y,U,F,K,Z).catch(q=>{T(q instanceof Error?q.message:"Failed to add transfer")})}function N(B,O,G,Y,U,F,K,Z,re){T(null),Q(null),v(B,O,G,Y,U,F,K,Z,re).catch(z=>{T(z instanceof Error?z.message:"Failed to update transfer")})}function P(B){confirm("Are you sure you want to delete this transfer?")&&(T(null),x(B).catch(O=>{T(O instanceof Error?O.message:"Failed to delete transfer")}))}const L=D.length>=1&&Object.keys(h).length>=1;return c.jsxs("div",{style:{opacity:g?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:g?"none":"auto"},children:[E&&c.jsx("div",{style:{background:`color-mix(in srgb, ${ae.error} 15%, transparent)`,border:`1px solid ${ae.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ae.error},children:E}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:S?"block":"grid",gridTemplateColumns:S?void 0:"subgrid"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),c.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!I&&c.jsx(Ie,{actionName:"Open Add Transfer Form",onClick:()=>j(!0),disabled:!L,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!S&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:Ts,children:"Date"}),c.jsx("div",{style:{...Ts,textAlign:"right"},children:"Amount"}),c.jsx("div",{style:{...Ts,textAlign:"center"},children:"From Cat"}),c.jsx("div",{style:Ts,children:"From Acct"}),c.jsx("div",{style:Ts}),c.jsx("div",{style:{...Ts,textAlign:"center"},children:"To Cat"}),c.jsx("div",{style:Ts,children:"To Acct"}),c.jsx("div",{style:Ts,children:"Description"}),c.jsx("div",{style:{...Ts,textAlign:"center"},children:"Clr"}),c.jsx("div",{style:Ts})]})]}),!L&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:["You need at least one account and one category before adding transfers."," ",c.jsx(Ft,{to:"/budget/accounts",style:{opacity:1},children:"Manage accounts "})]}),I&&c.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:c.jsx(Qw,{accounts:D,accountGroups:u,categories:h,categoryGroups:f,defaultDate:pm(e,n),onSubmit:A,onCancel:()=>j(!1),submitLabel:"Add Transfer"})}),m?.transfers?.slice().sort((B,O)=>(B.date||"").localeCompare(O.date||"")).map((B,O)=>M===B.id?c.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:c.jsx(Qw,{accounts:D,accountGroups:u,categories:h,categoryGroups:f,initialData:B,onSubmit:(G,Y,U,F,K,Z,re,z)=>N(B.id,G,Y,U,F,K,Z,re,z),onCancel:()=>Q(null),onDelete:()=>P(B.id),submitLabel:"Save"})},B.id):c.jsx(GU,{transfer:B,fromCategoryName:Ze(B.from_category_id)?ba:h[B.from_category_id]?.name||"Unknown",toCategoryName:Ze(B.to_category_id)?ba:h[B.to_category_id]?.name||"Unknown",fromAccountName:Le(B.from_account_id)?Ps:o[B.from_account_id]?.nickname||"Unknown",toAccountName:Le(B.to_account_id)?Ps:o[B.to_account_id]?.nickname||"Unknown",fromAccountGroupName:Le(B.from_account_id)?void 0:o[B.from_account_id]?.account_group_id?u[o[B.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:Le(B.to_account_id)?void 0:o[B.to_account_id]?.account_group_id?u[o[B.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:Ze(B.from_category_id),isToCategoryNo:Ze(B.to_category_id),isFromAccountNo:Le(B.from_account_id),isToAccountNo:Le(B.to_account_id),onEdit:()=>{B.description||`${B.amount}`,Q(B.id)},onDelete:()=>P(B.id),isMobile:S,isEvenRow:O%2===0},B.id)),(!m?.transfers||m.transfers.length===0)&&!I&&c.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function Ww({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:a,initialData:o,defaultAccountId:u,defaultDate:h,onSubmit:f,onCancel:m,onDelete:g,submitLabel:_}){function v(x){f(x.amount,x.accountId,x.categoryId,x.date,x.payee,x.description,x.cleared)}return c.jsx(Q0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:a,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:u,defaultDate:h,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:_},onSubmit:v,onCancel:m,onDelete:g})}function WU({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:a,onDelete:o,isMobile:u,isEvenRow:h}){const f=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,g=h?"transparent":"rgba(255,255,255,0.04)";if(u)return c.jsxs("div",{onClick:a,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:g,cursor:"pointer",transition:"background 0.15s"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:f}),t.cleared&&c.jsx("span",{style:{fontSize:"0.7rem",color:ae.success},title:"Cleared",children:""})]}),c.jsx("span",{style:{fontWeight:600,color:jt(t.amount),fontFamily:"monospace"},children:yr(t.amount)})]}),c.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[c.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),c.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:m})]})]});const _={padding:"0.6rem 0.5rem",background:g,display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{..._,fontSize:"0.85rem",fontFamily:"monospace"},children:c.jsx("span",{style:{opacity:.6},children:f})}),c.jsx("div",{style:{..._,justifyContent:"center"},children:c.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),c.jsx("div",{style:{..._,overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),c.jsx("div",{style:{..._,justifyContent:"flex-end",fontWeight:600,color:jt(t.amount),fontFamily:"monospace"},children:yr(t.amount)}),c.jsx("div",{style:{..._,paddingLeft:"0.5rem",overflow:"hidden"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),c.jsx("div",{style:{..._,justifyContent:"center",color:t.cleared?ae.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),c.jsxs("div",{style:{..._,justifyContent:"flex-end",gap:"0.25rem"},children:[c.jsx("button",{onClick:a,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),c.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const so={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function KU(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:a}=zt(),{accounts:o,accountGroups:u,categories:h,categoryGroups:f}=kn(),{month:m,isLoading:g,addAdjustment:_,updateAdjustment:v,deleteAdjustment:x}=yi(t,e,n),S=Ls(),[E,T]=C.useState(null),[I,j]=C.useState(!1),[M,Q]=C.useState(null),D=k0(t,{enabled:I||M!==null}).data||[];function A(G){const Y=G.account_group_id?u[G.account_group_id]:void 0;return Y?.is_active!==void 0?Y.is_active:G.is_active!==!1}function N(G){const Y=G.account_group_id?u[G.account_group_id]:void 0;return Y?.on_budget!==void 0?Y.on_budget:G.on_budget!==!1}const P=Object.entries(o).filter(([,G])=>A(G)&&N(G));function L(G,Y,U,F,K,Z,re){T(null),j(!1);const[z,q]=F.split("-").map(Number);(z!==e||q!==n)&&(r(z),a(q)),_(G,Y,U,F,K,Z,re).catch(te=>{T(te instanceof Error?te.message:"Failed to add adjustment")})}function B(G,Y,U,F,K,Z,re,z){T(null),Q(null),v(G,Y,U,F,K,Z,re,z).catch(q=>{T(q instanceof Error?q.message:"Failed to update adjustment")})}function O(G){confirm("Are you sure you want to delete this adjustment?")&&(T(null),x(G).catch(Y=>{T(Y instanceof Error?Y.message:"Failed to delete adjustment")}))}return c.jsxs("div",{style:{opacity:g?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:g?"none":"auto"},children:[E&&c.jsx("div",{style:{background:`color-mix(in srgb, ${ae.error} 15%, transparent)`,border:`1px solid ${ae.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ae.error},children:E}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:S?"block":"grid",gridTemplateColumns:S?void 0:"subgrid"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),c.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!I&&c.jsx(Ie,{actionName:"Open Add Adjustment Form",onClick:()=>j(!0),disabled:Object.keys(h).length===0&&P.length===0,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!S&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:so,children:"Date"}),c.jsx("div",{style:{...so,textAlign:"center"},children:"Category"}),c.jsx("div",{style:so,children:"Account"}),c.jsx("div",{style:{...so,textAlign:"right"},children:"Amount"}),c.jsx("div",{style:so,children:"Description"}),c.jsx("div",{style:{...so,textAlign:"center"},children:"Clr"}),c.jsx("div",{style:so})]})]}),P.length===0&&Object.keys(h).length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:["You need to create at least one account or category before adding adjustments."," ",c.jsx(Ft,{to:"/budget/accounts",style:{opacity:1},children:"Manage accounts "})]}),I&&c.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:c.jsx(Ww,{accounts:P,accountGroups:u,categories:h,categoryGroups:f,payees:D,defaultDate:pm(e,n),onSubmit:L,onCancel:()=>j(!1),submitLabel:"Add Adjustment"})}),m?.adjustments?.slice().sort((G,Y)=>(G.date||"").localeCompare(Y.date||"")).map((G,Y)=>M===G.id?c.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:c.jsx(Ww,{accounts:P,accountGroups:u,categories:h,categoryGroups:f,payees:D,initialData:G,onSubmit:(U,F,K,Z,re,z,q)=>B(G.id,U,F,K,Z,re,z,q),onCancel:()=>Q(null),onDelete:()=>O(G.id),submitLabel:"Save"})},G.id):c.jsx(WU,{adjustment:G,categoryName:Ze(G.category_id)?ba:h[G.category_id]?.name||"Unknown Category",accountName:Le(G.account_id)?Ps:o[G.account_id]?.nickname||"Unknown Account",accountGroupName:Le(G.account_id)?void 0:o[G.account_id]?.account_group_id?u[o[G.account_id].account_group_id]?.name:void 0,onEdit:()=>{G.description||`${G.amount}`,Q(G.id)},onDelete:()=>O(G.id),isMobile:S,isEvenRow:Y%2===0},G.id)),(!m?.adjustments||m.adjustments.length===0)&&!I&&c.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function YU({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:a}=sr(),{selectedBudgetId:o,currentYear:u,currentMonthNumber:h}=zt(),{deleteAllocations:f}=vT(),[m,g]=C.useState(null),_=async()=>{if(o){g(null),r("allocations-delete","Deleting allocations...");try{await f({budgetId:o,year:u,month:h}),e(),n?.()}catch(v){g(v instanceof Error?v.message:"Failed to delete allocations")}finally{a("allocations-delete")}}};return c.jsxs(Bs,{isOpen:t,onClose:e,title:"Delete Allocations",children:[m&&c.jsx(jo,{message:m,onDismiss:()=>g(null)}),c.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),c.jsx(Ie,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:_,children:"Delete Allocations"})]})]})}function uA({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:a,draftChangeAmount:o,availableAfterApply:u,currentDraftTotal:h}){const f=t&&h!==void 0?h:a.allocated;return c.jsxs(c.Fragment,{children:[c.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?c.jsx("span",{style:{color:jt(n),fontWeight:600},children:$e(n)}):c.jsxs("span",{style:{color:ae.success,fontWeight:600},children:["+",$e(r)]})]}),c.jsxs("span",{children:[t&&c.jsx("span",{style:{opacity:.6},children:" "}),c.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),c.jsxs("span",{style:{color:lc(t?f:a.allocated),fontWeight:600,...t?Jr:{}},children:[t?"":"+",$e(t?f:a.allocated)]}),e&&o!==0&&c.jsxs("span",{style:{fontSize:"0.85em",color:o>0?ae.warning:ae.success,marginLeft:"0.25rem"},children:["(",yr(o),")"]})]}),!t&&c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Spent: "}),c.jsx("span",{style:{color:oc(a.spent),fontWeight:600},children:ja(a.spent)})]}),c.jsxs("span",{children:[t&&c.jsx("span",{style:{opacity:.6},children:"= "}),c.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?c.jsx("span",{style:{color:jt(u),fontWeight:600,...Jr},children:$e(u)}):c.jsx("span",{style:{color:jt(a.allocated+a.spent),fontWeight:600},children:$e(a.allocated+a.spent)})]})]})}function XU({totals:t}){return c.jsxs(c.Fragment,{children:[c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Start: "}),c.jsx("span",{style:{color:jt(t.start),fontWeight:600},children:$e(t.start)})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Inc: "}),c.jsxs("span",{style:{color:ae.success,fontWeight:600},children:["+",$e(t.income)]})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Exp: "}),c.jsx("span",{style:{color:oc(t.expenses),fontWeight:600},children:ja(t.expenses)})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"End: "}),c.jsx("span",{style:{color:jt(t.end),fontWeight:600},children:$e(t.end)})]})]})}function W0({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:a,onEdit:o,onCancel:u,onDelete:h}){return c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&c.jsxs(c.Fragment,{children:[c.jsx(Ie,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),c.jsx(Ie,{actionName:"Apply Allocations",onClick:a,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&c.jsx(Ie,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&c.jsxs(c.Fragment,{children:[c.jsx(Ie,{actionName:"Apply Allocations",onClick:a,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),c.jsx(Ie,{actionName:"Cancel Edit Allocations",onClick:u,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),c.jsx(Ie,{actionName:"Open Delete Allocations Modal",onClick:h,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:ae.error},children:""})]})]})}function JU({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:a,onAllocationChange:o,projectedAllTime:u}){const h=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,f=h?t.default_monthly_amount/100*r:0,m=h?f.toFixed(2):n,g=a&&!h,_=a?u:t.balance??0,v=t.balance??0,x=v<0,S=x?Math.abs(v):0,E=h?f:parseFloat(n)||0,T=x?Math.min(E,S):0,I=x?Math.max(0,E-S):0,j=x&&E>0&&I>0;return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[c.jsx("div",{style:{marginBottom:"0.5rem"},children:c.jsx("span",{style:{fontWeight:500},children:t.name})}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),c.jsx("span",{style:{color:Dn(e.start_balance)},children:Zr(e.start_balance)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),g?c.jsxs(c.Fragment,{children:[c.jsx("input",{type:"text",inputMode:"decimal",value:m?`$${m}`:"",onChange:M=>{const Q=M.target.value.replace(/[^\d.]/g,"");o(Q)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),x&&E>0&&c.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[c.jsxs("span",{style:{color:ae.debt,display:"block"},children:[$e(T),"  debt"]}),j&&c.jsxs("span",{style:{color:ae.success,display:"block"},children:[$e(I),"  balance"]})]})]}):c.jsx("span",{style:{color:lc(e.allocated)},children:yr(e.allocated)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),c.jsx("span",{style:{color:oc(e.spent)},children:ja(e.spent)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),c.jsx("span",{style:{color:Dn(e.end_balance),...a&&!h?Jr:{}},children:Zr(e.end_balance)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:a?"Proj. All-Time":"All-Time"}),c.jsx("span",{style:{color:Dn(_),...a&&!h?Jr:{}},children:Zr(_)})]})]}),a&&h&&c.jsx("div",{style:{marginTop:"0.5rem"},children:c.jsxs("span",{style:{fontSize:"0.8rem"},children:[c.jsxs("span",{style:{opacity:.6},children:[$e(r),"  "]}),c.jsxs("span",{style:{color:ae.success},children:[t.default_monthly_amount,"%"]}),c.jsx("span",{style:{opacity:.6},children:" = "}),c.jsx("span",{style:{color:ae.success},children:$e(f)})]})})]})}function Kw({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:a,savedAllocations:o,previousMonthIncome:u,isDraftMode:h,onAllocationChange:f,isMobile:m,isUngrouped:g,getAllocationAmount:_}){const v={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Nf,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},x=n.allocated+n.spent,S=e.reduce((E,[T,I])=>{const j=I.balance??0;if(h){const M=_(T,I),Q=o[T]??0,H=M-Q;return E+j+H}return E+j},0);return c.jsxs("div",{style:{display:"contents"},children:[!m&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{...v,paddingLeft:"0.5rem",opacity:g?.7:1},children:[c.jsx("span",{children:t}),c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),c.jsx("div",{style:{...v,justifyContent:"flex-end",color:Dn(n.start)},children:Hn.showGroupTotals}),c.jsx("div",{style:{...v,justifyContent:h?"center":"flex-end",color:lc(n.allocated)},children:Hn.showGroupTotals}),c.jsx("div",{style:{...v,justifyContent:"flex-end",color:oc(n.spent)},children:Hn.showGroupTotals}),c.jsx("div",{style:{...v,justifyContent:"flex-end",color:Dn(x)},children:Hn.showGroupTotals}),c.jsx("div",{style:{...v,justifyContent:"flex-end",color:Dn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:Hn.showGroupTotals}),c.jsx("div",{style:{...v,justifyContent:"flex-end",color:Dn(S)},children:Hn.showGroupTotals})]}),!h&&m&&c.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Nf,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("span",{style:{fontWeight:600,opacity:g?.7:1},children:[t,c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Hn.showGroupTotals]}),e.map(([E,T],I)=>{const j=r(E);if(!j)return null;const M=T.balance??0;let Q=M;if(h){const H=_(E,T),W=o[E]??0,D=H-W;Q=M+D}return m?c.jsx("div",{style:{gridColumn:"1 / -1"},children:c.jsx(JU,{category:T,balance:j,localAllocation:a[E]||"",previousMonthIncome:u,isDraftMode:h,onAllocationChange:H=>f(E,H),projectedAllTime:Q})},E):c.jsx(ZU,{category:T,balance:j,localAllocation:a[E]||"",previousMonthIncome:u,isDraftMode:h,onAllocationChange:H=>f(E,H),allTimeBalance:Q,isEvenRow:I%2===0},E)})]})}function ZU({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:a,onAllocationChange:o,allTimeBalance:u,isEvenRow:h}){const f=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,m=f?t.default_monthly_amount/100*r:0,g=f?m.toFixed(2):n,_=t.balance??0,v=_<0,x=v?Math.abs(_):0,S=f?m:parseFloat(n)||0,E=v?Math.min(S,x):0,T=v?Math.max(0,S-x):0,I=v&&S>0&&T>0,j=h?"transparent":"rgba(255,255,255,0.04)",M={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",background:j,display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},Q=e.allocated+e.spent;return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",background:j,display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:Dn(e.start_balance)},children:Zr(e.start_balance)}),a?c.jsx("div",{style:{...M,justifyContent:"center",flexDirection:"column",gap:"0.1rem",paddingTop:"0.35rem",paddingBottom:"0.35rem"},children:f?c.jsxs("span",{style:{fontSize:"0.85rem"},children:[c.jsxs("span",{style:{color:ae.success},children:[t.default_monthly_amount,"%"]}),c.jsx("span",{style:{opacity:.5},children:" = "}),c.jsx("span",{style:{color:ae.success},children:$e(m)})]}):c.jsxs(c.Fragment,{children:[c.jsx("input",{type:"text",inputMode:"decimal",value:g?`$${g}`:"",onChange:H=>{const W=H.target.value.replace(/[^\d.]/g,"");o(W)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),v&&S>0&&c.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[c.jsxs("span",{style:{color:ae.debt},children:[$e(E),"  debt"]}),I&&c.jsxs("span",{style:{color:ae.success},children:[$e(T),"  bal"]})]})]})}):(()=>{const H=e.start_balance<0,W=H?Math.abs(e.start_balance):0,D=H?Math.min(e.allocated,W):0,A=H?Math.max(0,e.allocated-W):0,N=H&&e.allocated>0;return c.jsxs("div",{style:{...M,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:lc(e.allocated)},children:[c.jsxs("span",{children:["+",$e(e.allocated)]}),N&&c.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[c.jsxs("span",{style:{color:ae.debt},children:[$e(D),"  debt"]}),A>0&&c.jsxs("span",{style:{color:ae.success},children:[$e(A),"  bal"]})]})]})})(),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:oc(e.spent)},children:ja(e.spent)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:Dn(Q),...a&&!f?Jr:{}},children:yr(Q)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",fontWeight:600,color:Dn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...a&&!f?Jr:{}},children:Zr(e.end_balance)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:Dn(u),...a&&!f?Jr:{}},children:Zr(u)})]})}function ez(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,a])=>n||!a.is_hidden).reduce((a,[o,u])=>{const h=u.category_group_id||"ungrouped";return a[h]||(a[h]=[]),a[h].push([o,u]),a},{});return Object.keys(r).forEach(a=>{r[a].sort((o,u)=>o[1].sort_order-u[1].sort_order)}),r}function tz(t,e,n,r,a){const o={};t?.category_balances&&t.category_balances.forEach(h=>{o[h.category_id]=h});const u={};return Object.entries(e).forEach(([h,f])=>{const m=o[h],g=m?.start_balance??0,_=m?.spent??0;let v=0;n?v=a(h,f):r&&m&&(v=m.allocated),u[h]={category_id:h,start_balance:g,allocated:v,spent:_,end_balance:g+v+_}}),u}function nz(t,e){const n={};t?.account_balances&&t.account_balances.forEach(a=>{n[a.account_id]=a});const r={};return Object.entries(e).forEach(([a,o])=>{const h=n[a]?.start_balance??o.balance;let f=0;t?.income&&(f=t.income.filter(_=>_.account_id===a).reduce((_,v)=>_+v.amount,0));let m=0;t?.expenses&&(m=t.expenses.filter(_=>_.account_id===a).reduce((_,v)=>_+v.amount,0));const g=f+m;r[a]={account_id:a,start_balance:h,income:f,expenses:m,net_change:g,end_balance:h+g}}),r}function rz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,netChange:0,end:0})}function sz(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,end:e.end+n.end_balance}),{start:0,allocated:0,spent:0,end:0})}function iz({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:a,onApply:o,onEdit:u,onCancel:h,onDelete:f}){const m={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},g=n.allocated+n.spent;return c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{...m,gap:"0.75rem"},children:["Grand Totals",!t&&c.jsx(W0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:a,onApply:o,onEdit:u,onCancel:h,onDelete:f})]}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:Dn(n.start)},children:Zr(n.start)}),c.jsxs("div",{style:{...m,justifyContent:t?"center":"flex-end",color:lc(n.allocated),...t?Jr:{}},children:["+",$e(n.allocated)]}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:oc(n.spent)},children:ja(n.spent)}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:Dn(g),...t?Jr:{}},children:yr(g)}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:Dn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...t?Jr:{}},children:Zr(n.end)}),c.jsx("div",{style:{...m,justifyContent:"flex-end",color:Dn(r),...t?Jr:{}},children:Zr(r)})]})}function az({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:a,availableAfterApply:o,currentDraftTotal:u,onSave:h,onApply:f,onEdit:m,onCancel:g,onDelete:_}){return c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[c.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),c.jsx(uA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:a,availableAfterApply:o,currentDraftTotal:u}),c.jsx(W0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:h,onApply:f,onEdit:m,onCancel:g,onDelete:_})]})}const io={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function oz(t){if(!t)return"";switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}}function lz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=zt(),{categories:r,categoryGroups:a,monthMap:o}=kn(),{month:u}=yi(t,e,n),h=Ls(),f=At(e,n),m=o[f]?.needs_recalculation===!0,g=C.useRef(!1),[_,v]=C.useState(null);C.useEffect(()=>{!t||!u||!m||g.current||(g.current=!0,`${e}${String(n).padStart(2,"0")}`,gm(t,{onProgress:ee=>v(ee)}).then(()=>{Oe.invalidateQueries({queryKey:Ce.month(t,e,n)})}).catch(ee=>{console.error("[MonthCategories] Recalculation failed:",ee)}).finally(()=>{g.current=!1,v(null)}))},[t,m,u,e,n]);const[x,S]=C.useState(!1),{localAllocations:E,isEditingAppliedAllocations:T,error:I,availableNow:j,currentDraftTotal:M,draftChangeAmount:Q,availableAfterApply:H,previousMonthIncome:W,currentMonthIncome:D,allocationsFinalized:A,getAllocationAmount:N,handleAllocationChange:P,resetAllocationsToSaved:L,handleSaveAllocations:B,handleFinalizeAllocations:O,setIsEditingAppliedAllocations:G,setError:Y}=XB(),U=[...a].sort((ee,le)=>ee.sort_order-le.sort_order),F=C.useMemo(()=>ez(r),[r]),K=!A||T,Z=C.useMemo(()=>tz(u,r,K,A,N),[u,r,K,A,N]),re=ee=>Z[ee],z=C.useMemo(()=>sz(Z),[Z]),q=C.useMemo(()=>{const ee={};if(u?.category_balances)for(const le of u.category_balances)ee[le.category_id]=le.allocated;return ee},[u]),te=C.useMemo(()=>Object.entries(r).reduce((ee,[le,pe])=>{const xe=pe.balance??0;if(K){const ve=N(le,pe),J=q[le]??0,Se=ve-J;return ee+xe+Se}return ee+xe},0),[r,K,N,q]),ie={onSave:B,onApply:O,onEdit:()=>G(!0),onCancel:L,onDelete:()=>S(!0)};return c.jsxs(c.Fragment,{children:[_&&c.jsxs(ac,{message:oz(_),spinnerColor:"#22c55e",children:[c.jsx(od,{percent:_.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),c.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(_.totalMonthsToFetch??0)>0&&c.jsx(on,{value:`${_.monthsFetched||0}/${_.totalMonthsToFetch}`,label:"Months Loaded",color:_.phase==="fetching-months"?"#22c55e":"#6b7280"}),(_.totalMonths??0)>0&&c.jsx(on,{value:`${_.monthsProcessed}/${_.totalMonths}`,label:"Months Recalculated",color:_.phase==="recalculating"?"#22c55e":"#6b7280"})]}),c.jsx(ld,{percent:_.percentComplete})]}),I&&c.jsx(jo,{message:I,onDismiss:()=>Y(null)}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:h?"1fr":K?"2fr 1fr 200px 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:h?"block":"grid",gridTemplateColumns:h?void 0:"subgrid"},children:[K&&c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:h?"column":"row",flexWrap:"wrap",alignItems:h?"stretch":"center",gap:h?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:h?"0.5rem":"0.25rem"},children:[c.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:h?void 0:1,alignItems:"center"},children:c.jsx(uA,{isDraftMode:K,isEditingAppliedAllocations:T,availableNow:j,currentMonthIncome:D,balanceTotals:z,draftChangeAmount:Q,availableAfterApply:H,currentDraftTotal:M})}),c.jsx(W0,{isDraftMode:K,isEditingAppliedAllocations:T,allocationsFinalized:A,...ie})]}),!h&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:io,children:"Category"}),c.jsx("div",{style:{...io,textAlign:"right"},children:"Start"}),c.jsx("div",{style:{...io,textAlign:K?"center":"right"},children:"Allocated"}),c.jsx("div",{style:{...io,textAlign:"right"},children:"Spent"}),c.jsx("div",{style:{...io,textAlign:"right"},children:"Net Change"}),c.jsx("div",{style:{...io,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),c.jsx("div",{style:{...io,textAlign:"right"},children:"All-Time"})]}),!h&&c.jsx(iz,{isDraftMode:K,allocationsFinalized:A,balanceTotals:z,grandAllTime:te,...ie}),!K&&h&&c.jsx(az,{allocationsFinalized:A,availableNow:j,currentMonthIncome:D,balanceTotals:z,draftChangeAmount:Q,availableAfterApply:H,currentDraftTotal:M,...ie})]}),Object.keys(r).length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",c.jsx(Ft,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),U.map(ee=>{const le=F[ee.id]||[];if(le.length===0)return null;const pe=le.reduce((xe,[ve])=>{const J=re(ve);return J?{start:xe.start+J.start_balance,allocated:xe.allocated+J.allocated,spent:xe.spent+J.spent,end:xe.end+J.end_balance}:xe},{start:0,allocated:0,spent:0,end:0});return c.jsx(Kw,{name:ee.name,categories:le,groupTotals:pe,getCategoryBalance:re,localAllocations:E,savedAllocations:q,previousMonthIncome:W,isDraftMode:K,onAllocationChange:P,isMobile:h,getAllocationAmount:N},ee.id)}),F.ungrouped?.length>0&&(()=>{const ee=F.ungrouped,le=ee.reduce((pe,[xe])=>{const ve=re(xe);return ve?{start:pe.start+ve.start_balance,allocated:pe.allocated+ve.allocated,spent:pe.spent+ve.spent,end:pe.end+ve.end_balance}:pe},{start:0,allocated:0,spent:0,end:0});return c.jsx(Kw,{name:"Uncategorized",categories:ee,groupTotals:le,getCategoryBalance:re,localAllocations:E,savedAllocations:q,previousMonthIncome:W,isDraftMode:K,onAllocationChange:P,isMobile:h,isUngrouped:!0,getAllocationAmount:N},"ungrouped")})(),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),c.jsx(YU,{isOpen:x,onClose:()=>S(!1),onDeleted:()=>G(!1)})]})}function dA(t){return t===0?ae.zero:t>0?ae.success:ae.error}function hA(t){return t===0?ae.zero:t<0?ae.error:ae.success}function fA(t){return t===0?ae.zero:t>0?ae.success:ae.error}function Yw({name:t,accounts:e,groupTotals:n,accountBalances:r,isMobile:a,isUngrouped:o}){const u={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Nf,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return c.jsxs("div",{style:{display:"contents"},children:[!a&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{...u,opacity:o?.7:1},children:[c.jsx("span",{children:t}),c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:jt(n.start)},children:Hn.showGroupTotals}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:dA(n.income)},children:Hn.showGroupTotals}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:hA(n.expenses)},children:Hn.showGroupTotals}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:fA(n.netChange)},children:Hn.showGroupTotals}),c.jsx("div",{style:{...u,justifyContent:"flex-end",color:jt(n.end)},children:Hn.showGroupTotals})]}),a&&c.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Nf,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("span",{style:{fontWeight:600,opacity:o?.7:1},children:[t,c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Hn.showGroupTotals]}),e.map(([h,f],m)=>{const g=r[h];return g?a?c.jsx("div",{style:{gridColumn:"1 / -1"},children:c.jsx(uz,{account:f,balance:g})},h):c.jsx(cz,{account:f,balance:g,isEvenRow:m%2===0},h):null})]})}function cz({account:t,balance:e,isEvenRow:n}){const a={padding:"0.5rem 0.5rem",background:n?"transparent":"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem"};return c.jsxs("div",{style:{display:"contents"},children:[c.jsx("div",{style:{...a,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),c.jsx("div",{style:{...a,justifyContent:"flex-end",color:jt(e.start_balance)},children:$e(e.start_balance)}),c.jsxs("div",{style:{...a,justifyContent:"flex-end",color:dA(e.income)},children:["+",$e(e.income)]}),c.jsx("div",{style:{...a,justifyContent:"flex-end",color:hA(e.expenses)},children:ja(e.expenses)}),c.jsx("div",{style:{...a,justifyContent:"flex-end",color:fA(e.net_change)},children:yr(e.net_change)}),c.jsx("div",{style:{...a,justifyContent:"flex-end",fontWeight:600,color:jt(e.end_balance)},children:$e(e.end_balance)})]})}function uz({account:t,balance:e}){return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[c.jsx("div",{style:{marginBottom:"0.5rem"},children:c.jsx("span",{style:{fontWeight:500},children:t.nickname})}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),c.jsx("span",{children:$e(e.start_balance)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),c.jsx("span",{style:{color:jt(e.net_change)},children:yr(e.net_change)})]}),c.jsxs("div",{children:[c.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),c.jsx("span",{style:{color:jt(e.end_balance)},children:$e(e.end_balance)})]})]}),(e.income!==0||e.expenses!==0)&&c.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",gap:"1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&c.jsxs("span",{children:[yr(e.income)," income"]}),e.expenses!==0&&c.jsxs("span",{children:[ja(e.expenses)," expenses"]})]})]})}const _l={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function dz(t){return t===0?ae.zero:t>0?ae.success:ae.error}function hz(t){return t===0?ae.zero:t<0?ae.error:ae.success}function fz(t){return t===0?ae.zero:t>0?ae.success:ae.error}function mz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=zt(),{accounts:r,accountGroups:a,monthMap:o}=kn(),{month:u}=yi(t,e,n),h=Ls(),f=At(e,n),m=o[f]?.needs_recalculation===!0,g=C.useRef(!1),[_,v]=C.useState(null);C.useEffect(()=>{!t||!u||!m||g.current||(g.current=!0,`${e}${String(n).padStart(2,"0")}`,gm(t,{onProgress:H=>v(H)}).then(()=>{Oe.invalidateQueries({queryKey:Ce.month(t,e,n)})}).catch(H=>{console.error("[MonthAccounts] Recalculation failed:",H)}).finally(()=>{g.current=!1,v(null)}))},[t,m,u,e,n]);const x=C.useMemo(()=>Object.entries(a).map(([H,W])=>({id:H,...W})).sort((H,W)=>H.sort_order-W.sort_order),[a]),S=C.useMemo(()=>{const H={};return Object.entries(r).filter(([,W])=>!W.is_hidden).forEach(([W,D])=>{const A=D.account_group_id||"ungrouped";H[A]||(H[A]=[]),H[A].push([W,D])}),Object.keys(H).forEach(W=>{H[W].sort((D,A)=>D[1].sort_order-A[1].sort_order)}),H},[r]),E=C.useMemo(()=>nz(u,r),[u,r]),T=C.useMemo(()=>rz(E),[E]),I=T.income+T.expenses,M={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600},Q=()=>{if(!_)return"";switch(_.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return _.currentMonth?`Recalculating ${_.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}};return c.jsxs(c.Fragment,{children:[_&&c.jsxs(ac,{message:Q(),spinnerColor:"#22c55e",children:[c.jsx(od,{percent:_.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),c.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(_.totalMonthsToFetch??0)>0&&c.jsx(on,{value:`${_.monthsFetched||0}/${_.totalMonthsToFetch}`,label:"Months Loaded",color:_.phase==="fetching-months"?"#22c55e":"#6b7280"}),(_.totalMonths??0)>0&&c.jsx(on,{value:`${_.monthsProcessed}/${_.totalMonths}`,label:"Months Recalculated",color:_.phase==="recalculating"?"#22c55e":"#6b7280"})]}),c.jsx(ld,{percent:_.percentComplete})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:h?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr"},children:[c.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:h?"block":"grid",gridTemplateColumns:h?void 0:"subgrid"},children:[!h&&c.jsxs(c.Fragment,{children:[c.jsx("div",{style:_l,children:"Account"}),c.jsx("div",{style:{..._l,textAlign:"right"},children:"Start"}),c.jsx("div",{style:{..._l,textAlign:"right"},children:"Income"}),c.jsx("div",{style:{..._l,textAlign:"right"},children:"Expenses"}),c.jsx("div",{style:{..._l,textAlign:"right"},children:"Net Change"}),c.jsx("div",{style:{..._l,textAlign:"right"},children:"End"})]}),h?c.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[c.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),c.jsx(XU,{totals:T})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{style:{...M},children:"Grand Totals"}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:jt(T.start)},children:$e(T.start)}),c.jsxs("div",{style:{...M,justifyContent:"flex-end",color:dz(T.income)},children:["+",$e(T.income)]}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:hz(T.expenses)},children:ja(T.expenses)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:fz(I)},children:yr(I)}),c.jsx("div",{style:{...M,justifyContent:"flex-end",color:jt(T.end)},children:$e(T.end)})]})]}),Object.keys(r).length===0&&c.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",c.jsx(Ft,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),x.map(H=>{const W=S[H.id]||[];if(W.length===0)return null;const D=W.reduce((A,[N])=>{const P=E[N];return P?{start:A.start+P.start_balance,income:A.income+P.income,expenses:A.expenses+P.expenses,netChange:A.netChange+P.net_change,end:A.end+P.end_balance}:A},{start:0,income:0,expenses:0,netChange:0,end:0});return c.jsx(Yw,{name:H.name,accounts:W,groupTotals:D,accountBalances:E,isMobile:h},H.id)}),S.ungrouped?.length>0&&(()=>{const H=S.ungrouped,W=H.reduce((D,[A])=>{const N=E[A];return N?{start:D.start+N.start_balance,income:D.income+N.income,expenses:D.expenses+N.expenses,netChange:D.netChange+N.net_change,end:D.end+N.end_balance}:D},{start:0,income:0,expenses:0,netChange:0,end:0});return c.jsx(Yw,{name:"Ungrouped",accounts:H,groupTotals:W,accountBalances:E,isMobile:h,isUngrouped:!0},"ungrouped")})(),c.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const pz=["income","categories","accounts","spend","transfers","adjustments"];function Xw(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&pz.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function gz(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function Jw(){const t=HR(),e=Vu(),[n,r]=vE(),{addLoadingHold:a,removeLoadingHold:o}=sr(),{selectedBudgetId:u,setSelectedBudgetId:h,currentYear:f,currentMonthNumber:m,lastActiveTab:g,setCurrentYear:_,setCurrentMonthNumber:v,setLastActiveTab:x,setPageTitle:S,goToPreviousMonth:E,goToNextMonth:T,hasPendingInvites:I,needsFirstBudget:j}=zt(),{budget:M,isLoading:Q}=kn(),H=!Q,[W,D]=C.useState(!1);C.useEffect(()=>(H||a("budget-data","Loading budget data..."),()=>o("budget-data")),[H,a,o]);const A=C.useRef(!1),N=n.get("error"),[P,L]=C.useState(N);C.useEffect(()=>{N&&(n.delete("error"),r(n,{replace:!0}))},[N,n,r]);const[B,O]=C.useState(()=>{const{tab:re}=Xw(t);return re??g}),G=re=>{O(re),x(re)};C.useEffect(()=>{if(A.current)return;const{year:re,month:z}=Xw(t);re&&_(re),z&&v(z),A.current=!0},[t,_,v]),C.useEffect(()=>{if(!A.current)return;const re=`/budget/${f}/${m}/${B}`,z=`/budget/${t.year}/${t.month}/${t.tab}`;re!==z&&e(re,{replace:!0})},[f,m,B,e,t]);const{month:Y,error:U,isLoading:F}=yi(H?u:null,f,m);if(C.useEffect(()=>{if(!U||W)return;const re=U.message||"";if(re.includes("Budget")&&re.includes("does not exist")){queueMicrotask(()=>{h(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(re.includes("months in the past")||re.includes("Refusing to create month"))&&queueMicrotask(()=>{a("month-redirect","Redirecting to current month..."),D(!0);const{year:z,month:q}=gz();L(`Cannot create month ${f}/${m} - it's too far in the past. Redirected to current month.`),_(z),v(q)})},[U,W,f,m,_,v,a,h,e]),C.useEffect(()=>{W&&Y&&!F&&queueMicrotask(()=>{D(!1),o("month-redirect")})},[W,Y,F,o]),C.useLayoutEffect(()=>{S(M?.name||"Budget")},[M?.name,S]),C.useEffect(()=>{if(H&&!W){if(!M&&!u){e("/budget/my-budgets",{replace:!0});return}if(!M&&I){e("/budget/my-budgets",{replace:!0});return}if(j){e("/budget/my-budgets",{replace:!0});return}}},[H,W,M,u,I,j,e]),!H||W||!M)return null;function K(){L(null),E()}function Z(){L(null),T()}return c.jsxs(c.Fragment,{children:[P&&c.jsx(jo,{message:P,onDismiss:()=>L(null)}),c.jsx(NU,{onPreviousMonth:K,onNextMonth:Z}),c.jsx(wU,{activeTab:B,setActiveTab:G,allocationsFinalized:Y?.are_allocations_finalized}),B==="income"&&c.jsx(zU,{},`${f}-${m}`),B==="categories"&&c.jsx(lz,{},`${f}-${m}`),B==="accounts"&&c.jsx(mz,{},`${f}-${m}`),B==="spend"&&c.jsx(VU,{},`${f}-${m}`),B==="transfers"&&c.jsx(QU,{},`${f}-${m}`),B==="adjustments"&&c.jsx(KU,{},`${f}-${m}`)]})}function yz(){const{setPageTitle:t}=zt();return C.useLayoutEffect(()=>{t("Analytics")},[t]),c.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[c.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),c.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),c.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),c.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),c.jsx(Ft,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:ae.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function _z({message:t,onDismiss:e}){return c.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:t}),c.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function bz({message:t,onDismiss:e}){return c.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:t}),c.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function vz({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:a,onCheckInvite:o,onAcceptInvite:u,onCancel:h}){return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[c.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Join Budget by ID"]}),c.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?c.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[c.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[c.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&c.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[c.jsx("button",{onClick:u,disabled:a===r.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:a===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:a===r.budgetId?.7:1},children:a===r.budgetId?"Accepting...":"Accept Invitation"}),c.jsx("button",{onClick:h,disabled:a===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:a===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:a===r.budgetId?.7:.8},children:"Cancel"})]})]}):c.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[c.jsx("input",{type:"text",value:t,onChange:f=>e(f.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),c.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function xz({currentUserId:t}){return c.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[c.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),c.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function Sz(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:a,loadAccessibleBudgets:o,switchToBudget:u,checkBudgetInvite:h,isInitialized:f,setPageTitle:m,needsFirstBudget:g}=zt(),_=C.useRef(!1),[v,x]=vE(),S=v.get("context");C.useEffect(()=>{S&&(v.delete("context"),x(v,{replace:!0}))},[S,v,x]);const E=S==="budget-not-found",T=g&&a.length===0;C.useLayoutEffect(()=>{m("My Budgets")},[m]),C.useEffect(()=>{f&&!_.current&&(_.current=!0,o())},[f,o]);const{budget:I,renameBudget:j,acceptInvite:M,createBudget:Q,isLoading:H}=kn(),[W,D]=C.useState(null),[A,N]=C.useState(null),[P,L]=C.useState(null),[B,O]=C.useState(null),[G,Y]=C.useState(null),[U,F]=C.useState(""),[K,Z]=C.useState(!1),[re,z]=C.useState(""),[q,te]=C.useState(!1),[ie,ee]=C.useState(null),[le,pe]=C.useState(""),[xe,ve]=C.useState(!1);async function J(Ae){if(Ae!==I?.id){D(Ae),L(null),O(null);try{await u(Ae),O("Switched to budget successfully!"),await o({force:!0})}catch(Ke){L(Ke instanceof Error?Ke.message:"Failed to switch budget")}finally{D(null)}}}async function Se(Ae){N(Ae),L(null),O(null);try{await M(Ae),O("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(Ke){L(Ke instanceof Error?Ke.message:"Failed to accept invitation")}finally{N(null)}}async function je(Ae){if(Ae.preventDefault(),!!re.trim()){te(!0),L(null),ee(null);try{const Ke=await h(re.trim());Ke?ee(Ke):L("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Ke){L(Ke instanceof Error?Ke.message:"Failed to check invitation")}finally{te(!1)}}}async function at(){if(ie){ie.budgetName,N(ie.budgetId),L(null);try{await M(ie.budgetId),O(`Successfully joined "${ie.budgetName}"!`),ee(null),z(""),await o({force:!0})}catch(Ae){L(Ae instanceof Error?Ae.message:"Failed to accept invitation")}finally{N(null)}}}function Me(Ae,Ke){F(Ke),Y(Ae)}async function Ne(Ae){if(Ae.preventDefault(),!(!U.trim()||!G)){U.trim(),Z(!0),L(null),O(null);try{await j(U.trim()),O("Budget renamed successfully!"),Y(null),await o({force:!0})}catch(Ke){L(Ke instanceof Error?Ke.message:"Failed to rename budget")}finally{Z(!1)}}}async function lt(Ae){Ae.preventDefault(),le.trim(),ve(!0),L(null),O(null);try{const Ke=await Q(le.trim()||"My Budget");await u(Ke.budgetId),O("Budget created successfully!"),pe(""),await o({force:!0})}catch(Ke){L(Ke instanceof Error?Ke.message:"Failed to create budget")}finally{ve(!1)}}const Sn=a.filter(Ae=>!Ae.isPending),Gn=a.filter(Ae=>Ae.isPending);if(C.useEffect(()=>(H||!f?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[H,f,t,e]),H||!f)return null;let ft="My Budgets",Mt="Switch between budgets, accept invitations, or create a new budget.";return E?(ft="Budget Not Found",Mt="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):T&&(ft="Welcome!",Mt="Get started by creating your first budget or accepting an invitation."),c.jsxs("div",{children:[c.jsx("h1",{children:ft}),c.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:Mt}),P&&c.jsx(_z,{message:P,onDismiss:()=>L(null)}),B&&c.jsx(bz,{message:B,onDismiss:()=>O(null)}),Gn.length>0&&c.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Pending Invitations (",Gn.length,")"]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:Gn.map(Ae=>c.jsx(Lw,{budget:Ae,isCurrent:!1,isAccepting:A===Ae.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>Se(Ae.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},Ae.id))})]}),Sn.length>0&&c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Your Budgets (",Sn.length,")"]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:Sn.map(Ae=>c.jsx(Lw,{budget:Ae,isCurrent:Ae.id===n,isAccepting:!1,isSwitching:W===Ae.id,isEditing:G===Ae.id,editName:G===Ae.id?U:"",isRenaming:K,onAccept:()=>{},onSwitch:()=>J(Ae.id),onStartEdit:()=>Me(Ae.id,Ae.name),onCancelEdit:()=>{Y(null),F("")},onEditNameChange:F,onSaveEdit:Ne},Ae.id))})]}),c.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""})," Create New Budget"]}),c.jsxs("form",{onSubmit:lt,children:[c.jsxs("div",{style:{marginBottom:"1rem"},children:[c.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),c.jsx("input",{type:"text",value:le,onChange:Ae=>pe(Ae.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),c.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),c.jsx("button",{type:"submit",disabled:xe,style:{background:ae.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:xe?"not-allowed":"pointer",fontWeight:500,opacity:xe?.7:1,fontSize:"0.9rem"},children:xe?"Creating...":"Create Budget"})]})]}),c.jsx(vz,{budgetIdInput:re,setBudgetIdInput:z,isCheckingManual:q,manualInvite:ie,isAccepting:A,onCheckInvite:je,onAcceptInvite:at,onCancel:()=>{ee(null),z("")}}),r&&c.jsx(xz,{currentUserId:r})]})}const wz=["accounts","categories","users"];function Ez(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:a}=zt();C.useLayoutEffect(()=>{a("Budget Settings")},[a]);const{isOwner:o,isLoading:u}=kn();C.useEffect(()=>(u?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[u,t,e]);const h=Un(),f=h.pathname==="/budget/settings",m=C.useMemo(()=>{const S=h.pathname;return S.includes("/settings/accounts")?"accounts":S.includes("/settings/categories")?"categories":S.includes("/settings/users")?"users":"categories"},[h.pathname]),g=m==="users";C.useEffect(()=>{f||r(m)},[m,f,r]);function _(){return!wz.includes(n)||n==="users"&&!o?"categories":n}const v=C.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!o}],[o]);return u?null:!o&&g?c.jsxs("div",{children:[c.jsx("h1",{children:"Access Denied"}),c.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),c.jsx("p",{style:{marginTop:"1rem"},children:c.jsx(Ft,{to:"/budget/settings/categories",children:"Go to Categories "})})]}):c.jsxs("div",{children:[c.jsx(Lf,{mode:"link",linkPrefix:"/budget/settings",tabs:v,activeTab:f?_():m}),f?c.jsx(zf,{to:`/budget/settings/${_()}`,replace:!0}):c.jsx(cA,{children:c.jsx(Ff,{})})]})}function Uu({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:a,showGroupSelector:o=!1,showIncomeSettings:u=!1,hasExistingIncomeDefault:h=!1,hasExistingOutgoDefault:f=!1,currentGroupId:m}){const[g,_]=C.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),v=g.account_group_id||m,x=v?a.find(M=>M.id===v):null,S=x?.is_active!==void 0,E=x?.on_budget!==void 0;function T(M){M.preventDefault(),g.nickname.trim()&&e(g)}function I(M){_({...g,is_income_account:M,is_income_default:M?g.is_income_default:!1})}function j(M){_({...g,is_outgo_account:M,is_outgo_default:M?g.is_outgo_default:!1})}return c.jsxs(mi,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:T,children:[c.jsx(Et,{label:"Account Nickname",htmlFor:"account-nickname",children:c.jsx(pi,{id:"account-nickname",type:"text",value:g.nickname,onChange:M=>_({...g,nickname:M.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&c.jsx(Et,{label:"Account Type",htmlFor:"account-group",children:c.jsxs(Lu,{id:"account-group",value:g.account_group_id||"ungrouped",onChange:M=>_({...g,account_group_id:M.target.value==="ungrouped"?null:M.target.value}),children:[c.jsx("option",{value:"ungrouped",children:"Ungrouped"}),a.map(M=>c.jsx("option",{value:M.id,children:M.name},M.id))]})}),u&&c.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx(Or,{id:"is-active",checked:S?x.is_active:g.is_active!==!1,onChange:M=>_({...g,is_active:M.target.checked}),disabled:S,children:c.jsx("span",{style:{opacity:S?.5:1},children:"Active account"})}),S&&c.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ae.warning},children:['Set by account type "',x.name,'"']})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx(Or,{id:"on-budget",checked:E?x.on_budget:g.on_budget!==!1,onChange:M=>_({...g,on_budget:M.target.checked}),disabled:E,children:c.jsx("span",{style:{opacity:E?.5:1},children:"On budget (affects budget totals)"})}),E&&c.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ae.warning},children:['Set by account type "',x.name,'"']})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[c.jsx(Or,{id:"is-hidden",checked:g.is_hidden||!1,onChange:M=>_({...g,is_hidden:M.target.checked}),children:"Hidden account"}),c.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),c.jsx(Or,{id:"is-income-account",checked:g.is_income_account||!1,onChange:M=>I(M.target.checked),children:"Show in income deposit list"}),g.is_income_account&&c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[c.jsx(Or,{id:"is-income-default",checked:g.is_income_default||!1,onChange:M=>_({...g,is_income_default:M.target.checked}),disabled:h&&!t?.is_income_default,children:"Default account for new income"}),h&&!t?.is_income_default&&c.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),c.jsx(Or,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:M=>j(M.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[c.jsx(Or,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:M=>_({...g,is_outgo_default:M.target.checked}),disabled:f&&!t?.is_outgo_default,children:"Default account for new expenses"}),f&&!t?.is_outgo_default&&c.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),c.jsxs(Aa,{children:[c.jsx(Ie,{type:"submit",actionName:r,children:r}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"})]})]})}function Zw({label:t,value:e,onChange:n,trueLabel:r,falseLabel:a,undefinedLabel:o}){function u(){n(e===void 0?!0:e===!0?!1:void 0)}const h=e===!0?r:e===!1?a:o,f=e===!0?ae.success:e===!1?ae.warning:"inherit",m=e===!0?"":e===!1?"":"";return c.jsxs("button",{type:"button",onClick:u,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${f} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${f} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[c.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?f:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:m}),c.jsxs("span",{style:{flex:1},children:[c.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",c.jsx("span",{style:{fontWeight:500,color:f},children:h})]}),c.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function mA({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[a,o]=C.useState(t||{name:"",expected_balance:"positive"});function u(h){h.preventDefault(),a.name.trim()&&e(a)}return c.jsxs(mi,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:u,children:[c.jsx(Et,{label:"Account Type Name",htmlFor:"group-name",children:c.jsx(pi,{id:"group-name",type:"text",value:a.name,onChange:h=>o({...a,name:h.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),c.jsx(Et,{label:"Expected Balance",htmlFor:"expected-balance",children:c.jsxs(Lu,{id:"expected-balance",value:a.expected_balance,onChange:h=>o({...a,expected_balance:h.target.value}),children:[c.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),c.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),c.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),c.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",c.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),c.jsx(Zw,{label:"Active status",value:a.is_active,onChange:h=>o({...a,is_active:h}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),c.jsx(Zw,{label:"Budget status",value:a.on_budget,onChange:h=>o({...a,on_budget:h}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),c.jsxs(Aa,{children:[c.jsx(Ie,{type:"submit",actionName:r,children:r}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function bl({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${ae.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${ae.success} 40%, transparent)`,color:ae.success,opacity:1},warning:{background:`color-mix(in srgb, ${ae.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${ae.warning} 35%, transparent)`,color:ae.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${ae.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ae.success} 25%, transparent)`,color:ae.success,opacity:.7},expense:{background:`color-mix(in srgb, ${ae.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ae.warning} 25%, transparent)`,color:ae.warning,opacity:.7}}[n];return c.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[c.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function pA({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(u=>u.id===t.account_group_id):null,a=r?.is_active!==void 0?r.is_active:t.is_active!==!1,o=r?.on_budget!==void 0?r.on_budget:t.on_budget!==!1;if(!a){const u=r?.is_active!==void 0;n.push(c.jsx(bl,{icon:"",label:u?"Inactive (type)":"Inactive",variant:"warning",title:u?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const u=r?.on_budget!==void 0;n.push(c.jsx(bl,{icon:"",label:u?"Off Budget (type)":"Off Budget",variant:"warning",title:u?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(c.jsx(bl,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(c.jsx(bl,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(c.jsx(bl,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(c.jsx(bl,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:c.jsx(c.Fragment,{children:n})}function Cz({group:t}){const e=[];return t.is_active===!1?e.push(c.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ae.warning} 20%, transparent)`,color:ae.warning,whiteSpace:"nowrap"},title:"All accounts in this type are inactive",children:"All Inactive"},"inactive")):t.is_active===!0&&e.push(c.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ae.success} 20%, transparent)`,color:ae.success,whiteSpace:"nowrap"},title:"All accounts in this type are active",children:"All Active"},"active")),t.on_budget===!1?e.push(c.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ae.warning} 20%, transparent)`,color:ae.warning,whiteSpace:"nowrap"},title:"All accounts in this type are off budget",children:"All Off Budget"},"off-budget")):t.on_budget===!0&&e.push(c.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ae.success} 20%, transparent)`,color:ae.success,whiteSpace:"nowrap"},title:"All accounts in this type are on budget",children:"All On Budget"},"on-budget")),e.length===0?null:c.jsx(c.Fragment,{children:e})}function gA({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r}){return c.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[c.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ae.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&c.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function Tz({group:t,accountCount:e,groupTotal:n,canMoveUp:r,canMoveDown:a,isMobile:o,createForGroupId:u,onEdit:h,onDelete:f,onMoveUp:m,onMoveDown:g,onAddAccount:_}){return c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:o?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:o?"wrap":"nowrap"},children:[c.jsxs("h3",{style:{...xm,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0,flexWrap:"wrap"},children:[!o&&c.jsx("span",{style:{cursor:"grab",opacity:.4},children:""}),c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:t.name}),c.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]}),Hn.showGroupTotals,c.jsx(Cz,{group:t})]}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!o&&c.jsx(Ie,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:_,disabled:u!==null,children:"+ Account"}),c.jsx("button",{onClick:()=>{t.name,h()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),c.jsx("button",{onClick:()=>{t.name,f()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),c.jsxs("div",{style:U0,children:[c.jsx("button",{onClick:m,disabled:!r,style:{...Fl,opacity:r?.6:.2,cursor:r?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),c.jsx("button",{onClick:g,disabled:!a,style:{...Fl,opacity:a?.6:.2,cursor:a?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})}function Az(t,e){return!e||e==="any"||t===0?!1:e==="positive"&&t<0||e==="negative"&&t>0}function jz(t,e){return!e||e==="any"||t===0?null:e==="positive"&&t<0?"Unexpected negative balance":e==="negative"&&t>0?"Unexpected positive balance (credit owed to you?)":null}function Rz({group:t,groupIndex:e,totalGroups:n,accounts:r,allGroups:a,allAccounts:o,editingAccountId:u,editingGroupId:h,createForGroupId:f,setEditingAccountId:m,setEditingGroupId:g,setCreateForGroupId:_,dragType:v,draggedId:x,dragOverId:S,dragOverGroupId:E,setDragOverId:T,setDragOverGroupId:I,onAccountDragStart:j,onAccountDragOver:M,onAccountDrop:Q,onGroupDragStart:H,onGroupDragOver:W,onGroupDrop:D,onDragLeave:A,onDragLeaveGroup:N,onDragEnd:P,onDropOnGroup:L,onCreateAccount:B,onUpdateAccount:O,onDeleteAccount:G,onMoveAccount:Y,onUpdateGroup:U,onDeleteGroup:F,onMoveGroup:K}){const Z=Ls(),re=[...r].sort((J,Se)=>J.sort_order-Se.sort_order),z=v==="group"&&x===t.id,q=v==="group"&&S===t.id,te=v==="account"&&E===t.id,ee=(x&&v==="account"?o[x]:null)&&Object.entries(o).find(([J])=>J===x)?.[1]&&Object.entries(o).find(([J])=>J===x)?.[1]?.account_group_id!==t.id,le=v==="group"&&q&&x!==t.id,pe=e>0,xe=e<n-1,ve=re.reduce((J,Se)=>J+Se.balance,0);return c.jsxs("div",{children:[v==="group"&&!z&&c.jsxs("div",{onDragOver:J=>{J.preventDefault(),T(t.id)},onDragLeave:A,onDrop:J=>D(J,t.id),style:{position:"relative",height:le?"2.5rem":"0.5rem",marginBottom:le?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[c.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ae.primary,borderRadius:"2px",opacity:le?1:0,transition:"opacity 0.15s",boxShadow:le?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),le&&c.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),c.jsx("div",{draggable:h!==t.id,onDragStart:J=>H(J,t.id),onDragOver:J=>W(J,t.id),onDragLeave:N,onDragEnd:P,onDrop:J=>L(J,t.id),style:{background:z?"color-mix(in srgb, currentColor 3%, transparent)":te&&ee?`color-mix(in srgb, ${ae.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:z?.5:1,border:te&&ee?`2px dashed ${ae.primary}`:"2px solid transparent",cursor:h===t.id?"default":"grab",transition:"all 0.15s"},children:h===t.id?c.jsx(mA,{initialData:{name:t.name,expected_balance:t.expected_balance||"positive",on_budget:t.on_budget,is_active:t.is_active},onSubmit:J=>U(t.id,J),onCancel:()=>g(null),submitLabel:"Save"}):c.jsxs(c.Fragment,{children:[c.jsx(Tz,{group:t,accountCount:re.length,groupTotal:ve,canMoveUp:pe,canMoveDown:xe,isMobile:Z,createForGroupId:f,onEdit:()=>g(t.id),onDelete:()=>F(t.id),onMoveUp:()=>K(t.id,"up"),onMoveDown:()=>K(t.id,"down"),onAddAccount:()=>_(t.id)}),Z&&c.jsx("div",{style:{marginBottom:"0.5rem"},children:c.jsx(Ie,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>_(t.id),disabled:f!==null,children:"+ Account"})}),c.jsxs("div",{style:Vl,children:[re.map((J,Se)=>u===J.id?c.jsx(Uu,{initialData:{nickname:J.nickname,account_group_id:J.account_group_id,is_income_account:J.is_income_account,is_income_default:J.is_income_default,is_outgo_account:J.is_outgo_account,is_outgo_default:J.is_outgo_default,on_budget:J.on_budget,is_active:J.is_active},onSubmit:je=>O(J.id,je),onCancel:()=>m(null),submitLabel:"Save",accountGroups:a,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:J.account_group_id,hasExistingIncomeDefault:Object.entries(o).some(([je,at])=>at.is_income_default&&je!==J.id),hasExistingOutgoDefault:Object.entries(o).some(([je,at])=>at.is_outgo_default&&je!==J.id)},J.id):c.jsx(Sm,{isDragging:v==="account"&&x===J.id,isDragOver:S===J.id,onDragStart:je=>{je.stopPropagation(),j(je,J.id)},onDragOver:je=>M(je,J.id,t.id),onDragLeave:A,onDragEnd:P,onDrop:je=>Q(je,J.id,t.id),onEdit:()=>{J.nickname,m(J.id)},onDelete:()=>{J.nickname,G(J.id)},onMoveUp:()=>Y(J.id,"up"),onMoveDown:()=>Y(J.id,"down"),canMoveUp:Se>0,canMoveDown:Se<re.length-1,children:c.jsxs("div",{children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("span",{style:z0,children:J.nickname}),c.jsx(pA,{account:J,accountGroups:a})]}),c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:jt(J.balance)},children:[$e(J.balance),Az(J.balance,t.expected_balance)&&c.jsx("span",{title:jz(J.balance,t.expected_balance)||"",style:{marginLeft:"0.5rem",fontSize:"0.85rem"},children:""})]})]})},J.id)),re.length===0&&!f&&c.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No accounts in this type"}),v==="account"&&re.length>0&&c.jsx(gA,{groupId:t.id,isActive:S===`__end__${t.id}`,onDragOver:J=>{J.preventDefault(),J.stopPropagation(),T(`__end__${t.id}`),I(t.id)},onDragLeave:J=>{J.stopPropagation(),T(null)},onDrop:J=>{J.stopPropagation(),Q(J,"__group_end__",t.id)}}),f===t.id&&c.jsx(Uu,{initialData:{nickname:"",account_group_id:t.id},onSubmit:J=>B(J,t.id),onCancel:()=>_(null),submitLabel:"Create",accountGroups:a,showIncomeSettings:!0,currentGroupId:t.id})]}),f!==t.id&&c.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:c.jsx(Ie,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>_(t.id),disabled:f!==null,children:"+ Add Account"})})]})})]})}function Iz({accounts:t,allGroups:e,allAccounts:n,hasGroups:r,editingAccountId:a,createForGroupId:o,setEditingAccountId:u,setCreateForGroupId:h,dragType:f,draggedId:m,dragOverId:g,dragOverGroupId:_,setDragOverId:v,setDragOverGroupId:x,onAccountDragStart:S,onAccountDragOver:E,onAccountDrop:T,onDragOverGroup:I,onDropOnGroup:j,onDragLeave:M,onDragLeaveGroup:Q,onDragEnd:H,onCreateAccount:W,onUpdateAccount:D,onDeleteAccount:A,onMoveAccount:N}){const P=[...t].sort((G,Y)=>G.sort_order-Y.sort_order),L=f==="account"&&_==="ungrouped",O=(m&&f==="account"?n[m]:null)&&Object.entries(n).find(([G])=>G===m)?.[1]&&Object.entries(n).find(([G])=>G===m)?.[1]?.account_group_id!==null;return P.length===0&&!o&&r&&f!=="account"?null:(P.reduce((G,Y)=>G+Y.balance,0),c.jsxs("div",{onDragOver:G=>I(G,"ungrouped"),onDragLeave:Q,onDrop:G=>j(G,"ungrouped"),style:{background:L&&O?`color-mix(in srgb, ${ae.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:L&&O?`2px dashed ${ae.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[c.jsxs("h3",{style:{...xm,margin:0,opacity:.7,display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:"Ungrouped"}),c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",P.length,")"]}),Hn.showGroupTotals]}),c.jsx(Ie,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>h("ungrouped"),disabled:o!==null,children:"+ Account"})]}),c.jsxs("div",{style:Vl,children:[P.map((G,Y)=>a===G.id?c.jsx(Uu,{initialData:{nickname:G.nickname,account_group_id:G.account_group_id,is_income_account:G.is_income_account,is_income_default:G.is_income_default,is_outgo_account:G.is_outgo_account,is_outgo_default:G.is_outgo_default,on_budget:G.on_budget,is_active:G.is_active},onSubmit:U=>D(G.id,U),onCancel:()=>u(null),submitLabel:"Save",accountGroups:e,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:null,hasExistingIncomeDefault:Object.entries(n).some(([U,F])=>F.is_income_default&&U!==G.id),hasExistingOutgoDefault:Object.entries(n).some(([U,F])=>F.is_outgo_default&&U!==G.id)},G.id):c.jsx(Sm,{isDragging:f==="account"&&m===G.id,isDragOver:g===G.id,onDragStart:U=>S(U,G.id),onDragOver:U=>E(U,G.id,"ungrouped"),onDragLeave:M,onDragEnd:H,onDrop:U=>T(U,G.id,"ungrouped"),onEdit:()=>{G.nickname,u(G.id)},onDelete:()=>{G.nickname,A(G.id)},onMoveUp:()=>N(G.id,"up"),onMoveDown:()=>N(G.id,"down"),canMoveUp:Y>0,canMoveDown:Y<P.length-1,children:c.jsxs("div",{children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("span",{style:z0,children:G.nickname}),c.jsx(pA,{account:G,accountGroups:e})]}),c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:jt(G.balance)},children:$e(G.balance)})]})},G.id)),P.length===0&&f==="account"&&c.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to ungroup"}),f==="account"&&P.length>0&&c.jsx(gA,{groupId:"ungrouped",isActive:g==="__end__ungrouped",onDragOver:G=>{G.preventDefault(),G.stopPropagation(),v("__end__ungrouped"),x("ungrouped")},onDragLeave:G=>{G.stopPropagation(),v(null)},onDrop:G=>{G.stopPropagation(),T(G,"__group_end__","ungrouped")}}),o==="ungrouped"&&c.jsx(Uu,{initialData:{nickname:"",account_group_id:null},onSubmit:G=>W(G,"ungrouped"),onCancel:()=>h(null),submitLabel:"Create",accountGroups:e,showIncomeSettings:!0,currentGroupId:null})]}),o!=="ungrouped"&&c.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:c.jsx(Ie,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>h("ungrouped"),disabled:o!==null,children:"+ Add Account"})})]}))}function Dz(){const{accounts:t,accountsByGroup:e,hiddenAccounts:n,sortedGroups:r,currentBudget:a,error:o,setError:u,handleCreateAccount:h,handleUpdateAccount:f,handleDeleteAccount:m,handleMoveAccount:g,handleCreateGroup:_,handleUpdateGroup:v,handleDeleteGroup:x,handleMoveGroup:S,reorderAccountsInGroup:E,reorderGroups:T}=YB(),I=Ls(),[j,M]=C.useState(null),[Q,H]=C.useState(null),[W,D]=C.useState(null),[A,N]=C.useState(!1),[P,L]=C.useState(null),[B,O]=C.useState(null),[G,Y]=C.useState(null),[U,F]=C.useState(null);function K(J,Se){L("account"),O(Se),J.dataTransfer.effectAllowed="move"}function Z(J,Se,je){J.preventDefault(),P==="account"&&(Se!==B&&Y(Se),F(je))}function re(J,Se){J.preventDefault(),P==="account"?(F(Se),Y(null)):P==="group"&&Se!==B&&Y(Se)}function z(){Y(null)}function q(){F(null)}function te(){L(null),O(null),Y(null),F(null)}async function ie(J,Se,je){if(J.preventDefault(),J.stopPropagation(),!B||P!=="account"){te();return}await E(B,Se,je),te()}async function ee(J,Se){J.preventDefault(),P==="account"?await ie(J,"__group_end__",Se):P==="group"&&await pe(J,Se)}function le(J,Se){J.stopPropagation(),L("group"),O(Se),J.dataTransfer.effectAllowed="move"}async function pe(J,Se){if(J.preventDefault(),!B||P!=="group"||B===Se){te();return}await T(B,Se),te()}const xe=C.useMemo(()=>{const J=Object.values(t),Se=J.reduce((Me,Ne)=>Me+(Ne.balance??0),0);let je=0,at=0;for(const Me of J){const Ne=r.find(Sn=>Sn.id===Me.account_group_id);Me.on_budget===!0||Me.on_budget===void 0&&Ne?.on_budget!==!1?je+=Me.balance??0:at+=Me.balance??0}return{count:J.length,groupCount:r.length,totalBalance:Se,onBudgetTotal:je,offBudgetTotal:at}},[t,r]);if(!a)return c.jsx("p",{children:"No budget found. Please log in."});const ve=e.ungrouped||[];return c.jsxs("div",{children:[o&&c.jsx(jo,{message:o,onDismiss:()=>u(null)}),c.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),c.jsx("span",{style:{color:jt(xe.onBudgetTotal),fontWeight:600},children:$e(xe.onBudgetTotal)})]}),xe.offBudgetTotal!==0&&c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),c.jsx("span",{style:{fontWeight:600,opacity:.7},children:$e(xe.offBudgetTotal)})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Total: "}),c.jsx("span",{style:{color:jt(xe.totalBalance),fontWeight:600},children:$e(xe.totalBalance)})]}),c.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:I?"Drag to move.":"Drag between types or use  to reorder."})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:c.jsx(q0,{})})]})}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(t).length===0&&r.length===0&&c.jsx("p",{style:{opacity:.7},children:"No accounts yet. Create an account type first, then add accounts!"}),r.map((J,Se)=>c.jsx(Rz,{group:J,groupIndex:Se,totalGroups:r.length,accounts:e[J.id]||[],allGroups:r,allAccounts:t,editingAccountId:j,editingGroupId:W,createForGroupId:Q,setEditingAccountId:M,setEditingGroupId:D,setCreateForGroupId:H,dragType:P,draggedId:B,dragOverId:G,dragOverGroupId:U,setDragOverId:Y,setDragOverGroupId:F,onAccountDragStart:K,onAccountDragOver:Z,onAccountDrop:ie,onGroupDragStart:le,onGroupDragOver:re,onGroupDrop:pe,onDragLeave:z,onDragLeaveGroup:q,onDragEnd:te,onDropOnGroup:ee,onCreateAccount:h,onUpdateAccount:(je,at)=>{f(je,at),M(null)},onDeleteAccount:m,onMoveAccount:g,onUpdateGroup:(je,at)=>{v(je,at),D(null)},onDeleteGroup:x,onMoveGroup:S},J.id)),P==="group"&&r.length>0&&c.jsx($0,{isActive:G==="__end__",onDragOver:J=>{J.preventDefault(),Y("__end__")},onDragLeave:z,onDrop:J=>pe(J,"__end__"),label:"Move account type to end"}),c.jsx(Iz,{accounts:ve,allGroups:r,allAccounts:t,hasGroups:r.length>0,editingAccountId:j,createForGroupId:Q,setEditingAccountId:M,setCreateForGroupId:H,dragType:P,draggedId:B,dragOverId:G,dragOverGroupId:U,setDragOverId:Y,setDragOverGroupId:F,onAccountDragStart:K,onAccountDragOver:Z,onAccountDrop:ie,onDragOverGroup:re,onDropOnGroup:ee,onDragLeave:z,onDragLeaveGroup:q,onDragEnd:te,onCreateAccount:h,onUpdateAccount:(J,Se)=>{f(J,Se),M(null)},onDeleteAccount:m,onMoveAccount:g})]}),n.length>0&&c.jsx("div",{style:{marginBottom:"2rem"},children:c.jsxs(H0,{title:"Hidden Accounts",count:n.length,children:[c.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[c.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[c.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),c.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:n.map(J=>j===J.id?c.jsx(Uu,{initialData:{nickname:J.nickname,account_group_id:J.account_group_id,is_income_account:J.is_income_account,is_income_default:J.is_income_default,is_outgo_account:J.is_outgo_account,is_outgo_default:J.is_outgo_default,on_budget:J.on_budget,is_active:J.is_active,is_hidden:J.is_hidden},onSubmit:Se=>{f(J.id,Se),M(null)},onCancel:()=>M(null),submitLabel:"Save",accountGroups:r,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:J.account_group_id,hasExistingIncomeDefault:Object.entries(t).some(([Se,je])=>je.is_income_default&&Se!==J.id),hasExistingOutgoDefault:Object.entries(t).some(([Se,je])=>je.is_outgo_default&&Se!==J.id)},J.id):c.jsxs("div",{onClick:()=>M(J.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[c.jsx("span",{children:J.nickname}),c.jsx("span",{style:{color:jt(J.balance),fontWeight:500},children:$e(J.balance)})]},J.id))})]})}),A?c.jsx(mA,{onSubmit:J=>{_(J),N(!1)},onCancel:()=>N(!1),submitLabel:"Create Account Type"}):c.jsx(Ie,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>N(!0),children:"+ Add Account Type"})]})}function zu({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:a=[],showGroupSelector:o=!1}){const[u,h]=C.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[f,m]=C.useState(t?.default_monthly_amount?.toString()||""),[g,_]=C.useState(t?.default_monthly_type||"fixed"),[v,x]=C.useState(!1);function S(E){if(E.preventDefault(),!u.name.trim())return;x(!0);const T=parseFloat(f),I=!isNaN(T)&&T>0;e({...u,description:u.description?.trim()||void 0,default_monthly_amount:I?T:void 0,default_monthly_type:I?g:void 0})}return c.jsxs(mi,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:S,children:[c.jsx(Et,{label:"Category Name",htmlFor:"category-name",children:c.jsx(pi,{id:"category-name",type:"text",value:u.name,onChange:E=>h({...u,name:E.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),c.jsx(Et,{label:"Description (optional)",htmlFor:"category-description",children:c.jsx(V0,{id:"category-description",value:u.description||"",onChange:E=>h({...u,description:E.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&c.jsx(Et,{label:"Category Group",htmlFor:"category-group",children:c.jsxs(Lu,{id:"category-group",value:u.category_group_id||"ungrouped",onChange:E=>h({...u,category_group_id:E.target.value==="ungrouped"?null:E.target.value}),children:[c.jsx("option",{value:"ungrouped",children:"Uncategorized"}),a.map(E=>c.jsx("option",{value:E.id,children:E.name},E.id))]})}),c.jsxs(Et,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[c.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[c.jsxs(Lu,{id:"default-type",value:g,onChange:E=>_(E.target.value),style:{width:"auto",flex:"0 0 auto"},children:[c.jsx("option",{value:"fixed",children:"Fixed $"}),c.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?c.jsx(co,{id:"default-amount",value:f,onChange:m,placeholder:"$0.00"}):c.jsx(pi,{id:"default-amount",type:"number",value:f,onChange:E=>m(E.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&c.jsx("span",{style:{opacity:.6},children:"%"})]}),c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&c.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[c.jsx(Or,{id:"is-hidden",checked:u.is_hidden||!1,onChange:E=>h({...u,is_hidden:E.target.checked}),children:"Hidden category"}),c.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),c.jsxs(Aa,{children:[c.jsx(Ie,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:v,children:r}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"})]})]})}function yA({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[a,o]=C.useState(t||{name:""}),[u,h]=C.useState(!1);function f(m){m.preventDefault(),a.name.trim()&&(h(!0),e(a))}return c.jsxs(mi,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:f,children:[c.jsx(Et,{label:"Group Name",htmlFor:"group-name",children:c.jsx(pi,{id:"group-name",type:"text",value:a.name,onChange:m=>o({...a,name:m.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),c.jsxs(Aa,{children:[c.jsx(Ie,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:u,children:r}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function _A({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r}){return c.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[c.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ae.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&c.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function bA({category:t,catId:e,categoryBalances:n,loadingBalances:r}){const a=n[e]||{current:0,total:0};return c.jsxs("div",{children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[c.jsx("span",{style:z0,children:t.name}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&c.jsxs("span",{style:{fontSize:"0.75rem",opacity:.8,background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.15rem 0.4rem",borderRadius:"4px"},children:["Default: ",t.default_monthly_type==="percentage"?c.jsxs(c.Fragment,{children:[c.jsxs("span",{style:{color:ae.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{style:{color:ae.success,fontWeight:500},children:$e(t.default_monthly_amount)}),"/mo"]})]})]}),t.description&&c.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",opacity:.6,lineHeight:1.3},children:t.description}),c.jsxs("div",{style:{marginTop:"0.25rem"},children:[c.jsxs("p",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:Dn(a.current)},children:[r?"...":Zr(a.current),c.jsx("span",{style:{fontSize:"0.75rem",fontWeight:400,opacity:.6,marginLeft:"0.35rem"},children:"available now"})]}),c.jsxs("p",{style:{margin:"0.15rem 0 0 0",fontSize:"0.85rem",fontWeight:500,color:Dn(a.total),opacity:.75},children:[r?"...":Zr(a.total),c.jsx("span",{style:{fontSize:"0.7rem",fontWeight:400,opacity:.7,marginLeft:"0.35rem"},children:"total allocated"})]})]})]})}function Mz({group:t,categoryCount:e,canMoveUp:n,canMoveDown:r,isMobile:a,createForGroupId:o,onEdit:u,onDelete:h,onMoveUp:f,onMoveDown:m,onAddCategory:g,onDragStart:_,onDragEnd:v}){return c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:a?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:a?"wrap":"nowrap"},children:[c.jsxs("h3",{style:{...xm,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0},children:[!a&&c.jsx("span",{draggable:!0,onDragStart:_,onDragEnd:v,style:{cursor:"grab",opacity:.4,padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder group",children:""}),c.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),c.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]})]}),c.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!a&&c.jsx(Ie,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:g,disabled:o!==null,children:"+ Category"}),c.jsx("button",{onClick:()=>{t.name,u()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),c.jsx("button",{onClick:()=>{t.name,h()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),c.jsxs("div",{style:U0,children:[c.jsx("button",{onClick:f,disabled:!n,style:{...Fl,opacity:n?.6:.2,cursor:n?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),c.jsx("button",{onClick:m,disabled:!r,style:{...Fl,opacity:r?.6:.2,cursor:r?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]})}function kz({group:t,groupIndex:e,groupCategories:n,sortedGroups:r,categoryGroups:a,categoryBalances:o,loadingBalances:u,dragType:h,draggedId:f,dragOverId:m,dragOverGroupId:g,editingCategoryId:_,setEditingCategoryId:v,createForGroupId:x,setCreateForGroupId:S,editingGroupId:E,setEditingGroupId:T,handleCreateCategory:I,handleUpdateCategory:j,handleDeleteCategory:M,handleMoveCategory:Q,handleUpdateGroup:H,handleDeleteGroup:W,handleMoveGroup:D,handleCategoryDragStart:A,handleCategoryDragOver:N,handleDragOverGroup:P,handleDragLeave:L,handleDragLeaveGroup:B,handleDragEnd:O,handleCategoryDrop:G,handleDropOnGroup:Y,handleGroupDragStart:U,handleGroupDrop:F,setDragOverId:K,setDragOverGroupId:Z,isMobile:re,categories:z}){const q=h==="group"&&f===t.id,te=h==="group"&&m===t.id,ie=h==="category"&&g===t.id,ee=f&&h==="category"?z[f]:null,le=ee&&(ee.category_group_id||"ungrouped")!==t.id,pe=h==="group"&&te&&f!==t.id,xe=e>0,ve=e<r.length-1;return c.jsxs("div",{children:[h==="group"&&!q&&c.jsxs("div",{onDragOver:J=>{J.preventDefault(),K(t.id)},onDragLeave:L,onDrop:J=>F(J,t.id),style:{position:"relative",height:pe?"2.5rem":"0.5rem",marginBottom:pe?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[c.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ae.primary,borderRadius:"2px",opacity:pe?1:0,transition:"opacity 0.15s",boxShadow:pe?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),pe&&c.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),c.jsx("div",{onDragOver:J=>P(J,t.id),onDragLeave:B,onDrop:J=>Y(J,t.id),style:{background:q?"color-mix(in srgb, currentColor 3%, transparent)":ie&&le?`color-mix(in srgb, ${ae.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:q?.5:1,border:ie&&le?`2px dashed ${ae.primary}`:"2px solid transparent",transition:"all 0.15s"},children:E===t.id?c.jsx(yA,{initialData:{name:t.name},onSubmit:J=>H(t.id,J),onCancel:()=>T(null),submitLabel:"Save"}):c.jsxs(c.Fragment,{children:[c.jsx(Mz,{group:t,categoryCount:n.length,canMoveUp:xe,canMoveDown:ve,isMobile:re,createForGroupId:x,onEdit:()=>T(t.id),onDelete:()=>W(t.id),onMoveUp:()=>D(t.id,"up"),onMoveDown:()=>D(t.id,"down"),onAddCategory:()=>S(t.id),onDragStart:J=>U(J,t.id),onDragEnd:O}),re&&c.jsx("div",{style:{marginBottom:"0.5rem"},children:c.jsx(Ie,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>S(t.id),disabled:x!==null,children:"+ Category"})}),c.jsxs("div",{style:Vl,children:[n.map(([J,Se])=>_===J?c.jsx(zu,{initialData:{name:Se.name,description:Se.description,category_group_id:Se.category_group_id,default_monthly_amount:Se.default_monthly_amount,default_monthly_type:Se.default_monthly_type,is_hidden:Se.is_hidden},onSubmit:je=>{j(J,je),v(null)},onCancel:()=>v(null),submitLabel:"Save",categoryGroups:a,showGroupSelector:!0},J):c.jsx(Sm,{isDragging:h==="category"&&f===J,isDragOver:m===J,onDragStart:je=>{je.stopPropagation(),A(je,J)},onDragOver:je=>N(je,J,t.id),onDragLeave:L,onDragEnd:O,onDrop:je=>G(je,J,t.id),onEdit:()=>{Se.name,v(J)},onDelete:()=>{Se.name,M(J)},onMoveUp:()=>Q(J,"up"),onMoveDown:()=>Q(J,"down"),canMoveUp:n.findIndex(([je])=>je===J)>0,canMoveDown:n.findIndex(([je])=>je===J)<n.length-1,children:c.jsx(bA,{category:Se,catId:J,categoryBalances:o,loadingBalances:u})},J)),n.length===0&&!x&&c.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No categories in this group"}),h==="category"&&n.length>0&&c.jsx(_A,{groupId:t.id,isActive:m===`__end__${t.id}`,onDragOver:J=>{J.preventDefault(),J.stopPropagation(),K(`__end__${t.id}`),Z(t.id)},onDragLeave:J=>{J.stopPropagation(),K(null)},onDrop:J=>{J.stopPropagation(),G(J,"__group_end__",t.id)}}),x===t.id&&c.jsx(zu,{initialData:{name:"",category_group_id:t.id},onSubmit:J=>I(J,t.id),onCancel:()=>S(null),submitLabel:"Create",categoryGroups:a})]}),x!==t.id&&c.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:c.jsx(Ie,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>S(t.id),disabled:x!==null,children:"+ Add Category"})})]})})]})}function Oz({ungroupedCategories:t,categoryGroups:e,categoryBalances:n,loadingBalances:r,dragType:a,draggedId:o,dragOverId:u,dragOverGroupId:h,editingCategoryId:f,setEditingCategoryId:m,createForGroupId:g,setCreateForGroupId:_,handleCreateCategory:v,handleUpdateCategory:x,handleDeleteCategory:S,handleMoveCategory:E,handleCategoryDragStart:T,handleCategoryDragOver:I,handleDragOverGroup:j,handleDragLeaveGroup:M,handleDragLeave:Q,handleDragEnd:H,handleCategoryDrop:W,handleDropOnGroup:D,setDragOverId:A,setDragOverGroupId:N,categories:P,hasGroups:L}){const B=a==="category"&&h==="ungrouped",O=o&&a==="category"?P[o]:null,G=O&&O.category_group_id!==null;return t.length===0&&!g&&L&&a!=="category"?null:c.jsxs("div",{onDragOver:Y=>j(Y,"ungrouped"),onDragLeave:M,onDrop:Y=>D(Y,"ungrouped"),style:{background:B&&G?`color-mix(in srgb, ${ae.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:B&&G?`2px dashed ${ae.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[c.jsxs("h3",{style:{...xm,margin:0,opacity:.7},children:["Uncategorized",c.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",t.length,")"]})]}),c.jsx(Ie,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>_("ungrouped"),disabled:g!==null,children:"+ Category"})]}),c.jsxs("div",{style:Vl,children:[t.map(([Y,U])=>f===Y?c.jsx(zu,{initialData:{name:U.name,description:U.description,category_group_id:U.category_group_id,default_monthly_amount:U.default_monthly_amount,default_monthly_type:U.default_monthly_type,is_hidden:U.is_hidden},onSubmit:F=>{x(Y,F),m(null)},onCancel:()=>m(null),submitLabel:"Save",categoryGroups:e,showGroupSelector:!0},Y):c.jsx(Sm,{isDragging:a==="category"&&o===Y,isDragOver:u===Y,onDragStart:F=>T(F,Y),onDragOver:F=>I(F,Y,"ungrouped"),onDragLeave:Q,onDragEnd:H,onDrop:F=>W(F,Y,"ungrouped"),onEdit:()=>{U.name,m(Y)},onDelete:()=>{U.name,S(Y)},onMoveUp:()=>E(Y,"up"),onMoveDown:()=>E(Y,"down"),canMoveUp:t.findIndex(([F])=>F===Y)>0,canMoveDown:t.findIndex(([F])=>F===Y)<t.length-1,children:c.jsx(bA,{category:U,catId:Y,categoryBalances:n,loadingBalances:r})},Y)),t.length===0&&a==="category"&&c.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to uncategorize"}),a==="category"&&t.length>0&&c.jsx(_A,{groupId:"ungrouped",isActive:u==="__end__ungrouped",onDragOver:Y=>{Y.preventDefault(),Y.stopPropagation(),A("__end__ungrouped"),N("ungrouped")},onDragLeave:Y=>{Y.stopPropagation(),A(null)},onDrop:Y=>{Y.stopPropagation(),W(Y,"__group_end__","ungrouped")}}),g==="ungrouped"&&c.jsx(zu,{initialData:{name:"",category_group_id:null},onSubmit:Y=>v(Y,"ungrouped"),onCancel:()=>_(null),submitLabel:"Create",categoryGroups:e})]}),g!=="ungrouped"&&c.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:c.jsx(Ie,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>_("ungrouped"),disabled:g!==null,children:"+ Add Category"})})]})}function Nz(){const{currentBudget:t,categories:e,categoryGroups:n,categoriesByGroup:r,hiddenCategories:a,sortedGroups:o,categoryBalances:u,isLoading:h,loadingBalances:f,error:m,setError:g,getOnBudgetTotal:_,handleCreateCategory:v,handleUpdateCategory:x,handleDeleteCategory:S,handleMoveCategory:E,handleCreateGroup:T,handleUpdateGroup:I,handleDeleteGroup:j,handleMoveGroup:M,dragType:Q,draggedId:H,dragOverId:W,dragOverGroupId:D,setDragOverId:A,setDragOverGroupId:N,handleCategoryDragStart:P,handleCategoryDragOver:L,handleDragOverGroup:B,handleDragLeave:O,handleDragLeaveGroup:G,handleDragEnd:Y,handleCategoryDrop:U,handleDropOnGroup:F,handleGroupDragStart:K,handleGroupDrop:Z}=eL(),re=Ls(),{addLoadingHold:z,removeLoadingHold:q}=sr();C.useEffect(()=>(h?z("categories","Loading categories..."):q("categories"),()=>q("categories")),[h,z,q]);const[te,ie]=C.useState(null),[ee,le]=C.useState(null),[pe,xe]=C.useState(null),[ve,J]=C.useState(!1);if(!t)return c.jsx("p",{children:"No budget found. Please log in."});const Se=Object.values(u).reduce((Ne,lt)=>Ne+lt.current,0),je=Object.values(u).reduce((Ne,lt)=>Ne+lt.total,0),at=_()-Se,Me=Math.abs(je-Se)>.01;return h?null:c.jsxs("div",{children:[m&&c.jsx(jo,{message:m,onDismiss:()=>g(null)}),c.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[c.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:600},children:"Categories:"}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),c.jsx("span",{style:{color:jt(_()),fontWeight:600},children:$e(_())})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Allocated: "}),c.jsx("span",{style:{color:lc(Se),fontWeight:600},children:f?"...":$e(Se)}),Me&&c.jsxs("span",{style:{opacity:.5,fontSize:"0.8rem"},children:[" (",$e(je)," total)"]})]}),c.jsxs("span",{children:[c.jsx("span",{style:{opacity:.6},children:"Available: "}),c.jsx("span",{style:{color:jt(at),fontWeight:600},children:f?"...":$e(at)})]}),c.jsx("span",{style:{opacity:.6},children:re?"Drag to move between groups.":"Drag categories between groups, or use  to reorder."})]}),c.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:c.jsx(q0,{})})]})}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(e).length===0&&n.length===0&&c.jsx("p",{style:{opacity:.7},children:"No categories yet. Create a group first, then add categories!"}),o.map((Ne,lt)=>{const Sn=(r[Ne.id]||[]).sort((Gn,ft)=>Gn[1].sort_order-ft[1].sort_order);return c.jsx(kz,{group:Ne,groupIndex:lt,groupCategories:Sn,sortedGroups:o,categoryGroups:n,categoryBalances:u,loadingBalances:f,dragType:Q,draggedId:H,dragOverId:W,dragOverGroupId:D,editingCategoryId:te,setEditingCategoryId:ie,createForGroupId:ee,setCreateForGroupId:le,editingGroupId:pe,setEditingGroupId:xe,handleCreateCategory:v,handleUpdateCategory:x,handleDeleteCategory:S,handleMoveCategory:E,handleUpdateGroup:I,handleDeleteGroup:j,handleMoveGroup:M,handleCategoryDragStart:P,handleCategoryDragOver:L,handleDragOverGroup:B,handleDragLeave:O,handleDragLeaveGroup:G,handleDragEnd:Y,handleCategoryDrop:U,handleDropOnGroup:F,handleGroupDragStart:K,handleGroupDrop:Z,setDragOverId:A,setDragOverGroupId:N,isMobile:re,categories:e},Ne.id)}),Q==="group"&&o.length>0&&c.jsx($0,{isActive:W==="__end__",onDragOver:Ne=>{Ne.preventDefault(),A("__end__")},onDragLeave:O,onDrop:Ne=>Z(Ne,"__end__"),label:"Move group to end"}),c.jsx(Oz,{ungroupedCategories:(r.ungrouped||[]).sort((Ne,lt)=>Ne[1].sort_order-lt[1].sort_order),categoryGroups:n,categoryBalances:u,loadingBalances:f,dragType:Q,draggedId:H,dragOverId:W,dragOverGroupId:D,editingCategoryId:te,setEditingCategoryId:ie,createForGroupId:ee,setCreateForGroupId:le,handleCreateCategory:v,handleUpdateCategory:x,handleDeleteCategory:S,handleMoveCategory:E,handleCategoryDragStart:P,handleCategoryDragOver:L,handleDragOverGroup:B,handleDragLeaveGroup:G,handleDragLeave:O,handleDragEnd:Y,handleCategoryDrop:U,handleDropOnGroup:F,setDragOverId:A,setDragOverGroupId:N,categories:e,hasGroups:n.length>0})]}),a.length>0&&c.jsx("div",{style:{marginBottom:"2rem"},children:c.jsxs(H0,{title:"Hidden Categories",count:a.length,children:[c.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[c.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[c.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),c.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:a.map(([Ne,lt])=>te===Ne?c.jsx(zu,{initialData:{name:lt.name,description:lt.description,category_group_id:lt.category_group_id,default_monthly_amount:lt.default_monthly_amount,default_monthly_type:lt.default_monthly_type,is_hidden:lt.is_hidden},onSubmit:Sn=>{x(Ne,Sn),ie(null)},onCancel:()=>ie(null),submitLabel:"Save",categoryGroups:n,showGroupSelector:!0},Ne):c.jsxs("div",{onClick:()=>ie(Ne),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[c.jsx("span",{children:lt.name}),c.jsx("span",{style:{color:jt(lt.balance),fontWeight:500},children:$e(lt.balance)})]},Ne))})]})}),ve?c.jsx(yA,{onSubmit:Ne=>{T(Ne),J(!1)},onCancel:()=>J(!1),submitLabel:"Create Group"}):c.jsx(Ie,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>J(!0),children:"+ Add Category Group"})]})}function Pz(){const{currentUserId:t}=zt(),{budget:e,budgetUserIds:n,acceptedUserIds:r,inviteUser:a,revokeUser:o}=kn(),[u,h]=C.useState(""),[f,m]=C.useState(!1),[g,_]=C.useState(null),[v,x]=C.useState(null);if(!e)return c.jsx("p",{children:"No budget found."});async function S(j){if(j.preventDefault(),!(!u.trim()||!e)){m(!0),_(null),x(null);try{await a(u.trim()),h(""),x("Invite sent! The user can now accept the invitation from their account.")}catch(M){_(M instanceof Error?M.message:"Failed to invite user")}finally{m(!1)}}}async function E(j){if(!e)return;if(j===e.owner_id){_("Cannot revoke the budget owner");return}if(j===t){_("Cannot revoke yourself from the budget");return}const M=r.includes(j);if(confirm(M?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){_(null),x(null);try{await o(j),x(M?"User access revoked.":"Invitation cancelled.")}catch(H){_(H instanceof Error?H.message:"Failed to revoke user")}}}const T=n.filter(j=>r.includes(j)),I=n.filter(j=>!r.includes(j));return c.jsxs("div",{children:[c.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),c.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),g&&c.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:g}),c.jsx("button",{onClick:()=>_(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),v&&c.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:v}),c.jsx("button",{onClick:()=>x(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",T.length,")"]}),T.length===0?c.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:T.map(j=>{const M=j===e.owner_id,Q=j===t;return c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[c.jsx("div",{style:{flex:1,minWidth:0},children:c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:j}),M&&c.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),Q&&c.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!M&&!Q&&c.jsx("button",{onClick:()=>E(j),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},j)})})]}),I.length>0&&c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[c.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",I.length,")"]}),c.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:I.map(j=>c.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[c.jsx("div",{style:{flex:1,minWidth:0},children:c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[c.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:j}),c.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),c.jsx("button",{onClick:()=>E(j),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},j))})]}),c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[c.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),c.jsxs("form",{onSubmit:S,style:{display:"flex",gap:"0.75rem"},children:[c.jsx("input",{type:"text",value:u,onChange:j=>h(j.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),c.jsx("button",{type:"submit",disabled:f||!u.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:f||!u.trim()?"not-allowed":"pointer",fontWeight:500,opacity:f||!u.trim()?.7:1,whiteSpace:"nowrap"},children:f?"Inviting...":"Send Invite"})]}),c.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),c.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:e.id})]})]})}const Bz=["budget","feedback","migration","tests"];function Lz(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:a}=zt();C.useLayoutEffect(()=>{a("Budget Admin")},[a]);const o=Un(),u=o.pathname==="/budget/admin",h=C.useMemo(()=>{const _=o.pathname;return _.includes("/admin/budget")?"budget":_.includes("/admin/feedback")?"feedback":_.includes("/admin/migration")?"migration":_.includes("/admin/tests")?"tests":"budget"},[o.pathname]),f=h==="tests";C.useEffect(()=>{u||r(h)},[h,u,r]);function m(){return!Bz.includes(n)||n==="tests"&&!e?"budget":n}const g=C.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return t?!e&&f?c.jsxs("div",{children:[c.jsx("h1",{children:"Access Denied"}),c.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),c.jsx("p",{style:{marginTop:"1rem"},children:c.jsx(Ft,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):c.jsxs("div",{children:[c.jsx(Lf,{mode:"link",linkPrefix:"/budget/admin",tabs:g,activeTab:h}),u?c.jsx(zf,{to:`/budget/admin/${m()}`,replace:!0}):c.jsx(Ff,{})]}):c.jsxs("div",{children:[c.jsx("h1",{children:"Access Denied"}),c.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),c.jsx("p",{style:{marginTop:"1rem"},children:c.jsx(Ft,{to:"/budget",children:"Go to Budget "})})]})}function Uz(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{isAdmin:n}=zt(),{budget:r,accounts:a,accountGroups:o,categories:u,categoryGroups:h,isOwner:f,isLoading:m}=kn();return C.useEffect(()=>(m?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[m,t,e]),m?null:r?c.jsxs("div",{children:[c.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),c.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),c.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""}),c.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),c.jsx("strong",{children:r.name})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""}),c.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),c.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""}),c.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),c.jsx("strong",{children:r.owner_email||r.owner_id})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[c.jsx("span",{children:""}),c.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),c.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",c.jsxs("span",{style:{opacity:.7},children:["  ",f?"You are the owner":"Shared with you"]})]})]})]})}),n&&c.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[c.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),c.jsx("button",{onClick:()=>{const g={...r,accounts:a,account_groups:o,categories:u,category_groups:h,_meta:{downloaded_at:new Date().toISOString()}},_=new Blob([JSON.stringify(g,null,2)],{type:"application/json"}),v=URL.createObjectURL(_),x=document.createElement("a");x.href=v,x.download=`budget_${r.id}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(v)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):c.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function eE({selectedType:t,onSelect:e}){return c.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=Dy[n],a=t==="feature"?"new_feature":t,o=a===n||!a&&n==="bug";return c.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&c.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function zz(){const[t,e]=C.useState(null),[n,r]=C.useState(null),[a,o]=C.useState(null),[u,h]=C.useState(!1),[f,m]=C.useState(""),[g,_]=C.useState("bug"),[v,x]=C.useState(null),[S,E]=C.useState(null),T=C.useContext(sd),j=Sa().get_current_firebase_user(),M=B4(),{submitFeedback:Q}=oA(),{toggleFeedback:H}=V6(),{updateSortOrder:W}=H6(),D=M.data?.items||[],{addLoadingHold:A,removeLoadingHold:N}=sr();C.useEffect(()=>(M.isLoading?A("settings-feedback","Loading feedback..."):N("settings-feedback"),()=>N("settings-feedback")),[M.isLoading,A,N]);function P(q){q.preventDefault(),!(!f.trim()||!T.username||!j)&&(Q.mutate({userId:j.uid,userEmail:T.username,text:f.trim(),feedbackType:g,currentPath:"/settings/feedback"}),m(""),_("bug"),h(!1))}function L(q){q.is_done?B(q):x(q)}async function B(q){try{await H.mutateAsync({item:q})}catch(te){e(te instanceof Error?te.message:"Failed to update feedback")}}function O(){v&&(B(v),x(null))}async function G(q){if(S){try{const ie=D.filter(ee=>ee.doc_id===S.doc_id).map(ee=>({id:ee.id,text:ee.text,created_at:ee.created_at,is_done:ee.is_done,completed_at:ee.completed_at,sort_order:ee.sort_order,feedback_type:ee.id===S.id?q:ee.feedback_type}));await W.mutateAsync({docId:S.doc_id,items:ie})}catch(te){e(te instanceof Error?te.message:"Failed to update feedback type")}E(null)}}const Y=D.filter(q=>!q.is_done).sort((q,te)=>q.sort_order-te.sort_order),U=D.filter(q=>q.is_done).sort((q,te)=>new Date(te.completed_at||0).getTime()-new Date(q.completed_at||0).getTime());function F(q,te){r(te),q.dataTransfer.effectAllowed="move"}function K(q,te){q.preventDefault(),te!==n&&o(te)}function Z(){o(null)}function re(){r(null),o(null)}async function z(q,te){if(q.preventDefault(),!n||n===te){re();return}const ie=Y.findIndex(ve=>ve.id===n),ee=[...Y],[le]=ee.splice(ie,1);if(te==="__end__")ee.push(le);else{const ve=ee.findIndex(J=>J.id===te);ee.splice(ve,0,le)}const pe=ee.map((ve,J)=>({...ve,sort_order:J}));re();const xe=new Map;for(const ve of pe)xe.has(ve.doc_id)||xe.set(ve.doc_id,[]),xe.get(ve.doc_id).push({id:ve.id,text:ve.text,created_at:ve.created_at,is_done:ve.is_done,completed_at:ve.completed_at,sort_order:ve.sort_order,feedback_type:ve.feedback_type});for(const ve of U)xe.has(ve.doc_id)||xe.set(ve.doc_id,[]),xe.get(ve.doc_id).push({id:ve.id,text:ve.text,created_at:ve.created_at,is_done:ve.is_done,completed_at:ve.completed_at,sort_order:ve.sort_order,feedback_type:ve.feedback_type});try{for(const[ve,J]of xe)await W.mutateAsync({docId:ve,items:J})}catch(ve){e(ve instanceof Error?ve.message:"Failed to save order")}}return M.isLoading?null:c.jsxs("div",{children:[c.jsx("h2",{style:{marginTop:0},children:"Feedback"}),c.jsx("p",{style:{...XT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."}),t&&c.jsx(jo,{message:t,onDismiss:()=>e(null)}),c.jsxs("div",{style:Vl,children:[Y.length===0&&!u&&c.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),Y.map(q=>c.jsx(D6,{item:q,isDragging:n===q.id,isDragOver:a===q.id,onDragStart:te=>F(te,q.id),onDragOver:te=>K(te,q.id),onDragLeave:Z,onDragEnd:re,onDrop:te=>z(te,q.id),onToggleDone:()=>L(q),onTypeClick:()=>E(q)},q.id)),n&&Y.length>0&&c.jsx($0,{isActive:a==="__end__",onDragOver:q=>K(q,"__end__"),onDragLeave:Z,onDrop:q=>z(q,"__end__")})]}),u?c.jsxs(mi,{actionName:"Add Feedback",onSubmit:P,children:[c.jsx(eE,{selectedType:g,onSelect:_}),c.jsx(V0,{value:f,onChange:q=>m(q.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),c.jsxs(Aa,{children:[c.jsx(Ie,{type:"submit",actionName:"Add Feedback",disabled:!f.trim(),children:"Add Feedback"}),c.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{h(!1),m(""),_("bug")},children:"Cancel"})]})]}):c.jsx(Ie,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>h(!0),children:"+ Add Feedback"}),U.length>0&&c.jsx(H0,{title:"Completed",count:U.length,children:c.jsx("div",{style:{...Vl,marginTop:"0.5rem"},children:U.map(q=>c.jsx(M6,{item:q,onToggleDone:()=>L(q),onTypeClick:()=>E(q)},q.id))})}),c.jsxs(Bs,{isOpen:v!==null,onClose:()=>x(null),title:"Mark as Complete",children:[c.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),v&&c.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',v.text,'"']}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>x(null),children:"Cancel"}),c.jsx(Ie,{variant:"primary",actionName:"Confirm Mark Complete",onClick:O,children:"Mark Complete"})]})]}),c.jsxs(Bs,{isOpen:S!==null,onClose:()=>E(null),title:"Change Feedback Type",children:[c.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),c.jsx(eE,{selectedType:S?.feedback_type||"bug",onSelect:G}),c.jsx(Ie,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>E(null),style:{width:"100%"},children:"Cancel"})]})]})}function Fz(){try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")}catch{}window.location.reload()}function Vz(){const e=Sa().get_current_firebase_user(),[n,r]=C.useState(!1),a=lL({currentUser:e}),o=uL({currentUser:e}),u=hL({currentUser:e}),h=fL({currentUser:e}),f=_L({currentUser:e}),m=RL({currentUser:e}),g=CL({currentUser:e}),_=NL({currentUser:e}),v=qL({currentUser:e}),x=KL({currentUser:e}),S=JL({currentUser:e}),E=t6(),T=a.isScanning||o.isScanning||u.isScanning||h.isScanning||f.isScanning||g.isScanning||m.isScanning||_.isScanning||x.isScanning,I=a.isRunning||o.isMigratingFeedback||u.isDeleting||h.isDeleting||f.isRunning||g.isRunning||m.isRunning||_.isRunning||x.isRunning,j=async()=>{await Promise.all([a.scanStatus(),o.scanStatus(),u.scanStatus(),h.scanStatus(),f.scan(),m.scanStatus(),g.scanStatus(),_.scanStatus(),x.scanStatus()])};return c.jsxs("div",{children:[c.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[c.jsx("h2",{style:{margin:0},children:"Data Migrations"}),c.jsxs("button",{onClick:j,disabled:T||I,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:T||I?"not-allowed":"pointer",fontWeight:500,opacity:T||I?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[c.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:T?c.jsx(va,{noMargin:!0}):""}),"Refresh All"]})]}),c.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),c.jsx(mU,{hasData:!!v.status,status:v.status,report:v.report,hasViolations:v.hasViolations,violationCount:v.violationCount,isScanning:v.isScanning,onScan:v.scan,disabled:!e}),c.jsx(pU,{hasData:!!x.status,status:x.status,needsMigration:x.needsMigration,totalItemsToFix:x.totalItemsToFix,isRunning:x.isRunning,result:x.result,onRunMigration:x.runMigration,onRefresh:x.scanStatus,isRefreshing:x.isScanning,disabled:!e}),c.jsx(hU,{hasData:!!m.status,status:m.status,hasItemsToFix:m.hasItemsToFix,isRunning:m.isRunning,result:m.result,onRunMigration:m.runMigration,onRefresh:m.scanStatus,isRefreshing:m.isScanning,disabled:!e}),c.jsx(dU,{hasData:!!g.status,status:g.status,hasItemsToMigrate:g.hasItemsToMigrate,isRunning:g.isRunning,result:g.result,onRunMigration:g.runMigration,onRefresh:g.scanStatus,isRefreshing:g.isScanning,disabled:!e}),c.jsx(fU,{hasData:!!_.status,status:_.status,hasPairsToConvert:_.hasPairsToConvert,isRunning:_.isRunning,result:_.result,onRunMigration:_.runMigration,onRefresh:_.scanStatus,isRefreshing:_.isScanning,disabled:!e}),c.jsx(uU,{hasData:f.hasData,status:f.status,hasIssues:f.hasIssues,totalIssues:f.totalIssues,isRunning:f.isRunning,result:f.result,onRunCleanup:f.runCleanup,onRefresh:f.scan,isRefreshing:f.isScanning,disabled:!e}),c.jsx(O6,{hasData:!!a.status,status:a.status,hasIssues:a.hasIssues,totalIssues:a.totalIssues,isRunning:a.isRunning,result:a.result,onRunCleanup:a.runCleanup,onRefresh:a.scanStatus,isRefreshing:a.isScanning,disabled:!e}),c.jsx(N6,{hasData:!!o.status,status:o.status,isMigrating:o.isMigratingFeedback,onMigrate:o.migrateFeedbackDocuments,onRefresh:o.scanStatus,isRefreshing:o.isScanning,disabled:!e,migrationResult:o.feedbackMigrationResult}),c.jsx(eU,{hasData:!!u.status,monthsCount:u.status?.monthsCount??0,budgetCount:u.status?.budgetCount??0,monthsToDelete:u.status?.monthsToDelete??[],isDeleting:u.isDeleting,onDelete:u.deleteAllMonths,onRefresh:u.scanStatus,isRefreshing:u.isScanning,disabled:!e,deleteResult:u.deleteResult,deleteProgress:u.deleteProgress}),c.jsx(nU,{hasData:!!h.status,status:h.status,isDeleting:h.isDeleting,onDelete:h.deleteSampleUserBudget,onRefresh:h.scanStatus,isRefreshing:h.isScanning,disabled:!e,deleteResult:h.deleteResult,deleteProgress:h.deleteProgress}),c.jsx(cU,{disabled:!e}),c.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem",border:"1px solid color-mix(in srgb, #17a2b8 30%, transparent)"},children:c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("h3",{style:{margin:"0 0 0.25rem 0",fontSize:"1rem",color:"#17a2b8"},children:" Diagnostic Download"}),c.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Downloads all budget and month data as JSON for troubleshooting balance discrepancies. Includes stored vs calculated balances, transfers, adjustments, and full month breakdowns."}),S.error&&c.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem",color:"#dc3545"},children:["Error: ",S.error]}),S.progress&&c.jsxs("div",{style:{marginTop:"0.5rem"},children:[c.jsx("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:c.jsx("div",{style:{background:"#17a2b8",height:"100%",width:`${S.progress.percentComplete}%`,transition:"width 0.3s"}})}),c.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.7},children:[S.progress.phase==="reading"&&"Reading data from Firestore...",S.progress.phase==="analyzing"&&`Analyzing budget ${S.progress.current}/${S.progress.total}...`,S.progress.phase==="complete"&&"Download complete!"]})]})]}),c.jsx(Ie,{variant:"secondary",actionName:"Download Diagnostics",onClick:S.downloadDiagnostics,disabled:!e||S.isDownloading,style:{flexShrink:0},children:S.isDownloading?c.jsxs(c.Fragment,{children:[c.jsx(va,{noMargin:!0})," Downloading..."]}):" Download JSON"})]})}),c.jsx(gU,{status:E.status,result:E.result,isScanning:E.isScanning,isRunning:E.isRunning,onScan:E.scan,onRun:E.run,disabled:!e}),c.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:c.jsxs("p",{style:{margin:0,opacity:.7},children:[c.jsx("strong",{children:"Note:"})," These migrations will process ",c.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),c.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, #ff6b6b 10%, transparent)",borderRadius:"8px",border:"1px solid color-mix(in srgb, #ff6b6b 30%, transparent)"},children:[c.jsxs("p",{style:{margin:"0 0 0.75rem 0",fontSize:"0.9rem"},children:[c.jsx("strong",{children:" Clear All Caches"}),c.jsx("span",{style:{opacity:.7,display:"block",marginTop:"0.25rem"},children:"If you're seeing stale data after running migrations, clear all cached data and reload to fetch fresh data from Firestore."})]}),c.jsx(Ie,{variant:"danger",actionName:"Open Clear Caches Modal",onClick:()=>r(!0),style:{display:"flex",alignItems:"center",gap:"0.4rem"},children:" Clear All Caches & Reload"})]}),c.jsxs(Bs,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[c.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data from localStorage and reload the page. The app will fetch fresh data from Firestore for everything."}),c.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[c.jsx(Ie,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),c.jsx(Ie,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:Fz,children:"Clear & Reload"})]})]})]})}function vl({name:t,description:e,expectedBehavior:n,result:r,onRun:a,disabled:o,expectedToSucceed:u}){const h=r?.status==="passed"?ae.success:r?.status==="failed"?ae.danger:r?.status==="running"?ae.warning:"inherit";return c.jsxs("div",{style:{...ad,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),c.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),c.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:u?ae.success:ae.warning},children:["Expected: ",n]})]}),c.jsx(Ie,{onClick:a,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&c.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${h} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${h} 30%, transparent)`,fontSize:"0.85rem",color:h},children:r.message})]})}function $z({totalCount:t,passedCount:e,failedCount:n}){return c.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[c.jsxs("span",{children:["Total: ",c.jsx("strong",{children:t})]}),c.jsxs("span",{style:{color:ae.success},children:["Passed: ",c.jsx("strong",{children:e})]}),c.jsxs("span",{style:{color:ae.danger},children:["Failed: ",c.jsx("strong",{children:n})]})]})}const tE=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function Hz(){const{currentUserId:t}=zt(),[e,n]=C.useState([]),[r,a]=C.useState(!1);function o(x,S){n(E=>E.map(T=>T.name===x?{...T,...S}:T))}async function u(x,S,E){o(x,{status:"running",message:"Running..."});try{const T=await S();E?o(x,{status:"failed",message:` ${T}`}):o(x,{status:"passed",message:` ${T}`})}catch(T){const I=T instanceof Error?T.message:"Unknown error";E?o(x,{status:"passed",message:` Blocked as expected: ${I}`}):o(x,{status:"failed",message:` ${I}`})}}async function h(){a(!0),n(tE.map(x=>({...x,status:"pending",message:""})));for(const x of tE)await f(x.name);a(!1)}async function f(x){switch(x){case"Read unauthorized budget":await u(x,async()=>(await et("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await u(x,async()=>(await et("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await u(x,async()=>(await et("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await u(x,async()=>{if(!t)throw new Error("Not authenticated");const{data:S}=await et("users",t,"security test: reading own user to get current is_admin value"),E=S?.permission_flags?.is_admin??!1;return await zl("users",t,{"permission_flags.is_admin":!E},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${E} to ${!E} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await u(x,async()=>{if(!t)throw new Error("Not authenticated");const{data:S}=await et("users",t,"security test: reading own user to get current is_test value"),E=S?.permission_flags?.is_test??!1;return await zl("users",t,{"permission_flags.is_test":!E},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${E} to ${!E} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await u(x,async()=>{if(!t)throw new Error("Not authenticated");const{exists:S}=await et("users",t,"security test: reading own user document (should succeed)");if(S)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function m(x){e.find(E=>E.name===x)||n(E=>[...E,{name:x,status:"pending",message:"",expectedToFail:!0}]),a(!0),await f(x),a(!1)}const g=e.filter(x=>x.status==="passed").length,_=e.filter(x=>x.status==="failed").length,v=e.length;return c.jsxs("div",{children:[c.jsx("p",{style:XT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),c.jsx("div",{style:{marginBottom:"1.5rem"},children:c.jsx(Ie,{onClick:h,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&c.jsx($z,{totalCount:v,passedCount:g,failedCount:_}),c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[c.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),c.jsx(vl,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(x=>x.name==="Read unauthorized budget"),onRun:()=>m("Read unauthorized budget"),disabled:r}),c.jsx(vl,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(x=>x.name==="Read another user's document"),onRun:()=>m("Read another user's document"),disabled:r}),c.jsx(vl,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(x=>x.name==="Read unauthorized budget month"),onRun:()=>m("Read unauthorized budget month"),disabled:r}),c.jsx(vl,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(x=>x.name==="Toggle is_admin in own permission_flags"),onRun:()=>m("Toggle is_admin in own permission_flags"),disabled:r}),c.jsx(vl,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(x=>x.name==="Toggle is_test in own permission_flags"),onRun:()=>m("Toggle is_test in own permission_flags"),disabled:r}),c.jsx(vl,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(x=>x.name==="Read own user document"),onRun:()=>m("Read own user document"),disabled:r,expectedToSucceed:!0})]}),_>0&&c.jsxs(jo,{style:{marginTop:"1.5rem"},children:[" ",_," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function qz({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=sr(),r=C.useContext(sd),a=Un();return C.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?c.jsx(c.Fragment,{children:t}):c.jsx(Ff,{}):c.jsx(zf,{to:"/account",state:{from:a.pathname},replace:!0}):null}function Gz(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{isInitialized:n,pageTitle:r}=zt(),{isLoading:a,error:o}=kn();return C.useEffect(()=>{n?e("budget-init"):t("budget-init",a?"Fetching data from server...":"Loading budget...")},[n,a,t,e]),C.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),c.jsx("div",{style:Pf,children:c.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",o.message]})})):c.jsx("div",{style:{...Pf,paddingBottom:"5rem"},children:c.jsxs(cA,{children:[c.jsx(Z6,{title:r}),n&&c.jsx(Ff,{})]})})}const Qz={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function Wz(){const{isLoading:t,loadingMessage:e}=sr();return t?c.jsx(ac,{message:e}):null}function Kz(){const[t,e]=C.useState(Qz),n=Sa(),r=C.useRef(!1),{addLoadingHold:a,removeLoadingHold:o}=sr();return C.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(u=>{e({is_logged_in:u!=null,is_auth_checked:!0,username:u?.email??"",set_user_context:e})}))},[n]),C.useEffect(()=>{t.is_auth_checked?o("auth"):a("auth","Authenticating...")},[t.is_auth_checked,a,o]),t.is_auth_checked?c.jsx(sd.Provider,{value:t,children:c.jsx(Fk,{children:c.jsx(AB,{children:c.jsx(tL,{children:c.jsxs(II,{children:[c.jsxs(iI,{children:[c.jsx(fn,{path:"/",element:c.jsx(_U,{})}),c.jsx(fn,{path:"/account",element:c.jsx(bU,{})}),c.jsx(fn,{path:"/budget",element:c.jsx(qz,{}),children:c.jsxs(fn,{element:c.jsx(Gz,{}),children:[c.jsx(fn,{index:!0,element:c.jsx(Jw,{})}),c.jsx(fn,{path:":year/:month/:tab/:view?",element:c.jsx(Jw,{})}),c.jsx(fn,{path:"analytics",element:c.jsx(yz,{})}),c.jsx(fn,{path:"my-budgets",element:c.jsx(Sz,{})}),c.jsxs(fn,{path:"settings",element:c.jsx(Ez,{}),children:[c.jsx(fn,{index:!0,element:c.jsx(zf,{to:"categories",replace:!0})}),c.jsx(fn,{path:"accounts",element:c.jsx(Dz,{})}),c.jsx(fn,{path:"categories",element:c.jsx(Nz,{})}),c.jsx(fn,{path:"users",element:c.jsx(Pz,{})})]}),c.jsxs(fn,{path:"admin",element:c.jsx(Lz,{}),children:[c.jsx(fn,{path:"budget",element:c.jsx(Uz,{})}),c.jsx(fn,{path:"feedback",element:c.jsx(zz,{})}),c.jsx(fn,{path:"migration",element:c.jsx(Vz,{})}),c.jsx(fn,{path:"tests",element:c.jsx(Hz,{})})]})]})})]}),c.jsx(Y6,{}),c.jsx(Q6,{}),c.jsx(yU,{})]})})})})}):null}function Yz(){return c.jsxs(FI,{children:[c.jsx(Wz,{}),c.jsx(Kz,{})]})}iR.createRoot(document.getElementById("root")).render(c.jsx(C.StrictMode,{children:c.jsx(Yz,{})}));
