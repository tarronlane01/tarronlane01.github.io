(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Gh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var jg={exports:{}},Cu={};var kx;function tR(){if(kx)return Cu;kx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,o){var l=null;if(o!==void 0&&(l=""+o),i.key!==void 0&&(l=""+i.key),"key"in i){o={};for(var u in i)u!=="key"&&(o[u]=i[u])}else o=i;return i=o.ref,{$$typeof:t,type:r,key:l,ref:i!==void 0?i:null,props:o}}return Cu.Fragment=e,Cu.jsx=n,Cu.jsxs=n,Cu}var Mx;function nR(){return Mx||(Mx=1,jg.exports=tR()),jg.exports}var d=nR(),Rg={exports:{}},nt={};var Ox;function rR(){if(Ox)return nt;Ox=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),b=Symbol.iterator;function _(N){return N===null||typeof N!="object"?null:(N=b&&N[b]||N["@@iterator"],typeof N=="function"?N:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function C(N,q,J){this.props=N,this.context=q,this.refs=S,this.updater=J||w}C.prototype.isReactComponent={},C.prototype.setState=function(N,q){if(typeof N!="object"&&typeof N!="function"&&N!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,N,q,"setState")},C.prototype.forceUpdate=function(N){this.updater.enqueueForceUpdate(this,N,"forceUpdate")};function T(){}T.prototype=C.prototype;function I(N,q,J){this.props=N,this.context=q,this.refs=S,this.updater=J||w}var M=I.prototype=new T;M.constructor=I,x(M,C.prototype),M.isPureReactComponent=!0;var F=Array.isArray;function G(){}var D={H:null,A:null,T:null,S:null},O=Object.prototype.hasOwnProperty;function P(N,q,J){var ne=J.ref;return{$$typeof:t,type:N,key:q,ref:ne!==void 0?ne:null,props:J}}function $(N,q){return P(N.type,q,N.props)}function V(N){return typeof N=="object"&&N!==null&&N.$$typeof===t}function j(N){var q={"=":"=0",":":"=2"};return"$"+N.replace(/[=:]/g,function(J){return q[J]})}var B=/\/+/g;function k(N,q){return typeof N=="object"&&N!==null&&N.key!=null?j(""+N.key):q.toString(36)}function Y(N){switch(N.status){case"fulfilled":return N.value;case"rejected":throw N.reason;default:switch(typeof N.status=="string"?N.then(G,G):(N.status="pending",N.then(function(q){N.status==="pending"&&(N.status="fulfilled",N.value=q)},function(q){N.status==="pending"&&(N.status="rejected",N.reason=q)})),N.status){case"fulfilled":return N.value;case"rejected":throw N.reason}}throw N}function X(N,q,J,ne,ae){var Ee=typeof N;(Ee==="undefined"||Ee==="boolean")&&(N=null);var Ae=!1;if(N===null)Ae=!0;else switch(Ee){case"bigint":case"string":case"number":Ae=!0;break;case"object":switch(N.$$typeof){case t:case e:Ae=!0;break;case p:return Ae=N._init,X(Ae(N._payload),q,J,ne,ae)}}if(Ae)return ae=ae(N),Ae=ne===""?"."+k(N,0):ne,F(ae)?(J="",Ae!=null&&(J=Ae.replace(B,"$&/")+"/"),X(ae,q,J,"",function(Oe){return Oe})):ae!=null&&(V(ae)&&(ae=$(ae,J+(ae.key==null||N&&N.key===ae.key?"":(""+ae.key).replace(B,"$&/")+"/")+Ae)),q.push(ae)),1;Ae=0;var ce=ne===""?".":ne+":";if(F(N))for(var fe=0;fe<N.length;fe++)ne=N[fe],Ee=ce+k(ne,fe),Ae+=X(ne,q,J,Ee,ae);else if(fe=_(N),typeof fe=="function")for(N=fe.call(N),fe=0;!(ne=N.next()).done;)ne=ne.value,Ee=ce+k(ne,fe++),Ae+=X(ne,q,J,Ee,ae);else if(Ee==="object"){if(typeof N.then=="function")return X(Y(N),q,J,ne,ae);throw q=String(N),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(N).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return Ae}function W(N,q,J){if(N==null)return N;var ne=[],ae=0;return X(N,ne,"","",function(Ee){return q.call(J,Ee,ae++)}),ne}function te(N){if(N._status===-1){var q=N._result;q=q(),q.then(function(J){(N._status===0||N._status===-1)&&(N._status=1,N._result=J)},function(J){(N._status===0||N._status===-1)&&(N._status=2,N._result=J)}),N._status===-1&&(N._status=0,N._result=q)}if(N._status===1)return N._result.default;throw N._result}var H=typeof reportError=="function"?reportError:function(N){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof N=="object"&&N!==null&&typeof N.message=="string"?String(N.message):String(N),error:N});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",N);return}console.error(N)},re={map:W,forEach:function(N,q,J){W(N,function(){q.apply(this,arguments)},J)},count:function(N){var q=0;return W(N,function(){q++}),q},toArray:function(N){return W(N,function(q){return q})||[]},only:function(N){if(!V(N))throw Error("React.Children.only expected to receive a single React element child.");return N}};return nt.Activity=g,nt.Children=re,nt.Component=C,nt.Fragment=n,nt.Profiler=i,nt.PureComponent=I,nt.StrictMode=r,nt.Suspense=h,nt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,nt.__COMPILER_RUNTIME={__proto__:null,c:function(N){return D.H.useMemoCache(N)}},nt.cache=function(N){return function(){return N.apply(null,arguments)}},nt.cacheSignal=function(){return null},nt.cloneElement=function(N,q,J){if(N==null)throw Error("The argument must be a React element, but you passed "+N+".");var ne=x({},N.props),ae=N.key;if(q!=null)for(Ee in q.key!==void 0&&(ae=""+q.key),q)!O.call(q,Ee)||Ee==="key"||Ee==="__self"||Ee==="__source"||Ee==="ref"&&q.ref===void 0||(ne[Ee]=q[Ee]);var Ee=arguments.length-2;if(Ee===1)ne.children=J;else if(1<Ee){for(var Ae=Array(Ee),ce=0;ce<Ee;ce++)Ae[ce]=arguments[ce+2];ne.children=Ae}return P(N.type,ae,ne)},nt.createContext=function(N){return N={$$typeof:l,_currentValue:N,_currentValue2:N,_threadCount:0,Provider:null,Consumer:null},N.Provider=N,N.Consumer={$$typeof:o,_context:N},N},nt.createElement=function(N,q,J){var ne,ae={},Ee=null;if(q!=null)for(ne in q.key!==void 0&&(Ee=""+q.key),q)O.call(q,ne)&&ne!=="key"&&ne!=="__self"&&ne!=="__source"&&(ae[ne]=q[ne]);var Ae=arguments.length-2;if(Ae===1)ae.children=J;else if(1<Ae){for(var ce=Array(Ae),fe=0;fe<Ae;fe++)ce[fe]=arguments[fe+2];ae.children=ce}if(N&&N.defaultProps)for(ne in Ae=N.defaultProps,Ae)ae[ne]===void 0&&(ae[ne]=Ae[ne]);return P(N,Ee,ae)},nt.createRef=function(){return{current:null}},nt.forwardRef=function(N){return{$$typeof:u,render:N}},nt.isValidElement=V,nt.lazy=function(N){return{$$typeof:p,_payload:{_status:-1,_result:N},_init:te}},nt.memo=function(N,q){return{$$typeof:f,type:N,compare:q===void 0?null:q}},nt.startTransition=function(N){var q=D.T,J={};D.T=J;try{var ne=N(),ae=D.S;ae!==null&&ae(J,ne),typeof ne=="object"&&ne!==null&&typeof ne.then=="function"&&ne.then(G,H)}catch(Ee){H(Ee)}finally{q!==null&&J.types!==null&&(q.types=J.types),D.T=q}},nt.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},nt.use=function(N){return D.H.use(N)},nt.useActionState=function(N,q,J){return D.H.useActionState(N,q,J)},nt.useCallback=function(N,q){return D.H.useCallback(N,q)},nt.useContext=function(N){return D.H.useContext(N)},nt.useDebugValue=function(){},nt.useDeferredValue=function(N,q){return D.H.useDeferredValue(N,q)},nt.useEffect=function(N,q){return D.H.useEffect(N,q)},nt.useEffectEvent=function(N){return D.H.useEffectEvent(N)},nt.useId=function(){return D.H.useId()},nt.useImperativeHandle=function(N,q,J){return D.H.useImperativeHandle(N,q,J)},nt.useInsertionEffect=function(N,q){return D.H.useInsertionEffect(N,q)},nt.useLayoutEffect=function(N,q){return D.H.useLayoutEffect(N,q)},nt.useMemo=function(N,q){return D.H.useMemo(N,q)},nt.useOptimistic=function(N,q){return D.H.useOptimistic(N,q)},nt.useReducer=function(N,q,J){return D.H.useReducer(N,q,J)},nt.useRef=function(N){return D.H.useRef(N)},nt.useState=function(N){return D.H.useState(N)},nt.useSyncExternalStore=function(N,q,J){return D.H.useSyncExternalStore(N,q,J)},nt.useTransition=function(){return D.H.useTransition()},nt.version="19.2.3",nt}var Nx;function Vy(){return Nx||(Nx=1,Rg.exports=rR()),Rg.exports}var R=Vy(),Ig={exports:{}},Tu={},Dg={exports:{}},kg={};var Px;function sR(){return Px||(Px=1,(function(t){function e(X,W){var te=X.length;X.push(W);e:for(;0<te;){var H=te-1>>>1,re=X[H];if(0<i(re,W))X[H]=W,X[te]=re,te=H;else break e}}function n(X){return X.length===0?null:X[0]}function r(X){if(X.length===0)return null;var W=X[0],te=X.pop();if(te!==W){X[0]=te;e:for(var H=0,re=X.length,N=re>>>1;H<N;){var q=2*(H+1)-1,J=X[q],ne=q+1,ae=X[ne];if(0>i(J,te))ne<re&&0>i(ae,J)?(X[H]=ae,X[ne]=te,H=ne):(X[H]=J,X[q]=te,H=q);else if(ne<re&&0>i(ae,te))X[H]=ae,X[ne]=te,H=ne;else break e}}return W}function i(X,W){var te=X.sortIndex-W.sortIndex;return te!==0?te:X.id-W.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,u=l.now();t.unstable_now=function(){return l.now()-u}}var h=[],f=[],p=1,g=null,b=3,_=!1,w=!1,x=!1,S=!1,C=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function M(X){for(var W=n(f);W!==null;){if(W.callback===null)r(f);else if(W.startTime<=X)r(f),W.sortIndex=W.expirationTime,e(h,W);else break;W=n(f)}}function F(X){if(x=!1,M(X),!w)if(n(h)!==null)w=!0,G||(G=!0,j());else{var W=n(f);W!==null&&Y(F,W.startTime-X)}}var G=!1,D=-1,O=5,P=-1;function $(){return S?!0:!(t.unstable_now()-P<O)}function V(){if(S=!1,G){var X=t.unstable_now();P=X;var W=!0;try{e:{w=!1,x&&(x=!1,T(D),D=-1),_=!0;var te=b;try{t:{for(M(X),g=n(h);g!==null&&!(g.expirationTime>X&&$());){var H=g.callback;if(typeof H=="function"){g.callback=null,b=g.priorityLevel;var re=H(g.expirationTime<=X);if(X=t.unstable_now(),typeof re=="function"){g.callback=re,M(X),W=!0;break t}g===n(h)&&r(h),M(X)}else r(h);g=n(h)}if(g!==null)W=!0;else{var N=n(f);N!==null&&Y(F,N.startTime-X),W=!1}}break e}finally{g=null,b=te,_=!1}W=void 0}}finally{W?j():G=!1}}}var j;if(typeof I=="function")j=function(){I(V)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,k=B.port2;B.port1.onmessage=V,j=function(){k.postMessage(null)}}else j=function(){C(V,0)};function Y(X,W){D=C(function(){X(t.unstable_now())},W)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(X){X.callback=null},t.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<X?Math.floor(1e3/X):5},t.unstable_getCurrentPriorityLevel=function(){return b},t.unstable_next=function(X){switch(b){case 1:case 2:case 3:var W=3;break;default:W=b}var te=b;b=W;try{return X()}finally{b=te}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(X,W){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var te=b;b=X;try{return W()}finally{b=te}},t.unstable_scheduleCallback=function(X,W,te){var H=t.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?H+te:H):te=H,X){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=te+re,X={id:p++,callback:W,priorityLevel:X,startTime:te,expirationTime:re,sortIndex:-1},te>H?(X.sortIndex=te,e(f,X),n(h)===null&&X===n(f)&&(x?(T(D),D=-1):x=!0,Y(F,te-H))):(X.sortIndex=re,e(h,X),w||_||(w=!0,G||(G=!0,j()))),X},t.unstable_shouldYield=$,t.unstable_wrapCallback=function(X){var W=b;return function(){var te=b;b=W;try{return X.apply(this,arguments)}finally{b=te}}}})(kg)),kg}var Bx;function iR(){return Bx||(Bx=1,Dg.exports=sR()),Dg.exports}var Mg={exports:{}},Kn={};var zx;function aR(){if(zx)return Kn;zx=1;var t=Vy();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(h,f,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:f,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Kn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Kn.createPortal=function(h,f){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(h,f,null,p)},Kn.flushSync=function(h){var f=l.T,p=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=f,r.p=p,r.d.f()}},Kn.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,r.d.C(h,f))},Kn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Kn.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var p=f.as,g=u(p,f.crossOrigin),b=typeof f.integrity=="string"?f.integrity:void 0,_=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;p==="style"?r.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:g,integrity:b,fetchPriority:_}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:b,fetchPriority:_,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Kn.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var p=u(f.as,f.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&r.d.M(h)},Kn.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var p=f.as,g=u(p,f.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Kn.preloadModule=function(h,f){if(typeof h=="string")if(f){var p=u(f.as,f.crossOrigin);r.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else r.d.m(h)},Kn.requestFormReset=function(h){r.d.r(h)},Kn.unstable_batchedUpdates=function(h,f){return h(f)},Kn.useFormState=function(h,f,p){return l.H.useFormState(h,f,p)},Kn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Kn.version="19.2.3",Kn}var Lx;function oR(){if(Lx)return Mg.exports;Lx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Mg.exports=aR(),Mg.exports}var Ux;function lR(){if(Ux)return Tu;Ux=1;var t=iR(),e=Vy(),n=oR();function r(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function l(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function u(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function f(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(r(188));return a!==s?null:s}for(var c=s,m=a;;){var v=c.return;if(v===null)break;var E=v.alternate;if(E===null){if(m=v.return,m!==null){c=m;continue}break}if(v.child===E.child){for(E=v.child;E;){if(E===c)return h(v),s;if(E===m)return h(v),a;E=E.sibling}throw Error(r(188))}if(c.return!==m.return)c=v,m=E;else{for(var z=!1,Q=v.child;Q;){if(Q===c){z=!0,c=v,m=E;break}if(Q===m){z=!0,m=v,c=E;break}Q=Q.sibling}if(!z){for(Q=E.child;Q;){if(Q===c){z=!0,c=E,m=v;break}if(Q===m){z=!0,m=E,c=v;break}Q=Q.sibling}if(!z)throw Error(r(189))}}if(c.alternate!==m)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?s:a}function p(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=p(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),I=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),$=Symbol.for("react.memo_cache_sentinel"),V=Symbol.iterator;function j(s){return s===null||typeof s!="object"?null:(s=V&&s[V]||s["@@iterator"],typeof s=="function"?s:null)}var B=Symbol.for("react.client.reference");function k(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===B?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case x:return"Fragment";case C:return"Profiler";case S:return"StrictMode";case F:return"Suspense";case G:return"SuspenseList";case P:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case w:return"Portal";case I:return s.displayName||"Context";case T:return(s._context.displayName||"Context")+".Consumer";case M:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case D:return a=s.displayName||null,a!==null?a:k(s.type)||"Memo";case O:a=s._payload,s=s._init;try{return k(s(a))}catch{}}return null}var Y=Array.isArray,X=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},H=[],re=-1;function N(s){return{current:s}}function q(s){0>re||(s.current=H[re],H[re]=null,re--)}function J(s,a){re++,H[re]=s.current,s.current=a}var ne=N(null),ae=N(null),Ee=N(null),Ae=N(null);function ce(s,a){switch(J(Ee,a),J(ae,s),J(ne,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?tx(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=tx(a),s=nx(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}q(ne),J(ne,s)}function fe(){q(ne),q(ae),q(Ee)}function Oe(s){s.memoizedState!==null&&J(Ae,s);var a=ne.current,c=nx(a,s.type);a!==c&&(J(ae,s),J(ne,c))}function Me(s){ae.current===s&&(q(ne),q(ae)),Ae.current===s&&(q(Ae),xu._currentValue=te)}var Ge,tt;function L(s){if(Ge===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);Ge=a&&a[1]||"",tt=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ge+s+tt}var de=!1;function ye(s,a){if(!s||de)return"";de=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(a){var De=function(){throw Error()};if(Object.defineProperty(De.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(De,[])}catch(ve){var _e=ve}Reflect.construct(s,[],De)}else{try{De.call()}catch(ve){_e=ve}s.call(De.prototype)}}else{try{throw Error()}catch(ve){_e=ve}(De=s())&&typeof De.catch=="function"&&De.catch(function(){})}}catch(ve){if(ve&&_e&&typeof ve.stack=="string")return[ve.stack,_e.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=m.DetermineComponentFrameRoot(),z=E[0],Q=E[1];if(z&&Q){var se=z.split(`
`),pe=Q.split(`
`);for(v=m=0;m<se.length&&!se[m].includes("DetermineComponentFrameRoot");)m++;for(;v<pe.length&&!pe[v].includes("DetermineComponentFrameRoot");)v++;if(m===se.length||v===pe.length)for(m=se.length-1,v=pe.length-1;1<=m&&0<=v&&se[m]!==pe[v];)v--;for(;1<=m&&0<=v;m--,v--)if(se[m]!==pe[v]){if(m!==1||v!==1)do if(m--,v--,0>v||se[m]!==pe[v]){var Ce=`
`+se[m].replace(" at new "," at ");return s.displayName&&Ce.includes("<anonymous>")&&(Ce=Ce.replace("<anonymous>",s.displayName)),Ce}while(1<=m&&0<=v);break}}}finally{de=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?L(c):""}function ee(s,a){switch(s.tag){case 26:case 27:case 5:return L(s.type);case 16:return L("Lazy");case 13:return s.child!==a&&a!==null?L("Suspense Fallback"):L("Suspense");case 19:return L("SuspenseList");case 0:case 15:return ye(s.type,!1);case 11:return ye(s.type.render,!1);case 1:return ye(s.type,!0);case 31:return L("Activity");default:return""}}function Z(s){try{var a="",c=null;do a+=ee(s,c),c=s,s=s.return;while(s);return a}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var oe=Object.prototype.hasOwnProperty,Se=t.unstable_scheduleCallback,xe=t.unstable_cancelCallback,ie=t.unstable_shouldYield,Re=t.unstable_requestPaint,Pe=t.unstable_now,Ne=t.unstable_getCurrentPriorityLevel,qe=t.unstable_ImmediatePriority,xt=t.unstable_UserBlockingPriority,st=t.unstable_NormalPriority,Wn=t.unstable_LowPriority,gs=t.unstable_IdlePriority,nr=t.log,ys=t.unstable_setDisableYieldValue,vt=null,nn=null;function Qn(s){if(typeof nr=="function"&&ys(s),nn&&typeof nn.setStrictMode=="function")try{nn.setStrictMode(vt,s)}catch{}}var Et=Math.clz32?Math.clz32:Xo,Ka=Math.log,Bi=Math.LN2;function Xo(s){return s>>>=0,s===0?32:31-(Ka(s)/Bi|0)|0}var Or=256,_s=262144,Ft=4194304;function rr(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function bs(s,a,c){var m=s.pendingLanes;if(m===0)return 0;var v=0,E=s.suspendedLanes,z=s.pingedLanes;s=s.warmLanes;var Q=m&134217727;return Q!==0?(m=Q&~E,m!==0?v=rr(m):(z&=Q,z!==0?v=rr(z):c||(c=Q&~s,c!==0&&(v=rr(c))))):(Q=m&~E,Q!==0?v=rr(Q):z!==0?v=rr(z):c||(c=m&~s,c!==0&&(v=rr(c)))),v===0?0:a!==0&&a!==v&&(a&E)===0&&(E=v&-v,c=a&-a,E>=c||E===32&&(c&4194048)!==0)?a:v}function Zr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function km(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Sd(){var s=Ft;return Ft<<=1,(Ft&62914560)===0&&(Ft=4194304),s}function vs(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function Ya(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Mm(s,a,c,m,v,E){var z=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var Q=s.entanglements,se=s.expirationTimes,pe=s.hiddenUpdates;for(c=z&~c;0<c;){var Ce=31-Et(c),De=1<<Ce;Q[Ce]=0,se[Ce]=-1;var _e=pe[Ce];if(_e!==null)for(pe[Ce]=null,Ce=0;Ce<_e.length;Ce++){var ve=_e[Ce];ve!==null&&(ve.lane&=-536870913)}c&=~De}m!==0&&Xa(s,m,0),E!==0&&v===0&&s.tag!==0&&(s.suspendedLanes|=E&~(z&~a))}function Xa(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var m=31-Et(a);s.entangledLanes|=a,s.entanglements[m]=s.entanglements[m]|1073741824|c&261930}function Tc(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var m=31-Et(c),v=1<<m;v&a|s[m]&a&&(s[m]|=a),c&=~v}}function Ac(s,a){var c=a&-a;return c=(c&42)!==0?1:Za(c),(c&(s.suspendedLanes|a))!==0?0:c}function Za(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Zs(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Ed(){var s=W.p;return s!==0?s:(s=window.event,s===void 0?32:Cx(s.type))}function Jr(s,a){var c=W.p;try{return W.p=s,a()}finally{W.p=c}}var es=Math.random().toString(36).slice(2),hn="__reactFiber$"+es,Dn="__reactProps$"+es,xs="__reactContainer$"+es,Zo="__reactEvents$"+es,Om="__reactListeners$"+es,Cd="__reactHandles$"+es,Td="__reactResources$"+es,ws="__reactMarker$"+es;function Jo(s){delete s[hn],delete s[Dn],delete s[Zo],delete s[Om],delete s[Cd]}function Ss(s){var a=s[hn];if(a)return a;for(var c=s.parentNode;c;){if(a=c[xs]||c[hn]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=cx(s);s!==null;){if(c=s[hn])return c;s=cx(s)}return a}s=c,c=s.parentNode}return null}function Nr(s){if(s=s[hn]||s[xs]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function xr(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(r(33))}function Es(s){var a=s[Td];return a||(a=s[Td]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function fn(s){s[ws]=!0}var jc=new Set,Rc={};function Cs(s,a){Ts(s,a),Ts(s+"Capture",a)}function Ts(s,a){for(Rc[s]=a,s=0;s<a.length;s++)jc.add(a[s])}var Ic=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Dc={},kc={};function Ad(s){return oe.call(kc,s)?!0:oe.call(Dc,s)?!1:Ic.test(s)?kc[s]=!0:(Dc[s]=!0,!1)}function el(s,a,c){if(Ad(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var m=a.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function wr(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function mn(s,a,c,m){if(m===null)s.removeAttribute(c);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+m)}}function kn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function zi(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Mc(s,a,c){var m=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var v=m.get,E=m.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return v.call(this)},set:function(z){c=""+z,E.call(this,z)}}),Object.defineProperty(s,a,{enumerable:m.enumerable}),{getValue:function(){return c},setValue:function(z){c=""+z},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function It(s){if(!s._valueTracker){var a=zi(s)?"checked":"value";s._valueTracker=Mc(s,a,""+s[a])}}function Ja(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),m="";return s&&(m=zi(s)?s.checked?"true":"false":s.value),s=m,s!==c?(a.setValue(s),!0):!1}function As(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var eo=/[\n"\\]/g;function cr(s){return s.replace(eo,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function tl(s,a,c,m,v,E,z,Q){s.name="",z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?s.type=z:s.removeAttribute("type"),a!=null?z==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+kn(a)):s.value!==""+kn(a)&&(s.value=""+kn(a)):z!=="submit"&&z!=="reset"||s.removeAttribute("value"),a!=null?Oc(s,z,kn(a)):c!=null?Oc(s,z,kn(c)):m!=null&&s.removeAttribute("value"),v==null&&E!=null&&(s.defaultChecked=!!E),v!=null&&(s.checked=v&&typeof v!="function"&&typeof v!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?s.name=""+kn(Q):s.removeAttribute("name")}function jd(s,a,c,m,v,E,z,Q){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(s.type=E),a!=null||c!=null){if(!(E!=="submit"&&E!=="reset"||a!=null)){It(s);return}c=c!=null?""+kn(c):"",a=a!=null?""+kn(a):c,Q||a===s.value||(s.value=a),s.defaultValue=a}m=m??v,m=typeof m!="function"&&typeof m!="symbol"&&!!m,s.checked=Q?s.checked:!!m,s.defaultChecked=!!m,z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(s.name=z),It(s)}function Oc(s,a,c){a==="number"&&As(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function Li(s,a,c,m){if(s=s.options,a){a={};for(var v=0;v<c.length;v++)a["$"+c[v]]=!0;for(c=0;c<s.length;c++)v=a.hasOwnProperty("$"+s[c].value),s[c].selected!==v&&(s[c].selected=v),v&&m&&(s[c].defaultSelected=!0)}else{for(c=""+kn(c),a=null,v=0;v<s.length;v++){if(s[v].value===c){s[v].selected=!0,m&&(s[v].defaultSelected=!0);return}a!==null||s[v].disabled||(a=s[v])}a!==null&&(a.selected=!0)}}function Rd(s,a,c){if(a!=null&&(a=""+kn(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+kn(c):""}function Ui(s,a,c,m){if(a==null){if(m!=null){if(c!=null)throw Error(r(92));if(Y(m)){if(1<m.length)throw Error(r(93));m=m[0]}c=m}c==null&&(c=""),a=c}c=kn(a),s.defaultValue=c,m=s.textContent,m===c&&m!==""&&m!==null&&(s.value=m),It(s)}function ur(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var Id=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Nc(s,a,c){var m=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?m?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":m?s.setProperty(a,c):typeof c!="number"||c===0||Id.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Pc(s,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(s=s.style,c!=null){for(var m in c)!c.hasOwnProperty(m)||a!=null&&a.hasOwnProperty(m)||(m.indexOf("--")===0?s.setProperty(m,""):m==="float"?s.cssFloat="":s[m]="");for(var v in a)m=a[v],a.hasOwnProperty(v)&&c[v]!==m&&Nc(s,v,m)}else for(var E in a)a.hasOwnProperty(E)&&Nc(s,E,a[E])}function nl(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Fi=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function rl(s){return Fi.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function ts(){}var Bc=null;function Pr(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Vi=null,js=null;function to(s){var a=Nr(s);if(a&&(s=a.stateNode)){var c=s[Dn]||null;e:switch(s=a.stateNode,a.type){case"input":if(tl(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+cr(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var m=c[a];if(m!==s&&m.form===s.form){var v=m[Dn]||null;if(!v)throw Error(r(90));tl(m,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(a=0;a<c.length;a++)m=c[a],m.form===s.form&&Ja(m)}break e;case"textarea":Rd(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Li(s,!!c.multiple,a,!1)}}}var sl=!1;function $i(s,a,c){if(sl)return s(a,c);sl=!0;try{var m=s(a);return m}finally{if(sl=!1,(Vi!==null||js!==null)&&(Eh(),Vi&&(a=Vi,s=js,js=Vi=null,to(a),s)))for(a=0;a<s.length;a++)to(s[a])}}function ns(s,a){var c=s.stateNode;if(c===null)return null;var m=c[Dn]||null;if(m===null)return null;c=m[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(s=s.type,m=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!m;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var Br=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),no=!1;if(Br)try{var Mt={};Object.defineProperty(Mt,"passive",{get:function(){no=!0}}),window.addEventListener("test",Mt,Mt),window.removeEventListener("test",Mt,Mt)}catch{no=!1}var Rs=null,zc=null,ro=null;function Lc(){if(ro)return ro;var s,a=zc,c=a.length,m,v="value"in Rs?Rs.value:Rs.textContent,E=v.length;for(s=0;s<c&&a[s]===v[s];s++);var z=c-s;for(m=1;m<=z&&a[c-m]===v[E-m];m++);return ro=v.slice(s,1<m?1-m:void 0)}function so(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Js(){return!0}function rs(){return!1}function Pn(s){function a(c,m,v,E,z){this._reactName=c,this._targetInst=v,this.type=m,this.nativeEvent=E,this.target=z,this.currentTarget=null;for(var Q in s)s.hasOwnProperty(Q)&&(c=s[Q],this[Q]=c?c(E):E[Q]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?Js:rs,this.isPropagationStopped=rs,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Js)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Js)},persist:function(){},isPersistent:Js}),a}var ei={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Is=Pn(ei),qi=g({},ei,{view:0,detail:0}),Uc=Pn(qi),Hi,il,Ds,al=g({},qi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gi,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Ds&&(Ds&&s.type==="mousemove"?(Hi=s.screenX-Ds.screenX,il=s.screenY-Ds.screenY):il=Hi=0,Ds=s),Hi)},movementY:function(s){return"movementY"in s?s.movementY:il}}),Fc=Pn(al),io=g({},al,{dataTransfer:0}),kd=Pn(io),Md=g({},qi,{relatedTarget:0}),ao=Pn(Md),Vc=g({},ei,{animationName:0,elapsedTime:0,pseudoElement:0}),Od=Pn(Vc),ol=g({},ei,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Nd=Pn(ol),Pd=g({},ei,{data:0}),ks=Pn(Pd),Bd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ld={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ud(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=Ld[s])?!!a[s]:!1}function Gi(){return Ud}var sr=g({},qi,{key:function(s){if(s.key){var a=Bd[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=so(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?zd[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gi,charCode:function(s){return s.type==="keypress"?so(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?so(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Fd=Pn(sr),Vd=g({},al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ti=Pn(Vd),y=g({},qi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gi}),A=Pn(y),U=g({},ei,{propertyName:0,elapsedTime:0,pseudoElement:0}),K=Pn(U),he=g({},al,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),be=Pn(he),ze=g({},ei,{newState:0,oldState:0}),it=Pn(ze),an=[9,13,27,32],Ct=Br&&"CompositionEvent"in window,Qt=null;Br&&"documentMode"in document&&(Qt=document.documentMode);var zr=Br&&"TextEvent"in window&&!Qt,Ms=Br&&(!Ct||Qt&&8<Qt&&11>=Qt),ss=" ",is=!1;function oo(s,a){switch(s){case"keyup":return an.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ll(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var cl=!1;function EA(s,a){switch(s){case"compositionend":return ll(a);case"keypress":return a.which!==32?null:(is=!0,ss);case"textInput":return s=a.data,s===ss&&is?null:s;default:return null}}function CA(s,a){if(cl)return s==="compositionend"||!Ct&&oo(s,a)?(s=Lc(),ro=zc=Rs=null,cl=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Ms&&a.locale!=="ko"?null:a.data;default:return null}}var TA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function h0(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!TA[s.type]:a==="textarea"}function f0(s,a,c,m){Vi?js?js.push(m):js=[m]:Vi=m,a=Dh(a,"onChange"),0<a.length&&(c=new Is("onChange","change",null,c,m),s.push({event:c,listeners:a}))}var $c=null,qc=null;function AA(s){Kv(s,0)}function $d(s){var a=xr(s);if(Ja(a))return s}function m0(s,a){if(s==="change")return a}var p0=!1;if(Br){var Nm;if(Br){var Pm="oninput"in document;if(!Pm){var g0=document.createElement("div");g0.setAttribute("oninput","return;"),Pm=typeof g0.oninput=="function"}Nm=Pm}else Nm=!1;p0=Nm&&(!document.documentMode||9<document.documentMode)}function y0(){$c&&($c.detachEvent("onpropertychange",_0),qc=$c=null)}function _0(s){if(s.propertyName==="value"&&$d(qc)){var a=[];f0(a,qc,s,Pr(s)),$i(AA,a)}}function jA(s,a,c){s==="focusin"?(y0(),$c=a,qc=c,$c.attachEvent("onpropertychange",_0)):s==="focusout"&&y0()}function RA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return $d(qc)}function IA(s,a){if(s==="click")return $d(a)}function DA(s,a){if(s==="input"||s==="change")return $d(a)}function kA(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var Sr=typeof Object.is=="function"?Object.is:kA;function Hc(s,a){if(Sr(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),m=Object.keys(a);if(c.length!==m.length)return!1;for(m=0;m<c.length;m++){var v=c[m];if(!oe.call(a,v)||!Sr(s[v],a[v]))return!1}return!0}function b0(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function v0(s,a){var c=b0(s);s=0;for(var m;c;){if(c.nodeType===3){if(m=s+c.textContent.length,s<=a&&m>=a)return{node:c,offset:a-s};s=m}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=b0(c)}}function x0(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?x0(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function w0(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=As(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=As(s.document)}return a}function Bm(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var MA=Br&&"documentMode"in document&&11>=document.documentMode,ul=null,zm=null,Gc=null,Lm=!1;function S0(s,a,c){var m=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Lm||ul==null||ul!==As(m)||(m=ul,"selectionStart"in m&&Bm(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Gc&&Hc(Gc,m)||(Gc=m,m=Dh(zm,"onSelect"),0<m.length&&(a=new Is("onSelect","select",null,a,c),s.push({event:a,listeners:m}),a.target=ul)))}function lo(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var dl={animationend:lo("Animation","AnimationEnd"),animationiteration:lo("Animation","AnimationIteration"),animationstart:lo("Animation","AnimationStart"),transitionrun:lo("Transition","TransitionRun"),transitionstart:lo("Transition","TransitionStart"),transitioncancel:lo("Transition","TransitionCancel"),transitionend:lo("Transition","TransitionEnd")},Um={},E0={};Br&&(E0=document.createElement("div").style,"AnimationEvent"in window||(delete dl.animationend.animation,delete dl.animationiteration.animation,delete dl.animationstart.animation),"TransitionEvent"in window||delete dl.transitionend.transition);function co(s){if(Um[s])return Um[s];if(!dl[s])return s;var a=dl[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in E0)return Um[s]=a[c];return s}var C0=co("animationend"),T0=co("animationiteration"),A0=co("animationstart"),OA=co("transitionrun"),NA=co("transitionstart"),PA=co("transitioncancel"),j0=co("transitionend"),R0=new Map,Fm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Fm.push("scrollEnd");function as(s,a){R0.set(s,a),Cs(a,[s])}var qd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Lr=[],hl=0,Vm=0;function Hd(){for(var s=hl,a=Vm=hl=0;a<s;){var c=Lr[a];Lr[a++]=null;var m=Lr[a];Lr[a++]=null;var v=Lr[a];Lr[a++]=null;var E=Lr[a];if(Lr[a++]=null,m!==null&&v!==null){var z=m.pending;z===null?v.next=v:(v.next=z.next,z.next=v),m.pending=v}E!==0&&I0(c,v,E)}}function Gd(s,a,c,m){Lr[hl++]=s,Lr[hl++]=a,Lr[hl++]=c,Lr[hl++]=m,Vm|=m,s.lanes|=m,s=s.alternate,s!==null&&(s.lanes|=m)}function $m(s,a,c,m){return Gd(s,a,c,m),Wd(s)}function uo(s,a){return Gd(s,null,null,a),Wd(s)}function I0(s,a,c){s.lanes|=c;var m=s.alternate;m!==null&&(m.lanes|=c);for(var v=!1,E=s.return;E!==null;)E.childLanes|=c,m=E.alternate,m!==null&&(m.childLanes|=c),E.tag===22&&(s=E.stateNode,s===null||s._visibility&1||(v=!0)),s=E,E=E.return;return s.tag===3?(E=s.stateNode,v&&a!==null&&(v=31-Et(c),s=E.hiddenUpdates,m=s[v],m===null?s[v]=[a]:m.push(a),a.lane=c|536870912),E):null}function Wd(s){if(50<mu)throw mu=0,Zp=null,Error(r(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var fl={};function BA(s,a,c,m){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Er(s,a,c,m){return new BA(s,a,c,m)}function qm(s){return s=s.prototype,!(!s||!s.isReactComponent)}function ni(s,a){var c=s.alternate;return c===null?(c=Er(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function D0(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Qd(s,a,c,m,v,E){var z=0;if(m=s,typeof s=="function")qm(s)&&(z=1);else if(typeof s=="string")z=Vj(s,c,ne.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case P:return s=Er(31,c,a,v),s.elementType=P,s.lanes=E,s;case x:return ho(c.children,v,E,a);case S:z=8,v|=24;break;case C:return s=Er(12,c,a,v|2),s.elementType=C,s.lanes=E,s;case F:return s=Er(13,c,a,v),s.elementType=F,s.lanes=E,s;case G:return s=Er(19,c,a,v),s.elementType=G,s.lanes=E,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case I:z=10;break e;case T:z=9;break e;case M:z=11;break e;case D:z=14;break e;case O:z=16,m=null;break e}z=29,c=Error(r(130,s===null?"null":typeof s,"")),m=null}return a=Er(z,c,a,v),a.elementType=s,a.type=m,a.lanes=E,a}function ho(s,a,c,m){return s=Er(7,s,m,a),s.lanes=c,s}function Hm(s,a,c){return s=Er(6,s,null,a),s.lanes=c,s}function k0(s){var a=Er(18,null,null,0);return a.stateNode=s,a}function Gm(s,a,c){return a=Er(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var M0=new WeakMap;function Ur(s,a){if(typeof s=="object"&&s!==null){var c=M0.get(s);return c!==void 0?c:(a={value:s,source:a,stack:Z(a)},M0.set(s,a),a)}return{value:s,source:a,stack:Z(a)}}var ml=[],pl=0,Kd=null,Wc=0,Fr=[],Vr=0,Wi=null,Os=1,Ns="";function ri(s,a){ml[pl++]=Wc,ml[pl++]=Kd,Kd=s,Wc=a}function O0(s,a,c){Fr[Vr++]=Os,Fr[Vr++]=Ns,Fr[Vr++]=Wi,Wi=s;var m=Os;s=Ns;var v=32-Et(m)-1;m&=~(1<<v),c+=1;var E=32-Et(a)+v;if(30<E){var z=v-v%5;E=(m&(1<<z)-1).toString(32),m>>=z,v-=z,Os=1<<32-Et(a)+v|c<<v|m,Ns=E+s}else Os=1<<E|c<<v|m,Ns=s}function Wm(s){s.return!==null&&(ri(s,1),O0(s,1,0))}function Qm(s){for(;s===Kd;)Kd=ml[--pl],ml[pl]=null,Wc=ml[--pl],ml[pl]=null;for(;s===Wi;)Wi=Fr[--Vr],Fr[Vr]=null,Ns=Fr[--Vr],Fr[Vr]=null,Os=Fr[--Vr],Fr[Vr]=null}function N0(s,a){Fr[Vr++]=Os,Fr[Vr++]=Ns,Fr[Vr++]=Wi,Os=a.id,Ns=a.overflow,Wi=s}var Bn=null,qt=null,_t=!1,Qi=null,$r=!1,Km=Error(r(519));function Ki(s){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Qc(Ur(a,s)),Km}function P0(s){var a=s.stateNode,c=s.type,m=s.memoizedProps;switch(a[hn]=s,a[Dn]=m,c){case"dialog":dt("cancel",a),dt("close",a);break;case"iframe":case"object":case"embed":dt("load",a);break;case"video":case"audio":for(c=0;c<gu.length;c++)dt(gu[c],a);break;case"source":dt("error",a);break;case"img":case"image":case"link":dt("error",a),dt("load",a);break;case"details":dt("toggle",a);break;case"input":dt("invalid",a),jd(a,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":dt("invalid",a);break;case"textarea":dt("invalid",a),Ui(a,m.value,m.defaultValue,m.children)}c=m.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||m.suppressHydrationWarning===!0||Jv(a.textContent,c)?(m.popover!=null&&(dt("beforetoggle",a),dt("toggle",a)),m.onScroll!=null&&dt("scroll",a),m.onScrollEnd!=null&&dt("scrollend",a),m.onClick!=null&&(a.onclick=ts),a=!0):a=!1,a||Ki(s,!0)}function B0(s){for(Bn=s.return;Bn;)switch(Bn.tag){case 5:case 31:case 13:$r=!1;return;case 27:case 3:$r=!0;return;default:Bn=Bn.return}}function gl(s){if(s!==Bn)return!1;if(!_t)return B0(s),_t=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||fg(s.type,s.memoizedProps)),c=!c),c&&qt&&Ki(s),B0(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));qt=lx(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));qt=lx(s)}else a===27?(a=qt,ca(s.type)?(s=_g,_g=null,qt=s):qt=a):qt=Bn?Hr(s.stateNode.nextSibling):null;return!0}function fo(){qt=Bn=null,_t=!1}function Ym(){var s=Qi;return s!==null&&(mr===null?mr=s:mr.push.apply(mr,s),Qi=null),s}function Qc(s){Qi===null?Qi=[s]:Qi.push(s)}var Xm=N(null),mo=null,si=null;function Yi(s,a,c){J(Xm,a._currentValue),a._currentValue=c}function ii(s){s._currentValue=Xm.current,q(Xm)}function Zm(s,a,c){for(;s!==null;){var m=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,m!==null&&(m.childLanes|=a)):m!==null&&(m.childLanes&a)!==a&&(m.childLanes|=a),s===c)break;s=s.return}}function Jm(s,a,c,m){var v=s.child;for(v!==null&&(v.return=s);v!==null;){var E=v.dependencies;if(E!==null){var z=v.child;E=E.firstContext;e:for(;E!==null;){var Q=E;E=v;for(var se=0;se<a.length;se++)if(Q.context===a[se]){E.lanes|=c,Q=E.alternate,Q!==null&&(Q.lanes|=c),Zm(E.return,c,s),m||(z=null);break e}E=Q.next}}else if(v.tag===18){if(z=v.return,z===null)throw Error(r(341));z.lanes|=c,E=z.alternate,E!==null&&(E.lanes|=c),Zm(z,c,s),z=null}else z=v.child;if(z!==null)z.return=v;else for(z=v;z!==null;){if(z===s){z=null;break}if(v=z.sibling,v!==null){v.return=z.return,z=v;break}z=z.return}v=z}}function yl(s,a,c,m){s=null;for(var v=a,E=!1;v!==null;){if(!E){if((v.flags&524288)!==0)E=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var z=v.alternate;if(z===null)throw Error(r(387));if(z=z.memoizedProps,z!==null){var Q=v.type;Sr(v.pendingProps.value,z.value)||(s!==null?s.push(Q):s=[Q])}}else if(v===Ae.current){if(z=v.alternate,z===null)throw Error(r(387));z.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(s!==null?s.push(xu):s=[xu])}v=v.return}s!==null&&Jm(a,s,c,m),a.flags|=262144}function Yd(s){for(s=s.firstContext;s!==null;){if(!Sr(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function po(s){mo=s,si=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function zn(s){return z0(mo,s)}function Xd(s,a){return mo===null&&po(s),z0(s,a)}function z0(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},si===null){if(s===null)throw Error(r(308));si=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else si=si.next=a;return c}var zA=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,m){s.push(m)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},LA=t.unstable_scheduleCallback,UA=t.unstable_NormalPriority,pn={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ep(){return{controller:new zA,data:new Map,refCount:0}}function Kc(s){s.refCount--,s.refCount===0&&LA(UA,function(){s.controller.abort()})}var Yc=null,tp=0,_l=0,bl=null;function FA(s,a){if(Yc===null){var c=Yc=[];tp=0,_l=sg(),bl={status:"pending",value:void 0,then:function(m){c.push(m)}}}return tp++,a.then(L0,L0),a}function L0(){if(--tp===0&&Yc!==null){bl!==null&&(bl.status="fulfilled");var s=Yc;Yc=null,_l=0,bl=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function VA(s,a){var c=[],m={status:"pending",value:null,reason:null,then:function(v){c.push(v)}};return s.then(function(){m.status="fulfilled",m.value=a;for(var v=0;v<c.length;v++)(0,c[v])(a)},function(v){for(m.status="rejected",m.reason=v,v=0;v<c.length;v++)(0,c[v])(void 0)}),m}var U0=X.S;X.S=function(s,a){Sv=Pe(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&FA(s,a),U0!==null&&U0(s,a)};var go=N(null);function np(){var s=go.current;return s!==null?s:Ut.pooledCache}function Zd(s,a){a===null?J(go,go.current):J(go,a.pool)}function F0(){var s=np();return s===null?null:{parent:pn._currentValue,pool:s}}var vl=Error(r(460)),rp=Error(r(474)),Jd=Error(r(542)),eh={then:function(){}};function V0(s){return s=s.status,s==="fulfilled"||s==="rejected"}function $0(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(ts,ts),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,H0(s),s;default:if(typeof a.status=="string")a.then(ts,ts);else{if(s=Ut,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=a,s.status="pending",s.then(function(m){if(a.status==="pending"){var v=a;v.status="fulfilled",v.value=m}},function(m){if(a.status==="pending"){var v=a;v.status="rejected",v.reason=m}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,H0(s),s}throw _o=a,vl}}function yo(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(_o=c,vl):c}}var _o=null;function q0(){if(_o===null)throw Error(r(459));var s=_o;return _o=null,s}function H0(s){if(s===vl||s===Jd)throw Error(r(483))}var xl=null,Xc=0;function th(s){var a=Xc;return Xc+=1,xl===null&&(xl=[]),$0(xl,s,a)}function Zc(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function nh(s,a){throw a.$$typeof===b?Error(r(525)):(s=Object.prototype.toString.call(a),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function G0(s){function a(ue,le){if(s){var me=ue.deletions;me===null?(ue.deletions=[le],ue.flags|=16):me.push(le)}}function c(ue,le){if(!s)return null;for(;le!==null;)a(ue,le),le=le.sibling;return null}function m(ue){for(var le=new Map;ue!==null;)ue.key!==null?le.set(ue.key,ue):le.set(ue.index,ue),ue=ue.sibling;return le}function v(ue,le){return ue=ni(ue,le),ue.index=0,ue.sibling=null,ue}function E(ue,le,me){return ue.index=me,s?(me=ue.alternate,me!==null?(me=me.index,me<le?(ue.flags|=67108866,le):me):(ue.flags|=67108866,le)):(ue.flags|=1048576,le)}function z(ue){return s&&ue.alternate===null&&(ue.flags|=67108866),ue}function Q(ue,le,me,je){return le===null||le.tag!==6?(le=Hm(me,ue.mode,je),le.return=ue,le):(le=v(le,me),le.return=ue,le)}function se(ue,le,me,je){var We=me.type;return We===x?Ce(ue,le,me.props.children,je,me.key):le!==null&&(le.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===O&&yo(We)===le.type)?(le=v(le,me.props),Zc(le,me),le.return=ue,le):(le=Qd(me.type,me.key,me.props,null,ue.mode,je),Zc(le,me),le.return=ue,le)}function pe(ue,le,me,je){return le===null||le.tag!==4||le.stateNode.containerInfo!==me.containerInfo||le.stateNode.implementation!==me.implementation?(le=Gm(me,ue.mode,je),le.return=ue,le):(le=v(le,me.children||[]),le.return=ue,le)}function Ce(ue,le,me,je,We){return le===null||le.tag!==7?(le=ho(me,ue.mode,je,We),le.return=ue,le):(le=v(le,me),le.return=ue,le)}function De(ue,le,me){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=Hm(""+le,ue.mode,me),le.return=ue,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case _:return me=Qd(le.type,le.key,le.props,null,ue.mode,me),Zc(me,le),me.return=ue,me;case w:return le=Gm(le,ue.mode,me),le.return=ue,le;case O:return le=yo(le),De(ue,le,me)}if(Y(le)||j(le))return le=ho(le,ue.mode,me,null),le.return=ue,le;if(typeof le.then=="function")return De(ue,th(le),me);if(le.$$typeof===I)return De(ue,Xd(ue,le),me);nh(ue,le)}return null}function _e(ue,le,me,je){var We=le!==null?le.key:null;if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return We!==null?null:Q(ue,le,""+me,je);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case _:return me.key===We?se(ue,le,me,je):null;case w:return me.key===We?pe(ue,le,me,je):null;case O:return me=yo(me),_e(ue,le,me,je)}if(Y(me)||j(me))return We!==null?null:Ce(ue,le,me,je,null);if(typeof me.then=="function")return _e(ue,le,th(me),je);if(me.$$typeof===I)return _e(ue,le,Xd(ue,me),je);nh(ue,me)}return null}function ve(ue,le,me,je,We){if(typeof je=="string"&&je!==""||typeof je=="number"||typeof je=="bigint")return ue=ue.get(me)||null,Q(le,ue,""+je,We);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case _:return ue=ue.get(je.key===null?me:je.key)||null,se(le,ue,je,We);case w:return ue=ue.get(je.key===null?me:je.key)||null,pe(le,ue,je,We);case O:return je=yo(je),ve(ue,le,me,je,We)}if(Y(je)||j(je))return ue=ue.get(me)||null,Ce(le,ue,je,We,null);if(typeof je.then=="function")return ve(ue,le,me,th(je),We);if(je.$$typeof===I)return ve(ue,le,me,Xd(le,je),We);nh(le,je)}return null}function Fe(ue,le,me,je){for(var We=null,wt=null,Ve=le,ot=le=0,mt=null;Ve!==null&&ot<me.length;ot++){Ve.index>ot?(mt=Ve,Ve=null):mt=Ve.sibling;var St=_e(ue,Ve,me[ot],je);if(St===null){Ve===null&&(Ve=mt);break}s&&Ve&&St.alternate===null&&a(ue,Ve),le=E(St,le,ot),wt===null?We=St:wt.sibling=St,wt=St,Ve=mt}if(ot===me.length)return c(ue,Ve),_t&&ri(ue,ot),We;if(Ve===null){for(;ot<me.length;ot++)Ve=De(ue,me[ot],je),Ve!==null&&(le=E(Ve,le,ot),wt===null?We=Ve:wt.sibling=Ve,wt=Ve);return _t&&ri(ue,ot),We}for(Ve=m(Ve);ot<me.length;ot++)mt=ve(Ve,ue,ot,me[ot],je),mt!==null&&(s&&mt.alternate!==null&&Ve.delete(mt.key===null?ot:mt.key),le=E(mt,le,ot),wt===null?We=mt:wt.sibling=mt,wt=mt);return s&&Ve.forEach(function(ma){return a(ue,ma)}),_t&&ri(ue,ot),We}function Ke(ue,le,me,je){if(me==null)throw Error(r(151));for(var We=null,wt=null,Ve=le,ot=le=0,mt=null,St=me.next();Ve!==null&&!St.done;ot++,St=me.next()){Ve.index>ot?(mt=Ve,Ve=null):mt=Ve.sibling;var ma=_e(ue,Ve,St.value,je);if(ma===null){Ve===null&&(Ve=mt);break}s&&Ve&&ma.alternate===null&&a(ue,Ve),le=E(ma,le,ot),wt===null?We=ma:wt.sibling=ma,wt=ma,Ve=mt}if(St.done)return c(ue,Ve),_t&&ri(ue,ot),We;if(Ve===null){for(;!St.done;ot++,St=me.next())St=De(ue,St.value,je),St!==null&&(le=E(St,le,ot),wt===null?We=St:wt.sibling=St,wt=St);return _t&&ri(ue,ot),We}for(Ve=m(Ve);!St.done;ot++,St=me.next())St=ve(Ve,ue,ot,St.value,je),St!==null&&(s&&St.alternate!==null&&Ve.delete(St.key===null?ot:St.key),le=E(St,le,ot),wt===null?We=St:wt.sibling=St,wt=St);return s&&Ve.forEach(function(Jj){return a(ue,Jj)}),_t&&ri(ue,ot),We}function Pt(ue,le,me,je){if(typeof me=="object"&&me!==null&&me.type===x&&me.key===null&&(me=me.props.children),typeof me=="object"&&me!==null){switch(me.$$typeof){case _:e:{for(var We=me.key;le!==null;){if(le.key===We){if(We=me.type,We===x){if(le.tag===7){c(ue,le.sibling),je=v(le,me.props.children),je.return=ue,ue=je;break e}}else if(le.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===O&&yo(We)===le.type){c(ue,le.sibling),je=v(le,me.props),Zc(je,me),je.return=ue,ue=je;break e}c(ue,le);break}else a(ue,le);le=le.sibling}me.type===x?(je=ho(me.props.children,ue.mode,je,me.key),je.return=ue,ue=je):(je=Qd(me.type,me.key,me.props,null,ue.mode,je),Zc(je,me),je.return=ue,ue=je)}return z(ue);case w:e:{for(We=me.key;le!==null;){if(le.key===We)if(le.tag===4&&le.stateNode.containerInfo===me.containerInfo&&le.stateNode.implementation===me.implementation){c(ue,le.sibling),je=v(le,me.children||[]),je.return=ue,ue=je;break e}else{c(ue,le);break}else a(ue,le);le=le.sibling}je=Gm(me,ue.mode,je),je.return=ue,ue=je}return z(ue);case O:return me=yo(me),Pt(ue,le,me,je)}if(Y(me))return Fe(ue,le,me,je);if(j(me)){if(We=j(me),typeof We!="function")throw Error(r(150));return me=We.call(me),Ke(ue,le,me,je)}if(typeof me.then=="function")return Pt(ue,le,th(me),je);if(me.$$typeof===I)return Pt(ue,le,Xd(ue,me),je);nh(ue,me)}return typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint"?(me=""+me,le!==null&&le.tag===6?(c(ue,le.sibling),je=v(le,me),je.return=ue,ue=je):(c(ue,le),je=Hm(me,ue.mode,je),je.return=ue,ue=je),z(ue)):c(ue,le)}return function(ue,le,me,je){try{Xc=0;var We=Pt(ue,le,me,je);return xl=null,We}catch(Ve){if(Ve===vl||Ve===Jd)throw Ve;var wt=Er(29,Ve,null,ue.mode);return wt.lanes=je,wt.return=ue,wt}}}var bo=G0(!0),W0=G0(!1),Xi=!1;function sp(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ip(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Zi(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Ji(s,a,c){var m=s.updateQueue;if(m===null)return null;if(m=m.shared,(Tt&2)!==0){var v=m.pending;return v===null?a.next=a:(a.next=v.next,v.next=a),m.pending=a,a=Wd(s),I0(s,null,c),a}return Gd(s,m,a,c),Wd(s)}function Jc(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var m=a.lanes;m&=s.pendingLanes,c|=m,a.lanes=c,Tc(s,c)}}function ap(s,a){var c=s.updateQueue,m=s.alternate;if(m!==null&&(m=m.updateQueue,c===m)){var v=null,E=null;if(c=c.firstBaseUpdate,c!==null){do{var z={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};E===null?v=E=z:E=E.next=z,c=c.next}while(c!==null);E===null?v=E=a:E=E.next=a}else v=E=a;c={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:E,shared:m.shared,callbacks:m.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var op=!1;function eu(){if(op){var s=bl;if(s!==null)throw s}}function tu(s,a,c,m){op=!1;var v=s.updateQueue;Xi=!1;var E=v.firstBaseUpdate,z=v.lastBaseUpdate,Q=v.shared.pending;if(Q!==null){v.shared.pending=null;var se=Q,pe=se.next;se.next=null,z===null?E=pe:z.next=pe,z=se;var Ce=s.alternate;Ce!==null&&(Ce=Ce.updateQueue,Q=Ce.lastBaseUpdate,Q!==z&&(Q===null?Ce.firstBaseUpdate=pe:Q.next=pe,Ce.lastBaseUpdate=se))}if(E!==null){var De=v.baseState;z=0,Ce=pe=se=null,Q=E;do{var _e=Q.lane&-536870913,ve=_e!==Q.lane;if(ve?(ft&_e)===_e:(m&_e)===_e){_e!==0&&_e===_l&&(op=!0),Ce!==null&&(Ce=Ce.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var Fe=s,Ke=Q;_e=a;var Pt=c;switch(Ke.tag){case 1:if(Fe=Ke.payload,typeof Fe=="function"){De=Fe.call(Pt,De,_e);break e}De=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Ke.payload,_e=typeof Fe=="function"?Fe.call(Pt,De,_e):Fe,_e==null)break e;De=g({},De,_e);break e;case 2:Xi=!0}}_e=Q.callback,_e!==null&&(s.flags|=64,ve&&(s.flags|=8192),ve=v.callbacks,ve===null?v.callbacks=[_e]:ve.push(_e))}else ve={lane:_e,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Ce===null?(pe=Ce=ve,se=De):Ce=Ce.next=ve,z|=_e;if(Q=Q.next,Q===null){if(Q=v.shared.pending,Q===null)break;ve=Q,Q=ve.next,ve.next=null,v.lastBaseUpdate=ve,v.shared.pending=null}}while(!0);Ce===null&&(se=De),v.baseState=se,v.firstBaseUpdate=pe,v.lastBaseUpdate=Ce,E===null&&(v.shared.lanes=0),sa|=z,s.lanes=z,s.memoizedState=De}}function Q0(s,a){if(typeof s!="function")throw Error(r(191,s));s.call(a)}function K0(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)Q0(c[s],a)}var wl=N(null),rh=N(0);function Y0(s,a){s=mi,J(rh,s),J(wl,a),mi=s|a.baseLanes}function lp(){J(rh,mi),J(wl,wl.current)}function cp(){mi=rh.current,q(wl),q(rh)}var Cr=N(null),qr=null;function ea(s){var a=s.alternate;J(on,on.current&1),J(Cr,s),qr===null&&(a===null||wl.current!==null||a.memoizedState!==null)&&(qr=s)}function up(s){J(on,on.current),J(Cr,s),qr===null&&(qr=s)}function X0(s){s.tag===22?(J(on,on.current),J(Cr,s),qr===null&&(qr=s)):ta()}function ta(){J(on,on.current),J(Cr,Cr.current)}function Tr(s){q(Cr),qr===s&&(qr=null),q(on)}var on=N(0);function sh(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||gg(c)||yg(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ai=0,at=null,Ot=null,gn=null,ih=!1,Sl=!1,vo=!1,ah=0,nu=0,El=null,$A=0;function rn(){throw Error(r(321))}function dp(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!Sr(s[c],a[c]))return!1;return!0}function hp(s,a,c,m,v,E){return ai=E,at=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,X.H=s===null||s.memoizedState===null?Ob:Ap,vo=!1,E=c(m,v),vo=!1,Sl&&(E=J0(a,c,m,v)),Z0(s),E}function Z0(s){X.H=iu;var a=Ot!==null&&Ot.next!==null;if(ai=0,gn=Ot=at=null,ih=!1,nu=0,El=null,a)throw Error(r(300));s===null||yn||(s=s.dependencies,s!==null&&Yd(s)&&(yn=!0))}function J0(s,a,c,m){at=s;var v=0;do{if(Sl&&(El=null),nu=0,Sl=!1,25<=v)throw Error(r(301));if(v+=1,gn=Ot=null,s.updateQueue!=null){var E=s.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}X.H=Nb,E=a(c,m)}while(Sl);return E}function qA(){var s=X.H,a=s.useState()[0];return a=typeof a.then=="function"?ru(a):a,s=s.useState()[0],(Ot!==null?Ot.memoizedState:null)!==s&&(at.flags|=1024),a}function fp(){var s=ah!==0;return ah=0,s}function mp(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function pp(s){if(ih){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}ih=!1}ai=0,gn=Ot=at=null,Sl=!1,nu=ah=0,El=null}function ir(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gn===null?at.memoizedState=gn=s:gn=gn.next=s,gn}function ln(){if(Ot===null){var s=at.alternate;s=s!==null?s.memoizedState:null}else s=Ot.next;var a=gn===null?at.memoizedState:gn.next;if(a!==null)gn=a,Ot=s;else{if(s===null)throw at.alternate===null?Error(r(467)):Error(r(310));Ot=s,s={memoizedState:Ot.memoizedState,baseState:Ot.baseState,baseQueue:Ot.baseQueue,queue:Ot.queue,next:null},gn===null?at.memoizedState=gn=s:gn=gn.next=s}return gn}function oh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ru(s){var a=nu;return nu+=1,El===null&&(El=[]),s=$0(El,s,a),a=at,(gn===null?a.memoizedState:gn.next)===null&&(a=a.alternate,X.H=a===null||a.memoizedState===null?Ob:Ap),s}function lh(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return ru(s);if(s.$$typeof===I)return zn(s)}throw Error(r(438,String(s)))}function gp(s){var a=null,c=at.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var m=at.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(a={data:m.data.map(function(v){return v.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=oh(),at.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),m=0;m<s;m++)c[m]=$;return a.index++,c}function oi(s,a){return typeof a=="function"?a(s):a}function ch(s){var a=ln();return yp(a,Ot,s)}function yp(s,a,c){var m=s.queue;if(m===null)throw Error(r(311));m.lastRenderedReducer=c;var v=s.baseQueue,E=m.pending;if(E!==null){if(v!==null){var z=v.next;v.next=E.next,E.next=z}a.baseQueue=v=E,m.pending=null}if(E=s.baseState,v===null)s.memoizedState=E;else{a=v.next;var Q=z=null,se=null,pe=a,Ce=!1;do{var De=pe.lane&-536870913;if(De!==pe.lane?(ft&De)===De:(ai&De)===De){var _e=pe.revertLane;if(_e===0)se!==null&&(se=se.next={lane:0,revertLane:0,gesture:null,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null}),De===_l&&(Ce=!0);else if((ai&_e)===_e){pe=pe.next,_e===_l&&(Ce=!0);continue}else De={lane:0,revertLane:pe.revertLane,gesture:null,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null},se===null?(Q=se=De,z=E):se=se.next=De,at.lanes|=_e,sa|=_e;De=pe.action,vo&&c(E,De),E=pe.hasEagerState?pe.eagerState:c(E,De)}else _e={lane:De,revertLane:pe.revertLane,gesture:pe.gesture,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null},se===null?(Q=se=_e,z=E):se=se.next=_e,at.lanes|=De,sa|=De;pe=pe.next}while(pe!==null&&pe!==a);if(se===null?z=E:se.next=Q,!Sr(E,s.memoizedState)&&(yn=!0,Ce&&(c=bl,c!==null)))throw c;s.memoizedState=E,s.baseState=z,s.baseQueue=se,m.lastRenderedState=E}return v===null&&(m.lanes=0),[s.memoizedState,m.dispatch]}function _p(s){var a=ln(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var m=c.dispatch,v=c.pending,E=a.memoizedState;if(v!==null){c.pending=null;var z=v=v.next;do E=s(E,z.action),z=z.next;while(z!==v);Sr(E,a.memoizedState)||(yn=!0),a.memoizedState=E,a.baseQueue===null&&(a.baseState=E),c.lastRenderedState=E}return[E,m]}function eb(s,a,c){var m=at,v=ln(),E=_t;if(E){if(c===void 0)throw Error(r(407));c=c()}else c=a();var z=!Sr((Ot||v).memoizedState,c);if(z&&(v.memoizedState=c,yn=!0),v=v.queue,xp(rb.bind(null,m,v,s),[s]),v.getSnapshot!==a||z||gn!==null&&gn.memoizedState.tag&1){if(m.flags|=2048,Cl(9,{destroy:void 0},nb.bind(null,m,v,c,a),null),Ut===null)throw Error(r(349));E||(ai&127)!==0||tb(m,a,c)}return c}function tb(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=at.updateQueue,a===null?(a=oh(),at.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function nb(s,a,c,m){a.value=c,a.getSnapshot=m,sb(a)&&ib(s)}function rb(s,a,c){return c(function(){sb(a)&&ib(s)})}function sb(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!Sr(s,c)}catch{return!0}}function ib(s){var a=uo(s,2);a!==null&&pr(a,s,2)}function bp(s){var a=ir();if(typeof s=="function"){var c=s;if(s=c(),vo){Qn(!0);try{c()}finally{Qn(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:oi,lastRenderedState:s},a}function ab(s,a,c,m){return s.baseState=c,yp(s,Ot,typeof m=="function"?m:oi)}function HA(s,a,c,m,v){if(hh(s))throw Error(r(485));if(s=a.action,s!==null){var E={payload:v,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(z){E.listeners.push(z)}};X.T!==null?c(!0):E.isTransition=!1,m(E),c=a.pending,c===null?(E.next=a.pending=E,ob(a,E)):(E.next=c.next,a.pending=c.next=E)}}function ob(s,a){var c=a.action,m=a.payload,v=s.state;if(a.isTransition){var E=X.T,z={};X.T=z;try{var Q=c(v,m),se=X.S;se!==null&&se(z,Q),lb(s,a,Q)}catch(pe){vp(s,a,pe)}finally{E!==null&&z.types!==null&&(E.types=z.types),X.T=E}}else try{E=c(v,m),lb(s,a,E)}catch(pe){vp(s,a,pe)}}function lb(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(m){cb(s,a,m)},function(m){return vp(s,a,m)}):cb(s,a,c)}function cb(s,a,c){a.status="fulfilled",a.value=c,ub(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,ob(s,c)))}function vp(s,a,c){var m=s.pending;if(s.pending=null,m!==null){m=m.next;do a.status="rejected",a.reason=c,ub(a),a=a.next;while(a!==m)}s.action=null}function ub(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function db(s,a){return a}function hb(s,a){if(_t){var c=Ut.formState;if(c!==null){e:{var m=at;if(_t){if(qt){t:{for(var v=qt,E=$r;v.nodeType!==8;){if(!E){v=null;break t}if(v=Hr(v.nextSibling),v===null){v=null;break t}}E=v.data,v=E==="F!"||E==="F"?v:null}if(v){qt=Hr(v.nextSibling),m=v.data==="F!";break e}}Ki(m)}m=!1}m&&(a=c[0])}}return c=ir(),c.memoizedState=c.baseState=a,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:db,lastRenderedState:a},c.queue=m,c=Db.bind(null,at,m),m.dispatch=c,m=bp(!1),E=Tp.bind(null,at,!1,m.queue),m=ir(),v={state:a,dispatch:null,action:s,pending:null},m.queue=v,c=HA.bind(null,at,v,E,c),v.dispatch=c,m.memoizedState=s,[a,c,!1]}function fb(s){var a=ln();return mb(a,Ot,s)}function mb(s,a,c){if(a=yp(s,a,db)[0],s=ch(oi)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var m=ru(a)}catch(z){throw z===vl?Jd:z}else m=a;a=ln();var v=a.queue,E=v.dispatch;return c!==a.memoizedState&&(at.flags|=2048,Cl(9,{destroy:void 0},GA.bind(null,v,c),null)),[m,E,s]}function GA(s,a){s.action=a}function pb(s){var a=ln(),c=Ot;if(c!==null)return mb(a,c,s);ln(),a=a.memoizedState,c=ln();var m=c.queue.dispatch;return c.memoizedState=s,[a,m,!1]}function Cl(s,a,c,m){return s={tag:s,create:c,deps:m,inst:a,next:null},a=at.updateQueue,a===null&&(a=oh(),at.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(m=c.next,c.next=s,s.next=m,a.lastEffect=s),s}function gb(){return ln().memoizedState}function uh(s,a,c,m){var v=ir();at.flags|=s,v.memoizedState=Cl(1|a,{destroy:void 0},c,m===void 0?null:m)}function dh(s,a,c,m){var v=ln();m=m===void 0?null:m;var E=v.memoizedState.inst;Ot!==null&&m!==null&&dp(m,Ot.memoizedState.deps)?v.memoizedState=Cl(a,E,c,m):(at.flags|=s,v.memoizedState=Cl(1|a,E,c,m))}function yb(s,a){uh(8390656,8,s,a)}function xp(s,a){dh(2048,8,s,a)}function WA(s){at.flags|=4;var a=at.updateQueue;if(a===null)a=oh(),at.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function _b(s){var a=ln().memoizedState;return WA({ref:a,nextImpl:s}),function(){if((Tt&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function bb(s,a){return dh(4,2,s,a)}function vb(s,a){return dh(4,4,s,a)}function xb(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function wb(s,a,c){c=c!=null?c.concat([s]):null,dh(4,4,xb.bind(null,a,s),c)}function wp(){}function Sb(s,a){var c=ln();a=a===void 0?null:a;var m=c.memoizedState;return a!==null&&dp(a,m[1])?m[0]:(c.memoizedState=[s,a],s)}function Eb(s,a){var c=ln();a=a===void 0?null:a;var m=c.memoizedState;if(a!==null&&dp(a,m[1]))return m[0];if(m=s(),vo){Qn(!0);try{s()}finally{Qn(!1)}}return c.memoizedState=[m,a],m}function Sp(s,a,c){return c===void 0||(ai&1073741824)!==0&&(ft&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=Cv(),at.lanes|=s,sa|=s,c)}function Cb(s,a,c,m){return Sr(c,a)?c:wl.current!==null?(s=Sp(s,c,m),Sr(s,a)||(yn=!0),s):(ai&42)===0||(ai&1073741824)!==0&&(ft&261930)===0?(yn=!0,s.memoizedState=c):(s=Cv(),at.lanes|=s,sa|=s,a)}function Tb(s,a,c,m,v){var E=W.p;W.p=E!==0&&8>E?E:8;var z=X.T,Q={};X.T=Q,Tp(s,!1,a,c);try{var se=v(),pe=X.S;if(pe!==null&&pe(Q,se),se!==null&&typeof se=="object"&&typeof se.then=="function"){var Ce=VA(se,m);su(s,a,Ce,Rr(s))}else su(s,a,m,Rr(s))}catch(De){su(s,a,{then:function(){},status:"rejected",reason:De},Rr())}finally{W.p=E,z!==null&&Q.types!==null&&(z.types=Q.types),X.T=z}}function QA(){}function Ep(s,a,c,m){if(s.tag!==5)throw Error(r(476));var v=Ab(s).queue;Tb(s,v,a,te,c===null?QA:function(){return jb(s),c(m)})}function Ab(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:oi,lastRenderedState:te},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:oi,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function jb(s){var a=Ab(s);a.next===null&&(a=s.alternate.memoizedState),su(s,a.next.queue,{},Rr())}function Cp(){return zn(xu)}function Rb(){return ln().memoizedState}function Ib(){return ln().memoizedState}function KA(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=Rr();s=Zi(c);var m=Ji(a,s,c);m!==null&&(pr(m,a,c),Jc(m,a,c)),a={cache:ep()},s.payload=a;return}a=a.return}}function YA(s,a,c){var m=Rr();c={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},hh(s)?kb(a,c):(c=$m(s,a,c,m),c!==null&&(pr(c,s,m),Mb(c,a,m)))}function Db(s,a,c){var m=Rr();su(s,a,c,m)}function su(s,a,c,m){var v={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(hh(s))kb(a,v);else{var E=s.alternate;if(s.lanes===0&&(E===null||E.lanes===0)&&(E=a.lastRenderedReducer,E!==null))try{var z=a.lastRenderedState,Q=E(z,c);if(v.hasEagerState=!0,v.eagerState=Q,Sr(Q,z))return Gd(s,a,v,0),Ut===null&&Hd(),!1}catch{}if(c=$m(s,a,v,m),c!==null)return pr(c,s,m),Mb(c,a,m),!0}return!1}function Tp(s,a,c,m){if(m={lane:2,revertLane:sg(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},hh(s)){if(a)throw Error(r(479))}else a=$m(s,c,m,2),a!==null&&pr(a,s,2)}function hh(s){var a=s.alternate;return s===at||a!==null&&a===at}function kb(s,a){Sl=ih=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function Mb(s,a,c){if((c&4194048)!==0){var m=a.lanes;m&=s.pendingLanes,c|=m,a.lanes=c,Tc(s,c)}}var iu={readContext:zn,use:lh,useCallback:rn,useContext:rn,useEffect:rn,useImperativeHandle:rn,useLayoutEffect:rn,useInsertionEffect:rn,useMemo:rn,useReducer:rn,useRef:rn,useState:rn,useDebugValue:rn,useDeferredValue:rn,useTransition:rn,useSyncExternalStore:rn,useId:rn,useHostTransitionStatus:rn,useFormState:rn,useActionState:rn,useOptimistic:rn,useMemoCache:rn,useCacheRefresh:rn};iu.useEffectEvent=rn;var Ob={readContext:zn,use:lh,useCallback:function(s,a){return ir().memoizedState=[s,a===void 0?null:a],s},useContext:zn,useEffect:yb,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,uh(4194308,4,xb.bind(null,a,s),c)},useLayoutEffect:function(s,a){return uh(4194308,4,s,a)},useInsertionEffect:function(s,a){uh(4,2,s,a)},useMemo:function(s,a){var c=ir();a=a===void 0?null:a;var m=s();if(vo){Qn(!0);try{s()}finally{Qn(!1)}}return c.memoizedState=[m,a],m},useReducer:function(s,a,c){var m=ir();if(c!==void 0){var v=c(a);if(vo){Qn(!0);try{c(a)}finally{Qn(!1)}}}else v=a;return m.memoizedState=m.baseState=v,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:v},m.queue=s,s=s.dispatch=YA.bind(null,at,s),[m.memoizedState,s]},useRef:function(s){var a=ir();return s={current:s},a.memoizedState=s},useState:function(s){s=bp(s);var a=s.queue,c=Db.bind(null,at,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:wp,useDeferredValue:function(s,a){var c=ir();return Sp(c,s,a)},useTransition:function(){var s=bp(!1);return s=Tb.bind(null,at,s.queue,!0,!1),ir().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var m=at,v=ir();if(_t){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),Ut===null)throw Error(r(349));(ft&127)!==0||tb(m,a,c)}v.memoizedState=c;var E={value:c,getSnapshot:a};return v.queue=E,yb(rb.bind(null,m,E,s),[s]),m.flags|=2048,Cl(9,{destroy:void 0},nb.bind(null,m,E,c,a),null),c},useId:function(){var s=ir(),a=Ut.identifierPrefix;if(_t){var c=Ns,m=Os;c=(m&~(1<<32-Et(m)-1)).toString(32)+c,a="_"+a+"R_"+c,c=ah++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=$A++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:Cp,useFormState:hb,useActionState:hb,useOptimistic:function(s){var a=ir();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=Tp.bind(null,at,!0,c),c.dispatch=a,[s,a]},useMemoCache:gp,useCacheRefresh:function(){return ir().memoizedState=KA.bind(null,at)},useEffectEvent:function(s){var a=ir(),c={impl:s};return a.memoizedState=c,function(){if((Tt&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},Ap={readContext:zn,use:lh,useCallback:Sb,useContext:zn,useEffect:xp,useImperativeHandle:wb,useInsertionEffect:bb,useLayoutEffect:vb,useMemo:Eb,useReducer:ch,useRef:gb,useState:function(){return ch(oi)},useDebugValue:wp,useDeferredValue:function(s,a){var c=ln();return Cb(c,Ot.memoizedState,s,a)},useTransition:function(){var s=ch(oi)[0],a=ln().memoizedState;return[typeof s=="boolean"?s:ru(s),a]},useSyncExternalStore:eb,useId:Rb,useHostTransitionStatus:Cp,useFormState:fb,useActionState:fb,useOptimistic:function(s,a){var c=ln();return ab(c,Ot,s,a)},useMemoCache:gp,useCacheRefresh:Ib};Ap.useEffectEvent=_b;var Nb={readContext:zn,use:lh,useCallback:Sb,useContext:zn,useEffect:xp,useImperativeHandle:wb,useInsertionEffect:bb,useLayoutEffect:vb,useMemo:Eb,useReducer:_p,useRef:gb,useState:function(){return _p(oi)},useDebugValue:wp,useDeferredValue:function(s,a){var c=ln();return Ot===null?Sp(c,s,a):Cb(c,Ot.memoizedState,s,a)},useTransition:function(){var s=_p(oi)[0],a=ln().memoizedState;return[typeof s=="boolean"?s:ru(s),a]},useSyncExternalStore:eb,useId:Rb,useHostTransitionStatus:Cp,useFormState:pb,useActionState:pb,useOptimistic:function(s,a){var c=ln();return Ot!==null?ab(c,Ot,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:gp,useCacheRefresh:Ib};Nb.useEffectEvent=_b;function jp(s,a,c,m){a=s.memoizedState,c=c(m,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var Rp={enqueueSetState:function(s,a,c){s=s._reactInternals;var m=Rr(),v=Zi(m);v.payload=a,c!=null&&(v.callback=c),a=Ji(s,v,m),a!==null&&(pr(a,s,m),Jc(a,s,m))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var m=Rr(),v=Zi(m);v.tag=1,v.payload=a,c!=null&&(v.callback=c),a=Ji(s,v,m),a!==null&&(pr(a,s,m),Jc(a,s,m))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=Rr(),m=Zi(c);m.tag=2,a!=null&&(m.callback=a),a=Ji(s,m,c),a!==null&&(pr(a,s,c),Jc(a,s,c))}};function Pb(s,a,c,m,v,E,z){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(m,E,z):a.prototype&&a.prototype.isPureReactComponent?!Hc(c,m)||!Hc(v,E):!0}function Bb(s,a,c,m){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,m),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,m),a.state!==s&&Rp.enqueueReplaceState(a,a.state,null)}function xo(s,a){var c=a;if("ref"in a){c={};for(var m in a)m!=="ref"&&(c[m]=a[m])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var v in s)c[v]===void 0&&(c[v]=s[v])}return c}function zb(s){qd(s)}function Lb(s){console.error(s)}function Ub(s){qd(s)}function fh(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(m){setTimeout(function(){throw m})}}function Fb(s,a,c){try{var m=s.onCaughtError;m(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function Ip(s,a,c){return c=Zi(c),c.tag=3,c.payload={element:null},c.callback=function(){fh(s,a)},c}function Vb(s){return s=Zi(s),s.tag=3,s}function $b(s,a,c,m){var v=c.type.getDerivedStateFromError;if(typeof v=="function"){var E=m.value;s.payload=function(){return v(E)},s.callback=function(){Fb(a,c,m)}}var z=c.stateNode;z!==null&&typeof z.componentDidCatch=="function"&&(s.callback=function(){Fb(a,c,m),typeof v!="function"&&(ia===null?ia=new Set([this]):ia.add(this));var Q=m.stack;this.componentDidCatch(m.value,{componentStack:Q!==null?Q:""})})}function XA(s,a,c,m,v){if(c.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(a=c.alternate,a!==null&&yl(a,c,v,!0),c=Cr.current,c!==null){switch(c.tag){case 31:case 13:return qr===null?Ch():c.alternate===null&&sn===0&&(sn=3),c.flags&=-257,c.flags|=65536,c.lanes=v,m===eh?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([m]):a.add(m),tg(s,m,v)),!1;case 22:return c.flags|=65536,m===eh?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([m])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([m]):c.add(m)),tg(s,m,v)),!1}throw Error(r(435,c.tag))}return tg(s,m,v),Ch(),!1}if(_t)return a=Cr.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=v,m!==Km&&(s=Error(r(422),{cause:m}),Qc(Ur(s,c)))):(m!==Km&&(a=Error(r(423),{cause:m}),Qc(Ur(a,c))),s=s.current.alternate,s.flags|=65536,v&=-v,s.lanes|=v,m=Ur(m,c),v=Ip(s.stateNode,m,v),ap(s,v),sn!==4&&(sn=2)),!1;var E=Error(r(520),{cause:m});if(E=Ur(E,c),fu===null?fu=[E]:fu.push(E),sn!==4&&(sn=2),a===null)return!0;m=Ur(m,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=v&-v,c.lanes|=s,s=Ip(c.stateNode,m,s),ap(c,s),!1;case 1:if(a=c.type,E=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(ia===null||!ia.has(E))))return c.flags|=65536,v&=-v,c.lanes|=v,v=Vb(v),$b(v,s,c,m),ap(c,v),!1}c=c.return}while(c!==null);return!1}var Dp=Error(r(461)),yn=!1;function Ln(s,a,c,m){a.child=s===null?W0(a,null,c,m):bo(a,s.child,c,m)}function qb(s,a,c,m,v){c=c.render;var E=a.ref;if("ref"in m){var z={};for(var Q in m)Q!=="ref"&&(z[Q]=m[Q])}else z=m;return po(a),m=hp(s,a,c,z,E,v),Q=fp(),s!==null&&!yn?(mp(s,a,v),li(s,a,v)):(_t&&Q&&Wm(a),a.flags|=1,Ln(s,a,m,v),a.child)}function Hb(s,a,c,m,v){if(s===null){var E=c.type;return typeof E=="function"&&!qm(E)&&E.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=E,Gb(s,a,E,m,v)):(s=Qd(c.type,null,m,a,a.mode,v),s.ref=a.ref,s.return=a,a.child=s)}if(E=s.child,!Lp(s,v)){var z=E.memoizedProps;if(c=c.compare,c=c!==null?c:Hc,c(z,m)&&s.ref===a.ref)return li(s,a,v)}return a.flags|=1,s=ni(E,m),s.ref=a.ref,s.return=a,a.child=s}function Gb(s,a,c,m,v){if(s!==null){var E=s.memoizedProps;if(Hc(E,m)&&s.ref===a.ref)if(yn=!1,a.pendingProps=m=E,Lp(s,v))(s.flags&131072)!==0&&(yn=!0);else return a.lanes=s.lanes,li(s,a,v)}return kp(s,a,c,m,v)}function Wb(s,a,c,m){var v=m.children,E=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((a.flags&128)!==0){if(E=E!==null?E.baseLanes|c:c,s!==null){for(m=a.child=s.child,v=0;m!==null;)v=v|m.lanes|m.childLanes,m=m.sibling;m=v&~E}else m=0,a.child=null;return Qb(s,a,E,c,m)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&Zd(a,E!==null?E.cachePool:null),E!==null?Y0(a,E):lp(),X0(a);else return m=a.lanes=536870912,Qb(s,a,E!==null?E.baseLanes|c:c,c,m)}else E!==null?(Zd(a,E.cachePool),Y0(a,E),ta(),a.memoizedState=null):(s!==null&&Zd(a,null),lp(),ta());return Ln(s,a,v,c),a.child}function au(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Qb(s,a,c,m,v){var E=np();return E=E===null?null:{parent:pn._currentValue,pool:E},a.memoizedState={baseLanes:c,cachePool:E},s!==null&&Zd(a,null),lp(),X0(a),s!==null&&yl(s,a,m,!0),a.childLanes=v,null}function mh(s,a){return a=gh({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function Kb(s,a,c){return bo(a,s.child,null,c),s=mh(a,a.pendingProps),s.flags|=2,Tr(a),a.memoizedState=null,s}function ZA(s,a,c){var m=a.pendingProps,v=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(_t){if(m.mode==="hidden")return s=mh(a,m),a.lanes=536870912,au(null,s);if(up(a),(s=qt)?(s=ox(s,$r),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Wi!==null?{id:Os,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},c=k0(s),c.return=a,a.child=c,Bn=a,qt=null)):s=null,s===null)throw Ki(a);return a.lanes=536870912,null}return mh(a,m)}var E=s.memoizedState;if(E!==null){var z=E.dehydrated;if(up(a),v)if(a.flags&256)a.flags&=-257,a=Kb(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(r(558));else if(yn||yl(s,a,c,!1),v=(c&s.childLanes)!==0,yn||v){if(m=Ut,m!==null&&(z=Ac(m,c),z!==0&&z!==E.retryLane))throw E.retryLane=z,uo(s,z),pr(m,s,z),Dp;Ch(),a=Kb(s,a,c)}else s=E.treeContext,qt=Hr(z.nextSibling),Bn=a,_t=!0,Qi=null,$r=!1,s!==null&&N0(a,s),a=mh(a,m),a.flags|=4096;return a}return s=ni(s.child,{mode:m.mode,children:m.children}),s.ref=a.ref,a.child=s,s.return=a,s}function ph(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function kp(s,a,c,m,v){return po(a),c=hp(s,a,c,m,void 0,v),m=fp(),s!==null&&!yn?(mp(s,a,v),li(s,a,v)):(_t&&m&&Wm(a),a.flags|=1,Ln(s,a,c,v),a.child)}function Yb(s,a,c,m,v,E){return po(a),a.updateQueue=null,c=J0(a,m,c,v),Z0(s),m=fp(),s!==null&&!yn?(mp(s,a,E),li(s,a,E)):(_t&&m&&Wm(a),a.flags|=1,Ln(s,a,c,E),a.child)}function Xb(s,a,c,m,v){if(po(a),a.stateNode===null){var E=fl,z=c.contextType;typeof z=="object"&&z!==null&&(E=zn(z)),E=new c(m,E),a.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=Rp,a.stateNode=E,E._reactInternals=a,E=a.stateNode,E.props=m,E.state=a.memoizedState,E.refs={},sp(a),z=c.contextType,E.context=typeof z=="object"&&z!==null?zn(z):fl,E.state=a.memoizedState,z=c.getDerivedStateFromProps,typeof z=="function"&&(jp(a,c,z,m),E.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(z=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),z!==E.state&&Rp.enqueueReplaceState(E,E.state,null),tu(a,m,E,v),eu(),E.state=a.memoizedState),typeof E.componentDidMount=="function"&&(a.flags|=4194308),m=!0}else if(s===null){E=a.stateNode;var Q=a.memoizedProps,se=xo(c,Q);E.props=se;var pe=E.context,Ce=c.contextType;z=fl,typeof Ce=="object"&&Ce!==null&&(z=zn(Ce));var De=c.getDerivedStateFromProps;Ce=typeof De=="function"||typeof E.getSnapshotBeforeUpdate=="function",Q=a.pendingProps!==Q,Ce||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(Q||pe!==z)&&Bb(a,E,m,z),Xi=!1;var _e=a.memoizedState;E.state=_e,tu(a,m,E,v),eu(),pe=a.memoizedState,Q||_e!==pe||Xi?(typeof De=="function"&&(jp(a,c,De,m),pe=a.memoizedState),(se=Xi||Pb(a,c,se,m,_e,pe,z))?(Ce||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(a.flags|=4194308)):(typeof E.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=m,a.memoizedState=pe),E.props=m,E.state=pe,E.context=z,m=se):(typeof E.componentDidMount=="function"&&(a.flags|=4194308),m=!1)}else{E=a.stateNode,ip(s,a),z=a.memoizedProps,Ce=xo(c,z),E.props=Ce,De=a.pendingProps,_e=E.context,pe=c.contextType,se=fl,typeof pe=="object"&&pe!==null&&(se=zn(pe)),Q=c.getDerivedStateFromProps,(pe=typeof Q=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(z!==De||_e!==se)&&Bb(a,E,m,se),Xi=!1,_e=a.memoizedState,E.state=_e,tu(a,m,E,v),eu();var ve=a.memoizedState;z!==De||_e!==ve||Xi||s!==null&&s.dependencies!==null&&Yd(s.dependencies)?(typeof Q=="function"&&(jp(a,c,Q,m),ve=a.memoizedState),(Ce=Xi||Pb(a,c,Ce,m,_e,ve,se)||s!==null&&s.dependencies!==null&&Yd(s.dependencies))?(pe||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(m,ve,se),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(m,ve,se)),typeof E.componentDidUpdate=="function"&&(a.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof E.componentDidUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),a.memoizedProps=m,a.memoizedState=ve),E.props=m,E.state=ve,E.context=se,m=Ce):(typeof E.componentDidUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||z===s.memoizedProps&&_e===s.memoizedState||(a.flags|=1024),m=!1)}return E=m,ph(s,a),m=(a.flags&128)!==0,E||m?(E=a.stateNode,c=m&&typeof c.getDerivedStateFromError!="function"?null:E.render(),a.flags|=1,s!==null&&m?(a.child=bo(a,s.child,null,v),a.child=bo(a,null,c,v)):Ln(s,a,c,v),a.memoizedState=E.state,s=a.child):s=li(s,a,v),s}function Zb(s,a,c,m){return fo(),a.flags|=256,Ln(s,a,c,m),a.child}var Mp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Op(s){return{baseLanes:s,cachePool:F0()}}function Np(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=jr),s}function Jb(s,a,c){var m=a.pendingProps,v=!1,E=(a.flags&128)!==0,z;if((z=E)||(z=s!==null&&s.memoizedState===null?!1:(on.current&2)!==0),z&&(v=!0,a.flags&=-129),z=(a.flags&32)!==0,a.flags&=-33,s===null){if(_t){if(v?ea(a):ta(),(s=qt)?(s=ox(s,$r),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Wi!==null?{id:Os,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},c=k0(s),c.return=a,a.child=c,Bn=a,qt=null)):s=null,s===null)throw Ki(a);return yg(s)?a.lanes=32:a.lanes=536870912,null}var Q=m.children;return m=m.fallback,v?(ta(),v=a.mode,Q=gh({mode:"hidden",children:Q},v),m=ho(m,v,c,null),Q.return=a,m.return=a,Q.sibling=m,a.child=Q,m=a.child,m.memoizedState=Op(c),m.childLanes=Np(s,z,c),a.memoizedState=Mp,au(null,m)):(ea(a),Pp(a,Q))}var se=s.memoizedState;if(se!==null&&(Q=se.dehydrated,Q!==null)){if(E)a.flags&256?(ea(a),a.flags&=-257,a=Bp(s,a,c)):a.memoizedState!==null?(ta(),a.child=s.child,a.flags|=128,a=null):(ta(),Q=m.fallback,v=a.mode,m=gh({mode:"visible",children:m.children},v),Q=ho(Q,v,c,null),Q.flags|=2,m.return=a,Q.return=a,m.sibling=Q,a.child=m,bo(a,s.child,null,c),m=a.child,m.memoizedState=Op(c),m.childLanes=Np(s,z,c),a.memoizedState=Mp,a=au(null,m));else if(ea(a),yg(Q)){if(z=Q.nextSibling&&Q.nextSibling.dataset,z)var pe=z.dgst;z=pe,m=Error(r(419)),m.stack="",m.digest=z,Qc({value:m,source:null,stack:null}),a=Bp(s,a,c)}else if(yn||yl(s,a,c,!1),z=(c&s.childLanes)!==0,yn||z){if(z=Ut,z!==null&&(m=Ac(z,c),m!==0&&m!==se.retryLane))throw se.retryLane=m,uo(s,m),pr(z,s,m),Dp;gg(Q)||Ch(),a=Bp(s,a,c)}else gg(Q)?(a.flags|=192,a.child=s.child,a=null):(s=se.treeContext,qt=Hr(Q.nextSibling),Bn=a,_t=!0,Qi=null,$r=!1,s!==null&&N0(a,s),a=Pp(a,m.children),a.flags|=4096);return a}return v?(ta(),Q=m.fallback,v=a.mode,se=s.child,pe=se.sibling,m=ni(se,{mode:"hidden",children:m.children}),m.subtreeFlags=se.subtreeFlags&65011712,pe!==null?Q=ni(pe,Q):(Q=ho(Q,v,c,null),Q.flags|=2),Q.return=a,m.return=a,m.sibling=Q,a.child=m,au(null,m),m=a.child,Q=s.child.memoizedState,Q===null?Q=Op(c):(v=Q.cachePool,v!==null?(se=pn._currentValue,v=v.parent!==se?{parent:se,pool:se}:v):v=F0(),Q={baseLanes:Q.baseLanes|c,cachePool:v}),m.memoizedState=Q,m.childLanes=Np(s,z,c),a.memoizedState=Mp,au(s.child,m)):(ea(a),c=s.child,s=c.sibling,c=ni(c,{mode:"visible",children:m.children}),c.return=a,c.sibling=null,s!==null&&(z=a.deletions,z===null?(a.deletions=[s],a.flags|=16):z.push(s)),a.child=c,a.memoizedState=null,c)}function Pp(s,a){return a=gh({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function gh(s,a){return s=Er(22,s,null,a),s.lanes=0,s}function Bp(s,a,c){return bo(a,s.child,null,c),s=Pp(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function ev(s,a,c){s.lanes|=a;var m=s.alternate;m!==null&&(m.lanes|=a),Zm(s.return,a,c)}function zp(s,a,c,m,v,E){var z=s.memoizedState;z===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:m,tail:c,tailMode:v,treeForkCount:E}:(z.isBackwards=a,z.rendering=null,z.renderingStartTime=0,z.last=m,z.tail=c,z.tailMode=v,z.treeForkCount=E)}function tv(s,a,c){var m=a.pendingProps,v=m.revealOrder,E=m.tail;m=m.children;var z=on.current,Q=(z&2)!==0;if(Q?(z=z&1|2,a.flags|=128):z&=1,J(on,z),Ln(s,a,m,c),m=_t?Wc:0,!Q&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&ev(s,c,a);else if(s.tag===19)ev(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(v){case"forwards":for(c=a.child,v=null;c!==null;)s=c.alternate,s!==null&&sh(s)===null&&(v=c),c=c.sibling;c=v,c===null?(v=a.child,a.child=null):(v=c.sibling,c.sibling=null),zp(a,!1,v,c,E,m);break;case"backwards":case"unstable_legacy-backwards":for(c=null,v=a.child,a.child=null;v!==null;){if(s=v.alternate,s!==null&&sh(s)===null){a.child=v;break}s=v.sibling,v.sibling=c,c=v,v=s}zp(a,!0,c,null,E,m);break;case"together":zp(a,!1,null,null,void 0,m);break;default:a.memoizedState=null}return a.child}function li(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),sa|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(yl(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(r(153));if(a.child!==null){for(s=a.child,c=ni(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=ni(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Lp(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&Yd(s)))}function JA(s,a,c){switch(a.tag){case 3:ce(a,a.stateNode.containerInfo),Yi(a,pn,s.memoizedState.cache),fo();break;case 27:case 5:Oe(a);break;case 4:ce(a,a.stateNode.containerInfo);break;case 10:Yi(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,up(a),null;break;case 13:var m=a.memoizedState;if(m!==null)return m.dehydrated!==null?(ea(a),a.flags|=128,null):(c&a.child.childLanes)!==0?Jb(s,a,c):(ea(a),s=li(s,a,c),s!==null?s.sibling:null);ea(a);break;case 19:var v=(s.flags&128)!==0;if(m=(c&a.childLanes)!==0,m||(yl(s,a,c,!1),m=(c&a.childLanes)!==0),v){if(m)return tv(s,a,c);a.flags|=128}if(v=a.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),J(on,on.current),m)break;return null;case 22:return a.lanes=0,Wb(s,a,c,a.pendingProps);case 24:Yi(a,pn,s.memoizedState.cache)}return li(s,a,c)}function nv(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)yn=!0;else{if(!Lp(s,c)&&(a.flags&128)===0)return yn=!1,JA(s,a,c);yn=(s.flags&131072)!==0}else yn=!1,_t&&(a.flags&1048576)!==0&&O0(a,Wc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var m=a.pendingProps;if(s=yo(a.elementType),a.type=s,typeof s=="function")qm(s)?(m=xo(s,m),a.tag=1,a=Xb(null,a,s,m,c)):(a.tag=0,a=kp(null,a,s,m,c));else{if(s!=null){var v=s.$$typeof;if(v===M){a.tag=11,a=qb(null,a,s,m,c);break e}else if(v===D){a.tag=14,a=Hb(null,a,s,m,c);break e}}throw a=k(s)||s,Error(r(306,a,""))}}return a;case 0:return kp(s,a,a.type,a.pendingProps,c);case 1:return m=a.type,v=xo(m,a.pendingProps),Xb(s,a,m,v,c);case 3:e:{if(ce(a,a.stateNode.containerInfo),s===null)throw Error(r(387));m=a.pendingProps;var E=a.memoizedState;v=E.element,ip(s,a),tu(a,m,null,c);var z=a.memoizedState;if(m=z.cache,Yi(a,pn,m),m!==E.cache&&Jm(a,[pn],c,!0),eu(),m=z.element,E.isDehydrated)if(E={element:m,isDehydrated:!1,cache:z.cache},a.updateQueue.baseState=E,a.memoizedState=E,a.flags&256){a=Zb(s,a,m,c);break e}else if(m!==v){v=Ur(Error(r(424)),a),Qc(v),a=Zb(s,a,m,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,qt=Hr(s.firstChild),Bn=a,_t=!0,Qi=null,$r=!0,c=W0(a,null,m,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(fo(),m===v){a=li(s,a,c);break e}Ln(s,a,m,c)}a=a.child}return a;case 26:return ph(s,a),s===null?(c=fx(a.type,null,a.pendingProps,null))?a.memoizedState=c:_t||(c=a.type,s=a.pendingProps,m=kh(Ee.current).createElement(c),m[hn]=a,m[Dn]=s,Un(m,c,s),fn(m),a.stateNode=m):a.memoizedState=fx(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return Oe(a),s===null&&_t&&(m=a.stateNode=ux(a.type,a.pendingProps,Ee.current),Bn=a,$r=!0,v=qt,ca(a.type)?(_g=v,qt=Hr(m.firstChild)):qt=v),Ln(s,a,a.pendingProps.children,c),ph(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&_t&&((v=m=qt)&&(m=Rj(m,a.type,a.pendingProps,$r),m!==null?(a.stateNode=m,Bn=a,qt=Hr(m.firstChild),$r=!1,v=!0):v=!1),v||Ki(a)),Oe(a),v=a.type,E=a.pendingProps,z=s!==null?s.memoizedProps:null,m=E.children,fg(v,E)?m=null:z!==null&&fg(v,z)&&(a.flags|=32),a.memoizedState!==null&&(v=hp(s,a,qA,null,null,c),xu._currentValue=v),ph(s,a),Ln(s,a,m,c),a.child;case 6:return s===null&&_t&&((s=c=qt)&&(c=Ij(c,a.pendingProps,$r),c!==null?(a.stateNode=c,Bn=a,qt=null,s=!0):s=!1),s||Ki(a)),null;case 13:return Jb(s,a,c);case 4:return ce(a,a.stateNode.containerInfo),m=a.pendingProps,s===null?a.child=bo(a,null,m,c):Ln(s,a,m,c),a.child;case 11:return qb(s,a,a.type,a.pendingProps,c);case 7:return Ln(s,a,a.pendingProps,c),a.child;case 8:return Ln(s,a,a.pendingProps.children,c),a.child;case 12:return Ln(s,a,a.pendingProps.children,c),a.child;case 10:return m=a.pendingProps,Yi(a,a.type,m.value),Ln(s,a,m.children,c),a.child;case 9:return v=a.type._context,m=a.pendingProps.children,po(a),v=zn(v),m=m(v),a.flags|=1,Ln(s,a,m,c),a.child;case 14:return Hb(s,a,a.type,a.pendingProps,c);case 15:return Gb(s,a,a.type,a.pendingProps,c);case 19:return tv(s,a,c);case 31:return ZA(s,a,c);case 22:return Wb(s,a,c,a.pendingProps);case 24:return po(a),m=zn(pn),s===null?(v=np(),v===null&&(v=Ut,E=ep(),v.pooledCache=E,E.refCount++,E!==null&&(v.pooledCacheLanes|=c),v=E),a.memoizedState={parent:m,cache:v},sp(a),Yi(a,pn,v)):((s.lanes&c)!==0&&(ip(s,a),tu(a,null,null,c),eu()),v=s.memoizedState,E=a.memoizedState,v.parent!==m?(v={parent:m,cache:m},a.memoizedState=v,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=v),Yi(a,pn,m)):(m=E.cache,Yi(a,pn,m),m!==v.cache&&Jm(a,[pn],c,!0))),Ln(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function ci(s){s.flags|=4}function Up(s,a,c,m,v){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(v&335544128)===v)if(s.stateNode.complete)s.flags|=8192;else if(Rv())s.flags|=8192;else throw _o=eh,rp}else s.flags&=-16777217}function rv(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!_x(a))if(Rv())s.flags|=8192;else throw _o=eh,rp}function yh(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?Sd():536870912,s.lanes|=a,Rl|=a)}function ou(s,a){if(!_t)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var m=null;c!==null;)c.alternate!==null&&(m=c),c=c.sibling;m===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:m.sibling=null}}function Ht(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,m=0;if(a)for(var v=s.child;v!==null;)c|=v.lanes|v.childLanes,m|=v.subtreeFlags&65011712,m|=v.flags&65011712,v.return=s,v=v.sibling;else for(v=s.child;v!==null;)c|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=s,v=v.sibling;return s.subtreeFlags|=m,s.childLanes=c,a}function ej(s,a,c){var m=a.pendingProps;switch(Qm(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ht(a),null;case 1:return Ht(a),null;case 3:return c=a.stateNode,m=null,s!==null&&(m=s.memoizedState.cache),a.memoizedState.cache!==m&&(a.flags|=2048),ii(pn),fe(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(gl(a)?ci(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Ym())),Ht(a),null;case 26:var v=a.type,E=a.memoizedState;return s===null?(ci(a),E!==null?(Ht(a),rv(a,E)):(Ht(a),Up(a,v,null,m,c))):E?E!==s.memoizedState?(ci(a),Ht(a),rv(a,E)):(Ht(a),a.flags&=-16777217):(s=s.memoizedProps,s!==m&&ci(a),Ht(a),Up(a,v,s,m,c)),null;case 27:if(Me(a),c=Ee.current,v=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&ci(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return Ht(a),null}s=ne.current,gl(a)?P0(a):(s=ux(v,m,c),a.stateNode=s,ci(a))}return Ht(a),null;case 5:if(Me(a),v=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&ci(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return Ht(a),null}if(E=ne.current,gl(a))P0(a);else{var z=kh(Ee.current);switch(E){case 1:E=z.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:E=z.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":E=z.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":E=z.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":E=z.createElement("div"),E.innerHTML="<script><\/script>",E=E.removeChild(E.firstChild);break;case"select":E=typeof m.is=="string"?z.createElement("select",{is:m.is}):z.createElement("select"),m.multiple?E.multiple=!0:m.size&&(E.size=m.size);break;default:E=typeof m.is=="string"?z.createElement(v,{is:m.is}):z.createElement(v)}}E[hn]=a,E[Dn]=m;e:for(z=a.child;z!==null;){if(z.tag===5||z.tag===6)E.appendChild(z.stateNode);else if(z.tag!==4&&z.tag!==27&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===a)break e;for(;z.sibling===null;){if(z.return===null||z.return===a)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}a.stateNode=E;e:switch(Un(E,v,m),v){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&ci(a)}}return Ht(a),Up(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==m&&ci(a);else{if(typeof m!="string"&&a.stateNode===null)throw Error(r(166));if(s=Ee.current,gl(a)){if(s=a.stateNode,c=a.memoizedProps,m=null,v=Bn,v!==null)switch(v.tag){case 27:case 5:m=v.memoizedProps}s[hn]=a,s=!!(s.nodeValue===c||m!==null&&m.suppressHydrationWarning===!0||Jv(s.nodeValue,c)),s||Ki(a,!0)}else s=kh(s).createTextNode(m),s[hn]=a,a.stateNode=s}return Ht(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(m=gl(a),c!==null){if(s===null){if(!m)throw Error(r(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[hn]=a}else fo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ht(a),s=!1}else c=Ym(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(Tr(a),a):(Tr(a),null);if((a.flags&128)!==0)throw Error(r(558))}return Ht(a),null;case 13:if(m=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(v=gl(a),m!==null&&m.dehydrated!==null){if(s===null){if(!v)throw Error(r(318));if(v=a.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[hn]=a}else fo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Ht(a),v=!1}else v=Ym(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=v),v=!0;if(!v)return a.flags&256?(Tr(a),a):(Tr(a),null)}return Tr(a),(a.flags&128)!==0?(a.lanes=c,a):(c=m!==null,s=s!==null&&s.memoizedState!==null,c&&(m=a.child,v=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(v=m.alternate.memoizedState.cachePool.pool),E=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(E=m.memoizedState.cachePool.pool),E!==v&&(m.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),yh(a,a.updateQueue),Ht(a),null);case 4:return fe(),s===null&&lg(a.stateNode.containerInfo),Ht(a),null;case 10:return ii(a.type),Ht(a),null;case 19:if(q(on),m=a.memoizedState,m===null)return Ht(a),null;if(v=(a.flags&128)!==0,E=m.rendering,E===null)if(v)ou(m,!1);else{if(sn!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(E=sh(s),E!==null){for(a.flags|=128,ou(m,!1),s=E.updateQueue,a.updateQueue=s,yh(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)D0(c,s),c=c.sibling;return J(on,on.current&1|2),_t&&ri(a,m.treeForkCount),a.child}s=s.sibling}m.tail!==null&&Pe()>wh&&(a.flags|=128,v=!0,ou(m,!1),a.lanes=4194304)}else{if(!v)if(s=sh(E),s!==null){if(a.flags|=128,v=!0,s=s.updateQueue,a.updateQueue=s,yh(a,s),ou(m,!0),m.tail===null&&m.tailMode==="hidden"&&!E.alternate&&!_t)return Ht(a),null}else 2*Pe()-m.renderingStartTime>wh&&c!==536870912&&(a.flags|=128,v=!0,ou(m,!1),a.lanes=4194304);m.isBackwards?(E.sibling=a.child,a.child=E):(s=m.last,s!==null?s.sibling=E:a.child=E,m.last=E)}return m.tail!==null?(s=m.tail,m.rendering=s,m.tail=s.sibling,m.renderingStartTime=Pe(),s.sibling=null,c=on.current,J(on,v?c&1|2:c&1),_t&&ri(a,m.treeForkCount),s):(Ht(a),null);case 22:case 23:return Tr(a),cp(),m=a.memoizedState!==null,s!==null?s.memoizedState!==null!==m&&(a.flags|=8192):m&&(a.flags|=8192),m?(c&536870912)!==0&&(a.flags&128)===0&&(Ht(a),a.subtreeFlags&6&&(a.flags|=8192)):Ht(a),c=a.updateQueue,c!==null&&yh(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),m=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),m!==c&&(a.flags|=2048),s!==null&&q(go),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),ii(pn),Ht(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function tj(s,a){switch(Qm(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return ii(pn),fe(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Me(a),null;case 31:if(a.memoizedState!==null){if(Tr(a),a.alternate===null)throw Error(r(340));fo()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(Tr(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(r(340));fo()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return q(on),null;case 4:return fe(),null;case 10:return ii(a.type),null;case 22:case 23:return Tr(a),cp(),s!==null&&q(go),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return ii(pn),null;case 25:return null;default:return null}}function sv(s,a){switch(Qm(a),a.tag){case 3:ii(pn),fe();break;case 26:case 27:case 5:Me(a);break;case 4:fe();break;case 31:a.memoizedState!==null&&Tr(a);break;case 13:Tr(a);break;case 19:q(on);break;case 10:ii(a.type);break;case 22:case 23:Tr(a),cp(),s!==null&&q(go);break;case 24:ii(pn)}}function lu(s,a){try{var c=a.updateQueue,m=c!==null?c.lastEffect:null;if(m!==null){var v=m.next;c=v;do{if((c.tag&s)===s){m=void 0;var E=c.create,z=c.inst;m=E(),z.destroy=m}c=c.next}while(c!==v)}}catch(Q){kt(a,a.return,Q)}}function na(s,a,c){try{var m=a.updateQueue,v=m!==null?m.lastEffect:null;if(v!==null){var E=v.next;m=E;do{if((m.tag&s)===s){var z=m.inst,Q=z.destroy;if(Q!==void 0){z.destroy=void 0,v=a;var se=c,pe=Q;try{pe()}catch(Ce){kt(v,se,Ce)}}}m=m.next}while(m!==E)}}catch(Ce){kt(a,a.return,Ce)}}function iv(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{K0(a,c)}catch(m){kt(s,s.return,m)}}}function av(s,a,c){c.props=xo(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(m){kt(s,a,m)}}function cu(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var m=s.stateNode;break;case 30:m=s.stateNode;break;default:m=s.stateNode}typeof c=="function"?s.refCleanup=c(m):c.current=m}}catch(v){kt(s,a,v)}}function Ps(s,a){var c=s.ref,m=s.refCleanup;if(c!==null)if(typeof m=="function")try{m()}catch(v){kt(s,a,v)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(v){kt(s,a,v)}else c.current=null}function ov(s){var a=s.type,c=s.memoizedProps,m=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&m.focus();break e;case"img":c.src?m.src=c.src:c.srcSet&&(m.srcset=c.srcSet)}}catch(v){kt(s,s.return,v)}}function Fp(s,a,c){try{var m=s.stateNode;Sj(m,s.type,c,a),m[Dn]=a}catch(v){kt(s,s.return,v)}}function lv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&ca(s.type)||s.tag===4}function Vp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||lv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&ca(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function $p(s,a,c){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=ts));else if(m!==4&&(m===27&&ca(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for($p(s,a,c),s=s.sibling;s!==null;)$p(s,a,c),s=s.sibling}function _h(s,a,c){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(m!==4&&(m===27&&ca(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(_h(s,a,c),s=s.sibling;s!==null;)_h(s,a,c),s=s.sibling}function cv(s){var a=s.stateNode,c=s.memoizedProps;try{for(var m=s.type,v=a.attributes;v.length;)a.removeAttributeNode(v[0]);Un(a,m,c),a[hn]=s,a[Dn]=c}catch(E){kt(s,s.return,E)}}var ui=!1,_n=!1,qp=!1,uv=typeof WeakSet=="function"?WeakSet:Set,Mn=null;function nj(s,a){if(s=s.containerInfo,dg=Lh,s=w0(s),Bm(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var m=c.getSelection&&c.getSelection();if(m&&m.rangeCount!==0){c=m.anchorNode;var v=m.anchorOffset,E=m.focusNode;m=m.focusOffset;try{c.nodeType,E.nodeType}catch{c=null;break e}var z=0,Q=-1,se=-1,pe=0,Ce=0,De=s,_e=null;t:for(;;){for(var ve;De!==c||v!==0&&De.nodeType!==3||(Q=z+v),De!==E||m!==0&&De.nodeType!==3||(se=z+m),De.nodeType===3&&(z+=De.nodeValue.length),(ve=De.firstChild)!==null;)_e=De,De=ve;for(;;){if(De===s)break t;if(_e===c&&++pe===v&&(Q=z),_e===E&&++Ce===m&&(se=z),(ve=De.nextSibling)!==null)break;De=_e,_e=De.parentNode}De=ve}c=Q===-1||se===-1?null:{start:Q,end:se}}else c=null}c=c||{start:0,end:0}}else c=null;for(hg={focusedElem:s,selectionRange:c},Lh=!1,Mn=a;Mn!==null;)if(a=Mn,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,Mn=s;else for(;Mn!==null;){switch(a=Mn,E=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)v=s[c],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&E!==null){s=void 0,c=a,v=E.memoizedProps,E=E.memoizedState,m=c.stateNode;try{var Fe=xo(c.type,v);s=m.getSnapshotBeforeUpdate(Fe,E),m.__reactInternalSnapshotBeforeUpdate=s}catch(Ke){kt(c,c.return,Ke)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)pg(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":pg(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=a.sibling,s!==null){s.return=a.return,Mn=s;break}Mn=a.return}}function dv(s,a,c){var m=c.flags;switch(c.tag){case 0:case 11:case 15:hi(s,c),m&4&&lu(5,c);break;case 1:if(hi(s,c),m&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(z){kt(c,c.return,z)}else{var v=xo(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(v,a,s.__reactInternalSnapshotBeforeUpdate)}catch(z){kt(c,c.return,z)}}m&64&&iv(c),m&512&&cu(c,c.return);break;case 3:if(hi(s,c),m&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{K0(s,a)}catch(z){kt(c,c.return,z)}}break;case 27:a===null&&m&4&&cv(c);case 26:case 5:hi(s,c),a===null&&m&4&&ov(c),m&512&&cu(c,c.return);break;case 12:hi(s,c);break;case 31:hi(s,c),m&4&&mv(s,c);break;case 13:hi(s,c),m&4&&pv(s,c),m&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=dj.bind(null,c),Dj(s,c))));break;case 22:if(m=c.memoizedState!==null||ui,!m){a=a!==null&&a.memoizedState!==null||_n,v=ui;var E=_n;ui=m,(_n=a)&&!E?fi(s,c,(c.subtreeFlags&8772)!==0):hi(s,c),ui=v,_n=E}break;case 30:break;default:hi(s,c)}}function hv(s){var a=s.alternate;a!==null&&(s.alternate=null,hv(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Jo(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Kt=null,dr=!1;function di(s,a,c){for(c=c.child;c!==null;)fv(s,a,c),c=c.sibling}function fv(s,a,c){if(nn&&typeof nn.onCommitFiberUnmount=="function")try{nn.onCommitFiberUnmount(vt,c)}catch{}switch(c.tag){case 26:_n||Ps(c,a),di(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:_n||Ps(c,a);var m=Kt,v=dr;ca(c.type)&&(Kt=c.stateNode,dr=!1),di(s,a,c),_u(c.stateNode),Kt=m,dr=v;break;case 5:_n||Ps(c,a);case 6:if(m=Kt,v=dr,Kt=null,di(s,a,c),Kt=m,dr=v,Kt!==null)if(dr)try{(Kt.nodeType===9?Kt.body:Kt.nodeName==="HTML"?Kt.ownerDocument.body:Kt).removeChild(c.stateNode)}catch(E){kt(c,a,E)}else try{Kt.removeChild(c.stateNode)}catch(E){kt(c,a,E)}break;case 18:Kt!==null&&(dr?(s=Kt,ix(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Bl(s)):ix(Kt,c.stateNode));break;case 4:m=Kt,v=dr,Kt=c.stateNode.containerInfo,dr=!0,di(s,a,c),Kt=m,dr=v;break;case 0:case 11:case 14:case 15:na(2,c,a),_n||na(4,c,a),di(s,a,c);break;case 1:_n||(Ps(c,a),m=c.stateNode,typeof m.componentWillUnmount=="function"&&av(c,a,m)),di(s,a,c);break;case 21:di(s,a,c);break;case 22:_n=(m=_n)||c.memoizedState!==null,di(s,a,c),_n=m;break;default:di(s,a,c)}}function mv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Bl(s)}catch(c){kt(a,a.return,c)}}}function pv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Bl(s)}catch(c){kt(a,a.return,c)}}function rj(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new uv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new uv),a;default:throw Error(r(435,s.tag))}}function bh(s,a){var c=rj(s);a.forEach(function(m){if(!c.has(m)){c.add(m);var v=hj.bind(null,s,m);m.then(v,v)}})}function hr(s,a){var c=a.deletions;if(c!==null)for(var m=0;m<c.length;m++){var v=c[m],E=s,z=a,Q=z;e:for(;Q!==null;){switch(Q.tag){case 27:if(ca(Q.type)){Kt=Q.stateNode,dr=!1;break e}break;case 5:Kt=Q.stateNode,dr=!1;break e;case 3:case 4:Kt=Q.stateNode.containerInfo,dr=!0;break e}Q=Q.return}if(Kt===null)throw Error(r(160));fv(E,z,v),Kt=null,dr=!1,E=v.alternate,E!==null&&(E.return=null),v.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)gv(a,s),a=a.sibling}var os=null;function gv(s,a){var c=s.alternate,m=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:hr(a,s),fr(s),m&4&&(na(3,s,s.return),lu(3,s),na(5,s,s.return));break;case 1:hr(a,s),fr(s),m&512&&(_n||c===null||Ps(c,c.return)),m&64&&ui&&(s=s.updateQueue,s!==null&&(m=s.callbacks,m!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?m:c.concat(m))));break;case 26:var v=os;if(hr(a,s),fr(s),m&512&&(_n||c===null||Ps(c,c.return)),m&4){var E=c!==null?c.memoizedState:null;if(m=s.memoizedState,c===null)if(m===null)if(s.stateNode===null){e:{m=s.type,c=s.memoizedProps,v=v.ownerDocument||v;t:switch(m){case"title":E=v.getElementsByTagName("title")[0],(!E||E[ws]||E[hn]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=v.createElement(m),v.head.insertBefore(E,v.querySelector("head > title"))),Un(E,m,c),E[hn]=s,fn(E),m=E;break e;case"link":var z=gx("link","href",v).get(m+(c.href||""));if(z){for(var Q=0;Q<z.length;Q++)if(E=z[Q],E.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&E.getAttribute("rel")===(c.rel==null?null:c.rel)&&E.getAttribute("title")===(c.title==null?null:c.title)&&E.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){z.splice(Q,1);break t}}E=v.createElement(m),Un(E,m,c),v.head.appendChild(E);break;case"meta":if(z=gx("meta","content",v).get(m+(c.content||""))){for(Q=0;Q<z.length;Q++)if(E=z[Q],E.getAttribute("content")===(c.content==null?null:""+c.content)&&E.getAttribute("name")===(c.name==null?null:c.name)&&E.getAttribute("property")===(c.property==null?null:c.property)&&E.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&E.getAttribute("charset")===(c.charSet==null?null:c.charSet)){z.splice(Q,1);break t}}E=v.createElement(m),Un(E,m,c),v.head.appendChild(E);break;default:throw Error(r(468,m))}E[hn]=s,fn(E),m=E}s.stateNode=m}else yx(v,s.type,s.stateNode);else s.stateNode=px(v,m,s.memoizedProps);else E!==m?(E===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):E.count--,m===null?yx(v,s.type,s.stateNode):px(v,m,s.memoizedProps)):m===null&&s.stateNode!==null&&Fp(s,s.memoizedProps,c.memoizedProps)}break;case 27:hr(a,s),fr(s),m&512&&(_n||c===null||Ps(c,c.return)),c!==null&&m&4&&Fp(s,s.memoizedProps,c.memoizedProps);break;case 5:if(hr(a,s),fr(s),m&512&&(_n||c===null||Ps(c,c.return)),s.flags&32){v=s.stateNode;try{ur(v,"")}catch(Fe){kt(s,s.return,Fe)}}m&4&&s.stateNode!=null&&(v=s.memoizedProps,Fp(s,v,c!==null?c.memoizedProps:v)),m&1024&&(qp=!0);break;case 6:if(hr(a,s),fr(s),m&4){if(s.stateNode===null)throw Error(r(162));m=s.memoizedProps,c=s.stateNode;try{c.nodeValue=m}catch(Fe){kt(s,s.return,Fe)}}break;case 3:if(Nh=null,v=os,os=Mh(a.containerInfo),hr(a,s),os=v,fr(s),m&4&&c!==null&&c.memoizedState.isDehydrated)try{Bl(a.containerInfo)}catch(Fe){kt(s,s.return,Fe)}qp&&(qp=!1,yv(s));break;case 4:m=os,os=Mh(s.stateNode.containerInfo),hr(a,s),fr(s),os=m;break;case 12:hr(a,s),fr(s);break;case 31:hr(a,s),fr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,bh(s,m)));break;case 13:hr(a,s),fr(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(xh=Pe()),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,bh(s,m)));break;case 22:v=s.memoizedState!==null;var se=c!==null&&c.memoizedState!==null,pe=ui,Ce=_n;if(ui=pe||v,_n=Ce||se,hr(a,s),_n=Ce,ui=pe,fr(s),m&8192)e:for(a=s.stateNode,a._visibility=v?a._visibility&-2:a._visibility|1,v&&(c===null||se||ui||_n||wo(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){se=c=a;try{if(E=se.stateNode,v)z=E.style,typeof z.setProperty=="function"?z.setProperty("display","none","important"):z.display="none";else{Q=se.stateNode;var De=se.memoizedProps.style,_e=De!=null&&De.hasOwnProperty("display")?De.display:null;Q.style.display=_e==null||typeof _e=="boolean"?"":(""+_e).trim()}}catch(Fe){kt(se,se.return,Fe)}}}else if(a.tag===6){if(c===null){se=a;try{se.stateNode.nodeValue=v?"":se.memoizedProps}catch(Fe){kt(se,se.return,Fe)}}}else if(a.tag===18){if(c===null){se=a;try{var ve=se.stateNode;v?ax(ve,!0):ax(se.stateNode,!1)}catch(Fe){kt(se,se.return,Fe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}m&4&&(m=s.updateQueue,m!==null&&(c=m.retryQueue,c!==null&&(m.retryQueue=null,bh(s,c))));break;case 19:hr(a,s),fr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,bh(s,m)));break;case 30:break;case 21:break;default:hr(a,s),fr(s)}}function fr(s){var a=s.flags;if(a&2){try{for(var c,m=s.return;m!==null;){if(lv(m)){c=m;break}m=m.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var v=c.stateNode,E=Vp(s);_h(s,E,v);break;case 5:var z=c.stateNode;c.flags&32&&(ur(z,""),c.flags&=-33);var Q=Vp(s);_h(s,Q,z);break;case 3:case 4:var se=c.stateNode.containerInfo,pe=Vp(s);$p(s,pe,se);break;default:throw Error(r(161))}}catch(Ce){kt(s,s.return,Ce)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function yv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;yv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function hi(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)dv(s,a.alternate,a),a=a.sibling}function wo(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:na(4,a,a.return),wo(a);break;case 1:Ps(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&av(a,a.return,c),wo(a);break;case 27:_u(a.stateNode);case 26:case 5:Ps(a,a.return),wo(a);break;case 22:a.memoizedState===null&&wo(a);break;case 30:wo(a);break;default:wo(a)}s=s.sibling}}function fi(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var m=a.alternate,v=s,E=a,z=E.flags;switch(E.tag){case 0:case 11:case 15:fi(v,E,c),lu(4,E);break;case 1:if(fi(v,E,c),m=E,v=m.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(pe){kt(m,m.return,pe)}if(m=E,v=m.updateQueue,v!==null){var Q=m.stateNode;try{var se=v.shared.hiddenCallbacks;if(se!==null)for(v.shared.hiddenCallbacks=null,v=0;v<se.length;v++)Q0(se[v],Q)}catch(pe){kt(m,m.return,pe)}}c&&z&64&&iv(E),cu(E,E.return);break;case 27:cv(E);case 26:case 5:fi(v,E,c),c&&m===null&&z&4&&ov(E),cu(E,E.return);break;case 12:fi(v,E,c);break;case 31:fi(v,E,c),c&&z&4&&mv(v,E);break;case 13:fi(v,E,c),c&&z&4&&pv(v,E);break;case 22:E.memoizedState===null&&fi(v,E,c),cu(E,E.return);break;case 30:break;default:fi(v,E,c)}a=a.sibling}}function Hp(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Kc(c))}function Gp(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Kc(s))}function ls(s,a,c,m){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)_v(s,a,c,m),a=a.sibling}function _v(s,a,c,m){var v=a.flags;switch(a.tag){case 0:case 11:case 15:ls(s,a,c,m),v&2048&&lu(9,a);break;case 1:ls(s,a,c,m);break;case 3:ls(s,a,c,m),v&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Kc(s)));break;case 12:if(v&2048){ls(s,a,c,m),s=a.stateNode;try{var E=a.memoizedProps,z=E.id,Q=E.onPostCommit;typeof Q=="function"&&Q(z,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(se){kt(a,a.return,se)}}else ls(s,a,c,m);break;case 31:ls(s,a,c,m);break;case 13:ls(s,a,c,m);break;case 23:break;case 22:E=a.stateNode,z=a.alternate,a.memoizedState!==null?E._visibility&2?ls(s,a,c,m):uu(s,a):E._visibility&2?ls(s,a,c,m):(E._visibility|=2,Tl(s,a,c,m,(a.subtreeFlags&10256)!==0||!1)),v&2048&&Hp(z,a);break;case 24:ls(s,a,c,m),v&2048&&Gp(a.alternate,a);break;default:ls(s,a,c,m)}}function Tl(s,a,c,m,v){for(v=v&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var E=s,z=a,Q=c,se=m,pe=z.flags;switch(z.tag){case 0:case 11:case 15:Tl(E,z,Q,se,v),lu(8,z);break;case 23:break;case 22:var Ce=z.stateNode;z.memoizedState!==null?Ce._visibility&2?Tl(E,z,Q,se,v):uu(E,z):(Ce._visibility|=2,Tl(E,z,Q,se,v)),v&&pe&2048&&Hp(z.alternate,z);break;case 24:Tl(E,z,Q,se,v),v&&pe&2048&&Gp(z.alternate,z);break;default:Tl(E,z,Q,se,v)}a=a.sibling}}function uu(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,m=a,v=m.flags;switch(m.tag){case 22:uu(c,m),v&2048&&Hp(m.alternate,m);break;case 24:uu(c,m),v&2048&&Gp(m.alternate,m);break;default:uu(c,m)}a=a.sibling}}var du=8192;function Al(s,a,c){if(s.subtreeFlags&du)for(s=s.child;s!==null;)bv(s,a,c),s=s.sibling}function bv(s,a,c){switch(s.tag){case 26:Al(s,a,c),s.flags&du&&s.memoizedState!==null&&$j(c,os,s.memoizedState,s.memoizedProps);break;case 5:Al(s,a,c);break;case 3:case 4:var m=os;os=Mh(s.stateNode.containerInfo),Al(s,a,c),os=m;break;case 22:s.memoizedState===null&&(m=s.alternate,m!==null&&m.memoizedState!==null?(m=du,du=16777216,Al(s,a,c),du=m):Al(s,a,c));break;default:Al(s,a,c)}}function vv(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function hu(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];Mn=m,wv(m,s)}vv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)xv(s),s=s.sibling}function xv(s){switch(s.tag){case 0:case 11:case 15:hu(s),s.flags&2048&&na(9,s,s.return);break;case 3:hu(s);break;case 12:hu(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,vh(s)):hu(s);break;default:hu(s)}}function vh(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];Mn=m,wv(m,s)}vv(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:na(8,a,a.return),vh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,vh(a));break;default:vh(a)}s=s.sibling}}function wv(s,a){for(;Mn!==null;){var c=Mn;switch(c.tag){case 0:case 11:case 15:na(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var m=c.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Kc(c.memoizedState.cache)}if(m=c.child,m!==null)m.return=c,Mn=m;else e:for(c=s;Mn!==null;){m=Mn;var v=m.sibling,E=m.return;if(hv(m),m===c){Mn=null;break e}if(v!==null){v.return=E,Mn=v;break e}Mn=E}}}var sj={getCacheForType:function(s){var a=zn(pn),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return zn(pn).controller.signal}},ij=typeof WeakMap=="function"?WeakMap:Map,Tt=0,Ut=null,ut=null,ft=0,Dt=0,Ar=null,ra=!1,jl=!1,Wp=!1,mi=0,sn=0,sa=0,So=0,Qp=0,jr=0,Rl=0,fu=null,mr=null,Kp=!1,xh=0,Sv=0,wh=1/0,Sh=null,ia=null,Cn=0,aa=null,Il=null,pi=0,Yp=0,Xp=null,Ev=null,mu=0,Zp=null;function Rr(){return(Tt&2)!==0&&ft!==0?ft&-ft:X.T!==null?sg():Ed()}function Cv(){if(jr===0)if((ft&536870912)===0||_t){var s=_s;_s<<=1,(_s&3932160)===0&&(_s=262144),jr=s}else jr=536870912;return s=Cr.current,s!==null&&(s.flags|=32),jr}function pr(s,a,c){(s===Ut&&(Dt===2||Dt===9)||s.cancelPendingCommit!==null)&&(Dl(s,0),oa(s,ft,jr,!1)),Ya(s,c),((Tt&2)===0||s!==Ut)&&(s===Ut&&((Tt&2)===0&&(So|=c),sn===4&&oa(s,ft,jr,!1)),Bs(s))}function Tv(s,a,c){if((Tt&6)!==0)throw Error(r(327));var m=!c&&(a&127)===0&&(a&s.expiredLanes)===0||Zr(s,a),v=m?lj(s,a):eg(s,a,!0),E=m;do{if(v===0){jl&&!m&&oa(s,a,0,!1);break}else{if(c=s.current.alternate,E&&!aj(c)){v=eg(s,a,!1),E=!1;continue}if(v===2){if(E=a,s.errorRecoveryDisabledLanes&E)var z=0;else z=s.pendingLanes&-536870913,z=z!==0?z:z&536870912?536870912:0;if(z!==0){a=z;e:{var Q=s;v=fu;var se=Q.current.memoizedState.isDehydrated;if(se&&(Dl(Q,z).flags|=256),z=eg(Q,z,!1),z!==2){if(Wp&&!se){Q.errorRecoveryDisabledLanes|=E,So|=E,v=4;break e}E=mr,mr=v,E!==null&&(mr===null?mr=E:mr.push.apply(mr,E))}v=z}if(E=!1,v!==2)continue}}if(v===1){Dl(s,0),oa(s,a,0,!0);break}e:{switch(m=s,E=v,E){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:oa(m,a,jr,!ra);break e;case 2:mr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(v=xh+300-Pe(),10<v)){if(oa(m,a,jr,!ra),bs(m,0,!0)!==0)break e;pi=a,m.timeoutHandle=rx(Av.bind(null,m,c,mr,Sh,Kp,a,jr,So,Rl,ra,E,"Throttled",-0,0),v);break e}Av(m,c,mr,Sh,Kp,a,jr,So,Rl,ra,E,null,-0,0)}}break}while(!0);Bs(s)}function Av(s,a,c,m,v,E,z,Q,se,pe,Ce,De,_e,ve){if(s.timeoutHandle=-1,De=a.subtreeFlags,De&8192||(De&16785408)===16785408){De={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ts},bv(a,E,De);var Fe=(E&62914560)===E?xh-Pe():(E&4194048)===E?Sv-Pe():0;if(Fe=qj(De,Fe),Fe!==null){pi=E,s.cancelPendingCommit=Fe(Nv.bind(null,s,a,E,c,m,v,z,Q,se,Ce,De,null,_e,ve)),oa(s,E,z,!pe);return}}Nv(s,a,E,c,m,v,z,Q,se)}function aj(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var m=0;m<c.length;m++){var v=c[m],E=v.getSnapshot;v=v.value;try{if(!Sr(E(),v))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function oa(s,a,c,m){a&=~Qp,a&=~So,s.suspendedLanes|=a,s.pingedLanes&=~a,m&&(s.warmLanes|=a),m=s.expirationTimes;for(var v=a;0<v;){var E=31-Et(v),z=1<<E;m[E]=-1,v&=~z}c!==0&&Xa(s,c,a)}function Eh(){return(Tt&6)===0?(pu(0),!1):!0}function Jp(){if(ut!==null){if(Dt===0)var s=ut.return;else s=ut,si=mo=null,pp(s),xl=null,Xc=0,s=ut;for(;s!==null;)sv(s.alternate,s),s=s.return;ut=null}}function Dl(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,Tj(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),pi=0,Jp(),Ut=s,ut=c=ni(s.current,null),ft=a,Dt=0,Ar=null,ra=!1,jl=Zr(s,a),Wp=!1,Rl=jr=Qp=So=sa=sn=0,mr=fu=null,Kp=!1,(a&8)!==0&&(a|=a&32);var m=s.entangledLanes;if(m!==0)for(s=s.entanglements,m&=a;0<m;){var v=31-Et(m),E=1<<v;a|=s[v],m&=~E}return mi=a,Hd(),c}function jv(s,a){at=null,X.H=iu,a===vl||a===Jd?(a=q0(),Dt=3):a===rp?(a=q0(),Dt=4):Dt=a===Dp?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Ar=a,ut===null&&(sn=1,fh(s,Ur(a,s.current)))}function Rv(){var s=Cr.current;return s===null?!0:(ft&4194048)===ft?qr===null:(ft&62914560)===ft||(ft&536870912)!==0?s===qr:!1}function Iv(){var s=X.H;return X.H=iu,s===null?iu:s}function Dv(){var s=X.A;return X.A=sj,s}function Ch(){sn=4,ra||(ft&4194048)!==ft&&Cr.current!==null||(jl=!0),(sa&134217727)===0&&(So&134217727)===0||Ut===null||oa(Ut,ft,jr,!1)}function eg(s,a,c){var m=Tt;Tt|=2;var v=Iv(),E=Dv();(Ut!==s||ft!==a)&&(Sh=null,Dl(s,a)),a=!1;var z=sn;e:do try{if(Dt!==0&&ut!==null){var Q=ut,se=Ar;switch(Dt){case 8:Jp(),z=6;break e;case 3:case 2:case 9:case 6:Cr.current===null&&(a=!0);var pe=Dt;if(Dt=0,Ar=null,kl(s,Q,se,pe),c&&jl){z=0;break e}break;default:pe=Dt,Dt=0,Ar=null,kl(s,Q,se,pe)}}oj(),z=sn;break}catch(Ce){jv(s,Ce)}while(!0);return a&&s.shellSuspendCounter++,si=mo=null,Tt=m,X.H=v,X.A=E,ut===null&&(Ut=null,ft=0,Hd()),z}function oj(){for(;ut!==null;)kv(ut)}function lj(s,a){var c=Tt;Tt|=2;var m=Iv(),v=Dv();Ut!==s||ft!==a?(Sh=null,wh=Pe()+500,Dl(s,a)):jl=Zr(s,a);e:do try{if(Dt!==0&&ut!==null){a=ut;var E=Ar;t:switch(Dt){case 1:Dt=0,Ar=null,kl(s,a,E,1);break;case 2:case 9:if(V0(E)){Dt=0,Ar=null,Mv(a);break}a=function(){Dt!==2&&Dt!==9||Ut!==s||(Dt=7),Bs(s)},E.then(a,a);break e;case 3:Dt=7;break e;case 4:Dt=5;break e;case 7:V0(E)?(Dt=0,Ar=null,Mv(a)):(Dt=0,Ar=null,kl(s,a,E,7));break;case 5:var z=null;switch(ut.tag){case 26:z=ut.memoizedState;case 5:case 27:var Q=ut;if(z?_x(z):Q.stateNode.complete){Dt=0,Ar=null;var se=Q.sibling;if(se!==null)ut=se;else{var pe=Q.return;pe!==null?(ut=pe,Th(pe)):ut=null}break t}}Dt=0,Ar=null,kl(s,a,E,5);break;case 6:Dt=0,Ar=null,kl(s,a,E,6);break;case 8:Jp(),sn=6;break e;default:throw Error(r(462))}}cj();break}catch(Ce){jv(s,Ce)}while(!0);return si=mo=null,X.H=m,X.A=v,Tt=c,ut!==null?0:(Ut=null,ft=0,Hd(),sn)}function cj(){for(;ut!==null&&!ie();)kv(ut)}function kv(s){var a=nv(s.alternate,s,mi);s.memoizedProps=s.pendingProps,a===null?Th(s):ut=a}function Mv(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=Yb(c,a,a.pendingProps,a.type,void 0,ft);break;case 11:a=Yb(c,a,a.pendingProps,a.type.render,a.ref,ft);break;case 5:pp(a);default:sv(c,a),a=ut=D0(a,mi),a=nv(c,a,mi)}s.memoizedProps=s.pendingProps,a===null?Th(s):ut=a}function kl(s,a,c,m){si=mo=null,pp(a),xl=null,Xc=0;var v=a.return;try{if(XA(s,v,a,c,ft)){sn=1,fh(s,Ur(c,s.current)),ut=null;return}}catch(E){if(v!==null)throw ut=v,E;sn=1,fh(s,Ur(c,s.current)),ut=null;return}a.flags&32768?(_t||m===1?s=!0:jl||(ft&536870912)!==0?s=!1:(ra=s=!0,(m===2||m===9||m===3||m===6)&&(m=Cr.current,m!==null&&m.tag===13&&(m.flags|=16384))),Ov(a,s)):Th(a)}function Th(s){var a=s;do{if((a.flags&32768)!==0){Ov(a,ra);return}s=a.return;var c=ej(a.alternate,a,mi);if(c!==null){ut=c;return}if(a=a.sibling,a!==null){ut=a;return}ut=a=s}while(a!==null);sn===0&&(sn=5)}function Ov(s,a){do{var c=tj(s.alternate,s);if(c!==null){c.flags&=32767,ut=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){ut=s;return}ut=s=c}while(s!==null);sn=6,ut=null}function Nv(s,a,c,m,v,E,z,Q,se){s.cancelPendingCommit=null;do Ah();while(Cn!==0);if((Tt&6)!==0)throw Error(r(327));if(a!==null){if(a===s.current)throw Error(r(177));if(E=a.lanes|a.childLanes,E|=Vm,Mm(s,c,E,z,Q,se),s===Ut&&(ut=Ut=null,ft=0),Il=a,aa=s,pi=c,Yp=E,Xp=v,Ev=m,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,fj(st,function(){return Uv(),null})):(s.callbackNode=null,s.callbackPriority=0),m=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||m){m=X.T,X.T=null,v=W.p,W.p=2,z=Tt,Tt|=4;try{nj(s,a,c)}finally{Tt=z,W.p=v,X.T=m}}Cn=1,Pv(),Bv(),zv()}}function Pv(){if(Cn===1){Cn=0;var s=aa,a=Il,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=X.T,X.T=null;var m=W.p;W.p=2;var v=Tt;Tt|=4;try{gv(a,s);var E=hg,z=w0(s.containerInfo),Q=E.focusedElem,se=E.selectionRange;if(z!==Q&&Q&&Q.ownerDocument&&x0(Q.ownerDocument.documentElement,Q)){if(se!==null&&Bm(Q)){var pe=se.start,Ce=se.end;if(Ce===void 0&&(Ce=pe),"selectionStart"in Q)Q.selectionStart=pe,Q.selectionEnd=Math.min(Ce,Q.value.length);else{var De=Q.ownerDocument||document,_e=De&&De.defaultView||window;if(_e.getSelection){var ve=_e.getSelection(),Fe=Q.textContent.length,Ke=Math.min(se.start,Fe),Pt=se.end===void 0?Ke:Math.min(se.end,Fe);!ve.extend&&Ke>Pt&&(z=Pt,Pt=Ke,Ke=z);var ue=v0(Q,Ke),le=v0(Q,Pt);if(ue&&le&&(ve.rangeCount!==1||ve.anchorNode!==ue.node||ve.anchorOffset!==ue.offset||ve.focusNode!==le.node||ve.focusOffset!==le.offset)){var me=De.createRange();me.setStart(ue.node,ue.offset),ve.removeAllRanges(),Ke>Pt?(ve.addRange(me),ve.extend(le.node,le.offset)):(me.setEnd(le.node,le.offset),ve.addRange(me))}}}}for(De=[],ve=Q;ve=ve.parentNode;)ve.nodeType===1&&De.push({element:ve,left:ve.scrollLeft,top:ve.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<De.length;Q++){var je=De[Q];je.element.scrollLeft=je.left,je.element.scrollTop=je.top}}Lh=!!dg,hg=dg=null}finally{Tt=v,W.p=m,X.T=c}}s.current=a,Cn=2}}function Bv(){if(Cn===2){Cn=0;var s=aa,a=Il,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=X.T,X.T=null;var m=W.p;W.p=2;var v=Tt;Tt|=4;try{dv(s,a.alternate,a)}finally{Tt=v,W.p=m,X.T=c}}Cn=3}}function zv(){if(Cn===4||Cn===3){Cn=0,Re();var s=aa,a=Il,c=pi,m=Ev;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Cn=5:(Cn=0,Il=aa=null,Lv(s,s.pendingLanes));var v=s.pendingLanes;if(v===0&&(ia=null),Zs(c),a=a.stateNode,nn&&typeof nn.onCommitFiberRoot=="function")try{nn.onCommitFiberRoot(vt,a,void 0,(a.current.flags&128)===128)}catch{}if(m!==null){a=X.T,v=W.p,W.p=2,X.T=null;try{for(var E=s.onRecoverableError,z=0;z<m.length;z++){var Q=m[z];E(Q.value,{componentStack:Q.stack})}}finally{X.T=a,W.p=v}}(pi&3)!==0&&Ah(),Bs(s),v=s.pendingLanes,(c&261930)!==0&&(v&42)!==0?s===Zp?mu++:(mu=0,Zp=s):mu=0,pu(0)}}function Lv(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Kc(a)))}function Ah(){return Pv(),Bv(),zv(),Uv()}function Uv(){if(Cn!==5)return!1;var s=aa,a=Yp;Yp=0;var c=Zs(pi),m=X.T,v=W.p;try{W.p=32>c?32:c,X.T=null,c=Xp,Xp=null;var E=aa,z=pi;if(Cn=0,Il=aa=null,pi=0,(Tt&6)!==0)throw Error(r(331));var Q=Tt;if(Tt|=4,xv(E.current),_v(E,E.current,z,c),Tt=Q,pu(0,!1),nn&&typeof nn.onPostCommitFiberRoot=="function")try{nn.onPostCommitFiberRoot(vt,E)}catch{}return!0}finally{W.p=v,X.T=m,Lv(s,a)}}function Fv(s,a,c){a=Ur(c,a),a=Ip(s.stateNode,a,2),s=Ji(s,a,2),s!==null&&(Ya(s,2),Bs(s))}function kt(s,a,c){if(s.tag===3)Fv(s,s,c);else for(;a!==null;){if(a.tag===3){Fv(a,s,c);break}else if(a.tag===1){var m=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(ia===null||!ia.has(m))){s=Ur(c,s),c=Vb(2),m=Ji(a,c,2),m!==null&&($b(c,m,a,s),Ya(m,2),Bs(m));break}}a=a.return}}function tg(s,a,c){var m=s.pingCache;if(m===null){m=s.pingCache=new ij;var v=new Set;m.set(a,v)}else v=m.get(a),v===void 0&&(v=new Set,m.set(a,v));v.has(c)||(Wp=!0,v.add(c),s=uj.bind(null,s,a,c),a.then(s,s))}function uj(s,a,c){var m=s.pingCache;m!==null&&m.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,Ut===s&&(ft&c)===c&&(sn===4||sn===3&&(ft&62914560)===ft&&300>Pe()-xh?(Tt&2)===0&&Dl(s,0):Qp|=c,Rl===ft&&(Rl=0)),Bs(s)}function Vv(s,a){a===0&&(a=Sd()),s=uo(s,a),s!==null&&(Ya(s,a),Bs(s))}function dj(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),Vv(s,c)}function hj(s,a){var c=0;switch(s.tag){case 31:case 13:var m=s.stateNode,v=s.memoizedState;v!==null&&(c=v.retryLane);break;case 19:m=s.stateNode;break;case 22:m=s.stateNode._retryCache;break;default:throw Error(r(314))}m!==null&&m.delete(a),Vv(s,c)}function fj(s,a){return Se(s,a)}var jh=null,Ml=null,ng=!1,Rh=!1,rg=!1,la=0;function Bs(s){s!==Ml&&s.next===null&&(Ml===null?jh=Ml=s:Ml=Ml.next=s),Rh=!0,ng||(ng=!0,pj())}function pu(s,a){if(!rg&&Rh){rg=!0;do for(var c=!1,m=jh;m!==null;){if(s!==0){var v=m.pendingLanes;if(v===0)var E=0;else{var z=m.suspendedLanes,Q=m.pingedLanes;E=(1<<31-Et(42|s)+1)-1,E&=v&~(z&~Q),E=E&201326741?E&201326741|1:E?E|2:0}E!==0&&(c=!0,Gv(m,E))}else E=ft,E=bs(m,m===Ut?E:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(E&3)===0||Zr(m,E)||(c=!0,Gv(m,E));m=m.next}while(c);rg=!1}}function mj(){$v()}function $v(){Rh=ng=!1;var s=0;la!==0&&Cj()&&(s=la);for(var a=Pe(),c=null,m=jh;m!==null;){var v=m.next,E=qv(m,a);E===0?(m.next=null,c===null?jh=v:c.next=v,v===null&&(Ml=c)):(c=m,(s!==0||(E&3)!==0)&&(Rh=!0)),m=v}Cn!==0&&Cn!==5||pu(s),la!==0&&(la=0)}function qv(s,a){for(var c=s.suspendedLanes,m=s.pingedLanes,v=s.expirationTimes,E=s.pendingLanes&-62914561;0<E;){var z=31-Et(E),Q=1<<z,se=v[z];se===-1?((Q&c)===0||(Q&m)!==0)&&(v[z]=km(Q,a)):se<=a&&(s.expiredLanes|=Q),E&=~Q}if(a=Ut,c=ft,c=bs(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m=s.callbackNode,c===0||s===a&&(Dt===2||Dt===9)||s.cancelPendingCommit!==null)return m!==null&&m!==null&&xe(m),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Zr(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(m!==null&&xe(m),Zs(c)){case 2:case 8:c=xt;break;case 32:c=st;break;case 268435456:c=gs;break;default:c=st}return m=Hv.bind(null,s),c=Se(c,m),s.callbackPriority=a,s.callbackNode=c,a}return m!==null&&m!==null&&xe(m),s.callbackPriority=2,s.callbackNode=null,2}function Hv(s,a){if(Cn!==0&&Cn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(Ah()&&s.callbackNode!==c)return null;var m=ft;return m=bs(s,s===Ut?m:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m===0?null:(Tv(s,m,a),qv(s,Pe()),s.callbackNode!=null&&s.callbackNode===c?Hv.bind(null,s):null)}function Gv(s,a){if(Ah())return null;Tv(s,a,!0)}function pj(){Aj(function(){(Tt&6)!==0?Se(qe,mj):$v()})}function sg(){if(la===0){var s=_l;s===0&&(s=Or,Or<<=1,(Or&261888)===0&&(Or=256)),la=s}return la}function Wv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:rl(""+s)}function Qv(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function gj(s,a,c,m,v){if(a==="submit"&&c&&c.stateNode===v){var E=Wv((v[Dn]||null).action),z=m.submitter;z&&(a=(a=z[Dn]||null)?Wv(a.formAction):z.getAttribute("formAction"),a!==null&&(E=a,z=null));var Q=new Is("action","action",null,m,v);s.push({event:Q,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(la!==0){var se=z?Qv(v,z):new FormData(v);Ep(c,{pending:!0,data:se,method:v.method,action:E},null,se)}}else typeof E=="function"&&(Q.preventDefault(),se=z?Qv(v,z):new FormData(v),Ep(c,{pending:!0,data:se,method:v.method,action:E},E,se))},currentTarget:v}]})}}for(var ig=0;ig<Fm.length;ig++){var ag=Fm[ig],yj=ag.toLowerCase(),_j=ag[0].toUpperCase()+ag.slice(1);as(yj,"on"+_j)}as(C0,"onAnimationEnd"),as(T0,"onAnimationIteration"),as(A0,"onAnimationStart"),as("dblclick","onDoubleClick"),as("focusin","onFocus"),as("focusout","onBlur"),as(OA,"onTransitionRun"),as(NA,"onTransitionStart"),as(PA,"onTransitionCancel"),as(j0,"onTransitionEnd"),Ts("onMouseEnter",["mouseout","mouseover"]),Ts("onMouseLeave",["mouseout","mouseover"]),Ts("onPointerEnter",["pointerout","pointerover"]),Ts("onPointerLeave",["pointerout","pointerover"]),Cs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Cs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Cs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Cs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Cs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Cs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bj=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(gu));function Kv(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var m=s[c],v=m.event;m=m.listeners;e:{var E=void 0;if(a)for(var z=m.length-1;0<=z;z--){var Q=m[z],se=Q.instance,pe=Q.currentTarget;if(Q=Q.listener,se!==E&&v.isPropagationStopped())break e;E=Q,v.currentTarget=pe;try{E(v)}catch(Ce){qd(Ce)}v.currentTarget=null,E=se}else for(z=0;z<m.length;z++){if(Q=m[z],se=Q.instance,pe=Q.currentTarget,Q=Q.listener,se!==E&&v.isPropagationStopped())break e;E=Q,v.currentTarget=pe;try{E(v)}catch(Ce){qd(Ce)}v.currentTarget=null,E=se}}}}function dt(s,a){var c=a[Zo];c===void 0&&(c=a[Zo]=new Set);var m=s+"__bubble";c.has(m)||(Yv(a,s,2,!1),c.add(m))}function og(s,a,c){var m=0;a&&(m|=4),Yv(c,s,m,a)}var Ih="_reactListening"+Math.random().toString(36).slice(2);function lg(s){if(!s[Ih]){s[Ih]=!0,jc.forEach(function(c){c!=="selectionchange"&&(bj.has(c)||og(c,!1,s),og(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[Ih]||(a[Ih]=!0,og("selectionchange",!1,a))}}function Yv(s,a,c,m){switch(Cx(a)){case 2:var v=Wj;break;case 8:v=Qj;break;default:v=Sg}c=v.bind(null,a,c,s),v=void 0,!no||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(v=!0),m?v!==void 0?s.addEventListener(a,c,{capture:!0,passive:v}):s.addEventListener(a,c,!0):v!==void 0?s.addEventListener(a,c,{passive:v}):s.addEventListener(a,c,!1)}function cg(s,a,c,m,v){var E=m;if((a&1)===0&&(a&2)===0&&m!==null)e:for(;;){if(m===null)return;var z=m.tag;if(z===3||z===4){var Q=m.stateNode.containerInfo;if(Q===v)break;if(z===4)for(z=m.return;z!==null;){var se=z.tag;if((se===3||se===4)&&z.stateNode.containerInfo===v)return;z=z.return}for(;Q!==null;){if(z=Ss(Q),z===null)return;if(se=z.tag,se===5||se===6||se===26||se===27){m=E=z;continue e}Q=Q.parentNode}}m=m.return}$i(function(){var pe=E,Ce=Pr(c),De=[];e:{var _e=R0.get(s);if(_e!==void 0){var ve=Is,Fe=s;switch(s){case"keypress":if(so(c)===0)break e;case"keydown":case"keyup":ve=Fd;break;case"focusin":Fe="focus",ve=ao;break;case"focusout":Fe="blur",ve=ao;break;case"beforeblur":case"afterblur":ve=ao;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ve=Fc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ve=kd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ve=A;break;case C0:case T0:case A0:ve=Od;break;case j0:ve=K;break;case"scroll":case"scrollend":ve=Uc;break;case"wheel":ve=be;break;case"copy":case"cut":case"paste":ve=Nd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ve=ti;break;case"toggle":case"beforetoggle":ve=it}var Ke=(a&4)!==0,Pt=!Ke&&(s==="scroll"||s==="scrollend"),ue=Ke?_e!==null?_e+"Capture":null:_e;Ke=[];for(var le=pe,me;le!==null;){var je=le;if(me=je.stateNode,je=je.tag,je!==5&&je!==26&&je!==27||me===null||ue===null||(je=ns(le,ue),je!=null&&Ke.push(yu(le,je,me))),Pt)break;le=le.return}0<Ke.length&&(_e=new ve(_e,Fe,null,c,Ce),De.push({event:_e,listeners:Ke}))}}if((a&7)===0){e:{if(_e=s==="mouseover"||s==="pointerover",ve=s==="mouseout"||s==="pointerout",_e&&c!==Bc&&(Fe=c.relatedTarget||c.fromElement)&&(Ss(Fe)||Fe[xs]))break e;if((ve||_e)&&(_e=Ce.window===Ce?Ce:(_e=Ce.ownerDocument)?_e.defaultView||_e.parentWindow:window,ve?(Fe=c.relatedTarget||c.toElement,ve=pe,Fe=Fe?Ss(Fe):null,Fe!==null&&(Pt=o(Fe),Ke=Fe.tag,Fe!==Pt||Ke!==5&&Ke!==27&&Ke!==6)&&(Fe=null)):(ve=null,Fe=pe),ve!==Fe)){if(Ke=Fc,je="onMouseLeave",ue="onMouseEnter",le="mouse",(s==="pointerout"||s==="pointerover")&&(Ke=ti,je="onPointerLeave",ue="onPointerEnter",le="pointer"),Pt=ve==null?_e:xr(ve),me=Fe==null?_e:xr(Fe),_e=new Ke(je,le+"leave",ve,c,Ce),_e.target=Pt,_e.relatedTarget=me,je=null,Ss(Ce)===pe&&(Ke=new Ke(ue,le+"enter",Fe,c,Ce),Ke.target=me,Ke.relatedTarget=Pt,je=Ke),Pt=je,ve&&Fe)t:{for(Ke=vj,ue=ve,le=Fe,me=0,je=ue;je;je=Ke(je))me++;je=0;for(var We=le;We;We=Ke(We))je++;for(;0<me-je;)ue=Ke(ue),me--;for(;0<je-me;)le=Ke(le),je--;for(;me--;){if(ue===le||le!==null&&ue===le.alternate){Ke=ue;break t}ue=Ke(ue),le=Ke(le)}Ke=null}else Ke=null;ve!==null&&Xv(De,_e,ve,Ke,!1),Fe!==null&&Pt!==null&&Xv(De,Pt,Fe,Ke,!0)}}e:{if(_e=pe?xr(pe):window,ve=_e.nodeName&&_e.nodeName.toLowerCase(),ve==="select"||ve==="input"&&_e.type==="file")var wt=m0;else if(h0(_e))if(p0)wt=DA;else{wt=RA;var Ve=jA}else ve=_e.nodeName,!ve||ve.toLowerCase()!=="input"||_e.type!=="checkbox"&&_e.type!=="radio"?pe&&nl(pe.elementType)&&(wt=m0):wt=IA;if(wt&&(wt=wt(s,pe))){f0(De,wt,c,Ce);break e}Ve&&Ve(s,_e,pe),s==="focusout"&&pe&&_e.type==="number"&&pe.memoizedProps.value!=null&&Oc(_e,"number",_e.value)}switch(Ve=pe?xr(pe):window,s){case"focusin":(h0(Ve)||Ve.contentEditable==="true")&&(ul=Ve,zm=pe,Gc=null);break;case"focusout":Gc=zm=ul=null;break;case"mousedown":Lm=!0;break;case"contextmenu":case"mouseup":case"dragend":Lm=!1,S0(De,c,Ce);break;case"selectionchange":if(MA)break;case"keydown":case"keyup":S0(De,c,Ce)}var ot;if(Ct)e:{switch(s){case"compositionstart":var mt="onCompositionStart";break e;case"compositionend":mt="onCompositionEnd";break e;case"compositionupdate":mt="onCompositionUpdate";break e}mt=void 0}else cl?oo(s,c)&&(mt="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(mt="onCompositionStart");mt&&(Ms&&c.locale!=="ko"&&(cl||mt!=="onCompositionStart"?mt==="onCompositionEnd"&&cl&&(ot=Lc()):(Rs=Ce,zc="value"in Rs?Rs.value:Rs.textContent,cl=!0)),Ve=Dh(pe,mt),0<Ve.length&&(mt=new ks(mt,s,null,c,Ce),De.push({event:mt,listeners:Ve}),ot?mt.data=ot:(ot=ll(c),ot!==null&&(mt.data=ot)))),(ot=zr?EA(s,c):CA(s,c))&&(mt=Dh(pe,"onBeforeInput"),0<mt.length&&(Ve=new ks("onBeforeInput","beforeinput",null,c,Ce),De.push({event:Ve,listeners:mt}),Ve.data=ot)),gj(De,s,pe,c,Ce)}Kv(De,a)})}function yu(s,a,c){return{instance:s,listener:a,currentTarget:c}}function Dh(s,a){for(var c=a+"Capture",m=[];s!==null;){var v=s,E=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||E===null||(v=ns(s,c),v!=null&&m.unshift(yu(s,v,E)),v=ns(s,a),v!=null&&m.push(yu(s,v,E))),s.tag===3)return m;s=s.return}return[]}function vj(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Xv(s,a,c,m,v){for(var E=a._reactName,z=[];c!==null&&c!==m;){var Q=c,se=Q.alternate,pe=Q.stateNode;if(Q=Q.tag,se!==null&&se===m)break;Q!==5&&Q!==26&&Q!==27||pe===null||(se=pe,v?(pe=ns(c,E),pe!=null&&z.unshift(yu(c,pe,se))):v||(pe=ns(c,E),pe!=null&&z.push(yu(c,pe,se)))),c=c.return}z.length!==0&&s.push({event:a,listeners:z})}var xj=/\r\n?/g,wj=/\u0000|\uFFFD/g;function Zv(s){return(typeof s=="string"?s:""+s).replace(xj,`
`).replace(wj,"")}function Jv(s,a){return a=Zv(a),Zv(s)===a}function Nt(s,a,c,m,v,E){switch(c){case"children":typeof m=="string"?a==="body"||a==="textarea"&&m===""||ur(s,m):(typeof m=="number"||typeof m=="bigint")&&a!=="body"&&ur(s,""+m);break;case"className":wr(s,"class",m);break;case"tabIndex":wr(s,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":wr(s,c,m);break;case"style":Pc(s,m,E);break;case"data":if(a!=="object"){wr(s,"data",m);break}case"src":case"href":if(m===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(c);break}m=rl(""+m),s.setAttribute(c,m);break;case"action":case"formAction":if(typeof m=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(c==="formAction"?(a!=="input"&&Nt(s,a,"name",v.name,v,null),Nt(s,a,"formEncType",v.formEncType,v,null),Nt(s,a,"formMethod",v.formMethod,v,null),Nt(s,a,"formTarget",v.formTarget,v,null)):(Nt(s,a,"encType",v.encType,v,null),Nt(s,a,"method",v.method,v,null),Nt(s,a,"target",v.target,v,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(c);break}m=rl(""+m),s.setAttribute(c,m);break;case"onClick":m!=null&&(s.onclick=ts);break;case"onScroll":m!=null&&dt("scroll",s);break;case"onScrollEnd":m!=null&&dt("scrollend",s);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(c=m.__html,c!=null){if(v.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"multiple":s.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":s.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){s.removeAttribute("xlink:href");break}c=rl(""+m),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,""+m):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":m===!0?s.setAttribute(c,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,m):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?s.setAttribute(c,m):s.removeAttribute(c);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?s.removeAttribute(c):s.setAttribute(c,m);break;case"popover":dt("beforetoggle",s),dt("toggle",s),el(s,"popover",m);break;case"xlinkActuate":mn(s,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":mn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":mn(s,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":mn(s,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":mn(s,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":mn(s,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":mn(s,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":mn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":mn(s,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":el(s,"is",m);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Dd.get(c)||c,el(s,c,m))}}function ug(s,a,c,m,v,E){switch(c){case"style":Pc(s,m,E);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(c=m.__html,c!=null){if(v.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"children":typeof m=="string"?ur(s,m):(typeof m=="number"||typeof m=="bigint")&&ur(s,""+m);break;case"onScroll":m!=null&&dt("scroll",s);break;case"onScrollEnd":m!=null&&dt("scrollend",s);break;case"onClick":m!=null&&(s.onclick=ts);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Rc.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(v=c.endsWith("Capture"),a=c.slice(2,v?c.length-7:void 0),E=s[Dn]||null,E=E!=null?E[c]:null,typeof E=="function"&&s.removeEventListener(a,E,v),typeof m=="function")){typeof E!="function"&&E!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,m,v);break e}c in s?s[c]=m:m===!0?s.setAttribute(c,""):el(s,c,m)}}}function Un(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":dt("error",s),dt("load",s);var m=!1,v=!1,E;for(E in c)if(c.hasOwnProperty(E)){var z=c[E];if(z!=null)switch(E){case"src":m=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Nt(s,a,E,z,c,null)}}v&&Nt(s,a,"srcSet",c.srcSet,c,null),m&&Nt(s,a,"src",c.src,c,null);return;case"input":dt("invalid",s);var Q=E=z=v=null,se=null,pe=null;for(m in c)if(c.hasOwnProperty(m)){var Ce=c[m];if(Ce!=null)switch(m){case"name":v=Ce;break;case"type":z=Ce;break;case"checked":se=Ce;break;case"defaultChecked":pe=Ce;break;case"value":E=Ce;break;case"defaultValue":Q=Ce;break;case"children":case"dangerouslySetInnerHTML":if(Ce!=null)throw Error(r(137,a));break;default:Nt(s,a,m,Ce,c,null)}}jd(s,E,Q,se,pe,z,v,!1);return;case"select":dt("invalid",s),m=z=E=null;for(v in c)if(c.hasOwnProperty(v)&&(Q=c[v],Q!=null))switch(v){case"value":E=Q;break;case"defaultValue":z=Q;break;case"multiple":m=Q;default:Nt(s,a,v,Q,c,null)}a=E,c=z,s.multiple=!!m,a!=null?Li(s,!!m,a,!1):c!=null&&Li(s,!!m,c,!0);return;case"textarea":dt("invalid",s),E=v=m=null;for(z in c)if(c.hasOwnProperty(z)&&(Q=c[z],Q!=null))switch(z){case"value":m=Q;break;case"defaultValue":v=Q;break;case"children":E=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(r(91));break;default:Nt(s,a,z,Q,c,null)}Ui(s,m,v,E);return;case"option":for(se in c)c.hasOwnProperty(se)&&(m=c[se],m!=null)&&(se==="selected"?s.selected=m&&typeof m!="function"&&typeof m!="symbol":Nt(s,a,se,m,c,null));return;case"dialog":dt("beforetoggle",s),dt("toggle",s),dt("cancel",s),dt("close",s);break;case"iframe":case"object":dt("load",s);break;case"video":case"audio":for(m=0;m<gu.length;m++)dt(gu[m],s);break;case"image":dt("error",s),dt("load",s);break;case"details":dt("toggle",s);break;case"embed":case"source":case"link":dt("error",s),dt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(pe in c)if(c.hasOwnProperty(pe)&&(m=c[pe],m!=null))switch(pe){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Nt(s,a,pe,m,c,null)}return;default:if(nl(a)){for(Ce in c)c.hasOwnProperty(Ce)&&(m=c[Ce],m!==void 0&&ug(s,a,Ce,m,c,void 0));return}}for(Q in c)c.hasOwnProperty(Q)&&(m=c[Q],m!=null&&Nt(s,a,Q,m,c,null))}function Sj(s,a,c,m){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,E=null,z=null,Q=null,se=null,pe=null,Ce=null;for(ve in c){var De=c[ve];if(c.hasOwnProperty(ve)&&De!=null)switch(ve){case"checked":break;case"value":break;case"defaultValue":se=De;default:m.hasOwnProperty(ve)||Nt(s,a,ve,null,m,De)}}for(var _e in m){var ve=m[_e];if(De=c[_e],m.hasOwnProperty(_e)&&(ve!=null||De!=null))switch(_e){case"type":E=ve;break;case"name":v=ve;break;case"checked":pe=ve;break;case"defaultChecked":Ce=ve;break;case"value":z=ve;break;case"defaultValue":Q=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(r(137,a));break;default:ve!==De&&Nt(s,a,_e,ve,m,De)}}tl(s,z,Q,se,pe,Ce,E,v);return;case"select":ve=z=Q=_e=null;for(E in c)if(se=c[E],c.hasOwnProperty(E)&&se!=null)switch(E){case"value":break;case"multiple":ve=se;default:m.hasOwnProperty(E)||Nt(s,a,E,null,m,se)}for(v in m)if(E=m[v],se=c[v],m.hasOwnProperty(v)&&(E!=null||se!=null))switch(v){case"value":_e=E;break;case"defaultValue":Q=E;break;case"multiple":z=E;default:E!==se&&Nt(s,a,v,E,m,se)}a=Q,c=z,m=ve,_e!=null?Li(s,!!c,_e,!1):!!m!=!!c&&(a!=null?Li(s,!!c,a,!0):Li(s,!!c,c?[]:"",!1));return;case"textarea":ve=_e=null;for(Q in c)if(v=c[Q],c.hasOwnProperty(Q)&&v!=null&&!m.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:Nt(s,a,Q,null,m,v)}for(z in m)if(v=m[z],E=c[z],m.hasOwnProperty(z)&&(v!=null||E!=null))switch(z){case"value":_e=v;break;case"defaultValue":ve=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==E&&Nt(s,a,z,v,m,E)}Rd(s,_e,ve);return;case"option":for(var Fe in c)_e=c[Fe],c.hasOwnProperty(Fe)&&_e!=null&&!m.hasOwnProperty(Fe)&&(Fe==="selected"?s.selected=!1:Nt(s,a,Fe,null,m,_e));for(se in m)_e=m[se],ve=c[se],m.hasOwnProperty(se)&&_e!==ve&&(_e!=null||ve!=null)&&(se==="selected"?s.selected=_e&&typeof _e!="function"&&typeof _e!="symbol":Nt(s,a,se,_e,m,ve));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ke in c)_e=c[Ke],c.hasOwnProperty(Ke)&&_e!=null&&!m.hasOwnProperty(Ke)&&Nt(s,a,Ke,null,m,_e);for(pe in m)if(_e=m[pe],ve=c[pe],m.hasOwnProperty(pe)&&_e!==ve&&(_e!=null||ve!=null))switch(pe){case"children":case"dangerouslySetInnerHTML":if(_e!=null)throw Error(r(137,a));break;default:Nt(s,a,pe,_e,m,ve)}return;default:if(nl(a)){for(var Pt in c)_e=c[Pt],c.hasOwnProperty(Pt)&&_e!==void 0&&!m.hasOwnProperty(Pt)&&ug(s,a,Pt,void 0,m,_e);for(Ce in m)_e=m[Ce],ve=c[Ce],!m.hasOwnProperty(Ce)||_e===ve||_e===void 0&&ve===void 0||ug(s,a,Ce,_e,m,ve);return}}for(var ue in c)_e=c[ue],c.hasOwnProperty(ue)&&_e!=null&&!m.hasOwnProperty(ue)&&Nt(s,a,ue,null,m,_e);for(De in m)_e=m[De],ve=c[De],!m.hasOwnProperty(De)||_e===ve||_e==null&&ve==null||Nt(s,a,De,_e,m,ve)}function ex(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Ej(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),m=0;m<c.length;m++){var v=c[m],E=v.transferSize,z=v.initiatorType,Q=v.duration;if(E&&Q&&ex(z)){for(z=0,Q=v.responseEnd,m+=1;m<c.length;m++){var se=c[m],pe=se.startTime;if(pe>Q)break;var Ce=se.transferSize,De=se.initiatorType;Ce&&ex(De)&&(se=se.responseEnd,z+=Ce*(se<Q?1:(Q-pe)/(se-pe)))}if(--m,a+=8*(E+z)/(v.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var dg=null,hg=null;function kh(s){return s.nodeType===9?s:s.ownerDocument}function tx(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function nx(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function fg(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var mg=null;function Cj(){var s=window.event;return s&&s.type==="popstate"?s===mg?!1:(mg=s,!0):(mg=null,!1)}var rx=typeof setTimeout=="function"?setTimeout:void 0,Tj=typeof clearTimeout=="function"?clearTimeout:void 0,sx=typeof Promise=="function"?Promise:void 0,Aj=typeof queueMicrotask=="function"?queueMicrotask:typeof sx<"u"?function(s){return sx.resolve(null).then(s).catch(jj)}:rx;function jj(s){setTimeout(function(){throw s})}function ca(s){return s==="head"}function ix(s,a){var c=a,m=0;do{var v=c.nextSibling;if(s.removeChild(c),v&&v.nodeType===8)if(c=v.data,c==="/$"||c==="/&"){if(m===0){s.removeChild(v),Bl(a);return}m--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")m++;else if(c==="html")_u(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,_u(c);for(var E=c.firstChild;E;){var z=E.nextSibling,Q=E.nodeName;E[ws]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&E.rel.toLowerCase()==="stylesheet"||c.removeChild(E),E=z}}else c==="body"&&_u(s.ownerDocument.body);c=v}while(c);Bl(a)}function ax(s,a){var c=s;s=0;do{var m=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=m}while(c)}function pg(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":pg(c),Jo(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function Rj(s,a,c,m){for(;s.nodeType===1;){var v=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!m&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(m){if(!s[ws])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(E=s.getAttribute("rel"),E==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(E!==v.rel||s.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||s.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||s.getAttribute("title")!==(v.title==null?null:v.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(E=s.getAttribute("src"),(E!==(v.src==null?null:v.src)||s.getAttribute("type")!==(v.type==null?null:v.type)||s.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&E&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var E=v.name==null?null:""+v.name;if(v.type==="hidden"&&s.getAttribute("name")===E)return s}else return s;if(s=Hr(s.nextSibling),s===null)break}return null}function Ij(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=Hr(s.nextSibling),s===null))return null;return s}function ox(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=Hr(s.nextSibling),s===null))return null;return s}function gg(s){return s.data==="$?"||s.data==="$~"}function yg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function Dj(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var m=function(){a(),c.removeEventListener("DOMContentLoaded",m)};c.addEventListener("DOMContentLoaded",m),s._reactRetry=m}}function Hr(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var _g=null;function lx(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return Hr(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function cx(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function ux(s,a,c){switch(a=kh(c),s){case"html":if(s=a.documentElement,!s)throw Error(r(452));return s;case"head":if(s=a.head,!s)throw Error(r(453));return s;case"body":if(s=a.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function _u(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);Jo(s)}var Gr=new Map,dx=new Set;function Mh(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var gi=W.d;W.d={f:kj,r:Mj,D:Oj,C:Nj,L:Pj,m:Bj,X:Lj,S:zj,M:Uj};function kj(){var s=gi.f(),a=Eh();return s||a}function Mj(s){var a=Nr(s);a!==null&&a.tag===5&&a.type==="form"?jb(a):gi.r(s)}var Ol=typeof document>"u"?null:document;function hx(s,a,c){var m=Ol;if(m&&typeof a=="string"&&a){var v=cr(a);v='link[rel="'+s+'"][href="'+v+'"]',typeof c=="string"&&(v+='[crossorigin="'+c+'"]'),dx.has(v)||(dx.add(v),s={rel:s,crossOrigin:c,href:a},m.querySelector(v)===null&&(a=m.createElement("link"),Un(a,"link",s),fn(a),m.head.appendChild(a)))}}function Oj(s){gi.D(s),hx("dns-prefetch",s,null)}function Nj(s,a){gi.C(s,a),hx("preconnect",s,a)}function Pj(s,a,c){gi.L(s,a,c);var m=Ol;if(m&&s&&a){var v='link[rel="preload"][as="'+cr(a)+'"]';a==="image"&&c&&c.imageSrcSet?(v+='[imagesrcset="'+cr(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(v+='[imagesizes="'+cr(c.imageSizes)+'"]')):v+='[href="'+cr(s)+'"]';var E=v;switch(a){case"style":E=Nl(s);break;case"script":E=Pl(s)}Gr.has(E)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),Gr.set(E,s),m.querySelector(v)!==null||a==="style"&&m.querySelector(bu(E))||a==="script"&&m.querySelector(vu(E))||(a=m.createElement("link"),Un(a,"link",s),fn(a),m.head.appendChild(a)))}}function Bj(s,a){gi.m(s,a);var c=Ol;if(c&&s){var m=a&&typeof a.as=="string"?a.as:"script",v='link[rel="modulepreload"][as="'+cr(m)+'"][href="'+cr(s)+'"]',E=v;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=Pl(s)}if(!Gr.has(E)&&(s=g({rel:"modulepreload",href:s},a),Gr.set(E,s),c.querySelector(v)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(vu(E)))return}m=c.createElement("link"),Un(m,"link",s),fn(m),c.head.appendChild(m)}}}function zj(s,a,c){gi.S(s,a,c);var m=Ol;if(m&&s){var v=Es(m).hoistableStyles,E=Nl(s);a=a||"default";var z=v.get(E);if(!z){var Q={loading:0,preload:null};if(z=m.querySelector(bu(E)))Q.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=Gr.get(E))&&bg(s,c);var se=z=m.createElement("link");fn(se),Un(se,"link",s),se._p=new Promise(function(pe,Ce){se.onload=pe,se.onerror=Ce}),se.addEventListener("load",function(){Q.loading|=1}),se.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,Oh(z,a,m)}z={type:"stylesheet",instance:z,count:1,state:Q},v.set(E,z)}}}function Lj(s,a){gi.X(s,a);var c=Ol;if(c&&s){var m=Es(c).hoistableScripts,v=Pl(s),E=m.get(v);E||(E=c.querySelector(vu(v)),E||(s=g({src:s,async:!0},a),(a=Gr.get(v))&&vg(s,a),E=c.createElement("script"),fn(E),Un(E,"link",s),c.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},m.set(v,E))}}function Uj(s,a){gi.M(s,a);var c=Ol;if(c&&s){var m=Es(c).hoistableScripts,v=Pl(s),E=m.get(v);E||(E=c.querySelector(vu(v)),E||(s=g({src:s,async:!0,type:"module"},a),(a=Gr.get(v))&&vg(s,a),E=c.createElement("script"),fn(E),Un(E,"link",s),c.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},m.set(v,E))}}function fx(s,a,c,m){var v=(v=Ee.current)?Mh(v):null;if(!v)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=Nl(c.href),c=Es(v).hoistableStyles,m=c.get(a),m||(m={type:"style",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=Nl(c.href);var E=Es(v).hoistableStyles,z=E.get(s);if(z||(v=v.ownerDocument||v,z={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(s,z),(E=v.querySelector(bu(s)))&&!E._p&&(z.instance=E,z.state.loading=5),Gr.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Gr.set(s,c),E||Fj(v,s,c,z.state))),a&&m===null)throw Error(r(528,""));return z}if(a&&m!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Pl(c),c=Es(v).hoistableScripts,m=c.get(a),m||(m={type:"script",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function Nl(s){return'href="'+cr(s)+'"'}function bu(s){return'link[rel="stylesheet"]['+s+"]"}function mx(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function Fj(s,a,c,m){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?m.loading=1:(a=s.createElement("link"),m.preload=a,a.addEventListener("load",function(){return m.loading|=1}),a.addEventListener("error",function(){return m.loading|=2}),Un(a,"link",c),fn(a),s.head.appendChild(a))}function Pl(s){return'[src="'+cr(s)+'"]'}function vu(s){return"script[async]"+s}function px(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var m=s.querySelector('style[data-href~="'+cr(c.href)+'"]');if(m)return a.instance=m,fn(m),m;var v=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return m=(s.ownerDocument||s).createElement("style"),fn(m),Un(m,"style",v),Oh(m,c.precedence,s),a.instance=m;case"stylesheet":v=Nl(c.href);var E=s.querySelector(bu(v));if(E)return a.state.loading|=4,a.instance=E,fn(E),E;m=mx(c),(v=Gr.get(v))&&bg(m,v),E=(s.ownerDocument||s).createElement("link"),fn(E);var z=E;return z._p=new Promise(function(Q,se){z.onload=Q,z.onerror=se}),Un(E,"link",m),a.state.loading|=4,Oh(E,c.precedence,s),a.instance=E;case"script":return E=Pl(c.src),(v=s.querySelector(vu(E)))?(a.instance=v,fn(v),v):(m=c,(v=Gr.get(E))&&(m=g({},c),vg(m,v)),s=s.ownerDocument||s,v=s.createElement("script"),fn(v),Un(v,"link",m),s.head.appendChild(v),a.instance=v);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(m=a.instance,a.state.loading|=4,Oh(m,c.precedence,s));return a.instance}function Oh(s,a,c){for(var m=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=m.length?m[m.length-1]:null,E=v,z=0;z<m.length;z++){var Q=m[z];if(Q.dataset.precedence===a)E=Q;else if(E!==v)break}E?E.parentNode.insertBefore(s,E.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function bg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function vg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var Nh=null;function gx(s,a,c){if(Nh===null){var m=new Map,v=Nh=new Map;v.set(c,m)}else v=Nh,m=v.get(c),m||(m=new Map,v.set(c,m));if(m.has(s))return m;for(m.set(s,null),c=c.getElementsByTagName(s),v=0;v<c.length;v++){var E=c[v];if(!(E[ws]||E[hn]||s==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var z=E.getAttribute(a)||"";z=s+z;var Q=m.get(z);Q?Q.push(E):m.set(z,[E])}}return m}function yx(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function Vj(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function _x(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function $j(s,a,c,m){if(c.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var v=Nl(m.href),E=a.querySelector(bu(v));if(E){a=E._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=Ph.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=E,fn(E);return}E=a.ownerDocument||a,m=mx(m),(v=Gr.get(v))&&bg(m,v),E=E.createElement("link"),fn(E);var z=E;z._p=new Promise(function(Q,se){z.onload=Q,z.onerror=se}),Un(E,"link",m),c.instance=E}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Ph.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var xg=0;function qj(s,a){return s.stylesheets&&s.count===0&&zh(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var m=setTimeout(function(){if(s.stylesheets&&zh(s,s.stylesheets),s.unsuspend){var E=s.unsuspend;s.unsuspend=null,E()}},6e4+a);0<s.imgBytes&&xg===0&&(xg=62500*Ej());var v=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&zh(s,s.stylesheets),s.unsuspend)){var E=s.unsuspend;s.unsuspend=null,E()}},(s.imgBytes>xg?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(m),clearTimeout(v)}}:null}function Ph(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)zh(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Bh=null;function zh(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Bh=new Map,a.forEach(Hj,s),Bh=null,Ph.call(s))}function Hj(s,a){if(!(a.state.loading&4)){var c=Bh.get(s);if(c)var m=c.get(null);else{c=new Map,Bh.set(s,c);for(var v=s.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<v.length;E++){var z=v[E];(z.nodeName==="LINK"||z.getAttribute("media")!=="not all")&&(c.set(z.dataset.precedence,z),m=z)}m&&c.set(null,m)}v=a.instance,z=v.getAttribute("data-precedence"),E=c.get(z)||m,E===m&&c.set(null,v),c.set(z,v),this.count++,m=Ph.bind(this),v.addEventListener("load",m),v.addEventListener("error",m),E?E.parentNode.insertBefore(v,E.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(v,s.firstChild)),a.state.loading|=4}}var xu={$$typeof:I,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function Gj(s,a,c,m,v,E,z,Q,se){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=vs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vs(0),this.hiddenUpdates=vs(null),this.identifierPrefix=m,this.onUncaughtError=v,this.onCaughtError=E,this.onRecoverableError=z,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=se,this.incompleteTransitions=new Map}function bx(s,a,c,m,v,E,z,Q,se,pe,Ce,De){return s=new Gj(s,a,c,z,se,pe,Ce,De,Q),a=1,E===!0&&(a|=24),E=Er(3,null,null,a),s.current=E,E.stateNode=s,a=ep(),a.refCount++,s.pooledCache=a,a.refCount++,E.memoizedState={element:m,isDehydrated:c,cache:a},sp(E),s}function vx(s){return s?(s=fl,s):fl}function xx(s,a,c,m,v,E){v=vx(v),m.context===null?m.context=v:m.pendingContext=v,m=Zi(a),m.payload={element:c},E=E===void 0?null:E,E!==null&&(m.callback=E),c=Ji(s,m,a),c!==null&&(pr(c,s,a),Jc(c,s,a))}function wx(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function wg(s,a){wx(s,a),(s=s.alternate)&&wx(s,a)}function Sx(s){if(s.tag===13||s.tag===31){var a=uo(s,67108864);a!==null&&pr(a,s,67108864),wg(s,67108864)}}function Ex(s){if(s.tag===13||s.tag===31){var a=Rr();a=Za(a);var c=uo(s,a);c!==null&&pr(c,s,a),wg(s,a)}}var Lh=!0;function Wj(s,a,c,m){var v=X.T;X.T=null;var E=W.p;try{W.p=2,Sg(s,a,c,m)}finally{W.p=E,X.T=v}}function Qj(s,a,c,m){var v=X.T;X.T=null;var E=W.p;try{W.p=8,Sg(s,a,c,m)}finally{W.p=E,X.T=v}}function Sg(s,a,c,m){if(Lh){var v=Eg(m);if(v===null)cg(s,a,m,Uh,c),Tx(s,m);else if(Yj(v,s,a,c,m))m.stopPropagation();else if(Tx(s,m),a&4&&-1<Kj.indexOf(s)){for(;v!==null;){var E=Nr(v);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var z=rr(E.pendingLanes);if(z!==0){var Q=E;for(Q.pendingLanes|=2,Q.entangledLanes|=2;z;){var se=1<<31-Et(z);Q.entanglements[1]|=se,z&=~se}Bs(E),(Tt&6)===0&&(wh=Pe()+500,pu(0))}}break;case 31:case 13:Q=uo(E,2),Q!==null&&pr(Q,E,2),Eh(),wg(E,2)}if(E=Eg(m),E===null&&cg(s,a,m,Uh,c),E===v)break;v=E}v!==null&&m.stopPropagation()}else cg(s,a,m,null,c)}}function Eg(s){return s=Pr(s),Cg(s)}var Uh=null;function Cg(s){if(Uh=null,s=Ss(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=l(a),s!==null)return s;s=null}else if(c===31){if(s=u(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return Uh=s,null}function Cx(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ne()){case qe:return 2;case xt:return 8;case st:case Wn:return 32;case gs:return 268435456;default:return 32}default:return 32}}var Tg=!1,ua=null,da=null,ha=null,wu=new Map,Su=new Map,fa=[],Kj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Tx(s,a){switch(s){case"focusin":case"focusout":ua=null;break;case"dragenter":case"dragleave":da=null;break;case"mouseover":case"mouseout":ha=null;break;case"pointerover":case"pointerout":wu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Su.delete(a.pointerId)}}function Eu(s,a,c,m,v,E){return s===null||s.nativeEvent!==E?(s={blockedOn:a,domEventName:c,eventSystemFlags:m,nativeEvent:E,targetContainers:[v]},a!==null&&(a=Nr(a),a!==null&&Sx(a)),s):(s.eventSystemFlags|=m,a=s.targetContainers,v!==null&&a.indexOf(v)===-1&&a.push(v),s)}function Yj(s,a,c,m,v){switch(a){case"focusin":return ua=Eu(ua,s,a,c,m,v),!0;case"dragenter":return da=Eu(da,s,a,c,m,v),!0;case"mouseover":return ha=Eu(ha,s,a,c,m,v),!0;case"pointerover":var E=v.pointerId;return wu.set(E,Eu(wu.get(E)||null,s,a,c,m,v)),!0;case"gotpointercapture":return E=v.pointerId,Su.set(E,Eu(Su.get(E)||null,s,a,c,m,v)),!0}return!1}function Ax(s){var a=Ss(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){s.blockedOn=a,Jr(s.priority,function(){Ex(c)});return}}else if(a===31){if(a=u(c),a!==null){s.blockedOn=a,Jr(s.priority,function(){Ex(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Fh(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=Eg(s.nativeEvent);if(c===null){c=s.nativeEvent;var m=new c.constructor(c.type,c);Bc=m,c.target.dispatchEvent(m),Bc=null}else return a=Nr(c),a!==null&&Sx(a),s.blockedOn=c,!1;a.shift()}return!0}function jx(s,a,c){Fh(s)&&c.delete(a)}function Xj(){Tg=!1,ua!==null&&Fh(ua)&&(ua=null),da!==null&&Fh(da)&&(da=null),ha!==null&&Fh(ha)&&(ha=null),wu.forEach(jx),Su.forEach(jx)}function Vh(s,a){s.blockedOn===a&&(s.blockedOn=null,Tg||(Tg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Xj)))}var $h=null;function Rx(s){$h!==s&&($h=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){$h===s&&($h=null);for(var a=0;a<s.length;a+=3){var c=s[a],m=s[a+1],v=s[a+2];if(typeof m!="function"){if(Cg(m||c)===null)continue;break}var E=Nr(c);E!==null&&(s.splice(a,3),a-=3,Ep(E,{pending:!0,data:v,method:c.method,action:m},m,v))}}))}function Bl(s){function a(se){return Vh(se,s)}ua!==null&&Vh(ua,s),da!==null&&Vh(da,s),ha!==null&&Vh(ha,s),wu.forEach(a),Su.forEach(a);for(var c=0;c<fa.length;c++){var m=fa[c];m.blockedOn===s&&(m.blockedOn=null)}for(;0<fa.length&&(c=fa[0],c.blockedOn===null);)Ax(c),c.blockedOn===null&&fa.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(m=0;m<c.length;m+=3){var v=c[m],E=c[m+1],z=v[Dn]||null;if(typeof E=="function")z||Rx(c);else if(z){var Q=null;if(E&&E.hasAttribute("formAction")){if(v=E,z=E[Dn]||null)Q=z.formAction;else if(Cg(v)!==null)continue}else Q=z.action;typeof Q=="function"?c[m+1]=Q:(c.splice(m,3),m-=3),Rx(c)}}}function Ix(){function s(E){E.canIntercept&&E.info==="react-transition"&&E.intercept({handler:function(){return new Promise(function(z){return v=z})},focusReset:"manual",scroll:"manual"})}function a(){v!==null&&(v(),v=null),m||setTimeout(c,20)}function c(){if(!m&&!navigation.transition){var E=navigation.currentEntry;E&&E.url!=null&&navigation.navigate(E.url,{state:E.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,v=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){m=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),v!==null&&(v(),v=null)}}}function Ag(s){this._internalRoot=s}qh.prototype.render=Ag.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,m=Rr();xx(c,m,s,a,null,null)},qh.prototype.unmount=Ag.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;xx(s.current,2,null,s,null,null),Eh(),a[xs]=null}};function qh(s){this._internalRoot=s}qh.prototype.unstable_scheduleHydration=function(s){if(s){var a=Ed();s={blockedOn:null,target:s,priority:a};for(var c=0;c<fa.length&&a!==0&&a<fa[c].priority;c++);fa.splice(c,0,s),c===0&&Ax(s)}};var Dx=e.version;if(Dx!=="19.2.3")throw Error(r(527,Dx,"19.2.3"));W.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=f(a),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var Zj={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:X,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hh.isDisabled&&Hh.supportsFiber)try{vt=Hh.inject(Zj),nn=Hh}catch{}}return Tu.createRoot=function(s,a){if(!i(s))throw Error(r(299));var c=!1,m="",v=zb,E=Lb,z=Ub;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onUncaughtError!==void 0&&(v=a.onUncaughtError),a.onCaughtError!==void 0&&(E=a.onCaughtError),a.onRecoverableError!==void 0&&(z=a.onRecoverableError)),a=bx(s,1,!1,null,null,c,m,null,v,E,z,Ix),s[xs]=a.current,lg(s),new Ag(a)},Tu.hydrateRoot=function(s,a,c){if(!i(s))throw Error(r(299));var m=!1,v="",E=zb,z=Lb,Q=Ub,se=null;return c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(v=c.identifierPrefix),c.onUncaughtError!==void 0&&(E=c.onUncaughtError),c.onCaughtError!==void 0&&(z=c.onCaughtError),c.onRecoverableError!==void 0&&(Q=c.onRecoverableError),c.formState!==void 0&&(se=c.formState)),a=bx(s,1,!0,a,c??null,m,v,se,E,z,Q,Ix),a.context=vx(null),c=a.current,m=Rr(),m=Za(m),v=Zi(m),v.callback=null,Ji(c,v,m),c=m,a.current.lanes=c,Ya(a,c),Bs(a),s[xs]=a.current,lg(s),new qh(a)},Tu.version="19.2.3",Tu}var Fx;function cR(){if(Fx)return Ig.exports;Fx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ig.exports=lR(),Ig.exports}var uR=cR();var Vx="popstate";function dR(t={}){function e(r,i){let{pathname:o,search:l,hash:u}=r.location;return sy("",{pathname:o,search:l,hash:u},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:Uu(i)}return fR(e,n,null,t)}function Jt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Dr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function hR(){return Math.random().toString(36).substring(2,10)}function $x(t,e){return{usr:t.state,key:t.key,idx:e}}function sy(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?lc(e):e,state:n,key:e&&e.key||r||hR()}}function Uu({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function lc(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function fR(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,l=i.history,u="POP",h=null,f=p();f==null&&(f=0,l.replaceState({...l.state,idx:f},""));function p(){return(l.state||{idx:null}).idx}function g(){u="POP";let S=p(),C=S==null?null:S-f;f=S,h&&h({action:u,location:x.location,delta:C})}function b(S,C){u="PUSH";let T=sy(x.location,S,C);f=p()+1;let I=$x(T,f),M=x.createHref(T);try{l.pushState(I,"",M)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;i.location.assign(M)}o&&h&&h({action:u,location:x.location,delta:1})}function _(S,C){u="REPLACE";let T=sy(x.location,S,C);f=p();let I=$x(T,f),M=x.createHref(T);l.replaceState(I,"",M),o&&h&&h({action:u,location:x.location,delta:0})}function w(S){return mR(S)}let x={get action(){return u},get location(){return t(i,l)},listen(S){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(Vx,g),h=S,()=>{i.removeEventListener(Vx,g),h=null}},createHref(S){return e(i,S)},createURL:w,encodeLocation(S){let C=w(S);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:b,replace:_,go(S){return l.go(S)}};return x}function mR(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Jt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Uu(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function g1(t,e,n="/"){return pR(t,e,n,!1)}function pR(t,e,n,r){let i=typeof e=="string"?lc(e):e,o=Ci(i.pathname||"/",n);if(o==null)return null;let l=y1(t);gR(l);let u=null;for(let h=0;u==null&&h<l.length;++h){let f=AR(o);u=CR(l[h],f,r)}return u}function y1(t,e=[],n=[],r="",i=!1){let o=(l,u,h=i,f)=>{let p={relativePath:f===void 0?l.path||"":f,caseSensitive:l.caseSensitive===!0,childrenIndex:u,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;Jt(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=Si([r,p.relativePath]),b=n.concat(p);l.children&&l.children.length>0&&(Jt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),y1(l.children,e,b,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:SR(g,l.index),routesMeta:b})};return t.forEach((l,u)=>{if(l.path===""||!l.path?.includes("?"))o(l,u);else for(let h of _1(l.path))o(l,u,!0,h)}),e}function _1(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let l=_1(r.join("/")),u=[];return u.push(...l.map(h=>h===""?o:[o,h].join("/"))),i&&u.push(...l),u.map(h=>t.startsWith("/")&&h===""?"/":h)}function gR(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:ER(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var yR=/^:[\w-]+$/,_R=3,bR=2,vR=1,xR=10,wR=-2,qx=t=>t==="*";function SR(t,e){let n=t.split("/"),r=n.length;return n.some(qx)&&(r+=wR),e&&(r+=bR),n.filter(i=>!qx(i)).reduce((i,o)=>i+(yR.test(o)?_R:o===""?vR:xR),r)}function ER(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function CR(t,e,n=!1){let{routesMeta:r}=t,i={},o="/",l=[];for(let u=0;u<r.length;++u){let h=r[u],f=u===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=gf({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},p),b=h.route;if(!g&&f&&n&&!r[r.length-1].route.index&&(g=gf({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(i,g.params),l.push({params:i,pathname:Si([o,g.pathname]),pathnameBase:DR(Si([o,g.pathnameBase])),route:b}),g.pathnameBase!=="/"&&(o=Si([o,g.pathnameBase]))}return l}function gf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=TR(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],l=o.replace(/(.)\/+$/,"$1"),u=i.slice(1);return{params:r.reduce((f,{paramName:p,isOptional:g},b)=>{if(p==="*"){let w=u[b]||"";l=o.slice(0,o.length-w.length).replace(/(.)\/+$/,"$1")}const _=u[b];return g&&!_?f[p]=void 0:f[p]=(_||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:l,pattern:t}}function TR(t,e=!1,n=!0){Dr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,u,h)=>(r.push({paramName:u,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function AR(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Dr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Ci(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var b1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,jR=t=>b1.test(t);function RR(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?lc(t):t,o;if(n)if(jR(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),Dr(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${n}`)}n.startsWith("/")?o=Hx(n.substring(1),"/"):o=Hx(n,e)}else o=e;return{pathname:o,search:kR(r),hash:MR(i)}}function Hx(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Og(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function IR(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function $y(t){let e=IR(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function qy(t,e,n,r=!1){let i;typeof t=="string"?i=lc(t):(i={...t},Jt(!i.pathname||!i.pathname.includes("?"),Og("?","pathname","search",i)),Jt(!i.pathname||!i.pathname.includes("#"),Og("#","pathname","hash",i)),Jt(!i.search||!i.search.includes("#"),Og("#","search","hash",i)));let o=t===""||i.pathname==="",l=o?"/":i.pathname,u;if(l==null)u=n;else{let g=e.length-1;if(!r&&l.startsWith("..")){let b=l.split("/");for(;b[0]==="..";)b.shift(),g-=1;i.pathname=b.join("/")}u=g>=0?e[g]:"/"}let h=RR(i,u),f=l&&l!=="/"&&l.endsWith("/"),p=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(f||p)&&(h.pathname+="/"),h}var Si=t=>t.join("/").replace(/\/\/+/g,"/"),DR=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),kR=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,MR=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,OR=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function NR(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function PR(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var v1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function x1(t,e){let n=t;if(typeof n!="string"||!b1.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(v1)try{let o=new URL(window.location.href),l=n.startsWith("//")?new URL(o.protocol+n):new URL(n),u=Ci(l.pathname,e);l.origin===o.origin&&u!=null?n=u+l.search+l.hash:i=!0}catch{Dr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var w1=["POST","PUT","PATCH","DELETE"];new Set(w1);var BR=["GET",...w1];new Set(BR);var cc=R.createContext(null);cc.displayName="DataRouter";var Gf=R.createContext(null);Gf.displayName="DataRouterState";var zR=R.createContext(!1),S1=R.createContext({isTransitioning:!1});S1.displayName="ViewTransition";var LR=R.createContext(new Map);LR.displayName="Fetchers";var UR=R.createContext(null);UR.displayName="Await";var Mr=R.createContext(null);Mr.displayName="Navigation";var td=R.createContext(null);td.displayName="Location";var Xr=R.createContext({outlet:null,matches:[],isDataRoute:!1});Xr.displayName="Route";var Hy=R.createContext(null);Hy.displayName="RouteError";var E1="REACT_ROUTER_ERROR",FR="REDIRECT",VR="ROUTE_ERROR_RESPONSE";function $R(t){if(t.startsWith(`${E1}:${FR}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function qR(t){if(t.startsWith(`${E1}:${VR}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new OR(e.status,e.statusText,e.data)}catch{}}function HR(t,{relative:e}={}){Jt(uc(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=R.useContext(Mr),{hash:i,pathname:o,search:l}=rd(t,{relative:e}),u=o;return n!=="/"&&(u=o==="/"?n:Si([n,o])),r.createHref({pathname:u,search:l,hash:i})}function uc(){return R.useContext(td)!=null}function er(){return Jt(uc(),"useLocation() may be used only in the context of a <Router> component."),R.useContext(td).location}var C1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function T1(t){R.useContext(Mr).static||R.useLayoutEffect(t)}function nd(){let{isDataRoute:t}=R.useContext(Xr);return t?oI():GR()}function GR(){Jt(uc(),"useNavigate() may be used only in the context of a <Router> component.");let t=R.useContext(cc),{basename:e,navigator:n}=R.useContext(Mr),{matches:r}=R.useContext(Xr),{pathname:i}=er(),o=JSON.stringify($y(r)),l=R.useRef(!1);return T1(()=>{l.current=!0}),R.useCallback((h,f={})=>{if(Dr(l.current,C1),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=qy(h,JSON.parse(o),i,f.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:Si([e,p.pathname])),(f.replace?n.replace:n.push)(p,f.state,f)},[e,n,o,i,t])}var WR=R.createContext(null);function QR(t){let e=R.useContext(Xr).outlet;return R.useMemo(()=>e&&R.createElement(WR.Provider,{value:t},e),[e,t])}function KR(){let{matches:t}=R.useContext(Xr),e=t[t.length-1];return e?e.params:{}}function rd(t,{relative:e}={}){let{matches:n}=R.useContext(Xr),{pathname:r}=er(),i=JSON.stringify($y(n));return R.useMemo(()=>qy(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function YR(t,e){return A1(t,e)}function A1(t,e,n,r,i){Jt(uc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=R.useContext(Mr),{matches:l}=R.useContext(Xr),u=l[l.length-1],h=u?u.params:{},f=u?u.pathname:"/",p=u?u.pathnameBase:"/",g=u&&u.route;{let T=g&&g.path||"";R1(f,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let b=er(),_;if(e){let T=typeof e=="string"?lc(e):e;Jt(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),_=T}else _=b;let w=_.pathname||"/",x=w;if(p!=="/"){let T=p.replace(/^\//,"").split("/");x="/"+w.replace(/^\//,"").split("/").slice(T.length).join("/")}let S=g1(t,{pathname:x});Dr(g||S!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),Dr(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=tI(S&&S.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:Si([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:Si([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),l,n,r,i);return e&&C?R.createElement(td.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},C):C}function XR(){let t=aI(),e=NR(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=R.createElement(R.Fragment,null,R.createElement("p",null," Hey developer "),R.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",R.createElement("code",{style:o},"ErrorBoundary")," or"," ",R.createElement("code",{style:o},"errorElement")," prop on your route.")),R.createElement(R.Fragment,null,R.createElement("h2",null,"Unexpected Application Error!"),R.createElement("h3",{style:{fontStyle:"italic"}},e),n?R.createElement("pre",{style:i},n):null,l)}var ZR=R.createElement(XR,null),j1=class extends R.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=qR(t.digest);n&&(t=n)}let e=t!==void 0?R.createElement(Xr.Provider,{value:this.props.routeContext},R.createElement(Hy.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?R.createElement(JR,{error:t},e):e}};j1.contextType=zR;var Ng=new WeakMap;function JR({children:t,error:e}){let{basename:n}=R.useContext(Mr);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=$R(e.digest);if(r){let i=Ng.get(e);if(i)throw i;let o=x1(r.location,n);if(v1&&!Ng.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw Ng.set(e,l),l}return R.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function eI({routeContext:t,match:e,children:n}){let r=R.useContext(cc);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),R.createElement(Xr.Provider,{value:t},n)}function tI(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=n?.errors;if(l!=null){let p=o.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Jt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let u=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:b,errors:_}=n,w=g.route.loader&&!b.hasOwnProperty(g.route.id)&&(!_||_[g.route.id]===void 0);if(g.route.lazy||w){u=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let f=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:PR(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,b)=>{let _,w=!1,x=null,S=null;n&&(_=l&&g.route.id?l[g.route.id]:void 0,x=g.route.errorElement||ZR,u&&(h<0&&b===0?(R1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),w=!0,S=null):h===b&&(w=!0,S=g.route.hydrateFallbackElement||null)));let C=e.concat(o.slice(0,b+1)),T=()=>{let I;return _?I=x:w?I=S:g.route.Component?I=R.createElement(g.route.Component,null):g.route.element?I=g.route.element:I=p,R.createElement(eI,{match:g,routeContext:{outlet:p,matches:C,isDataRoute:n!=null},children:I})};return n&&(g.route.ErrorBoundary||g.route.errorElement||b===0)?R.createElement(j1,{location:n.location,revalidation:n.revalidation,component:x,error:_,children:T(),routeContext:{outlet:null,matches:C,isDataRoute:!0},onError:f}):T()},null)}function Gy(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nI(t){let e=R.useContext(cc);return Jt(e,Gy(t)),e}function rI(t){let e=R.useContext(Gf);return Jt(e,Gy(t)),e}function sI(t){let e=R.useContext(Xr);return Jt(e,Gy(t)),e}function Wy(t){let e=sI(t),n=e.matches[e.matches.length-1];return Jt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function iI(){return Wy("useRouteId")}function aI(){let t=R.useContext(Hy),e=rI("useRouteError"),n=Wy("useRouteError");return t!==void 0?t:e.errors?.[n]}function oI(){let{router:t}=nI("useNavigate"),e=Wy("useNavigate"),n=R.useRef(!1);return T1(()=>{n.current=!0}),R.useCallback(async(i,o={})=>{Dr(n.current,C1),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...o}))},[t,e])}var Gx={};function R1(t,e,n){!e&&!Gx[t]&&(Gx[t]=!0,Dr(!1,n))}R.memo(lI);function lI({routes:t,future:e,state:n,onError:r}){return A1(t,void 0,n,r,e)}function Wf({to:t,replace:e,state:n,relative:r}){Jt(uc(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=R.useContext(Mr);Dr(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=R.useContext(Xr),{pathname:l}=er(),u=nd(),h=qy(t,$y(o),l,r==="path"),f=JSON.stringify(h);return R.useEffect(()=>{u(JSON.parse(f),{replace:e,state:n,relative:r})},[u,f,r,e,n]),null}function Qf(t){return QR(t.context)}function bn(t){Jt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function cI({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:o=!1,unstable_useTransitions:l}){Jt(!uc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=t.replace(/^\/*/,"/"),h=R.useMemo(()=>({basename:u,navigator:i,static:o,unstable_useTransitions:l,future:{}}),[u,i,o,l]);typeof n=="string"&&(n=lc(n));let{pathname:f="/",search:p="",hash:g="",state:b=null,key:_="default"}=n,w=R.useMemo(()=>{let x=Ci(f,u);return x==null?null:{location:{pathname:x,search:p,hash:g,state:b,key:_},navigationType:r}},[u,f,p,g,b,_,r]);return Dr(w!=null,`<Router basename="${u}"> is not able to match the URL "${f}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),w==null?null:R.createElement(Mr.Provider,{value:h},R.createElement(td.Provider,{children:e,value:w}))}function uI({children:t,location:e}){return YR(iy(t),e)}function iy(t,e=[]){let n=[];return R.Children.forEach(t,(r,i)=>{if(!R.isValidElement(r))return;let o=[...e,i];if(r.type===R.Fragment){n.push.apply(n,iy(r.props.children,o));return}Jt(r.type===bn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Jt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=iy(r.props.children,o)),n.push(l)}),n}var rf="get",sf="application/x-www-form-urlencoded";function Kf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function dI(t){return Kf(t)&&t.tagName.toLowerCase()==="button"}function hI(t){return Kf(t)&&t.tagName.toLowerCase()==="form"}function fI(t){return Kf(t)&&t.tagName.toLowerCase()==="input"}function mI(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function pI(t,e){return t.button===0&&(!e||e==="_self")&&!mI(t)}function ay(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function gI(t,e){let n=ay(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(o=>{n.append(i,o)})}),n}var Wh=null;function yI(){if(Wh===null)try{new FormData(document.createElement("form"),0),Wh=!1}catch{Wh=!0}return Wh}var _I=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Pg(t){return t!=null&&!_I.has(t)?(Dr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${sf}"`),null):t}function bI(t,e){let n,r,i,o,l;if(hI(t)){let u=t.getAttribute("action");r=u?Ci(u,e):null,n=t.getAttribute("method")||rf,i=Pg(t.getAttribute("enctype"))||sf,o=new FormData(t)}else if(dI(t)||fI(t)&&(t.type==="submit"||t.type==="image")){let u=t.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||u.getAttribute("action");if(r=h?Ci(h,e):null,n=t.getAttribute("formmethod")||u.getAttribute("method")||rf,i=Pg(t.getAttribute("formenctype"))||Pg(u.getAttribute("enctype"))||sf,o=new FormData(u,t),!yI()){let{name:f,type:p,value:g}=t;if(p==="image"){let b=f?`${f}.`:"";o.append(`${b}x`,"0"),o.append(`${b}y`,"0")}else f&&o.append(f,g)}}else{if(Kf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=rf,r=null,i=sf,l=t}return o&&i==="text/plain"&&(l=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Qy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function vI(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&Ci(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function xI(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function wI(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function SI(t,e,n){let r=await Promise.all(t.map(async i=>{let o=e.routes[i.route.id];if(o){let l=await xI(o,n);return l.links?l.links():[]}return[]}));return AI(r.flat(1).filter(wI).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Wx(t,e,n,r,i,o){let l=(h,f)=>n[f]?h.route.id!==n[f].route.id:!0,u=(h,f)=>n[f].pathname!==h.pathname||n[f].route.path?.endsWith("*")&&n[f].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,f)=>l(h,f)||u(h,f)):o==="data"?e.filter((h,f)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,f)||u(h,f))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function EI(t,e,{includeHydrateFallback:n}={}){return CI(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function CI(t){return[...new Set(t)]}function TI(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function AI(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let o=JSON.stringify(TI(i));return n.has(o)||(n.add(o),r.push({key:o,link:i})),r},[])}function I1(){let t=R.useContext(cc);return Qy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function jI(){let t=R.useContext(Gf);return Qy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Ky=R.createContext(void 0);Ky.displayName="FrameworkContext";function D1(){let t=R.useContext(Ky);return Qy(t,"You must render this element inside a <HydratedRouter> element"),t}function RI(t,e){let n=R.useContext(Ky),[r,i]=R.useState(!1),[o,l]=R.useState(!1),{onFocus:u,onBlur:h,onMouseEnter:f,onMouseLeave:p,onTouchStart:g}=e,b=R.useRef(null);R.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=C=>{C.forEach(T=>{l(T.isIntersecting)})},S=new IntersectionObserver(x,{threshold:.5});return b.current&&S.observe(b.current),()=>{S.disconnect()}}},[t]),R.useEffect(()=>{if(r){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[r]);let _=()=>{i(!0)},w=()=>{i(!1),l(!1)};return n?t!=="intent"?[o,b,{}]:[o,b,{onFocus:Au(u,_),onBlur:Au(h,w),onMouseEnter:Au(f,_),onMouseLeave:Au(p,w),onTouchStart:Au(g,_)}]:[!1,b,{}]}function Au(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function II({page:t,...e}){let{router:n}=I1(),r=R.useMemo(()=>g1(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?R.createElement(kI,{page:t,matches:r,...e}):null}function DI(t){let{manifest:e,routeModules:n}=D1(),[r,i]=R.useState([]);return R.useEffect(()=>{let o=!1;return SI(t,e,n).then(l=>{o||i(l)}),()=>{o=!0}},[t,e,n]),r}function kI({page:t,matches:e,...n}){let r=er(),{manifest:i,routeModules:o}=D1(),{basename:l}=I1(),{loaderData:u,matches:h}=jI(),f=R.useMemo(()=>Wx(t,e,h,i,r,"data"),[t,e,h,i,r]),p=R.useMemo(()=>Wx(t,e,h,i,r,"assets"),[t,e,h,i,r]),g=R.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let w=new Set,x=!1;if(e.forEach(C=>{let T=i.routes[C.route.id];!T||!T.hasLoader||(!f.some(I=>I.route.id===C.route.id)&&C.route.id in u&&o[C.route.id]?.shouldRevalidate||T.hasClientLoader?x=!0:w.add(C.route.id))}),w.size===0)return[];let S=vI(t,l,"data");return x&&w.size>0&&S.searchParams.set("_routes",e.filter(C=>w.has(C.route.id)).map(C=>C.route.id).join(",")),[S.pathname+S.search]},[l,u,r,i,f,e,t,o]),b=R.useMemo(()=>EI(p,i),[p,i]),_=DI(p);return R.createElement(R.Fragment,null,g.map(w=>R.createElement("link",{key:w,rel:"prefetch",as:"fetch",href:w,...n})),b.map(w=>R.createElement("link",{key:w,rel:"modulepreload",href:w,...n})),_.map(({key:w,link:x})=>R.createElement("link",{key:w,nonce:n.nonce,...x})))}function MI(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var OI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{OI&&(window.__reactRouterVersion="7.11.0")}catch{}function NI({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=R.useRef();i.current==null&&(i.current=dR({window:r,v5Compat:!0}));let o=i.current,[l,u]=R.useState({action:o.action,location:o.location}),h=R.useCallback(f=>{n===!1?u(f):R.startTransition(()=>u(f))},[n]);return R.useLayoutEffect(()=>o.listen(h),[o,h]),R.createElement(cI,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:n})}var k1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,An=R.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:o,replace:l,state:u,target:h,to:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b,..._},w){let{basename:x,unstable_useTransitions:S}=R.useContext(Mr),C=typeof f=="string"&&k1.test(f),T=x1(f,x);f=T.to;let I=HR(f,{relative:i}),[M,F,G]=RI(r,_),D=LI(f,{replace:l,state:u,target:h,preventScrollReset:p,relative:i,viewTransition:g,unstable_defaultShouldRevalidate:b,unstable_useTransitions:S});function O($){e&&e($),$.defaultPrevented||D($)}let P=R.createElement("a",{..._,...G,href:T.absoluteURL||I,onClick:T.isExternal||o?e:O,ref:MI(w,F),target:h,"data-discover":!C&&n==="render"?"true":void 0});return M&&!C?R.createElement(R.Fragment,null,P,R.createElement(II,{page:I})):P});An.displayName="Link";var PI=R.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:o,to:l,viewTransition:u,children:h,...f},p){let g=rd(l,{relative:f.relative}),b=er(),_=R.useContext(Gf),{navigator:w,basename:x}=R.useContext(Mr),S=_!=null&&qI(g)&&u===!0,C=w.encodeLocation?w.encodeLocation(g).pathname:g.pathname,T=b.pathname,I=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;n||(T=T.toLowerCase(),I=I?I.toLowerCase():null,C=C.toLowerCase()),I&&x&&(I=Ci(I,x)||I);const M=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let F=T===C||!i&&T.startsWith(C)&&T.charAt(M)==="/",G=I!=null&&(I===C||!i&&I.startsWith(C)&&I.charAt(C.length)==="/"),D={isActive:F,isPending:G,isTransitioning:S},O=F?e:void 0,P;typeof r=="function"?P=r(D):P=[r,F?"active":null,G?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let $=typeof o=="function"?o(D):o;return R.createElement(An,{...f,"aria-current":O,className:P,ref:p,style:$,to:l,viewTransition:u},typeof h=="function"?h(D):h)});PI.displayName="NavLink";var BI=R.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:o,method:l=rf,action:u,onSubmit:h,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b,..._},w)=>{let{unstable_useTransitions:x}=R.useContext(Mr),S=VI(),C=$I(u,{relative:f}),T=l.toLowerCase()==="get"?"get":"post",I=typeof u=="string"&&k1.test(u),M=F=>{if(h&&h(F),F.defaultPrevented)return;F.preventDefault();let G=F.nativeEvent.submitter,D=G?.getAttribute("formmethod")||l,O=()=>S(G||F.currentTarget,{fetcherKey:e,method:D,navigate:n,replace:i,state:o,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b});x&&n!==!1?R.startTransition(()=>O()):O()};return R.createElement("form",{ref:w,method:T,action:C,onSubmit:r?h:M,..._,"data-discover":!I&&t==="render"?"true":void 0})});BI.displayName="Form";function zI(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function M1(t){let e=R.useContext(cc);return Jt(e,zI(t)),e}function LI(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:u,unstable_useTransitions:h}={}){let f=nd(),p=er(),g=rd(t,{relative:o});return R.useCallback(b=>{if(pI(b,e)){b.preventDefault();let _=n!==void 0?n:Uu(p)===Uu(g),w=()=>f(t,{replace:_,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:u});h?R.startTransition(()=>w()):w()}},[p,f,g,n,r,e,t,i,o,l,u,h])}function O1(t){Dr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=R.useRef(ay(t)),n=R.useRef(!1),r=er(),i=R.useMemo(()=>gI(r.search,n.current?null:e.current),[r.search]),o=nd(),l=R.useCallback((u,h)=>{const f=ay(typeof u=="function"?u(new URLSearchParams(i)):u);n.current=!0,o("?"+f,h)},[o,i]);return[i,l]}var UI=0,FI=()=>`__${String(++UI)}__`;function VI(){let{router:t}=M1("useSubmit"),{basename:e}=R.useContext(Mr),n=iI(),r=t.fetch,i=t.navigate;return R.useCallback(async(o,l={})=>{let{action:u,method:h,encType:f,formData:p,body:g}=bI(o,e);if(l.navigate===!1){let b=l.fetcherKey||FI();await r(b,n,l.action||u,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||f,flushSync:l.flushSync})}else await i(l.action||u,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||f,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[r,i,e,n])}function $I(t,{relative:e}={}){let{basename:n}=R.useContext(Mr),r=R.useContext(Xr);Jt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...rd(t||".",{relative:e})},l=er();if(t==null){o.search=l.search;let u=new URLSearchParams(o.search),h=u.getAll("index");if(h.some(p=>p==="")){u.delete("index"),h.filter(g=>g).forEach(g=>u.append("index",g));let p=u.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:Si([n,o.pathname])),Uu(o)}function qI(t,{relative:e}={}){let n=R.useContext(S1);Jt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=M1("useViewTransitionState"),i=rd(t,{relative:e});if(!n.isTransitioning)return!1;let o=Ci(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=Ci(n.nextLocation.pathname,r)||n.nextLocation.pathname;return gf(i.pathname,l)!=null||gf(i.pathname,o)!=null}const HI={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},N1=R.createContext(HI);function GI({children:t}){const[e,n]=R.useState(new Map),r=R.useCallback((h,f)=>{n(p=>new Map(p).set(h,f))},[]),i=R.useCallback(h=>{n(f=>{const p=new Map(f);return p.delete(h),p})},[]),o=e.size>0,l=e.size>0&&Array.from(e.values()).pop()||"Loading...",u={isLoading:o,loadingMessage:l,addLoadingHold:r,removeLoadingHold:i};return d.jsx(N1.Provider,{value:u,children:t})}function Rn(){const t=R.useContext(N1);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const WI=()=>{};var Qx={};const P1=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},QI=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],l=t[n++],u=t[n++],h=((i&7)<<18|(o&63)<<12|(l&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|l&63)}}return e.join("")},B1={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],l=i+1<t.length,u=l?t[i+1]:0,h=i+2<t.length,f=h?t[i+2]:0,p=o>>2,g=(o&3)<<4|u>>4;let b=(u&15)<<2|f>>6,_=f&63;h||(_=64,l||(b=64)),r.push(n[p],n[g],n[b],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(P1(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):QI(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],u=i<t.length?n[t.charAt(i)]:0;++i;const f=i<t.length?n[t.charAt(i)]:64;++i;const g=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||u==null||f==null||g==null)throw new KI;const b=o<<2|u>>4;if(r.push(b),f!==64){const _=u<<4&240|f>>2;if(r.push(_),g!==64){const w=f<<6&192|g;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class KI extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const YI=function(t){const e=P1(t);return B1.encodeByteArray(e,!0)},yf=function(t){return YI(t).replace(/\./g,"")},z1=function(t){try{return B1.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function XI(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const ZI=()=>XI().__FIREBASE_DEFAULTS__,JI=()=>{if(typeof process>"u"||typeof Qx>"u")return;const t=Qx.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},e2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&z1(t[1]);return e&&JSON.parse(e)},Yf=()=>{try{return WI()||ZI()||JI()||e2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},L1=t=>Yf()?.emulatorHosts?.[t],t2=t=>{const e=L1(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},U1=()=>Yf()?.config,F1=t=>Yf()?.[`_${t}`];class n2{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function dc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function V1(t){return(await fetch(t,{credentials:"include"})).ok}function r2(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[yf(JSON.stringify(n)),yf(JSON.stringify(l)),""].join(".")}const Ou={};function s2(){const t={prod:[],emulator:[]};for(const e of Object.keys(Ou))Ou[e]?t.emulator.push(e):t.prod.push(e);return t}function i2(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Kx=!1;function $1(t,e){if(typeof window>"u"||typeof document>"u"||!dc(window.location.host)||Ou[t]===e||Ou[t]||Kx)return;Ou[t]=e;function n(b){return`__firebase__banner__${b}`}const r="__firebase__banner",o=s2().prod.length>0;function l(){const b=document.getElementById(r);b&&b.remove()}function u(b){b.style.display="flex",b.style.background="#7faaf0",b.style.position="fixed",b.style.bottom="5px",b.style.left="5px",b.style.padding=".5em",b.style.borderRadius="5px",b.style.alignItems="center"}function h(b,_){b.setAttribute("width","24"),b.setAttribute("id",_),b.setAttribute("height","24"),b.setAttribute("viewBox","0 0 24 24"),b.setAttribute("fill","none"),b.style.marginLeft="-6px"}function f(){const b=document.createElement("span");return b.style.cursor="pointer",b.style.marginLeft="16px",b.style.fontSize="24px",b.innerHTML=" &times;",b.onclick=()=>{Kx=!0,l()},b}function p(b,_){b.setAttribute("id",_),b.innerText="Learn more",b.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",b.setAttribute("target","__blank"),b.style.paddingLeft="5px",b.style.textDecoration="underline"}function g(){const b=i2(r),_=n("text"),w=document.getElementById(_)||document.createElement("span"),x=n("learnmore"),S=document.getElementById(x)||document.createElement("a"),C=n("preprendIcon"),T=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(b.created){const I=b.element;u(I),p(S,x);const M=f();h(T,C),I.append(T,w,S,M),document.body.appendChild(I)}o?(w.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function Jn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function a2(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Jn())}function o2(){const t=Yf()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function l2(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function c2(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function u2(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function d2(){const t=Jn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function h2(){return!o2()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function f2(){try{return typeof indexedDB=="object"}catch{return!1}}function m2(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(n){e(n)}})}const p2="FirebaseError";class Oi extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=p2,Object.setPrototypeOf(this,Oi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,sd.prototype.create)}}class sd{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],l=o?g2(o,r):"Error",u=`${this.serviceName}: ${l} (${i}).`;return new Oi(i,u,r)}}function g2(t,e){return t.replace(y2,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const y2=/\{\$([^}]+)}/g;function _2(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ti(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],l=e[i];if(Yx(o)&&Yx(l)){if(!Ti(o,l))return!1}else if(o!==l)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Yx(t){return t!==null&&typeof t=="object"}function id(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ju(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function Ru(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function b2(t,e){const n=new v2(t,e);return n.subscribe.bind(n)}class v2{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");x2(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=Bg),i.error===void 0&&(i.error=Bg),i.complete===void 0&&(i.complete=Bg);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function x2(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Bg(){}function Sn(t){return t&&t._delegate?t._delegate:t}class Mo{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const To="[DEFAULT]";class w2{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new n2;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(E2(e))try{this.getOrInitializeService({instanceIdentifier:To})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=To){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=To){return this.instances.has(e)}getOptions(e=To){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&l.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:S2(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=To){return this.component?this.component.multipleInstances?e:To:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function S2(t){return t===To?void 0:t}function E2(t){return t.instantiationMode==="EAGER"}class C2{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new w2(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var pt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(pt||(pt={}));const T2={debug:pt.DEBUG,verbose:pt.VERBOSE,info:pt.INFO,warn:pt.WARN,error:pt.ERROR,silent:pt.SILENT},A2=pt.INFO,j2={[pt.DEBUG]:"log",[pt.VERBOSE]:"log",[pt.INFO]:"info",[pt.WARN]:"warn",[pt.ERROR]:"error"},R2=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=j2[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Yy{constructor(e){this.name=e,this._logLevel=A2,this._logHandler=R2,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in pt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?T2[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,pt.DEBUG,...e),this._logHandler(this,pt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,pt.VERBOSE,...e),this._logHandler(this,pt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,pt.INFO,...e),this._logHandler(this,pt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,pt.WARN,...e),this._logHandler(this,pt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,pt.ERROR,...e),this._logHandler(this,pt.ERROR,...e)}}const I2=(t,e)=>e.some(n=>t instanceof n);let Xx,Zx;function D2(){return Xx||(Xx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function k2(){return Zx||(Zx=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const q1=new WeakMap,oy=new WeakMap,H1=new WeakMap,zg=new WeakMap,Xy=new WeakMap;function M2(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(Ca(t.result)),i()},l=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&q1.set(n,t)}).catch(()=>{}),Xy.set(e,t),e}function O2(t){if(oy.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),i()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});oy.set(t,e)}let ly={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return oy.get(t);if(e==="objectStoreNames")return t.objectStoreNames||H1.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ca(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function N2(t){ly=t(ly)}function P2(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Lg(this),e,...n);return H1.set(r,e.sort?e.sort():[e]),Ca(r)}:k2().includes(t)?function(...e){return t.apply(Lg(this),e),Ca(q1.get(this))}:function(...e){return Ca(t.apply(Lg(this),e))}}function B2(t){return typeof t=="function"?P2(t):(t instanceof IDBTransaction&&O2(t),I2(t,D2())?new Proxy(t,ly):t)}function Ca(t){if(t instanceof IDBRequest)return M2(t);if(zg.has(t))return zg.get(t);const e=B2(t);return e!==t&&(zg.set(t,e),Xy.set(e,t)),e}const Lg=t=>Xy.get(t);function z2(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(t,e),u=Ca(l);return r&&l.addEventListener("upgradeneeded",h=>{r(Ca(l.result),h.oldVersion,h.newVersion,Ca(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const L2=["get","getKey","getAll","getAllKeys","count"],U2=["put","add","delete","clear"],Ug=new Map;function Jx(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ug.get(e))return Ug.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=U2.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||L2.includes(n)))return;const o=async function(l,...u){const h=this.transaction(l,i?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(u.shift())),(await Promise.all([f[n](...u),i&&h.done]))[0]};return Ug.set(e,o),o}N2(t=>({...t,get:(e,n,r)=>Jx(e,n)||t.get(e,n,r),has:(e,n)=>!!Jx(e,n)||t.has(e,n)}));class F2{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(V2(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function V2(t){return t.getComponent()?.type==="VERSION"}const cy="@firebase/app",ew="0.14.6";const Ai=new Yy("@firebase/app"),$2="@firebase/app-compat",q2="@firebase/analytics-compat",H2="@firebase/analytics",G2="@firebase/app-check-compat",W2="@firebase/app-check",Q2="@firebase/auth",K2="@firebase/auth-compat",Y2="@firebase/database",X2="@firebase/data-connect",Z2="@firebase/database-compat",J2="@firebase/functions",eD="@firebase/functions-compat",tD="@firebase/installations",nD="@firebase/installations-compat",rD="@firebase/messaging",sD="@firebase/messaging-compat",iD="@firebase/performance",aD="@firebase/performance-compat",oD="@firebase/remote-config",lD="@firebase/remote-config-compat",cD="@firebase/storage",uD="@firebase/storage-compat",dD="@firebase/firestore",hD="@firebase/ai",fD="@firebase/firestore-compat",mD="firebase",pD="12.6.0";const uy="[DEFAULT]",gD={[cy]:"fire-core",[$2]:"fire-core-compat",[H2]:"fire-analytics",[q2]:"fire-analytics-compat",[W2]:"fire-app-check",[G2]:"fire-app-check-compat",[Q2]:"fire-auth",[K2]:"fire-auth-compat",[Y2]:"fire-rtdb",[X2]:"fire-data-connect",[Z2]:"fire-rtdb-compat",[J2]:"fire-fn",[eD]:"fire-fn-compat",[tD]:"fire-iid",[nD]:"fire-iid-compat",[rD]:"fire-fcm",[sD]:"fire-fcm-compat",[iD]:"fire-perf",[aD]:"fire-perf-compat",[oD]:"fire-rc",[lD]:"fire-rc-compat",[cD]:"fire-gcs",[uD]:"fire-gcs-compat",[dD]:"fire-fst",[fD]:"fire-fst-compat",[hD]:"fire-vertex","fire-js":"fire-js",[mD]:"fire-js-all"};const _f=new Map,yD=new Map,dy=new Map;function tw(t,e){try{t.container.addComponent(e)}catch(n){Ai.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Xl(t){const e=t.name;if(dy.has(e))return Ai.debug(`There were multiple attempts to register component ${e}.`),!1;dy.set(e,t);for(const n of _f.values())tw(n,t);for(const n of yD.values())tw(n,t);return!0}function Zy(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function us(t){return t==null?!1:t.settings!==void 0}const _D={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ta=new sd("app","Firebase",_D);class bD{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Mo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ta.create("app-deleted",{appName:this._name})}}const hc=pD;function G1(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:uy,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw Ta.create("bad-app-name",{appName:String(i)});if(n||(n=U1()),!n)throw Ta.create("no-options");const o=_f.get(i);if(o){if(Ti(n,o.options)&&Ti(r,o.config))return o;throw Ta.create("duplicate-app",{appName:i})}const l=new C2(i);for(const h of dy.values())l.addComponent(h);const u=new bD(n,r,l);return _f.set(i,u),u}function W1(t=uy){const e=_f.get(t);if(!e&&t===uy&&U1())return G1();if(!e)throw Ta.create("no-app",{appName:t});return e}function Aa(t,e,n){let r=gD[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${e}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ai.warn(l.join(" "));return}Xl(new Mo(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const vD="firebase-heartbeat-database",xD=1,Fu="firebase-heartbeat-store";let Fg=null;function Q1(){return Fg||(Fg=z2(vD,xD,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Fu)}catch(n){console.warn(n)}}}}).catch(t=>{throw Ta.create("idb-open",{originalErrorMessage:t.message})})),Fg}async function wD(t){try{const n=(await Q1()).transaction(Fu),r=await n.objectStore(Fu).get(K1(t));return await n.done,r}catch(e){if(e instanceof Oi)Ai.warn(e.message);else{const n=Ta.create("idb-get",{originalErrorMessage:e?.message});Ai.warn(n.message)}}}async function nw(t,e){try{const r=(await Q1()).transaction(Fu,"readwrite");await r.objectStore(Fu).put(e,K1(t)),await r.done}catch(n){if(n instanceof Oi)Ai.warn(n.message);else{const r=Ta.create("idb-set",{originalErrorMessage:n?.message});Ai.warn(r.message)}}}function K1(t){return`${t.name}!${t.options.appId}`}const SD=1024,ED=30;class CD{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new AD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=rw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>ED){const i=jD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ai.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=rw(),{heartbeatsToSend:n,unsentEntries:r}=TD(this._heartbeatsCache.heartbeats),i=yf(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Ai.warn(e),""}}}function rw(){return new Date().toISOString().substring(0,10)}function TD(t,e=SD){const n=[];let r=t.slice();for(const i of t){const o=n.find(l=>l.agent===i.agent);if(o){if(o.dates.push(i.date),sw(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),sw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class AD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return f2()?m2().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await wD(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return nw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return nw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function sw(t){return yf(JSON.stringify({version:2,heartbeats:t})).length}function jD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function RD(t){Xl(new Mo("platform-logger",e=>new F2(e),"PRIVATE")),Xl(new Mo("heartbeat",e=>new CD(e),"PRIVATE")),Aa(cy,ew,t),Aa(cy,ew,"esm2020"),Aa("fire-js","")}RD("");function Y1(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ID=Y1,X1=new sd("auth","Firebase",Y1());const bf=new Yy("@firebase/auth");function DD(t,...e){bf.logLevel<=pt.WARN&&bf.warn(`Auth (${hc}): ${t}`,...e)}function af(t,...e){bf.logLevel<=pt.ERROR&&bf.error(`Auth (${hc}): ${t}`,...e)}function fs(t,...e){throw Jy(t,...e)}function Fs(t,...e){return Jy(t,...e)}function Z1(t,e,n){const r={...ID(),[e]:n};return new sd("auth","Firebase",r).create(e,{appName:t.name})}function ja(t){return Z1(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Jy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return X1.create(t,...e)}function Ze(t,e,...n){if(!t)throw Jy(e,...n)}function xi(t){const e="INTERNAL ASSERTION FAILED: "+t;throw af(e),new Error(e)}function ji(t,e){t||xi(e)}function hy(){return typeof self<"u"&&self.location?.href||""}function kD(){return iw()==="http:"||iw()==="https:"}function iw(){return typeof self<"u"&&self.location?.protocol||null}function MD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(kD()||c2()||"connection"in navigator)?navigator.onLine:!0}function OD(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class ad{constructor(e,n){this.shortDelay=e,this.longDelay=n,ji(n>e,"Short delay should be less than long delay!"),this.isMobile=a2()||u2()}get(){return MD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function e_(t,e){ji(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class J1{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;xi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;xi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;xi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ND={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const PD=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],BD=new ad(3e4,6e4);function Fo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Va(t,e,n,r,i={}){return eE(t,i,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const u=id({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const f={method:e,headers:h,...o};return l2()||(f.referrerPolicy="no-referrer"),t.emulatorConfig&&dc(t.emulatorConfig.host)&&(f.credentials="include"),J1.fetch()(await tE(t,t.config.apiHost,n,u),f)})}async function eE(t,e,n){t._canInitEmulator=!1;const r={...ND,...e};try{const i=new LD(t),o=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Qh(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const u=o.ok?l.errorMessage:l.error.message,[h,f]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Qh(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Qh(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw Qh(t,"user-disabled",l);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw Z1(t,p,f);fs(t,p)}}catch(i){if(i instanceof Oi)throw i;fs(t,"network-request-failed",{message:String(i)})}}async function Xf(t,e,n,r,i={}){const o=await Va(t,e,n,r,i);return"mfaPendingCredential"in o&&fs(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function tE(t,e,n,r){const i=`${e}${n}?${r}`,o=t,l=o.config.emulator?e_(t.config,i):`${t.config.apiScheme}://${i}`;return PD.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function zD(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class LD{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Fs(this.auth,"network-request-failed")),BD.get())})}}function Qh(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Fs(t,e,r);return i.customData._tokenResponse=n,i}function aw(t){return t!==void 0&&t.enterprise!==void 0}class UD{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return zD(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function FD(t,e){return Va(t,"GET","/v2/recaptchaConfig",Fo(t,e))}async function VD(t,e){return Va(t,"POST","/v1/accounts:delete",e)}async function vf(t,e){return Va(t,"POST","/v1/accounts:lookup",e)}function Nu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function $D(t,e=!1){const n=Sn(t),r=await n.getIdToken(e),i=t_(r);Ze(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,l=o?.sign_in_provider;return{claims:i,token:r,authTime:Nu(Vg(i.auth_time)),issuedAtTime:Nu(Vg(i.iat)),expirationTime:Nu(Vg(i.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Vg(t){return Number(t)*1e3}function t_(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return af("JWT malformed, contained fewer than 3 sections"),null;try{const i=z1(n);return i?JSON.parse(i):(af("Failed to decode base64 JWT payload"),null)}catch(i){return af("Caught error parsing JWT payload as JSON",i?.toString()),null}}function ow(t){const e=t_(t);return Ze(e,"internal-error"),Ze(typeof e.exp<"u","internal-error"),Ze(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Vu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Oi&&qD(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function qD({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class HD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class fy{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Nu(this.lastLoginAt),this.creationTime=Nu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function xf(t){const e=t.auth,n=await t.getIdToken(),r=await Vu(t,vf(e,{idToken:n}));Ze(r?.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=i.providerUserInfo?.length?nE(i.providerUserInfo):[],l=WD(t.providerData,o),u=t.isAnonymous,h=!(t.email&&i.passwordHash)&&!l?.length,f=u?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new fy(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(t,p)}async function GD(t){const e=Sn(t);await xf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function WD(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function nE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function QD(t,e){const n=await eE(t,{},async()=>{const r=id({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=t.config,l=await tE(t,i,"/v1/token",`key=${o}`),u=await t._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:u,body:r};return t.emulatorConfig&&dc(t.emulatorConfig.host)&&(h.credentials="include"),J1.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function KD(t,e){return Va(t,"POST","/v2/accounts:revokeToken",Fo(t,e))}class Gl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ze(e.idToken,"internal-error"),Ze(typeof e.idToken<"u","internal-error"),Ze(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ow(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ze(e.length!==0,"internal-error");const n=ow(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ze(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:o}=await QD(e,n);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:o}=n,l=new Gl;return r&&(Ze(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),i&&(Ze(typeof i=="string","internal-error",{appName:e}),l.accessToken=i),o&&(Ze(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Gl,this.toJSON())}_performRefresh(){return xi("not implemented")}}function pa(t,e){Ze(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class ds{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new HD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new fy(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Vu(this,this.stsTokenManager.getToken(this.auth,e));return Ze(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return $D(this,e)}reload(){return GD(this)}_assign(e){this!==e&&(Ze(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new ds({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ze(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await xf(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(us(this.auth.app))return Promise.reject(ja(this.auth));const e=await this.getIdToken();return await Vu(this,VD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,u=n.tenantId??void 0,h=n._redirectEventId??void 0,f=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:b,isAnonymous:_,providerData:w,stsTokenManager:x}=n;Ze(g&&x,e,"internal-error");const S=Gl.fromJSON(this.name,x);Ze(typeof g=="string",e,"internal-error"),pa(r,e.name),pa(i,e.name),Ze(typeof b=="boolean",e,"internal-error"),Ze(typeof _=="boolean",e,"internal-error"),pa(o,e.name),pa(l,e.name),pa(u,e.name),pa(h,e.name),pa(f,e.name),pa(p,e.name);const C=new ds({uid:g,auth:e,email:i,emailVerified:b,displayName:r,isAnonymous:_,photoURL:l,phoneNumber:o,tenantId:u,stsTokenManager:S,createdAt:f,lastLoginAt:p});return w&&Array.isArray(w)&&(C.providerData=w.map(T=>({...T}))),h&&(C._redirectEventId=h),C}static async _fromIdTokenResponse(e,n,r=!1){const i=new Gl;i.updateFromServerResponse(n);const o=new ds({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await xf(o),o}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];Ze(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?nE(i.providerUserInfo):[],l=!(i.email&&i.passwordHash)&&!o?.length,u=new Gl;u.updateFromIdToken(r);const h=new ds({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:l}),f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new fy(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,f),h}}const lw=new Map;function wi(t){ji(t instanceof Function,"Expected a class definition");let e=lw.get(t);return e?(ji(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,lw.set(t,e),e)}class rE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}rE.type="NONE";const cw=rE;function of(t,e,n){return`firebase:${t}:${e}:${n}`}class Wl{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=of(this.userKey,i.apiKey,o),this.fullPersistenceKey=of("persistence",i.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await vf(this.auth,{idToken:e}).catch(()=>{});return n?ds._fromGetAccountInfoResponse(this.auth,n,e):null}return ds._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Wl(wi(cw),e,r);const i=(await Promise.all(n.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let o=i[0]||wi(cw);const l=of(r,e.config.apiKey,e.name);let u=null;for(const f of n)try{const p=await f._get(l);if(p){let g;if(typeof p=="string"){const b=await vf(e,{idToken:p}).catch(()=>{});if(!b)break;g=await ds._fromGetAccountInfoResponse(e,b,p)}else g=ds._fromJSON(e,p);f!==o&&(u=g),o=f;break}}catch{}const h=i.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Wl(o,e,r):(o=h[0],u&&await o._set(l,u.toJSON()),await Promise.all(n.map(async f=>{if(f!==o)try{await f._remove(l)}catch{}})),new Wl(o,e,r))}}function uw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(oE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(sE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(cE(e))return"Blackberry";if(uE(e))return"Webos";if(iE(e))return"Safari";if((e.includes("chrome/")||aE(e))&&!e.includes("edge/"))return"Chrome";if(lE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function sE(t=Jn()){return/firefox\//i.test(t)}function iE(t=Jn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function aE(t=Jn()){return/crios\//i.test(t)}function oE(t=Jn()){return/iemobile/i.test(t)}function lE(t=Jn()){return/android/i.test(t)}function cE(t=Jn()){return/blackberry/i.test(t)}function uE(t=Jn()){return/webos/i.test(t)}function n_(t=Jn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function YD(t=Jn()){return n_(t)&&!!window.navigator?.standalone}function XD(){return d2()&&document.documentMode===10}function dE(t=Jn()){return n_(t)||lE(t)||uE(t)||cE(t)||/windows phone/i.test(t)||oE(t)}function hE(t,e=[]){let n;switch(t){case"Browser":n=uw(Jn());break;case"Worker":n=`${uw(Jn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${hc}/${r}`}class ZD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,u)=>{try{const h=e(o);l(h)}catch(h){u(h)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function JD(t,e={}){return Va(t,"GET","/v2/passwordPolicy",Fo(t,e))}const ek=6;class tk{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??ek,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class nk{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new dw(this),this.idTokenSubscription=new dw(this),this.beforeStateQueue=new ZD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=X1,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=wi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Wl.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await vf(this,{idToken:e}),r=await ds._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(us(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===l)&&u?.user&&(r=u.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ze(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await xf(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=OD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(us(this.app))return Promise.reject(ja(this));const n=e?Sn(e):null;return n&&Ze(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ze(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return us(this.app)?Promise.reject(ja(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return us(this.app)?Promise.reject(ja(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(wi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await JD(this),n=new tk(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new sd("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await KD(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&wi(e)||this._popupRedirectResolver;Ze(n,this,"argument-error"),this.redirectPersistenceManager=await Wl.create(this,[wi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ze(u,this,"internal-error"),u.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,i);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ze(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=hE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(us(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&DD(`Error while retrieving App Check token: ${e.error}`),e?.token}}function fc(t){return Sn(t)}class dw{constructor(e){this.auth=e,this.observer=null,this.addObserver=b2(n=>this.observer=n)}get next(){return Ze(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Zf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function rk(t){Zf=t}function fE(t){return Zf.loadJS(t)}function sk(){return Zf.recaptchaEnterpriseScript}function ik(){return Zf.gapiScript}function ak(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class ok{constructor(){this.enterprise=new lk}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class lk{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const ck="recaptcha-enterprise",mE="NO_RECAPTCHA";class uk{constructor(e){this.type=ck,this.auth=fc(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,u)=>{FD(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const f=new UD(h);return o.tenantId==null?o._agentRecaptchaConfig=f:o._tenantRecaptchaConfigs[o.tenantId]=f,l(f.siteKey)}}).catch(h=>{u(h)})})}function i(o,l,u){const h=window.grecaptcha;aw(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(f=>{l(f)}).catch(()=>{l(mE)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ok().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(u=>{if(!n&&aw(window.grecaptcha))i(u,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=sk();h.length!==0&&(h+=u),fE(h).then(()=>{i(u,o,l)}).catch(f=>{l(f)})}}).catch(u=>{l(u)})})}}async function hw(t,e,n,r=!1,i=!1){const o=new uk(t);let l;if(i)l=mE;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const u={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const h=u.phoneEnrollmentInfo.phoneNumber,f=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:f,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const h=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return r?Object.assign(u,{captchaResp:l}):Object.assign(u,{captchaResponse:l}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function fw(t,e,n,r,i){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await hw(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await hw(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function dk(t,e){const n=Zy(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),o=n.getOptions();if(Ti(o,e??{}))return i;fs(i,"already-initialized")}return n.initialize({options:e})}function hk(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(wi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function fk(t,e,n){const r=fc(t);Ze(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=pE(e),{host:l,port:u}=mk(e),h=u===null?"":`:${u}`,f={url:`${o}//${l}${h}/`},p=Object.freeze({host:l,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Ze(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ze(Ti(f,r.config.emulator)&&Ti(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=f,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,dc(l)?(V1(`${o}//${l}${h}`),$1("Auth",!0)):pk()}function pE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function mk(t){const e=pE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:mw(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:mw(l)}}}function mw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function pk(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class r_{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return xi("not implemented")}_getIdTokenResponse(e){return xi("not implemented")}_linkToIdToken(e,n){return xi("not implemented")}_getReauthenticationResolver(e){return xi("not implemented")}}async function gk(t,e){return Va(t,"POST","/v1/accounts:signUp",e)}async function yk(t,e){return Xf(t,"POST","/v1/accounts:signInWithPassword",Fo(t,e))}async function _k(t,e){return Xf(t,"POST","/v1/accounts:signInWithEmailLink",Fo(t,e))}async function bk(t,e){return Xf(t,"POST","/v1/accounts:signInWithEmailLink",Fo(t,e))}class $u extends r_{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new $u(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new $u(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fw(e,n,"signInWithPassword",yk);case"emailLink":return _k(e,{email:this._email,oobCode:this._password});default:fs(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fw(e,r,"signUpPassword",gk);case"emailLink":return bk(e,{idToken:n,email:this._email,oobCode:this._password});default:fs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ql(t,e){return Xf(t,"POST","/v1/accounts:signInWithIdp",Fo(t,e))}const vk="http://localhost";class Oo extends r_{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Oo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):fs("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...o}=n;if(!r||!i)return null;const l=new Oo(r,i);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return Ql(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Ql(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Ql(e,n)}buildRequest(){const e={requestUri:vk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=id(n)}return e}}function xk(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function wk(t){const e=ju(Ru(t)).link,n=e?ju(Ru(e)).deep_link_id:null,r=ju(Ru(t)).deep_link_id;return(r?ju(Ru(r)).link:null)||r||n||e||t}class s_{constructor(e){const n=ju(Ru(e)),r=n.apiKey??null,i=n.oobCode??null,o=xk(n.mode??null);Ze(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=wk(e);try{return new s_(n)}catch{return null}}}class mc{constructor(){this.providerId=mc.PROVIDER_ID}static credential(e,n){return $u._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=s_.parseLink(n);return Ze(r,"argument-error"),$u._fromEmailAndCode(e,r.code,r.tenantId)}}mc.PROVIDER_ID="password";mc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";mc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class gE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class od extends gE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ya extends od{constructor(){super("facebook.com")}static credential(e){return Oo._fromParams({providerId:ya.PROVIDER_ID,signInMethod:ya.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ya.credentialFromTaggedObject(e)}static credentialFromError(e){return ya.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ya.credential(e.oauthAccessToken)}catch{return null}}}ya.FACEBOOK_SIGN_IN_METHOD="facebook.com";ya.PROVIDER_ID="facebook.com";class _a extends od{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Oo._fromParams({providerId:_a.PROVIDER_ID,signInMethod:_a.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return _a.credentialFromTaggedObject(e)}static credentialFromError(e){return _a.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return _a.credential(n,r)}catch{return null}}}_a.GOOGLE_SIGN_IN_METHOD="google.com";_a.PROVIDER_ID="google.com";class ba extends od{constructor(){super("github.com")}static credential(e){return Oo._fromParams({providerId:ba.PROVIDER_ID,signInMethod:ba.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ba.credentialFromTaggedObject(e)}static credentialFromError(e){return ba.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ba.credential(e.oauthAccessToken)}catch{return null}}}ba.GITHUB_SIGN_IN_METHOD="github.com";ba.PROVIDER_ID="github.com";class va extends od{constructor(){super("twitter.com")}static credential(e,n){return Oo._fromParams({providerId:va.PROVIDER_ID,signInMethod:va.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return va.credentialFromTaggedObject(e)}static credentialFromError(e){return va.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return va.credential(n,r)}catch{return null}}}va.TWITTER_SIGN_IN_METHOD="twitter.com";va.PROVIDER_ID="twitter.com";class Zl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const o=await ds._fromIdTokenResponse(e,r,i),l=pw(r);return new Zl({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=pw(r);return new Zl({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function pw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class wf extends Oi{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,wf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new wf(e,n,r,i)}}function yE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?wf._fromErrorAndOperation(t,o,e,r):o})}async function Sk(t,e,n=!1){const r=await Vu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Zl._forOperation(t,"link",r)}async function Ek(t,e,n=!1){const{auth:r}=t;if(us(r.app))return Promise.reject(ja(r));const i="reauthenticate";try{const o=await Vu(t,yE(r,i,e,t),n);Ze(o.idToken,r,"internal-error");const l=t_(o.idToken);Ze(l,r,"internal-error");const{sub:u}=l;return Ze(t.uid===u,r,"user-mismatch"),Zl._forOperation(t,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&fs(r,"user-mismatch"),o}}async function _E(t,e,n=!1){if(us(t.app))return Promise.reject(ja(t));const r="signIn",i=await yE(t,r,e),o=await Zl._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(o.user),o}async function Ck(t,e){return _E(fc(t),e)}async function Tk(t){const e=fc(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function Ak(t,e,n){return us(t.app)?Promise.reject(ja(t)):Ck(Sn(t),mc.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Tk(t),r})}function jk(t,e,n,r){return Sn(t).onIdTokenChanged(e,n,r)}function Rk(t,e,n){return Sn(t).beforeAuthStateChanged(e,n)}function Ik(t,e,n,r){return Sn(t).onAuthStateChanged(e,n,r)}function Dk(t){return Sn(t).signOut()}const Sf="__sak";class bE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Sf,"1"),this.storage.removeItem(Sf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const kk=1e3,Mk=10;class vE extends bE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=dE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,u,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);XD()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Mk):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},kk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}vE.type="LOCAL";const Ok=vE;class xE extends bE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}xE.type="SESSION";const wE=xE;function Nk(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class Jf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new Jf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:o}=n.data,l=this.handlersMap[i];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const u=Array.from(l).map(async f=>f(n.origin,o)),h=await Nk(u);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Jf.receivers=[];function i_(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class Pk{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,l;return new Promise((u,h)=>{const f=i_("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:i,onMessage(g){const b=g;if(b.data.eventId===f)switch(b.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(b.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),i.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:f,data:n},[i.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Vs(){return window}function Bk(t){Vs().location.href=t}function SE(){return typeof Vs().WorkerGlobalScope<"u"&&typeof Vs().importScripts=="function"}async function zk(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Lk(){return navigator?.serviceWorker?.controller||null}function Uk(){return SE()?self:null}const EE="firebaseLocalStorageDb",Fk=1,Ef="firebaseLocalStorage",CE="fbase_key";class ld{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function em(t,e){return t.transaction([Ef],e?"readwrite":"readonly").objectStore(Ef)}function Vk(){const t=indexedDB.deleteDatabase(EE);return new ld(t).toPromise()}function my(){const t=indexedDB.open(EE,Fk);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Ef,{keyPath:CE})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Ef)?e(r):(r.close(),await Vk(),e(await my()))})})}async function gw(t,e,n){const r=em(t,!0).put({[CE]:e,value:n});return new ld(r).toPromise()}async function $k(t,e){const n=em(t,!1).get(e),r=await new ld(n).toPromise();return r===void 0?null:r.value}function yw(t,e){const n=em(t,!0).delete(e);return new ld(n).toPromise()}const qk=800,Hk=3;class TE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await my(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>Hk)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return SE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Jf._getInstance(Uk()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await zk(),!this.activeServiceWorker)return;this.sender=new Pk(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Lk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await my();return await gw(e,Sf,"1"),await yw(e,Sf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>gw(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>$k(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>yw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=em(i,!1).getAll();return new ld(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),qk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}TE.type="LOCAL";const Gk=TE;new ad(3e4,6e4);function Wk(t,e){return e?wi(e):(Ze(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class a_ extends r_{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ql(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Ql(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Ql(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function Qk(t){return _E(t.auth,new a_(t),t.bypassAuthState)}function Kk(t){const{auth:e,user:n}=t;return Ze(n,e,"internal-error"),Ek(n,new a_(t),t.bypassAuthState)}async function Yk(t){const{auth:e,user:n}=t;return Ze(n,e,"internal-error"),Sk(n,new a_(t),t.bypassAuthState)}class AE{constructor(e,n,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:o,error:l,type:u}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Qk;case"linkViaPopup":case"linkViaRedirect":return Yk;case"reauthViaPopup":case"reauthViaRedirect":return Kk;default:fs(this.auth,"internal-error")}}resolve(e){ji(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ji(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Xk=new ad(2e3,1e4);class Hl extends AE{constructor(e,n,r,i,o){super(e,n,i,o),this.provider=r,this.authWindow=null,this.pollId=null,Hl.currentPopupAction&&Hl.currentPopupAction.cancel(),Hl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ze(e,this.auth,"internal-error"),e}async onExecution(){ji(this.filter.length===1,"Popup operations only handle one event");const e=i_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Fs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Fs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Hl.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Fs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Xk.get())};e()}}Hl.currentPopupAction=null;const Zk="pendingRedirect",lf=new Map;class Jk extends AE{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=lf.get(this.auth._key());if(!e){try{const r=await e5(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}lf.set(this.auth._key(),e)}return this.bypassAuthState||lf.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function e5(t,e){const n=r5(e),r=n5(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function t5(t,e){lf.set(t._key(),e)}function n5(t){return wi(t._redirectPersistence)}function r5(t){return of(Zk,t.config.apiKey,t.name)}async function s5(t,e,n=!1){if(us(t.app))return Promise.reject(ja(t));const r=fc(t),i=Wk(r,e),l=await new Jk(r,i,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const i5=600*1e3;class a5{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!o5(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!jE(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Fs(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=i5&&this.cachedEventUids.clear(),this.cachedEventUids.has(_w(e))}saveEventToCache(e){this.cachedEventUids.add(_w(e)),this.lastProcessedEventTime=Date.now()}}function _w(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function jE({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function o5(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return jE(t);default:return!1}}async function l5(t,e={}){return Va(t,"GET","/v1/projects",e)}const c5=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,u5=/^https?/;async function d5(t){if(t.config.emulator)return;const{authorizedDomains:e}=await l5(t);for(const n of e)try{if(h5(n))return}catch{}fs(t,"unauthorized-domain")}function h5(t){const e=hy(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!u5.test(n))return!1;if(c5.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const f5=new ad(3e4,6e4);function bw(){const t=Vs().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function m5(t){return new Promise((e,n)=>{function r(){bw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{bw(),n(Fs(t,"network-request-failed"))},timeout:f5.get()})}if(Vs().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Vs().gapi?.load)r();else{const i=ak("iframefcb");return Vs()[i]=()=>{gapi.load?r():n(Fs(t,"network-request-failed"))},fE(`${ik()}?onload=${i}`).catch(o=>n(o))}}).catch(e=>{throw cf=null,e})}let cf=null;function p5(t){return cf=cf||m5(t),cf}const g5=new ad(5e3,15e3),y5="__/auth/iframe",_5="emulator/auth/iframe",b5={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},v5=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function x5(t){const e=t.config;Ze(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?e_(e,_5):`https://${t.config.authDomain}/${y5}`,r={apiKey:e.apiKey,appName:t.name,v:hc},i=v5.get(t.config.apiHost);i&&(r.eid=i);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${id(r).slice(1)}`}async function w5(t){const e=await p5(t),n=Vs().gapi;return Ze(n,t,"internal-error"),e.open({where:document.body,url:x5(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:b5,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const l=Fs(t,"network-request-failed"),u=Vs().setTimeout(()=>{o(l)},g5.get());function h(){Vs().clearTimeout(u),i(r)}r.ping(h).then(h,()=>{o(l)})}))}const S5={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},E5=500,C5=600,T5="_blank",A5="http://localhost";class vw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function j5(t,e,n,r=E5,i=C5){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let u="";const h={...S5,width:r.toString(),height:i.toString(),top:o,left:l},f=Jn().toLowerCase();n&&(u=aE(f)?T5:n),sE(f)&&(e=e||A5,h.scrollbars="yes");const p=Object.entries(h).reduce((b,[_,w])=>`${b}${_}=${w},`,"");if(YD(f)&&u!=="_self")return R5(e||"",u),new vw(null);const g=window.open(e||"",u,p);Ze(g,t,"popup-blocked");try{g.focus()}catch{}return new vw(g)}function R5(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const I5="__/auth/handler",D5="emulator/auth/handler",k5=encodeURIComponent("fac");async function xw(t,e,n,r,i,o){Ze(t.config.authDomain,t,"auth-domain-config-required"),Ze(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:hc,eventId:i};if(e instanceof gE){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",_2(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))l[p]=g}if(e instanceof od){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(l.scopes=p.join(","))}t.tenantId&&(l.tid=t.tenantId);const u=l;for(const p of Object.keys(u))u[p]===void 0&&delete u[p];const h=await t._getAppCheckToken(),f=h?`#${k5}=${encodeURIComponent(h)}`:"";return`${M5(t)}?${id(u).slice(1)}${f}`}function M5({config:t}){return t.emulator?e_(t,D5):`https://${t.authDomain}/${I5}`}const $g="webStorageSupport";class O5{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=wE,this._completeRedirectFn=s5,this._overrideRedirectResult=t5}async _openPopup(e,n,r,i){ji(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await xw(e,n,r,hy(),i);return j5(e,o,i_())}async _openRedirect(e,n,r,i){await this._originValidation(e);const o=await xw(e,n,r,hy(),i);return Bk(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:o}=this.eventManagers[n];return i?Promise.resolve(i):(ji(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await w5(e),r=new a5(e);return n.register("authEvent",i=>(Ze(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send($g,{type:$g},i=>{const o=i?.[0]?.[$g];o!==void 0&&n(!!o),fs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=d5(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return dE()||iE()||n_()}}const N5=O5;var ww="@firebase/auth",Sw="1.12.0";class P5{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ze(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function B5(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function z5(t){Xl(new Mo("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:u}=r.options;Ze(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:u,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:hE(t)},f=new nk(r,i,o,h);return hk(f,n),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Xl(new Mo("auth-internal",e=>{const n=fc(e.getProvider("auth").getImmediate());return(r=>new P5(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Aa(ww,Sw,B5(t)),Aa(ww,Sw,"esm2020")}const L5=300,U5=F1("authIdTokenMaxAge")||L5;let Ew=null;const F5=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>U5)return;const i=n?.token;Ew!==i&&(Ew=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function V5(t=W1()){const e=Zy(t,"auth");if(e.isInitialized())return e.getImmediate();const n=dk(t,{popupRedirectResolver:N5,persistence:[Gk,Ok,wE]}),r=F1("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=F5(o.toString());Rk(n,l,()=>l(n.currentUser)),jk(n,u=>l(u))}}const i=L1("auth");return i&&fk(n,`http://${i}`),n}function $5(){return document.getElementsByTagName("head")?.[0]??document}rk({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const o=Fs("internal-error");o.customData=i,n(o)},r.type="text/javascript",r.charset="UTF-8",$5().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});z5("Browser");var q5="firebase",H5="12.7.0";Aa(q5,H5,"app");const G5={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},RE=G1(G5);function Ni(){const t=V5(RE);async function e(){return!1}async function n(h,f){return Ak(t,h,f)}function r(){return Dk(t)}function i(h){Ik(t,f=>{h(f)})}function o(){return t.currentUser}function l(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:i,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:l}}var pc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},W5={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Q5=class{#e=W5;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},jo=new Q5;function K5(t){setTimeout(t,0)}var No=typeof window>"u"||"Deno"in globalThis;function ar(){}function Y5(t,e){return typeof t=="function"?t(e):t}function py(t){return typeof t=="number"&&t>=0&&t!==1/0}function IE(t,e){return Math.max(t+(e||0)-Date.now(),0)}function Ra(t,e){return typeof t=="function"?t(e):t}function Wr(t,e){return typeof t=="function"?t(e):t}function Cw(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:o,queryKey:l,stale:u}=t;if(l){if(r){if(e.queryHash!==o_(l,e.options))return!1}else if(!qu(e.queryKey,l))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof u=="boolean"&&e.isStale()!==u||i&&i!==e.state.fetchStatus||o&&!o(e))}function Tw(t,e){const{exact:n,status:r,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(Po(e.options.mutationKey)!==Po(o))return!1}else if(!qu(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function o_(t,e){return(e?.queryKeyHashFn||Po)(t)}function Po(t){return JSON.stringify(t,(e,n)=>gy(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function qu(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>qu(t[n],e[n])):!1}var X5=Object.prototype.hasOwnProperty;function DE(t,e){if(t===e)return t;const n=Aw(t)&&Aw(e);if(!n&&!(gy(t)&&gy(e)))return e;const i=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),l=o.length,u=n?new Array(l):{};let h=0;for(let f=0;f<l;f++){const p=n?f:o[f],g=t[p],b=e[p];if(g===b){u[p]=g,(n?f<i:X5.call(t,p))&&h++;continue}if(g===null||b===null||typeof g!="object"||typeof b!="object"){u[p]=b;continue}const _=DE(g,b);u[p]=_,_===g&&h++}return i===l&&h===i?t:u}function Cf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Aw(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function gy(t){if(!jw(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!jw(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function jw(t){return Object.prototype.toString.call(t)==="[object Object]"}function Z5(t){return new Promise(e=>{jo.setTimeout(e,t)})}function yy(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?DE(t,e):e}function J5(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function eM(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var l_=Symbol();function kE(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===l_?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function ME(t,e){return typeof t=="function"?t(...e):!!t}var tM=class extends pc{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!No&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},c_=new tM;function _y(){let t,e;const n=new Promise((i,o)=>{t=i,e=o});n.status="pending",n.catch(()=>{});function r(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},n.reject=i=>{r({status:"rejected",reason:i}),e(i)},n}var nM=K5;function rM(){let t=[],e=0,n=u=>{u()},r=u=>{u()},i=nM;const o=u=>{e?t.push(u):i(()=>{n(u)})},l=()=>{const u=t;t=[],u.length&&i(()=>{r(()=>{u.forEach(h=>{n(h)})})})};return{batch:u=>{let h;e++;try{h=u()}finally{e--,e||l()}return h},batchCalls:u=>(...h)=>{o(()=>{u(...h)})},schedule:o,setNotifyFunction:u=>{n=u},setBatchNotifyFunction:u=>{r=u},setScheduler:u=>{i=u}}}var Tn=rM(),sM=class extends pc{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!No&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},Tf=new sM;function iM(t){return Math.min(1e3*2**t,3e4)}function OE(t){return(t??"online")==="online"?Tf.isOnline():!0}var by=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function NE(t){let e=!1,n=0,r;const i=_y(),o=()=>i.status!=="pending",l=x=>{if(!o()){const S=new by(x);b(S),t.onCancel?.(S)}},u=()=>{e=!0},h=()=>{e=!1},f=()=>c_.isFocused()&&(t.networkMode==="always"||Tf.isOnline())&&t.canRun(),p=()=>OE(t.networkMode)&&t.canRun(),g=x=>{o()||(r?.(),i.resolve(x))},b=x=>{o()||(r?.(),i.reject(x))},_=()=>new Promise(x=>{r=S=>{(o()||f())&&x(S)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),w=()=>{if(o())return;let x;const S=n===0?t.initialPromise:void 0;try{x=S??t.fn()}catch(C){x=Promise.reject(C)}Promise.resolve(x).then(g).catch(C=>{if(o())return;const T=t.retry??(No?0:3),I=t.retryDelay??iM,M=typeof I=="function"?I(n,C):I,F=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,C);if(e||!F){b(C);return}n++,t.onFail?.(n,C),Z5(M).then(()=>f()?void 0:_()).then(()=>{e?b(C):w()})})};return{promise:i,status:()=>i.status,cancel:l,continue:()=>(r?.(),i),cancelRetry:u,continueRetry:h,canStart:p,start:()=>(p()?w():_().then(w),i)}}var PE=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),py(this.gcTime)&&(this.#e=jo.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(No?1/0:300*1e3))}clearGcTimeout(){this.#e&&(jo.clearTimeout(this.#e),this.#e=void 0)}},aM=class extends PE{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=Iw(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=Iw(this.options);n.data!==void 0&&(this.setState(Rw(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=yy(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(ar).catch(ar):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Wr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===l_||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>Ra(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!IE(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(f=>f.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,i=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=kE(this.options,n),p=(()=>{const g={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},u=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return i(h),h})();this.options.behavior?.onFetch(u,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==u.fetchOptions?.meta)&&this.#i({type:"fetch",meta:u.fetchOptions?.meta}),this.#r=NE({initialPromise:n?.initialPromise,fn:u.fetchFn,onCancel:h=>{h instanceof by&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,f)=>{this.#i({type:"failed",failureCount:h,error:f})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof by){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#i({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...BE(r.data,this.options),fetchMeta:e.meta??null};case"success":const i={...r,...Rw(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),Tn.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function BE(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:OE(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Rw(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Iw(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var oM=class extends pc{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=_y(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Dw(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return vy(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return vy(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Wr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!Cf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&kw(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Wr(this.options.enabled,this.#t)!==Wr(e.enabled,this.#t)||Ra(this.options.staleTime,this.#t)!==Ra(e.staleTime,this.#t))&&this.#g();const i=this.#y();r&&(this.#t!==n||Wr(this.options.enabled,this.#t)!==Wr(e.enabled,this.#t)||i!==this.#l)&&this.#_(i)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return cM(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(ar)),e}#g(){this.#v();const t=Ra(this.options.staleTime,this.#t);if(No||this.#s.isStale||!py(t))return;const n=IE(this.#s.dataUpdatedAt,t)+1;this.#c=jo.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(No||Wr(this.options.enabled,this.#t)===!1||!py(this.#l)||this.#l===0)&&(this.#u=jo.setInterval(()=>{(this.options.refetchIntervalInBackground||c_.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(jo.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(jo.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,i=this.#s,o=this.#r,l=this.#a,h=t!==n?t.state:this.#n,{state:f}=t;let p={...f},g=!1,b;if(e._optimisticResults){const O=this.hasListeners(),P=!O&&Dw(t,e),$=O&&kw(t,n,e,r);(P||$)&&(p={...p,...BE(f.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:_,errorUpdatedAt:w,status:x}=p;b=p.data;let S=!1;if(e.placeholderData!==void 0&&b===void 0&&x==="pending"){let O;i?.isPlaceholderData&&e.placeholderData===l?.placeholderData?(O=i.data,S=!0):O=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,O!==void 0&&(x="success",b=yy(i?.data,O,e),g=!0)}if(e.select&&b!==void 0&&!S)if(i&&b===o?.data&&e.select===this.#p)b=this.#h;else try{this.#p=e.select,b=e.select(b),b=yy(i?.data,b,e),this.#h=b,this.#i=null}catch(O){this.#i=O}this.#i&&(_=this.#i,b=this.#h,w=Date.now(),x="error");const C=p.fetchStatus==="fetching",T=x==="pending",I=x==="error",M=T&&C,F=b!==void 0,D={status:x,fetchStatus:p.fetchStatus,isPending:T,isSuccess:x==="success",isError:I,isInitialLoading:M,isLoading:M,data:b,dataUpdatedAt:p.dataUpdatedAt,error:_,errorUpdatedAt:w,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:C,isRefetching:C&&!T,isLoadingError:I&&!F,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:I&&F,isStale:u_(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Wr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const O=V=>{D.status==="error"?V.reject(D.error):D.data!==void 0&&V.resolve(D.data)},P=()=>{const V=this.#o=D.promise=_y();O(V)},$=this.#o;switch($.status){case"pending":t.queryHash===n.queryHash&&O($);break;case"fulfilled":(D.status==="error"||D.data!==$.value)&&P();break;case"rejected":(D.status!=="error"||D.error!==$.reason)&&P();break}}return D}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),Cf(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#m.size)return!0;const o=new Set(i??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(l=>{const u=l;return this.#s[u]!==t[u]&&o.has(u)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){Tn.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function lM(t,e){return Wr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Dw(t,e){return lM(t,e)||t.state.data!==void 0&&vy(t,e,e.refetchOnMount)}function vy(t,e,n){if(Wr(e.enabled,t)!==!1&&Ra(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&u_(t,e)}return!1}function kw(t,e,n,r){return(t!==e||Wr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&u_(t,n)}function u_(t,e){return Wr(e.enabled,t)!==!1&&t.isStaleByTime(Ra(e.staleTime,t))}function cM(t,e){return!Cf(t.getCurrentResult(),e)}function Mw(t){return{onFetch:(e,n)=>{const r=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],l=e.state.data?.pageParams||[];let u={pages:[],pageParams:[]},h=0;const f=async()=>{let p=!1;const g=w=>{Object.defineProperty(w,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},b=kE(e.options,e.fetchOptions),_=async(w,x,S)=>{if(p)return Promise.reject();if(x==null&&w.pages.length)return Promise.resolve(w);const T=(()=>{const G={client:e.client,queryKey:e.queryKey,pageParam:x,direction:S?"backward":"forward",meta:e.options.meta};return g(G),G})(),I=await b(T),{maxPages:M}=e.options,F=S?eM:J5;return{pages:F(w.pages,I,M),pageParams:F(w.pageParams,x,M)}};if(i&&o.length){const w=i==="backward",x=w?uM:Ow,S={pages:o,pageParams:l},C=x(r,S);u=await _(S,C,w)}else{const w=t??o.length;do{const x=h===0?l[0]??r.initialPageParam:Ow(r,u);if(h>0&&x==null)break;u=await _(u,x),h++}while(h<w)}return u};e.options.persister?e.fetchFn=()=>e.options.persister?.(f,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=f}}}function Ow(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function uM(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var dM=class extends PE{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||zE(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=NE({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(l,u)=>{this.#r({type:"failed",failureCount:l,error:u})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",o=!this.#s.canStart();try{if(i)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const u=await this.options.onMutate?.(e,r);u!==this.state.context&&this.#r({type:"pending",context:u,variables:e,isPaused:o})}const l=await this.#s.start();return await this.#n.config.onSuccess?.(l,e,this.state.context,this,r),await this.options.onSuccess?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(l,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(l,null,e,this.state.context,r),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#n.config.onError?.(l,e,this.state.context,this,r),await this.options.onError?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,l,e,this.state.context,r),l}finally{this.#r({type:"error",error:l})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),Tn.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function zE(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var hM=class extends pc{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new dM({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Kh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Kh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Kh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Kh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Tn.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Tw(e,n))}findAll(t={}){return this.getAll().filter(e=>Tw(t,e))}notify(t){Tn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return Tn.batch(()=>Promise.all(t.map(e=>e.continue().catch(ar))))}};function Kh(t){return t.options.scope?.id}var fM=class extends pc{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),Cf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&Po(n.mutationKey)!==Po(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??zE();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){Tn.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,i),this.#s.onSettled?.(e.data,null,n,r,i)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,i),this.#s.onSettled?.(void 0,e.error,n,r,i))}this.listeners.forEach(n=>{n(this.#t)})})}},mM=class extends pc{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,i=e.queryHash??o_(r,e);let o=this.get(i);return o||(o=new aM({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Tn.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Cw(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>Cw(t,n)):e}notify(t){Tn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){Tn.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Tn.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},pM=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new mM,this.#t=t.mutationCache||new hM,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=c_.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=Tf.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(Ra(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,l=Y5(e,o);if(l!==void 0)return this.#e.build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return Tn.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;Tn.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return Tn.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=Tn.batch(()=>this.#e.findAll(t).map(i=>i.cancel(n)));return Promise.all(r).then(ar).catch(ar)}invalidateQueries(t,e={}){return Tn.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=Tn.batch(()=>this.#e.findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let o=i.fetch(void 0,n);return n.throwOnError||(o=o.catch(ar)),i.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(ar)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(Ra(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(ar).catch(ar)}fetchInfiniteQuery(t){return t.behavior=Mw(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(ar).catch(ar)}ensureInfiniteQueryData(t){return t.behavior=Mw(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return Tf.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(Po(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{qu(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(Po(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{qu(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=o_(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===l_&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},LE=R.createContext(void 0),Rt=t=>{const e=R.useContext(LE);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},gM=({client:t,children:e})=>(R.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),d.jsx(LE.Provider,{value:t,children:e})),UE=R.createContext(!1),yM=()=>R.useContext(UE);UE.Provider;function _M(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var bM=R.createContext(_M()),vM=()=>R.useContext(bM),xM=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},wM=t=>{R.useEffect(()=>{t.clearReset()},[t])},SM=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||ME(n,[t.error,r])),EM=t=>{if(t.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...i)=>n(r(...i)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},CM=(t,e)=>t.isLoading&&t.isFetching&&!e,TM=(t,e)=>t?.suspense&&e.isPending,Nw=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function AM(t,e,n){const r=yM(),i=vM(),o=Rt(),l=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=r?"isRestoring":"optimistic",EM(l),xM(l,i),wM(i);const u=!o.getQueryCache().get(l.queryHash),[h]=R.useState(()=>new e(o,l)),f=h.getOptimisticResult(l),p=!r&&t.subscribed!==!1;if(R.useSyncExternalStore(R.useCallback(g=>{const b=p?h.subscribe(Tn.batchCalls(g)):ar;return h.updateResult(),b},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),R.useEffect(()=>{h.setOptions(l)},[l,h]),TM(l,f))throw Nw(l,h,i);if(SM({result:f,errorResetBoundary:i,throwOnError:l.throwOnError,query:o.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw f.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(l,f),l.experimental_prefetchInRender&&!No&&CM(f,r)&&(u?Nw(l,h,i):o.getQueryCache().get(l.queryHash)?.promise)?.catch(ar).finally(()=>{h.updateResult()}),l.notifyOnChangeProps?f:h.trackResult(f)}function Vo(t,e){return AM(t,oM)}function En(t,e){const n=Rt(),[r]=R.useState(()=>new fM(n,t));R.useEffect(()=>{r.setOptions(t)},[r,t]);const i=R.useSyncExternalStore(R.useCallback(l=>r.subscribe(Tn.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=R.useCallback((l,u)=>{r.mutate(l,u).catch(ar)},[r]);if(i.error&&ME(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}const Yr=300*1e3,jM=1800*1e3,Be=new pM({defaultOptions:{queries:{staleTime:Yr,gcTime:jM,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Be.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const we={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};function RM({children:t}){return d.jsx(gM,{client:Be,children:t})}var Pw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Ia,FE;(function(){var t;function e(D,O){function P(){}P.prototype=O.prototype,D.F=O.prototype,D.prototype=new P,D.prototype.constructor=D,D.D=function($,V,j){for(var B=Array(arguments.length-2),k=2;k<arguments.length;k++)B[k-2]=arguments[k];return O.prototype[V].apply($,B)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(D,O,P){P||(P=0);const $=Array(16);if(typeof O=="string")for(var V=0;V<16;++V)$[V]=O.charCodeAt(P++)|O.charCodeAt(P++)<<8|O.charCodeAt(P++)<<16|O.charCodeAt(P++)<<24;else for(V=0;V<16;++V)$[V]=O[P++]|O[P++]<<8|O[P++]<<16|O[P++]<<24;O=D.g[0],P=D.g[1],V=D.g[2];let j=D.g[3],B;B=O+(j^P&(V^j))+$[0]+3614090360&4294967295,O=P+(B<<7&4294967295|B>>>25),B=j+(V^O&(P^V))+$[1]+3905402710&4294967295,j=O+(B<<12&4294967295|B>>>20),B=V+(P^j&(O^P))+$[2]+606105819&4294967295,V=j+(B<<17&4294967295|B>>>15),B=P+(O^V&(j^O))+$[3]+3250441966&4294967295,P=V+(B<<22&4294967295|B>>>10),B=O+(j^P&(V^j))+$[4]+4118548399&4294967295,O=P+(B<<7&4294967295|B>>>25),B=j+(V^O&(P^V))+$[5]+1200080426&4294967295,j=O+(B<<12&4294967295|B>>>20),B=V+(P^j&(O^P))+$[6]+2821735955&4294967295,V=j+(B<<17&4294967295|B>>>15),B=P+(O^V&(j^O))+$[7]+4249261313&4294967295,P=V+(B<<22&4294967295|B>>>10),B=O+(j^P&(V^j))+$[8]+1770035416&4294967295,O=P+(B<<7&4294967295|B>>>25),B=j+(V^O&(P^V))+$[9]+2336552879&4294967295,j=O+(B<<12&4294967295|B>>>20),B=V+(P^j&(O^P))+$[10]+4294925233&4294967295,V=j+(B<<17&4294967295|B>>>15),B=P+(O^V&(j^O))+$[11]+2304563134&4294967295,P=V+(B<<22&4294967295|B>>>10),B=O+(j^P&(V^j))+$[12]+1804603682&4294967295,O=P+(B<<7&4294967295|B>>>25),B=j+(V^O&(P^V))+$[13]+4254626195&4294967295,j=O+(B<<12&4294967295|B>>>20),B=V+(P^j&(O^P))+$[14]+2792965006&4294967295,V=j+(B<<17&4294967295|B>>>15),B=P+(O^V&(j^O))+$[15]+1236535329&4294967295,P=V+(B<<22&4294967295|B>>>10),B=O+(V^j&(P^V))+$[1]+4129170786&4294967295,O=P+(B<<5&4294967295|B>>>27),B=j+(P^V&(O^P))+$[6]+3225465664&4294967295,j=O+(B<<9&4294967295|B>>>23),B=V+(O^P&(j^O))+$[11]+643717713&4294967295,V=j+(B<<14&4294967295|B>>>18),B=P+(j^O&(V^j))+$[0]+3921069994&4294967295,P=V+(B<<20&4294967295|B>>>12),B=O+(V^j&(P^V))+$[5]+3593408605&4294967295,O=P+(B<<5&4294967295|B>>>27),B=j+(P^V&(O^P))+$[10]+38016083&4294967295,j=O+(B<<9&4294967295|B>>>23),B=V+(O^P&(j^O))+$[15]+3634488961&4294967295,V=j+(B<<14&4294967295|B>>>18),B=P+(j^O&(V^j))+$[4]+3889429448&4294967295,P=V+(B<<20&4294967295|B>>>12),B=O+(V^j&(P^V))+$[9]+568446438&4294967295,O=P+(B<<5&4294967295|B>>>27),B=j+(P^V&(O^P))+$[14]+3275163606&4294967295,j=O+(B<<9&4294967295|B>>>23),B=V+(O^P&(j^O))+$[3]+4107603335&4294967295,V=j+(B<<14&4294967295|B>>>18),B=P+(j^O&(V^j))+$[8]+1163531501&4294967295,P=V+(B<<20&4294967295|B>>>12),B=O+(V^j&(P^V))+$[13]+2850285829&4294967295,O=P+(B<<5&4294967295|B>>>27),B=j+(P^V&(O^P))+$[2]+4243563512&4294967295,j=O+(B<<9&4294967295|B>>>23),B=V+(O^P&(j^O))+$[7]+1735328473&4294967295,V=j+(B<<14&4294967295|B>>>18),B=P+(j^O&(V^j))+$[12]+2368359562&4294967295,P=V+(B<<20&4294967295|B>>>12),B=O+(P^V^j)+$[5]+4294588738&4294967295,O=P+(B<<4&4294967295|B>>>28),B=j+(O^P^V)+$[8]+2272392833&4294967295,j=O+(B<<11&4294967295|B>>>21),B=V+(j^O^P)+$[11]+1839030562&4294967295,V=j+(B<<16&4294967295|B>>>16),B=P+(V^j^O)+$[14]+4259657740&4294967295,P=V+(B<<23&4294967295|B>>>9),B=O+(P^V^j)+$[1]+2763975236&4294967295,O=P+(B<<4&4294967295|B>>>28),B=j+(O^P^V)+$[4]+1272893353&4294967295,j=O+(B<<11&4294967295|B>>>21),B=V+(j^O^P)+$[7]+4139469664&4294967295,V=j+(B<<16&4294967295|B>>>16),B=P+(V^j^O)+$[10]+3200236656&4294967295,P=V+(B<<23&4294967295|B>>>9),B=O+(P^V^j)+$[13]+681279174&4294967295,O=P+(B<<4&4294967295|B>>>28),B=j+(O^P^V)+$[0]+3936430074&4294967295,j=O+(B<<11&4294967295|B>>>21),B=V+(j^O^P)+$[3]+3572445317&4294967295,V=j+(B<<16&4294967295|B>>>16),B=P+(V^j^O)+$[6]+76029189&4294967295,P=V+(B<<23&4294967295|B>>>9),B=O+(P^V^j)+$[9]+3654602809&4294967295,O=P+(B<<4&4294967295|B>>>28),B=j+(O^P^V)+$[12]+3873151461&4294967295,j=O+(B<<11&4294967295|B>>>21),B=V+(j^O^P)+$[15]+530742520&4294967295,V=j+(B<<16&4294967295|B>>>16),B=P+(V^j^O)+$[2]+3299628645&4294967295,P=V+(B<<23&4294967295|B>>>9),B=O+(V^(P|~j))+$[0]+4096336452&4294967295,O=P+(B<<6&4294967295|B>>>26),B=j+(P^(O|~V))+$[7]+1126891415&4294967295,j=O+(B<<10&4294967295|B>>>22),B=V+(O^(j|~P))+$[14]+2878612391&4294967295,V=j+(B<<15&4294967295|B>>>17),B=P+(j^(V|~O))+$[5]+4237533241&4294967295,P=V+(B<<21&4294967295|B>>>11),B=O+(V^(P|~j))+$[12]+1700485571&4294967295,O=P+(B<<6&4294967295|B>>>26),B=j+(P^(O|~V))+$[3]+2399980690&4294967295,j=O+(B<<10&4294967295|B>>>22),B=V+(O^(j|~P))+$[10]+4293915773&4294967295,V=j+(B<<15&4294967295|B>>>17),B=P+(j^(V|~O))+$[1]+2240044497&4294967295,P=V+(B<<21&4294967295|B>>>11),B=O+(V^(P|~j))+$[8]+1873313359&4294967295,O=P+(B<<6&4294967295|B>>>26),B=j+(P^(O|~V))+$[15]+4264355552&4294967295,j=O+(B<<10&4294967295|B>>>22),B=V+(O^(j|~P))+$[6]+2734768916&4294967295,V=j+(B<<15&4294967295|B>>>17),B=P+(j^(V|~O))+$[13]+1309151649&4294967295,P=V+(B<<21&4294967295|B>>>11),B=O+(V^(P|~j))+$[4]+4149444226&4294967295,O=P+(B<<6&4294967295|B>>>26),B=j+(P^(O|~V))+$[11]+3174756917&4294967295,j=O+(B<<10&4294967295|B>>>22),B=V+(O^(j|~P))+$[2]+718787259&4294967295,V=j+(B<<15&4294967295|B>>>17),B=P+(j^(V|~O))+$[9]+3951481745&4294967295,D.g[0]=D.g[0]+O&4294967295,D.g[1]=D.g[1]+(V+(B<<21&4294967295|B>>>11))&4294967295,D.g[2]=D.g[2]+V&4294967295,D.g[3]=D.g[3]+j&4294967295}r.prototype.v=function(D,O){O===void 0&&(O=D.length);const P=O-this.blockSize,$=this.C;let V=this.h,j=0;for(;j<O;){if(V==0)for(;j<=P;)i(this,D,j),j+=this.blockSize;if(typeof D=="string"){for(;j<O;)if($[V++]=D.charCodeAt(j++),V==this.blockSize){i(this,$),V=0;break}}else for(;j<O;)if($[V++]=D[j++],V==this.blockSize){i(this,$),V=0;break}}this.h=V,this.o+=O},r.prototype.A=function(){var D=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);D[0]=128;for(var O=1;O<D.length-8;++O)D[O]=0;O=this.o*8;for(var P=D.length-8;P<D.length;++P)D[P]=O&255,O/=256;for(this.v(D),D=Array(16),O=0,P=0;P<4;++P)for(let $=0;$<32;$+=8)D[O++]=this.g[P]>>>$&255;return D};function o(D,O){var P=u;return Object.prototype.hasOwnProperty.call(P,D)?P[D]:P[D]=O(D)}function l(D,O){this.h=O;const P=[];let $=!0;for(let V=D.length-1;V>=0;V--){const j=D[V]|0;$&&j==O||(P[V]=j,$=!1)}this.g=P}var u={};function h(D){return-128<=D&&D<128?o(D,function(O){return new l([O|0],O<0?-1:0)}):new l([D|0],D<0?-1:0)}function f(D){if(isNaN(D)||!isFinite(D))return g;if(D<0)return S(f(-D));const O=[];let P=1;for(let $=0;D>=P;$++)O[$]=D/P|0,P*=4294967296;return new l(O,0)}function p(D,O){if(D.length==0)throw Error("number format error: empty string");if(O=O||10,O<2||36<O)throw Error("radix out of range: "+O);if(D.charAt(0)=="-")return S(p(D.substring(1),O));if(D.indexOf("-")>=0)throw Error('number format error: interior "-" character');const P=f(Math.pow(O,8));let $=g;for(let j=0;j<D.length;j+=8){var V=Math.min(8,D.length-j);const B=parseInt(D.substring(j,j+V),O);V<8?(V=f(Math.pow(O,V)),$=$.j(V).add(f(B))):($=$.j(P),$=$.add(f(B)))}return $}var g=h(0),b=h(1),_=h(16777216);t=l.prototype,t.m=function(){if(x(this))return-S(this).m();let D=0,O=1;for(let P=0;P<this.g.length;P++){const $=this.i(P);D+=($>=0?$:4294967296+$)*O,O*=4294967296}return D},t.toString=function(D){if(D=D||10,D<2||36<D)throw Error("radix out of range: "+D);if(w(this))return"0";if(x(this))return"-"+S(this).toString(D);const O=f(Math.pow(D,6));var P=this;let $="";for(;;){const V=M(P,O).g;P=C(P,V.j(O));let j=((P.g.length>0?P.g[0]:P.h)>>>0).toString(D);if(P=V,w(P))return j+$;for(;j.length<6;)j="0"+j;$=j+$}},t.i=function(D){return D<0?0:D<this.g.length?this.g[D]:this.h};function w(D){if(D.h!=0)return!1;for(let O=0;O<D.g.length;O++)if(D.g[O]!=0)return!1;return!0}function x(D){return D.h==-1}t.l=function(D){return D=C(this,D),x(D)?-1:w(D)?0:1};function S(D){const O=D.g.length,P=[];for(let $=0;$<O;$++)P[$]=~D.g[$];return new l(P,~D.h).add(b)}t.abs=function(){return x(this)?S(this):this},t.add=function(D){const O=Math.max(this.g.length,D.g.length),P=[];let $=0;for(let V=0;V<=O;V++){let j=$+(this.i(V)&65535)+(D.i(V)&65535),B=(j>>>16)+(this.i(V)>>>16)+(D.i(V)>>>16);$=B>>>16,j&=65535,B&=65535,P[V]=B<<16|j}return new l(P,P[P.length-1]&-2147483648?-1:0)};function C(D,O){return D.add(S(O))}t.j=function(D){if(w(this)||w(D))return g;if(x(this))return x(D)?S(this).j(S(D)):S(S(this).j(D));if(x(D))return S(this.j(S(D)));if(this.l(_)<0&&D.l(_)<0)return f(this.m()*D.m());const O=this.g.length+D.g.length,P=[];for(var $=0;$<2*O;$++)P[$]=0;for($=0;$<this.g.length;$++)for(let V=0;V<D.g.length;V++){const j=this.i($)>>>16,B=this.i($)&65535,k=D.i(V)>>>16,Y=D.i(V)&65535;P[2*$+2*V]+=B*Y,T(P,2*$+2*V),P[2*$+2*V+1]+=j*Y,T(P,2*$+2*V+1),P[2*$+2*V+1]+=B*k,T(P,2*$+2*V+1),P[2*$+2*V+2]+=j*k,T(P,2*$+2*V+2)}for(D=0;D<O;D++)P[D]=P[2*D+1]<<16|P[2*D];for(D=O;D<2*O;D++)P[D]=0;return new l(P,0)};function T(D,O){for(;(D[O]&65535)!=D[O];)D[O+1]+=D[O]>>>16,D[O]&=65535,O++}function I(D,O){this.g=D,this.h=O}function M(D,O){if(w(O))throw Error("division by zero");if(w(D))return new I(g,g);if(x(D))return O=M(S(D),O),new I(S(O.g),S(O.h));if(x(O))return O=M(D,S(O)),new I(S(O.g),O.h);if(D.g.length>30){if(x(D)||x(O))throw Error("slowDivide_ only works with positive integers.");for(var P=b,$=O;$.l(D)<=0;)P=F(P),$=F($);var V=G(P,1),j=G($,1);for($=G($,2),P=G(P,2);!w($);){var B=j.add($);B.l(D)<=0&&(V=V.add(P),j=B),$=G($,1),P=G(P,1)}return O=C(D,V.j(O)),new I(V,O)}for(V=g;D.l(O)>=0;){for(P=Math.max(1,Math.floor(D.m()/O.m())),$=Math.ceil(Math.log(P)/Math.LN2),$=$<=48?1:Math.pow(2,$-48),j=f(P),B=j.j(O);x(B)||B.l(D)>0;)P-=$,j=f(P),B=j.j(O);w(j)&&(j=b),V=V.add(j),D=C(D,B)}return new I(V,D)}t.B=function(D){return M(this,D).h},t.and=function(D){const O=Math.max(this.g.length,D.g.length),P=[];for(let $=0;$<O;$++)P[$]=this.i($)&D.i($);return new l(P,this.h&D.h)},t.or=function(D){const O=Math.max(this.g.length,D.g.length),P=[];for(let $=0;$<O;$++)P[$]=this.i($)|D.i($);return new l(P,this.h|D.h)},t.xor=function(D){const O=Math.max(this.g.length,D.g.length),P=[];for(let $=0;$<O;$++)P[$]=this.i($)^D.i($);return new l(P,this.h^D.h)};function F(D){const O=D.g.length+1,P=[];for(let $=0;$<O;$++)P[$]=D.i($)<<1|D.i($-1)>>>31;return new l(P,D.h)}function G(D,O){const P=O>>5;O%=32;const $=D.g.length-P,V=[];for(let j=0;j<$;j++)V[j]=O>0?D.i(j+P)>>>O|D.i(j+P+1)<<32-O:D.i(j+P);return new l(V,D.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,FE=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=f,l.fromString=p,Ia=l}).apply(typeof Pw<"u"?Pw:typeof self<"u"?self:typeof window<"u"?window:{});var Yh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var VE,Iu,$E,uf,xy,qE,HE,GE;(function(){var t,e=Object.defineProperty;function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Yh=="object"&&Yh];for(var A=0;A<y.length;++A){var U=y[A];if(U&&U.Math==Math)return U}throw Error("Cannot find global object")}var r=n(this);function i(y,A){if(A)e:{var U=r;y=y.split(".");for(var K=0;K<y.length-1;K++){var he=y[K];if(!(he in U))break e;U=U[he]}y=y[y.length-1],K=U[y],A=A(K),A!=K&&A!=null&&e(U,y,{configurable:!0,writable:!0,value:A})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(A){var U=[],K;for(K in A)Object.prototype.hasOwnProperty.call(A,K)&&U.push([K,A[K]]);return U}});var o=o||{},l=this||self;function u(y){var A=typeof y;return A=="object"&&y!=null||A=="function"}function h(y,A,U){return y.call.apply(y.bind,arguments)}function f(y,A,U){return f=h,f.apply(null,arguments)}function p(y,A){var U=Array.prototype.slice.call(arguments,1);return function(){var K=U.slice();return K.push.apply(K,arguments),y.apply(this,K)}}function g(y,A){function U(){}U.prototype=A.prototype,y.Z=A.prototype,y.prototype=new U,y.prototype.constructor=y,y.Ob=function(K,he,be){for(var ze=Array(arguments.length-2),it=2;it<arguments.length;it++)ze[it-2]=arguments[it];return A.prototype[he].apply(K,ze)}}var b=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function _(y){const A=y.length;if(A>0){const U=Array(A);for(let K=0;K<A;K++)U[K]=y[K];return U}return[]}function w(y,A){for(let K=1;K<arguments.length;K++){const he=arguments[K];var U=typeof he;if(U=U!="object"?U:he?Array.isArray(he)?"array":U:"null",U=="array"||U=="object"&&typeof he.length=="number"){U=y.length||0;const be=he.length||0;y.length=U+be;for(let ze=0;ze<be;ze++)y[U+ze]=he[ze]}else y.push(he)}}class x{constructor(A,U){this.i=A,this.j=U,this.h=0,this.g=null}get(){let A;return this.h>0?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function S(y){l.setTimeout(()=>{throw y},0)}function C(){var y=D;let A=null;return y.g&&(A=y.g,y.g=y.g.next,y.g||(y.h=null),A.next=null),A}class T{constructor(){this.h=this.g=null}add(A,U){const K=I.get();K.set(A,U),this.h?this.h.next=K:this.g=K,this.h=K}}var I=new x(()=>new M,y=>y.reset());class M{constructor(){this.next=this.g=this.h=null}set(A,U){this.h=A,this.g=U,this.next=null}reset(){this.next=this.g=this.h=null}}let F,G=!1,D=new T,O=()=>{const y=Promise.resolve(void 0);F=()=>{y.then(P)}};function P(){for(var y;y=C();){try{y.h.call(y.g)}catch(U){S(U)}var A=I;A.j(y),A.h<100&&(A.h++,y.next=A.g,A.g=y)}G=!1}function $(){this.u=this.u,this.C=this.C}$.prototype.u=!1,$.prototype.dispose=function(){this.u||(this.u=!0,this.N())},$.prototype[Symbol.dispose]=function(){this.dispose()},$.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function V(y,A){this.type=y,this.g=this.target=A,this.defaultPrevented=!1}V.prototype.h=function(){this.defaultPrevented=!0};var j=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var y=!1,A=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const U=()=>{};l.addEventListener("test",U,A),l.removeEventListener("test",U,A)}catch{}return y})();function B(y){return/^[\s\xa0]*$/.test(y)}function k(y,A){V.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,A)}g(k,V),k.prototype.init=function(y,A){const U=this.type=y.type,K=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=A,A=y.relatedTarget,A||(U=="mouseover"?A=y.fromElement:U=="mouseout"&&(A=y.toElement)),this.relatedTarget=A,K?(this.clientX=K.clientX!==void 0?K.clientX:K.pageX,this.clientY=K.clientY!==void 0?K.clientY:K.pageY,this.screenX=K.screenX||0,this.screenY=K.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&k.Z.h.call(this)},k.prototype.h=function(){k.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var Y="closure_listenable_"+(Math.random()*1e6|0),X=0;function W(y,A,U,K,he){this.listener=y,this.proxy=null,this.src=A,this.type=U,this.capture=!!K,this.ha=he,this.key=++X,this.da=this.fa=!1}function te(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function H(y,A,U){for(const K in y)A.call(U,y[K],K,y)}function re(y,A){for(const U in y)A.call(void 0,y[U],U,y)}function N(y){const A={};for(const U in y)A[U]=y[U];return A}const q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(y,A){let U,K;for(let he=1;he<arguments.length;he++){K=arguments[he];for(U in K)y[U]=K[U];for(let be=0;be<q.length;be++)U=q[be],Object.prototype.hasOwnProperty.call(K,U)&&(y[U]=K[U])}}function ne(y){this.src=y,this.g={},this.h=0}ne.prototype.add=function(y,A,U,K,he){const be=y.toString();y=this.g[be],y||(y=this.g[be]=[],this.h++);const ze=Ee(y,A,K,he);return ze>-1?(A=y[ze],U||(A.fa=!1)):(A=new W(A,this.src,be,!!K,he),A.fa=U,y.push(A)),A};function ae(y,A){const U=A.type;if(U in y.g){var K=y.g[U],he=Array.prototype.indexOf.call(K,A,void 0),be;(be=he>=0)&&Array.prototype.splice.call(K,he,1),be&&(te(A),y.g[U].length==0&&(delete y.g[U],y.h--))}}function Ee(y,A,U,K){for(let he=0;he<y.length;++he){const be=y[he];if(!be.da&&be.listener==A&&be.capture==!!U&&be.ha==K)return he}return-1}var Ae="closure_lm_"+(Math.random()*1e6|0),ce={};function fe(y,A,U,K,he){if(Array.isArray(A)){for(let be=0;be<A.length;be++)fe(y,A[be],U,K,he);return null}return U=Z(U),y&&y[Y]?y.J(A,U,u(K)?!!K.capture:!1,he):Oe(y,A,U,!1,K,he)}function Oe(y,A,U,K,he,be){if(!A)throw Error("Invalid event type");const ze=u(he)?!!he.capture:!!he;let it=ye(y);if(it||(y[Ae]=it=new ne(y)),U=it.add(A,U,K,ze,be),U.proxy)return U;if(K=Me(),U.proxy=K,K.src=y,K.listener=U,y.addEventListener)j||(he=ze),he===void 0&&(he=!1),y.addEventListener(A.toString(),K,he);else if(y.attachEvent)y.attachEvent(L(A.toString()),K);else if(y.addListener&&y.removeListener)y.addListener(K);else throw Error("addEventListener and attachEvent are unavailable.");return U}function Me(){function y(U){return A.call(y.src,y.listener,U)}const A=de;return y}function Ge(y,A,U,K,he){if(Array.isArray(A))for(var be=0;be<A.length;be++)Ge(y,A[be],U,K,he);else K=u(K)?!!K.capture:!!K,U=Z(U),y&&y[Y]?(y=y.i,be=String(A).toString(),be in y.g&&(A=y.g[be],U=Ee(A,U,K,he),U>-1&&(te(A[U]),Array.prototype.splice.call(A,U,1),A.length==0&&(delete y.g[be],y.h--)))):y&&(y=ye(y))&&(A=y.g[A.toString()],y=-1,A&&(y=Ee(A,U,K,he)),(U=y>-1?A[y]:null)&&tt(U))}function tt(y){if(typeof y!="number"&&y&&!y.da){var A=y.src;if(A&&A[Y])ae(A.i,y);else{var U=y.type,K=y.proxy;A.removeEventListener?A.removeEventListener(U,K,y.capture):A.detachEvent?A.detachEvent(L(U),K):A.addListener&&A.removeListener&&A.removeListener(K),(U=ye(A))?(ae(U,y),U.h==0&&(U.src=null,A[Ae]=null)):te(y)}}}function L(y){return y in ce?ce[y]:ce[y]="on"+y}function de(y,A){if(y.da)y=!0;else{A=new k(A,this);const U=y.listener,K=y.ha||y.src;y.fa&&tt(y),y=U.call(K,A)}return y}function ye(y){return y=y[Ae],y instanceof ne?y:null}var ee="__closure_events_fn_"+(Math.random()*1e9>>>0);function Z(y){return typeof y=="function"?y:(y[ee]||(y[ee]=function(A){return y.handleEvent(A)}),y[ee])}function oe(){$.call(this),this.i=new ne(this),this.M=this,this.G=null}g(oe,$),oe.prototype[Y]=!0,oe.prototype.removeEventListener=function(y,A,U,K){Ge(this,y,A,U,K)};function Se(y,A){var U,K=y.G;if(K)for(U=[];K;K=K.G)U.push(K);if(y=y.M,K=A.type||A,typeof A=="string")A=new V(A,y);else if(A instanceof V)A.target=A.target||y;else{var he=A;A=new V(K,y),J(A,he)}he=!0;let be,ze;if(U)for(ze=U.length-1;ze>=0;ze--)be=A.g=U[ze],he=xe(be,K,!0,A)&&he;if(be=A.g=y,he=xe(be,K,!0,A)&&he,he=xe(be,K,!1,A)&&he,U)for(ze=0;ze<U.length;ze++)be=A.g=U[ze],he=xe(be,K,!1,A)&&he}oe.prototype.N=function(){if(oe.Z.N.call(this),this.i){var y=this.i;for(const A in y.g){const U=y.g[A];for(let K=0;K<U.length;K++)te(U[K]);delete y.g[A],y.h--}}this.G=null},oe.prototype.J=function(y,A,U,K){return this.i.add(String(y),A,!1,U,K)},oe.prototype.K=function(y,A,U,K){return this.i.add(String(y),A,!0,U,K)};function xe(y,A,U,K){if(A=y.i.g[String(A)],!A)return!0;A=A.concat();let he=!0;for(let be=0;be<A.length;++be){const ze=A[be];if(ze&&!ze.da&&ze.capture==U){const it=ze.listener,an=ze.ha||ze.src;ze.fa&&ae(y.i,ze),he=it.call(an,K)!==!1&&he}}return he&&!K.defaultPrevented}function ie(y,A){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=f(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(A)>2147483647?-1:l.setTimeout(y,A||0)}function Re(y){y.g=ie(()=>{y.g=null,y.i&&(y.i=!1,Re(y))},y.l);const A=y.h;y.h=null,y.m.apply(null,A)}class Pe extends ${constructor(A,U){super(),this.m=A,this.l=U,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:Re(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ne(y){$.call(this),this.h=y,this.g={}}g(Ne,$);var qe=[];function xt(y){H(y.g,function(A,U){this.g.hasOwnProperty(U)&&tt(A)},y),y.g={}}Ne.prototype.N=function(){Ne.Z.N.call(this),xt(this)},Ne.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var st=l.JSON.stringify,Wn=l.JSON.parse,gs=class{stringify(y){return l.JSON.stringify(y,void 0)}parse(y){return l.JSON.parse(y,void 0)}};function nr(){}function ys(){}var vt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function nn(){V.call(this,"d")}g(nn,V);function Qn(){V.call(this,"c")}g(Qn,V);var Et={},Ka=null;function Bi(){return Ka=Ka||new oe}Et.Ia="serverreachability";function Xo(y){V.call(this,Et.Ia,y)}g(Xo,V);function Or(y){const A=Bi();Se(A,new Xo(A))}Et.STAT_EVENT="statevent";function _s(y,A){V.call(this,Et.STAT_EVENT,y),this.stat=A}g(_s,V);function Ft(y){const A=Bi();Se(A,new _s(A,y))}Et.Ja="timingevent";function rr(y,A){V.call(this,Et.Ja,y),this.size=A}g(rr,V);function bs(y,A){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){y()},A)}function Zr(){this.g=!0}Zr.prototype.ua=function(){this.g=!1};function km(y,A,U,K,he,be){y.info(function(){if(y.g)if(be){var ze="",it=be.split("&");for(let Ct=0;Ct<it.length;Ct++){var an=it[Ct].split("=");if(an.length>1){const Qt=an[0];an=an[1];const zr=Qt.split("_");ze=zr.length>=2&&zr[1]=="type"?ze+(Qt+"="+an+"&"):ze+(Qt+"=redacted&")}}}else ze=null;else ze=be;return"XMLHTTP REQ ("+K+") [attempt "+he+"]: "+A+`
`+U+`
`+ze})}function Sd(y,A,U,K,he,be,ze){y.info(function(){return"XMLHTTP RESP ("+K+") [ attempt "+he+"]: "+A+`
`+U+`
`+be+" "+ze})}function vs(y,A,U,K){y.info(function(){return"XMLHTTP TEXT ("+A+"): "+Mm(y,U)+(K?" "+K:"")})}function Ya(y,A){y.info(function(){return"TIMEOUT: "+A})}Zr.prototype.info=function(){};function Mm(y,A){if(!y.g)return A;if(!A)return null;try{const be=JSON.parse(A);if(be){for(y=0;y<be.length;y++)if(Array.isArray(be[y])){var U=be[y];if(!(U.length<2)){var K=U[1];if(Array.isArray(K)&&!(K.length<1)){var he=K[0];if(he!="noop"&&he!="stop"&&he!="close")for(let ze=1;ze<K.length;ze++)K[ze]=""}}}}return st(be)}catch{return A}}var Xa={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Tc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ac;function Za(){}g(Za,nr),Za.prototype.g=function(){return new XMLHttpRequest},Ac=new Za;function Zs(y){return encodeURIComponent(String(y))}function Ed(y){var A=1;y=y.split(":");const U=[];for(;A>0&&y.length;)U.push(y.shift()),A--;return y.length&&U.push(y.join(":")),U}function Jr(y,A,U,K){this.j=y,this.i=A,this.l=U,this.S=K||1,this.V=new Ne(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new es}function es(){this.i=null,this.g="",this.h=!1}var hn={},Dn={};function xs(y,A,U){y.M=1,y.A=Ja(mn(A)),y.u=U,y.R=!0,Zo(y,null)}function Zo(y,A){y.F=Date.now(),ws(y),y.B=mn(y.A);var U=y.B,K=y.S;Array.isArray(K)||(K=[String(K)]),nl(U.i,"t",K),y.C=0,U=y.j.L,y.h=new es,y.g=Ld(y.j,U?A:null,!y.u),y.P>0&&(y.O=new Pe(f(y.Y,y,y.g),y.P)),A=y.V,U=y.g,K=y.ba;var he="readystatechange";Array.isArray(he)||(he&&(qe[0]=he.toString()),he=qe);for(let be=0;be<he.length;be++){const ze=fe(U,he[be],K||A.handleEvent,!1,A.h||A);if(!ze)break;A.g[ze.key]=ze}A=y.J?N(y.J):{},y.u?(y.v||(y.v="POST"),A["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,A)):(y.v="GET",y.g.ea(y.B,y.v,null,A)),Or(),km(y.i,y.v,y.B,y.l,y.S,y.u)}Jr.prototype.ba=function(y){y=y.target;const A=this.O;A&&rs(y)==3?A.j():this.Y(y)},Jr.prototype.Y=function(y){try{if(y==this.g)e:{const it=rs(this.g),an=this.g.ya(),Ct=this.g.ca();if(!(it<3)&&(it!=3||this.g&&(this.h.h||this.g.la()||Pn(this.g)))){this.K||it!=4||an==7||(an==8||Ct<=0?Or(3):Or(2)),Ss(this);var A=this.g.ca();this.X=A;var U=Om(this);if(this.o=A==200,Sd(this.i,this.v,this.B,this.l,this.S,it,A),this.o){if(this.U&&!this.L){t:{if(this.g){var K,he=this.g;if((K=he.g?he.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(K)){var be=K;break t}}be=null}if(y=be)vs(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Es(this,y);else{this.o=!1,this.m=3,Ft(12),xr(this),Nr(this);break e}}if(this.R){y=!0;let Qt;for(;!this.K&&this.C<U.length;)if(Qt=Td(this,U),Qt==Dn){it==4&&(this.m=4,Ft(14),y=!1),vs(this.i,this.l,null,"[Incomplete Response]");break}else if(Qt==hn){this.m=4,Ft(15),vs(this.i,this.l,U,"[Invalid Chunk]"),y=!1;break}else vs(this.i,this.l,Qt,null),Es(this,Qt);if(Cd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),it!=4||U.length!=0||this.h.h||(this.m=1,Ft(16),y=!1),this.o=this.o&&y,!y)vs(this.i,this.l,U,"[Invalid Chunked Response]"),xr(this),Nr(this);else if(U.length>0&&!this.W){this.W=!0;var ze=this.j;ze.g==this&&ze.aa&&!ze.P&&(ze.j.info("Great, no buffering proxy detected. Bytes received: "+U.length),Vc(ze),ze.P=!0,Ft(11))}}else vs(this.i,this.l,U,null),Es(this,U);it==4&&xr(this),this.o&&!this.K&&(it==4?Nd(this.j,this):(this.o=!1,ws(this)))}else ei(this.g),A==400&&U.indexOf("Unknown SID")>0?(this.m=3,Ft(12)):(this.m=0,Ft(13)),xr(this),Nr(this)}}}catch{}};function Om(y){if(!Cd(y))return y.g.la();const A=Pn(y.g);if(A==="")return"";let U="";const K=A.length,he=rs(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return xr(y),Nr(y),"";y.h.i=new l.TextDecoder}for(let be=0;be<K;be++)y.h.h=!0,U+=y.h.i.decode(A[be],{stream:!(he&&be==K-1)});return A.length=0,y.h.g+=U,y.C=0,y.h.g}function Cd(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function Td(y,A){var U=y.C,K=A.indexOf(`
`,U);return K==-1?Dn:(U=Number(A.substring(U,K)),isNaN(U)?hn:(K+=1,K+U>A.length?Dn:(A=A.slice(K,K+U),y.C=K+U,A)))}Jr.prototype.cancel=function(){this.K=!0,xr(this)};function ws(y){y.T=Date.now()+y.H,Jo(y,y.H)}function Jo(y,A){if(y.D!=null)throw Error("WatchDog timer not null");y.D=bs(f(y.aa,y),A)}function Ss(y){y.D&&(l.clearTimeout(y.D),y.D=null)}Jr.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(Ya(this.i,this.B),this.M!=2&&(Or(),Ft(17)),xr(this),this.m=2,Nr(this)):Jo(this,this.T-y)};function Nr(y){y.j.I==0||y.K||Nd(y.j,y)}function xr(y){Ss(y);var A=y.O;A&&typeof A.dispose=="function"&&A.dispose(),y.O=null,xt(y.V),y.g&&(A=y.g,y.g=null,A.abort(),A.dispose())}function Es(y,A){try{var U=y.j;if(U.I!=0&&(U.g==y||Ts(U.h,y))){if(!y.L&&Ts(U.h,y)&&U.I==3){try{var K=U.Ba.g.parse(A)}catch{K=null}if(Array.isArray(K)&&K.length==3){var he=K;if(he[0]==0){e:if(!U.v){if(U.g)if(U.g.F+3e3<y.F)ol(U),Hi(U);else break e;ao(U),Ft(18)}}else U.xa=he[1],0<U.xa-U.K&&he[2]<37500&&U.F&&U.A==0&&!U.C&&(U.C=bs(f(U.Va,U),6e3));Cs(U.h)<=1&&U.ta&&(U.ta=void 0)}else ks(U,11)}else if((y.L||U.g==y)&&ol(U),!B(A))for(he=U.Ba.g.parse(A),A=0;A<he.length;A++){let Ct=he[A];const Qt=Ct[0];if(!(Qt<=U.K))if(U.K=Qt,Ct=Ct[1],U.I==2)if(Ct[0]=="c"){U.M=Ct[1],U.ba=Ct[2];const zr=Ct[3];zr!=null&&(U.ka=zr,U.j.info("VER="+U.ka));const Ms=Ct[4];Ms!=null&&(U.za=Ms,U.j.info("SVER="+U.za));const ss=Ct[5];ss!=null&&typeof ss=="number"&&ss>0&&(K=1.5*ss,U.O=K,U.j.info("backChannelRequestTimeoutMs_="+K)),K=U;const is=y.g;if(is){const oo=is.g?is.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(oo){var be=K.h;be.g||oo.indexOf("spdy")==-1&&oo.indexOf("quic")==-1&&oo.indexOf("h2")==-1||(be.j=be.l,be.g=new Set,be.h&&(Ic(be,be.h),be.h=null))}if(K.G){const ll=is.g?is.g.getResponseHeader("X-HTTP-Session-Id"):null;ll&&(K.wa=ll,It(K.J,K.G,ll))}}U.I=3,U.l&&U.l.ra(),U.aa&&(U.T=Date.now()-y.F,U.j.info("Handshake RTT: "+U.T+"ms")),K=U;var ze=y;if(K.na=zd(K,K.L?K.ba:null,K.W),ze.L){Dc(K.h,ze);var it=ze,an=K.O;an&&(it.H=an),it.D&&(Ss(it),ws(it)),K.g=ze}else Md(K);U.i.length>0&&Ds(U)}else Ct[0]!="stop"&&Ct[0]!="close"||ks(U,7);else U.I==3&&(Ct[0]=="stop"||Ct[0]=="close"?Ct[0]=="stop"?ks(U,7):Uc(U):Ct[0]!="noop"&&U.l&&U.l.qa(Ct),U.A=0)}}Or(4)}catch{}}var fn=class{constructor(y,A){this.g=y,this.map=A}};function jc(y){this.l=y||10,l.PerformanceNavigationTiming?(y=l.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Rc(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function Cs(y){return y.h?1:y.g?y.g.size:0}function Ts(y,A){return y.h?y.h==A:y.g?y.g.has(A):!1}function Ic(y,A){y.g?y.g.add(A):y.h=A}function Dc(y,A){y.h&&y.h==A?y.h=null:y.g&&y.g.has(A)&&y.g.delete(A)}jc.prototype.cancel=function(){if(this.i=kc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function kc(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let A=y.i;for(const U of y.g.values())A=A.concat(U.G);return A}return _(y.i)}var Ad=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function el(y,A){if(y){y=y.split("&");for(let U=0;U<y.length;U++){const K=y[U].indexOf("=");let he,be=null;K>=0?(he=y[U].substring(0,K),be=y[U].substring(K+1)):he=y[U],A(he,be?decodeURIComponent(be.replace(/\+/g," ")):"")}}}function wr(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let A;y instanceof wr?(this.l=y.l,kn(this,y.j),this.o=y.o,this.g=y.g,zi(this,y.u),this.h=y.h,Mc(this,Dd(y.i)),this.m=y.m):y&&(A=String(y).match(Ad))?(this.l=!1,kn(this,A[1]||"",!0),this.o=As(A[2]||""),this.g=As(A[3]||"",!0),zi(this,A[4]),this.h=As(A[5]||"",!0),Mc(this,A[6]||"",!0),this.m=As(A[7]||"")):(this.l=!1,this.i=new Ui(null,this.l))}wr.prototype.toString=function(){const y=[];var A=this.j;A&&y.push(eo(A,tl,!0),":");var U=this.g;return(U||A=="file")&&(y.push("//"),(A=this.o)&&y.push(eo(A,tl,!0),"@"),y.push(Zs(U).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),U=this.u,U!=null&&y.push(":",String(U))),(U=this.h)&&(this.g&&U.charAt(0)!="/"&&y.push("/"),y.push(eo(U,U.charAt(0)=="/"?Oc:jd,!0))),(U=this.i.toString())&&y.push("?",U),(U=this.m)&&y.push("#",eo(U,Rd)),y.join("")},wr.prototype.resolve=function(y){const A=mn(this);let U=!!y.j;U?kn(A,y.j):U=!!y.o,U?A.o=y.o:U=!!y.g,U?A.g=y.g:U=y.u!=null;var K=y.h;if(U)zi(A,y.u);else if(U=!!y.h){if(K.charAt(0)!="/")if(this.g&&!this.h)K="/"+K;else{var he=A.h.lastIndexOf("/");he!=-1&&(K=A.h.slice(0,he+1)+K)}if(he=K,he==".."||he==".")K="";else if(he.indexOf("./")!=-1||he.indexOf("/.")!=-1){K=he.lastIndexOf("/",0)==0,he=he.split("/");const be=[];for(let ze=0;ze<he.length;){const it=he[ze++];it=="."?K&&ze==he.length&&be.push(""):it==".."?((be.length>1||be.length==1&&be[0]!="")&&be.pop(),K&&ze==he.length&&be.push("")):(be.push(it),K=!0)}K=be.join("/")}else K=he}return U?A.h=K:U=y.i.toString()!=="",U?Mc(A,Dd(y.i)):U=!!y.m,U&&(A.m=y.m),A};function mn(y){return new wr(y)}function kn(y,A,U){y.j=U?As(A,!0):A,y.j&&(y.j=y.j.replace(/:$/,""))}function zi(y,A){if(A){if(A=Number(A),isNaN(A)||A<0)throw Error("Bad port number "+A);y.u=A}else y.u=null}function Mc(y,A,U){A instanceof Ui?(y.i=A,rl(y.i,y.l)):(U||(A=eo(A,Li)),y.i=new Ui(A,y.l))}function It(y,A,U){y.i.set(A,U)}function Ja(y){return It(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function As(y,A){return y?A?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function eo(y,A,U){return typeof y=="string"?(y=encodeURI(y).replace(A,cr),U&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function cr(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var tl=/[#\/\?@]/g,jd=/[#\?:]/g,Oc=/[#\?]/g,Li=/[#\?@]/g,Rd=/#/g;function Ui(y,A){this.h=this.g=null,this.i=y||null,this.j=!!A}function ur(y){y.g||(y.g=new Map,y.h=0,y.i&&el(y.i,function(A,U){y.add(decodeURIComponent(A.replace(/\+/g," ")),U)}))}t=Ui.prototype,t.add=function(y,A){ur(this),this.i=null,y=Fi(this,y);let U=this.g.get(y);return U||this.g.set(y,U=[]),U.push(A),this.h+=1,this};function Id(y,A){ur(y),A=Fi(y,A),y.g.has(A)&&(y.i=null,y.h-=y.g.get(A).length,y.g.delete(A))}function Nc(y,A){return ur(y),A=Fi(y,A),y.g.has(A)}t.forEach=function(y,A){ur(this),this.g.forEach(function(U,K){U.forEach(function(he){y.call(A,he,K,this)},this)},this)};function Pc(y,A){ur(y);let U=[];if(typeof A=="string")Nc(y,A)&&(U=U.concat(y.g.get(Fi(y,A))));else for(y=Array.from(y.g.values()),A=0;A<y.length;A++)U=U.concat(y[A]);return U}t.set=function(y,A){return ur(this),this.i=null,y=Fi(this,y),Nc(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[A]),this.h+=1,this},t.get=function(y,A){return y?(y=Pc(this,y),y.length>0?String(y[0]):A):A};function nl(y,A,U){Id(y,A),U.length>0&&(y.i=null,y.g.set(Fi(y,A),_(U)),y.h+=U.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],A=Array.from(this.g.keys());for(let K=0;K<A.length;K++){var U=A[K];const he=Zs(U);U=Pc(this,U);for(let be=0;be<U.length;be++){let ze=he;U[be]!==""&&(ze+="="+Zs(U[be])),y.push(ze)}}return this.i=y.join("&")};function Dd(y){const A=new Ui;return A.i=y.i,y.g&&(A.g=new Map(y.g),A.h=y.h),A}function Fi(y,A){return A=String(A),y.j&&(A=A.toLowerCase()),A}function rl(y,A){A&&!y.j&&(ur(y),y.i=null,y.g.forEach(function(U,K){const he=K.toLowerCase();K!=he&&(Id(this,K),nl(this,he,U))},y)),y.j=A}function ts(y,A){const U=new Zr;if(l.Image){const K=new Image;K.onload=p(Pr,U,"TestLoadImage: loaded",!0,A,K),K.onerror=p(Pr,U,"TestLoadImage: error",!1,A,K),K.onabort=p(Pr,U,"TestLoadImage: abort",!1,A,K),K.ontimeout=p(Pr,U,"TestLoadImage: timeout",!1,A,K),l.setTimeout(function(){K.ontimeout&&K.ontimeout()},1e4),K.src=y}else A(!1)}function Bc(y,A){const U=new Zr,K=new AbortController,he=setTimeout(()=>{K.abort(),Pr(U,"TestPingServer: timeout",!1,A)},1e4);fetch(y,{signal:K.signal}).then(be=>{clearTimeout(he),be.ok?Pr(U,"TestPingServer: ok",!0,A):Pr(U,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(he),Pr(U,"TestPingServer: error",!1,A)})}function Pr(y,A,U,K,he){try{he&&(he.onload=null,he.onerror=null,he.onabort=null,he.ontimeout=null),K(U)}catch{}}function Vi(){this.g=new gs}function js(y){this.i=y.Sb||null,this.h=y.ab||!1}g(js,nr),js.prototype.g=function(){return new to(this.i,this.h)};function to(y,A){oe.call(this),this.H=y,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(to,oe),t=to.prototype,t.open=function(y,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=A,this.readyState=1,ns(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const A={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(A.body=y),(this.H||l).fetch(new Request(this.D,A)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,$i(this)),this.readyState=0},t.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,ns(this)),this.g&&(this.readyState=3,ns(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;sl(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function sl(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}t.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var A=y.value?y.value:new Uint8Array(0);(A=this.B.decode(A,{stream:!y.done}))&&(this.response=this.responseText+=A)}y.done?$i(this):ns(this),this.readyState==3&&sl(this)}},t.Oa=function(y){this.g&&(this.response=this.responseText=y,$i(this))},t.Na=function(y){this.g&&(this.response=y,$i(this))},t.ga=function(){this.g&&$i(this)};function $i(y){y.readyState=4,y.l=null,y.j=null,y.B=null,ns(y)}t.setRequestHeader=function(y,A){this.A.append(y,A)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],A=this.h.entries();for(var U=A.next();!U.done;)U=U.value,y.push(U[0]+": "+U[1]),U=A.next();return y.join(`\r
`)};function ns(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(to.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Br(y){let A="";return H(y,function(U,K){A+=K,A+=":",A+=U,A+=`\r
`}),A}function no(y,A,U){e:{for(K in U){var K=!1;break e}K=!0}K||(U=Br(U),typeof y=="string"?U!=null&&Zs(U):It(y,A,U))}function Mt(y){oe.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Mt,oe);var Rs=/^https?$/i,zc=["POST","PUT"];t=Mt.prototype,t.Fa=function(y){this.H=y},t.ea=function(y,A,U,K){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);A=A?A.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ac.g(),this.g.onreadystatechange=b(f(this.Ca,this));try{this.B=!0,this.g.open(A,String(y),!0),this.B=!1}catch(be){ro(this,be);return}if(y=U||"",U=new Map(this.headers),K)if(Object.getPrototypeOf(K)===Object.prototype)for(var he in K)U.set(he,K[he]);else if(typeof K.keys=="function"&&typeof K.get=="function")for(const be of K.keys())U.set(be,K.get(be));else throw Error("Unknown input type for opt_headers: "+String(K));K=Array.from(U.keys()).find(be=>be.toLowerCase()=="content-type"),he=l.FormData&&y instanceof l.FormData,!(Array.prototype.indexOf.call(zc,A,void 0)>=0)||K||he||U.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[be,ze]of U)this.g.setRequestHeader(be,ze);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(be){ro(this,be)}};function ro(y,A){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=A,y.o=5,Lc(y),Js(y)}function Lc(y){y.A||(y.A=!0,Se(y,"complete"),Se(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,Se(this,"complete"),Se(this,"abort"),Js(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Js(this,!0)),Mt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?so(this):this.Xa())},t.Xa=function(){so(this)};function so(y){if(y.h&&typeof o<"u"){if(y.v&&rs(y)==4)setTimeout(y.Ca.bind(y),0);else if(Se(y,"readystatechange"),rs(y)==4){y.h=!1;try{const be=y.ca();e:switch(be){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break e;default:A=!1}var U;if(!(U=A)){var K;if(K=be===0){let ze=String(y.D).match(Ad)[1]||null;!ze&&l.self&&l.self.location&&(ze=l.self.location.protocol.slice(0,-1)),K=!Rs.test(ze?ze.toLowerCase():"")}U=K}if(U)Se(y,"complete"),Se(y,"success");else{y.o=6;try{var he=rs(y)>2?y.g.statusText:""}catch{he=""}y.l=he+" ["+y.ca()+"]",Lc(y)}}finally{Js(y)}}}}function Js(y,A){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const U=y.g;y.g=null,A||Se(y,"ready");try{U.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function rs(y){return y.g?y.g.readyState:0}t.ca=function(){try{return rs(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(y){if(this.g){var A=this.g.responseText;return y&&A.indexOf(y)==0&&(A=A.substring(y.length)),Wn(A)}};function Pn(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function ei(y){const A={};y=(y.g&&rs(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let K=0;K<y.length;K++){if(B(y[K]))continue;var U=Ed(y[K]);const he=U[0];if(U=U[1],typeof U!="string")continue;U=U.trim();const be=A[he]||[];A[he]=be,be.push(U)}re(A,function(K){return K.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Is(y,A,U){return U&&U.internalChannelParams&&U.internalChannelParams[y]||A}function qi(y){this.za=0,this.i=[],this.j=new Zr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Is("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Is("baseRetryDelayMs",5e3,y),this.Za=Is("retryDelaySeedMs",1e4,y),this.Ta=Is("forwardChannelMaxRetries",2,y),this.va=Is("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new jc(y&&y.concurrentRequestLimit),this.Ba=new Vi,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=qi.prototype,t.ka=8,t.I=1,t.connect=function(y,A,U,K){Ft(0),this.W=y,this.H=A||{},U&&K!==void 0&&(this.H.OSID=U,this.H.OAID=K),this.F=this.X,this.J=zd(this,null,this.W),Ds(this)};function Uc(y){if(il(y),y.I==3){var A=y.V++,U=mn(y.J);if(It(U,"SID",y.M),It(U,"RID",A),It(U,"TYPE","terminate"),io(y,U),A=new Jr(y,y.j,A),A.M=2,A.A=Ja(mn(U)),U=!1,l.navigator&&l.navigator.sendBeacon)try{U=l.navigator.sendBeacon(A.A.toString(),"")}catch{}!U&&l.Image&&(new Image().src=A.A,U=!0),U||(A.g=Ld(A.j,null),A.g.ea(A.A)),A.F=Date.now(),ws(A)}Bd(y)}function Hi(y){y.g&&(Vc(y),y.g.cancel(),y.g=null)}function il(y){Hi(y),y.v&&(l.clearTimeout(y.v),y.v=null),ol(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&l.clearTimeout(y.m),y.m=null)}function Ds(y){if(!Rc(y.h)&&!y.m){y.m=!0;var A=y.Ea;F||O(),G||(F(),G=!0),D.add(A,y),y.D=0}}function al(y,A){return Cs(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=A.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=bs(f(y.Ea,y,A),Pd(y,y.D)),y.D++,!0)}t.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const he=new Jr(this,this.j,y);let be=this.o;if(this.U&&(be?(be=N(be),J(be,this.U)):be=this.U),this.u!==null||this.R||(he.J=be,be=null),this.S)e:{for(var A=0,U=0;U<this.i.length;U++){t:{var K=this.i[U];if("__data__"in K.map&&(K=K.map.__data__,typeof K=="string")){K=K.length;break t}K=void 0}if(K===void 0)break;if(A+=K,A>4096){A=U;break e}if(A===4096||U===this.i.length-1){A=U+1;break e}}A=1e3}else A=1e3;A=kd(this,he,A),U=mn(this.J),It(U,"RID",y),It(U,"CVER",22),this.G&&It(U,"X-HTTP-Session-Id",this.G),io(this,U),be&&(this.R?A="headers="+Zs(Br(be))+"&"+A:this.u&&no(U,this.u,be)),Ic(this.h,he),this.Ra&&It(U,"TYPE","init"),this.S?(It(U,"$req",A),It(U,"SID","null"),he.U=!0,xs(he,U,null)):xs(he,U,A),this.I=2}}else this.I==3&&(y?Fc(this,y):this.i.length==0||Rc(this.h)||Fc(this))};function Fc(y,A){var U;A?U=A.l:U=y.V++;const K=mn(y.J);It(K,"SID",y.M),It(K,"RID",U),It(K,"AID",y.K),io(y,K),y.u&&y.o&&no(K,y.u,y.o),U=new Jr(y,y.j,U,y.D+1),y.u===null&&(U.J=y.o),A&&(y.i=A.G.concat(y.i)),A=kd(y,U,1e3),U.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),Ic(y.h,U),xs(U,K,A)}function io(y,A){y.H&&H(y.H,function(U,K){It(A,K,U)}),y.l&&H({},function(U,K){It(A,K,U)})}function kd(y,A,U){U=Math.min(y.i.length,U);const K=y.l?f(y.l.Ka,y.l,y):null;e:{var he=y.i;let it=-1;for(;;){const an=["count="+U];it==-1?U>0?(it=he[0].g,an.push("ofs="+it)):it=0:an.push("ofs="+it);let Ct=!0;for(let Qt=0;Qt<U;Qt++){var be=he[Qt].g;const zr=he[Qt].map;if(be-=it,be<0)it=Math.max(0,he[Qt].g-100),Ct=!1;else try{be="req"+be+"_"||"";try{var ze=zr instanceof Map?zr:Object.entries(zr);for(const[Ms,ss]of ze){let is=ss;u(ss)&&(is=st(ss)),an.push(be+Ms+"="+encodeURIComponent(is))}}catch(Ms){throw an.push(be+"type="+encodeURIComponent("_badmap")),Ms}}catch{K&&K(zr)}}if(Ct){ze=an.join("&");break e}}ze=void 0}return y=y.i.splice(0,U),A.G=y,ze}function Md(y){if(!y.g&&!y.v){y.Y=1;var A=y.Da;F||O(),G||(F(),G=!0),D.add(A,y),y.A=0}}function ao(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=bs(f(y.Da,y),Pd(y,y.A)),y.A++,!0)}t.Da=function(){if(this.v=null,Od(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=bs(f(this.Wa,this),y)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ft(10),Hi(this),Od(this))};function Vc(y){y.B!=null&&(l.clearTimeout(y.B),y.B=null)}function Od(y){y.g=new Jr(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var A=mn(y.na);It(A,"RID","rpc"),It(A,"SID",y.M),It(A,"AID",y.K),It(A,"CI",y.F?"0":"1"),!y.F&&y.ia&&It(A,"TO",y.ia),It(A,"TYPE","xmlhttp"),io(y,A),y.u&&y.o&&no(A,y.u,y.o),y.O&&(y.g.H=y.O);var U=y.g;y=y.ba,U.M=1,U.A=Ja(mn(A)),U.u=null,U.R=!0,Zo(U,y)}t.Va=function(){this.C!=null&&(this.C=null,Hi(this),ao(this),Ft(19))};function ol(y){y.C!=null&&(l.clearTimeout(y.C),y.C=null)}function Nd(y,A){var U=null;if(y.g==A){ol(y),Vc(y),y.g=null;var K=2}else if(Ts(y.h,A))U=A.G,Dc(y.h,A),K=1;else return;if(y.I!=0){if(A.o)if(K==1){U=A.u?A.u.length:0,A=Date.now()-A.F;var he=y.D;K=Bi(),Se(K,new rr(K,U)),Ds(y)}else Md(y);else if(he=A.m,he==3||he==0&&A.X>0||!(K==1&&al(y,A)||K==2&&ao(y)))switch(U&&U.length>0&&(A=y.h,A.i=A.i.concat(U)),he){case 1:ks(y,5);break;case 4:ks(y,10);break;case 3:ks(y,6);break;default:ks(y,2)}}}function Pd(y,A){let U=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(U*=2),U*A}function ks(y,A){if(y.j.info("Error code "+A),A==2){var U=f(y.bb,y),K=y.Ua;const he=!K;K=new wr(K||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||kn(K,"https"),Ja(K),he?ts(K.toString(),U):Bc(K.toString(),U)}else Ft(2);y.I=0,y.l&&y.l.pa(A),Bd(y),il(y)}t.bb=function(y){y?(this.j.info("Successfully pinged google.com"),Ft(2)):(this.j.info("Failed to ping google.com"),Ft(1))};function Bd(y){if(y.I=0,y.ja=[],y.l){const A=kc(y.h);(A.length!=0||y.i.length!=0)&&(w(y.ja,A),w(y.ja,y.i),y.h.i.length=0,_(y.i),y.i.length=0),y.l.oa()}}function zd(y,A,U){var K=U instanceof wr?mn(U):new wr(U);if(K.g!="")A&&(K.g=A+"."+K.g),zi(K,K.u);else{var he=l.location;K=he.protocol,A=A?A+"."+he.hostname:he.hostname,he=+he.port;const be=new wr(null);K&&kn(be,K),A&&(be.g=A),he&&zi(be,he),U&&(be.h=U),K=be}return U=y.G,A=y.wa,U&&A&&It(K,U,A),It(K,"VER",y.ka),io(y,K),K}function Ld(y,A,U){if(A&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return A=y.Aa&&!y.ma?new Mt(new js({ab:U})):new Mt(y.ma),A.Fa(y.L),A}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ud(){}t=Ud.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Gi(){}Gi.prototype.g=function(y,A){return new sr(y,A)};function sr(y,A){oe.call(this),this.g=new qi(A),this.l=y,this.h=A&&A.messageUrlParams||null,y=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(y?y["X-WebChannel-Content-Type"]=A.messageContentType:y={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.sa&&(y?y["X-WebChannel-Client-Profile"]=A.sa:y={"X-WebChannel-Client-Profile":A.sa}),this.g.U=y,(y=A&&A.Qb)&&!B(y)&&(this.g.u=y),this.A=A&&A.supportsCrossDomainXhr||!1,this.v=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!B(A)&&(this.g.G=A,y=this.h,y!==null&&A in y&&(y=this.h,A in y&&delete y[A])),this.j=new ti(this)}g(sr,oe),sr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},sr.prototype.close=function(){Uc(this.g)},sr.prototype.o=function(y){var A=this.g;if(typeof y=="string"){var U={};U.__data__=y,y=U}else this.v&&(U={},U.__data__=st(y),y=U);A.i.push(new fn(A.Ya++,y)),A.I==3&&Ds(A)},sr.prototype.N=function(){this.g.l=null,delete this.j,Uc(this.g),delete this.g,sr.Z.N.call(this)};function Fd(y){nn.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var A=y.__sm__;if(A){e:{for(const U in A){y=U;break e}y=void 0}(this.i=y)&&(y=this.i,A=A!==null&&y in A?A[y]:void 0),this.data=A}else this.data=y}g(Fd,nn);function Vd(){Qn.call(this),this.status=1}g(Vd,Qn);function ti(y){this.g=y}g(ti,Ud),ti.prototype.ra=function(){Se(this.g,"a")},ti.prototype.qa=function(y){Se(this.g,new Fd(y))},ti.prototype.pa=function(y){Se(this.g,new Vd)},ti.prototype.oa=function(){Se(this.g,"b")},Gi.prototype.createWebChannel=Gi.prototype.g,sr.prototype.send=sr.prototype.o,sr.prototype.open=sr.prototype.m,sr.prototype.close=sr.prototype.close,GE=function(){return new Gi},HE=function(){return Bi()},qE=Et,xy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Xa.NO_ERROR=0,Xa.TIMEOUT=8,Xa.HTTP_ERROR=6,uf=Xa,Tc.COMPLETE="complete",$E=Tc,ys.EventType=vt,vt.OPEN="a",vt.CLOSE="b",vt.ERROR="c",vt.MESSAGE="d",oe.prototype.listen=oe.prototype.J,Iu=ys,Mt.prototype.listenOnce=Mt.prototype.K,Mt.prototype.getLastError=Mt.prototype.Ha,Mt.prototype.getLastErrorCode=Mt.prototype.ya,Mt.prototype.getStatus=Mt.prototype.ca,Mt.prototype.getResponseJson=Mt.prototype.La,Mt.prototype.getResponseText=Mt.prototype.la,Mt.prototype.send=Mt.prototype.ea,Mt.prototype.setWithCredentials=Mt.prototype.Fa,VE=Mt}).apply(typeof Yh<"u"?Yh:typeof self<"u"?self:typeof window<"u"?window:{});const Bw="@firebase/firestore",zw="4.9.3";class Xn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Xn.UNAUTHENTICATED=new Xn(null),Xn.GOOGLE_CREDENTIALS=new Xn("google-credentials-uid"),Xn.FIRST_PARTY=new Xn("first-party-uid"),Xn.MOCK_USER=new Xn("mock-user");let gc="12.7.0";const Bo=new Yy("@firebase/firestore");function Fl(){return Bo.logLevel}function Ue(t,...e){if(Bo.logLevel<=pt.DEBUG){const n=e.map(d_);Bo.debug(`Firestore (${gc}): ${t}`,...n)}}function Ri(t,...e){if(Bo.logLevel<=pt.ERROR){const n=e.map(d_);Bo.error(`Firestore (${gc}): ${t}`,...n)}}function Jl(t,...e){if(Bo.logLevel<=pt.WARN){const n=e.map(d_);Bo.warn(`Firestore (${gc}): ${t}`,...n)}}function d_(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Je(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,WE(t,r,n)}function WE(t,e,n){let r=`FIRESTORE (${gc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Ri(r),new Error(r)}function jt(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||WE(e,i,r)}function rt(t,e){return t}const Ie={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Le extends Oi{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ei{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class QE{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class IM{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Xn.UNAUTHENTICATED)))}shutdown(){}}class DM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class kM{constructor(e){this.t=e,this.currentUser=Xn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){jt(this.o===void 0,42304);let r=this.i;const i=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new Ei;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ei,e.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await i(this.currentUser)}))},u=h=>{Ue("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(Ue("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ei)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Ue("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(jt(typeof r.accessToken=="string",31837,{l:r}),new QE(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return jt(e===null||typeof e=="string",2055,{h:e}),new Xn(e)}}class MM{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Xn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class OM{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new MM(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Xn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Lw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class NM{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,us(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){jt(this.o===void 0,3512);const r=o=>{o.error!=null&&Ue("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Ue("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const i=o=>{Ue("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>i(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):Ue("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Lw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(jt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Lw(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function PM(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class h_{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=PM(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%62))}return r}}function gt(t,e){return t<e?-1:t>e?1:0}function wy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),o=e.charAt(r);if(i!==o)return qg(i)===qg(o)?gt(i,o):qg(i)?1:-1}return gt(t.length,e.length)}const BM=55296,zM=57343;function qg(t){const e=t.charCodeAt(0);return e>=BM&&e<=zM}function ec(t,e,n){return t.length===e.length&&t.every(((r,i)=>n(r,e[i])))}const Uw="__name__";class Ls{constructor(e,n,r){n===void 0?n=0:n>e.length&&Je(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Je(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Ls.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Ls?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=Ls.compareSegments(e.get(i),n.get(i));if(o!==0)return o}return gt(e.length,n.length)}static compareSegments(e,n){const r=Ls.isNumericId(e),i=Ls.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?Ls.extractNumericId(e).compare(Ls.extractNumericId(n)):wy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ia.fromString(e.substring(4,e.length-2))}}class $t extends Ls{construct(e,n,r){return new $t(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Le(Ie.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((i=>i.length>0)))}return new $t(n)}static emptyPath(){return new $t([])}}const LM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $n extends Ls{construct(e,n,r){return new $n(e,n,r)}static isValidIdentifier(e){return LM.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$n.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Uw}static keyField(){return new $n([Uw])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new Le(Ie.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;i<e.length;){const u=e[i];if(u==="\\"){if(i+1===e.length)throw new Le(Ie.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Le(Ie.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else u==="`"?(l=!l,i++):u!=="."||l?(r+=u,i++):(o(),i++)}if(o(),l)throw new Le(Ie.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new $n(n)}static emptyPath(){return new $n([])}}class Qe{constructor(e){this.path=e}static fromPath(e){return new Qe($t.fromString(e))}static fromName(e){return new Qe($t.fromString(e).popFirst(5))}static empty(){return new Qe($t.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&$t.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return $t.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Qe(new $t(e.slice()))}}function KE(t,e,n){if(!n)throw new Le(Ie.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function UM(t,e,n,r){if(e===!0&&r===!0)throw new Le(Ie.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Fw(t){if(!Qe.isDocumentKey(t))throw new Le(Ie.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Vw(t){if(Qe.isDocumentKey(t))throw new Le(Ie.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function YE(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function tm(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Je(12329,{type:typeof t})}function ms(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Le(Ie.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=tm(t);throw new Le(Ie.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function wn(t,e){const n={typeString:t};return e&&(n.value=e),n}function cd(t,e){if(!YE(t))throw new Le(Ie.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(i&&typeof l!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Le(Ie.INVALID_ARGUMENT,n);return!0}const $w=-62135596800,qw=1e6;class Wt{static now(){return Wt.fromMillis(Date.now())}static fromDate(e){return Wt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*qw);return new Wt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<$w)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/qw}_compareTo(e){return this.seconds===e.seconds?gt(this.nanoseconds,e.nanoseconds):gt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Wt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(cd(e,Wt._jsonSchema))return new Wt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-$w;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Wt._jsonSchemaVersion="firestore/timestamp/1.0",Wt._jsonSchema={type:wn("string",Wt._jsonSchemaVersion),seconds:wn("number"),nanoseconds:wn("number")};class et{static fromTimestamp(e){return new et(e)}static min(){return new et(new Wt(0,0))}static max(){return new et(new Wt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Hu=-1;function FM(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=et.fromTimestamp(r===1e9?new Wt(n+1,0):new Wt(n,r));return new ka(i,Qe.empty(),e)}function VM(t){return new ka(t.readTime,t.key,Hu)}class ka{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new ka(et.min(),Qe.empty(),Hu)}static max(){return new ka(et.max(),Qe.empty(),Hu)}}function $M(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Qe.comparator(t.documentKey,e.documentKey),n!==0?n:gt(t.largestBatchId,e.largestBatchId))}const qM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class HM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function yc(t){if(t.code!==Ie.FAILED_PRECONDITION||t.message!==qM)throw t;Ue("LocalStore","Unexpectedly lost primary lease")}class ke{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Je(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ke(((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof ke?n:ke.resolve(n)}catch(n){return ke.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):ke.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):ke.reject(n)}static resolve(e){return new ke(((n,r)=>{n(e)}))}static reject(e){return new ke(((n,r)=>{r(e)}))}static waitFor(e){return new ke(((n,r)=>{let i=0,o=0,l=!1;e.forEach((u=>{++i,u.next((()=>{++o,l&&o===i&&n()}),(h=>r(h)))})),l=!0,o===i&&n()}))}static or(e){let n=ke.resolve(!1);for(const r of e)n=n.next((i=>i?ke.resolve(i):r()));return n}static forEach(e,n){const r=[];return e.forEach(((i,o)=>{r.push(n.call(this,i,o))})),this.waitFor(r)}static mapArray(e,n){return new ke(((r,i)=>{const o=e.length,l=new Array(o);let u=0;for(let h=0;h<o;h++){const f=h;n(e[f]).next((p=>{l[f]=p,++u,u===o&&r(l)}),(p=>i(p)))}}))}static doWhile(e,n){return new ke(((r,i)=>{const o=()=>{e()===!0?n().next((()=>{o()}),i):r()};o()}))}}function GM(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function _c(t){return t.name==="IndexedDbTransactionError"}class nm{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}nm.ce=-1;const f_=-1;function rm(t){return t==null}function Af(t){return t===0&&1/t==-1/0}function WM(t){return typeof t=="number"&&Number.isInteger(t)&&!Af(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const XE="";function QM(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Hw(e)),e=KM(t.get(n),e);return Hw(e)}function KM(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case XE:n+="";break;default:n+=o}}return n}function Hw(t){return t+XE+""}function Gw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function $a(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ZE(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class tn{constructor(e,n){this.comparator=e,this.root=n||Fn.EMPTY}insert(e,n){return new tn(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Fn.BLACK,null,null))}remove(e){return new tn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Fn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Xh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Xh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Xh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Xh(this.root,e,this.comparator,!0)}}class Xh{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Fn{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Fn.RED,this.left=i??Fn.EMPTY,this.right=o??Fn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new Fn(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Fn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Fn.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Fn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Fn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Je(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Je(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Je(27949);return e+(this.isRed()?0:1)}}Fn.EMPTY=null,Fn.RED=!0,Fn.BLACK=!1;Fn.EMPTY=new class{constructor(){this.size=0}get key(){throw Je(57766)}get value(){throw Je(16141)}get color(){throw Je(16727)}get left(){throw Je(29726)}get right(){throw Je(36894)}copy(e,n,r,i,o){return this}insert(e,n,r){return new Fn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class jn{constructor(e){this.comparator=e,this.data=new tn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Ww(this.data.getIterator())}getIteratorFrom(e){return new Ww(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof jn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new jn(this.comparator);return n.data=e,n}}class Ww{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ir{constructor(e){this.fields=e,e.sort($n.comparator)}static empty(){return new Ir([])}unionWith(e){let n=new jn($n.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Ir(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ec(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class JE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Gn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new JE("Invalid base64 string: "+o):o}})(e);return new Gn(n)}static fromUint8Array(e){const n=(function(i){let o="";for(let l=0;l<i.length;++l)o+=String.fromCharCode(i[l]);return o})(e);return new Gn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return gt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Gn.EMPTY_BYTE_STRING=new Gn("");const YM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ma(t){if(jt(!!t,39018),typeof t=="string"){let e=0;const n=YM.exec(t);if(jt(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:cn(t.seconds),nanos:cn(t.nanos)}}function cn(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Oa(t){return typeof t=="string"?Gn.fromBase64String(t):Gn.fromUint8Array(t)}const eC="server_timestamp",tC="__type__",nC="__previous_value__",rC="__local_write_time__";function m_(t){return(t?.mapValue?.fields||{})[tC]?.stringValue===eC}function sm(t){const e=t.mapValue.fields[nC];return m_(e)?sm(e):e}function Gu(t){const e=Ma(t.mapValue.fields[rC].timestampValue);return new Wt(e.seconds,e.nanos)}class XM{constructor(e,n,r,i,o,l,u,h,f,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=p}}const jf="(default)";class Wu{constructor(e,n){this.projectId=e,this.database=n||jf}static empty(){return new Wu("","")}get isDefaultDatabase(){return this.database===jf}isEqual(e){return e instanceof Wu&&e.projectId===this.projectId&&e.database===this.database}}const sC="__type__",ZM="__max__",Zh={mapValue:{}},iC="__vector__",Rf="value";function Na(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?m_(t)?4:eO(t)?9007199254740991:JM(t)?10:11:Je(28295,{value:t})}function Ys(t,e){if(t===e)return!0;const n=Na(t);if(n!==Na(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Gu(t).isEqual(Gu(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const l=Ma(i.timestampValue),u=Ma(o.timestampValue);return l.seconds===u.seconds&&l.nanos===u.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(i,o){return Oa(i.bytesValue).isEqual(Oa(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(i,o){return cn(i.geoPointValue.latitude)===cn(o.geoPointValue.latitude)&&cn(i.geoPointValue.longitude)===cn(o.geoPointValue.longitude)})(t,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return cn(i.integerValue)===cn(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const l=cn(i.doubleValue),u=cn(o.doubleValue);return l===u?Af(l)===Af(u):isNaN(l)&&isNaN(u)}return!1})(t,e);case 9:return ec(t.arrayValue.values||[],e.arrayValue.values||[],Ys);case 10:case 11:return(function(i,o){const l=i.mapValue.fields||{},u=o.mapValue.fields||{};if(Gw(l)!==Gw(u))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(u[h]===void 0||!Ys(l[h],u[h])))return!1;return!0})(t,e);default:return Je(52216,{left:t})}}function Qu(t,e){return(t.values||[]).find((n=>Ys(n,e)))!==void 0}function tc(t,e){if(t===e)return 0;const n=Na(t),r=Na(e);if(n!==r)return gt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return gt(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const u=cn(o.integerValue||o.doubleValue),h=cn(l.integerValue||l.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(t,e);case 3:return Qw(t.timestampValue,e.timestampValue);case 4:return Qw(Gu(t),Gu(e));case 5:return wy(t.stringValue,e.stringValue);case 6:return(function(o,l){const u=Oa(o),h=Oa(l);return u.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const u=o.split("/"),h=l.split("/");for(let f=0;f<u.length&&f<h.length;f++){const p=gt(u[f],h[f]);if(p!==0)return p}return gt(u.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const u=gt(cn(o.latitude),cn(l.latitude));return u!==0?u:gt(cn(o.longitude),cn(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return Kw(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const u=o.fields||{},h=l.fields||{},f=u[Rf]?.arrayValue,p=h[Rf]?.arrayValue,g=gt(f?.values?.length||0,p?.values?.length||0);return g!==0?g:Kw(f,p)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===Zh.mapValue&&l===Zh.mapValue)return 0;if(o===Zh.mapValue)return 1;if(l===Zh.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),f=l.fields||{},p=Object.keys(f);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const b=wy(h[g],p[g]);if(b!==0)return b;const _=tc(u[h[g]],f[p[g]]);if(_!==0)return _}return gt(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Je(23264,{he:n})}}function Qw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return gt(t,e);const n=Ma(t),r=Ma(e),i=gt(n.seconds,r.seconds);return i!==0?i:gt(n.nanos,r.nanos)}function Kw(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=tc(n[i],r[i]);if(o)return o}return gt(n.length,r.length)}function nc(t){return Sy(t)}function Sy(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=Ma(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return Oa(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return Qe.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=Sy(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const l of r)o?o=!1:i+=",",i+=`${l}:${Sy(n.fields[l])}`;return i+"}"})(t.mapValue):Je(61005,{value:t})}function df(t){switch(Na(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=sm(t);return e?16+df(e):16;case 5:return 2*t.stringValue.length;case 6:return Oa(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,o)=>i+df(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let i=0;return $a(r.fields,((o,l)=>{i+=o.length+df(l)})),i})(t.mapValue);default:throw Je(13486,{value:t})}}function Yw(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ey(t){return!!t&&"integerValue"in t}function p_(t){return!!t&&"arrayValue"in t}function Xw(t){return!!t&&"nullValue"in t}function Zw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function hf(t){return!!t&&"mapValue"in t}function JM(t){return(t?.mapValue?.fields||{})[sC]?.stringValue===iC}function Pu(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return $a(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Pu(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Pu(t.arrayValue.values[n]);return e}return{...t}}function eO(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===ZM}class yr{constructor(e){this.value=e}static empty(){return new yr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!hf(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Pu(n)}setAll(e){let n=$n.emptyPath(),r={},i=[];e.forEach(((l,u)=>{if(!n.isImmediateParentOf(u)){const h=this.getFieldsMap(n);this.applyChanges(h,r,i),r={},i=[],n=u.popLast()}l?r[u.lastSegment()]=Pu(l):i.push(u.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());hf(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Ys(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];hf(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){$a(n,((i,o)=>e[i]=o));for(const i of r)delete e[i]}clone(){return new yr(Pu(this.value))}}function aC(t){const e=[];return $a(t.fields,((n,r)=>{const i=new $n([n]);if(hf(r)){const o=aC(r.mapValue).fields;if(o.length===0)e.push(i);else for(const l of o)e.push(i.child(l))}else e.push(i)})),new Ir(e)}class Zn{constructor(e,n,r,i,o,l,u){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=l,this.documentState=u}static newInvalidDocument(e){return new Zn(e,0,et.min(),et.min(),et.min(),yr.empty(),0)}static newFoundDocument(e,n,r,i){return new Zn(e,1,n,et.min(),r,i,0)}static newNoDocument(e,n){return new Zn(e,2,n,et.min(),et.min(),yr.empty(),0)}static newUnknownDocument(e,n){return new Zn(e,3,n,et.min(),et.min(),yr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(et.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=yr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=yr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=et.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Zn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Zn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class If{constructor(e,n){this.position=e,this.inclusive=n}}function Jw(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],l=t.position[i];if(o.field.isKeyField()?r=Qe.comparator(Qe.fromName(l.referenceValue),n.key):r=tc(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function eS(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ys(t.position[n],e.position[n]))return!1;return!0}class Df{constructor(e,n="asc"){this.field=e,this.dir=n}}function tO(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class oC{}class xn extends oC{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new rO(e,n,r):n==="array-contains"?new aO(e,r):n==="in"?new oO(e,r):n==="not-in"?new lO(e,r):n==="array-contains-any"?new cO(e,r):new xn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new sO(e,r):new iO(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(tc(n,this.value)):n!==null&&Na(this.value)===Na(n)&&this.matchesComparison(tc(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Je(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ps extends oC{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ps(e,n)}matches(e){return lC(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function lC(t){return t.op==="and"}function cC(t){return nO(t)&&lC(t)}function nO(t){for(const e of t.filters)if(e instanceof ps)return!1;return!0}function Cy(t){if(t instanceof xn)return t.field.canonicalString()+t.op.toString()+nc(t.value);if(cC(t))return t.filters.map((e=>Cy(e))).join(",");{const e=t.filters.map((n=>Cy(n))).join(",");return`${t.op}(${e})`}}function uC(t,e){return t instanceof xn?(function(r,i){return i instanceof xn&&r.op===i.op&&r.field.isEqual(i.field)&&Ys(r.value,i.value)})(t,e):t instanceof ps?(function(r,i){return i instanceof ps&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((o,l,u)=>o&&uC(l,i.filters[u])),!0):!1})(t,e):void Je(19439)}function dC(t){return t instanceof xn?(function(n){return`${n.field.canonicalString()} ${n.op} ${nc(n.value)}`})(t):t instanceof ps?(function(n){return n.op.toString()+" {"+n.getFilters().map(dC).join(" ,")+"}"})(t):"Filter"}class rO extends xn{constructor(e,n,r){super(e,n,r),this.key=Qe.fromName(r.referenceValue)}matches(e){const n=Qe.comparator(e.key,this.key);return this.matchesComparison(n)}}class sO extends xn{constructor(e,n){super(e,"in",n),this.keys=hC("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class iO extends xn{constructor(e,n){super(e,"not-in",n),this.keys=hC("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function hC(t,e){return(e.arrayValue?.values||[]).map((n=>Qe.fromName(n.referenceValue)))}class aO extends xn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return p_(n)&&Qu(n.arrayValue,this.value)}}class oO extends xn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Qu(this.value.arrayValue,n)}}class lO extends xn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Qu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Qu(this.value.arrayValue,n)}}class cO extends xn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!p_(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Qu(this.value.arrayValue,r)))}}class uO{constructor(e,n=null,r=[],i=[],o=null,l=null,u=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=l,this.endAt=u,this.Te=null}}function tS(t,e=null,n=[],r=[],i=null,o=null,l=null){return new uO(t,e,n,r,i,o,l)}function g_(t){const e=rt(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>Cy(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),rm(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>nc(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>nc(r))).join(",")),e.Te=n}return e.Te}function y_(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!tO(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!uC(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!eS(t.startAt,e.startAt)&&eS(t.endAt,e.endAt)}function Ty(t){return Qe.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class ud{constructor(e,n=null,r=[],i=[],o=null,l="F",u=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=l,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function dO(t,e,n,r,i,o,l,u){return new ud(t,e,n,r,i,o,l,u)}function __(t){return new ud(t)}function nS(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function fC(t){return t.collectionGroup!==null}function Bu(t){const e=rt(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let u=new jn($n.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(u=u.add(f.field))}))})),u})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Df(o,r))})),n.has($n.keyField().canonicalString())||e.Ie.push(new Df($n.keyField(),r))}return e.Ie}function $s(t){const e=rt(t);return e.Ee||(e.Ee=hO(e,Bu(t))),e.Ee}function hO(t,e){if(t.limitType==="F")return tS(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((i=>{const o=i.dir==="desc"?"asc":"desc";return new Df(i.field,o)}));const n=t.endAt?new If(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new If(t.startAt.position,t.startAt.inclusive):null;return tS(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Ay(t,e){const n=t.filters.concat([e]);return new ud(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function jy(t,e,n){return new ud(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function im(t,e){return y_($s(t),$s(e))&&t.limitType===e.limitType}function mC(t){return`${g_($s(t))}|lt:${t.limitType}`}function Vl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((i=>dC(i))).join(", ")}]`),rm(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((i=>nc(i))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((i=>nc(i))).join(",")),`Target(${r})`})($s(t))}; limitType=${t.limitType})`}function am(t,e){return e.isFoundDocument()&&(function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):Qe.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,i){for(const o of Bu(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0})(t,e)&&(function(r,i){return!(r.startAt&&!(function(l,u,h){const f=Jw(l,u,h);return l.inclusive?f<=0:f<0})(r.startAt,Bu(r),i)||r.endAt&&!(function(l,u,h){const f=Jw(l,u,h);return l.inclusive?f>=0:f>0})(r.endAt,Bu(r),i))})(t,e)}function fO(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function pC(t){return(e,n)=>{let r=!1;for(const i of Bu(t)){const o=mO(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function mO(t,e,n){const r=t.field.isKeyField()?Qe.comparator(e.key,n.key):(function(o,l,u){const h=l.data.field(o),f=u.data.field(o);return h!==null&&f!==null?tc(h,f):Je(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Je(19790,{direction:t.dir})}}class $o{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){$a(this.inner,((n,r)=>{for(const[i,o]of r)e(i,o)}))}isEmpty(){return ZE(this.inner)}size(){return this.innerSize}}const pO=new tn(Qe.comparator);function Ii(){return pO}const gC=new tn(Qe.comparator);function Du(...t){let e=gC;for(const n of t)e=e.insert(n.key,n);return e}function yC(t){let e=gC;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function Ro(){return zu()}function _C(){return zu()}function zu(){return new $o((t=>t.toString()),((t,e)=>t.isEqual(e)))}const gO=new tn(Qe.comparator),yO=new jn(Qe.comparator);function yt(...t){let e=yO;for(const n of t)e=e.add(n);return e}const _O=new jn(gt);function bO(){return _O}function b_(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Af(e)?"-0":e}}function bC(t){return{integerValue:""+t}}function vO(t,e){return WM(e)?bC(e):b_(t,e)}class om{constructor(){this._=void 0}}function xO(t,e,n){return t instanceof kf?(function(i,o){const l={fields:{[tC]:{stringValue:eC},[rC]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&m_(o)&&(o=sm(o)),o&&(l.fields[nC]=o),{mapValue:l}})(n,e):t instanceof rc?xC(t,e):t instanceof sc?wC(t,e):(function(i,o){const l=vC(i,o),u=rS(l)+rS(i.Ae);return Ey(l)&&Ey(i.Ae)?bC(u):b_(i.serializer,u)})(t,e)}function wO(t,e,n){return t instanceof rc?xC(t,e):t instanceof sc?wC(t,e):n}function vC(t,e){return t instanceof Mf?(function(r){return Ey(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class kf extends om{}class rc extends om{constructor(e){super(),this.elements=e}}function xC(t,e){const n=SC(e);for(const r of t.elements)n.some((i=>Ys(i,r)))||n.push(r);return{arrayValue:{values:n}}}class sc extends om{constructor(e){super(),this.elements=e}}function wC(t,e){let n=SC(e);for(const r of t.elements)n=n.filter((i=>!Ys(i,r)));return{arrayValue:{values:n}}}class Mf extends om{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function rS(t){return cn(t.integerValue||t.doubleValue)}function SC(t){return p_(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class EC{constructor(e,n){this.field=e,this.transform=n}}function SO(t,e){return t.field.isEqual(e.field)&&(function(r,i){return r instanceof rc&&i instanceof rc||r instanceof sc&&i instanceof sc?ec(r.elements,i.elements,Ys):r instanceof Mf&&i instanceof Mf?Ys(r.Ae,i.Ae):r instanceof kf&&i instanceof kf})(t.transform,e.transform)}class EO{constructor(e,n){this.version=e,this.transformResults=n}}class br{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new br}static exists(e){return new br(void 0,e)}static updateTime(e){return new br(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ff(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class lm{}function CC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new cm(t.key,br.none()):new dd(t.key,t.data,br.none());{const n=t.data,r=yr.empty();let i=new jn($n.comparator);for(let o of e.fields)if(!i.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),i=i.add(o)}return new qa(t.key,r,new Ir(i.toArray()),br.none())}}function CO(t,e,n){t instanceof dd?(function(i,o,l){const u=i.value.clone(),h=iS(i.fieldTransforms,o,l.transformResults);u.setAll(h),o.convertToFoundDocument(l.version,u).setHasCommittedMutations()})(t,e,n):t instanceof qa?(function(i,o,l){if(!ff(i.precondition,o))return void o.convertToUnknownDocument(l.version);const u=iS(i.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(TC(i)),h.setAll(u),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(i,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function Lu(t,e,n,r){return t instanceof dd?(function(o,l,u,h){if(!ff(o.precondition,l))return u;const f=o.value.clone(),p=aS(o.fieldTransforms,h,l);return f.setAll(p),l.convertToFoundDocument(l.version,f).setHasLocalMutations(),null})(t,e,n,r):t instanceof qa?(function(o,l,u,h){if(!ff(o.precondition,l))return u;const f=aS(o.fieldTransforms,h,l),p=l.data;return p.setAll(TC(o)),p.setAll(f),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,l,u){return ff(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):u})(t,e,n)}function TO(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=vC(r.transform,i||null);o!=null&&(n===null&&(n=yr.empty()),n.set(r.field,o))}return n||null}function sS(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ec(r,i,((o,l)=>SO(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class dd extends lm{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class qa extends lm{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function TC(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function iS(t,e,n){const r=new Map;jt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const o=t[i],l=o.transform,u=e.data.field(o.field);r.set(o.field,wO(l,u,n[i]))}return r}function aS(t,e,n){const r=new Map;for(const i of t){const o=i.transform,l=n.data.field(i.field);r.set(i.field,xO(o,l,e))}return r}class cm extends lm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class AO extends lm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class jO{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&CO(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Lu(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Lu(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=_C();return this.mutations.forEach((i=>{const o=e.get(i.key),l=o.overlayedDocument;let u=this.applyToLocalView(l,o.mutatedFields);u=n.has(i.key)?null:u;const h=CC(l,u);h!==null&&r.set(i.key,h),l.isValidDocument()||l.convertToNoDocument(et.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),yt())}isEqual(e){return this.batchId===e.batchId&&ec(this.mutations,e.mutations,((n,r)=>sS(n,r)))&&ec(this.baseMutations,e.baseMutations,((n,r)=>sS(n,r)))}}class v_{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){jt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return gO})();const o=e.mutations;for(let l=0;l<o.length;l++)i=i.insert(o[l].key,r[l].version);return new v_(e,n,r,i)}}class RO{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class IO{constructor(e,n){this.count=e,this.unchangedNames=n}}var vn,bt;function DO(t){switch(t){case Ie.OK:return Je(64938);case Ie.CANCELLED:case Ie.UNKNOWN:case Ie.DEADLINE_EXCEEDED:case Ie.RESOURCE_EXHAUSTED:case Ie.INTERNAL:case Ie.UNAVAILABLE:case Ie.UNAUTHENTICATED:return!1;case Ie.INVALID_ARGUMENT:case Ie.NOT_FOUND:case Ie.ALREADY_EXISTS:case Ie.PERMISSION_DENIED:case Ie.FAILED_PRECONDITION:case Ie.ABORTED:case Ie.OUT_OF_RANGE:case Ie.UNIMPLEMENTED:case Ie.DATA_LOSS:return!0;default:return Je(15467,{code:t})}}function AC(t){if(t===void 0)return Ri("GRPC error has no .code"),Ie.UNKNOWN;switch(t){case vn.OK:return Ie.OK;case vn.CANCELLED:return Ie.CANCELLED;case vn.UNKNOWN:return Ie.UNKNOWN;case vn.DEADLINE_EXCEEDED:return Ie.DEADLINE_EXCEEDED;case vn.RESOURCE_EXHAUSTED:return Ie.RESOURCE_EXHAUSTED;case vn.INTERNAL:return Ie.INTERNAL;case vn.UNAVAILABLE:return Ie.UNAVAILABLE;case vn.UNAUTHENTICATED:return Ie.UNAUTHENTICATED;case vn.INVALID_ARGUMENT:return Ie.INVALID_ARGUMENT;case vn.NOT_FOUND:return Ie.NOT_FOUND;case vn.ALREADY_EXISTS:return Ie.ALREADY_EXISTS;case vn.PERMISSION_DENIED:return Ie.PERMISSION_DENIED;case vn.FAILED_PRECONDITION:return Ie.FAILED_PRECONDITION;case vn.ABORTED:return Ie.ABORTED;case vn.OUT_OF_RANGE:return Ie.OUT_OF_RANGE;case vn.UNIMPLEMENTED:return Ie.UNIMPLEMENTED;case vn.DATA_LOSS:return Ie.DATA_LOSS;default:return Je(39323,{code:t})}}(bt=vn||(vn={}))[bt.OK=0]="OK",bt[bt.CANCELLED=1]="CANCELLED",bt[bt.UNKNOWN=2]="UNKNOWN",bt[bt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bt[bt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bt[bt.NOT_FOUND=5]="NOT_FOUND",bt[bt.ALREADY_EXISTS=6]="ALREADY_EXISTS",bt[bt.PERMISSION_DENIED=7]="PERMISSION_DENIED",bt[bt.UNAUTHENTICATED=16]="UNAUTHENTICATED",bt[bt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bt[bt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bt[bt.ABORTED=10]="ABORTED",bt[bt.OUT_OF_RANGE=11]="OUT_OF_RANGE",bt[bt.UNIMPLEMENTED=12]="UNIMPLEMENTED",bt[bt.INTERNAL=13]="INTERNAL",bt[bt.UNAVAILABLE=14]="UNAVAILABLE",bt[bt.DATA_LOSS=15]="DATA_LOSS";function kO(){return new TextEncoder}const MO=new Ia([4294967295,4294967295],0);function oS(t){const e=kO().encode(t),n=new FE;return n.update(e),new Uint8Array(n.digest())}function lS(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Ia([n,r],0),new Ia([i,o],0)]}class x_{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new ku(`Invalid padding: ${n}`);if(r<0)throw new ku(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ku(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new ku(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=Ia.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(Ia.fromNumber(r)));return i.compare(MO)===1&&(i=new Ia([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=oS(e),[r,i]=lS(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new x_(o,i,n);return r.forEach((u=>l.insert(u))),l}insert(e){if(this.ge===0)return;const n=oS(e),[r,i]=lS(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class ku extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class um{constructor(e,n,r,i,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,hd.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new um(et.min(),i,new tn(gt),Ii(),yt())}}class hd{constructor(e,n,r,i,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new hd(r,n,yt(),yt(),yt())}}class mf{constructor(e,n,r,i){this.be=e,this.removedTargetIds=n,this.key=r,this.De=i}}class jC{constructor(e,n){this.targetId=e,this.Ce=n}}class RC{constructor(e,n,r=Gn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class cS{constructor(){this.ve=0,this.Fe=uS(),this.Me=Gn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=yt(),n=yt(),r=yt();return this.Fe.forEach(((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Je(38017,{changeType:o})}})),new hd(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=uS()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,jt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class OO{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ii(),this.Je=Jh(),this.He=Jh(),this.Ye=new tn(gt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Je(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,i)=>{this.rt(i)&&n(i)}))}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const o=i.target;if(Ty(o))if(r===0){const l=new Qe(o.path);this.et(n,l,Zn.newNoDocument(l,et.min()))}else jt(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const u=this.ut(e),h=u?this.ct(u,e,l):1;if(h!==0){this.it(n);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,f)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let l,u;try{l=Oa(r).toUint8Array()}catch(h){if(h instanceof JE)return Jl("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new x_(l,i,o)}catch(h){return Jl(h instanceof ku?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach((o=>{const l=this.Ge.ht(),u=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(n,o,null),i++)})),i}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const u=this.ot(l);if(u){if(o.current&&Ty(u.target)){const h=new Qe(u.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Zn.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=yt();this.He.forEach(((o,l)=>{let u=!0;l.forEachWhile((h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const i=new um(e,n,this.Ye,this.je,r);return this.je=Ii(),this.Je=Jh(),this.He=Jh(),this.Ye=new tn(gt),i}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.Qe(n,1):i.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new cS,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new jn(gt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new jn(gt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Ue("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new cS),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Jh(){return new tn(Qe.comparator)}function uS(){return new tn(Qe.comparator)}const NO={asc:"ASCENDING",desc:"DESCENDING"},PO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},BO={and:"AND",or:"OR"};class zO{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Ry(t,e){return t.useProto3Json||rm(e)?e:{value:e}}function Of(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function IC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function LO(t,e){return Of(t,e.toTimestamp())}function qs(t){return jt(!!t,49232),et.fromTimestamp((function(n){const r=Ma(n);return new Wt(r.seconds,r.nanos)})(t))}function w_(t,e){return Iy(t,e).canonicalString()}function Iy(t,e){const n=(function(i){return new $t(["projects",i.projectId,"databases",i.database])})(t).child("documents");return e===void 0?n:n.child(e)}function DC(t){const e=$t.fromString(t);return jt(PC(e),10190,{key:e.toString()}),e}function Dy(t,e){return w_(t.databaseId,e.path)}function Hg(t,e){const n=DC(e);if(n.get(1)!==t.databaseId.projectId)throw new Le(Ie.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Le(Ie.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Qe(MC(n))}function kC(t,e){return w_(t.databaseId,e)}function UO(t){const e=DC(t);return e.length===4?$t.emptyPath():MC(e)}function ky(t){return new $t(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function MC(t){return jt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function dS(t,e,n){return{name:Dy(t,e),fields:n.value.mapValue.fields}}function FO(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:Je(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(f,p){return f.useProto3Json?(jt(p===void 0||typeof p=="string",58123),Gn.fromBase64String(p||"")):(jt(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Gn.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,u=l&&(function(f){const p=f.code===void 0?Ie.UNKNOWN:AC(f.code);return new Le(p,f.message||"")})(l);n=new RC(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Hg(t,r.document.name),o=qs(r.document.updateTime),l=r.document.createTime?qs(r.document.createTime):et.min(),u=new yr({mapValue:{fields:r.document.fields}}),h=Zn.newFoundDocument(i,o,l,u),f=r.targetIds||[],p=r.removedTargetIds||[];n=new mf(f,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Hg(t,r.document),o=r.readTime?qs(r.readTime):et.min(),l=Zn.newNoDocument(i,o),u=r.removedTargetIds||[];n=new mf([],u,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Hg(t,r.document),o=r.removedTargetIds||[];n=new mf([],o,i,null)}else{if(!("filter"in e))return Je(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,l=new IO(i,o),u=r.targetId;n=new jC(u,l)}}return n}function VO(t,e){let n;if(e instanceof dd)n={update:dS(t,e.key,e.value)};else if(e instanceof cm)n={delete:Dy(t,e.key)};else if(e instanceof qa)n={update:dS(t,e.key,e.data),updateMask:XO(e.fieldMask)};else{if(!(e instanceof AO))return Je(16599,{Vt:e.type});n={verify:Dy(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const u=l.transform;if(u instanceof kf)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof rc)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof sc)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Mf)return{fieldPath:l.field.canonicalString(),increment:u.Ae};throw Je(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:LO(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Je(27497)})(t,e.precondition)),n}function $O(t,e){return t&&t.length>0?(jt(e!==void 0,14353),t.map((n=>(function(i,o){let l=i.updateTime?qs(i.updateTime):qs(o);return l.isEqual(et.min())&&(l=qs(o)),new EO(l,i.transformResults||[])})(n,e)))):[]}function qO(t,e){return{documents:[kC(t,e.path)]}}function HO(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=kC(t,i);const o=(function(f){if(f.length!==0)return NC(ps.create(f,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(f){if(f.length!==0)return f.map((p=>(function(b){return{field:$l(b.field),direction:QO(b.dir)}})(p)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const u=Ry(t,e.limit);return u!==null&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:n,parent:i}}function GO(t){let e=UO(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){jt(r===1,65062);const p=n.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const b=OC(g);return b instanceof ps&&cC(b)?b.getFilters():[b]})(n.where));let l=[];n.orderBy&&(l=(function(g){return g.map((b=>(function(w){return new Df(ql(w.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(w.direction))})(b)))})(n.orderBy));let u=null;n.limit&&(u=(function(g){let b;return b=typeof g=="object"?g.value:g,rm(b)?null:b})(n.limit));let h=null;n.startAt&&(h=(function(g){const b=!!g.before,_=g.values||[];return new If(_,b)})(n.startAt));let f=null;return n.endAt&&(f=(function(g){const b=!g.before,_=g.values||[];return new If(_,b)})(n.endAt)),dO(e,i,l,o,u,"F",h,f)}function WO(t,e){const n=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Je(28987,{purpose:i})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function OC(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=ql(n.unaryFilter.field);return xn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=ql(n.unaryFilter.field);return xn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=ql(n.unaryFilter.field);return xn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=ql(n.unaryFilter.field);return xn.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Je(61313);default:return Je(60726)}})(t):t.fieldFilter!==void 0?(function(n){return xn.create(ql(n.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Je(58110);default:return Je(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return ps.create(n.compositeFilter.filters.map((r=>OC(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Je(1026)}})(n.compositeFilter.op))})(t):Je(30097,{filter:t})}function QO(t){return NO[t]}function KO(t){return PO[t]}function YO(t){return BO[t]}function $l(t){return{fieldPath:t.canonicalString()}}function ql(t){return $n.fromServerFormat(t.fieldPath)}function NC(t){return t instanceof xn?(function(n){if(n.op==="=="){if(Zw(n.value))return{unaryFilter:{field:$l(n.field),op:"IS_NAN"}};if(Xw(n.value))return{unaryFilter:{field:$l(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Zw(n.value))return{unaryFilter:{field:$l(n.field),op:"IS_NOT_NAN"}};if(Xw(n.value))return{unaryFilter:{field:$l(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$l(n.field),op:KO(n.op),value:n.value}}})(t):t instanceof ps?(function(n){const r=n.getFilters().map((i=>NC(i)));return r.length===1?r[0]:{compositeFilter:{op:YO(n.op),filters:r}}})(t):Je(54877,{filter:t})}function XO(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function PC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class xa{constructor(e,n,r,i,o=et.min(),l=et.min(),u=Gn.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new xa(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new xa(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new xa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new xa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ZO{constructor(e){this.yt=e}}function JO(t){const e=GO({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?jy(e,e.limit,"L"):e}class eN{constructor(){this.Cn=new tN}addToCollectionParentIndex(e,n){return this.Cn.add(n),ke.resolve()}getCollectionParents(e,n){return ke.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return ke.resolve()}deleteFieldIndex(e,n){return ke.resolve()}deleteAllFieldIndexes(e){return ke.resolve()}createTargetIndexes(e,n){return ke.resolve()}getDocumentsMatchingTarget(e,n){return ke.resolve(null)}getIndexType(e,n){return ke.resolve(0)}getFieldIndexes(e,n){return ke.resolve([])}getNextCollectionGroupToUpdate(e){return ke.resolve(null)}getMinOffset(e,n){return ke.resolve(ka.min())}getMinOffsetFromCollectionGroup(e,n){return ke.resolve(ka.min())}updateCollectionGroup(e,n,r){return ke.resolve()}updateIndexEntries(e,n){return ke.resolve()}}class tN{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new jn($t.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new jn($t.comparator)).toArray()}}const hS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},BC=41943040;class gr{static withCacheSize(e){return new gr(e,gr.DEFAULT_COLLECTION_PERCENTILE,gr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}gr.DEFAULT_COLLECTION_PERCENTILE=10,gr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gr.DEFAULT=new gr(BC,gr.DEFAULT_COLLECTION_PERCENTILE,gr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gr.DISABLED=new gr(-1,0,0);class ic{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new ic(0)}static cr(){return new ic(-1)}}const fS="LruGarbageCollector",nN=1048576;function mS([t,e],[n,r]){const i=gt(t,n);return i===0?gt(e,r):i}class rN{constructor(e){this.Ir=e,this.buffer=new jn(mS),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();mS(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class sN{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ue(fS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){_c(n)?Ue(fS,"Ignoring IndexedDB error during garbage collection: ",n):await yc(n)}await this.Vr(3e5)}))}}class iN{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return ke.resolve(nm.ce);const r=new rN(n);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Ue("LruGarbageCollector","Garbage collection skipped; disabled"),ke.resolve(hS)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Ue("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hS):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,o,l,u,h,f;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Ue("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,l=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,u=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(f=Date.now(),Fl()<=pt.DEBUG&&Ue("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-p}ms
	Determined least recently used ${i} in `+(u-l)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${g} documents in `+(f-h)+`ms
Total Duration: ${f-p}ms`),ke.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:g}))))}}function aN(t,e){return new iN(t,e)}class oN{constructor(){this.changes=new $o((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Zn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ke.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class lN{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class cN{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,n)))).next((i=>(r!==null&&Lu(r.mutation,i,Ir.empty(),Wt.now()),i)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,yt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=yt()){const i=Ro();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,r).next((o=>{let l=Du();return o.forEach(((u,h)=>{l=l.insert(u,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=Ro();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,yt())))}populateOverlays(e,n,r){const i=[];return r.forEach((o=>{n.has(o)||i.push(o)})),this.documentOverlayCache.getOverlays(e,i).next((o=>{o.forEach(((l,u)=>{n.set(l,u)}))}))}computeViews(e,n,r,i){let o=Ii();const l=zu(),u=(function(){return zu()})();return n.forEach(((h,f)=>{const p=r.get(f.key);i.has(f.key)&&(p===void 0||p.mutation instanceof qa)?o=o.insert(f.key,f):p!==void 0?(l.set(f.key,p.mutation.getFieldMask()),Lu(p.mutation,f,p.mutation.getFieldMask(),Wt.now())):l.set(f.key,Ir.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((f,p)=>l.set(f,p))),n.forEach(((f,p)=>u.set(f,new lN(p,l.get(f)??null)))),u)))}recalculateAndSaveOverlays(e,n){const r=zu();let i=new tn(((l,u)=>l-u)),o=yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const u of l)u.keys().forEach((h=>{const f=n.get(h);if(f===null)return;let p=r.get(h)||Ir.empty();p=u.applyToLocalView(f,p),r.set(h,p);const g=(i.get(u.batchId)||yt()).add(h);i=i.insert(u.batchId,g)}))})).next((()=>{const l=[],u=i.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),f=h.key,p=h.value,g=_C();p.forEach((b=>{if(!o.has(b)){const _=CC(n.get(b),r.get(b));_!==null&&g.set(b,_),o=o.add(b)}})),l.push(this.documentOverlayCache.saveOverlays(e,f,g))}return ke.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,i){return(function(l){return Qe.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):fC(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next((o=>{const l=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):ke.resolve(Ro());let u=Hu,h=o;return l.next((f=>ke.forEach(f,((p,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),o.get(p)?ke.resolve():this.remoteDocumentCache.getEntry(e,p).next((b=>{h=h.insert(p,b)}))))).next((()=>this.populateOverlays(e,f,o))).next((()=>this.computeViews(e,h,f,yt()))).next((p=>({batchId:u,changes:yC(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Qe(n)).next((r=>{let i=Du();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let l=Du();return this.indexManager.getCollectionParents(e,o).next((u=>ke.forEach(u,(h=>{const f=(function(g,b){return new ud(b,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next((p=>{p.forEach(((g,b)=>{l=l.insert(g,b)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i)))).next((l=>{o.forEach(((h,f)=>{const p=f.getKey();l.get(p)===null&&(l=l.insert(p,Zn.newInvalidDocument(p)))}));let u=Du();return l.forEach(((h,f)=>{const p=o.get(h);p!==void 0&&Lu(p.mutation,f,Ir.empty(),Wt.now()),am(n,f)&&(u=u.insert(h,f))})),u}))}}class uN{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return ke.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(i){return{id:i.id,version:i.version,createTime:qs(i.createTime)}})(n)),ke.resolve()}getNamedQuery(e,n){return ke.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(i){return{name:i.name,query:JO(i.bundledQuery),readTime:qs(i.readTime)}})(n)),ke.resolve()}}class dN{constructor(){this.overlays=new tn(Qe.comparator),this.qr=new Map}getOverlay(e,n){return ke.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Ro();return ke.forEach(n,(i=>this.getOverlay(e,i).next((o=>{o!==null&&r.set(i,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((i,o)=>{this.St(e,n,o)})),ke.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),ke.resolve()}getOverlaysForCollection(e,n,r){const i=Ro(),o=n.length+1,l=new Qe(n.child("")),u=this.overlays.getIteratorFrom(l);for(;u.hasNext();){const h=u.getNext().value,f=h.getKey();if(!n.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return ke.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new tn(((f,p)=>f-p));const l=this.overlays.getIterator();for(;l.hasNext();){const f=l.getNext().value;if(f.getKey().getCollectionGroup()===n&&f.largestBatchId>r){let p=o.get(f.largestBatchId);p===null&&(p=Ro(),o=o.insert(f.largestBatchId,p)),p.set(f.getKey(),f)}}const u=Ro(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,p)=>u.set(f,p))),!(u.size()>=i)););return ke.resolve(u)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const l=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new RO(n,r));let o=this.qr.get(n);o===void 0&&(o=yt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class hN{constructor(){this.sessionToken=Gn.EMPTY_BYTE_STRING}getSessionToken(e){return ke.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ke.resolve()}}class S_{constructor(){this.Qr=new jn(On.$r),this.Ur=new jn(On.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new On(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new On(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new Qe(new $t([])),r=new On(n,e),i=new On(n,e+1),o=[];return this.Ur.forEachInRange([r,i],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Qe(new $t([])),r=new On(n,e),i=new On(n,e+1);let o=yt();return this.Ur.forEachInRange([r,i],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new On(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class On{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Qe.comparator(e.key,n.key)||gt(e.Yr,n.Yr)}static Kr(e,n){return gt(e.Yr,n.Yr)||Qe.comparator(e.key,n.key)}}class fN{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new jn(On.$r)}checkEmpty(e){return ke.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new jO(o,n,r,i);this.mutationQueue.push(l);for(const u of i)this.Zr=this.Zr.add(new On(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return ke.resolve(l)}lookupMutationBatch(e,n){return ke.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),o=i<0?0:i;return ke.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return ke.resolve(this.mutationQueue.length===0?f_:this.tr-1)}getAllMutationBatches(e){return ke.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new On(n,0),i=new On(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],(l=>{const u=this.Xr(l.Yr);o.push(u)})),ke.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new jn(gt);return n.forEach((i=>{const o=new On(i,0),l=new On(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(u=>{r=r.add(u.Yr)}))})),ke.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;Qe.isDocumentKey(o)||(o=o.child(""));const l=new On(new Qe(o),0);let u=new jn(gt);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(u=u.add(h.Yr)),!0)}),l),ke.resolve(this.ti(u))}ti(e){const n=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&n.push(i)})),n}removeMutationBatch(e,n){jt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return ke.forEach(n.mutations,(i=>{const o=new On(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new On(n,0),i=this.Zr.firstAfterOrEqual(r);return ke.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ke.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class mN{constructor(e){this.ri=e,this.docs=(function(){return new tn(Qe.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ke.resolve(r?r.document.mutableCopy():Zn.newInvalidDocument(n))}getEntries(e,n){let r=Ii();return n.forEach((i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Zn.newInvalidDocument(i))})),ke.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=Ii();const l=n.path,u=new Qe(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:f,value:{document:p}}=h.getNext();if(!l.isPrefixOf(f.path))break;f.path.length>l.length+1||$M(VM(p),r)<=0||(i.has(p.key)||am(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return ke.resolve(o)}getAllFromCollectionGroup(e,n,r,i){Je(9500)}ii(e,n){return ke.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new pN(this)}getSize(e){return ke.resolve(this.size)}}class pN extends oN{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),ke.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class gN{constructor(e){this.persistence=e,this.si=new $o((n=>g_(n)),y_),this.lastRemoteSnapshotVersion=et.min(),this.highestTargetId=0,this.oi=0,this._i=new S_,this.targetCount=0,this.ai=ic.ur()}forEachTarget(e,n){return this.si.forEach(((r,i)=>n(i))),ke.resolve()}getLastRemoteSnapshotVersion(e){return ke.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ke.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ke.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),ke.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new ic(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,ke.resolve()}updateTargetData(e,n){return this.Pr(n),ke.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,ke.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.si.forEach(((l,u)=>{u.sequenceNumber<=n&&r.get(u.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)})),ke.waitFor(o).next((()=>i))}getTargetCount(e){return ke.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return ke.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),ke.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach((l=>{o.push(i.markPotentiallyOrphaned(e,l))})),ke.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),ke.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return ke.resolve(r)}containsKey(e,n){return ke.resolve(this._i.containsKey(n))}}class zC{constructor(e,n){this.ui={},this.overlays={},this.ci=new nm(0),this.li=!1,this.li=!0,this.hi=new hN,this.referenceDelegate=e(this),this.Pi=new gN(this),this.indexManager=new eN,this.remoteDocumentCache=(function(i){return new mN(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new ZO(n),this.Ii=new uN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new dN,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new fN(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Ue("MemoryPersistence","Starting transaction:",e);const i=new yN(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((o=>this.referenceDelegate.di(i).next((()=>o)))).toPromise().then((o=>(i.raiseOnCommittedEvent(),o)))}Ai(e,n){return ke.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class yN extends HM{constructor(e){super(),this.currentSequenceNumber=e}}class E_{constructor(e){this.persistence=e,this.Ri=new S_,this.Vi=null}static mi(e){return new E_(e)}get fi(){if(this.Vi)return this.Vi;throw Je(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),ke.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),ke.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),ke.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((i=>{i.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ke.forEach(this.fi,(r=>{const i=Qe.fromPath(r);return this.gi(e,i).next((o=>{o||n.removeEntry(i,et.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return ke.or([()=>ke.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Nf{constructor(e,n){this.persistence=e,this.pi=new $o((r=>QM(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=aN(this,n)}static mi(e,n){return new Nf(e,n)}Ei(){}di(e){return ke.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((i=>r+i))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return ke.forEach(this.pi,((r,i)=>this.br(e,r,i).next((o=>o?ke.resolve():n(i)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,(l=>this.br(e,l,n).next((u=>{u||(r++,o.removeEntry(l,et.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ke.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),ke.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),ke.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=df(e.data.value)),n}br(e,n,r){return ke.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return ke.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class C_{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=yt(),i=yt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new C_(e,n.fromCache,r,i)}}class _N{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class bN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return h2()?8:GM(Jn())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,i,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new _N;return this.Ss(e,n,l).next((u=>{if(o.result=u,this.Vs)return this.bs(e,n,l,u.size)}))})).next((()=>o.result))}bs(e,n,r,i){return r.documentReadCount<this.fs?(Fl()<=pt.DEBUG&&Ue("QueryEngine","SDK will not create cache indexes for query:",Vl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ke.resolve()):(Fl()<=pt.DEBUG&&Ue("QueryEngine","Query:",Vl(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Fl()<=pt.DEBUG&&Ue("QueryEngine","The SDK decides to create cache indexes for query:",Vl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$s(n))):ke.resolve())}ys(e,n){if(nS(n))return ke.resolve(null);let r=$s(n);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(n.limit!==null&&i===1&&(n=jy(n,null,"F"),r=$s(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=yt(...o);return this.ps.getDocuments(e,l).next((u=>this.indexManager.getMinOffset(e,r).next((h=>{const f=this.Ds(n,u);return this.Cs(n,f,l,h.readTime)?this.ys(e,jy(n,null,"F")):this.vs(e,f,n,h)}))))})))))}ws(e,n,r,i){return nS(n)||i.isEqual(et.min())?ke.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,i)?ke.resolve(null):(Fl()<=pt.DEBUG&&Ue("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Vl(n)),this.vs(e,l,n,FM(i,Hu)).next((u=>u)))}))}Ds(e,n){let r=new jn(pC(e));return n.forEach(((i,o)=>{am(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,n,r){return Fl()<=pt.DEBUG&&Ue("QueryEngine","Using full collection scan to execute query:",Vl(n)),this.ps.getDocumentsMatchingQuery(e,n,ka.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const T_="LocalStore",vN=3e8;class xN{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new tn(gt),this.xs=new $o((o=>g_(o)),y_),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function wN(t,e,n,r){return new xN(t,e,n,r)}async function LC(t,e){const n=rt(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next((o=>(i=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],u=[];let h=yt();for(const f of i){l.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}for(const f of o){u.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((f=>({Ls:f,removedBatchIds:l,addedBatchIds:u})))}))}))}function SN(t,e){const n=rt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,f,p){const g=f.batch,b=g.keys();let _=ke.resolve();return b.forEach((w=>{_=_.next((()=>p.getEntry(h,w))).next((x=>{const S=f.docVersions.get(w);jt(S!==null,48541),x.version.compareTo(S)<0&&(g.applyToRemoteDocument(x,f),x.isValidDocument()&&(x.setReadTime(f.commitVersion),p.addEntry(x)))}))})),_.next((()=>u.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=yt();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,i)))}))}function UC(t){const e=rt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function EN(t,e){const n=rt(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const u=[];e.targetChanges.forEach(((p,g)=>{const b=i.get(g);if(!b)return;u.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let _=b.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?_=_.withResumeToken(Gn.EMPTY_BYTE_STRING,et.min()).withLastLimboFreeSnapshotVersion(et.min()):p.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(p.resumeToken,r)),i=i.insert(g,_),(function(x,S,C){return x.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=vN?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(b,_,p)&&u.push(n.Pi.updateTargetData(o,_))}));let h=Ii(),f=yt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),u.push(CN(o,l,e.documentUpdates).next((p=>{h=p.ks,f=p.qs}))),!r.isEqual(et.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));u.push(p)}return ke.waitFor(u).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,f))).next((()=>h))})).then((o=>(n.Ms=i,o)))}function CN(t,e,n){let r=yt(),i=yt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=Ii();return n.forEach(((u,h)=>{const f=o.get(u);h.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(u)),h.isNoDocument()&&h.version.isEqual(et.min())?(e.removeEntry(u,h.readTime),l=l.insert(u,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),l=l.insert(u,h)):Ue(T_,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",h.version)})),{ks:l,qs:i}}))}function TN(t,e){const n=rt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=f_),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function AN(t,e){const n=rt(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return n.Pi.getTargetData(r,e).next((o=>o?(i=o,ke.resolve(i)):n.Pi.allocateTargetId(r).next((l=>(i=new xa(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=n.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function My(t,e,n){const r=rt(t),i=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!_c(l))throw l;Ue(T_,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function pS(t,e,n){const r=rt(t);let i=et.min(),o=yt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,f,p){const g=rt(h),b=g.xs.get(p);return b!==void 0?ke.resolve(g.Ms.get(b)):g.Pi.getTargetData(f,p)})(r,l,$s(e)).next((u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,u.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?i:et.min(),n?o:yt()))).next((u=>(jN(r,fO(e),u),{documents:u,Qs:o})))))}function jN(t,e,n){let r=t.Os.get(e)||et.min();n.forEach(((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class gS{constructor(){this.activeTargetIds=bO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class RN{constructor(){this.Mo=new gS,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new gS,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class IN{Oo(e){}shutdown(){}}const yS="ConnectivityMonitor";class _S{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ue(yS,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ue(yS,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let ef=null;function Oy(){return ef===null?ef=(function(){return 268435456+Math.round(2147483648*Math.random())})():ef++,"0x"+ef.toString(16)}const Gg="RestConnection",DN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class kN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===jf?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,o){const l=Oy(),u=this.zo(e,n.toUriEncodedString());Ue(Gg,`Sending RPC '${e}' ${l}:`,u,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);const{host:f}=new URL(u),p=dc(f);return this.Jo(e,u,h,r,p).then((g=>(Ue(Gg,`Received RPC '${e}' ${l}: `,g),g)),(g=>{throw Jl(Gg,`RPC '${e}' ${l} failed with error: `,g,"url: ",u,"request:",r),g}))}Ho(e,n,r,i,o,l){return this.Go(e,n,r,i,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+gc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((i,o)=>e[o]=i)),r&&r.headers.forEach(((i,o)=>e[o]=i))}zo(e,n){const r=DN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class MN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Yn="WebChannelConnection";class ON extends kN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,o){const l=Oy();return new Promise(((u,h)=>{const f=new VE;f.setWithCredentials(!0),f.listenOnce($E.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case uf.NO_ERROR:const g=f.getResponseJson();Ue(Yn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),u(g);break;case uf.TIMEOUT:Ue(Yn,`RPC '${e}' ${l} timed out`),h(new Le(Ie.DEADLINE_EXCEEDED,"Request time out"));break;case uf.HTTP_ERROR:const b=f.getStatus();if(Ue(Yn,`RPC '${e}' ${l} failed with status:`,b,"response text:",f.getResponseText()),b>0){let _=f.getResponseJson();Array.isArray(_)&&(_=_[0]);const w=_?.error;if(w&&w.status&&w.message){const x=(function(C){const T=C.toLowerCase().replace(/_/g,"-");return Object.values(Ie).indexOf(T)>=0?T:Ie.UNKNOWN})(w.status);h(new Le(x,w.message))}else h(new Le(Ie.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new Le(Ie.UNAVAILABLE,"Connection failed."));break;default:Je(9055,{l_:e,streamId:l,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{Ue(Yn,`RPC '${e}' ${l} completed.`)}}));const p=JSON.stringify(i);Ue(Yn,`RPC '${e}' ${l} sending request:`,i),f.send(n,"POST",p,r,15)}))}T_(e,n,r){const i=Oy(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=GE(),u=HE(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");Ue(Yn,`Creating RPC '${e}' stream ${i}: ${p}`,h);const g=l.createWebChannel(p,h);this.I_(g);let b=!1,_=!1;const w=new MN({Yo:S=>{_?Ue(Yn,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(b||(Ue(Yn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),b=!0),Ue(Yn,`RPC '${e}' stream ${i} sending:`,S),g.send(S))},Zo:()=>g.close()}),x=(S,C,T)=>{S.listen(C,(I=>{try{T(I)}catch(M){setTimeout((()=>{throw M}),0)}}))};return x(g,Iu.EventType.OPEN,(()=>{_||(Ue(Yn,`RPC '${e}' stream ${i} transport opened.`),w.o_())})),x(g,Iu.EventType.CLOSE,(()=>{_||(_=!0,Ue(Yn,`RPC '${e}' stream ${i} transport closed`),w.a_(),this.E_(g))})),x(g,Iu.EventType.ERROR,(S=>{_||(_=!0,Jl(Yn,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),w.a_(new Le(Ie.UNAVAILABLE,"The operation could not be completed")))})),x(g,Iu.EventType.MESSAGE,(S=>{if(!_){const C=S.data[0];jt(!!C,16349);const T=C,I=T?.error||T[0]?.error;if(I){Ue(Yn,`RPC '${e}' stream ${i} received error:`,I);const M=I.status;let F=(function(O){const P=vn[O];if(P!==void 0)return AC(P)})(M),G=I.message;F===void 0&&(F=Ie.INTERNAL,G="Unknown error status: "+M+" with message "+I.message),_=!0,w.a_(new Le(F,G)),g.close()}else Ue(Yn,`RPC '${e}' stream ${i} received:`,C),w.u_(C)}})),x(u,qE.STAT_EVENT,(S=>{S.stat===xy.PROXY?Ue(Yn,`RPC '${e}' stream ${i} detected buffering proxy`):S.stat===xy.NOPROXY&&Ue(Yn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{w.__()}),0),w}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function Wg(){return typeof document<"u"?document:null}function dm(t){return new zO(t,!0)}class FC{constructor(e,n,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&Ue("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const bS="PersistentStream";class VC{constructor(e,n,r,i,o,l,u,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new FC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===Ie.RESOURCE_EXHAUSTED?(Ri(n.toString()),Ri("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===Ie.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===n&&this.G_(r,i)}),(r=>{e((()=>{const i=new Le(Ie.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ue(bS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Ue(bS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class NN extends VC{constructor(e,n,r,i,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=FO(this.serializer,e),r=(function(o){if(!("targetChange"in o))return et.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?et.min():l.readTime?qs(l.readTime):et.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=ky(this.serializer),n.addTarget=(function(o,l){let u;const h=l.target;if(u=Ty(h)?{documents:qO(o,h)}:{query:HO(o,h).ft},u.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){u.resumeToken=IC(o,l.resumeToken);const f=Ry(o,l.expectedCount);f!==null&&(u.expectedCount=f)}else if(l.snapshotVersion.compareTo(et.min())>0){u.readTime=Of(o,l.snapshotVersion.toTimestamp());const f=Ry(o,l.expectedCount);f!==null&&(u.expectedCount=f)}return u})(this.serializer,e);const r=WO(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=ky(this.serializer),n.removeTarget=e,this.q_(n)}}class PN extends VC{constructor(e,n,r,i,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return jt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,jt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){jt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=$O(e.writeResults,e.commitTime),r=qs(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=ky(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>VO(this.serializer,r)))};this.q_(n)}}class BN{}class zN extends BN{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Le(Ie.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,Iy(n,r),i,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===Ie.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Le(Ie.UNKNOWN,o.toString())}))}Ho(e,n,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,u])=>this.connection.Ho(e,Iy(n,r),i,l,u,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===Ie.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Le(Ie.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class LN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ri(n),this.aa=!1):Ue("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const zo="RemoteStore";class UN{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{qo(this)&&(Ue(zo,"Restarting streams for network reachability change."),await(async function(h){const f=rt(h);f.Ea.add(4),await fd(f),f.Ra.set("Unknown"),f.Ea.delete(4),await hm(f)})(this))}))})),this.Ra=new LN(r,i)}}async function hm(t){if(qo(t))for(const e of t.da)await e(!0)}async function fd(t){for(const e of t.da)await e(!1)}function $C(t,e){const n=rt(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),I_(n)?R_(n):bc(n).O_()&&j_(n,e))}function A_(t,e){const n=rt(t),r=bc(n);n.Ia.delete(e),r.O_()&&qC(n,e),n.Ia.size===0&&(r.O_()?r.L_():qo(n)&&n.Ra.set("Unknown"))}function j_(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(et.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}bc(t).Y_(e)}function qC(t,e){t.Va.Ue(e),bc(t).Z_(e)}function R_(t){t.Va=new OO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),bc(t).start(),t.Ra.ua()}function I_(t){return qo(t)&&!bc(t).x_()&&t.Ia.size>0}function qo(t){return rt(t).Ea.size===0}function HC(t){t.Va=void 0}async function FN(t){t.Ra.set("Online")}async function VN(t){t.Ia.forEach(((e,n)=>{j_(t,e)}))}async function $N(t,e){HC(t),I_(t)?(t.Ra.ha(e),R_(t)):t.Ra.set("Unknown")}async function qN(t,e,n){if(t.Ra.set("Online"),e instanceof RC&&e.state===2&&e.cause)try{await(async function(i,o){const l=o.cause;for(const u of o.targetIds)i.Ia.has(u)&&(await i.remoteSyncer.rejectListen(u,l),i.Ia.delete(u),i.Va.removeTarget(u))})(t,e)}catch(r){Ue(zo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Pf(t,r)}else if(e instanceof mf?t.Va.Ze(e):e instanceof jC?t.Va.st(e):t.Va.tt(e),!n.isEqual(et.min()))try{const r=await UC(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const u=o.Va.Tt(l);return u.targetChanges.forEach(((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(f);p&&o.Ia.set(f,p.withResumeToken(h.resumeToken,l))}})),u.targetMismatches.forEach(((h,f)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Gn.EMPTY_BYTE_STRING,p.snapshotVersion)),qC(o,h);const g=new xa(p.target,h,f,p.sequenceNumber);j_(o,g)})),o.remoteSyncer.applyRemoteEvent(u)})(t,n)}catch(r){Ue(zo,"Failed to raise snapshot:",r),await Pf(t,r)}}async function Pf(t,e,n){if(!_c(e))throw e;t.Ea.add(1),await fd(t),t.Ra.set("Offline"),n||(n=()=>UC(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ue(zo,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await hm(t)}))}function GC(t,e){return e().catch((n=>Pf(t,n,e)))}async function fm(t){const e=rt(t),n=Pa(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:f_;for(;HN(e);)try{const i=await TN(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,GN(e,i)}catch(i){await Pf(e,i)}WC(e)&&QC(e)}function HN(t){return qo(t)&&t.Ta.length<10}function GN(t,e){t.Ta.push(e);const n=Pa(t);n.O_()&&n.X_&&n.ea(e.mutations)}function WC(t){return qo(t)&&!Pa(t).x_()&&t.Ta.length>0}function QC(t){Pa(t).start()}async function WN(t){Pa(t).ra()}async function QN(t){const e=Pa(t);for(const n of t.Ta)e.ea(n.mutations)}async function KN(t,e,n){const r=t.Ta.shift(),i=v_.from(r,e,n);await GC(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await fm(t)}async function YN(t,e){e&&Pa(t).X_&&await(async function(r,i){if((function(l){return DO(l)&&l!==Ie.ABORTED})(i.code)){const o=r.Ta.shift();Pa(r).B_(),await GC(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i))),await fm(r)}})(t,e),WC(t)&&QC(t)}async function vS(t,e){const n=rt(t);n.asyncQueue.verifyOperationInProgress(),Ue(zo,"RemoteStore received new credentials");const r=qo(n);n.Ea.add(3),await fd(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await hm(n)}async function XN(t,e){const n=rt(t);e?(n.Ea.delete(2),await hm(n)):e||(n.Ea.add(2),await fd(n),n.Ra.set("Unknown"))}function bc(t){return t.ma||(t.ma=(function(n,r,i){const o=rt(n);return o.sa(),new NN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:FN.bind(null,t),t_:VN.bind(null,t),r_:$N.bind(null,t),H_:qN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),I_(t)?R_(t):t.Ra.set("Unknown")):(await t.ma.stop(),HC(t))}))),t.ma}function Pa(t){return t.fa||(t.fa=(function(n,r,i){const o=rt(n);return o.sa(),new PN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:WN.bind(null,t),r_:YN.bind(null,t),ta:QN.bind(null,t),na:KN.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await fm(t)):(await t.fa.stop(),t.Ta.length>0&&(Ue(zo,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class D_{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new Ei,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const l=Date.now()+r,u=new D_(e,n,l,i,o);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Le(Ie.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function k_(t,e){if(Ri("AsyncQueue",`${e}: ${t}`),_c(t))return new Le(Ie.UNAVAILABLE,`${e}: ${t}`);throw t}class Kl{static emptySet(e){return new Kl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Qe.comparator(n.key,r.key):(n,r)=>Qe.comparator(n.key,r.key),this.keyedMap=Du(),this.sortedSet=new tn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Kl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Kl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class xS{constructor(){this.ga=new tn(Qe.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Je(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class ac{constructor(e,n,r,i,o,l,u,h,f){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,n,r,i,o){const l=[];return n.forEach((u=>{l.push({type:0,doc:u})})),new ac(e,n,Kl.emptySet(n),l,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&im(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}class ZN{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class JN{constructor(){this.queries=wS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=rt(n),o=i.queries;i.queries=wS(),o.forEach(((l,u)=>{for(const h of u.Sa)h.onError(r)}))})(this,new Le(Ie.ABORTED,"Firestore shutting down"))}}function wS(){return new $o((t=>mC(t)),im)}async function KC(t,e){const n=rt(t);let r=3;const i=e.query;let o=n.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new ZN,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(i,!0);break;case 1:o.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(l){const u=k_(l,`Initialization of query '${Vl(e.query)}' failed`);return void e.onError(u)}n.queries.set(i,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&M_(n)}async function YC(t,e){const n=rt(t),r=e.query;let i=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function e6(t,e){const n=rt(t);let r=!1;for(const i of e){const o=i.query,l=n.queries.get(o);if(l){for(const u of l.Sa)u.Fa(i)&&(r=!0);l.wa=i}}r&&M_(n)}function t6(t,e,n){const r=rt(t),i=r.queries.get(e);if(i)for(const o of i.Sa)o.onError(n);r.queries.delete(e)}function M_(t){t.Ca.forEach((e=>{e.next()}))}var Ny,SS;(SS=Ny||(Ny={})).Ma="default",SS.Cache="cache";class XC{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new ac(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=ac.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ny.Cache}}class ZC{constructor(e){this.key=e}}class JC{constructor(e){this.key=e}}class n6{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=yt(),this.mutatedKeys=yt(),this.eu=pC(e),this.tu=new Kl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new xS,i=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=i,u=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((p,g)=>{const b=i.get(p),_=am(this.query,g)?g:null,w=!!b&&this.mutatedKeys.has(b.key),x=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let S=!1;b&&_?b.data.isEqual(_.data)?w!==x&&(r.track({type:3,doc:_}),S=!0):this.su(b,_)||(r.track({type:2,doc:_}),S=!0,(h&&this.eu(_,h)>0||f&&this.eu(_,f)<0)&&(u=!0)):!b&&_?(r.track({type:0,doc:_}),S=!0):b&&!_&&(r.track({type:1,doc:b}),S=!0,(h||f)&&(u=!0)),S&&(_?(l=l.add(_),o=x?o.add(p):o.delete(p)):(l=l.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const p=this.query.limitType==="F"?l.last():l.first();l=l.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:l,iu:r,Cs:u,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((p,g)=>(function(_,w){const x=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Je(20277,{Rt:S})}};return x(_)-x(w)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),i=i??!1;const u=n&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,f=h!==this.Za;return this.Za=h,l.length!==0||f?{snapshot:new ac(this.query,e.tu,o,l,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new xS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=yt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new JC(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new ZC(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=yt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return ac.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const O_="SyncEngine";class r6{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class s6{constructor(e){this.key=e,this.hu=!1}}class i6{constructor(e,n,r,i,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new $o((u=>mC(u)),im),this.Iu=new Map,this.Eu=new Set,this.du=new tn(Qe.comparator),this.Au=new Map,this.Ru=new S_,this.Vu={},this.mu=new Map,this.fu=ic.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function a6(t,e,n=!0){const r=iT(t);let i;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await eT(r,e,n,!0),i}async function o6(t,e){const n=iT(t);await eT(n,e,!0,!1)}async function eT(t,e,n,r){const i=await AN(t.localStore,$s(e)),o=i.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let u;return r&&(u=await l6(t,e,o,l==="current",i.resumeToken)),t.isPrimaryClient&&n&&$C(t.remoteStore,i),u}async function l6(t,e,n,r,i){t.pu=(g,b,_)=>(async function(x,S,C,T){let I=S.view.ru(C);I.Cs&&(I=await pS(x.localStore,S.query,!1).then((({documents:D})=>S.view.ru(D,I))));const M=T&&T.targetChanges.get(S.targetId),F=T&&T.targetMismatches.get(S.targetId)!=null,G=S.view.applyChanges(I,x.isPrimaryClient,M,F);return CS(x,S.targetId,G.au),G.snapshot})(t,g,b,_);const o=await pS(t.localStore,e,!0),l=new n6(e,o.Qs),u=l.ru(o.documents),h=hd.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),f=l.applyChanges(u,t.isPrimaryClient,h);CS(t,n,f.au);const p=new r6(e,n,l);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),f.snapshot}async function c6(t,e,n){const r=rt(t),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter((l=>!im(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await My(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&A_(r.remoteStore,i.targetId),Py(r,i.targetId)})).catch(yc)):(Py(r,i.targetId),await My(r.localStore,i.targetId,!0))}async function u6(t,e){const n=rt(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),A_(n.remoteStore,r.targetId))}async function d6(t,e,n){const r=_6(t);try{const i=await(function(l,u){const h=rt(l),f=Wt.now(),p=u.reduce(((_,w)=>_.add(w.key)),yt());let g,b;return h.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let w=Ii(),x=yt();return h.Ns.getEntries(_,p).next((S=>{w=S,w.forEach(((C,T)=>{T.isValidDocument()||(x=x.add(C))}))})).next((()=>h.localDocuments.getOverlayedDocuments(_,w))).next((S=>{g=S;const C=[];for(const T of u){const I=TO(T,g.get(T.key).overlayedDocument);I!=null&&C.push(new qa(T.key,I,aC(I.value.mapValue),br.exists(!0)))}return h.mutationQueue.addMutationBatch(_,f,C,u)})).next((S=>{b=S;const C=S.applyToLocalDocumentSet(g,x);return h.documentOverlayCache.saveOverlays(_,S.batchId,C)}))})).then((()=>({batchId:b.batchId,changes:yC(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(l,u,h){let f=l.Vu[l.currentUser.toKey()];f||(f=new tn(gt)),f=f.insert(u,h),l.Vu[l.currentUser.toKey()]=f})(r,i.batchId,n),await md(r,i.changes),await fm(r.remoteStore)}catch(i){const o=k_(i,"Failed to persist write");n.reject(o)}}async function tT(t,e){const n=rt(t);try{const r=await EN(n.localStore,e);e.targetChanges.forEach(((i,o)=>{const l=n.Au.get(o);l&&(jt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?l.hu=!0:i.modifiedDocuments.size>0?jt(l.hu,14607):i.removedDocuments.size>0&&(jt(l.hu,42227),l.hu=!1))})),await md(n,r,e)}catch(r){await yc(r)}}function ES(t,e,n){const r=rt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach(((o,l)=>{const u=l.view.va(e);u.snapshot&&i.push(u.snapshot)})),(function(l,u){const h=rt(l);h.onlineState=u;let f=!1;h.queries.forEach(((p,g)=>{for(const b of g.Sa)b.va(u)&&(f=!0)})),f&&M_(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function h6(t,e,n){const r=rt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),o=i&&i.key;if(o){let l=new tn(Qe.comparator);l=l.insert(o,Zn.newNoDocument(o,et.min()));const u=yt().add(o),h=new um(et.min(),new Map,new tn(gt),l,u);await tT(r,h),r.du=r.du.remove(o),r.Au.delete(e),N_(r)}else await My(r.localStore,e,!1).then((()=>Py(r,e,n))).catch(yc)}async function f6(t,e){const n=rt(t),r=e.batch.batchId;try{const i=await SN(n.localStore,e);rT(n,r,null),nT(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await md(n,i)}catch(i){await yc(i)}}async function m6(t,e,n){const r=rt(t);try{const i=await(function(l,u){const h=rt(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let p;return h.mutationQueue.lookupMutationBatch(f,u).next((g=>(jt(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(f,g)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,p,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,p))).next((()=>h.localDocuments.getDocuments(f,p)))}))})(r.localStore,e);rT(r,e,n),nT(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await md(r,i)}catch(i){await yc(i)}}function nT(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function rT(t,e,n){const r=rt(t);let i=r.Vu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Py(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||sT(t,r)}))}function sT(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(A_(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),N_(t))}function CS(t,e,n){for(const r of n)r instanceof ZC?(t.Ru.addReference(r.key,e),p6(t,r)):r instanceof JC?(Ue(O_,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||sT(t,r.key)):Je(19791,{wu:r})}function p6(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Ue(O_,"New document in limbo: "+n),t.Eu.add(r),N_(t))}function N_(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Qe($t.fromString(e)),r=t.fu.next();t.Au.set(r,new s6(n)),t.du=t.du.insert(n,r),$C(t.remoteStore,new xa($s(__(n.path)),r,"TargetPurposeLimboResolution",nm.ce))}}async function md(t,e,n){const r=rt(t),i=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,h)=>{l.push(r.pu(h,e,n).then((f=>{if((f||n)&&r.isPrimaryClient){const p=f?!f.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(f){i.push(f);const p=C_.As(h.targetId,f);o.push(p)}})))})),await Promise.all(l),r.Pu.H_(i),await(async function(h,f){const p=rt(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>ke.forEach(f,(b=>ke.forEach(b.Es,(_=>p.persistence.referenceDelegate.addReference(g,b.targetId,_))).next((()=>ke.forEach(b.ds,(_=>p.persistence.referenceDelegate.removeReference(g,b.targetId,_)))))))))}catch(g){if(!_c(g))throw g;Ue(T_,"Failed to update sequence numbers: "+g)}for(const g of f){const b=g.targetId;if(!g.fromCache){const _=p.Ms.get(b),w=_.snapshotVersion,x=_.withLastLimboFreeSnapshotVersion(w);p.Ms=p.Ms.insert(b,x)}}})(r.localStore,o))}async function g6(t,e){const n=rt(t);if(!n.currentUser.isEqual(e)){Ue(O_,"User change. New user:",e.toKey());const r=await LC(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new Le(Ie.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await md(n,r.Ls)}}function y6(t,e){const n=rt(t),r=n.Au.get(e);if(r&&r.hu)return yt().add(r.key);{let i=yt();const o=n.Iu.get(e);if(!o)return i;for(const l of o){const u=n.Tu.get(l);i=i.unionWith(u.view.nu)}return i}}function iT(t){const e=rt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=tT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=y6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=h6.bind(null,e),e.Pu.H_=e6.bind(null,e.eventManager),e.Pu.yu=t6.bind(null,e.eventManager),e}function _6(t){const e=rt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=f6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=m6.bind(null,e),e}class Bf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=dm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return wN(this.persistence,new bN,e.initialUser,this.serializer)}Cu(e){return new zC(E_.mi,this.serializer)}Du(e){return new RN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Bf.provider={build:()=>new Bf};class b6 extends Bf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){jt(this.persistence.referenceDelegate instanceof Nf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new sN(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?gr.withCacheSize(this.cacheSizeBytes):gr.DEFAULT;return new zC((r=>Nf.mi(r,n)),this.serializer)}}class By{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>ES(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=g6.bind(null,this.syncEngine),await XN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new JN})()}createDatastore(e){const n=dm(e.databaseInfo.databaseId),r=(function(o){return new ON(o)})(e.databaseInfo);return(function(o,l,u,h){return new zN(o,l,u,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,i,o,l,u){return new UN(r,i,o,l,u)})(this.localStore,this.datastore,e.asyncQueue,(n=>ES(this.syncEngine,n,0)),(function(){return _S.v()?new _S:new IN})())}createSyncEngine(e,n){return(function(i,o,l,u,h,f,p){const g=new i6(i,o,l,u,h,f);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=rt(n);Ue(zo,"RemoteStore shutting down."),r.Ea.add(5),await fd(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}By.provider={build:()=>new By};class aT{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ri("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const Ba="FirestoreClient";class v6{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Xn.UNAUTHENTICATED,this.clientId=h_.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{Ue(Ba,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(Ue(Ba,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ei;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=k_(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Qg(t,e){t.asyncQueue.verifyOperationInProgress(),Ue(Ba,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async i=>{r.isEqual(i)||(await LC(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function TS(t,e){t.asyncQueue.verifyOperationInProgress();const n=await x6(t);Ue(Ba,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>vS(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,i)=>vS(e.remoteStore,i))),t._onlineComponents=e}async function x6(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ue(Ba,"Using user provided OfflineComponentProvider");try{await Qg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(i){return i.name==="FirebaseError"?i.code===Ie.FAILED_PRECONDITION||i.code===Ie.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(n))throw n;Jl("Error using user provided cache. Falling back to memory cache: "+n),await Qg(t,new Bf)}}else Ue(Ba,"Using default OfflineComponentProvider"),await Qg(t,new b6(void 0));return t._offlineComponents}async function oT(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ue(Ba,"Using user provided OnlineComponentProvider"),await TS(t,t._uninitializedComponentsProvider._online)):(Ue(Ba,"Using default OnlineComponentProvider"),await TS(t,new By))),t._onlineComponents}function w6(t){return oT(t).then((e=>e.syncEngine))}async function lT(t){const e=await oT(t),n=e.eventManager;return n.onListen=a6.bind(null,e.syncEngine),n.onUnlisten=c6.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=o6.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=u6.bind(null,e.syncEngine),n}function S6(t,e,n={}){const r=new Ei;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,u,h,f){const p=new aT({next:b=>{p.Nu(),l.enqueueAndForget((()=>YC(o,g)));const _=b.docs.has(u);!_&&b.fromCache?f.reject(new Le(Ie.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&b.fromCache&&h&&h.source==="server"?f.reject(new Le(Ie.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(b)},error:b=>f.reject(b)}),g=new XC(__(u.path),p,{includeMetadataChanges:!0,qa:!0});return KC(o,g)})(await lT(t),t.asyncQueue,e,n,r))),r.promise}function E6(t,e,n={}){const r=new Ei;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,u,h,f){const p=new aT({next:b=>{p.Nu(),l.enqueueAndForget((()=>YC(o,g))),b.fromCache&&h.source==="server"?f.reject(new Le(Ie.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(b)},error:b=>f.reject(b)}),g=new XC(u,p,{includeMetadataChanges:!0,qa:!0});return KC(o,g)})(await lT(t),t.asyncQueue,e,n,r))),r.promise}function cT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const AS=new Map;const uT="firestore.googleapis.com",jS=!0;class RS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Le(Ie.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=uT,this.ssl=jS}else this.host=e.host,this.ssl=e.ssl??jS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=BC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<nN)throw new Le(Ie.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}UM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=cT(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Le(Ie.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Le(Ie.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Le(Ie.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class mm{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new RS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Le(Ie.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Le(Ie.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new RS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new IM;switch(r.type){case"firstParty":return new OM(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Le(Ie.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=AS.get(n);r&&(Ue("ComponentProvider","Removing Datastore"),AS.delete(n),r.terminate())})(this),Promise.resolve()}}function C6(t,e,n,r={}){t=ms(t,mm);const i=dc(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},u=`${e}:${n}`;i&&(V1(`https://${u}`),$1("Firestore",!0)),o.host!==uT&&o.host!==u&&Jl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:i,emulatorOptions:r};if(!Ti(h,l)&&(t._setSettings(h),r.mockUserToken)){let f,p;if(typeof r.mockUserToken=="string")f=r.mockUserToken,p=Xn.MOCK_USER;else{f=r2(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Le(Ie.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Xn(g)}t._authCredentials=new DM(new QE(f,p))}}class vc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new vc(this.firestore,e,this._query)}}class un{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Da(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new un(this.firestore,e,this._key)}toJSON(){return{type:un._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(cd(n,un._jsonSchema))return new un(e,r||null,new Qe($t.fromString(n.referencePath)))}}un._jsonSchemaVersion="firestore/documentReference/1.0",un._jsonSchema={type:wn("string",un._jsonSchemaVersion),referencePath:wn("string")};class Da extends vc{constructor(e,n,r){super(e,n,__(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new un(this.firestore,null,new Qe(e))}withConverter(e){return new Da(this.firestore,e,this._path)}}function T6(t,e,...n){if(t=Sn(t),KE("collection","path",e),t instanceof mm){const r=$t.fromString(e,...n);return Vw(r),new Da(t,null,r)}{if(!(t instanceof un||t instanceof Da))throw new Le(Ie.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child($t.fromString(e,...n));return Vw(r),new Da(t.firestore,null,r)}}function xc(t,e,...n){if(t=Sn(t),arguments.length===1&&(e=h_.newId()),KE("doc","path",e),t instanceof mm){const r=$t.fromString(e,...n);return Fw(r),new un(t,null,new Qe(r))}{if(!(t instanceof un||t instanceof Da))throw new Le(Ie.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child($t.fromString(e,...n));return Fw(r),new un(t.firestore,t instanceof Da?t.converter:null,new Qe(r))}}const IS="AsyncQueue";class DS{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new FC(this,"async_queue_retry"),this._c=()=>{const r=Wg();r&&Ue(IS,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Wg();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Wg();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new Ei;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!_c(e))throw e;Ue(IS,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Ri("INTERNAL UNHANDLED ERROR: ",kS(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=D_.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(i),i}uc(){this.nc&&Je(47125,{Pc:kS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function kS(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Ho extends mm{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new DS,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new DS(e),this._firestoreClient=void 0,await e}}}function A6(t,e){const n=typeof t=="object"?t:W1(),r=typeof t=="string"?t:jf,i=Zy(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=t2("firestore");o&&C6(i,...o)}return i}function pm(t){if(t._terminated)throw new Le(Ie.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||j6(t),t._firestoreClient}function j6(t){const e=t._freezeSettings(),n=(function(i,o,l,u){return new XM(i,o,l,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,cT(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new v6(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(i){const o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(t._componentsProvider))}class Kr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Kr(Gn.fromBase64String(e))}catch(n){throw new Le(Ie.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Kr(Gn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Kr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(cd(e,Kr._jsonSchema))return Kr.fromBase64String(e.bytes)}}Kr._jsonSchemaVersion="firestore/bytes/1.0",Kr._jsonSchema={type:wn("string",Kr._jsonSchemaVersion),bytes:wn("string")};class pd{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Le(Ie.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $n(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class gd{constructor(e){this._methodName=e}}class Hs{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Le(Ie.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Le(Ie.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return gt(this._lat,e._lat)||gt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Hs._jsonSchemaVersion}}static fromJSON(e){if(cd(e,Hs._jsonSchema))return new Hs(e.latitude,e.longitude)}}Hs._jsonSchemaVersion="firestore/geoPoint/1.0",Hs._jsonSchema={type:wn("string",Hs._jsonSchemaVersion),latitude:wn("number"),longitude:wn("number")};class Gs{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Gs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(cd(e,Gs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Gs(e.vectorValues);throw new Le(Ie.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Gs._jsonSchemaVersion="firestore/vectorValue/1.0",Gs._jsonSchema={type:wn("string",Gs._jsonSchemaVersion),vectorValues:wn("object")};const R6=/^__.*__$/;class I6{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new qa(e,this.data,this.fieldMask,n,this.fieldTransforms):new dd(e,this.data,n,this.fieldTransforms)}}class dT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new qa(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function hT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Je(40011,{Ac:t})}}class gm{constructor(e,n,r,i,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new gm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return zf(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(hT(this.Ac)&&R6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class D6{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||dm(e)}Cc(e,n,r,i=!1){return new gm({Ac:e,methodName:n,Dc:r,path:$n.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ym(t){const e=t._freezeSettings(),n=dm(t._databaseId);return new D6(t._databaseId,!!e.ignoreUndefinedProperties,n)}function fT(t,e,n,r,i,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,i);z_("Data must be an object, but it was:",l,r);const u=yT(r,l);let h,f;if(o.merge)h=new Ir(l.fieldMask),f=l.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const b=zy(e,g,n);if(!l.contains(b))throw new Le(Ie.INVALID_ARGUMENT,`Field '${b}' is specified in your field mask but missing from your input data.`);bT(p,b)||p.push(b)}h=new Ir(p),f=l.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,f=l.fieldTransforms;return new I6(new yr(u),h,f)}class yd extends gd{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof yd}}function mT(t,e,n){return new gm({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class P_ extends gd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=mT(this,e,!0),r=this.vc.map((o=>Go(o,n))),i=new rc(r);return new EC(e.path,i)}isEqual(e){return e instanceof P_&&Ti(this.vc,e.vc)}}class B_ extends gd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=mT(this,e,!0),r=this.vc.map((o=>Go(o,n))),i=new sc(r);return new EC(e.path,i)}isEqual(e){return e instanceof B_&&Ti(this.vc,e.vc)}}function pT(t,e,n,r){const i=t.Cc(1,e,n);z_("Data must be an object, but it was:",i,r);const o=[],l=yr.empty();$a(r,((h,f)=>{const p=L_(e,h,n);f=Sn(f);const g=i.yc(p);if(f instanceof yd)o.push(p);else{const b=Go(f,g);b!=null&&(o.push(p),l.set(p,b))}}));const u=new Ir(o);return new dT(l,u,i.fieldTransforms)}function gT(t,e,n,r,i,o){const l=t.Cc(1,e,n),u=[zy(e,r,n)],h=[i];if(o.length%2!=0)throw new Le(Ie.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let b=0;b<o.length;b+=2)u.push(zy(e,o[b])),h.push(o[b+1]);const f=[],p=yr.empty();for(let b=u.length-1;b>=0;--b)if(!bT(f,u[b])){const _=u[b];let w=h[b];w=Sn(w);const x=l.yc(_);if(w instanceof yd)f.push(_);else{const S=Go(w,x);S!=null&&(f.push(_),p.set(_,S))}}const g=new Ir(f);return new dT(p,g,l.fieldTransforms)}function k6(t,e,n,r=!1){return Go(n,t.Cc(r?4:3,e))}function Go(t,e){if(_T(t=Sn(t)))return z_("Unsupported field value:",e,t),yT(t,e);if(t instanceof gd)return(function(r,i){if(!hT(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const o=[];let l=0;for(const u of r){let h=Go(u,i.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,i){if((r=Sn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return vO(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Wt.fromDate(r);return{timestampValue:Of(i.serializer,o)}}if(r instanceof Wt){const o=new Wt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Of(i.serializer,o)}}if(r instanceof Hs)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Kr)return{bytesValue:IC(i.serializer,r._byteString)};if(r instanceof un){const o=i.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw i.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:w_(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Gs)return(function(l,u){return{mapValue:{fields:{[sC]:{stringValue:iC},[Rf]:{arrayValue:{values:l.toArray().map((f=>{if(typeof f!="number")throw u.Sc("VectorValues must only contain numeric values.");return b_(u.serializer,f)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${tm(r)}`)})(t,e)}function yT(t,e){const n={};return ZE(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):$a(t,((r,i)=>{const o=Go(i,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function _T(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Wt||t instanceof Hs||t instanceof Kr||t instanceof un||t instanceof gd||t instanceof Gs)}function z_(t,e,n){if(!_T(n)||!YE(n)){const r=tm(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function zy(t,e,n){if((e=Sn(e))instanceof pd)return e._internalPath;if(typeof e=="string")return L_(t,e);throw zf("Field path arguments must be of type string or ",t,!1,void 0,n)}const M6=new RegExp("[~\\*/\\[\\]]");function L_(t,e,n){if(e.search(M6)>=0)throw zf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new pd(...e.split("."))._internalPath}catch{throw zf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function zf(t,e,n,r,i){const o=r&&!r.isEmpty(),l=i!==void 0;let u=`Function ${e}() called with invalid data`;n&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${i}`),h+=")"),new Le(Ie.INVALID_ARGUMENT,u+t+h)}function bT(t,e){return t.some((n=>n.isEqual(e)))}class vT{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new un(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new O6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(U_("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class O6 extends vT{data(){return super.data()}}function U_(t,e){return typeof e=="string"?L_(t,e):e instanceof pd?e._internalPath:e._delegate._internalPath}function N6(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Le(Ie.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class F_{}class P6 extends F_{}function B6(t,e,...n){let r=[];e instanceof F_&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof V_)).length,u=o.filter((h=>h instanceof _m)).length;if(l>1||l>0&&u>0)throw new Le(Ie.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)t=i._apply(t);return t}class _m extends P6{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new _m(e,n,r)}_apply(e){const n=this._parse(e);return xT(e._query,n),new vc(e.firestore,e.converter,Ay(e._query,n))}_parse(e){const n=ym(e.firestore);return(function(o,l,u,h,f,p,g){let b;if(f.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Le(Ie.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){OS(g,p);const w=[];for(const x of g)w.push(MS(h,o,x));b={arrayValue:{values:w}}}else b=MS(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||OS(g,p),b=k6(u,l,g,p==="in"||p==="not-in");return xn.create(f,p,b)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function z6(t,e,n){const r=e,i=U_("where",t);return _m._create(i,r,n)}class V_ extends F_{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new V_(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:ps.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(i,o){let l=i;const u=o.getFlattenedFilters();for(const h of u)xT(l,h),l=Ay(l,h)})(e._query,n),new vc(e.firestore,e.converter,Ay(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function MS(t,e,n){if(typeof(n=Sn(n))=="string"){if(n==="")throw new Le(Ie.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!fC(e)&&n.indexOf("/")!==-1)throw new Le(Ie.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child($t.fromString(n));if(!Qe.isDocumentKey(r))throw new Le(Ie.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Yw(t,new Qe(r))}if(n instanceof un)return Yw(t,n._key);throw new Le(Ie.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${tm(n)}.`)}function OS(t,e){if(!Array.isArray(t)||t.length===0)throw new Le(Ie.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function xT(t,e){const n=(function(i,o){for(const l of i)for(const u of l.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null})(t.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Le(Ie.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Le(Ie.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class L6{convertValue(e,n="none"){switch(Na(e)){case 0:return null;case 1:return e.booleanValue;case 2:return cn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Oa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Je(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return $a(e,((i,o)=>{r[i]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[Rf].arrayValue?.values?.map((r=>cn(r.doubleValue)));return new Gs(n)}convertGeoPoint(e){return new Hs(cn(e.latitude),cn(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=sm(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Gu(e));default:return null}}convertTimestamp(e){const n=Ma(e);return new Wt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=$t.fromString(e);jt(PC(r),9688,{name:e});const i=new Wu(r.get(1),r.get(3)),o=new Qe(r.popFirst(5));return i.isEqual(n)||Ri(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function wT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Mu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Do extends vT{constructor(e,n,r,i,o,l){super(e,n,r,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new pf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(U_("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Ie.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=Do._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}Do._jsonSchemaVersion="firestore/documentSnapshot/1.0",Do._jsonSchema={type:wn("string",Do._jsonSchemaVersion),bundleSource:wn("string","DocumentSnapshot"),bundleName:wn("string"),bundle:wn("string")};class pf extends Do{data(e={}){return super.data(e)}}class Yl{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Mu(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new pf(this._firestore,this._userDataWriter,r.key,r,new Mu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Le(Ie.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((u=>{const h=new pf(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Mu(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new pf(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Mu(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,p=-1;return u.type!==0&&(f=l.indexOf(u.doc.key),l=l.delete(u.doc.key)),u.type!==1&&(l=l.add(u.doc),p=l.indexOf(u.doc.key)),{type:U6(u.type),doc:h,oldIndex:f,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Ie.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Yl._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=h_.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function U6(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Je(61501,{type:t})}}function F6(t){t=ms(t,un);const e=ms(t.firestore,Ho);return S6(pm(e),t._key).then((n=>G6(e,t,n)))}Yl._jsonSchemaVersion="firestore/querySnapshot/1.0",Yl._jsonSchema={type:wn("string",Yl._jsonSchemaVersion),bundleSource:wn("string","QuerySnapshot"),bundleName:wn("string"),bundle:wn("string")};class ST extends L6{constructor(e){super(),this.firestore=e}convertBytes(e){return new Kr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new un(this.firestore,null,n)}}function V6(t){t=ms(t,vc);const e=ms(t.firestore,Ho),n=pm(e),r=new ST(e);return N6(t._query),E6(n,t._query).then((i=>new Yl(e,r,t,i)))}function $6(t,e,n){t=ms(t,un);const r=ms(t.firestore,Ho),i=wT(t.converter,e,n);return bm(r,[fT(ym(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,br.none())])}function q6(t,e,n,...r){t=ms(t,un);const i=ms(t.firestore,Ho),o=ym(i);let l;return l=typeof(e=Sn(e))=="string"||e instanceof pd?gT(o,"updateDoc",t._key,e,n,r):pT(o,"updateDoc",t._key,e),bm(i,[l.toMutation(t._key,br.exists(!0))])}function H6(t){return bm(ms(t.firestore,Ho),[new cm(t._key,br.none())])}function bm(t,e){return(function(r,i){const o=new Ei;return r.asyncQueue.enqueueAndForget((async()=>d6(await w6(r),i,o))),o.promise})(pm(t),e)}function G6(t,e,n){const r=n.docs.get(e._key),i=new ST(t);return new Do(t,i,e._key,r,new Mu(n.hasPendingWrites,n.fromCache),e.converter)}class W6{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=ym(e)}set(e,n,r){this._verifyNotCommitted();const i=Kg(e,this._firestore),o=wT(i.converter,n,r),l=fT(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(l.toMutation(i._key,br.none())),this}update(e,n,r,...i){this._verifyNotCommitted();const o=Kg(e,this._firestore);let l;return l=typeof(n=Sn(n))=="string"||n instanceof pd?gT(this._dataReader,"WriteBatch.update",o._key,n,r,i):pT(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,br.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Kg(e,this._firestore);return this._mutations=this._mutations.concat(new cm(n._key,br.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Le(Ie.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Kg(t,e){if((t=Sn(t)).firestore!==e)throw new Le(Ie.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function $_(){return new yd("deleteField")}function Ku(...t){return new P_("arrayUnion",t)}function NS(...t){return new B_("arrayRemove",t)}function ET(t){return pm(t=ms(t,Ho)),new W6(t,(e=>bm(t,e)))}(function(e,n=!0){(function(i){gc=i})(hc),Xl(new Mo("firestore",((r,{instanceIdentifier:i,options:o})=>{const l=r.getProvider("app").getImmediate(),u=new Ho(new kM(r.getProvider("auth-internal")),new NM(l,r.getProvider("app-check-internal")),(function(f,p){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new Le(Ie.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Wu(f.options.projectId,p)})(l,i),l);return o={useFetchStreams:n,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),Aa(Bw,zw,e),Aa(Bw,zw,"esm2020")})();function Wo(){return A6(RE)}const Yt={showGroupTotals:!1};function Qo(t,e,n,r=1,i,o){let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const p=e.replace("months/","").split("_");if(p.length>=2){const g=p[p.length-1];l=`months/${p[p.length-2]}/${g}`}}console.log(`[Firebase] ${t}(${r}): ${l}${i===!1?" [NOT FOUND]":""}`)}async function At(t,e,n){const r=xc(Wo(),t,e),i=`${t}/${e}`,o=await F6(r),l=o.exists(),u=l?o.data():null;return Qo("READ",i,n,1,l),{exists:l,data:u,ref:r}}async function or(t,e,n){const r=Wo(),i=T6(r,t);let o;if(n&&n.length>0){const f=n.map(p=>z6(p.field,p.op,p.value));o=B6(i,...f)}else o=i;const l=await V6(o),u=l.docs.map(f=>({id:f.id,data:f.data()}));let h=t;if(n&&n.length>0){const f=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${f}`}return Qo("QUERY",h,e,l.docs.length,void 0),{docs:u}}async function kr(t,e,n,r,i){const o=xc(Wo(),t,e),l=`${t}/${e}`;return Qo("WRITE",l,r,1,void 0),$6(o,n,i??{})}async function q_(t,e){const r=Wo();for(let i=0;i<t.length;i+=500){const o=t.slice(i,i+500),l=ET(r);for(const{collectionPath:u,docId:h,data:f}of o){const p=xc(r,u,h);l.set(p,f)}Qo("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0);try{await l.commit()}catch(u){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,u),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(i/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),u}}}async function Di(t,e,n,r){const i=xc(Wo(),t,e),o=`${t}/${e}`;return Qo("UPDATE",o,r,1,void 0),q6(i,n)}async function Ly(t,e,n){const r=xc(Wo(),t,e),i=`${t}/${e}`;return Qo("DELETE",i),H6(r)}async function CT(t,e,n){const i=Wo();for(let o=0;o<t.length;o+=500){const l=t.slice(o,o+500),u=ET(i);for(const{collectionPath:h,docId:f}of l){const p=xc(i,h,f);u.delete(p)}Qo("BATCH_DELETE",`${l.length} docs`,e,l.length),await u.commit(),n?.(o+l.length)}}const Ao={mobile:640,tablet:768,wide:1200},Q6=Ao.mobile,yi={primary:"--color-primary",error:"--color-error",errorBg:"--color-error-bg",errorBorder:"--color-error-border",success:"--color-success",warning:"--color-warning",danger:"--color-danger",debt:"--color-debt",zero:"--color-zero"},Lf=["January","February","March","April","May","June","July","August","September","October","November","December"],Ws=3,H_=3,Vt="ungrouped_accounts",en="ungrouped_categories";function K6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:0,account_group_id:r.account_group_id??Vt,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function Y6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget!==void 0?r.on_budget:null,is_active:r.is_active!==void 0?r.is_active:null}}),e[Vt]||(e[Vt]={name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}),e}function X6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??en,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:0,is_hidden:r.is_hidden??!1}}),e}function Z6(t=[]){const e=t.map(r=>({id:r.id,name:r.name,sort_order:r.sort_order??0}));if(!e.some(r=>r.id===en)){const r=e.length>0?Math.max(...e.map(i=>i.sort_order)):-1;e.push({id:en,name:"Uncategorized",sort_order:r+1})}return e.sort((r,i)=>r.sort_order-i.sort_order),e}function J6(t={}){const e={};return Object.keys(t).forEach(n=>{e[n]={}}),e}async function G_(t){const{exists:e,data:n}=await At("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=K6(n.accounts),i=Y6(n.account_groups),o=X6(n.categories),l=Z6(n.category_groups),u=J6(n.month_map);return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:i,categories:o,category_groups:l,month_map:u,percentage_income_months_back:n.percentage_income_months_back},accounts:r,accountGroups:i,categories:o,categoryGroups:l,monthMap:u}}async function Uf(t,e){return e.fetchQuery({queryKey:we.budget(t),queryFn:()=>G_(t),staleTime:Yr})}function eP(t,e){const{initialDataLoadComplete:n}=Xe(),r=!!t&&e?.enabled!==!1&&n;return Vo({queryKey:t?we.budget(t):["budget","none"],queryFn:()=>G_(t),enabled:r,staleTime:Yr})}function Qs(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function wc(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function vm(t,e,n){if(n<1)return null;let r=t,i=e;for(let o=0;o<n;o++)i===1?(r-=1,i=12):i-=1;return{year:r,month:i}}function Yu(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function He(t,e){return`${t}${e.toString().padStart(2,"0")}`}function Uy(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function xm(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1;if(t===r&&e===i){const o=n.getDate();return`${r}-${String(i).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function wm(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}function Te(t){return Math.round((t+Number.EPSILON)*100)/100}function ht(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function za(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>za(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=za(r));return e}return t}const Xt="__NO_CATEGORY__",Lo="No Category";function lt(t){return t===Xt}const Gt="__NO_ACCOUNT__",La="No Account";function Ye(t){return t===Gt}function TT(t,e){return Te(e.filter(n=>n.category_id===t).reduce((n,r)=>n+r.amount,0))}function AT(t,e){let n=0;for(const r of e)r.from_category_id===t&&!lt(r.from_category_id)&&(n-=r.amount),r.to_category_id===t&&!lt(r.to_category_id)&&(n+=r.amount);return Te(n)}function jT(t,e){return Te(e.filter(n=>n.category_id===t&&!lt(n.category_id)).reduce((n,r)=>n+r.amount,0))}function RT(t,e,n){const r={},i={},o={};for(const l of t)lt(l.category_id)||(r[l.category_id]=(r[l.category_id]||0)+l.amount);for(const l of e)lt(l.from_category_id)||(i[l.from_category_id]=(i[l.from_category_id]||0)-l.amount),lt(l.to_category_id)||(i[l.to_category_id]=(i[l.to_category_id]||0)+l.amount);for(const l of n)lt(l.category_id)||(o[l.category_id]=(o[l.category_id]||0)+l.amount);for(const l of Object.keys(r))r[l]=Te(r[l]);for(const l of Object.keys(i))i[l]=Te(i[l]);for(const l of Object.keys(o))o[l]=Te(o[l]);return{spentMap:r,transfersMap:i,adjustmentsMap:o}}function IT(t,e,n,r){const i=TT(t.category_id,e),o=AT(t.category_id,n),l=jT(t.category_id,r),u=Te(t.start_balance+t.allocated+i+o+l);return{...t,spent:i,transfers:o,adjustments:l,end_balance:u}}function DT(t,e,n,r){return t.map(i=>IT(i,e,n,r))}const tP=Object.freeze(Object.defineProperty({__proto__:null,calculateCategoryBalance:IT,calculateCategoryBalances:DT},Symbol.toStringTag,{value:"Module"}));function nP(t,e){return Te(e.filter(n=>n.account_id===t).reduce((n,r)=>n+r.amount,0))}function rP(t,e){return Te(e.filter(n=>n.account_id===t).reduce((n,r)=>n+r.amount,0))}function sP(t,e){let n=0;for(const r of e)r.from_account_id===t&&!Ye(r.from_account_id)&&(n-=r.amount),r.to_account_id===t&&!Ye(r.to_account_id)&&(n+=r.amount);return Te(n)}function iP(t,e){return Te(e.filter(n=>n.account_id===t&&!Ye(n.account_id)).reduce((n,r)=>n+r.amount,0))}function aP(t,e,n,r,i){const o=nP(t.account_id,e),l=rP(t.account_id,n),u=sP(t.account_id,r),h=iP(t.account_id,i),f=Te(o+l+u+h),p=Te(t.start_balance+f);return{...t,income:o,expenses:l,transfers:u,adjustments:h,net_change:f,end_balance:p}}function oP(t,e,n,r,i){return t.map(o=>aP(o,e,n,r,i))}function _d(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1;let r=e,i=n-H_;for(;i<1;)i+=12,r-=1;return{year:r,month:i}}function Sm(t,e){const n=_d(),r=He(t,e),i=He(n.year,n.month);return r<=i}function lP(t,e,n,r){if("spent"in t&&"transfers"in t&&"adjustments"in t&&"end_balance"in t)return t;const[i]=DT([t],e,n,r);return i}function cP(t,e,n,r,i){if("income"in t&&"expenses"in t&&"transfers"in t&&"adjustments"in t&&"net_change"in t&&"end_balance"in t)return t;const[o]=oP([t],e,n,r,i);return o}function uP(t,e,n){const r=Sm(e,n);return{category_id:t.category_id,start_balance:r?Te(t.start_balance):0,allocated:Te(t.allocated)}}function dP(t,e,n){const r=Sm(e,n);return{account_id:t.account_id,start_balance:r?Te(t.start_balance):0}}function bd(t){const e=t.category_balances.map(r=>lP(r,t.expenses,t.transfers,t.adjustments)),n=t.account_balances.map(r=>cP(r,t.income,t.expenses,t.transfers,t.adjustments));return{...t,category_balances:e,account_balances:n}}function vd(t){const e=t.category_balances.map(u=>uP(u,t.year,t.month)),n=t.account_balances.map(u=>dP(u,t.year,t.month)),{total_income:r,total_expenses:i,previous_month_income:o,...l}=t;return{...l,category_balances:e,account_balances:n}}async function Em(t,e,n,r,i=1){const o=vm(e,n,i);if(!o)return 0;const{year:l,month:u}=o,h=we.month(t,l,u);if(r){const f=r.getQueryData(h);if(f?.month){const p=f.month.income||[];return Te(p.reduce((g,b)=>g+(b.amount||0),0))}}try{const f=Qs(t,l,u),{exists:p,data:g}=await At("months",f,`[calculatePreviousMonthIncome] income ${i} month(s) back for ${e}/${n}`);if(p&&g?.income){const b=g.income;return Te(b.reduce((_,w)=>_+(w.amount||0),0))}}catch(f){console.warn(`[calculatePreviousMonthIncome] Could not read month ${l}/${u}:`,f)}return 0}async function hP(t,e,n,r,i,o=1){const l=t.income||[],u=t.expenses||[],h=l.reduce((_,w)=>_+(w.amount||0),0),f=u.reduce((_,w)=>_+(w.amount||0),0),g=t.are_allocations_finalized??!1?0:await Em(e,n,r,i,o),b={budget_id:e,year_month_ordinal:t.year_month_ordinal??He(n,r),year:t.year??n,month:t.month??r,income:l,total_income:h,previous_month_income:g,expenses:u,total_expenses:f,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return bd(b)}async function lr(t,e,n,r){const i=Qs(t,e,n),l=(await Uf(t,Be)).budget.percentage_income_months_back??1;return(await Be.fetchQuery({queryKey:we.month(t,e,n),queryFn:async()=>{const{exists:h,data:f}=await At("months",i,r?.description??`reading month ${e}/${n}`);return!h||!f?null:{month:await hP(f,t,e,n,Be,l)}},staleTime:Yr}))?.month??null}async function fP(t,e,n,r){const i=t.income||[],o=t.expenses||[],l=i.reduce((b,_)=>b+(_.amount||0),0),u=o.reduce((b,_)=>b+(_.amount||0),0),f=(await Uf(e,Be)).budget.percentage_income_months_back??1,p=await Em(e,n,r,Be,f),g={budget_id:e,year_month_ordinal:t.year_month_ordinal??He(n,r),year:t.year??n,month:t.month??r,income:i,total_income:l,previous_month_income:p,expenses:o,total_expenses:u,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return bd(g)}async function kT(t,e,n,r){const i=Qs(t,e,n),o=`PRE-EDIT-READ: ${r}`,{exists:l,data:u}=await At("months",i,o);if(!l||!u)throw new Error(`Month data not found for ${e}/${n}`);return await fP(u,t,e,n)}function MT(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}function OT(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let i=H_;i>0;i--){let o=e,l=n-i;for(;l<1;)l+=12,o-=1;r.push(He(o,l))}r.push(He(e,n));for(let i=1;i<=Ws;i++){let o=e,l=n+i;for(;l>12;)l-=12,o+=1;r.push(He(o,l))}return r}function mP(t,e){const n=we.budget(t),r=Be.getQueryData(n);if(!r?.monthMap||!(e in r.monthMap))return!1;const i=OT();for(const o of i)if(o>=e&&!(o in r.monthMap))return!1;return!0}function pP(t,e,n){const r=we.budget(t),i=Be.getQueryData(r);i&&Be.setQueryData(r,{...i,monthMap:n,budget:{...i.budget,month_map:n}})}function gP(t,e){const n=we.budget(t),r=Be.getQueryData(n);r&&Be.setQueryData(n,{...r,monthMap:e,budget:{...r.budget,month_map:e}})}function yP(t,e){const n=we.budget(t),r=Be.getQueryData(n);r&&Be.setQueryData(n,{...r,monthMap:e,budget:{...r.budget,month_map:e}})}function _P(t,e,n){const r=He(e,n),i=we.budget(t),o=Be.getQueryData(i);if(!o)return console.warn(`[removeMonthFromMap] Budget ${t} not found in cache`),{};const l=o.monthMap||{},{[r]:u,...h}=l;return Be.setQueryData(i,{...o,monthMap:h,budget:{...o.budget,month_map:h}}),h}async function bP(t,e,n,r){const{bypassDateLimit:i=!1}={},o=new Date,l=o.getFullYear(),u=o.getMonth()+1,h=(e-l)*12+(n-u);if(!i&&h>Ws){const P=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${Ws}). This likely indicates a bug in month navigation.`;throw console.error(P),new Error(P)}const{exists:f,data:p}=await At("budgets",t,"validating budget exists before creating month");if(!f||!p){Be.removeQueries({queryKey:we.budget(t)});const P=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(P),new Error(P)}const g=o.toISOString(),b=Qs(t,e,n),_=p.percentage_income_months_back??1;let w=0,x={},S={};if(n>1||e>new Date().getFullYear()-10){const{year:P,month:$}=wc(e,n),V=Qs(t,P,$),j=we.month(t,P,$),B=Be.getQueryData(j);let k=null;if(B?.month){const Y=B.month;k={budget_id:Y.budget_id,year_month_ordinal:Y.year_month_ordinal,year:Y.year,month:Y.month,income:Y.income,expenses:Y.expenses,transfers:Y.transfers,adjustments:Y.adjustments,account_balances:Y.account_balances,category_balances:Y.category_balances,are_allocations_finalized:Y.are_allocations_finalized,created_at:Y.created_at,updated_at:Y.updated_at}}else try{const{exists:Y,data:X}=await At("months",V,"fetching previous month to create start balances for new month");Y&&(k=X)}catch(Y){if(Y instanceof Error&&Y.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${P}/${$}, starting with zero balances`);else throw Y}if(k){const Y={year_month_ordinal:k.year_month_ordinal??He(P,$),year:k.year??P,month:k.month??$,income:k.income||[],total_income:k.total_income??0,previous_month_income:k.previous_month_income??0,expenses:k.expenses||[],total_expenses:k.total_expenses??0,transfers:k.transfers||[],adjustments:k.adjustments||[],account_balances:k.account_balances||[],category_balances:k.category_balances||[],are_allocations_finalized:k.are_allocations_finalized??!1,created_at:k.created_at,updated_at:k.updated_at};if(_===1)w=Y.total_income;else{const te=vm(e,n,_);if(te){const H=we.month(t,te.year,te.month),re=Be.getQueryData(H);if(re?.month)w=(re.month.income||[]).reduce((N,q)=>N+(q.amount||0),0);else try{const N=Qs(t,te.year,te.month),{exists:q,data:J}=await At("months",N,"fetching month for percentage income");q&&J?.income&&(w=J.income.reduce((ne,ae)=>ne+(ae.amount||0),0))}catch{}}}const{categoryEndBalances:X,accountEndBalances:W}=MT(Y);x=X,S=W}}const C=Sm(e,n),T=Object.entries(x).map(([P,$])=>({category_id:P,start_balance:C?$:0,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:$})),I=Object.entries(S).map(([P,$])=>({account_id:P,start_balance:C?$:0,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:$})),M={budget_id:t,year_month_ordinal:He(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:w,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:I,category_balances:T,are_allocations_finalized:!1,created_at:g,updated_at:g},F={budget_id:t,year_month_ordinal:He(e,n),year:e,month:n,income:[],expenses:[],transfers:[],adjustments:[],account_balances:I,category_balances:T,are_allocations_finalized:!1,created_at:g,updated_at:g};await kr("months",b,F,"creating new month document (first time viewing this month)"),Be.setQueryData(we.month(t,e,n),{month:M});const G=He(e,n),O={...p.month_map||{},[G]:{}};return gP(t,O),await Di("budgets",t,{month_map:O,updated_at:g},`adding month ${e}/${n} to budget month_map`),M}async function vP(t,e,n,r,i,o=1){const l=t.income||[],u=t.expenses||[],h=l.reduce((_,w)=>_+(w.amount||0),0),f=u.reduce((_,w)=>_+(w.amount||0),0),g=t.are_allocations_finalized??!1?0:await Em(e,n,r,i,o),b={budget_id:e,year_month_ordinal:t.year_month_ordinal??He(n,r),year:t.year??n,month:t.month??r,income:l,total_income:h,previous_month_income:g,expenses:u,total_expenses:f,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return bd(b)}async function Cm(t,e,n,r,i=1){const o=Qs(t,e,n);try{const{exists:l,data:u}=await At("months",o,`loading month ${e}/${n}`);return!l||!u?null:await vP(u,t,e,n,r,i)}catch(l){if(l instanceof Error&&l.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw l}}async function NT(t,e,n,r){if(r){const h=we.month(t,e,n),f=r.getQueryData(h);if(f?.month){if(!f.month.are_allocations_finalized){const g=(await Uf(t,r)).budget.percentage_income_months_back??1,b=await Em(t,e,n,r,g);return{...f.month,previous_month_income:b}}return f.month}}const i=r?await Uf(t,r):null,o=i?.budget.percentage_income_months_back??1,l=await Cm(t,e,n,r,o);if(l)return l;let u=!1;if(r&&i)i.monthMap&&(u=He(e,n)in i.monthMap);else{const{exists:h,data:f}=await At("budgets",t,"checking month_map before creating month");if(h&&f?.month_map){const p=He(e,n),g=f.month_map;u=p in g}}if(u)return bP(t,e,n);throw new Error(`Month ${e}/${n} does not exist in budget. Cannot create months that are not in month_map.`)}function PT(t,e,n,r){const i=Rt(),{initialDataLoadComplete:o}=Xe(),l=t?we.month(t,e,n):["month","none"],u=!!t&&r?.enabled!==!1&&o;return Vo({queryKey:l,queryFn:async()=>({month:await NT(t,e,n,i)}),enabled:u,staleTime:Yr})}const PS=Object.freeze(Object.defineProperty({__proto__:null,fetchMonth:NT,getEndBalancesFromMonth:MT,readMonth:lr,readMonthDirect:Cm,readMonthForEdit:kT,useMonthQuery:PT},Symbol.toStringTag,{value:"Module"}));async function BT(t){const{exists:e,data:n}=await At("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function W_(t,e){const{initialDataLoadComplete:n}=Xe(),r=!!t&&e?.enabled!==!1&&n;return Vo({queryKey:t?we.payees(t):["payees","none"],queryFn:()=>BT(t),enabled:r,staleTime:Yr})}async function xP(t,e){const{exists:n,data:r}=await At("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const i={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await kr("users",t,i,"creating new user document (first login)"),i}function zT(t,e,n){return Vo({queryKey:t?we.user(t):["user","none"],queryFn:()=>xP(t,e),enabled:!!t&&n?.enabled!==!1})}async function wP(t,e){const n=await or("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],i=[];for(const o of n.docs){const l=o.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):i.push({budgetId:o.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}return{budgets:r,pendingInvites:i}}function SP(t,e,n){return Vo({queryKey:t?we.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?wP(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function EP(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function CP(){const t=await or("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=EP(n.data.items),i=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:i})})}return{items:e}}function TP(t){return Vo({queryKey:we.feedback(),queryFn:CP,enabled:t?.enabled!==!1})}const AP="modulepreload",jP=function(t){return"/"+t},BS={},ko=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let f=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};var l=f;document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),h=u?.nonce||u?.getAttribute("nonce");i=f(n.map(p=>{if(p=jP(p),p in BS)return;BS[p]=!0;const g=p.endsWith(".css"),b=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const _=document.createElement("link");if(_.rel=g?"stylesheet":AP,g||(_.as="script"),_.crossOrigin="",_.href=p,h&&_.setAttribute("nonce",h),document.head.appendChild(_),g)return new Promise((w,x)=>{_.addEventListener("load",w),_.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return i.then(u=>{for(const h of u||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})},xd={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function oc(t,e,n){const r=t.income||[],i=t.expenses||[],o=Te(r.reduce((_,w)=>_+w.amount,0)),l=Te(i.reduce((_,w)=>_+w.amount,0)),{spentMap:u,transfersMap:h,adjustmentsMap:f}=RT(i,t.transfers||[],t.adjustments||[]),p=RP(t.category_balances,e.categoryEndBalances,h,f,u),g=IP(t,e.accountEndBalances),b=n!==void 0?n:e.totalIncome;return{...t,total_income:o,total_expenses:l,previous_month_income:b,category_balances:p,account_balances:g,updated_at:new Date().toISOString()}}function RP(t,e,n,r,i){const o=new Map;for(const h of t)lt(h.category_id)||o.set(h.category_id,h);const l=new Set;for(const h of t)lt(h.category_id)||l.add(h.category_id);for(const h of Object.keys(e))lt(h)||l.add(h);for(const h of Object.keys(n))lt(h)||l.add(h);for(const h of Object.keys(r))lt(h)||l.add(h);const u=[];for(const h of l){const f=o.get(h),p=Te(e[h]??0),g=Te(f?.allocated??0),b=Te(i[h]??0),_=Te(n[h]??0),w=Te(r[h]??0);u.push({category_id:h,start_balance:p,allocated:g,spent:b,transfers:_,adjustments:w,end_balance:Te(p+g+b+_+w)})}return u}function IP(t,e){const n=new Set;for(const i of t.income||[])Ye(i.account_id)||n.add(i.account_id);for(const i of t.expenses||[])Ye(i.account_id)||n.add(i.account_id);for(const i of t.transfers||[])Ye(i.from_account_id)||n.add(i.from_account_id),Ye(i.to_account_id)||n.add(i.to_account_id);for(const i of t.adjustments||[])Ye(i.account_id)||n.add(i.account_id);for(const i of Object.keys(e))Ye(i)||n.add(i);for(const i of t.account_balances||[])Ye(i.account_id)||n.add(i.account_id);const r=[];for(const i of n){const o=Te(e[i]??0),l=Te((t.income||[]).filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)),u=Te((t.expenses||[]).filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)),h=Te((t.transfers||[]).filter(_=>_.from_account_id===i).reduce((_,w)=>_-w.amount,0)),f=Te((t.transfers||[]).filter(_=>_.to_account_id===i).reduce((_,w)=>_+w.amount,0)),p=Te(f+h),g=Te((t.adjustments||[]).filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)),b=Te(l+u+p+g);r.push({account_id:i,start_balance:o,income:l,expenses:u,transfers:p,adjustments:g,net_change:b,end_balance:Te(o+b)})}return r}function Uo(t){const e={},n={};for(const r of t.category_balances||[])lt(r.category_id)||(e[r.category_id]=Te(r.end_balance));for(const r of t.account_balances||[])Ye(r.account_id)||(n[r.account_id]=Te(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:Te(t.total_income)}}async function DP(t,e){return Be.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await At("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function Fy(t,e,n){const r=await lr(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function kP(t,e,n,r){const i={};e.forEach(b=>{i[b]=0});const o=await Fy(t,n,r);if(o?.category_balances){for(const b of o.category_balances)e.includes(b.category_id)&&(i[b.category_id]=b.end_balance);return i}const l={};e.forEach(b=>{l[b]=0});const u=[];o&&u.push(o);let h=n,f=r,p=!1;const g=120;for(let b=0;b<g&&!p;b++){const _=wc(h,f);h=_.year,f=_.month;const w=await Fy(t,h,f);if(!w)p=!0;else if(w.category_balances){p=!0;for(const x of w.category_balances)e.includes(x.category_id)&&(l[x.category_id]=x.end_balance)}else u.push(w)}u.reverse(),Object.assign(i,l);for(const b of u){if(b.are_allocations_finalized&&b.category_balances)for(const _ of b.category_balances)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)+_.allocated);if(b.expenses)for(const _ of b.expenses)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)-_.amount)}return i}async function LT(t,e,n,r,i){const o={...n},u=Be.getQueryData(we.budget(t))?.monthMap||{},h=new Date,f=h.getFullYear(),p=h.getMonth()+1;let g=f,b=p+Ws;for(;b>12;)b-=12,g+=1;const _=He(g,b);let w=r,x=i;const S=Ws*2;for(let C=0;C<S;C++){const T=Yu(w,x);w=T.year,x=T.month;const I=He(w,x);if(I>_||!(I in u))break;const M=await Fy(t,w,x);if(!M)break;if(M.are_allocations_finalized&&M.category_balances)for(const F of M.category_balances)e.includes(F.category_id)&&(o[F.category_id]=(o[F.category_id]||0)+F.allocated);if(M.expenses)for(const F of M.expenses)e.includes(F.category_id)&&(o[F.category_id]=(o[F.category_id]||0)-F.amount)}return o}async function zS(t,e,n,r){const i=await kP(t,e,n,r),o=await LT(t,e,i,n,r);return{current:i,total:o}}function Q_(t,e){const n=t.account_group_id?e[t.account_group_id]:void 0,r=n&&n.on_budget!==null?n.on_budget:t.on_budget!==!1,i=n&&n.is_active!==null?n.is_active:t.is_active!==!1;return r&&i}function UT(t,e,n){const r=Object.entries(t).reduce((o,[,l])=>Q_(l,n)?o+(l.balance??0):o,0),i=Object.values(e).reduce((o,l)=>{const u=l.balance??0;return o+(u>0?u:0)},0);return Te(r-i)}const MP=Object.freeze(Object.defineProperty({__proto__:null,calculateTotalAvailable:UT,isAccountOnBudget:Q_},Symbol.toStringTag,{value:"Module"}));function OP(t={}){const e={};return Object.keys(t).forEach(n=>{e[n]={}}),e}async function NP(t,e,n,r){const i=Be.getQueryData(we.budget(t));let o=null;if(i?.budget)o=i.budget;else{const{exists:g,data:b}=await At("budgets",t,"[recalc] reading budget for cache update");if(!g||!b)return;o=b}if(!o)return;const l={...o.accounts};for(const[g,b]of Object.entries(e))l[g]&&(l[g]={...l[g],balance:Te(b)});const u={...o.categories};for(const[g,b]of Object.entries(n))u[g]&&(u[g]={...u[g],balance:Te(b)});const{calculateTotalAvailable:h}=await ko(async()=>{const{calculateTotalAvailable:g}=await Promise.resolve().then(()=>MP);return{calculateTotalAvailable:g}},[]),f=h(l,u,o.account_groups||{}),{writeBudgetData:p}=await ko(async()=>{const{writeBudgetData:g}=await Promise.resolve().then(()=>tA);return{writeBudgetData:g}},void 0);await p({budgetId:t,updates:{month_map:r},description:"[recalc] updating month_map"}),PP(t,l,u,f,r)}function PP(t,e,n,r,i){const o=Be.getQueryData(we.budget(t));if(o){const l={};for(const[h,f]of Object.entries(o.accounts)){const p=e[h];p&&p.balance!==void 0?l[h]={...f,balance:Te(p.balance)}:l[h]=f}const u={};for(const[h,f]of Object.entries(o.categories)){const p=n[h];p&&p.balance!==void 0?u[h]={...f,balance:Te(p.balance)}:u[h]=f}Be.setQueryData(we.budget(t),{...o,accounts:l,categories:u,accountGroups:o.accountGroups,categoryGroups:o.categoryGroups,monthMap:i,budget:{...o.budget,accounts:l,categories:u,account_groups:o.budget.account_groups,category_groups:o.budget.category_groups,month_map:i}})}}async function K_(t,e,n){const r=He(e,n);if(mP(t,r))return{addedCount:0,budgetUpdated:!1};const i=we.budget(t),o=Be.getQueryData(i);let l=null;if(o?.budget)l=o.budget;else{const{exists:g,data:b}=await At("budgets",t,"reading budget for month_map update");if(!g||!b)return console.warn(`[ensureMonthsInMap] Budget ${t} not found`),{addedCount:0,budgetUpdated:!1};l=b}const h={...l.month_map||{}},f=OT();let p=0;r in h||(h[r]={},p++);for(const g of f)g>=r&&!(g in h)&&(h[g]={},p++);return p===0?{addedCount:0,budgetUpdated:!1}:(pP(t,r,h),await Di("budgets",t,{month_map:h,updated_at:new Date().toISOString()},`adding ${p} month(s) to budget month_map`),{addedCount:p,budgetUpdated:!0})}async function BP(t,e){if(e.length===0)return{addedCount:0,budgetUpdated:!1};const n=we.budget(t),r=Be.getQueryData(n);let i=null;if(r?.budget)i=r.budget;else{const{exists:h,data:f}=await At("budgets",t,"reading budget for batch month_map update");if(!h||!f)return console.warn(`[ensureMonthsInMapBatch] Budget ${t} not found`),{addedCount:0,budgetUpdated:!1};i=f}const l={...i.month_map||{}};let u=0;for(const{year:h,month:f}of e){const p=He(h,f);p in l||(l[p]={},u++)}return u===0?{addedCount:0,budgetUpdated:!1}:(yP(t,l),await Di("budgets",t,{month_map:l,updated_at:new Date().toISOString()},`adding ${u} month(s) to budget month_map (batch)`),{addedCount:u,budgetUpdated:!0})}const zP=Object.freeze(Object.defineProperty({__proto__:null,ensureMonthsInMap:K_,ensureMonthsInMapBatch:BP},Symbol.toStringTag,{value:"Module"}));async function FT(t,e,n){const r=Qs(t,e.year,e.month),i=vd(e);await kr("months",r,i,`writeMonthData: ${n}`)}async function Y_(t){const{budgetId:e,month:n,description:r,updateMonthMap:i=!0}=t;await FT(e,n,r||`${n.year}/${n.month}`),Be.setQueryData(we.month(e,n.year,n.month),{month:n}),i&&await K_(e,n.year,n.month)}function LP(){const t=Rt();return{writeData:En({mutationFn:async({budgetId:n,month:r,description:i,updateMonthMap:o=!0})=>(await FT(n,r,i||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,updateMonthMap:o}),onMutate:async({budgetId:n,month:r})=>{const i=we.month(n,r.year,r.month);await t.cancelQueries({queryKey:i});const o=t.getQueryData(i);return t.setQueryData(i,{month:r}),{oldMonthQueryData:o,monthKey:i}},onSuccess:async({budgetId:n,year:r,month:i,updateMonthMap:o})=>{o&&await K_(n,r,i)},onError:(n,r,i)=>{i?.oldMonthQueryData&&t.setQueryData(i.monthKey,i.oldMonthQueryData)}})}}function UP(){const{writeData:t}=LP();return{saveDraftAllocations:async(n,r,i,o)=>{const l=await lr(n,r,i);if(!l)throw new Error(`Month not found: ${r}/${i}`);const{calculateCategoryBalances:u}=await ko(async()=>{const{calculateCategoryBalances:g}=await Promise.resolve().then(()=>tP);return{calculateCategoryBalances:g}},void 0),h=l.category_balances.map(g=>({category_id:g.category_id,start_balance:g.start_balance,allocated:Te(o[g.category_id]??g.allocated)})),f=u(h,l.expenses||[],l.transfers||[],l.adjustments||[]),p={...l,category_balances:f,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:p,updateMonthMap:!1}),{updatedMonth:p}},isPending:t.isPending,isError:t.isError,error:t.error}}const ge={primary:`var(${yi.primary})`,error:`var(${yi.error})`,errorBg:`var(${yi.errorBg})`,errorBorder:`var(${yi.errorBorder})`,success:`var(${yi.success})`,danger:`var(${yi.danger})`,warning:`var(${yi.warning})`,debt:`var(${yi.debt})`,zero:`var(${yi.zero})`},hs={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},Ua="1px solid color-mix(in srgb, currentColor 20%, transparent)",Ff={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},X_={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},FP={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},VP={display:"flex",flexDirection:"column",gap:"0.5rem"},$P={fontSize:"0.9rem",fontWeight:500},Ha={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},qP={...Ha,cursor:"pointer"},Z_={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},VT={...Z_,background:ge.primary,color:"white",border:"none"},HP={...VT,padding:"0.75rem 1.5rem",borderRadius:"8px"},GP={...Z_,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},WP={...Z_,background:"transparent",border:`1px solid ${ge.errorBorder}`,color:ge.error},QP={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s",whiteSpace:"nowrap"},wa={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},Vf={display:"flex",flexDirection:"column",gap:"2px"},KP={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},YP={opacity:.4,cursor:"grab"},XP={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:ge.primary,borderRadius:"2px",transition:"opacity 0.15s"},ZP={position:"relative",height:"2rem",marginTop:"-0.25rem"},JP={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ge.primary,borderRadius:"2px",transition:"opacity 0.15s"},eB={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--surface-base)",padding:"0 0.5rem",whiteSpace:"nowrap"},tB={background:ge.errorBg,border:`1px solid ${ge.errorBorder}`,color:ge.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},nB={background:"transparent",border:"none",color:ge.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},$T={opacity:.7,marginBottom:"1.5rem"},LS={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"};function J_({message:t,children:e,onDismiss:n,style:r}){return d.jsxs("div",{style:{...tB,...r},children:[d.jsx("span",{children:e??t}),n&&d.jsx("button",{onClick:n,style:nB,children:""})]})}const rB={primary:VT,"primary-large":HP,secondary:GP,danger:WP,small:QP},sB={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:ge.warning,color:"var(--text-primary)",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px var(--shadow-overlay)",animation:"tooltipFadeIn 0.15s ease-out"},iB={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${ge.warning}`};function $e({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:i,style:o,actionName:l,disabledReason:u,onClick:h,...f}){const p=rB[t],g=i||e,[b,_]=R.useState(!1);function w(C){h?.(C)}function x(C){g&&u&&(C.preventDefault(),C.stopPropagation(),_(!0),setTimeout(()=>_(!1),3e3))}const S=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return d.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:x,children:[b&&u&&d.jsxs("div",{style:sB,children:[u,d.jsx("div",{style:iB})]}),d.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...S,...o},onClick:w,...f,children:e?n:r})]})}function qT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const u=r.indexOf(n);return{match:!0,score:u===0||/\s/.test(r[u-1])?100:90}}let i=0,o=0,l=0;for(let u=0;u<r.length&&i<n.length;u++)r[u]===n[i]?(i++,l++,o+=l*2):l=0;return i===n.length?{match:!0,score:o}:{match:!1,score:0}}function HT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function GT(t){const e=HT(t),n=[];let r="__initial__";return e.forEach(i=>{i.groupId!==r&&(r=i.groupId,n.push({groupId:i.groupId,groupName:i.groupName,groupSortOrder:i.groupSortOrder,items:[]})),n[n.length-1].items.push(i)}),n}function WT(t,e,n){return e.trim()?t.map(i=>{const o=n(i);let l=0,u=!1;for(const h of o){const f=qT(e,h);f.match&&(u=!0,l=Math.max(l,f.score))}return{item:i,score:l,hasMatch:u}}).filter(({hasMatch:i})=>i).sort((i,o)=>o.score!==i.score?o.score-i.score:!i.item.groupId&&o.item.groupId?1:i.item.groupId&&!o.item.groupId?-1:i.item.groupSortOrder!==o.item.groupSortOrder?i.item.groupSortOrder-o.item.groupSortOrder:i.item.sortOrder-o.item.sortOrder).map(({item:i})=>i):HT(t)}const e0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--surface-base)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px var(--shadow-overlay)",zIndex:1e3},Xu={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function US({id:t,value:e,onChange:n,payees:r,placeholder:i="Enter payee name",autoFocus:o}){const[l,u]=R.useState(!1),[h,f]=R.useState(-1),p=R.useRef(null),g=R.useRef(null),b=e.trim()?r.map(x=>({payee:x,...qT(e,x)})).filter(x=>x.match).sort((x,S)=>S.score-x.score).slice(0,8).map(x=>x.payee):[];R.useEffect(()=>{function x(S){p.current&&!p.current.contains(S.target)&&u(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function _(x){!l||b.length===0||(x.key==="ArrowDown"?(x.preventDefault(),f(S=>Math.min(S+1,b.length-1))):x.key==="ArrowUp"?(x.preventDefault(),f(S=>Math.max(S-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(b[h]),u(!1),f(-1)):x.key==="Escape"&&(u(!1),f(-1)))}function w(x){n(x),u(!1),f(-1),g.current?.focus()}return d.jsxs("div",{ref:p,style:{position:"relative"},children:[d.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),u(!0),f(-1)},onFocus:()=>u(!0),onKeyDown:_,placeholder:i,autoComplete:"off",autoFocus:o,style:Ha}),l&&b.length>0&&d.jsx("div",{style:{...e0,maxHeight:"200px",overflowY:"auto"},children:b.map((x,S)=>d.jsx("div",{onClick:()=>w(x),style:{...Xu,background:S===h?`color-mix(in srgb, ${ge.primary} 20%, transparent)`:"transparent",borderBottom:S<b.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>f(S),children:x},x))})]})}function QT({id:t,value:e,onChange:n,categories:r,categoryGroups:i,placeholder:o="Search categories...",required:l,showNoCategoryOption:u=!1,showHiddenCategories:h=!1}){const f=Object.fromEntries(i.map(W=>[W.id,W.name])),p=Object.fromEntries(i.map(W=>[W.id,W.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,W])=>!W.is_hidden)),b=Object.entries(g).map(([W,te])=>({id:W,name:te.name,groupId:te.category_group_id,groupName:te.category_group_id&&f[te.category_group_id]||null,sortOrder:te.sort_order,groupSortOrder:te.category_group_id?p[te.category_group_id]??999:999})),_=e===Xt,w=_?null:e?r[e]:null,x=_?"":w?.name||"",[S,C]=R.useState(x),[T,I]=R.useState(!1),[M,F]=R.useState(-1),G=R.useRef(null),D=R.useRef(null);R.useEffect(()=>{if(e===Xt)C("");else if(e){const W=r[e];C(W?.name||"")}},[e,r]);const O=WT(b,S,W=>[W.name]),P=GT(O);R.useEffect(()=>{function W(te){if(G.current&&!G.current.contains(te.target))if(I(!1),e===Xt)C("");else{const H=e?r[e]:null;C(H?.name||"")}}return document.addEventListener("mousedown",W),()=>document.removeEventListener("mousedown",W)},[e,r]);function $(W){if(W.key==="ArrowDown")W.preventDefault(),T?F(te=>Math.min(te+1,O.length-1)):(I(!0),F(0));else if(W.key==="ArrowUp")W.preventDefault(),F(te=>Math.max(te-1,0));else if(W.key==="Enter")W.preventDefault(),T&&M>=0&&O[M]&&V(O[M]);else if(W.key==="Escape")if(I(!1),F(-1),e===Xt)C("");else{const te=e?r[e]:null;C(te?.name||"")}else if(W.key==="Tab")if(T&&M>=0&&O[M])V(O[M]);else if(I(!1),F(-1),e===Xt)C("");else{const te=e?r[e]:null;C(te?.name||"")}}function V(W){n(W.id),C(W.id===Xt?"":W.name),I(!1),F(-1)}function j(){n(Xt),C(""),I(!1),F(-1)}function B(W){const te=W.target.value;C(te),I(!0),F(te.trim()?0:-1),te!==x&&(u&&te.trim()===""?n(Xt):n(""))}function k(){I(!0),u&&(e===Xt||S.trim()==="")?F(-1):O.length>0&&F(0)}let Y=-1;const X=()=>++Y;return d.jsxs("div",{ref:G,style:{position:"relative"},children:[d.jsx("input",{ref:D,id:t,type:"text",value:S,onChange:B,onFocus:k,onKeyDown:$,placeholder:o,autoComplete:"off",required:l&&!u,style:{...Ha,borderColor:l&&!e?ge.error:void 0}}),T&&d.jsxs("div",{style:{...e0,maxHeight:"250px",overflowY:"auto"},children:[u&&d.jsx("div",{onClick:j,onMouseEnter:()=>F(-1),style:{...Xu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:M===-1?`color-mix(in srgb, ${ge.primary} 20%, transparent)`:"transparent"},children:Lo}),P.map((W,te)=>d.jsxs("div",{children:[W.groupName&&d.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:W.groupName}),W.items.map(H=>{const re=X();return d.jsx("div",{onClick:()=>V(H),style:{...Xu,paddingLeft:W.groupName?"1.2rem":"0.8rem",background:re===M?`color-mix(in srgb, ${ge.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>F(re),children:H.name},H.id)})]},`group-${te}`)),O.length===0&&S.trim()&&!u&&d.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function KT({id:t,value:e,onChange:n,accounts:r,accountGroups:i,placeholder:o="Search accounts...",required:l,showNoAccountOption:u=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,Y])=>!Y.is_hidden)).map(([Y,X])=>({id:Y,name:X.nickname,groupId:X.account_group_id,groupName:X.account_group_id&&i[X.account_group_id]?.name||null,sortOrder:X.sort_order,groupSortOrder:X.account_group_id?i[X.account_group_id]?.sort_order??999:999})),g=e===Gt,b=g?null:r.find(([Y])=>Y===e)?.[1],_=g?"":b?.nickname||"",[w,x]=R.useState(_),[S,C]=R.useState(!1),[T,I]=R.useState(-1),M=R.useRef(null),F=R.useRef(null);R.useEffect(()=>{if(e===Gt)x("");else if(e){const Y=r.find(([X])=>X===e)?.[1];x(Y?.nickname||"")}},[e,r]);const G=WT(p,w,Y=>[Y.name]),D=GT(G);R.useEffect(()=>{function Y(X){if(M.current&&!M.current.contains(X.target))if(C(!1),e===Gt)x("");else{const W=r.find(([te])=>te===e)?.[1];x(W?.nickname||"")}}return document.addEventListener("mousedown",Y),()=>document.removeEventListener("mousedown",Y)},[e,r]);function O(Y){if(Y.key==="ArrowDown")Y.preventDefault(),S?I(X=>Math.min(X+1,G.length-1)):(C(!0),I(0));else if(Y.key==="ArrowUp")Y.preventDefault(),I(X=>Math.max(X-1,0));else if(Y.key==="Enter")Y.preventDefault(),S&&T>=0&&G[T]&&P(G[T]);else if(Y.key==="Escape")if(C(!1),I(-1),e===Gt)x("");else{const X=r.find(([W])=>W===e)?.[1];x(X?.nickname||"")}else if(Y.key==="Tab")if(S&&T>=0&&G[T])P(G[T]);else if(C(!1),I(-1),e===Gt)x("");else{const X=r.find(([W])=>W===e)?.[1];x(X?.nickname||"")}}function P(Y){n(Y.id),x(Y.id===Gt?"":Y.name),C(!1),I(-1)}function $(){n(Gt),x(""),C(!1),I(-1)}function V(Y){const X=Y.target.value;x(X),C(!0),I(X.trim()?0:-1),X!==_&&(u&&X.trim()===""?n(Gt):n(""))}function j(){C(!0),u&&(e===Gt||w.trim()==="")?I(-1):G.length>0&&I(0)}let B=-1;const k=()=>++B;return d.jsxs("div",{ref:M,style:{position:"relative"},children:[d.jsx("input",{ref:F,id:t,type:"text",value:w,onChange:V,onFocus:j,onKeyDown:O,placeholder:o,autoComplete:"off",required:l&&!u,style:{...Ha,borderColor:l&&!e?ge.error:void 0}}),S&&d.jsxs("div",{style:{...e0,maxHeight:"250px",overflowY:"auto"},children:[u&&d.jsx("div",{onClick:$,onMouseEnter:()=>I(-1),style:{...Xu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${ge.primary} 20%, transparent)`:"transparent"},children:La}),D.map((Y,X)=>d.jsxs("div",{children:[Y.groupName&&d.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:Y.groupName}),Y.items.map(W=>{const te=k();return d.jsx("div",{onClick:()=>P(W),style:{...Xu,paddingLeft:Y.groupName?"1.2rem":"0.8rem",background:te===T?`color-mix(in srgb, ${ge.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>I(te),children:W.name},W.id)})]},`group-${X}`)),G.length===0&&w.trim()&&!u&&d.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function ki({children:t,onSubmit:e,actionName:n}){function r(i){e(i)}return d.jsx("form",{onSubmit:r,style:FP,children:t})}function Bt({label:t,htmlFor:e,children:n,hint:r,style:i}){return d.jsxs("div",{style:{...VP,...i},children:[d.jsx("label",{htmlFor:e,style:$P,children:t}),n,r&&d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function Mi(t){return d.jsx("input",{style:Ha,...t})}function aB(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function $f({value:t,onChange:e,style:n,autoFocus:r,...i}){const o=R.useRef(null),l=R.useRef(null),u=aB(t);R.useEffect(()=>{r&&l.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function f(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return d.jsxs("div",{style:{position:"relative"},children:[d.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...i}),d.jsx("div",{ref:l,tabIndex:0,onClick:h,onKeyDown:f,style:{...Ha,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:u||"Select date"})]})}function Zu({children:t,...e}){return d.jsx("select",{style:qP,...e,children:t})}function t0({minHeight:t="6rem",style:e,...n}){return d.jsx("textarea",{style:{...Ha,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function Ga({children:t}){return d.jsx("div",{style:KP,children:t})}function Yg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",i=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return i!==void 0?`$${o}.${i.slice(0,2)}`:o?`$${o}`:""}function oB(t){return t.replace(/[$,]/g,"")}function Io({id:t,value:e,onChange:n,placeholder:r="$0.00",required:i,autoFocus:o,style:l}){const[u,h]=R.useState(()=>Yg(e)),f=R.useRef(null);R.useEffect(()=>{const g=Yg(e);oB(u)!==e&&h(g)},[e]);function p(g){const b=g.target.value;if(!b||b==="$"){h(""),n("");return}const w=b.replace(/[^\d.]/g,"").split(".");let x=w[0];w.length>1&&(x+="."+w.slice(1).join("").slice(0,2));const S=Yg(x);h(S),n(x)}return d.jsx("input",{ref:f,id:t,type:"text",inputMode:"decimal",value:u,onChange:p,placeholder:r,required:i,autoFocus:o,style:{...Ha,...l}})}function Pi(t=Q6){const[e,n]=R.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return R.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function i(l){n(l.matches)}i(r),r.addEventListener("change",i);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",i),window.removeEventListener("resize",o)}},[t]),e}function YT(){const[t,e]=R.useState(()=>typeof window>"u"?1200:window.innerWidth);return R.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=Ao.wide,isMedium:t>=Ao.tablet&&t<Ao.wide,isNarrowMedium:t>=Ao.mobile&&t<Ao.tablet,isMobile:t<Ao.mobile}}function In(){const{selectedBudgetId:t,currentUserId:e}=Xe(),n=eP(t),r=n.data,i=r?.budget||null,o=R.useMemo(()=>r?.accounts||{},[r?.accounts]),l=R.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),u=R.useMemo(()=>r?.categories||{},[r?.categories]),h=R.useMemo(()=>{const M=r?.categoryGroups||[];return M.length>0?[...M]:[]},[r?.categoryGroups]),f=i?.owner_id===e,p=R.useMemo(()=>i?.user_ids||[],[i?.user_ids]),g=R.useMemo(()=>i?.accepted_user_ids||[],[i?.accepted_user_ids]),b=R.useMemo(()=>i?UT(o,u,l):0,[i,o,l,u]),_=R.useMemo(()=>r?.monthMap||{},[r?.monthMap]),w=R.useCallback(M=>{if(!t)return;const F=Be.getQueryData(we.budget(t));F&&Be.setQueryData(we.budget(t),{...F,accounts:M})},[t]),x=R.useCallback(M=>{if(!t)return;const F=Be.getQueryData(we.budget(t));F&&Be.setQueryData(we.budget(t),{...F,accountGroups:M})},[t]),S=R.useCallback(M=>{if(!t)return;const F=Be.getQueryData(we.budget(t));F&&Be.setQueryData(we.budget(t),{...F,categories:M,budget:{...F.budget,categories:M}})},[t]),C=R.useCallback(M=>{if(!t)return;const F=Be.getQueryData(we.budget(t));if(F){const G=[...M];Be.setQueryData(we.budget(t),{...F,categoryGroups:G,budget:{...F.budget,category_groups:G}})}},[t]),T=R.useCallback(async()=>{t&&await Be.invalidateQueries({queryKey:we.budget(t)})},[t]),I=R.useCallback(()=>Object.entries(o).filter(([,M])=>Q_(M,l)).reduce((M,[,F])=>M+F.balance,0),[o,l]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:i,accounts:o,accountGroups:l,categories:u,categoryGroups:h,isOwner:f,budgetUserIds:p,acceptedUserIds:g,totalAvailable:b,monthMap:_,setAccountsOptimistic:w,setAccountGroupsOptimistic:x,setCategoriesOptimistic:S,setCategoryGroupsOptimistic:C,refreshBudget:T,getOnBudgetTotal:I}}function Xs(t,e,n){const{addLoadingHold:r,removeLoadingHold:i}=Rn(),o=Rt(),l=PT(t,e,n,{enabled:!!t});R.useEffect(()=>{const T=t?we.month(t,e,n):null;if(!T){i("month-query");return}const I=!!l.data,M=o.getQueryState(T),F=M?.dataUpdatedAt?Date.now()-M.dataUpdatedAt>Yr:!1;return!I||F&&l.isFetching||l.isLoading?r("month-query","Loading month data..."):i("month-query"),()=>i("month-query")},[l.isLoading,l.isFetching,l.data,t,e,n,o,r,i]);const u=l.data?.month||null,h=R.useMemo(()=>u?.income||[],[u?.income]),f=R.useMemo(()=>u?.expenses||[],[u?.expenses]),p=R.useMemo(()=>u?.transfers||[],[u?.transfers]),g=R.useMemo(()=>u?.adjustments||[],[u?.adjustments]),b=R.useMemo(()=>u?.category_balances||[],[u?.category_balances]),_=R.useMemo(()=>u?.account_balances||[],[u?.account_balances]),w=u?.total_income||0,x=u?.total_expenses||0,S=u?.are_allocations_finalized||!1,C=u?.previous_month_income??0;return{isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,month:u,income:h,expenses:f,transfers:p,adjustments:g,categoryBalances:b,accountBalances:_,totalIncome:w,totalExpenses:x,areAllocationsFinalized:S,previousMonthIncome:C}}function Ko(){return{updateBudgetCacheAndTrack:(e,n)=>{Be.setQueryData(we.budget(e),n)}}}function XT(){const t=Rt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Nn(),{updateBudgetCacheAndTrack:r}=Ko(),i=En({onMutate:async l=>{const{budgetId:u,accounts:h}=l,f=we.budget(u);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,accounts:h};r(u,b)}if(e.type==="budget")try{await n(u,"budget")}catch(b){console.warn("[useUpdateAccounts] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{accounts:u}=l;return{accounts:u}},onError:(l,u,h)=>{h?.previousData&&t.setQueryData(we.budget(u.budgetId),h.previousData)}});return{updateAccounts:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function lB(){const t=Rt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Nn(),{updateBudgetCacheAndTrack:r}=Ko(),i=En({onMutate:async l=>{const{budgetId:u,accountGroups:h}=l,f=we.budget(u);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,accountGroups:h};r(u,b)}if(e.type==="budget")try{await n(u,"budget")}catch(b){console.warn("[useUpdateAccountGroups] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{accountGroups:u}=l;return{accountGroups:u}},onError:(l,u,h)=>{h?.previousData&&t.setQueryData(we.budget(u.budgetId),h.previousData)}});return{updateAccountGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}async function ZT(t,e,n){const r={[`categories.${e}`]:$_(),updated_at:new Date().toISOString()};await Di("budgets",t,r,n);const i=Be.getQueryData(we.budget(t));if(i?.categories&&e in i.categories){const{[e]:o,...l}=i.categories;Be.setQueryData(we.budget(t),{...i,categories:l,budget:{...i.budget,categories:l}})}}async function JT(t,e,n){const r={[`accounts.${e}`]:$_(),updated_at:new Date().toISOString()};await Di("budgets",t,r,n);const i=Be.getQueryData(we.budget(t));if(i?.accounts&&e in i.accounts){const{[e]:o,...l}=i.accounts;Be.setQueryData(we.budget(t),{...i,accounts:l,budget:{...i.budget,accounts:l}})}}async function eA(t,e,n,r){const i={[`account_groups.${e}`]:$_(),updated_at:new Date().toISOString()};for(const l of n)i[`accounts.${l}.account_group_id`]=Vt;await Di("budgets",t,i,r);const o=Be.getQueryData(we.budget(t));if(o?.accounts&&o?.accountGroups&&e in o.accountGroups){const{[e]:l,...u}=o.accountGroups,h={...o.accounts};for(const f of n)h[f]&&(h[f]={...h[f],account_group_id:Vt});Be.setQueryData(we.budget(t),{...o,accounts:h,accountGroups:u,budget:{...o.budget,accounts:h,account_groups:u}})}}async function Yo(t){const{budgetId:e,updates:n,description:r}=t,{total_available:i,is_needs_recalculation:o,...l}=n;let u={...l};if(u.accounts&&typeof u.accounts=="object"){const g=u.accounts;u={...u,accounts:Object.fromEntries(Object.entries(g).map(([b,_])=>{if(_&&typeof _=="object"){const{balance:w,...x}=_;return[b,x]}return[b,_]}))}}if(u.categories&&typeof u.categories=="object"){const g=u.categories;u={...u,categories:Object.fromEntries(Object.entries(g).map(([b,_])=>{if(_&&typeof _=="object"){const{balance:w,...x}=_;return[b,x]}return[b,_]}))}}const h={...u,updated_at:new Date().toISOString()},f=za(h);await Di("budgets",e,f,r);const p=Be.getQueryData(we.budget(e));p&&Be.setQueryData(we.budget(e),{...p,budget:{...p.budget,...n}})}const tA=Object.freeze(Object.defineProperty({__proto__:null,deleteBudgetAccountGroupKey:eA,deleteBudgetAccountKey:JT,deleteBudgetCategoryKey:ZT,writeBudgetData:Yo},Symbol.toStringTag,{value:"Module"}));function cB(){const t=Rt(),{currentViewingDocument:e}=Xe(),{updateBudgetCacheAndTrack:n}=Ko(),r=En({onMutate:async o=>{const{budgetId:l,accountId:u}=o,h=we.budget(l);await t.cancelQueries({queryKey:h});const f=t.getQueryData(h),p=e.type==="budget";if(f?.accounts&&u in f.accounts){const{[u]:g,...b}=f.accounts,_={...f,accounts:b,budget:{...f.budget,accounts:b}};t.setQueryData(h,_),p||n(l,_)}if(p)try{await JT(l,u,"accounts: delete (targeted key)")}catch(g){console.warn("[useDeleteAccount] Failed to delete account key:",g)}return{previousData:f}},mutationFn:async()=>{},onError:(o,l,u)=>{u?.previousData&&t.setQueryData(we.budget(l.budgetId),u.previousData)}});return{deleteAccount:{mutate:o=>r.mutate(o),mutateAsync:o=>r.mutateAsync(o),isPending:r.isPending,isError:r.isError,error:r.error,reset:r.reset}}}function uB(){const t=Rt(),{currentViewingDocument:e}=Xe(),{updateBudgetCacheAndTrack:n}=Ko(),r=En({onMutate:async o=>{const{budgetId:l,groupId:u,accountIdsToUngroup:h}=o,f=we.budget(l);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f),g=e.type==="budget";if(p?.accounts&&p?.accountGroups&&u in p.accountGroups){const{[u]:b,..._}=p.accountGroups,w={...p.accounts};for(const S of h)w[S]&&(w[S]={...w[S],account_group_id:Vt});const x={...p,accounts:w,accountGroups:_,budget:{...p.budget,accounts:w,account_groups:_}};t.setQueryData(f,x),g||n(l,x)}if(g)try{await eA(l,u,h,"account_groups: delete (targeted key)")}catch(b){console.warn("[useDeleteAccountGroup] Failed to delete account group key:",b)}return{previousData:p}},mutationFn:async()=>{},onError:(o,l,u)=>{u?.previousData&&t.setQueryData(we.budget(l.budgetId),u.previousData)}});return{deleteAccountGroup:{mutate:o=>r.mutate(o),mutateAsync:o=>r.mutateAsync(o),isPending:r.isPending,isError:r.isError,error:r.error,reset:r.reset}}}function nA(){const t=Rt(),{currentViewingDocument:e}=Xe(),{updateBudgetCacheAndTrack:n}=Ko(),r=En({onMutate:async o=>{const{budgetId:l,categories:u}=o,h=we.budget(l);await t.cancelQueries({queryKey:h});const f=t.getQueryData(h),p=e.type==="budget";if(f){const g={...f,categories:u,budget:{...f.budget,categories:u}};t.setQueryData(h,g),p||n(l,g)}if(p)try{await Yo({budgetId:l,updates:{categories:u},description:"categories: update (settings)"})}catch(g){console.warn("[useUpdateCategories] Failed to save categories immediately:",g)}return{previousData:f}},mutationFn:async o=>{const{categories:l}=o;return{categories:l}},onError:(o,l,u)=>{u?.previousData&&t.setQueryData(we.budget(l.budgetId),u.previousData)}});return{updateCategories:{mutate:o=>r.mutate(o),mutateAsync:o=>r.mutateAsync(o),isPending:r.isPending,isError:r.isError,error:r.error,reset:r.reset}}}function dB(){const t=Rt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Nn(),{updateBudgetCacheAndTrack:r}=Ko(),i=En({onMutate:async l=>{const{budgetId:u,categoryGroups:h}=l,f=we.budget(u);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,categoryGroups:h,budget:{...p.budget,category_groups:h}};r(u,b)}if(e.type==="budget")try{await n(u,"budget")}catch(b){console.warn("[useUpdateCategoryGroups] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{categoryGroups:u}=l;return{categoryGroups:u}},onError:(l,u,h)=>{h?.previousData&&t.setQueryData(we.budget(u.budgetId),h.previousData)}});return{updateCategoryGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function hB(){const t=Rt(),{currentViewingDocument:e}=Xe(),{updateBudgetCacheAndTrack:n}=Ko(),r=En({onMutate:async o=>{const{budgetId:l,categoryId:u}=o,h=we.budget(l);await t.cancelQueries({queryKey:h});const f=t.getQueryData(h),p=e.type==="budget";if(f?.categories&&u in f.categories){const{[u]:g,...b}=f.categories,_={...f,categories:b,budget:{...f.budget,categories:b}};t.setQueryData(h,_),p||n(l,_)}if(p)try{await ZT(l,u,"categories: delete (targeted key)")}catch(g){console.warn("[useDeleteCategory] Failed to delete category key:",g)}return{previousData:f}},mutationFn:async()=>{},onError:(o,l,u)=>{u?.previousData&&t.setQueryData(we.budget(l.budgetId),u.previousData)}});return{deleteCategory:{mutate:o=>r.mutate(o),mutateAsync:o=>r.mutateAsync(o),isPending:r.isPending,isError:r.isError,error:r.error,reset:r.reset}}}function fB(){const t=Rt(),e=En({onMutate:async r=>{const{budgetId:i,newName:o}=r,l=we.budget(i);await t.cancelQueries({queryKey:l});const u=t.getQueryData(l);return u&&t.setQueryData(l,{...u,budget:{...u.budget,name:o.trim()}}),{previousData:u}},mutationFn:async r=>{const{budgetId:i,newName:o}=r,l=o.trim();return await Yo({budgetId:i,updates:{name:l},description:`renaming budget to "${l}"`}),{newName:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(we.budget(i.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function mB({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:i,saveAccounts:o,saveAccountGroups:l,setError:u}){const h=R.useCallback(async(p,g,b)=>{const _=e[p];if(!_)return;const w=b==="ungrouped"?Vt:b,x=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===b),S={};Object.entries(e).forEach(([T,I])=>{T!==p&&(S[T]={...I})});let C;if(g==="__group_end__"||x.length===0||!x.find(([T])=>T===g))C=(x.length>0?Math.max(...x.filter(([I])=>I!==p).map(([,I])=>I.sort_order)):-1)+1;else{const T=x.find(([I])=>I===g);if(T){const[,I]=T;C=I.sort_order,Object.entries(S).forEach(([M,F])=>{(F.account_group_id||"ungrouped")===b&&F.sort_order>=C&&(S[M]={...F,sort_order:F.sort_order+1})})}else C=0}if(S[p]={..._,account_group_id:w,sort_order:C},r(S),!!t)try{await o(S)}catch(T){u(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,u]),f=R.useCallback(async(p,g)=>{if(p===g)return;const b=Object.entries(n).sort(([,C],[,T])=>C.sort_order-T.sort_order),_=b.findIndex(([C])=>C===p),w=[...b],[x]=w.splice(_,1);if(g==="__end__")w.push(x);else{const C=w.findIndex(([T])=>T===g);w.splice(C,0,x)}const S={};if(w.forEach(([C,T],I)=>{S[C]={...T,sort_order:I}}),i(S),!!t)try{await l(S)}catch(C){u(C instanceof Error?C.message:"Failed to save new order")}},[t,n,i,l,u]);return{reorderAccountsInGroup:h,reorderGroups:f}}function pB(){const{selectedBudgetId:t}=Xe(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o}=In(),{updateAccounts:l}=XT(),{updateAccountGroups:u}=lB(),{deleteAccount:h}=cB(),{deleteAccountGroup:f}=uB(),[p,g]=R.useState(null),b=R.useCallback(async V=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accounts:V})},[t,l]),_=R.useCallback(async V=>{if(!t)throw new Error("No budget selected");await u.mutateAsync({budgetId:t,accountGroups:V})},[t,u]),w=R.useMemo(()=>Object.entries(n).filter(([,V])=>!V.is_hidden).reduce((V,[j,B])=>{const k=B.account_group_id||Vt;return V[k]||(V[k]=[]),V[k].push({...B,id:j}),V},{}),[n]),x=R.useMemo(()=>Object.entries(n).filter(([,V])=>V.is_hidden).map(([V,j])=>({...j,id:V})).sort((V,j)=>V.sort_order-j.sort_order),[n]),S=R.useMemo(()=>Object.entries(r).sort(([,V],[,j])=>V.sort_order-j.sort_order).map(([V,j])=>({...j,id:V})),[r]),C=R.useCallback((V,j)=>{if(!e)return;const B=j||Vt,k=Object.values(n).filter(H=>H.account_group_id===B),Y=k.length>0?Math.max(...k.map(H=>H.sort_order)):-1,X=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,W={nickname:V.nickname,description:"",balance:0,account_group_id:B,sort_order:Y+1,is_income_account:V.is_income_account??!1,is_income_default:V.is_income_default??!1,is_outgo_account:V.is_outgo_account??!1,is_outgo_default:V.is_outgo_default??!1,on_budget:V.on_budget!==!1,is_active:V.is_active!==!1,is_hidden:V.is_hidden??!1},te={...n};V.is_income_default&&Object.keys(te).forEach(H=>{te[H]={...te[H],is_income_default:!1}}),V.is_outgo_default&&Object.keys(te).forEach(H=>{te[H]={...te[H],is_outgo_default:!1}}),te[X]=W,i(te),b(te).catch(H=>g(H instanceof Error?H.message:"Failed to create account."))},[e,n,i,b]),T=R.useCallback((V,j)=>{if(!e)return;const B=n[V];if(!B)return;const k=B.account_group_id||Vt,Y=j.account_group_id||Vt;let X=B.sort_order;if(k!==Y){const te=Object.values(n).filter(H=>H.account_group_id===Y);X=te.length>0?Math.max(...te.map(H=>H.sort_order))+1:0}const W={};Object.entries(n).forEach(([te,H])=>{te===V?W[te]={...H,nickname:j.nickname,account_group_id:Y,sort_order:X,is_income_account:j.is_income_account??!1,is_income_default:j.is_income_default??!1,is_outgo_account:j.is_outgo_account??!1,is_outgo_default:j.is_outgo_default??!1,on_budget:j.on_budget!==!1,is_active:j.is_active!==!1,is_hidden:j.is_hidden??!1}:(W[te]={...H},j.is_income_default&&!B.is_income_default&&(W[te].is_income_default=!1),j.is_outgo_default&&!B.is_outgo_default&&(W[te].is_outgo_default=!1))}),i(W),b(W).catch(te=>g(te instanceof Error?te.message:"Failed to save account."))},[e,n,i,b]),I=R.useCallback(V=>{confirm("Are you sure you want to delete this account?")&&(!e||!t||h.mutateAsync({budgetId:t,accountId:V}).catch(j=>g(j instanceof Error?j.message:"Failed to delete account.")))},[e,t,h]),M=R.useCallback(async(V,j)=>{const B=n[V];if(!B)return;const k=B.account_group_id||Vt,Y=Object.entries(n).filter(([,N])=>N.account_group_id===k).sort(([,N],[,q])=>N.sort_order-q.sort_order),X=Y.findIndex(([N])=>N===V),W=j==="up"?X-1:X+1;if(W<0||W>=Y.length)return;const[te,H]=Y[W],re={};if(Object.entries(n).forEach(([N,q])=>{N===V?re[N]={...q,sort_order:H.sort_order}:N===te?re[N]={...q,sort_order:B.sort_order}:re[N]={...q}}),i(re),!!e)try{await b(re)}catch(N){i(n),g(N instanceof Error?N.message:"Failed to move account")}},[e,n,i,b]),F=R.useCallback(V=>{if(!e)return;const j=Object.values(r).map(W=>W.sort_order),B=j.length>0?Math.max(...j):-1,k=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,Y={name:V.name,sort_order:B+1,expected_balance:V.expected_balance,on_budget:V.on_budget??null,is_active:V.is_active??null},X={...r,[k]:Y};o(X),_(X).catch(W=>g(W instanceof Error?W.message:"Failed to create account type."))},[e,r,o,_]),G=R.useCallback((V,j)=>{if(!e)return;const B={...r,[V]:{...r[V],name:j.name,expected_balance:j.expected_balance,on_budget:j.on_budget??null,is_active:j.is_active??null}};o(B),_(B).catch(k=>g(k instanceof Error?k.message:"Failed to update account type."))},[e,r,o,_]),D=R.useCallback(V=>{if(V===Vt){alert("Cannot delete the default Ungrouped account type.");return}if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e||!t)return;const j=Object.entries(n).filter(([,B])=>(B.account_group_id||Vt)===V).map(([B])=>B);f.mutateAsync({budgetId:t,groupId:V,accountIdsToUngroup:j}).catch(B=>g(B instanceof Error?B.message:"Failed to delete account type."))},[e,t,n,f]),O=R.useCallback(async(V,j)=>{const B=Object.entries(r).sort(([,te],[,H])=>te.sort_order-H.sort_order),k=B.findIndex(([te])=>te===V),Y=j==="up"?k-1:k+1;if(Y<0||Y>=B.length)return;const[X]=B.splice(k,1);B.splice(Y,0,X);const W={};if(B.forEach(([te,H],re)=>{W[te]={...H,sort_order:re}}),o(W),!!e)try{await _(W)}catch(te){o(r),g(te instanceof Error?te.message:"Failed to move account type")}},[e,r,o,_]),{reorderAccountsInGroup:P,reorderGroups:$}=mB({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o,saveAccounts:b,saveAccountGroups:_,setError:g});return{accounts:n,accountGroups:r,accountsByGroup:w,hiddenAccounts:x,sortedGroups:S,currentBudget:e,error:p,setError:g,handleCreateAccount:C,handleUpdateAccount:T,handleDeleteAccount:I,handleMoveAccount:M,handleCreateGroup:F,handleUpdateGroup:G,handleDeleteGroup:D,handleMoveGroup:O,reorderAccountsInGroup:P,reorderGroups:$}}function FS(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,i])=>{if(i.default_monthly_type==="percentage")return;const o=t.category_balances?.find(l=>l.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():i.default_monthly_amount!==void 0&&i.default_monthly_amount>0?n[r]=i.default_monthly_amount.toString():n[r]=""}),n}function gB(){const t=Rt(),{addLoadingHold:e,removeLoadingHold:n}=Rn(),{selectedBudgetId:r,currentYear:i,currentMonthNumber:o}=Xe(),{categories:l,getOnBudgetTotal:u,totalAvailable:h}=In(),{month:f,isLoading:p,previousMonthIncome:g,areAllocationsFinalized:b}=Xs(r,i,o),_=R.useMemo(()=>f?.income?f.income.reduce((N,q)=>N+q.amount,0):0,[f]),{saveDraftAllocations:w}=UP(),{finalizeAllocations:x}=oz(),{deleteAllocations:S}=pA(),C=R.useMemo(()=>FS(f,l),[f,l]),[T,I]=R.useState(C),[M,F]=R.useState(!1),G=R.useRef(null);R.useMemo(()=>Object.values(l).reduce((N,q)=>N+(q.balance??0),0),[l]),R.useEffect(()=>{if(!f)return;const N=`${f.year}-${f.month}`;G.current!==N&&(F(!1),I(FS(f,l)),G.current=N)},[f,l]);const D=R.useCallback((N,q)=>{if(q.default_monthly_type==="percentage"&&q.default_monthly_amount!==void 0)return Te(q.default_monthly_amount/100*g);const J=T[N],ne=parseFloat(J||"0");return isNaN(ne)?0:Te(ne)},[T,g]),O=R.useMemo(()=>Object.entries(l).reduce((N,[q,J])=>{const ne=D(q,J),ae=J.balance??0;if(ae<0){const Ee=Math.abs(ae),Ae=Math.max(0,ne-Ee);return N+Ae}return N+ne},0),[l,D]),P=u(),$=b?(f?.category_balances||[]).reduce((N,q)=>{const J=l[q.category_id]?.balance??0,ne=q.allocated,ae=J-ne;if(ae<0){const Ee=Math.abs(ae);return N+Math.max(0,ne-Ee)}return N+ne},0):0,V=M?h+$:h,j=R.useMemo(()=>M?V-O:V-O+$,[V,O,$,M]),B=R.useCallback((N,q)=>{I(J=>({...J,[N]:q}))},[]),k=R.useCallback(()=>{if(!f)return;const N={};Object.entries(l).forEach(([q,J])=>{if(J.default_monthly_type==="percentage")return;const ne=f.category_balances?.find(ae=>ae.category_id===q);ne&&ne.allocated>0?N[q]=ne.allocated.toString():J.default_monthly_amount!==void 0&&J.default_monthly_amount>0?N[q]=J.default_monthly_amount.toString():N[q]=""}),I(N),F(!1)},[f,l]),Y=R.useCallback(async()=>{if(r){e("allocations-edit","Loading allocations...");try{const N=await kT(r,i,o,"Edit Allocations"),q=we.month(r,i,o);t.setQueryData(q,{month:N}),F(!0)}catch(N){console.error("[useAllocationsPage] Edit Allocations failed:",N),qn.add({type:"error",message:"Failed to load allocations. See console for details.",autoDismissMs:0})}finally{n("allocations-edit")}}},[r,i,o,t,e,n]),X=R.useCallback(()=>{const N={};return Object.entries(l).forEach(([q,J])=>{const ne=D(q,J);ne>0&&(N[q]=ne)}),N},[l,D]),W=R.useCallback(async()=>{if(r){e("allocations-save","Saving allocations...");try{await w(r,i,o,X()),F(!1)}catch(N){console.error("[useAllocationsPage] Save allocations failed:",N),qn.add({type:"error",message:"Failed to save allocations. See console for details.",autoDismissMs:0})}finally{n("allocations-save")}}},[r,i,o,w,X,e,n]),te=R.useCallback(async()=>{if(r){e("allocations-finalize","Applying allocations...");try{await x({budgetId:r,year:i,month:o,allocations:X(),onProgress:N=>{e("allocations-finalize",N.message)}}),F(!1)}catch(N){console.error("[useAllocationsPage] Finalize allocations failed:",N),qn.add({type:"error",message:"Failed to apply allocations. See console for details.",autoDismissMs:0})}finally{n("allocations-finalize")}}},[r,i,o,x,X,e,n]),H=R.useCallback(async()=>{if(r){e("allocations-delete","Deleting allocations...");try{await S({budgetId:r,year:i,month:o,onProgress:q=>{e("allocations-delete",q.message)}});const N={};Object.entries(l).forEach(([q,J])=>{J.default_monthly_type!=="percentage"&&(J.default_monthly_amount!==void 0&&J.default_monthly_amount>0?N[q]=J.default_monthly_amount.toString():N[q]="")}),I(N),F(!1)}catch(N){console.error("[useAllocationsPage] Delete allocations failed:",N),qn.add({type:"error",message:"Failed to delete allocations. See console for details.",autoDismissMs:0})}finally{n("allocations-delete")}}},[r,i,o,S,l,e,n]),re=O-$;return{localAllocations:T,isEditingAppliedAllocations:M,monthLoading:p,onBudgetTotal:P,availableNow:V,currentDraftTotal:O,draftChangeAmount:re,availableAfterApply:j,previousMonthIncome:g,currentMonthIncome:_,allocationsFinalized:b,getAllocationAmount:D,handleAllocationChange:B,resetAllocationsToSaved:k,handleSaveAllocations:W,handleFinalizeAllocations:te,handleDeleteAllocations:H,handleEditAllocations:Y,setIsEditingAppliedAllocations:F}}function yB({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:i}){const o=Object.keys(e),l=o.length>0,u=R.useMemo(()=>{const w={};return Object.entries(e).forEach(([x,S])=>{w[x]={current:S.balance??0,total:S.balance??0}}),w},[e]),[h,f]=R.useState(!1),[p,g]=R.useState(null),b=R.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const w=Object.keys(e),{total:x}=await zS(t,w,n,r),S={};Object.entries(e).forEach(([T,I])=>{const M=I.balance,F=x[T]??0;Math.abs(M-F)>.01&&(S[T]={stored:M,calculated:F})});const C=Object.keys(S).length>0?S:null;return g(C),C},[t,e,n,r]),_=R.useCallback(async()=>{if(!(!t||!l)){f(!0);try{const{total:w}=await zS(t,o,n,r),x={};Object.entries(e).forEach(([S,C])=>{x[S]={...C,balance:w[S]??0}}),await i(x),g(null)}finally{f(!1)}}},[t,e,i,n,r,o,l]);return{categoryBalances:u,loadingBalances:h,categoryBalanceMismatch:p,checkCategoryBalanceMismatch:b,recalculateAndSaveCategoryBalances:_}}function _B({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:i,saveCategories:o,saveCategoryGroups:l,setError:u}){const[h,f]=R.useState(null),[p,g]=R.useState(null),[b,_]=R.useState(null),[w,x]=R.useState(null);function S(O,P){f("category"),g(P),O.dataTransfer.effectAllowed="move"}function C(O,P,$){O.preventDefault(),h==="category"&&(P!==p&&_(P),x($))}function T(O,P){O.preventDefault(),h==="category"&&(x(P),_(null))}function I(){_(null)}function M(){x(null)}function F(){f(null),g(null),_(null),x(null)}async function G(O,P,$){if(O.preventDefault(),O.stopPropagation(),!p||h!=="category"){F();return}const V=t[p];if(!V)return;const j=$==="ungrouped"?en:$,B=Object.entries(t).filter(([,X])=>(X.category_group_id||"ungrouped")===$),k={};Object.entries(t).forEach(([X,W])=>{X!==p&&(k[X]=W)});let Y;if(P==="__group_end__"||B.length===0||!B.find(([X])=>X===P))Y=(B.length>0?Math.max(...B.filter(([W])=>W!==p).map(([,W])=>W.sort_order)):-1)+1;else{const X=B.find(([W])=>W===P);X?(Y=X[1].sort_order,Object.entries(k).forEach(([W,te])=>{(te.category_group_id||"ungrouped")===$&&te.sort_order>=Y&&(k[W]={...te,sort_order:te.sort_order+1})})):Y=0}if(k[p]={...V,category_group_id:j,sort_order:Y},r(k),F(),!!n)try{await o(k)}catch(X){u(X instanceof Error?X.message:"Failed to save changes")}}async function D(O,P){O.preventDefault(),h==="category"&&await G(O,"__group_end__",P)}return{dragType:h,draggedId:p,dragOverId:b,dragOverGroupId:w,setDragOverId:_,setDragOverGroupId:x,handleCategoryDragStart:S,handleCategoryDragOver:C,handleDragOverGroup:T,handleDragLeave:I,handleDragLeaveGroup:M,handleDragEnd:F,handleCategoryDrop:G,handleDropOnGroup:D}}function bB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{budget:r,categories:i,categoryGroups:o,isLoading:l,setCategoriesOptimistic:u,setCategoryGroupsOptimistic:h,getOnBudgetTotal:f}=In(),{updateCategories:p}=nA(),{updateCategoryGroups:g}=dB(),{deleteCategory:b}=hB(),[_,w]=R.useState(null),x=R.useCallback(async H=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:H})},[t,p]),S=R.useCallback(async H=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:H})},[t,g]),C=R.useCallback(async(H,re)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:H}),g.mutateAsync({budgetId:t,categoryGroups:re})])},[t,p,g]),{categoryBalances:T,loadingBalances:I,categoryBalanceMismatch:M,checkCategoryBalanceMismatch:F,recalculateAndSaveCategoryBalances:G}=yB({budgetId:t,categories:i,currentYear:e,currentMonth:n,updateCategoriesWithBalances:x}),D=_B({categories:i,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:u,setCategoryGroupsOptimistic:h,saveCategories:x,saveCategoryGroups:S,setError:w});async function O(H,re){if(!r)return;const N=re||en,q=Object.values(i).filter(Ae=>Ae.category_group_id===N),J=q.length>0?Math.max(...q.map(Ae=>Ae.sort_order)):-1,ne=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,ae={name:H.name,description:H.description??"",category_group_id:N,sort_order:J+1,default_monthly_amount:H.default_monthly_amount??0,default_monthly_type:H.default_monthly_type??"fixed",balance:0,is_hidden:H.is_hidden??!1},Ee={...i,[ne]:ae};u(Ee);try{await x(Ee)}catch(Ae){u(i);const ce=Ae instanceof Error?Ae.message:"Failed to create category";throw w(ce),Ae}}async function P(H,re){if(r)try{const N=i[H];if(!N)return;const q=N.category_group_id||en,J=re.category_group_id||en;let ne=N.sort_order;if(q!==J){const Ee=Object.values(i).filter(Ae=>Ae.category_group_id===J&&Ae!==N);ne=Ee.length>0?Math.max(...Ee.map(Ae=>Ae.sort_order))+1:0}const ae={...i,[H]:{...N,name:re.name,description:re.description??"",category_group_id:J,sort_order:ne,default_monthly_amount:re.default_monthly_amount??0,default_monthly_type:re.default_monthly_type??"fixed",is_hidden:re.is_hidden??!1}};u(ae),await x(ae)}catch(N){w(N instanceof Error?N.message:"Failed to update category")}}async function $(H){if(confirm("Are you sure you want to delete this category?")&&!(!r||!t))try{await b.mutateAsync({budgetId:t,categoryId:H})}catch(re){w(re instanceof Error?re.message:"Failed to delete category")}}async function V(H,re){const N=i[H];if(!N)return;const q=N.category_group_id||en,J=Object.entries(i).filter(([,fe])=>fe.category_group_id===q).sort((fe,Oe)=>fe[1].sort_order-Oe[1].sort_order),ne=J.findIndex(([fe])=>fe===H),ae=re==="up"?ne-1:ne+1;if(ae<0||ae>=J.length)return;const[Ee,Ae]=J[ae],ce={};if(Object.entries(i).forEach(([fe,Oe])=>{fe===H?ce[fe]={...Oe,sort_order:Ae.sort_order}:fe===Ee?ce[fe]={...Oe,sort_order:N.sort_order}:ce[fe]=Oe}),u(ce),!!r)try{await x(ce)}catch(fe){u(i),w(fe instanceof Error?fe.message:"Failed to move category")}}async function j(H){if(r)try{const re=o.length>0?Math.max(...o.map(J=>J.sort_order)):-1,N={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:H.name,sort_order:re+1},q=[...o,N];h(q),await S(q)}catch(re){w(re instanceof Error?re.message:"Failed to create group")}}async function B(H,re){if(r)try{const N=o.map(q=>q.id===H?{...q,name:re.name}:q);h(N),await S(N)}catch(N){w(N instanceof Error?N.message:"Failed to update group")}}async function k(H){if(H===en){alert("Cannot delete the default Uncategorized category group.");return}if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const re={};Object.entries(i).forEach(([q,J])=>{re[q]=J.category_group_id===H?{...J,category_group_id:en}:J});const N=o.filter(q=>q.id!==H);u(re),h(N),await C(re,N)}catch(re){w(re instanceof Error?re.message:"Failed to delete group")}}async function Y(H,re){const N=o.filter(ce=>ce.id!==en).sort((ce,fe)=>ce.sort_order-fe.sort_order),q=o.find(ce=>ce.id===en),J=N.findIndex(ce=>ce.id===H),ne=re==="up"?J-1:J+1;if(ne<0||ne>=N.length)return;const[ae]=N.splice(J,1);N.splice(ne,0,ae);const Ee=N.map((ce,fe)=>({...ce,sort_order:fe})),Ae=[...Ee,...q?[{...q,sort_order:Ee.length}]:[]];if(h(Ae),!!r)try{await S(Ae)}catch(ce){h(o),w(ce instanceof Error?ce.message:"Failed to move group")}}const X=R.useMemo(()=>Object.entries(i).filter(([,H])=>!H.is_hidden).reduce((H,[re,N])=>{const q=N.category_group_id||en;return H[q]||(H[q]=[]),H[q].push([re,N]),H},{}),[i]),W=R.useMemo(()=>Object.entries(i).filter(([,H])=>H.is_hidden).map(([H,re])=>[H,re]).sort((H,re)=>H[1].sort_order-re[1].sort_order),[i]),te=R.useMemo(()=>[...o].sort((H,re)=>H.sort_order-re.sort_order),[o]);return{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:X,hiddenCategories:W,sortedGroups:te,categoryBalances:T,isLoading:l,loadingBalances:I,error:_,setError:w,getOnBudgetTotal:f,categoryBalanceMismatch:M,checkCategoryBalanceMismatch:F,recalculateAndSaveCategoryBalances:G,handleCreateCategory:O,handleUpdateCategory:P,handleDeleteCategory:$,handleMoveCategory:V,handleCreateGroup:j,handleUpdateGroup:B,handleDeleteGroup:k,handleMoveGroup:Y,dragType:D.dragType,draggedId:D.draggedId,dragOverId:D.dragOverId,dragOverGroupId:D.dragOverGroupId,setDragOverId:D.setDragOverId,setDragOverGroupId:D.setDragOverGroupId,handleCategoryDragStart:D.handleCategoryDragStart,handleCategoryDragOver:D.handleCategoryDragOver,handleDragOverGroup:D.handleDragOverGroup,handleDragLeave:D.handleDragLeave,handleDragLeaveGroup:D.handleDragLeaveGroup,handleDragEnd:D.handleDragEnd,handleCategoryDrop:D.handleCategoryDrop,handleDropOnGroup:D.handleDropOnGroup}}function vB({categories:t,categoryBalances:e,totalAvailable:n,onBudgetTotal:r,isDataLoading:i,loadingBalances:o,currentBudget:l}){const u=R.useMemo(()=>Object.values(t).reduce((x,S)=>x+Math.max(0,S.balance??0),0),[t]),h=R.useMemo(()=>Object.values(e).reduce((x,S)=>x+Math.max(0,S.total),0),[e]),f=u,p=R.useMemo(()=>Object.values(t).reduce((x,S)=>x+Math.max(0,S.balance??0),0),[t]),g=n,b=R.useMemo(()=>Math.abs(u-h)>.01,[u,h]),_=R.useMemo(()=>Math.abs(r-(f+g))>.01,[r,f,g]),w=R.useMemo(()=>Math.abs(u-p)>.01,[u,p]);return R.useEffect(()=>{},[b,_,w,u,h,f,g,r,p,i,o,l]),{allocatedFromStored:u,allocatedFromCalculated:h,allocated:f,unallocated:g,monthViewAllTime:p,calculationMismatch:b,relationshipMismatch:_,monthViewMismatch:w}}function xB(t,e,n,r){const i={budget_id:e,year_month_ordinal:t.year_month_ordinal??He(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return bd(i)}async function wB(t){const e=new Date,n=e.getFullYear(),r=e.getMonth()+1;let i=n,o=r-3;for(;o<=0;)o+=12,i-=1;const l=He(i,o);return(await or("months","useInitialDataLoad: loading initial months",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:l}])).docs.map(f=>{const p=f.data,g=p.year,b=p.month;return xB(p,t,g,b)}).sort((f,p)=>f.year!==p.year?f.year-p.year:f.month-p.month)}function SB(t,e){if(e<1)return t;const n=new Map;for(const r of t)n.set(`${r.year}/${r.month}`,r);return t.map(r=>{const i=vm(r.year,r.month,e);if(!i)return r;const o=n.get(`${i.year}/${i.month}`);if(!o)return r;const l=o.income||[],u=Te(l.reduce((h,f)=>h+(f.amount||0),0));return{...r,previous_month_income:u}})}async function EB(t){const[e,n,r]=await Promise.all([G_(t),BT(t),wB(t)]),i=e.budget.percentage_income_months_back??1,o=SB(r,i);return{budget:e,payees:n,months:o}}function CB(t,e){return Vo({queryKey:t?["initialDataLoad",t]:["initialDataLoad","none"],queryFn:()=>EB(t),enabled:!!t&&e?.enabled!==!1,staleTime:1/0})}async function TB(t,e,n,r){const i=we.month(t,e,n),o=r.getQueryData(i);if(!o?.month)throw new Error(`Month ${e}/${n} not found in cache`);const l=o.month,u=await AB(t,e,n,r),h=oc(l,u);return r.setQueryData(i,{month:h}),h}async function AB(t,e,n,r){const{year:i,month:o}=wc(e,n),l=we.month(t,i,o),u=r.getQueryData(l);if(u?.month)return Uo(u.month);try{const h=await lr(t,i,o,{description:`fetching previous month ${i}/${o} for recalculation`});if(h)return Uo(h)}catch(h){console.warn(`[useLocalRecalculation] Could not fetch previous month ${i}/${o}:`,h)}return xd}async function jB(t,e,n){const i=n.getQueryCache().findAll({predicate:h=>h.queryKey[0]==="month"&&h.queryKey[1]===t&&h.state.status==="success"&&h.state.data!=null});if(i.length===0)return;const o=[];for(const h of i){const f=h.queryKey,p=f[2],g=f[3],b=n.getQueryData(h.queryKey);b?.month&&o.push({year:p,month:g,monthDoc:b.month})}o.sort((h,f)=>h.year!==f.year?h.year-f.year:h.month-f.month);const l=new Map;for(const{year:h,month:f,monthDoc:p}of o)l.set(`${h}/${f}`,p);let u=xd;for(const{year:h,month:f,monthDoc:p}of o){const g=vm(h,f,e),b=g?(()=>{const x=l.get(`${g.year}/${g.month}`);if(!x)return 0;const S=x.income||[];return Te(S.reduce((C,T)=>C+(T.amount||0),0))})():0,_=oc(p,u,b),w=we.month(t,h,f);n.setQueryData(w,{month:_}),u=Uo(_)}}function RB(t,e,n){const r=Rt(),i=R.useRef(null),o=R.useRef(null),l=R.useRef(null),u=R.useCallback((h,f)=>{if(!t)return;const p=we.month(t,h,f);if(r.getQueryData(p))return;const b=r.getQueryData(we.budget(t)),_=He(h,f);b?.monthMap&&_ in b.monthMap&&r.prefetchQuery({queryKey:p,queryFn:async()=>{const x=await Cm(t,h,f);return x?{month:x}:null},staleTime:Yr}).catch(x=>{console.warn(`[useMonthPrefetch] Failed to prefetch month ${h}/${f}:`,x)})},[t,r]);R.useEffect(()=>{if(!t)return;const h=`${t}-${e}-${n}`;if(l.current===h)return;l.current=h;const f=Yu(e,n);u(f.year,f.month)},[t,e,n,u]),R.useEffect(()=>{if(i.current===null||o.current===null){i.current=e,o.current=n;return}if(i.current===e&&o.current===n)return;if(!t){i.current=e,o.current=n;return}const h=He(i.current,o.current),g=He(e,n)>h?Yu(e,n):wc(e,n);u(g.year,g.month),i.current=e,o.current=n},[t,e,n,u])}function IB(t,e){const n={};Object.keys(e).forEach(l=>{n[l]=0});const r=Be.getQueryData(we.budget(t));if(!r)return n;const i=r.budget.month_map||{},o=Object.keys(i).sort();for(const l of o){const u=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),f=we.month(t,u,h),p=Be.getQueryData(f);if(!p?.month)continue;const g=p.month;for(const b of g.account_balances||[])b.account_id&&!Ye(b.account_id)&&n[b.account_id]===0&&(n[b.account_id]=b.start_balance??0)}for(const l of o){const u=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),f=we.month(t,u,h),p=Be.getQueryData(f);if(!p?.month)continue;const g=p.month;for(const b of g.income||[])b.account_id&&!Ye(b.account_id)&&n[b.account_id]!==void 0&&(n[b.account_id]+=b.amount);for(const b of g.expenses||[])b.account_id&&!Ye(b.account_id)&&n[b.account_id]!==void 0&&(n[b.account_id]+=b.amount);for(const b of g.transfers||[])b.to_account_id&&!Ye(b.to_account_id)&&n[b.to_account_id]!==void 0&&(n[b.to_account_id]+=b.amount),b.from_account_id&&!Ye(b.from_account_id)&&n[b.from_account_id]!==void 0&&(n[b.from_account_id]-=b.amount);for(const b of g.adjustments||[])b.account_id&&!Ye(b.account_id)&&n[b.account_id]!==void 0&&(n[b.account_id]+=b.amount)}for(const l of Object.keys(n))n[l]=Te(n[l]);return n}function DB(t){const e=Be.getQueryData(we.budget(t));if(!e){console.warn("[recalculateBudgetAccountBalancesFromCache] Budget not in cache");return}const n=IB(t,e.accounts),r={};for(const[i,o]of Object.entries(e.accounts))r[i]={...o,balance:Te(n[i]??o.balance)};Be.setQueryData(we.budget(t),{...e,accounts:r,budget:{...e.budget,accounts:r}})}function VS(t){return{year:parseInt(t.substring(0,4),10),month:parseInt(t.substring(4,6),10)}}async function kB(t){const e=Be.getQueryData(we.budget(t));if(!e){console.warn("[recalculateBudgetCategoryBalancesFromCache] Budget not in cache");return}const n=Object.keys(e.categories);if(n.length===0)return;const r=new Date,i=r.getFullYear(),o=r.getMonth()+1,l=He(i,o),u=e.monthMap||{},h={};n.forEach(C=>{h[C]=0});const f=Object.keys(u).sort(),p=we.month(t,i,o),g=Be.getQueryData(p);if(g?.month?.category_balances)for(const C of g.month.category_balances)n.includes(C.category_id)&&(h[C.category_id]=C.end_balance??0);else{let C=!1;for(let T=f.length-1;T>=0&&!C;T--){const I=f[T];if(I>l)continue;const{year:M,month:F}=VS(I),G=we.month(t,M,F),D=Be.getQueryData(G);if(D?.month?.category_balances){C=!0;for(const O of D.month.category_balances)n.includes(O.category_id)&&(h[O.category_id]=O.end_balance??0)}}if(!C&&f.length>0)for(const T of f){if(T>l)break;const{year:I,month:M}=VS(T),F=we.month(t,I,M),G=Be.getQueryData(F);if(G?.month){const D=G.month;if(D.are_allocations_finalized&&D.category_balances)for(const O of D.category_balances)n.includes(O.category_id)&&(h[O.category_id]=(h[O.category_id]||0)+(O.allocated||0));if(D.expenses)for(const O of D.expenses)n.includes(O.category_id)&&(h[O.category_id]=(h[O.category_id]||0)-O.amount);if(D.adjustments)for(const O of D.adjustments)O.category_id&&n.includes(O.category_id)&&(h[O.category_id]=(h[O.category_id]||0)+O.amount);if(D.transfers)for(const O of D.transfers)O.to_category_id&&n.includes(O.to_category_id)&&(h[O.to_category_id]=(h[O.to_category_id]||0)+O.amount),O.from_category_id&&n.includes(O.from_category_id)&&(h[O.from_category_id]=(h[O.from_category_id]||0)-O.amount)}}}const b=He(i+Math.floor((o+Ws-1)/12),(o+Ws-1)%12+1);let _=i,w=o;for(let C=0;C<Ws*2;C++){const T=Yu(_,w);_=T.year,w=T.month;const I=He(_,w);if(I>b||!(I in u))break;const M=we.month(t,_,w),F=Be.getQueryData(M);if(!F?.month)break;const G=F.month;if(G.are_allocations_finalized&&G.category_balances)for(const D of G.category_balances)n.includes(D.category_id)&&(h[D.category_id]=(h[D.category_id]||0)+(D.allocated||0));if(G.expenses)for(const D of G.expenses)n.includes(D.category_id)&&(h[D.category_id]=(h[D.category_id]||0)-D.amount)}const x={};for(const C of n)x[C]=Te(h[C]||0);const S={};for(const[C,T]of Object.entries(e.categories))S[C]={...T,balance:Te(x[C]??T.balance)};Be.setQueryData(we.budget(t),{...e,categories:S,budget:{...e.budget,categories:S}})}function MB(t){return{year:parseInt(t.substring(0,4),10),month:parseInt(t.substring(4,6),10)}}function OB(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1,o=He(r,i);let l=r,u=i+Ws;for(;u>12;)u-=12,l+=1;const h=He(l,u),f=[],p=Object.keys(e).sort();for(const g of p){if(g<o)continue;if(g>h)break;const{year:b,month:_}=MB(g),w=we.month(t,b,_),x=Be.getQueryState(w),S=!x?.data,C=x?.dataUpdatedAt?Date.now()-x.dataUpdatedAt>Yr:!0;(S||C)&&f.push({year:b,month:_,ordinal:g})}return f}async function rA(t,e,n=!0){const r=Be.getQueryData(we.budget(t));if(!r){console.warn("[ensureMonthsFreshAndRecalculateBalances] Budget not in cache");return}const i=r.monthMap||{},o=OB(t,i);if(!(o.length===0&&!n)){if(o.length>0){e?.(!0,`Refreshing ${o.length} month${o.length>1?"s":""}...`);try{await Promise.all(o.map(({year:l,month:u})=>lr(t,l,u,{description:`refreshing month ${l}/${u} for balance calculation`})))}finally{e?.(!1,"")}}DB(t),await kB(t)}}function sA(t=!0){const{selectedBudgetId:e}=Xe(),{addLoadingHold:n,removeLoadingHold:r}=Rn(),i=R.useRef(!1);R.useEffect(()=>{if(!t||!e||i.current)return;i.current=!0;let o=null;rA(e,(l,u)=>{l?(o="ensure-balances-fresh",n(o,u)):o&&(r(o),o=null)},!1).catch(l=>{console.error("[useEnsureBalancesFresh] Failed to ensure balances fresh:",l),o&&r(o)})},[t,e,n,r]),R.useEffect(()=>{e||(i.current=!1)},[e])}function NB(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1;let r=e,i=n-3;for(;i<=0;)i+=12,r-=1;return He(r,i)}function PB(t,e){const n=He(t,e),r=NB();return n>=r}function BB({budgetId:t,viewingYear:e,viewingMonth:n,initialDataLoadComplete:r,enabled:i=!0}){const o=Rt(),l=R.useRef(!1),u=R.useRef(null),h=R.useCallback(()=>{if(!t||!i||!r)return;const f=["initialDataLoad",t],p=o.getQueryState(f);if(!p?.dataUpdatedAt)return;Date.now()-p.dataUpdatedAt>Yr&&!l.current&&(l.current=!0,o.invalidateQueries({queryKey:f}))},[t,i,r,o]);R.useEffect(()=>{r&&h()},[r,h]),R.useEffect(()=>{if(!i||!r)return;const f=()=>{document.visibilityState==="visible"&&(l.current=!1,h())};return document.addEventListener("visibilitychange",f),()=>{document.removeEventListener("visibilitychange",f)}},[i,r,h]),R.useEffect(()=>{l.current=!1,u.current=null},[t]),R.useEffect(()=>{if(!t||!i||!r||PB(e,n))return;const p=`${t}-${e}-${n}`;if(u.current===p)return;u.current=p;const g=[{year:e,month:n},wc(e,n),Yu(e,n)];for(const{year:b,month:_}of g){const w=we.month(t,b,_);if(o.getQueryData(w)){const S=o.getQueryState(w);if(!(S?.dataUpdatedAt?Date.now()-S.dataUpdatedAt>Yr:!1))continue}o.prefetchQuery({queryKey:w,queryFn:async()=>{const S=await Cm(t,b,_);return S?{month:S}:null},staleTime:Yr}).catch(S=>{console.warn(`[useStaleDataRefresh] Failed to prefetch month ${b}/${_}:`,S)})}},[t,i,r,e,n,o])}function Fa(){Be.removeQueries({queryKey:["budget"]}),Be.removeQueries({queryKey:["month"]}),Be.removeQueries({queryKey:["accessibleBudgets"]}),Be.removeQueries({queryKey:["payees"]}),Be.removeQueries({queryKey:["user"]}),console.log("[Migration] All caches cleared")}async function Tm(t){try{const e=await t();return Fa(),e}catch(e){throw Fa(),e}}const iA=R.createContext(null),$S={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function zB({children:t}){const[e,n]=R.useState($S),r=R.useCallback(()=>({setStage:u=>{n(h=>({...h,stage:u}))},setProgress:u=>{n(h=>({...h,progress:u}))},setCurrentItem:u=>{n(h=>({...h,currentItem:u}))},setDetails:u=>{n(h=>({...h,details:u}))},updateItemProgress:(u,h,f)=>{const p=h>0?Math.round(u/h*100):0;n(g=>({...g,progress:p,currentItem:f||`Item ${u} of ${h}`,details:`${u} / ${h} complete`}))}}),[]),i=R.useCallback(async(u,h)=>{n({isOpen:!0,migrationName:u,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const f=r();try{const p=await h(f);return Fa(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){Fa();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(b=>({...b,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=R.useCallback(()=>{n(u=>u.isComplete?$S:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),u))},[]),l={state:e,runMigrationWithProgress:i,closeModal:o};return d.jsx(iA.Provider,{value:l,children:t})}function Sc(){const t=R.useContext(iA);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function n0(t){return(await or("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function aA(t,e){return(await or("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(i=>({id:i.id,data:i.data,budgetId:i.data.budget_id,year:i.data.year,month:i.data.month})).sort((i,o)=>i.year!==o.year?i.year-o.year:i.month-o.month)}async function tr(t){const e=await n0(t),n=await or("months",`${t}: batch reading all months`),r=new Map;for(const i of n.docs){const o=i.data.budget_id,l={id:i.id,data:i.data,budgetId:o,year:i.data.year,month:i.data.month};r.has(o)||r.set(o,[]),r.get(o).push(l)}for(const i of r.values())i.sort((o,l)=>o.year!==l.year?o.year-l.year:o.month-l.month);return{budgets:e,monthsByBudget:r}}async function Wa(t,e){if(t.length===0)return;const n=t.map(o=>{const l=vd(o.data);return{collectionPath:"months",docId:Qs(o.budgetId,o.year,o.month),data:za({...l,updated_at:new Date().toISOString()})}});await q_(n,`${e}: batch writing ${t.length} months`);const r=new Map;for(const o of t)r.has(o.budgetId)||r.set(o.budgetId,[]),r.get(o.budgetId).push({year:o.year,month:o.month});const{ensureMonthsInMapBatch:i}=await ko(async()=>{const{ensureMonthsInMapBatch:o}=await Promise.resolve().then(()=>zP);return{ensureMonthsInMapBatch:o}},void 0);for(const[o,l]of r)try{await i(o,l)}catch(u){console.warn(`[batchWriteMonths] Failed to update month_map for budget ${o}:`,u)}}async function Am(t,e){if(t.length===0)return;const n=t.map(r=>{const i={...r.data};if(i.accounts&&typeof i.accounts=="object"){const o=i.accounts;i.accounts=Object.fromEntries(Object.entries(o).map(([l,u])=>{if(u&&typeof u=="object"){const{balance:h,...f}=u;return[l,f]}return[l,u]}))}if(i.categories&&typeof i.categories=="object"){const o=i.categories;i.categories=Object.fromEntries(Object.entries(o).map(([l,u])=>{if(u&&typeof u=="object"){const{balance:h,...f}=u;return[l,f]}return[l,u]}))}return delete i.total_available,delete i.is_needs_recalculation,{collectionPath:"budgets",docId:r.budgetId,data:za({...i,updated_at:new Date().toISOString()})}});await q_(n,`${e}: batch writing ${t.length} budgets`)}async function oA(t,e,n){if(e.length===0)return;let r=xd;const i=[];for(const p of e){const g=oc(p,r);i.push(g),r=Uo(g)}const o=i.map(p=>({budgetId:t,year:p.year,month:p.month,data:p}));await Wa(o,n);const l=r.accountEndBalances,u=r.categoryEndBalances,{exists:h,data:f}=await At("budgets",t,`${n}: reading budget for final update`);if(h&&f){const p=OP(f.month_map||{}),g={...u},b=f.categories||{};for(const _ of Object.keys(b))_ in g||(g[_]=0);await NP(t,l,g,p)}}async function LB(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,i]of n){i.sort((u,h)=>u.year!==h.year?u.year-h.year:u.month-h.month),await Wa(i,e);const l=(await aA(r,e)).map(u=>u.data);await oA(r,l,e)}}async function UB(t){const{exists:e,data:n}=await At("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r=Object.fromEntries(Object.entries(n.accounts||{}).map(([o,l])=>{if(l&&typeof l=="object"){const{balance:u,...h}=l;return[o,h]}return[o,l]})),i=Object.fromEntries(Object.entries(n.categories||{}).map(([o,l])=>{if(l&&typeof l=="object"){const{balance:u,...h}=l;return[o,h]}return[o,l]}));await kr("budgets",t,{...n,accounts:r,categories:i,month_map:{},updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} (removing balances)`)}function FB({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[i,o]=R.useState(!1),[l,u]=R.useState(null),[h,f]=R.useState(null),[p,g]=R.useState(null);async function b(){if(t){r(!0);try{const w=await or("months","delete all months: scanning for all months"),x=[],S=new Set;for(const C of w.docs){const{budget_id:T,year:I,month:M}=C.data;S.add(T),x.push({docId:C.id,budgetId:T,year:I,month:M})}x.sort((C,T)=>C.budgetId!==T.budgetId?C.budgetId.localeCompare(T.budgetId):C.year!==T.year?C.year-T.year:C.month-T.month),u({monthsToDelete:x,monthsCount:x.length,budgetCount:S.size})}catch{}finally{r(!1)}}}async function _(){if(!t||!l||l.monthsToDelete.length===0)return;o(!0),f(null);const w=l.monthsToDelete.length,x=new Set,S=[];for(const F of l.monthsToDelete)x.add(F.budgetId);g({phase:"deleting",deleted:0,total:w,currentMonth:null,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:0});const C=l.monthsToDelete.map(F=>({collectionPath:"months",docId:F.docId}));let T=0;try{await CT(C,"delete all months: batch deleting all month documents",F=>{T=F,g({phase:"deleting",deleted:F,total:w,currentMonth:`Batch ${Math.ceil(F/500)} of ${Math.ceil(w/500)}`,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:Math.round(F/w*70)})}),T=w}catch(F){S.push(`Batch delete failed: ${F instanceof Error?F.message:"Unknown error"}`)}const I=Array.from(x);let M=0;for(const F of I){g({phase:"resetting-budgets",deleted:T,total:w,currentMonth:`Budget ${M+1}/${I.length}`,budgetsRecalculated:M,totalBudgets:I.length,percentComplete:70+Math.round(M/I.length*25)});try{await UB(F),M++}catch{M++}}g({phase:"clearing-cache",deleted:T,total:w,currentMonth:null,budgetsRecalculated:M,totalBudgets:I.length,percentComplete:95}),Fa(),g({phase:"complete",deleted:T,total:w,currentMonth:null,budgetsRecalculated:M,totalBudgets:I.length,percentComplete:100}),f({deleted:T,errors:S,budgetsRecalculated:M}),o(!1),g(null),S.length===0&&(u({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:l,isScanning:n,scanStatus:b,isDeleting:i,deleteResult:h,deleteProgress:p,deleteAllMonths:_}}const Xg="sample@sample.com",Eo="budget_1767746876726_xuj7nzl4l";function VB({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[i,o]=R.useState(!1),[l,u]=R.useState(null),[h,f]=R.useState(null),[p,g]=R.useState(null);async function b(){if(t){r(!0);try{let x=(await or("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:Xg}])).docs;if(x.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const F=await At("budgets",Eo,"delete sample user budget: checking fallback budget ID");F.exists&&F.data&&(console.log("delete sample user budget: found fallback budget",Eo),x=[{id:Eo,data:F.data}])}const S=[];let C=0,T=!1;for(const F of x){const G=F.id,D=F.data.name,P=(await or("months",`delete sample user budget: counting months for budget ${G}`,[{field:"budget_id",op:"==",value:G}])).docs.length;C+=P,S.push({budgetId:G,budgetName:D,monthCount:P}),(await or("payees",`delete sample user budget: checking payees for budget ${G}`,[{field:"budget_id",op:"==",value:G}])).docs.length>0&&(T=!0)}const I=[],M=await or("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:Xg}]);M.docs.length>0&&M.docs[0].data.budget_ids?.includes(Eo)&&(S.some(O=>O.budgetId===Eo)||(console.log("delete sample user budget: found stale budget reference in sample user document",Eo),I.push(Eo))),u({budgets:S,totalBudgets:S.length,totalMonths:C,hasPayees:T,staleBudgetIds:I})}catch(w){console.error("Error scanning for sample user budgets:",w)}finally{r(!1)}}}async function _(){if(!t||!l||l.budgets.length===0&&l.staleBudgetIds.length===0)return;o(!0),f(null);const w=[];let x=0,S=0,C=0;const T=l.totalMonths,I=l.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:I,percentComplete:0});for(const F of l.budgets)try{const D=(await or("months",`delete sample user budget: fetching month IDs for budget ${F.budgetId}`)).docs.filter(O=>O.data.budget_id===F.budgetId).map(O=>({collectionPath:"months",docId:O.id}));D.length>0&&(await CT(D,`delete sample user budget: deleting ${D.length} months for budget ${F.budgetId}`,O=>{x=O,g({phase:"deleting-months",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:Math.round(x/Math.max(T,1)*60)})}),x=D.length)}catch(G){w.push(`Failed to delete months for budget ${F.budgetId}: ${G instanceof Error?G.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:60});for(const F of l.budgets)try{await Ly("payees",F.budgetId,`delete sample user budget: deleting payees for budget ${F.budgetId}`),C++}catch{}g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:70});for(const F of l.budgets)try{await Ly("budgets",F.budgetId,`delete sample user budget: deleting budget ${F.budgetId}`),S++,g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:70+Math.round(S/I*10)})}catch(G){w.push(`Failed to delete budget ${F.budgetId}: ${G instanceof Error?G.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:80});const M=[...l.budgets.map(F=>F.budgetId),...l.staleBudgetIds];try{const F=await or("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:Xg}]);if(F.docs.length>0){const G=F.docs[0],D=G.id,O=G.data,P=(O.budget_ids||[]).filter($=>!M.includes($));await kr("users",D,{...O,budget_ids:P,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${M.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(F){w.push(`Failed to update sample user document: ${F instanceof Error?F.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:95}),Fa(),g({phase:"complete",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:I,percentComplete:100}),f({budgetsDeleted:S,monthsDeleted:x,payeesDeleted:C,errors:w}),o(!1),g(null),w.length===0&&(u({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:l,isScanning:n,scanStatus:b,isDeleting:i,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:_}}function qS(t){if(!t)return 0;let e=0;for(const n of t)ht(n.start_balance??0)&&e++,ht(n.end_balance??0)&&e++,ht(n.allocated??0)&&e++,ht(n.spent??0)&&e++,ht(n.income??0)&&e++,ht(n.expenses??0)&&e++,ht(n.net_change??0)&&e++;return e}function HS(t){if(!t)return 0;let e=0;for(const n of t)ht(n.amount??0)&&e++;return e}async function GS(){const t=await or("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,i=0;for(const g of t.docs){const b=g.data;let _=!1;ht(b.total_available??0)&&(i++,_=!0);const w=b.accounts;if(w&&typeof w=="object")for(const S of Object.values(w))ht(S.balance??0)&&(n++,_=!0);const x=b.categories;if(x&&typeof x=="object")for(const S of Object.values(x))ht(S.balance??0)&&(r++,_=!0),ht(S.default_monthly_amount??0)&&(r++,_=!0);_&&e++}const o=await or("months","precision cleanup: scanning all months");let l=0,u=0,h=0,f=0,p=0;for(const g of o.docs){const b=g.data;let _=!1;(ht(b.total_income??0)||ht(b.total_expenses??0)||ht(b.previous_month_income??0))&&(_=!0);const w=HS(b.income);w>0&&(u+=w,_=!0);const x=HS(b.expenses);x>0&&(h+=x,_=!0);const S=qS(b.category_balances);S>0&&(f+=S,_=!0);const C=qS(b.account_balances);C>0&&(p+=C,_=!0),_&&l++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:i,totalMonths:o.docs.length,monthsWithPrecisionIssues:l,incomeValuesWithPrecisionIssues:u,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:f,accountBalancesWithPrecisionIssues:p}}function WS(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=Te(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=Te(e.end_balance)),e.allocated!==void 0&&(e.allocated=Te(e.allocated)),e.spent!==void 0&&(e.spent=Te(e.spent)),e.income!==void 0&&(e.income=Te(e.income)),e.expenses!==void 0&&(e.expenses=Te(e.expenses)),e.transfers!==void 0&&(e.transfers=Te(e.transfers)),e.adjustments!==void 0&&(e.adjustments=Te(e.adjustments)),e.net_change!==void 0&&(e.net_change=Te(e.net_change)),e}function $B(t,e){let n=!1;ht(t.total_available??0)&&(t.total_available=Te(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,l]of Object.entries(r)){const u=l;ht(u.balance??0)&&(r[o].balance=Te(u.balance??0),e.accountsFixed++,n=!0)}const i=t.categories;if(i&&typeof i=="object")for(const[o,l]of Object.entries(i)){const u=l;ht(u.balance??0)&&(i[o].balance=Te(u.balance??0),e.categoriesFixed++,n=!0),ht(u.default_monthly_amount??0)&&(i[o].default_monthly_amount=Te(u.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function qB(t,e){let n=!1;if(ht(t.total_income??0)&&(t.total_income=Te(t.total_income??0),n=!0),ht(t.total_expenses??0)&&(t.total_expenses=Te(t.total_expenses??0),n=!0),ht(t.previous_month_income??0)&&(t.previous_month_income=Te(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const i of t.income)ht(i.amount??0)?(r.push({...i,amount:Te(i.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(i);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const i of t.expenses)ht(i.amount??0)?(r.push({...i,amount:Te(i.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(i);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const i of t.category_balances)ht(i.start_balance??0)||ht(i.end_balance??0)||ht(i.allocated??0)||ht(i.spent??0)||ht(i.transfers??0)||ht(i.adjustments??0)?(r.push(WS(i)),e.categoryBalancesFixed++,n=!0):r.push(i);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const i of t.account_balances)ht(i.start_balance??0)||ht(i.end_balance??0)||ht(i.income??0)||ht(i.expenses??0)||ht(i.transfers??0)||ht(i.adjustments??0)||ht(i.net_change??0)?(r.push(WS(i)),e.accountBalancesFixed++,n=!0):r.push(i);t.account_balances=r}return{fixed:n,data:t}}function HB(t,e,n){const r={...t.data},{fixed:i,data:o}=$B(r,n),l=i?{budgetId:t.id,data:o}:null;i&&n.budgetsProcessed++;const u=[];let h=!1;for(const f of e){const p={...f.data},{fixed:g,data:b}=qB(p,n);g&&(n.monthsProcessed++,h=!0),u.push(b)}return{budgetUpdate:l,fixedMonths:u,hasMonthFixes:h}}async function GB(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await tr("precision cleanup"),r=[],i=[];for(const o of e)try{const l=n.get(o.id)||[],{budgetUpdate:u,fixedMonths:h,hasMonthFixes:f}=HB(o,l,t);u&&r.push(u),(f||h.length>0)&&i.push({budgetId:o.id,months:h})}catch(l){t.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}if(r.length>0)try{await Am(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:l}of i)try{await oA(o,l,"precision cleanup")}catch(u){t.errors.push(`Budget ${o} recalc: ${u instanceof Error?u.message:String(u)}`)}return t}function WB({currentUser:t,onComplete:e}){const[n,r]=R.useState(null),[i,o]=R.useState(!1),[l,u]=R.useState(!1),[h,f]=R.useState(null),[p,g]=R.useState(null),b=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,_=b>0,w=R.useCallback(async()=>{if(t){o(!0),g(null);try{const S=await GS();r(S),f(null)}catch(S){g(S instanceof Error?S.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),x=R.useCallback(async()=>{if(!(!t||!_)){u(!0),g(null);try{const S=await Tm(()=>GB());f(S);const C=await GS();r(C),e?.()}catch(S){g(S instanceof Error?S.message:"Failed to run precision cleanup")}finally{u(!1)}}},[t,_,e]);return{status:n,isScanning:i,isRunning:l,result:h,error:p,totalIssues:b,hasIssues:_,hasData:n!==null,scan:w,runCleanup:x}}function r0(t){const e=t.income||[],n=t.expenses||[],r=Te(e.reduce((u,h)=>u+h.amount,0)),i=Te(n.reduce((u,h)=>u+h.amount,0)),o=QB(t),l=KB(t);return{...t,total_income:r,total_expenses:i,account_balances:o,category_balances:l}}function QB(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],i=t.adjustments||[],o=t.account_balances||[],l=new Map;for(const f of o)Ye(f.account_id)||l.set(f.account_id,f);const u=new Set;for(const f of e)Ye(f.account_id)||u.add(f.account_id);for(const f of n)Ye(f.account_id)||u.add(f.account_id);for(const f of r)Ye(f.from_account_id)||u.add(f.from_account_id),Ye(f.to_account_id)||u.add(f.to_account_id);for(const f of i)Ye(f.account_id)||u.add(f.account_id);for(const f of o)Ye(f.account_id)||u.add(f.account_id);const h=[];for(const f of u){const p=l.get(f),g=Te(p?.start_balance??0),b=Te(e.filter(I=>I.account_id===f).reduce((I,M)=>I+M.amount,0)),_=Te(n.filter(I=>I.account_id===f).reduce((I,M)=>I+M.amount,0)),w=Te(r.filter(I=>I.from_account_id===f).reduce((I,M)=>I-M.amount,0)),x=Te(r.filter(I=>I.to_account_id===f).reduce((I,M)=>I+M.amount,0)),S=Te(x+w),C=Te(i.filter(I=>I.account_id===f).reduce((I,M)=>I+M.amount,0)),T=Te(b+_+S+C);h.push({account_id:f,start_balance:g,income:b,expenses:_,transfers:S,adjustments:C,net_change:T,end_balance:Te(g+T)})}return h}function KB(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],i=t.category_balances||[],o=new Map;for(const g of i)lt(g.category_id)||o.set(g.category_id,g);const{spentMap:l,transfersMap:u,adjustmentsMap:h}=RT(e,n,r),f=new Set;for(const g of i)lt(g.category_id)||f.add(g.category_id);for(const g of e)lt(g.category_id)||f.add(g.category_id);for(const g of n)lt(g.from_category_id)||f.add(g.from_category_id),lt(g.to_category_id)||f.add(g.to_category_id);for(const g of r)lt(g.category_id)||f.add(g.category_id);const p=[];for(const g of f){const b=o.get(g),_=l[g]??0,w=u[g]??0,x=h[g]??0;if(b){const S=Te(b.start_balance),C=Te(b.allocated);p.push({category_id:g,start_balance:S,allocated:C,spent:_,transfers:w,adjustments:x,end_balance:Te(S+C+_+w+x)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:_,transfers:w,adjustments:x,end_balance:Te(_+w+x)})}return p}const YB=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],XB=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function jm(t){return!t||Ye(t)?!0:YB.includes(t)}function Rm(t){return!t||lt(t)?!0:XB.includes(t)}function lA(t){return jm(t.account_id)||Rm(t.category_id)}function ZB(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:jm(t.account_id)?Gt:t.account_id,category_id:Rm(t.category_id)?Xt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function JB(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],i=[],o=[];let l=0,u=0;for(const f of n)lA(f)?(jm(f.account_id)&&!Ye(f.account_id)&&l++,Rm(f.category_id)&&!lt(f.category_id)&&u++,o.push(ZB(f))):i.push(f);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:r0({...e,expenses:i,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:l,invalidCategoriesFixed:u}}}async function e3(){const{budgets:t,monthsByBudget:e}=await tr("expense-to-adjustment-scan");let n=0,r=0,i=0,o=0;for(const l of t){const u=e.get(l.id)||[];n+=u.length;for(const h of u){const p=h.data.expenses||[];for(const g of p)lA(g)&&(r++,jm(g.account_id)&&!Ye(g.account_id)&&i++,Rm(g.category_id)&&!lt(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:i,invalidCategoriesToFix:o}}async function t3(){const{budgets:t,monthsByBudget:e}=await tr("expense-to-adjustment-migration"),n=[];let r=0,i=0,o=0;const l=[];for(const u of t){const h=e.get(u.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:b}=JB(f);p&&g&&(n.push({budgetId:u.id,year:f.year,month:f.month,data:g}),r+=b.expensesMigrated,i+=b.invalidAccountsFixed,o+=b.invalidCategoriesFixed)}catch(p){l.push(`Month ${f.year}/${f.month} in budget ${u.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await Wa(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:i,invalidCategoriesFixed:o,errors:l}}function n3({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[i,o]=R.useState(!1),[l,u]=R.useState(null),[h,f]=R.useState(null);async function p(){if(t){r(!0);try{const _=await e3();u(_)}catch(_){console.error("Failed to scan for expense to adjustment migration:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Tm(()=>t3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const b=l!==null&&l.expensesToMigrate>0;return{status:l,isScanning:n,scanStatus:p,hasItemsToMigrate:b,isRunning:i,result:h,runMigration:g}}function cA(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const i=t.accounts;if(i)for(const o of Object.keys(i))n.add(o);return{categoryIds:e,accountIds:n}}function Sa(t,e){return!t||lt(t)?!1:!e.has(t)}function Us(t,e){return!t||Ye(t)?!1:!e.has(t)}function r3(t,e){const n=t.data;let r=0,i=0,o=0,l=0,u=0,h=0,f=!1;const p=(n.expenses||[]).map(x=>{const S={...x};let C=!1;return Sa(x.category_id,e.categoryIds)&&(S.category_id=Xt,r++,C=!0),Us(x.account_id,e.accountIds)&&(S.account_id=Gt,i++,C=!0),C&&(o++,f=!0),S}),g=(n.income||[]).map(x=>{const S={...x};let C=!1;return Us(x.account_id,e.accountIds)&&(S.account_id=Gt,i++,C=!0),C&&(l++,f=!0),S}),b=(n.transfers||[]).map(x=>{const S={...x};let C=!1;return Sa(x.from_category_id,e.categoryIds)&&(S.from_category_id=Xt,r++,C=!0),Sa(x.to_category_id,e.categoryIds)&&(S.to_category_id=Xt,r++,C=!0),Us(x.from_account_id,e.accountIds)&&(S.from_account_id=Gt,i++,C=!0),Us(x.to_account_id,e.accountIds)&&(S.to_account_id=Gt,i++,C=!0),C&&(u++,f=!0),S}),_=(n.adjustments||[]).map(x=>{const S={...x};let C=!1;return Sa(x.category_id,e.categoryIds)&&(S.category_id=Xt,r++,C=!0),Us(x.account_id,e.accountIds)&&(S.account_id=Gt,i++,C=!0),C&&(h++,f=!0),S});return f?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:b,adjustments:_,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:u,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function s3(){const{budgets:t,monthsByBudget:e}=await tr("orphaned-id-scan");let n=0,r=0,i=0,o=0,l=0,u=0,h=0;for(const f of t){const p=cA(f.data),g=e.get(f.id)||[];n+=g.length;for(const b of g){const _=b.data;for(const w of _.expenses||[]){let x=!1;Sa(w.category_id,p.categoryIds)&&(r++,x=!0),Us(w.account_id,p.accountIds)&&(i++,x=!0),x&&o++}for(const w of _.income||[])Us(w.account_id,p.accountIds)&&(i++,l++);for(const w of _.transfers||[]){let x=!1;Sa(w.from_category_id,p.categoryIds)&&(r++,x=!0),Sa(w.to_category_id,p.categoryIds)&&(r++,x=!0),Us(w.from_account_id,p.accountIds)&&(i++,x=!0),Us(w.to_account_id,p.accountIds)&&(i++,x=!0),x&&u++}for(const w of _.adjustments||[]){let x=!1;Sa(w.category_id,p.categoryIds)&&(r++,x=!0),Us(w.account_id,p.accountIds)&&(i++,x=!0),x&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:u,affectedAdjustments:h}}async function i3(){const{budgets:t,monthsByBudget:e}=await tr("orphaned-id-cleanup"),n=[];let r=0,i=0;const o=[];for(const l of t){const u=cA(l.data),h=e.get(l.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:b}=r3(f,u);p&&g&&(n.push({budgetId:l.id,year:f.year,month:f.month,data:g}),r+=b.categoryIdsFixed,i+=b.accountIdsFixed)}catch(p){o.push(`Month ${f.year}/${f.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await Wa(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:i,errors:o}}function a3({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[i,o]=R.useState(!1),[l,u]=R.useState(null),[h,f]=R.useState(null);async function p(){if(t){r(!0);try{const _=await s3();u(_)}catch(_){console.error("Failed to scan for orphaned IDs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Tm(()=>i3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const b=l!==null&&(l.orphanedCategoryIds>0||l.orphanedAccountIds>0);return{status:l,isScanning:n,scanStatus:p,hasItemsToFix:b,isRunning:i,result:h,runMigration:g}}function o3(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,i=lt(t.category_id)&&lt(e.category_id),o=!Ye(t.account_id)&&!Ye(e.account_id),l=t.account_id!==e.account_id;if(i&&o&&l)return{negative:n,positive:r,type:"account"};const u=Ye(t.account_id)&&Ye(e.account_id),h=!lt(t.category_id)&&!lt(e.category_id),f=t.category_id!==e.category_id;return u&&h&&f?{negative:n,positive:r,type:"category"}:null}function uA(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let i=r+1;i<t.length;i++){if(n.has(t[i].id))continue;const o=o3(t[r],t[i]);if(o){e.push(o),n.add(t[r].id),n.add(t[i].id);break}}return e}function l3(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Xt,to_category_id:Xt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Gt,to_account_id:Gt,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function c3(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],i=uA(n);if(i.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=i.map(l3),l=new Set;for(const f of i)l.add(f.negative.id),l.add(f.positive.id);const u=n.filter(f=>!l.has(f.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:u,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:i.length,adjustmentsRemoved:l.size}}}async function u3(){const{budgets:t,monthsByBudget:e}=await tr("adjustments-to-transfers-scan");let n=0,r=0,i=0,o=0;for(const l of t){const u=e.get(l.id)||[];n+=u.length;for(const h of u){const p=h.data.adjustments||[],g=uA(p);r+=g.length;for(const b of g)b.type==="account"?i++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:i,categoryTransferPairs:o}}async function d3(){const{budgets:t,monthsByBudget:e}=await tr("adjustments-to-transfers-migration"),n=[];let r=0,i=0;const o=[];for(const l of t){const u=e.get(l.id)||[];for(const h of u)try{const{needsUpdate:f,updatedMonth:p,stats:g}=c3(h);f&&p&&(n.push({budgetId:l.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,i+=g.adjustmentsRemoved)}catch(f){o.push(`Month ${h.year}/${h.month} in budget ${l.id}: ${f instanceof Error?f.message:String(f)}`)}}return n.length>0&&await Wa(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:i,errors:o}}function h3({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[i,o]=R.useState(!1),[l,u]=R.useState(null),[h,f]=R.useState(null);async function p(){if(t){r(!0);try{const _=await u3();u(_)}catch(_){console.error("Failed to scan for adjustment pairs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Tm(()=>d3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const b=l!==null&&l.pairsFound>0;return{status:l,isScanning:n,scanStatus:p,hasPairsToConvert:b,isRunning:i,result:h,runMigration:g}}function f3(t){const e=[];let n="",r=!1;for(let i=0;i<t.length;i++){const o=t[i];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function m3(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function p3(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),i=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(i)||n<1||n>12||r<1||r>31?null:{year:i,month:n,day:r}}function g3(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function y3(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function _3(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const i=f3(r);if(i.length<5)continue;const[o,l,u,h,f,p,g]=i;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const b=p3(o);if(!b)continue;const _=y3(l,u),w=m3(f),x=g3(g||"");n.push({recordType:_,date:o,year:b.year,month:b.month,day:b.day,payee:l,category:u,account:h,amount:w,description:p||"",cleared:x,rawLine:r})}return n}function b3(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function v3(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function x3(t){const e=Ye(t.account_id)||!t.account_id||t.account_id.trim()==="",n=lt(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function w3(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const i=Ye(t.from_account_id),o=Ye(t.to_account_id),l=lt(t.from_category_id),u=lt(t.to_category_id);return i&&o&&l&&u?"All from/to account and category IDs are NO_* (must involve at least one real entity)":i&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":l&&u&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function tf(t,e,n,r,i){return t.filter(o=>{const[l,u,h]=e.split("-").map(Number);return o.year!==l||o.month!==u||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||i&&o.description&&o.description.toLowerCase().includes(i.toLowerCase()),!0)})}async function S3(t){const e=[];let n=0,r=0,i=0,o=0;const l=t?_3(t):[],{budgets:u,monthsByBudget:h}=await tr("account-category-validation");for(const f of u){const p=h.get(f.id)||[];for(const g of p){const b=g.data,_=`${b.year}-${String(b.month).padStart(2,"0")}`,w=b.income||[];n+=w.length;for(const T of w){const I=b3(T);I&&e.push({budgetId:f.id,monthKey:_,transactionType:"income",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:tf(l,T.date,T.amount,T.payee,T.description)})}const x=b.expenses||[];r+=x.length;for(const T of x){const I=v3(T);I&&e.push({budgetId:f.id,monthKey:_,transactionType:"expense",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:tf(l,T.date,T.amount,T.payee,T.description)})}const S=b.adjustments||[];i+=S.length;for(const T of S){const I=x3(T);I&&e.push({budgetId:f.id,monthKey:_,transactionType:"adjustment",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:tf(l,T.date,T.amount,void 0,T.description)})}const C=b.transfers||[];o+=C.length;for(const T of C){const I=w3(T);I&&e.push({budgetId:f.id,monthKey:_,transactionType:"transfer",transactionId:T.id,violation:I,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:tf(l,T.date,T.amount,void 0,T.description)})}}}return e.sort((f,p)=>{const g=f.monthKey.localeCompare(p.monthKey);return g!==0?g:f.transactionType.localeCompare(p.transactionType)}),{totalBudgets:u.length,totalMonths:Array.from(h.values()).reduce((f,p)=>f+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:i,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function E3(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,i]of n){e.push("",`## ${r.toUpperCase()} (${i.length} violations)`,"");for(const o of i){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const l of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${l.rawLine}`,`        Type: ${l.recordType}, Date: ${l.date}, Payee: ${l.payee}`,`        Category: ${l.category}, Account: ${l.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function C3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(null),[o,l]=R.useState(null);async function u(h){if(t){n(!0),i(null),l(null);try{const f=await S3(h);i(f),l(E3(f))}catch(f){console.error("Failed to scan transactions:",f),l(`Error scanning: ${f instanceof Error?f.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:u,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}async function T3(){const{budgets:t,monthsByBudget:e}=await tr("remove-total-fields-migration-scan");let n=0,r=0,i=0;for(const l of t){const u=e.get(l.id)||[];for(const h of u){const f=h.data,p="total_income"in f&&f.total_income!==void 0,g="total_expenses"in f&&f.total_expenses!==void 0;p&&r++,g&&i++,(p||g)&&n++}}const o=e.size>0?Array.from(e.values()).reduce((l,u)=>l+u.length,0):0;return{totalBudgets:t.length,totalMonths:o,monthsNeedingMigration:n,monthsWithTotalIncome:r,monthsWithTotalExpenses:i}}async function A3(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await tr("remove-total-fields-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=[];t.setStage("Processing months...");let o=0;for(const u of r.values())o+=u.length;let l=0;for(const u of n)try{const h=r.get(u.id)||[];for(const f of h){l++;const p=f.data;t.updateItemProgress(l,o,`Month ${p.year}/${p.month}`);const g="total_income"in p&&p.total_income!==void 0,b="total_expenses"in p&&p.total_expenses!==void 0;if(g||b){const{total_income:_,total_expenses:w,...x}=p;i.push({budgetId:u.id,year:p.year,month:p.month,data:{...x,updated_at:new Date().toISOString()}}),e.monthsUpdated++}e.monthsProcessed++}h.length>0&&e.budgetsProcessed++}catch(h){e.errors.push(`Budget ${u.id}: ${h instanceof Error?h.message:String(h)}`)}return i.length>0&&(t.setStage(`Writing ${i.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} month(s) to update`),await Wa(i,"remove-total-fields-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function j3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(!1),[o,l]=R.useState(null),[u,h]=R.useState(null),{runMigrationWithProgress:f}=Sc();async function p(){if(t){n(!0);try{const w=await T3();l(w)}catch(w){console.error("Failed to scan remove total fields status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Remove Total Fields Migration",x=>A3(x));h(w)}catch(w){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.monthsNeedingMigration>0,_=o?.monthsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:u,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function R3(){const{budgets:t,monthsByBudget:e}=await tr("remove-previous-month-income-migration-scan");let n=0;for(const i of t){const o=e.get(i.id)||[];for(const l of o){const u=l.data;"previous_month_income"in u&&u.previous_month_income!==void 0&&n++}}const r=e.size>0?Array.from(e.values()).reduce((i,o)=>i+o.length,0):0;return{totalBudgets:t.length,totalMonths:r,monthsNeedingMigration:n}}async function I3(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]},{budgets:n,monthsByBudget:r}=await tr("remove-previous-month-income-migration");t.setStage(`Processing ${n.length} budget(s)...`),t.setProgress(0);const i=[];for(let o=0;o<n.length;o++){const l=n[o];t.setProgress(o/n.length*100),t.setCurrentItem(`Budget ${o+1}/${n.length}: ${l.id}`);try{const u=r.get(l.id)||[];for(const h of u){const f=h.data;if("previous_month_income"in f&&f.previous_month_income!==void 0){const{previous_month_income:g,...b}=f;i.push({budgetId:l.id,year:f.year,month:f.month,data:{...b,updated_at:new Date().toISOString()}}),e.monthsUpdated++}e.monthsProcessed++}u.length>0&&e.budgetsProcessed++}catch(u){e.errors.push(`Budget ${l.id}: ${u instanceof Error?u.message:String(u)}`)}}return i.length>0&&(t.setStage(`Writing ${i.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} month(s) to update`),await Wa(i,"remove-previous-month-income-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function D3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(!1),[o,l]=R.useState(null),[u,h]=R.useState(null),{runMigrationWithProgress:f}=Sc();async function p(){if(t){n(!0);try{const w=await R3();l(w)}catch(w){console.error("Failed to scan remove previous month income status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Remove Previous Month Income Migration",x=>I3(x));h(w)}catch(w){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.monthsNeedingMigration>0,_=o?.monthsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:u,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function k3(){const t=await n0("percentage-income-months-back-migration-scan");let e=0;for(const n of t)n.data.percentage_income_months_back===void 0&&e++;return{totalBudgets:t.length,budgetsNeedingMigration:e}}async function M3(t){const e={budgetsProcessed:0,budgetsUpdated:0,errors:[]};t.setStage("Reading all budgets..."),t.setProgress(null);const n=await n0("percentage-income-months-back-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const r=[];for(let i=0;i<n.length;i++){const o=n[i];t.updateItemProgress(i+1,n.length,`Budget: ${o.data.name??o.id}`);try{const l=o.data;l.percentage_income_months_back===void 0&&(r.push({budgetId:o.id,data:{...l,percentage_income_months_back:1}}),e.budgetsProcessed++)}catch(l){e.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}}return r.length>0&&(t.setStage("Writing budget updates..."),t.setProgress(null),t.setCurrentItem(`${r.length} budget(s) to update`),await Am(r,"percentage-income-months-back-migration"),e.budgetsUpdated=r.length),t.setStage("Migration complete"),t.setProgress(100),e}function O3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(!1),[o,l]=R.useState(null),[u,h]=R.useState(null),{runMigrationWithProgress:f}=Sc();async function p(){if(t){n(!0);try{const w=await k3();l(w)}catch(w){console.error("Failed to scan percentage income months back status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Percentage Income Months Back",x=>M3(x));h(w)}catch(w){h({budgetsProcessed:0,budgetsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.budgetsNeedingMigration>0,_=o?.budgetsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:u,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function N3(){const{budgets:t,monthsByBudget:e}=await tr("recalculate-start-balances-migration-scan"),n=_d(),r=He(n.year,n.month);let i=0;for(const l of t){const h=(e.get(l.id)||[]).filter(f=>{const p=f.data;return He(p.year,p.month)<=r});i+=h.length}const o=e.size>0?Array.from(e.values()).reduce((l,u)=>l+u.length,0):0;return{totalBudgets:t.length,totalMonths:o,monthsNeedingRecalculation:i}}async function P3(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await tr("recalculate-start-balances-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=_d(),o=He(i.year,i.month),l=[];t.setStage("Processing months...");let u=0;for(const f of n){const g=(r.get(f.id)||[]).filter(b=>{const _=b.data;return He(_.year,_.month)<=o});u+=g.length}let h=0;for(const f of n)try{const g=(r.get(f.id)||[]).filter(_=>{const w=_.data;return He(w.year,w.month)<=o}).sort((_,w)=>{const x=_.data,S=w.data,C=He(x.year,x.month),T=He(S.year,S.month);return C.localeCompare(T)});if(g.length===0){e.budgetsProcessed++;continue}let b=xd;for(const _ of g){h++;const w=_.data,x=w.year,S=w.month;t.updateItemProgress(h,u,`Budget ${f.id}: ${x}/${S}`);const C={budget_id:f.id,year_month_ordinal:w.year_month_ordinal,year:x,month:S,income:w.income||[],total_income:0,previous_month_income:0,expenses:w.expenses||[],total_expenses:0,transfers:w.transfers||[],adjustments:w.adjustments||[],account_balances:w.account_balances||[],category_balances:w.category_balances||[],are_allocations_finalized:w.are_allocations_finalized??!1,created_at:w.created_at,updated_at:w.updated_at},T=bd(C),I=oc(T,b);b=Uo(I);const M=vd(I);l.push({budgetId:f.id,year:x,month:S,data:M}),e.monthsUpdated++,e.monthsProcessed++}e.budgetsProcessed++}catch(p){e.errors.push(`Budget ${f.id}: ${p instanceof Error?p.message:String(p)}`)}return l.length>0&&(t.setStage(`Writing ${l.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${l.length} month(s) to update`),await Wa(l,"recalculate-start-balances-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function B3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(!1),[o,l]=R.useState(null),[u,h]=R.useState(null),{runMigrationWithProgress:f}=Sc();async function p(){if(t){n(!0);try{const w=await N3();l(w)}catch(w){console.error("Failed to scan recalculate start balances status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Recalculate Start Balances Migration",x=>P3(x));h(w)}catch(w){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.monthsNeedingRecalculation>0,_=o?.monthsNeedingRecalculation??0;return{isScanning:e,isRunning:r,status:o,result:u,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function z3(){const{budgets:t,monthsByBudget:e}=await tr("repair-month-map-migration-scan");let n=0,r=0,i=0;for(const l of t){const u=e.get(l.id)||[],f=l.data.month_map||{},p=new Set;for(const _ of u){const w=He(_.year,_.month);p.add(w)}let g=0;for(const _ of p)_ in f||g++;let b=0;for(const _ of Object.keys(f))p.has(_)||b++;(g>0||b>0)&&(n++,r+=g,i+=b)}const o=e.size>0?Array.from(e.values()).reduce((l,u)=>l+u.length,0):0;return{totalBudgets:t.length,totalMonths:o,budgetsNeedingRepair:n,totalMissingMonths:r,totalOrphanedEntries:i}}async function L3(t){const e={budgetsProcessed:0,budgetsUpdated:0,monthsAdded:0,orphanedEntriesRemoved:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await tr("repair-month-map-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=[];t.setStage("Processing budgets...");let o=0;for(const l of n)try{o++;const u=r.get(l.id)||[],f=l.data.month_map||{};t.updateItemProgress(o,n.length,`Budget ${l.id}`);const p=new Set;for(const w of u){const x=He(w.year,w.month);p.add(x)}const g={...f};let b=0,_=0;for(const w of p)w in g||(g[w]={},b++);for(const w of Object.keys(g))p.has(w)||(delete g[w],_++);(b>0||_>0)&&(i.push({budgetId:l.id,data:{...l.data,month_map:g,updated_at:new Date().toISOString()}}),e.monthsAdded+=b,e.orphanedEntriesRemoved+=_,e.budgetsUpdated++),e.budgetsProcessed++}catch(u){e.errors.push(`Budget ${l.id}: ${u instanceof Error?u.message:String(u)}`)}return i.length>0&&(t.setStage(`Writing ${i.length} budget update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} budget(s) to update`),await Am(i,"repair-month-map-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function U3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(!1),[o,l]=R.useState(null),[u,h]=R.useState(null),{runMigrationWithProgress:f}=Sc();async function p(){if(t){n(!0);try{const w=await z3();l(w)}catch(w){console.error("Failed to scan repair month map status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Repair Month Map Migration",x=>L3(x));h(w)}catch(w){h({budgetsProcessed:0,budgetsUpdated:0,monthsAdded:0,orphanedEntriesRemoved:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&(o.totalMissingMonths>0||o.totalOrphanedEntries>0),_=o?o.totalMissingMonths+o.totalOrphanedEntries:0;return{isScanning:e,isRunning:r,status:o,result:u,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}function nf(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Zg={exports:{}};var QS;function F3(){return QS||(QS=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,o){function l(f,p){if(!i[f]){if(!r[f]){var g=typeof nf=="function"&&nf;if(!p&&g)return g(f,!0);if(u)return u(f,!0);var b=new Error("Cannot find module '"+f+"'");throw b.code="MODULE_NOT_FOUND",b}var _=i[f]={exports:{}};r[f][0].call(_.exports,function(w){var x=r[f][1][w];return l(x||w)},_,_.exports,n,r,i,o)}return i[f].exports}for(var u=typeof nf=="function"&&nf,h=0;h<o.length;h++)l(o[h]);return l})({1:[function(n,r,i){var o=n("./utils"),l=n("./support"),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(h){for(var f,p,g,b,_,w,x,S=[],C=0,T=h.length,I=T,M=o.getTypeOf(h)!=="string";C<h.length;)I=T-C,g=M?(f=h[C++],p=C<T?h[C++]:0,C<T?h[C++]:0):(f=h.charCodeAt(C++),p=C<T?h.charCodeAt(C++):0,C<T?h.charCodeAt(C++):0),b=f>>2,_=(3&f)<<4|p>>4,w=1<I?(15&p)<<2|g>>6:64,x=2<I?63&g:64,S.push(u.charAt(b)+u.charAt(_)+u.charAt(w)+u.charAt(x));return S.join("")},i.decode=function(h){var f,p,g,b,_,w,x=0,S=0,C="data:";if(h.substr(0,C.length)===C)throw new Error("Invalid base64 input, it looks like a data url.");var T,I=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===u.charAt(64)&&I--,h.charAt(h.length-2)===u.charAt(64)&&I--,I%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=l.uint8array?new Uint8Array(0|I):new Array(0|I);x<h.length;)f=u.indexOf(h.charAt(x++))<<2|(b=u.indexOf(h.charAt(x++)))>>4,p=(15&b)<<4|(_=u.indexOf(h.charAt(x++)))>>2,g=(3&_)<<6|(w=u.indexOf(h.charAt(x++))),T[S++]=f,_!==64&&(T[S++]=p),w!==64&&(T[S++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var o=n("./external"),l=n("./stream/DataWorker"),u=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function f(p,g,b,_,w){this.compressedSize=p,this.uncompressedSize=g,this.crc32=b,this.compression=_,this.compressedContent=w}f.prototype={getContentWorker:function(){var p=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},f.createWorkerFrom=function(p,g,b){return p.pipe(new u).pipe(new h("uncompressedSize")).pipe(g.compressWorker(b)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=f},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var o=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var o=n("./utils"),l=(function(){for(var u,h=[],f=0;f<256;f++){u=f;for(var p=0;p<8;p++)u=1&u?3988292384^u>>>1:u>>>1;h[f]=u}return h})();r.exports=function(u,h){return u!==void 0&&u.length?o.getTypeOf(u)!=="string"?(function(f,p,g,b){var _=l,w=b+g;f^=-1;for(var x=b;x<w;x++)f=f>>>8^_[255&(f^p[x])];return-1^f})(0|h,u,u.length,0):(function(f,p,g,b){var _=l,w=b+g;f^=-1;for(var x=b;x<w;x++)f=f>>>8^_[255&(f^p.charCodeAt(x))];return-1^f})(0|h,u,u.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=n("pako"),u=n("./utils"),h=n("./stream/GenericWorker"),f=o?"uint8array":"array";function p(g,b){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=b,this.meta={}}i.magic="\b\0",u.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(u.transformTo(f,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(b){g.push({data:b,meta:g.meta})}},i.compressWorker=function(g){return new p("Deflate",g)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function o(_,w){var x,S="";for(x=0;x<w;x++)S+=String.fromCharCode(255&_),_>>>=8;return S}function l(_,w,x,S,C,T){var I,M,F=_.file,G=_.compression,D=T!==f.utf8encode,O=u.transformTo("string",T(F.name)),P=u.transformTo("string",f.utf8encode(F.name)),$=F.comment,V=u.transformTo("string",T($)),j=u.transformTo("string",f.utf8encode($)),B=P.length!==F.name.length,k=j.length!==$.length,Y="",X="",W="",te=F.dir,H=F.date,re={crc32:0,compressedSize:0,uncompressedSize:0};w&&!x||(re.crc32=_.crc32,re.compressedSize=_.compressedSize,re.uncompressedSize=_.uncompressedSize);var N=0;w&&(N|=8),D||!B&&!k||(N|=2048);var q=0,J=0;te&&(q|=16),C==="UNIX"?(J=798,q|=(function(ae,Ee){var Ae=ae;return ae||(Ae=Ee?16893:33204),(65535&Ae)<<16})(F.unixPermissions,te)):(J=20,q|=(function(ae){return 63&(ae||0)})(F.dosPermissions)),I=H.getUTCHours(),I<<=6,I|=H.getUTCMinutes(),I<<=5,I|=H.getUTCSeconds()/2,M=H.getUTCFullYear()-1980,M<<=4,M|=H.getUTCMonth()+1,M<<=5,M|=H.getUTCDate(),B&&(X=o(1,1)+o(p(O),4)+P,Y+="up"+o(X.length,2)+X),k&&(W=o(1,1)+o(p(V),4)+j,Y+="uc"+o(W.length,2)+W);var ne="";return ne+=`
\0`,ne+=o(N,2),ne+=G.magic,ne+=o(I,2),ne+=o(M,2),ne+=o(re.crc32,4),ne+=o(re.compressedSize,4),ne+=o(re.uncompressedSize,4),ne+=o(O.length,2),ne+=o(Y.length,2),{fileRecord:g.LOCAL_FILE_HEADER+ne+O+Y,dirRecord:g.CENTRAL_FILE_HEADER+o(J,2)+ne+o(V.length,2)+"\0\0\0\0"+o(q,4)+o(S,4)+O+Y+V}}var u=n("../utils"),h=n("../stream/GenericWorker"),f=n("../utf8"),p=n("../crc32"),g=n("../signature");function b(_,w,x,S){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=w,this.zipPlatform=x,this.encodeFileName=S,this.streamFiles=_,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}u.inherits(b,h),b.prototype.push=function(_){var w=_.meta.percent||0,x=this.entriesCount,S=this._sources.length;this.accumulate?this.contentBuffer.push(_):(this.bytesWritten+=_.data.length,h.prototype.push.call(this,{data:_.data,meta:{currentFile:this.currentFile,percent:x?(w+100*(x-S-1))/x:100}}))},b.prototype.openedSource=function(_){this.currentSourceOffset=this.bytesWritten,this.currentFile=_.file.name;var w=this.streamFiles&&!_.file.dir;if(w){var x=l(_,w,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},b.prototype.closedSource=function(_){this.accumulate=!1;var w=this.streamFiles&&!_.file.dir,x=l(_,w,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),w)this.push({data:(function(S){return g.DATA_DESCRIPTOR+o(S.crc32,4)+o(S.compressedSize,4)+o(S.uncompressedSize,4)})(_),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},b.prototype.flush=function(){for(var _=this.bytesWritten,w=0;w<this.dirRecords.length;w++)this.push({data:this.dirRecords[w],meta:{percent:100}});var x=this.bytesWritten-_,S=(function(C,T,I,M,F){var G=u.transformTo("string",F(M));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(C,2)+o(C,2)+o(T,4)+o(I,4)+o(G.length,2)+G})(this.dirRecords.length,x,_,this.zipComment,this.encodeFileName);this.push({data:S,meta:{percent:100}})},b.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},b.prototype.registerPrevious=function(_){this._sources.push(_);var w=this;return _.on("data",function(x){w.processChunk(x)}),_.on("end",function(){w.closedSource(w.previous.streamInfo),w._sources.length?w.prepareNextSource():w.end()}),_.on("error",function(x){w.error(x)}),this},b.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},b.prototype.error=function(_){var w=this._sources;if(!h.prototype.error.call(this,_))return!1;for(var x=0;x<w.length;x++)try{w[x].error(_)}catch{}return!0},b.prototype.lock=function(){h.prototype.lock.call(this);for(var _=this._sources,w=0;w<_.length;w++)_[w].lock()},r.exports=b},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var o=n("../compressions"),l=n("./ZipFileWorker");i.generateWorker=function(u,h,f){var p=new l(h.streamFiles,f,h.platform,h.encodeFileName),g=0;try{u.forEach(function(b,_){g++;var w=(function(T,I){var M=T||I,F=o[M];if(!F)throw new Error(M+" is not a valid compression method !");return F})(_.options.compression,h.compression),x=_.options.compressionOptions||h.compressionOptions||{},S=_.dir,C=_.date;_._compressWorker(w,x).withStreamInfo("file",{name:b,dir:S,date:C,comment:_.comment||"",unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(b){p.error(b)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var u in this)typeof this[u]!="function"&&(l[u]=this[u]);return l}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(l,u){return new o().loadAsync(l,u)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var o=n("./utils"),l=n("./external"),u=n("./utf8"),h=n("./zipEntries"),f=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(b){return new l.Promise(function(_,w){var x=b.decompressed.getContentWorker().pipe(new f);x.on("error",function(S){w(S)}).on("end",function(){x.streamInfo.crc32!==b.decompressed.crc32?w(new Error("Corrupted zip : CRC32 mismatch")):_()}).resume()})}r.exports=function(b,_){var w=this;return _=o.extend(_||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:u.utf8decode}),p.isNode&&p.isStream(b)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",b,!0,_.optimizedBinaryString,_.base64).then(function(x){var S=new h(_);return S.load(x),S}).then(function(x){var S=[l.Promise.resolve(x)],C=x.files;if(_.checkCRC32)for(var T=0;T<C.length;T++)S.push(g(C[T]));return l.Promise.all(S)}).then(function(x){for(var S=x.shift(),C=S.files,T=0;T<C.length;T++){var I=C[T],M=I.fileNameStr,F=o.resolve(I.fileNameStr);w.file(F,I.decompressed,{binary:!0,optimizedBinaryString:!0,date:I.date,dir:I.dir,comment:I.fileCommentStr.length?I.fileCommentStr:null,unixPermissions:I.unixPermissions,dosPermissions:I.dosPermissions,createFolders:_.createFolders}),I.dir||(w.file(F).unsafeOriginalName=M)}return S.zipComment.length&&(w.comment=S.zipComment),w})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var o=n("../utils"),l=n("../stream/GenericWorker");function u(h,f){l.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(f)}o.inherits(u,l),u.prototype._bindStream=function(h){var f=this;(this._stream=h).pause(),h.on("data",function(p){f.push({data:p,meta:{percent:0}})}).on("error",function(p){f.isPaused?this.generatedError=p:f.error(p)}).on("end",function(){f.isPaused?f._upstreamEnded=!0:f.end()})},u.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=u},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var o=n("readable-stream").Readable;function l(u,h,f){o.call(this,h),this._helper=u;var p=this;u.on("data",function(g,b){p.push(g)||p._helper.pause(),f&&f(b)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},r.exports=l},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,i){function o(F,G,D){var O,P=u.getTypeOf(G),$=u.extend(D||{},p);$.date=$.date||new Date,$.compression!==null&&($.compression=$.compression.toUpperCase()),typeof $.unixPermissions=="string"&&($.unixPermissions=parseInt($.unixPermissions,8)),$.unixPermissions&&16384&$.unixPermissions&&($.dir=!0),$.dosPermissions&&16&$.dosPermissions&&($.dir=!0),$.dir&&(F=C(F)),$.createFolders&&(O=S(F))&&T.call(this,O,!0);var V=P==="string"&&$.binary===!1&&$.base64===!1;D&&D.binary!==void 0||($.binary=!V),(G instanceof g&&G.uncompressedSize===0||$.dir||!G||G.length===0)&&($.base64=!1,$.binary=!0,G="",$.compression="STORE",P="string");var j=null;j=G instanceof g||G instanceof h?G:w.isNode&&w.isStream(G)?new x(F,G):u.prepareContent(F,G,$.binary,$.optimizedBinaryString,$.base64);var B=new b(F,j,$);this.files[F]=B}var l=n("./utf8"),u=n("./utils"),h=n("./stream/GenericWorker"),f=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),b=n("./zipObject"),_=n("./generate"),w=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),S=function(F){F.slice(-1)==="/"&&(F=F.substring(0,F.length-1));var G=F.lastIndexOf("/");return 0<G?F.substring(0,G):""},C=function(F){return F.slice(-1)!=="/"&&(F+="/"),F},T=function(F,G){return G=G!==void 0?G:p.createFolders,F=C(F),this.files[F]||o.call(this,F,null,{dir:!0,createFolders:G}),this.files[F]};function I(F){return Object.prototype.toString.call(F)==="[object RegExp]"}var M={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(F){var G,D,O;for(G in this.files)O=this.files[G],(D=G.slice(this.root.length,G.length))&&G.slice(0,this.root.length)===this.root&&F(D,O)},filter:function(F){var G=[];return this.forEach(function(D,O){F(D,O)&&G.push(O)}),G},file:function(F,G,D){if(arguments.length!==1)return F=this.root+F,o.call(this,F,G,D),this;if(I(F)){var O=F;return this.filter(function($,V){return!V.dir&&O.test($)})}var P=this.files[this.root+F];return P&&!P.dir?P:null},folder:function(F){if(!F)return this;if(I(F))return this.filter(function(P,$){return $.dir&&F.test(P)});var G=this.root+F,D=T.call(this,G),O=this.clone();return O.root=D.name,O},remove:function(F){F=this.root+F;var G=this.files[F];if(G||(F.slice(-1)!=="/"&&(F+="/"),G=this.files[F]),G&&!G.dir)delete this.files[F];else for(var D=this.filter(function(P,$){return $.name.slice(0,F.length)===F}),O=0;O<D.length;O++)delete this.files[D[O].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(F){var G,D={};try{if((D=u.extend(F||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=D.type.toLowerCase(),D.compression=D.compression.toUpperCase(),D.type==="binarystring"&&(D.type="string"),!D.type)throw new Error("No output type specified.");u.checkSupport(D.type),D.platform!=="darwin"&&D.platform!=="freebsd"&&D.platform!=="linux"&&D.platform!=="sunos"||(D.platform="UNIX"),D.platform==="win32"&&(D.platform="DOS");var O=D.comment||this.comment||"";G=_.generateWorker(this,D,O)}catch(P){(G=new h("error")).error(P)}return new f(G,D.type||"string",D.mimeType)},generateAsync:function(F,G){return this.generateInternalStream(F).accumulate(G)},generateNodeStream:function(F,G){return(F=F||{}).type||(F.type="nodebuffer"),this.generateInternalStream(F).toNodejsStream(G)}};r.exports=M},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var o=n("./DataReader");function l(u){o.call(this,u);for(var h=0;h<this.data.length;h++)u[h]=255&u[h]}n("../utils").inherits(l,o),l.prototype.byteAt=function(u){return this.data[this.zero+u]},l.prototype.lastIndexOfSignature=function(u){for(var h=u.charCodeAt(0),f=u.charCodeAt(1),p=u.charCodeAt(2),g=u.charCodeAt(3),b=this.length-4;0<=b;--b)if(this.data[b]===h&&this.data[b+1]===f&&this.data[b+2]===p&&this.data[b+3]===g)return b-this.zero;return-1},l.prototype.readAndCheckSignature=function(u){var h=u.charCodeAt(0),f=u.charCodeAt(1),p=u.charCodeAt(2),g=u.charCodeAt(3),b=this.readData(4);return h===b[0]&&f===b[1]&&p===b[2]&&g===b[3]},l.prototype.readData=function(u){if(this.checkOffset(u),u===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+u);return this.index+=u,h},r.exports=l},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var o=n("../utils");function l(u){this.data=u,this.length=u.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(u){this.checkIndex(this.index+u)},checkIndex:function(u){if(this.length<this.zero+u||u<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+u+"). Corrupted zip ?")},setIndex:function(u){this.checkIndex(u),this.index=u},skip:function(u){this.setIndex(this.index+u)},byteAt:function(){},readInt:function(u){var h,f=0;for(this.checkOffset(u),h=this.index+u-1;h>=this.index;h--)f=(f<<8)+this.byteAt(h);return this.index+=u,f},readString:function(u){return o.transformTo("string",this.readData(u))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var u=this.readInt(4);return new Date(Date.UTC(1980+(u>>25&127),(u>>21&15)-1,u>>16&31,u>>11&31,u>>5&63,(31&u)<<1))}},r.exports=l},{"../utils":32}],19:[function(n,r,i){var o=n("./Uint8ArrayReader");function l(u){o.call(this,u)}n("../utils").inherits(l,o),l.prototype.readData=function(u){this.checkOffset(u);var h=this.data.slice(this.zero+this.index,this.zero+this.index+u);return this.index+=u,h},r.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var o=n("./DataReader");function l(u){o.call(this,u)}n("../utils").inherits(l,o),l.prototype.byteAt=function(u){return this.data.charCodeAt(this.zero+u)},l.prototype.lastIndexOfSignature=function(u){return this.data.lastIndexOf(u)-this.zero},l.prototype.readAndCheckSignature=function(u){return u===this.readData(4)},l.prototype.readData=function(u){this.checkOffset(u);var h=this.data.slice(this.zero+this.index,this.zero+this.index+u);return this.index+=u,h},r.exports=l},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var o=n("./ArrayReader");function l(u){o.call(this,u)}n("../utils").inherits(l,o),l.prototype.readData=function(u){if(this.checkOffset(u),u===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+u);return this.index+=u,h},r.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var o=n("../utils"),l=n("../support"),u=n("./ArrayReader"),h=n("./StringReader"),f=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var b=o.getTypeOf(g);return o.checkSupport(b),b!=="string"||l.uint8array?b==="nodebuffer"?new f(g):l.uint8array?new p(o.transformTo("uint8array",g)):new u(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var o=n("./GenericWorker"),l=n("../utils");function u(h){o.call(this,"ConvertWorker to "+h),this.destType=h}l.inherits(u,o),u.prototype.processChunk=function(h){this.push({data:l.transformTo(this.destType,h.data),meta:h.meta})},r.exports=u},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var o=n("./GenericWorker"),l=n("../crc32");function u(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(u,o),u.prototype.processChunk=function(h){this.streamInfo.crc32=l(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=u},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function u(h){l.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(u,l),u.prototype.processChunk=function(h){if(h){var f=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=f+h.data.length}l.prototype.processChunk.call(this,h)},r.exports=u},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function u(h){l.call(this,"DataWorker");var f=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){f.dataIsReady=!0,f.data=p,f.max=p&&p.length||0,f.type=o.getTypeOf(p),f.isPaused||f._tickAndRepeat()},function(p){f.error(p)})}o.inherits(u,l),u.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},u.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},u.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,f=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,f);break;case"uint8array":h=this.data.subarray(this.index,f);break;case"array":case"nodebuffer":h=this.data.slice(this.index,f)}return this.index=f,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=u},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,u){return this._listeners[l].push(u),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,u){if(this._listeners[l])for(var h=0;h<this._listeners[l].length;h++)this._listeners[l][h].call(this,u)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var u=this;return l.on("data",function(h){u.processChunk(h)}),l.on("end",function(){u.end()}),l.on("error",function(h){u.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,u){return this.extraStreamInfo[l]=u,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},r.exports=o},{}],29:[function(n,r,i){var o=n("../utils"),l=n("./ConvertWorker"),u=n("./GenericWorker"),h=n("../base64"),f=n("../support"),p=n("../external"),g=null;if(f.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function b(w,x){return new p.Promise(function(S,C){var T=[],I=w._internalType,M=w._outputType,F=w._mimeType;w.on("data",function(G,D){T.push(G),x&&x(D)}).on("error",function(G){T=[],C(G)}).on("end",function(){try{var G=(function(D,O,P){switch(D){case"blob":return o.newBlob(o.transformTo("arraybuffer",O),P);case"base64":return h.encode(O);default:return o.transformTo(D,O)}})(M,(function(D,O){var P,$=0,V=null,j=0;for(P=0;P<O.length;P++)j+=O[P].length;switch(D){case"string":return O.join("");case"array":return Array.prototype.concat.apply([],O);case"uint8array":for(V=new Uint8Array(j),P=0;P<O.length;P++)V.set(O[P],$),$+=O[P].length;return V;case"nodebuffer":return Buffer.concat(O);default:throw new Error("concat : unsupported type '"+D+"'")}})(I,T),F);S(G)}catch(D){C(D)}T=[]}).resume()})}function _(w,x,S){var C=x;switch(x){case"blob":case"arraybuffer":C="uint8array";break;case"base64":C="string"}try{this._internalType=C,this._outputType=x,this._mimeType=S,o.checkSupport(C),this._worker=w.pipe(new l(C)),w.lock()}catch(T){this._worker=new u("error"),this._worker.error(T)}}_.prototype={accumulate:function(w){return b(this,w)},on:function(w,x){var S=this;return w==="data"?this._worker.on(w,function(C){x.call(S,C.data,C.meta)}):this._worker.on(w,function(){o.delay(x,arguments,S)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(w){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},w)}},r.exports=_},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),i.blob=l.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var o=n("./utils"),l=n("./support"),u=n("./nodejsUtils"),h=n("./stream/GenericWorker"),f=new Array(256),p=0;p<256;p++)f[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;f[254]=f[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function b(){h.call(this,"utf-8 encode")}i.utf8encode=function(_){return l.nodebuffer?u.newBufferFrom(_,"utf-8"):(function(w){var x,S,C,T,I,M=w.length,F=0;for(T=0;T<M;T++)(64512&(S=w.charCodeAt(T)))==55296&&T+1<M&&(64512&(C=w.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(C-56320),T++),F+=S<128?1:S<2048?2:S<65536?3:4;for(x=l.uint8array?new Uint8Array(F):new Array(F),T=I=0;I<F;T++)(64512&(S=w.charCodeAt(T)))==55296&&T+1<M&&(64512&(C=w.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(C-56320),T++),S<128?x[I++]=S:(S<2048?x[I++]=192|S>>>6:(S<65536?x[I++]=224|S>>>12:(x[I++]=240|S>>>18,x[I++]=128|S>>>12&63),x[I++]=128|S>>>6&63),x[I++]=128|63&S);return x})(_)},i.utf8decode=function(_){return l.nodebuffer?o.transformTo("nodebuffer",_).toString("utf-8"):(function(w){var x,S,C,T,I=w.length,M=new Array(2*I);for(x=S=0;x<I;)if((C=w[x++])<128)M[S++]=C;else if(4<(T=f[C]))M[S++]=65533,x+=T-1;else{for(C&=T===2?31:T===3?15:7;1<T&&x<I;)C=C<<6|63&w[x++],T--;1<T?M[S++]=65533:C<65536?M[S++]=C:(C-=65536,M[S++]=55296|C>>10&1023,M[S++]=56320|1023&C)}return M.length!==S&&(M.subarray?M=M.subarray(0,S):M.length=S),o.applyFromCharCode(M)})(_=o.transformTo(l.uint8array?"uint8array":"array",_))},o.inherits(g,h),g.prototype.processChunk=function(_){var w=o.transformTo(l.uint8array?"uint8array":"array",_.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var x=w;(w=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),w.set(x,this.leftOver.length)}else w=this.leftOver.concat(w);this.leftOver=null}var S=(function(T,I){var M;for((I=I||T.length)>T.length&&(I=T.length),M=I-1;0<=M&&(192&T[M])==128;)M--;return M<0||M===0?I:M+f[T[M]]>I?M:I})(w),C=w;S!==w.length&&(l.uint8array?(C=w.subarray(0,S),this.leftOver=w.subarray(S,w.length)):(C=w.slice(0,S),this.leftOver=w.slice(S,w.length))),this.push({data:i.utf8decode(C),meta:_.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,o.inherits(b,h),b.prototype.processChunk=function(_){this.push({data:i.utf8encode(_.data),meta:_.meta})},i.Utf8EncodeWorker=b},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var o=n("./support"),l=n("./base64"),u=n("./nodejsUtils"),h=n("./external");function f(x){return x}function p(x,S){for(var C=0;C<x.length;++C)S[C]=255&x.charCodeAt(C);return S}n("setimmediate"),i.newBlob=function(x,S){i.checkSupport("blob");try{return new Blob([x],{type:S})}catch{try{var C=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return C.append(x),C.getBlob(S)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(x,S,C){var T=[],I=0,M=x.length;if(M<=C)return String.fromCharCode.apply(null,x);for(;I<M;)S==="array"||S==="nodebuffer"?T.push(String.fromCharCode.apply(null,x.slice(I,Math.min(I+C,M)))):T.push(String.fromCharCode.apply(null,x.subarray(I,Math.min(I+C,M)))),I+=C;return T.join("")},stringifyByChar:function(x){for(var S="",C=0;C<x.length;C++)S+=String.fromCharCode(x[C]);return S},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,u.allocBuffer(1)).length===1}catch{return!1}})()}};function b(x){var S=65536,C=i.getTypeOf(x),T=!0;if(C==="uint8array"?T=g.applyCanBeUsed.uint8array:C==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<S;)try{return g.stringifyByChunk(x,C,S)}catch{S=Math.floor(S/2)}return g.stringifyByChar(x)}function _(x,S){for(var C=0;C<x.length;C++)S[C]=x[C];return S}i.applyFromCharCode=b;var w={};w.string={string:f,array:function(x){return p(x,new Array(x.length))},arraybuffer:function(x){return w.string.uint8array(x).buffer},uint8array:function(x){return p(x,new Uint8Array(x.length))},nodebuffer:function(x){return p(x,u.allocBuffer(x.length))}},w.array={string:b,array:f,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return u.newBufferFrom(x)}},w.arraybuffer={string:function(x){return b(new Uint8Array(x))},array:function(x){return _(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:f,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return u.newBufferFrom(new Uint8Array(x))}},w.uint8array={string:b,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:f,nodebuffer:function(x){return u.newBufferFrom(x)}},w.nodebuffer={string:b,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return w.nodebuffer.uint8array(x).buffer},uint8array:function(x){return _(x,new Uint8Array(x.length))},nodebuffer:f},i.transformTo=function(x,S){if(S=S||"",!x)return S;i.checkSupport(x);var C=i.getTypeOf(S);return w[C][x](S)},i.resolve=function(x){for(var S=x.split("/"),C=[],T=0;T<S.length;T++){var I=S[T];I==="."||I===""&&T!==0&&T!==S.length-1||(I===".."?C.pop():C.push(I))}return C.join("/")},i.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":o.nodebuffer&&u.isBuffer(x)?"nodebuffer":o.uint8array&&x instanceof Uint8Array?"uint8array":o.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(x){if(!o[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(x){var S,C,T="";for(C=0;C<(x||"").length;C++)T+="\\x"+((S=x.charCodeAt(C))<16?"0":"")+S.toString(16).toUpperCase();return T},i.delay=function(x,S,C){setImmediate(function(){x.apply(C||null,S||[])})},i.inherits=function(x,S){function C(){}C.prototype=S.prototype,x.prototype=new C},i.extend=function(){var x,S,C={};for(x=0;x<arguments.length;x++)for(S in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],S)&&C[S]===void 0&&(C[S]=arguments[x][S]);return C},i.prepareContent=function(x,S,C,T,I){return h.Promise.resolve(S).then(function(M){return o.blob&&(M instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(M))!==-1)&&typeof FileReader<"u"?new h.Promise(function(F,G){var D=new FileReader;D.onload=function(O){F(O.target.result)},D.onerror=function(O){G(O.target.error)},D.readAsArrayBuffer(M)}):M}).then(function(M){var F=i.getTypeOf(M);return F?(F==="arraybuffer"?M=i.transformTo("uint8array",M):F==="string"&&(I?M=l.decode(M):C&&T!==!0&&(M=(function(G){return p(G,o.uint8array?new Uint8Array(G.length):new Array(G.length))})(M))),M):h.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),u=n("./signature"),h=n("./zipEntry"),f=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(b)+", expected "+l.pretty(g)+")")}},isSignature:function(g,b){var _=this.reader.index;this.reader.setIndex(g);var w=this.reader.readString(4)===b;return this.reader.setIndex(_),w},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),b=f.uint8array?"uint8array":"array",_=l.transformTo(b,g);this.zipComment=this.loadOptions.decodeFileName(_)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,b,_,w=this.zip64EndOfCentralSize-44;0<w;)g=this.reader.readInt(2),b=this.reader.readInt(4),_=this.reader.readData(b),this.zip64ExtensibleData[g]={id:g,length:b,value:_}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,b;for(g=0;g<this.files.length;g++)b=this.files[g],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(u.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(u.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(u.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,u.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var b=g;if(this.checkSignature(u.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(u.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(u.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,u.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(u.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(u.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var _=this.centralDirOffset+this.centralDirSize;this.zip64&&(_+=20,_+=12+this.zip64EndOfCentralSize);var w=b-_;if(0<w)this.isSignature(b,u.CENTRAL_FILE_HEADER)||(this.reader.zero=w);else if(w<0)throw new Error("Corrupted zip: missing "+Math.abs(w)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),u=n("./compressedObject"),h=n("./crc32"),f=n("./utf8"),p=n("./compressions"),g=n("./support");function b(_,w){this.options=_,this.loadOptions=w}b.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(_){var w,x;if(_.skip(22),this.fileNameLength=_.readInt(2),x=_.readInt(2),this.fileName=_.readData(this.fileNameLength),_.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((w=(function(S){for(var C in p)if(Object.prototype.hasOwnProperty.call(p,C)&&p[C].magic===S)return p[C];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new u(this.compressedSize,this.uncompressedSize,this.crc32,w,_.readData(this.compressedSize))},readCentralPart:function(_){this.versionMadeBy=_.readInt(2),_.skip(2),this.bitFlag=_.readInt(2),this.compressionMethod=_.readString(2),this.date=_.readDate(),this.crc32=_.readInt(4),this.compressedSize=_.readInt(4),this.uncompressedSize=_.readInt(4);var w=_.readInt(2);if(this.extraFieldsLength=_.readInt(2),this.fileCommentLength=_.readInt(2),this.diskNumberStart=_.readInt(2),this.internalFileAttributes=_.readInt(2),this.externalFileAttributes=_.readInt(4),this.localHeaderOffset=_.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");_.skip(w),this.readExtraFields(_),this.parseZIP64ExtraField(_),this.fileComment=_.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var _=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),_==0&&(this.dosPermissions=63&this.externalFileAttributes),_==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var _=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=_.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=_.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=_.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=_.readInt(4))}},readExtraFields:function(_){var w,x,S,C=_.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});_.index+4<C;)w=_.readInt(2),x=_.readInt(2),S=_.readData(x),this.extraFields[w]={id:w,length:x,value:S};_.setIndex(C)},handleUTF8:function(){var _=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=f.utf8decode(this.fileName),this.fileCommentStr=f.utf8decode(this.fileComment);else{var w=this.findExtraFieldUnicodePath();if(w!==null)this.fileNameStr=w;else{var x=l.transformTo(_,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var C=l.transformTo(_,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(C)}}},findExtraFieldUnicodePath:function(){var _=this.extraFields[28789];if(_){var w=o(_.value);return w.readInt(1)!==1||h(this.fileName)!==w.readInt(4)?null:f.utf8decode(w.readData(_.length-5))}return null},findExtraFieldUnicodeComment:function(){var _=this.extraFields[25461];if(_){var w=o(_.value);return w.readInt(1)!==1||h(this.fileComment)!==w.readInt(4)?null:f.utf8decode(w.readData(_.length-5))}return null}},r.exports=b},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function o(w,x,S){this.name=w,this.dir=S.dir,this.date=S.date,this.comment=S.comment,this.unixPermissions=S.unixPermissions,this.dosPermissions=S.dosPermissions,this._data=x,this._dataBinary=S.binary,this.options={compression:S.compression,compressionOptions:S.compressionOptions}}var l=n("./stream/StreamHelper"),u=n("./stream/DataWorker"),h=n("./utf8"),f=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(w){var x=null,S="string";try{if(!w)throw new Error("No output type specified.");var C=(S=w.toLowerCase())==="string"||S==="text";S!=="binarystring"&&S!=="text"||(S="string"),x=this._decompressWorker();var T=!this._dataBinary;T&&!C&&(x=x.pipe(new h.Utf8EncodeWorker)),!T&&C&&(x=x.pipe(new h.Utf8DecodeWorker))}catch(I){(x=new p("error")).error(I)}return new l(x,S,"")},async:function(w,x){return this.internalStream(w).accumulate(x)},nodeStream:function(w,x){return this.internalStream(w||"nodebuffer").toNodejsStream(x)},_compressWorker:function(w,x){if(this._data instanceof f&&this._data.compression.magic===w.magic)return this._data.getCompressedWorker();var S=this._decompressWorker();return this._dataBinary||(S=S.pipe(new h.Utf8EncodeWorker)),f.createWorkerFrom(S,w,x)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof p?this._data:new u(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],b=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},_=0;_<g.length;_++)o.prototype[g[_]]=b;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(o){var l,u,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var f=0,p=new h(w),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=f=++f%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){w(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(w,0)};else{var b=new o.MessageChannel;b.port1.onmessage=w,l=function(){b.port2.postMessage(0)}}var _=[];function w(){var x,S;u=!0;for(var C=_.length;C;){for(S=_,_=[],x=-1;++x<C;)S[x]();C=_.length}u=!1}r.exports=function(x){_.push(x)!==1||u||l()}}).call(this,typeof Gh<"u"?Gh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var o=n("immediate");function l(){}var u={},h=["REJECTED"],f=["FULFILLED"],p=["PENDING"];function g(C){if(typeof C!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,C!==l&&x(this,C)}function b(C,T,I){this.promise=C,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof I=="function"&&(this.onRejected=I,this.callRejected=this.otherCallRejected)}function _(C,T,I){o(function(){var M;try{M=T(I)}catch(F){return u.reject(C,F)}M===C?u.reject(C,new TypeError("Cannot resolve promise with itself")):u.resolve(C,M)})}function w(C){var T=C&&C.then;if(C&&(typeof C=="object"||typeof C=="function")&&typeof T=="function")return function(){T.apply(C,arguments)}}function x(C,T){var I=!1;function M(D){I||(I=!0,u.reject(C,D))}function F(D){I||(I=!0,u.resolve(C,D))}var G=S(function(){T(F,M)});G.status==="error"&&M(G.value)}function S(C,T){var I={};try{I.value=C(T),I.status="success"}catch(M){I.status="error",I.value=M}return I}(r.exports=g).prototype.finally=function(C){if(typeof C!="function")return this;var T=this.constructor;return this.then(function(I){return T.resolve(C()).then(function(){return I})},function(I){return T.resolve(C()).then(function(){throw I})})},g.prototype.catch=function(C){return this.then(null,C)},g.prototype.then=function(C,T){if(typeof C!="function"&&this.state===f||typeof T!="function"&&this.state===h)return this;var I=new this.constructor(l);return this.state!==p?_(I,this.state===f?C:T,this.outcome):this.queue.push(new b(I,C,T)),I},b.prototype.callFulfilled=function(C){u.resolve(this.promise,C)},b.prototype.otherCallFulfilled=function(C){_(this.promise,this.onFulfilled,C)},b.prototype.callRejected=function(C){u.reject(this.promise,C)},b.prototype.otherCallRejected=function(C){_(this.promise,this.onRejected,C)},u.resolve=function(C,T){var I=S(w,T);if(I.status==="error")return u.reject(C,I.value);var M=I.value;if(M)x(C,M);else{C.state=f,C.outcome=T;for(var F=-1,G=C.queue.length;++F<G;)C.queue[F].callFulfilled(T)}return C},u.reject=function(C,T){C.state=h,C.outcome=T;for(var I=-1,M=C.queue.length;++I<M;)C.queue[I].callRejected(T);return C},g.resolve=function(C){return C instanceof this?C:u.resolve(new this(l),C)},g.reject=function(C){var T=new this(l);return u.reject(T,C)},g.all=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var I=C.length,M=!1;if(!I)return this.resolve([]);for(var F=new Array(I),G=0,D=-1,O=new this(l);++D<I;)P(C[D],D);return O;function P($,V){T.resolve($).then(function(j){F[V]=j,++G!==I||M||(M=!0,u.resolve(O,F))},function(j){M||(M=!0,u.reject(O,j))})}},g.race=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var I=C.length,M=!1;if(!I)return this.resolve([]);for(var F=-1,G=new this(l);++F<I;)D=C[F],T.resolve(D).then(function(O){M||(M=!0,u.resolve(G,O))},function(O){M||(M=!0,u.reject(G,O))});var D;return G}},{immediate:36}],38:[function(n,r,i){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var o=n("./zlib/deflate"),l=n("./utils/common"),u=n("./utils/strings"),h=n("./zlib/messages"),f=n("./zlib/zstream"),p=Object.prototype.toString,g=0,b=-1,_=0,w=8;function x(C){if(!(this instanceof x))return new x(C);this.options=l.assign({level:b,method:w,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},C||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var I=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(I!==g)throw new Error(h[I]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var M;if(M=typeof T.dictionary=="string"?u.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(I=o.deflateSetDictionary(this.strm,M))!==g)throw new Error(h[I]);this._dict_set=!0}}function S(C,T){var I=new x(T);if(I.push(C,!0),I.err)throw I.msg||h[I.err];return I.result}x.prototype.push=function(C,T){var I,M,F=this.strm,G=this.options.chunkSize;if(this.ended)return!1;M=T===~~T?T:T===!0?4:0,typeof C=="string"?F.input=u.string2buf(C):p.call(C)==="[object ArrayBuffer]"?F.input=new Uint8Array(C):F.input=C,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new l.Buf8(G),F.next_out=0,F.avail_out=G),(I=o.deflate(F,M))!==1&&I!==g)return this.onEnd(I),!(this.ended=!0);F.avail_out!==0&&(F.avail_in!==0||M!==4&&M!==2)||(this.options.to==="string"?this.onData(u.buf2binstring(l.shrinkBuf(F.output,F.next_out))):this.onData(l.shrinkBuf(F.output,F.next_out)))}while((0<F.avail_in||F.avail_out===0)&&I!==1);return M===4?(I=o.deflateEnd(this.strm),this.onEnd(I),this.ended=!0,I===g):M!==2||(this.onEnd(g),!(F.avail_out=0))},x.prototype.onData=function(C){this.chunks.push(C)},x.prototype.onEnd=function(C){C===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},i.Deflate=x,i.deflate=S,i.deflateRaw=function(C,T){return(T=T||{}).raw=!0,S(C,T)},i.gzip=function(C,T){return(T=T||{}).gzip=!0,S(C,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var o=n("./zlib/inflate"),l=n("./utils/common"),u=n("./utils/strings"),h=n("./zlib/constants"),f=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),b=Object.prototype.toString;function _(x){if(!(this instanceof _))return new _(x);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},x||{});var S=this.options;S.raw&&0<=S.windowBits&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),!(0<=S.windowBits&&S.windowBits<16)||x&&x.windowBits||(S.windowBits+=32),15<S.windowBits&&S.windowBits<48&&(15&S.windowBits)==0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var C=o.inflateInit2(this.strm,S.windowBits);if(C!==h.Z_OK)throw new Error(f[C]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function w(x,S){var C=new _(S);if(C.push(x,!0),C.err)throw C.msg||f[C.err];return C.result}_.prototype.push=function(x,S){var C,T,I,M,F,G,D=this.strm,O=this.options.chunkSize,P=this.options.dictionary,$=!1;if(this.ended)return!1;T=S===~~S?S:S===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof x=="string"?D.input=u.binstring2buf(x):b.call(x)==="[object ArrayBuffer]"?D.input=new Uint8Array(x):D.input=x,D.next_in=0,D.avail_in=D.input.length;do{if(D.avail_out===0&&(D.output=new l.Buf8(O),D.next_out=0,D.avail_out=O),(C=o.inflate(D,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&P&&(G=typeof P=="string"?u.string2buf(P):b.call(P)==="[object ArrayBuffer]"?new Uint8Array(P):P,C=o.inflateSetDictionary(this.strm,G)),C===h.Z_BUF_ERROR&&$===!0&&(C=h.Z_OK,$=!1),C!==h.Z_STREAM_END&&C!==h.Z_OK)return this.onEnd(C),!(this.ended=!0);D.next_out&&(D.avail_out!==0&&C!==h.Z_STREAM_END&&(D.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(I=u.utf8border(D.output,D.next_out),M=D.next_out-I,F=u.buf2string(D.output,I),D.next_out=M,D.avail_out=O-M,M&&l.arraySet(D.output,D.output,I,M,0),this.onData(F)):this.onData(l.shrinkBuf(D.output,D.next_out)))),D.avail_in===0&&D.avail_out===0&&($=!0)}while((0<D.avail_in||D.avail_out===0)&&C!==h.Z_STREAM_END);return C===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(C=o.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(D.avail_out=0))},_.prototype.onData=function(x){this.chunks.push(x)},_.prototype.onEnd=function(x){x===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},i.Inflate=_,i.inflate=w,i.inflateRaw=function(x,S){return(S=S||{}).raw=!0,w(x,S)},i.ungzip=w},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(h){for(var f=Array.prototype.slice.call(arguments,1);f.length;){var p=f.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},i.shrinkBuf=function(h,f){return h.length===f?h:h.subarray?h.subarray(0,f):(h.length=f,h)};var l={arraySet:function(h,f,p,g,b){if(f.subarray&&h.subarray)h.set(f.subarray(p,p+g),b);else for(var _=0;_<g;_++)h[b+_]=f[p+_]},flattenChunks:function(h){var f,p,g,b,_,w;for(f=g=0,p=h.length;f<p;f++)g+=h[f].length;for(w=new Uint8Array(g),f=b=0,p=h.length;f<p;f++)_=h[f],w.set(_,b),b+=_.length;return w}},u={arraySet:function(h,f,p,g,b){for(var _=0;_<g;_++)h[b+_]=f[p+_]},flattenChunks:function(h){return[].concat.apply([],h)}};i.setTyped=function(h){h?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,l)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,u))},i.setTyped(o)},{}],42:[function(n,r,i){var o=n("./common"),l=!0,u=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{u=!1}for(var h=new o.Buf8(256),f=0;f<256;f++)h[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;function p(g,b){if(b<65537&&(g.subarray&&u||!g.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(g,b));for(var _="",w=0;w<b;w++)_+=String.fromCharCode(g[w]);return _}h[254]=h[254]=1,i.string2buf=function(g){var b,_,w,x,S,C=g.length,T=0;for(x=0;x<C;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(w=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),x++),T+=_<128?1:_<2048?2:_<65536?3:4;for(b=new o.Buf8(T),x=S=0;S<T;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(w=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),x++),_<128?b[S++]=_:(_<2048?b[S++]=192|_>>>6:(_<65536?b[S++]=224|_>>>12:(b[S++]=240|_>>>18,b[S++]=128|_>>>12&63),b[S++]=128|_>>>6&63),b[S++]=128|63&_);return b},i.buf2binstring=function(g){return p(g,g.length)},i.binstring2buf=function(g){for(var b=new o.Buf8(g.length),_=0,w=b.length;_<w;_++)b[_]=g.charCodeAt(_);return b},i.buf2string=function(g,b){var _,w,x,S,C=b||g.length,T=new Array(2*C);for(_=w=0;_<C;)if((x=g[_++])<128)T[w++]=x;else if(4<(S=h[x]))T[w++]=65533,_+=S-1;else{for(x&=S===2?31:S===3?15:7;1<S&&_<C;)x=x<<6|63&g[_++],S--;1<S?T[w++]=65533:x<65536?T[w++]=x:(x-=65536,T[w++]=55296|x>>10&1023,T[w++]=56320|1023&x)}return p(T,w)},i.utf8border=function(g,b){var _;for((b=b||g.length)>g.length&&(b=g.length),_=b-1;0<=_&&(192&g[_])==128;)_--;return _<0||_===0?b:_+h[g[_]]>b?_:b}},{"./common":41}],43:[function(n,r,i){r.exports=function(o,l,u,h){for(var f=65535&o|0,p=o>>>16&65535|0,g=0;u!==0;){for(u-=g=2e3<u?2e3:u;p=p+(f=f+l[h++]|0)|0,--g;);f%=65521,p%=65521}return f|p<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var o=(function(){for(var l,u=[],h=0;h<256;h++){l=h;for(var f=0;f<8;f++)l=1&l?3988292384^l>>>1:l>>>1;u[h]=l}return u})();r.exports=function(l,u,h,f){var p=o,g=f+h;l^=-1;for(var b=f;b<g;b++)l=l>>>8^p[255&(l^u[b])];return-1^l}},{}],46:[function(n,r,i){var o,l=n("../utils/common"),u=n("./trees"),h=n("./adler32"),f=n("./crc32"),p=n("./messages"),g=0,b=4,_=0,w=-2,x=-1,S=4,C=2,T=8,I=9,M=286,F=30,G=19,D=2*M+1,O=15,P=3,$=258,V=$+P+1,j=42,B=113,k=1,Y=2,X=3,W=4;function te(L,de){return L.msg=p[de],de}function H(L){return(L<<1)-(4<L?9:0)}function re(L){for(var de=L.length;0<=--de;)L[de]=0}function N(L){var de=L.state,ye=de.pending;ye>L.avail_out&&(ye=L.avail_out),ye!==0&&(l.arraySet(L.output,de.pending_buf,de.pending_out,ye,L.next_out),L.next_out+=ye,de.pending_out+=ye,L.total_out+=ye,L.avail_out-=ye,de.pending-=ye,de.pending===0&&(de.pending_out=0))}function q(L,de){u._tr_flush_block(L,0<=L.block_start?L.block_start:-1,L.strstart-L.block_start,de),L.block_start=L.strstart,N(L.strm)}function J(L,de){L.pending_buf[L.pending++]=de}function ne(L,de){L.pending_buf[L.pending++]=de>>>8&255,L.pending_buf[L.pending++]=255&de}function ae(L,de){var ye,ee,Z=L.max_chain_length,oe=L.strstart,Se=L.prev_length,xe=L.nice_match,ie=L.strstart>L.w_size-V?L.strstart-(L.w_size-V):0,Re=L.window,Pe=L.w_mask,Ne=L.prev,qe=L.strstart+$,xt=Re[oe+Se-1],st=Re[oe+Se];L.prev_length>=L.good_match&&(Z>>=2),xe>L.lookahead&&(xe=L.lookahead);do if(Re[(ye=de)+Se]===st&&Re[ye+Se-1]===xt&&Re[ye]===Re[oe]&&Re[++ye]===Re[oe+1]){oe+=2,ye++;do;while(Re[++oe]===Re[++ye]&&Re[++oe]===Re[++ye]&&Re[++oe]===Re[++ye]&&Re[++oe]===Re[++ye]&&Re[++oe]===Re[++ye]&&Re[++oe]===Re[++ye]&&Re[++oe]===Re[++ye]&&Re[++oe]===Re[++ye]&&oe<qe);if(ee=$-(qe-oe),oe=qe-$,Se<ee){if(L.match_start=de,xe<=(Se=ee))break;xt=Re[oe+Se-1],st=Re[oe+Se]}}while((de=Ne[de&Pe])>ie&&--Z!=0);return Se<=L.lookahead?Se:L.lookahead}function Ee(L){var de,ye,ee,Z,oe,Se,xe,ie,Re,Pe,Ne=L.w_size;do{if(Z=L.window_size-L.lookahead-L.strstart,L.strstart>=Ne+(Ne-V)){for(l.arraySet(L.window,L.window,Ne,Ne,0),L.match_start-=Ne,L.strstart-=Ne,L.block_start-=Ne,de=ye=L.hash_size;ee=L.head[--de],L.head[de]=Ne<=ee?ee-Ne:0,--ye;);for(de=ye=Ne;ee=L.prev[--de],L.prev[de]=Ne<=ee?ee-Ne:0,--ye;);Z+=Ne}if(L.strm.avail_in===0)break;if(Se=L.strm,xe=L.window,ie=L.strstart+L.lookahead,Re=Z,Pe=void 0,Pe=Se.avail_in,Re<Pe&&(Pe=Re),ye=Pe===0?0:(Se.avail_in-=Pe,l.arraySet(xe,Se.input,Se.next_in,Pe,ie),Se.state.wrap===1?Se.adler=h(Se.adler,xe,Pe,ie):Se.state.wrap===2&&(Se.adler=f(Se.adler,xe,Pe,ie)),Se.next_in+=Pe,Se.total_in+=Pe,Pe),L.lookahead+=ye,L.lookahead+L.insert>=P)for(oe=L.strstart-L.insert,L.ins_h=L.window[oe],L.ins_h=(L.ins_h<<L.hash_shift^L.window[oe+1])&L.hash_mask;L.insert&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[oe+P-1])&L.hash_mask,L.prev[oe&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=oe,oe++,L.insert--,!(L.lookahead+L.insert<P)););}while(L.lookahead<V&&L.strm.avail_in!==0)}function Ae(L,de){for(var ye,ee;;){if(L.lookahead<V){if(Ee(L),L.lookahead<V&&de===g)return k;if(L.lookahead===0)break}if(ye=0,L.lookahead>=P&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+P-1])&L.hash_mask,ye=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),ye!==0&&L.strstart-ye<=L.w_size-V&&(L.match_length=ae(L,ye)),L.match_length>=P)if(ee=u._tr_tally(L,L.strstart-L.match_start,L.match_length-P),L.lookahead-=L.match_length,L.match_length<=L.max_lazy_match&&L.lookahead>=P){for(L.match_length--;L.strstart++,L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+P-1])&L.hash_mask,ye=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart,--L.match_length!=0;);L.strstart++}else L.strstart+=L.match_length,L.match_length=0,L.ins_h=L.window[L.strstart],L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+1])&L.hash_mask;else ee=u._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++;if(ee&&(q(L,!1),L.strm.avail_out===0))return k}return L.insert=L.strstart<P-1?L.strstart:P-1,de===b?(q(L,!0),L.strm.avail_out===0?X:W):L.last_lit&&(q(L,!1),L.strm.avail_out===0)?k:Y}function ce(L,de){for(var ye,ee,Z;;){if(L.lookahead<V){if(Ee(L),L.lookahead<V&&de===g)return k;if(L.lookahead===0)break}if(ye=0,L.lookahead>=P&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+P-1])&L.hash_mask,ye=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),L.prev_length=L.match_length,L.prev_match=L.match_start,L.match_length=P-1,ye!==0&&L.prev_length<L.max_lazy_match&&L.strstart-ye<=L.w_size-V&&(L.match_length=ae(L,ye),L.match_length<=5&&(L.strategy===1||L.match_length===P&&4096<L.strstart-L.match_start)&&(L.match_length=P-1)),L.prev_length>=P&&L.match_length<=L.prev_length){for(Z=L.strstart+L.lookahead-P,ee=u._tr_tally(L,L.strstart-1-L.prev_match,L.prev_length-P),L.lookahead-=L.prev_length-1,L.prev_length-=2;++L.strstart<=Z&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+P-1])&L.hash_mask,ye=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),--L.prev_length!=0;);if(L.match_available=0,L.match_length=P-1,L.strstart++,ee&&(q(L,!1),L.strm.avail_out===0))return k}else if(L.match_available){if((ee=u._tr_tally(L,0,L.window[L.strstart-1]))&&q(L,!1),L.strstart++,L.lookahead--,L.strm.avail_out===0)return k}else L.match_available=1,L.strstart++,L.lookahead--}return L.match_available&&(ee=u._tr_tally(L,0,L.window[L.strstart-1]),L.match_available=0),L.insert=L.strstart<P-1?L.strstart:P-1,de===b?(q(L,!0),L.strm.avail_out===0?X:W):L.last_lit&&(q(L,!1),L.strm.avail_out===0)?k:Y}function fe(L,de,ye,ee,Z){this.good_length=L,this.max_lazy=de,this.nice_length=ye,this.max_chain=ee,this.func=Z}function Oe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*D),this.dyn_dtree=new l.Buf16(2*(2*F+1)),this.bl_tree=new l.Buf16(2*(2*G+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(O+1),this.heap=new l.Buf16(2*M+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*M+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Me(L){var de;return L&&L.state?(L.total_in=L.total_out=0,L.data_type=C,(de=L.state).pending=0,de.pending_out=0,de.wrap<0&&(de.wrap=-de.wrap),de.status=de.wrap?j:B,L.adler=de.wrap===2?0:1,de.last_flush=g,u._tr_init(de),_):te(L,w)}function Ge(L){var de=Me(L);return de===_&&(function(ye){ye.window_size=2*ye.w_size,re(ye.head),ye.max_lazy_match=o[ye.level].max_lazy,ye.good_match=o[ye.level].good_length,ye.nice_match=o[ye.level].nice_length,ye.max_chain_length=o[ye.level].max_chain,ye.strstart=0,ye.block_start=0,ye.lookahead=0,ye.insert=0,ye.match_length=ye.prev_length=P-1,ye.match_available=0,ye.ins_h=0})(L.state),de}function tt(L,de,ye,ee,Z,oe){if(!L)return w;var Se=1;if(de===x&&(de=6),ee<0?(Se=0,ee=-ee):15<ee&&(Se=2,ee-=16),Z<1||I<Z||ye!==T||ee<8||15<ee||de<0||9<de||oe<0||S<oe)return te(L,w);ee===8&&(ee=9);var xe=new Oe;return(L.state=xe).strm=L,xe.wrap=Se,xe.gzhead=null,xe.w_bits=ee,xe.w_size=1<<xe.w_bits,xe.w_mask=xe.w_size-1,xe.hash_bits=Z+7,xe.hash_size=1<<xe.hash_bits,xe.hash_mask=xe.hash_size-1,xe.hash_shift=~~((xe.hash_bits+P-1)/P),xe.window=new l.Buf8(2*xe.w_size),xe.head=new l.Buf16(xe.hash_size),xe.prev=new l.Buf16(xe.w_size),xe.lit_bufsize=1<<Z+6,xe.pending_buf_size=4*xe.lit_bufsize,xe.pending_buf=new l.Buf8(xe.pending_buf_size),xe.d_buf=1*xe.lit_bufsize,xe.l_buf=3*xe.lit_bufsize,xe.level=de,xe.strategy=oe,xe.method=ye,Ge(L)}o=[new fe(0,0,0,0,function(L,de){var ye=65535;for(ye>L.pending_buf_size-5&&(ye=L.pending_buf_size-5);;){if(L.lookahead<=1){if(Ee(L),L.lookahead===0&&de===g)return k;if(L.lookahead===0)break}L.strstart+=L.lookahead,L.lookahead=0;var ee=L.block_start+ye;if((L.strstart===0||L.strstart>=ee)&&(L.lookahead=L.strstart-ee,L.strstart=ee,q(L,!1),L.strm.avail_out===0)||L.strstart-L.block_start>=L.w_size-V&&(q(L,!1),L.strm.avail_out===0))return k}return L.insert=0,de===b?(q(L,!0),L.strm.avail_out===0?X:W):(L.strstart>L.block_start&&(q(L,!1),L.strm.avail_out),k)}),new fe(4,4,8,4,Ae),new fe(4,5,16,8,Ae),new fe(4,6,32,32,Ae),new fe(4,4,16,16,ce),new fe(8,16,32,32,ce),new fe(8,16,128,128,ce),new fe(8,32,128,256,ce),new fe(32,128,258,1024,ce),new fe(32,258,258,4096,ce)],i.deflateInit=function(L,de){return tt(L,de,T,15,8,0)},i.deflateInit2=tt,i.deflateReset=Ge,i.deflateResetKeep=Me,i.deflateSetHeader=function(L,de){return L&&L.state?L.state.wrap!==2?w:(L.state.gzhead=de,_):w},i.deflate=function(L,de){var ye,ee,Z,oe;if(!L||!L.state||5<de||de<0)return L?te(L,w):w;if(ee=L.state,!L.output||!L.input&&L.avail_in!==0||ee.status===666&&de!==b)return te(L,L.avail_out===0?-5:w);if(ee.strm=L,ye=ee.last_flush,ee.last_flush=de,ee.status===j)if(ee.wrap===2)L.adler=0,J(ee,31),J(ee,139),J(ee,8),ee.gzhead?(J(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),J(ee,255&ee.gzhead.time),J(ee,ee.gzhead.time>>8&255),J(ee,ee.gzhead.time>>16&255),J(ee,ee.gzhead.time>>24&255),J(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),J(ee,255&ee.gzhead.os),ee.gzhead.extra&&ee.gzhead.extra.length&&(J(ee,255&ee.gzhead.extra.length),J(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(L.adler=f(L.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=69):(J(ee,0),J(ee,0),J(ee,0),J(ee,0),J(ee,0),J(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),J(ee,3),ee.status=B);else{var Se=T+(ee.w_bits-8<<4)<<8;Se|=(2<=ee.strategy||ee.level<2?0:ee.level<6?1:ee.level===6?2:3)<<6,ee.strstart!==0&&(Se|=32),Se+=31-Se%31,ee.status=B,ne(ee,Se),ee.strstart!==0&&(ne(ee,L.adler>>>16),ne(ee,65535&L.adler)),L.adler=1}if(ee.status===69)if(ee.gzhead.extra){for(Z=ee.pending;ee.gzindex<(65535&ee.gzhead.extra.length)&&(ee.pending!==ee.pending_buf_size||(ee.gzhead.hcrc&&ee.pending>Z&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-Z,Z)),N(L),Z=ee.pending,ee.pending!==ee.pending_buf_size));)J(ee,255&ee.gzhead.extra[ee.gzindex]),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>Z&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-Z,Z)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=73)}else ee.status=73;if(ee.status===73)if(ee.gzhead.name){Z=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>Z&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-Z,Z)),N(L),Z=ee.pending,ee.pending===ee.pending_buf_size)){oe=1;break}oe=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0,J(ee,oe)}while(oe!==0);ee.gzhead.hcrc&&ee.pending>Z&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-Z,Z)),oe===0&&(ee.gzindex=0,ee.status=91)}else ee.status=91;if(ee.status===91)if(ee.gzhead.comment){Z=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>Z&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-Z,Z)),N(L),Z=ee.pending,ee.pending===ee.pending_buf_size)){oe=1;break}oe=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0,J(ee,oe)}while(oe!==0);ee.gzhead.hcrc&&ee.pending>Z&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-Z,Z)),oe===0&&(ee.status=103)}else ee.status=103;if(ee.status===103&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&N(L),ee.pending+2<=ee.pending_buf_size&&(J(ee,255&L.adler),J(ee,L.adler>>8&255),L.adler=0,ee.status=B)):ee.status=B),ee.pending!==0){if(N(L),L.avail_out===0)return ee.last_flush=-1,_}else if(L.avail_in===0&&H(de)<=H(ye)&&de!==b)return te(L,-5);if(ee.status===666&&L.avail_in!==0)return te(L,-5);if(L.avail_in!==0||ee.lookahead!==0||de!==g&&ee.status!==666){var xe=ee.strategy===2?(function(ie,Re){for(var Pe;;){if(ie.lookahead===0&&(Ee(ie),ie.lookahead===0)){if(Re===g)return k;break}if(ie.match_length=0,Pe=u._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++,Pe&&(q(ie,!1),ie.strm.avail_out===0))return k}return ie.insert=0,Re===b?(q(ie,!0),ie.strm.avail_out===0?X:W):ie.last_lit&&(q(ie,!1),ie.strm.avail_out===0)?k:Y})(ee,de):ee.strategy===3?(function(ie,Re){for(var Pe,Ne,qe,xt,st=ie.window;;){if(ie.lookahead<=$){if(Ee(ie),ie.lookahead<=$&&Re===g)return k;if(ie.lookahead===0)break}if(ie.match_length=0,ie.lookahead>=P&&0<ie.strstart&&(Ne=st[qe=ie.strstart-1])===st[++qe]&&Ne===st[++qe]&&Ne===st[++qe]){xt=ie.strstart+$;do;while(Ne===st[++qe]&&Ne===st[++qe]&&Ne===st[++qe]&&Ne===st[++qe]&&Ne===st[++qe]&&Ne===st[++qe]&&Ne===st[++qe]&&Ne===st[++qe]&&qe<xt);ie.match_length=$-(xt-qe),ie.match_length>ie.lookahead&&(ie.match_length=ie.lookahead)}if(ie.match_length>=P?(Pe=u._tr_tally(ie,1,ie.match_length-P),ie.lookahead-=ie.match_length,ie.strstart+=ie.match_length,ie.match_length=0):(Pe=u._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++),Pe&&(q(ie,!1),ie.strm.avail_out===0))return k}return ie.insert=0,Re===b?(q(ie,!0),ie.strm.avail_out===0?X:W):ie.last_lit&&(q(ie,!1),ie.strm.avail_out===0)?k:Y})(ee,de):o[ee.level].func(ee,de);if(xe!==X&&xe!==W||(ee.status=666),xe===k||xe===X)return L.avail_out===0&&(ee.last_flush=-1),_;if(xe===Y&&(de===1?u._tr_align(ee):de!==5&&(u._tr_stored_block(ee,0,0,!1),de===3&&(re(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),N(L),L.avail_out===0))return ee.last_flush=-1,_}return de!==b?_:ee.wrap<=0?1:(ee.wrap===2?(J(ee,255&L.adler),J(ee,L.adler>>8&255),J(ee,L.adler>>16&255),J(ee,L.adler>>24&255),J(ee,255&L.total_in),J(ee,L.total_in>>8&255),J(ee,L.total_in>>16&255),J(ee,L.total_in>>24&255)):(ne(ee,L.adler>>>16),ne(ee,65535&L.adler)),N(L),0<ee.wrap&&(ee.wrap=-ee.wrap),ee.pending!==0?_:1)},i.deflateEnd=function(L){var de;return L&&L.state?(de=L.state.status)!==j&&de!==69&&de!==73&&de!==91&&de!==103&&de!==B&&de!==666?te(L,w):(L.state=null,de===B?te(L,-3):_):w},i.deflateSetDictionary=function(L,de){var ye,ee,Z,oe,Se,xe,ie,Re,Pe=de.length;if(!L||!L.state||(oe=(ye=L.state).wrap)===2||oe===1&&ye.status!==j||ye.lookahead)return w;for(oe===1&&(L.adler=h(L.adler,de,Pe,0)),ye.wrap=0,Pe>=ye.w_size&&(oe===0&&(re(ye.head),ye.strstart=0,ye.block_start=0,ye.insert=0),Re=new l.Buf8(ye.w_size),l.arraySet(Re,de,Pe-ye.w_size,ye.w_size,0),de=Re,Pe=ye.w_size),Se=L.avail_in,xe=L.next_in,ie=L.input,L.avail_in=Pe,L.next_in=0,L.input=de,Ee(ye);ye.lookahead>=P;){for(ee=ye.strstart,Z=ye.lookahead-(P-1);ye.ins_h=(ye.ins_h<<ye.hash_shift^ye.window[ee+P-1])&ye.hash_mask,ye.prev[ee&ye.w_mask]=ye.head[ye.ins_h],ye.head[ye.ins_h]=ee,ee++,--Z;);ye.strstart=ee,ye.lookahead=P-1,Ee(ye)}return ye.strstart+=ye.lookahead,ye.block_start=ye.strstart,ye.insert=ye.lookahead,ye.lookahead=0,ye.match_length=ye.prev_length=P-1,ye.match_available=0,L.next_in=xe,L.input=ie,L.avail_in=Se,ye.wrap=oe,_},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(o,l){var u,h,f,p,g,b,_,w,x,S,C,T,I,M,F,G,D,O,P,$,V,j,B,k,Y;u=o.state,h=o.next_in,k=o.input,f=h+(o.avail_in-5),p=o.next_out,Y=o.output,g=p-(l-o.avail_out),b=p+(o.avail_out-257),_=u.dmax,w=u.wsize,x=u.whave,S=u.wnext,C=u.window,T=u.hold,I=u.bits,M=u.lencode,F=u.distcode,G=(1<<u.lenbits)-1,D=(1<<u.distbits)-1;e:do{I<15&&(T+=k[h++]<<I,I+=8,T+=k[h++]<<I,I+=8),O=M[T&G];t:for(;;){if(T>>>=P=O>>>24,I-=P,(P=O>>>16&255)===0)Y[p++]=65535&O;else{if(!(16&P)){if((64&P)==0){O=M[(65535&O)+(T&(1<<P)-1)];continue t}if(32&P){u.mode=12;break e}o.msg="invalid literal/length code",u.mode=30;break e}$=65535&O,(P&=15)&&(I<P&&(T+=k[h++]<<I,I+=8),$+=T&(1<<P)-1,T>>>=P,I-=P),I<15&&(T+=k[h++]<<I,I+=8,T+=k[h++]<<I,I+=8),O=F[T&D];n:for(;;){if(T>>>=P=O>>>24,I-=P,!(16&(P=O>>>16&255))){if((64&P)==0){O=F[(65535&O)+(T&(1<<P)-1)];continue n}o.msg="invalid distance code",u.mode=30;break e}if(V=65535&O,I<(P&=15)&&(T+=k[h++]<<I,(I+=8)<P&&(T+=k[h++]<<I,I+=8)),_<(V+=T&(1<<P)-1)){o.msg="invalid distance too far back",u.mode=30;break e}if(T>>>=P,I-=P,(P=p-g)<V){if(x<(P=V-P)&&u.sane){o.msg="invalid distance too far back",u.mode=30;break e}if(B=C,(j=0)===S){if(j+=w-P,P<$){for($-=P;Y[p++]=C[j++],--P;);j=p-V,B=Y}}else if(S<P){if(j+=w+S-P,(P-=S)<$){for($-=P;Y[p++]=C[j++],--P;);if(j=0,S<$){for($-=P=S;Y[p++]=C[j++],--P;);j=p-V,B=Y}}}else if(j+=S-P,P<$){for($-=P;Y[p++]=C[j++],--P;);j=p-V,B=Y}for(;2<$;)Y[p++]=B[j++],Y[p++]=B[j++],Y[p++]=B[j++],$-=3;$&&(Y[p++]=B[j++],1<$&&(Y[p++]=B[j++]))}else{for(j=p-V;Y[p++]=Y[j++],Y[p++]=Y[j++],Y[p++]=Y[j++],2<($-=3););$&&(Y[p++]=Y[j++],1<$&&(Y[p++]=Y[j++]))}break}}break}}while(h<f&&p<b);h-=$=I>>3,T&=(1<<(I-=$<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<f?f-h+5:5-(h-f),o.avail_out=p<b?b-p+257:257-(p-b),u.hold=T,u.bits=I}},{}],49:[function(n,r,i){var o=n("../utils/common"),l=n("./adler32"),u=n("./crc32"),h=n("./inffast"),f=n("./inftrees"),p=1,g=2,b=0,_=-2,w=1,x=852,S=592;function C(j){return(j>>>24&255)+(j>>>8&65280)+((65280&j)<<8)+((255&j)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function I(j){var B;return j&&j.state?(B=j.state,j.total_in=j.total_out=B.total=0,j.msg="",B.wrap&&(j.adler=1&B.wrap),B.mode=w,B.last=0,B.havedict=0,B.dmax=32768,B.head=null,B.hold=0,B.bits=0,B.lencode=B.lendyn=new o.Buf32(x),B.distcode=B.distdyn=new o.Buf32(S),B.sane=1,B.back=-1,b):_}function M(j){var B;return j&&j.state?((B=j.state).wsize=0,B.whave=0,B.wnext=0,I(j)):_}function F(j,B){var k,Y;return j&&j.state?(Y=j.state,B<0?(k=0,B=-B):(k=1+(B>>4),B<48&&(B&=15)),B&&(B<8||15<B)?_:(Y.window!==null&&Y.wbits!==B&&(Y.window=null),Y.wrap=k,Y.wbits=B,M(j))):_}function G(j,B){var k,Y;return j?(Y=new T,(j.state=Y).window=null,(k=F(j,B))!==b&&(j.state=null),k):_}var D,O,P=!0;function $(j){if(P){var B;for(D=new o.Buf32(512),O=new o.Buf32(32),B=0;B<144;)j.lens[B++]=8;for(;B<256;)j.lens[B++]=9;for(;B<280;)j.lens[B++]=7;for(;B<288;)j.lens[B++]=8;for(f(p,j.lens,0,288,D,0,j.work,{bits:9}),B=0;B<32;)j.lens[B++]=5;f(g,j.lens,0,32,O,0,j.work,{bits:5}),P=!1}j.lencode=D,j.lenbits=9,j.distcode=O,j.distbits=5}function V(j,B,k,Y){var X,W=j.state;return W.window===null&&(W.wsize=1<<W.wbits,W.wnext=0,W.whave=0,W.window=new o.Buf8(W.wsize)),Y>=W.wsize?(o.arraySet(W.window,B,k-W.wsize,W.wsize,0),W.wnext=0,W.whave=W.wsize):(Y<(X=W.wsize-W.wnext)&&(X=Y),o.arraySet(W.window,B,k-Y,X,W.wnext),(Y-=X)?(o.arraySet(W.window,B,k-Y,Y,0),W.wnext=Y,W.whave=W.wsize):(W.wnext+=X,W.wnext===W.wsize&&(W.wnext=0),W.whave<W.wsize&&(W.whave+=X))),0}i.inflateReset=M,i.inflateReset2=F,i.inflateResetKeep=I,i.inflateInit=function(j){return G(j,15)},i.inflateInit2=G,i.inflate=function(j,B){var k,Y,X,W,te,H,re,N,q,J,ne,ae,Ee,Ae,ce,fe,Oe,Me,Ge,tt,L,de,ye,ee,Z=0,oe=new o.Buf8(4),Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!j||!j.state||!j.output||!j.input&&j.avail_in!==0)return _;(k=j.state).mode===12&&(k.mode=13),te=j.next_out,X=j.output,re=j.avail_out,W=j.next_in,Y=j.input,H=j.avail_in,N=k.hold,q=k.bits,J=H,ne=re,de=b;e:for(;;)switch(k.mode){case w:if(k.wrap===0){k.mode=13;break}for(;q<16;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}if(2&k.wrap&&N===35615){oe[k.check=0]=255&N,oe[1]=N>>>8&255,k.check=u(k.check,oe,2,0),q=N=0,k.mode=2;break}if(k.flags=0,k.head&&(k.head.done=!1),!(1&k.wrap)||(((255&N)<<8)+(N>>8))%31){j.msg="incorrect header check",k.mode=30;break}if((15&N)!=8){j.msg="unknown compression method",k.mode=30;break}if(q-=4,L=8+(15&(N>>>=4)),k.wbits===0)k.wbits=L;else if(L>k.wbits){j.msg="invalid window size",k.mode=30;break}k.dmax=1<<L,j.adler=k.check=1,k.mode=512&N?10:12,q=N=0;break;case 2:for(;q<16;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}if(k.flags=N,(255&k.flags)!=8){j.msg="unknown compression method",k.mode=30;break}if(57344&k.flags){j.msg="unknown header flags set",k.mode=30;break}k.head&&(k.head.text=N>>8&1),512&k.flags&&(oe[0]=255&N,oe[1]=N>>>8&255,k.check=u(k.check,oe,2,0)),q=N=0,k.mode=3;case 3:for(;q<32;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}k.head&&(k.head.time=N),512&k.flags&&(oe[0]=255&N,oe[1]=N>>>8&255,oe[2]=N>>>16&255,oe[3]=N>>>24&255,k.check=u(k.check,oe,4,0)),q=N=0,k.mode=4;case 4:for(;q<16;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}k.head&&(k.head.xflags=255&N,k.head.os=N>>8),512&k.flags&&(oe[0]=255&N,oe[1]=N>>>8&255,k.check=u(k.check,oe,2,0)),q=N=0,k.mode=5;case 5:if(1024&k.flags){for(;q<16;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}k.length=N,k.head&&(k.head.extra_len=N),512&k.flags&&(oe[0]=255&N,oe[1]=N>>>8&255,k.check=u(k.check,oe,2,0)),q=N=0}else k.head&&(k.head.extra=null);k.mode=6;case 6:if(1024&k.flags&&(H<(ae=k.length)&&(ae=H),ae&&(k.head&&(L=k.head.extra_len-k.length,k.head.extra||(k.head.extra=new Array(k.head.extra_len)),o.arraySet(k.head.extra,Y,W,ae,L)),512&k.flags&&(k.check=u(k.check,Y,ae,W)),H-=ae,W+=ae,k.length-=ae),k.length))break e;k.length=0,k.mode=7;case 7:if(2048&k.flags){if(H===0)break e;for(ae=0;L=Y[W+ae++],k.head&&L&&k.length<65536&&(k.head.name+=String.fromCharCode(L)),L&&ae<H;);if(512&k.flags&&(k.check=u(k.check,Y,ae,W)),H-=ae,W+=ae,L)break e}else k.head&&(k.head.name=null);k.length=0,k.mode=8;case 8:if(4096&k.flags){if(H===0)break e;for(ae=0;L=Y[W+ae++],k.head&&L&&k.length<65536&&(k.head.comment+=String.fromCharCode(L)),L&&ae<H;);if(512&k.flags&&(k.check=u(k.check,Y,ae,W)),H-=ae,W+=ae,L)break e}else k.head&&(k.head.comment=null);k.mode=9;case 9:if(512&k.flags){for(;q<16;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}if(N!==(65535&k.check)){j.msg="header crc mismatch",k.mode=30;break}q=N=0}k.head&&(k.head.hcrc=k.flags>>9&1,k.head.done=!0),j.adler=k.check=0,k.mode=12;break;case 10:for(;q<32;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}j.adler=k.check=C(N),q=N=0,k.mode=11;case 11:if(k.havedict===0)return j.next_out=te,j.avail_out=re,j.next_in=W,j.avail_in=H,k.hold=N,k.bits=q,2;j.adler=k.check=1,k.mode=12;case 12:if(B===5||B===6)break e;case 13:if(k.last){N>>>=7&q,q-=7&q,k.mode=27;break}for(;q<3;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}switch(k.last=1&N,q-=1,3&(N>>>=1)){case 0:k.mode=14;break;case 1:if($(k),k.mode=20,B!==6)break;N>>>=2,q-=2;break e;case 2:k.mode=17;break;case 3:j.msg="invalid block type",k.mode=30}N>>>=2,q-=2;break;case 14:for(N>>>=7&q,q-=7&q;q<32;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}if((65535&N)!=(N>>>16^65535)){j.msg="invalid stored block lengths",k.mode=30;break}if(k.length=65535&N,q=N=0,k.mode=15,B===6)break e;case 15:k.mode=16;case 16:if(ae=k.length){if(H<ae&&(ae=H),re<ae&&(ae=re),ae===0)break e;o.arraySet(X,Y,W,ae,te),H-=ae,W+=ae,re-=ae,te+=ae,k.length-=ae;break}k.mode=12;break;case 17:for(;q<14;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}if(k.nlen=257+(31&N),N>>>=5,q-=5,k.ndist=1+(31&N),N>>>=5,q-=5,k.ncode=4+(15&N),N>>>=4,q-=4,286<k.nlen||30<k.ndist){j.msg="too many length or distance symbols",k.mode=30;break}k.have=0,k.mode=18;case 18:for(;k.have<k.ncode;){for(;q<3;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}k.lens[Se[k.have++]]=7&N,N>>>=3,q-=3}for(;k.have<19;)k.lens[Se[k.have++]]=0;if(k.lencode=k.lendyn,k.lenbits=7,ye={bits:k.lenbits},de=f(0,k.lens,0,19,k.lencode,0,k.work,ye),k.lenbits=ye.bits,de){j.msg="invalid code lengths set",k.mode=30;break}k.have=0,k.mode=19;case 19:for(;k.have<k.nlen+k.ndist;){for(;fe=(Z=k.lencode[N&(1<<k.lenbits)-1])>>>16&255,Oe=65535&Z,!((ce=Z>>>24)<=q);){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}if(Oe<16)N>>>=ce,q-=ce,k.lens[k.have++]=Oe;else{if(Oe===16){for(ee=ce+2;q<ee;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}if(N>>>=ce,q-=ce,k.have===0){j.msg="invalid bit length repeat",k.mode=30;break}L=k.lens[k.have-1],ae=3+(3&N),N>>>=2,q-=2}else if(Oe===17){for(ee=ce+3;q<ee;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}q-=ce,L=0,ae=3+(7&(N>>>=ce)),N>>>=3,q-=3}else{for(ee=ce+7;q<ee;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}q-=ce,L=0,ae=11+(127&(N>>>=ce)),N>>>=7,q-=7}if(k.have+ae>k.nlen+k.ndist){j.msg="invalid bit length repeat",k.mode=30;break}for(;ae--;)k.lens[k.have++]=L}}if(k.mode===30)break;if(k.lens[256]===0){j.msg="invalid code -- missing end-of-block",k.mode=30;break}if(k.lenbits=9,ye={bits:k.lenbits},de=f(p,k.lens,0,k.nlen,k.lencode,0,k.work,ye),k.lenbits=ye.bits,de){j.msg="invalid literal/lengths set",k.mode=30;break}if(k.distbits=6,k.distcode=k.distdyn,ye={bits:k.distbits},de=f(g,k.lens,k.nlen,k.ndist,k.distcode,0,k.work,ye),k.distbits=ye.bits,de){j.msg="invalid distances set",k.mode=30;break}if(k.mode=20,B===6)break e;case 20:k.mode=21;case 21:if(6<=H&&258<=re){j.next_out=te,j.avail_out=re,j.next_in=W,j.avail_in=H,k.hold=N,k.bits=q,h(j,ne),te=j.next_out,X=j.output,re=j.avail_out,W=j.next_in,Y=j.input,H=j.avail_in,N=k.hold,q=k.bits,k.mode===12&&(k.back=-1);break}for(k.back=0;fe=(Z=k.lencode[N&(1<<k.lenbits)-1])>>>16&255,Oe=65535&Z,!((ce=Z>>>24)<=q);){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}if(fe&&(240&fe)==0){for(Me=ce,Ge=fe,tt=Oe;fe=(Z=k.lencode[tt+((N&(1<<Me+Ge)-1)>>Me)])>>>16&255,Oe=65535&Z,!(Me+(ce=Z>>>24)<=q);){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}N>>>=Me,q-=Me,k.back+=Me}if(N>>>=ce,q-=ce,k.back+=ce,k.length=Oe,fe===0){k.mode=26;break}if(32&fe){k.back=-1,k.mode=12;break}if(64&fe){j.msg="invalid literal/length code",k.mode=30;break}k.extra=15&fe,k.mode=22;case 22:if(k.extra){for(ee=k.extra;q<ee;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}k.length+=N&(1<<k.extra)-1,N>>>=k.extra,q-=k.extra,k.back+=k.extra}k.was=k.length,k.mode=23;case 23:for(;fe=(Z=k.distcode[N&(1<<k.distbits)-1])>>>16&255,Oe=65535&Z,!((ce=Z>>>24)<=q);){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}if((240&fe)==0){for(Me=ce,Ge=fe,tt=Oe;fe=(Z=k.distcode[tt+((N&(1<<Me+Ge)-1)>>Me)])>>>16&255,Oe=65535&Z,!(Me+(ce=Z>>>24)<=q);){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}N>>>=Me,q-=Me,k.back+=Me}if(N>>>=ce,q-=ce,k.back+=ce,64&fe){j.msg="invalid distance code",k.mode=30;break}k.offset=Oe,k.extra=15&fe,k.mode=24;case 24:if(k.extra){for(ee=k.extra;q<ee;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}k.offset+=N&(1<<k.extra)-1,N>>>=k.extra,q-=k.extra,k.back+=k.extra}if(k.offset>k.dmax){j.msg="invalid distance too far back",k.mode=30;break}k.mode=25;case 25:if(re===0)break e;if(ae=ne-re,k.offset>ae){if((ae=k.offset-ae)>k.whave&&k.sane){j.msg="invalid distance too far back",k.mode=30;break}Ee=ae>k.wnext?(ae-=k.wnext,k.wsize-ae):k.wnext-ae,ae>k.length&&(ae=k.length),Ae=k.window}else Ae=X,Ee=te-k.offset,ae=k.length;for(re<ae&&(ae=re),re-=ae,k.length-=ae;X[te++]=Ae[Ee++],--ae;);k.length===0&&(k.mode=21);break;case 26:if(re===0)break e;X[te++]=k.length,re--,k.mode=21;break;case 27:if(k.wrap){for(;q<32;){if(H===0)break e;H--,N|=Y[W++]<<q,q+=8}if(ne-=re,j.total_out+=ne,k.total+=ne,ne&&(j.adler=k.check=k.flags?u(k.check,X,ne,te-ne):l(k.check,X,ne,te-ne)),ne=re,(k.flags?N:C(N))!==k.check){j.msg="incorrect data check",k.mode=30;break}q=N=0}k.mode=28;case 28:if(k.wrap&&k.flags){for(;q<32;){if(H===0)break e;H--,N+=Y[W++]<<q,q+=8}if(N!==(4294967295&k.total)){j.msg="incorrect length check",k.mode=30;break}q=N=0}k.mode=29;case 29:de=1;break e;case 30:de=-3;break e;case 31:return-4;default:return _}return j.next_out=te,j.avail_out=re,j.next_in=W,j.avail_in=H,k.hold=N,k.bits=q,(k.wsize||ne!==j.avail_out&&k.mode<30&&(k.mode<27||B!==4))&&V(j,j.output,j.next_out,ne-j.avail_out)?(k.mode=31,-4):(J-=j.avail_in,ne-=j.avail_out,j.total_in+=J,j.total_out+=ne,k.total+=ne,k.wrap&&ne&&(j.adler=k.check=k.flags?u(k.check,X,ne,j.next_out-ne):l(k.check,X,ne,j.next_out-ne)),j.data_type=k.bits+(k.last?64:0)+(k.mode===12?128:0)+(k.mode===20||k.mode===15?256:0),(J==0&&ne===0||B===4)&&de===b&&(de=-5),de)},i.inflateEnd=function(j){if(!j||!j.state)return _;var B=j.state;return B.window&&(B.window=null),j.state=null,b},i.inflateGetHeader=function(j,B){var k;return j&&j.state?(2&(k=j.state).wrap)==0?_:((k.head=B).done=!1,b):_},i.inflateSetDictionary=function(j,B){var k,Y=B.length;return j&&j.state?(k=j.state).wrap!==0&&k.mode!==11?_:k.mode===11&&l(1,B,Y,0)!==k.check?-3:V(j,B,Y,Y)?(k.mode=31,-4):(k.havedict=1,b):_},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var o=n("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,b,_,w,x,S,C){var T,I,M,F,G,D,O,P,$,V=C.bits,j=0,B=0,k=0,Y=0,X=0,W=0,te=0,H=0,re=0,N=0,q=null,J=0,ne=new o.Buf16(16),ae=new o.Buf16(16),Ee=null,Ae=0;for(j=0;j<=15;j++)ne[j]=0;for(B=0;B<_;B++)ne[g[b+B]]++;for(X=V,Y=15;1<=Y&&ne[Y]===0;Y--);if(Y<X&&(X=Y),Y===0)return w[x++]=20971520,w[x++]=20971520,C.bits=1,0;for(k=1;k<Y&&ne[k]===0;k++);for(X<k&&(X=k),j=H=1;j<=15;j++)if(H<<=1,(H-=ne[j])<0)return-1;if(0<H&&(p===0||Y!==1))return-1;for(ae[1]=0,j=1;j<15;j++)ae[j+1]=ae[j]+ne[j];for(B=0;B<_;B++)g[b+B]!==0&&(S[ae[g[b+B]]++]=B);if(D=p===0?(q=Ee=S,19):p===1?(q=l,J-=257,Ee=u,Ae-=257,256):(q=h,Ee=f,-1),j=k,G=x,te=B=N=0,M=-1,F=(re=1<<(W=X))-1,p===1&&852<re||p===2&&592<re)return 1;for(;;){for(O=j-te,$=S[B]<D?(P=0,S[B]):S[B]>D?(P=Ee[Ae+S[B]],q[J+S[B]]):(P=96,0),T=1<<j-te,k=I=1<<W;w[G+(N>>te)+(I-=T)]=O<<24|P<<16|$|0,I!==0;);for(T=1<<j-1;N&T;)T>>=1;if(T!==0?(N&=T-1,N+=T):N=0,B++,--ne[j]==0){if(j===Y)break;j=g[b+S[B]]}if(X<j&&(N&F)!==M){for(te===0&&(te=X),G+=k,H=1<<(W=j-te);W+te<Y&&!((H-=ne[W+te])<=0);)W++,H<<=1;if(re+=1<<W,p===1&&852<re||p===2&&592<re)return 1;w[M=N&F]=X<<24|W<<16|G-x|0}}return N!==0&&(w[G+N]=j-te<<24|64<<16|0),C.bits=X,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var o=n("../utils/common"),l=0,u=1;function h(Z){for(var oe=Z.length;0<=--oe;)Z[oe]=0}var f=0,p=29,g=256,b=g+1+p,_=30,w=19,x=2*b+1,S=15,C=16,T=7,I=256,M=16,F=17,G=18,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],O=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],$=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=new Array(2*(b+2));h(V);var j=new Array(2*_);h(j);var B=new Array(512);h(B);var k=new Array(256);h(k);var Y=new Array(p);h(Y);var X,W,te,H=new Array(_);function re(Z,oe,Se,xe,ie){this.static_tree=Z,this.extra_bits=oe,this.extra_base=Se,this.elems=xe,this.max_length=ie,this.has_stree=Z&&Z.length}function N(Z,oe){this.dyn_tree=Z,this.max_code=0,this.stat_desc=oe}function q(Z){return Z<256?B[Z]:B[256+(Z>>>7)]}function J(Z,oe){Z.pending_buf[Z.pending++]=255&oe,Z.pending_buf[Z.pending++]=oe>>>8&255}function ne(Z,oe,Se){Z.bi_valid>C-Se?(Z.bi_buf|=oe<<Z.bi_valid&65535,J(Z,Z.bi_buf),Z.bi_buf=oe>>C-Z.bi_valid,Z.bi_valid+=Se-C):(Z.bi_buf|=oe<<Z.bi_valid&65535,Z.bi_valid+=Se)}function ae(Z,oe,Se){ne(Z,Se[2*oe],Se[2*oe+1])}function Ee(Z,oe){for(var Se=0;Se|=1&Z,Z>>>=1,Se<<=1,0<--oe;);return Se>>>1}function Ae(Z,oe,Se){var xe,ie,Re=new Array(S+1),Pe=0;for(xe=1;xe<=S;xe++)Re[xe]=Pe=Pe+Se[xe-1]<<1;for(ie=0;ie<=oe;ie++){var Ne=Z[2*ie+1];Ne!==0&&(Z[2*ie]=Ee(Re[Ne]++,Ne))}}function ce(Z){var oe;for(oe=0;oe<b;oe++)Z.dyn_ltree[2*oe]=0;for(oe=0;oe<_;oe++)Z.dyn_dtree[2*oe]=0;for(oe=0;oe<w;oe++)Z.bl_tree[2*oe]=0;Z.dyn_ltree[2*I]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0}function fe(Z){8<Z.bi_valid?J(Z,Z.bi_buf):0<Z.bi_valid&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0}function Oe(Z,oe,Se,xe){var ie=2*oe,Re=2*Se;return Z[ie]<Z[Re]||Z[ie]===Z[Re]&&xe[oe]<=xe[Se]}function Me(Z,oe,Se){for(var xe=Z.heap[Se],ie=Se<<1;ie<=Z.heap_len&&(ie<Z.heap_len&&Oe(oe,Z.heap[ie+1],Z.heap[ie],Z.depth)&&ie++,!Oe(oe,xe,Z.heap[ie],Z.depth));)Z.heap[Se]=Z.heap[ie],Se=ie,ie<<=1;Z.heap[Se]=xe}function Ge(Z,oe,Se){var xe,ie,Re,Pe,Ne=0;if(Z.last_lit!==0)for(;xe=Z.pending_buf[Z.d_buf+2*Ne]<<8|Z.pending_buf[Z.d_buf+2*Ne+1],ie=Z.pending_buf[Z.l_buf+Ne],Ne++,xe===0?ae(Z,ie,oe):(ae(Z,(Re=k[ie])+g+1,oe),(Pe=D[Re])!==0&&ne(Z,ie-=Y[Re],Pe),ae(Z,Re=q(--xe),Se),(Pe=O[Re])!==0&&ne(Z,xe-=H[Re],Pe)),Ne<Z.last_lit;);ae(Z,I,oe)}function tt(Z,oe){var Se,xe,ie,Re=oe.dyn_tree,Pe=oe.stat_desc.static_tree,Ne=oe.stat_desc.has_stree,qe=oe.stat_desc.elems,xt=-1;for(Z.heap_len=0,Z.heap_max=x,Se=0;Se<qe;Se++)Re[2*Se]!==0?(Z.heap[++Z.heap_len]=xt=Se,Z.depth[Se]=0):Re[2*Se+1]=0;for(;Z.heap_len<2;)Re[2*(ie=Z.heap[++Z.heap_len]=xt<2?++xt:0)]=1,Z.depth[ie]=0,Z.opt_len--,Ne&&(Z.static_len-=Pe[2*ie+1]);for(oe.max_code=xt,Se=Z.heap_len>>1;1<=Se;Se--)Me(Z,Re,Se);for(ie=qe;Se=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],Me(Z,Re,1),xe=Z.heap[1],Z.heap[--Z.heap_max]=Se,Z.heap[--Z.heap_max]=xe,Re[2*ie]=Re[2*Se]+Re[2*xe],Z.depth[ie]=(Z.depth[Se]>=Z.depth[xe]?Z.depth[Se]:Z.depth[xe])+1,Re[2*Se+1]=Re[2*xe+1]=ie,Z.heap[1]=ie++,Me(Z,Re,1),2<=Z.heap_len;);Z.heap[--Z.heap_max]=Z.heap[1],(function(st,Wn){var gs,nr,ys,vt,nn,Qn,Et=Wn.dyn_tree,Ka=Wn.max_code,Bi=Wn.stat_desc.static_tree,Xo=Wn.stat_desc.has_stree,Or=Wn.stat_desc.extra_bits,_s=Wn.stat_desc.extra_base,Ft=Wn.stat_desc.max_length,rr=0;for(vt=0;vt<=S;vt++)st.bl_count[vt]=0;for(Et[2*st.heap[st.heap_max]+1]=0,gs=st.heap_max+1;gs<x;gs++)Ft<(vt=Et[2*Et[2*(nr=st.heap[gs])+1]+1]+1)&&(vt=Ft,rr++),Et[2*nr+1]=vt,Ka<nr||(st.bl_count[vt]++,nn=0,_s<=nr&&(nn=Or[nr-_s]),Qn=Et[2*nr],st.opt_len+=Qn*(vt+nn),Xo&&(st.static_len+=Qn*(Bi[2*nr+1]+nn)));if(rr!==0){do{for(vt=Ft-1;st.bl_count[vt]===0;)vt--;st.bl_count[vt]--,st.bl_count[vt+1]+=2,st.bl_count[Ft]--,rr-=2}while(0<rr);for(vt=Ft;vt!==0;vt--)for(nr=st.bl_count[vt];nr!==0;)Ka<(ys=st.heap[--gs])||(Et[2*ys+1]!==vt&&(st.opt_len+=(vt-Et[2*ys+1])*Et[2*ys],Et[2*ys+1]=vt),nr--)}})(Z,oe),Ae(Re,xt,Z.bl_count)}function L(Z,oe,Se){var xe,ie,Re=-1,Pe=oe[1],Ne=0,qe=7,xt=4;for(Pe===0&&(qe=138,xt=3),oe[2*(Se+1)+1]=65535,xe=0;xe<=Se;xe++)ie=Pe,Pe=oe[2*(xe+1)+1],++Ne<qe&&ie===Pe||(Ne<xt?Z.bl_tree[2*ie]+=Ne:ie!==0?(ie!==Re&&Z.bl_tree[2*ie]++,Z.bl_tree[2*M]++):Ne<=10?Z.bl_tree[2*F]++:Z.bl_tree[2*G]++,Re=ie,xt=(Ne=0)===Pe?(qe=138,3):ie===Pe?(qe=6,3):(qe=7,4))}function de(Z,oe,Se){var xe,ie,Re=-1,Pe=oe[1],Ne=0,qe=7,xt=4;for(Pe===0&&(qe=138,xt=3),xe=0;xe<=Se;xe++)if(ie=Pe,Pe=oe[2*(xe+1)+1],!(++Ne<qe&&ie===Pe)){if(Ne<xt)for(;ae(Z,ie,Z.bl_tree),--Ne!=0;);else ie!==0?(ie!==Re&&(ae(Z,ie,Z.bl_tree),Ne--),ae(Z,M,Z.bl_tree),ne(Z,Ne-3,2)):Ne<=10?(ae(Z,F,Z.bl_tree),ne(Z,Ne-3,3)):(ae(Z,G,Z.bl_tree),ne(Z,Ne-11,7));Re=ie,xt=(Ne=0)===Pe?(qe=138,3):ie===Pe?(qe=6,3):(qe=7,4)}}h(H);var ye=!1;function ee(Z,oe,Se,xe){ne(Z,(f<<1)+(xe?1:0),3),(function(ie,Re,Pe,Ne){fe(ie),J(ie,Pe),J(ie,~Pe),o.arraySet(ie.pending_buf,ie.window,Re,Pe,ie.pending),ie.pending+=Pe})(Z,oe,Se)}i._tr_init=function(Z){ye||((function(){var oe,Se,xe,ie,Re,Pe=new Array(S+1);for(ie=xe=0;ie<p-1;ie++)for(Y[ie]=xe,oe=0;oe<1<<D[ie];oe++)k[xe++]=ie;for(k[xe-1]=ie,ie=Re=0;ie<16;ie++)for(H[ie]=Re,oe=0;oe<1<<O[ie];oe++)B[Re++]=ie;for(Re>>=7;ie<_;ie++)for(H[ie]=Re<<7,oe=0;oe<1<<O[ie]-7;oe++)B[256+Re++]=ie;for(Se=0;Se<=S;Se++)Pe[Se]=0;for(oe=0;oe<=143;)V[2*oe+1]=8,oe++,Pe[8]++;for(;oe<=255;)V[2*oe+1]=9,oe++,Pe[9]++;for(;oe<=279;)V[2*oe+1]=7,oe++,Pe[7]++;for(;oe<=287;)V[2*oe+1]=8,oe++,Pe[8]++;for(Ae(V,b+1,Pe),oe=0;oe<_;oe++)j[2*oe+1]=5,j[2*oe]=Ee(oe,5);X=new re(V,D,g+1,b,S),W=new re(j,O,0,_,S),te=new re(new Array(0),P,0,w,T)})(),ye=!0),Z.l_desc=new N(Z.dyn_ltree,X),Z.d_desc=new N(Z.dyn_dtree,W),Z.bl_desc=new N(Z.bl_tree,te),Z.bi_buf=0,Z.bi_valid=0,ce(Z)},i._tr_stored_block=ee,i._tr_flush_block=function(Z,oe,Se,xe){var ie,Re,Pe=0;0<Z.level?(Z.strm.data_type===2&&(Z.strm.data_type=(function(Ne){var qe,xt=4093624447;for(qe=0;qe<=31;qe++,xt>>>=1)if(1&xt&&Ne.dyn_ltree[2*qe]!==0)return l;if(Ne.dyn_ltree[18]!==0||Ne.dyn_ltree[20]!==0||Ne.dyn_ltree[26]!==0)return u;for(qe=32;qe<g;qe++)if(Ne.dyn_ltree[2*qe]!==0)return u;return l})(Z)),tt(Z,Z.l_desc),tt(Z,Z.d_desc),Pe=(function(Ne){var qe;for(L(Ne,Ne.dyn_ltree,Ne.l_desc.max_code),L(Ne,Ne.dyn_dtree,Ne.d_desc.max_code),tt(Ne,Ne.bl_desc),qe=w-1;3<=qe&&Ne.bl_tree[2*$[qe]+1]===0;qe--);return Ne.opt_len+=3*(qe+1)+5+5+4,qe})(Z),ie=Z.opt_len+3+7>>>3,(Re=Z.static_len+3+7>>>3)<=ie&&(ie=Re)):ie=Re=Se+5,Se+4<=ie&&oe!==-1?ee(Z,oe,Se,xe):Z.strategy===4||Re===ie?(ne(Z,2+(xe?1:0),3),Ge(Z,V,j)):(ne(Z,4+(xe?1:0),3),(function(Ne,qe,xt,st){var Wn;for(ne(Ne,qe-257,5),ne(Ne,xt-1,5),ne(Ne,st-4,4),Wn=0;Wn<st;Wn++)ne(Ne,Ne.bl_tree[2*$[Wn]+1],3);de(Ne,Ne.dyn_ltree,qe-1),de(Ne,Ne.dyn_dtree,xt-1)})(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,Pe+1),Ge(Z,Z.dyn_ltree,Z.dyn_dtree)),ce(Z),xe&&fe(Z)},i._tr_tally=function(Z,oe,Se){return Z.pending_buf[Z.d_buf+2*Z.last_lit]=oe>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&oe,Z.pending_buf[Z.l_buf+Z.last_lit]=255&Se,Z.last_lit++,oe===0?Z.dyn_ltree[2*Se]++:(Z.matches++,oe--,Z.dyn_ltree[2*(k[Se]+g+1)]++,Z.dyn_dtree[2*q(oe)]++),Z.last_lit===Z.lit_bufsize-1},i._tr_align=function(Z){ne(Z,2,3),ae(Z,I,V),(function(oe){oe.bi_valid===16?(J(oe,oe.bi_buf),oe.bi_buf=0,oe.bi_valid=0):8<=oe.bi_valid&&(oe.pending_buf[oe.pending++]=255&oe.bi_buf,oe.bi_buf>>=8,oe.bi_valid-=8)})(Z)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(o){(function(l,u){if(!l.setImmediate){var h,f,p,g,b=1,_={},w=!1,x=l.document,S=Object.getPrototypeOf&&Object.getPrototypeOf(l);S=S&&S.setTimeout?S:l,h={}.toString.call(l.process)==="[object process]"?function(M){process.nextTick(function(){T(M)})}:(function(){if(l.postMessage&&!l.importScripts){var M=!0,F=l.onmessage;return l.onmessage=function(){M=!1},l.postMessage("","*"),l.onmessage=F,M}})()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",I,!1):l.attachEvent("onmessage",I),function(M){l.postMessage(g+M,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(M){T(M.data)},function(M){p.port2.postMessage(M)}):x&&"onreadystatechange"in x.createElement("script")?(f=x.documentElement,function(M){var F=x.createElement("script");F.onreadystatechange=function(){T(M),F.onreadystatechange=null,f.removeChild(F),F=null},f.appendChild(F)}):function(M){setTimeout(T,0,M)},S.setImmediate=function(M){typeof M!="function"&&(M=new Function(""+M));for(var F=new Array(arguments.length-1),G=0;G<F.length;G++)F[G]=arguments[G+1];var D={callback:M,args:F};return _[b]=D,h(b),b++},S.clearImmediate=C}function C(M){delete _[M]}function T(M){if(w)setTimeout(T,0,M);else{var F=_[M];if(F){w=!0;try{(function(G){var D=G.callback,O=G.args;switch(O.length){case 0:D();break;case 1:D(O[0]);break;case 2:D(O[0],O[1]);break;case 3:D(O[0],O[1],O[2]);break;default:D.apply(u,O)}})(F)}finally{C(M),w=!1}}}}function I(M){M.source===l&&typeof M.data=="string"&&M.data.indexOf(g)===0&&T(+M.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Gh<"u"?Gh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Zg)),Zg.exports}var V3=F3();const Im=eR(V3);function $3({currentUser:t,budgetId:e}){const[n,r]=R.useState(!1),[i,o]=R.useState(null),[l,u]=R.useState(null);async function h(){if(!t){u("Must be logged in to download budget");return}if(!e){u("No budget selected");return}r(!0),u(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:f,data:p}=await At("budgets",e,`downloading budget ${e}`);if(!f||!p){u(`Budget ${e} not found`);return}const g=await aA(e,"download-budget");let b=null;try{const{exists:j,data:B}=await At("payees",e,`downloading payees for budget ${e}`);j&&B&&(b=B)}catch(j){console.warn(`Could not read payees for budget ${e}:`,j)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const _=new Im,w=new Date,x=w.toISOString().split("T")[0],S=`budget_${e}`,{accounts:C,account_groups:T,categories:I,category_groups:M,...F}=p;_.file(`${S}/budget.json`,JSON.stringify(F,null,2)),_.file(`${S}/accounts.json`,JSON.stringify(C||{},null,2)),_.file(`${S}/account_groups.json`,JSON.stringify(T||{},null,2)),_.file(`${S}/categories.json`,JSON.stringify(I||{},null,2)),_.file(`${S}/category_groups.json`,JSON.stringify(M||[],null,2)),b&&_.file(`${S}/payees.json`,JSON.stringify(b,null,2));let G=0;for(const j of g){const B=j.data,k=`${S}/months/month_${B.year}_${String(B.month).padStart(2,"0")}`,Y={};if(B.are_allocations_finalized&&B.category_balances)for(const X of B.category_balances)X.allocated!==void 0&&(Y[X.category_id]=X.allocated);_.file(`${k}/metadata.json`,JSON.stringify({budget_id:B.budget_id,year_month_ordinal:B.year_month_ordinal,year:B.year,month:B.month,total_income:B.total_income,previous_month_income:B.previous_month_income,total_expenses:B.total_expenses,are_allocations_finalized:B.are_allocations_finalized,created_at:B.created_at,updated_at:B.updated_at,...B.are_allocations_finalized&&{allocations:Y},downloaded_at:w.toISOString()},null,2)),_.file(`${k}/income.json`,JSON.stringify(B.income||[],null,2)),_.file(`${k}/expenses.json`,JSON.stringify(B.expenses||[],null,2)),_.file(`${k}/transfers.json`,JSON.stringify(B.transfers||[],null,2)),_.file(`${k}/adjustments.json`,JSON.stringify(B.adjustments||[],null,2)),_.file(`${k}/account_balances.json`,JSON.stringify(B.account_balances||[],null,2)),_.file(`${k}/category_balances.json`,JSON.stringify(B.category_balances||[],null,2)),G++,o({phase:"processing",current:G,total:g.length,percentComplete:20+Math.round(G/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const D=await _.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const P=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),$=URL.createObjectURL(D),V=document.createElement("a");V.href=$,V.download=`${x}_${P}_${e}.zip`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL($)}catch(f){u(f instanceof Error?f.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:i,error:l,downloadBudget:h}}async function q3(t){const n=await new Im().loadAsync(t),r=new Set,i=new Set;for(const[o]of Object.entries(n.files)){const l=o.match(/^budget_([^/]+)\//);if(l){const u=l[1];r.add(u),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&i.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:i.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function H3(t,e,n){const i=`${`${e}/months/`}${n}/`,o=`${i}metadata.json`,l=t.files[o];if(!l)return null;const u=await l.async("string"),h=JSON.parse(u),{downloaded_at:f,allocations:p,...g}=h,b=async S=>{const C=`${i}${S}`,T=t.files[C];if(T){const I=await T.async("string");return JSON.parse(I)}return[]},_={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await b("income.json"),expenses:await b("expenses.json"),transfers:await b("transfers.json"),adjustments:await b("adjustments.json"),account_balances:[],category_balances:[]},w=za(_);let x=r0(w);if(h.are_allocations_finalized&&p!==void 0){const S=new Map;for(const I of x.category_balances)S.set(I.category_id,I);const C=[],T=new Set;for(const I of x.category_balances){const M=p[I.category_id];if(M!==void 0){const F=Te(M);C.push({...I,allocated:F,end_balance:Te(I.start_balance+F+I.spent+I.transfers+I.adjustments)})}else C.push(I);T.add(I.category_id)}for(const[I,M]of Object.entries(p))if(!T.has(I)){const F=Te(M);C.push({category_id:I,start_balance:0,allocated:F,spent:0,transfers:0,adjustments:0,end_balance:F})}x={...x,category_balances:C}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:x}}async function G3(t,e){const n=`budget_${e}`,r=async G=>{const D=t.files[G];if(D){const O=await D.async("string");return JSON.parse(O)}return null},i=`${n}/budget.json`,o=`${n}/accounts.json`,l=`${n}/account_groups.json`,u=`${n}/categories.json`,h=`${n}/category_groups.json`,f=await r(i);if(!f)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(l)||{},b=await r(u)||{},_=await r(h)||[],w=za({...f,accounts:p,account_groups:g,categories:b,category_groups:_}),x={budgetId:e,data:w},S=`${n}/payees.json`,C=await r(S);let T=null;if(C){const G={...C,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:za(G)}}const I=`${n}/months/`,M=new Set;for(const G of Object.keys(t.files))if(G.startsWith(I)&&G.includes("/metadata.json")){const D=G.split("/months/")[1].split("/")[0];M.add(D)}const F=[];for(const G of M){const D=await H3(t,n,G);D&&F.push(D)}return{budgetUpdate:x,monthUpdates:F,payeeWrite:T}}function W3({currentUser:t}){const[e,n]=R.useState(!1),[r,i]=R.useState(!1),[o,l]=R.useState(null),[u,h]=R.useState(null),[f,p]=R.useState(null),[g,b]=R.useState(null);async function _(x){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),l(null),b(null);try{const S=await q3(x);l(S)}catch(S){p(S instanceof Error?S.message:"Failed to parse zip file")}finally{n(!1)}}async function w(x){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}i(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const S=[];let C=0,T=0,I=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const F=await new Im().loadAsync(x);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const G=[],D=[],O=[];for(let P=0;P<o.budgetsToRestore.length;P++){const $=o.budgetsToRestore[P];try{const{budgetUpdate:V,monthUpdates:j,payeeWrite:B}=await G3(F,$);G.push(V),D.push(...j),B&&O.push(B),h({phase:"uploading",current:P+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((P+1)/o.budgetsToRestore.length*50)})}catch(V){S.push(`Budget ${$}: ${V instanceof Error?V.message:String(V)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),G.length>0)try{console.log(`[Upload] Writing ${G.length} budget(s)...`),await Am(G,"upload-budget"),C=G.length,console.log(`[Upload] Successfully wrote ${C} budget(s)`)}catch(P){const $=`Failed to write budgets: ${P instanceof Error?P.message:String(P)}`;throw console.error(`[Upload] ${$}`,P),S.push($),P}if(O.length>0)try{console.log(`[Upload] Writing ${O.length} payee doc(s)...`),await q_(O,"upload-budget: writing payees"),I=O.length,console.log(`[Upload] Successfully wrote ${I} payee doc(s)`)}catch(P){const $=`Failed to write payees: ${P instanceof Error?P.message:String(P)}`;throw console.error(`[Upload] ${$}`,P),S.push($),P}if(D.length>0)try{console.log(`[Upload] Writing ${D.length} month(s) and recalculating...`),await LB(D,"upload-budget"),T=D.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(P){const $=`Failed to write months: ${P instanceof Error?P.message:String(P)}`;throw console.error(`[Upload] ${$}`,P),S.push($),P}h({phase:"complete",current:1,total:1,percentComplete:100}),b({success:S.length===0,budgetsRestored:C,monthsRestored:T,payeesRestored:I,errors:S}),console.log("[Upload] Clearing all caches after upload..."),Fa()}catch(M){const F=M instanceof Error?M.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",M),console.error("[Upload] Error details:",{errorMessage:F,budgetsRestored:C,monthsRestored:T,payeesRestored:I,errorsSoFar:S}),p(F),b({success:!1,budgetsRestored:C,monthsRestored:T,payeesRestored:I,errors:[...S,F]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),Fa()}finally{i(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:u,error:f,result:g,scanZipFile:_,uploadBudget:w}}function Q3({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:i="Move to end"}){return d.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:ZP,children:[d.jsx("div",{style:{...JP,opacity:t?1:.3,boxShadow:t?"0 0 8px var(--shadow-primary)":"none"}}),t&&d.jsx("span",{style:eB,children:i})]})}function Zt(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function _r(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Vn(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function zt(t){return t===0?"$0.00":`${t>0?"+":"-"}${Zt(t)}`}function Lt(t){return`${t>=0?"+":"-"}${Zt(t)}`}function ct(t){return t===0?ge.zero:t>0?ge.success:ge.danger}function dn(t){return t===0?ge.zero:t>0?ge.success:ge.debt}function Ec(t){return t===0?ge.zero:t<0?ge.error:ge.success}function Cc(t){return t===0?ge.zero:t>0?ge.success:ge.error}async function dA(t,e){const{exists:n,data:r}=await At("feedback",t,`VALIDATION-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function s0(t){const{docId:e,items:n,description:r}=t;await kr("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function K3(t,e,n,r){const{exists:i}=await At("feedback",t,"checking if user has existing feedback document");i?await kr("feedback",t,{items:Ku(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await kr("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}function hA(){const t=Rt(),e=En({onMutate:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:u,currentPath:h}=r,f=o||i,p=we.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),b=`feedback_optimistic_${Date.now()}`,_={id:b,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:u,doc_id:f,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,_]}),{previousData:g,optimisticId:b}},mutationFn:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:u,currentPath:h}=r,f=o||i,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:u};return await K3(f,p,o,"submitting new feedback"),{feedbackItem:p,docId:f}},onSuccess:(r,i,o)=>{if(!o?.optimisticId)return;const l=t.getQueryData(we.feedback());l&&t.setQueryData(we.feedback(),{items:l.items.map(u=>u.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:i.userEmail}:u)})},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(we.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function Y3(){const t=Rt(),e=En({onMutate:async r=>{const{item:i}=r,o=we.feedback(),l=!i.is_done,u=l?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(f=>f.id===i.id?{...f,is_done:l,completed_at:u}:f)}),{previousData:h}},mutationFn:async r=>{const{item:i}=r,o=!i.is_done,l=o?new Date().toISOString():null,u=await dA(i.doc_id,"toggle feedback");let h=!1;const f=u.items.map(p=>p.id===i.id?(h=!0,{...p,is_done:o,completed_at:l}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:i.id,inDocument:i.doc_id,availableIds:u.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${i.id}, Doc ID: ${i.doc_id}`);return await s0({docId:i.doc_id,items:f,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:i.id,isDone:o,completedAt:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(we.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function X3(){const t=Rt(),e=En({onMutate:async r=>{const{docId:i,items:o}=r,l=we.feedback();await t.cancelQueries({queryKey:l});const u=t.getQueryData(l),h=new Map;return o.forEach(f=>{h.set(f.id,f.sort_order)}),u&&t.setQueryData(l,{items:u.items.map(f=>f.doc_id===i&&h.has(f.id)?{...f,sort_order:h.get(f.id)}:f)}),{previousData:u}},mutationFn:async r=>{const{docId:i,items:o}=r;return await s0({docId:i,items:o,description:"saving reordered feedback items"}),{docId:i,items:o}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(we.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}const Ju={critical_bug:{label:"Critical Bug",color:"var(--color-error)",bgColor:"var(--color-error-bg)"},bug:{label:"Bug",color:"var(--color-warning)",bgColor:"var(--color-warning-bg)"},new_feature:{label:"New Feature",color:"var(--color-success)",bgColor:"var(--color-success-bg)"},core_feature:{label:"Core Feature",color:"var(--color-migration-blue)",bgColor:"var(--color-migration-blue-bg)"},qol:{label:"QOL",color:"var(--color-migration-purple)",bgColor:"var(--color-migration-purple-bg)"}};function Ks({isOpen:t,onClose:e,title:n,children:r,width:i="28rem"}){if(!t)return null;function o(){e()}return d.jsx("div",{style:{position:"fixed",inset:0,background:"var(--modal-backdrop)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:d.jsxs("div",{style:{background:"var(--surface-base)",color:"var(--text-primary)",borderRadius:"12px",padding:"1.5rem",width:i,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px var(--shadow-overlay)"},onClick:l=>l.stopPropagation(),children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[d.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),d.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const Z3=2e3;function J3(){const[t,e]=R.useState(!1),[n,r]=R.useState(""),[i,o]=R.useState("bug"),[l,u]=R.useState(!1),h=R.useContext(wd),p=Ni().get_current_firebase_user(),g=er(),{submitFeedback:b}=hA();if(R.useEffect(()=>{if(l){const x=setTimeout(()=>u(!1),Z3);return()=>clearTimeout(x)}},[l]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function w(x){x.preventDefault(),!(!n.trim()||!h.username||!p)&&(b.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:i,currentPath:g.pathname}),r(""),o("bug"),e(!1),u(!0))}return d.jsxs(d.Fragment,{children:[l&&d.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"var(--banner-success)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px var(--shadow-overlay)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[d.jsx("span",{children:""}),d.jsx("span",{children:"Feedback submitted!"})]}),d.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:ge.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px var(--shadow-overlay)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:x=>{x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 16px var(--shadow-overlay)"},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 4px 12px var(--shadow-overlay)"},children:""}),d.jsx(Ks,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:d.jsxs("form",{onSubmit:w,children:[d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(x=>{const S=Ju[x],C=i===x;return d.jsxs("button",{type:"button",onClick:()=>{S.label,o(x)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${S.color}`,borderRadius:"0.5rem",background:C?S.bgColor:"transparent",color:C?S.color:"var(--text-muted)",cursor:"pointer",fontWeight:C?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:C?1:.5,boxShadow:C?`0 0 12px ${S.bgColor}`:"none",position:"relative"},children:[S.label,C&&d.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},x)})}),d.jsx(t0,{value:n,onChange:x=>r(x.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),d.jsxs(Ga,{children:[d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),d.jsx($e,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function Qr({children:t,labelStyle:e,...n}){return d.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[d.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:ge.primary},...n}),t]})}function i0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[i,o]=R.useState(r);return d.jsxs("div",{style:{marginTop:"2rem"},children:[d.jsxs("button",{onClick:()=>o(!i),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[d.jsx("span",{style:{transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),i&&n]})}const ez=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},tz=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function qf(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,i=e.filter(S=>!S.hidden),o=i.length,l=ez(o),u=tz(o),h=Math.floor(100/u),f=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",b=r==="segmented",_=S=>{const C="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return b?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:S?C:T,cursor:"pointer",fontWeight:S?600:400,fontSize:"0.95rem",color:"inherit",opacity:S?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:S?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:S?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:S?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:S?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:S?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},w=(S,C)=>d.jsxs(d.Fragment,{children:[d.jsx("span",{children:S.label}),S.checkmark&&d.jsx("span",{style:{color:ge.success,fontWeight:600},children:""}),p&&C&&d.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),x=()=>b?`
        .${f} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${f} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${f} > button,
        .${f} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${f} > button:last-child,
        .${f} > a:last-child {
          margin-right: 0;
        }
        .${f} > button::before,
        .${f} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 var(--sticky-header-bg), 1px 0 0 var(--sticky-header-bg);
        }
        .${f} > button:nth-child(1),
        .${f} > a:nth-child(1) {
          z-index: 4;
        }
        .${f} > button:nth-child(2),
        .${f} > a:nth-child(2) {
          z-index: 3;
        }
        .${f} > button:nth-child(3),
        .${f} > a:nth-child(3) {
          z-index: 2;
        }
        .${f} > button:nth-child(4),
        .${f} > a:nth-child(4) {
          z-index: 1;
        }
        .${f} > button.tab-active,
        .${f} > a.tab-active {
          z-index: 10;
        }
        .${f} > button.tab-active::before,
        .${f} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${f} > button:not(.tab-active):hover,
        .${f} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${f} > button:not(.tab-active):hover::before,
        .${f} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${f} {
            padding-left: 0;
            padding-right: 0;
          }
          .${f} > button,
          .${f} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${f} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${l}px) {
        .${f} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return d.jsxs(d.Fragment,{children:[d.jsx("style",{children:`
        ${x()}
        .${f} > button,
        .${f} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${f} > button:hover,
        .${f} > button:focus,
        .${f} > a:hover,
        .${f} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${b?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),d.jsx("div",{className:f,children:i.map(S=>{const C=n===S.id;return t.mode==="link"?d.jsx(An,{to:`${t.linkPrefix}/${S.id}`,onClick:()=>(`${S.label}`,void 0),style:_(C),className:C?"tab-active":"",children:w(S,C)},S.id):d.jsx("button",{onClick:()=>{`${S.label}`,t.onTabChange(S.id)},style:_(C),className:C?"tab-active":"",children:w(S,C)},S.id)})})]})}function fA({items:t}){const[e,n]=R.useState(!1),r=R.useRef(null),o=er().pathname;R.useEffect(()=>{function u(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[e]),R.useEffect(()=>{function u(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[e]);const l=t.filter(u=>u.hidden?!1:u.to?u.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):u.to==="/account"||u.to==="/"?o!==u.to:!o.startsWith(u.to):!0);return d.jsxs("div",{ref:r,style:{position:"relative"},children:[d.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&d.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"var(--overlay-panel-bg)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px var(--shadow-overlay)",zIndex:1e3,overflow:"hidden"},children:l.map((u,h)=>{if(u.divider)return d.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const f=d.jsxs(d.Fragment,{children:[u.icon&&d.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:u.icon}),d.jsx("span",{children:u.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return u.to?d.jsx(An,{to:u.to,style:p,onMouseEnter:b=>Object.assign(b.currentTarget.style,g),onMouseLeave:b=>b.currentTarget.style.background="transparent",onClick:()=>{`${u.label}`,n(!1)},children:f},h):d.jsx("button",{onClick:()=>{`${u.label}`,u.onClick?.(),n(!1)},style:p,onMouseEnter:b=>Object.assign(b.currentTarget.style,g),onMouseLeave:b=>b.currentTarget.style.background="transparent",children:f},h)})})]})}function nz({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Xe(),i=er(),l=[...i.pathname==="/budget"||i.pathname.startsWith("/budget/")&&!i.pathname.startsWith("/budget/settings")&&!i.pathname.startsWith("/budget/admin")&&!i.pathname.startsWith("/budget/analytics")&&!i.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return d.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[d.jsx("div",{style:{flex:"0 0 auto"},children:e?d.jsx(An,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):d.jsx(An,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:d.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),d.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),d.jsx("div",{style:{flex:"0 0 auto"},children:n?d.jsx("div",{style:{width:"1.5rem"}}):d.jsx(fA,{items:l})})]})}function mA({children:t,style:e}){return d.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function ed({message:t,linkText:e,linkTo:n}){return d.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${ge.warning} 12%, transparent)`,border:`2px solid ${ge.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[d.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),d.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[d.jsx("p",{style:{margin:0,fontWeight:500,color:ge.warning,fontSize:"0.95rem"},children:t}),d.jsxs(An,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:ge.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}const rz={success:{bgColor:"var(--banner-success)",color:"white",icon:""},error:{bgColor:"var(--banner-error)",color:"white",icon:""},warning:{bgColor:"var(--banner-warning)",color:"white",icon:""},info:{bgColor:"var(--banner-info)",color:"white",icon:""}};function sz({item:t,onDismiss:e}){const[n,r]=R.useState(!1);if(R.useEffect(()=>{if(t){if(r(!0),t.autoDismissMs&&t.autoDismissMs>0){const o=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),200)},t.autoDismissMs);return()=>clearTimeout(o)}}else r(!1)},[t,e]),!t||!n)return null;const i=rz[t.type];return d.jsxs("div",{style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",left:"1.5rem",maxWidth:"600px",margin:"0 auto",background:i.bgColor,color:i.color,padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px var(--shadow-overlay)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:n?"fadeInUp 0.2s ease-out":"fadeOut 0.2s ease-out",cursor:"pointer"},onClick:()=>{r(!1),setTimeout(()=>e(t.id),200)},children:[d.jsx("span",{children:i.icon}),d.jsx("span",{style:{flex:1},children:t.message}),d.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:""})]})}class iz{items=[];listeners=new Set;nextId=1;add(e){const n=`banner-${this.nextId++}`,r={...e,id:n};return this.items.push(r),this.notify(),n}remove(e){this.items=this.items.filter(n=>n.id!==e),this.notify()}getCurrent(){return this.items[0]||null}subscribe(e){return this.listeners.add(e),e(this.getCurrent()),()=>{this.listeners.delete(e)}}notify(){const e=this.getCurrent();this.listeners.forEach(n=>n(e))}}const qn=new iz;function Nn(){const t=R.useCallback(async(r,i,o,l)=>{const u=we.month(r,i,o),h=Be.getQueryData(u);if(!h?.month)throw new Error(`Month ${i}/${o} not found in cache`);await Y_({budgetId:r,month:h.month,description:`${l}: ${i}/${o}`,updateMonthMap:!1})},[]),e=R.useCallback(async(r,i)=>{const o=we.budget(r),l=Be.getQueryData(o);if(!l)throw new Error(`Budget ${r} not found in cache`);const u=Object.fromEntries(Object.entries(l.budget.accounts||{}).map(([f,p])=>{const{balance:g,...b}=p;return[f,b]})),h=Object.fromEntries(Object.entries(l.budget.categories||{}).map(([f,p])=>{const{balance:g,...b}=p;return[f,b]}));await Yo({budgetId:r,updates:{name:l.budget.name,user_ids:l.budget.user_ids,accepted_user_ids:l.budget.accepted_user_ids,owner_id:l.budget.owner_id,owner_email:l.budget.owner_email,accounts:u,account_groups:l.budget.account_groups,categories:h,category_groups:l.budget.category_groups,month_map:l.budget.month_map},description:`${i}: budget`})},[]);return{saveCurrentDocument:R.useCallback(async(r,i,o,l)=>{try{i==="month"&&o!==void 0&&l!==void 0?await t(r,o,l,"immediate save (current viewing document)"):i==="budget"&&await e(r,"immediate save (current viewing document)")}catch(u){const h=u instanceof Error?u.message:String(u);throw qn.add({type:"error",message:`Failed to save current document: ${h}`,autoDismissMs:0}),u}},[t,e])}}async function az(t,e,n){const r=Be.getQueryData(we.budget(t));if(!r){console.warn("[mutationHelpers] Budget not in cache, skipping local recalculation");return}const i=r.budget.month_map,o=He(e,n),l=[];for(const[u]of Object.entries(i))if(u>=o){const h=parseInt(u.substring(0,4),10),f=parseInt(u.substring(4,6),10);l.push({year:h,month:f})}l.sort((u,h)=>u.year!==h.year?u.year-h.year:u.month-h.month);for(const{year:u,month:h}of l)try{await TB(t,u,h,Be)}catch(f){console.warn(`[mutationHelpers] Failed to recalculate month ${u}/${h} locally:`,f)}}function vr(){const{addLoadingHold:t,removeLoadingHold:e}=Rn();return{updateMonthCacheAndTrack:(i,o,l,u)=>{Be.setQueryData(we.month(i,o,l),{month:u})},recalculateMonthAndCascade:async(i,o,l,u)=>{const h="recalculate-month-cascade",f=u||((S,C)=>{S?t(h,C):e(h)}),p=we.month(i,o,l),g=Be.getQueryData(p);if(g?.month){const S=r0(g.month);Be.setQueryData(p,{month:S})}const b=_d(),_=He(b.year,b.month),w=He(o,l),x=w<_;if(await az(i,o,l),x){f(!0,"Saving start balances...");try{const S=Be.getQueryData(we.budget(i));if(!S){console.warn("[mutationHelpers] Budget not in cache, skipping start_balance save");return}const C=S.monthMap||{},T=[];for(const[I]of Object.entries(C))if(I>=w&&I<=_){const M=parseInt(I.substring(0,4),10),F=parseInt(I.substring(4,6),10);T.push({year:M,month:F})}T.sort((I,M)=>I.year!==M.year?I.year-M.year:I.month-M.month);for(const{year:I,month:M}of T){const F=we.month(i,I,M),G=Be.getQueryData(F);if(G?.month){const D=vd(G.month);await Y_({budgetId:i,month:D,description:`recalculation: saving start_balance for ${I}/${M}`,updateMonthMap:!1})}}}catch(S){console.error("[mutationHelpers] Failed to save start_balance for months at/before window:",S)}finally{f(!1,"")}}try{await rA(i,f)}catch(S){console.warn("[mutationHelpers] Failed to ensure months fresh and recalculate balances:",S)}}}}function oz(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Nn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=vr();return{finalizeAllocations:async o=>{const{budgetId:l,year:u,month:h,allocations:f,onProgress:p}=o;p?.({phase:"saving",message:"Saving allocations..."});const g=await lr(l,u,h);if(!g)throw new Error(`Month not found: ${u}/${h}`);const b=g.category_balances?.map(S=>S.category_id)??[],_=g.category_balances.map(S=>{const C=Te(f[S.category_id]??S.allocated);return{...S,allocated:C}});for(const[S,C]of Object.entries(f))b.includes(S)||_.push({category_id:S,start_balance:0,allocated:Te(C),spent:0,transfers:0,adjustments:0,end_balance:0});const w={...g,category_balances:_,are_allocations_finalized:!0,updated_at:new Date().toISOString()};n(l,u,h,w),p?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,u,h)}catch(S){console.warn("[useFinalizeAllocations] Failed to recalculate month and cascade:",S)}if(t.type==="month"&&t.year===u&&t.month===h)try{await e(l,"month",u,h)}catch(S){console.warn("[useFinalizeAllocations] Failed to save current document immediately:",S)}return p?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:w}},isPending:!1,isError:!1,error:null}}function pA(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Nn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=vr();return{deleteAllocations:async o=>{const{budgetId:l,year:u,month:h,onProgress:f}=o;f?.({phase:"saving",message:"Deleting allocations..."});const p=await lr(l,u,h);if(!p)throw new Error(`Month not found: ${u}/${h}`);const g=p.category_balances.map(w=>({...w,allocated:0})),b={...p,category_balances:g,are_allocations_finalized:!1,updated_at:new Date().toISOString()};n(l,u,h,b),f?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,u,h)}catch(w){console.warn("[useDeleteAllocations] Failed to recalculate month and cascade:",w)}if(t.type==="month"&&t.year===u&&t.month===h)try{await e(l,"month",u,h)}catch(w){console.warn("[useDeleteAllocations] Failed to save current document immediately:",w)}return f?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:b}},isPending:!1,isError:!1,error:null}}async function Dm(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const i=[...n,r].sort((o,l)=>o.toLowerCase().localeCompare(l.toLowerCase()));return await kr("payees",t,{budget_id:t,payees:i,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),i}function lz(t,e){const n={id:e,amount:Te(t.amount),account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function cz(){const t=Rt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Nn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=vr(),o=En({onMutate:async u=>{const{budgetId:h,year:f,month:p}=u,g=we.month(h,f,p);await t.cancelQueries({queryKey:g});const b=t.getQueryData(g),_=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,w=lz(u,_);if(b?.month){const S={...b.month,income:[...b.month.income||[],w],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await i(h,f,p)}catch(S){console.warn("[useAddIncome] Failed to recalculate month and cascade:",S)}if(u.payee?.trim()){const S=t.getQueryData(we.payees(h))||[],C=await Dm(h,u.payee,S);C&&t.setQueryData(we.payees(h),C)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddIncome] Failed to save current document immediately:",S)}return{previousData:b,incomeId:_,newIncome:w}},mutationFn:async u=>{const{budgetId:h,year:f,month:p}=u,g=we.month(h,f,p),b=t.getQueryData(g);if(!b?.month)throw new Error("No month data in cache after optimistic update");const _=b.month,w=_.income?.[_.income.length-1];if(!w)throw new Error("Could not find new income in updated month");return{updatedMonth:_,newIncome:w}},onError:(u,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:b}=h;t.setQueryData(we.month(p,g,b),f.previousData)}}});return{addIncome:async(u,h,f,p,g,b,_,w)=>o.mutateAsync({budgetId:u,year:h,month:f,amount:p,accountId:g,date:b,payee:_,description:w}),isPending:o.isPending,isError:o.isError,error:o.error}}function uz(t,e,n,r,i,o){if(!t)return!0;const l=t.payee||void 0,u=i?.trim()||void 0,h=t.description||void 0,f=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||u!==l||f!==h}function dz(){const t=Rt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Nn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=vr();return{updateIncome:async(l,u,h,f,p,g,b,_,w)=>{const x=await lr(l,u,h);if(!x)throw new Error(`Month not found: ${u}/${h}`);const S=(x.income||[]).find(F=>F.id===f);if(!uz(S,p,g,b,_,w))return{updatedMonth:x,noOp:!0};const C={id:f,amount:Te(p),account_id:g,date:b,created_at:(x.income||[]).find(F=>F.id===f)?.created_at||new Date().toISOString()};_?.trim()&&(C.payee=_.trim()),w&&(C.description=w);const T=(x.income||[]).map(F=>F.id===f?C:F),I={...x,income:T,updated_at:new Date().toISOString()};r(l,u,h,I);try{await i(l,u,h)}catch(F){console.warn("[useUpdateIncome] Failed to recalculate month and cascade:",F)}if(_?.trim()){const F=t.getQueryData(we.payees(l))||[],G=await Dm(l,_,F);G&&t.setQueryData(we.payees(l),G)}if(e.type==="month"&&e.year===u&&e.month===h)try{await n(l,"month",u,h)}catch(F){console.warn("[useUpdateIncome] Failed to save current document immediately:",F)}return{updatedMonth:I}},isPending:!1,isError:!1,error:null}}function hz(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Nn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=vr();return{deleteIncome:async(o,l,u,h)=>{const f=await lr(o,l,u);if(!f)throw new Error(`Month not found: ${l}/${u}`);const p=(f.income||[]).filter(_=>_.id!==h),g={...f,income:p,updated_at:new Date().toISOString()};n(o,l,u,g);try{await r(o,l,u)}catch(_){console.warn("[useDeleteIncome] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(_){console.warn("[useDeleteIncome] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function fz(t,e){const n={id:e,amount:Te(t.amount),category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function mz(){const t=Rt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Nn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=vr(),o=En({onMutate:async u=>{const{budgetId:h,year:f,month:p}=u,g=we.month(h,f,p);await t.cancelQueries({queryKey:g});const b=t.getQueryData(g),_=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,w=fz(u,_);if(b?.month){const S={...b.month,expenses:[...b.month.expenses||[],w],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await i(h,f,p)}catch(S){console.warn("[useAddExpense] Failed to recalculate month and cascade:",S)}if(u.payee?.trim()){const S=t.getQueryData(we.payees(h))||[],C=await Dm(h,u.payee,S);C&&t.setQueryData(we.payees(h),C)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddExpense] Failed to save current document immediately:",S)}return{previousData:b,expenseId:_,newExpense:w}},mutationFn:async u=>{const{budgetId:h,year:f,month:p}=u,g=we.month(h,f,p),b=t.getQueryData(g);if(!b?.month)throw new Error("No month data in cache after optimistic update");const _=b.month,w=_.expenses?.[_.expenses.length-1];if(!w)throw new Error("Could not find new expense in updated month");return{updatedMonth:_,newExpense:w}},onError:(u,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:b}=h;t.setQueryData(we.month(p,g,b),f.previousData)}}});return{addExpense:async(u,h,f,p,g,b,_,w,x,S)=>o.mutateAsync({budgetId:u,year:h,month:f,amount:p,categoryId:g,accountId:b,date:_,payee:w,description:x,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function pz(t,e,n,r,i,o,l,u){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||i!==t.date||f!==h||g!==p||u!==t.cleared}function gz(){const t=Rt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Nn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=vr();return{updateExpense:async(l,u,h,f,p,g,b,_,w,x,S)=>{const C=await lr(l,u,h);if(!C)throw new Error(`Month not found: ${u}/${h}`);const T=(C.expenses||[]).find(D=>D.id===f);if(!pz(T,p,g,b,_,w,x,S))return{updatedMonth:C,noOp:!0};const I={id:f,amount:Te(p),category_id:g,account_id:b,date:_,created_at:C.expenses?.find(D=>D.id===f)?.created_at||new Date().toISOString()};w?.trim()&&(I.payee=w.trim()),x&&(I.description=x),S!==void 0&&(I.cleared=S);const M=(C.expenses||[]).map(D=>D.id===f?I:D),F={...C,expenses:M,updated_at:new Date().toISOString()};r(l,u,h,F);try{await i(l,u,h)}catch(D){console.warn("[useUpdateExpense] Failed to recalculate month and cascade:",D)}if(w?.trim()){const D=t.getQueryData(we.payees(l))||[],O=await Dm(l,w,D);O&&t.setQueryData(we.payees(l),O)}if(e.type==="month"&&e.year===u&&e.month===h)try{await n(l,"month",u,h)}catch(D){console.warn("[useUpdateExpense] Failed to save current document immediately:",D)}return{updatedMonth:F}},isPending:!1,isError:!1,error:null}}function yz(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Nn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=vr();return{deleteExpense:async(o,l,u,h)=>{const f=await lr(o,l,u);if(!f)throw new Error(`Month not found: ${l}/${u}`);const p=(f.expenses||[]).filter(_=>_.id!==h),g={...f,expenses:p,updated_at:new Date().toISOString()};n(o,l,u,g);try{await r(o,l,u)}catch(_){console.warn("[useDeleteExpense] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(_){console.warn("[useDeleteExpense] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function _z(t,e){const n={id:e,amount:Te(t.amount),from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function bz(){const t=Rt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Nn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=vr(),o=En({onMutate:async u=>{const{budgetId:h,year:f,month:p}=u,g=we.month(h,f,p);await t.cancelQueries({queryKey:g});const b=t.getQueryData(g),_=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,w=_z(u,_);if(b?.month){const S={...b.month,transfers:[...b.month.transfers||[],w],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await i(h,f,p)}catch(S){console.warn("[useAddTransfer] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddTransfer] Failed to save current document immediately:",S)}return{previousData:b,transferId:_,newTransfer:w}},mutationFn:async u=>{const{budgetId:h,year:f,month:p}=u,g=we.month(h,f,p),b=t.getQueryData(g);if(!b?.month)throw new Error("No month data in cache after optimistic update");const _=b.month,w=_.transfers?.[_.transfers.length-1];if(!w)throw new Error("Could not find new transfer in updated month");return{updatedMonth:_,newTransfer:w}},onError:(u,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:b}=h;t.setQueryData(we.month(p,g,b),f.previousData)}}});return{addTransfer:async(u,h,f,p,g,b,_,w,x,S,C)=>o.mutateAsync({budgetId:u,year:h,month:f,amount:p,fromAccountId:g,toAccountId:b,fromCategoryId:_,toCategoryId:w,date:x,description:S,cleared:C}),isPending:o.isPending,isError:o.isError,error:o.error}}function vz(t,e,n,r,i,o,l,u,h){if(!t)return!0;const f=t.description||void 0,p=u||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||i!==t.from_category_id||o!==t.to_category_id||l!==t.date||p!==f||h!==t.cleared}function xz(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Nn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=vr();return{updateTransfer:async(o,l,u,h,f,p,g,b,_,w,x,S)=>{const C=await lr(o,l,u);if(!C)throw new Error(`Month not found: ${l}/${u}`);const T=(C.transfers||[]).find(D=>D.id===h);if(!vz(T,f,p,g,b,_,w,x,S))return{updatedMonth:C,noOp:!0};const I={id:h,amount:Te(f),from_account_id:p,to_account_id:g,from_category_id:b,to_category_id:_,date:w,created_at:C.transfers?.find(D=>D.id===h)?.created_at||new Date().toISOString()};x&&(I.description=x),S!==void 0&&(I.cleared=S);const M=(C.transfers||[]).map(D=>D.id===h?I:D),F={...C,transfers:M,updated_at:new Date().toISOString()};n(o,l,u,F);try{await r(o,l,u)}catch(D){console.warn("[useUpdateTransfer] Failed to recalculate month and cascade:",D)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(D){console.warn("[useUpdateTransfer] Failed to save current document immediately:",D)}return{updatedMonth:F}},isPending:!1,isError:!1,error:null}}function wz(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Nn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=vr();return{deleteTransfer:async(o,l,u,h)=>{const f=await lr(o,l,u);if(!f)throw new Error(`Month not found: ${l}/${u}`);const p=(f.transfers||[]).filter(_=>_.id!==h),g={...f,transfers:p,updated_at:new Date().toISOString()};n(o,l,u,g);try{await r(o,l,u)}catch(_){console.warn("[useDeleteTransfer] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(_){console.warn("[useDeleteTransfer] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function Sz(t,e){const n={id:e,amount:Te(t.amount),account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function Ez(){const t=Rt(),{currentViewingDocument:e}=Xe(),{saveCurrentDocument:n}=Nn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=vr(),o=En({onMutate:async u=>{const{budgetId:h,year:f,month:p}=u,g=we.month(h,f,p);await t.cancelQueries({queryKey:g});const b=t.getQueryData(g),_=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,w=Sz(u,_);if(b?.month){const S={...b.month,adjustments:[...b.month.adjustments||[],w],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await i(h,f,p)}catch(S){console.warn("[useAddAdjustment] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddAdjustment] Failed to save current document immediately:",S)}return{previousData:b,adjustmentId:_,newAdjustment:w}},mutationFn:async u=>{const{budgetId:h,year:f,month:p}=u,g=we.month(h,f,p),b=t.getQueryData(g);if(!b?.month)throw new Error("No month data in cache after optimistic update");const _=b.month,w=_.adjustments?.[_.adjustments.length-1];if(!w)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:_,newAdjustment:w}},onError:(u,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:b}=h;t.setQueryData(we.month(p,g,b),f.previousData)}}});return{addAdjustment:async(u,h,f,p,g,b,_,w,x,S)=>o.mutateAsync({budgetId:u,year:h,month:f,amount:p,accountId:g,categoryId:b,date:_,payee:w,description:x,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function Cz(t,e,n,r,i,o,l,u){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||i!==t.date||f!==h||g!==p||u!==t.cleared}function Tz(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Nn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=vr();return{updateAdjustment:async(o,l,u,h,f,p,g,b,_,w,x)=>{const S=await lr(o,l,u);if(!S)throw new Error(`Month not found: ${l}/${u}`);const C=(S.adjustments||[]).find(G=>G.id===h);if(!Cz(C,f,p,g,b,_,w,x))return{updatedMonth:S,noOp:!0};const T={id:h,amount:Te(f),account_id:p,category_id:g,date:b,created_at:S.adjustments?.find(G=>G.id===h)?.created_at||new Date().toISOString()};_?.trim()&&(T.payee=_.trim()),w&&(T.description=w),x!==void 0&&(T.cleared=x);const I=(S.adjustments||[]).map(G=>G.id===h?T:G),M={...S,adjustments:I,updated_at:new Date().toISOString()};n(o,l,u,M);try{await r(o,l,u)}catch(G){console.warn("[useUpdateAdjustment] Failed to recalculate month and cascade:",G)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(G){console.warn("[useUpdateAdjustment] Failed to save current document immediately:",G)}return{updatedMonth:M}},isPending:!1,isError:!1,error:null}}function Az(){const{currentViewingDocument:t}=Xe(),{saveCurrentDocument:e}=Nn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=vr();return{deleteAdjustment:async(o,l,u,h)=>{const f=await lr(o,l,u);if(!f)throw new Error(`Month not found: ${l}/${u}`);const p=(f.adjustments||[]).filter(_=>_.id!==h),g={...f,adjustments:p,updated_at:new Date().toISOString()};n(o,l,u,g);try{await r(o,l,u)}catch(_){console.warn("[useDeleteAdjustment] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===u)try{await e(o,"month",l,u)}catch(_){console.warn("[useDeleteAdjustment] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function jz({budgetId:t,enabled:e,initialDataLoadComplete:n,months:r}){const{addLoadingHold:i,removeLoadingHold:o}=Rn(),{updateAccounts:l}=XT(),{updateCategories:u}=nA(),h=R.useRef(!1);R.useEffect(()=>{if(!e||!t||!n||r.length===0||h.current)return;h.current=!0,(async()=>{try{i("initial-balance-calculation","Calculating balances...");const p=Be.getQueryData(we.budget(t));if(!p){console.warn("[useInitialBalanceCalculation] No budget data in cache"),o("initial-balance-calculation");return}const{budget:g,accounts:b,categories:_}=p,w=Object.keys(_),x=[...r].sort((H,re)=>H.year!==re.year?H.year-re.year:H.month-re.month),S=_d(),C=He(S.year,S.month),T=x[0],I=T?He(T.year,T.month):null;let M=null;if(I&&I<=C)M=x.find(H=>He(H.year,H.month)===C)||null;else{const{readMonth:H}=await ko(async()=>{const{readMonth:re}=await Promise.resolve().then(()=>PS);return{readMonth:re}},void 0);M=await H(t,S.year,S.month,{description:"initial balance calculation: fetching first window month"})}let F=!1;M&&(F=(M.category_balances||[]).some(H=>!lt(H.category_id)&&H.start_balance!==0)||(M.account_balances||[]).some(H=>!Ye(H.account_id)&&H.start_balance!==0));let G=xd;const D=[];if(!F&&M){let H=S.year,re=S.month,N=!1;const q=120;for(let J=0;J<q&&!N;J++){const ne=wc(H,re);H=ne.year,re=ne.month;const{readMonth:ae}=await ko(async()=>{const{readMonth:Ae}=await Promise.resolve().then(()=>PS);return{readMonth:Ae}},void 0),Ee=await ae(t,H,re,{description:"initial balance calculation: walking backward to find start_balance"});if(!Ee)N=!0;else if((Ee.category_balances||[]).some(ce=>!lt(ce.category_id)&&ce.start_balance!==0)||(Ee.account_balances||[]).some(ce=>!Ye(ce.account_id)&&ce.start_balance!==0)){N=!0;const ce={},fe={};for(const Oe of Ee.category_balances||[])lt(Oe.category_id)||(ce[Oe.category_id]=Te(Oe.end_balance??0));for(const Oe of Ee.account_balances||[])Ye(Oe.account_id)||(fe[Oe.account_id]=Te(Oe.end_balance??0));G={categoryEndBalances:ce,accountEndBalances:fe,totalIncome:Te(Ee.total_income??0)}}else D.push(Ee)}D.reverse();for(const J of D){const ne=oc(J,G,J.previous_month_income);if(G=Uo(ne),Sm(J.year,J.month)){const ae=vd(ne);await Y_({budgetId:t,month:ae,description:`initial balance calculation: ensuring start_balance for ${J.year}/${J.month}`,updateMonthMap:!1})}}}else if(T){const H={},re={};for(const N of T.category_balances||[])lt(N.category_id)||(H[N.category_id]=Te(N.start_balance??0));for(const N of T.account_balances||[])Ye(N.account_id)||(re[N.account_id]=Te(N.start_balance??0));G={categoryEndBalances:H,accountEndBalances:re,totalIncome:Te(T.previous_month_income??0)}}const O=[];for(const H of x){const re=oc(H,G,H.previous_month_income);O.push(re),G=Uo(re)}const P=G.accountEndBalances,$=G.categoryEndBalances,V=O.length>0?O[O.length-1]:x.length>0?x[x.length-1]:null;let j;V?j=await LT(t,w,$,V.year,V.month):(j={},w.forEach(H=>{j[H]=0}));const B={};Object.entries(b).forEach(([H,re])=>{B[H]={...re,balance:Te(P[H]??0)}});const k={};Object.entries(_).forEach(([H,re])=>{k[H]={...re,balance:Te(j[H]??0)}});const Y=g.month_map||{},X=new Set(x.map(H=>He(H.year,H.month))),W={};for(const H of Object.keys(Y))X.has(H)?W[H]={}:W[H]=Y[H];for(const H of x){const re=He(H.year,H.month);re in W||(W[re]={})}for(const H of O)Be.setQueryData(we.month(t,H.year,H.month),{month:H});if(JSON.stringify(g.month_map)!==JSON.stringify(W)){i("initial-balance-calculation","Saving month map...");const{writeBudgetData:H}=await ko(async()=>{const{writeBudgetData:re}=await Promise.resolve().then(()=>tA);return{writeBudgetData:re}},void 0);await H({budgetId:t,updates:{month_map:W},description:"initial balance calculation: updating month_map"})}Be.setQueryData(we.budget(t),{...p,budget:{...g,month_map:W},accounts:B,categories:k})}catch(p){const g=p instanceof Error?p.message:"Failed to calculate initial balances";console.error("[useInitialBalanceCalculation] Error calculating balances:",p),qn.add({type:"error",message:`Initial balance calculation failed: ${g}`,autoDismissMs:1e4})}finally{o("initial-balance-calculation")}})()},[e,t,n,r,i,o,l,u]),R.useEffect(()=>{t||(h.current=!1)},[t])}const Rz={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastBalancesTab:"categories",lastTransactionsTab:"income",lastSettingsTab:"categories",lastAdminTab:"budget",currentViewingDocument:{type:null},setCurrentViewingDocument:()=>{},setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,initialDataLoadComplete:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},gA=R.createContext(Rz);function Iz({children:t}){const n=Ni().get_current_firebase_user(),[r,i]=R.useState(null),[o,l]=R.useState(new Date().getFullYear()),[u,h]=R.useState(new Date().getMonth()+1),[f,p]=R.useState("categories"),[g,b]=R.useState("categories"),[_,w]=R.useState("income"),x=R.useCallback(Me=>{p(Me),Me==="categories"||Me==="accounts"?b(Me):w(Me)},[]),[S,C]=R.useState("categories"),[T,I]=R.useState("budget"),[M,F]=R.useState("Budget"),G=R.useCallback(Me=>{F(Ge=>Ge===Me?Ge:Me)},[]),[D,O]=R.useState({type:null}),[P,$]=R.useState(!1),[V,j]=R.useState(!1),B=zT(n?.uid||null,n?.email||null),k=B.data&&B.data.budget_ids.length===0,Y=SP(n?.uid||null,B.data||null,{enabled:!!n?.uid&&!!B.data&&k}),X=CB(r,{enabled:!!r&&P}),[W,te]=R.useState(!1);R.useEffect(()=>{if(!X.data){te(!1);return}const{budget:Me,payees:Ge,months:tt}=X.data,L=Date.now();Be.setQueryData(we.budget(r),Me,{updatedAt:L}),Be.setQueryData(we.payees(r),Ge,{updatedAt:L});for(const de of tt)Be.setQueryData(we.month(r,de.year,de.month),{month:de},{updatedAt:L});te(!0)},[X.data,r]),jz({budgetId:r,enabled:!!r&&P&&W,initialDataLoadComplete:W,months:X.data?.months||[]}),R.useEffect(()=>{r||te(!1)},[r]);const H=B.data?.permission_flags?.is_admin===!0,re=B.data?.permission_flags?.is_test===!0,N=Y.data?.pendingInvites||[],q=Y.data?.budgets||[],J=N.length>0;R.useEffect(()=>{if(!n||P||B.isLoading)return;const Me=B.data;if(!(!Me&&!B.isError))if(Me&&Me.budget_ids.length>0)i(Me.budget_ids[0]),j(!1),$(!0);else{if(Y.isLoading)return;const Ge=Y.data;j(!(Ge?.pendingInvites&&Ge.pendingInvites.length>0)),$(!0)}},[n,P,B.data,B.isLoading,B.isError,Y.data,Y.isLoading]);const ne=R.useCallback(()=>{u===1?(l(Me=>Me-1),h(12)):h(Me=>Me-1)},[u]),ae=R.useCallback(()=>{u===12?(l(Me=>Me+1),h(1)):h(Me=>Me+1)},[u]),Ee=R.useCallback(async Me=>{(Me?.force||!Y.data)&&await Y.refetch()},[Y]),Ae=R.useCallback(Me=>{i(Me),j(!1)},[]),ce=R.useCallback(async Me=>{if(!n)return null;try{const Ge=await DP(Me,n.uid);return Ge&&Ge.isInvited&&!Ge.hasAccepted?{budgetId:Me,budgetName:Ge.budgetName,ownerEmail:Ge.ownerEmail}:null}catch(Ge){return console.error("[BudgetContext] Error checking budget invite:",Ge),null}},[n]),fe=R.useCallback(()=>Be.clear(),[]),Oe={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:u,lastActiveTab:f,lastBalancesTab:g,lastTransactionsTab:_,lastSettingsTab:S,lastAdminTab:T,currentViewingDocument:D,setCurrentViewingDocument:O,setSelectedBudgetId:i,setCurrentYear:l,setCurrentMonthNumber:h,setLastActiveTab:x,setLastSettingsTab:C,setLastAdminTab:I,pageTitle:M,setPageTitle:G,isInitialized:P,needsFirstBudget:V,initialDataLoadComplete:W,goToPreviousMonth:ne,goToNextMonth:ae,pendingInvites:N,hasPendingInvites:J,accessibleBudgets:q,isAdmin:H,isTest:re,loadAccessibleBudgets:Ee,switchToBudget:Ae,checkBudgetInvite:ce,clearCache:fe};return d.jsx(gA.Provider,{value:Oe,children:t})}function Xe(){const t=R.useContext(gA);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const Dz=function(){},kz={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:Dz},wd=R.createContext(kz);function KS({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:i,editName:o,isRenaming:l,onAccept:u,onSwitch:h,onStartEdit:f,onCancelEdit:p,onEditNameChange:g,onSaveEdit:b}){const _=e&&t.isOwner;return d.jsx("div",{style:{background:e?"color-mix(in srgb, var(--color-primary) 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, var(--color-primary) 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:i?d.jsxs("form",{onSubmit:b,children:[d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:d.jsx("input",{type:"text",value:o,onChange:w=>g(w.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[d.jsx("button",{type:"submit",disabled:l||!o.trim(),style:{background:"var(--color-success)",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:l||!o.trim()?.7:1,fontSize:"0.8rem"},children:l?"Saving...":"Save"}),d.jsx("button",{type:"button",onClick:p,disabled:l,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontWeight:500,opacity:l?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[d.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[d.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&d.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-success) 20%, transparent)",color:"var(--color-success)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-warning) 20%, transparent)",color:"var(--color-warning)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),_&&d.jsx("button",{onClick:f,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),d.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?d.jsx("button",{onClick:u,disabled:n,style:{background:"var(--color-success)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:d.jsx("button",{onClick:h,disabled:r,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}function yA({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in Ju?n:"bug",i=Ju[r];return d.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:i.bgColor,color:i.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:i.label})}function Mz({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:u,onToggleDone:h,onTypeClick:f}){return d.jsxs("div",{onDragOver:p=>{p.stopPropagation(),i(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),u(p)},style:{position:"relative"},children:[d.jsx("div",{style:{...XP,opacity:n?1:0,boxShadow:n?"0 0 8px var(--shadow-primary)":"none"}}),d.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:l,style:{...X_,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[d.jsx("span",{style:{...YP},children:""}),d.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ge.primary,flexShrink:0}}),d.jsx(yA,{type:t.feedback_type,onClick:f})]}),d.jsxs("div",{style:{marginLeft:"3.25rem"},children:[d.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),d.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",Uy(t.created_at)]})]})]})]})}function Oz({item:t,onToggleDone:e,onTypeClick:n}){return d.jsxs("div",{style:{...X_,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[d.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ge.primary,flexShrink:0}}),d.jsx(yA,{type:t.feedback_type,onClick:n})]}),d.jsxs("div",{style:{marginLeft:"2rem"},children:[d.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),d.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",Uy(t.created_at)]}),t.completed_at&&d.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:ge.success},children:[" Completed: ",Uy(t.completed_at)]})]})]})}function Hn({noMargin:t}={}){return d.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid var(--border-strong)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function _A(){const{state:t,closeModal:e}=Sc();if(!t.isOpen)return null;const n=t.isComplete;return d.jsx("div",{style:{position:"fixed",inset:0,background:"var(--modal-backdrop)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:d.jsxs("div",{style:{background:"var(--surface-base)",color:"var(--text-primary)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px var(--shadow-overlay)"},onClick:r=>r.stopPropagation(),children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[d.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&d.jsx(Hn,{noMargin:!0}),t.migrationName]}),n&&d.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),d.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"var(--color-error)":t.isComplete?"var(--color-success)":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),d.jsx("div",{style:{background:"var(--border-subtle)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?d.jsx("div",{style:{background:t.error?"var(--color-error)":t.isComplete?"var(--color-success)":"var(--color-primary)",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):d.jsx("div",{style:{background:t.error?"var(--color-error)":"var(--color-primary)",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&d.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&d.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&d.jsx("div",{style:{background:"var(--color-error-bg)",border:"1px solid var(--color-error-border)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"var(--color-error)"},children:t.error}),t.isComplete&&d.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"var(--color-error-bg)":"var(--color-primary)",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&d.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),d.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function bi({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:i=!1,onDownloadBackup:o,isDownloading:l=!1}){const[u,h]=R.useState(!1),f=R.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=R.useCallback(()=>{n(u?"downloaded":"already-have")},[u,n]),g=R.useCallback(()=>{n("cancelled"),e()},[n,e]);return d.jsxs(Ks,{isOpen:t,onClose:g,title:" Backup Recommended",children:[d.jsx("div",{style:{background:i?"color-mix(in srgb, var(--color-error) 15%, transparent)":"color-mix(in srgb, var(--color-warning) 15%, transparent)",border:`1px solid ${i?"color-mix(in srgb, var(--color-error) 40%, transparent)":"color-mix(in srgb, var(--color-warning) 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:i?"var(--color-error-light)":"var(--color-warning-light)",fontWeight:500,fontSize:"0.95rem"},children:i?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",d.jsx("strong",{children:r})]}),d.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx($e,{variant:"secondary",onClick:f,disabled:l,actionName:"Download Backup Before Migration",style:{width:"100%"},children:l?d.jsxs(d.Fragment,{children:[d.jsx(Hn,{noMargin:!0})," Downloading Backup..."]}):u?" Backup Downloaded":" Download Backup Now"})}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),d.jsx($e,{variant:i?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:l,children:u?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function vi({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,i]=R.useState(!1),[o,l]=R.useState(!1),[u,h]=R.useState(null),f=R.useCallback(_=>{h(()=>_),i(!0)},[]),p=R.useCallback(_=>{_!=="cancelled"&&u&&u(),h(null),i(!1)},[u]),g=R.useCallback(()=>{h(null),i(!1)},[]),b=R.useCallback(async()=>{if(n){l(!0);try{await n()}finally{l(!1)}}},[n]);return{promptBeforeAction:f,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?b:void 0,isDownloading:o}}}const Nz={onetime:{borderColor:"color-mix(in srgb, var(--color-migration-purple) 30%, transparent)",iconBg:"color-mix(in srgb, var(--color-migration-purple) 15%, transparent)",headerBg:"color-mix(in srgb, var(--color-migration-purple) 8%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, var(--color-migration-blue) 30%, transparent)",iconBg:"color-mix(in srgb, var(--color-migration-blue) 15%, transparent)",headerBg:"color-mix(in srgb, var(--color-migration-blue) 8%, transparent)"},utility:{borderColor:"color-mix(in srgb, var(--color-migration-green) 30%, transparent)",iconBg:"color-mix(in srgb, var(--color-migration-green) 15%, transparent)",headerBg:"color-mix(in srgb, var(--color-migration-green) 8%, transparent)"}};function a0({title:t,icon:e,description:n,type:r,children:i,onValidateAll:o,isValidating:l=!1,isAnyRunning:u=!1}){const h=Nz[r],f=l||u,p=()=>{o&&!f&&o()};return d.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[d.jsxs("div",{style:{background:h.headerBg,padding:"1.25rem 1.5rem",borderBottom:`2px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.875rem",flex:1},children:[d.jsx("span",{style:{fontSize:"1.75rem",background:h.iconBg,padding:"0.625rem",borderRadius:"10px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"48px",minHeight:"48px"},children:e}),d.jsxs("div",{children:[d.jsx("h3",{style:{margin:"0 0 0.375rem 0",fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em"},children:t}),d.jsx("p",{style:{margin:0,opacity:.75,fontSize:"0.9rem",lineHeight:1.4},children:n})]})]}),o&&d.jsx("button",{onClick:p,disabled:f,style:{background:"color-mix(in srgb, var(--color-migration-blue) 20%, transparent)",color:"var(--color-migration-blue-light)",border:"1px solid color-mix(in srgb, var(--color-migration-blue) 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:f?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:f?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:l?d.jsxs(d.Fragment,{children:[d.jsx(Hn,{noMargin:!0})," Validating..."]}):" Validate All"})]}),d.jsx("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 1%, transparent)"},children:i})]})}const Pz={unknown:{color:"var(--text-muted)",icon:"",text:"Unknown"},clean:{color:"var(--color-success)",icon:"",text:"Clean"},"needs-action":{color:"var(--color-warning)",icon:"",text:"Needs Action"},running:{color:"var(--color-migration-blue-light)",icon:"",text:"Running"},complete:{color:"var(--color-success)",icon:"",text:"Complete"},error:{color:"var(--color-error)",icon:"",text:"Error"}};function Qa({name:t,description:e,status:n,statusText:r,onCheck:i,isChecking:o,onRun:l,isRunning:u=!1,actionText:h="Run",disabled:f=!1,itemCount:p,details:g,isDestructive:b=!1}){const[_,w]=R.useState(!1),x=Pz[n],S=r||x.text,C=f||u||o,T=()=>{i()},I=()=>{l&&l()},M=()=>{g&&w(!_)};return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${x.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:u||o?d.jsx(Hn,{noMargin:!0}):x.icon}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),d.jsxs("div",{style:{color:x.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[S,p!==void 0&&p>0&&d.jsx("span",{style:{background:`color-mix(in srgb, ${x.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[d.jsx("button",{onClick:T,disabled:C,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",opacity:C?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?d.jsx(Hn,{noMargin:!0}):""}),l&&n==="needs-action"&&d.jsx("button",{onClick:I,disabled:C,style:{background:b?"var(--color-error)":"var(--color-primary)",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:C?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:u?d.jsx(Hn,{noMargin:!0}):h}),g&&d.jsx("button",{onClick:M,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:_?"Collapse details":"Expand details",children:_?"":""})]})]}),_&&g&&d.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function Bz({name:t,description:e,onAction:n,actionText:r,actionIcon:i,isRunning:o=!1,disabled:l=!1,progress:u,error:h,isDestructive:f=!1}){const p=l||o,g=()=>{n()};return d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&d.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-error)",marginTop:"0.25rem"},children:h})]}),u!==void 0&&o&&d.jsxs("div",{style:{width:"100px",flexShrink:0},children:[d.jsx("div",{style:{background:"var(--border-subtle)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:d.jsx("div",{style:{background:f?"var(--color-error)":"var(--color-primary)",height:"100%",width:`${u}%`,transition:"width 0.3s"}})}),d.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[u,"%"]})]}),d.jsx("button",{onClick:g,disabled:p,style:{background:f?"var(--color-error)":"var(--color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?d.jsxs(d.Fragment,{children:[d.jsx(Hn,{noMargin:!0})," Running..."]}):d.jsxs(d.Fragment,{children:[i&&d.jsx("span",{children:i}),r]})})]})})}function zz(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function Lz(t,e,n,r){return e?n?`${r} month(s) need migration`:"No data to migrate":"No data scanned"}function Uz(t,e,n,r,i){return t?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&d.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.monthsProcessed>0&&d.jsxs("li",{children:[t.monthsProcessed," month(s) processed"]}),t.monthsUpdated>0&&d.jsxs("li",{children:[t.monthsUpdated," month(s) updated"]}),t.monthsUpdated===0&&t.monthsProcessed>0&&d.jsx("li",{children:"No months needed updates"})]}),t.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>d.jsx("li",{children:o},l)),t.errors.length>3&&d.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," month(s) with total_income or total_expenses fields."]}),r&&d.jsxs("div",{style:{opacity:.6,fontSize:"0.8rem"},children:[r.monthsWithTotalIncome>0&&`${r.monthsWithTotalIncome} with total_income`,r.monthsWithTotalIncome>0&&r.monthsWithTotalExpenses>0&&", ",r.monthsWithTotalExpenses>0&&`${r.monthsWithTotalExpenses} with total_expenses`]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All months are clean.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalMonths," month(s) across ",r.totalBudgets," budget(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months with total_income or total_expenses fields."})}function Fz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){return d.jsx(Qa,{name:"Remove Total Fields Migration",description:"Removes total_income and total_expenses from month documents. These are calculated from income/expenses arrays on-the-fly.",status:zz(t,e,n,o,l),statusText:Lz(t,e,n,r),isChecking:i,isRunning:o,onCheck:u,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:Uz(l,e,n,t,r)})}function Vz(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function $z(t,e,n,r){return e?n?`${r} month(s) need migration`:"No data to migrate":"No data scanned"}function qz(t,e,n,r,i){return t?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&d.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.monthsProcessed>0&&d.jsxs("li",{children:[t.monthsProcessed," month(s) processed"]}),t.monthsUpdated>0&&d.jsxs("li",{children:[t.monthsUpdated," month(s) updated"]}),t.monthsUpdated===0&&t.monthsProcessed>0&&d.jsx("li",{children:"No months needed updates"})]}),t.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>d.jsx("li",{children:o},l)),t.errors.length>3&&d.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," month(s) with previous_month_income field."]}),d.jsx("div",{style:{opacity:.6,fontSize:"0.8rem"},children:"This field is now calculated from the previous month's income array."})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All months are clean.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalMonths," month(s) across ",r.totalBudgets," budget(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months with previous_month_income field."})}function Hz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){return d.jsx(Qa,{name:"Remove Previous Month Income Migration",description:"Removes previous_month_income from month documents. This is calculated from the previous month's income array on-the-fly.",status:Vz(t,e,n,o,l),statusText:$z(t,e,n,r),isChecking:i,isRunning:o,onCheck:u,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:qz(l,e,n,t,r)})}function Gz(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function Wz(t,e,n,r){return e?n?`${r} budget(s) need migration`:"No data to migrate":"No data scanned"}function Qz(t,e,n,r,i){return t?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&d.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.budgetsUpdated>0&&d.jsxs("li",{children:[t.budgetsUpdated," budget(s) updated"]}),t.budgetsUpdated===0&&t.budgetsProcessed>0&&d.jsx("li",{children:"No budgets needed updates"})]}),t.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>d.jsx("li",{children:o},l)),t.errors.length>3&&d.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," budget(s) missing percentage_income_months_back."]}),d.jsx("div",{style:{opacity:.6,fontSize:"0.8rem"},children:"Adds percentage_income_months_back: 1 so percentage-based allocations use previous month income by default."})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All budgets have percentage_income_months_back set.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalBudgets," budget(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for budgets missing percentage_income_months_back."})}function Kz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){return d.jsx(Qa,{name:"Percentage Income Months Back",description:"Adds percentage_income_months_back to all budgets (default 1). Use budget settings to change how many months back percentage-based allocation income is taken from.",status:Gz(t,e,n,o,l),statusText:Wz(t,e,n,r),isChecking:i,isRunning:o,onCheck:u,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:Qz(l,e,n,t,r)})}function Yz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,removeTotalFieldsMigration:r,removePreviousMonthIncomeMigration:i,percentageIncomeMonthsBackMigration:o}){const l=r.isRunning||i.isRunning||o.isRunning;return d.jsx(d.Fragment,{children:d.jsxs(a0,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:l,children:[d.jsx(Fz,{status:r.status,hasData:r.hasData,needsMigration:r.needsMigration,totalItemsToFix:r.totalItemsToFix,isChecking:r.isScanning,isRunning:r.isRunning,result:r.result,onCheck:r.scanStatus,onRun:r.runMigration,disabled:t}),d.jsx(Hz,{status:i.status,hasData:i.hasData,needsMigration:i.needsMigration,totalItemsToFix:i.totalItemsToFix,isChecking:i.isScanning,isRunning:i.isRunning,result:i.result,onCheck:i.scanStatus,onRun:i.runMigration,disabled:t}),d.jsx(Kz,{status:o.status,hasData:!!o.status,needsMigration:o.needsMigration,totalItemsToFix:o.totalItemsToFix,isChecking:o.isScanning,isRunning:o.isRunning,result:o.result,onCheck:o.scanStatus,onRun:o.runMigration,disabled:t})]})})}const bA={unknown:{color:"var(--text-muted)",icon:""},clean:{color:"var(--color-success)",icon:""},"needs-action":{color:"var(--color-warning)",icon:""},running:{color:"var(--color-migration-blue-light)",icon:""},complete:{color:"var(--color-success)",icon:""},error:{color:"var(--color-error)",icon:""}};function Xz({check:t,disabled:e}){const n=bA[t.status],r=e||t.isRunning||t.isChecking;return d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[d.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?d.jsx(Hn,{noMargin:!0}):n.icon}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&d.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),d.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),d.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[d.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?d.jsx(Hn,{noMargin:!0}):""}),t.canFix&&t.onFix&&d.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?d.jsx(Hn,{noMargin:!0}):"Fix"})]})]})}function Zz({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:i,totalIssues:o,isScanning:l,isRunning:u,disabled:h,onRunOrphaned:f,onRunExpense:p,onRunTransfers:g}){const[b,_]=R.useState(!1),x=u?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?i?"needs-action":"clean":"unknown",S=bA[x],C=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(M=>M.transactionType==="income").length>0&&d.jsxs("span",{children:["Income: ",t.status.violations.filter(M=>M.transactionType==="income").length," "]}),t.status.violations.filter(M=>M.transactionType==="expense").length>0&&d.jsxs("span",{children:["Expenses: ",t.status.violations.filter(M=>M.transactionType==="expense").length," "]}),t.status.violations.filter(M=>M.transactionType==="adjustment").length>0&&d.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(M=>M.transactionType==="adjustment").length," "]}),t.status.violations.filter(M=>M.transactionType==="transfer").length>0&&d.jsxs("span",{children:["Transfers: ",t.status.violations.filter(M=>M.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:Jg(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:f,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&d.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&d.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:Jg(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:Jg(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&d.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&d.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||u||l,I=()=>{C.forEach(M=>M.onCheck())};return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${S.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:u||l?d.jsx(Hn,{noMargin:!0}):S.icon}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),d.jsxs("div",{style:{color:S.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[x==="unknown"?"Unknown":x==="clean"?"Clean":x==="running"?"Running":"Needs Action",o>0&&d.jsx("span",{style:{background:`color-mix(in srgb, ${S.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[d.jsx("button",{onClick:I,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:l?d.jsx(Hn,{noMargin:!0}):""}),d.jsx("button",{onClick:()=>_(!b),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:b?"Collapse":"Expand",children:b?"":""})]})]}),b&&d.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:C.map(M=>d.jsx(Xz,{check:M,disabled:h},M.id))})]})}function Jg(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function Jz({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return _>0?`Fixed ${_}`:"Complete"}},b=()=>{if(l){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&d.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsFixed>0&&d.jsxs("li",{children:[l.accountsFixed," account balance(s) fixed"]}),l.categoriesFixed>0&&d.jsxs("li",{children:[l.categoriesFixed," category value(s) fixed"]}),l.totalAvailableFixed>0&&d.jsxs("li",{children:[l.totalAvailableFixed," total_available value(s) fixed"]}),l.monthsProcessed>0&&d.jsxs("li",{children:[l.monthsProcessed," month(s) updated"]}),l.incomeValuesFixed>0&&d.jsxs("li",{children:[l.incomeValuesFixed," income amount(s) fixed"]}),l.expenseValuesFixed>0&&d.jsxs("li",{children:[l.expenseValuesFixed," expense amount(s) fixed"]}),l.categoryBalancesFixed>0&&d.jsxs("li",{children:[l.categoryBalancesFixed," category balance(s) fixed"]}),l.accountBalancesFixed>0&&d.jsxs("li",{children:[l.accountBalancesFixed," account balance(s) fixed"]}),_===0&&d.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((w,x)=>d.jsx("li",{children:w},x)),l.errors.length>3&&d.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:"Precision issues found:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&d.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&d.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&d.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&d.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),d.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return d.jsx(Qa,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:u,isChecking:i,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:f,itemCount:n?r:void 0,details:b(),isDestructive:!0})}function e4({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0)return l.monthsUpdated>0?`Updated ${l.monthsUpdated} month(s)`:"Complete"},b=()=>l?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Recalculation complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&d.jsxs("li",{children:[l.budgetsProcessed," budget(s) processed"]}),l.monthsProcessed>0&&d.jsxs("li",{children:[l.monthsProcessed," month(s) processed"]}),l.monthsUpdated>0&&d.jsxs("li",{children:[l.monthsUpdated," month(s) updated"]}),l.monthsUpdated===0&&d.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((_,w)=>d.jsx("li",{children:_},w)),l.errors.length>3&&d.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:"Months needing recalculation:"}),d.jsx("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:d.jsxs("li",{children:[t.monthsNeedingRecalculation," month(s) from first month up to earliest window month"]})}),d.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All start balances are up to date.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months needing recalculation."});return d.jsx(Qa,{name:"Recalculate Start Balances",description:"Recalculates and saves start_balance for all months from the first month up to the earliest month in the window",status:p(),statusText:g(),onCheck:u,isChecking:i,onRun:h,isRunning:o,actionText:n?`Recalculate ${r}`:void 0,disabled:f,itemCount:n?r:void 0,details:b(),isDestructive:!0})}function t4({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:u,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.monthsAdded+l.orphanedEntriesRemoved;return _>0?`Fixed ${_} issue(s)`:"Complete"}},b=()=>l?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Repair complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&d.jsxs("li",{children:[l.budgetsProcessed," budget(s) processed"]}),l.budgetsUpdated>0&&d.jsxs("li",{children:[l.budgetsUpdated," budget(s) updated"]}),l.monthsAdded>0&&d.jsxs("li",{children:[l.monthsAdded," month(s) added to month_map"]}),l.orphanedEntriesRemoved>0&&d.jsxs("li",{children:[l.orphanedEntriesRemoved," orphaned entry(ies) removed"]}),l.monthsAdded===0&&l.orphanedEntriesRemoved===0&&d.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((_,w)=>d.jsx("li",{children:_},w)),l.errors.length>3&&d.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:"Month_map issues found:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.totalMissingMonths>0&&d.jsxs("li",{children:[t.totalMissingMonths," month(s) missing from month_map"]}),t.totalOrphanedEntries>0&&d.jsxs("li",{children:[t.totalOrphanedEntries," orphaned entry(ies) in month_map"]}),t.budgetsNeedingRepair>0&&d.jsxs("li",{children:[t.budgetsNeedingRepair," budget(s) need repair"]})]}),d.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All month_map entries are up to date.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for month_map issues."});return d.jsx(Qa,{name:"Repair Month Map",description:"Updates month_map for all budgets by adding missing months and removing orphaned entries",status:p(),statusText:g(),onCheck:u,isChecking:i,onRun:h,isRunning:o,actionText:n?`Repair ${r}`:void 0,disabled:f,itemCount:n?r:void 0,details:b(),isDestructive:!0})}function n4({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,precisionCleanup:u,recalculateStartBalances:h,repairMonthMap:f}){const p=r.isScanning||i.isScanning||o.isScanning||l.isScanning||u.isScanning||h.isScanning||f.isScanning,g=i.isRunning||o.isRunning||l.isRunning||u.isRunning||h.isRunning||f.isRunning,b=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),u.scan(),h.scanStatus(),f.scanStatus()])},_=vi({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),w=vi({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),x=vi({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),S=vi({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),C=vi({migrationName:"Recalculate Start Balances Migration",isDestructive:!0,onDownloadBackup:e}),T=vi({migrationName:"Repair Month Map Migration",isDestructive:!0,onDownloadBackup:e}),I=r.hasViolations||i.hasItemsToFix||o.hasItemsToMigrate||l.hasPairsToConvert,M=(r.violationCount||0)+(i.totalOrphaned||0)+(o.totalToMigrate||0)+(l.totalPairs||0);return d.jsxs(d.Fragment,{children:[d.jsxs(a0,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:b,isValidating:p,isAnyRunning:g,children:[d.jsx(Zz,{accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,needsAction:I,totalIssues:M,isScanning:r.isScanning||i.isScanning||o.isScanning||l.isScanning,isRunning:i.isRunning||o.isRunning||l.isRunning,disabled:t,onRunOrphaned:()=>_.promptBeforeAction(i.runMigration),onRunExpense:()=>w.promptBeforeAction(o.runMigration),onRunTransfers:()=>x.promptBeforeAction(l.runMigration)}),d.jsx(Jz,{status:u.status,hasData:u.hasData,hasIssues:u.hasIssues,totalIssues:u.totalIssues,isChecking:u.isScanning,isRunning:u.isRunning,result:u.result,onCheck:u.scan,onRun:()=>S.promptBeforeAction(u.runCleanup),disabled:t}),d.jsx(e4,{status:h.status,hasData:h.hasData,needsMigration:h.needsMigration,totalItemsToFix:h.totalItemsToFix,isChecking:h.isScanning,isRunning:h.isRunning,result:h.result,onCheck:h.scanStatus,onRun:()=>C.promptBeforeAction(h.runMigration),disabled:t}),d.jsx(t4,{status:f.status,hasData:f.hasData,needsMigration:f.needsMigration,totalItemsToFix:f.totalItemsToFix,isChecking:f.isScanning,isRunning:f.isRunning,result:f.result,onCheck:f.scanStatus,onRun:()=>T.promptBeforeAction(f.runMigration),disabled:t})]}),d.jsx(bi,{..._.promptProps,isDownloading:n}),d.jsx(bi,{...w.promptProps,isDownloading:n}),d.jsx(bi,{...x.promptProps,isDownloading:n}),d.jsx(bi,{...S.promptProps,isDownloading:n}),d.jsx(bi,{...C.promptProps,isDownloading:n}),d.jsx(bi,{...T.promptProps,isDownloading:n})]})}function r4({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:i,isUploading:o,uploadStatus:l,uploadProgress:u,uploadError:h,uploadResult:f,onScan:p,onUpload:g,disabled:b}){const _=R.useRef(null),[w,x]=R.useState(null),[S,C]=R.useState(!1),T=async V=>{const j=V.target.files?.[0];j&&(x(j),await p(j))},I=l!==null,M=I&&(l.budgetsFound>0||l.monthsFound>0),F=b||t||i||o,G=f?.success?"var(--color-success)":M?"var(--color-warning)":I?"var(--color-success)":"var(--text-muted)",D=f?.success?"":o||i||t?"":M?"":I?"":"",O=f?.success?"Uploaded":o?"Uploading":i?"Scanning":t?"Downloading":M?`${l.budgetsFound} budget(s), ${l.monthsFound} month(s) ready`:I?"Nothing to upload":"Select file",P=t?e?.percentComplete:u?.percentComplete,$=n||h;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${G} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||i||t?d.jsx(Hn,{noMargin:!0}):D}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),d.jsx("div",{style:{color:G,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:O}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[d.jsx("button",{onClick:()=>{r()},disabled:F,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:F?"not-allowed":"pointer",fontSize:"0.8rem",opacity:F?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?d.jsx(Hn,{noMargin:!0}):""}),d.jsx("input",{ref:_,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),d.jsx("button",{onClick:()=>_.current?.click(),disabled:F,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:F?"not-allowed":"pointer",fontSize:"0.8rem",opacity:F?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:i?d.jsx(Hn,{noMargin:!0}):""}),M&&w&&d.jsx("button",{onClick:async()=>{await g(w)},disabled:F,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:F?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:F?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?d.jsx(Hn,{noMargin:!0}):"Upload"}),(I||f||$)&&d.jsx("button",{onClick:()=>C(!S),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:S?"Collapse":"Expand",children:S?"":""})]})]}),(t||o)&&P!==void 0&&d.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[d.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:d.jsx("div",{style:{width:`${P}%`,height:"100%",background:"var(--color-primary)",transition:"width 0.3s ease"}})}),d.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:u?.phase,": ",P,"%"]})]}),S&&(I||f||$)&&d.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[$&&d.jsxs("div",{style:{marginBottom:"0.75rem",color:"var(--color-error)"},children:[" Error: ",$]}),f&&d.jsx("div",{style:{marginBottom:l?"0.75rem":0,color:f.success?"var(--color-success)":"var(--color-error)"},children:f.success?d.jsxs(d.Fragment,{children:[" Restored ",f.budgetsRestored," budget(s), ",f.monthsRestored," month(s), ",f.payeesRestored," payee doc(s)"]}):d.jsxs(d.Fragment,{children:[" Upload failed: ",f.errors.join(", ")]})}),l&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:[d.jsx("strong",{children:"Found in zip:"})," ",l.budgetsFound," budget(s), ",l.monthsFound," month(s), ",l.payeesFound," payee doc(s)"]}),l.budgetsToRestore.length>0&&d.jsxs("div",{children:[d.jsx("strong",{children:"Budgets to restore:"})," ",l.budgetsToRestore.join(", ")]})]})]})]})}function s4({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:i,deleteResult:o,onCheck:l,onDelete:u,disabled:h}){const[f,p]=R.useState(!1),g=()=>i?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",b=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,_=()=>{p(!0)},w=()=>{p(!1),u()},x=()=>o?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[d.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&d.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((S,C)=>d.jsx("li",{children:S},C)),o.errors.length>3&&d.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?d.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-error)"},children:" DESTRUCTIVE ACTION"}),d.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),d.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return d.jsxs(d.Fragment,{children:[d.jsx(Qa,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:b(),onCheck:l,isChecking:r,onRun:e>0?_:void 0,isRunning:i,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:x(),isDestructive:!0}),d.jsxs(Ks,{isOpen:f,onClose:()=>p(!1),title:" Delete All Months?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, var(--color-error) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-error) 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:"var(--color-error-light)",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",d.jsxs("strong",{style:{color:"var(--color-error)"},children:[e," month(s)"]})," across"," ",d.jsxs("strong",{style:{color:"var(--color-error)"},children:[n," budget(s)"]}),"."]}),d.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[d.jsx("li",{children:"All account balances  $0"}),d.jsx("li",{children:"All category balances  $0"}),d.jsx("li",{children:"Month history cleared"})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),d.jsxs($e,{variant:"danger",actionName:"Confirm Delete All Months",onClick:w,children:[" Delete All ",e," Months"]})]})]})]})}function i4({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:i,isDeleting:o,deleteResult:l,onCheck:u,onDelete:h,disabled:f}){const[p,g]=R.useState(!1),b=t?.staleBudgetIds??[],_=b.length>0,w=()=>o?"running":e?l&&l.errors.length===0?"complete":n===0&&!_?"clean":"needs-action":"unknown",x=()=>l&&l.errors.length===0?`Deleted ${l.budgetsDeleted}`:n===0&&!_?"Clean":_?`${b.length} stale ref(s)`:`${n} budget(s)`,S=()=>{g(!0)},C=()=>{g(!1),h()},T=()=>l?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Deletion complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsDeleted>0&&d.jsxs("li",{children:[l.budgetsDeleted," budget(s) deleted"]}),l.monthsDeleted>0&&d.jsxs("li",{children:[l.monthsDeleted," month(s) deleted"]}),l.payeesDeleted>0&&d.jsxs("li",{children:[l.payeesDeleted," payee doc(s) deleted"]})]}),l.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((M,F)=>d.jsx("li",{children:M},F)),l.errors.length>3&&d.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n===0&&!_?d.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):_?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:" Found stale budget references:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[b.slice(0,3).map(M=>d.jsx("li",{style:{opacity:.8},children:M},M)),b.length>3&&d.jsxs("li",{style:{opacity:.6},children:["...and ",b.length-3," more"]})]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:" Sample user budget found:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[d.jsxs("li",{children:[n," budget(s)"]}),d.jsxs("li",{children:[r," month(s)"]})]}),d.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),I=n>0||_;return d.jsxs(d.Fragment,{children:[d.jsx(Qa,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:w(),statusText:x(),onCheck:u,isChecking:i,onRun:I?S:void 0,isRunning:o,actionText:"Delete",disabled:f,itemCount:I?n||b.length:void 0,details:T(),isDestructive:!0}),d.jsxs(Ks,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, var(--color-warning) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-warning) 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:"var(--color-warning-light)",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",d.jsxs("strong",{style:{color:"var(--color-warning)"},children:[n," budget(s)"]})," and"," ",d.jsxs("strong",{style:{color:"var(--color-warning)"},children:[r," month(s)"]}),"."]}),_&&d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",d.jsxs("strong",{style:{color:"var(--color-warning)"},children:[b.length," stale reference(s)"]})," from the user document."]}),d.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[d.jsx("li",{children:"Budget document deleted"}),d.jsx("li",{children:"All month documents deleted"}),d.jsx("li",{children:"Payees document deleted"}),d.jsx("li",{children:"User will see onboarding flow"})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),d.jsx($e,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:C,children:" Delete Sample User Data"})]})]})]})}function a4({onClearCache:t,disabled:e}){const[n,r]=R.useState(!1),i=()=>{r(!0)},o=()=>{r(!1),t()};return d.jsxs(d.Fragment,{children:[d.jsx(Bz,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:i,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),d.jsxs(Ks,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[d.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data and reload the page. The app will fetch fresh data from Firestore for everything."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),d.jsx($e,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function o4({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,deleteAllMonths:i,deleteSampleUserBudget:o,onClearCache:l}){const u=r.isDownloading||r.isUploading||i.isDeleting||o.isDeleting,h=vi({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),f=vi({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),p=vi({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e});return d.jsxs(d.Fragment,{children:[d.jsxs(a0,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:u,children:[d.jsx(r4,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async g=>{p.promptBeforeAction(()=>{r.uploadBudget(g).catch(b=>console.error("Upload failed:",b))})},disabled:t}),d.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[d.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),d.jsx(s4,{status:i.status,hasData:i.hasData,monthsCount:i.monthsCount,budgetCount:i.budgetCount,isChecking:i.isScanning,isDeleting:i.isDeleting,deleteResult:i.deleteResult,deleteProgress:i.deleteProgress,onCheck:i.scanStatus,onDelete:()=>h.promptBeforeAction(i.deleteAllMonths),disabled:t}),d.jsx(i4,{status:o.status,hasData:o.hasData,totalBudgets:o.totalBudgets,totalMonths:o.totalMonths,isChecking:o.isScanning,isDeleting:o.isDeleting,deleteResult:o.deleteResult,deleteProgress:o.deleteProgress,onCheck:o.scanStatus,onDelete:()=>f.promptBeforeAction(o.deleteSampleUserBudget),disabled:t}),d.jsx(a4,{onClearCache:l,disabled:t})]})]}),d.jsx(bi,{...h.promptProps,isDownloading:n}),d.jsx(bi,{...f.promptProps,isDownloading:n}),d.jsx(bi,{...p.promptProps,isDownloading:n})]})}function l4({message:t="Loading...",spinnerColor:e=ge.primary,children:n,spinnerSize:r=4}){return d.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"var(--loading-overlay-bg)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[d.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid var(--loading-overlay-content-border)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),d.jsx("p",{style:{color:"var(--loading-overlay-text)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,d.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function c4(){return d.jsxs("div",{style:Ff,children:[d.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:d.jsx(An,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:d.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),d.jsx("h1",{children:"Tarron Lane Homepage"}),d.jsx("nav",{children:d.jsxs("ul",{children:[d.jsx("li",{children:d.jsx(An,{to:"/sql-test",children:"SQL Test"})}),d.jsx("li",{children:d.jsx(An,{to:"/budget",children:"Budget"})}),d.jsx("li",{children:d.jsx(An,{to:"/account",children:"Account"})})]})})]})}function u4(){const t=R.useContext(wd),e=Ni(),[n,r]=R.useState(!1),i=er(),o=nd(),l=i.state?.from||"/";R.useEffect(()=>{t.is_logged_in&&l!=="/"&&o(l,{replace:!0})},[t.is_logged_in,l,o]);function u(){r(!0),e.logout_firebase_user().then(function(){Be.clear(),window.location.href="/"})}return d.jsxs("div",{style:Ff,children:[d.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsx(An,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),d.jsxs(An,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[d.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),d.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),d.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:d.jsx(fA,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),d.jsx("h1",{children:"Account"}),t.is_logged_in?n?d.jsx("p",{children:"Logging Out..."}):d.jsxs(d.Fragment,{children:[d.jsxs("p",{children:["You are logged in as ",t.username]}),d.jsx("button",{onClick:u,style:{marginTop:"1rem"},children:"Logout"})]}):d.jsx(d4,{})]})}function d4(){const t=Ni(),[e,n]=R.useState(""),[r,i]=R.useState(""),[o,l]=R.useState(!1),[u,h]=R.useState(!1),[f,p]=R.useState("");function g(w){n(w.target.value)}function b(w){i(w.target.value)}function _(w){w.preventDefault(),h(!0),p(""),Be.clear(),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return d.jsxs("form",{onSubmit:_,children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"username",children:"Email: "}),d.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"password",children:"Password: "}),d.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[d.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:b,style:{paddingRight:"2rem"}}),d.jsx("button",{type:"button",onClick:()=>l(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),u?d.jsx("p",{children:"Logging in..."}):d.jsx("button",{children:"Login"}),f&&d.jsx("p",{style:{color:"red"},children:f})]})}const h4={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"};function f4({activeTab:t,setActiveTab:e,lastBalancesTab:n,lastTransactionsTab:r,allocationsFinalized:i}){const o=h4[t],l=R.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),u=R.useMemo(()=>[{id:"categories",label:"Categories",checkmark:i},{id:"accounts",label:"Accounts"}],[i]),h=R.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),f=g=>{e(g==="balances"?n:r)},p=o==="balances"?u:h;return d.jsxs("div",{children:[d.jsx(qf,{mode:"button",tabs:l,activeTab:o,onTabChange:f,variant:"segmented"}),d.jsx(qf,{mode:"button",tabs:p,activeTab:t,onTabChange:g=>e(g),variant:"secondary"})]})}function YS({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:i}){const[o,l]=R.useState(!1),u=n||e,h=t==="prev"?"":"",f=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(l(!0),setTimeout(()=>l(!1),2e3)):i())};return d.jsxs("div",{style:{position:"relative"},children:[d.jsx("button",{onClick:p,onMouseEnter:()=>e&&l(!0),onMouseLeave:()=>l(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:u?"not-allowed":"pointer",fontSize:"1.25rem",opacity:u?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:f,children:h}),o&&e&&r&&d.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:ge.warning,color:"var(--color-warning-on-warning)",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px var(--shadow-overlay)"},children:r})]})}function m4({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:i,maxOrdinal:o,minAllowed:l,maxAllowed:u,monthMap:h,onYearChange:f,onMonthChange:p,onGo:g}){const b=t>l.year,_=t<u.year,w=Number(He(t,e)),x=h?He(t,e)in h:!1,S=w<=o,C=(x||S)&&w>=i;return d.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[d.jsx("button",{onClick:()=>f(t-1),disabled:!b,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:b?"pointer":"not-allowed",fontSize:"0.8rem",opacity:b?1:.3},title:b?"Previous year":"Cannot go further back",children:""}),d.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),d.jsx("button",{onClick:()=>f(t+1),disabled:!_,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:_?"pointer":"not-allowed",fontSize:"0.8rem",opacity:_?1:.3},title:_?"Next year":"Cannot go further ahead",children:""})]}),d.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:Lf.map((T,I)=>{const M=I+1,F=M===e,G=t===n&&M===r,D=Number(He(t,M)),O=He(t,M),P=D<i,$=D>o,V=D<Number(He(n,r)),j=h?O in h:!1,B=P||$||V&&!j;let k=T;return P?k="Too far in the past":$?k="Too far in the future":V&&!j&&(k="Month not in budget"),d.jsx("button",{onClick:()=>p(M),disabled:B,style:{background:F?ge.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:G?`1px solid ${ge.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:B?"not-allowed":"pointer",fontSize:"0.7rem",color:F?"var(--color-primary-on-primary)":"inherit",opacity:B?.3:1,transition:"background 0.15s"},title:k,children:T.slice(0,3)},M)})}),d.jsxs("button",{onClick:g,disabled:!C,style:{width:"100%",background:C?ge.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:C?"pointer":"not-allowed",fontSize:"0.85rem",color:C?"var(--color-primary-on-primary)":"inherit",fontWeight:500,opacity:C?1:.5},children:["Go to ",Lf[e-1]," ",t]})]})}function p4({isOpen:t,onClose:e,year:n,month:r,isDeleting:i,onConfirm:o}){return d.jsxs(Ks,{isOpen:t,onClose:e,title:" Delete Month?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, var(--color-error) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-error) 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsxs("p",{style:{margin:0,color:"var(--color-error-light)",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",Lf[r-1]," ",n,"!"]})}),d.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),d.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:i,children:"Cancel"}),d.jsx($e,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:i,children:i?"Deleting...":" Delete Month"})]})]})}function g4(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Ws;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function y4(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-H_;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function _4(t){return Object.keys(t).sort()[0]}function b4(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function v4(t){const e=_4(t);return e?b4(e):y4()}function XS(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function x4(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function w4({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=Rn(),{currentYear:r,currentMonthNumber:i,isAdmin:o,selectedBudgetId:l,setCurrentYear:u,setCurrentMonthNumber:h}=Xe(),{budget:f,monthMap:p}=In(),{month:g}=Xs(l,r,i),b=XS(r,i),_=x4(r,i),w=g4(),x=Number(He(w.year,w.month)),C=Number(He(_.year,_.month))>x,T=He(b.year,b.month),I=p?T in p:!1,M=!I,F=v4(p||{}),G=Number(He(F.year,F.month)),[D,O]=R.useState(!1),[P,$]=R.useState(!1),[V,j]=R.useState(r),[B,k]=R.useState(i),[Y,X]=R.useState(!1),[W,te]=R.useState(!1),H=R.useRef(null),re=(()=>{if(!p||Object.keys(p).length===0)return!1;const ae=He(r,i),Ee=Math.max(...Object.keys(p).map(Number));return Number(ae)===Ee})();async function N(){if(l){te(!0);try{const ae=Qs(l,r,i);_P(l,r,i),await Ly("months",ae,`deleting month ${r}/${i}`),`${r}${i}`,Be.removeQueries({queryKey:we.month(l,r,i)});const Ee=XS(r,i);X(!1),O(!1),window.location.href=`/budget/${Ee.year}/${Ee.month}/categories`}catch(ae){console.error("Failed to delete month:",ae),alert(`Failed to delete month: ${ae instanceof Error?ae.message:"Unknown error"}`)}finally{te(!1)}}}R.useEffect(()=>{if(!D)return;function ae(Ee){H.current&&!H.current.contains(Ee.target)&&(O(!1),$(!1))}return document.addEventListener("mousedown",ae),()=>document.removeEventListener("mousedown",ae)},[D]);function q(){P||(j(r),k(i)),$(!P)}function J(){u(V),h(B),$(!1),O(!1)}async function ne(){if(!g||!f)return;const ae=new Date,Ae=`${ae.toISOString().split("T")[0]}_month_${r}_${String(i).padStart(2,"0")}`,ce=new Im,fe=[{name:`${Ae}_income.json`,data:g.income||[]},{name:`${Ae}_expenses.json`,data:g.expenses||[]},{name:`${Ae}_transfers.json`,data:g.transfers||[]},{name:`${Ae}_adjustments.json`,data:g.adjustments||[]},{name:`${Ae}_account_balances.json`,data:g.account_balances||[]},{name:`${Ae}_category_balances.json`,data:g.category_balances||[]}],Oe={budget_id:f.id,budget_name:f.name,year_month_ordinal:g.year_month_ordinal,year:g.year,month:g.month,total_income:g.total_income,previous_month_income:g.previous_month_income,total_expenses:g.total_expenses,are_allocations_finalized:g.are_allocations_finalized,created_at:g.created_at,updated_at:g.updated_at,downloaded_at:ae.toISOString()};fe.push({name:`${Ae}_metadata.json`,data:Oe});for(const L of fe)ce.file(L.name,JSON.stringify(L.data,null,2));const Me=await ce.generateAsync({type:"blob"}),Ge=URL.createObjectURL(Me),tt=document.createElement("a");tt.href=Ge,tt.download=`${Ae}.zip`,document.body.appendChild(tt),tt.click(),document.body.removeChild(tt),URL.revokeObjectURL(Ge),O(!1)}return d.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[d.jsx(YS,{direction:"prev",isDisabled:M,isLoading:n,disabledReason:I?void 0:"No previous month available in this budget",onNavigate:t}),d.jsxs("div",{ref:H,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[d.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[Lf[i-1]," ",r]}),d.jsx("button",{onClick:()=>O(!D),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:D?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&d.jsxs(d.Fragment,{children:[d.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),d.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[d.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:ge.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),d.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),D&&d.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--sticky-header-bg)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px var(--shadow-overlay)"},children:[d.jsx("button",{onClick:q,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),P&&d.jsx(m4,{pickerYear:V,pickerMonth:B,currentYear:r,currentMonthNumber:i,minOrdinal:G,maxOrdinal:x,minAllowed:F,maxAllowed:w,monthMap:p,onYearChange:j,onMonthChange:k,onGo:J}),o&&g&&d.jsx("button",{onClick:()=>{ne()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&g&&re&&d.jsx("button",{onClick:()=>X(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"var(--color-error)",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),d.jsx(YS,{direction:"next",isDisabled:C,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),d.jsx(p4,{isOpen:Y,onClose:()=>X(!1),year:r,month:i,isDeleting:W,onConfirm:N})]})}const o0={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},S4={...o0,background:ge.primary,border:"none",color:"white"},E4={...o0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},C4={...o0,background:"transparent",border:`1px solid ${ge.errorBorder}`,color:ge.error},ZS=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${ge.error} 15%, transparent)`:`color-mix(in srgb, ${ge.success} 15%, transparent)`,border:`1px solid ${t?ge.errorBorder:"var(--color-success-border)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?ge.error:ge.success,transition:"all 0.15s ease",flexShrink:0});function l0({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:u,config:h,onSubmit:f,onCancel:p,onDelete:g,extraContent:b}){const{isWide:_}=YT(),{showCategory:w=!1,showCleared:x=!1,showSignToggle:S=!1,accountLabel:C="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:I="Optional note",submitLabel:M}=h,F=new Date().toISOString().split("T")[0],[G,D]=R.useState(o?.date||u||F),[O,P]=R.useState(o?.payee||""),[$,V]=R.useState(o?.categoryId||(h.showNoCategoryOption?Xt:"")),[j,B]=R.useState(o?.accountId||l||(h.showNoAccountOption?Gt:t[0]?t[0][0]:"")),k=o?.amount!==void 0?Math.abs(o.amount):void 0,[Y,X]=R.useState(k?.toString()||""),[W,te]=R.useState(o?.description||""),[H,re]=R.useState(o?.cleared||!1),[N,q]=R.useState(()=>S?o?.amount!==void 0?o.amount<0:!1:!0),[J,ne]=R.useState(!1),ae={},Ee=[];t.forEach(([xe,ie])=>{ie.account_group_id?(ae[ie.account_group_id]||(ae[ie.account_group_id]=[]),ae[ie.account_group_id].push([xe,ie])):Ee.push([xe,ie])});function Ae(xe){xe.preventDefault();const ie=parseFloat(Y);if(isNaN(ie)||ie<=0||w&&!$||!j||!G)return;if($===Xt&&j===Gt){ne(!0);return}ne(!1);const Ne=S&&N?-ie:ie;f({date:G,payee:O.trim()||void 0,categoryId:w?$:void 0,accountId:j,amount:Ne,description:W.trim()||void 0,cleared:x?H:void 0})}!($===Xt&&j===Gt)&&J&&ne(!1);const Me=h.showNoAccountOption?d.jsx(KT,{id:"txn-account",value:j,onChange:B,accounts:t,accountGroups:e,placeholder:La,required:!0,showNoAccountOption:!0}):d.jsxs(Zu,{id:"txn-account",value:j,onChange:xe=>B(xe.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([xe,ie])=>{const Re=ae[xe];return Re?.length?d.jsx("optgroup",{label:ie.name,children:Re.map(([Pe,Ne])=>d.jsx("option",{value:Pe,children:Ne.nickname},Pe))},xe):null}),Ee.length>0&&d.jsx("optgroup",{label:"Other",children:Ee.map(([xe,ie])=>d.jsx("option",{value:xe,children:ie.nickname},xe))})]}),Ge=w&&n&&r?d.jsx(Bt,{label:"Category",htmlFor:"txn-category",children:d.jsx(QT,{id:"txn-category",value:$,onChange:V,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?Lo:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,tt=x?d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[d.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),d.jsx(Qr,{id:"txn-cleared",checked:H,onChange:xe=>re(xe.target.checked)})]}):null,L=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),d.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[d.jsx("button",{type:"submit",title:M,style:S4,children:""}),d.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:E4,children:""}),g&&d.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:C4,children:""})]})]}),de=J?d.jsx("div",{style:{background:`color-mix(in srgb, ${ge.error} 15%, transparent)`,border:`1px solid ${ge.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ge.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,ye=d.jsxs(Ga,{children:[d.jsx($e,{type:"submit",actionName:M,children:M}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&d.jsx($e,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),ee=w&&n&&r,Z={fontSize:"0.85rem",padding:"0.5rem"};if(!_)return d.jsxs(ki,{actionName:M,onSubmit:Ae,children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[d.jsx(Bt,{label:"Date",htmlFor:"txn-date",children:d.jsx($f,{id:"txn-date",value:G,onChange:xe=>D(xe.target.value),required:!0,autoFocus:!0})}),d.jsx(Bt,{label:S?N?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:S?d.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[d.jsx("button",{type:"button",onClick:()=>q(!N),style:ZS(N),title:N?"Click to make this a refund (+)":"Click to make this an expense (-)",children:N?"":"+"}),d.jsx("div",{style:{flex:1},children:d.jsx(Io,{id:"txn-amount",value:Y,onChange:X,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:N?ge.error:ge.success}})})]}):d.jsx(Io,{id:"txn-amount",value:Y,onChange:X,placeholder:"$0.00",required:!0})})]}),d.jsx(Bt,{label:"Payee",htmlFor:"txn-payee",children:d.jsx(US,{id:"txn-payee",value:O,onChange:P,payees:i,placeholder:T})}),Ge,d.jsx(Bt,{label:C,htmlFor:"txn-account",children:Me}),d.jsx(Bt,{label:"Description (optional)",htmlFor:"txn-description",children:d.jsx(Mi,{id:"txn-description",value:W,onChange:xe=>te(xe.target.value),placeholder:I})}),x&&d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx(Qr,{id:"txn-cleared-stacked",checked:H,onChange:xe=>re(xe.target.checked)}),d.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),de,b]}),ye]});const oe=S?"8.25rem":"6rem",Se=ee?x?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto`:x?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto`;return d.jsxs(ki,{actionName:M,onSubmit:Ae,children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:Se,gap:"1rem",alignItems:"end"},children:[d.jsx(Bt,{label:"Date",htmlFor:"txn-date",children:d.jsx($f,{id:"txn-date",value:G,onChange:xe=>D(xe.target.value),required:!0,style:Z,autoFocus:!0})}),d.jsx(Bt,{label:"Payee",htmlFor:"txn-payee",children:d.jsx(US,{id:"txn-payee",value:O,onChange:P,payees:i,placeholder:T})}),Ge,d.jsx(Bt,{label:C,htmlFor:"txn-account",children:Me}),d.jsx(Bt,{label:S?N?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:S?d.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[d.jsx("button",{type:"button",onClick:()=>q(!N),style:ZS(N),title:N?"Click to make this a refund (+)":"Click to make this an expense (-)",children:N?"":"+"}),d.jsx("div",{style:{flex:1},children:d.jsx(Io,{id:"txn-amount",value:Y,onChange:X,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:N?ge.error:ge.success}})})]}):d.jsx(Io,{id:"txn-amount",value:Y,onChange:X,placeholder:"$0.00",required:!0})}),d.jsx(Bt,{label:"Description",htmlFor:"txn-description",children:d.jsx(Mi,{id:"txn-description",value:W,onChange:xe=>te(xe.target.value),placeholder:I,style:Z})}),tt,L]}),de,b]})}function JS({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:i,defaultDate:o,onSubmit:l,onCancel:u,onDelete:h,submitLabel:f}){function p(g){l(g.amount,g.accountId,g.date,g.payee,g.description)}return d.jsx(l0,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:i,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:f},onSubmit:p,onCancel:u,onDelete:h})}function T4({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:i,isMobile:o,isEvenRow:l}){const u=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,f=l?"transparent":"var(--row-alt-bg)";if(o)return d.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:f,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:u}),d.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),d.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsxs("span",{style:{fontWeight:600,color:ge.success,fontFamily:"monospace"},children:["+",Zt(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:f,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:u})}),d.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),d.jsx("div",{style:{...p,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),d.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:ge.success,fontFamily:"monospace"},children:["+",Zt(t.amount)]}),d.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const zl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function A4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l}=In(),{month:u,isLoading:h}=Xs(t,e,n),{addIncome:f}=cz(),{updateIncome:p}=dz(),{deleteIncome:g}=hz(),b=Pi(),[_,w]=R.useState(null),[x,S]=R.useState(!1),[C,T]=R.useState(null),F=W_(t,{enabled:x||C!==null}).data||[];function G(W){const te=W.account_group_id?l[W.account_group_id]:void 0;return te&&te.is_active!==null?te.is_active:W.is_active!==!1}function D(W){const te=W.account_group_id?l[W.account_group_id]:void 0;return te&&te.on_budget!==null?te.on_budget:W.on_budget!==!1}const O=Object.entries(o).filter(([,W])=>G(W)&&D(W)),P=O.filter(([,W])=>W.is_income_account),$=P.length>0?P:O,V=O.find(([,W])=>W.is_income_default),j=V?V[0]:void 0,B=u?.income.reduce((W,te)=>W+te.amount,0)||0;function k(W,te,H,re,N){if(!t)return;w(null),S(!1);const{year:q,month:J}=wm(H);(q!==e||J!==n)&&(r(q),i(J)),f(t,q,J,W,te,H,re,N).catch(ne=>{w(ne instanceof Error?ne.message:"Failed to add income")})}function Y(W,te,H,re,N,q){t&&(w(null),T(null),p(t,e,n,W,te,H,re,N,q).catch(J=>{w(J instanceof Error?J.message:"Failed to update income")}))}function X(W){t&&confirm("Are you sure you want to delete this income entry?")&&(w(null),g(t,e,n,W).catch(te=>{w(te instanceof Error?te.message:"Failed to delete income")}))}return d.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[_&&d.jsx("div",{style:{background:`color-mix(in srgb, ${ge.error} 15%, transparent)`,border:`1px solid ${ge.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ge.error},children:_}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:b?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:b?"block":"grid",gridTemplateColumns:b?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Income:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:ct(B),fontWeight:600},children:Zt(B)})]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!x&&d.jsx($e,{actionName:"Open Add Income Form",onClick:()=>S(!0),disabled:$.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!b&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:zl,children:"Date"}),d.jsx("div",{style:zl,children:"Payee"}),d.jsx("div",{style:zl,children:"Account"}),d.jsx("div",{style:{...zl,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:zl,children:"Description"}),d.jsx("div",{style:zl})]})]}),d.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),$.length===0&&d.jsx(ed,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),x&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(JS,{accounts:$,accountGroups:l,payees:F,defaultAccountId:j,defaultDate:xm(e,n),onSubmit:k,onCancel:()=>S(!1),submitLabel:"Add Income",isMobile:b})}),u?.income.slice().sort((W,te)=>(W.date||"").localeCompare(te.date||"")).map((W,te)=>C===W.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(JS,{accounts:$,accountGroups:l,payees:F,initialData:W,onSubmit:(H,re,N,q,J)=>Y(W.id,H,re,N,q,J),onCancel:()=>T(null),onDelete:()=>X(W.id),submitLabel:"Save",isMobile:b})},W.id):d.jsx(T4,{income:W,accountName:Ye(W.account_id)?La:o[W.account_id]?.nickname||"Unknown Account",accountGroupName:Ye(W.account_id)?void 0:o[W.account_id]?.account_group_id?l[o[W.account_id].account_group_id]?.name:void 0,onEdit:()=>{W.payee||`${W.amount}`,T(W.id)},onDelete:()=>X(W.id),isMobile:b,isEvenRow:te%2===0},W.id)),(!u?.income||u.income.length===0)&&!x&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function e1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:u,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function b(_){h(_.amount,_.categoryId,_.accountId,_.date,_.payee,_.description,_.cleared)}return d.jsx(l0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:u,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:b,onCancel:f,onDelete:p})}function j4({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:u}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=u?"transparent":"var(--row-alt-bg)";if(l)return d.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),d.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:ge.success},title:"Cleared",children:""})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),d.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",f]})]})]}),d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsx("span",{style:{fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Lt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:h})}),d.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),d.jsx("div",{style:{...g,justifyContent:"center"},children:d.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...g,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),d.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Lt(t.amount)}),d.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?ge.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const ga={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function R4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l,categories:u,categoryGroups:h}=In(),{month:f,isLoading:p}=Xs(t,e,n),{addExpense:g}=mz(),{updateExpense:b}=gz(),{deleteExpense:_}=yz(),w=Pi(),[x,S]=R.useState(null),[C,T]=R.useState(!1),[I,M]=R.useState(null),D=W_(t,{enabled:C||I!==null}).data||[];function O(H){const re=H.account_group_id?l[H.account_group_id]:void 0;return re&&re.is_active!==null?re.is_active:H.is_active!==!1}function P(H){const re=H.account_group_id?l[H.account_group_id]:void 0;return re&&re.on_budget!==null?re.on_budget:H.on_budget!==!1}const $=Object.entries(o).filter(([,H])=>O(H)&&P(H)),V=$.filter(([,H])=>H.is_outgo_account),j=V.length>0?V:$,B=$.find(([,H])=>H.is_outgo_default),k=B?B[0]:void 0,Y=f?.expenses?.reduce((H,re)=>H+re.amount,0)||0;function X(H,re,N,q,J,ne,ae){if(!t)return;S(null),T(!1);const{year:Ee,month:Ae}=wm(q);(Ee!==e||Ae!==n)&&(r(Ee),i(Ae)),g(t,Ee,Ae,H,re,N,q,J,ne,ae).catch(ce=>{S(ce instanceof Error?ce.message:"Failed to add expense")})}function W(H,re,N,q,J,ne,ae,Ee){t&&(S(null),M(null),b(t,e,n,H,re,N,q,J,ne,ae,Ee).catch(Ae=>{S(Ae instanceof Error?Ae.message:"Failed to update expense")}))}function te(H){t&&confirm("Are you sure you want to delete this expense?")&&(S(null),_(t,e,n,H).catch(re=>{S(re instanceof Error?re.message:"Failed to delete expense")}))}return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&d.jsx("div",{style:{background:`color-mix(in srgb, ${ge.error} 15%, transparent)`,border:`1px solid ${ge.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ge.error},children:x}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:w?"block":"grid",gridTemplateColumns:w?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:ct(Y),fontWeight:600},children:Lt(Y)})]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&d.jsx($e,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:j.length===0||Object.keys(u).length===0,disabledReason:j.length===0&&Object.keys(u).length===0?"Create accounts and categories first":j.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!w&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:ga,children:"Date"}),d.jsx("div",{style:ga,children:"Payee"}),d.jsx("div",{style:{...ga,textAlign:"center"},children:"Category"}),d.jsx("div",{style:ga,children:"Account"}),d.jsx("div",{style:{...ga,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:ga,children:"Description"}),d.jsx("div",{style:{...ga,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:ga})]})]}),j.length===0&&d.jsx(ed,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(u).length===0&&d.jsx(ed,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),C&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(e1,{accounts:j,accountGroups:l,categories:u,categoryGroups:h,payees:D,defaultAccountId:k,defaultDate:xm(e,n),onSubmit:X,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:w})}),f?.expenses?.slice().sort((H,re)=>(H.date||"").localeCompare(re.date||"")).map((H,re)=>I===H.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(e1,{accounts:j,accountGroups:l,categories:u,categoryGroups:h,payees:D,initialData:H,onSubmit:(N,q,J,ne,ae,Ee,Ae)=>W(H.id,N,q,J,ne,ae,Ee,Ae),onCancel:()=>M(null),onDelete:()=>te(H.id),submitLabel:"Save",isMobile:w})},H.id):d.jsx(j4,{expense:H,categoryName:lt(H.category_id)?Lo:u[H.category_id]?.name||"Unknown Category",accountName:Ye(H.account_id)?La:o[H.account_id]?.nickname||"Unknown Account",accountGroupName:Ye(H.account_id)?void 0:o[H.account_id]?.account_group_id?l[o[H.account_id].account_group_id]?.name:void 0,onEdit:()=>{H.payee||`${H.amount}`,M(H.id)},onDelete:()=>te(H.id),isMobile:w,isEvenRow:re%2===0},H.id)),(!f?.expenses||f.expenses.length===0)&&!C&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const I4={background:ge.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},D4={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},k4={background:"transparent",border:`1px solid ${ge.errorBorder}`,color:ge.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function t1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:i,defaultDate:o,onSubmit:l,onCancel:u,onDelete:h,submitLabel:f}){const{isWide:p}=YT(),g=new Date().toISOString().split("T")[0],[b,_]=R.useState(i?.date||o||g),[w,x]=R.useState(i?.amount?.toString()||""),[S,C]=R.useState(i?.from_account_id||Gt),[T,I]=R.useState(i?.to_account_id||Gt),[M,F]=R.useState(i?.from_category_id||Xt),[G,D]=R.useState(i?.to_category_id||Xt),[O,P]=R.useState(i?.description||""),[$,V]=R.useState(i?.cleared||!1),[j,B]=R.useState(null),k=M===Xt,Y=G===Xt,X=S===Gt,W=T===Gt;function te(){return k&&Y&&(X&&W)?'A transfer must move between real categories or real accounts  not all "No" options.':X!==W?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':k!==Y?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}te()===null&&j!==null&&B(null);function re(ce){ce.preventDefault();const fe=parseFloat(w);if(isNaN(fe)||fe<=0||!S||!T||!M||!G||!b)return;const Oe=te();if(Oe){B(Oe);return}B(null),l(fe,S,T,M,G,b,O.trim()||void 0,$)}const N=j?d.jsx("div",{style:{background:`color-mix(in srgb, ${ge.error} 15%, transparent)`,border:`1px solid ${ge.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ge.error,marginTop:"0.5rem"},children:j}):null,q=(ce,fe,Oe,Me)=>d.jsx(Bt,{label:Me,htmlFor:ce,children:d.jsx(KT,{id:ce,value:fe,onChange:Oe,accounts:t,accountGroups:e,placeholder:La,required:!0,showNoAccountOption:!0})}),J=(ce,fe,Oe,Me)=>d.jsx(Bt,{label:Me,htmlFor:ce,children:d.jsx(QT,{id:ce,value:fe,onChange:Oe,categories:n,categoryGroups:r,placeholder:Lo,required:!0,showNoCategoryOption:!0})}),ne=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[d.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),d.jsx(Qr,{id:"transfer-cleared",checked:$,onChange:ce=>V(ce.target.checked)})]}),ae=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),d.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[d.jsx("button",{type:"submit",title:f,style:I4,children:""}),d.jsx("button",{type:"button",onClick:()=>{u()},title:"Cancel",style:D4,children:""}),h&&d.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:k4,children:""})]})]}),Ee=d.jsxs(Ga,{children:[d.jsx($e,{type:"submit",actionName:f,children:f}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:u,children:"Cancel"}),h&&d.jsx($e,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),Ae={fontSize:"0.85rem",padding:"0.5rem"};return p?d.jsx(ki,{actionName:f,onSubmit:re,children:d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[d.jsx(Bt,{label:"Date",htmlFor:"transfer-date",children:d.jsx($f,{id:"transfer-date",value:b,onChange:ce=>_(ce.target.value),required:!0,style:Ae,autoFocus:!0})}),d.jsx(Bt,{label:"Amount",htmlFor:"transfer-amount",children:d.jsx(Io,{id:"transfer-amount",value:w,onChange:x,placeholder:"$0.00",required:!0})}),J("from-category",M,F,"From Category"),q("from-account",S,C,"From Account"),d.jsx(Bt,{label:"Description",htmlFor:"transfer-description",children:d.jsx(Mi,{id:"transfer-description",value:O,onChange:ce=>P(ce.target.value),placeholder:"e.g., Transfer",style:Ae})})]}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),d.jsx("div",{}),J("to-category",G,D,"To Category"),q("to-account",T,I,"To Account"),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[ne,ae]})]}),N]})}):d.jsxs(ki,{actionName:f,onSubmit:re,children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[d.jsx(Bt,{label:"Date",htmlFor:"transfer-date",children:d.jsx($f,{id:"transfer-date",value:b,onChange:ce=>_(ce.target.value),required:!0,autoFocus:!0})}),d.jsx(Bt,{label:"Amount",htmlFor:"transfer-amount",children:d.jsx(Io,{id:"transfer-amount",value:w,onChange:x,placeholder:"$0.00",required:!0})})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[J("from-category",M,F,"From Cat."),q("from-account",S,C,"From Acct.")]}),d.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[J("to-category",G,D,"To Cat."),q("to-account",T,I,"To Acct.")]})]}),d.jsx(Bt,{label:"Description (optional)",htmlFor:"transfer-description",children:d.jsx(Mi,{id:"transfer-description",value:O,onChange:ce=>P(ce.target.value),placeholder:"e.g., Transfer to savings"})}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx(Qr,{id:"transfer-cleared-stacked",checked:$,onChange:ce=>V(ce.target.checked)}),d.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),N]}),Ee]})}function M4({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:i,fromAccountGroupName:o,toAccountGroupName:l,isFromCategoryNo:u,isToCategoryNo:h,isFromAccountNo:f,isToAccountNo:p,onEdit:g,onDelete:b,isMobile:_,isEvenRow:w}){const x=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",S=w?"transparent":"var(--row-alt-bg)";if(_)return d.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:S,cursor:"pointer",transition:"background 0.15s"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:x}),d.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Zt(t.amount)}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:ge.success},title:"Cleared",children:""})]})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx("span",{style:u?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),f?d.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):d.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&d.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),d.jsx("span",{children:r})]})]}),d.jsx("span",{style:{opacity:.5},children:""}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?d.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:i}):d.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[l&&d.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:l}),d.jsx("span",{children:i})]})]})]}),t.description&&d.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const C={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[d.jsx("div",{style:{...C,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:x})}),d.jsx("div",{style:{...C,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Zt(t.amount)}),d.jsx("div",{style:{...C,justifyContent:"center"},children:d.jsx("span",{style:u?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...C,overflow:"hidden"},children:f?d.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&d.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),d.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),d.jsx("div",{style:{...C,justifyContent:"center",fontSize:"1rem"},children:d.jsx("span",{style:{opacity:.5},children:""})}),d.jsx("div",{style:{...C,justifyContent:"center"},children:d.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),d.jsx("div",{style:{...C,overflow:"hidden"},children:p?d.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:i}):d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[l&&d.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),d.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i})]})}),d.jsx("div",{style:{...C,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsx("div",{style:{...C,justifyContent:"center",color:t.cleared?ge.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...C,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:b,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const zs={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function O4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l,categories:u,categoryGroups:h}=In(),{month:f,isLoading:p}=Xs(t,e,n),{addTransfer:g}=bz(),{updateTransfer:b}=xz(),{deleteTransfer:_}=wz(),w=Pi(),[x,S]=R.useState(null),[C,T]=R.useState(!1),[I,M]=R.useState(null);function F(j){const B=j.account_group_id?l[j.account_group_id]:void 0;return B&&B.is_active!==null?B.is_active:j.is_active!==!1}function G(j){const B=j.account_group_id?l[j.account_group_id]:void 0;return B&&B.on_budget!==null?B.on_budget:j.on_budget!==!1}const D=Object.entries(o).filter(([,j])=>F(j)&&G(j));function O(j,B,k,Y,X,W,te,H){if(!t)return;S(null),T(!1);const{year:re,month:N}=wm(W);(re!==e||N!==n)&&(r(re),i(N)),g(t,re,N,j,B,k,Y,X,W,te,H).catch(q=>{S(q instanceof Error?q.message:"Failed to add transfer")})}function P(j,B,k,Y,X,W,te,H,re){t&&(S(null),M(null),b(t,e,n,j,B,k,Y,X,W,te,H,re).catch(N=>{S(N instanceof Error?N.message:"Failed to update transfer")}))}function $(j){t&&confirm("Are you sure you want to delete this transfer?")&&(S(null),_(t,e,n,j).catch(B=>{S(B instanceof Error?B.message:"Failed to delete transfer")}))}const V=D.length>=1&&Object.keys(u).length>=1;return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&d.jsx("div",{style:{background:`color-mix(in srgb, ${ge.error} 15%, transparent)`,border:`1px solid ${ge.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ge.error},children:x}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:w?"block":"grid",gridTemplateColumns:w?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&d.jsx($e,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!V,disabledReason:D.length===0&&Object.keys(u).length===0?"Create accounts and categories first":D.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!w&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:zs,children:"Date"}),d.jsx("div",{style:{...zs,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:{...zs,textAlign:"center"},children:"From Cat"}),d.jsx("div",{style:zs,children:"From Acct"}),d.jsx("div",{style:zs}),d.jsx("div",{style:{...zs,textAlign:"center"},children:"To Cat"}),d.jsx("div",{style:zs,children:"To Acct"}),d.jsx("div",{style:zs,children:"Description"}),d.jsx("div",{style:{...zs,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:zs})]})]}),!V&&d.jsx(ed,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(t1,{accounts:D,accountGroups:l,categories:u,categoryGroups:h,defaultDate:xm(e,n),onSubmit:O,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),f?.transfers?.slice().sort((j,B)=>(j.date||"").localeCompare(B.date||"")).map((j,B)=>I===j.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(t1,{accounts:D,accountGroups:l,categories:u,categoryGroups:h,initialData:j,onSubmit:(k,Y,X,W,te,H,re,N)=>P(j.id,k,Y,X,W,te,H,re,N),onCancel:()=>M(null),onDelete:()=>$(j.id),submitLabel:"Save"})},j.id):d.jsx(M4,{transfer:j,fromCategoryName:lt(j.from_category_id)?Lo:u[j.from_category_id]?.name||"Unknown",toCategoryName:lt(j.to_category_id)?Lo:u[j.to_category_id]?.name||"Unknown",fromAccountName:Ye(j.from_account_id)?La:o[j.from_account_id]?.nickname||"Unknown",toAccountName:Ye(j.to_account_id)?La:o[j.to_account_id]?.nickname||"Unknown",fromAccountGroupName:Ye(j.from_account_id)?void 0:o[j.from_account_id]?.account_group_id?l[o[j.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:Ye(j.to_account_id)?void 0:o[j.to_account_id]?.account_group_id?l[o[j.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:lt(j.from_category_id),isToCategoryNo:lt(j.to_category_id),isFromAccountNo:Ye(j.from_account_id),isToAccountNo:Ye(j.to_account_id),onEdit:()=>{j.description||`${j.amount}`,M(j.id)},onDelete:()=>$(j.id),isMobile:w,isEvenRow:B%2===0},j.id)),(!f?.transfers||f.transfers.length===0)&&!C&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function n1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:u,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function b(_){h(_.amount,_.accountId,_.categoryId,_.date,_.payee,_.description,_.cleared)}return d.jsx(l0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:u,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:b,onCancel:f,onDelete:p})}function N4({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:u}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=u?"transparent":"var(--row-alt-bg)";if(l)return d.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:ge.success},title:"Cleared",children:""})]}),d.jsx("span",{style:{fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Lt(t.amount)})]}),d.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[d.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),d.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:f})]})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:h})}),d.jsx("div",{style:{...g,justifyContent:"center"},children:d.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...g,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),d.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:Lt(t.amount)}),d.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?ge.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Co={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function P4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Xe(),{accounts:o,accountGroups:l,categories:u,categoryGroups:h}=In(),{month:f,isLoading:p}=Xs(t,e,n),{addAdjustment:g}=Ez(),{updateAdjustment:b}=Tz(),{deleteAdjustment:_}=Az(),w=Pi(),[x,S]=R.useState(null),[C,T]=R.useState(!1),[I,M]=R.useState(null),D=W_(t,{enabled:C||I!==null}).data||[];function O(k){const Y=k.account_group_id?l[k.account_group_id]:void 0;return Y&&Y.is_active!==null?Y.is_active:k.is_active!==!1}function P(k){const Y=k.account_group_id?l[k.account_group_id]:void 0;return Y&&Y.on_budget!==null?Y.on_budget:k.on_budget!==!1}const $=Object.entries(o).filter(([,k])=>O(k)&&P(k));function V(k,Y,X,W,te,H,re){if(!t)return;S(null),T(!1);const{year:N,month:q}=wm(W);(N!==e||q!==n)&&(r(N),i(q)),g(t,N,q,k,Y,X,W,te,H,re).catch(J=>{S(J instanceof Error?J.message:"Failed to add adjustment")})}function j(k,Y,X,W,te,H,re,N){t&&(S(null),M(null),b(t,e,n,k,Y,X,W,te,H,re,N).catch(q=>{S(q instanceof Error?q.message:"Failed to update adjustment")}))}function B(k){t&&confirm("Are you sure you want to delete this adjustment?")&&(S(null),_(t,e,n,k).catch(Y=>{S(Y instanceof Error?Y.message:"Failed to delete adjustment")}))}return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&d.jsx("div",{style:{background:`color-mix(in srgb, ${ge.error} 15%, transparent)`,border:`1px solid ${ge.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ge.error},children:x}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:w?"block":"grid",gridTemplateColumns:w?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&d.jsx($e,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(u).length===0&&$.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!w&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Co,children:"Date"}),d.jsx("div",{style:{...Co,textAlign:"center"},children:"Category"}),d.jsx("div",{style:Co,children:"Account"}),d.jsx("div",{style:{...Co,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:Co,children:"Description"}),d.jsx("div",{style:{...Co,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:Co})]})]}),$.length===0&&Object.keys(u).length===0&&d.jsx(ed,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(n1,{accounts:$,accountGroups:l,categories:u,categoryGroups:h,payees:D,defaultDate:xm(e,n),onSubmit:V,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),f?.adjustments?.slice().sort((k,Y)=>(k.date||"").localeCompare(Y.date||"")).map((k,Y)=>I===k.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(n1,{accounts:$,accountGroups:l,categories:u,categoryGroups:h,payees:D,initialData:k,onSubmit:(X,W,te,H,re,N,q)=>j(k.id,X,W,te,H,re,N,q),onCancel:()=>M(null),onDelete:()=>B(k.id),submitLabel:"Save"})},k.id):d.jsx(N4,{adjustment:k,categoryName:lt(k.category_id)?Lo:u[k.category_id]?.name||"Unknown Category",accountName:Ye(k.account_id)?La:o[k.account_id]?.nickname||"Unknown Account",accountGroupName:Ye(k.account_id)?void 0:o[k.account_id]?.account_group_id?l[o[k.account_id].account_group_id]?.name:void 0,onEdit:()=>{k.description||`${k.amount}`,M(k.id)},onDelete:()=>B(k.id),isMobile:w,isEvenRow:Y%2===0},k.id)),(!f?.adjustments||f.adjustments.length===0)&&!C&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function B4({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:i}=Rn(),{selectedBudgetId:o,currentYear:l,currentMonthNumber:u}=Xe(),{deleteAllocations:h}=pA(),[f,p]=R.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:l,month:u}),e(),n?.()}catch(b){p(b instanceof Error?b.message:"Failed to delete allocations")}finally{i("allocations-delete")}}};return d.jsxs(Ks,{isOpen:t,onClose:e,title:"Delete Allocations",children:[f&&d.jsx(J_,{message:f,onDismiss:()=>p(null)}),d.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),d.jsx($e,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function vA({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:i,draftChangeAmount:o,availableAfterApply:l,currentDraftTotal:u}){const h=t&&u!==void 0?u:i.allocated;return d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?d.jsx("span",{style:{color:ct(n),fontWeight:600},children:Vn(n)}):d.jsx("span",{style:{color:ge.success,fontWeight:600},children:Vn(r)})]}),d.jsxs("span",{children:[t&&d.jsx("span",{style:{opacity:.6},children:" "}),d.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),d.jsx("span",{style:{color:Cc(t?h:i.allocated),fontWeight:600,...t?hs:{}},children:Vn(t?h:i.allocated)}),e&&o!==0&&d.jsxs("span",{style:{fontSize:"0.85em",color:o>0?ge.warning:ge.success,marginLeft:"0.25rem"},children:["(",Lt(o),")"]})]}),!t&&d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Spent: "}),d.jsx("span",{style:{color:Ec(i.spent),fontWeight:600},children:Vn(i.spent)})]}),d.jsxs("span",{children:[t&&d.jsx("span",{style:{opacity:.6},children:"= "}),d.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?d.jsx("span",{style:{color:ct(l),fontWeight:600,...hs},children:Vn(l)}):d.jsx("span",{style:{color:ct(i.allocated+i.spent),fontWeight:600},children:Vn(i.allocated+i.spent)})]})]})}function z4({totals:t}){return d.jsxs(d.Fragment,{children:[d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Start: "}),d.jsx("span",{style:{color:ct(t.start),fontWeight:600},children:Vn(t.start)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Inc: "}),d.jsx("span",{style:{color:ge.success,fontWeight:600},children:Vn(t.income)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Exp: "}),d.jsx("span",{style:{color:Ec(t.expenses),fontWeight:600},children:Vn(t.expenses)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"End: "}),d.jsx("span",{style:{color:ct(t.end),fontWeight:600},children:Vn(t.end)})]})]})}function c0({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:i,onEdit:o,onCancel:l,onDelete:u}){const h={fontSize:"0.8rem",padding:"0.4em 0.8em",height:32,minHeight:32,boxSizing:"border-box",lineHeight:1,display:"inline-flex",alignItems:"center",justifyContent:"center"};return d.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:"0.5rem",flexShrink:0},children:[t&&!e&&d.jsxs(d.Fragment,{children:[d.jsx($e,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:h,children:" Save"}),d.jsx($e,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:h,children:" Apply"})]}),!t&&n&&d.jsx($e,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:h,children:" Edit Allocations"}),e&&d.jsxs(d.Fragment,{children:[d.jsx($e,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:h,children:" Apply"}),d.jsx($e,{actionName:"Cancel Edit Allocations",onClick:l,variant:"secondary",style:h,children:""}),d.jsx($e,{actionName:"Open Delete Allocations Modal",onClick:u,variant:"secondary",style:{...h,color:ge.error},children:""})]})]})}function r1(t){return t===0?ge.zero:t>0?ge.success:ge.error}function L4({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,projectedAllTime:l}){const u=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=u?t.default_monthly_amount/100*r:0,f=u?h.toFixed(2):n,p=i&&!u,g=i?l:t.balance??0,b=t.balance??0,_=b<0,w=_?Math.abs(b):0,x=u?h:parseFloat(n)||0,S=_?Math.min(x,w):0,C=_?Math.max(0,x-w):0,T=_&&x>0&&C>0;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx("span",{style:{fontWeight:500},children:t.name})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),d.jsx("span",{style:{color:dn(e.start_balance)},children:_r(e.start_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?d.jsxs(d.Fragment,{children:[d.jsx("input",{type:"text",inputMode:"decimal",value:f?`$${f}`:"",onChange:I=>{const M=I.target.value.replace(/[^\d.]/g,"");o(M)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),_&&x>0&&d.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[d.jsxs("span",{style:{color:ge.debt,display:"block"},children:[Zt(S),"  debt"]}),T&&d.jsxs("span",{style:{color:ge.success,display:"block"},children:[Zt(C),"  balance"]})]})]}):d.jsx("span",{style:{color:Cc(e.allocated)},children:Lt(e.allocated)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),d.jsx("span",{style:{color:Ec(e.spent)},children:zt(e.spent)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),d.jsx("span",{style:{color:dn(e.end_balance),...i&&!u?hs:{}},children:_r(e.end_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:i?"Proj. All-Time":"All-Time"}),d.jsx("span",{style:{color:dn(g),...i&&!u?hs:{}},children:_r(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&d.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&d.jsxs("span",{style:{color:r1(e.transfers)},children:[Lt(e.transfers)," transfers"]}),e.adjustments!==0&&d.jsxs("span",{style:{color:r1(e.adjustments)},children:[Lt(e.adjustments)," adjust"]})]}),i&&u&&d.jsx("div",{style:{marginTop:"0.5rem"},children:d.jsxs("span",{style:{fontSize:"0.8rem"},children:[d.jsxs("span",{style:{opacity:.6},children:[Zt(r),"  "]}),d.jsxs("span",{style:{color:ge.success},children:[t.default_monthly_amount,"%"]}),d.jsx("span",{style:{opacity:.6},children:" = "}),d.jsx("span",{style:{color:ge.success},children:Zt(h)})]})})]})}function Hf(t){return t===0?ge.zero:t>0?ge.success:ge.error}function s1({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:i,savedAllocations:o,previousMonthIncome:l,isDraftMode:u,onAllocationChange:h,isMobile:f,isUngrouped:p,isFirstGroup:g=!1,getAllocationAmount:b,gridTemplateColumns:_}){const w={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:g?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},x=n.allocated+n.spent+n.transfers+n.adjustments,S=e.reduce((C,[T,I])=>{const M=I.balance??0;let F=M;if(u){const G=b(T,I),D=o[T]??0,O=G-D;F=M+O}return C+Math.max(0,F)},0);return d.jsxs("div",{style:{display:"contents"},children:[!f&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...w,paddingLeft:"0.5rem",opacity:p?.7:1},children:[d.jsx("span",{children:t}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:dn(n.start)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:u?"center":"flex-end",color:Cc(n.allocated)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:Ec(n.spent)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:Hf(n.transfers)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:Hf(n.adjustments)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:dn(x)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:dn(n.end),paddingRight:"1rem",borderRight:"2px solid var(--border-muted)"},children:Yt.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:dn(S)},children:Yt.showGroupTotals})]}),!u&&f&&d.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:g?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:p?.7:1},children:[t,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Yt.showGroupTotals]}),e.map(([C,T],I)=>{const M=r(C);if(!M)return null;const F=T.balance??0;let G=F;if(u){const D=b(C,T),O=o[C]??0,P=D-O;G=F+P}return f?d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(L4,{category:T,balance:M,localAllocation:i[C]||"",previousMonthIncome:l,isDraftMode:u,onAllocationChange:D=>h(C,D),projectedAllTime:G})},C):d.jsx(U4,{category:T,balance:M,localAllocation:i[C]||"",previousMonthIncome:l,isDraftMode:u,onAllocationChange:D=>h(C,D),allTimeBalance:G,isEvenRow:I%2===0,gridTemplateColumns:_},C)})]})}function U4({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,allTimeBalance:l,isEvenRow:u,gridTemplateColumns:h}){const f=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,p=f?t.default_monthly_amount/100*r:0,g=f?p.toFixed(2):n,b=t.balance??0,_=b<0,w=_?Math.abs(b):0,x=f?p:parseFloat(n)||0,S=_?Math.min(x,w):0,C=_?Math.max(0,x-w):0,T=_&&x>0&&C>0,I=u?"transparent":"var(--row-alt-bg)",M={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},F=e.allocated+e.spent+e.transfers+e.adjustments;return d.jsxs("div",{style:{gridColumn:"1 / -1",background:I,display:"grid",gridTemplateColumns:h},children:[d.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid var(--border-subtle)",minHeight:"2.4rem",boxSizing:"border-box"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:dn(e.start_balance)},children:_r(e.start_balance)}),i?d.jsx("div",{style:{...M,justifyContent:"center",flexDirection:"column",gap:"0.1rem"},children:f?d.jsxs("span",{style:{fontSize:"0.85rem"},children:[d.jsxs("span",{style:{color:ge.success},children:[t.default_monthly_amount,"%"]}),d.jsx("span",{style:{opacity:.5},children:" = "}),d.jsx("span",{style:{color:ge.success},children:Zt(p)})]}):d.jsxs(d.Fragment,{children:[d.jsx("input",{type:"text",inputMode:"decimal",value:g?`$${g}`:"",onChange:G=>{const D=G.target.value.replace(/[^\d.]/g,"");o(D)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),_&&x>0&&d.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[d.jsxs("span",{style:{color:ge.debt},children:[Zt(S),"  debt"]}),T&&d.jsxs("span",{style:{color:ge.success},children:[Zt(C),"  bal"]})]})]})}):(()=>{const G=e.start_balance<0,D=G?Math.abs(e.start_balance):0,O=G?Math.min(e.allocated,D):0,P=G?Math.max(0,e.allocated-D):0,$=G&&e.allocated>0;return d.jsxs("div",{style:{...M,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:Cc(e.allocated)},children:[d.jsxs("span",{children:["+",Zt(e.allocated)]}),$&&d.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsxs("span",{style:{color:ge.debt},children:[Zt(O),"  debt"]}),P>0&&d.jsxs("span",{style:{color:ge.success},children:[Zt(P),"  bal"]})]})]})})(),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:Ec(e.spent)},children:zt(e.spent)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:Hf(e.transfers)},children:Lt(e.transfers)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:Hf(e.adjustments)},children:Lt(e.adjustments)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:dn(F),...i&&!f?hs:{}},children:Lt(F)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",fontWeight:600,color:dn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid var(--border-muted)",...i&&!f?hs:{}},children:_r(e.end_balance)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:dn(l),...i&&!f?hs:{}},children:_r(l)})]})}function F4(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,i])=>n||!i.is_hidden).reduce((i,[o,l])=>{const u=l.category_group_id||"ungrouped";return i[u]||(i[u]=[]),i[u].push([o,l]),i},{});return Object.keys(r).forEach(i=>{r[i].sort((o,l)=>o[1].sort_order-l[1].sort_order)}),r}function V4(t,e,n,r,i){const o={};t?.category_balances&&t.category_balances.forEach(u=>{o[u.category_id]=u});const l={};return Object.entries(e).forEach(([u,h])=>{const f=o[u],p=Te(f?.start_balance??0);let g=0;n?g=Te(i(u,h)):r&&f&&(g=Te(f.allocated));const b=TT(u,t?.expenses||[]),_=AT(u,t?.transfers||[]),w=jT(u,t?.adjustments||[]);l[u]={category_id:u,start_balance:p,allocated:g,spent:b,transfers:_,adjustments:w,end_balance:Te(p+g+b+_+w)}}),l}function $4(t,e){const n={};t?.account_balances&&t.account_balances.forEach(i=>{n[i.account_id]=i});const r={};return Object.entries(e).forEach(([i,o])=>{const l=n[i],u=Te(l?.start_balance??o.balance);let h=0;t?.income&&(h=Te(t.income.filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)));let f=0;t?.expenses&&(f=Te(t.expenses.filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)));let p=0;if(t?.transfers){let _=0;t.transfers.forEach(w=>{w.to_account_id===i&&(_+=w.amount),w.from_account_id===i&&(_-=w.amount)}),p=Te(_)}let g=0;t?.adjustments&&(g=Te(t.adjustments.filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)));const b=Te(h+f+p+g);r[i]={account_id:i,start_balance:u,income:h,expenses:f,transfers:p,adjustments:g,net_change:b,end_balance:Te(u+b)}}),r}function q4(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function H4(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+Math.max(0,n.end_balance)}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function xA(t,e){const n={},r={};return t?.account_balances&&t.account_balances.forEach(i=>{r[i.account_id]=i}),t?(Object.entries(e).forEach(([i,o])=>{const l=r[i],u=Te(l?.start_balance??o.balance);let h=0,f=0;t?.income&&t.income.filter(T=>T.account_id===i).forEach(T=>{f+=T.amount,h+=T.amount});let p=0,g=0;t?.expenses&&t.expenses.filter(T=>T.account_id===i).forEach(T=>{g+=T.amount,T.cleared===!0&&(p+=T.amount)});let b=0,_=0;t?.transfers&&t.transfers.forEach(T=>{T.to_account_id===i&&(_+=T.amount,T.cleared===!0&&(b+=T.amount)),T.from_account_id===i&&(_-=T.amount,T.cleared===!0&&(b-=T.amount))});let w=0,x=0;t?.adjustments&&t.adjustments.filter(T=>T.account_id===i).forEach(T=>{x+=T.amount,T.cleared===!0&&(w+=T.amount)});const S=Te(h+p+b+w),C=Te(f+g+_+x);n[i]={account_id:i,cleared_balance:Te(u+S),uncleared_balance:Te(u+C)}}),n):(Object.entries(e).forEach(([i,o])=>{const l=Te(o.balance??0);n[i]={account_id:i,cleared_balance:l,uncleared_balance:l}}),n)}function i1(t){return t===0?ge.zero:t>0?ge.success:ge.error}function G4({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:i,onApply:o,onEdit:l,onCancel:u,onDelete:h}){const f={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...f,gap:"0.75rem"},children:["Grand Totals",!t&&d.jsx(c0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:i,onApply:o,onEdit:l,onCancel:u,onDelete:h})]}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(n.start)},children:_r(n.start)}),d.jsxs("div",{style:{...f,justifyContent:t?"center":"flex-end",color:Cc(n.allocated),...t?hs:{}},children:["+",Zt(n.allocated)]}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:Ec(n.spent)},children:zt(n.spent)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:i1(n.transfers)},children:Lt(n.transfers)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:i1(n.adjustments)},children:Lt(n.adjustments)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(p),...t?hs:{}},children:Lt(p)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(n.end),paddingRight:"1rem",borderRight:"2px solid var(--border-muted)",...t?hs:{}},children:_r(n.end)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(r),...t?hs:{}},children:_r(r)})]})}function W4({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l,onSave:u,onApply:h,onEdit:f,onCancel:p,onDelete:g}){return d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)"},children:[d.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),d.jsx(vA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l}),d.jsx(c0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:u,onApply:h,onEdit:f,onCancel:p,onDelete:g})]})}const _i={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid var(--border-medium)"};function Q4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{categories:r,categoryGroups:i}=In(),{month:o}=Xs(t,e,n),l=Pi(),[u,h]=R.useState(!1),{localAllocations:f,isEditingAppliedAllocations:p,availableNow:g,currentDraftTotal:b,draftChangeAmount:_,availableAfterApply:w,previousMonthIncome:x,currentMonthIncome:S,allocationsFinalized:C,getAllocationAmount:T,handleAllocationChange:I,resetAllocationsToSaved:M,handleSaveAllocations:F,handleFinalizeAllocations:G,handleEditAllocations:D,setIsEditingAppliedAllocations:O}=gB(),P=[...i].sort((H,re)=>H.sort_order-re.sort_order),$=R.useMemo(()=>F4(r),[r]),V=!C||p,j=R.useMemo(()=>V4(o,r,V,C,T),[o,r,V,C,T]),B=H=>j[H],k=R.useMemo(()=>H4(j),[j]),Y=R.useMemo(()=>{const H={};if(o?.category_balances)for(const re of o.category_balances)H[re.category_id]=re.allocated;return H},[o]),X=R.useMemo(()=>Object.entries(r).reduce((H,[re,N])=>{const q=N.balance??0;let J=q;if(V){const ne=T(re,N),ae=Y[re]??0,Ee=ne-ae;J=q+Ee}return H+Math.max(0,J)},0),[r,V,T,Y]),W=R.useMemo(()=>Object.values(r).reduce((H,re)=>H+Math.max(0,re.balance??0),0),[r]);R.useEffect(()=>{if(!t||V)return;if(Math.abs(X-W)>.01){const re=Math.abs(X-W);console.error("[MonthCategories] Month View vs Settings Mismatch:",{grandAllTime:X,settingsPageAllocated:W,difference:re,message:'Month view "ALL-TIME" does not match settings page "Allocated" total. These should always match.'}),qn.add({type:"error",message:`Balance display mismatch: Month view "ALL-TIME" (${Zt(X)})  Settings "Allocated" (${Zt(W)}). Difference: ${Zt(re)}. Budget may need recalculation.`,autoDismissMs:1e4})}},[X,W,V,t]);const te={onSave:F,onApply:G,onEdit:D,onCancel:M,onDelete:()=>h(!0)};return d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:l?"1fr":V?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",display:l?"block":"grid",gridTemplateColumns:l?void 0:"subgrid"},children:[V&&d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:l?"column":"row",flexWrap:"wrap",alignItems:l?"stretch":"center",gap:l?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:l?"0.5rem":"0.25rem"},children:[d.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:l?void 0:1,alignItems:"center"},children:d.jsx(vA,{isDraftMode:V,isEditingAppliedAllocations:p,availableNow:g,currentMonthIncome:S,balanceTotals:k,draftChangeAmount:_,availableAfterApply:w,currentDraftTotal:b})}),d.jsx(c0,{isDraftMode:V,isEditingAppliedAllocations:p,allocationsFinalized:C,...te})]}),!l&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:_i,children:"Category"}),d.jsx("div",{style:{..._i,textAlign:"right"},children:"Start"}),d.jsx("div",{style:{..._i,textAlign:V?"center":"right"},children:"Allocated"}),d.jsx("div",{style:{..._i,textAlign:"right"},children:"Spent"}),d.jsx("div",{style:{..._i,textAlign:"right"},children:"Transfers"}),d.jsx("div",{style:{..._i,textAlign:"right"},children:"Adjust"}),d.jsx("div",{style:{..._i,textAlign:"right"},children:"Net Change"}),d.jsx("div",{style:{..._i,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid var(--border-muted)"},children:"End"}),d.jsx("div",{style:{..._i,textAlign:"right"},children:"All-Time"})]}),!l&&d.jsx(G4,{isDraftMode:V,allocationsFinalized:C,balanceTotals:k,grandAllTime:X,...te}),!V&&l&&d.jsx(W4,{allocationsFinalized:C,availableNow:g,currentMonthIncome:S,balanceTotals:k,draftChangeAmount:_,availableAfterApply:w,currentDraftTotal:b,...te})]}),Object.keys(r).length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",d.jsx(An,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),P.map((H,re)=>{const N=$[H.id]||[];if(N.length===0)return null;const q=N.reduce((J,[ne])=>{const ae=B(ne);return ae?{start:J.start+ae.start_balance,allocated:J.allocated+ae.allocated,spent:J.spent+ae.spent,transfers:J.transfers+ae.transfers,adjustments:J.adjustments+ae.adjustments,end:J.end+ae.end_balance}:J},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return d.jsx(s1,{name:H.name,categories:N,groupTotals:q,getCategoryBalance:B,localAllocations:f,savedAllocations:Y,previousMonthIncome:x,isDraftMode:V,onAllocationChange:I,isMobile:l,isFirstGroup:re===0,getAllocationAmount:T,gridTemplateColumns:V?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},H.id)}),$[en]?.length>0&&(()=>{const H=$[en],re=H.reduce((q,[J])=>{const ne=B(J);return ne?{start:q.start+ne.start_balance,allocated:q.allocated+ne.allocated,spent:q.spent+ne.spent,transfers:q.transfers+ne.transfers,adjustments:q.adjustments+ne.adjustments,end:q.end+ne.end_balance}:q},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0}),N=P.length===0;return d.jsx(s1,{name:"Uncategorized",categories:H,groupTotals:re,getCategoryBalance:B,localAllocations:f,savedAllocations:Y,previousMonthIncome:x,isDraftMode:V,onAllocationChange:I,isMobile:l,isUngrouped:!0,isFirstGroup:N,getAllocationAmount:T,gridTemplateColumns:V?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},en)})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),d.jsx(B4,{isOpen:u,onClose:()=>h(!1),onDeleted:()=>O(!1)})]})}function wA(t){return t===0?ge.zero:t>0?ge.success:ge.error}function SA(t){return t===0?ge.zero:t<0?ge.error:ge.success}function Ea(t){return t===0?ge.zero:t>0?ge.success:ge.error}function a1({name:t,accounts:e,groupTotals:n,accountBalances:r,accountClearedBalances:i,isMobile:o,isUngrouped:l,isFirstGroup:u=!1}){const h={padding:"0.6rem 0.5rem",marginTop:u?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return d.jsxs("div",{style:{display:"contents"},children:[!o&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...h,opacity:l?.7:1},children:[d.jsx("span",{children:t}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),d.jsx("div",{style:{...h,justifyContent:"flex-end",color:ct(n.start)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...h,justifyContent:"flex-end",color:wA(n.income)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...h,justifyContent:"flex-end",color:SA(n.expenses)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...h,justifyContent:"flex-end",color:Ea(n.transfers)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...h,justifyContent:"flex-end",color:Ea(n.adjustments)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...h,justifyContent:"flex-end",color:Ea(n.netChange)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...h,justifyContent:"flex-end",color:ct(n.end)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...h,justifyContent:"flex-end"},children:Yt.showGroupTotals}),d.jsx("div",{style:{...h,justifyContent:"flex-end"},children:Yt.showGroupTotals}),d.jsx("div",{style:{...h,justifyContent:"flex-end"},children:Yt.showGroupTotals})]}),o&&d.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:u?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:l?.7:1},children:[t,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Yt.showGroupTotals]}),e.map(([f,p],g)=>{const b=r[f];if(!b)return null;const _=i?.[f];return o?d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(Y4,{account:p,balance:b,clearedBalance:_})},f):d.jsx(K4,{account:p,balance:b,clearedBalance:_,isEvenRow:g%2===0},f)})]})}function K4({account:t,balance:e,clearedBalance:n,isEvenRow:r}){const i=r?"transparent":"var(--row-alt-bg)",o={padding:"0.5rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:i,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[d.jsx("div",{style:{...o,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid var(--border-subtle)"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),d.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(e.start_balance)},children:zt(e.start_balance)}),d.jsxs("div",{style:{...o,justifyContent:"flex-end",color:wA(e.income)},children:["+",Zt(e.income)]}),d.jsx("div",{style:{...o,justifyContent:"flex-end",color:SA(e.expenses)},children:zt(e.expenses)}),d.jsx("div",{style:{...o,justifyContent:"flex-end",color:Ea(e.transfers)},children:Lt(e.transfers)}),d.jsx("div",{style:{...o,justifyContent:"flex-end",color:Ea(e.adjustments)},children:Lt(e.adjustments)}),d.jsx("div",{style:{...o,justifyContent:"flex-end",color:Ea(e.net_change)},children:Lt(e.net_change)}),d.jsx("div",{style:{...o,justifyContent:"flex-end",fontWeight:600,color:ct(e.end_balance)},children:zt(e.end_balance)}),n?d.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(n.uncleared_balance),fontWeight:600},children:zt(n.uncleared_balance)}):d.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"var(--text-muted)"},children:""}),n?d.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(n.cleared_balance)},children:Math.abs(n.uncleared_balance-n.cleared_balance)<.01?d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""}):zt(n.cleared_balance)}):d.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"var(--text-muted)"},children:""}),n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?d.jsx("div",{style:{...o,justifyContent:"flex-end",color:Ea(n.uncleared_balance-n.cleared_balance)},children:Lt(n.uncleared_balance-n.cleared_balance)}):d.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"var(--text-muted)"},children:""})]})}function Y4({account:t,balance:e,clearedBalance:n}){return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx("span",{style:{fontWeight:500},children:t.nickname})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?"1fr 1fr 1fr 1fr":"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),d.jsx("span",{children:zt(e.start_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),d.jsx("span",{style:{color:ct(e.net_change)},children:Lt(e.net_change)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),d.jsx("span",{style:{color:ct(e.end_balance)},children:zt(e.end_balance)})]}),n&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Total"}),d.jsx("span",{style:{color:ct(n.uncleared_balance),fontWeight:600},children:zt(n.uncleared_balance)})]}),Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?d.jsxs(d.Fragment,{children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),d.jsx("span",{style:{color:ct(n.cleared_balance)},children:zt(n.cleared_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),d.jsx("span",{style:{color:Ea(n.uncleared_balance-n.cleared_balance)},children:Lt(n.uncleared_balance-n.cleared_balance)})]})]}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]})]})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&d.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&d.jsxs("span",{children:[Lt(e.income)," income"]}),e.expenses!==0&&d.jsxs("span",{children:[zt(e.expenses)," expenses"]}),e.transfers!==0&&d.jsxs("span",{children:[Lt(e.transfers)," transfers"]}),e.adjustments!==0&&d.jsxs("span",{children:[Lt(e.adjustments)," adjust"]})]})]})}const cs={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid var(--border-medium)"};function X4(t){return t===0?ge.zero:t>0?ge.success:ge.error}function Z4(t){return t===0?ge.zero:t<0?ge.error:ge.success}function ey(t){return t===0?ge.zero:t>0?ge.success:ge.error}function J4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{accounts:r,accountGroups:i}=In(),{month:o}=Xs(t,e,n),l=Pi(),u=R.useMemo(()=>Object.entries(i).map(([S,C])=>({id:S,...C})).sort((S,C)=>S.sort_order-C.sort_order),[i]),h=R.useMemo(()=>{const S={};return Object.entries(r).filter(([,C])=>!C.is_hidden).forEach(([C,T])=>{const I=T.account_group_id||Vt;S[I]||(S[I]=[]),S[I].push([C,T])}),Object.keys(S).forEach(C=>{S[C].sort((T,I)=>T[1].sort_order-I[1].sort_order)}),S},[r]),f=R.useMemo(()=>$4(o,r),[o,r]),p=R.useMemo(()=>xA(o,r),[o,r]),g=R.useMemo(()=>q4(f),[f]),b=g.income+g.expenses,_=R.useMemo(()=>Object.keys(p).length===0?null:Object.values(p).reduce((S,C)=>S+C.uncleared_balance,0),[p]),x={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)",fontWeight:600};return d.jsx(d.Fragment,{children:d.jsxs("div",{style:{display:"grid",gridTemplateColumns:l?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",display:l?"block":"grid",gridTemplateColumns:l?void 0:"subgrid"},children:[!l&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:cs,children:"Account"}),d.jsx("div",{style:{...cs,textAlign:"right"},children:"Start"}),d.jsx("div",{style:{...cs,textAlign:"right"},children:"Income"}),d.jsx("div",{style:{...cs,textAlign:"right"},children:"Expenses"}),d.jsx("div",{style:{...cs,textAlign:"right"},children:"Transfers"}),d.jsx("div",{style:{...cs,textAlign:"right"},children:"Adjust"}),d.jsx("div",{style:{...cs,textAlign:"right"},children:"Net Change"}),d.jsx("div",{style:{...cs,textAlign:"right"},children:"End"}),d.jsx("div",{style:{...cs,textAlign:"right"},children:"Total"}),d.jsx("div",{style:{...cs,textAlign:"right"},children:"Cleared"}),d.jsx("div",{style:{...cs,textAlign:"right"},children:"Uncleared"})]}),l?d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)"},children:[d.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),d.jsx(z4,{totals:g})]}):d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{...x},children:"Grand Totals"}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:ct(g.start)},children:zt(g.start)}),d.jsxs("div",{style:{...x,justifyContent:"flex-end",color:X4(g.income)},children:["+",Zt(g.income)]}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:Z4(g.expenses)},children:zt(g.expenses)}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:ey(g.transfers)},children:Lt(g.transfers)}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:ey(g.adjustments)},children:Lt(g.adjustments)}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:ey(b)},children:Lt(b)}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:ct(g.end)},children:zt(g.end)}),d.jsx("div",{style:{...x,justifyContent:"flex-end",color:_!==null?ct(_):void 0},children:_!==null?zt(_):d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})}),d.jsx("div",{style:{...x,justifyContent:"flex-end"},children:(()=>{if(Object.keys(p).length===0)return d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""});const S=Object.values(p).reduce((T,I)=>T+I.cleared_balance,0),C=Object.values(p).reduce((T,I)=>T+I.uncleared_balance,0);return Math.abs(C-S)<.01?d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""}):zt(S)})()}),d.jsx("div",{style:{...x,justifyContent:"flex-end"},children:(()=>{if(Object.keys(p).length===0)return d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""});const S=Object.values(p).reduce((I,M)=>I+M.cleared_balance,0),T=Object.values(p).reduce((I,M)=>I+M.uncleared_balance,0)-S;return Math.abs(T)<.01?d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""}):Lt(T)})()})]})]}),Object.keys(r).length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",d.jsx(An,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),u.map((S,C)=>{const T=h[S.id]||[];if(T.length===0)return null;const I=T.reduce((M,[F])=>{const G=f[F];return G?{start:M.start+G.start_balance,income:M.income+G.income,expenses:M.expenses+G.expenses,transfers:M.transfers+G.transfers,adjustments:M.adjustments+G.adjustments,netChange:M.netChange+G.net_change,end:M.end+G.end_balance}:M},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return d.jsx(a1,{name:S.name,accounts:T,groupTotals:I,accountBalances:f,accountClearedBalances:p,isMobile:l,isFirstGroup:C===0},S.id)}),h[Vt]?.length>0&&(()=>{const S=h[Vt],C=S.reduce((I,[M])=>{const F=f[M];return F?{start:I.start+F.start_balance,income:I.income+F.income,expenses:I.expenses+F.expenses,transfers:I.transfers+F.transfers,adjustments:I.adjustments+F.adjustments,netChange:I.netChange+F.net_change,end:I.end+F.end_balance}:I},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0}),T=u.length===0;return d.jsx(a1,{name:"Ungrouped",accounts:S,groupTotals:C,accountBalances:f,accountClearedBalances:p,isMobile:l,isUngrouped:!0,isFirstGroup:T},Vt)})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})})}const eL=["income","categories","accounts","spend","transfers","adjustments"];function ty(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&eL.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function tL(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function o1(){const t=KR(),e=nd(),[n,r]=O1(),{addLoadingHold:i,removeLoadingHold:o}=Rn(),{selectedBudgetId:l,setSelectedBudgetId:u,currentYear:h,currentMonthNumber:f,lastActiveTab:p,lastBalancesTab:g,lastTransactionsTab:b,setCurrentYear:_,setCurrentMonthNumber:w,setLastActiveTab:x,setPageTitle:S,goToPreviousMonth:C,goToNextMonth:T,hasPendingInvites:I,needsFirstBudget:M,initialDataLoadComplete:F}=Xe(),{budget:G,isLoading:D}=In(),O=!D,[P,$]=R.useState(!1);R.useEffect(()=>(!O||!F?i("budget-data","Loading budget data..."):o("budget-data"),()=>o("budget-data")),[O,F,i,o]);const V=R.useRef(!1),j=n.get("error"),[B,k]=R.useState(j);R.useEffect(()=>{j&&(n.delete("error"),r(n,{replace:!0}))},[j,n,r]);const Y=R.useMemo(()=>{const{tab:J}=ty(t);return J??p},[t,p]),X=J=>{e(`/budget/${h}/${f}/${J}`),x(J)};R.useEffect(()=>{const{tab:J}=ty(t);J!=null&&x(Y)},[Y,t,x]),R.useEffect(()=>{if(V.current)return;const{year:J,month:ne}=ty(t);J&&_(J),ne&&w(ne),V.current=!0},[t,_,w]),R.useEffect(()=>{if(!V.current)return;const J=`/budget/${h}/${f}/${Y}`,ne=`/budget/${t.year}/${t.month}/${t.tab}`;J!==ne&&e(J,{replace:!0})},[h,f,Y,e,t]);const{month:W,error:te,isLoading:H}=Xs(O&&F?l:null,h,f);R.useEffect(()=>{if(!te||P)return;const J=te.message||"";if(J.includes("Budget")&&J.includes("does not exist")){queueMicrotask(()=>{u(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(J.includes("months in the past")||J.includes("Refusing to create month"))&&queueMicrotask(()=>{i("month-redirect","Redirecting to current month..."),$(!0);const{year:ne,month:ae}=tL();k(`Cannot create month ${h}/${f} - it's too far in the past. Redirected to current month.`),_(ne),w(ae)})},[te,P,h,f,_,w,i,u,e]),R.useEffect(()=>{P&&W&&!H&&queueMicrotask(()=>{$(!1),o("month-redirect")})},[P,W,H,o]),R.useLayoutEffect(()=>{S(G?.name||"Budget")},[G?.name,S]);const{setCurrentViewingDocument:re}=Xe();if(R.useEffect(()=>(G&&h&&f&&re({type:"month",year:h,month:f}),()=>{re({type:null})}),[G,h,f,re]),R.useEffect(()=>{if(O&&!P){if(!G&&!l){e("/budget/my-budgets",{replace:!0});return}if(!G&&I){e("/budget/my-budgets",{replace:!0});return}if(M){e("/budget/my-budgets",{replace:!0});return}}},[O,P,G,l,I,M,e]),RB(F?l:null,h,f),BB({budgetId:l,viewingYear:h,viewingMonth:f,initialDataLoadComplete:F,enabled:!!l&&F}),!O||!F||P||!G)return null;function N(){k(null),C()}function q(){k(null),T()}return d.jsxs(d.Fragment,{children:[B&&d.jsx(J_,{message:B,onDismiss:()=>k(null)}),d.jsx(w4,{onPreviousMonth:N,onNextMonth:q}),d.jsx(f4,{activeTab:Y,setActiveTab:X,lastBalancesTab:g,lastTransactionsTab:b,allocationsFinalized:W?.are_allocations_finalized}),Y==="income"&&d.jsx(A4,{},`${h}-${f}`),Y==="categories"&&d.jsx(Q4,{},`${h}-${f}`),Y==="accounts"&&d.jsx(J4,{},`${h}-${f}`),Y==="spend"&&d.jsx(R4,{},`${h}-${f}`),Y==="transfers"&&d.jsx(O4,{},`${h}-${f}`),Y==="adjustments"&&d.jsx(P4,{},`${h}-${f}`)]})}function nL(){const{setPageTitle:t}=Xe();return R.useLayoutEffect(()=>{t("Analytics")},[t]),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[d.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),d.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),d.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),d.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),d.jsx(An,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:ge.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function rL(){const t=Rt();return{createBudget:En({mutationFn:async({name:n,userId:r,userEmail:i})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString(),u={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:i,accounts:{},account_groups:{[Vt]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},categories:{},category_groups:[{id:en,name:"Uncategorized",sort_order:0}],month_map:{},percentage_income_months_back:1,created_at:l,updated_at:l};return await kr("budgets",o,u,"creating new budget document"),await kr("users",r,{uid:r,email:i,budget_ids:Ku(o),updated_at:l},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...u}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:we.user(r)}),t.invalidateQueries({queryKey:we.accessibleBudgets(r)})}})}}function sL(){const t=Rt();return{acceptInvite:En({mutationFn:async({budgetId:n,userId:r})=>{const i=new Date().toISOString(),{exists:o,data:l}=await At("budgets",n,"validating user was invited to this budget");if(!o||!l)throw new Error("Budget not found");if(!l.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(l.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await kr("users",r,{uid:r,budget_ids:Ku(n),updated_at:i},"adding accepted budget to user's budget list",{merge:!0}),await kr("budgets",n,{accepted_user_ids:Ku(r),updated_at:i},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:we.user(r)}),t.invalidateQueries({queryKey:we.accessibleBudgets(r)}),t.invalidateQueries({queryKey:we.budget(n.budgetId)})}})}}function iL(){const t=Rt(),e=En({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=we.budget(i);await t.cancelQueries({queryKey:l});const u=t.getQueryData(l);return u&&t.setQueryData(l,{...u,budget:{...u.budget,user_ids:[...u.budget.user_ids,o]}}),{previousData:u}},mutationFn:async r=>{const{budgetId:i,userId:o}=r,{exists:l,data:u}=await At("budgets",i,"validating user is not already invited");if(!l||!u)throw new Error("Budget not found");if(u.user_ids?.includes(o))throw new Error("User is already invited");return await Yo({budgetId:i,updates:{user_ids:Ku(o)},description:"adding user to budget's invited users list"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(we.budget(i.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function aL(){const t=Rt(),e=En({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=we.budget(i);await t.cancelQueries({queryKey:l});const u=t.getQueryData(l);return u&&t.setQueryData(l,{...u,budget:{...u.budget,user_ids:u.budget.user_ids.filter(h=>h!==o),accepted_user_ids:u.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:u}},mutationFn:async r=>{const{budgetId:i,userId:o}=r;return await Yo({budgetId:i,updates:{user_ids:NS(o),accepted_user_ids:NS(o)},description:"removing user from budget's access lists"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(we.budget(i.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function oL({message:t,onDismiss:e}){return d.jsxs("div",{style:{background:"var(--color-error-bg)",border:"1px solid var(--color-error-border)",color:"var(--color-error)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:t}),d.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"var(--color-error)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function lL({message:t,onDismiss:e}){return d.jsxs("div",{style:{background:"var(--color-success-bg)",border:"1px solid var(--color-success-border)",color:"var(--color-success)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:t}),d.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"var(--color-success)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function cL({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:i,onCheckInvite:o,onAcceptInvite:l,onCancel:u}){return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Join Budget by ID"]}),d.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-success) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-success) 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[d.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[d.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&d.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[d.jsx("button",{onClick:l,disabled:i===r.budgetId,style:{background:"var(--color-success)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:1},children:i===r.budgetId?"Accepting...":"Accept Invitation"}),d.jsx("button",{onClick:u,disabled:i===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:.8},children:"Cancel"})]})]}):d.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[d.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),d.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function uL({currentUserId:t}){return d.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[d.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),d.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function dL(){const{addLoadingHold:t,removeLoadingHold:e}=Rn(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:i,loadAccessibleBudgets:o,switchToBudget:l,checkBudgetInvite:u,isInitialized:h,setPageTitle:f,needsFirstBudget:p}=Xe(),{requireUserEmail:g}=Ni(),b=R.useRef(!1),[_,w]=O1(),x=_.get("context");R.useEffect(()=>{x&&(_.delete("context"),w(_,{replace:!0}))},[x,_,w]);const S=x==="budget-not-found",C=p&&i.length===0;R.useLayoutEffect(()=>{f("My Budgets")},[f]),R.useEffect(()=>{h&&!b.current&&(b.current=!0,o())},[h,o]);const{budget:T,isLoading:I}=In(),{renameBudget:M}=fB(),{acceptInvite:F}=sL(),{createBudget:G}=rL(),[D,O]=R.useState(null),[P,$]=R.useState(null),[V,j]=R.useState(null),[B,k]=R.useState(null),[Y,X]=R.useState(null),[W,te]=R.useState(""),[H,re]=R.useState(!1),[N,q]=R.useState(""),[J,ne]=R.useState(!1),[ae,Ee]=R.useState(null),[Ae,ce]=R.useState(""),[fe,Oe]=R.useState(!1);async function Me(ie){if(ie!==T?.id){O(ie),j(null),k(null);try{await l(ie),k("Switched to budget successfully!"),await o({force:!0})}catch(Re){j(Re instanceof Error?Re.message:"Failed to switch budget")}finally{O(null)}}}async function Ge(ie){if(r){$(ie),j(null),k(null);try{await F.mutateAsync({budgetId:ie,userId:r}),k("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(Re){j(Re instanceof Error?Re.message:"Failed to accept invitation")}finally{$(null)}}}async function tt(ie){if(ie.preventDefault(),!!N.trim()){ne(!0),j(null),Ee(null);try{const Re=await u(N.trim());Re?Ee(Re):j("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Re){j(Re instanceof Error?Re.message:"Failed to check invitation")}finally{ne(!1)}}}async function L(){if(!(!ae||!r)){ae.budgetName,$(ae.budgetId),j(null);try{await F.mutateAsync({budgetId:ae.budgetId,userId:r}),k(`Successfully joined "${ae.budgetName}"!`),Ee(null),q(""),await o({force:!0})}catch(ie){j(ie instanceof Error?ie.message:"Failed to accept invitation")}finally{$(null)}}}function de(ie,Re){te(Re),X(ie)}async function ye(ie){if(ie.preventDefault(),!(!W.trim()||!Y||!n)){W.trim(),re(!0),j(null),k(null);try{await M.mutateAsync({budgetId:n,newName:W.trim()}),k("Budget renamed successfully!"),X(null),await o({force:!0})}catch(Re){j(Re instanceof Error?Re.message:"Failed to rename budget")}finally{re(!1)}}}async function ee(ie){if(ie.preventDefault(),!!r){Ae.trim(),Oe(!0),j(null),k(null);try{const Re=await G.mutateAsync({name:Ae.trim()||"My Budget",userId:r,userEmail:g()});await l(Re.budgetId),k("Budget created successfully!"),ce(""),await o({force:!0})}catch(Re){j(Re instanceof Error?Re.message:"Failed to create budget")}finally{Oe(!1)}}}const Z=i.filter(ie=>!ie.isPending),oe=i.filter(ie=>ie.isPending);if(R.useEffect(()=>(I||!h?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[I,h,t,e]),I||!h)return null;let Se="My Budgets",xe="Switch between budgets, accept invitations, or create a new budget.";return S?(Se="Budget Not Found",xe="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):C&&(Se="Welcome!",xe="Get started by creating your first budget or accepting an invitation."),d.jsxs("div",{children:[d.jsx("h1",{children:Se}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:xe}),V&&d.jsx(oL,{message:V,onDismiss:()=>j(null)}),B&&d.jsx(lL,{message:B,onDismiss:()=>k(null)}),oe.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-warning) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-warning) 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Pending Invitations (",oe.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:oe.map(ie=>d.jsx(KS,{budget:ie,isCurrent:!1,isAccepting:P===ie.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>Ge(ie.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},ie.id))})]}),Z.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Your Budgets (",Z.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:Z.map(ie=>d.jsx(KS,{budget:ie,isCurrent:ie.id===n,isAccepting:!1,isSwitching:D===ie.id,isEditing:Y===ie.id,editName:Y===ie.id?W:"",isRenaming:H,onAccept:()=>{},onSwitch:()=>Me(ie.id),onStartEdit:()=>de(ie.id,ie.name),onCancelEdit:()=>{X(null),te("")},onEditNameChange:te,onSaveEdit:ye},ie.id))})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-primary) 8%, transparent)",border:"1px solid color-mix(in srgb, var(--color-primary) 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Create New Budget"]}),d.jsxs("form",{onSubmit:ee,children:[d.jsxs("div",{style:{marginBottom:"1rem"},children:[d.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),d.jsx("input",{type:"text",value:Ae,onChange:ie=>ce(ie.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),d.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),d.jsx("button",{type:"submit",disabled:fe,style:{background:ge.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:fe?"not-allowed":"pointer",fontWeight:500,opacity:fe?.7:1,fontSize:"0.9rem"},children:fe?"Creating...":"Create Budget"})]})]}),d.jsx(cL,{budgetIdInput:N,setBudgetIdInput:q,isCheckingManual:J,manualInvite:ae,isAccepting:P,onCheckInvite:tt,onAcceptInvite:L,onCancel:()=>{Ee(null),q("")}}),r&&d.jsx(uL,{currentUserId:r})]})}const hL=["general","accounts","categories","users"];function fL(){const{addLoadingHold:t,removeLoadingHold:e}=Rn(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:i,selectedBudgetId:o,setCurrentViewingDocument:l}=Xe();R.useLayoutEffect(()=>{i("Budget Settings")},[i]),R.useEffect(()=>(o&&l({type:"budget"}),()=>{l({type:null})}),[o,l]);const{isOwner:u,isLoading:h,isFetching:f}=In();R.useEffect(()=>(h||f?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[h,f,t,e]);const p=er(),g=p.pathname==="/budget/settings",b=R.useMemo(()=>{const C=p.pathname;return C.includes("/settings/general")?"general":C.includes("/settings/accounts")?"accounts":C.includes("/settings/categories")?"categories":C.includes("/settings/users")?"users":"general"},[p.pathname]),_=b==="users";R.useEffect(()=>{g||r(b)},[b,g,r]);function w(){return!hL.includes(n)||n==="users"&&!u?"general":n}const x=R.useMemo(()=>[{id:"general",label:"General",icon:""},{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!u}],[u]);return h||f?null:!u&&_?d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(An,{to:"/budget/settings/general",children:"Go to General "})})]}):d.jsxs("div",{children:[d.jsx(qf,{mode:"link",linkPrefix:"/budget/settings",tabs:x,activeTab:g?w():b}),g?d.jsx(Wf,{to:`/budget/settings/${w()}`,replace:!0}):d.jsx(mA,{children:d.jsx(Qf,{})})]})}const ny=1,ry=12;function mL(){const{selectedBudgetId:t}=Xe(),{budget:e,isLoading:n}=In(),r=e?.percentage_income_months_back??1,[i,o]=R.useState(r),[l,u]=R.useState(!1),[h,f]=R.useState(null);R.useEffect(()=>{o(e?.percentage_income_months_back??1)},[e?.percentage_income_months_back]);const p=Math.min(ry,Math.max(ny,Math.round(Number(i))||1));async function g(){if(!t)return;const _=p;f(null),u(!0);try{await Yo({budgetId:t,updates:{percentage_income_months_back:_},description:"update percentage income months back"}),Be.setQueryData(we.budget(t),w=>w&&{...w,budget:{...w.budget,percentage_income_months_back:_}}),await jB(t,_,Be),o(_),f(null)}catch(w){const x=w instanceof Error?w.message:"Failed to save";console.error("[Settings/General] Failed to save percentage income months back:",w),qn.add({type:"error",message:"Failed to save setting. See console for details.",autoDismissMs:0}),f(x)}finally{u(!1)}}const b=p!==r;return n||!e?d.jsx("div",{style:{padding:"1rem"},children:d.jsx("p",{style:{opacity:.7},children:"Loading..."})}):d.jsxs("div",{style:{padding:"1rem",maxWidth:"32rem"},children:[d.jsx("h3",{style:{marginTop:0,marginBottom:"1rem"},children:"Budget behavior"}),d.jsxs("div",{style:{marginBottom:"1.5rem"},children:[d.jsx("label",{htmlFor:"percentage-income-months-back",style:{display:"block",marginBottom:"0.35rem",fontWeight:500},children:"Income reference for % allocations (months back)"}),d.jsx("p",{style:{fontSize:"0.85rem",opacity:.7,margin:"0 0 0.5rem 0"},children:"Percentage-based category allocations use income from this many months ago. Use 1 for previous month or 2 if you budget for the month after next."}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[d.jsx("input",{id:"percentage-income-months-back",type:"number",min:ny,max:ry,value:i,onChange:_=>{const w=_.target.value;o(w===""?1:Math.min(ry,Math.max(ny,Math.round(Number(w))||1)))},style:{width:"4rem",padding:"0.4rem 0.5rem",fontSize:"1rem",border:"1px solid var(--border-medium)",borderRadius:"6px"}}),d.jsx("span",{style:{opacity:.7},children:"month(s) back"}),b&&d.jsx("button",{type:"button",onClick:g,disabled:l,style:{padding:"0.4rem 0.75rem",background:"var(--color-primary)",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer",opacity:l?.7:1},children:l?"Saving":"Save"})]}),h&&d.jsx("p",{style:{marginTop:"0.5rem",color:"var(--color-error)",fontSize:"0.9rem"},"aria-live":"polite",children:"Save failed. See banner for details."})]}),d.jsx("p",{style:{fontSize:"0.8rem",opacity:.6},children:"Changing this only affects non-finalized allocation calculations. Finalized months keep their existing amounts."})]})}function u0({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:i,showGroupSelector:o=!1,showIncomeSettings:l=!1,hasExistingIncomeDefault:u=!1,hasExistingOutgoDefault:h=!1,currentGroupId:f,onDelete:p}){const[g,b]=R.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),_=g.account_group_id||f,w=_?i.find(M=>M.id===_):null,x=!!(w&&w.is_active!==null),S=!!(w&&w.on_budget!==null);function C(M){M.preventDefault(),g.nickname.trim()&&e(g)}function T(M){b({...g,is_income_account:M,is_income_default:M?g.is_income_default:!1})}function I(M){b({...g,is_outgo_account:M,is_outgo_default:M?g.is_outgo_default:!1})}return d.jsxs(ki,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:C,children:[d.jsx(Bt,{label:"Account Nickname",htmlFor:"account-nickname",children:d.jsx(Mi,{id:"account-nickname",type:"text",value:g.nickname,onChange:M=>b({...g,nickname:M.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&d.jsx(Bt,{label:"Account Type",htmlFor:"account-group",children:d.jsxs(Zu,{id:"account-group",value:g.account_group_id||Vt,onChange:M=>b({...g,account_group_id:M.target.value===Vt?null:M.target.value}),children:[d.jsx("option",{value:Vt,children:"Ungrouped"}),i.map(M=>d.jsx("option",{value:M.id,children:M.name},M.id))]})}),l&&d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Qr,{id:"is-active",checked:(()=>{if(x&&w){const M=w.is_active;return M===null||M===void 0?!1:M}return g.is_active??!0})(),onChange:M=>b({...g,is_active:M.target.checked}),disabled:x,children:d.jsx("span",{style:{opacity:x?.5:1},children:"Active account"})}),x&&w&&d.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ge.warning},children:['Set by account type "',w.name,'"']})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Qr,{id:"on-budget",checked:(()=>{if(S&&w){const M=w.on_budget;return M===null||M===void 0?!1:M}return g.on_budget??!0})(),onChange:M=>b({...g,on_budget:M.target.checked}),disabled:S,children:d.jsx("span",{style:{opacity:S?.5:1},children:"On budget (affects budget totals)"})}),S&&w&&d.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ge.warning},children:['Set by account type "',w.name,'"']})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Qr,{id:"is-hidden",checked:g.is_hidden||!1,onChange:M=>b({...g,is_hidden:M.target.checked}),children:"Hidden account"}),d.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),d.jsx(Qr,{id:"is-income-account",checked:g.is_income_account||!1,onChange:M=>T(M.target.checked),children:"Show in income deposit list"}),g.is_income_account&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[d.jsx(Qr,{id:"is-income-default",checked:g.is_income_default||!1,onChange:M=>b({...g,is_income_default:M.target.checked}),disabled:u&&!t?.is_income_default,children:"Default account for new income"}),u&&!t?.is_income_default&&d.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),d.jsx(Qr,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:M=>I(M.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[d.jsx(Qr,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:M=>b({...g,is_outgo_default:M.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&d.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),d.jsxs(Ga,{children:[d.jsx($e,{type:"submit",actionName:r,children:r}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"}),p&&d.jsx($e,{type:"button",variant:"secondary",actionName:"Delete Account",onClick:M=>{M.preventDefault(),p()},style:{color:"var(--color-validation-error)",borderColor:"var(--color-validation-error)"},children:" Delete"})]})]})}function l1({label:t,value:e,onChange:n,trueLabel:r,falseLabel:i,undefinedLabel:o}){function l(){n(e===void 0?!0:e===!0?!1:void 0)}const u=e===!0?r:e===!1?i:o,h=e===!0?ge.success:e===!1?ge.warning:"inherit",f=e===!0?"":e===!1?"":"";return d.jsxs("button",{type:"button",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[d.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:f}),d.jsxs("span",{style:{flex:1},children:[d.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",d.jsx("span",{style:{fontWeight:500,color:h},children:u})]}),d.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function c1({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=R.useState(t||{name:"",expected_balance:"positive"});function l(u){u.preventDefault(),i.name.trim()&&e(i)}return d.jsxs(ki,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:l,children:[d.jsx(Bt,{label:"Account Type Name",htmlFor:"group-name",children:d.jsx(Mi,{id:"group-name",type:"text",value:i.name,onChange:u=>o({...i,name:u.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),d.jsx(Bt,{label:"Expected Balance",htmlFor:"expected-balance",children:d.jsxs(Zu,{id:"expected-balance",value:i.expected_balance,onChange:u=>o({...i,expected_balance:u.target.value}),children:[d.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),d.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),d.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",d.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),d.jsx(l1,{label:"Active status",value:i.is_active,onChange:u=>o({...i,is_active:u}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),d.jsx(l1,{label:"Budget status",value:i.on_budget,onChange:u=>o({...i,on_budget:u}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),d.jsxs(Ga,{children:[d.jsx($e,{type:"submit",actionName:r,children:r}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function Ll({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${ge.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${ge.success} 40%, transparent)`,color:ge.success,opacity:1},warning:{background:`color-mix(in srgb, ${ge.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${ge.warning} 35%, transparent)`,color:ge.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${ge.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ge.success} 25%, transparent)`,color:ge.success,opacity:.7},expense:{background:`color-mix(in srgb, ${ge.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ge.warning} 25%, transparent)`,color:ge.warning,opacity:.7}}[n];return d.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[d.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function u1({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(l=>l.id===t.account_group_id):null,i=r&&r.is_active!==null?r.is_active:t.is_active!==!1,o=r&&r.on_budget!==null?r.on_budget:t.on_budget!==!1;if(!i){const l=r&&r.is_active!==null;n.push(d.jsx(Ll,{icon:"",label:"Inactive",variant:"warning",title:l?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const l=r&&r.on_budget!==null;n.push(d.jsx(Ll,{icon:"",label:"Off Budget",variant:"warning",title:l?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(d.jsx(Ll,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(d.jsx(Ll,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(d.jsx(Ll,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(d.jsx(Ll,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:d.jsx(d.Fragment,{children:n})}function pL({account:t,accountIndex:e,allGroups:n,allAccounts:r,clearedBalance:i,onEdit:o,onDelete:l,onMoveUp:u,onMoveDown:h,canMoveUp:f,canMoveDown:p,editingAccountId:g,setEditingAccountId:b,onUpdateAccount:_,isMobile:w}){if(g===t.id)return d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:d.jsx(u0,{initialData:{nickname:t.nickname,account_group_id:t.account_group_id,is_income_account:t.is_income_account,is_income_default:t.is_income_default,is_outgo_account:t.is_outgo_account,is_outgo_default:t.is_outgo_default,on_budget:t.on_budget,is_active:t.is_active},onSubmit:T=>{_(t.id,T),b(null)},onCancel:()=>b(null),onDelete:()=>{t.nickname,l(t.id),b(null)},submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:t.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([T,I])=>I.is_income_default&&T!==t.id),hasExistingOutgoDefault:Object.entries(r).some(([T,I])=>I.is_outgo_default&&T!==t.id)})});if(w)return d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsx("span",{style:{fontWeight:500},children:t.nickname}),d.jsx("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:i?d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total"}),d.jsx("span",{style:{color:ct(i.uncleared_balance),fontWeight:600},children:zt(i.uncleared_balance)})]}),Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),d.jsx("span",{style:{color:ct(i.cleared_balance)},children:zt(i.cleared_balance)})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),d.jsx("span",{style:{color:ct(i.uncleared_balance-i.cleared_balance)},children:zt(i.uncleared_balance-i.cleared_balance)})]})]}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]})]})]}):d.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:d.jsx("span",{style:{color:ct(t.balance),fontWeight:600},children:zt(t.balance)})})})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.5rem"},children:d.jsx(u1,{account:t,accountGroups:n})}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[d.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),d.jsx("button",{onClick:T=>{T.stopPropagation(),u()},disabled:!f,style:{background:"transparent",border:"none",cursor:f?"pointer":"default",opacity:f?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),d.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const S=e%2===0?"transparent":"var(--row-alt-bg)",C={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1.5fr 1fr"},children:[d.jsx("div",{style:{...C,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid var(--border-subtle)"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),i?d.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(i.uncleared_balance),fontWeight:600},children:zt(i.uncleared_balance)}):d.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(t.balance),fontWeight:600},children:zt(t.balance)}),i?d.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(i.cleared_balance)},children:Math.abs(i.uncleared_balance-i.cleared_balance)<.01?d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""}):zt(i.cleared_balance)}):d.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(t.balance),fontWeight:600},children:zt(t.balance)}),i&&Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?d.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(i.uncleared_balance-i.cleared_balance)},children:zt(i.uncleared_balance-i.cleared_balance)}):d.jsx("div",{style:{...C,justifyContent:"flex-end",opacity:.3,color:"var(--text-muted)"},children:""}),d.jsx("div",{style:{...C,gap:"0.25rem",flexWrap:"wrap"},children:d.jsx(u1,{account:t,accountGroups:n})}),d.jsxs("div",{style:{...C,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),d.jsx("button",{onClick:T=>{T.stopPropagation(),u()},disabled:!f,style:{background:"transparent",border:"none",cursor:f?"pointer":"default",opacity:f?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),d.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function d1({group:t,accounts:e,allGroups:n,allAccounts:r,accountClearedBalances:i,editingAccountId:o,createForGroupId:l,setEditingAccountId:u,setCreateForGroupId:h,onUpdateAccount:f,onDeleteAccount:p,onMoveAccount:g,onCreateAccount:b,isMobile:_,isUngrouped:w,canMoveGroupUp:x,canMoveGroupDown:S,onEditGroup:C,onDeleteGroup:T,onMoveGroupUp:I,onMoveGroupDown:M}){const F=[...e].sort((D,O)=>D.sort_order-O.sort_order);F.reduce((D,O)=>D+O.balance,0);const G={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return d.jsxs("div",{style:{display:"contents"},children:[!_&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...G,opacity:w?.7:1,justifyContent:"space-between"},children:[d.jsxs("span",{children:[d.jsx("span",{children:t.name}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",F.length,")"]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!w&&d.jsxs(d.Fragment,{children:[d.jsx($e,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),d.jsx("button",{onClick:()=>{t.name,C()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),d.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),d.jsxs("div",{style:Vf,children:[d.jsx("button",{onClick:I,disabled:!x,style:{...wa,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),d.jsx("button",{onClick:M,disabled:!S,style:{...wa,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})})]}),d.jsx("div",{style:G}),d.jsx("div",{style:G}),d.jsx("div",{style:G}),d.jsx("div",{style:G}),d.jsx("div",{style:G})]}),_&&d.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:w?.7:1},children:[t.name,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",F.length,")"]})]}),Yt.showGroupTotals]}),!w&&d.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[d.jsx($e,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),d.jsx("button",{onClick:()=>{t.name,C()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),d.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),d.jsxs("div",{style:Vf,children:[d.jsx("button",{onClick:I,disabled:!x,style:{...wa,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),d.jsx("button",{onClick:M,disabled:!S,style:{...wa,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]}),F.map((D,O)=>d.jsx(pL,{account:D,accountIndex:O,totalAccounts:F.length,allGroups:n,allAccounts:r,clearedBalance:i?.[D.id],onEdit:u,onDelete:p,onMoveUp:()=>g(D.id,"up"),onMoveDown:()=>g(D.id,"down"),canMoveUp:O>0,canMoveDown:O<F.length-1,editingAccountId:o,setEditingAccountId:u,onUpdateAccount:f,isMobile:_},D.id)),l===t.id&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:d.jsx(u0,{initialData:{nickname:"",account_group_id:t.id},onSubmit:D=>b(D,t.id),onCancel:()=>h(null),submitLabel:"Create",accountGroups:n,showIncomeSettings:!0,currentGroupId:t.id})})]})}function gL({hiddenAccounts:t,accounts:e,sortedGroups:n,editingAccountId:r,setEditingAccountId:i,onUpdateAccount:o}){return t.length===0?null:d.jsx("div",{style:{marginBottom:"2rem"},children:d.jsxs(i0,{title:"Hidden Accounts",count:t.length,children:[d.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[d.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[d.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),d.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.map(l=>r===l.id?d.jsx(u0,{initialData:{nickname:l.nickname,account_group_id:l.account_group_id,is_income_account:l.is_income_account,is_income_default:l.is_income_default,is_outgo_account:l.is_outgo_account,is_outgo_default:l.is_outgo_default,on_budget:l.on_budget,is_active:l.is_active,is_hidden:l.is_hidden},onSubmit:u=>{o(l.id,u),i(null)},onCancel:()=>i(null),submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:l.account_group_id,hasExistingIncomeDefault:Object.entries(e).some(([u,h])=>h.is_income_default&&u!==l.id),hasExistingOutgoDefault:Object.entries(e).some(([u,h])=>h.is_outgo_default&&u!==l.id)},l.id):d.jsxs("div",{onClick:()=>i(l.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[d.jsx("span",{children:l.nickname}),d.jsx("span",{style:{color:ct(l.balance),fontWeight:500},children:zt(l.balance)})]},l.id))})]})})}function yL(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Xe(),{isLoading:r,isFetching:i,accounts:o}=In(),{month:l}=Xs(t,e,n),{accounts:u,accountsByGroup:h,hiddenAccounts:f,sortedGroups:p,currentBudget:g,error:b,setError:_,handleCreateAccount:w,handleUpdateAccount:x,handleDeleteAccount:S,handleMoveAccount:C,handleCreateGroup:T,handleUpdateGroup:I,handleDeleteGroup:M,handleMoveGroup:F}=pB(),G=Pi(),{addLoadingHold:D,removeLoadingHold:O}=Rn(),P=r||i||!g;sA(!P&&!!g),R.useEffect(()=>(P?D("accounts","Loading accounts..."):O("accounts"),()=>O("accounts")),[P,D,O]);const[$,V]=R.useState(null),[j,B]=R.useState(null),[k,Y]=R.useState(null),[X,W]=R.useState(!1),te=R.useMemo(()=>{const ne=Object.values(u),ae=ne.reduce((ce,fe)=>ce+(fe.balance??0),0);let Ee=0,Ae=0;for(const ce of ne){const fe=p.find(Me=>Me.id===ce.account_group_id);ce.on_budget===!0||ce.on_budget===void 0&&fe?.on_budget!==!1?Ee+=ce.balance??0:Ae+=ce.balance??0}return{count:ne.length,groupCount:p.filter(ce=>ce.id!==Vt).length,totalBalance:ae,onBudgetTotal:Ee,offBudgetTotal:Ae}},[u,p]),H=R.useMemo(()=>p.filter(ne=>ne.id!==Vt),[p]),re=R.useMemo(()=>({id:Vt,name:"Ungrouped",sort_order:H.length,expected_balance:"any",on_budget:null,is_active:null}),[H.length]),N=h[Vt]||[],q=R.useMemo(()=>l?xA(l,o):{},[l,o]),J={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid var(--border-medium)"};return R.useEffect(()=>{b&&(console.error("[Settings/Accounts] Error:",b),qn.add({type:"error",message:"Failed to update accounts. See console for details.",autoDismissMs:0}),_(null))},[b,_]),P||!g?P?null:d.jsx("p",{children:"No budget found. Please log in."}):d.jsxs("div",{children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:G?"1fr":"2fr 1fr 1fr 1fr 1.5fr 1fr",marginBottom:"1.5rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"var(--sticky-header-bg)",display:G?"block":"grid",gridTemplateColumns:G?void 0:"subgrid"},children:[d.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:d.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid var(--border-medium)"},children:d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),d.jsx("span",{style:{color:ct(te.onBudgetTotal),fontWeight:600},children:Vn(te.onBudgetTotal)})]}),te.offBudgetTotal!==0&&d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),d.jsx("span",{style:{fontWeight:600,opacity:.7},children:Vn(te.offBudgetTotal)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:ct(te.totalBalance),fontWeight:600},children:Vn(te.totalBalance)})]}),d.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:"Use  buttons to reorder accounts."})]})})}),!G&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:J,children:"Account"}),d.jsx("div",{style:{...J,textAlign:"right"},children:"Total"}),d.jsx("div",{style:{...J,textAlign:"right"},children:"Cleared"}),d.jsx("div",{style:{...J,textAlign:"right"},children:"Uncleared"}),d.jsx("div",{style:J,children:"Flags"}),d.jsx("div",{style:{...J,textAlign:"right"},children:"Actions"})]})]}),Object.keys(u).length===0&&H.length===0&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No accounts yet. Create an account type first, then add accounts!"}),H.map((ne,ae)=>{const Ee=h[ne.id]||[];return Ee.length===0&&k!==ne.id&&j!==ne.id?null:k===ne.id?d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(c1,{initialData:{name:ne.name,expected_balance:ne.expected_balance||"positive",on_budget:ne.on_budget??void 0,is_active:ne.is_active??void 0},onSubmit:Ae=>{I(ne.id,Ae),Y(null)},onCancel:()=>Y(null),submitLabel:"Save"})},ne.id):d.jsx(d1,{group:ne,accounts:Ee,allGroups:H,allAccounts:u,accountClearedBalances:q,editingAccountId:$,createForGroupId:j,setEditingAccountId:V,setCreateForGroupId:B,onUpdateAccount:(Ae,ce)=>{x(Ae,ce),V(null)},onDeleteAccount:S,onMoveAccount:C,onCreateAccount:w,isMobile:G,canMoveGroupUp:ae>0,canMoveGroupDown:ae<H.length-1,onEditGroup:()=>Y(ne.id),onDeleteGroup:()=>M(ne.id),onMoveGroupUp:()=>F(ne.id,"up"),onMoveGroupDown:()=>F(ne.id,"down")},ne.id)}),(N.length>0||j==="ungrouped")&&d.jsx(d1,{group:re,accounts:N,allGroups:H,allAccounts:u,accountClearedBalances:q,editingAccountId:$,createForGroupId:j,setEditingAccountId:V,setCreateForGroupId:B,onUpdateAccount:(ne,ae)=>{x(ne,ae),V(null)},onDeleteAccount:S,onMoveAccount:C,onCreateAccount:w,isMobile:G,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{}}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),d.jsx(gL,{hiddenAccounts:f,accounts:u,sortedGroups:H,editingAccountId:$,setEditingAccountId:V,onUpdateAccount:x}),X?d.jsx(c1,{onSubmit:ne=>{T(ne),W(!1)},onCancel:()=>W(!1),submitLabel:"Create Account Type"}):d.jsx($e,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>W(!0),children:"+ Add Account Type"})]})}function d0({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:i=[],showGroupSelector:o=!1,onDelete:l}){const[u,h]=R.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[f,p]=R.useState(t?.default_monthly_amount?.toString()||""),[g,b]=R.useState(t?.default_monthly_type||"fixed"),[_,w]=R.useState(!1);function x(S){if(S.preventDefault(),!u.name.trim())return;w(!0);const C=parseFloat(f),T=!isNaN(C)&&C>0;Promise.resolve(e({...u,description:u.description?.trim()||void 0,default_monthly_amount:T?C:void 0,default_monthly_type:T?g:void 0})).catch(I=>{console.error("[CategoryForm] Error submitting form:",I)}).finally(()=>{w(!1)}),n()}return d.jsxs(ki,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:x,children:[d.jsx(Bt,{label:"Category Name",htmlFor:"category-name",children:d.jsx(Mi,{id:"category-name",type:"text",value:u.name,onChange:S=>h({...u,name:S.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),d.jsx(Bt,{label:"Description (optional)",htmlFor:"category-description",children:d.jsx(t0,{id:"category-description",value:u.description||"",onChange:S=>h({...u,description:S.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&d.jsx(Bt,{label:"Category Group",htmlFor:"category-group",children:d.jsxs(Zu,{id:"category-group",value:u.category_group_id||en,onChange:S=>h({...u,category_group_id:S.target.value===en?null:S.target.value}),children:[d.jsx("option",{value:en,children:"Uncategorized"}),i.map(S=>d.jsx("option",{value:S.id,children:S.name},S.id))]})}),d.jsxs(Bt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[d.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[d.jsxs(Zu,{id:"default-type",value:g,onChange:S=>b(S.target.value),style:{width:"auto",flex:"0 0 auto"},children:[d.jsx("option",{value:"fixed",children:"Fixed $"}),d.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?d.jsx(Io,{id:"default-amount",value:f,onChange:p,placeholder:"$0.00"}):d.jsx(Mi,{id:"default-amount",type:"number",value:f,onChange:S=>p(S.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&d.jsx("span",{style:{opacity:.6},children:"%"})]}),d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[d.jsx(Qr,{id:"is-hidden",checked:u.is_hidden||!1,onChange:S=>h({...u,is_hidden:S.target.checked}),children:"Hidden category"}),d.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),d.jsxs(Ga,{children:[d.jsx($e,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:_,children:r}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"}),l&&d.jsx($e,{type:"button",variant:"secondary",actionName:"Delete Category",onClick:S=>{S.preventDefault(),l()},style:{color:"var(--color-validation-error)",borderColor:"var(--color-validation-error)"},children:" Delete"})]})]})}function h1({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=R.useState(t||{name:""}),[l,u]=R.useState(!1);function h(f){f.preventDefault(),i.name.trim()&&(u(!0),e(i))}return d.jsxs(ki,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[d.jsx(Bt,{label:"Group Name",htmlFor:"group-name",children:d.jsx(Mi,{id:"group-name",type:"text",value:i.name,onChange:f=>o({...i,name:f.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),d.jsxs(Ga,{children:[d.jsx($e,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:l,children:r}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function _L({category:t,catId:e,categoryIndex:n,categoryGroups:r,categoryBalances:i,loadingBalances:o,onEdit:l,onDelete:u,onMoveUp:h,onMoveDown:f,canMoveUp:p,canMoveDown:g,editingCategoryId:b,setEditingCategoryId:_,onUpdateCategory:w,isMobile:x}){const S=i[e]||{current:0,total:0};if(b===e)return d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:d.jsx(d0,{initialData:{name:t.name,description:t.description,category_group_id:t.category_group_id,default_monthly_amount:t.default_monthly_amount,default_monthly_type:t.default_monthly_type,is_hidden:t.is_hidden},onSubmit:M=>{w(e,M),_(null)},onCancel:()=>_(null),onDelete:()=>{t.name,u(e),_(null)},submitLabel:"Save",categoryGroups:r,showGroupSelector:!0})});if(x)return d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsx("span",{style:{fontWeight:500},children:t.name}),d.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:[t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Default"}),d.jsx("span",{style:{opacity:.7},children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${Zt(t.default_monthly_amount)}/mo`})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Available Now"}),d.jsx("span",{style:{color:dn(S.current),fontWeight:600},children:o?"...":_r(S.current)})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total Allocated"}),d.jsx("span",{style:{color:dn(S.total)},children:o?"...":_r(S.total)})]})]})]}),t.description&&d.jsx("p",{style:{fontSize:"0.8rem",opacity:.6,margin:"0 0 0.5rem 0"},children:t.description}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&d.jsxs("div",{style:{fontSize:"0.75rem",opacity:.8,marginBottom:"0.5rem"},children:["Default: ",t.default_monthly_type==="percentage"?d.jsxs(d.Fragment,{children:[d.jsxs("span",{style:{color:ge.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{color:ge.success,fontWeight:500},children:t.default_monthly_amount}),"/mo"]})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[d.jsx("button",{onClick:M=>{M.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),d.jsx("button",{onClick:M=>{M.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),d.jsx("button",{onClick:M=>{M.stopPropagation(),f()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const T=n%2===0?"transparent":"var(--row-alt-bg)",I={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:T,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 2fr 1fr"},children:[d.jsx("div",{style:{...I,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid var(--border-subtle)"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),d.jsx("div",{style:{...I,justifyContent:"flex-end",opacity:.7,fontSize:"0.85rem"},children:t.default_monthly_amount!==void 0&&t.default_monthly_amount>0?d.jsx("span",{children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${_r(t.default_monthly_amount)}/mo`}):d.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"var(--text-muted)"},children:""})}),d.jsx("div",{style:{...I,justifyContent:"flex-end",color:dn(S.current),fontWeight:600},children:o?"...":_r(S.current)}),d.jsx("div",{style:{...I,justifyContent:"flex-end",color:dn(S.total)},children:o?"...":_r(S.total)}),d.jsx("div",{style:{...I,opacity:.7,fontSize:"0.85rem"},children:t.description?d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description}):d.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"var(--text-muted)"},children:""})}),d.jsxs("div",{style:{...I,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:M=>{M.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),d.jsx("button",{onClick:M=>{M.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),d.jsx("button",{onClick:M=>{M.stopPropagation(),f()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function f1({group:t,categories:e,categoryGroups:n,categoryBalances:r,loadingBalances:i,editingCategoryId:o,createForGroupId:l,setEditingCategoryId:u,setCreateForGroupId:h,handleUpdateCategory:f,handleDeleteCategory:p,handleMoveCategory:g,handleCreateCategory:b,isMobile:_,isUngrouped:w,startRowIndex:x=0,canMoveGroupUp:S,canMoveGroupDown:C,onEditGroup:T,onDeleteGroup:I,onMoveGroupUp:M,onMoveGroupDown:F}){const G=R.useMemo(()=>[...e].sort(($,V)=>$[1].sort_order-V[1].sort_order),[e]),D=G.reduce(($,[V])=>{const j=r[V];return $+(j?.current||0)},0),O=x===0,P={padding:"0.6rem 0.5rem",marginTop:O?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600,minWidth:0,overflow:"visible"};return d.jsxs("div",{style:{display:"contents"},children:[!_&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{...P,opacity:w?.7:1},children:d.jsxs("span",{style:{whiteSpace:"nowrap"},children:[d.jsx("span",{children:t.name}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",G.length,")"]})]})}),d.jsx("div",{style:P}),d.jsx("div",{style:{...P,justifyContent:"flex-end",color:dn(D)},children:Yt.showGroupTotals}),d.jsx("div",{style:{...P,justifyContent:"flex-end",color:dn(G.reduce(($,[V])=>{const j=r[V];return $+(j?.total||0)},0))},children:Yt.showGroupTotals}),d.jsx("div",{style:P}),d.jsx("div",{style:{...P,justifyContent:"flex-end",gap:"0.25rem"},children:!w&&d.jsxs(d.Fragment,{children:[d.jsx($e,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),d.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),d.jsx("button",{onClick:()=>{t.name,I()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),d.jsxs("div",{style:Vf,children:[d.jsx("button",{onClick:M,disabled:!S,style:{...wa,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),d.jsx("button",{onClick:F,disabled:!C,style:{...wa,opacity:C?.6:.2,cursor:C?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})})]}),_&&d.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:O?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:w?.7:1,whiteSpace:"nowrap"},children:[t.name,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",G.length,")"]})]}),Yt.showGroupTotals]}),!w&&d.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[d.jsx($e,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),d.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),d.jsx("button",{onClick:()=>{t.name,I()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),d.jsxs("div",{style:Vf,children:[d.jsx("button",{onClick:M,disabled:!S,style:{...wa,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),d.jsx("button",{onClick:F,disabled:!C,style:{...wa,opacity:C?.6:.2,cursor:C?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]}),G.map(([$,V],j)=>{const B=x+j;return d.jsx(_L,{category:V,catId:$,categoryIndex:B,totalCategories:G.length,categoryGroups:n,categoryBalances:r,loadingBalances:i,onEdit:u,onDelete:p,onMoveUp:()=>g($,"up"),onMoveDown:()=>g($,"down"),canMoveUp:j>0,canMoveDown:j<G.length-1,editingCategoryId:o,setEditingCategoryId:u,onUpdateCategory:f,isMobile:_},$)}),l===t.id&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:d.jsx(d0,{initialData:{name:"",category_group_id:t.id},onSubmit:$=>b($,t.id),onCancel:()=>h(null),submitLabel:"Create",categoryGroups:n})})]})}function bL({onBudgetTotal:t,allocated:e,unallocated:n,relationshipMismatch:r,calculationMismatch:i}){return d.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:d.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid var(--border-medium)"},children:d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Categories:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"On Budget: "}),d.jsx("span",{style:{color:ct(t),fontWeight:600},children:Vn(t)})]}),d.jsx("span",{style:{opacity:r?1:.5,color:r?"var(--color-error)":void 0,fontWeight:r?700:void 0},children:r?"":"="}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Allocated: "}),d.jsx("span",{style:{color:Cc(e),fontWeight:600},children:Vn(e)})]}),d.jsx("span",{style:{opacity:r?1:.5,color:r?"var(--color-error)":void 0,fontWeight:r?700:void 0},children:"+"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Unallocated: "}),d.jsx("span",{style:{color:ct(n),fontWeight:600},children:Vn(n)})]}),d.jsx("span",{style:{opacity:.6},children:"Use  buttons to reorder categories."})]})})})}function vL(){const{isLoading:t,isFetching:e,totalAvailable:n}=In(),{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:l,hiddenCategories:u,sortedGroups:h,categoryBalances:f,isLoading:p,loadingBalances:g,error:b,setError:_,getOnBudgetTotal:w,handleCreateCategory:x,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateGroup:I,handleUpdateGroup:M,handleDeleteGroup:F,handleMoveGroup:G}=bB(),D=Pi(),{addLoadingHold:O,removeLoadingHold:P}=Rn(),$=t||p||e||!r;sA(!$&&!!r),R.useEffect(()=>($?O("categories","Loading categories..."):P("categories"),()=>P("categories")),[$,O,P]);const[V,j]=R.useState(null),[B,k]=R.useState(null),[Y,X]=R.useState(null),[W,te]=R.useState(!1),H=R.useMemo(()=>h.filter(ce=>ce.id!==en),[h]),re=R.useMemo(()=>({id:en,name:"Uncategorized",sort_order:H.length}),[H.length]),N=(l[en]||[]).sort((ce,fe)=>ce[1].sort_order-fe[1].sort_order);R.useEffect(()=>{b&&(console.error("[Settings/Categories] Error:",b),qn.add({type:"error",message:"Failed to update categories. See console for details.",autoDismissMs:0}),_(null))},[b,_]);const q=R.useMemo(()=>w(),[w]),{allocated:J,unallocated:ne,calculationMismatch:ae,relationshipMismatch:Ee}=vB({categories:i,categoryBalances:f,totalAvailable:n,onBudgetTotal:q,isDataLoading:$,loadingBalances:g,currentBudget:r});if($||!r)return $?null:d.jsx("p",{children:"No budget found. Please log in."});const Ae={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid var(--border-medium)"};return d.jsxs("div",{children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:D?"1fr":"2fr 1fr 1fr 1fr 2fr 1fr",marginBottom:"1.5rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"var(--sticky-header-bg)",display:D?"block":"grid",gridTemplateColumns:D?void 0:"subgrid"},children:[d.jsx(bL,{onBudgetTotal:q,allocated:J,unallocated:ne,relationshipMismatch:Ee,calculationMismatch:ae}),!D&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Ae,children:"Category"}),d.jsx("div",{style:{...Ae,textAlign:"right"},children:"Default"}),d.jsx("div",{style:{...Ae,textAlign:"right"},children:"Available Now"}),d.jsx("div",{style:{...Ae,textAlign:"right"},children:"Total Allocated"}),d.jsx("div",{style:Ae,children:"Description"}),d.jsx("div",{style:{...Ae,textAlign:"right"},children:"Actions"})]})]}),Object.keys(i).length===0&&o.length===0&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No categories yet. Create a group first, then add categories!"}),(()=>{const ce={};let fe=0;return H.forEach(Oe=>{const Me=(l[Oe.id]||[]).sort((Ge,tt)=>Ge[1].sort_order-tt[1].sort_order);ce[Oe.id]=fe,fe+=Me.length}),H.map((Oe,Me)=>{const Ge=(l[Oe.id]||[]).sort((tt,L)=>tt[1].sort_order-L[1].sort_order);return Ge.length===0&&Y!==Oe.id&&B!==Oe.id?null:Y===Oe.id?d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(h1,{initialData:{name:Oe.name},onSubmit:tt=>{M(Oe.id,tt),X(null)},onCancel:()=>X(null),submitLabel:"Save"})},Oe.id):d.jsx(f1,{group:Oe,categories:Ge,categoryGroups:o,categoryBalances:f,loadingBalances:g,editingCategoryId:V,createForGroupId:B,setEditingCategoryId:j,setCreateForGroupId:k,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateCategory:x,isMobile:D,canMoveGroupUp:Me>0,canMoveGroupDown:Me<H.length-1,onEditGroup:()=>X(Oe.id),onDeleteGroup:()=>F(Oe.id),onMoveGroupUp:()=>G(Oe.id,"up"),onMoveGroupDown:()=>G(Oe.id,"down"),startRowIndex:ce[Oe.id]??0},Oe.id)})})(),(N.length>0||B==="ungrouped")&&(()=>{const ce=H.reduce((fe,Oe)=>{const Me=(l[Oe.id]||[]).sort((Ge,tt)=>Ge[1].sort_order-tt[1].sort_order);return fe+Me.length},0);return d.jsx(f1,{group:re,categories:N,categoryGroups:o,categoryBalances:f,loadingBalances:g,editingCategoryId:V,createForGroupId:B,setEditingCategoryId:j,setCreateForGroupId:k,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateCategory:x,isMobile:D,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{},startRowIndex:ce})})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),u.length>0&&d.jsx("div",{style:{marginBottom:"2rem"},children:d.jsxs(i0,{title:"Hidden Categories",count:u.length,children:[d.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[d.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[d.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),d.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:u.map(([ce,fe])=>V===ce?d.jsx(d0,{initialData:{name:fe.name,description:fe.description,category_group_id:fe.category_group_id,default_monthly_amount:fe.default_monthly_amount,default_monthly_type:fe.default_monthly_type,is_hidden:fe.is_hidden},onSubmit:Oe=>{S(ce,Oe),j(null)},onCancel:()=>j(null),submitLabel:"Save",categoryGroups:o,showGroupSelector:!0},ce):d.jsxs("div",{onClick:()=>j(ce),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[d.jsx("span",{children:fe.name}),d.jsx("span",{style:{color:ct(fe.balance),fontWeight:500},children:Vn(fe.balance)})]},ce))})]})}),W?d.jsx(h1,{onSubmit:ce=>{I(ce),te(!1)},onCancel:()=>te(!1),submitLabel:"Create Group"}):d.jsx($e,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>te(!0),children:"+ Add Category Group"})]})}function xL(){const{selectedBudgetId:t,currentUserId:e}=Xe(),{addLoadingHold:n,removeLoadingHold:r}=Rn(),{budget:i,budgetUserIds:o,acceptedUserIds:l,isLoading:u}=In();R.useEffect(()=>(u||!i?n("users","Loading users..."):r("users"),()=>r("users")),[u,i,n,r]);const{inviteUser:h}=iL(),{revokeUser:f}=aL(),[p,g]=R.useState(""),[b,_]=R.useState(!1),[w,x]=R.useState(null),[S,C]=R.useState(null);if(u)return null;if(!i)return d.jsx("p",{children:"No budget found."});async function T(G){if(G.preventDefault(),!(!p.trim()||!i||!t)){_(!0),x(null),C(null);try{await h.mutateAsync({budgetId:t,userId:p.trim()}),g(""),C("Invite sent! The user can now accept the invitation from their account.")}catch(D){x(D instanceof Error?D.message:"Failed to invite user")}finally{_(!1)}}}async function I(G){if(!i||!t)return;if(G===i.owner_id){x("Cannot revoke the budget owner");return}if(G===e){x("Cannot revoke yourself from the budget");return}const D=l.includes(G);if(confirm(D?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){x(null),C(null);try{await f.mutateAsync({budgetId:t,userId:G}),C(D?"User access revoked.":"Invitation cancelled.")}catch(P){x(P instanceof Error?P.message:"Failed to revoke user")}}}const M=o.filter(G=>l.includes(G)),F=o.filter(G=>!l.includes(G));return d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),w&&d.jsxs("div",{style:{background:"var(--color-error-bg)",border:"1px solid var(--color-error-border)",color:"var(--color-error)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:w}),d.jsx("button",{onClick:()=>x(null),style:{background:"transparent",border:"none",color:"var(--color-error)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),S&&d.jsxs("div",{style:{background:"var(--color-success-bg)",border:"1px solid var(--color-success-border)",color:"var(--color-success)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:S}),d.jsx("button",{onClick:()=>C(null),style:{background:"transparent",border:"none",color:"var(--color-success)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",M.length,")"]}),M.length===0?d.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:M.map(G=>{const D=G===i.owner_id,O=G===e;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[d.jsx("div",{style:{flex:1,minWidth:0},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:G}),D&&d.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),O&&d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-success) 20%, transparent)",color:"var(--color-success)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!D&&!O&&d.jsx("button",{onClick:()=>I(G),style:{background:"transparent",border:"1px solid var(--color-error-border)",color:"var(--color-error)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},G)})})]}),F.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",F.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:F.map(G=>d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-warning) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-warning) 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[d.jsx("div",{style:{flex:1,minWidth:0},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:G}),d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-warning) 20%, transparent)",color:"var(--color-warning)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),d.jsx("button",{onClick:()=>I(G),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},G))})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),d.jsxs("form",{onSubmit:T,style:{display:"flex",gap:"0.75rem"},children:[d.jsx("input",{type:"text",value:p,onChange:G=>g(G.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),d.jsx("button",{type:"submit",disabled:b||!p.trim(),style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:b||!p.trim()?"not-allowed":"pointer",fontWeight:500,opacity:b||!p.trim()?.7:1,whiteSpace:"nowrap"},children:b?"Inviting...":"Send Invite"})]}),d.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),d.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:i.id})]})]})}const wL=["budget","feedback","migration","tests"];function SL(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:i}=Xe(),l=Ni().get_current_firebase_user(),u=zT(l?.uid||null,l?.email||null);R.useLayoutEffect(()=>{i("Budget Admin")},[i]);const h=er(),f=h.pathname==="/budget/admin",p=R.useMemo(()=>{const w=h.pathname;return w.includes("/admin/budget")?"budget":w.includes("/admin/feedback")?"feedback":w.includes("/admin/migration")?"migration":w.includes("/admin/tests")?"tests":"budget"},[h.pathname]),g=p==="tests";R.useEffect(()=>{f||r(p)},[p,f,r]);function b(){return!wL.includes(n)||n==="tests"&&!e?"budget":n}const _=R.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return u.isLoading||u.isFetching?null:t?!e&&g?d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(An,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):d.jsxs("div",{children:[d.jsx(qf,{mode:"link",linkPrefix:"/budget/admin",tabs:_,activeTab:p}),f?d.jsx(Wf,{to:`/budget/admin/${b()}`,replace:!0}):d.jsx(Qf,{})]}):d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(An,{to:"/budget",children:"Go to Budget "})})]})}function EL(){const{addLoadingHold:t,removeLoadingHold:e}=Rn(),{isAdmin:n}=Xe(),{budget:r,accounts:i,accountGroups:o,categories:l,categoryGroups:u,isOwner:h,isLoading:f}=In();return R.useEffect(()=>(f?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[f,t,e]),f?null:r?d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),d.jsx("strong",{children:r.name})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),d.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),d.jsx("strong",{children:r.owner_email||r.owner_id})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),d.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",d.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),d.jsx("button",{onClick:()=>{const p={...r,accounts:i,account_groups:o,categories:l,category_groups:u,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),b=URL.createObjectURL(g),_=document.createElement("a");_.href=b,_.download=`budget_${r.id}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(b)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):d.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function m1({selectedType:t,onSelect:e}){return d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=Ju[n],i=t==="feature"?"new_feature":t,o=i===n||!i&&n==="bug";return d.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"var(--text-muted)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&d.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function CL(){const[t,e]=R.useState(null),[n,r]=R.useState(null),[i,o]=R.useState(!1),[l,u]=R.useState(""),[h,f]=R.useState("bug"),[p,g]=R.useState(null),[b,_]=R.useState(!1),[w,x]=R.useState(null),S=R.useContext(wd),T=Ni().get_current_firebase_user(),I=Rt(),M=TP(),{submitFeedback:F}=hA(),{toggleFeedback:G}=Y3(),{updateSortOrder:D}=X3(),O=M.data?.items||[],P=Pi(),{addLoadingHold:$,removeLoadingHold:V}=Rn();R.useEffect(()=>(M.isLoading?$("settings-feedback","Loading feedback..."):V("settings-feedback"),()=>V("settings-feedback")),[M.isLoading,$,V]);function j(ce){ce.preventDefault(),!(!l.trim()||!S.username||!T)&&(F.mutate({userId:T.uid,userEmail:S.username,text:l.trim(),feedbackType:h,currentPath:"/settings/feedback"}),u(""),f("bug"),o(!1))}function B(ce){ce.is_done?k(ce):g(ce)}async function k(ce){try{await G.mutateAsync({item:ce})}catch(fe){console.error("[Feedback] Error updating feedback:",fe),qn.add({type:"error",message:"Failed to update feedback",autoDismissMs:5e3})}}function Y(){p&&(k(p),g(null))}async function X(){_(!1);const ce="mark-all-feedback-complete";$(ce,`Marking ${H.length} item${H.length!==1?"s":""} as complete...`);try{const fe=new Date().toISOString(),Oe=new Set(H.map(de=>de.id)),Me=new Map;for(const de of H)Me.has(de.doc_id)||Me.set(de.doc_id,[]),Me.get(de.doc_id).push(de);const Ge=[];for(const[de,ye]of Me){const ee=(async()=>{const oe=(await dA(de,"mark all feedback complete")).items.map(Se=>Oe.has(Se.id)?{...Se,is_done:!0,completed_at:fe}:Se);await s0({docId:de,items:oe,description:`marking ${ye.length} feedback item${ye.length!==1?"s":""} as complete`})})();Ge.push(ee)}await Promise.all(Ge);const tt=we.feedback(),L=I.getQueryData(tt);L&&I.setQueryData(tt,{items:L.items.map(de=>Oe.has(de.id)?{...de,is_done:!0,completed_at:fe}:de)}),await I.invalidateQueries({queryKey:tt}),qn.add({type:"success",message:`Marked ${H.length} item${H.length!==1?"s":""} as complete`,autoDismissMs:3e3})}catch(fe){console.error("[Feedback] Error marking all as complete:",fe),qn.add({type:"error",message:"Failed to mark all items as complete",autoDismissMs:5e3}),await I.invalidateQueries({queryKey:we.feedback()})}finally{V(ce)}}function W(){X()}async function te(ce){if(w){try{const Oe=O.filter(Me=>Me.doc_id===w.doc_id).map(Me=>({id:Me.id,text:Me.text,created_at:Me.created_at,is_done:Me.is_done,completed_at:Me.completed_at,sort_order:Me.sort_order,feedback_type:Me.id===w.id?ce:Me.feedback_type}));await D.mutateAsync({docId:w.doc_id,items:Oe})}catch(fe){console.error("[Feedback] Error updating feedback type:",fe),qn.add({type:"error",message:"Failed to update feedback type",autoDismissMs:5e3})}x(null)}}const H=O.filter(ce=>!ce.is_done).sort((ce,fe)=>ce.sort_order-fe.sort_order),re=O.filter(ce=>ce.is_done).sort((ce,fe)=>new Date(fe.completed_at||0).getTime()-new Date(ce.completed_at||0).getTime());function N(ce,fe){e(fe),ce.dataTransfer.effectAllowed="move"}function q(ce,fe){ce.preventDefault(),fe!==t&&r(fe)}function J(){r(null)}function ne(){e(null),r(null)}async function ae(ce,fe){if(ce.preventDefault(),!t||t===fe){ne();return}const Oe=H.findIndex(de=>de.id===t),Me=[...H],[Ge]=Me.splice(Oe,1);if(fe==="__end__")Me.push(Ge);else{const de=Me.findIndex(ye=>ye.id===fe);Me.splice(de,0,Ge)}const tt=Me.map((de,ye)=>({...de,sort_order:ye}));ne();const L=new Map;for(const de of tt)L.has(de.doc_id)||L.set(de.doc_id,[]),L.get(de.doc_id).push({id:de.id,text:de.text,created_at:de.created_at,is_done:de.is_done,completed_at:de.completed_at,sort_order:de.sort_order,feedback_type:de.feedback_type});for(const de of re)L.has(de.doc_id)||L.set(de.doc_id,[]),L.get(de.doc_id).push({id:de.id,text:de.text,created_at:de.created_at,is_done:de.is_done,completed_at:de.completed_at,sort_order:de.sort_order,feedback_type:de.feedback_type});try{for(const[de,ye]of L)await D.mutateAsync({docId:de,items:ye})}catch(de){console.error("[Feedback] Error saving order:",de),qn.add({type:"error",message:"Failed to save order",autoDismissMs:5e3})}}function Ee(){const ce=Ae(H),fe=new Blob([ce],{type:"text/markdown"}),Oe=URL.createObjectURL(fe),Me=document.createElement("a");Me.href=Oe,Me.download=`feedback-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(Me),Me.click(),document.body.removeChild(Me),URL.revokeObjectURL(Oe)}function Ae(ce){let fe=`# Feedback Export

`;return fe+=`Generated: ${new Date().toISOString()}

`,ce.length>0&&(fe+=`## Pending

`,ce.forEach((Oe,Me)=>{const Ge=Oe.feedback_type?Ju[Oe.feedback_type]?.label||Oe.feedback_type:"Unknown";fe+=`### ${Me+1}. [${Ge}] ${Oe.text.split(`
`)[0].substring(0,60)}${Oe.text.split(`
`)[0].length>60?"...":""}

`,fe+=`- **Type:** ${Ge}
`,fe+=`- **Created:** ${Oe.created_at}
`,fe+=`- **User:** ${Oe.user_email||Oe.doc_id}
`,fe+=`- **ID:** ${Oe.id}

`,fe+=`${Oe.text}

`,fe+=`---

`})),fe}return M.isLoading?null:d.jsxs("div",{children:[d.jsxs("div",{style:{display:"flex",flexDirection:P?"column":"row",justifyContent:"space-between",alignItems:P?"stretch":"flex-start",gap:P?"0.75rem":"1rem",marginTop:"1.5rem",marginBottom:"0.5rem"},children:[d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Feedback"}),d.jsx("p",{style:{...$T,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexDirection:P?"column":"row"},children:[d.jsx($e,{variant:"secondary",actionName:"Download Feedback as Markdown",onClick:Ee,disabled:H.length===0,style:P?{width:"100%"}:void 0,children:"Download Markdown"}),d.jsx($e,{variant:"secondary",actionName:"Mark All Complete",onClick:()=>_(!0),disabled:H.length===0,style:P?{width:"100%"}:void 0,children:"Mark All Complete"})]})]}),d.jsxs("div",{style:LS,children:[H.length===0&&!i&&d.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),H.map(ce=>d.jsx(Mz,{item:ce,isDragging:t===ce.id,isDragOver:n===ce.id,onDragStart:fe=>N(fe,ce.id),onDragOver:fe=>q(fe,ce.id),onDragLeave:J,onDragEnd:ne,onDrop:fe=>ae(fe,ce.id),onToggleDone:()=>B(ce),onTypeClick:()=>x(ce)},ce.id)),t&&H.length>0&&d.jsx(Q3,{isActive:n==="__end__",onDragOver:ce=>q(ce,"__end__"),onDragLeave:J,onDrop:ce=>ae(ce,"__end__")})]}),i?d.jsxs(ki,{actionName:"Add Feedback",onSubmit:j,children:[d.jsx(m1,{selectedType:h,onSelect:f}),d.jsx(t0,{value:l,onChange:ce=>u(ce.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),d.jsxs(Ga,{children:[d.jsx($e,{type:"submit",actionName:"Add Feedback",disabled:!l.trim(),children:"Add Feedback"}),d.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{o(!1),u(""),f("bug")},children:"Cancel"})]})]}):d.jsx($e,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>o(!0),children:"+ Add Feedback"}),re.length>0&&d.jsx(i0,{title:"Completed",count:re.length,children:d.jsx("div",{style:{...LS,marginTop:"0.5rem"},children:re.map(ce=>d.jsx(Oz,{item:ce,onToggleDone:()=>B(ce),onTypeClick:()=>x(ce)},ce.id))})}),d.jsxs(Ks,{isOpen:p!==null,onClose:()=>g(null),title:"Mark as Complete",children:[d.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),p&&d.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"var(--row-alt-bg)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',p.text,'"']}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>g(null),children:"Cancel"}),d.jsx($e,{variant:"primary",actionName:"Confirm Mark Complete",onClick:Y,children:"Mark Complete"})]})]}),d.jsxs(Ks,{isOpen:b,onClose:()=>_(!1),title:"Mark All as Complete",children:[d.jsxs("p",{style:{margin:"0 0 1.5rem 0"},children:["Are you sure you want to mark all ",H.length," pending feedback item",H.length!==1?"s":""," as complete?"]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx($e,{variant:"secondary",actionName:"Cancel Mark All Complete",onClick:()=>_(!1),children:"Cancel"}),d.jsx($e,{variant:"primary",actionName:"Confirm Mark All Complete",onClick:W,children:"Mark All Complete"})]})]}),d.jsxs(Ks,{isOpen:w!==null,onClose:()=>x(null),title:"Change Feedback Type",children:[d.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),d.jsx(m1,{selectedType:w?.feedback_type||"bug",onSelect:te}),d.jsx($e,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>x(null),style:{width:"100%"},children:"Cancel"})]})]})}function TL(){Be.clear(),window.location.reload()}function AL(){const e=Ni().get_current_firebase_user(),{selectedBudgetId:n}=Xe(),r=j3({currentUser:e}),i=D3({currentUser:e}),o=O3({currentUser:e}),l=C3({currentUser:e}),u=a3({currentUser:e}),h=n3({currentUser:e}),f=h3({currentUser:e}),p=WB({currentUser:e}),g=B3({currentUser:e}),b=U3({currentUser:e}),_=$3({currentUser:e,budgetId:n}),w=W3({currentUser:e}),x=FB({currentUser:e}),S=VB({currentUser:e}),C=r.isScanning||i.isScanning||o.isScanning||l.isScanning||u.isScanning||h.isScanning||f.isScanning||p.isScanning||g.isScanning||b.isScanning||x.isScanning||S.isScanning,T=r.isRunning||i.isRunning||o.isRunning||u.isRunning||h.isRunning||f.isRunning||p.isRunning||g.isRunning||b.isRunning||x.isDeleting||S.isDeleting||_.isDownloading||w.isUploading,I=async()=>{await Promise.all([r.scanStatus(),i.scanStatus(),o.scanStatus(),l.scan(),u.scanStatus(),h.scanStatus(),f.scanStatus(),p.scan(),g.scanStatus(),b.scanStatus(),x.scanStatus(),S.scanStatus()])};return d.jsxs("div",{children:[d.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsx("h2",{style:{margin:0},children:"Data Migrations"}),d.jsxs("button",{onClick:I,disabled:C||T,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:C||T?"not-allowed":"pointer",fontWeight:500,opacity:C||T?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[d.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:C?d.jsx(Hn,{noMargin:!0}):""}),"Refresh All"]})]}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),d.jsx(Yz,{disabled:!e,onDownloadBackup:_.downloadBudget,isDownloadingBackup:_.isDownloading,removeTotalFieldsMigration:{status:r.status,hasData:!!r.status,needsMigration:r.needsMigration,totalItemsToFix:r.totalItemsToFix,isScanning:r.isScanning,isRunning:r.isRunning,result:r.result,scanStatus:r.scanStatus,runMigration:r.runMigration},removePreviousMonthIncomeMigration:{status:i.status,hasData:!!i.status,needsMigration:i.needsMigration,totalItemsToFix:i.totalItemsToFix,isScanning:i.isScanning,isRunning:i.isRunning,result:i.result,scanStatus:i.scanStatus,runMigration:i.runMigration},percentageIncomeMonthsBackMigration:{status:o.status,hasData:!!o.status,needsMigration:o.needsMigration,totalItemsToFix:o.totalItemsToFix,isScanning:o.isScanning,isRunning:o.isRunning,result:o.result,scanStatus:o.scanStatus,runMigration:o.runMigration}}),d.jsx(n4,{disabled:!e,onDownloadBackup:_.downloadBudget,isDownloadingBackup:_.isDownloading,accountCategoryValidation:{status:l.status,hasData:!!l.status,hasViolations:l.hasViolations,violationCount:l.violationCount,isScanning:l.isScanning,report:l.report,scan:l.scan},orphanedIdCleanup:{status:u.status,hasData:!!u.status,hasItemsToFix:u.hasItemsToFix,totalOrphaned:u.status?u.status.orphanedCategoryIds+u.status.orphanedAccountIds:0,isScanning:u.isScanning,isRunning:u.isRunning,result:u.result,scanStatus:u.scanStatus,runMigration:u.runMigration},expenseToAdjustment:{status:h.status,hasData:!!h.status,hasItemsToMigrate:h.hasItemsToMigrate,totalToMigrate:h.status?.expensesToMigrate??0,isScanning:h.isScanning,isRunning:h.isRunning,result:h.result,scanStatus:h.scanStatus,runMigration:h.runMigration},adjustmentsToTransfers:{status:f.status,hasData:!!f.status,hasPairsToConvert:f.hasPairsToConvert,totalPairs:f.status?.pairsFound??0,isScanning:f.isScanning,isRunning:f.isRunning,result:f.result,scanStatus:f.scanStatus,runMigration:f.runMigration},precisionCleanup:{status:p.status,hasData:p.hasData,hasIssues:p.hasIssues,totalIssues:p.totalIssues,isScanning:p.isScanning,isRunning:p.isRunning,result:p.result,scan:p.scan,runCleanup:p.runCleanup},recalculateStartBalances:{status:g.status,hasData:!!g.status,needsMigration:g.needsMigration,totalItemsToFix:g.totalItemsToFix,isScanning:g.isScanning,isRunning:g.isRunning,result:g.result,scanStatus:g.scanStatus,runMigration:g.runMigration},repairMonthMap:{status:b.status,hasData:!!b.status,needsMigration:b.needsMigration,totalItemsToFix:b.totalItemsToFix,isScanning:b.isScanning,isRunning:b.isRunning,result:b.result,scanStatus:b.scanStatus,runMigration:b.runMigration}}),d.jsx(o4,{disabled:!e,onDownloadBackup:_.downloadBudget,isDownloadingBackup:_.isDownloading,budgetDownloadUpload:{isDownloading:_.isDownloading,downloadProgress:_.progress,downloadError:_.error,downloadBudget:_.downloadBudget,isScanning:w.isScanning,isUploading:w.isUploading,uploadStatus:w.status,uploadProgress:w.progress,uploadError:w.error,uploadResult:w.result,scanZipFile:w.scanZipFile,uploadBudget:w.uploadBudget},deleteAllMonths:{status:x.status,hasData:!!x.status,monthsCount:x.status?.monthsCount??0,budgetCount:x.status?.budgetCount??0,isScanning:x.isScanning,isDeleting:x.isDeleting,deleteResult:x.deleteResult,deleteProgress:x.deleteProgress,scanStatus:x.scanStatus,deleteAllMonths:x.deleteAllMonths},deleteSampleUserBudget:{status:S.status,hasData:!!S.status,totalBudgets:S.status?.totalBudgets??0,totalMonths:S.status?.totalMonths??0,isScanning:S.isScanning,isDeleting:S.isDeleting,deleteResult:S.deleteResult,deleteProgress:S.deleteProgress,scanStatus:S.scanStatus,deleteSampleUserBudget:S.deleteSampleUserBudget},onClearCache:TL}),d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:d.jsxs("p",{style:{margin:0,opacity:.7},children:[d.jsx("strong",{children:"Note:"})," These migrations will process ",d.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),d.jsx(_A,{})]})}function Ul({name:t,description:e,expectedBehavior:n,result:r,onRun:i,disabled:o,expectedToSucceed:l}){const u=r?.status==="passed"?ge.success:r?.status==="failed"?ge.danger:r?.status==="running"?ge.warning:"inherit";return d.jsxs("div",{style:{...X_,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[d.jsxs("div",{style:{flex:1},children:[d.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),d.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),d.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:l?ge.success:ge.warning},children:["Expected: ",n]})]}),d.jsx($e,{onClick:i,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&d.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${u} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${u} 30%, transparent)`,fontSize:"0.85rem",color:u},children:r.message})]})}function jL({totalCount:t,passedCount:e,failedCount:n}){return d.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[d.jsxs("span",{children:["Total: ",d.jsx("strong",{children:t})]}),d.jsxs("span",{style:{color:ge.success},children:["Passed: ",d.jsx("strong",{children:e})]}),d.jsxs("span",{style:{color:ge.danger},children:["Failed: ",d.jsx("strong",{children:n})]})]})}const p1=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function RL(){const{currentUserId:t}=Xe(),[e,n]=R.useState([]),[r,i]=R.useState(!1);function o(_,w){n(x=>x.map(S=>S.name===_?{...S,...w}:S))}async function l(_,w,x){o(_,{status:"running",message:"Running..."});try{const S=await w();x?o(_,{status:"failed",message:` ${S}`}):o(_,{status:"passed",message:` ${S}`})}catch(S){const C=S instanceof Error?S.message:"Unknown error";x?o(_,{status:"passed",message:` Blocked as expected: ${C}`}):o(_,{status:"failed",message:` ${C}`})}}async function u(){i(!0),n(p1.map(_=>({..._,status:"pending",message:""})));for(const _ of p1)await h(_.name);i(!1)}async function h(_){switch(_){case"Read unauthorized budget":await l(_,async()=>(await At("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await l(_,async()=>(await At("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await l(_,async()=>(await At("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:w}=await At("users",t,"security test: reading own user to get current is_admin value"),x=w?.permission_flags?.is_admin??!1;return await Di("users",t,{"permission_flags.is_admin":!x},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:w}=await At("users",t,"security test: reading own user to get current is_test value"),x=w?.permission_flags?.is_test??!1;return await Di("users",t,{"permission_flags.is_test":!x},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{exists:w}=await At("users",t,"security test: reading own user document (should succeed)");if(w)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function f(_){e.find(x=>x.name===_)||n(x=>[...x,{name:_,status:"pending",message:"",expectedToFail:!0}]),i(!0),await h(_),i(!1)}const p=e.filter(_=>_.status==="passed").length,g=e.filter(_=>_.status==="failed").length,b=e.length;return d.jsxs("div",{children:[d.jsx("p",{style:$T,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),d.jsx("div",{style:{marginBottom:"1.5rem"},children:d.jsx($e,{onClick:u,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&d.jsx(jL,{totalCount:b,passedCount:p,failedCount:g}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[d.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),d.jsx(Ul,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read unauthorized budget"),onRun:()=>f("Read unauthorized budget"),disabled:r}),d.jsx(Ul,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read another user's document"),onRun:()=>f("Read another user's document"),disabled:r}),d.jsx(Ul,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(_=>_.name==="Read unauthorized budget month"),onRun:()=>f("Read unauthorized budget month"),disabled:r}),d.jsx(Ul,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_admin in own permission_flags"),onRun:()=>f("Toggle is_admin in own permission_flags"),disabled:r}),d.jsx(Ul,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_test in own permission_flags"),onRun:()=>f("Toggle is_test in own permission_flags"),disabled:r}),d.jsx(Ul,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(_=>_.name==="Read own user document"),onRun:()=>f("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&d.jsxs(J_,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function IL({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=Rn(),r=R.useContext(wd),i=er();return R.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?d.jsx(d.Fragment,{children:t}):d.jsx(Qf,{}):d.jsx(Wf,{to:"/account",state:{from:i.pathname},replace:!0}):null}function DL(){const{addLoadingHold:t,removeLoadingHold:e}=Rn(),{isInitialized:n,pageTitle:r}=Xe(),{isLoading:i,error:o}=In();return R.useEffect(()=>{n?e("budget-init"):t("budget-init",i?"Fetching data from server...":"Loading budget...")},[n,i,t,e]),R.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),d.jsx("div",{style:Ff,children:d.jsxs("p",{style:{color:"var(--color-error)"},children:["Error: ",o.message]})})):d.jsx("div",{style:{...Ff,paddingBottom:"5rem"},children:d.jsxs(mA,{children:[d.jsx(nz,{title:r}),n&&d.jsx(Qf,{})]})})}const kL={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function ML(){const{isLoading:t,loadingMessage:e}=Rn();return t?d.jsx(l4,{message:e}):null}function OL(){const[t,e]=R.useState(null);return R.useEffect(()=>qn.subscribe(e),[]),t?d.jsx(sz,{item:t,onDismiss:n=>qn.remove(n)}):null}function NL(){return Nn(),d.jsxs(d.Fragment,{children:[d.jsxs(uI,{children:[d.jsx(bn,{path:"/",element:d.jsx(c4,{})}),d.jsx(bn,{path:"/account",element:d.jsx(u4,{})}),d.jsx(bn,{path:"/budget",element:d.jsx(IL,{}),children:d.jsxs(bn,{element:d.jsx(DL,{}),children:[d.jsx(bn,{index:!0,element:d.jsx(o1,{})}),d.jsx(bn,{path:":year/:month/:tab/:view?",element:d.jsx(o1,{})}),d.jsx(bn,{path:"analytics",element:d.jsx(nL,{})}),d.jsx(bn,{path:"my-budgets",element:d.jsx(dL,{})}),d.jsxs(bn,{path:"settings",element:d.jsx(fL,{}),children:[d.jsx(bn,{index:!0,element:d.jsx(Wf,{to:"general",replace:!0})}),d.jsx(bn,{path:"general",element:d.jsx(mL,{})}),d.jsx(bn,{path:"accounts",element:d.jsx(yL,{})}),d.jsx(bn,{path:"categories",element:d.jsx(vL,{})}),d.jsx(bn,{path:"users",element:d.jsx(xL,{})})]}),d.jsxs(bn,{path:"admin",element:d.jsx(SL,{}),children:[d.jsx(bn,{path:"budget",element:d.jsx(EL,{})}),d.jsx(bn,{path:"feedback",element:d.jsx(CL,{})}),d.jsx(bn,{path:"migration",element:d.jsx(AL,{})}),d.jsx(bn,{path:"tests",element:d.jsx(RL,{})})]})]})})]}),d.jsx(J3,{}),d.jsx(_A,{}),d.jsx(OL,{})]})}function PL(){const[t,e]=R.useState(kL),n=Ni(),r=R.useRef(!1),{addLoadingHold:i,removeLoadingHold:o}=Rn();return R.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(l=>{e({is_logged_in:l!=null,is_auth_checked:!0,username:l?.email??"",set_user_context:e})}))},[n]),R.useEffect(()=>{t.is_auth_checked?o("auth"):i("auth","Authenticating...")},[t.is_auth_checked,i,o]),t.is_auth_checked?d.jsx(wd.Provider,{value:t,children:d.jsx(RM,{children:d.jsx(Iz,{children:d.jsx(zB,{children:d.jsx(NI,{children:d.jsx(NL,{})})})})})}):null}function BL(){return d.jsxs(GI,{children:[d.jsx(ML,{}),d.jsx(PL,{})]})}uR.createRoot(document.getElementById("root")).render(d.jsx(R.StrictMode,{children:d.jsx(BL,{})}));
