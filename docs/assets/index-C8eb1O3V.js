(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Hh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ig={exports:{}},Su={};var Mx;function tR(){if(Mx)return Su;Mx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,o){var l=null;if(o!==void 0&&(l=""+o),i.key!==void 0&&(l=""+i.key),"key"in i){o={};for(var d in i)d!=="key"&&(o[d]=i[d])}else o=i;return i=o.ref,{$$typeof:t,type:r,key:l,ref:i!==void 0?i:null,props:o}}return Su.Fragment=e,Su.jsx=n,Su.jsxs=n,Su}var Ox;function nR(){return Ox||(Ox=1,Ig.exports=tR()),Ig.exports}var u=nR(),kg={exports:{}},tt={};var Nx;function rR(){if(Nx)return tt;Nx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),b=Symbol.iterator;function _(B){return B===null||typeof B!="object"?null:(B=b&&B[b]||B["@@iterator"],typeof B=="function"?B:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function C(B,H,ne){this.props=B,this.context=H,this.refs=S,this.updater=ne||w}C.prototype.isReactComponent={},C.prototype.setState=function(B,H){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,H,"setState")},C.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function T(){}T.prototype=C.prototype;function R(B,H,ne){this.props=B,this.context=H,this.refs=S,this.updater=ne||w}var k=R.prototype=new T;k.constructor=R,x(k,C.prototype),k.isPureReactComponent=!0;var V=Array.isArray;function $(){}var D={H:null,A:null,T:null,S:null},O=Object.prototype.hasOwnProperty;function N(B,H,ne){var re=ne.ref;return{$$typeof:t,type:B,key:H,ref:re!==void 0?re:null,props:ne}}function U(B,H){return N(B.type,H,B.props)}function q(B){return typeof B=="object"&&B!==null&&B.$$typeof===t}function I(B){var H={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(ne){return H[ne]})}var z=/\/+/g;function M(B,H){return typeof B=="object"&&B!==null&&B.key!=null?I(""+B.key):H.toString(36)}function X(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then($,$):(B.status="pending",B.then(function(H){B.status==="pending"&&(B.status="fulfilled",B.value=H)},function(H){B.status==="pending"&&(B.status="rejected",B.reason=H)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function Y(B,H,ne,re,ce){var _e=typeof B;(_e==="undefined"||_e==="boolean")&&(B=null);var Te=!1;if(B===null)Te=!0;else switch(_e){case"bigint":case"string":case"number":Te=!0;break;case"object":switch(B.$$typeof){case t:case e:Te=!0;break;case p:return Te=B._init,Y(Te(B._payload),H,ne,re,ce)}}if(Te)return ce=ce(B),Te=re===""?"."+M(B,0):re,V(ce)?(ne="",Te!=null&&(ne=Te.replace(z,"$&/")+"/"),Y(ce,H,ne,"",function(Ne){return Ne})):ce!=null&&(q(ce)&&(ce=U(ce,ne+(ce.key==null||B&&B.key===ce.key?"":(""+ce.key).replace(z,"$&/")+"/")+Te)),H.push(ce)),1;Te=0;var oe=re===""?".":re+":";if(V(B))for(var be=0;be<B.length;be++)re=B[be],_e=oe+M(re,be),Te+=Y(re,H,ne,_e,ce);else if(be=_(B),typeof be=="function")for(B=be.call(B),be=0;!(re=B.next()).done;)re=re.value,_e=oe+M(re,be++),Te+=Y(re,H,ne,_e,ce);else if(_e==="object"){if(typeof B.then=="function")return Y(X(B),H,ne,re,ce);throw H=String(B),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.")}return Te}function G(B,H,ne){if(B==null)return B;var re=[],ce=0;return Y(B,re,"","",function(_e){return H.call(ne,_e,ce++)}),re}function Z(B){if(B._status===-1){var H=B._result;H=H(),H.then(function(ne){(B._status===0||B._status===-1)&&(B._status=1,B._result=ne)},function(ne){(B._status===0||B._status===-1)&&(B._status=2,B._result=ne)}),B._status===-1&&(B._status=0,B._result=H)}if(B._status===1)return B._result.default;throw B._result}var W=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var H=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(H))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)},te={map:G,forEach:function(B,H,ne){G(B,function(){H.apply(this,arguments)},ne)},count:function(B){var H=0;return G(B,function(){H++}),H},toArray:function(B){return G(B,function(H){return H})||[]},only:function(B){if(!q(B))throw Error("React.Children.only expected to receive a single React element child.");return B}};return tt.Activity=g,tt.Children=te,tt.Component=C,tt.Fragment=n,tt.Profiler=i,tt.PureComponent=R,tt.StrictMode=r,tt.Suspense=h,tt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,tt.__COMPILER_RUNTIME={__proto__:null,c:function(B){return D.H.useMemoCache(B)}},tt.cache=function(B){return function(){return B.apply(null,arguments)}},tt.cacheSignal=function(){return null},tt.cloneElement=function(B,H,ne){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var re=x({},B.props),ce=B.key;if(H!=null)for(_e in H.key!==void 0&&(ce=""+H.key),H)!O.call(H,_e)||_e==="key"||_e==="__self"||_e==="__source"||_e==="ref"&&H.ref===void 0||(re[_e]=H[_e]);var _e=arguments.length-2;if(_e===1)re.children=ne;else if(1<_e){for(var Te=Array(_e),oe=0;oe<_e;oe++)Te[oe]=arguments[oe+2];re.children=Te}return N(B.type,ce,re)},tt.createContext=function(B){return B={$$typeof:l,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:o,_context:B},B},tt.createElement=function(B,H,ne){var re,ce={},_e=null;if(H!=null)for(re in H.key!==void 0&&(_e=""+H.key),H)O.call(H,re)&&re!=="key"&&re!=="__self"&&re!=="__source"&&(ce[re]=H[re]);var Te=arguments.length-2;if(Te===1)ce.children=ne;else if(1<Te){for(var oe=Array(Te),be=0;be<Te;be++)oe[be]=arguments[be+2];ce.children=oe}if(B&&B.defaultProps)for(re in Te=B.defaultProps,Te)ce[re]===void 0&&(ce[re]=Te[re]);return N(B,_e,ce)},tt.createRef=function(){return{current:null}},tt.forwardRef=function(B){return{$$typeof:d,render:B}},tt.isValidElement=q,tt.lazy=function(B){return{$$typeof:p,_payload:{_status:-1,_result:B},_init:Z}},tt.memo=function(B,H){return{$$typeof:f,type:B,compare:H===void 0?null:H}},tt.startTransition=function(B){var H=D.T,ne={};D.T=ne;try{var re=B(),ce=D.S;ce!==null&&ce(ne,re),typeof re=="object"&&re!==null&&typeof re.then=="function"&&re.then($,W)}catch(_e){W(_e)}finally{H!==null&&ne.types!==null&&(H.types=ne.types),D.T=H}},tt.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},tt.use=function(B){return D.H.use(B)},tt.useActionState=function(B,H,ne){return D.H.useActionState(B,H,ne)},tt.useCallback=function(B,H){return D.H.useCallback(B,H)},tt.useContext=function(B){return D.H.useContext(B)},tt.useDebugValue=function(){},tt.useDeferredValue=function(B,H){return D.H.useDeferredValue(B,H)},tt.useEffect=function(B,H){return D.H.useEffect(B,H)},tt.useEffectEvent=function(B){return D.H.useEffectEvent(B)},tt.useId=function(){return D.H.useId()},tt.useImperativeHandle=function(B,H,ne){return D.H.useImperativeHandle(B,H,ne)},tt.useInsertionEffect=function(B,H){return D.H.useInsertionEffect(B,H)},tt.useLayoutEffect=function(B,H){return D.H.useLayoutEffect(B,H)},tt.useMemo=function(B,H){return D.H.useMemo(B,H)},tt.useOptimistic=function(B,H){return D.H.useOptimistic(B,H)},tt.useReducer=function(B,H,ne){return D.H.useReducer(B,H,ne)},tt.useRef=function(B){return D.H.useRef(B)},tt.useState=function(B){return D.H.useState(B)},tt.useSyncExternalStore=function(B,H,ne){return D.H.useSyncExternalStore(B,H,ne)},tt.useTransition=function(){return D.H.useTransition()},tt.version="19.2.3",tt}var Px;function Hy(){return Px||(Px=1,kg.exports=rR()),kg.exports}var A=Hy(),Dg={exports:{}},Eu={},Mg={exports:{}},Og={};var Bx;function sR(){return Bx||(Bx=1,(function(t){function e(Y,G){var Z=Y.length;Y.push(G);e:for(;0<Z;){var W=Z-1>>>1,te=Y[W];if(0<i(te,G))Y[W]=G,Y[Z]=te,Z=W;else break e}}function n(Y){return Y.length===0?null:Y[0]}function r(Y){if(Y.length===0)return null;var G=Y[0],Z=Y.pop();if(Z!==G){Y[0]=Z;e:for(var W=0,te=Y.length,B=te>>>1;W<B;){var H=2*(W+1)-1,ne=Y[H],re=H+1,ce=Y[re];if(0>i(ne,Z))re<te&&0>i(ce,ne)?(Y[W]=ce,Y[re]=Z,W=re):(Y[W]=ne,Y[H]=Z,W=H);else if(re<te&&0>i(ce,Z))Y[W]=ce,Y[re]=Z,W=re;else break e}}return G}function i(Y,G){var Z=Y.sortIndex-G.sortIndex;return Z!==0?Z:Y.id-G.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,d=l.now();t.unstable_now=function(){return l.now()-d}}var h=[],f=[],p=1,g=null,b=3,_=!1,w=!1,x=!1,S=!1,C=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function k(Y){for(var G=n(f);G!==null;){if(G.callback===null)r(f);else if(G.startTime<=Y)r(f),G.sortIndex=G.expirationTime,e(h,G);else break;G=n(f)}}function V(Y){if(x=!1,k(Y),!w)if(n(h)!==null)w=!0,$||($=!0,I());else{var G=n(f);G!==null&&X(V,G.startTime-Y)}}var $=!1,D=-1,O=5,N=-1;function U(){return S?!0:!(t.unstable_now()-N<O)}function q(){if(S=!1,$){var Y=t.unstable_now();N=Y;var G=!0;try{e:{w=!1,x&&(x=!1,T(D),D=-1),_=!0;var Z=b;try{t:{for(k(Y),g=n(h);g!==null&&!(g.expirationTime>Y&&U());){var W=g.callback;if(typeof W=="function"){g.callback=null,b=g.priorityLevel;var te=W(g.expirationTime<=Y);if(Y=t.unstable_now(),typeof te=="function"){g.callback=te,k(Y),G=!0;break t}g===n(h)&&r(h),k(Y)}else r(h);g=n(h)}if(g!==null)G=!0;else{var B=n(f);B!==null&&X(V,B.startTime-Y),G=!1}}break e}finally{g=null,b=Z,_=!1}G=void 0}}finally{G?I():$=!1}}}var I;if(typeof R=="function")I=function(){R(q)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,M=z.port2;z.port1.onmessage=q,I=function(){M.postMessage(null)}}else I=function(){C(q,0)};function X(Y,G){D=C(function(){Y(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Y){Y.callback=null},t.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<Y?Math.floor(1e3/Y):5},t.unstable_getCurrentPriorityLevel=function(){return b},t.unstable_next=function(Y){switch(b){case 1:case 2:case 3:var G=3;break;default:G=b}var Z=b;b=G;try{return Y()}finally{b=Z}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(Y,G){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var Z=b;b=Y;try{return G()}finally{b=Z}},t.unstable_scheduleCallback=function(Y,G,Z){var W=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?W+Z:W):Z=W,Y){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=Z+te,Y={id:p++,callback:G,priorityLevel:Y,startTime:Z,expirationTime:te,sortIndex:-1},Z>W?(Y.sortIndex=Z,e(f,Y),n(h)===null&&Y===n(f)&&(x?(T(D),D=-1):x=!0,X(V,Z-W))):(Y.sortIndex=te,e(h,Y),w||_||(w=!0,$||($=!0,I()))),Y},t.unstable_shouldYield=U,t.unstable_wrapCallback=function(Y){var G=b;return function(){var Z=b;b=G;try{return Y.apply(this,arguments)}finally{b=Z}}}})(Og)),Og}var zx;function iR(){return zx||(zx=1,Mg.exports=sR()),Mg.exports}var Ng={exports:{}},Kn={};var Lx;function aR(){if(Lx)return Kn;Lx=1;var t=Hy();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(h,f,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:f,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Kn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Kn.createPortal=function(h,f){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(h,f,null,p)},Kn.flushSync=function(h){var f=l.T,p=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=f,r.p=p,r.d.f()}},Kn.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,r.d.C(h,f))},Kn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Kn.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var p=f.as,g=d(p,f.crossOrigin),b=typeof f.integrity=="string"?f.integrity:void 0,_=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;p==="style"?r.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:g,integrity:b,fetchPriority:_}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:b,fetchPriority:_,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Kn.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var p=d(f.as,f.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&r.d.M(h)},Kn.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var p=f.as,g=d(p,f.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Kn.preloadModule=function(h,f){if(typeof h=="string")if(f){var p=d(f.as,f.crossOrigin);r.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else r.d.m(h)},Kn.requestFormReset=function(h){r.d.r(h)},Kn.unstable_batchedUpdates=function(h,f){return h(f)},Kn.useFormState=function(h,f,p){return l.H.useFormState(h,f,p)},Kn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Kn.version="19.2.3",Kn}var Ux;function oR(){if(Ux)return Ng.exports;Ux=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ng.exports=aR(),Ng.exports}var Fx;function lR(){if(Fx)return Eu;Fx=1;var t=iR(),e=Hy(),n=oR();function r(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function l(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function d(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function f(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(r(188));return a!==s?null:s}for(var c=s,m=a;;){var v=c.return;if(v===null)break;var E=v.alternate;if(E===null){if(m=v.return,m!==null){c=m;continue}break}if(v.child===E.child){for(E=v.child;E;){if(E===c)return h(v),s;if(E===m)return h(v),a;E=E.sibling}throw Error(r(188))}if(c.return!==m.return)c=v,m=E;else{for(var P=!1,Q=v.child;Q;){if(Q===c){P=!0,c=v,m=E;break}if(Q===m){P=!0,m=v,c=E;break}Q=Q.sibling}if(!P){for(Q=E.child;Q;){if(Q===c){P=!0,c=E,m=v;break}if(Q===m){P=!0,m=E,c=v;break}Q=Q.sibling}if(!P)throw Error(r(189))}}if(c.alternate!==m)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?s:a}function p(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=p(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),R=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),q=Symbol.iterator;function I(s){return s===null||typeof s!="object"?null:(s=q&&s[q]||s["@@iterator"],typeof s=="function"?s:null)}var z=Symbol.for("react.client.reference");function M(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===z?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case x:return"Fragment";case C:return"Profiler";case S:return"StrictMode";case V:return"Suspense";case $:return"SuspenseList";case N:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case w:return"Portal";case R:return s.displayName||"Context";case T:return(s._context.displayName||"Context")+".Consumer";case k:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case D:return a=s.displayName||null,a!==null?a:M(s.type)||"Memo";case O:a=s._payload,s=s._init;try{return M(s(a))}catch{}}return null}var X=Array.isArray,Y=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},W=[],te=-1;function B(s){return{current:s}}function H(s){0>te||(s.current=W[te],W[te]=null,te--)}function ne(s,a){te++,W[te]=s.current,s.current=a}var re=B(null),ce=B(null),_e=B(null),Te=B(null);function oe(s,a){switch(ne(_e,a),ne(ce,s),ne(re,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?nx(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=nx(a),s=rx(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}H(re),ne(re,s)}function be(){H(re),H(ce),H(_e)}function Ne(s){s.memoizedState!==null&&ne(Te,s);var a=re.current,c=rx(a,s.type);a!==c&&(ne(ce,s),ne(re,c))}function Me(s){ce.current===s&&(H(re),H(ce)),Te.current===s&&(H(Te),bu._currentValue=Z)}var Ge,at;function L(s){if(Ge===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);Ge=a&&a[1]||"",at=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ge+s+at}var de=!1;function ge(s,a){if(!s||de)return"";de=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(a){var ke=function(){throw Error()};if(Object.defineProperty(ke.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ke,[])}catch(xe){var ye=xe}Reflect.construct(s,[],ke)}else{try{ke.call()}catch(xe){ye=xe}s.call(ke.prototype)}}else{try{throw Error()}catch(xe){ye=xe}(ke=s())&&typeof ke.catch=="function"&&ke.catch(function(){})}}catch(xe){if(xe&&ye&&typeof xe.stack=="string")return[xe.stack,ye.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=m.DetermineComponentFrameRoot(),P=E[0],Q=E[1];if(P&&Q){var se=P.split(`
`),me=Q.split(`
`);for(v=m=0;m<se.length&&!se[m].includes("DetermineComponentFrameRoot");)m++;for(;v<me.length&&!me[v].includes("DetermineComponentFrameRoot");)v++;if(m===se.length||v===me.length)for(m=se.length-1,v=me.length-1;1<=m&&0<=v&&se[m]!==me[v];)v--;for(;1<=m&&0<=v;m--,v--)if(se[m]!==me[v]){if(m!==1||v!==1)do if(m--,v--,0>v||se[m]!==me[v]){var Ce=`
`+se[m].replace(" at new "," at ");return s.displayName&&Ce.includes("<anonymous>")&&(Ce=Ce.replace("<anonymous>",s.displayName)),Ce}while(1<=m&&0<=v);break}}}finally{de=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?L(c):""}function ee(s,a){switch(s.tag){case 26:case 27:case 5:return L(s.type);case 16:return L("Lazy");case 13:return s.child!==a&&a!==null?L("Suspense Fallback"):L("Suspense");case 19:return L("SuspenseList");case 0:case 15:return ge(s.type,!1);case 11:return ge(s.type.render,!1);case 1:return ge(s.type,!0);case 31:return L("Activity");default:return""}}function J(s){try{var a="",c=null;do a+=ee(s,c),c=s,s=s.return;while(s);return a}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var ae=Object.prototype.hasOwnProperty,Se=t.unstable_scheduleCallback,we=t.unstable_cancelCallback,ie=t.unstable_shouldYield,Re=t.unstable_requestPaint,Be=t.unstable_now,Oe=t.unstable_getCurrentPriorityLevel,He=t.unstable_ImmediatePriority,xt=t.unstable_UserBlockingPriority,rt=t.unstable_NormalPriority,Wn=t.unstable_LowPriority,gs=t.unstable_IdlePriority,sr=t.log,ys=t.unstable_setDisableYieldValue,vt=null,nn=null;function Qn(s){if(typeof sr=="function"&&ys(s),nn&&typeof nn.setStrictMode=="function")try{nn.setStrictMode(vt,s)}catch{}}var Et=Math.clz32?Math.clz32:Qo,Ka=Math.log,Ni=Math.LN2;function Qo(s){return s>>>=0,s===0?32:31-(Ka(s)/Ni|0)|0}var Or=256,_s=262144,Ft=4194304;function ir(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function bs(s,a,c){var m=s.pendingLanes;if(m===0)return 0;var v=0,E=s.suspendedLanes,P=s.pingedLanes;s=s.warmLanes;var Q=m&134217727;return Q!==0?(m=Q&~E,m!==0?v=ir(m):(P&=Q,P!==0?v=ir(P):c||(c=Q&~s,c!==0&&(v=ir(c))))):(Q=m&~E,Q!==0?v=ir(Q):P!==0?v=ir(P):c||(c=m&~s,c!==0&&(v=ir(c)))),v===0?0:a!==0&&a!==v&&(a&E)===0&&(E=v&-v,c=a&-a,E>=c||E===32&&(c&4194048)!==0)?a:v}function Zr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function Om(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wd(){var s=Ft;return Ft<<=1,(Ft&62914560)===0&&(Ft=4194304),s}function vs(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function Ya(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Nm(s,a,c,m,v,E){var P=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var Q=s.entanglements,se=s.expirationTimes,me=s.hiddenUpdates;for(c=P&~c;0<c;){var Ce=31-Et(c),ke=1<<Ce;Q[Ce]=0,se[Ce]=-1;var ye=me[Ce];if(ye!==null)for(me[Ce]=null,Ce=0;Ce<ye.length;Ce++){var xe=ye[Ce];xe!==null&&(xe.lane&=-536870913)}c&=~ke}m!==0&&Xa(s,m,0),E!==0&&v===0&&s.tag!==0&&(s.suspendedLanes|=E&~(P&~a))}function Xa(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var m=31-Et(a);s.entangledLanes|=a,s.entanglements[m]=s.entanglements[m]|1073741824|c&261930}function Ec(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var m=31-Et(c),v=1<<m;v&a|s[m]&a&&(s[m]|=a),c&=~v}}function Cc(s,a){var c=a&-a;return c=(c&42)!==0?1:Za(c),(c&(s.suspendedLanes|a))!==0?0:c}function Za(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Xs(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Sd(){var s=G.p;return s!==0?s:(s=window.event,s===void 0?32:Tx(s.type))}function Jr(s,a){var c=G.p;try{return G.p=s,a()}finally{G.p=c}}var es=Math.random().toString(36).slice(2),hn="__reactFiber$"+es,kn="__reactProps$"+es,xs="__reactContainer$"+es,Ko="__reactEvents$"+es,Pm="__reactListeners$"+es,Ed="__reactHandles$"+es,Cd="__reactResources$"+es,ws="__reactMarker$"+es;function Yo(s){delete s[hn],delete s[kn],delete s[Ko],delete s[Pm],delete s[Ed]}function Ss(s){var a=s[hn];if(a)return a;for(var c=s.parentNode;c;){if(a=c[xs]||c[hn]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=ux(s);s!==null;){if(c=s[hn])return c;s=ux(s)}return a}s=c,c=s.parentNode}return null}function Nr(s){if(s=s[hn]||s[xs]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function wr(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(r(33))}function Es(s){var a=s[Cd];return a||(a=s[Cd]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function fn(s){s[ws]=!0}var Tc=new Set,Ac={};function Cs(s,a){Ts(s,a),Ts(s+"Capture",a)}function Ts(s,a){for(Ac[s]=a,s=0;s<a.length;s++)Tc.add(a[s])}var jc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Rc={},Ic={};function Td(s){return ae.call(Ic,s)?!0:ae.call(Rc,s)?!1:jc.test(s)?Ic[s]=!0:(Rc[s]=!0,!1)}function Xo(s,a,c){if(Td(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var m=a.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function Sr(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function mn(s,a,c,m){if(m===null)s.removeAttribute(c);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+m)}}function Dn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Pi(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function kc(s,a,c){var m=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var v=m.get,E=m.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return v.call(this)},set:function(P){c=""+P,E.call(this,P)}}),Object.defineProperty(s,a,{enumerable:m.enumerable}),{getValue:function(){return c},setValue:function(P){c=""+P},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function jt(s){if(!s._valueTracker){var a=Pi(s)?"checked":"value";s._valueTracker=kc(s,a,""+s[a])}}function Ja(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),m="";return s&&(m=Pi(s)?s.checked?"true":"false":s.value),s=m,s!==c?(a.setValue(s),!0):!1}function As(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var eo=/[\n"\\]/g;function ur(s){return s.replace(eo,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Zo(s,a,c,m,v,E,P,Q){s.name="",P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?s.type=P:s.removeAttribute("type"),a!=null?P==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+Dn(a)):s.value!==""+Dn(a)&&(s.value=""+Dn(a)):P!=="submit"&&P!=="reset"||s.removeAttribute("value"),a!=null?Dc(s,P,Dn(a)):c!=null?Dc(s,P,Dn(c)):m!=null&&s.removeAttribute("value"),v==null&&E!=null&&(s.defaultChecked=!!E),v!=null&&(s.checked=v&&typeof v!="function"&&typeof v!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?s.name=""+Dn(Q):s.removeAttribute("name")}function Ad(s,a,c,m,v,E,P,Q){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(s.type=E),a!=null||c!=null){if(!(E!=="submit"&&E!=="reset"||a!=null)){jt(s);return}c=c!=null?""+Dn(c):"",a=a!=null?""+Dn(a):c,Q||a===s.value||(s.value=a),s.defaultValue=a}m=m??v,m=typeof m!="function"&&typeof m!="symbol"&&!!m,s.checked=Q?s.checked:!!m,s.defaultChecked=!!m,P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(s.name=P),jt(s)}function Dc(s,a,c){a==="number"&&As(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function Bi(s,a,c,m){if(s=s.options,a){a={};for(var v=0;v<c.length;v++)a["$"+c[v]]=!0;for(c=0;c<s.length;c++)v=a.hasOwnProperty("$"+s[c].value),s[c].selected!==v&&(s[c].selected=v),v&&m&&(s[c].defaultSelected=!0)}else{for(c=""+Dn(c),a=null,v=0;v<s.length;v++){if(s[v].value===c){s[v].selected=!0,m&&(s[v].defaultSelected=!0);return}a!==null||s[v].disabled||(a=s[v])}a!==null&&(a.selected=!0)}}function jd(s,a,c){if(a!=null&&(a=""+Dn(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+Dn(c):""}function zi(s,a,c,m){if(a==null){if(m!=null){if(c!=null)throw Error(r(92));if(X(m)){if(1<m.length)throw Error(r(93));m=m[0]}c=m}c==null&&(c=""),a=c}c=Dn(a),s.defaultValue=c,m=s.textContent,m===c&&m!==""&&m!==null&&(s.value=m),jt(s)}function dr(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var Rd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Mc(s,a,c){var m=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?m?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":m?s.setProperty(a,c):typeof c!="number"||c===0||Rd.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Oc(s,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(s=s.style,c!=null){for(var m in c)!c.hasOwnProperty(m)||a!=null&&a.hasOwnProperty(m)||(m.indexOf("--")===0?s.setProperty(m,""):m==="float"?s.cssFloat="":s[m]="");for(var v in a)m=a[v],a.hasOwnProperty(v)&&c[v]!==m&&Mc(s,v,m)}else for(var E in a)a.hasOwnProperty(E)&&Mc(s,E,a[E])}function Jo(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Id=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Li=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function el(s){return Li.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function ts(){}var Nc=null;function Pr(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Ui=null,js=null;function to(s){var a=Nr(s);if(a&&(s=a.stateNode)){var c=s[kn]||null;e:switch(s=a.stateNode,a.type){case"input":if(Zo(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+ur(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var m=c[a];if(m!==s&&m.form===s.form){var v=m[kn]||null;if(!v)throw Error(r(90));Zo(m,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(a=0;a<c.length;a++)m=c[a],m.form===s.form&&Ja(m)}break e;case"textarea":jd(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Bi(s,!!c.multiple,a,!1)}}}var tl=!1;function Fi(s,a,c){if(tl)return s(a,c);tl=!0;try{var m=s(a);return m}finally{if(tl=!1,(Ui!==null||js!==null)&&(Sh(),Ui&&(a=Ui,s=js,js=Ui=null,to(a),s)))for(a=0;a<s.length;a++)to(s[a])}}function ns(s,a){var c=s.stateNode;if(c===null)return null;var m=c[kn]||null;if(m===null)return null;c=m[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(s=s.type,m=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!m;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var Br=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),no=!1;if(Br)try{var kt={};Object.defineProperty(kt,"passive",{get:function(){no=!0}}),window.addEventListener("test",kt,kt),window.removeEventListener("test",kt,kt)}catch{no=!1}var Rs=null,Pc=null,ro=null;function Bc(){if(ro)return ro;var s,a=Pc,c=a.length,m,v="value"in Rs?Rs.value:Rs.textContent,E=v.length;for(s=0;s<c&&a[s]===v[s];s++);var P=c-s;for(m=1;m<=P&&a[c-m]===v[E-m];m++);return ro=v.slice(s,1<m?1-m:void 0)}function so(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Zs(){return!0}function rs(){return!1}function Nn(s){function a(c,m,v,E,P){this._reactName=c,this._targetInst=v,this.type=m,this.nativeEvent=E,this.target=P,this.currentTarget=null;for(var Q in s)s.hasOwnProperty(Q)&&(c=s[Q],this[Q]=c?c(E):E[Q]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?Zs:rs,this.isPropagationStopped=rs,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Zs)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Zs)},persist:function(){},isPersistent:Zs}),a}var Js={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Is=Nn(Js),Vi=g({},Js,{view:0,detail:0}),zc=Nn(Vi),$i,nl,ks,rl=g({},Vi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qi,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==ks&&(ks&&s.type==="mousemove"?($i=s.screenX-ks.screenX,nl=s.screenY-ks.screenY):nl=$i=0,ks=s),$i)},movementY:function(s){return"movementY"in s?s.movementY:nl}}),Lc=Nn(rl),io=g({},rl,{dataTransfer:0}),kd=Nn(io),Dd=g({},Vi,{relatedTarget:0}),ao=Nn(Dd),Uc=g({},Js,{animationName:0,elapsedTime:0,pseudoElement:0}),Md=Nn(Uc),sl=g({},Js,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Od=Nn(sl),Nd=g({},Js,{data:0}),Ds=Nn(Nd),Pd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ld(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=zd[s])?!!a[s]:!1}function qi(){return Ld}var ar=g({},Vi,{key:function(s){if(s.key){var a=Pd[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=so(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Bd[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qi,charCode:function(s){return s.type==="keypress"?so(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?so(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Ud=Nn(ar),Fd=g({},rl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ei=Nn(Fd),y=g({},Vi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qi}),j=Nn(y),F=g({},Js,{propertyName:0,elapsedTime:0,pseudoElement:0}),K=Nn(F),he=g({},rl,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),ve=Nn(he),ze=g({},Js,{newState:0,oldState:0}),st=Nn(ze),an=[9,13,27,32],Ct=Br&&"CompositionEvent"in window,Wt=null;Br&&"documentMode"in document&&(Wt=document.documentMode);var zr=Br&&"TextEvent"in window&&!Wt,Ms=Br&&(!Ct||Wt&&8<Wt&&11>=Wt),ss=" ",is=!1;function oo(s,a){switch(s){case"keyup":return an.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function il(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var al=!1;function EA(s,a){switch(s){case"compositionend":return il(a);case"keypress":return a.which!==32?null:(is=!0,ss);case"textInput":return s=a.data,s===ss&&is?null:s;default:return null}}function CA(s,a){if(al)return s==="compositionend"||!Ct&&oo(s,a)?(s=Bc(),ro=Pc=Rs=null,al=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Ms&&a.locale!=="ko"?null:a.data;default:return null}}var TA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function f0(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!TA[s.type]:a==="textarea"}function m0(s,a,c,m){Ui?js?js.push(m):js=[m]:Ui=m,a=Ih(a,"onChange"),0<a.length&&(c=new Is("onChange","change",null,c,m),s.push({event:c,listeners:a}))}var Fc=null,Vc=null;function AA(s){Yv(s,0)}function Vd(s){var a=wr(s);if(Ja(a))return s}function p0(s,a){if(s==="change")return a}var g0=!1;if(Br){var Bm;if(Br){var zm="oninput"in document;if(!zm){var y0=document.createElement("div");y0.setAttribute("oninput","return;"),zm=typeof y0.oninput=="function"}Bm=zm}else Bm=!1;g0=Bm&&(!document.documentMode||9<document.documentMode)}function _0(){Fc&&(Fc.detachEvent("onpropertychange",b0),Vc=Fc=null)}function b0(s){if(s.propertyName==="value"&&Vd(Vc)){var a=[];m0(a,Vc,s,Pr(s)),Fi(AA,a)}}function jA(s,a,c){s==="focusin"?(_0(),Fc=a,Vc=c,Fc.attachEvent("onpropertychange",b0)):s==="focusout"&&_0()}function RA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Vd(Vc)}function IA(s,a){if(s==="click")return Vd(a)}function kA(s,a){if(s==="input"||s==="change")return Vd(a)}function DA(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var Er=typeof Object.is=="function"?Object.is:DA;function $c(s,a){if(Er(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),m=Object.keys(a);if(c.length!==m.length)return!1;for(m=0;m<c.length;m++){var v=c[m];if(!ae.call(a,v)||!Er(s[v],a[v]))return!1}return!0}function v0(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function x0(s,a){var c=v0(s);s=0;for(var m;c;){if(c.nodeType===3){if(m=s+c.textContent.length,s<=a&&m>=a)return{node:c,offset:a-s};s=m}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=v0(c)}}function w0(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?w0(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function S0(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=As(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=As(s.document)}return a}function Lm(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var MA=Br&&"documentMode"in document&&11>=document.documentMode,ol=null,Um=null,qc=null,Fm=!1;function E0(s,a,c){var m=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Fm||ol==null||ol!==As(m)||(m=ol,"selectionStart"in m&&Lm(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),qc&&$c(qc,m)||(qc=m,m=Ih(Um,"onSelect"),0<m.length&&(a=new Is("onSelect","select",null,a,c),s.push({event:a,listeners:m}),a.target=ol)))}function lo(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var ll={animationend:lo("Animation","AnimationEnd"),animationiteration:lo("Animation","AnimationIteration"),animationstart:lo("Animation","AnimationStart"),transitionrun:lo("Transition","TransitionRun"),transitionstart:lo("Transition","TransitionStart"),transitioncancel:lo("Transition","TransitionCancel"),transitionend:lo("Transition","TransitionEnd")},Vm={},C0={};Br&&(C0=document.createElement("div").style,"AnimationEvent"in window||(delete ll.animationend.animation,delete ll.animationiteration.animation,delete ll.animationstart.animation),"TransitionEvent"in window||delete ll.transitionend.transition);function co(s){if(Vm[s])return Vm[s];if(!ll[s])return s;var a=ll[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in C0)return Vm[s]=a[c];return s}var T0=co("animationend"),A0=co("animationiteration"),j0=co("animationstart"),OA=co("transitionrun"),NA=co("transitionstart"),PA=co("transitioncancel"),R0=co("transitionend"),I0=new Map,$m="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");$m.push("scrollEnd");function as(s,a){I0.set(s,a),Cs(a,[s])}var $d=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Lr=[],cl=0,qm=0;function qd(){for(var s=cl,a=qm=cl=0;a<s;){var c=Lr[a];Lr[a++]=null;var m=Lr[a];Lr[a++]=null;var v=Lr[a];Lr[a++]=null;var E=Lr[a];if(Lr[a++]=null,m!==null&&v!==null){var P=m.pending;P===null?v.next=v:(v.next=P.next,P.next=v),m.pending=v}E!==0&&k0(c,v,E)}}function Hd(s,a,c,m){Lr[cl++]=s,Lr[cl++]=a,Lr[cl++]=c,Lr[cl++]=m,qm|=m,s.lanes|=m,s=s.alternate,s!==null&&(s.lanes|=m)}function Hm(s,a,c,m){return Hd(s,a,c,m),Gd(s)}function uo(s,a){return Hd(s,null,null,a),Gd(s)}function k0(s,a,c){s.lanes|=c;var m=s.alternate;m!==null&&(m.lanes|=c);for(var v=!1,E=s.return;E!==null;)E.childLanes|=c,m=E.alternate,m!==null&&(m.childLanes|=c),E.tag===22&&(s=E.stateNode,s===null||s._visibility&1||(v=!0)),s=E,E=E.return;return s.tag===3?(E=s.stateNode,v&&a!==null&&(v=31-Et(c),s=E.hiddenUpdates,m=s[v],m===null?s[v]=[a]:m.push(a),a.lane=c|536870912),E):null}function Gd(s){if(50<hu)throw hu=0,eg=null,Error(r(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var ul={};function BA(s,a,c,m){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cr(s,a,c,m){return new BA(s,a,c,m)}function Gm(s){return s=s.prototype,!(!s||!s.isReactComponent)}function ti(s,a){var c=s.alternate;return c===null?(c=Cr(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function D0(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Wd(s,a,c,m,v,E){var P=0;if(m=s,typeof s=="function")Gm(s)&&(P=1);else if(typeof s=="string")P=Vj(s,c,re.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case N:return s=Cr(31,c,a,v),s.elementType=N,s.lanes=E,s;case x:return ho(c.children,v,E,a);case S:P=8,v|=24;break;case C:return s=Cr(12,c,a,v|2),s.elementType=C,s.lanes=E,s;case V:return s=Cr(13,c,a,v),s.elementType=V,s.lanes=E,s;case $:return s=Cr(19,c,a,v),s.elementType=$,s.lanes=E,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case R:P=10;break e;case T:P=9;break e;case k:P=11;break e;case D:P=14;break e;case O:P=16,m=null;break e}P=29,c=Error(r(130,s===null?"null":typeof s,"")),m=null}return a=Cr(P,c,a,v),a.elementType=s,a.type=m,a.lanes=E,a}function ho(s,a,c,m){return s=Cr(7,s,m,a),s.lanes=c,s}function Wm(s,a,c){return s=Cr(6,s,null,a),s.lanes=c,s}function M0(s){var a=Cr(18,null,null,0);return a.stateNode=s,a}function Qm(s,a,c){return a=Cr(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var O0=new WeakMap;function Ur(s,a){if(typeof s=="object"&&s!==null){var c=O0.get(s);return c!==void 0?c:(a={value:s,source:a,stack:J(a)},O0.set(s,a),a)}return{value:s,source:a,stack:J(a)}}var dl=[],hl=0,Qd=null,Hc=0,Fr=[],Vr=0,Hi=null,Os=1,Ns="";function ni(s,a){dl[hl++]=Hc,dl[hl++]=Qd,Qd=s,Hc=a}function N0(s,a,c){Fr[Vr++]=Os,Fr[Vr++]=Ns,Fr[Vr++]=Hi,Hi=s;var m=Os;s=Ns;var v=32-Et(m)-1;m&=~(1<<v),c+=1;var E=32-Et(a)+v;if(30<E){var P=v-v%5;E=(m&(1<<P)-1).toString(32),m>>=P,v-=P,Os=1<<32-Et(a)+v|c<<v|m,Ns=E+s}else Os=1<<E|c<<v|m,Ns=s}function Km(s){s.return!==null&&(ni(s,1),N0(s,1,0))}function Ym(s){for(;s===Qd;)Qd=dl[--hl],dl[hl]=null,Hc=dl[--hl],dl[hl]=null;for(;s===Hi;)Hi=Fr[--Vr],Fr[Vr]=null,Ns=Fr[--Vr],Fr[Vr]=null,Os=Fr[--Vr],Fr[Vr]=null}function P0(s,a){Fr[Vr++]=Os,Fr[Vr++]=Ns,Fr[Vr++]=Hi,Os=a.id,Ns=a.overflow,Hi=s}var Pn=null,$t=null,_t=!1,Gi=null,$r=!1,Xm=Error(r(519));function Wi(s){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Gc(Ur(a,s)),Xm}function B0(s){var a=s.stateNode,c=s.type,m=s.memoizedProps;switch(a[hn]=s,a[kn]=m,c){case"dialog":dt("cancel",a),dt("close",a);break;case"iframe":case"object":case"embed":dt("load",a);break;case"video":case"audio":for(c=0;c<mu.length;c++)dt(mu[c],a);break;case"source":dt("error",a);break;case"img":case"image":case"link":dt("error",a),dt("load",a);break;case"details":dt("toggle",a);break;case"input":dt("invalid",a),Ad(a,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":dt("invalid",a);break;case"textarea":dt("invalid",a),zi(a,m.value,m.defaultValue,m.children)}c=m.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||m.suppressHydrationWarning===!0||ex(a.textContent,c)?(m.popover!=null&&(dt("beforetoggle",a),dt("toggle",a)),m.onScroll!=null&&dt("scroll",a),m.onScrollEnd!=null&&dt("scrollend",a),m.onClick!=null&&(a.onclick=ts),a=!0):a=!1,a||Wi(s,!0)}function z0(s){for(Pn=s.return;Pn;)switch(Pn.tag){case 5:case 31:case 13:$r=!1;return;case 27:case 3:$r=!0;return;default:Pn=Pn.return}}function fl(s){if(s!==Pn)return!1;if(!_t)return z0(s),_t=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||pg(s.type,s.memoizedProps)),c=!c),c&&$t&&Wi(s),z0(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));$t=cx(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));$t=cx(s)}else a===27?(a=$t,oa(s.type)?(s=vg,vg=null,$t=s):$t=a):$t=Pn?Hr(s.stateNode.nextSibling):null;return!0}function fo(){$t=Pn=null,_t=!1}function Zm(){var s=Gi;return s!==null&&(pr===null?pr=s:pr.push.apply(pr,s),Gi=null),s}function Gc(s){Gi===null?Gi=[s]:Gi.push(s)}var Jm=B(null),mo=null,ri=null;function Qi(s,a,c){ne(Jm,a._currentValue),a._currentValue=c}function si(s){s._currentValue=Jm.current,H(Jm)}function ep(s,a,c){for(;s!==null;){var m=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,m!==null&&(m.childLanes|=a)):m!==null&&(m.childLanes&a)!==a&&(m.childLanes|=a),s===c)break;s=s.return}}function tp(s,a,c,m){var v=s.child;for(v!==null&&(v.return=s);v!==null;){var E=v.dependencies;if(E!==null){var P=v.child;E=E.firstContext;e:for(;E!==null;){var Q=E;E=v;for(var se=0;se<a.length;se++)if(Q.context===a[se]){E.lanes|=c,Q=E.alternate,Q!==null&&(Q.lanes|=c),ep(E.return,c,s),m||(P=null);break e}E=Q.next}}else if(v.tag===18){if(P=v.return,P===null)throw Error(r(341));P.lanes|=c,E=P.alternate,E!==null&&(E.lanes|=c),ep(P,c,s),P=null}else P=v.child;if(P!==null)P.return=v;else for(P=v;P!==null;){if(P===s){P=null;break}if(v=P.sibling,v!==null){v.return=P.return,P=v;break}P=P.return}v=P}}function ml(s,a,c,m){s=null;for(var v=a,E=!1;v!==null;){if(!E){if((v.flags&524288)!==0)E=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var P=v.alternate;if(P===null)throw Error(r(387));if(P=P.memoizedProps,P!==null){var Q=v.type;Er(v.pendingProps.value,P.value)||(s!==null?s.push(Q):s=[Q])}}else if(v===Te.current){if(P=v.alternate,P===null)throw Error(r(387));P.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(s!==null?s.push(bu):s=[bu])}v=v.return}s!==null&&tp(a,s,c,m),a.flags|=262144}function Kd(s){for(s=s.firstContext;s!==null;){if(!Er(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function po(s){mo=s,ri=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Bn(s){return L0(mo,s)}function Yd(s,a){return mo===null&&po(s),L0(s,a)}function L0(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},ri===null){if(s===null)throw Error(r(308));ri=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else ri=ri.next=a;return c}var zA=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,m){s.push(m)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},LA=t.unstable_scheduleCallback,UA=t.unstable_NormalPriority,pn={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function np(){return{controller:new zA,data:new Map,refCount:0}}function Wc(s){s.refCount--,s.refCount===0&&LA(UA,function(){s.controller.abort()})}var Qc=null,rp=0,pl=0,gl=null;function FA(s,a){if(Qc===null){var c=Qc=[];rp=0,pl=ag(),gl={status:"pending",value:void 0,then:function(m){c.push(m)}}}return rp++,a.then(U0,U0),a}function U0(){if(--rp===0&&Qc!==null){gl!==null&&(gl.status="fulfilled");var s=Qc;Qc=null,pl=0,gl=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function VA(s,a){var c=[],m={status:"pending",value:null,reason:null,then:function(v){c.push(v)}};return s.then(function(){m.status="fulfilled",m.value=a;for(var v=0;v<c.length;v++)(0,c[v])(a)},function(v){for(m.status="rejected",m.reason=v,v=0;v<c.length;v++)(0,c[v])(void 0)}),m}var F0=Y.S;Y.S=function(s,a){Ev=Be(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&FA(s,a),F0!==null&&F0(s,a)};var go=B(null);function sp(){var s=go.current;return s!==null?s:Lt.pooledCache}function Xd(s,a){a===null?ne(go,go.current):ne(go,a.pool)}function V0(){var s=sp();return s===null?null:{parent:pn._currentValue,pool:s}}var yl=Error(r(460)),ip=Error(r(474)),Zd=Error(r(542)),Jd={then:function(){}};function $0(s){return s=s.status,s==="fulfilled"||s==="rejected"}function q0(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(ts,ts),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,G0(s),s;default:if(typeof a.status=="string")a.then(ts,ts);else{if(s=Lt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=a,s.status="pending",s.then(function(m){if(a.status==="pending"){var v=a;v.status="fulfilled",v.value=m}},function(m){if(a.status==="pending"){var v=a;v.status="rejected",v.reason=m}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,G0(s),s}throw _o=a,yl}}function yo(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(_o=c,yl):c}}var _o=null;function H0(){if(_o===null)throw Error(r(459));var s=_o;return _o=null,s}function G0(s){if(s===yl||s===Zd)throw Error(r(483))}var _l=null,Kc=0;function eh(s){var a=Kc;return Kc+=1,_l===null&&(_l=[]),q0(_l,s,a)}function Yc(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function th(s,a){throw a.$$typeof===b?Error(r(525)):(s=Object.prototype.toString.call(a),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function W0(s){function a(ue,le){if(s){var fe=ue.deletions;fe===null?(ue.deletions=[le],ue.flags|=16):fe.push(le)}}function c(ue,le){if(!s)return null;for(;le!==null;)a(ue,le),le=le.sibling;return null}function m(ue){for(var le=new Map;ue!==null;)ue.key!==null?le.set(ue.key,ue):le.set(ue.index,ue),ue=ue.sibling;return le}function v(ue,le){return ue=ti(ue,le),ue.index=0,ue.sibling=null,ue}function E(ue,le,fe){return ue.index=fe,s?(fe=ue.alternate,fe!==null?(fe=fe.index,fe<le?(ue.flags|=67108866,le):fe):(ue.flags|=67108866,le)):(ue.flags|=1048576,le)}function P(ue){return s&&ue.alternate===null&&(ue.flags|=67108866),ue}function Q(ue,le,fe,je){return le===null||le.tag!==6?(le=Wm(fe,ue.mode,je),le.return=ue,le):(le=v(le,fe),le.return=ue,le)}function se(ue,le,fe,je){var We=fe.type;return We===x?Ce(ue,le,fe.props.children,je,fe.key):le!==null&&(le.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===O&&yo(We)===le.type)?(le=v(le,fe.props),Yc(le,fe),le.return=ue,le):(le=Wd(fe.type,fe.key,fe.props,null,ue.mode,je),Yc(le,fe),le.return=ue,le)}function me(ue,le,fe,je){return le===null||le.tag!==4||le.stateNode.containerInfo!==fe.containerInfo||le.stateNode.implementation!==fe.implementation?(le=Qm(fe,ue.mode,je),le.return=ue,le):(le=v(le,fe.children||[]),le.return=ue,le)}function Ce(ue,le,fe,je,We){return le===null||le.tag!==7?(le=ho(fe,ue.mode,je,We),le.return=ue,le):(le=v(le,fe),le.return=ue,le)}function ke(ue,le,fe){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=Wm(""+le,ue.mode,fe),le.return=ue,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case _:return fe=Wd(le.type,le.key,le.props,null,ue.mode,fe),Yc(fe,le),fe.return=ue,fe;case w:return le=Qm(le,ue.mode,fe),le.return=ue,le;case O:return le=yo(le),ke(ue,le,fe)}if(X(le)||I(le))return le=ho(le,ue.mode,fe,null),le.return=ue,le;if(typeof le.then=="function")return ke(ue,eh(le),fe);if(le.$$typeof===R)return ke(ue,Yd(ue,le),fe);th(ue,le)}return null}function ye(ue,le,fe,je){var We=le!==null?le.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return We!==null?null:Q(ue,le,""+fe,je);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case _:return fe.key===We?se(ue,le,fe,je):null;case w:return fe.key===We?me(ue,le,fe,je):null;case O:return fe=yo(fe),ye(ue,le,fe,je)}if(X(fe)||I(fe))return We!==null?null:Ce(ue,le,fe,je,null);if(typeof fe.then=="function")return ye(ue,le,eh(fe),je);if(fe.$$typeof===R)return ye(ue,le,Yd(ue,fe),je);th(ue,fe)}return null}function xe(ue,le,fe,je,We){if(typeof je=="string"&&je!==""||typeof je=="number"||typeof je=="bigint")return ue=ue.get(fe)||null,Q(le,ue,""+je,We);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case _:return ue=ue.get(je.key===null?fe:je.key)||null,se(le,ue,je,We);case w:return ue=ue.get(je.key===null?fe:je.key)||null,me(le,ue,je,We);case O:return je=yo(je),xe(ue,le,fe,je,We)}if(X(je)||I(je))return ue=ue.get(fe)||null,Ce(le,ue,je,We,null);if(typeof je.then=="function")return xe(ue,le,fe,eh(je),We);if(je.$$typeof===R)return xe(ue,le,fe,Yd(le,je),We);th(le,je)}return null}function Fe(ue,le,fe,je){for(var We=null,wt=null,Ve=le,ot=le=0,mt=null;Ve!==null&&ot<fe.length;ot++){Ve.index>ot?(mt=Ve,Ve=null):mt=Ve.sibling;var St=ye(ue,Ve,fe[ot],je);if(St===null){Ve===null&&(Ve=mt);break}s&&Ve&&St.alternate===null&&a(ue,Ve),le=E(St,le,ot),wt===null?We=St:wt.sibling=St,wt=St,Ve=mt}if(ot===fe.length)return c(ue,Ve),_t&&ni(ue,ot),We;if(Ve===null){for(;ot<fe.length;ot++)Ve=ke(ue,fe[ot],je),Ve!==null&&(le=E(Ve,le,ot),wt===null?We=Ve:wt.sibling=Ve,wt=Ve);return _t&&ni(ue,ot),We}for(Ve=m(Ve);ot<fe.length;ot++)mt=xe(Ve,ue,ot,fe[ot],je),mt!==null&&(s&&mt.alternate!==null&&Ve.delete(mt.key===null?ot:mt.key),le=E(mt,le,ot),wt===null?We=mt:wt.sibling=mt,wt=mt);return s&&Ve.forEach(function(ha){return a(ue,ha)}),_t&&ni(ue,ot),We}function Ke(ue,le,fe,je){if(fe==null)throw Error(r(151));for(var We=null,wt=null,Ve=le,ot=le=0,mt=null,St=fe.next();Ve!==null&&!St.done;ot++,St=fe.next()){Ve.index>ot?(mt=Ve,Ve=null):mt=Ve.sibling;var ha=ye(ue,Ve,St.value,je);if(ha===null){Ve===null&&(Ve=mt);break}s&&Ve&&ha.alternate===null&&a(ue,Ve),le=E(ha,le,ot),wt===null?We=ha:wt.sibling=ha,wt=ha,Ve=mt}if(St.done)return c(ue,Ve),_t&&ni(ue,ot),We;if(Ve===null){for(;!St.done;ot++,St=fe.next())St=ke(ue,St.value,je),St!==null&&(le=E(St,le,ot),wt===null?We=St:wt.sibling=St,wt=St);return _t&&ni(ue,ot),We}for(Ve=m(Ve);!St.done;ot++,St=fe.next())St=xe(Ve,ue,ot,St.value,je),St!==null&&(s&&St.alternate!==null&&Ve.delete(St.key===null?ot:St.key),le=E(St,le,ot),wt===null?We=St:wt.sibling=St,wt=St);return s&&Ve.forEach(function(Jj){return a(ue,Jj)}),_t&&ni(ue,ot),We}function Ot(ue,le,fe,je){if(typeof fe=="object"&&fe!==null&&fe.type===x&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case _:e:{for(var We=fe.key;le!==null;){if(le.key===We){if(We=fe.type,We===x){if(le.tag===7){c(ue,le.sibling),je=v(le,fe.props.children),je.return=ue,ue=je;break e}}else if(le.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===O&&yo(We)===le.type){c(ue,le.sibling),je=v(le,fe.props),Yc(je,fe),je.return=ue,ue=je;break e}c(ue,le);break}else a(ue,le);le=le.sibling}fe.type===x?(je=ho(fe.props.children,ue.mode,je,fe.key),je.return=ue,ue=je):(je=Wd(fe.type,fe.key,fe.props,null,ue.mode,je),Yc(je,fe),je.return=ue,ue=je)}return P(ue);case w:e:{for(We=fe.key;le!==null;){if(le.key===We)if(le.tag===4&&le.stateNode.containerInfo===fe.containerInfo&&le.stateNode.implementation===fe.implementation){c(ue,le.sibling),je=v(le,fe.children||[]),je.return=ue,ue=je;break e}else{c(ue,le);break}else a(ue,le);le=le.sibling}je=Qm(fe,ue.mode,je),je.return=ue,ue=je}return P(ue);case O:return fe=yo(fe),Ot(ue,le,fe,je)}if(X(fe))return Fe(ue,le,fe,je);if(I(fe)){if(We=I(fe),typeof We!="function")throw Error(r(150));return fe=We.call(fe),Ke(ue,le,fe,je)}if(typeof fe.then=="function")return Ot(ue,le,eh(fe),je);if(fe.$$typeof===R)return Ot(ue,le,Yd(ue,fe),je);th(ue,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint"?(fe=""+fe,le!==null&&le.tag===6?(c(ue,le.sibling),je=v(le,fe),je.return=ue,ue=je):(c(ue,le),je=Wm(fe,ue.mode,je),je.return=ue,ue=je),P(ue)):c(ue,le)}return function(ue,le,fe,je){try{Kc=0;var We=Ot(ue,le,fe,je);return _l=null,We}catch(Ve){if(Ve===yl||Ve===Zd)throw Ve;var wt=Cr(29,Ve,null,ue.mode);return wt.lanes=je,wt.return=ue,wt}}}var bo=W0(!0),Q0=W0(!1),Ki=!1;function ap(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function op(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Yi(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Xi(s,a,c){var m=s.updateQueue;if(m===null)return null;if(m=m.shared,(Tt&2)!==0){var v=m.pending;return v===null?a.next=a:(a.next=v.next,v.next=a),m.pending=a,a=Gd(s),k0(s,null,c),a}return Hd(s,m,a,c),Gd(s)}function Xc(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var m=a.lanes;m&=s.pendingLanes,c|=m,a.lanes=c,Ec(s,c)}}function lp(s,a){var c=s.updateQueue,m=s.alternate;if(m!==null&&(m=m.updateQueue,c===m)){var v=null,E=null;if(c=c.firstBaseUpdate,c!==null){do{var P={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};E===null?v=E=P:E=E.next=P,c=c.next}while(c!==null);E===null?v=E=a:E=E.next=a}else v=E=a;c={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:E,shared:m.shared,callbacks:m.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var cp=!1;function Zc(){if(cp){var s=gl;if(s!==null)throw s}}function Jc(s,a,c,m){cp=!1;var v=s.updateQueue;Ki=!1;var E=v.firstBaseUpdate,P=v.lastBaseUpdate,Q=v.shared.pending;if(Q!==null){v.shared.pending=null;var se=Q,me=se.next;se.next=null,P===null?E=me:P.next=me,P=se;var Ce=s.alternate;Ce!==null&&(Ce=Ce.updateQueue,Q=Ce.lastBaseUpdate,Q!==P&&(Q===null?Ce.firstBaseUpdate=me:Q.next=me,Ce.lastBaseUpdate=se))}if(E!==null){var ke=v.baseState;P=0,Ce=me=se=null,Q=E;do{var ye=Q.lane&-536870913,xe=ye!==Q.lane;if(xe?(ft&ye)===ye:(m&ye)===ye){ye!==0&&ye===pl&&(cp=!0),Ce!==null&&(Ce=Ce.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var Fe=s,Ke=Q;ye=a;var Ot=c;switch(Ke.tag){case 1:if(Fe=Ke.payload,typeof Fe=="function"){ke=Fe.call(Ot,ke,ye);break e}ke=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Ke.payload,ye=typeof Fe=="function"?Fe.call(Ot,ke,ye):Fe,ye==null)break e;ke=g({},ke,ye);break e;case 2:Ki=!0}}ye=Q.callback,ye!==null&&(s.flags|=64,xe&&(s.flags|=8192),xe=v.callbacks,xe===null?v.callbacks=[ye]:xe.push(ye))}else xe={lane:ye,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Ce===null?(me=Ce=xe,se=ke):Ce=Ce.next=xe,P|=ye;if(Q=Q.next,Q===null){if(Q=v.shared.pending,Q===null)break;xe=Q,Q=xe.next,xe.next=null,v.lastBaseUpdate=xe,v.shared.pending=null}}while(!0);Ce===null&&(se=ke),v.baseState=se,v.firstBaseUpdate=me,v.lastBaseUpdate=Ce,E===null&&(v.shared.lanes=0),na|=P,s.lanes=P,s.memoizedState=ke}}function K0(s,a){if(typeof s!="function")throw Error(r(191,s));s.call(a)}function Y0(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)K0(c[s],a)}var bl=B(null),nh=B(0);function X0(s,a){s=fi,ne(nh,s),ne(bl,a),fi=s|a.baseLanes}function up(){ne(nh,fi),ne(bl,bl.current)}function dp(){fi=nh.current,H(bl),H(nh)}var Tr=B(null),qr=null;function Zi(s){var a=s.alternate;ne(on,on.current&1),ne(Tr,s),qr===null&&(a===null||bl.current!==null||a.memoizedState!==null)&&(qr=s)}function hp(s){ne(on,on.current),ne(Tr,s),qr===null&&(qr=s)}function Z0(s){s.tag===22?(ne(on,on.current),ne(Tr,s),qr===null&&(qr=s)):Ji()}function Ji(){ne(on,on.current),ne(Tr,Tr.current)}function Ar(s){H(Tr),qr===s&&(qr=null),H(on)}var on=B(0);function rh(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||_g(c)||bg(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ii=0,it=null,Dt=null,gn=null,sh=!1,vl=!1,vo=!1,ih=0,eu=0,xl=null,$A=0;function rn(){throw Error(r(321))}function fp(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!Er(s[c],a[c]))return!1;return!0}function mp(s,a,c,m,v,E){return ii=E,it=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Y.H=s===null||s.memoizedState===null?Nb:Rp,vo=!1,E=c(m,v),vo=!1,vl&&(E=eb(a,c,m,v)),J0(s),E}function J0(s){Y.H=ru;var a=Dt!==null&&Dt.next!==null;if(ii=0,gn=Dt=it=null,sh=!1,eu=0,xl=null,a)throw Error(r(300));s===null||yn||(s=s.dependencies,s!==null&&Kd(s)&&(yn=!0))}function eb(s,a,c,m){it=s;var v=0;do{if(vl&&(xl=null),eu=0,vl=!1,25<=v)throw Error(r(301));if(v+=1,gn=Dt=null,s.updateQueue!=null){var E=s.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}Y.H=Pb,E=a(c,m)}while(vl);return E}function qA(){var s=Y.H,a=s.useState()[0];return a=typeof a.then=="function"?tu(a):a,s=s.useState()[0],(Dt!==null?Dt.memoizedState:null)!==s&&(it.flags|=1024),a}function pp(){var s=ih!==0;return ih=0,s}function gp(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function yp(s){if(sh){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}sh=!1}ii=0,gn=Dt=it=null,vl=!1,eu=ih=0,xl=null}function or(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gn===null?it.memoizedState=gn=s:gn=gn.next=s,gn}function ln(){if(Dt===null){var s=it.alternate;s=s!==null?s.memoizedState:null}else s=Dt.next;var a=gn===null?it.memoizedState:gn.next;if(a!==null)gn=a,Dt=s;else{if(s===null)throw it.alternate===null?Error(r(467)):Error(r(310));Dt=s,s={memoizedState:Dt.memoizedState,baseState:Dt.baseState,baseQueue:Dt.baseQueue,queue:Dt.queue,next:null},gn===null?it.memoizedState=gn=s:gn=gn.next=s}return gn}function ah(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function tu(s){var a=eu;return eu+=1,xl===null&&(xl=[]),s=q0(xl,s,a),a=it,(gn===null?a.memoizedState:gn.next)===null&&(a=a.alternate,Y.H=a===null||a.memoizedState===null?Nb:Rp),s}function oh(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return tu(s);if(s.$$typeof===R)return Bn(s)}throw Error(r(438,String(s)))}function _p(s){var a=null,c=it.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var m=it.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(a={data:m.data.map(function(v){return v.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=ah(),it.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),m=0;m<s;m++)c[m]=U;return a.index++,c}function ai(s,a){return typeof a=="function"?a(s):a}function lh(s){var a=ln();return bp(a,Dt,s)}function bp(s,a,c){var m=s.queue;if(m===null)throw Error(r(311));m.lastRenderedReducer=c;var v=s.baseQueue,E=m.pending;if(E!==null){if(v!==null){var P=v.next;v.next=E.next,E.next=P}a.baseQueue=v=E,m.pending=null}if(E=s.baseState,v===null)s.memoizedState=E;else{a=v.next;var Q=P=null,se=null,me=a,Ce=!1;do{var ke=me.lane&-536870913;if(ke!==me.lane?(ft&ke)===ke:(ii&ke)===ke){var ye=me.revertLane;if(ye===0)se!==null&&(se=se.next={lane:0,revertLane:0,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null}),ke===pl&&(Ce=!0);else if((ii&ye)===ye){me=me.next,ye===pl&&(Ce=!0);continue}else ke={lane:0,revertLane:me.revertLane,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},se===null?(Q=se=ke,P=E):se=se.next=ke,it.lanes|=ye,na|=ye;ke=me.action,vo&&c(E,ke),E=me.hasEagerState?me.eagerState:c(E,ke)}else ye={lane:ke,revertLane:me.revertLane,gesture:me.gesture,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},se===null?(Q=se=ye,P=E):se=se.next=ye,it.lanes|=ke,na|=ke;me=me.next}while(me!==null&&me!==a);if(se===null?P=E:se.next=Q,!Er(E,s.memoizedState)&&(yn=!0,Ce&&(c=gl,c!==null)))throw c;s.memoizedState=E,s.baseState=P,s.baseQueue=se,m.lastRenderedState=E}return v===null&&(m.lanes=0),[s.memoizedState,m.dispatch]}function vp(s){var a=ln(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var m=c.dispatch,v=c.pending,E=a.memoizedState;if(v!==null){c.pending=null;var P=v=v.next;do E=s(E,P.action),P=P.next;while(P!==v);Er(E,a.memoizedState)||(yn=!0),a.memoizedState=E,a.baseQueue===null&&(a.baseState=E),c.lastRenderedState=E}return[E,m]}function tb(s,a,c){var m=it,v=ln(),E=_t;if(E){if(c===void 0)throw Error(r(407));c=c()}else c=a();var P=!Er((Dt||v).memoizedState,c);if(P&&(v.memoizedState=c,yn=!0),v=v.queue,Sp(sb.bind(null,m,v,s),[s]),v.getSnapshot!==a||P||gn!==null&&gn.memoizedState.tag&1){if(m.flags|=2048,wl(9,{destroy:void 0},rb.bind(null,m,v,c,a),null),Lt===null)throw Error(r(349));E||(ii&127)!==0||nb(m,a,c)}return c}function nb(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=it.updateQueue,a===null?(a=ah(),it.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function rb(s,a,c,m){a.value=c,a.getSnapshot=m,ib(a)&&ab(s)}function sb(s,a,c){return c(function(){ib(a)&&ab(s)})}function ib(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!Er(s,c)}catch{return!0}}function ab(s){var a=uo(s,2);a!==null&&gr(a,s,2)}function xp(s){var a=or();if(typeof s=="function"){var c=s;if(s=c(),vo){Qn(!0);try{c()}finally{Qn(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ai,lastRenderedState:s},a}function ob(s,a,c,m){return s.baseState=c,bp(s,Dt,typeof m=="function"?m:ai)}function HA(s,a,c,m,v){if(dh(s))throw Error(r(485));if(s=a.action,s!==null){var E={payload:v,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(P){E.listeners.push(P)}};Y.T!==null?c(!0):E.isTransition=!1,m(E),c=a.pending,c===null?(E.next=a.pending=E,lb(a,E)):(E.next=c.next,a.pending=c.next=E)}}function lb(s,a){var c=a.action,m=a.payload,v=s.state;if(a.isTransition){var E=Y.T,P={};Y.T=P;try{var Q=c(v,m),se=Y.S;se!==null&&se(P,Q),cb(s,a,Q)}catch(me){wp(s,a,me)}finally{E!==null&&P.types!==null&&(E.types=P.types),Y.T=E}}else try{E=c(v,m),cb(s,a,E)}catch(me){wp(s,a,me)}}function cb(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(m){ub(s,a,m)},function(m){return wp(s,a,m)}):ub(s,a,c)}function ub(s,a,c){a.status="fulfilled",a.value=c,db(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,lb(s,c)))}function wp(s,a,c){var m=s.pending;if(s.pending=null,m!==null){m=m.next;do a.status="rejected",a.reason=c,db(a),a=a.next;while(a!==m)}s.action=null}function db(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function hb(s,a){return a}function fb(s,a){if(_t){var c=Lt.formState;if(c!==null){e:{var m=it;if(_t){if($t){t:{for(var v=$t,E=$r;v.nodeType!==8;){if(!E){v=null;break t}if(v=Hr(v.nextSibling),v===null){v=null;break t}}E=v.data,v=E==="F!"||E==="F"?v:null}if(v){$t=Hr(v.nextSibling),m=v.data==="F!";break e}}Wi(m)}m=!1}m&&(a=c[0])}}return c=or(),c.memoizedState=c.baseState=a,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:hb,lastRenderedState:a},c.queue=m,c=Db.bind(null,it,m),m.dispatch=c,m=xp(!1),E=jp.bind(null,it,!1,m.queue),m=or(),v={state:a,dispatch:null,action:s,pending:null},m.queue=v,c=HA.bind(null,it,v,E,c),v.dispatch=c,m.memoizedState=s,[a,c,!1]}function mb(s){var a=ln();return pb(a,Dt,s)}function pb(s,a,c){if(a=bp(s,a,hb)[0],s=lh(ai)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var m=tu(a)}catch(P){throw P===yl?Zd:P}else m=a;a=ln();var v=a.queue,E=v.dispatch;return c!==a.memoizedState&&(it.flags|=2048,wl(9,{destroy:void 0},GA.bind(null,v,c),null)),[m,E,s]}function GA(s,a){s.action=a}function gb(s){var a=ln(),c=Dt;if(c!==null)return pb(a,c,s);ln(),a=a.memoizedState,c=ln();var m=c.queue.dispatch;return c.memoizedState=s,[a,m,!1]}function wl(s,a,c,m){return s={tag:s,create:c,deps:m,inst:a,next:null},a=it.updateQueue,a===null&&(a=ah(),it.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(m=c.next,c.next=s,s.next=m,a.lastEffect=s),s}function yb(){return ln().memoizedState}function ch(s,a,c,m){var v=or();it.flags|=s,v.memoizedState=wl(1|a,{destroy:void 0},c,m===void 0?null:m)}function uh(s,a,c,m){var v=ln();m=m===void 0?null:m;var E=v.memoizedState.inst;Dt!==null&&m!==null&&fp(m,Dt.memoizedState.deps)?v.memoizedState=wl(a,E,c,m):(it.flags|=s,v.memoizedState=wl(1|a,E,c,m))}function _b(s,a){ch(8390656,8,s,a)}function Sp(s,a){uh(2048,8,s,a)}function WA(s){it.flags|=4;var a=it.updateQueue;if(a===null)a=ah(),it.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function bb(s){var a=ln().memoizedState;return WA({ref:a,nextImpl:s}),function(){if((Tt&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function vb(s,a){return uh(4,2,s,a)}function xb(s,a){return uh(4,4,s,a)}function wb(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function Sb(s,a,c){c=c!=null?c.concat([s]):null,uh(4,4,wb.bind(null,a,s),c)}function Ep(){}function Eb(s,a){var c=ln();a=a===void 0?null:a;var m=c.memoizedState;return a!==null&&fp(a,m[1])?m[0]:(c.memoizedState=[s,a],s)}function Cb(s,a){var c=ln();a=a===void 0?null:a;var m=c.memoizedState;if(a!==null&&fp(a,m[1]))return m[0];if(m=s(),vo){Qn(!0);try{s()}finally{Qn(!1)}}return c.memoizedState=[m,a],m}function Cp(s,a,c){return c===void 0||(ii&1073741824)!==0&&(ft&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=Tv(),it.lanes|=s,na|=s,c)}function Tb(s,a,c,m){return Er(c,a)?c:bl.current!==null?(s=Cp(s,c,m),Er(s,a)||(yn=!0),s):(ii&42)===0||(ii&1073741824)!==0&&(ft&261930)===0?(yn=!0,s.memoizedState=c):(s=Tv(),it.lanes|=s,na|=s,a)}function Ab(s,a,c,m,v){var E=G.p;G.p=E!==0&&8>E?E:8;var P=Y.T,Q={};Y.T=Q,jp(s,!1,a,c);try{var se=v(),me=Y.S;if(me!==null&&me(Q,se),se!==null&&typeof se=="object"&&typeof se.then=="function"){var Ce=VA(se,m);nu(s,a,Ce,Ir(s))}else nu(s,a,m,Ir(s))}catch(ke){nu(s,a,{then:function(){},status:"rejected",reason:ke},Ir())}finally{G.p=E,P!==null&&Q.types!==null&&(P.types=Q.types),Y.T=P}}function QA(){}function Tp(s,a,c,m){if(s.tag!==5)throw Error(r(476));var v=jb(s).queue;Ab(s,v,a,Z,c===null?QA:function(){return Rb(s),c(m)})}function jb(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ai,lastRenderedState:Z},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ai,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function Rb(s){var a=jb(s);a.next===null&&(a=s.alternate.memoizedState),nu(s,a.next.queue,{},Ir())}function Ap(){return Bn(bu)}function Ib(){return ln().memoizedState}function kb(){return ln().memoizedState}function KA(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=Ir();s=Yi(c);var m=Xi(a,s,c);m!==null&&(gr(m,a,c),Xc(m,a,c)),a={cache:np()},s.payload=a;return}a=a.return}}function YA(s,a,c){var m=Ir();c={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},dh(s)?Mb(a,c):(c=Hm(s,a,c,m),c!==null&&(gr(c,s,m),Ob(c,a,m)))}function Db(s,a,c){var m=Ir();nu(s,a,c,m)}function nu(s,a,c,m){var v={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(dh(s))Mb(a,v);else{var E=s.alternate;if(s.lanes===0&&(E===null||E.lanes===0)&&(E=a.lastRenderedReducer,E!==null))try{var P=a.lastRenderedState,Q=E(P,c);if(v.hasEagerState=!0,v.eagerState=Q,Er(Q,P))return Hd(s,a,v,0),Lt===null&&qd(),!1}catch{}if(c=Hm(s,a,v,m),c!==null)return gr(c,s,m),Ob(c,a,m),!0}return!1}function jp(s,a,c,m){if(m={lane:2,revertLane:ag(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},dh(s)){if(a)throw Error(r(479))}else a=Hm(s,c,m,2),a!==null&&gr(a,s,2)}function dh(s){var a=s.alternate;return s===it||a!==null&&a===it}function Mb(s,a){vl=sh=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function Ob(s,a,c){if((c&4194048)!==0){var m=a.lanes;m&=s.pendingLanes,c|=m,a.lanes=c,Ec(s,c)}}var ru={readContext:Bn,use:oh,useCallback:rn,useContext:rn,useEffect:rn,useImperativeHandle:rn,useLayoutEffect:rn,useInsertionEffect:rn,useMemo:rn,useReducer:rn,useRef:rn,useState:rn,useDebugValue:rn,useDeferredValue:rn,useTransition:rn,useSyncExternalStore:rn,useId:rn,useHostTransitionStatus:rn,useFormState:rn,useActionState:rn,useOptimistic:rn,useMemoCache:rn,useCacheRefresh:rn};ru.useEffectEvent=rn;var Nb={readContext:Bn,use:oh,useCallback:function(s,a){return or().memoizedState=[s,a===void 0?null:a],s},useContext:Bn,useEffect:_b,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,ch(4194308,4,wb.bind(null,a,s),c)},useLayoutEffect:function(s,a){return ch(4194308,4,s,a)},useInsertionEffect:function(s,a){ch(4,2,s,a)},useMemo:function(s,a){var c=or();a=a===void 0?null:a;var m=s();if(vo){Qn(!0);try{s()}finally{Qn(!1)}}return c.memoizedState=[m,a],m},useReducer:function(s,a,c){var m=or();if(c!==void 0){var v=c(a);if(vo){Qn(!0);try{c(a)}finally{Qn(!1)}}}else v=a;return m.memoizedState=m.baseState=v,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:v},m.queue=s,s=s.dispatch=YA.bind(null,it,s),[m.memoizedState,s]},useRef:function(s){var a=or();return s={current:s},a.memoizedState=s},useState:function(s){s=xp(s);var a=s.queue,c=Db.bind(null,it,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:Ep,useDeferredValue:function(s,a){var c=or();return Cp(c,s,a)},useTransition:function(){var s=xp(!1);return s=Ab.bind(null,it,s.queue,!0,!1),or().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var m=it,v=or();if(_t){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),Lt===null)throw Error(r(349));(ft&127)!==0||nb(m,a,c)}v.memoizedState=c;var E={value:c,getSnapshot:a};return v.queue=E,_b(sb.bind(null,m,E,s),[s]),m.flags|=2048,wl(9,{destroy:void 0},rb.bind(null,m,E,c,a),null),c},useId:function(){var s=or(),a=Lt.identifierPrefix;if(_t){var c=Ns,m=Os;c=(m&~(1<<32-Et(m)-1)).toString(32)+c,a="_"+a+"R_"+c,c=ih++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=$A++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:Ap,useFormState:fb,useActionState:fb,useOptimistic:function(s){var a=or();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=jp.bind(null,it,!0,c),c.dispatch=a,[s,a]},useMemoCache:_p,useCacheRefresh:function(){return or().memoizedState=KA.bind(null,it)},useEffectEvent:function(s){var a=or(),c={impl:s};return a.memoizedState=c,function(){if((Tt&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},Rp={readContext:Bn,use:oh,useCallback:Eb,useContext:Bn,useEffect:Sp,useImperativeHandle:Sb,useInsertionEffect:vb,useLayoutEffect:xb,useMemo:Cb,useReducer:lh,useRef:yb,useState:function(){return lh(ai)},useDebugValue:Ep,useDeferredValue:function(s,a){var c=ln();return Tb(c,Dt.memoizedState,s,a)},useTransition:function(){var s=lh(ai)[0],a=ln().memoizedState;return[typeof s=="boolean"?s:tu(s),a]},useSyncExternalStore:tb,useId:Ib,useHostTransitionStatus:Ap,useFormState:mb,useActionState:mb,useOptimistic:function(s,a){var c=ln();return ob(c,Dt,s,a)},useMemoCache:_p,useCacheRefresh:kb};Rp.useEffectEvent=bb;var Pb={readContext:Bn,use:oh,useCallback:Eb,useContext:Bn,useEffect:Sp,useImperativeHandle:Sb,useInsertionEffect:vb,useLayoutEffect:xb,useMemo:Cb,useReducer:vp,useRef:yb,useState:function(){return vp(ai)},useDebugValue:Ep,useDeferredValue:function(s,a){var c=ln();return Dt===null?Cp(c,s,a):Tb(c,Dt.memoizedState,s,a)},useTransition:function(){var s=vp(ai)[0],a=ln().memoizedState;return[typeof s=="boolean"?s:tu(s),a]},useSyncExternalStore:tb,useId:Ib,useHostTransitionStatus:Ap,useFormState:gb,useActionState:gb,useOptimistic:function(s,a){var c=ln();return Dt!==null?ob(c,Dt,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:_p,useCacheRefresh:kb};Pb.useEffectEvent=bb;function Ip(s,a,c,m){a=s.memoizedState,c=c(m,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var kp={enqueueSetState:function(s,a,c){s=s._reactInternals;var m=Ir(),v=Yi(m);v.payload=a,c!=null&&(v.callback=c),a=Xi(s,v,m),a!==null&&(gr(a,s,m),Xc(a,s,m))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var m=Ir(),v=Yi(m);v.tag=1,v.payload=a,c!=null&&(v.callback=c),a=Xi(s,v,m),a!==null&&(gr(a,s,m),Xc(a,s,m))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=Ir(),m=Yi(c);m.tag=2,a!=null&&(m.callback=a),a=Xi(s,m,c),a!==null&&(gr(a,s,c),Xc(a,s,c))}};function Bb(s,a,c,m,v,E,P){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(m,E,P):a.prototype&&a.prototype.isPureReactComponent?!$c(c,m)||!$c(v,E):!0}function zb(s,a,c,m){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,m),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,m),a.state!==s&&kp.enqueueReplaceState(a,a.state,null)}function xo(s,a){var c=a;if("ref"in a){c={};for(var m in a)m!=="ref"&&(c[m]=a[m])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var v in s)c[v]===void 0&&(c[v]=s[v])}return c}function Lb(s){$d(s)}function Ub(s){console.error(s)}function Fb(s){$d(s)}function hh(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(m){setTimeout(function(){throw m})}}function Vb(s,a,c){try{var m=s.onCaughtError;m(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function Dp(s,a,c){return c=Yi(c),c.tag=3,c.payload={element:null},c.callback=function(){hh(s,a)},c}function $b(s){return s=Yi(s),s.tag=3,s}function qb(s,a,c,m){var v=c.type.getDerivedStateFromError;if(typeof v=="function"){var E=m.value;s.payload=function(){return v(E)},s.callback=function(){Vb(a,c,m)}}var P=c.stateNode;P!==null&&typeof P.componentDidCatch=="function"&&(s.callback=function(){Vb(a,c,m),typeof v!="function"&&(ra===null?ra=new Set([this]):ra.add(this));var Q=m.stack;this.componentDidCatch(m.value,{componentStack:Q!==null?Q:""})})}function XA(s,a,c,m,v){if(c.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(a=c.alternate,a!==null&&ml(a,c,v,!0),c=Tr.current,c!==null){switch(c.tag){case 31:case 13:return qr===null?Eh():c.alternate===null&&sn===0&&(sn=3),c.flags&=-257,c.flags|=65536,c.lanes=v,m===Jd?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([m]):a.add(m),rg(s,m,v)),!1;case 22:return c.flags|=65536,m===Jd?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([m])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([m]):c.add(m)),rg(s,m,v)),!1}throw Error(r(435,c.tag))}return rg(s,m,v),Eh(),!1}if(_t)return a=Tr.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=v,m!==Xm&&(s=Error(r(422),{cause:m}),Gc(Ur(s,c)))):(m!==Xm&&(a=Error(r(423),{cause:m}),Gc(Ur(a,c))),s=s.current.alternate,s.flags|=65536,v&=-v,s.lanes|=v,m=Ur(m,c),v=Dp(s.stateNode,m,v),lp(s,v),sn!==4&&(sn=2)),!1;var E=Error(r(520),{cause:m});if(E=Ur(E,c),du===null?du=[E]:du.push(E),sn!==4&&(sn=2),a===null)return!0;m=Ur(m,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=v&-v,c.lanes|=s,s=Dp(c.stateNode,m,s),lp(c,s),!1;case 1:if(a=c.type,E=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(ra===null||!ra.has(E))))return c.flags|=65536,v&=-v,c.lanes|=v,v=$b(v),qb(v,s,c,m),lp(c,v),!1}c=c.return}while(c!==null);return!1}var Mp=Error(r(461)),yn=!1;function zn(s,a,c,m){a.child=s===null?Q0(a,null,c,m):bo(a,s.child,c,m)}function Hb(s,a,c,m,v){c=c.render;var E=a.ref;if("ref"in m){var P={};for(var Q in m)Q!=="ref"&&(P[Q]=m[Q])}else P=m;return po(a),m=mp(s,a,c,P,E,v),Q=pp(),s!==null&&!yn?(gp(s,a,v),oi(s,a,v)):(_t&&Q&&Km(a),a.flags|=1,zn(s,a,m,v),a.child)}function Gb(s,a,c,m,v){if(s===null){var E=c.type;return typeof E=="function"&&!Gm(E)&&E.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=E,Wb(s,a,E,m,v)):(s=Wd(c.type,null,m,a,a.mode,v),s.ref=a.ref,s.return=a,a.child=s)}if(E=s.child,!Fp(s,v)){var P=E.memoizedProps;if(c=c.compare,c=c!==null?c:$c,c(P,m)&&s.ref===a.ref)return oi(s,a,v)}return a.flags|=1,s=ti(E,m),s.ref=a.ref,s.return=a,a.child=s}function Wb(s,a,c,m,v){if(s!==null){var E=s.memoizedProps;if($c(E,m)&&s.ref===a.ref)if(yn=!1,a.pendingProps=m=E,Fp(s,v))(s.flags&131072)!==0&&(yn=!0);else return a.lanes=s.lanes,oi(s,a,v)}return Op(s,a,c,m,v)}function Qb(s,a,c,m){var v=m.children,E=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((a.flags&128)!==0){if(E=E!==null?E.baseLanes|c:c,s!==null){for(m=a.child=s.child,v=0;m!==null;)v=v|m.lanes|m.childLanes,m=m.sibling;m=v&~E}else m=0,a.child=null;return Kb(s,a,E,c,m)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&Xd(a,E!==null?E.cachePool:null),E!==null?X0(a,E):up(),Z0(a);else return m=a.lanes=536870912,Kb(s,a,E!==null?E.baseLanes|c:c,c,m)}else E!==null?(Xd(a,E.cachePool),X0(a,E),Ji(),a.memoizedState=null):(s!==null&&Xd(a,null),up(),Ji());return zn(s,a,v,c),a.child}function su(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Kb(s,a,c,m,v){var E=sp();return E=E===null?null:{parent:pn._currentValue,pool:E},a.memoizedState={baseLanes:c,cachePool:E},s!==null&&Xd(a,null),up(),Z0(a),s!==null&&ml(s,a,m,!0),a.childLanes=v,null}function fh(s,a){return a=ph({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function Yb(s,a,c){return bo(a,s.child,null,c),s=fh(a,a.pendingProps),s.flags|=2,Ar(a),a.memoizedState=null,s}function ZA(s,a,c){var m=a.pendingProps,v=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(_t){if(m.mode==="hidden")return s=fh(a,m),a.lanes=536870912,su(null,s);if(hp(a),(s=$t)?(s=lx(s,$r),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Hi!==null?{id:Os,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},c=M0(s),c.return=a,a.child=c,Pn=a,$t=null)):s=null,s===null)throw Wi(a);return a.lanes=536870912,null}return fh(a,m)}var E=s.memoizedState;if(E!==null){var P=E.dehydrated;if(hp(a),v)if(a.flags&256)a.flags&=-257,a=Yb(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(r(558));else if(yn||ml(s,a,c,!1),v=(c&s.childLanes)!==0,yn||v){if(m=Lt,m!==null&&(P=Cc(m,c),P!==0&&P!==E.retryLane))throw E.retryLane=P,uo(s,P),gr(m,s,P),Mp;Eh(),a=Yb(s,a,c)}else s=E.treeContext,$t=Hr(P.nextSibling),Pn=a,_t=!0,Gi=null,$r=!1,s!==null&&P0(a,s),a=fh(a,m),a.flags|=4096;return a}return s=ti(s.child,{mode:m.mode,children:m.children}),s.ref=a.ref,a.child=s,s.return=a,s}function mh(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function Op(s,a,c,m,v){return po(a),c=mp(s,a,c,m,void 0,v),m=pp(),s!==null&&!yn?(gp(s,a,v),oi(s,a,v)):(_t&&m&&Km(a),a.flags|=1,zn(s,a,c,v),a.child)}function Xb(s,a,c,m,v,E){return po(a),a.updateQueue=null,c=eb(a,m,c,v),J0(s),m=pp(),s!==null&&!yn?(gp(s,a,E),oi(s,a,E)):(_t&&m&&Km(a),a.flags|=1,zn(s,a,c,E),a.child)}function Zb(s,a,c,m,v){if(po(a),a.stateNode===null){var E=ul,P=c.contextType;typeof P=="object"&&P!==null&&(E=Bn(P)),E=new c(m,E),a.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=kp,a.stateNode=E,E._reactInternals=a,E=a.stateNode,E.props=m,E.state=a.memoizedState,E.refs={},ap(a),P=c.contextType,E.context=typeof P=="object"&&P!==null?Bn(P):ul,E.state=a.memoizedState,P=c.getDerivedStateFromProps,typeof P=="function"&&(Ip(a,c,P,m),E.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(P=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),P!==E.state&&kp.enqueueReplaceState(E,E.state,null),Jc(a,m,E,v),Zc(),E.state=a.memoizedState),typeof E.componentDidMount=="function"&&(a.flags|=4194308),m=!0}else if(s===null){E=a.stateNode;var Q=a.memoizedProps,se=xo(c,Q);E.props=se;var me=E.context,Ce=c.contextType;P=ul,typeof Ce=="object"&&Ce!==null&&(P=Bn(Ce));var ke=c.getDerivedStateFromProps;Ce=typeof ke=="function"||typeof E.getSnapshotBeforeUpdate=="function",Q=a.pendingProps!==Q,Ce||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(Q||me!==P)&&zb(a,E,m,P),Ki=!1;var ye=a.memoizedState;E.state=ye,Jc(a,m,E,v),Zc(),me=a.memoizedState,Q||ye!==me||Ki?(typeof ke=="function"&&(Ip(a,c,ke,m),me=a.memoizedState),(se=Ki||Bb(a,c,se,m,ye,me,P))?(Ce||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(a.flags|=4194308)):(typeof E.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=m,a.memoizedState=me),E.props=m,E.state=me,E.context=P,m=se):(typeof E.componentDidMount=="function"&&(a.flags|=4194308),m=!1)}else{E=a.stateNode,op(s,a),P=a.memoizedProps,Ce=xo(c,P),E.props=Ce,ke=a.pendingProps,ye=E.context,me=c.contextType,se=ul,typeof me=="object"&&me!==null&&(se=Bn(me)),Q=c.getDerivedStateFromProps,(me=typeof Q=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(P!==ke||ye!==se)&&zb(a,E,m,se),Ki=!1,ye=a.memoizedState,E.state=ye,Jc(a,m,E,v),Zc();var xe=a.memoizedState;P!==ke||ye!==xe||Ki||s!==null&&s.dependencies!==null&&Kd(s.dependencies)?(typeof Q=="function"&&(Ip(a,c,Q,m),xe=a.memoizedState),(Ce=Ki||Bb(a,c,Ce,m,ye,xe,se)||s!==null&&s.dependencies!==null&&Kd(s.dependencies))?(me||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(m,xe,se),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(m,xe,se)),typeof E.componentDidUpdate=="function"&&(a.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof E.componentDidUpdate!="function"||P===s.memoizedProps&&ye===s.memoizedState||(a.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||P===s.memoizedProps&&ye===s.memoizedState||(a.flags|=1024),a.memoizedProps=m,a.memoizedState=xe),E.props=m,E.state=xe,E.context=se,m=Ce):(typeof E.componentDidUpdate!="function"||P===s.memoizedProps&&ye===s.memoizedState||(a.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||P===s.memoizedProps&&ye===s.memoizedState||(a.flags|=1024),m=!1)}return E=m,mh(s,a),m=(a.flags&128)!==0,E||m?(E=a.stateNode,c=m&&typeof c.getDerivedStateFromError!="function"?null:E.render(),a.flags|=1,s!==null&&m?(a.child=bo(a,s.child,null,v),a.child=bo(a,null,c,v)):zn(s,a,c,v),a.memoizedState=E.state,s=a.child):s=oi(s,a,v),s}function Jb(s,a,c,m){return fo(),a.flags|=256,zn(s,a,c,m),a.child}var Np={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Pp(s){return{baseLanes:s,cachePool:V0()}}function Bp(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=Rr),s}function ev(s,a,c){var m=a.pendingProps,v=!1,E=(a.flags&128)!==0,P;if((P=E)||(P=s!==null&&s.memoizedState===null?!1:(on.current&2)!==0),P&&(v=!0,a.flags&=-129),P=(a.flags&32)!==0,a.flags&=-33,s===null){if(_t){if(v?Zi(a):Ji(),(s=$t)?(s=lx(s,$r),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Hi!==null?{id:Os,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},c=M0(s),c.return=a,a.child=c,Pn=a,$t=null)):s=null,s===null)throw Wi(a);return bg(s)?a.lanes=32:a.lanes=536870912,null}var Q=m.children;return m=m.fallback,v?(Ji(),v=a.mode,Q=ph({mode:"hidden",children:Q},v),m=ho(m,v,c,null),Q.return=a,m.return=a,Q.sibling=m,a.child=Q,m=a.child,m.memoizedState=Pp(c),m.childLanes=Bp(s,P,c),a.memoizedState=Np,su(null,m)):(Zi(a),zp(a,Q))}var se=s.memoizedState;if(se!==null&&(Q=se.dehydrated,Q!==null)){if(E)a.flags&256?(Zi(a),a.flags&=-257,a=Lp(s,a,c)):a.memoizedState!==null?(Ji(),a.child=s.child,a.flags|=128,a=null):(Ji(),Q=m.fallback,v=a.mode,m=ph({mode:"visible",children:m.children},v),Q=ho(Q,v,c,null),Q.flags|=2,m.return=a,Q.return=a,m.sibling=Q,a.child=m,bo(a,s.child,null,c),m=a.child,m.memoizedState=Pp(c),m.childLanes=Bp(s,P,c),a.memoizedState=Np,a=su(null,m));else if(Zi(a),bg(Q)){if(P=Q.nextSibling&&Q.nextSibling.dataset,P)var me=P.dgst;P=me,m=Error(r(419)),m.stack="",m.digest=P,Gc({value:m,source:null,stack:null}),a=Lp(s,a,c)}else if(yn||ml(s,a,c,!1),P=(c&s.childLanes)!==0,yn||P){if(P=Lt,P!==null&&(m=Cc(P,c),m!==0&&m!==se.retryLane))throw se.retryLane=m,uo(s,m),gr(P,s,m),Mp;_g(Q)||Eh(),a=Lp(s,a,c)}else _g(Q)?(a.flags|=192,a.child=s.child,a=null):(s=se.treeContext,$t=Hr(Q.nextSibling),Pn=a,_t=!0,Gi=null,$r=!1,s!==null&&P0(a,s),a=zp(a,m.children),a.flags|=4096);return a}return v?(Ji(),Q=m.fallback,v=a.mode,se=s.child,me=se.sibling,m=ti(se,{mode:"hidden",children:m.children}),m.subtreeFlags=se.subtreeFlags&65011712,me!==null?Q=ti(me,Q):(Q=ho(Q,v,c,null),Q.flags|=2),Q.return=a,m.return=a,m.sibling=Q,a.child=m,su(null,m),m=a.child,Q=s.child.memoizedState,Q===null?Q=Pp(c):(v=Q.cachePool,v!==null?(se=pn._currentValue,v=v.parent!==se?{parent:se,pool:se}:v):v=V0(),Q={baseLanes:Q.baseLanes|c,cachePool:v}),m.memoizedState=Q,m.childLanes=Bp(s,P,c),a.memoizedState=Np,su(s.child,m)):(Zi(a),c=s.child,s=c.sibling,c=ti(c,{mode:"visible",children:m.children}),c.return=a,c.sibling=null,s!==null&&(P=a.deletions,P===null?(a.deletions=[s],a.flags|=16):P.push(s)),a.child=c,a.memoizedState=null,c)}function zp(s,a){return a=ph({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function ph(s,a){return s=Cr(22,s,null,a),s.lanes=0,s}function Lp(s,a,c){return bo(a,s.child,null,c),s=zp(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function tv(s,a,c){s.lanes|=a;var m=s.alternate;m!==null&&(m.lanes|=a),ep(s.return,a,c)}function Up(s,a,c,m,v,E){var P=s.memoizedState;P===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:m,tail:c,tailMode:v,treeForkCount:E}:(P.isBackwards=a,P.rendering=null,P.renderingStartTime=0,P.last=m,P.tail=c,P.tailMode=v,P.treeForkCount=E)}function nv(s,a,c){var m=a.pendingProps,v=m.revealOrder,E=m.tail;m=m.children;var P=on.current,Q=(P&2)!==0;if(Q?(P=P&1|2,a.flags|=128):P&=1,ne(on,P),zn(s,a,m,c),m=_t?Hc:0,!Q&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&tv(s,c,a);else if(s.tag===19)tv(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(v){case"forwards":for(c=a.child,v=null;c!==null;)s=c.alternate,s!==null&&rh(s)===null&&(v=c),c=c.sibling;c=v,c===null?(v=a.child,a.child=null):(v=c.sibling,c.sibling=null),Up(a,!1,v,c,E,m);break;case"backwards":case"unstable_legacy-backwards":for(c=null,v=a.child,a.child=null;v!==null;){if(s=v.alternate,s!==null&&rh(s)===null){a.child=v;break}s=v.sibling,v.sibling=c,c=v,v=s}Up(a,!0,c,null,E,m);break;case"together":Up(a,!1,null,null,void 0,m);break;default:a.memoizedState=null}return a.child}function oi(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),na|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(ml(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(r(153));if(a.child!==null){for(s=a.child,c=ti(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=ti(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Fp(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&Kd(s)))}function JA(s,a,c){switch(a.tag){case 3:oe(a,a.stateNode.containerInfo),Qi(a,pn,s.memoizedState.cache),fo();break;case 27:case 5:Ne(a);break;case 4:oe(a,a.stateNode.containerInfo);break;case 10:Qi(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,hp(a),null;break;case 13:var m=a.memoizedState;if(m!==null)return m.dehydrated!==null?(Zi(a),a.flags|=128,null):(c&a.child.childLanes)!==0?ev(s,a,c):(Zi(a),s=oi(s,a,c),s!==null?s.sibling:null);Zi(a);break;case 19:var v=(s.flags&128)!==0;if(m=(c&a.childLanes)!==0,m||(ml(s,a,c,!1),m=(c&a.childLanes)!==0),v){if(m)return nv(s,a,c);a.flags|=128}if(v=a.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),ne(on,on.current),m)break;return null;case 22:return a.lanes=0,Qb(s,a,c,a.pendingProps);case 24:Qi(a,pn,s.memoizedState.cache)}return oi(s,a,c)}function rv(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)yn=!0;else{if(!Fp(s,c)&&(a.flags&128)===0)return yn=!1,JA(s,a,c);yn=(s.flags&131072)!==0}else yn=!1,_t&&(a.flags&1048576)!==0&&N0(a,Hc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var m=a.pendingProps;if(s=yo(a.elementType),a.type=s,typeof s=="function")Gm(s)?(m=xo(s,m),a.tag=1,a=Zb(null,a,s,m,c)):(a.tag=0,a=Op(null,a,s,m,c));else{if(s!=null){var v=s.$$typeof;if(v===k){a.tag=11,a=Hb(null,a,s,m,c);break e}else if(v===D){a.tag=14,a=Gb(null,a,s,m,c);break e}}throw a=M(s)||s,Error(r(306,a,""))}}return a;case 0:return Op(s,a,a.type,a.pendingProps,c);case 1:return m=a.type,v=xo(m,a.pendingProps),Zb(s,a,m,v,c);case 3:e:{if(oe(a,a.stateNode.containerInfo),s===null)throw Error(r(387));m=a.pendingProps;var E=a.memoizedState;v=E.element,op(s,a),Jc(a,m,null,c);var P=a.memoizedState;if(m=P.cache,Qi(a,pn,m),m!==E.cache&&tp(a,[pn],c,!0),Zc(),m=P.element,E.isDehydrated)if(E={element:m,isDehydrated:!1,cache:P.cache},a.updateQueue.baseState=E,a.memoizedState=E,a.flags&256){a=Jb(s,a,m,c);break e}else if(m!==v){v=Ur(Error(r(424)),a),Gc(v),a=Jb(s,a,m,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,$t=Hr(s.firstChild),Pn=a,_t=!0,Gi=null,$r=!0,c=Q0(a,null,m,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(fo(),m===v){a=oi(s,a,c);break e}zn(s,a,m,c)}a=a.child}return a;case 26:return mh(s,a),s===null?(c=mx(a.type,null,a.pendingProps,null))?a.memoizedState=c:_t||(c=a.type,s=a.pendingProps,m=kh(_e.current).createElement(c),m[hn]=a,m[kn]=s,Ln(m,c,s),fn(m),a.stateNode=m):a.memoizedState=mx(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return Ne(a),s===null&&_t&&(m=a.stateNode=dx(a.type,a.pendingProps,_e.current),Pn=a,$r=!0,v=$t,oa(a.type)?(vg=v,$t=Hr(m.firstChild)):$t=v),zn(s,a,a.pendingProps.children,c),mh(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&_t&&((v=m=$t)&&(m=Rj(m,a.type,a.pendingProps,$r),m!==null?(a.stateNode=m,Pn=a,$t=Hr(m.firstChild),$r=!1,v=!0):v=!1),v||Wi(a)),Ne(a),v=a.type,E=a.pendingProps,P=s!==null?s.memoizedProps:null,m=E.children,pg(v,E)?m=null:P!==null&&pg(v,P)&&(a.flags|=32),a.memoizedState!==null&&(v=mp(s,a,qA,null,null,c),bu._currentValue=v),mh(s,a),zn(s,a,m,c),a.child;case 6:return s===null&&_t&&((s=c=$t)&&(c=Ij(c,a.pendingProps,$r),c!==null?(a.stateNode=c,Pn=a,$t=null,s=!0):s=!1),s||Wi(a)),null;case 13:return ev(s,a,c);case 4:return oe(a,a.stateNode.containerInfo),m=a.pendingProps,s===null?a.child=bo(a,null,m,c):zn(s,a,m,c),a.child;case 11:return Hb(s,a,a.type,a.pendingProps,c);case 7:return zn(s,a,a.pendingProps,c),a.child;case 8:return zn(s,a,a.pendingProps.children,c),a.child;case 12:return zn(s,a,a.pendingProps.children,c),a.child;case 10:return m=a.pendingProps,Qi(a,a.type,m.value),zn(s,a,m.children,c),a.child;case 9:return v=a.type._context,m=a.pendingProps.children,po(a),v=Bn(v),m=m(v),a.flags|=1,zn(s,a,m,c),a.child;case 14:return Gb(s,a,a.type,a.pendingProps,c);case 15:return Wb(s,a,a.type,a.pendingProps,c);case 19:return nv(s,a,c);case 31:return ZA(s,a,c);case 22:return Qb(s,a,c,a.pendingProps);case 24:return po(a),m=Bn(pn),s===null?(v=sp(),v===null&&(v=Lt,E=np(),v.pooledCache=E,E.refCount++,E!==null&&(v.pooledCacheLanes|=c),v=E),a.memoizedState={parent:m,cache:v},ap(a),Qi(a,pn,v)):((s.lanes&c)!==0&&(op(s,a),Jc(a,null,null,c),Zc()),v=s.memoizedState,E=a.memoizedState,v.parent!==m?(v={parent:m,cache:m},a.memoizedState=v,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=v),Qi(a,pn,m)):(m=E.cache,Qi(a,pn,m),m!==v.cache&&tp(a,[pn],c,!0))),zn(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function li(s){s.flags|=4}function Vp(s,a,c,m,v){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(v&335544128)===v)if(s.stateNode.complete)s.flags|=8192;else if(Iv())s.flags|=8192;else throw _o=Jd,ip}else s.flags&=-16777217}function sv(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!bx(a))if(Iv())s.flags|=8192;else throw _o=Jd,ip}function gh(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?wd():536870912,s.lanes|=a,Tl|=a)}function iu(s,a){if(!_t)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var m=null;c!==null;)c.alternate!==null&&(m=c),c=c.sibling;m===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:m.sibling=null}}function qt(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,m=0;if(a)for(var v=s.child;v!==null;)c|=v.lanes|v.childLanes,m|=v.subtreeFlags&65011712,m|=v.flags&65011712,v.return=s,v=v.sibling;else for(v=s.child;v!==null;)c|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=s,v=v.sibling;return s.subtreeFlags|=m,s.childLanes=c,a}function ej(s,a,c){var m=a.pendingProps;switch(Ym(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(a),null;case 1:return qt(a),null;case 3:return c=a.stateNode,m=null,s!==null&&(m=s.memoizedState.cache),a.memoizedState.cache!==m&&(a.flags|=2048),si(pn),be(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(fl(a)?li(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Zm())),qt(a),null;case 26:var v=a.type,E=a.memoizedState;return s===null?(li(a),E!==null?(qt(a),sv(a,E)):(qt(a),Vp(a,v,null,m,c))):E?E!==s.memoizedState?(li(a),qt(a),sv(a,E)):(qt(a),a.flags&=-16777217):(s=s.memoizedProps,s!==m&&li(a),qt(a),Vp(a,v,s,m,c)),null;case 27:if(Me(a),c=_e.current,v=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&li(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return qt(a),null}s=re.current,fl(a)?B0(a):(s=dx(v,m,c),a.stateNode=s,li(a))}return qt(a),null;case 5:if(Me(a),v=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==m&&li(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return qt(a),null}if(E=re.current,fl(a))B0(a);else{var P=kh(_e.current);switch(E){case 1:E=P.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:E=P.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":E=P.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":E=P.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":E=P.createElement("div"),E.innerHTML="<script><\/script>",E=E.removeChild(E.firstChild);break;case"select":E=typeof m.is=="string"?P.createElement("select",{is:m.is}):P.createElement("select"),m.multiple?E.multiple=!0:m.size&&(E.size=m.size);break;default:E=typeof m.is=="string"?P.createElement(v,{is:m.is}):P.createElement(v)}}E[hn]=a,E[kn]=m;e:for(P=a.child;P!==null;){if(P.tag===5||P.tag===6)E.appendChild(P.stateNode);else if(P.tag!==4&&P.tag!==27&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===a)break e;for(;P.sibling===null;){if(P.return===null||P.return===a)break e;P=P.return}P.sibling.return=P.return,P=P.sibling}a.stateNode=E;e:switch(Ln(E,v,m),v){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&li(a)}}return qt(a),Vp(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==m&&li(a);else{if(typeof m!="string"&&a.stateNode===null)throw Error(r(166));if(s=_e.current,fl(a)){if(s=a.stateNode,c=a.memoizedProps,m=null,v=Pn,v!==null)switch(v.tag){case 27:case 5:m=v.memoizedProps}s[hn]=a,s=!!(s.nodeValue===c||m!==null&&m.suppressHydrationWarning===!0||ex(s.nodeValue,c)),s||Wi(a,!0)}else s=kh(s).createTextNode(m),s[hn]=a,a.stateNode=s}return qt(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(m=fl(a),c!==null){if(s===null){if(!m)throw Error(r(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[hn]=a}else fo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qt(a),s=!1}else c=Zm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(Ar(a),a):(Ar(a),null);if((a.flags&128)!==0)throw Error(r(558))}return qt(a),null;case 13:if(m=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(v=fl(a),m!==null&&m.dehydrated!==null){if(s===null){if(!v)throw Error(r(318));if(v=a.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[hn]=a}else fo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qt(a),v=!1}else v=Zm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=v),v=!0;if(!v)return a.flags&256?(Ar(a),a):(Ar(a),null)}return Ar(a),(a.flags&128)!==0?(a.lanes=c,a):(c=m!==null,s=s!==null&&s.memoizedState!==null,c&&(m=a.child,v=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(v=m.alternate.memoizedState.cachePool.pool),E=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(E=m.memoizedState.cachePool.pool),E!==v&&(m.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),gh(a,a.updateQueue),qt(a),null);case 4:return be(),s===null&&ug(a.stateNode.containerInfo),qt(a),null;case 10:return si(a.type),qt(a),null;case 19:if(H(on),m=a.memoizedState,m===null)return qt(a),null;if(v=(a.flags&128)!==0,E=m.rendering,E===null)if(v)iu(m,!1);else{if(sn!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(E=rh(s),E!==null){for(a.flags|=128,iu(m,!1),s=E.updateQueue,a.updateQueue=s,gh(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)D0(c,s),c=c.sibling;return ne(on,on.current&1|2),_t&&ni(a,m.treeForkCount),a.child}s=s.sibling}m.tail!==null&&Be()>xh&&(a.flags|=128,v=!0,iu(m,!1),a.lanes=4194304)}else{if(!v)if(s=rh(E),s!==null){if(a.flags|=128,v=!0,s=s.updateQueue,a.updateQueue=s,gh(a,s),iu(m,!0),m.tail===null&&m.tailMode==="hidden"&&!E.alternate&&!_t)return qt(a),null}else 2*Be()-m.renderingStartTime>xh&&c!==536870912&&(a.flags|=128,v=!0,iu(m,!1),a.lanes=4194304);m.isBackwards?(E.sibling=a.child,a.child=E):(s=m.last,s!==null?s.sibling=E:a.child=E,m.last=E)}return m.tail!==null?(s=m.tail,m.rendering=s,m.tail=s.sibling,m.renderingStartTime=Be(),s.sibling=null,c=on.current,ne(on,v?c&1|2:c&1),_t&&ni(a,m.treeForkCount),s):(qt(a),null);case 22:case 23:return Ar(a),dp(),m=a.memoizedState!==null,s!==null?s.memoizedState!==null!==m&&(a.flags|=8192):m&&(a.flags|=8192),m?(c&536870912)!==0&&(a.flags&128)===0&&(qt(a),a.subtreeFlags&6&&(a.flags|=8192)):qt(a),c=a.updateQueue,c!==null&&gh(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),m=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),m!==c&&(a.flags|=2048),s!==null&&H(go),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),si(pn),qt(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function tj(s,a){switch(Ym(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return si(pn),be(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Me(a),null;case 31:if(a.memoizedState!==null){if(Ar(a),a.alternate===null)throw Error(r(340));fo()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(Ar(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(r(340));fo()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return H(on),null;case 4:return be(),null;case 10:return si(a.type),null;case 22:case 23:return Ar(a),dp(),s!==null&&H(go),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return si(pn),null;case 25:return null;default:return null}}function iv(s,a){switch(Ym(a),a.tag){case 3:si(pn),be();break;case 26:case 27:case 5:Me(a);break;case 4:be();break;case 31:a.memoizedState!==null&&Ar(a);break;case 13:Ar(a);break;case 19:H(on);break;case 10:si(a.type);break;case 22:case 23:Ar(a),dp(),s!==null&&H(go);break;case 24:si(pn)}}function au(s,a){try{var c=a.updateQueue,m=c!==null?c.lastEffect:null;if(m!==null){var v=m.next;c=v;do{if((c.tag&s)===s){m=void 0;var E=c.create,P=c.inst;m=E(),P.destroy=m}c=c.next}while(c!==v)}}catch(Q){It(a,a.return,Q)}}function ea(s,a,c){try{var m=a.updateQueue,v=m!==null?m.lastEffect:null;if(v!==null){var E=v.next;m=E;do{if((m.tag&s)===s){var P=m.inst,Q=P.destroy;if(Q!==void 0){P.destroy=void 0,v=a;var se=c,me=Q;try{me()}catch(Ce){It(v,se,Ce)}}}m=m.next}while(m!==E)}}catch(Ce){It(a,a.return,Ce)}}function av(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{Y0(a,c)}catch(m){It(s,s.return,m)}}}function ov(s,a,c){c.props=xo(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(m){It(s,a,m)}}function ou(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var m=s.stateNode;break;case 30:m=s.stateNode;break;default:m=s.stateNode}typeof c=="function"?s.refCleanup=c(m):c.current=m}}catch(v){It(s,a,v)}}function Ps(s,a){var c=s.ref,m=s.refCleanup;if(c!==null)if(typeof m=="function")try{m()}catch(v){It(s,a,v)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(v){It(s,a,v)}else c.current=null}function lv(s){var a=s.type,c=s.memoizedProps,m=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&m.focus();break e;case"img":c.src?m.src=c.src:c.srcSet&&(m.srcset=c.srcSet)}}catch(v){It(s,s.return,v)}}function $p(s,a,c){try{var m=s.stateNode;Sj(m,s.type,c,a),m[kn]=a}catch(v){It(s,s.return,v)}}function cv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&oa(s.type)||s.tag===4}function qp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||cv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&oa(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Hp(s,a,c){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=ts));else if(m!==4&&(m===27&&oa(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Hp(s,a,c),s=s.sibling;s!==null;)Hp(s,a,c),s=s.sibling}function yh(s,a,c){var m=s.tag;if(m===5||m===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(m!==4&&(m===27&&oa(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(yh(s,a,c),s=s.sibling;s!==null;)yh(s,a,c),s=s.sibling}function uv(s){var a=s.stateNode,c=s.memoizedProps;try{for(var m=s.type,v=a.attributes;v.length;)a.removeAttributeNode(v[0]);Ln(a,m,c),a[hn]=s,a[kn]=c}catch(E){It(s,s.return,E)}}var ci=!1,_n=!1,Gp=!1,dv=typeof WeakSet=="function"?WeakSet:Set,Mn=null;function nj(s,a){if(s=s.containerInfo,fg=zh,s=S0(s),Lm(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var m=c.getSelection&&c.getSelection();if(m&&m.rangeCount!==0){c=m.anchorNode;var v=m.anchorOffset,E=m.focusNode;m=m.focusOffset;try{c.nodeType,E.nodeType}catch{c=null;break e}var P=0,Q=-1,se=-1,me=0,Ce=0,ke=s,ye=null;t:for(;;){for(var xe;ke!==c||v!==0&&ke.nodeType!==3||(Q=P+v),ke!==E||m!==0&&ke.nodeType!==3||(se=P+m),ke.nodeType===3&&(P+=ke.nodeValue.length),(xe=ke.firstChild)!==null;)ye=ke,ke=xe;for(;;){if(ke===s)break t;if(ye===c&&++me===v&&(Q=P),ye===E&&++Ce===m&&(se=P),(xe=ke.nextSibling)!==null)break;ke=ye,ye=ke.parentNode}ke=xe}c=Q===-1||se===-1?null:{start:Q,end:se}}else c=null}c=c||{start:0,end:0}}else c=null;for(mg={focusedElem:s,selectionRange:c},zh=!1,Mn=a;Mn!==null;)if(a=Mn,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,Mn=s;else for(;Mn!==null;){switch(a=Mn,E=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)v=s[c],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&E!==null){s=void 0,c=a,v=E.memoizedProps,E=E.memoizedState,m=c.stateNode;try{var Fe=xo(c.type,v);s=m.getSnapshotBeforeUpdate(Fe,E),m.__reactInternalSnapshotBeforeUpdate=s}catch(Ke){It(c,c.return,Ke)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)yg(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":yg(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=a.sibling,s!==null){s.return=a.return,Mn=s;break}Mn=a.return}}function hv(s,a,c){var m=c.flags;switch(c.tag){case 0:case 11:case 15:di(s,c),m&4&&au(5,c);break;case 1:if(di(s,c),m&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(P){It(c,c.return,P)}else{var v=xo(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(v,a,s.__reactInternalSnapshotBeforeUpdate)}catch(P){It(c,c.return,P)}}m&64&&av(c),m&512&&ou(c,c.return);break;case 3:if(di(s,c),m&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{Y0(s,a)}catch(P){It(c,c.return,P)}}break;case 27:a===null&&m&4&&uv(c);case 26:case 5:di(s,c),a===null&&m&4&&lv(c),m&512&&ou(c,c.return);break;case 12:di(s,c);break;case 31:di(s,c),m&4&&pv(s,c);break;case 13:di(s,c),m&4&&gv(s,c),m&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=dj.bind(null,c),kj(s,c))));break;case 22:if(m=c.memoizedState!==null||ci,!m){a=a!==null&&a.memoizedState!==null||_n,v=ci;var E=_n;ci=m,(_n=a)&&!E?hi(s,c,(c.subtreeFlags&8772)!==0):di(s,c),ci=v,_n=E}break;case 30:break;default:di(s,c)}}function fv(s){var a=s.alternate;a!==null&&(s.alternate=null,fv(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Yo(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Qt=null,hr=!1;function ui(s,a,c){for(c=c.child;c!==null;)mv(s,a,c),c=c.sibling}function mv(s,a,c){if(nn&&typeof nn.onCommitFiberUnmount=="function")try{nn.onCommitFiberUnmount(vt,c)}catch{}switch(c.tag){case 26:_n||Ps(c,a),ui(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:_n||Ps(c,a);var m=Qt,v=hr;oa(c.type)&&(Qt=c.stateNode,hr=!1),ui(s,a,c),gu(c.stateNode),Qt=m,hr=v;break;case 5:_n||Ps(c,a);case 6:if(m=Qt,v=hr,Qt=null,ui(s,a,c),Qt=m,hr=v,Qt!==null)if(hr)try{(Qt.nodeType===9?Qt.body:Qt.nodeName==="HTML"?Qt.ownerDocument.body:Qt).removeChild(c.stateNode)}catch(E){It(c,a,E)}else try{Qt.removeChild(c.stateNode)}catch(E){It(c,a,E)}break;case 18:Qt!==null&&(hr?(s=Qt,ax(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Ol(s)):ax(Qt,c.stateNode));break;case 4:m=Qt,v=hr,Qt=c.stateNode.containerInfo,hr=!0,ui(s,a,c),Qt=m,hr=v;break;case 0:case 11:case 14:case 15:ea(2,c,a),_n||ea(4,c,a),ui(s,a,c);break;case 1:_n||(Ps(c,a),m=c.stateNode,typeof m.componentWillUnmount=="function"&&ov(c,a,m)),ui(s,a,c);break;case 21:ui(s,a,c);break;case 22:_n=(m=_n)||c.memoizedState!==null,ui(s,a,c),_n=m;break;default:ui(s,a,c)}}function pv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Ol(s)}catch(c){It(a,a.return,c)}}}function gv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Ol(s)}catch(c){It(a,a.return,c)}}function rj(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new dv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new dv),a;default:throw Error(r(435,s.tag))}}function _h(s,a){var c=rj(s);a.forEach(function(m){if(!c.has(m)){c.add(m);var v=hj.bind(null,s,m);m.then(v,v)}})}function fr(s,a){var c=a.deletions;if(c!==null)for(var m=0;m<c.length;m++){var v=c[m],E=s,P=a,Q=P;e:for(;Q!==null;){switch(Q.tag){case 27:if(oa(Q.type)){Qt=Q.stateNode,hr=!1;break e}break;case 5:Qt=Q.stateNode,hr=!1;break e;case 3:case 4:Qt=Q.stateNode.containerInfo,hr=!0;break e}Q=Q.return}if(Qt===null)throw Error(r(160));mv(E,P,v),Qt=null,hr=!1,E=v.alternate,E!==null&&(E.return=null),v.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)yv(a,s),a=a.sibling}var os=null;function yv(s,a){var c=s.alternate,m=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:fr(a,s),mr(s),m&4&&(ea(3,s,s.return),au(3,s),ea(5,s,s.return));break;case 1:fr(a,s),mr(s),m&512&&(_n||c===null||Ps(c,c.return)),m&64&&ci&&(s=s.updateQueue,s!==null&&(m=s.callbacks,m!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?m:c.concat(m))));break;case 26:var v=os;if(fr(a,s),mr(s),m&512&&(_n||c===null||Ps(c,c.return)),m&4){var E=c!==null?c.memoizedState:null;if(m=s.memoizedState,c===null)if(m===null)if(s.stateNode===null){e:{m=s.type,c=s.memoizedProps,v=v.ownerDocument||v;t:switch(m){case"title":E=v.getElementsByTagName("title")[0],(!E||E[ws]||E[hn]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=v.createElement(m),v.head.insertBefore(E,v.querySelector("head > title"))),Ln(E,m,c),E[hn]=s,fn(E),m=E;break e;case"link":var P=yx("link","href",v).get(m+(c.href||""));if(P){for(var Q=0;Q<P.length;Q++)if(E=P[Q],E.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&E.getAttribute("rel")===(c.rel==null?null:c.rel)&&E.getAttribute("title")===(c.title==null?null:c.title)&&E.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){P.splice(Q,1);break t}}E=v.createElement(m),Ln(E,m,c),v.head.appendChild(E);break;case"meta":if(P=yx("meta","content",v).get(m+(c.content||""))){for(Q=0;Q<P.length;Q++)if(E=P[Q],E.getAttribute("content")===(c.content==null?null:""+c.content)&&E.getAttribute("name")===(c.name==null?null:c.name)&&E.getAttribute("property")===(c.property==null?null:c.property)&&E.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&E.getAttribute("charset")===(c.charSet==null?null:c.charSet)){P.splice(Q,1);break t}}E=v.createElement(m),Ln(E,m,c),v.head.appendChild(E);break;default:throw Error(r(468,m))}E[hn]=s,fn(E),m=E}s.stateNode=m}else _x(v,s.type,s.stateNode);else s.stateNode=gx(v,m,s.memoizedProps);else E!==m?(E===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):E.count--,m===null?_x(v,s.type,s.stateNode):gx(v,m,s.memoizedProps)):m===null&&s.stateNode!==null&&$p(s,s.memoizedProps,c.memoizedProps)}break;case 27:fr(a,s),mr(s),m&512&&(_n||c===null||Ps(c,c.return)),c!==null&&m&4&&$p(s,s.memoizedProps,c.memoizedProps);break;case 5:if(fr(a,s),mr(s),m&512&&(_n||c===null||Ps(c,c.return)),s.flags&32){v=s.stateNode;try{dr(v,"")}catch(Fe){It(s,s.return,Fe)}}m&4&&s.stateNode!=null&&(v=s.memoizedProps,$p(s,v,c!==null?c.memoizedProps:v)),m&1024&&(Gp=!0);break;case 6:if(fr(a,s),mr(s),m&4){if(s.stateNode===null)throw Error(r(162));m=s.memoizedProps,c=s.stateNode;try{c.nodeValue=m}catch(Fe){It(s,s.return,Fe)}}break;case 3:if(Oh=null,v=os,os=Dh(a.containerInfo),fr(a,s),os=v,mr(s),m&4&&c!==null&&c.memoizedState.isDehydrated)try{Ol(a.containerInfo)}catch(Fe){It(s,s.return,Fe)}Gp&&(Gp=!1,_v(s));break;case 4:m=os,os=Dh(s.stateNode.containerInfo),fr(a,s),mr(s),os=m;break;case 12:fr(a,s),mr(s);break;case 31:fr(a,s),mr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,_h(s,m)));break;case 13:fr(a,s),mr(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(vh=Be()),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,_h(s,m)));break;case 22:v=s.memoizedState!==null;var se=c!==null&&c.memoizedState!==null,me=ci,Ce=_n;if(ci=me||v,_n=Ce||se,fr(a,s),_n=Ce,ci=me,mr(s),m&8192)e:for(a=s.stateNode,a._visibility=v?a._visibility&-2:a._visibility|1,v&&(c===null||se||ci||_n||wo(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){se=c=a;try{if(E=se.stateNode,v)P=E.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none";else{Q=se.stateNode;var ke=se.memoizedProps.style,ye=ke!=null&&ke.hasOwnProperty("display")?ke.display:null;Q.style.display=ye==null||typeof ye=="boolean"?"":(""+ye).trim()}}catch(Fe){It(se,se.return,Fe)}}}else if(a.tag===6){if(c===null){se=a;try{se.stateNode.nodeValue=v?"":se.memoizedProps}catch(Fe){It(se,se.return,Fe)}}}else if(a.tag===18){if(c===null){se=a;try{var xe=se.stateNode;v?ox(xe,!0):ox(se.stateNode,!1)}catch(Fe){It(se,se.return,Fe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}m&4&&(m=s.updateQueue,m!==null&&(c=m.retryQueue,c!==null&&(m.retryQueue=null,_h(s,c))));break;case 19:fr(a,s),mr(s),m&4&&(m=s.updateQueue,m!==null&&(s.updateQueue=null,_h(s,m)));break;case 30:break;case 21:break;default:fr(a,s),mr(s)}}function mr(s){var a=s.flags;if(a&2){try{for(var c,m=s.return;m!==null;){if(cv(m)){c=m;break}m=m.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var v=c.stateNode,E=qp(s);yh(s,E,v);break;case 5:var P=c.stateNode;c.flags&32&&(dr(P,""),c.flags&=-33);var Q=qp(s);yh(s,Q,P);break;case 3:case 4:var se=c.stateNode.containerInfo,me=qp(s);Hp(s,me,se);break;default:throw Error(r(161))}}catch(Ce){It(s,s.return,Ce)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function _v(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;_v(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function di(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)hv(s,a.alternate,a),a=a.sibling}function wo(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:ea(4,a,a.return),wo(a);break;case 1:Ps(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&ov(a,a.return,c),wo(a);break;case 27:gu(a.stateNode);case 26:case 5:Ps(a,a.return),wo(a);break;case 22:a.memoizedState===null&&wo(a);break;case 30:wo(a);break;default:wo(a)}s=s.sibling}}function hi(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var m=a.alternate,v=s,E=a,P=E.flags;switch(E.tag){case 0:case 11:case 15:hi(v,E,c),au(4,E);break;case 1:if(hi(v,E,c),m=E,v=m.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(me){It(m,m.return,me)}if(m=E,v=m.updateQueue,v!==null){var Q=m.stateNode;try{var se=v.shared.hiddenCallbacks;if(se!==null)for(v.shared.hiddenCallbacks=null,v=0;v<se.length;v++)K0(se[v],Q)}catch(me){It(m,m.return,me)}}c&&P&64&&av(E),ou(E,E.return);break;case 27:uv(E);case 26:case 5:hi(v,E,c),c&&m===null&&P&4&&lv(E),ou(E,E.return);break;case 12:hi(v,E,c);break;case 31:hi(v,E,c),c&&P&4&&pv(v,E);break;case 13:hi(v,E,c),c&&P&4&&gv(v,E);break;case 22:E.memoizedState===null&&hi(v,E,c),ou(E,E.return);break;case 30:break;default:hi(v,E,c)}a=a.sibling}}function Wp(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Wc(c))}function Qp(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Wc(s))}function ls(s,a,c,m){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)bv(s,a,c,m),a=a.sibling}function bv(s,a,c,m){var v=a.flags;switch(a.tag){case 0:case 11:case 15:ls(s,a,c,m),v&2048&&au(9,a);break;case 1:ls(s,a,c,m);break;case 3:ls(s,a,c,m),v&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Wc(s)));break;case 12:if(v&2048){ls(s,a,c,m),s=a.stateNode;try{var E=a.memoizedProps,P=E.id,Q=E.onPostCommit;typeof Q=="function"&&Q(P,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(se){It(a,a.return,se)}}else ls(s,a,c,m);break;case 31:ls(s,a,c,m);break;case 13:ls(s,a,c,m);break;case 23:break;case 22:E=a.stateNode,P=a.alternate,a.memoizedState!==null?E._visibility&2?ls(s,a,c,m):lu(s,a):E._visibility&2?ls(s,a,c,m):(E._visibility|=2,Sl(s,a,c,m,(a.subtreeFlags&10256)!==0||!1)),v&2048&&Wp(P,a);break;case 24:ls(s,a,c,m),v&2048&&Qp(a.alternate,a);break;default:ls(s,a,c,m)}}function Sl(s,a,c,m,v){for(v=v&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var E=s,P=a,Q=c,se=m,me=P.flags;switch(P.tag){case 0:case 11:case 15:Sl(E,P,Q,se,v),au(8,P);break;case 23:break;case 22:var Ce=P.stateNode;P.memoizedState!==null?Ce._visibility&2?Sl(E,P,Q,se,v):lu(E,P):(Ce._visibility|=2,Sl(E,P,Q,se,v)),v&&me&2048&&Wp(P.alternate,P);break;case 24:Sl(E,P,Q,se,v),v&&me&2048&&Qp(P.alternate,P);break;default:Sl(E,P,Q,se,v)}a=a.sibling}}function lu(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,m=a,v=m.flags;switch(m.tag){case 22:lu(c,m),v&2048&&Wp(m.alternate,m);break;case 24:lu(c,m),v&2048&&Qp(m.alternate,m);break;default:lu(c,m)}a=a.sibling}}var cu=8192;function El(s,a,c){if(s.subtreeFlags&cu)for(s=s.child;s!==null;)vv(s,a,c),s=s.sibling}function vv(s,a,c){switch(s.tag){case 26:El(s,a,c),s.flags&cu&&s.memoizedState!==null&&$j(c,os,s.memoizedState,s.memoizedProps);break;case 5:El(s,a,c);break;case 3:case 4:var m=os;os=Dh(s.stateNode.containerInfo),El(s,a,c),os=m;break;case 22:s.memoizedState===null&&(m=s.alternate,m!==null&&m.memoizedState!==null?(m=cu,cu=16777216,El(s,a,c),cu=m):El(s,a,c));break;default:El(s,a,c)}}function xv(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function uu(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];Mn=m,Sv(m,s)}xv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)wv(s),s=s.sibling}function wv(s){switch(s.tag){case 0:case 11:case 15:uu(s),s.flags&2048&&ea(9,s,s.return);break;case 3:uu(s);break;case 12:uu(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,bh(s)):uu(s);break;default:uu(s)}}function bh(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];Mn=m,Sv(m,s)}xv(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:ea(8,a,a.return),bh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,bh(a));break;default:bh(a)}s=s.sibling}}function Sv(s,a){for(;Mn!==null;){var c=Mn;switch(c.tag){case 0:case 11:case 15:ea(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var m=c.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Wc(c.memoizedState.cache)}if(m=c.child,m!==null)m.return=c,Mn=m;else e:for(c=s;Mn!==null;){m=Mn;var v=m.sibling,E=m.return;if(fv(m),m===c){Mn=null;break e}if(v!==null){v.return=E,Mn=v;break e}Mn=E}}}var sj={getCacheForType:function(s){var a=Bn(pn),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return Bn(pn).controller.signal}},ij=typeof WeakMap=="function"?WeakMap:Map,Tt=0,Lt=null,ut=null,ft=0,Rt=0,jr=null,ta=!1,Cl=!1,Kp=!1,fi=0,sn=0,na=0,So=0,Yp=0,Rr=0,Tl=0,du=null,pr=null,Xp=!1,vh=0,Ev=0,xh=1/0,wh=null,ra=null,En=0,sa=null,Al=null,mi=0,Zp=0,Jp=null,Cv=null,hu=0,eg=null;function Ir(){return(Tt&2)!==0&&ft!==0?ft&-ft:Y.T!==null?ag():Sd()}function Tv(){if(Rr===0)if((ft&536870912)===0||_t){var s=_s;_s<<=1,(_s&3932160)===0&&(_s=262144),Rr=s}else Rr=536870912;return s=Tr.current,s!==null&&(s.flags|=32),Rr}function gr(s,a,c){(s===Lt&&(Rt===2||Rt===9)||s.cancelPendingCommit!==null)&&(jl(s,0),ia(s,ft,Rr,!1)),Ya(s,c),((Tt&2)===0||s!==Lt)&&(s===Lt&&((Tt&2)===0&&(So|=c),sn===4&&ia(s,ft,Rr,!1)),Bs(s))}function Av(s,a,c){if((Tt&6)!==0)throw Error(r(327));var m=!c&&(a&127)===0&&(a&s.expiredLanes)===0||Zr(s,a),v=m?lj(s,a):ng(s,a,!0),E=m;do{if(v===0){Cl&&!m&&ia(s,a,0,!1);break}else{if(c=s.current.alternate,E&&!aj(c)){v=ng(s,a,!1),E=!1;continue}if(v===2){if(E=a,s.errorRecoveryDisabledLanes&E)var P=0;else P=s.pendingLanes&-536870913,P=P!==0?P:P&536870912?536870912:0;if(P!==0){a=P;e:{var Q=s;v=du;var se=Q.current.memoizedState.isDehydrated;if(se&&(jl(Q,P).flags|=256),P=ng(Q,P,!1),P!==2){if(Kp&&!se){Q.errorRecoveryDisabledLanes|=E,So|=E,v=4;break e}E=pr,pr=v,E!==null&&(pr===null?pr=E:pr.push.apply(pr,E))}v=P}if(E=!1,v!==2)continue}}if(v===1){jl(s,0),ia(s,a,0,!0);break}e:{switch(m=s,E=v,E){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:ia(m,a,Rr,!ta);break e;case 2:pr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(v=vh+300-Be(),10<v)){if(ia(m,a,Rr,!ta),bs(m,0,!0)!==0)break e;mi=a,m.timeoutHandle=sx(jv.bind(null,m,c,pr,wh,Xp,a,Rr,So,Tl,ta,E,"Throttled",-0,0),v);break e}jv(m,c,pr,wh,Xp,a,Rr,So,Tl,ta,E,null,-0,0)}}break}while(!0);Bs(s)}function jv(s,a,c,m,v,E,P,Q,se,me,Ce,ke,ye,xe){if(s.timeoutHandle=-1,ke=a.subtreeFlags,ke&8192||(ke&16785408)===16785408){ke={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ts},vv(a,E,ke);var Fe=(E&62914560)===E?vh-Be():(E&4194048)===E?Ev-Be():0;if(Fe=qj(ke,Fe),Fe!==null){mi=E,s.cancelPendingCommit=Fe(Pv.bind(null,s,a,E,c,m,v,P,Q,se,Ce,ke,null,ye,xe)),ia(s,E,P,!me);return}}Pv(s,a,E,c,m,v,P,Q,se)}function aj(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var m=0;m<c.length;m++){var v=c[m],E=v.getSnapshot;v=v.value;try{if(!Er(E(),v))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function ia(s,a,c,m){a&=~Yp,a&=~So,s.suspendedLanes|=a,s.pingedLanes&=~a,m&&(s.warmLanes|=a),m=s.expirationTimes;for(var v=a;0<v;){var E=31-Et(v),P=1<<E;m[E]=-1,v&=~P}c!==0&&Xa(s,c,a)}function Sh(){return(Tt&6)===0?(fu(0),!1):!0}function tg(){if(ut!==null){if(Rt===0)var s=ut.return;else s=ut,ri=mo=null,yp(s),_l=null,Kc=0,s=ut;for(;s!==null;)iv(s.alternate,s),s=s.return;ut=null}}function jl(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,Tj(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),mi=0,tg(),Lt=s,ut=c=ti(s.current,null),ft=a,Rt=0,jr=null,ta=!1,Cl=Zr(s,a),Kp=!1,Tl=Rr=Yp=So=na=sn=0,pr=du=null,Xp=!1,(a&8)!==0&&(a|=a&32);var m=s.entangledLanes;if(m!==0)for(s=s.entanglements,m&=a;0<m;){var v=31-Et(m),E=1<<v;a|=s[v],m&=~E}return fi=a,qd(),c}function Rv(s,a){it=null,Y.H=ru,a===yl||a===Zd?(a=H0(),Rt=3):a===ip?(a=H0(),Rt=4):Rt=a===Mp?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,jr=a,ut===null&&(sn=1,hh(s,Ur(a,s.current)))}function Iv(){var s=Tr.current;return s===null?!0:(ft&4194048)===ft?qr===null:(ft&62914560)===ft||(ft&536870912)!==0?s===qr:!1}function kv(){var s=Y.H;return Y.H=ru,s===null?ru:s}function Dv(){var s=Y.A;return Y.A=sj,s}function Eh(){sn=4,ta||(ft&4194048)!==ft&&Tr.current!==null||(Cl=!0),(na&134217727)===0&&(So&134217727)===0||Lt===null||ia(Lt,ft,Rr,!1)}function ng(s,a,c){var m=Tt;Tt|=2;var v=kv(),E=Dv();(Lt!==s||ft!==a)&&(wh=null,jl(s,a)),a=!1;var P=sn;e:do try{if(Rt!==0&&ut!==null){var Q=ut,se=jr;switch(Rt){case 8:tg(),P=6;break e;case 3:case 2:case 9:case 6:Tr.current===null&&(a=!0);var me=Rt;if(Rt=0,jr=null,Rl(s,Q,se,me),c&&Cl){P=0;break e}break;default:me=Rt,Rt=0,jr=null,Rl(s,Q,se,me)}}oj(),P=sn;break}catch(Ce){Rv(s,Ce)}while(!0);return a&&s.shellSuspendCounter++,ri=mo=null,Tt=m,Y.H=v,Y.A=E,ut===null&&(Lt=null,ft=0,qd()),P}function oj(){for(;ut!==null;)Mv(ut)}function lj(s,a){var c=Tt;Tt|=2;var m=kv(),v=Dv();Lt!==s||ft!==a?(wh=null,xh=Be()+500,jl(s,a)):Cl=Zr(s,a);e:do try{if(Rt!==0&&ut!==null){a=ut;var E=jr;t:switch(Rt){case 1:Rt=0,jr=null,Rl(s,a,E,1);break;case 2:case 9:if($0(E)){Rt=0,jr=null,Ov(a);break}a=function(){Rt!==2&&Rt!==9||Lt!==s||(Rt=7),Bs(s)},E.then(a,a);break e;case 3:Rt=7;break e;case 4:Rt=5;break e;case 7:$0(E)?(Rt=0,jr=null,Ov(a)):(Rt=0,jr=null,Rl(s,a,E,7));break;case 5:var P=null;switch(ut.tag){case 26:P=ut.memoizedState;case 5:case 27:var Q=ut;if(P?bx(P):Q.stateNode.complete){Rt=0,jr=null;var se=Q.sibling;if(se!==null)ut=se;else{var me=Q.return;me!==null?(ut=me,Ch(me)):ut=null}break t}}Rt=0,jr=null,Rl(s,a,E,5);break;case 6:Rt=0,jr=null,Rl(s,a,E,6);break;case 8:tg(),sn=6;break e;default:throw Error(r(462))}}cj();break}catch(Ce){Rv(s,Ce)}while(!0);return ri=mo=null,Y.H=m,Y.A=v,Tt=c,ut!==null?0:(Lt=null,ft=0,qd(),sn)}function cj(){for(;ut!==null&&!ie();)Mv(ut)}function Mv(s){var a=rv(s.alternate,s,fi);s.memoizedProps=s.pendingProps,a===null?Ch(s):ut=a}function Ov(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=Xb(c,a,a.pendingProps,a.type,void 0,ft);break;case 11:a=Xb(c,a,a.pendingProps,a.type.render,a.ref,ft);break;case 5:yp(a);default:iv(c,a),a=ut=D0(a,fi),a=rv(c,a,fi)}s.memoizedProps=s.pendingProps,a===null?Ch(s):ut=a}function Rl(s,a,c,m){ri=mo=null,yp(a),_l=null,Kc=0;var v=a.return;try{if(XA(s,v,a,c,ft)){sn=1,hh(s,Ur(c,s.current)),ut=null;return}}catch(E){if(v!==null)throw ut=v,E;sn=1,hh(s,Ur(c,s.current)),ut=null;return}a.flags&32768?(_t||m===1?s=!0:Cl||(ft&536870912)!==0?s=!1:(ta=s=!0,(m===2||m===9||m===3||m===6)&&(m=Tr.current,m!==null&&m.tag===13&&(m.flags|=16384))),Nv(a,s)):Ch(a)}function Ch(s){var a=s;do{if((a.flags&32768)!==0){Nv(a,ta);return}s=a.return;var c=ej(a.alternate,a,fi);if(c!==null){ut=c;return}if(a=a.sibling,a!==null){ut=a;return}ut=a=s}while(a!==null);sn===0&&(sn=5)}function Nv(s,a){do{var c=tj(s.alternate,s);if(c!==null){c.flags&=32767,ut=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){ut=s;return}ut=s=c}while(s!==null);sn=6,ut=null}function Pv(s,a,c,m,v,E,P,Q,se){s.cancelPendingCommit=null;do Th();while(En!==0);if((Tt&6)!==0)throw Error(r(327));if(a!==null){if(a===s.current)throw Error(r(177));if(E=a.lanes|a.childLanes,E|=qm,Nm(s,c,E,P,Q,se),s===Lt&&(ut=Lt=null,ft=0),Al=a,sa=s,mi=c,Zp=E,Jp=v,Cv=m,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,fj(rt,function(){return Fv(),null})):(s.callbackNode=null,s.callbackPriority=0),m=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||m){m=Y.T,Y.T=null,v=G.p,G.p=2,P=Tt,Tt|=4;try{nj(s,a,c)}finally{Tt=P,G.p=v,Y.T=m}}En=1,Bv(),zv(),Lv()}}function Bv(){if(En===1){En=0;var s=sa,a=Al,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=Y.T,Y.T=null;var m=G.p;G.p=2;var v=Tt;Tt|=4;try{yv(a,s);var E=mg,P=S0(s.containerInfo),Q=E.focusedElem,se=E.selectionRange;if(P!==Q&&Q&&Q.ownerDocument&&w0(Q.ownerDocument.documentElement,Q)){if(se!==null&&Lm(Q)){var me=se.start,Ce=se.end;if(Ce===void 0&&(Ce=me),"selectionStart"in Q)Q.selectionStart=me,Q.selectionEnd=Math.min(Ce,Q.value.length);else{var ke=Q.ownerDocument||document,ye=ke&&ke.defaultView||window;if(ye.getSelection){var xe=ye.getSelection(),Fe=Q.textContent.length,Ke=Math.min(se.start,Fe),Ot=se.end===void 0?Ke:Math.min(se.end,Fe);!xe.extend&&Ke>Ot&&(P=Ot,Ot=Ke,Ke=P);var ue=x0(Q,Ke),le=x0(Q,Ot);if(ue&&le&&(xe.rangeCount!==1||xe.anchorNode!==ue.node||xe.anchorOffset!==ue.offset||xe.focusNode!==le.node||xe.focusOffset!==le.offset)){var fe=ke.createRange();fe.setStart(ue.node,ue.offset),xe.removeAllRanges(),Ke>Ot?(xe.addRange(fe),xe.extend(le.node,le.offset)):(fe.setEnd(le.node,le.offset),xe.addRange(fe))}}}}for(ke=[],xe=Q;xe=xe.parentNode;)xe.nodeType===1&&ke.push({element:xe,left:xe.scrollLeft,top:xe.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<ke.length;Q++){var je=ke[Q];je.element.scrollLeft=je.left,je.element.scrollTop=je.top}}zh=!!fg,mg=fg=null}finally{Tt=v,G.p=m,Y.T=c}}s.current=a,En=2}}function zv(){if(En===2){En=0;var s=sa,a=Al,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=Y.T,Y.T=null;var m=G.p;G.p=2;var v=Tt;Tt|=4;try{hv(s,a.alternate,a)}finally{Tt=v,G.p=m,Y.T=c}}En=3}}function Lv(){if(En===4||En===3){En=0,Re();var s=sa,a=Al,c=mi,m=Cv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?En=5:(En=0,Al=sa=null,Uv(s,s.pendingLanes));var v=s.pendingLanes;if(v===0&&(ra=null),Xs(c),a=a.stateNode,nn&&typeof nn.onCommitFiberRoot=="function")try{nn.onCommitFiberRoot(vt,a,void 0,(a.current.flags&128)===128)}catch{}if(m!==null){a=Y.T,v=G.p,G.p=2,Y.T=null;try{for(var E=s.onRecoverableError,P=0;P<m.length;P++){var Q=m[P];E(Q.value,{componentStack:Q.stack})}}finally{Y.T=a,G.p=v}}(mi&3)!==0&&Th(),Bs(s),v=s.pendingLanes,(c&261930)!==0&&(v&42)!==0?s===eg?hu++:(hu=0,eg=s):hu=0,fu(0)}}function Uv(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Wc(a)))}function Th(){return Bv(),zv(),Lv(),Fv()}function Fv(){if(En!==5)return!1;var s=sa,a=Zp;Zp=0;var c=Xs(mi),m=Y.T,v=G.p;try{G.p=32>c?32:c,Y.T=null,c=Jp,Jp=null;var E=sa,P=mi;if(En=0,Al=sa=null,mi=0,(Tt&6)!==0)throw Error(r(331));var Q=Tt;if(Tt|=4,wv(E.current),bv(E,E.current,P,c),Tt=Q,fu(0,!1),nn&&typeof nn.onPostCommitFiberRoot=="function")try{nn.onPostCommitFiberRoot(vt,E)}catch{}return!0}finally{G.p=v,Y.T=m,Uv(s,a)}}function Vv(s,a,c){a=Ur(c,a),a=Dp(s.stateNode,a,2),s=Xi(s,a,2),s!==null&&(Ya(s,2),Bs(s))}function It(s,a,c){if(s.tag===3)Vv(s,s,c);else for(;a!==null;){if(a.tag===3){Vv(a,s,c);break}else if(a.tag===1){var m=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(ra===null||!ra.has(m))){s=Ur(c,s),c=$b(2),m=Xi(a,c,2),m!==null&&(qb(c,m,a,s),Ya(m,2),Bs(m));break}}a=a.return}}function rg(s,a,c){var m=s.pingCache;if(m===null){m=s.pingCache=new ij;var v=new Set;m.set(a,v)}else v=m.get(a),v===void 0&&(v=new Set,m.set(a,v));v.has(c)||(Kp=!0,v.add(c),s=uj.bind(null,s,a,c),a.then(s,s))}function uj(s,a,c){var m=s.pingCache;m!==null&&m.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,Lt===s&&(ft&c)===c&&(sn===4||sn===3&&(ft&62914560)===ft&&300>Be()-vh?(Tt&2)===0&&jl(s,0):Yp|=c,Tl===ft&&(Tl=0)),Bs(s)}function $v(s,a){a===0&&(a=wd()),s=uo(s,a),s!==null&&(Ya(s,a),Bs(s))}function dj(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),$v(s,c)}function hj(s,a){var c=0;switch(s.tag){case 31:case 13:var m=s.stateNode,v=s.memoizedState;v!==null&&(c=v.retryLane);break;case 19:m=s.stateNode;break;case 22:m=s.stateNode._retryCache;break;default:throw Error(r(314))}m!==null&&m.delete(a),$v(s,c)}function fj(s,a){return Se(s,a)}var Ah=null,Il=null,sg=!1,jh=!1,ig=!1,aa=0;function Bs(s){s!==Il&&s.next===null&&(Il===null?Ah=Il=s:Il=Il.next=s),jh=!0,sg||(sg=!0,pj())}function fu(s,a){if(!ig&&jh){ig=!0;do for(var c=!1,m=Ah;m!==null;){if(s!==0){var v=m.pendingLanes;if(v===0)var E=0;else{var P=m.suspendedLanes,Q=m.pingedLanes;E=(1<<31-Et(42|s)+1)-1,E&=v&~(P&~Q),E=E&201326741?E&201326741|1:E?E|2:0}E!==0&&(c=!0,Wv(m,E))}else E=ft,E=bs(m,m===Lt?E:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(E&3)===0||Zr(m,E)||(c=!0,Wv(m,E));m=m.next}while(c);ig=!1}}function mj(){qv()}function qv(){jh=sg=!1;var s=0;aa!==0&&Cj()&&(s=aa);for(var a=Be(),c=null,m=Ah;m!==null;){var v=m.next,E=Hv(m,a);E===0?(m.next=null,c===null?Ah=v:c.next=v,v===null&&(Il=c)):(c=m,(s!==0||(E&3)!==0)&&(jh=!0)),m=v}En!==0&&En!==5||fu(s),aa!==0&&(aa=0)}function Hv(s,a){for(var c=s.suspendedLanes,m=s.pingedLanes,v=s.expirationTimes,E=s.pendingLanes&-62914561;0<E;){var P=31-Et(E),Q=1<<P,se=v[P];se===-1?((Q&c)===0||(Q&m)!==0)&&(v[P]=Om(Q,a)):se<=a&&(s.expiredLanes|=Q),E&=~Q}if(a=Lt,c=ft,c=bs(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m=s.callbackNode,c===0||s===a&&(Rt===2||Rt===9)||s.cancelPendingCommit!==null)return m!==null&&m!==null&&we(m),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Zr(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(m!==null&&we(m),Xs(c)){case 2:case 8:c=xt;break;case 32:c=rt;break;case 268435456:c=gs;break;default:c=rt}return m=Gv.bind(null,s),c=Se(c,m),s.callbackPriority=a,s.callbackNode=c,a}return m!==null&&m!==null&&we(m),s.callbackPriority=2,s.callbackNode=null,2}function Gv(s,a){if(En!==0&&En!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(Th()&&s.callbackNode!==c)return null;var m=ft;return m=bs(s,s===Lt?m:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),m===0?null:(Av(s,m,a),Hv(s,Be()),s.callbackNode!=null&&s.callbackNode===c?Gv.bind(null,s):null)}function Wv(s,a){if(Th())return null;Av(s,a,!0)}function pj(){Aj(function(){(Tt&6)!==0?Se(He,mj):qv()})}function ag(){if(aa===0){var s=pl;s===0&&(s=Or,Or<<=1,(Or&261888)===0&&(Or=256)),aa=s}return aa}function Qv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:el(""+s)}function Kv(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function gj(s,a,c,m,v){if(a==="submit"&&c&&c.stateNode===v){var E=Qv((v[kn]||null).action),P=m.submitter;P&&(a=(a=P[kn]||null)?Qv(a.formAction):P.getAttribute("formAction"),a!==null&&(E=a,P=null));var Q=new Is("action","action",null,m,v);s.push({event:Q,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(aa!==0){var se=P?Kv(v,P):new FormData(v);Tp(c,{pending:!0,data:se,method:v.method,action:E},null,se)}}else typeof E=="function"&&(Q.preventDefault(),se=P?Kv(v,P):new FormData(v),Tp(c,{pending:!0,data:se,method:v.method,action:E},E,se))},currentTarget:v}]})}}for(var og=0;og<$m.length;og++){var lg=$m[og],yj=lg.toLowerCase(),_j=lg[0].toUpperCase()+lg.slice(1);as(yj,"on"+_j)}as(T0,"onAnimationEnd"),as(A0,"onAnimationIteration"),as(j0,"onAnimationStart"),as("dblclick","onDoubleClick"),as("focusin","onFocus"),as("focusout","onBlur"),as(OA,"onTransitionRun"),as(NA,"onTransitionStart"),as(PA,"onTransitionCancel"),as(R0,"onTransitionEnd"),Ts("onMouseEnter",["mouseout","mouseover"]),Ts("onMouseLeave",["mouseout","mouseover"]),Ts("onPointerEnter",["pointerout","pointerover"]),Ts("onPointerLeave",["pointerout","pointerover"]),Cs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Cs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Cs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Cs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Cs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Cs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bj=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(mu));function Yv(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var m=s[c],v=m.event;m=m.listeners;e:{var E=void 0;if(a)for(var P=m.length-1;0<=P;P--){var Q=m[P],se=Q.instance,me=Q.currentTarget;if(Q=Q.listener,se!==E&&v.isPropagationStopped())break e;E=Q,v.currentTarget=me;try{E(v)}catch(Ce){$d(Ce)}v.currentTarget=null,E=se}else for(P=0;P<m.length;P++){if(Q=m[P],se=Q.instance,me=Q.currentTarget,Q=Q.listener,se!==E&&v.isPropagationStopped())break e;E=Q,v.currentTarget=me;try{E(v)}catch(Ce){$d(Ce)}v.currentTarget=null,E=se}}}}function dt(s,a){var c=a[Ko];c===void 0&&(c=a[Ko]=new Set);var m=s+"__bubble";c.has(m)||(Xv(a,s,2,!1),c.add(m))}function cg(s,a,c){var m=0;a&&(m|=4),Xv(c,s,m,a)}var Rh="_reactListening"+Math.random().toString(36).slice(2);function ug(s){if(!s[Rh]){s[Rh]=!0,Tc.forEach(function(c){c!=="selectionchange"&&(bj.has(c)||cg(c,!1,s),cg(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[Rh]||(a[Rh]=!0,cg("selectionchange",!1,a))}}function Xv(s,a,c,m){switch(Tx(a)){case 2:var v=Wj;break;case 8:v=Qj;break;default:v=Cg}c=v.bind(null,a,c,s),v=void 0,!no||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(v=!0),m?v!==void 0?s.addEventListener(a,c,{capture:!0,passive:v}):s.addEventListener(a,c,!0):v!==void 0?s.addEventListener(a,c,{passive:v}):s.addEventListener(a,c,!1)}function dg(s,a,c,m,v){var E=m;if((a&1)===0&&(a&2)===0&&m!==null)e:for(;;){if(m===null)return;var P=m.tag;if(P===3||P===4){var Q=m.stateNode.containerInfo;if(Q===v)break;if(P===4)for(P=m.return;P!==null;){var se=P.tag;if((se===3||se===4)&&P.stateNode.containerInfo===v)return;P=P.return}for(;Q!==null;){if(P=Ss(Q),P===null)return;if(se=P.tag,se===5||se===6||se===26||se===27){m=E=P;continue e}Q=Q.parentNode}}m=m.return}Fi(function(){var me=E,Ce=Pr(c),ke=[];e:{var ye=I0.get(s);if(ye!==void 0){var xe=Is,Fe=s;switch(s){case"keypress":if(so(c)===0)break e;case"keydown":case"keyup":xe=Ud;break;case"focusin":Fe="focus",xe=ao;break;case"focusout":Fe="blur",xe=ao;break;case"beforeblur":case"afterblur":xe=ao;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":xe=Lc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":xe=kd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":xe=j;break;case T0:case A0:case j0:xe=Md;break;case R0:xe=K;break;case"scroll":case"scrollend":xe=zc;break;case"wheel":xe=ve;break;case"copy":case"cut":case"paste":xe=Od;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":xe=ei;break;case"toggle":case"beforetoggle":xe=st}var Ke=(a&4)!==0,Ot=!Ke&&(s==="scroll"||s==="scrollend"),ue=Ke?ye!==null?ye+"Capture":null:ye;Ke=[];for(var le=me,fe;le!==null;){var je=le;if(fe=je.stateNode,je=je.tag,je!==5&&je!==26&&je!==27||fe===null||ue===null||(je=ns(le,ue),je!=null&&Ke.push(pu(le,je,fe))),Ot)break;le=le.return}0<Ke.length&&(ye=new xe(ye,Fe,null,c,Ce),ke.push({event:ye,listeners:Ke}))}}if((a&7)===0){e:{if(ye=s==="mouseover"||s==="pointerover",xe=s==="mouseout"||s==="pointerout",ye&&c!==Nc&&(Fe=c.relatedTarget||c.fromElement)&&(Ss(Fe)||Fe[xs]))break e;if((xe||ye)&&(ye=Ce.window===Ce?Ce:(ye=Ce.ownerDocument)?ye.defaultView||ye.parentWindow:window,xe?(Fe=c.relatedTarget||c.toElement,xe=me,Fe=Fe?Ss(Fe):null,Fe!==null&&(Ot=o(Fe),Ke=Fe.tag,Fe!==Ot||Ke!==5&&Ke!==27&&Ke!==6)&&(Fe=null)):(xe=null,Fe=me),xe!==Fe)){if(Ke=Lc,je="onMouseLeave",ue="onMouseEnter",le="mouse",(s==="pointerout"||s==="pointerover")&&(Ke=ei,je="onPointerLeave",ue="onPointerEnter",le="pointer"),Ot=xe==null?ye:wr(xe),fe=Fe==null?ye:wr(Fe),ye=new Ke(je,le+"leave",xe,c,Ce),ye.target=Ot,ye.relatedTarget=fe,je=null,Ss(Ce)===me&&(Ke=new Ke(ue,le+"enter",Fe,c,Ce),Ke.target=fe,Ke.relatedTarget=Ot,je=Ke),Ot=je,xe&&Fe)t:{for(Ke=vj,ue=xe,le=Fe,fe=0,je=ue;je;je=Ke(je))fe++;je=0;for(var We=le;We;We=Ke(We))je++;for(;0<fe-je;)ue=Ke(ue),fe--;for(;0<je-fe;)le=Ke(le),je--;for(;fe--;){if(ue===le||le!==null&&ue===le.alternate){Ke=ue;break t}ue=Ke(ue),le=Ke(le)}Ke=null}else Ke=null;xe!==null&&Zv(ke,ye,xe,Ke,!1),Fe!==null&&Ot!==null&&Zv(ke,Ot,Fe,Ke,!0)}}e:{if(ye=me?wr(me):window,xe=ye.nodeName&&ye.nodeName.toLowerCase(),xe==="select"||xe==="input"&&ye.type==="file")var wt=p0;else if(f0(ye))if(g0)wt=kA;else{wt=RA;var Ve=jA}else xe=ye.nodeName,!xe||xe.toLowerCase()!=="input"||ye.type!=="checkbox"&&ye.type!=="radio"?me&&Jo(me.elementType)&&(wt=p0):wt=IA;if(wt&&(wt=wt(s,me))){m0(ke,wt,c,Ce);break e}Ve&&Ve(s,ye,me),s==="focusout"&&me&&ye.type==="number"&&me.memoizedProps.value!=null&&Dc(ye,"number",ye.value)}switch(Ve=me?wr(me):window,s){case"focusin":(f0(Ve)||Ve.contentEditable==="true")&&(ol=Ve,Um=me,qc=null);break;case"focusout":qc=Um=ol=null;break;case"mousedown":Fm=!0;break;case"contextmenu":case"mouseup":case"dragend":Fm=!1,E0(ke,c,Ce);break;case"selectionchange":if(MA)break;case"keydown":case"keyup":E0(ke,c,Ce)}var ot;if(Ct)e:{switch(s){case"compositionstart":var mt="onCompositionStart";break e;case"compositionend":mt="onCompositionEnd";break e;case"compositionupdate":mt="onCompositionUpdate";break e}mt=void 0}else al?oo(s,c)&&(mt="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(mt="onCompositionStart");mt&&(Ms&&c.locale!=="ko"&&(al||mt!=="onCompositionStart"?mt==="onCompositionEnd"&&al&&(ot=Bc()):(Rs=Ce,Pc="value"in Rs?Rs.value:Rs.textContent,al=!0)),Ve=Ih(me,mt),0<Ve.length&&(mt=new Ds(mt,s,null,c,Ce),ke.push({event:mt,listeners:Ve}),ot?mt.data=ot:(ot=il(c),ot!==null&&(mt.data=ot)))),(ot=zr?EA(s,c):CA(s,c))&&(mt=Ih(me,"onBeforeInput"),0<mt.length&&(Ve=new Ds("onBeforeInput","beforeinput",null,c,Ce),ke.push({event:Ve,listeners:mt}),Ve.data=ot)),gj(ke,s,me,c,Ce)}Yv(ke,a)})}function pu(s,a,c){return{instance:s,listener:a,currentTarget:c}}function Ih(s,a){for(var c=a+"Capture",m=[];s!==null;){var v=s,E=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||E===null||(v=ns(s,c),v!=null&&m.unshift(pu(s,v,E)),v=ns(s,a),v!=null&&m.push(pu(s,v,E))),s.tag===3)return m;s=s.return}return[]}function vj(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Zv(s,a,c,m,v){for(var E=a._reactName,P=[];c!==null&&c!==m;){var Q=c,se=Q.alternate,me=Q.stateNode;if(Q=Q.tag,se!==null&&se===m)break;Q!==5&&Q!==26&&Q!==27||me===null||(se=me,v?(me=ns(c,E),me!=null&&P.unshift(pu(c,me,se))):v||(me=ns(c,E),me!=null&&P.push(pu(c,me,se)))),c=c.return}P.length!==0&&s.push({event:a,listeners:P})}var xj=/\r\n?/g,wj=/\u0000|\uFFFD/g;function Jv(s){return(typeof s=="string"?s:""+s).replace(xj,`
`).replace(wj,"")}function ex(s,a){return a=Jv(a),Jv(s)===a}function Mt(s,a,c,m,v,E){switch(c){case"children":typeof m=="string"?a==="body"||a==="textarea"&&m===""||dr(s,m):(typeof m=="number"||typeof m=="bigint")&&a!=="body"&&dr(s,""+m);break;case"className":Sr(s,"class",m);break;case"tabIndex":Sr(s,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":Sr(s,c,m);break;case"style":Oc(s,m,E);break;case"data":if(a!=="object"){Sr(s,"data",m);break}case"src":case"href":if(m===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(c);break}m=el(""+m),s.setAttribute(c,m);break;case"action":case"formAction":if(typeof m=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(c==="formAction"?(a!=="input"&&Mt(s,a,"name",v.name,v,null),Mt(s,a,"formEncType",v.formEncType,v,null),Mt(s,a,"formMethod",v.formMethod,v,null),Mt(s,a,"formTarget",v.formTarget,v,null)):(Mt(s,a,"encType",v.encType,v,null),Mt(s,a,"method",v.method,v,null),Mt(s,a,"target",v.target,v,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){s.removeAttribute(c);break}m=el(""+m),s.setAttribute(c,m);break;case"onClick":m!=null&&(s.onclick=ts);break;case"onScroll":m!=null&&dt("scroll",s);break;case"onScrollEnd":m!=null&&dt("scrollend",s);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(c=m.__html,c!=null){if(v.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"multiple":s.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":s.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){s.removeAttribute("xlink:href");break}c=el(""+m),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,""+m):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":m===!0?s.setAttribute(c,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?s.setAttribute(c,m):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?s.setAttribute(c,m):s.removeAttribute(c);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?s.removeAttribute(c):s.setAttribute(c,m);break;case"popover":dt("beforetoggle",s),dt("toggle",s),Xo(s,"popover",m);break;case"xlinkActuate":mn(s,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":mn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":mn(s,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":mn(s,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":mn(s,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":mn(s,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":mn(s,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":mn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":mn(s,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":Xo(s,"is",m);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Id.get(c)||c,Xo(s,c,m))}}function hg(s,a,c,m,v,E){switch(c){case"style":Oc(s,m,E);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(c=m.__html,c!=null){if(v.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"children":typeof m=="string"?dr(s,m):(typeof m=="number"||typeof m=="bigint")&&dr(s,""+m);break;case"onScroll":m!=null&&dt("scroll",s);break;case"onScrollEnd":m!=null&&dt("scrollend",s);break;case"onClick":m!=null&&(s.onclick=ts);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ac.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(v=c.endsWith("Capture"),a=c.slice(2,v?c.length-7:void 0),E=s[kn]||null,E=E!=null?E[c]:null,typeof E=="function"&&s.removeEventListener(a,E,v),typeof m=="function")){typeof E!="function"&&E!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,m,v);break e}c in s?s[c]=m:m===!0?s.setAttribute(c,""):Xo(s,c,m)}}}function Ln(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":dt("error",s),dt("load",s);var m=!1,v=!1,E;for(E in c)if(c.hasOwnProperty(E)){var P=c[E];if(P!=null)switch(E){case"src":m=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Mt(s,a,E,P,c,null)}}v&&Mt(s,a,"srcSet",c.srcSet,c,null),m&&Mt(s,a,"src",c.src,c,null);return;case"input":dt("invalid",s);var Q=E=P=v=null,se=null,me=null;for(m in c)if(c.hasOwnProperty(m)){var Ce=c[m];if(Ce!=null)switch(m){case"name":v=Ce;break;case"type":P=Ce;break;case"checked":se=Ce;break;case"defaultChecked":me=Ce;break;case"value":E=Ce;break;case"defaultValue":Q=Ce;break;case"children":case"dangerouslySetInnerHTML":if(Ce!=null)throw Error(r(137,a));break;default:Mt(s,a,m,Ce,c,null)}}Ad(s,E,Q,se,me,P,v,!1);return;case"select":dt("invalid",s),m=P=E=null;for(v in c)if(c.hasOwnProperty(v)&&(Q=c[v],Q!=null))switch(v){case"value":E=Q;break;case"defaultValue":P=Q;break;case"multiple":m=Q;default:Mt(s,a,v,Q,c,null)}a=E,c=P,s.multiple=!!m,a!=null?Bi(s,!!m,a,!1):c!=null&&Bi(s,!!m,c,!0);return;case"textarea":dt("invalid",s),E=v=m=null;for(P in c)if(c.hasOwnProperty(P)&&(Q=c[P],Q!=null))switch(P){case"value":m=Q;break;case"defaultValue":v=Q;break;case"children":E=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(r(91));break;default:Mt(s,a,P,Q,c,null)}zi(s,m,v,E);return;case"option":for(se in c)c.hasOwnProperty(se)&&(m=c[se],m!=null)&&(se==="selected"?s.selected=m&&typeof m!="function"&&typeof m!="symbol":Mt(s,a,se,m,c,null));return;case"dialog":dt("beforetoggle",s),dt("toggle",s),dt("cancel",s),dt("close",s);break;case"iframe":case"object":dt("load",s);break;case"video":case"audio":for(m=0;m<mu.length;m++)dt(mu[m],s);break;case"image":dt("error",s),dt("load",s);break;case"details":dt("toggle",s);break;case"embed":case"source":case"link":dt("error",s),dt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(me in c)if(c.hasOwnProperty(me)&&(m=c[me],m!=null))switch(me){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Mt(s,a,me,m,c,null)}return;default:if(Jo(a)){for(Ce in c)c.hasOwnProperty(Ce)&&(m=c[Ce],m!==void 0&&hg(s,a,Ce,m,c,void 0));return}}for(Q in c)c.hasOwnProperty(Q)&&(m=c[Q],m!=null&&Mt(s,a,Q,m,c,null))}function Sj(s,a,c,m){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,E=null,P=null,Q=null,se=null,me=null,Ce=null;for(xe in c){var ke=c[xe];if(c.hasOwnProperty(xe)&&ke!=null)switch(xe){case"checked":break;case"value":break;case"defaultValue":se=ke;default:m.hasOwnProperty(xe)||Mt(s,a,xe,null,m,ke)}}for(var ye in m){var xe=m[ye];if(ke=c[ye],m.hasOwnProperty(ye)&&(xe!=null||ke!=null))switch(ye){case"type":E=xe;break;case"name":v=xe;break;case"checked":me=xe;break;case"defaultChecked":Ce=xe;break;case"value":P=xe;break;case"defaultValue":Q=xe;break;case"children":case"dangerouslySetInnerHTML":if(xe!=null)throw Error(r(137,a));break;default:xe!==ke&&Mt(s,a,ye,xe,m,ke)}}Zo(s,P,Q,se,me,Ce,E,v);return;case"select":xe=P=Q=ye=null;for(E in c)if(se=c[E],c.hasOwnProperty(E)&&se!=null)switch(E){case"value":break;case"multiple":xe=se;default:m.hasOwnProperty(E)||Mt(s,a,E,null,m,se)}for(v in m)if(E=m[v],se=c[v],m.hasOwnProperty(v)&&(E!=null||se!=null))switch(v){case"value":ye=E;break;case"defaultValue":Q=E;break;case"multiple":P=E;default:E!==se&&Mt(s,a,v,E,m,se)}a=Q,c=P,m=xe,ye!=null?Bi(s,!!c,ye,!1):!!m!=!!c&&(a!=null?Bi(s,!!c,a,!0):Bi(s,!!c,c?[]:"",!1));return;case"textarea":xe=ye=null;for(Q in c)if(v=c[Q],c.hasOwnProperty(Q)&&v!=null&&!m.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:Mt(s,a,Q,null,m,v)}for(P in m)if(v=m[P],E=c[P],m.hasOwnProperty(P)&&(v!=null||E!=null))switch(P){case"value":ye=v;break;case"defaultValue":xe=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==E&&Mt(s,a,P,v,m,E)}jd(s,ye,xe);return;case"option":for(var Fe in c)ye=c[Fe],c.hasOwnProperty(Fe)&&ye!=null&&!m.hasOwnProperty(Fe)&&(Fe==="selected"?s.selected=!1:Mt(s,a,Fe,null,m,ye));for(se in m)ye=m[se],xe=c[se],m.hasOwnProperty(se)&&ye!==xe&&(ye!=null||xe!=null)&&(se==="selected"?s.selected=ye&&typeof ye!="function"&&typeof ye!="symbol":Mt(s,a,se,ye,m,xe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ke in c)ye=c[Ke],c.hasOwnProperty(Ke)&&ye!=null&&!m.hasOwnProperty(Ke)&&Mt(s,a,Ke,null,m,ye);for(me in m)if(ye=m[me],xe=c[me],m.hasOwnProperty(me)&&ye!==xe&&(ye!=null||xe!=null))switch(me){case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(r(137,a));break;default:Mt(s,a,me,ye,m,xe)}return;default:if(Jo(a)){for(var Ot in c)ye=c[Ot],c.hasOwnProperty(Ot)&&ye!==void 0&&!m.hasOwnProperty(Ot)&&hg(s,a,Ot,void 0,m,ye);for(Ce in m)ye=m[Ce],xe=c[Ce],!m.hasOwnProperty(Ce)||ye===xe||ye===void 0&&xe===void 0||hg(s,a,Ce,ye,m,xe);return}}for(var ue in c)ye=c[ue],c.hasOwnProperty(ue)&&ye!=null&&!m.hasOwnProperty(ue)&&Mt(s,a,ue,null,m,ye);for(ke in m)ye=m[ke],xe=c[ke],!m.hasOwnProperty(ke)||ye===xe||ye==null&&xe==null||Mt(s,a,ke,ye,m,xe)}function tx(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Ej(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),m=0;m<c.length;m++){var v=c[m],E=v.transferSize,P=v.initiatorType,Q=v.duration;if(E&&Q&&tx(P)){for(P=0,Q=v.responseEnd,m+=1;m<c.length;m++){var se=c[m],me=se.startTime;if(me>Q)break;var Ce=se.transferSize,ke=se.initiatorType;Ce&&tx(ke)&&(se=se.responseEnd,P+=Ce*(se<Q?1:(Q-me)/(se-me)))}if(--m,a+=8*(E+P)/(v.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var fg=null,mg=null;function kh(s){return s.nodeType===9?s:s.ownerDocument}function nx(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function rx(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function pg(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var gg=null;function Cj(){var s=window.event;return s&&s.type==="popstate"?s===gg?!1:(gg=s,!0):(gg=null,!1)}var sx=typeof setTimeout=="function"?setTimeout:void 0,Tj=typeof clearTimeout=="function"?clearTimeout:void 0,ix=typeof Promise=="function"?Promise:void 0,Aj=typeof queueMicrotask=="function"?queueMicrotask:typeof ix<"u"?function(s){return ix.resolve(null).then(s).catch(jj)}:sx;function jj(s){setTimeout(function(){throw s})}function oa(s){return s==="head"}function ax(s,a){var c=a,m=0;do{var v=c.nextSibling;if(s.removeChild(c),v&&v.nodeType===8)if(c=v.data,c==="/$"||c==="/&"){if(m===0){s.removeChild(v),Ol(a);return}m--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")m++;else if(c==="html")gu(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,gu(c);for(var E=c.firstChild;E;){var P=E.nextSibling,Q=E.nodeName;E[ws]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&E.rel.toLowerCase()==="stylesheet"||c.removeChild(E),E=P}}else c==="body"&&gu(s.ownerDocument.body);c=v}while(c);Ol(a)}function ox(s,a){var c=s;s=0;do{var m=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=m}while(c)}function yg(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":yg(c),Yo(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function Rj(s,a,c,m){for(;s.nodeType===1;){var v=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!m&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(m){if(!s[ws])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(E=s.getAttribute("rel"),E==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(E!==v.rel||s.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||s.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||s.getAttribute("title")!==(v.title==null?null:v.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(E=s.getAttribute("src"),(E!==(v.src==null?null:v.src)||s.getAttribute("type")!==(v.type==null?null:v.type)||s.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&E&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var E=v.name==null?null:""+v.name;if(v.type==="hidden"&&s.getAttribute("name")===E)return s}else return s;if(s=Hr(s.nextSibling),s===null)break}return null}function Ij(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=Hr(s.nextSibling),s===null))return null;return s}function lx(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=Hr(s.nextSibling),s===null))return null;return s}function _g(s){return s.data==="$?"||s.data==="$~"}function bg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function kj(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var m=function(){a(),c.removeEventListener("DOMContentLoaded",m)};c.addEventListener("DOMContentLoaded",m),s._reactRetry=m}}function Hr(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var vg=null;function cx(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return Hr(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function ux(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function dx(s,a,c){switch(a=kh(c),s){case"html":if(s=a.documentElement,!s)throw Error(r(452));return s;case"head":if(s=a.head,!s)throw Error(r(453));return s;case"body":if(s=a.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function gu(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);Yo(s)}var Gr=new Map,hx=new Set;function Dh(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var pi=G.d;G.d={f:Dj,r:Mj,D:Oj,C:Nj,L:Pj,m:Bj,X:Lj,S:zj,M:Uj};function Dj(){var s=pi.f(),a=Sh();return s||a}function Mj(s){var a=Nr(s);a!==null&&a.tag===5&&a.type==="form"?Rb(a):pi.r(s)}var kl=typeof document>"u"?null:document;function fx(s,a,c){var m=kl;if(m&&typeof a=="string"&&a){var v=ur(a);v='link[rel="'+s+'"][href="'+v+'"]',typeof c=="string"&&(v+='[crossorigin="'+c+'"]'),hx.has(v)||(hx.add(v),s={rel:s,crossOrigin:c,href:a},m.querySelector(v)===null&&(a=m.createElement("link"),Ln(a,"link",s),fn(a),m.head.appendChild(a)))}}function Oj(s){pi.D(s),fx("dns-prefetch",s,null)}function Nj(s,a){pi.C(s,a),fx("preconnect",s,a)}function Pj(s,a,c){pi.L(s,a,c);var m=kl;if(m&&s&&a){var v='link[rel="preload"][as="'+ur(a)+'"]';a==="image"&&c&&c.imageSrcSet?(v+='[imagesrcset="'+ur(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(v+='[imagesizes="'+ur(c.imageSizes)+'"]')):v+='[href="'+ur(s)+'"]';var E=v;switch(a){case"style":E=Dl(s);break;case"script":E=Ml(s)}Gr.has(E)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),Gr.set(E,s),m.querySelector(v)!==null||a==="style"&&m.querySelector(yu(E))||a==="script"&&m.querySelector(_u(E))||(a=m.createElement("link"),Ln(a,"link",s),fn(a),m.head.appendChild(a)))}}function Bj(s,a){pi.m(s,a);var c=kl;if(c&&s){var m=a&&typeof a.as=="string"?a.as:"script",v='link[rel="modulepreload"][as="'+ur(m)+'"][href="'+ur(s)+'"]',E=v;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=Ml(s)}if(!Gr.has(E)&&(s=g({rel:"modulepreload",href:s},a),Gr.set(E,s),c.querySelector(v)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(_u(E)))return}m=c.createElement("link"),Ln(m,"link",s),fn(m),c.head.appendChild(m)}}}function zj(s,a,c){pi.S(s,a,c);var m=kl;if(m&&s){var v=Es(m).hoistableStyles,E=Dl(s);a=a||"default";var P=v.get(E);if(!P){var Q={loading:0,preload:null};if(P=m.querySelector(yu(E)))Q.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=Gr.get(E))&&xg(s,c);var se=P=m.createElement("link");fn(se),Ln(se,"link",s),se._p=new Promise(function(me,Ce){se.onload=me,se.onerror=Ce}),se.addEventListener("load",function(){Q.loading|=1}),se.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,Mh(P,a,m)}P={type:"stylesheet",instance:P,count:1,state:Q},v.set(E,P)}}}function Lj(s,a){pi.X(s,a);var c=kl;if(c&&s){var m=Es(c).hoistableScripts,v=Ml(s),E=m.get(v);E||(E=c.querySelector(_u(v)),E||(s=g({src:s,async:!0},a),(a=Gr.get(v))&&wg(s,a),E=c.createElement("script"),fn(E),Ln(E,"link",s),c.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},m.set(v,E))}}function Uj(s,a){pi.M(s,a);var c=kl;if(c&&s){var m=Es(c).hoistableScripts,v=Ml(s),E=m.get(v);E||(E=c.querySelector(_u(v)),E||(s=g({src:s,async:!0,type:"module"},a),(a=Gr.get(v))&&wg(s,a),E=c.createElement("script"),fn(E),Ln(E,"link",s),c.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},m.set(v,E))}}function mx(s,a,c,m){var v=(v=_e.current)?Dh(v):null;if(!v)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=Dl(c.href),c=Es(v).hoistableStyles,m=c.get(a),m||(m={type:"style",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=Dl(c.href);var E=Es(v).hoistableStyles,P=E.get(s);if(P||(v=v.ownerDocument||v,P={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(s,P),(E=v.querySelector(yu(s)))&&!E._p&&(P.instance=E,P.state.loading=5),Gr.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Gr.set(s,c),E||Fj(v,s,c,P.state))),a&&m===null)throw Error(r(528,""));return P}if(a&&m!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Ml(c),c=Es(v).hoistableScripts,m=c.get(a),m||(m={type:"script",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function Dl(s){return'href="'+ur(s)+'"'}function yu(s){return'link[rel="stylesheet"]['+s+"]"}function px(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function Fj(s,a,c,m){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?m.loading=1:(a=s.createElement("link"),m.preload=a,a.addEventListener("load",function(){return m.loading|=1}),a.addEventListener("error",function(){return m.loading|=2}),Ln(a,"link",c),fn(a),s.head.appendChild(a))}function Ml(s){return'[src="'+ur(s)+'"]'}function _u(s){return"script[async]"+s}function gx(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var m=s.querySelector('style[data-href~="'+ur(c.href)+'"]');if(m)return a.instance=m,fn(m),m;var v=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return m=(s.ownerDocument||s).createElement("style"),fn(m),Ln(m,"style",v),Mh(m,c.precedence,s),a.instance=m;case"stylesheet":v=Dl(c.href);var E=s.querySelector(yu(v));if(E)return a.state.loading|=4,a.instance=E,fn(E),E;m=px(c),(v=Gr.get(v))&&xg(m,v),E=(s.ownerDocument||s).createElement("link"),fn(E);var P=E;return P._p=new Promise(function(Q,se){P.onload=Q,P.onerror=se}),Ln(E,"link",m),a.state.loading|=4,Mh(E,c.precedence,s),a.instance=E;case"script":return E=Ml(c.src),(v=s.querySelector(_u(E)))?(a.instance=v,fn(v),v):(m=c,(v=Gr.get(E))&&(m=g({},c),wg(m,v)),s=s.ownerDocument||s,v=s.createElement("script"),fn(v),Ln(v,"link",m),s.head.appendChild(v),a.instance=v);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(m=a.instance,a.state.loading|=4,Mh(m,c.precedence,s));return a.instance}function Mh(s,a,c){for(var m=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=m.length?m[m.length-1]:null,E=v,P=0;P<m.length;P++){var Q=m[P];if(Q.dataset.precedence===a)E=Q;else if(E!==v)break}E?E.parentNode.insertBefore(s,E.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function xg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function wg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var Oh=null;function yx(s,a,c){if(Oh===null){var m=new Map,v=Oh=new Map;v.set(c,m)}else v=Oh,m=v.get(c),m||(m=new Map,v.set(c,m));if(m.has(s))return m;for(m.set(s,null),c=c.getElementsByTagName(s),v=0;v<c.length;v++){var E=c[v];if(!(E[ws]||E[hn]||s==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var P=E.getAttribute(a)||"";P=s+P;var Q=m.get(P);Q?Q.push(E):m.set(P,[E])}}return m}function _x(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function Vj(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function bx(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function $j(s,a,c,m){if(c.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var v=Dl(m.href),E=a.querySelector(yu(v));if(E){a=E._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=Nh.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=E,fn(E);return}E=a.ownerDocument||a,m=px(m),(v=Gr.get(v))&&xg(m,v),E=E.createElement("link"),fn(E);var P=E;P._p=new Promise(function(Q,se){P.onload=Q,P.onerror=se}),Ln(E,"link",m),c.instance=E}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Nh.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var Sg=0;function qj(s,a){return s.stylesheets&&s.count===0&&Bh(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var m=setTimeout(function(){if(s.stylesheets&&Bh(s,s.stylesheets),s.unsuspend){var E=s.unsuspend;s.unsuspend=null,E()}},6e4+a);0<s.imgBytes&&Sg===0&&(Sg=62500*Ej());var v=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Bh(s,s.stylesheets),s.unsuspend)){var E=s.unsuspend;s.unsuspend=null,E()}},(s.imgBytes>Sg?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(m),clearTimeout(v)}}:null}function Nh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Bh(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Ph=null;function Bh(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Ph=new Map,a.forEach(Hj,s),Ph=null,Nh.call(s))}function Hj(s,a){if(!(a.state.loading&4)){var c=Ph.get(s);if(c)var m=c.get(null);else{c=new Map,Ph.set(s,c);for(var v=s.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<v.length;E++){var P=v[E];(P.nodeName==="LINK"||P.getAttribute("media")!=="not all")&&(c.set(P.dataset.precedence,P),m=P)}m&&c.set(null,m)}v=a.instance,P=v.getAttribute("data-precedence"),E=c.get(P)||m,E===m&&c.set(null,v),c.set(P,v),this.count++,m=Nh.bind(this),v.addEventListener("load",m),v.addEventListener("error",m),E?E.parentNode.insertBefore(v,E.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(v,s.firstChild)),a.state.loading|=4}}var bu={$$typeof:R,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function Gj(s,a,c,m,v,E,P,Q,se){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=vs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vs(0),this.hiddenUpdates=vs(null),this.identifierPrefix=m,this.onUncaughtError=v,this.onCaughtError=E,this.onRecoverableError=P,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=se,this.incompleteTransitions=new Map}function vx(s,a,c,m,v,E,P,Q,se,me,Ce,ke){return s=new Gj(s,a,c,P,se,me,Ce,ke,Q),a=1,E===!0&&(a|=24),E=Cr(3,null,null,a),s.current=E,E.stateNode=s,a=np(),a.refCount++,s.pooledCache=a,a.refCount++,E.memoizedState={element:m,isDehydrated:c,cache:a},ap(E),s}function xx(s){return s?(s=ul,s):ul}function wx(s,a,c,m,v,E){v=xx(v),m.context===null?m.context=v:m.pendingContext=v,m=Yi(a),m.payload={element:c},E=E===void 0?null:E,E!==null&&(m.callback=E),c=Xi(s,m,a),c!==null&&(gr(c,s,a),Xc(c,s,a))}function Sx(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function Eg(s,a){Sx(s,a),(s=s.alternate)&&Sx(s,a)}function Ex(s){if(s.tag===13||s.tag===31){var a=uo(s,67108864);a!==null&&gr(a,s,67108864),Eg(s,67108864)}}function Cx(s){if(s.tag===13||s.tag===31){var a=Ir();a=Za(a);var c=uo(s,a);c!==null&&gr(c,s,a),Eg(s,a)}}var zh=!0;function Wj(s,a,c,m){var v=Y.T;Y.T=null;var E=G.p;try{G.p=2,Cg(s,a,c,m)}finally{G.p=E,Y.T=v}}function Qj(s,a,c,m){var v=Y.T;Y.T=null;var E=G.p;try{G.p=8,Cg(s,a,c,m)}finally{G.p=E,Y.T=v}}function Cg(s,a,c,m){if(zh){var v=Tg(m);if(v===null)dg(s,a,m,Lh,c),Ax(s,m);else if(Yj(v,s,a,c,m))m.stopPropagation();else if(Ax(s,m),a&4&&-1<Kj.indexOf(s)){for(;v!==null;){var E=Nr(v);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var P=ir(E.pendingLanes);if(P!==0){var Q=E;for(Q.pendingLanes|=2,Q.entangledLanes|=2;P;){var se=1<<31-Et(P);Q.entanglements[1]|=se,P&=~se}Bs(E),(Tt&6)===0&&(xh=Be()+500,fu(0))}}break;case 31:case 13:Q=uo(E,2),Q!==null&&gr(Q,E,2),Sh(),Eg(E,2)}if(E=Tg(m),E===null&&dg(s,a,m,Lh,c),E===v)break;v=E}v!==null&&m.stopPropagation()}else dg(s,a,m,null,c)}}function Tg(s){return s=Pr(s),Ag(s)}var Lh=null;function Ag(s){if(Lh=null,s=Ss(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=l(a),s!==null)return s;s=null}else if(c===31){if(s=d(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return Lh=s,null}function Tx(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Oe()){case He:return 2;case xt:return 8;case rt:case Wn:return 32;case gs:return 268435456;default:return 32}default:return 32}}var jg=!1,la=null,ca=null,ua=null,vu=new Map,xu=new Map,da=[],Kj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ax(s,a){switch(s){case"focusin":case"focusout":la=null;break;case"dragenter":case"dragleave":ca=null;break;case"mouseover":case"mouseout":ua=null;break;case"pointerover":case"pointerout":vu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":xu.delete(a.pointerId)}}function wu(s,a,c,m,v,E){return s===null||s.nativeEvent!==E?(s={blockedOn:a,domEventName:c,eventSystemFlags:m,nativeEvent:E,targetContainers:[v]},a!==null&&(a=Nr(a),a!==null&&Ex(a)),s):(s.eventSystemFlags|=m,a=s.targetContainers,v!==null&&a.indexOf(v)===-1&&a.push(v),s)}function Yj(s,a,c,m,v){switch(a){case"focusin":return la=wu(la,s,a,c,m,v),!0;case"dragenter":return ca=wu(ca,s,a,c,m,v),!0;case"mouseover":return ua=wu(ua,s,a,c,m,v),!0;case"pointerover":var E=v.pointerId;return vu.set(E,wu(vu.get(E)||null,s,a,c,m,v)),!0;case"gotpointercapture":return E=v.pointerId,xu.set(E,wu(xu.get(E)||null,s,a,c,m,v)),!0}return!1}function jx(s){var a=Ss(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){s.blockedOn=a,Jr(s.priority,function(){Cx(c)});return}}else if(a===31){if(a=d(c),a!==null){s.blockedOn=a,Jr(s.priority,function(){Cx(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Uh(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=Tg(s.nativeEvent);if(c===null){c=s.nativeEvent;var m=new c.constructor(c.type,c);Nc=m,c.target.dispatchEvent(m),Nc=null}else return a=Nr(c),a!==null&&Ex(a),s.blockedOn=c,!1;a.shift()}return!0}function Rx(s,a,c){Uh(s)&&c.delete(a)}function Xj(){jg=!1,la!==null&&Uh(la)&&(la=null),ca!==null&&Uh(ca)&&(ca=null),ua!==null&&Uh(ua)&&(ua=null),vu.forEach(Rx),xu.forEach(Rx)}function Fh(s,a){s.blockedOn===a&&(s.blockedOn=null,jg||(jg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Xj)))}var Vh=null;function Ix(s){Vh!==s&&(Vh=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Vh===s&&(Vh=null);for(var a=0;a<s.length;a+=3){var c=s[a],m=s[a+1],v=s[a+2];if(typeof m!="function"){if(Ag(m||c)===null)continue;break}var E=Nr(c);E!==null&&(s.splice(a,3),a-=3,Tp(E,{pending:!0,data:v,method:c.method,action:m},m,v))}}))}function Ol(s){function a(se){return Fh(se,s)}la!==null&&Fh(la,s),ca!==null&&Fh(ca,s),ua!==null&&Fh(ua,s),vu.forEach(a),xu.forEach(a);for(var c=0;c<da.length;c++){var m=da[c];m.blockedOn===s&&(m.blockedOn=null)}for(;0<da.length&&(c=da[0],c.blockedOn===null);)jx(c),c.blockedOn===null&&da.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(m=0;m<c.length;m+=3){var v=c[m],E=c[m+1],P=v[kn]||null;if(typeof E=="function")P||Ix(c);else if(P){var Q=null;if(E&&E.hasAttribute("formAction")){if(v=E,P=E[kn]||null)Q=P.formAction;else if(Ag(v)!==null)continue}else Q=P.action;typeof Q=="function"?c[m+1]=Q:(c.splice(m,3),m-=3),Ix(c)}}}function kx(){function s(E){E.canIntercept&&E.info==="react-transition"&&E.intercept({handler:function(){return new Promise(function(P){return v=P})},focusReset:"manual",scroll:"manual"})}function a(){v!==null&&(v(),v=null),m||setTimeout(c,20)}function c(){if(!m&&!navigation.transition){var E=navigation.currentEntry;E&&E.url!=null&&navigation.navigate(E.url,{state:E.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,v=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){m=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),v!==null&&(v(),v=null)}}}function Rg(s){this._internalRoot=s}$h.prototype.render=Rg.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,m=Ir();wx(c,m,s,a,null,null)},$h.prototype.unmount=Rg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;wx(s.current,2,null,s,null,null),Sh(),a[xs]=null}};function $h(s){this._internalRoot=s}$h.prototype.unstable_scheduleHydration=function(s){if(s){var a=Sd();s={blockedOn:null,target:s,priority:a};for(var c=0;c<da.length&&a!==0&&a<da[c].priority;c++);da.splice(c,0,s),c===0&&jx(s)}};var Dx=e.version;if(Dx!=="19.2.3")throw Error(r(527,Dx,"19.2.3"));G.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=f(a),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var Zj={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Y,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qh.isDisabled&&qh.supportsFiber)try{vt=qh.inject(Zj),nn=qh}catch{}}return Eu.createRoot=function(s,a){if(!i(s))throw Error(r(299));var c=!1,m="",v=Lb,E=Ub,P=Fb;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onUncaughtError!==void 0&&(v=a.onUncaughtError),a.onCaughtError!==void 0&&(E=a.onCaughtError),a.onRecoverableError!==void 0&&(P=a.onRecoverableError)),a=vx(s,1,!1,null,null,c,m,null,v,E,P,kx),s[xs]=a.current,ug(s),new Rg(a)},Eu.hydrateRoot=function(s,a,c){if(!i(s))throw Error(r(299));var m=!1,v="",E=Lb,P=Ub,Q=Fb,se=null;return c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(v=c.identifierPrefix),c.onUncaughtError!==void 0&&(E=c.onUncaughtError),c.onCaughtError!==void 0&&(P=c.onCaughtError),c.onRecoverableError!==void 0&&(Q=c.onRecoverableError),c.formState!==void 0&&(se=c.formState)),a=vx(s,1,!0,a,c??null,m,v,se,E,P,Q,kx),a.context=xx(null),c=a.current,m=Ir(),m=Za(m),v=Yi(m),v.callback=null,Xi(c,v,m),c=m,a.current.lanes=c,Ya(a,c),Bs(a),s[xs]=a.current,ug(s),new $h(a)},Eu.version="19.2.3",Eu}var Vx;function cR(){if(Vx)return Dg.exports;Vx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Dg.exports=lR(),Dg.exports}var uR=cR();var $x="popstate";function dR(t={}){function e(r,i){let{pathname:o,search:l,hash:d}=r.location;return ay("",{pathname:o,search:l,hash:d},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:zu(i)}return fR(e,n,null,t)}function Zt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Dr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function hR(){return Math.random().toString(36).substring(2,10)}function qx(t,e){return{usr:t.state,key:t.key,idx:e}}function ay(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?ic(e):e,state:n,key:e&&e.key||r||hR()}}function zu({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function ic(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function fR(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,l=i.history,d="POP",h=null,f=p();f==null&&(f=0,l.replaceState({...l.state,idx:f},""));function p(){return(l.state||{idx:null}).idx}function g(){d="POP";let S=p(),C=S==null?null:S-f;f=S,h&&h({action:d,location:x.location,delta:C})}function b(S,C){d="PUSH";let T=ay(x.location,S,C);f=p()+1;let R=qx(T,f),k=x.createHref(T);try{l.pushState(R,"",k)}catch(V){if(V instanceof DOMException&&V.name==="DataCloneError")throw V;i.location.assign(k)}o&&h&&h({action:d,location:x.location,delta:1})}function _(S,C){d="REPLACE";let T=ay(x.location,S,C);f=p();let R=qx(T,f),k=x.createHref(T);l.replaceState(R,"",k),o&&h&&h({action:d,location:x.location,delta:0})}function w(S){return mR(S)}let x={get action(){return d},get location(){return t(i,l)},listen(S){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener($x,g),h=S,()=>{i.removeEventListener($x,g),h=null}},createHref(S){return e(i,S)},createURL:w,encodeLocation(S){let C=w(S);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:b,replace:_,go(S){return l.go(S)}};return x}function mR(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Zt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:zu(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function b1(t,e,n="/"){return pR(t,e,n,!1)}function pR(t,e,n,r){let i=typeof e=="string"?ic(e):e,o=Ei(i.pathname||"/",n);if(o==null)return null;let l=v1(t);gR(l);let d=null;for(let h=0;d==null&&h<l.length;++h){let f=AR(o);d=CR(l[h],f,r)}return d}function v1(t,e=[],n=[],r="",i=!1){let o=(l,d,h=i,f)=>{let p={relativePath:f===void 0?l.path||"":f,caseSensitive:l.caseSensitive===!0,childrenIndex:d,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;Zt(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=wi([r,p.relativePath]),b=n.concat(p);l.children&&l.children.length>0&&(Zt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),v1(l.children,e,b,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:SR(g,l.index),routesMeta:b})};return t.forEach((l,d)=>{if(l.path===""||!l.path?.includes("?"))o(l,d);else for(let h of x1(l.path))o(l,d,!0,h)}),e}function x1(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let l=x1(r.join("/")),d=[];return d.push(...l.map(h=>h===""?o:[o,h].join("/"))),i&&d.push(...l),d.map(h=>t.startsWith("/")&&h===""?"/":h)}function gR(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:ER(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var yR=/^:[\w-]+$/,_R=3,bR=2,vR=1,xR=10,wR=-2,Hx=t=>t==="*";function SR(t,e){let n=t.split("/"),r=n.length;return n.some(Hx)&&(r+=wR),e&&(r+=bR),n.filter(i=>!Hx(i)).reduce((i,o)=>i+(yR.test(o)?_R:o===""?vR:xR),r)}function ER(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function CR(t,e,n=!1){let{routesMeta:r}=t,i={},o="/",l=[];for(let d=0;d<r.length;++d){let h=r[d],f=d===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=pf({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},p),b=h.route;if(!g&&f&&n&&!r[r.length-1].route.index&&(g=pf({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(i,g.params),l.push({params:i,pathname:wi([o,g.pathname]),pathnameBase:kR(wi([o,g.pathnameBase])),route:b}),g.pathnameBase!=="/"&&(o=wi([o,g.pathnameBase]))}return l}function pf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=TR(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],l=o.replace(/(.)\/+$/,"$1"),d=i.slice(1);return{params:r.reduce((f,{paramName:p,isOptional:g},b)=>{if(p==="*"){let w=d[b]||"";l=o.slice(0,o.length-w.length).replace(/(.)\/+$/,"$1")}const _=d[b];return g&&!_?f[p]=void 0:f[p]=(_||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:l,pattern:t}}function TR(t,e=!1,n=!0){Dr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,d,h)=>(r.push({paramName:d,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function AR(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Dr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Ei(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var w1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,jR=t=>w1.test(t);function RR(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?ic(t):t,o;if(n)if(jR(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),Dr(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${n}`)}n.startsWith("/")?o=Gx(n.substring(1),"/"):o=Gx(n,e)}else o=e;return{pathname:o,search:DR(r),hash:MR(i)}}function Gx(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Pg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function IR(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Gy(t){let e=IR(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Wy(t,e,n,r=!1){let i;typeof t=="string"?i=ic(t):(i={...t},Zt(!i.pathname||!i.pathname.includes("?"),Pg("?","pathname","search",i)),Zt(!i.pathname||!i.pathname.includes("#"),Pg("#","pathname","hash",i)),Zt(!i.search||!i.search.includes("#"),Pg("#","search","hash",i)));let o=t===""||i.pathname==="",l=o?"/":i.pathname,d;if(l==null)d=n;else{let g=e.length-1;if(!r&&l.startsWith("..")){let b=l.split("/");for(;b[0]==="..";)b.shift(),g-=1;i.pathname=b.join("/")}d=g>=0?e[g]:"/"}let h=RR(i,d),f=l&&l!=="/"&&l.endsWith("/"),p=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(f||p)&&(h.pathname+="/"),h}var wi=t=>t.join("/").replace(/\/\/+/g,"/"),kR=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),DR=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,MR=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,OR=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function NR(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function PR(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var S1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function E1(t,e){let n=t;if(typeof n!="string"||!w1.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(S1)try{let o=new URL(window.location.href),l=n.startsWith("//")?new URL(o.protocol+n):new URL(n),d=Ei(l.pathname,e);l.origin===o.origin&&d!=null?n=d+l.search+l.hash:i=!0}catch{Dr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var C1=["POST","PUT","PATCH","DELETE"];new Set(C1);var BR=["GET",...C1];new Set(BR);var ac=A.createContext(null);ac.displayName="DataRouter";var qf=A.createContext(null);qf.displayName="DataRouterState";var zR=A.createContext(!1),T1=A.createContext({isTransitioning:!1});T1.displayName="ViewTransition";var LR=A.createContext(new Map);LR.displayName="Fetchers";var UR=A.createContext(null);UR.displayName="Await";var Mr=A.createContext(null);Mr.displayName="Navigation";var ed=A.createContext(null);ed.displayName="Location";var Xr=A.createContext({outlet:null,matches:[],isDataRoute:!1});Xr.displayName="Route";var Qy=A.createContext(null);Qy.displayName="RouteError";var A1="REACT_ROUTER_ERROR",FR="REDIRECT",VR="ROUTE_ERROR_RESPONSE";function $R(t){if(t.startsWith(`${A1}:${FR}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function qR(t){if(t.startsWith(`${A1}:${VR}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new OR(e.status,e.statusText,e.data)}catch{}}function HR(t,{relative:e}={}){Zt(oc(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=A.useContext(Mr),{hash:i,pathname:o,search:l}=nd(t,{relative:e}),d=o;return n!=="/"&&(d=o==="/"?n:wi([n,o])),r.createHref({pathname:d,search:l,hash:i})}function oc(){return A.useContext(ed)!=null}function tr(){return Zt(oc(),"useLocation() may be used only in the context of a <Router> component."),A.useContext(ed).location}var j1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function R1(t){A.useContext(Mr).static||A.useLayoutEffect(t)}function td(){let{isDataRoute:t}=A.useContext(Xr);return t?oI():GR()}function GR(){Zt(oc(),"useNavigate() may be used only in the context of a <Router> component.");let t=A.useContext(ac),{basename:e,navigator:n}=A.useContext(Mr),{matches:r}=A.useContext(Xr),{pathname:i}=tr(),o=JSON.stringify(Gy(r)),l=A.useRef(!1);return R1(()=>{l.current=!0}),A.useCallback((h,f={})=>{if(Dr(l.current,j1),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=Wy(h,JSON.parse(o),i,f.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:wi([e,p.pathname])),(f.replace?n.replace:n.push)(p,f.state,f)},[e,n,o,i,t])}var WR=A.createContext(null);function QR(t){let e=A.useContext(Xr).outlet;return A.useMemo(()=>e&&A.createElement(WR.Provider,{value:t},e),[e,t])}function KR(){let{matches:t}=A.useContext(Xr),e=t[t.length-1];return e?e.params:{}}function nd(t,{relative:e}={}){let{matches:n}=A.useContext(Xr),{pathname:r}=tr(),i=JSON.stringify(Gy(n));return A.useMemo(()=>Wy(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function YR(t,e){return I1(t,e)}function I1(t,e,n,r,i){Zt(oc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=A.useContext(Mr),{matches:l}=A.useContext(Xr),d=l[l.length-1],h=d?d.params:{},f=d?d.pathname:"/",p=d?d.pathnameBase:"/",g=d&&d.route;{let T=g&&g.path||"";D1(f,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let b=tr(),_;if(e){let T=typeof e=="string"?ic(e):e;Zt(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),_=T}else _=b;let w=_.pathname||"/",x=w;if(p!=="/"){let T=p.replace(/^\//,"").split("/");x="/"+w.replace(/^\//,"").split("/").slice(T.length).join("/")}let S=b1(t,{pathname:x});Dr(g||S!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),Dr(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=tI(S&&S.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:wi([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:wi([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),l,n,r,i);return e&&C?A.createElement(ed.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},C):C}function XR(){let t=aI(),e=NR(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=A.createElement(A.Fragment,null,A.createElement("p",null," Hey developer "),A.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",A.createElement("code",{style:o},"ErrorBoundary")," or"," ",A.createElement("code",{style:o},"errorElement")," prop on your route.")),A.createElement(A.Fragment,null,A.createElement("h2",null,"Unexpected Application Error!"),A.createElement("h3",{style:{fontStyle:"italic"}},e),n?A.createElement("pre",{style:i},n):null,l)}var ZR=A.createElement(XR,null),k1=class extends A.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=qR(t.digest);n&&(t=n)}let e=t!==void 0?A.createElement(Xr.Provider,{value:this.props.routeContext},A.createElement(Qy.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?A.createElement(JR,{error:t},e):e}};k1.contextType=zR;var Bg=new WeakMap;function JR({children:t,error:e}){let{basename:n}=A.useContext(Mr);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=$R(e.digest);if(r){let i=Bg.get(e);if(i)throw i;let o=E1(r.location,n);if(S1&&!Bg.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw Bg.set(e,l),l}return A.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function eI({routeContext:t,match:e,children:n}){let r=A.useContext(ac);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),A.createElement(Xr.Provider,{value:t},n)}function tI(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=n?.errors;if(l!=null){let p=o.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Zt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let d=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:b,errors:_}=n,w=g.route.loader&&!b.hasOwnProperty(g.route.id)&&(!_||_[g.route.id]===void 0);if(g.route.lazy||w){d=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let f=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:PR(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,b)=>{let _,w=!1,x=null,S=null;n&&(_=l&&g.route.id?l[g.route.id]:void 0,x=g.route.errorElement||ZR,d&&(h<0&&b===0?(D1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),w=!0,S=null):h===b&&(w=!0,S=g.route.hydrateFallbackElement||null)));let C=e.concat(o.slice(0,b+1)),T=()=>{let R;return _?R=x:w?R=S:g.route.Component?R=A.createElement(g.route.Component,null):g.route.element?R=g.route.element:R=p,A.createElement(eI,{match:g,routeContext:{outlet:p,matches:C,isDataRoute:n!=null},children:R})};return n&&(g.route.ErrorBoundary||g.route.errorElement||b===0)?A.createElement(k1,{location:n.location,revalidation:n.revalidation,component:x,error:_,children:T(),routeContext:{outlet:null,matches:C,isDataRoute:!0},onError:f}):T()},null)}function Ky(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nI(t){let e=A.useContext(ac);return Zt(e,Ky(t)),e}function rI(t){let e=A.useContext(qf);return Zt(e,Ky(t)),e}function sI(t){let e=A.useContext(Xr);return Zt(e,Ky(t)),e}function Yy(t){let e=sI(t),n=e.matches[e.matches.length-1];return Zt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function iI(){return Yy("useRouteId")}function aI(){let t=A.useContext(Qy),e=rI("useRouteError"),n=Yy("useRouteError");return t!==void 0?t:e.errors?.[n]}function oI(){let{router:t}=nI("useNavigate"),e=Yy("useNavigate"),n=A.useRef(!1);return R1(()=>{n.current=!0}),A.useCallback(async(i,o={})=>{Dr(n.current,j1),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...o}))},[t,e])}var Wx={};function D1(t,e,n){!e&&!Wx[t]&&(Wx[t]=!0,Dr(!1,n))}A.memo(lI);function lI({routes:t,future:e,state:n,onError:r}){return I1(t,void 0,n,r,e)}function Hf({to:t,replace:e,state:n,relative:r}){Zt(oc(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=A.useContext(Mr);Dr(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=A.useContext(Xr),{pathname:l}=tr(),d=td(),h=Wy(t,Gy(o),l,r==="path"),f=JSON.stringify(h);return A.useEffect(()=>{d(JSON.parse(f),{replace:e,state:n,relative:r})},[d,f,r,e,n]),null}function Gf(t){return QR(t.context)}function bn(t){Zt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function cI({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:o=!1,unstable_useTransitions:l}){Zt(!oc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=t.replace(/^\/*/,"/"),h=A.useMemo(()=>({basename:d,navigator:i,static:o,unstable_useTransitions:l,future:{}}),[d,i,o,l]);typeof n=="string"&&(n=ic(n));let{pathname:f="/",search:p="",hash:g="",state:b=null,key:_="default"}=n,w=A.useMemo(()=>{let x=Ei(f,d);return x==null?null:{location:{pathname:x,search:p,hash:g,state:b,key:_},navigationType:r}},[d,f,p,g,b,_,r]);return Dr(w!=null,`<Router basename="${d}"> is not able to match the URL "${f}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),w==null?null:A.createElement(Mr.Provider,{value:h},A.createElement(ed.Provider,{children:e,value:w}))}function uI({children:t,location:e}){return YR(oy(t),e)}function oy(t,e=[]){let n=[];return A.Children.forEach(t,(r,i)=>{if(!A.isValidElement(r))return;let o=[...e,i];if(r.type===A.Fragment){n.push.apply(n,oy(r.props.children,o));return}Zt(r.type===bn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Zt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=oy(r.props.children,o)),n.push(l)}),n}var nf="get",rf="application/x-www-form-urlencoded";function Wf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function dI(t){return Wf(t)&&t.tagName.toLowerCase()==="button"}function hI(t){return Wf(t)&&t.tagName.toLowerCase()==="form"}function fI(t){return Wf(t)&&t.tagName.toLowerCase()==="input"}function mI(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function pI(t,e){return t.button===0&&(!e||e==="_self")&&!mI(t)}function ly(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function gI(t,e){let n=ly(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(o=>{n.append(i,o)})}),n}var Gh=null;function yI(){if(Gh===null)try{new FormData(document.createElement("form"),0),Gh=!1}catch{Gh=!0}return Gh}var _I=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function zg(t){return t!=null&&!_I.has(t)?(Dr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${rf}"`),null):t}function bI(t,e){let n,r,i,o,l;if(hI(t)){let d=t.getAttribute("action");r=d?Ei(d,e):null,n=t.getAttribute("method")||nf,i=zg(t.getAttribute("enctype"))||rf,o=new FormData(t)}else if(dI(t)||fI(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||d.getAttribute("action");if(r=h?Ei(h,e):null,n=t.getAttribute("formmethod")||d.getAttribute("method")||nf,i=zg(t.getAttribute("formenctype"))||zg(d.getAttribute("enctype"))||rf,o=new FormData(d,t),!yI()){let{name:f,type:p,value:g}=t;if(p==="image"){let b=f?`${f}.`:"";o.append(`${b}x`,"0"),o.append(`${b}y`,"0")}else f&&o.append(f,g)}}else{if(Wf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=nf,r=null,i=rf,l=t}return o&&i==="text/plain"&&(l=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Xy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function vI(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&Ei(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function xI(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function wI(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function SI(t,e,n){let r=await Promise.all(t.map(async i=>{let o=e.routes[i.route.id];if(o){let l=await xI(o,n);return l.links?l.links():[]}return[]}));return AI(r.flat(1).filter(wI).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Qx(t,e,n,r,i,o){let l=(h,f)=>n[f]?h.route.id!==n[f].route.id:!0,d=(h,f)=>n[f].pathname!==h.pathname||n[f].route.path?.endsWith("*")&&n[f].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,f)=>l(h,f)||d(h,f)):o==="data"?e.filter((h,f)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,f)||d(h,f))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function EI(t,e,{includeHydrateFallback:n}={}){return CI(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function CI(t){return[...new Set(t)]}function TI(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function AI(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let o=JSON.stringify(TI(i));return n.has(o)||(n.add(o),r.push({key:o,link:i})),r},[])}function M1(){let t=A.useContext(ac);return Xy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function jI(){let t=A.useContext(qf);return Xy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Zy=A.createContext(void 0);Zy.displayName="FrameworkContext";function O1(){let t=A.useContext(Zy);return Xy(t,"You must render this element inside a <HydratedRouter> element"),t}function RI(t,e){let n=A.useContext(Zy),[r,i]=A.useState(!1),[o,l]=A.useState(!1),{onFocus:d,onBlur:h,onMouseEnter:f,onMouseLeave:p,onTouchStart:g}=e,b=A.useRef(null);A.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=C=>{C.forEach(T=>{l(T.isIntersecting)})},S=new IntersectionObserver(x,{threshold:.5});return b.current&&S.observe(b.current),()=>{S.disconnect()}}},[t]),A.useEffect(()=>{if(r){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[r]);let _=()=>{i(!0)},w=()=>{i(!1),l(!1)};return n?t!=="intent"?[o,b,{}]:[o,b,{onFocus:Cu(d,_),onBlur:Cu(h,w),onMouseEnter:Cu(f,_),onMouseLeave:Cu(p,w),onTouchStart:Cu(g,_)}]:[!1,b,{}]}function Cu(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function II({page:t,...e}){let{router:n}=M1(),r=A.useMemo(()=>b1(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?A.createElement(DI,{page:t,matches:r,...e}):null}function kI(t){let{manifest:e,routeModules:n}=O1(),[r,i]=A.useState([]);return A.useEffect(()=>{let o=!1;return SI(t,e,n).then(l=>{o||i(l)}),()=>{o=!0}},[t,e,n]),r}function DI({page:t,matches:e,...n}){let r=tr(),{manifest:i,routeModules:o}=O1(),{basename:l}=M1(),{loaderData:d,matches:h}=jI(),f=A.useMemo(()=>Qx(t,e,h,i,r,"data"),[t,e,h,i,r]),p=A.useMemo(()=>Qx(t,e,h,i,r,"assets"),[t,e,h,i,r]),g=A.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let w=new Set,x=!1;if(e.forEach(C=>{let T=i.routes[C.route.id];!T||!T.hasLoader||(!f.some(R=>R.route.id===C.route.id)&&C.route.id in d&&o[C.route.id]?.shouldRevalidate||T.hasClientLoader?x=!0:w.add(C.route.id))}),w.size===0)return[];let S=vI(t,l,"data");return x&&w.size>0&&S.searchParams.set("_routes",e.filter(C=>w.has(C.route.id)).map(C=>C.route.id).join(",")),[S.pathname+S.search]},[l,d,r,i,f,e,t,o]),b=A.useMemo(()=>EI(p,i),[p,i]),_=kI(p);return A.createElement(A.Fragment,null,g.map(w=>A.createElement("link",{key:w,rel:"prefetch",as:"fetch",href:w,...n})),b.map(w=>A.createElement("link",{key:w,rel:"modulepreload",href:w,...n})),_.map(({key:w,link:x})=>A.createElement("link",{key:w,nonce:n.nonce,...x})))}function MI(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var OI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{OI&&(window.__reactRouterVersion="7.11.0")}catch{}function NI({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=A.useRef();i.current==null&&(i.current=dR({window:r,v5Compat:!0}));let o=i.current,[l,d]=A.useState({action:o.action,location:o.location}),h=A.useCallback(f=>{n===!1?d(f):A.startTransition(()=>d(f))},[n]);return A.useLayoutEffect(()=>o.listen(h),[o,h]),A.createElement(cI,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:n})}var N1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Tn=A.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:o,replace:l,state:d,target:h,to:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b,..._},w){let{basename:x,unstable_useTransitions:S}=A.useContext(Mr),C=typeof f=="string"&&N1.test(f),T=E1(f,x);f=T.to;let R=HR(f,{relative:i}),[k,V,$]=RI(r,_),D=LI(f,{replace:l,state:d,target:h,preventScrollReset:p,relative:i,viewTransition:g,unstable_defaultShouldRevalidate:b,unstable_useTransitions:S});function O(U){e&&e(U),U.defaultPrevented||D(U)}let N=A.createElement("a",{..._,...$,href:T.absoluteURL||R,onClick:T.isExternal||o?e:O,ref:MI(w,V),target:h,"data-discover":!C&&n==="render"?"true":void 0});return k&&!C?A.createElement(A.Fragment,null,N,A.createElement(II,{page:R})):N});Tn.displayName="Link";var PI=A.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:o,to:l,viewTransition:d,children:h,...f},p){let g=nd(l,{relative:f.relative}),b=tr(),_=A.useContext(qf),{navigator:w,basename:x}=A.useContext(Mr),S=_!=null&&qI(g)&&d===!0,C=w.encodeLocation?w.encodeLocation(g).pathname:g.pathname,T=b.pathname,R=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;n||(T=T.toLowerCase(),R=R?R.toLowerCase():null,C=C.toLowerCase()),R&&x&&(R=Ei(R,x)||R);const k=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let V=T===C||!i&&T.startsWith(C)&&T.charAt(k)==="/",$=R!=null&&(R===C||!i&&R.startsWith(C)&&R.charAt(C.length)==="/"),D={isActive:V,isPending:$,isTransitioning:S},O=V?e:void 0,N;typeof r=="function"?N=r(D):N=[r,V?"active":null,$?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let U=typeof o=="function"?o(D):o;return A.createElement(Tn,{...f,"aria-current":O,className:N,ref:p,style:U,to:l,viewTransition:d},typeof h=="function"?h(D):h)});PI.displayName="NavLink";var BI=A.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:o,method:l=nf,action:d,onSubmit:h,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b,..._},w)=>{let{unstable_useTransitions:x}=A.useContext(Mr),S=VI(),C=$I(d,{relative:f}),T=l.toLowerCase()==="get"?"get":"post",R=typeof d=="string"&&N1.test(d),k=V=>{if(h&&h(V),V.defaultPrevented)return;V.preventDefault();let $=V.nativeEvent.submitter,D=$?.getAttribute("formmethod")||l,O=()=>S($||V.currentTarget,{fetcherKey:e,method:D,navigate:n,replace:i,state:o,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:b});x&&n!==!1?A.startTransition(()=>O()):O()};return A.createElement("form",{ref:w,method:T,action:C,onSubmit:r?h:k,..._,"data-discover":!R&&t==="render"?"true":void 0})});BI.displayName="Form";function zI(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function P1(t){let e=A.useContext(ac);return Zt(e,zI(t)),e}function LI(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d,unstable_useTransitions:h}={}){let f=td(),p=tr(),g=nd(t,{relative:o});return A.useCallback(b=>{if(pI(b,e)){b.preventDefault();let _=n!==void 0?n:zu(p)===zu(g),w=()=>f(t,{replace:_,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d});h?A.startTransition(()=>w()):w()}},[p,f,g,n,r,e,t,i,o,l,d,h])}function B1(t){Dr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=A.useRef(ly(t)),n=A.useRef(!1),r=tr(),i=A.useMemo(()=>gI(r.search,n.current?null:e.current),[r.search]),o=td(),l=A.useCallback((d,h)=>{const f=ly(typeof d=="function"?d(new URLSearchParams(i)):d);n.current=!0,o("?"+f,h)},[o,i]);return[i,l]}var UI=0,FI=()=>`__${String(++UI)}__`;function VI(){let{router:t}=P1("useSubmit"),{basename:e}=A.useContext(Mr),n=iI(),r=t.fetch,i=t.navigate;return A.useCallback(async(o,l={})=>{let{action:d,method:h,encType:f,formData:p,body:g}=bI(o,e);if(l.navigate===!1){let b=l.fetcherKey||FI();await r(b,n,l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||f,flushSync:l.flushSync})}else await i(l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||f,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[r,i,e,n])}function $I(t,{relative:e}={}){let{basename:n}=A.useContext(Mr),r=A.useContext(Xr);Zt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...nd(t||".",{relative:e})},l=tr();if(t==null){o.search=l.search;let d=new URLSearchParams(o.search),h=d.getAll("index");if(h.some(p=>p==="")){d.delete("index"),h.filter(g=>g).forEach(g=>d.append("index",g));let p=d.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:wi([n,o.pathname])),zu(o)}function qI(t,{relative:e}={}){let n=A.useContext(T1);Zt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=P1("useViewTransitionState"),i=nd(t,{relative:e});if(!n.isTransitioning)return!1;let o=Ei(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=Ei(n.nextLocation.pathname,r)||n.nextLocation.pathname;return pf(i.pathname,l)!=null||pf(i.pathname,o)!=null}var lc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},HI={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},GI=class{#e=HI;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},jo=new GI;function WI(t){setTimeout(t,0)}var Do=typeof window>"u"||"Deno"in globalThis;function lr(){}function QI(t,e){return typeof t=="function"?t(e):t}function cy(t){return typeof t=="number"&&t>=0&&t!==1/0}function z1(t,e){return Math.max(t+(e||0)-Date.now(),0)}function Sa(t,e){return typeof t=="function"?t(e):t}function Wr(t,e){return typeof t=="function"?t(e):t}function Kx(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:o,queryKey:l,stale:d}=t;if(l){if(r){if(e.queryHash!==Jy(l,e.options))return!1}else if(!Lu(e.queryKey,l))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof d=="boolean"&&e.isStale()!==d||i&&i!==e.state.fetchStatus||o&&!o(e))}function Yx(t,e){const{exact:n,status:r,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(Mo(e.options.mutationKey)!==Mo(o))return!1}else if(!Lu(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function Jy(t,e){return(e?.queryKeyHashFn||Mo)(t)}function Mo(t){return JSON.stringify(t,(e,n)=>uy(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function Lu(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Lu(t[n],e[n])):!1}var KI=Object.prototype.hasOwnProperty;function L1(t,e){if(t===e)return t;const n=Xx(t)&&Xx(e);if(!n&&!(uy(t)&&uy(e)))return e;const i=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),l=o.length,d=n?new Array(l):{};let h=0;for(let f=0;f<l;f++){const p=n?f:o[f],g=t[p],b=e[p];if(g===b){d[p]=g,(n?f<i:KI.call(t,p))&&h++;continue}if(g===null||b===null||typeof g!="object"||typeof b!="object"){d[p]=b;continue}const _=L1(g,b);d[p]=_,_===g&&h++}return i===l&&h===i?t:d}function gf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Xx(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function uy(t){if(!Zx(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Zx(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Zx(t){return Object.prototype.toString.call(t)==="[object Object]"}function YI(t){return new Promise(e=>{jo.setTimeout(e,t)})}function dy(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?L1(t,e):e}function XI(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function ZI(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var e_=Symbol();function U1(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===e_?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function F1(t,e){return typeof t=="function"?t(...e):!!t}var JI=class extends lc{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!Do&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},t_=new JI;function hy(){let t,e;const n=new Promise((i,o)=>{t=i,e=o});n.status="pending",n.catch(()=>{});function r(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},n.reject=i=>{r({status:"rejected",reason:i}),e(i)},n}var e2=WI;function t2(){let t=[],e=0,n=d=>{d()},r=d=>{d()},i=e2;const o=d=>{e?t.push(d):i(()=>{n(d)})},l=()=>{const d=t;t=[],d.length&&i(()=>{r(()=>{d.forEach(h=>{n(h)})})})};return{batch:d=>{let h;e++;try{h=d()}finally{e--,e||l()}return h},batchCalls:d=>(...h)=>{o(()=>{d(...h)})},schedule:o,setNotifyFunction:d=>{n=d},setBatchNotifyFunction:d=>{r=d},setScheduler:d=>{i=d}}}var Cn=t2(),n2=class extends lc{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!Do&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},yf=new n2;function r2(t){return Math.min(1e3*2**t,3e4)}function V1(t){return(t??"online")==="online"?yf.isOnline():!0}var fy=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function $1(t){let e=!1,n=0,r;const i=hy(),o=()=>i.status!=="pending",l=x=>{if(!o()){const S=new fy(x);b(S),t.onCancel?.(S)}},d=()=>{e=!0},h=()=>{e=!1},f=()=>t_.isFocused()&&(t.networkMode==="always"||yf.isOnline())&&t.canRun(),p=()=>V1(t.networkMode)&&t.canRun(),g=x=>{o()||(r?.(),i.resolve(x))},b=x=>{o()||(r?.(),i.reject(x))},_=()=>new Promise(x=>{r=S=>{(o()||f())&&x(S)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),w=()=>{if(o())return;let x;const S=n===0?t.initialPromise:void 0;try{x=S??t.fn()}catch(C){x=Promise.reject(C)}Promise.resolve(x).then(g).catch(C=>{if(o())return;const T=t.retry??(Do?0:3),R=t.retryDelay??r2,k=typeof R=="function"?R(n,C):R,V=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,C);if(e||!V){b(C);return}n++,t.onFail?.(n,C),YI(k).then(()=>f()?void 0:_()).then(()=>{e?b(C):w()})})};return{promise:i,status:()=>i.status,cancel:l,continue:()=>(r?.(),i),cancelRetry:d,continueRetry:h,canStart:p,start:()=>(p()?w():_().then(w),i)}}var q1=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),cy(this.gcTime)&&(this.#e=jo.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Do?1/0:300*1e3))}clearGcTimeout(){this.#e&&(jo.clearTimeout(this.#e),this.#e=void 0)}},s2=class extends q1{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=ew(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=ew(this.options);n.data!==void 0&&(this.setState(Jx(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=dy(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(lr).catch(lr):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Wr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===e_||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>Sa(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!z1(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(f=>f.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,i=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=U1(this.options,n),p=(()=>{const g={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},d=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return i(h),h})();this.options.behavior?.onFetch(d,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==d.fetchOptions?.meta)&&this.#i({type:"fetch",meta:d.fetchOptions?.meta}),this.#r=$1({initialPromise:n?.initialPromise,fn:d.fetchFn,onCancel:h=>{h instanceof fy&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,f)=>{this.#i({type:"failed",failureCount:h,error:f})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:d.options.retry,retryDelay:d.options.retryDelay,networkMode:d.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof fy){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#i({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...H1(r.data,this.options),fetchMeta:e.meta??null};case"success":const i={...r,...Jx(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),Cn.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function H1(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:V1(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Jx(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function ew(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var i2=class extends lc{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=hy(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),tw(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return my(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return my(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Wr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!gf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&nw(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Wr(this.options.enabled,this.#t)!==Wr(e.enabled,this.#t)||Sa(this.options.staleTime,this.#t)!==Sa(e.staleTime,this.#t))&&this.#g();const i=this.#y();r&&(this.#t!==n||Wr(this.options.enabled,this.#t)!==Wr(e.enabled,this.#t)||i!==this.#l)&&this.#_(i)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return o2(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(lr)),e}#g(){this.#v();const t=Sa(this.options.staleTime,this.#t);if(Do||this.#s.isStale||!cy(t))return;const n=z1(this.#s.dataUpdatedAt,t)+1;this.#c=jo.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(Do||Wr(this.options.enabled,this.#t)===!1||!cy(this.#l)||this.#l===0)&&(this.#u=jo.setInterval(()=>{(this.options.refetchIntervalInBackground||t_.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(jo.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(jo.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,i=this.#s,o=this.#r,l=this.#a,h=t!==n?t.state:this.#n,{state:f}=t;let p={...f},g=!1,b;if(e._optimisticResults){const O=this.hasListeners(),N=!O&&tw(t,e),U=O&&nw(t,n,e,r);(N||U)&&(p={...p,...H1(f.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:_,errorUpdatedAt:w,status:x}=p;b=p.data;let S=!1;if(e.placeholderData!==void 0&&b===void 0&&x==="pending"){let O;i?.isPlaceholderData&&e.placeholderData===l?.placeholderData?(O=i.data,S=!0):O=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,O!==void 0&&(x="success",b=dy(i?.data,O,e),g=!0)}if(e.select&&b!==void 0&&!S)if(i&&b===o?.data&&e.select===this.#p)b=this.#h;else try{this.#p=e.select,b=e.select(b),b=dy(i?.data,b,e),this.#h=b,this.#i=null}catch(O){this.#i=O}this.#i&&(_=this.#i,b=this.#h,w=Date.now(),x="error");const C=p.fetchStatus==="fetching",T=x==="pending",R=x==="error",k=T&&C,V=b!==void 0,D={status:x,fetchStatus:p.fetchStatus,isPending:T,isSuccess:x==="success",isError:R,isInitialLoading:k,isLoading:k,data:b,dataUpdatedAt:p.dataUpdatedAt,error:_,errorUpdatedAt:w,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:C,isRefetching:C&&!T,isLoadingError:R&&!V,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:R&&V,isStale:n_(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Wr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const O=q=>{D.status==="error"?q.reject(D.error):D.data!==void 0&&q.resolve(D.data)},N=()=>{const q=this.#o=D.promise=hy();O(q)},U=this.#o;switch(U.status){case"pending":t.queryHash===n.queryHash&&O(U);break;case"fulfilled":(D.status==="error"||D.data!==U.value)&&N();break;case"rejected":(D.status!=="error"||D.error!==U.reason)&&N();break}}return D}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),gf(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#m.size)return!0;const o=new Set(i??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(l=>{const d=l;return this.#s[d]!==t[d]&&o.has(d)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){Cn.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function a2(t,e){return Wr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function tw(t,e){return a2(t,e)||t.state.data!==void 0&&my(t,e,e.refetchOnMount)}function my(t,e,n){if(Wr(e.enabled,t)!==!1&&Sa(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&n_(t,e)}return!1}function nw(t,e,n,r){return(t!==e||Wr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&n_(t,n)}function n_(t,e){return Wr(e.enabled,t)!==!1&&t.isStaleByTime(Sa(e.staleTime,t))}function o2(t,e){return!gf(t.getCurrentResult(),e)}function rw(t){return{onFetch:(e,n)=>{const r=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],l=e.state.data?.pageParams||[];let d={pages:[],pageParams:[]},h=0;const f=async()=>{let p=!1;const g=w=>{Object.defineProperty(w,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},b=U1(e.options,e.fetchOptions),_=async(w,x,S)=>{if(p)return Promise.reject();if(x==null&&w.pages.length)return Promise.resolve(w);const T=(()=>{const $={client:e.client,queryKey:e.queryKey,pageParam:x,direction:S?"backward":"forward",meta:e.options.meta};return g($),$})(),R=await b(T),{maxPages:k}=e.options,V=S?ZI:XI;return{pages:V(w.pages,R,k),pageParams:V(w.pageParams,x,k)}};if(i&&o.length){const w=i==="backward",x=w?l2:sw,S={pages:o,pageParams:l},C=x(r,S);d=await _(S,C,w)}else{const w=t??o.length;do{const x=h===0?l[0]??r.initialPageParam:sw(r,d);if(h>0&&x==null)break;d=await _(d,x),h++}while(h<w)}return d};e.options.persister?e.fetchFn=()=>e.options.persister?.(f,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=f}}}function sw(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function l2(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var c2=class extends q1{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||G1(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=$1({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(l,d)=>{this.#r({type:"failed",failureCount:l,error:d})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",o=!this.#s.canStart();try{if(i)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const d=await this.options.onMutate?.(e,r);d!==this.state.context&&this.#r({type:"pending",context:d,variables:e,isPaused:o})}const l=await this.#s.start();return await this.#n.config.onSuccess?.(l,e,this.state.context,this,r),await this.options.onSuccess?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(l,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(l,null,e,this.state.context,r),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#n.config.onError?.(l,e,this.state.context,this,r),await this.options.onError?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,l,e,this.state.context,r),l}finally{this.#r({type:"error",error:l})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),Cn.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function G1(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var u2=class extends lc{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new c2({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Wh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Wh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Wh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Wh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Cn.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Yx(e,n))}findAll(t={}){return this.getAll().filter(e=>Yx(t,e))}notify(t){Cn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return Cn.batch(()=>Promise.all(t.map(e=>e.continue().catch(lr))))}};function Wh(t){return t.options.scope?.id}var d2=class extends lc{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),gf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&Mo(n.mutationKey)!==Mo(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??G1();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){Cn.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,i),this.#s.onSettled?.(e.data,null,n,r,i)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,i),this.#s.onSettled?.(void 0,e.error,n,r,i))}this.listeners.forEach(n=>{n(this.#t)})})}},h2=class extends lc{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,i=e.queryHash??Jy(r,e);let o=this.get(i);return o||(o=new s2({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Cn.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Kx(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>Kx(t,n)):e}notify(t){Cn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){Cn.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Cn.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},f2=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new h2,this.#t=t.mutationCache||new u2,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=t_.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=yf.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(Sa(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,l=QI(e,o);if(l!==void 0)return this.#e.build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return Cn.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;Cn.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return Cn.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=Cn.batch(()=>this.#e.findAll(t).map(i=>i.cancel(n)));return Promise.all(r).then(lr).catch(lr)}invalidateQueries(t,e={}){return Cn.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=Cn.batch(()=>this.#e.findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let o=i.fetch(void 0,n);return n.throwOnError||(o=o.catch(lr)),i.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(lr)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(Sa(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(lr).catch(lr)}fetchInfiniteQuery(t){return t.behavior=rw(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(lr).catch(lr)}ensureInfiniteQueryData(t){return t.behavior=rw(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return yf.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(Mo(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{Lu(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(Mo(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{Lu(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Jy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===e_&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},W1=A.createContext(void 0),Ut=t=>{const e=A.useContext(W1);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},m2=({client:t,children:e})=>(A.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),u.jsx(W1.Provider,{value:t,children:e})),Q1=A.createContext(!1),p2=()=>A.useContext(Q1);Q1.Provider;function g2(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var y2=A.createContext(g2()),_2=()=>A.useContext(y2),b2=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},v2=t=>{A.useEffect(()=>{t.clearReset()},[t])},x2=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||F1(n,[t.error,r])),w2=t=>{if(t.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...i)=>n(r(...i)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},S2=(t,e)=>t.isLoading&&t.isFetching&&!e,E2=(t,e)=>t?.suspense&&e.isPending,iw=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function C2(t,e,n){const r=p2(),i=_2(),o=Ut(),l=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=r?"isRestoring":"optimistic",w2(l),b2(l,i),v2(i);const d=!o.getQueryCache().get(l.queryHash),[h]=A.useState(()=>new e(o,l)),f=h.getOptimisticResult(l),p=!r&&t.subscribed!==!1;if(A.useSyncExternalStore(A.useCallback(g=>{const b=p?h.subscribe(Cn.batchCalls(g)):lr;return h.updateResult(),b},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),A.useEffect(()=>{h.setOptions(l)},[l,h]),E2(l,f))throw iw(l,h,i);if(x2({result:f,errorResetBoundary:i,throwOnError:l.throwOnError,query:o.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw f.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(l,f),l.experimental_prefetchInRender&&!Do&&S2(f,r)&&(d?iw(l,h,i):o.getQueryCache().get(l.queryHash)?.promise)?.catch(lr).finally(()=>{h.updateResult()}),l.notifyOnChangeProps?f:h.trackResult(f)}function Uo(t,e){return C2(t,i2)}function Gn(t,e){const n=Ut(),[r]=A.useState(()=>new d2(n,t));A.useEffect(()=>{r.setOptions(t)},[r,t]);const i=A.useSyncExternalStore(A.useCallback(l=>r.subscribe(Cn.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=A.useCallback((l,d)=>{r.mutate(l,d).catch(lr)},[r]);if(i.error&&F1(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}const T2={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},K1=A.createContext(T2);function A2({children:t}){const[e,n]=A.useState(new Map),r=A.useCallback((h,f)=>{n(p=>new Map(p).set(h,f))},[]),i=A.useCallback(h=>{n(f=>{const p=new Map(f);return p.delete(h),p})},[]),o=e.size>0,l=e.size>0&&Array.from(e.values()).pop()||"Loading...",d={isLoading:o,loadingMessage:l,addLoadingHold:r,removeLoadingHold:i};return u.jsx(K1.Provider,{value:d,children:t})}function jn(){const t=A.useContext(K1);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const j2=()=>{};var aw={};const Y1=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},R2=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],l=t[n++],d=t[n++],h=((i&7)<<18|(o&63)<<12|(l&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|l&63)}}return e.join("")},X1={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],l=i+1<t.length,d=l?t[i+1]:0,h=i+2<t.length,f=h?t[i+2]:0,p=o>>2,g=(o&3)<<4|d>>4;let b=(d&15)<<2|f>>6,_=f&63;h||(_=64,l||(b=64)),r.push(n[p],n[g],n[b],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Y1(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):R2(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],d=i<t.length?n[t.charAt(i)]:0;++i;const f=i<t.length?n[t.charAt(i)]:64;++i;const g=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||d==null||f==null||g==null)throw new I2;const b=o<<2|d>>4;if(r.push(b),f!==64){const _=d<<4&240|f>>2;if(r.push(_),g!==64){const w=f<<6&192|g;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class I2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const k2=function(t){const e=Y1(t);return X1.encodeByteArray(e,!0)},_f=function(t){return k2(t).replace(/\./g,"")},Z1=function(t){try{return X1.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function D2(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const M2=()=>D2().__FIREBASE_DEFAULTS__,O2=()=>{if(typeof process>"u"||typeof aw>"u")return;const t=aw.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},N2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Z1(t[1]);return e&&JSON.parse(e)},Qf=()=>{try{return j2()||M2()||O2()||N2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},J1=t=>Qf()?.emulatorHosts?.[t],P2=t=>{const e=J1(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},eE=()=>Qf()?.config,tE=t=>Qf()?.[`_${t}`];class B2{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function cc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function nE(t){return(await fetch(t,{credentials:"include"})).ok}function z2(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[_f(JSON.stringify(n)),_f(JSON.stringify(l)),""].join(".")}const Du={};function L2(){const t={prod:[],emulator:[]};for(const e of Object.keys(Du))Du[e]?t.emulator.push(e):t.prod.push(e);return t}function U2(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let ow=!1;function rE(t,e){if(typeof window>"u"||typeof document>"u"||!cc(window.location.host)||Du[t]===e||Du[t]||ow)return;Du[t]=e;function n(b){return`__firebase__banner__${b}`}const r="__firebase__banner",o=L2().prod.length>0;function l(){const b=document.getElementById(r);b&&b.remove()}function d(b){b.style.display="flex",b.style.background="#7faaf0",b.style.position="fixed",b.style.bottom="5px",b.style.left="5px",b.style.padding=".5em",b.style.borderRadius="5px",b.style.alignItems="center"}function h(b,_){b.setAttribute("width","24"),b.setAttribute("id",_),b.setAttribute("height","24"),b.setAttribute("viewBox","0 0 24 24"),b.setAttribute("fill","none"),b.style.marginLeft="-6px"}function f(){const b=document.createElement("span");return b.style.cursor="pointer",b.style.marginLeft="16px",b.style.fontSize="24px",b.innerHTML=" &times;",b.onclick=()=>{ow=!0,l()},b}function p(b,_){b.setAttribute("id",_),b.innerText="Learn more",b.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",b.setAttribute("target","__blank"),b.style.paddingLeft="5px",b.style.textDecoration="underline"}function g(){const b=U2(r),_=n("text"),w=document.getElementById(_)||document.createElement("span"),x=n("learnmore"),S=document.getElementById(x)||document.createElement("a"),C=n("preprendIcon"),T=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(b.created){const R=b.element;d(R),p(S,x);const k=f();h(T,C),R.append(T,w,S,k),document.body.appendChild(R)}o?(w.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function er(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function F2(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(er())}function V2(){const t=Qf()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function $2(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function q2(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function H2(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function G2(){const t=er();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function W2(){return!V2()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Q2(){try{return typeof indexedDB=="object"}catch{return!1}}function K2(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(n){e(n)}})}const Y2="FirebaseError";class Di extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=Y2,Object.setPrototypeOf(this,Di.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,rd.prototype.create)}}class rd{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],l=o?X2(o,r):"Error",d=`${this.serviceName}: ${l} (${i}).`;return new Di(i,d,r)}}function X2(t,e){return t.replace(Z2,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const Z2=/\{\$([^}]+)}/g;function J2(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ci(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],l=e[i];if(lw(o)&&lw(l)){if(!Ci(o,l))return!1}else if(o!==l)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function lw(t){return t!==null&&typeof t=="object"}function sd(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Tu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function Au(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function ek(t,e){const n=new tk(t,e);return n.subscribe.bind(n)}class tk{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");nk(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=Lg),i.error===void 0&&(i.error=Lg),i.complete===void 0&&(i.complete=Lg);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function nk(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Lg(){}function Sn(t){return t&&t._delegate?t._delegate:t}class Oo{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const To="[DEFAULT]";class rk{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new B2;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ik(e))try{this.getOrInitializeService({instanceIdentifier:To})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=To){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=To){return this.instances.has(e)}getOptions(e=To){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);r===d&&l.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:sk(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=To){return this.component?this.component.multipleInstances?e:To:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function sk(t){return t===To?void 0:t}function ik(t){return t.instantiationMode==="EAGER"}class ak{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new rk(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var pt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(pt||(pt={}));const ok={debug:pt.DEBUG,verbose:pt.VERBOSE,info:pt.INFO,warn:pt.WARN,error:pt.ERROR,silent:pt.SILENT},lk=pt.INFO,ck={[pt.DEBUG]:"log",[pt.VERBOSE]:"log",[pt.INFO]:"info",[pt.WARN]:"warn",[pt.ERROR]:"error"},uk=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=ck[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class r_{constructor(e){this.name=e,this._logLevel=lk,this._logHandler=uk,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in pt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ok[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,pt.DEBUG,...e),this._logHandler(this,pt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,pt.VERBOSE,...e),this._logHandler(this,pt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,pt.INFO,...e),this._logHandler(this,pt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,pt.WARN,...e),this._logHandler(this,pt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,pt.ERROR,...e),this._logHandler(this,pt.ERROR,...e)}}const dk=(t,e)=>e.some(n=>t instanceof n);let cw,uw;function hk(){return cw||(cw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fk(){return uw||(uw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const sE=new WeakMap,py=new WeakMap,iE=new WeakMap,Ug=new WeakMap,s_=new WeakMap;function mk(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(Ea(t.result)),i()},l=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&sE.set(n,t)}).catch(()=>{}),s_.set(e,t),e}function pk(t){if(py.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),i()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});py.set(t,e)}let gy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return py.get(t);if(e==="objectStoreNames")return t.objectStoreNames||iE.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ea(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function gk(t){gy=t(gy)}function yk(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Fg(this),e,...n);return iE.set(r,e.sort?e.sort():[e]),Ea(r)}:fk().includes(t)?function(...e){return t.apply(Fg(this),e),Ea(sE.get(this))}:function(...e){return Ea(t.apply(Fg(this),e))}}function _k(t){return typeof t=="function"?yk(t):(t instanceof IDBTransaction&&pk(t),dk(t,hk())?new Proxy(t,gy):t)}function Ea(t){if(t instanceof IDBRequest)return mk(t);if(Ug.has(t))return Ug.get(t);const e=_k(t);return e!==t&&(Ug.set(t,e),s_.set(e,t)),e}const Fg=t=>s_.get(t);function bk(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(t,e),d=Ea(l);return r&&l.addEventListener("upgradeneeded",h=>{r(Ea(l.result),h.oldVersion,h.newVersion,Ea(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),d.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),d}const vk=["get","getKey","getAll","getAllKeys","count"],xk=["put","add","delete","clear"],Vg=new Map;function dw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Vg.get(e))return Vg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=xk.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||vk.includes(n)))return;const o=async function(l,...d){const h=this.transaction(l,i?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(d.shift())),(await Promise.all([f[n](...d),i&&h.done]))[0]};return Vg.set(e,o),o}gk(t=>({...t,get:(e,n,r)=>dw(e,n)||t.get(e,n,r),has:(e,n)=>!!dw(e,n)||t.has(e,n)}));class wk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Sk(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function Sk(t){return t.getComponent()?.type==="VERSION"}const yy="@firebase/app",hw="0.14.6";const Ti=new r_("@firebase/app"),Ek="@firebase/app-compat",Ck="@firebase/analytics-compat",Tk="@firebase/analytics",Ak="@firebase/app-check-compat",jk="@firebase/app-check",Rk="@firebase/auth",Ik="@firebase/auth-compat",kk="@firebase/database",Dk="@firebase/data-connect",Mk="@firebase/database-compat",Ok="@firebase/functions",Nk="@firebase/functions-compat",Pk="@firebase/installations",Bk="@firebase/installations-compat",zk="@firebase/messaging",Lk="@firebase/messaging-compat",Uk="@firebase/performance",Fk="@firebase/performance-compat",Vk="@firebase/remote-config",$k="@firebase/remote-config-compat",qk="@firebase/storage",Hk="@firebase/storage-compat",Gk="@firebase/firestore",Wk="@firebase/ai",Qk="@firebase/firestore-compat",Kk="firebase",Yk="12.6.0";const _y="[DEFAULT]",Xk={[yy]:"fire-core",[Ek]:"fire-core-compat",[Tk]:"fire-analytics",[Ck]:"fire-analytics-compat",[jk]:"fire-app-check",[Ak]:"fire-app-check-compat",[Rk]:"fire-auth",[Ik]:"fire-auth-compat",[kk]:"fire-rtdb",[Dk]:"fire-data-connect",[Mk]:"fire-rtdb-compat",[Ok]:"fire-fn",[Nk]:"fire-fn-compat",[Pk]:"fire-iid",[Bk]:"fire-iid-compat",[zk]:"fire-fcm",[Lk]:"fire-fcm-compat",[Uk]:"fire-perf",[Fk]:"fire-perf-compat",[Vk]:"fire-rc",[$k]:"fire-rc-compat",[qk]:"fire-gcs",[Hk]:"fire-gcs-compat",[Gk]:"fire-fst",[Qk]:"fire-fst-compat",[Wk]:"fire-vertex","fire-js":"fire-js",[Kk]:"fire-js-all"};const bf=new Map,Zk=new Map,by=new Map;function fw(t,e){try{t.container.addComponent(e)}catch(n){Ti.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Ql(t){const e=t.name;if(by.has(e))return Ti.debug(`There were multiple attempts to register component ${e}.`),!1;by.set(e,t);for(const n of bf.values())fw(n,t);for(const n of Zk.values())fw(n,t);return!0}function i_(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function us(t){return t==null?!1:t.settings!==void 0}const Jk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ca=new rd("app","Firebase",Jk);class eD{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Oo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ca.create("app-deleted",{appName:this._name})}}const uc=Yk;function aE(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:_y,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw Ca.create("bad-app-name",{appName:String(i)});if(n||(n=eE()),!n)throw Ca.create("no-options");const o=bf.get(i);if(o){if(Ci(n,o.options)&&Ci(r,o.config))return o;throw Ca.create("duplicate-app",{appName:i})}const l=new ak(i);for(const h of by.values())l.addComponent(h);const d=new eD(n,r,l);return bf.set(i,d),d}function oE(t=_y){const e=bf.get(t);if(!e&&t===_y&&eE())return aE();if(!e)throw Ca.create("no-app",{appName:t});return e}function Ta(t,e,n){let r=Xk[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${e}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ti.warn(l.join(" "));return}Ql(new Oo(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const tD="firebase-heartbeat-database",nD=1,Uu="firebase-heartbeat-store";let $g=null;function lE(){return $g||($g=bk(tD,nD,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Uu)}catch(n){console.warn(n)}}}}).catch(t=>{throw Ca.create("idb-open",{originalErrorMessage:t.message})})),$g}async function rD(t){try{const n=(await lE()).transaction(Uu),r=await n.objectStore(Uu).get(cE(t));return await n.done,r}catch(e){if(e instanceof Di)Ti.warn(e.message);else{const n=Ca.create("idb-get",{originalErrorMessage:e?.message});Ti.warn(n.message)}}}async function mw(t,e){try{const r=(await lE()).transaction(Uu,"readwrite");await r.objectStore(Uu).put(e,cE(t)),await r.done}catch(n){if(n instanceof Di)Ti.warn(n.message);else{const r=Ca.create("idb-set",{originalErrorMessage:n?.message});Ti.warn(r.message)}}}function cE(t){return`${t.name}!${t.options.appId}`}const sD=1024,iD=30;class aD{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new lD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=pw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>iD){const i=cD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ti.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=pw(),{heartbeatsToSend:n,unsentEntries:r}=oD(this._heartbeatsCache.heartbeats),i=_f(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Ti.warn(e),""}}}function pw(){return new Date().toISOString().substring(0,10)}function oD(t,e=sD){const n=[];let r=t.slice();for(const i of t){const o=n.find(l=>l.agent===i.agent);if(o){if(o.dates.push(i.date),gw(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),gw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class lD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Q2()?K2().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await rD(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return mw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return mw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function gw(t){return _f(JSON.stringify({version:2,heartbeats:t})).length}function cD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function uD(t){Ql(new Oo("platform-logger",e=>new wk(e),"PRIVATE")),Ql(new Oo("heartbeat",e=>new aD(e),"PRIVATE")),Ta(yy,hw,t),Ta(yy,hw,"esm2020"),Ta("fire-js","")}uD("");function uE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const dD=uE,dE=new rd("auth","Firebase",uE());const vf=new r_("@firebase/auth");function hD(t,...e){vf.logLevel<=pt.WARN&&vf.warn(`Auth (${uc}): ${t}`,...e)}function sf(t,...e){vf.logLevel<=pt.ERROR&&vf.error(`Auth (${uc}): ${t}`,...e)}function fs(t,...e){throw a_(t,...e)}function Fs(t,...e){return a_(t,...e)}function hE(t,e,n){const r={...dD(),[e]:n};return new rd("auth","Firebase",r).create(e,{appName:t.name})}function Aa(t){return hE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function a_(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return dE.create(t,...e)}function Xe(t,e,...n){if(!t)throw a_(e,...n)}function vi(t){const e="INTERNAL ASSERTION FAILED: "+t;throw sf(e),new Error(e)}function Ai(t,e){t||vi(e)}function vy(){return typeof self<"u"&&self.location?.href||""}function fD(){return yw()==="http:"||yw()==="https:"}function yw(){return typeof self<"u"&&self.location?.protocol||null}function mD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(fD()||q2()||"connection"in navigator)?navigator.onLine:!0}function pD(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class id{constructor(e,n){this.shortDelay=e,this.longDelay=n,Ai(n>e,"Short delay should be less than long delay!"),this.isMobile=F2()||H2()}get(){return mD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function o_(t,e){Ai(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class fE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;vi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;vi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;vi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const gD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const yD=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],_D=new id(3e4,6e4);function Fo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Va(t,e,n,r,i={}){return mE(t,i,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const d=sd({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const f={method:e,headers:h,...o};return $2()||(f.referrerPolicy="no-referrer"),t.emulatorConfig&&cc(t.emulatorConfig.host)&&(f.credentials="include"),fE.fetch()(await pE(t,t.config.apiHost,n,d),f)})}async function mE(t,e,n){t._canInitEmulator=!1;const r={...gD,...e};try{const i=new vD(t),o=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Qh(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const d=o.ok?l.errorMessage:l.error.message,[h,f]=d.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Qh(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Qh(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw Qh(t,"user-disabled",l);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw hE(t,p,f);fs(t,p)}}catch(i){if(i instanceof Di)throw i;fs(t,"network-request-failed",{message:String(i)})}}async function Kf(t,e,n,r,i={}){const o=await Va(t,e,n,r,i);return"mfaPendingCredential"in o&&fs(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function pE(t,e,n,r){const i=`${e}${n}?${r}`,o=t,l=o.config.emulator?o_(t.config,i):`${t.config.apiScheme}://${i}`;return yD.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function bD(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class vD{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Fs(this.auth,"network-request-failed")),_D.get())})}}function Qh(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Fs(t,e,r);return i.customData._tokenResponse=n,i}function _w(t){return t!==void 0&&t.enterprise!==void 0}class xD{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return bD(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function wD(t,e){return Va(t,"GET","/v2/recaptchaConfig",Fo(t,e))}async function SD(t,e){return Va(t,"POST","/v1/accounts:delete",e)}async function xf(t,e){return Va(t,"POST","/v1/accounts:lookup",e)}function Mu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ED(t,e=!1){const n=Sn(t),r=await n.getIdToken(e),i=l_(r);Xe(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,l=o?.sign_in_provider;return{claims:i,token:r,authTime:Mu(qg(i.auth_time)),issuedAtTime:Mu(qg(i.iat)),expirationTime:Mu(qg(i.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function qg(t){return Number(t)*1e3}function l_(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return sf("JWT malformed, contained fewer than 3 sections"),null;try{const i=Z1(n);return i?JSON.parse(i):(sf("Failed to decode base64 JWT payload"),null)}catch(i){return sf("Caught error parsing JWT payload as JSON",i?.toString()),null}}function bw(t){const e=l_(t);return Xe(e,"internal-error"),Xe(typeof e.exp<"u","internal-error"),Xe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Fu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Di&&CD(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function CD({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class TD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class xy{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Mu(this.lastLoginAt),this.creationTime=Mu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function wf(t){const e=t.auth,n=await t.getIdToken(),r=await Fu(t,xf(e,{idToken:n}));Xe(r?.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=i.providerUserInfo?.length?gE(i.providerUserInfo):[],l=jD(t.providerData,o),d=t.isAnonymous,h=!(t.email&&i.passwordHash)&&!l?.length,f=d?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new xy(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(t,p)}async function AD(t){const e=Sn(t);await wf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function jD(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function gE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function RD(t,e){const n=await mE(t,{},async()=>{const r=sd({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=t.config,l=await pE(t,i,"/v1/token",`key=${o}`),d=await t._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:d,body:r};return t.emulatorConfig&&cc(t.emulatorConfig.host)&&(h.credentials="include"),fE.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function ID(t,e){return Va(t,"POST","/v2/accounts:revokeToken",Fo(t,e))}class $l{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Xe(e.idToken,"internal-error"),Xe(typeof e.idToken<"u","internal-error"),Xe(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):bw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Xe(e.length!==0,"internal-error");const n=bw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Xe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:o}=await RD(e,n);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:o}=n,l=new $l;return r&&(Xe(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),i&&(Xe(typeof i=="string","internal-error",{appName:e}),l.accessToken=i),o&&(Xe(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new $l,this.toJSON())}_performRefresh(){return vi("not implemented")}}function fa(t,e){Xe(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class ds{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new TD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new xy(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Fu(this,this.stsTokenManager.getToken(this.auth,e));return Xe(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return ED(this,e)}reload(){return AD(this)}_assign(e){this!==e&&(Xe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new ds({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Xe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await wf(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(us(this.auth.app))return Promise.reject(Aa(this.auth));const e=await this.getIdToken();return await Fu(this,SD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,d=n.tenantId??void 0,h=n._redirectEventId??void 0,f=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:b,isAnonymous:_,providerData:w,stsTokenManager:x}=n;Xe(g&&x,e,"internal-error");const S=$l.fromJSON(this.name,x);Xe(typeof g=="string",e,"internal-error"),fa(r,e.name),fa(i,e.name),Xe(typeof b=="boolean",e,"internal-error"),Xe(typeof _=="boolean",e,"internal-error"),fa(o,e.name),fa(l,e.name),fa(d,e.name),fa(h,e.name),fa(f,e.name),fa(p,e.name);const C=new ds({uid:g,auth:e,email:i,emailVerified:b,displayName:r,isAnonymous:_,photoURL:l,phoneNumber:o,tenantId:d,stsTokenManager:S,createdAt:f,lastLoginAt:p});return w&&Array.isArray(w)&&(C.providerData=w.map(T=>({...T}))),h&&(C._redirectEventId=h),C}static async _fromIdTokenResponse(e,n,r=!1){const i=new $l;i.updateFromServerResponse(n);const o=new ds({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await wf(o),o}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];Xe(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?gE(i.providerUserInfo):[],l=!(i.email&&i.passwordHash)&&!o?.length,d=new $l;d.updateFromIdToken(r);const h=new ds({uid:i.localId,auth:e,stsTokenManager:d,isAnonymous:l}),f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new xy(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,f),h}}const vw=new Map;function xi(t){Ai(t instanceof Function,"Expected a class definition");let e=vw.get(t);return e?(Ai(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,vw.set(t,e),e)}class yE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}yE.type="NONE";const xw=yE;function af(t,e,n){return`firebase:${t}:${e}:${n}`}class ql{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=af(this.userKey,i.apiKey,o),this.fullPersistenceKey=af("persistence",i.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await xf(this.auth,{idToken:e}).catch(()=>{});return n?ds._fromGetAccountInfoResponse(this.auth,n,e):null}return ds._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new ql(xi(xw),e,r);const i=(await Promise.all(n.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let o=i[0]||xi(xw);const l=af(r,e.config.apiKey,e.name);let d=null;for(const f of n)try{const p=await f._get(l);if(p){let g;if(typeof p=="string"){const b=await xf(e,{idToken:p}).catch(()=>{});if(!b)break;g=await ds._fromGetAccountInfoResponse(e,b,p)}else g=ds._fromJSON(e,p);f!==o&&(d=g),o=f;break}}catch{}const h=i.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new ql(o,e,r):(o=h[0],d&&await o._set(l,d.toJSON()),await Promise.all(n.map(async f=>{if(f!==o)try{await f._remove(l)}catch{}})),new ql(o,e,r))}}function ww(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(xE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(_E(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(SE(e))return"Blackberry";if(EE(e))return"Webos";if(bE(e))return"Safari";if((e.includes("chrome/")||vE(e))&&!e.includes("edge/"))return"Chrome";if(wE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function _E(t=er()){return/firefox\//i.test(t)}function bE(t=er()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function vE(t=er()){return/crios\//i.test(t)}function xE(t=er()){return/iemobile/i.test(t)}function wE(t=er()){return/android/i.test(t)}function SE(t=er()){return/blackberry/i.test(t)}function EE(t=er()){return/webos/i.test(t)}function c_(t=er()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function kD(t=er()){return c_(t)&&!!window.navigator?.standalone}function DD(){return G2()&&document.documentMode===10}function CE(t=er()){return c_(t)||wE(t)||EE(t)||SE(t)||/windows phone/i.test(t)||xE(t)}function TE(t,e=[]){let n;switch(t){case"Browser":n=ww(er());break;case"Worker":n=`${ww(er())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${uc}/${r}`}class MD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,d)=>{try{const h=e(o);l(h)}catch(h){d(h)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function OD(t,e={}){return Va(t,"GET","/v2/passwordPolicy",Fo(t,e))}const ND=6;class PD{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??ND,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class BD{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Sw(this),this.idTokenSubscription=new Sw(this),this.beforeStateQueue=new MD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=xi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await ql.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await xf(this,{idToken:e}),r=await ds._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(us(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===l)&&d?.user&&(r=d.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Xe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await wf(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=pD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(us(this.app))return Promise.reject(Aa(this));const n=e?Sn(e):null;return n&&Xe(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Xe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return us(this.app)?Promise.reject(Aa(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return us(this.app)?Promise.reject(Aa(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(xi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await OD(this),n=new PD(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new rd("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await ID(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&xi(e)||this._popupRedirectResolver;Xe(n,this,"argument-error"),this.redirectPersistenceManager=await ql.create(this,[xi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(Xe(d,this,"internal-error"),d.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,i);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Xe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=TE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(us(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&hD(`Error while retrieving App Check token: ${e.error}`),e?.token}}function dc(t){return Sn(t)}class Sw{constructor(e){this.auth=e,this.observer=null,this.addObserver=ek(n=>this.observer=n)}get next(){return Xe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Yf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function zD(t){Yf=t}function AE(t){return Yf.loadJS(t)}function LD(){return Yf.recaptchaEnterpriseScript}function UD(){return Yf.gapiScript}function FD(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class VD{constructor(){this.enterprise=new $D}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class $D{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const qD="recaptcha-enterprise",jE="NO_RECAPTCHA";class HD{constructor(e){this.type=qD,this.auth=dc(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,d)=>{wD(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)d(new Error("recaptcha Enterprise site key undefined"));else{const f=new xD(h);return o.tenantId==null?o._agentRecaptchaConfig=f:o._tenantRecaptchaConfigs[o.tenantId]=f,l(f.siteKey)}}).catch(h=>{d(h)})})}function i(o,l,d){const h=window.grecaptcha;_w(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(f=>{l(f)}).catch(()=>{l(jE)})}):d(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new VD().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(d=>{if(!n&&_w(window.grecaptcha))i(d,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=LD();h.length!==0&&(h+=d),AE(h).then(()=>{i(d,o,l)}).catch(f=>{l(f)})}}).catch(d=>{l(d)})})}}async function Ew(t,e,n,r=!1,i=!1){const o=new HD(t);let l;if(i)l=jE;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const d={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in d){const h=d.phoneEnrollmentInfo.phoneNumber,f=d.phoneEnrollmentInfo.recaptchaToken;Object.assign(d,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:f,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in d){const h=d.phoneSignInInfo.recaptchaToken;Object.assign(d,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return d}return r?Object.assign(d,{captchaResp:l}):Object.assign(d,{captchaResponse:l}),Object.assign(d,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(d,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),d}async function Cw(t,e,n,r,i){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Ew(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Ew(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function GD(t,e){const n=i_(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),o=n.getOptions();if(Ci(o,e??{}))return i;fs(i,"already-initialized")}return n.initialize({options:e})}function WD(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(xi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function QD(t,e,n){const r=dc(t);Xe(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=RE(e),{host:l,port:d}=KD(e),h=d===null?"":`:${d}`,f={url:`${o}//${l}${h}/`},p=Object.freeze({host:l,port:d,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Xe(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Xe(Ci(f,r.config.emulator)&&Ci(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=f,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,cc(l)?(nE(`${o}//${l}${h}`),rE("Auth",!0)):YD()}function RE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function KD(t){const e=RE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:Tw(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:Tw(l)}}}function Tw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function YD(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class u_{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return vi("not implemented")}_getIdTokenResponse(e){return vi("not implemented")}_linkToIdToken(e,n){return vi("not implemented")}_getReauthenticationResolver(e){return vi("not implemented")}}async function XD(t,e){return Va(t,"POST","/v1/accounts:signUp",e)}async function ZD(t,e){return Kf(t,"POST","/v1/accounts:signInWithPassword",Fo(t,e))}async function JD(t,e){return Kf(t,"POST","/v1/accounts:signInWithEmailLink",Fo(t,e))}async function e5(t,e){return Kf(t,"POST","/v1/accounts:signInWithEmailLink",Fo(t,e))}class Vu extends u_{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Vu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Vu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Cw(e,n,"signInWithPassword",ZD);case"emailLink":return JD(e,{email:this._email,oobCode:this._password});default:fs(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Cw(e,r,"signUpPassword",XD);case"emailLink":return e5(e,{idToken:n,email:this._email,oobCode:this._password});default:fs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Hl(t,e){return Kf(t,"POST","/v1/accounts:signInWithIdp",Fo(t,e))}const t5="http://localhost";class No extends u_{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new No(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):fs("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...o}=n;if(!r||!i)return null;const l=new No(r,i);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return Hl(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Hl(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Hl(e,n)}buildRequest(){const e={requestUri:t5,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=sd(n)}return e}}function n5(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function r5(t){const e=Tu(Au(t)).link,n=e?Tu(Au(e)).deep_link_id:null,r=Tu(Au(t)).deep_link_id;return(r?Tu(Au(r)).link:null)||r||n||e||t}class d_{constructor(e){const n=Tu(Au(e)),r=n.apiKey??null,i=n.oobCode??null,o=n5(n.mode??null);Xe(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=r5(e);try{return new d_(n)}catch{return null}}}class hc{constructor(){this.providerId=hc.PROVIDER_ID}static credential(e,n){return Vu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=d_.parseLink(n);return Xe(r,"argument-error"),Vu._fromEmailAndCode(e,r.code,r.tenantId)}}hc.PROVIDER_ID="password";hc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";hc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class IE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ad extends IE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class pa extends ad{constructor(){super("facebook.com")}static credential(e){return No._fromParams({providerId:pa.PROVIDER_ID,signInMethod:pa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pa.credentialFromTaggedObject(e)}static credentialFromError(e){return pa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return pa.credential(e.oauthAccessToken)}catch{return null}}}pa.FACEBOOK_SIGN_IN_METHOD="facebook.com";pa.PROVIDER_ID="facebook.com";class ga extends ad{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return No._fromParams({providerId:ga.PROVIDER_ID,signInMethod:ga.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return ga.credentialFromTaggedObject(e)}static credentialFromError(e){return ga.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return ga.credential(n,r)}catch{return null}}}ga.GOOGLE_SIGN_IN_METHOD="google.com";ga.PROVIDER_ID="google.com";class ya extends ad{constructor(){super("github.com")}static credential(e){return No._fromParams({providerId:ya.PROVIDER_ID,signInMethod:ya.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ya.credentialFromTaggedObject(e)}static credentialFromError(e){return ya.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ya.credential(e.oauthAccessToken)}catch{return null}}}ya.GITHUB_SIGN_IN_METHOD="github.com";ya.PROVIDER_ID="github.com";class _a extends ad{constructor(){super("twitter.com")}static credential(e,n){return No._fromParams({providerId:_a.PROVIDER_ID,signInMethod:_a.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return _a.credentialFromTaggedObject(e)}static credentialFromError(e){return _a.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return _a.credential(n,r)}catch{return null}}}_a.TWITTER_SIGN_IN_METHOD="twitter.com";_a.PROVIDER_ID="twitter.com";class Kl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const o=await ds._fromIdTokenResponse(e,r,i),l=Aw(r);return new Kl({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=Aw(r);return new Kl({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function Aw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class Sf extends Di{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,Sf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new Sf(e,n,r,i)}}function kE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?Sf._fromErrorAndOperation(t,o,e,r):o})}async function s5(t,e,n=!1){const r=await Fu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Kl._forOperation(t,"link",r)}async function i5(t,e,n=!1){const{auth:r}=t;if(us(r.app))return Promise.reject(Aa(r));const i="reauthenticate";try{const o=await Fu(t,kE(r,i,e,t),n);Xe(o.idToken,r,"internal-error");const l=l_(o.idToken);Xe(l,r,"internal-error");const{sub:d}=l;return Xe(t.uid===d,r,"user-mismatch"),Kl._forOperation(t,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&fs(r,"user-mismatch"),o}}async function DE(t,e,n=!1){if(us(t.app))return Promise.reject(Aa(t));const r="signIn",i=await kE(t,r,e),o=await Kl._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(o.user),o}async function a5(t,e){return DE(dc(t),e)}async function o5(t){const e=dc(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function l5(t,e,n){return us(t.app)?Promise.reject(Aa(t)):a5(Sn(t),hc.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&o5(t),r})}function c5(t,e,n,r){return Sn(t).onIdTokenChanged(e,n,r)}function u5(t,e,n){return Sn(t).beforeAuthStateChanged(e,n)}function d5(t,e,n,r){return Sn(t).onAuthStateChanged(e,n,r)}function h5(t){return Sn(t).signOut()}const Ef="__sak";class ME{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Ef,"1"),this.storage.removeItem(Ef),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const f5=1e3,m5=10;class OE extends ME{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=CE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,d,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);DD()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,m5):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},f5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}OE.type="LOCAL";const p5=OE;class NE extends ME{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}NE.type="SESSION";const PE=NE;function g5(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class Xf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new Xf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:o}=n.data,l=this.handlersMap[i];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const d=Array.from(l).map(async f=>f(n.origin,o)),h=await g5(d);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Xf.receivers=[];function h_(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class y5{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,l;return new Promise((d,h)=>{const f=h_("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:i,onMessage(g){const b=g;if(b.data.eventId===f)switch(b.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),d(b.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),i.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:f,data:n},[i.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Vs(){return window}function _5(t){Vs().location.href=t}function BE(){return typeof Vs().WorkerGlobalScope<"u"&&typeof Vs().importScripts=="function"}async function b5(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function v5(){return navigator?.serviceWorker?.controller||null}function x5(){return BE()?self:null}const zE="firebaseLocalStorageDb",w5=1,Cf="firebaseLocalStorage",LE="fbase_key";class od{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Zf(t,e){return t.transaction([Cf],e?"readwrite":"readonly").objectStore(Cf)}function S5(){const t=indexedDB.deleteDatabase(zE);return new od(t).toPromise()}function wy(){const t=indexedDB.open(zE,w5);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Cf,{keyPath:LE})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Cf)?e(r):(r.close(),await S5(),e(await wy()))})})}async function jw(t,e,n){const r=Zf(t,!0).put({[LE]:e,value:n});return new od(r).toPromise()}async function E5(t,e){const n=Zf(t,!1).get(e),r=await new od(n).toPromise();return r===void 0?null:r.value}function Rw(t,e){const n=Zf(t,!0).delete(e);return new od(n).toPromise()}const C5=800,T5=3;class UE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await wy(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>T5)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return BE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Xf._getInstance(x5()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await b5(),!this.activeServiceWorker)return;this.sender=new y5(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||v5()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await wy();return await jw(e,Ef,"1"),await Rw(e,Ef),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>jw(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>E5(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Rw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=Zf(i,!1).getAll();return new od(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),C5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}UE.type="LOCAL";const A5=UE;new id(3e4,6e4);function j5(t,e){return e?xi(e):(Xe(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class f_ extends u_{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Hl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Hl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Hl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function R5(t){return DE(t.auth,new f_(t),t.bypassAuthState)}function I5(t){const{auth:e,user:n}=t;return Xe(n,e,"internal-error"),i5(n,new f_(t),t.bypassAuthState)}async function k5(t){const{auth:e,user:n}=t;return Xe(n,e,"internal-error"),s5(n,new f_(t),t.bypassAuthState)}class FE{constructor(e,n,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:o,error:l,type:d}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return R5;case"linkViaPopup":case"linkViaRedirect":return k5;case"reauthViaPopup":case"reauthViaRedirect":return I5;default:fs(this.auth,"internal-error")}}resolve(e){Ai(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ai(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const D5=new id(2e3,1e4);class Vl extends FE{constructor(e,n,r,i,o){super(e,n,i,o),this.provider=r,this.authWindow=null,this.pollId=null,Vl.currentPopupAction&&Vl.currentPopupAction.cancel(),Vl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Xe(e,this.auth,"internal-error"),e}async onExecution(){Ai(this.filter.length===1,"Popup operations only handle one event");const e=h_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Fs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Fs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Vl.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Fs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,D5.get())};e()}}Vl.currentPopupAction=null;const M5="pendingRedirect",of=new Map;class O5 extends FE{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=of.get(this.auth._key());if(!e){try{const r=await N5(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}of.set(this.auth._key(),e)}return this.bypassAuthState||of.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function N5(t,e){const n=z5(e),r=B5(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function P5(t,e){of.set(t._key(),e)}function B5(t){return xi(t._redirectPersistence)}function z5(t){return af(M5,t.config.apiKey,t.name)}async function L5(t,e,n=!1){if(us(t.app))return Promise.reject(Aa(t));const r=dc(t),i=j5(r,e),l=await new O5(r,i,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const U5=600*1e3;class F5{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!V5(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!VE(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Fs(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=U5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Iw(e))}saveEventToCache(e){this.cachedEventUids.add(Iw(e)),this.lastProcessedEventTime=Date.now()}}function Iw(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function VE({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function V5(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return VE(t);default:return!1}}async function $5(t,e={}){return Va(t,"GET","/v1/projects",e)}const q5=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,H5=/^https?/;async function G5(t){if(t.config.emulator)return;const{authorizedDomains:e}=await $5(t);for(const n of e)try{if(W5(n))return}catch{}fs(t,"unauthorized-domain")}function W5(t){const e=vy(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!H5.test(n))return!1;if(q5.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Q5=new id(3e4,6e4);function kw(){const t=Vs().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function K5(t){return new Promise((e,n)=>{function r(){kw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{kw(),n(Fs(t,"network-request-failed"))},timeout:Q5.get()})}if(Vs().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Vs().gapi?.load)r();else{const i=FD("iframefcb");return Vs()[i]=()=>{gapi.load?r():n(Fs(t,"network-request-failed"))},AE(`${UD()}?onload=${i}`).catch(o=>n(o))}}).catch(e=>{throw lf=null,e})}let lf=null;function Y5(t){return lf=lf||K5(t),lf}const X5=new id(5e3,15e3),Z5="__/auth/iframe",J5="emulator/auth/iframe",eM={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},tM=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function nM(t){const e=t.config;Xe(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?o_(e,J5):`https://${t.config.authDomain}/${Z5}`,r={apiKey:e.apiKey,appName:t.name,v:uc},i=tM.get(t.config.apiHost);i&&(r.eid=i);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${sd(r).slice(1)}`}async function rM(t){const e=await Y5(t),n=Vs().gapi;return Xe(n,t,"internal-error"),e.open({where:document.body,url:nM(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:eM,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const l=Fs(t,"network-request-failed"),d=Vs().setTimeout(()=>{o(l)},X5.get());function h(){Vs().clearTimeout(d),i(r)}r.ping(h).then(h,()=>{o(l)})}))}const sM={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},iM=500,aM=600,oM="_blank",lM="http://localhost";class Dw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function cM(t,e,n,r=iM,i=aM){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const h={...sM,width:r.toString(),height:i.toString(),top:o,left:l},f=er().toLowerCase();n&&(d=vE(f)?oM:n),_E(f)&&(e=e||lM,h.scrollbars="yes");const p=Object.entries(h).reduce((b,[_,w])=>`${b}${_}=${w},`,"");if(kD(f)&&d!=="_self")return uM(e||"",d),new Dw(null);const g=window.open(e||"",d,p);Xe(g,t,"popup-blocked");try{g.focus()}catch{}return new Dw(g)}function uM(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const dM="__/auth/handler",hM="emulator/auth/handler",fM=encodeURIComponent("fac");async function Mw(t,e,n,r,i,o){Xe(t.config.authDomain,t,"auth-domain-config-required"),Xe(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:uc,eventId:i};if(e instanceof IE){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",J2(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))l[p]=g}if(e instanceof ad){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(l.scopes=p.join(","))}t.tenantId&&(l.tid=t.tenantId);const d=l;for(const p of Object.keys(d))d[p]===void 0&&delete d[p];const h=await t._getAppCheckToken(),f=h?`#${fM}=${encodeURIComponent(h)}`:"";return`${mM(t)}?${sd(d).slice(1)}${f}`}function mM({config:t}){return t.emulator?o_(t,hM):`https://${t.authDomain}/${dM}`}const Hg="webStorageSupport";class pM{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=PE,this._completeRedirectFn=L5,this._overrideRedirectResult=P5}async _openPopup(e,n,r,i){Ai(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Mw(e,n,r,vy(),i);return cM(e,o,h_())}async _openRedirect(e,n,r,i){await this._originValidation(e);const o=await Mw(e,n,r,vy(),i);return _5(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:o}=this.eventManagers[n];return i?Promise.resolve(i):(Ai(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await rM(e),r=new F5(e);return n.register("authEvent",i=>(Xe(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Hg,{type:Hg},i=>{const o=i?.[0]?.[Hg];o!==void 0&&n(!!o),fs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=G5(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return CE()||bE()||c_()}}const gM=pM;var Ow="@firebase/auth",Nw="1.12.0";class yM{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Xe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function _M(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function bM(t){Ql(new Oo("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:d}=r.options;Xe(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:d,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:TE(t)},f=new BD(r,i,o,h);return WD(f,n),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Ql(new Oo("auth-internal",e=>{const n=dc(e.getProvider("auth").getImmediate());return(r=>new yM(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ta(Ow,Nw,_M(t)),Ta(Ow,Nw,"esm2020")}const vM=300,xM=tE("authIdTokenMaxAge")||vM;let Pw=null;const wM=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>xM)return;const i=n?.token;Pw!==i&&(Pw=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function SM(t=oE()){const e=i_(t,"auth");if(e.isInitialized())return e.getImmediate();const n=GD(t,{popupRedirectResolver:gM,persistence:[A5,p5,PE]}),r=tE("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=wM(o.toString());u5(n,l,()=>l(n.currentUser)),c5(n,d=>l(d))}}const i=J1("auth");return i&&QD(n,`http://${i}`),n}function EM(){return document.getElementsByTagName("head")?.[0]??document}zD({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const o=Fs("internal-error");o.customData=i,n(o)},r.type="text/javascript",r.charset="UTF-8",EM().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});bM("Browser");var CM="firebase",TM="12.7.0";Ta(CM,TM,"app");const AM={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},$E=aE(AM);function Mi(){const t=SM($E);async function e(){return!1}async function n(h,f){return l5(t,h,f)}function r(){return h5(t)}function i(h){d5(t,f=>{h(f)})}function o(){return t.currentUser}function l(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:i,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:l}}const Yr=300*1e3,jM=1800*1e3,Pe=new f2({defaultOptions:{queries:{staleTime:Yr,gcTime:jM,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Pe.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const Ee={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};function RM({children:t}){return u.jsx(m2,{client:Pe,children:t})}var Bw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ja,qE;(function(){var t;function e(D,O){function N(){}N.prototype=O.prototype,D.F=O.prototype,D.prototype=new N,D.prototype.constructor=D,D.D=function(U,q,I){for(var z=Array(arguments.length-2),M=2;M<arguments.length;M++)z[M-2]=arguments[M];return O.prototype[q].apply(U,z)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(D,O,N){N||(N=0);const U=Array(16);if(typeof O=="string")for(var q=0;q<16;++q)U[q]=O.charCodeAt(N++)|O.charCodeAt(N++)<<8|O.charCodeAt(N++)<<16|O.charCodeAt(N++)<<24;else for(q=0;q<16;++q)U[q]=O[N++]|O[N++]<<8|O[N++]<<16|O[N++]<<24;O=D.g[0],N=D.g[1],q=D.g[2];let I=D.g[3],z;z=O+(I^N&(q^I))+U[0]+3614090360&4294967295,O=N+(z<<7&4294967295|z>>>25),z=I+(q^O&(N^q))+U[1]+3905402710&4294967295,I=O+(z<<12&4294967295|z>>>20),z=q+(N^I&(O^N))+U[2]+606105819&4294967295,q=I+(z<<17&4294967295|z>>>15),z=N+(O^q&(I^O))+U[3]+3250441966&4294967295,N=q+(z<<22&4294967295|z>>>10),z=O+(I^N&(q^I))+U[4]+4118548399&4294967295,O=N+(z<<7&4294967295|z>>>25),z=I+(q^O&(N^q))+U[5]+1200080426&4294967295,I=O+(z<<12&4294967295|z>>>20),z=q+(N^I&(O^N))+U[6]+2821735955&4294967295,q=I+(z<<17&4294967295|z>>>15),z=N+(O^q&(I^O))+U[7]+4249261313&4294967295,N=q+(z<<22&4294967295|z>>>10),z=O+(I^N&(q^I))+U[8]+1770035416&4294967295,O=N+(z<<7&4294967295|z>>>25),z=I+(q^O&(N^q))+U[9]+2336552879&4294967295,I=O+(z<<12&4294967295|z>>>20),z=q+(N^I&(O^N))+U[10]+4294925233&4294967295,q=I+(z<<17&4294967295|z>>>15),z=N+(O^q&(I^O))+U[11]+2304563134&4294967295,N=q+(z<<22&4294967295|z>>>10),z=O+(I^N&(q^I))+U[12]+1804603682&4294967295,O=N+(z<<7&4294967295|z>>>25),z=I+(q^O&(N^q))+U[13]+4254626195&4294967295,I=O+(z<<12&4294967295|z>>>20),z=q+(N^I&(O^N))+U[14]+2792965006&4294967295,q=I+(z<<17&4294967295|z>>>15),z=N+(O^q&(I^O))+U[15]+1236535329&4294967295,N=q+(z<<22&4294967295|z>>>10),z=O+(q^I&(N^q))+U[1]+4129170786&4294967295,O=N+(z<<5&4294967295|z>>>27),z=I+(N^q&(O^N))+U[6]+3225465664&4294967295,I=O+(z<<9&4294967295|z>>>23),z=q+(O^N&(I^O))+U[11]+643717713&4294967295,q=I+(z<<14&4294967295|z>>>18),z=N+(I^O&(q^I))+U[0]+3921069994&4294967295,N=q+(z<<20&4294967295|z>>>12),z=O+(q^I&(N^q))+U[5]+3593408605&4294967295,O=N+(z<<5&4294967295|z>>>27),z=I+(N^q&(O^N))+U[10]+38016083&4294967295,I=O+(z<<9&4294967295|z>>>23),z=q+(O^N&(I^O))+U[15]+3634488961&4294967295,q=I+(z<<14&4294967295|z>>>18),z=N+(I^O&(q^I))+U[4]+3889429448&4294967295,N=q+(z<<20&4294967295|z>>>12),z=O+(q^I&(N^q))+U[9]+568446438&4294967295,O=N+(z<<5&4294967295|z>>>27),z=I+(N^q&(O^N))+U[14]+3275163606&4294967295,I=O+(z<<9&4294967295|z>>>23),z=q+(O^N&(I^O))+U[3]+4107603335&4294967295,q=I+(z<<14&4294967295|z>>>18),z=N+(I^O&(q^I))+U[8]+1163531501&4294967295,N=q+(z<<20&4294967295|z>>>12),z=O+(q^I&(N^q))+U[13]+2850285829&4294967295,O=N+(z<<5&4294967295|z>>>27),z=I+(N^q&(O^N))+U[2]+4243563512&4294967295,I=O+(z<<9&4294967295|z>>>23),z=q+(O^N&(I^O))+U[7]+1735328473&4294967295,q=I+(z<<14&4294967295|z>>>18),z=N+(I^O&(q^I))+U[12]+2368359562&4294967295,N=q+(z<<20&4294967295|z>>>12),z=O+(N^q^I)+U[5]+4294588738&4294967295,O=N+(z<<4&4294967295|z>>>28),z=I+(O^N^q)+U[8]+2272392833&4294967295,I=O+(z<<11&4294967295|z>>>21),z=q+(I^O^N)+U[11]+1839030562&4294967295,q=I+(z<<16&4294967295|z>>>16),z=N+(q^I^O)+U[14]+4259657740&4294967295,N=q+(z<<23&4294967295|z>>>9),z=O+(N^q^I)+U[1]+2763975236&4294967295,O=N+(z<<4&4294967295|z>>>28),z=I+(O^N^q)+U[4]+1272893353&4294967295,I=O+(z<<11&4294967295|z>>>21),z=q+(I^O^N)+U[7]+4139469664&4294967295,q=I+(z<<16&4294967295|z>>>16),z=N+(q^I^O)+U[10]+3200236656&4294967295,N=q+(z<<23&4294967295|z>>>9),z=O+(N^q^I)+U[13]+681279174&4294967295,O=N+(z<<4&4294967295|z>>>28),z=I+(O^N^q)+U[0]+3936430074&4294967295,I=O+(z<<11&4294967295|z>>>21),z=q+(I^O^N)+U[3]+3572445317&4294967295,q=I+(z<<16&4294967295|z>>>16),z=N+(q^I^O)+U[6]+76029189&4294967295,N=q+(z<<23&4294967295|z>>>9),z=O+(N^q^I)+U[9]+3654602809&4294967295,O=N+(z<<4&4294967295|z>>>28),z=I+(O^N^q)+U[12]+3873151461&4294967295,I=O+(z<<11&4294967295|z>>>21),z=q+(I^O^N)+U[15]+530742520&4294967295,q=I+(z<<16&4294967295|z>>>16),z=N+(q^I^O)+U[2]+3299628645&4294967295,N=q+(z<<23&4294967295|z>>>9),z=O+(q^(N|~I))+U[0]+4096336452&4294967295,O=N+(z<<6&4294967295|z>>>26),z=I+(N^(O|~q))+U[7]+1126891415&4294967295,I=O+(z<<10&4294967295|z>>>22),z=q+(O^(I|~N))+U[14]+2878612391&4294967295,q=I+(z<<15&4294967295|z>>>17),z=N+(I^(q|~O))+U[5]+4237533241&4294967295,N=q+(z<<21&4294967295|z>>>11),z=O+(q^(N|~I))+U[12]+1700485571&4294967295,O=N+(z<<6&4294967295|z>>>26),z=I+(N^(O|~q))+U[3]+2399980690&4294967295,I=O+(z<<10&4294967295|z>>>22),z=q+(O^(I|~N))+U[10]+4293915773&4294967295,q=I+(z<<15&4294967295|z>>>17),z=N+(I^(q|~O))+U[1]+2240044497&4294967295,N=q+(z<<21&4294967295|z>>>11),z=O+(q^(N|~I))+U[8]+1873313359&4294967295,O=N+(z<<6&4294967295|z>>>26),z=I+(N^(O|~q))+U[15]+4264355552&4294967295,I=O+(z<<10&4294967295|z>>>22),z=q+(O^(I|~N))+U[6]+2734768916&4294967295,q=I+(z<<15&4294967295|z>>>17),z=N+(I^(q|~O))+U[13]+1309151649&4294967295,N=q+(z<<21&4294967295|z>>>11),z=O+(q^(N|~I))+U[4]+4149444226&4294967295,O=N+(z<<6&4294967295|z>>>26),z=I+(N^(O|~q))+U[11]+3174756917&4294967295,I=O+(z<<10&4294967295|z>>>22),z=q+(O^(I|~N))+U[2]+718787259&4294967295,q=I+(z<<15&4294967295|z>>>17),z=N+(I^(q|~O))+U[9]+3951481745&4294967295,D.g[0]=D.g[0]+O&4294967295,D.g[1]=D.g[1]+(q+(z<<21&4294967295|z>>>11))&4294967295,D.g[2]=D.g[2]+q&4294967295,D.g[3]=D.g[3]+I&4294967295}r.prototype.v=function(D,O){O===void 0&&(O=D.length);const N=O-this.blockSize,U=this.C;let q=this.h,I=0;for(;I<O;){if(q==0)for(;I<=N;)i(this,D,I),I+=this.blockSize;if(typeof D=="string"){for(;I<O;)if(U[q++]=D.charCodeAt(I++),q==this.blockSize){i(this,U),q=0;break}}else for(;I<O;)if(U[q++]=D[I++],q==this.blockSize){i(this,U),q=0;break}}this.h=q,this.o+=O},r.prototype.A=function(){var D=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);D[0]=128;for(var O=1;O<D.length-8;++O)D[O]=0;O=this.o*8;for(var N=D.length-8;N<D.length;++N)D[N]=O&255,O/=256;for(this.v(D),D=Array(16),O=0,N=0;N<4;++N)for(let U=0;U<32;U+=8)D[O++]=this.g[N]>>>U&255;return D};function o(D,O){var N=d;return Object.prototype.hasOwnProperty.call(N,D)?N[D]:N[D]=O(D)}function l(D,O){this.h=O;const N=[];let U=!0;for(let q=D.length-1;q>=0;q--){const I=D[q]|0;U&&I==O||(N[q]=I,U=!1)}this.g=N}var d={};function h(D){return-128<=D&&D<128?o(D,function(O){return new l([O|0],O<0?-1:0)}):new l([D|0],D<0?-1:0)}function f(D){if(isNaN(D)||!isFinite(D))return g;if(D<0)return S(f(-D));const O=[];let N=1;for(let U=0;D>=N;U++)O[U]=D/N|0,N*=4294967296;return new l(O,0)}function p(D,O){if(D.length==0)throw Error("number format error: empty string");if(O=O||10,O<2||36<O)throw Error("radix out of range: "+O);if(D.charAt(0)=="-")return S(p(D.substring(1),O));if(D.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=f(Math.pow(O,8));let U=g;for(let I=0;I<D.length;I+=8){var q=Math.min(8,D.length-I);const z=parseInt(D.substring(I,I+q),O);q<8?(q=f(Math.pow(O,q)),U=U.j(q).add(f(z))):(U=U.j(N),U=U.add(f(z)))}return U}var g=h(0),b=h(1),_=h(16777216);t=l.prototype,t.m=function(){if(x(this))return-S(this).m();let D=0,O=1;for(let N=0;N<this.g.length;N++){const U=this.i(N);D+=(U>=0?U:4294967296+U)*O,O*=4294967296}return D},t.toString=function(D){if(D=D||10,D<2||36<D)throw Error("radix out of range: "+D);if(w(this))return"0";if(x(this))return"-"+S(this).toString(D);const O=f(Math.pow(D,6));var N=this;let U="";for(;;){const q=k(N,O).g;N=C(N,q.j(O));let I=((N.g.length>0?N.g[0]:N.h)>>>0).toString(D);if(N=q,w(N))return I+U;for(;I.length<6;)I="0"+I;U=I+U}},t.i=function(D){return D<0?0:D<this.g.length?this.g[D]:this.h};function w(D){if(D.h!=0)return!1;for(let O=0;O<D.g.length;O++)if(D.g[O]!=0)return!1;return!0}function x(D){return D.h==-1}t.l=function(D){return D=C(this,D),x(D)?-1:w(D)?0:1};function S(D){const O=D.g.length,N=[];for(let U=0;U<O;U++)N[U]=~D.g[U];return new l(N,~D.h).add(b)}t.abs=function(){return x(this)?S(this):this},t.add=function(D){const O=Math.max(this.g.length,D.g.length),N=[];let U=0;for(let q=0;q<=O;q++){let I=U+(this.i(q)&65535)+(D.i(q)&65535),z=(I>>>16)+(this.i(q)>>>16)+(D.i(q)>>>16);U=z>>>16,I&=65535,z&=65535,N[q]=z<<16|I}return new l(N,N[N.length-1]&-2147483648?-1:0)};function C(D,O){return D.add(S(O))}t.j=function(D){if(w(this)||w(D))return g;if(x(this))return x(D)?S(this).j(S(D)):S(S(this).j(D));if(x(D))return S(this.j(S(D)));if(this.l(_)<0&&D.l(_)<0)return f(this.m()*D.m());const O=this.g.length+D.g.length,N=[];for(var U=0;U<2*O;U++)N[U]=0;for(U=0;U<this.g.length;U++)for(let q=0;q<D.g.length;q++){const I=this.i(U)>>>16,z=this.i(U)&65535,M=D.i(q)>>>16,X=D.i(q)&65535;N[2*U+2*q]+=z*X,T(N,2*U+2*q),N[2*U+2*q+1]+=I*X,T(N,2*U+2*q+1),N[2*U+2*q+1]+=z*M,T(N,2*U+2*q+1),N[2*U+2*q+2]+=I*M,T(N,2*U+2*q+2)}for(D=0;D<O;D++)N[D]=N[2*D+1]<<16|N[2*D];for(D=O;D<2*O;D++)N[D]=0;return new l(N,0)};function T(D,O){for(;(D[O]&65535)!=D[O];)D[O+1]+=D[O]>>>16,D[O]&=65535,O++}function R(D,O){this.g=D,this.h=O}function k(D,O){if(w(O))throw Error("division by zero");if(w(D))return new R(g,g);if(x(D))return O=k(S(D),O),new R(S(O.g),S(O.h));if(x(O))return O=k(D,S(O)),new R(S(O.g),O.h);if(D.g.length>30){if(x(D)||x(O))throw Error("slowDivide_ only works with positive integers.");for(var N=b,U=O;U.l(D)<=0;)N=V(N),U=V(U);var q=$(N,1),I=$(U,1);for(U=$(U,2),N=$(N,2);!w(U);){var z=I.add(U);z.l(D)<=0&&(q=q.add(N),I=z),U=$(U,1),N=$(N,1)}return O=C(D,q.j(O)),new R(q,O)}for(q=g;D.l(O)>=0;){for(N=Math.max(1,Math.floor(D.m()/O.m())),U=Math.ceil(Math.log(N)/Math.LN2),U=U<=48?1:Math.pow(2,U-48),I=f(N),z=I.j(O);x(z)||z.l(D)>0;)N-=U,I=f(N),z=I.j(O);w(I)&&(I=b),q=q.add(I),D=C(D,z)}return new R(q,D)}t.B=function(D){return k(this,D).h},t.and=function(D){const O=Math.max(this.g.length,D.g.length),N=[];for(let U=0;U<O;U++)N[U]=this.i(U)&D.i(U);return new l(N,this.h&D.h)},t.or=function(D){const O=Math.max(this.g.length,D.g.length),N=[];for(let U=0;U<O;U++)N[U]=this.i(U)|D.i(U);return new l(N,this.h|D.h)},t.xor=function(D){const O=Math.max(this.g.length,D.g.length),N=[];for(let U=0;U<O;U++)N[U]=this.i(U)^D.i(U);return new l(N,this.h^D.h)};function V(D){const O=D.g.length+1,N=[];for(let U=0;U<O;U++)N[U]=D.i(U)<<1|D.i(U-1)>>>31;return new l(N,D.h)}function $(D,O){const N=O>>5;O%=32;const U=D.g.length-N,q=[];for(let I=0;I<U;I++)q[I]=O>0?D.i(I+N)>>>O|D.i(I+N+1)<<32-O:D.i(I+N);return new l(q,D.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,qE=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=f,l.fromString=p,ja=l}).apply(typeof Bw<"u"?Bw:typeof self<"u"?self:typeof window<"u"?window:{});var Kh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var HE,ju,GE,cf,Sy,WE,QE,KE;(function(){var t,e=Object.defineProperty;function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Kh=="object"&&Kh];for(var j=0;j<y.length;++j){var F=y[j];if(F&&F.Math==Math)return F}throw Error("Cannot find global object")}var r=n(this);function i(y,j){if(j)e:{var F=r;y=y.split(".");for(var K=0;K<y.length-1;K++){var he=y[K];if(!(he in F))break e;F=F[he]}y=y[y.length-1],K=F[y],j=j(K),j!=K&&j!=null&&e(F,y,{configurable:!0,writable:!0,value:j})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(j){var F=[],K;for(K in j)Object.prototype.hasOwnProperty.call(j,K)&&F.push([K,j[K]]);return F}});var o=o||{},l=this||self;function d(y){var j=typeof y;return j=="object"&&y!=null||j=="function"}function h(y,j,F){return y.call.apply(y.bind,arguments)}function f(y,j,F){return f=h,f.apply(null,arguments)}function p(y,j){var F=Array.prototype.slice.call(arguments,1);return function(){var K=F.slice();return K.push.apply(K,arguments),y.apply(this,K)}}function g(y,j){function F(){}F.prototype=j.prototype,y.Z=j.prototype,y.prototype=new F,y.prototype.constructor=y,y.Ob=function(K,he,ve){for(var ze=Array(arguments.length-2),st=2;st<arguments.length;st++)ze[st-2]=arguments[st];return j.prototype[he].apply(K,ze)}}var b=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function _(y){const j=y.length;if(j>0){const F=Array(j);for(let K=0;K<j;K++)F[K]=y[K];return F}return[]}function w(y,j){for(let K=1;K<arguments.length;K++){const he=arguments[K];var F=typeof he;if(F=F!="object"?F:he?Array.isArray(he)?"array":F:"null",F=="array"||F=="object"&&typeof he.length=="number"){F=y.length||0;const ve=he.length||0;y.length=F+ve;for(let ze=0;ze<ve;ze++)y[F+ze]=he[ze]}else y.push(he)}}class x{constructor(j,F){this.i=j,this.j=F,this.h=0,this.g=null}get(){let j;return this.h>0?(this.h--,j=this.g,this.g=j.next,j.next=null):j=this.i(),j}}function S(y){l.setTimeout(()=>{throw y},0)}function C(){var y=D;let j=null;return y.g&&(j=y.g,y.g=y.g.next,y.g||(y.h=null),j.next=null),j}class T{constructor(){this.h=this.g=null}add(j,F){const K=R.get();K.set(j,F),this.h?this.h.next=K:this.g=K,this.h=K}}var R=new x(()=>new k,y=>y.reset());class k{constructor(){this.next=this.g=this.h=null}set(j,F){this.h=j,this.g=F,this.next=null}reset(){this.next=this.g=this.h=null}}let V,$=!1,D=new T,O=()=>{const y=Promise.resolve(void 0);V=()=>{y.then(N)}};function N(){for(var y;y=C();){try{y.h.call(y.g)}catch(F){S(F)}var j=R;j.j(y),j.h<100&&(j.h++,y.next=j.g,j.g=y)}$=!1}function U(){this.u=this.u,this.C=this.C}U.prototype.u=!1,U.prototype.dispose=function(){this.u||(this.u=!0,this.N())},U.prototype[Symbol.dispose]=function(){this.dispose()},U.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function q(y,j){this.type=y,this.g=this.target=j,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var I=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var y=!1,j=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const F=()=>{};l.addEventListener("test",F,j),l.removeEventListener("test",F,j)}catch{}return y})();function z(y){return/^[\s\xa0]*$/.test(y)}function M(y,j){q.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,j)}g(M,q),M.prototype.init=function(y,j){const F=this.type=y.type,K=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=j,j=y.relatedTarget,j||(F=="mouseover"?j=y.fromElement:F=="mouseout"&&(j=y.toElement)),this.relatedTarget=j,K?(this.clientX=K.clientX!==void 0?K.clientX:K.pageX,this.clientY=K.clientY!==void 0?K.clientY:K.pageY,this.screenX=K.screenX||0,this.screenY=K.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&M.Z.h.call(this)},M.prototype.h=function(){M.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var X="closure_listenable_"+(Math.random()*1e6|0),Y=0;function G(y,j,F,K,he){this.listener=y,this.proxy=null,this.src=j,this.type=F,this.capture=!!K,this.ha=he,this.key=++Y,this.da=this.fa=!1}function Z(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function W(y,j,F){for(const K in y)j.call(F,y[K],K,y)}function te(y,j){for(const F in y)j.call(void 0,y[F],F,y)}function B(y){const j={};for(const F in y)j[F]=y[F];return j}const H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ne(y,j){let F,K;for(let he=1;he<arguments.length;he++){K=arguments[he];for(F in K)y[F]=K[F];for(let ve=0;ve<H.length;ve++)F=H[ve],Object.prototype.hasOwnProperty.call(K,F)&&(y[F]=K[F])}}function re(y){this.src=y,this.g={},this.h=0}re.prototype.add=function(y,j,F,K,he){const ve=y.toString();y=this.g[ve],y||(y=this.g[ve]=[],this.h++);const ze=_e(y,j,K,he);return ze>-1?(j=y[ze],F||(j.fa=!1)):(j=new G(j,this.src,ve,!!K,he),j.fa=F,y.push(j)),j};function ce(y,j){const F=j.type;if(F in y.g){var K=y.g[F],he=Array.prototype.indexOf.call(K,j,void 0),ve;(ve=he>=0)&&Array.prototype.splice.call(K,he,1),ve&&(Z(j),y.g[F].length==0&&(delete y.g[F],y.h--))}}function _e(y,j,F,K){for(let he=0;he<y.length;++he){const ve=y[he];if(!ve.da&&ve.listener==j&&ve.capture==!!F&&ve.ha==K)return he}return-1}var Te="closure_lm_"+(Math.random()*1e6|0),oe={};function be(y,j,F,K,he){if(Array.isArray(j)){for(let ve=0;ve<j.length;ve++)be(y,j[ve],F,K,he);return null}return F=J(F),y&&y[X]?y.J(j,F,d(K)?!!K.capture:!1,he):Ne(y,j,F,!1,K,he)}function Ne(y,j,F,K,he,ve){if(!j)throw Error("Invalid event type");const ze=d(he)?!!he.capture:!!he;let st=ge(y);if(st||(y[Te]=st=new re(y)),F=st.add(j,F,K,ze,ve),F.proxy)return F;if(K=Me(),F.proxy=K,K.src=y,K.listener=F,y.addEventListener)I||(he=ze),he===void 0&&(he=!1),y.addEventListener(j.toString(),K,he);else if(y.attachEvent)y.attachEvent(L(j.toString()),K);else if(y.addListener&&y.removeListener)y.addListener(K);else throw Error("addEventListener and attachEvent are unavailable.");return F}function Me(){function y(F){return j.call(y.src,y.listener,F)}const j=de;return y}function Ge(y,j,F,K,he){if(Array.isArray(j))for(var ve=0;ve<j.length;ve++)Ge(y,j[ve],F,K,he);else K=d(K)?!!K.capture:!!K,F=J(F),y&&y[X]?(y=y.i,ve=String(j).toString(),ve in y.g&&(j=y.g[ve],F=_e(j,F,K,he),F>-1&&(Z(j[F]),Array.prototype.splice.call(j,F,1),j.length==0&&(delete y.g[ve],y.h--)))):y&&(y=ge(y))&&(j=y.g[j.toString()],y=-1,j&&(y=_e(j,F,K,he)),(F=y>-1?j[y]:null)&&at(F))}function at(y){if(typeof y!="number"&&y&&!y.da){var j=y.src;if(j&&j[X])ce(j.i,y);else{var F=y.type,K=y.proxy;j.removeEventListener?j.removeEventListener(F,K,y.capture):j.detachEvent?j.detachEvent(L(F),K):j.addListener&&j.removeListener&&j.removeListener(K),(F=ge(j))?(ce(F,y),F.h==0&&(F.src=null,j[Te]=null)):Z(y)}}}function L(y){return y in oe?oe[y]:oe[y]="on"+y}function de(y,j){if(y.da)y=!0;else{j=new M(j,this);const F=y.listener,K=y.ha||y.src;y.fa&&at(y),y=F.call(K,j)}return y}function ge(y){return y=y[Te],y instanceof re?y:null}var ee="__closure_events_fn_"+(Math.random()*1e9>>>0);function J(y){return typeof y=="function"?y:(y[ee]||(y[ee]=function(j){return y.handleEvent(j)}),y[ee])}function ae(){U.call(this),this.i=new re(this),this.M=this,this.G=null}g(ae,U),ae.prototype[X]=!0,ae.prototype.removeEventListener=function(y,j,F,K){Ge(this,y,j,F,K)};function Se(y,j){var F,K=y.G;if(K)for(F=[];K;K=K.G)F.push(K);if(y=y.M,K=j.type||j,typeof j=="string")j=new q(j,y);else if(j instanceof q)j.target=j.target||y;else{var he=j;j=new q(K,y),ne(j,he)}he=!0;let ve,ze;if(F)for(ze=F.length-1;ze>=0;ze--)ve=j.g=F[ze],he=we(ve,K,!0,j)&&he;if(ve=j.g=y,he=we(ve,K,!0,j)&&he,he=we(ve,K,!1,j)&&he,F)for(ze=0;ze<F.length;ze++)ve=j.g=F[ze],he=we(ve,K,!1,j)&&he}ae.prototype.N=function(){if(ae.Z.N.call(this),this.i){var y=this.i;for(const j in y.g){const F=y.g[j];for(let K=0;K<F.length;K++)Z(F[K]);delete y.g[j],y.h--}}this.G=null},ae.prototype.J=function(y,j,F,K){return this.i.add(String(y),j,!1,F,K)},ae.prototype.K=function(y,j,F,K){return this.i.add(String(y),j,!0,F,K)};function we(y,j,F,K){if(j=y.i.g[String(j)],!j)return!0;j=j.concat();let he=!0;for(let ve=0;ve<j.length;++ve){const ze=j[ve];if(ze&&!ze.da&&ze.capture==F){const st=ze.listener,an=ze.ha||ze.src;ze.fa&&ce(y.i,ze),he=st.call(an,K)!==!1&&he}}return he&&!K.defaultPrevented}function ie(y,j){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=f(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(j)>2147483647?-1:l.setTimeout(y,j||0)}function Re(y){y.g=ie(()=>{y.g=null,y.i&&(y.i=!1,Re(y))},y.l);const j=y.h;y.h=null,y.m.apply(null,j)}class Be extends U{constructor(j,F){super(),this.m=j,this.l=F,this.h=null,this.i=!1,this.g=null}j(j){this.h=arguments,this.g?this.i=!0:Re(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Oe(y){U.call(this),this.h=y,this.g={}}g(Oe,U);var He=[];function xt(y){W(y.g,function(j,F){this.g.hasOwnProperty(F)&&at(j)},y),y.g={}}Oe.prototype.N=function(){Oe.Z.N.call(this),xt(this)},Oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rt=l.JSON.stringify,Wn=l.JSON.parse,gs=class{stringify(y){return l.JSON.stringify(y,void 0)}parse(y){return l.JSON.parse(y,void 0)}};function sr(){}function ys(){}var vt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function nn(){q.call(this,"d")}g(nn,q);function Qn(){q.call(this,"c")}g(Qn,q);var Et={},Ka=null;function Ni(){return Ka=Ka||new ae}Et.Ia="serverreachability";function Qo(y){q.call(this,Et.Ia,y)}g(Qo,q);function Or(y){const j=Ni();Se(j,new Qo(j))}Et.STAT_EVENT="statevent";function _s(y,j){q.call(this,Et.STAT_EVENT,y),this.stat=j}g(_s,q);function Ft(y){const j=Ni();Se(j,new _s(j,y))}Et.Ja="timingevent";function ir(y,j){q.call(this,Et.Ja,y),this.size=j}g(ir,q);function bs(y,j){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){y()},j)}function Zr(){this.g=!0}Zr.prototype.ua=function(){this.g=!1};function Om(y,j,F,K,he,ve){y.info(function(){if(y.g)if(ve){var ze="",st=ve.split("&");for(let Ct=0;Ct<st.length;Ct++){var an=st[Ct].split("=");if(an.length>1){const Wt=an[0];an=an[1];const zr=Wt.split("_");ze=zr.length>=2&&zr[1]=="type"?ze+(Wt+"="+an+"&"):ze+(Wt+"=redacted&")}}}else ze=null;else ze=ve;return"XMLHTTP REQ ("+K+") [attempt "+he+"]: "+j+`
`+F+`
`+ze})}function wd(y,j,F,K,he,ve,ze){y.info(function(){return"XMLHTTP RESP ("+K+") [ attempt "+he+"]: "+j+`
`+F+`
`+ve+" "+ze})}function vs(y,j,F,K){y.info(function(){return"XMLHTTP TEXT ("+j+"): "+Nm(y,F)+(K?" "+K:"")})}function Ya(y,j){y.info(function(){return"TIMEOUT: "+j})}Zr.prototype.info=function(){};function Nm(y,j){if(!y.g)return j;if(!j)return null;try{const ve=JSON.parse(j);if(ve){for(y=0;y<ve.length;y++)if(Array.isArray(ve[y])){var F=ve[y];if(!(F.length<2)){var K=F[1];if(Array.isArray(K)&&!(K.length<1)){var he=K[0];if(he!="noop"&&he!="stop"&&he!="close")for(let ze=1;ze<K.length;ze++)K[ze]=""}}}}return rt(ve)}catch{return j}}var Xa={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ec={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Cc;function Za(){}g(Za,sr),Za.prototype.g=function(){return new XMLHttpRequest},Cc=new Za;function Xs(y){return encodeURIComponent(String(y))}function Sd(y){var j=1;y=y.split(":");const F=[];for(;j>0&&y.length;)F.push(y.shift()),j--;return y.length&&F.push(y.join(":")),F}function Jr(y,j,F,K){this.j=y,this.i=j,this.l=F,this.S=K||1,this.V=new Oe(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new es}function es(){this.i=null,this.g="",this.h=!1}var hn={},kn={};function xs(y,j,F){y.M=1,y.A=Ja(mn(j)),y.u=F,y.R=!0,Ko(y,null)}function Ko(y,j){y.F=Date.now(),ws(y),y.B=mn(y.A);var F=y.B,K=y.S;Array.isArray(K)||(K=[String(K)]),Jo(F.i,"t",K),y.C=0,F=y.j.L,y.h=new es,y.g=zd(y.j,F?j:null,!y.u),y.P>0&&(y.O=new Be(f(y.Y,y,y.g),y.P)),j=y.V,F=y.g,K=y.ba;var he="readystatechange";Array.isArray(he)||(he&&(He[0]=he.toString()),he=He);for(let ve=0;ve<he.length;ve++){const ze=be(F,he[ve],K||j.handleEvent,!1,j.h||j);if(!ze)break;j.g[ze.key]=ze}j=y.J?B(y.J):{},y.u?(y.v||(y.v="POST"),j["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,j)):(y.v="GET",y.g.ea(y.B,y.v,null,j)),Or(),Om(y.i,y.v,y.B,y.l,y.S,y.u)}Jr.prototype.ba=function(y){y=y.target;const j=this.O;j&&rs(y)==3?j.j():this.Y(y)},Jr.prototype.Y=function(y){try{if(y==this.g)e:{const st=rs(this.g),an=this.g.ya(),Ct=this.g.ca();if(!(st<3)&&(st!=3||this.g&&(this.h.h||this.g.la()||Nn(this.g)))){this.K||st!=4||an==7||(an==8||Ct<=0?Or(3):Or(2)),Ss(this);var j=this.g.ca();this.X=j;var F=Pm(this);if(this.o=j==200,wd(this.i,this.v,this.B,this.l,this.S,st,j),this.o){if(this.U&&!this.L){t:{if(this.g){var K,he=this.g;if((K=he.g?he.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(K)){var ve=K;break t}}ve=null}if(y=ve)vs(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Es(this,y);else{this.o=!1,this.m=3,Ft(12),wr(this),Nr(this);break e}}if(this.R){y=!0;let Wt;for(;!this.K&&this.C<F.length;)if(Wt=Cd(this,F),Wt==kn){st==4&&(this.m=4,Ft(14),y=!1),vs(this.i,this.l,null,"[Incomplete Response]");break}else if(Wt==hn){this.m=4,Ft(15),vs(this.i,this.l,F,"[Invalid Chunk]"),y=!1;break}else vs(this.i,this.l,Wt,null),Es(this,Wt);if(Ed(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),st!=4||F.length!=0||this.h.h||(this.m=1,Ft(16),y=!1),this.o=this.o&&y,!y)vs(this.i,this.l,F,"[Invalid Chunked Response]"),wr(this),Nr(this);else if(F.length>0&&!this.W){this.W=!0;var ze=this.j;ze.g==this&&ze.aa&&!ze.P&&(ze.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Uc(ze),ze.P=!0,Ft(11))}}else vs(this.i,this.l,F,null),Es(this,F);st==4&&wr(this),this.o&&!this.K&&(st==4?Od(this.j,this):(this.o=!1,ws(this)))}else Js(this.g),j==400&&F.indexOf("Unknown SID")>0?(this.m=3,Ft(12)):(this.m=0,Ft(13)),wr(this),Nr(this)}}}catch{}};function Pm(y){if(!Ed(y))return y.g.la();const j=Nn(y.g);if(j==="")return"";let F="";const K=j.length,he=rs(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return wr(y),Nr(y),"";y.h.i=new l.TextDecoder}for(let ve=0;ve<K;ve++)y.h.h=!0,F+=y.h.i.decode(j[ve],{stream:!(he&&ve==K-1)});return j.length=0,y.h.g+=F,y.C=0,y.h.g}function Ed(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function Cd(y,j){var F=y.C,K=j.indexOf(`
`,F);return K==-1?kn:(F=Number(j.substring(F,K)),isNaN(F)?hn:(K+=1,K+F>j.length?kn:(j=j.slice(K,K+F),y.C=K+F,j)))}Jr.prototype.cancel=function(){this.K=!0,wr(this)};function ws(y){y.T=Date.now()+y.H,Yo(y,y.H)}function Yo(y,j){if(y.D!=null)throw Error("WatchDog timer not null");y.D=bs(f(y.aa,y),j)}function Ss(y){y.D&&(l.clearTimeout(y.D),y.D=null)}Jr.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(Ya(this.i,this.B),this.M!=2&&(Or(),Ft(17)),wr(this),this.m=2,Nr(this)):Yo(this,this.T-y)};function Nr(y){y.j.I==0||y.K||Od(y.j,y)}function wr(y){Ss(y);var j=y.O;j&&typeof j.dispose=="function"&&j.dispose(),y.O=null,xt(y.V),y.g&&(j=y.g,y.g=null,j.abort(),j.dispose())}function Es(y,j){try{var F=y.j;if(F.I!=0&&(F.g==y||Ts(F.h,y))){if(!y.L&&Ts(F.h,y)&&F.I==3){try{var K=F.Ba.g.parse(j)}catch{K=null}if(Array.isArray(K)&&K.length==3){var he=K;if(he[0]==0){e:if(!F.v){if(F.g)if(F.g.F+3e3<y.F)sl(F),$i(F);else break e;ao(F),Ft(18)}}else F.xa=he[1],0<F.xa-F.K&&he[2]<37500&&F.F&&F.A==0&&!F.C&&(F.C=bs(f(F.Va,F),6e3));Cs(F.h)<=1&&F.ta&&(F.ta=void 0)}else Ds(F,11)}else if((y.L||F.g==y)&&sl(F),!z(j))for(he=F.Ba.g.parse(j),j=0;j<he.length;j++){let Ct=he[j];const Wt=Ct[0];if(!(Wt<=F.K))if(F.K=Wt,Ct=Ct[1],F.I==2)if(Ct[0]=="c"){F.M=Ct[1],F.ba=Ct[2];const zr=Ct[3];zr!=null&&(F.ka=zr,F.j.info("VER="+F.ka));const Ms=Ct[4];Ms!=null&&(F.za=Ms,F.j.info("SVER="+F.za));const ss=Ct[5];ss!=null&&typeof ss=="number"&&ss>0&&(K=1.5*ss,F.O=K,F.j.info("backChannelRequestTimeoutMs_="+K)),K=F;const is=y.g;if(is){const oo=is.g?is.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(oo){var ve=K.h;ve.g||oo.indexOf("spdy")==-1&&oo.indexOf("quic")==-1&&oo.indexOf("h2")==-1||(ve.j=ve.l,ve.g=new Set,ve.h&&(jc(ve,ve.h),ve.h=null))}if(K.G){const il=is.g?is.g.getResponseHeader("X-HTTP-Session-Id"):null;il&&(K.wa=il,jt(K.J,K.G,il))}}F.I=3,F.l&&F.l.ra(),F.aa&&(F.T=Date.now()-y.F,F.j.info("Handshake RTT: "+F.T+"ms")),K=F;var ze=y;if(K.na=Bd(K,K.L?K.ba:null,K.W),ze.L){Rc(K.h,ze);var st=ze,an=K.O;an&&(st.H=an),st.D&&(Ss(st),ws(st)),K.g=ze}else Dd(K);F.i.length>0&&ks(F)}else Ct[0]!="stop"&&Ct[0]!="close"||Ds(F,7);else F.I==3&&(Ct[0]=="stop"||Ct[0]=="close"?Ct[0]=="stop"?Ds(F,7):zc(F):Ct[0]!="noop"&&F.l&&F.l.qa(Ct),F.A=0)}}Or(4)}catch{}}var fn=class{constructor(y,j){this.g=y,this.map=j}};function Tc(y){this.l=y||10,l.PerformanceNavigationTiming?(y=l.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ac(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function Cs(y){return y.h?1:y.g?y.g.size:0}function Ts(y,j){return y.h?y.h==j:y.g?y.g.has(j):!1}function jc(y,j){y.g?y.g.add(j):y.h=j}function Rc(y,j){y.h&&y.h==j?y.h=null:y.g&&y.g.has(j)&&y.g.delete(j)}Tc.prototype.cancel=function(){if(this.i=Ic(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function Ic(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let j=y.i;for(const F of y.g.values())j=j.concat(F.G);return j}return _(y.i)}var Td=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Xo(y,j){if(y){y=y.split("&");for(let F=0;F<y.length;F++){const K=y[F].indexOf("=");let he,ve=null;K>=0?(he=y[F].substring(0,K),ve=y[F].substring(K+1)):he=y[F],j(he,ve?decodeURIComponent(ve.replace(/\+/g," ")):"")}}}function Sr(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let j;y instanceof Sr?(this.l=y.l,Dn(this,y.j),this.o=y.o,this.g=y.g,Pi(this,y.u),this.h=y.h,kc(this,Id(y.i)),this.m=y.m):y&&(j=String(y).match(Td))?(this.l=!1,Dn(this,j[1]||"",!0),this.o=As(j[2]||""),this.g=As(j[3]||"",!0),Pi(this,j[4]),this.h=As(j[5]||"",!0),kc(this,j[6]||"",!0),this.m=As(j[7]||"")):(this.l=!1,this.i=new zi(null,this.l))}Sr.prototype.toString=function(){const y=[];var j=this.j;j&&y.push(eo(j,Zo,!0),":");var F=this.g;return(F||j=="file")&&(y.push("//"),(j=this.o)&&y.push(eo(j,Zo,!0),"@"),y.push(Xs(F).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),F=this.u,F!=null&&y.push(":",String(F))),(F=this.h)&&(this.g&&F.charAt(0)!="/"&&y.push("/"),y.push(eo(F,F.charAt(0)=="/"?Dc:Ad,!0))),(F=this.i.toString())&&y.push("?",F),(F=this.m)&&y.push("#",eo(F,jd)),y.join("")},Sr.prototype.resolve=function(y){const j=mn(this);let F=!!y.j;F?Dn(j,y.j):F=!!y.o,F?j.o=y.o:F=!!y.g,F?j.g=y.g:F=y.u!=null;var K=y.h;if(F)Pi(j,y.u);else if(F=!!y.h){if(K.charAt(0)!="/")if(this.g&&!this.h)K="/"+K;else{var he=j.h.lastIndexOf("/");he!=-1&&(K=j.h.slice(0,he+1)+K)}if(he=K,he==".."||he==".")K="";else if(he.indexOf("./")!=-1||he.indexOf("/.")!=-1){K=he.lastIndexOf("/",0)==0,he=he.split("/");const ve=[];for(let ze=0;ze<he.length;){const st=he[ze++];st=="."?K&&ze==he.length&&ve.push(""):st==".."?((ve.length>1||ve.length==1&&ve[0]!="")&&ve.pop(),K&&ze==he.length&&ve.push("")):(ve.push(st),K=!0)}K=ve.join("/")}else K=he}return F?j.h=K:F=y.i.toString()!=="",F?kc(j,Id(y.i)):F=!!y.m,F&&(j.m=y.m),j};function mn(y){return new Sr(y)}function Dn(y,j,F){y.j=F?As(j,!0):j,y.j&&(y.j=y.j.replace(/:$/,""))}function Pi(y,j){if(j){if(j=Number(j),isNaN(j)||j<0)throw Error("Bad port number "+j);y.u=j}else y.u=null}function kc(y,j,F){j instanceof zi?(y.i=j,el(y.i,y.l)):(F||(j=eo(j,Bi)),y.i=new zi(j,y.l))}function jt(y,j,F){y.i.set(j,F)}function Ja(y){return jt(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function As(y,j){return y?j?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function eo(y,j,F){return typeof y=="string"?(y=encodeURI(y).replace(j,ur),F&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function ur(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var Zo=/[#\/\?@]/g,Ad=/[#\?:]/g,Dc=/[#\?]/g,Bi=/[#\?@]/g,jd=/#/g;function zi(y,j){this.h=this.g=null,this.i=y||null,this.j=!!j}function dr(y){y.g||(y.g=new Map,y.h=0,y.i&&Xo(y.i,function(j,F){y.add(decodeURIComponent(j.replace(/\+/g," ")),F)}))}t=zi.prototype,t.add=function(y,j){dr(this),this.i=null,y=Li(this,y);let F=this.g.get(y);return F||this.g.set(y,F=[]),F.push(j),this.h+=1,this};function Rd(y,j){dr(y),j=Li(y,j),y.g.has(j)&&(y.i=null,y.h-=y.g.get(j).length,y.g.delete(j))}function Mc(y,j){return dr(y),j=Li(y,j),y.g.has(j)}t.forEach=function(y,j){dr(this),this.g.forEach(function(F,K){F.forEach(function(he){y.call(j,he,K,this)},this)},this)};function Oc(y,j){dr(y);let F=[];if(typeof j=="string")Mc(y,j)&&(F=F.concat(y.g.get(Li(y,j))));else for(y=Array.from(y.g.values()),j=0;j<y.length;j++)F=F.concat(y[j]);return F}t.set=function(y,j){return dr(this),this.i=null,y=Li(this,y),Mc(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[j]),this.h+=1,this},t.get=function(y,j){return y?(y=Oc(this,y),y.length>0?String(y[0]):j):j};function Jo(y,j,F){Rd(y,j),F.length>0&&(y.i=null,y.g.set(Li(y,j),_(F)),y.h+=F.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],j=Array.from(this.g.keys());for(let K=0;K<j.length;K++){var F=j[K];const he=Xs(F);F=Oc(this,F);for(let ve=0;ve<F.length;ve++){let ze=he;F[ve]!==""&&(ze+="="+Xs(F[ve])),y.push(ze)}}return this.i=y.join("&")};function Id(y){const j=new zi;return j.i=y.i,y.g&&(j.g=new Map(y.g),j.h=y.h),j}function Li(y,j){return j=String(j),y.j&&(j=j.toLowerCase()),j}function el(y,j){j&&!y.j&&(dr(y),y.i=null,y.g.forEach(function(F,K){const he=K.toLowerCase();K!=he&&(Rd(this,K),Jo(this,he,F))},y)),y.j=j}function ts(y,j){const F=new Zr;if(l.Image){const K=new Image;K.onload=p(Pr,F,"TestLoadImage: loaded",!0,j,K),K.onerror=p(Pr,F,"TestLoadImage: error",!1,j,K),K.onabort=p(Pr,F,"TestLoadImage: abort",!1,j,K),K.ontimeout=p(Pr,F,"TestLoadImage: timeout",!1,j,K),l.setTimeout(function(){K.ontimeout&&K.ontimeout()},1e4),K.src=y}else j(!1)}function Nc(y,j){const F=new Zr,K=new AbortController,he=setTimeout(()=>{K.abort(),Pr(F,"TestPingServer: timeout",!1,j)},1e4);fetch(y,{signal:K.signal}).then(ve=>{clearTimeout(he),ve.ok?Pr(F,"TestPingServer: ok",!0,j):Pr(F,"TestPingServer: server error",!1,j)}).catch(()=>{clearTimeout(he),Pr(F,"TestPingServer: error",!1,j)})}function Pr(y,j,F,K,he){try{he&&(he.onload=null,he.onerror=null,he.onabort=null,he.ontimeout=null),K(F)}catch{}}function Ui(){this.g=new gs}function js(y){this.i=y.Sb||null,this.h=y.ab||!1}g(js,sr),js.prototype.g=function(){return new to(this.i,this.h)};function to(y,j){ae.call(this),this.H=y,this.o=j,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(to,ae),t=to.prototype,t.open=function(y,j){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=j,this.readyState=1,ns(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const j={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(j.body=y),(this.H||l).fetch(new Request(this.D,j)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Fi(this)),this.readyState=0},t.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,ns(this)),this.g&&(this.readyState=3,ns(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tl(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function tl(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}t.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var j=y.value?y.value:new Uint8Array(0);(j=this.B.decode(j,{stream:!y.done}))&&(this.response=this.responseText+=j)}y.done?Fi(this):ns(this),this.readyState==3&&tl(this)}},t.Oa=function(y){this.g&&(this.response=this.responseText=y,Fi(this))},t.Na=function(y){this.g&&(this.response=y,Fi(this))},t.ga=function(){this.g&&Fi(this)};function Fi(y){y.readyState=4,y.l=null,y.j=null,y.B=null,ns(y)}t.setRequestHeader=function(y,j){this.A.append(y,j)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],j=this.h.entries();for(var F=j.next();!F.done;)F=F.value,y.push(F[0]+": "+F[1]),F=j.next();return y.join(`\r
`)};function ns(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(to.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Br(y){let j="";return W(y,function(F,K){j+=K,j+=":",j+=F,j+=`\r
`}),j}function no(y,j,F){e:{for(K in F){var K=!1;break e}K=!0}K||(F=Br(F),typeof y=="string"?F!=null&&Xs(F):jt(y,j,F))}function kt(y){ae.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(kt,ae);var Rs=/^https?$/i,Pc=["POST","PUT"];t=kt.prototype,t.Fa=function(y){this.H=y},t.ea=function(y,j,F,K){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);j=j?j.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Cc.g(),this.g.onreadystatechange=b(f(this.Ca,this));try{this.B=!0,this.g.open(j,String(y),!0),this.B=!1}catch(ve){ro(this,ve);return}if(y=F||"",F=new Map(this.headers),K)if(Object.getPrototypeOf(K)===Object.prototype)for(var he in K)F.set(he,K[he]);else if(typeof K.keys=="function"&&typeof K.get=="function")for(const ve of K.keys())F.set(ve,K.get(ve));else throw Error("Unknown input type for opt_headers: "+String(K));K=Array.from(F.keys()).find(ve=>ve.toLowerCase()=="content-type"),he=l.FormData&&y instanceof l.FormData,!(Array.prototype.indexOf.call(Pc,j,void 0)>=0)||K||he||F.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ve,ze]of F)this.g.setRequestHeader(ve,ze);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(ve){ro(this,ve)}};function ro(y,j){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=j,y.o=5,Bc(y),Zs(y)}function Bc(y){y.A||(y.A=!0,Se(y,"complete"),Se(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,Se(this,"complete"),Se(this,"abort"),Zs(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Zs(this,!0)),kt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?so(this):this.Xa())},t.Xa=function(){so(this)};function so(y){if(y.h&&typeof o<"u"){if(y.v&&rs(y)==4)setTimeout(y.Ca.bind(y),0);else if(Se(y,"readystatechange"),rs(y)==4){y.h=!1;try{const ve=y.ca();e:switch(ve){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var j=!0;break e;default:j=!1}var F;if(!(F=j)){var K;if(K=ve===0){let ze=String(y.D).match(Td)[1]||null;!ze&&l.self&&l.self.location&&(ze=l.self.location.protocol.slice(0,-1)),K=!Rs.test(ze?ze.toLowerCase():"")}F=K}if(F)Se(y,"complete"),Se(y,"success");else{y.o=6;try{var he=rs(y)>2?y.g.statusText:""}catch{he=""}y.l=he+" ["+y.ca()+"]",Bc(y)}}finally{Zs(y)}}}}function Zs(y,j){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const F=y.g;y.g=null,j||Se(y,"ready");try{F.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function rs(y){return y.g?y.g.readyState:0}t.ca=function(){try{return rs(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(y){if(this.g){var j=this.g.responseText;return y&&j.indexOf(y)==0&&(j=j.substring(y.length)),Wn(j)}};function Nn(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function Js(y){const j={};y=(y.g&&rs(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let K=0;K<y.length;K++){if(z(y[K]))continue;var F=Sd(y[K]);const he=F[0];if(F=F[1],typeof F!="string")continue;F=F.trim();const ve=j[he]||[];j[he]=ve,ve.push(F)}te(j,function(K){return K.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Is(y,j,F){return F&&F.internalChannelParams&&F.internalChannelParams[y]||j}function Vi(y){this.za=0,this.i=[],this.j=new Zr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Is("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Is("baseRetryDelayMs",5e3,y),this.Za=Is("retryDelaySeedMs",1e4,y),this.Ta=Is("forwardChannelMaxRetries",2,y),this.va=Is("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new Tc(y&&y.concurrentRequestLimit),this.Ba=new Ui,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Vi.prototype,t.ka=8,t.I=1,t.connect=function(y,j,F,K){Ft(0),this.W=y,this.H=j||{},F&&K!==void 0&&(this.H.OSID=F,this.H.OAID=K),this.F=this.X,this.J=Bd(this,null,this.W),ks(this)};function zc(y){if(nl(y),y.I==3){var j=y.V++,F=mn(y.J);if(jt(F,"SID",y.M),jt(F,"RID",j),jt(F,"TYPE","terminate"),io(y,F),j=new Jr(y,y.j,j),j.M=2,j.A=Ja(mn(F)),F=!1,l.navigator&&l.navigator.sendBeacon)try{F=l.navigator.sendBeacon(j.A.toString(),"")}catch{}!F&&l.Image&&(new Image().src=j.A,F=!0),F||(j.g=zd(j.j,null),j.g.ea(j.A)),j.F=Date.now(),ws(j)}Pd(y)}function $i(y){y.g&&(Uc(y),y.g.cancel(),y.g=null)}function nl(y){$i(y),y.v&&(l.clearTimeout(y.v),y.v=null),sl(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&l.clearTimeout(y.m),y.m=null)}function ks(y){if(!Ac(y.h)&&!y.m){y.m=!0;var j=y.Ea;V||O(),$||(V(),$=!0),D.add(j,y),y.D=0}}function rl(y,j){return Cs(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=j.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=bs(f(y.Ea,y,j),Nd(y,y.D)),y.D++,!0)}t.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const he=new Jr(this,this.j,y);let ve=this.o;if(this.U&&(ve?(ve=B(ve),ne(ve,this.U)):ve=this.U),this.u!==null||this.R||(he.J=ve,ve=null),this.S)e:{for(var j=0,F=0;F<this.i.length;F++){t:{var K=this.i[F];if("__data__"in K.map&&(K=K.map.__data__,typeof K=="string")){K=K.length;break t}K=void 0}if(K===void 0)break;if(j+=K,j>4096){j=F;break e}if(j===4096||F===this.i.length-1){j=F+1;break e}}j=1e3}else j=1e3;j=kd(this,he,j),F=mn(this.J),jt(F,"RID",y),jt(F,"CVER",22),this.G&&jt(F,"X-HTTP-Session-Id",this.G),io(this,F),ve&&(this.R?j="headers="+Xs(Br(ve))+"&"+j:this.u&&no(F,this.u,ve)),jc(this.h,he),this.Ra&&jt(F,"TYPE","init"),this.S?(jt(F,"$req",j),jt(F,"SID","null"),he.U=!0,xs(he,F,null)):xs(he,F,j),this.I=2}}else this.I==3&&(y?Lc(this,y):this.i.length==0||Ac(this.h)||Lc(this))};function Lc(y,j){var F;j?F=j.l:F=y.V++;const K=mn(y.J);jt(K,"SID",y.M),jt(K,"RID",F),jt(K,"AID",y.K),io(y,K),y.u&&y.o&&no(K,y.u,y.o),F=new Jr(y,y.j,F,y.D+1),y.u===null&&(F.J=y.o),j&&(y.i=j.G.concat(y.i)),j=kd(y,F,1e3),F.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),jc(y.h,F),xs(F,K,j)}function io(y,j){y.H&&W(y.H,function(F,K){jt(j,K,F)}),y.l&&W({},function(F,K){jt(j,K,F)})}function kd(y,j,F){F=Math.min(y.i.length,F);const K=y.l?f(y.l.Ka,y.l,y):null;e:{var he=y.i;let st=-1;for(;;){const an=["count="+F];st==-1?F>0?(st=he[0].g,an.push("ofs="+st)):st=0:an.push("ofs="+st);let Ct=!0;for(let Wt=0;Wt<F;Wt++){var ve=he[Wt].g;const zr=he[Wt].map;if(ve-=st,ve<0)st=Math.max(0,he[Wt].g-100),Ct=!1;else try{ve="req"+ve+"_"||"";try{var ze=zr instanceof Map?zr:Object.entries(zr);for(const[Ms,ss]of ze){let is=ss;d(ss)&&(is=rt(ss)),an.push(ve+Ms+"="+encodeURIComponent(is))}}catch(Ms){throw an.push(ve+"type="+encodeURIComponent("_badmap")),Ms}}catch{K&&K(zr)}}if(Ct){ze=an.join("&");break e}}ze=void 0}return y=y.i.splice(0,F),j.G=y,ze}function Dd(y){if(!y.g&&!y.v){y.Y=1;var j=y.Da;V||O(),$||(V(),$=!0),D.add(j,y),y.A=0}}function ao(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=bs(f(y.Da,y),Nd(y,y.A)),y.A++,!0)}t.Da=function(){if(this.v=null,Md(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=bs(f(this.Wa,this),y)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ft(10),$i(this),Md(this))};function Uc(y){y.B!=null&&(l.clearTimeout(y.B),y.B=null)}function Md(y){y.g=new Jr(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var j=mn(y.na);jt(j,"RID","rpc"),jt(j,"SID",y.M),jt(j,"AID",y.K),jt(j,"CI",y.F?"0":"1"),!y.F&&y.ia&&jt(j,"TO",y.ia),jt(j,"TYPE","xmlhttp"),io(y,j),y.u&&y.o&&no(j,y.u,y.o),y.O&&(y.g.H=y.O);var F=y.g;y=y.ba,F.M=1,F.A=Ja(mn(j)),F.u=null,F.R=!0,Ko(F,y)}t.Va=function(){this.C!=null&&(this.C=null,$i(this),ao(this),Ft(19))};function sl(y){y.C!=null&&(l.clearTimeout(y.C),y.C=null)}function Od(y,j){var F=null;if(y.g==j){sl(y),Uc(y),y.g=null;var K=2}else if(Ts(y.h,j))F=j.G,Rc(y.h,j),K=1;else return;if(y.I!=0){if(j.o)if(K==1){F=j.u?j.u.length:0,j=Date.now()-j.F;var he=y.D;K=Ni(),Se(K,new ir(K,F)),ks(y)}else Dd(y);else if(he=j.m,he==3||he==0&&j.X>0||!(K==1&&rl(y,j)||K==2&&ao(y)))switch(F&&F.length>0&&(j=y.h,j.i=j.i.concat(F)),he){case 1:Ds(y,5);break;case 4:Ds(y,10);break;case 3:Ds(y,6);break;default:Ds(y,2)}}}function Nd(y,j){let F=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(F*=2),F*j}function Ds(y,j){if(y.j.info("Error code "+j),j==2){var F=f(y.bb,y),K=y.Ua;const he=!K;K=new Sr(K||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Dn(K,"https"),Ja(K),he?ts(K.toString(),F):Nc(K.toString(),F)}else Ft(2);y.I=0,y.l&&y.l.pa(j),Pd(y),nl(y)}t.bb=function(y){y?(this.j.info("Successfully pinged google.com"),Ft(2)):(this.j.info("Failed to ping google.com"),Ft(1))};function Pd(y){if(y.I=0,y.ja=[],y.l){const j=Ic(y.h);(j.length!=0||y.i.length!=0)&&(w(y.ja,j),w(y.ja,y.i),y.h.i.length=0,_(y.i),y.i.length=0),y.l.oa()}}function Bd(y,j,F){var K=F instanceof Sr?mn(F):new Sr(F);if(K.g!="")j&&(K.g=j+"."+K.g),Pi(K,K.u);else{var he=l.location;K=he.protocol,j=j?j+"."+he.hostname:he.hostname,he=+he.port;const ve=new Sr(null);K&&Dn(ve,K),j&&(ve.g=j),he&&Pi(ve,he),F&&(ve.h=F),K=ve}return F=y.G,j=y.wa,F&&j&&jt(K,F,j),jt(K,"VER",y.ka),io(y,K),K}function zd(y,j,F){if(j&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return j=y.Aa&&!y.ma?new kt(new js({ab:F})):new kt(y.ma),j.Fa(y.L),j}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ld(){}t=Ld.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function qi(){}qi.prototype.g=function(y,j){return new ar(y,j)};function ar(y,j){ae.call(this),this.g=new Vi(j),this.l=y,this.h=j&&j.messageUrlParams||null,y=j&&j.messageHeaders||null,j&&j.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=j&&j.initMessageHeaders||null,j&&j.messageContentType&&(y?y["X-WebChannel-Content-Type"]=j.messageContentType:y={"X-WebChannel-Content-Type":j.messageContentType}),j&&j.sa&&(y?y["X-WebChannel-Client-Profile"]=j.sa:y={"X-WebChannel-Client-Profile":j.sa}),this.g.U=y,(y=j&&j.Qb)&&!z(y)&&(this.g.u=y),this.A=j&&j.supportsCrossDomainXhr||!1,this.v=j&&j.sendRawJson||!1,(j=j&&j.httpSessionIdParam)&&!z(j)&&(this.g.G=j,y=this.h,y!==null&&j in y&&(y=this.h,j in y&&delete y[j])),this.j=new ei(this)}g(ar,ae),ar.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ar.prototype.close=function(){zc(this.g)},ar.prototype.o=function(y){var j=this.g;if(typeof y=="string"){var F={};F.__data__=y,y=F}else this.v&&(F={},F.__data__=rt(y),y=F);j.i.push(new fn(j.Ya++,y)),j.I==3&&ks(j)},ar.prototype.N=function(){this.g.l=null,delete this.j,zc(this.g),delete this.g,ar.Z.N.call(this)};function Ud(y){nn.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var j=y.__sm__;if(j){e:{for(const F in j){y=F;break e}y=void 0}(this.i=y)&&(y=this.i,j=j!==null&&y in j?j[y]:void 0),this.data=j}else this.data=y}g(Ud,nn);function Fd(){Qn.call(this),this.status=1}g(Fd,Qn);function ei(y){this.g=y}g(ei,Ld),ei.prototype.ra=function(){Se(this.g,"a")},ei.prototype.qa=function(y){Se(this.g,new Ud(y))},ei.prototype.pa=function(y){Se(this.g,new Fd)},ei.prototype.oa=function(){Se(this.g,"b")},qi.prototype.createWebChannel=qi.prototype.g,ar.prototype.send=ar.prototype.o,ar.prototype.open=ar.prototype.m,ar.prototype.close=ar.prototype.close,KE=function(){return new qi},QE=function(){return Ni()},WE=Et,Sy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Xa.NO_ERROR=0,Xa.TIMEOUT=8,Xa.HTTP_ERROR=6,cf=Xa,Ec.COMPLETE="complete",GE=Ec,ys.EventType=vt,vt.OPEN="a",vt.CLOSE="b",vt.ERROR="c",vt.MESSAGE="d",ae.prototype.listen=ae.prototype.J,ju=ys,kt.prototype.listenOnce=kt.prototype.K,kt.prototype.getLastError=kt.prototype.Ha,kt.prototype.getLastErrorCode=kt.prototype.ya,kt.prototype.getStatus=kt.prototype.ca,kt.prototype.getResponseJson=kt.prototype.La,kt.prototype.getResponseText=kt.prototype.la,kt.prototype.send=kt.prototype.ea,kt.prototype.setWithCredentials=kt.prototype.Fa,HE=kt}).apply(typeof Kh<"u"?Kh:typeof self<"u"?self:typeof window<"u"?window:{});const zw="@firebase/firestore",Lw="4.9.3";class Xn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Xn.UNAUTHENTICATED=new Xn(null),Xn.GOOGLE_CREDENTIALS=new Xn("google-credentials-uid"),Xn.FIRST_PARTY=new Xn("first-party-uid"),Xn.MOCK_USER=new Xn("mock-user");let fc="12.7.0";const Po=new r_("@firebase/firestore");function zl(){return Po.logLevel}function Ue(t,...e){if(Po.logLevel<=pt.DEBUG){const n=e.map(m_);Po.debug(`Firestore (${fc}): ${t}`,...n)}}function ji(t,...e){if(Po.logLevel<=pt.ERROR){const n=e.map(m_);Po.error(`Firestore (${fc}): ${t}`,...n)}}function Yl(t,...e){if(Po.logLevel<=pt.WARN){const n=e.map(m_);Po.warn(`Firestore (${fc}): ${t}`,...n)}}function m_(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Ze(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,YE(t,r,n)}function YE(t,e,n){let r=`FIRESTORE (${fc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw ji(r),new Error(r)}function At(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||YE(e,i,r)}function nt(t,e){return t}const Ie={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Le extends Di{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Si{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class XE{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class IM{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Xn.UNAUTHENTICATED)))}shutdown(){}}class kM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class DM{constructor(e){this.t=e,this.currentUser=Xn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){At(this.o===void 0,42304);let r=this.i;const i=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new Si;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Si,e.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await i(this.currentUser)}))},d=h=>{Ue("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>d(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?d(h):(Ue("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Si)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Ue("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(At(typeof r.accessToken=="string",31837,{l:r}),new XE(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return At(e===null||typeof e=="string",2055,{h:e}),new Xn(e)}}class MM{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Xn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class OM{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new MM(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Xn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Uw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class NM{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,us(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){At(this.o===void 0,3512);const r=o=>{o.error!=null&&Ue("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Ue("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const i=o=>{Ue("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>i(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):Ue("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Uw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(At(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Uw(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function PM(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class p_{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=PM(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%62))}return r}}function gt(t,e){return t<e?-1:t>e?1:0}function Ey(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),o=e.charAt(r);if(i!==o)return Gg(i)===Gg(o)?gt(i,o):Gg(i)?1:-1}return gt(t.length,e.length)}const BM=55296,zM=57343;function Gg(t){const e=t.charCodeAt(0);return e>=BM&&e<=zM}function Xl(t,e,n){return t.length===e.length&&t.every(((r,i)=>n(r,e[i])))}const Fw="__name__";class Ls{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ze(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Ze(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Ls.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Ls?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=Ls.compareSegments(e.get(i),n.get(i));if(o!==0)return o}return gt(e.length,n.length)}static compareSegments(e,n){const r=Ls.isNumericId(e),i=Ls.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?Ls.extractNumericId(e).compare(Ls.extractNumericId(n)):Ey(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ja.fromString(e.substring(4,e.length-2))}}class Vt extends Ls{construct(e,n,r){return new Vt(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Le(Ie.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((i=>i.length>0)))}return new Vt(n)}static emptyPath(){return new Vt([])}}const LM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Vn extends Ls{construct(e,n,r){return new Vn(e,n,r)}static isValidIdentifier(e){return LM.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Vn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Fw}static keyField(){return new Vn([Fw])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new Le(Ie.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;i<e.length;){const d=e[i];if(d==="\\"){if(i+1===e.length)throw new Le(Ie.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Le(Ie.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else d==="`"?(l=!l,i++):d!=="."||l?(r+=d,i++):(o(),i++)}if(o(),l)throw new Le(Ie.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Vn(n)}static emptyPath(){return new Vn([])}}class Qe{constructor(e){this.path=e}static fromPath(e){return new Qe(Vt.fromString(e))}static fromName(e){return new Qe(Vt.fromString(e).popFirst(5))}static empty(){return new Qe(Vt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Vt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Vt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Qe(new Vt(e.slice()))}}function ZE(t,e,n){if(!n)throw new Le(Ie.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function UM(t,e,n,r){if(e===!0&&r===!0)throw new Le(Ie.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Vw(t){if(!Qe.isDocumentKey(t))throw new Le(Ie.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function $w(t){if(Qe.isDocumentKey(t))throw new Le(Ie.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function JE(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Jf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ze(12329,{type:typeof t})}function ms(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Le(Ie.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Jf(t);throw new Le(Ie.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function wn(t,e){const n={typeString:t};return e&&(n.value=e),n}function ld(t,e){if(!JE(t))throw new Le(Ie.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(i&&typeof l!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Le(Ie.INVALID_ARGUMENT,n);return!0}const qw=-62135596800,Hw=1e6;class Gt{static now(){return Gt.fromMillis(Date.now())}static fromDate(e){return Gt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Hw);return new Gt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<qw)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Le(Ie.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Hw}_compareTo(e){return this.seconds===e.seconds?gt(this.nanoseconds,e.nanoseconds):gt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Gt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ld(e,Gt._jsonSchema))return new Gt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-qw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Gt._jsonSchemaVersion="firestore/timestamp/1.0",Gt._jsonSchema={type:wn("string",Gt._jsonSchemaVersion),seconds:wn("number"),nanoseconds:wn("number")};class et{static fromTimestamp(e){return new et(e)}static min(){return new et(new Gt(0,0))}static max(){return new et(new Gt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const $u=-1;function FM(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=et.fromTimestamp(r===1e9?new Gt(n+1,0):new Gt(n,r));return new Da(i,Qe.empty(),e)}function VM(t){return new Da(t.readTime,t.key,$u)}class Da{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Da(et.min(),Qe.empty(),$u)}static max(){return new Da(et.max(),Qe.empty(),$u)}}function $M(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Qe.comparator(t.documentKey,e.documentKey),n!==0?n:gt(t.largestBatchId,e.largestBatchId))}const qM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class HM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function mc(t){if(t.code!==Ie.FAILED_PRECONDITION||t.message!==qM)throw t;Ue("LocalStore","Unexpectedly lost primary lease")}class De{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ze(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new De(((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof De?n:De.resolve(n)}catch(n){return De.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):De.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):De.reject(n)}static resolve(e){return new De(((n,r)=>{n(e)}))}static reject(e){return new De(((n,r)=>{r(e)}))}static waitFor(e){return new De(((n,r)=>{let i=0,o=0,l=!1;e.forEach((d=>{++i,d.next((()=>{++o,l&&o===i&&n()}),(h=>r(h)))})),l=!0,o===i&&n()}))}static or(e){let n=De.resolve(!1);for(const r of e)n=n.next((i=>i?De.resolve(i):r()));return n}static forEach(e,n){const r=[];return e.forEach(((i,o)=>{r.push(n.call(this,i,o))})),this.waitFor(r)}static mapArray(e,n){return new De(((r,i)=>{const o=e.length,l=new Array(o);let d=0;for(let h=0;h<o;h++){const f=h;n(e[f]).next((p=>{l[f]=p,++d,d===o&&r(l)}),(p=>i(p)))}}))}static doWhile(e,n){return new De(((r,i)=>{const o=()=>{e()===!0?n().next((()=>{o()}),i):r()};o()}))}}function GM(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function pc(t){return t.name==="IndexedDbTransactionError"}class em{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}em.ce=-1;const g_=-1;function tm(t){return t==null}function Tf(t){return t===0&&1/t==-1/0}function WM(t){return typeof t=="number"&&Number.isInteger(t)&&!Tf(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const eC="";function QM(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Gw(e)),e=KM(t.get(n),e);return Gw(e)}function KM(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case eC:n+="";break;default:n+=o}}return n}function Gw(t){return t+eC+""}function Ww(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function $a(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function tC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class tn{constructor(e,n){this.comparator=e,this.root=n||Un.EMPTY}insert(e,n){return new tn(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Un.BLACK,null,null))}remove(e){return new tn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Un.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Yh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Yh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Yh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Yh(this.root,e,this.comparator,!0)}}class Yh{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Un{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Un.RED,this.left=i??Un.EMPTY,this.right=o??Un.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new Un(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Un.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Un.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Un.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Un.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ze(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ze(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ze(27949);return e+(this.isRed()?0:1)}}Un.EMPTY=null,Un.RED=!0,Un.BLACK=!1;Un.EMPTY=new class{constructor(){this.size=0}get key(){throw Ze(57766)}get value(){throw Ze(16141)}get color(){throw Ze(16727)}get left(){throw Ze(29726)}get right(){throw Ze(36894)}copy(e,n,r,i,o){return this}insert(e,n,r){return new Un(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class An{constructor(e){this.comparator=e,this.data=new tn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Qw(this.data.getIterator())}getIteratorFrom(e){return new Qw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof An)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new An(this.comparator);return n.data=e,n}}class Qw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class kr{constructor(e){this.fields=e,e.sort(Vn.comparator)}static empty(){return new kr([])}unionWith(e){let n=new An(Vn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new kr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Xl(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class nC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Hn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new nC("Invalid base64 string: "+o):o}})(e);return new Hn(n)}static fromUint8Array(e){const n=(function(i){let o="";for(let l=0;l<i.length;++l)o+=String.fromCharCode(i[l]);return o})(e);return new Hn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return gt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Hn.EMPTY_BYTE_STRING=new Hn("");const YM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ma(t){if(At(!!t,39018),typeof t=="string"){let e=0;const n=YM.exec(t);if(At(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:cn(t.seconds),nanos:cn(t.nanos)}}function cn(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Oa(t){return typeof t=="string"?Hn.fromBase64String(t):Hn.fromUint8Array(t)}const rC="server_timestamp",sC="__type__",iC="__previous_value__",aC="__local_write_time__";function y_(t){return(t?.mapValue?.fields||{})[sC]?.stringValue===rC}function nm(t){const e=t.mapValue.fields[iC];return y_(e)?nm(e):e}function qu(t){const e=Ma(t.mapValue.fields[aC].timestampValue);return new Gt(e.seconds,e.nanos)}class XM{constructor(e,n,r,i,o,l,d,h,f,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=d,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=p}}const Af="(default)";class Hu{constructor(e,n){this.projectId=e,this.database=n||Af}static empty(){return new Hu("","")}get isDefaultDatabase(){return this.database===Af}isEqual(e){return e instanceof Hu&&e.projectId===this.projectId&&e.database===this.database}}const oC="__type__",ZM="__max__",Xh={mapValue:{}},lC="__vector__",jf="value";function Na(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?y_(t)?4:eO(t)?9007199254740991:JM(t)?10:11:Ze(28295,{value:t})}function Ks(t,e){if(t===e)return!0;const n=Na(t);if(n!==Na(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return qu(t).isEqual(qu(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const l=Ma(i.timestampValue),d=Ma(o.timestampValue);return l.seconds===d.seconds&&l.nanos===d.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(i,o){return Oa(i.bytesValue).isEqual(Oa(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(i,o){return cn(i.geoPointValue.latitude)===cn(o.geoPointValue.latitude)&&cn(i.geoPointValue.longitude)===cn(o.geoPointValue.longitude)})(t,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return cn(i.integerValue)===cn(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const l=cn(i.doubleValue),d=cn(o.doubleValue);return l===d?Tf(l)===Tf(d):isNaN(l)&&isNaN(d)}return!1})(t,e);case 9:return Xl(t.arrayValue.values||[],e.arrayValue.values||[],Ks);case 10:case 11:return(function(i,o){const l=i.mapValue.fields||{},d=o.mapValue.fields||{};if(Ww(l)!==Ww(d))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(d[h]===void 0||!Ks(l[h],d[h])))return!1;return!0})(t,e);default:return Ze(52216,{left:t})}}function Gu(t,e){return(t.values||[]).find((n=>Ks(n,e)))!==void 0}function Zl(t,e){if(t===e)return 0;const n=Na(t),r=Na(e);if(n!==r)return gt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return gt(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const d=cn(o.integerValue||o.doubleValue),h=cn(l.integerValue||l.doubleValue);return d<h?-1:d>h?1:d===h?0:isNaN(d)?isNaN(h)?0:-1:1})(t,e);case 3:return Kw(t.timestampValue,e.timestampValue);case 4:return Kw(qu(t),qu(e));case 5:return Ey(t.stringValue,e.stringValue);case 6:return(function(o,l){const d=Oa(o),h=Oa(l);return d.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const d=o.split("/"),h=l.split("/");for(let f=0;f<d.length&&f<h.length;f++){const p=gt(d[f],h[f]);if(p!==0)return p}return gt(d.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const d=gt(cn(o.latitude),cn(l.latitude));return d!==0?d:gt(cn(o.longitude),cn(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return Yw(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const d=o.fields||{},h=l.fields||{},f=d[jf]?.arrayValue,p=h[jf]?.arrayValue,g=gt(f?.values?.length||0,p?.values?.length||0);return g!==0?g:Yw(f,p)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===Xh.mapValue&&l===Xh.mapValue)return 0;if(o===Xh.mapValue)return 1;if(l===Xh.mapValue)return-1;const d=o.fields||{},h=Object.keys(d),f=l.fields||{},p=Object.keys(f);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const b=Ey(h[g],p[g]);if(b!==0)return b;const _=Zl(d[h[g]],f[p[g]]);if(_!==0)return _}return gt(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Ze(23264,{he:n})}}function Kw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return gt(t,e);const n=Ma(t),r=Ma(e),i=gt(n.seconds,r.seconds);return i!==0?i:gt(n.nanos,r.nanos)}function Yw(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=Zl(n[i],r[i]);if(o)return o}return gt(n.length,r.length)}function Jl(t){return Cy(t)}function Cy(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=Ma(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return Oa(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return Qe.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=Cy(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const l of r)o?o=!1:i+=",",i+=`${l}:${Cy(n.fields[l])}`;return i+"}"})(t.mapValue):Ze(61005,{value:t})}function uf(t){switch(Na(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=nm(t);return e?16+uf(e):16;case 5:return 2*t.stringValue.length;case 6:return Oa(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,o)=>i+uf(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let i=0;return $a(r.fields,((o,l)=>{i+=o.length+uf(l)})),i})(t.mapValue);default:throw Ze(13486,{value:t})}}function Xw(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ty(t){return!!t&&"integerValue"in t}function __(t){return!!t&&"arrayValue"in t}function Zw(t){return!!t&&"nullValue"in t}function Jw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function df(t){return!!t&&"mapValue"in t}function JM(t){return(t?.mapValue?.fields||{})[oC]?.stringValue===lC}function Ou(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return $a(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Ou(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ou(t.arrayValue.values[n]);return e}return{...t}}function eO(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===ZM}class _r{constructor(e){this.value=e}static empty(){return new _r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!df(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ou(n)}setAll(e){let n=Vn.emptyPath(),r={},i=[];e.forEach(((l,d)=>{if(!n.isImmediateParentOf(d)){const h=this.getFieldsMap(n);this.applyChanges(h,r,i),r={},i=[],n=d.popLast()}l?r[d.lastSegment()]=Ou(l):i.push(d.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());df(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Ks(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];df(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){$a(n,((i,o)=>e[i]=o));for(const i of r)delete e[i]}clone(){return new _r(Ou(this.value))}}function cC(t){const e=[];return $a(t.fields,((n,r)=>{const i=new Vn([n]);if(df(r)){const o=cC(r.mapValue).fields;if(o.length===0)e.push(i);else for(const l of o)e.push(i.child(l))}else e.push(i)})),new kr(e)}class Zn{constructor(e,n,r,i,o,l,d){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=l,this.documentState=d}static newInvalidDocument(e){return new Zn(e,0,et.min(),et.min(),et.min(),_r.empty(),0)}static newFoundDocument(e,n,r,i){return new Zn(e,1,n,et.min(),r,i,0)}static newNoDocument(e,n){return new Zn(e,2,n,et.min(),et.min(),_r.empty(),0)}static newUnknownDocument(e,n){return new Zn(e,3,n,et.min(),et.min(),_r.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(et.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_r.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_r.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=et.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Zn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Zn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Rf{constructor(e,n){this.position=e,this.inclusive=n}}function eS(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],l=t.position[i];if(o.field.isKeyField()?r=Qe.comparator(Qe.fromName(l.referenceValue),n.key):r=Zl(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function tS(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ks(t.position[n],e.position[n]))return!1;return!0}class If{constructor(e,n="asc"){this.field=e,this.dir=n}}function tO(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class uC{}class xn extends uC{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new rO(e,n,r):n==="array-contains"?new aO(e,r):n==="in"?new oO(e,r):n==="not-in"?new lO(e,r):n==="array-contains-any"?new cO(e,r):new xn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new sO(e,r):new iO(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Zl(n,this.value)):n!==null&&Na(this.value)===Na(n)&&this.matchesComparison(Zl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ze(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ps extends uC{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ps(e,n)}matches(e){return dC(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function dC(t){return t.op==="and"}function hC(t){return nO(t)&&dC(t)}function nO(t){for(const e of t.filters)if(e instanceof ps)return!1;return!0}function Ay(t){if(t instanceof xn)return t.field.canonicalString()+t.op.toString()+Jl(t.value);if(hC(t))return t.filters.map((e=>Ay(e))).join(",");{const e=t.filters.map((n=>Ay(n))).join(",");return`${t.op}(${e})`}}function fC(t,e){return t instanceof xn?(function(r,i){return i instanceof xn&&r.op===i.op&&r.field.isEqual(i.field)&&Ks(r.value,i.value)})(t,e):t instanceof ps?(function(r,i){return i instanceof ps&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((o,l,d)=>o&&fC(l,i.filters[d])),!0):!1})(t,e):void Ze(19439)}function mC(t){return t instanceof xn?(function(n){return`${n.field.canonicalString()} ${n.op} ${Jl(n.value)}`})(t):t instanceof ps?(function(n){return n.op.toString()+" {"+n.getFilters().map(mC).join(" ,")+"}"})(t):"Filter"}class rO extends xn{constructor(e,n,r){super(e,n,r),this.key=Qe.fromName(r.referenceValue)}matches(e){const n=Qe.comparator(e.key,this.key);return this.matchesComparison(n)}}class sO extends xn{constructor(e,n){super(e,"in",n),this.keys=pC("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class iO extends xn{constructor(e,n){super(e,"not-in",n),this.keys=pC("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function pC(t,e){return(e.arrayValue?.values||[]).map((n=>Qe.fromName(n.referenceValue)))}class aO extends xn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return __(n)&&Gu(n.arrayValue,this.value)}}class oO extends xn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Gu(this.value.arrayValue,n)}}class lO extends xn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Gu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Gu(this.value.arrayValue,n)}}class cO extends xn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!__(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Gu(this.value.arrayValue,r)))}}class uO{constructor(e,n=null,r=[],i=[],o=null,l=null,d=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=l,this.endAt=d,this.Te=null}}function nS(t,e=null,n=[],r=[],i=null,o=null,l=null){return new uO(t,e,n,r,i,o,l)}function b_(t){const e=nt(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>Ay(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),tm(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>Jl(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>Jl(r))).join(",")),e.Te=n}return e.Te}function v_(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!tO(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!fC(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!tS(t.startAt,e.startAt)&&tS(t.endAt,e.endAt)}function jy(t){return Qe.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class cd{constructor(e,n=null,r=[],i=[],o=null,l="F",d=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=l,this.startAt=d,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function dO(t,e,n,r,i,o,l,d){return new cd(t,e,n,r,i,o,l,d)}function x_(t){return new cd(t)}function rS(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function gC(t){return t.collectionGroup!==null}function Nu(t){const e=nt(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let d=new An(Vn.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(d=d.add(f.field))}))})),d})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new If(o,r))})),n.has(Vn.keyField().canonicalString())||e.Ie.push(new If(Vn.keyField(),r))}return e.Ie}function $s(t){const e=nt(t);return e.Ee||(e.Ee=hO(e,Nu(t))),e.Ee}function hO(t,e){if(t.limitType==="F")return nS(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((i=>{const o=i.dir==="desc"?"asc":"desc";return new If(i.field,o)}));const n=t.endAt?new Rf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Rf(t.startAt.position,t.startAt.inclusive):null;return nS(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Ry(t,e){const n=t.filters.concat([e]);return new cd(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Iy(t,e,n){return new cd(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function rm(t,e){return v_($s(t),$s(e))&&t.limitType===e.limitType}function yC(t){return`${b_($s(t))}|lt:${t.limitType}`}function Ll(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((i=>mC(i))).join(", ")}]`),tm(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((i=>Jl(i))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((i=>Jl(i))).join(",")),`Target(${r})`})($s(t))}; limitType=${t.limitType})`}function sm(t,e){return e.isFoundDocument()&&(function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):Qe.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,i){for(const o of Nu(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0})(t,e)&&(function(r,i){return!(r.startAt&&!(function(l,d,h){const f=eS(l,d,h);return l.inclusive?f<=0:f<0})(r.startAt,Nu(r),i)||r.endAt&&!(function(l,d,h){const f=eS(l,d,h);return l.inclusive?f>=0:f>0})(r.endAt,Nu(r),i))})(t,e)}function fO(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function _C(t){return(e,n)=>{let r=!1;for(const i of Nu(t)){const o=mO(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function mO(t,e,n){const r=t.field.isKeyField()?Qe.comparator(e.key,n.key):(function(o,l,d){const h=l.data.field(o),f=d.data.field(o);return h!==null&&f!==null?Zl(h,f):Ze(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ze(19790,{direction:t.dir})}}class Vo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){$a(this.inner,((n,r)=>{for(const[i,o]of r)e(i,o)}))}isEmpty(){return tC(this.inner)}size(){return this.innerSize}}const pO=new tn(Qe.comparator);function Ri(){return pO}const bC=new tn(Qe.comparator);function Ru(...t){let e=bC;for(const n of t)e=e.insert(n.key,n);return e}function vC(t){let e=bC;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function Ro(){return Pu()}function xC(){return Pu()}function Pu(){return new Vo((t=>t.toString()),((t,e)=>t.isEqual(e)))}const gO=new tn(Qe.comparator),yO=new An(Qe.comparator);function yt(...t){let e=yO;for(const n of t)e=e.add(n);return e}const _O=new An(gt);function bO(){return _O}function w_(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Tf(e)?"-0":e}}function wC(t){return{integerValue:""+t}}function vO(t,e){return WM(e)?wC(e):w_(t,e)}class im{constructor(){this._=void 0}}function xO(t,e,n){return t instanceof kf?(function(i,o){const l={fields:{[sC]:{stringValue:rC},[aC]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&y_(o)&&(o=nm(o)),o&&(l.fields[iC]=o),{mapValue:l}})(n,e):t instanceof ec?EC(t,e):t instanceof tc?CC(t,e):(function(i,o){const l=SC(i,o),d=sS(l)+sS(i.Ae);return Ty(l)&&Ty(i.Ae)?wC(d):w_(i.serializer,d)})(t,e)}function wO(t,e,n){return t instanceof ec?EC(t,e):t instanceof tc?CC(t,e):n}function SC(t,e){return t instanceof Df?(function(r){return Ty(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class kf extends im{}class ec extends im{constructor(e){super(),this.elements=e}}function EC(t,e){const n=TC(e);for(const r of t.elements)n.some((i=>Ks(i,r)))||n.push(r);return{arrayValue:{values:n}}}class tc extends im{constructor(e){super(),this.elements=e}}function CC(t,e){let n=TC(e);for(const r of t.elements)n=n.filter((i=>!Ks(i,r)));return{arrayValue:{values:n}}}class Df extends im{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function sS(t){return cn(t.integerValue||t.doubleValue)}function TC(t){return __(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class AC{constructor(e,n){this.field=e,this.transform=n}}function SO(t,e){return t.field.isEqual(e.field)&&(function(r,i){return r instanceof ec&&i instanceof ec||r instanceof tc&&i instanceof tc?Xl(r.elements,i.elements,Ks):r instanceof Df&&i instanceof Df?Ks(r.Ae,i.Ae):r instanceof kf&&i instanceof kf})(t.transform,e.transform)}class EO{constructor(e,n){this.version=e,this.transformResults=n}}class vr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new vr}static exists(e){return new vr(void 0,e)}static updateTime(e){return new vr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function hf(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class am{}function jC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new om(t.key,vr.none()):new ud(t.key,t.data,vr.none());{const n=t.data,r=_r.empty();let i=new An(Vn.comparator);for(let o of e.fields)if(!i.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),i=i.add(o)}return new qa(t.key,r,new kr(i.toArray()),vr.none())}}function CO(t,e,n){t instanceof ud?(function(i,o,l){const d=i.value.clone(),h=aS(i.fieldTransforms,o,l.transformResults);d.setAll(h),o.convertToFoundDocument(l.version,d).setHasCommittedMutations()})(t,e,n):t instanceof qa?(function(i,o,l){if(!hf(i.precondition,o))return void o.convertToUnknownDocument(l.version);const d=aS(i.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(RC(i)),h.setAll(d),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(i,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function Bu(t,e,n,r){return t instanceof ud?(function(o,l,d,h){if(!hf(o.precondition,l))return d;const f=o.value.clone(),p=oS(o.fieldTransforms,h,l);return f.setAll(p),l.convertToFoundDocument(l.version,f).setHasLocalMutations(),null})(t,e,n,r):t instanceof qa?(function(o,l,d,h){if(!hf(o.precondition,l))return d;const f=oS(o.fieldTransforms,h,l),p=l.data;return p.setAll(RC(o)),p.setAll(f),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),d===null?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,l,d){return hf(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):d})(t,e,n)}function TO(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=SC(r.transform,i||null);o!=null&&(n===null&&(n=_r.empty()),n.set(r.field,o))}return n||null}function iS(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Xl(r,i,((o,l)=>SO(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class ud extends am{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class qa extends am{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function RC(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function aS(t,e,n){const r=new Map;At(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const o=t[i],l=o.transform,d=e.data.field(o.field);r.set(o.field,wO(l,d,n[i]))}return r}function oS(t,e,n){const r=new Map;for(const i of t){const o=i.transform,l=n.data.field(i.field);r.set(i.field,xO(o,l,e))}return r}class om extends am{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class AO extends am{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class jO{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&CO(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Bu(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Bu(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=xC();return this.mutations.forEach((i=>{const o=e.get(i.key),l=o.overlayedDocument;let d=this.applyToLocalView(l,o.mutatedFields);d=n.has(i.key)?null:d;const h=jC(l,d);h!==null&&r.set(i.key,h),l.isValidDocument()||l.convertToNoDocument(et.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),yt())}isEqual(e){return this.batchId===e.batchId&&Xl(this.mutations,e.mutations,((n,r)=>iS(n,r)))&&Xl(this.baseMutations,e.baseMutations,((n,r)=>iS(n,r)))}}class S_{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){At(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return gO})();const o=e.mutations;for(let l=0;l<o.length;l++)i=i.insert(o[l].key,r[l].version);return new S_(e,n,r,i)}}class RO{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class IO{constructor(e,n){this.count=e,this.unchangedNames=n}}var vn,bt;function kO(t){switch(t){case Ie.OK:return Ze(64938);case Ie.CANCELLED:case Ie.UNKNOWN:case Ie.DEADLINE_EXCEEDED:case Ie.RESOURCE_EXHAUSTED:case Ie.INTERNAL:case Ie.UNAVAILABLE:case Ie.UNAUTHENTICATED:return!1;case Ie.INVALID_ARGUMENT:case Ie.NOT_FOUND:case Ie.ALREADY_EXISTS:case Ie.PERMISSION_DENIED:case Ie.FAILED_PRECONDITION:case Ie.ABORTED:case Ie.OUT_OF_RANGE:case Ie.UNIMPLEMENTED:case Ie.DATA_LOSS:return!0;default:return Ze(15467,{code:t})}}function IC(t){if(t===void 0)return ji("GRPC error has no .code"),Ie.UNKNOWN;switch(t){case vn.OK:return Ie.OK;case vn.CANCELLED:return Ie.CANCELLED;case vn.UNKNOWN:return Ie.UNKNOWN;case vn.DEADLINE_EXCEEDED:return Ie.DEADLINE_EXCEEDED;case vn.RESOURCE_EXHAUSTED:return Ie.RESOURCE_EXHAUSTED;case vn.INTERNAL:return Ie.INTERNAL;case vn.UNAVAILABLE:return Ie.UNAVAILABLE;case vn.UNAUTHENTICATED:return Ie.UNAUTHENTICATED;case vn.INVALID_ARGUMENT:return Ie.INVALID_ARGUMENT;case vn.NOT_FOUND:return Ie.NOT_FOUND;case vn.ALREADY_EXISTS:return Ie.ALREADY_EXISTS;case vn.PERMISSION_DENIED:return Ie.PERMISSION_DENIED;case vn.FAILED_PRECONDITION:return Ie.FAILED_PRECONDITION;case vn.ABORTED:return Ie.ABORTED;case vn.OUT_OF_RANGE:return Ie.OUT_OF_RANGE;case vn.UNIMPLEMENTED:return Ie.UNIMPLEMENTED;case vn.DATA_LOSS:return Ie.DATA_LOSS;default:return Ze(39323,{code:t})}}(bt=vn||(vn={}))[bt.OK=0]="OK",bt[bt.CANCELLED=1]="CANCELLED",bt[bt.UNKNOWN=2]="UNKNOWN",bt[bt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bt[bt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bt[bt.NOT_FOUND=5]="NOT_FOUND",bt[bt.ALREADY_EXISTS=6]="ALREADY_EXISTS",bt[bt.PERMISSION_DENIED=7]="PERMISSION_DENIED",bt[bt.UNAUTHENTICATED=16]="UNAUTHENTICATED",bt[bt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bt[bt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bt[bt.ABORTED=10]="ABORTED",bt[bt.OUT_OF_RANGE=11]="OUT_OF_RANGE",bt[bt.UNIMPLEMENTED=12]="UNIMPLEMENTED",bt[bt.INTERNAL=13]="INTERNAL",bt[bt.UNAVAILABLE=14]="UNAVAILABLE",bt[bt.DATA_LOSS=15]="DATA_LOSS";function DO(){return new TextEncoder}const MO=new ja([4294967295,4294967295],0);function lS(t){const e=DO().encode(t),n=new qE;return n.update(e),new Uint8Array(n.digest())}function cS(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new ja([n,r],0),new ja([i,o],0)]}class E_{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Iu(`Invalid padding: ${n}`);if(r<0)throw new Iu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Iu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Iu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=ja.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(ja.fromNumber(r)));return i.compare(MO)===1&&(i=new ja([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=lS(e),[r,i]=cS(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new E_(o,i,n);return r.forEach((d=>l.insert(d))),l}insert(e){if(this.ge===0)return;const n=lS(e),[r,i]=cS(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Iu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class lm{constructor(e,n,r,i,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,dd.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new lm(et.min(),i,new tn(gt),Ri(),yt())}}class dd{constructor(e,n,r,i,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new dd(r,n,yt(),yt(),yt())}}class ff{constructor(e,n,r,i){this.be=e,this.removedTargetIds=n,this.key=r,this.De=i}}class kC{constructor(e,n){this.targetId=e,this.Ce=n}}class DC{constructor(e,n,r=Hn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class uS{constructor(){this.ve=0,this.Fe=dS(),this.Me=Hn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=yt(),n=yt(),r=yt();return this.Fe.forEach(((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Ze(38017,{changeType:o})}})),new dd(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=dS()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,At(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class OO{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ri(),this.Je=Zh(),this.He=Zh(),this.Ye=new tn(gt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Ze(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,i)=>{this.rt(i)&&n(i)}))}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const o=i.target;if(jy(o))if(r===0){const l=new Qe(o.path);this.et(n,l,Zn.newNoDocument(l,et.min()))}else At(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const d=this.ut(e),h=d?this.ct(d,e,l):1;if(h!==0){this.it(n);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,f)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let l,d;try{l=Oa(r).toUint8Array()}catch(h){if(h instanceof nC)return Yl("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{d=new E_(l,i,o)}catch(h){return Yl(h instanceof Iu?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return d.ge===0?null:d}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach((o=>{const l=this.Ge.ht(),d=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.et(n,o,null),i++)})),i}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const d=this.ot(l);if(d){if(o.current&&jy(d.target)){const h=new Qe(d.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Zn.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=yt();this.He.forEach(((o,l)=>{let d=!0;l.forEachWhile((h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const i=new lm(e,n,this.Ye,this.je,r);return this.je=Ri(),this.Je=Zh(),this.He=Zh(),this.Ye=new tn(gt),i}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.Qe(n,1):i.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new uS,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new An(gt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new An(gt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Ue("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new uS),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Zh(){return new tn(Qe.comparator)}function dS(){return new tn(Qe.comparator)}const NO={asc:"ASCENDING",desc:"DESCENDING"},PO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},BO={and:"AND",or:"OR"};class zO{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function ky(t,e){return t.useProto3Json||tm(e)?e:{value:e}}function Mf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function MC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function LO(t,e){return Mf(t,e.toTimestamp())}function qs(t){return At(!!t,49232),et.fromTimestamp((function(n){const r=Ma(n);return new Gt(r.seconds,r.nanos)})(t))}function C_(t,e){return Dy(t,e).canonicalString()}function Dy(t,e){const n=(function(i){return new Vt(["projects",i.projectId,"databases",i.database])})(t).child("documents");return e===void 0?n:n.child(e)}function OC(t){const e=Vt.fromString(t);return At(LC(e),10190,{key:e.toString()}),e}function My(t,e){return C_(t.databaseId,e.path)}function Wg(t,e){const n=OC(e);if(n.get(1)!==t.databaseId.projectId)throw new Le(Ie.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Le(Ie.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Qe(PC(n))}function NC(t,e){return C_(t.databaseId,e)}function UO(t){const e=OC(t);return e.length===4?Vt.emptyPath():PC(e)}function Oy(t){return new Vt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function PC(t){return At(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function hS(t,e,n){return{name:My(t,e),fields:n.value.mapValue.fields}}function FO(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:Ze(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(f,p){return f.useProto3Json?(At(p===void 0||typeof p=="string",58123),Hn.fromBase64String(p||"")):(At(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Hn.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,d=l&&(function(f){const p=f.code===void 0?Ie.UNKNOWN:IC(f.code);return new Le(p,f.message||"")})(l);n=new DC(r,i,o,d||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Wg(t,r.document.name),o=qs(r.document.updateTime),l=r.document.createTime?qs(r.document.createTime):et.min(),d=new _r({mapValue:{fields:r.document.fields}}),h=Zn.newFoundDocument(i,o,l,d),f=r.targetIds||[],p=r.removedTargetIds||[];n=new ff(f,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Wg(t,r.document),o=r.readTime?qs(r.readTime):et.min(),l=Zn.newNoDocument(i,o),d=r.removedTargetIds||[];n=new ff([],d,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Wg(t,r.document),o=r.removedTargetIds||[];n=new ff([],o,i,null)}else{if(!("filter"in e))return Ze(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,l=new IO(i,o),d=r.targetId;n=new kC(d,l)}}return n}function VO(t,e){let n;if(e instanceof ud)n={update:hS(t,e.key,e.value)};else if(e instanceof om)n={delete:My(t,e.key)};else if(e instanceof qa)n={update:hS(t,e.key,e.data),updateMask:XO(e.fieldMask)};else{if(!(e instanceof AO))return Ze(16599,{Vt:e.type});n={verify:My(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const d=l.transform;if(d instanceof kf)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof ec)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof tc)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof Df)return{fieldPath:l.field.canonicalString(),increment:d.Ae};throw Ze(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:LO(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Ze(27497)})(t,e.precondition)),n}function $O(t,e){return t&&t.length>0?(At(e!==void 0,14353),t.map((n=>(function(i,o){let l=i.updateTime?qs(i.updateTime):qs(o);return l.isEqual(et.min())&&(l=qs(o)),new EO(l,i.transformResults||[])})(n,e)))):[]}function qO(t,e){return{documents:[NC(t,e.path)]}}function HO(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=NC(t,i);const o=(function(f){if(f.length!==0)return zC(ps.create(f,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(f){if(f.length!==0)return f.map((p=>(function(b){return{field:Ul(b.field),direction:QO(b.dir)}})(p)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const d=ky(t,e.limit);return d!==null&&(n.structuredQuery.limit=d),e.startAt&&(n.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:n,parent:i}}function GO(t){let e=UO(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){At(r===1,65062);const p=n.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const b=BC(g);return b instanceof ps&&hC(b)?b.getFilters():[b]})(n.where));let l=[];n.orderBy&&(l=(function(g){return g.map((b=>(function(w){return new If(Fl(w.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(w.direction))})(b)))})(n.orderBy));let d=null;n.limit&&(d=(function(g){let b;return b=typeof g=="object"?g.value:g,tm(b)?null:b})(n.limit));let h=null;n.startAt&&(h=(function(g){const b=!!g.before,_=g.values||[];return new Rf(_,b)})(n.startAt));let f=null;return n.endAt&&(f=(function(g){const b=!g.before,_=g.values||[];return new Rf(_,b)})(n.endAt)),dO(e,i,l,o,d,"F",h,f)}function WO(t,e){const n=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ze(28987,{purpose:i})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function BC(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Fl(n.unaryFilter.field);return xn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Fl(n.unaryFilter.field);return xn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Fl(n.unaryFilter.field);return xn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Fl(n.unaryFilter.field);return xn.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ze(61313);default:return Ze(60726)}})(t):t.fieldFilter!==void 0?(function(n){return xn.create(Fl(n.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ze(58110);default:return Ze(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return ps.create(n.compositeFilter.filters.map((r=>BC(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ze(1026)}})(n.compositeFilter.op))})(t):Ze(30097,{filter:t})}function QO(t){return NO[t]}function KO(t){return PO[t]}function YO(t){return BO[t]}function Ul(t){return{fieldPath:t.canonicalString()}}function Fl(t){return Vn.fromServerFormat(t.fieldPath)}function zC(t){return t instanceof xn?(function(n){if(n.op==="=="){if(Jw(n.value))return{unaryFilter:{field:Ul(n.field),op:"IS_NAN"}};if(Zw(n.value))return{unaryFilter:{field:Ul(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Jw(n.value))return{unaryFilter:{field:Ul(n.field),op:"IS_NOT_NAN"}};if(Zw(n.value))return{unaryFilter:{field:Ul(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ul(n.field),op:KO(n.op),value:n.value}}})(t):t instanceof ps?(function(n){const r=n.getFilters().map((i=>zC(i)));return r.length===1?r[0]:{compositeFilter:{op:YO(n.op),filters:r}}})(t):Ze(54877,{filter:t})}function XO(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function LC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class ba{constructor(e,n,r,i,o=et.min(),l=et.min(),d=Hn.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=d,this.expectedCount=h}withSequenceNumber(e){return new ba(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ba(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ba(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ba(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ZO{constructor(e){this.yt=e}}function JO(t){const e=GO({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Iy(e,e.limit,"L"):e}class eN{constructor(){this.Cn=new tN}addToCollectionParentIndex(e,n){return this.Cn.add(n),De.resolve()}getCollectionParents(e,n){return De.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return De.resolve()}deleteFieldIndex(e,n){return De.resolve()}deleteAllFieldIndexes(e){return De.resolve()}createTargetIndexes(e,n){return De.resolve()}getDocumentsMatchingTarget(e,n){return De.resolve(null)}getIndexType(e,n){return De.resolve(0)}getFieldIndexes(e,n){return De.resolve([])}getNextCollectionGroupToUpdate(e){return De.resolve(null)}getMinOffset(e,n){return De.resolve(Da.min())}getMinOffsetFromCollectionGroup(e,n){return De.resolve(Da.min())}updateCollectionGroup(e,n,r){return De.resolve()}updateIndexEntries(e,n){return De.resolve()}}class tN{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new An(Vt.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new An(Vt.comparator)).toArray()}}const fS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},UC=41943040;class yr{static withCacheSize(e){return new yr(e,yr.DEFAULT_COLLECTION_PERCENTILE,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}yr.DEFAULT_COLLECTION_PERCENTILE=10,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yr.DEFAULT=new yr(UC,yr.DEFAULT_COLLECTION_PERCENTILE,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yr.DISABLED=new yr(-1,0,0);class nc{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new nc(0)}static cr(){return new nc(-1)}}const mS="LruGarbageCollector",nN=1048576;function pS([t,e],[n,r]){const i=gt(t,n);return i===0?gt(e,r):i}class rN{constructor(e){this.Ir=e,this.buffer=new An(pS),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();pS(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class sN{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ue(mS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){pc(n)?Ue(mS,"Ignoring IndexedDB error during garbage collection: ",n):await mc(n)}await this.Vr(3e5)}))}}class iN{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return De.resolve(em.ce);const r=new rN(n);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Ue("LruGarbageCollector","Garbage collection skipped; disabled"),De.resolve(fS)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Ue("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),fS):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,o,l,d,h,f;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Ue("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,l=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,d=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(f=Date.now(),zl()<=pt.DEBUG&&Ue("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-p}ms
	Determined least recently used ${i} in `+(d-l)+`ms
	Removed ${o} targets in `+(h-d)+`ms
	Removed ${g} documents in `+(f-h)+`ms
Total Duration: ${f-p}ms`),De.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:g}))))}}function aN(t,e){return new iN(t,e)}class oN{constructor(){this.changes=new Vo((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Zn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?De.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class lN{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class cN{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,n)))).next((i=>(r!==null&&Bu(r.mutation,i,kr.empty(),Gt.now()),i)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,yt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=yt()){const i=Ro();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,r).next((o=>{let l=Ru();return o.forEach(((d,h)=>{l=l.insert(d,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=Ro();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,yt())))}populateOverlays(e,n,r){const i=[];return r.forEach((o=>{n.has(o)||i.push(o)})),this.documentOverlayCache.getOverlays(e,i).next((o=>{o.forEach(((l,d)=>{n.set(l,d)}))}))}computeViews(e,n,r,i){let o=Ri();const l=Pu(),d=(function(){return Pu()})();return n.forEach(((h,f)=>{const p=r.get(f.key);i.has(f.key)&&(p===void 0||p.mutation instanceof qa)?o=o.insert(f.key,f):p!==void 0?(l.set(f.key,p.mutation.getFieldMask()),Bu(p.mutation,f,p.mutation.getFieldMask(),Gt.now())):l.set(f.key,kr.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((f,p)=>l.set(f,p))),n.forEach(((f,p)=>d.set(f,new lN(p,l.get(f)??null)))),d)))}recalculateAndSaveOverlays(e,n){const r=Pu();let i=new tn(((l,d)=>l-d)),o=yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const d of l)d.keys().forEach((h=>{const f=n.get(h);if(f===null)return;let p=r.get(h)||kr.empty();p=d.applyToLocalView(f,p),r.set(h,p);const g=(i.get(d.batchId)||yt()).add(h);i=i.insert(d.batchId,g)}))})).next((()=>{const l=[],d=i.getReverseIterator();for(;d.hasNext();){const h=d.getNext(),f=h.key,p=h.value,g=xC();p.forEach((b=>{if(!o.has(b)){const _=jC(n.get(b),r.get(b));_!==null&&g.set(b,_),o=o.add(b)}})),l.push(this.documentOverlayCache.saveOverlays(e,f,g))}return De.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,i){return(function(l){return Qe.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):gC(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next((o=>{const l=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):De.resolve(Ro());let d=$u,h=o;return l.next((f=>De.forEach(f,((p,g)=>(d<g.largestBatchId&&(d=g.largestBatchId),o.get(p)?De.resolve():this.remoteDocumentCache.getEntry(e,p).next((b=>{h=h.insert(p,b)}))))).next((()=>this.populateOverlays(e,f,o))).next((()=>this.computeViews(e,h,f,yt()))).next((p=>({batchId:d,changes:vC(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Qe(n)).next((r=>{let i=Ru();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let l=Ru();return this.indexManager.getCollectionParents(e,o).next((d=>De.forEach(d,(h=>{const f=(function(g,b){return new cd(b,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next((p=>{p.forEach(((g,b)=>{l=l.insert(g,b)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i)))).next((l=>{o.forEach(((h,f)=>{const p=f.getKey();l.get(p)===null&&(l=l.insert(p,Zn.newInvalidDocument(p)))}));let d=Ru();return l.forEach(((h,f)=>{const p=o.get(h);p!==void 0&&Bu(p.mutation,f,kr.empty(),Gt.now()),sm(n,f)&&(d=d.insert(h,f))})),d}))}}class uN{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return De.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(i){return{id:i.id,version:i.version,createTime:qs(i.createTime)}})(n)),De.resolve()}getNamedQuery(e,n){return De.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(i){return{name:i.name,query:JO(i.bundledQuery),readTime:qs(i.readTime)}})(n)),De.resolve()}}class dN{constructor(){this.overlays=new tn(Qe.comparator),this.qr=new Map}getOverlay(e,n){return De.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Ro();return De.forEach(n,(i=>this.getOverlay(e,i).next((o=>{o!==null&&r.set(i,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((i,o)=>{this.St(e,n,o)})),De.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),De.resolve()}getOverlaysForCollection(e,n,r){const i=Ro(),o=n.length+1,l=new Qe(n.child("")),d=this.overlays.getIteratorFrom(l);for(;d.hasNext();){const h=d.getNext().value,f=h.getKey();if(!n.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return De.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new tn(((f,p)=>f-p));const l=this.overlays.getIterator();for(;l.hasNext();){const f=l.getNext().value;if(f.getKey().getCollectionGroup()===n&&f.largestBatchId>r){let p=o.get(f.largestBatchId);p===null&&(p=Ro(),o=o.insert(f.largestBatchId,p)),p.set(f.getKey(),f)}}const d=Ro(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,p)=>d.set(f,p))),!(d.size()>=i)););return De.resolve(d)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const l=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new RO(n,r));let o=this.qr.get(n);o===void 0&&(o=yt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class hN{constructor(){this.sessionToken=Hn.EMPTY_BYTE_STRING}getSessionToken(e){return De.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,De.resolve()}}class T_{constructor(){this.Qr=new An(On.$r),this.Ur=new An(On.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new On(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new On(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new Qe(new Vt([])),r=new On(n,e),i=new On(n,e+1),o=[];return this.Ur.forEachInRange([r,i],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Qe(new Vt([])),r=new On(n,e),i=new On(n,e+1);let o=yt();return this.Ur.forEachInRange([r,i],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new On(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class On{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Qe.comparator(e.key,n.key)||gt(e.Yr,n.Yr)}static Kr(e,n){return gt(e.Yr,n.Yr)||Qe.comparator(e.key,n.key)}}class fN{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new An(On.$r)}checkEmpty(e){return De.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new jO(o,n,r,i);this.mutationQueue.push(l);for(const d of i)this.Zr=this.Zr.add(new On(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return De.resolve(l)}lookupMutationBatch(e,n){return De.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),o=i<0?0:i;return De.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return De.resolve(this.mutationQueue.length===0?g_:this.tr-1)}getAllMutationBatches(e){return De.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new On(n,0),i=new On(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],(l=>{const d=this.Xr(l.Yr);o.push(d)})),De.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new An(gt);return n.forEach((i=>{const o=new On(i,0),l=new On(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(d=>{r=r.add(d.Yr)}))})),De.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;Qe.isDocumentKey(o)||(o=o.child(""));const l=new On(new Qe(o),0);let d=new An(gt);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(d=d.add(h.Yr)),!0)}),l),De.resolve(this.ti(d))}ti(e){const n=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&n.push(i)})),n}removeMutationBatch(e,n){At(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return De.forEach(n.mutations,(i=>{const o=new On(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new On(n,0),i=this.Zr.firstAfterOrEqual(r);return De.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,De.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class mN{constructor(e){this.ri=e,this.docs=(function(){return new tn(Qe.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return De.resolve(r?r.document.mutableCopy():Zn.newInvalidDocument(n))}getEntries(e,n){let r=Ri();return n.forEach((i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Zn.newInvalidDocument(i))})),De.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=Ri();const l=n.path,d=new Qe(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(d);for(;h.hasNext();){const{key:f,value:{document:p}}=h.getNext();if(!l.isPrefixOf(f.path))break;f.path.length>l.length+1||$M(VM(p),r)<=0||(i.has(p.key)||sm(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return De.resolve(o)}getAllFromCollectionGroup(e,n,r,i){Ze(9500)}ii(e,n){return De.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new pN(this)}getSize(e){return De.resolve(this.size)}}class pN extends oN{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),De.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class gN{constructor(e){this.persistence=e,this.si=new Vo((n=>b_(n)),v_),this.lastRemoteSnapshotVersion=et.min(),this.highestTargetId=0,this.oi=0,this._i=new T_,this.targetCount=0,this.ai=nc.ur()}forEachTarget(e,n){return this.si.forEach(((r,i)=>n(i))),De.resolve()}getLastRemoteSnapshotVersion(e){return De.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return De.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),De.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),De.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new nc(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,De.resolve()}updateTargetData(e,n){return this.Pr(n),De.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,De.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.si.forEach(((l,d)=>{d.sequenceNumber<=n&&r.get(d.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)})),De.waitFor(o).next((()=>i))}getTargetCount(e){return De.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return De.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),De.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach((l=>{o.push(i.markPotentiallyOrphaned(e,l))})),De.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),De.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return De.resolve(r)}containsKey(e,n){return De.resolve(this._i.containsKey(n))}}class FC{constructor(e,n){this.ui={},this.overlays={},this.ci=new em(0),this.li=!1,this.li=!0,this.hi=new hN,this.referenceDelegate=e(this),this.Pi=new gN(this),this.indexManager=new eN,this.remoteDocumentCache=(function(i){return new mN(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new ZO(n),this.Ii=new uN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new dN,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new fN(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Ue("MemoryPersistence","Starting transaction:",e);const i=new yN(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((o=>this.referenceDelegate.di(i).next((()=>o)))).toPromise().then((o=>(i.raiseOnCommittedEvent(),o)))}Ai(e,n){return De.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class yN extends HM{constructor(e){super(),this.currentSequenceNumber=e}}class A_{constructor(e){this.persistence=e,this.Ri=new T_,this.Vi=null}static mi(e){return new A_(e)}get fi(){if(this.Vi)return this.Vi;throw Ze(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),De.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),De.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),De.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((i=>{i.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return De.forEach(this.fi,(r=>{const i=Qe.fromPath(r);return this.gi(e,i).next((o=>{o||n.removeEntry(i,et.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return De.or([()=>De.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Of{constructor(e,n){this.persistence=e,this.pi=new Vo((r=>QM(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=aN(this,n)}static mi(e,n){return new Of(e,n)}Ei(){}di(e){return De.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((i=>r+i))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return De.forEach(this.pi,((r,i)=>this.br(e,r,i).next((o=>o?De.resolve():n(i)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,(l=>this.br(e,l,n).next((d=>{d||(r++,o.removeEntry(l,et.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),De.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),De.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),De.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),De.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=uf(e.data.value)),n}br(e,n,r){return De.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return De.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class j_{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=yt(),i=yt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new j_(e,n.fromCache,r,i)}}class _N{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class bN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return W2()?8:GM(er())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,i,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new _N;return this.Ss(e,n,l).next((d=>{if(o.result=d,this.Vs)return this.bs(e,n,l,d.size)}))})).next((()=>o.result))}bs(e,n,r,i){return r.documentReadCount<this.fs?(zl()<=pt.DEBUG&&Ue("QueryEngine","SDK will not create cache indexes for query:",Ll(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),De.resolve()):(zl()<=pt.DEBUG&&Ue("QueryEngine","Query:",Ll(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(zl()<=pt.DEBUG&&Ue("QueryEngine","The SDK decides to create cache indexes for query:",Ll(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$s(n))):De.resolve())}ys(e,n){if(rS(n))return De.resolve(null);let r=$s(n);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(n.limit!==null&&i===1&&(n=Iy(n,null,"F"),r=$s(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=yt(...o);return this.ps.getDocuments(e,l).next((d=>this.indexManager.getMinOffset(e,r).next((h=>{const f=this.Ds(n,d);return this.Cs(n,f,l,h.readTime)?this.ys(e,Iy(n,null,"F")):this.vs(e,f,n,h)}))))})))))}ws(e,n,r,i){return rS(n)||i.isEqual(et.min())?De.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,i)?De.resolve(null):(zl()<=pt.DEBUG&&Ue("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ll(n)),this.vs(e,l,n,FM(i,$u)).next((d=>d)))}))}Ds(e,n){let r=new An(_C(e));return n.forEach(((i,o)=>{sm(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,n,r){return zl()<=pt.DEBUG&&Ue("QueryEngine","Using full collection scan to execute query:",Ll(n)),this.ps.getDocumentsMatchingQuery(e,n,Da.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const R_="LocalStore",vN=3e8;class xN{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new tn(gt),this.xs=new Vo((o=>b_(o)),v_),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function wN(t,e,n,r){return new xN(t,e,n,r)}async function VC(t,e){const n=nt(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next((o=>(i=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],d=[];let h=yt();for(const f of i){l.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}for(const f of o){d.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((f=>({Ls:f,removedBatchIds:l,addedBatchIds:d})))}))}))}function SN(t,e){const n=nt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,h,f,p){const g=f.batch,b=g.keys();let _=De.resolve();return b.forEach((w=>{_=_.next((()=>p.getEntry(h,w))).next((x=>{const S=f.docVersions.get(w);At(S!==null,48541),x.version.compareTo(S)<0&&(g.applyToRemoteDocument(x,f),x.isValidDocument()&&(x.setReadTime(f.commitVersion),p.addEntry(x)))}))})),_.next((()=>d.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(d){let h=yt();for(let f=0;f<d.mutationResults.length;++f)d.mutationResults[f].transformResults.length>0&&(h=h.add(d.batch.mutations[f].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,i)))}))}function $C(t){const e=nt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function EN(t,e){const n=nt(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const d=[];e.targetChanges.forEach(((p,g)=>{const b=i.get(g);if(!b)return;d.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let _=b.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?_=_.withResumeToken(Hn.EMPTY_BYTE_STRING,et.min()).withLastLimboFreeSnapshotVersion(et.min()):p.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(p.resumeToken,r)),i=i.insert(g,_),(function(x,S,C){return x.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=vN?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(b,_,p)&&d.push(n.Pi.updateTargetData(o,_))}));let h=Ri(),f=yt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&d.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),d.push(CN(o,l,e.documentUpdates).next((p=>{h=p.ks,f=p.qs}))),!r.isEqual(et.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));d.push(p)}return De.waitFor(d).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,f))).next((()=>h))})).then((o=>(n.Ms=i,o)))}function CN(t,e,n){let r=yt(),i=yt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=Ri();return n.forEach(((d,h)=>{const f=o.get(d);h.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(d)),h.isNoDocument()&&h.version.isEqual(et.min())?(e.removeEntry(d,h.readTime),l=l.insert(d,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),l=l.insert(d,h)):Ue(R_,"Ignoring outdated watch update for ",d,". Current version:",f.version," Watch version:",h.version)})),{ks:l,qs:i}}))}function TN(t,e){const n=nt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=g_),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function AN(t,e){const n=nt(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return n.Pi.getTargetData(r,e).next((o=>o?(i=o,De.resolve(i)):n.Pi.allocateTargetId(r).next((l=>(i=new ba(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=n.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function Ny(t,e,n){const r=nt(t),i=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!pc(l))throw l;Ue(R_,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function gS(t,e,n){const r=nt(t);let i=et.min(),o=yt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,f,p){const g=nt(h),b=g.xs.get(p);return b!==void 0?De.resolve(g.Ms.get(b)):g.Pi.getTargetData(f,p)})(r,l,$s(e)).next((d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,d.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?i:et.min(),n?o:yt()))).next((d=>(jN(r,fO(e),d),{documents:d,Qs:o})))))}function jN(t,e,n){let r=t.Os.get(e)||et.min();n.forEach(((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class yS{constructor(){this.activeTargetIds=bO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class RN{constructor(){this.Mo=new yS,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new yS,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class IN{Oo(e){}shutdown(){}}const _S="ConnectivityMonitor";class bS{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ue(_S,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ue(_S,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Jh=null;function Py(){return Jh===null?Jh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Jh++,"0x"+Jh.toString(16)}const Qg="RestConnection",kN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class DN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===Af?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,o){const l=Py(),d=this.zo(e,n.toUriEncodedString());Ue(Qg,`Sending RPC '${e}' ${l}:`,d,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);const{host:f}=new URL(d),p=cc(f);return this.Jo(e,d,h,r,p).then((g=>(Ue(Qg,`Received RPC '${e}' ${l}: `,g),g)),(g=>{throw Yl(Qg,`RPC '${e}' ${l} failed with error: `,g,"url: ",d,"request:",r),g}))}Ho(e,n,r,i,o,l){return this.Go(e,n,r,i,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+fc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((i,o)=>e[o]=i)),r&&r.headers.forEach(((i,o)=>e[o]=i))}zo(e,n){const r=kN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class MN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Yn="WebChannelConnection";class ON extends DN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,o){const l=Py();return new Promise(((d,h)=>{const f=new HE;f.setWithCredentials(!0),f.listenOnce(GE.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case cf.NO_ERROR:const g=f.getResponseJson();Ue(Yn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),d(g);break;case cf.TIMEOUT:Ue(Yn,`RPC '${e}' ${l} timed out`),h(new Le(Ie.DEADLINE_EXCEEDED,"Request time out"));break;case cf.HTTP_ERROR:const b=f.getStatus();if(Ue(Yn,`RPC '${e}' ${l} failed with status:`,b,"response text:",f.getResponseText()),b>0){let _=f.getResponseJson();Array.isArray(_)&&(_=_[0]);const w=_?.error;if(w&&w.status&&w.message){const x=(function(C){const T=C.toLowerCase().replace(/_/g,"-");return Object.values(Ie).indexOf(T)>=0?T:Ie.UNKNOWN})(w.status);h(new Le(x,w.message))}else h(new Le(Ie.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new Le(Ie.UNAVAILABLE,"Connection failed."));break;default:Ze(9055,{l_:e,streamId:l,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{Ue(Yn,`RPC '${e}' ${l} completed.`)}}));const p=JSON.stringify(i);Ue(Yn,`RPC '${e}' ${l} sending request:`,i),f.send(n,"POST",p,r,15)}))}T_(e,n,r){const i=Py(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=KE(),d=QE(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");Ue(Yn,`Creating RPC '${e}' stream ${i}: ${p}`,h);const g=l.createWebChannel(p,h);this.I_(g);let b=!1,_=!1;const w=new MN({Yo:S=>{_?Ue(Yn,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(b||(Ue(Yn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),b=!0),Ue(Yn,`RPC '${e}' stream ${i} sending:`,S),g.send(S))},Zo:()=>g.close()}),x=(S,C,T)=>{S.listen(C,(R=>{try{T(R)}catch(k){setTimeout((()=>{throw k}),0)}}))};return x(g,ju.EventType.OPEN,(()=>{_||(Ue(Yn,`RPC '${e}' stream ${i} transport opened.`),w.o_())})),x(g,ju.EventType.CLOSE,(()=>{_||(_=!0,Ue(Yn,`RPC '${e}' stream ${i} transport closed`),w.a_(),this.E_(g))})),x(g,ju.EventType.ERROR,(S=>{_||(_=!0,Yl(Yn,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),w.a_(new Le(Ie.UNAVAILABLE,"The operation could not be completed")))})),x(g,ju.EventType.MESSAGE,(S=>{if(!_){const C=S.data[0];At(!!C,16349);const T=C,R=T?.error||T[0]?.error;if(R){Ue(Yn,`RPC '${e}' stream ${i} received error:`,R);const k=R.status;let V=(function(O){const N=vn[O];if(N!==void 0)return IC(N)})(k),$=R.message;V===void 0&&(V=Ie.INTERNAL,$="Unknown error status: "+k+" with message "+R.message),_=!0,w.a_(new Le(V,$)),g.close()}else Ue(Yn,`RPC '${e}' stream ${i} received:`,C),w.u_(C)}})),x(d,WE.STAT_EVENT,(S=>{S.stat===Sy.PROXY?Ue(Yn,`RPC '${e}' stream ${i} detected buffering proxy`):S.stat===Sy.NOPROXY&&Ue(Yn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{w.__()}),0),w}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function Kg(){return typeof document<"u"?document:null}function cm(t){return new zO(t,!0)}class qC{constructor(e,n,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&Ue("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const vS="PersistentStream";class HC{constructor(e,n,r,i,o,l,d,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=d,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new qC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===Ie.RESOURCE_EXHAUSTED?(ji(n.toString()),ji("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===Ie.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===n&&this.G_(r,i)}),(r=>{e((()=>{const i=new Le(Ie.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ue(vS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Ue(vS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class NN extends HC{constructor(e,n,r,i,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=FO(this.serializer,e),r=(function(o){if(!("targetChange"in o))return et.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?et.min():l.readTime?qs(l.readTime):et.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Oy(this.serializer),n.addTarget=(function(o,l){let d;const h=l.target;if(d=jy(h)?{documents:qO(o,h)}:{query:HO(o,h).ft},d.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){d.resumeToken=MC(o,l.resumeToken);const f=ky(o,l.expectedCount);f!==null&&(d.expectedCount=f)}else if(l.snapshotVersion.compareTo(et.min())>0){d.readTime=Mf(o,l.snapshotVersion.toTimestamp());const f=ky(o,l.expectedCount);f!==null&&(d.expectedCount=f)}return d})(this.serializer,e);const r=WO(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Oy(this.serializer),n.removeTarget=e,this.q_(n)}}class PN extends HC{constructor(e,n,r,i,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return At(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,At(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){At(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=$O(e.writeResults,e.commitTime),r=qs(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Oy(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>VO(this.serializer,r)))};this.q_(n)}}class BN{}class zN extends BN{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Le(Ie.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,Dy(n,r),i,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===Ie.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Le(Ie.UNKNOWN,o.toString())}))}Ho(e,n,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,d])=>this.connection.Ho(e,Dy(n,r),i,l,d,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===Ie.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Le(Ie.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class LN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ji(n),this.aa=!1):Ue("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Bo="RemoteStore";class UN{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{$o(this)&&(Ue(Bo,"Restarting streams for network reachability change."),await(async function(h){const f=nt(h);f.Ea.add(4),await hd(f),f.Ra.set("Unknown"),f.Ea.delete(4),await um(f)})(this))}))})),this.Ra=new LN(r,i)}}async function um(t){if($o(t))for(const e of t.da)await e(!0)}async function hd(t){for(const e of t.da)await e(!1)}function GC(t,e){const n=nt(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),M_(n)?D_(n):gc(n).O_()&&k_(n,e))}function I_(t,e){const n=nt(t),r=gc(n);n.Ia.delete(e),r.O_()&&WC(n,e),n.Ia.size===0&&(r.O_()?r.L_():$o(n)&&n.Ra.set("Unknown"))}function k_(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(et.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}gc(t).Y_(e)}function WC(t,e){t.Va.Ue(e),gc(t).Z_(e)}function D_(t){t.Va=new OO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),gc(t).start(),t.Ra.ua()}function M_(t){return $o(t)&&!gc(t).x_()&&t.Ia.size>0}function $o(t){return nt(t).Ea.size===0}function QC(t){t.Va=void 0}async function FN(t){t.Ra.set("Online")}async function VN(t){t.Ia.forEach(((e,n)=>{k_(t,e)}))}async function $N(t,e){QC(t),M_(t)?(t.Ra.ha(e),D_(t)):t.Ra.set("Unknown")}async function qN(t,e,n){if(t.Ra.set("Online"),e instanceof DC&&e.state===2&&e.cause)try{await(async function(i,o){const l=o.cause;for(const d of o.targetIds)i.Ia.has(d)&&(await i.remoteSyncer.rejectListen(d,l),i.Ia.delete(d),i.Va.removeTarget(d))})(t,e)}catch(r){Ue(Bo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Nf(t,r)}else if(e instanceof ff?t.Va.Ze(e):e instanceof kC?t.Va.st(e):t.Va.tt(e),!n.isEqual(et.min()))try{const r=await $C(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const d=o.Va.Tt(l);return d.targetChanges.forEach(((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(f);p&&o.Ia.set(f,p.withResumeToken(h.resumeToken,l))}})),d.targetMismatches.forEach(((h,f)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Hn.EMPTY_BYTE_STRING,p.snapshotVersion)),WC(o,h);const g=new ba(p.target,h,f,p.sequenceNumber);k_(o,g)})),o.remoteSyncer.applyRemoteEvent(d)})(t,n)}catch(r){Ue(Bo,"Failed to raise snapshot:",r),await Nf(t,r)}}async function Nf(t,e,n){if(!pc(e))throw e;t.Ea.add(1),await hd(t),t.Ra.set("Offline"),n||(n=()=>$C(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ue(Bo,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await um(t)}))}function KC(t,e){return e().catch((n=>Nf(t,n,e)))}async function dm(t){const e=nt(t),n=Pa(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:g_;for(;HN(e);)try{const i=await TN(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,GN(e,i)}catch(i){await Nf(e,i)}YC(e)&&XC(e)}function HN(t){return $o(t)&&t.Ta.length<10}function GN(t,e){t.Ta.push(e);const n=Pa(t);n.O_()&&n.X_&&n.ea(e.mutations)}function YC(t){return $o(t)&&!Pa(t).x_()&&t.Ta.length>0}function XC(t){Pa(t).start()}async function WN(t){Pa(t).ra()}async function QN(t){const e=Pa(t);for(const n of t.Ta)e.ea(n.mutations)}async function KN(t,e,n){const r=t.Ta.shift(),i=S_.from(r,e,n);await KC(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await dm(t)}async function YN(t,e){e&&Pa(t).X_&&await(async function(r,i){if((function(l){return kO(l)&&l!==Ie.ABORTED})(i.code)){const o=r.Ta.shift();Pa(r).B_(),await KC(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i))),await dm(r)}})(t,e),YC(t)&&XC(t)}async function xS(t,e){const n=nt(t);n.asyncQueue.verifyOperationInProgress(),Ue(Bo,"RemoteStore received new credentials");const r=$o(n);n.Ea.add(3),await hd(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await um(n)}async function XN(t,e){const n=nt(t);e?(n.Ea.delete(2),await um(n)):e||(n.Ea.add(2),await hd(n),n.Ra.set("Unknown"))}function gc(t){return t.ma||(t.ma=(function(n,r,i){const o=nt(n);return o.sa(),new NN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:FN.bind(null,t),t_:VN.bind(null,t),r_:$N.bind(null,t),H_:qN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),M_(t)?D_(t):t.Ra.set("Unknown")):(await t.ma.stop(),QC(t))}))),t.ma}function Pa(t){return t.fa||(t.fa=(function(n,r,i){const o=nt(n);return o.sa(),new PN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:WN.bind(null,t),r_:YN.bind(null,t),ta:QN.bind(null,t),na:KN.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await dm(t)):(await t.fa.stop(),t.Ta.length>0&&(Ue(Bo,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class O_{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new Si,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const l=Date.now()+r,d=new O_(e,n,l,i,o);return d.start(r),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Le(Ie.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function N_(t,e){if(ji("AsyncQueue",`${e}: ${t}`),pc(t))return new Le(Ie.UNAVAILABLE,`${e}: ${t}`);throw t}class Gl{static emptySet(e){return new Gl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Qe.comparator(n.key,r.key):(n,r)=>Qe.comparator(n.key,r.key),this.keyedMap=Ru(),this.sortedSet=new tn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Gl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Gl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class wS{constructor(){this.ga=new tn(Qe.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Ze(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class rc{constructor(e,n,r,i,o,l,d,h,f){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=d,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,n,r,i,o){const l=[];return n.forEach((d=>{l.push({type:0,doc:d})})),new rc(e,n,Gl.emptySet(n),l,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&rm(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}class ZN{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class JN{constructor(){this.queries=SS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=nt(n),o=i.queries;i.queries=SS(),o.forEach(((l,d)=>{for(const h of d.Sa)h.onError(r)}))})(this,new Le(Ie.ABORTED,"Firestore shutting down"))}}function SS(){return new Vo((t=>yC(t)),rm)}async function ZC(t,e){const n=nt(t);let r=3;const i=e.query;let o=n.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new ZN,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(i,!0);break;case 1:o.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(l){const d=N_(l,`Initialization of query '${Ll(e.query)}' failed`);return void e.onError(d)}n.queries.set(i,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&P_(n)}async function JC(t,e){const n=nt(t),r=e.query;let i=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function e6(t,e){const n=nt(t);let r=!1;for(const i of e){const o=i.query,l=n.queries.get(o);if(l){for(const d of l.Sa)d.Fa(i)&&(r=!0);l.wa=i}}r&&P_(n)}function t6(t,e,n){const r=nt(t),i=r.queries.get(e);if(i)for(const o of i.Sa)o.onError(n);r.queries.delete(e)}function P_(t){t.Ca.forEach((e=>{e.next()}))}var By,ES;(ES=By||(By={})).Ma="default",ES.Cache="cache";class eT{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new rc(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=rc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==By.Cache}}class tT{constructor(e){this.key=e}}class nT{constructor(e){this.key=e}}class n6{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=yt(),this.mutatedKeys=yt(),this.eu=_C(e),this.tu=new Gl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new wS,i=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=i,d=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((p,g)=>{const b=i.get(p),_=sm(this.query,g)?g:null,w=!!b&&this.mutatedKeys.has(b.key),x=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let S=!1;b&&_?b.data.isEqual(_.data)?w!==x&&(r.track({type:3,doc:_}),S=!0):this.su(b,_)||(r.track({type:2,doc:_}),S=!0,(h&&this.eu(_,h)>0||f&&this.eu(_,f)<0)&&(d=!0)):!b&&_?(r.track({type:0,doc:_}),S=!0):b&&!_&&(r.track({type:1,doc:b}),S=!0,(h||f)&&(d=!0)),S&&(_?(l=l.add(_),o=x?o.add(p):o.delete(p)):(l=l.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const p=this.query.limitType==="F"?l.last():l.first();l=l.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:l,iu:r,Cs:d,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((p,g)=>(function(_,w){const x=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ze(20277,{Rt:S})}};return x(_)-x(w)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),i=i??!1;const d=n&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,f=h!==this.Za;return this.Za=h,l.length!==0||f?{snapshot:new rc(this.query,e.tu,o,l,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new wS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=yt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new nT(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new tT(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=yt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return rc.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const B_="SyncEngine";class r6{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class s6{constructor(e){this.key=e,this.hu=!1}}class i6{constructor(e,n,r,i,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new Vo((d=>yC(d)),rm),this.Iu=new Map,this.Eu=new Set,this.du=new tn(Qe.comparator),this.Au=new Map,this.Ru=new T_,this.Vu={},this.mu=new Map,this.fu=nc.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function a6(t,e,n=!0){const r=lT(t);let i;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await rT(r,e,n,!0),i}async function o6(t,e){const n=lT(t);await rT(n,e,!0,!1)}async function rT(t,e,n,r){const i=await AN(t.localStore,$s(e)),o=i.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let d;return r&&(d=await l6(t,e,o,l==="current",i.resumeToken)),t.isPrimaryClient&&n&&GC(t.remoteStore,i),d}async function l6(t,e,n,r,i){t.pu=(g,b,_)=>(async function(x,S,C,T){let R=S.view.ru(C);R.Cs&&(R=await gS(x.localStore,S.query,!1).then((({documents:D})=>S.view.ru(D,R))));const k=T&&T.targetChanges.get(S.targetId),V=T&&T.targetMismatches.get(S.targetId)!=null,$=S.view.applyChanges(R,x.isPrimaryClient,k,V);return TS(x,S.targetId,$.au),$.snapshot})(t,g,b,_);const o=await gS(t.localStore,e,!0),l=new n6(e,o.Qs),d=l.ru(o.documents),h=dd.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),f=l.applyChanges(d,t.isPrimaryClient,h);TS(t,n,f.au);const p=new r6(e,n,l);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),f.snapshot}async function c6(t,e,n){const r=nt(t),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter((l=>!rm(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Ny(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&I_(r.remoteStore,i.targetId),zy(r,i.targetId)})).catch(mc)):(zy(r,i.targetId),await Ny(r.localStore,i.targetId,!0))}async function u6(t,e){const n=nt(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),I_(n.remoteStore,r.targetId))}async function d6(t,e,n){const r=_6(t);try{const i=await(function(l,d){const h=nt(l),f=Gt.now(),p=d.reduce(((_,w)=>_.add(w.key)),yt());let g,b;return h.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let w=Ri(),x=yt();return h.Ns.getEntries(_,p).next((S=>{w=S,w.forEach(((C,T)=>{T.isValidDocument()||(x=x.add(C))}))})).next((()=>h.localDocuments.getOverlayedDocuments(_,w))).next((S=>{g=S;const C=[];for(const T of d){const R=TO(T,g.get(T.key).overlayedDocument);R!=null&&C.push(new qa(T.key,R,cC(R.value.mapValue),vr.exists(!0)))}return h.mutationQueue.addMutationBatch(_,f,C,d)})).next((S=>{b=S;const C=S.applyToLocalDocumentSet(g,x);return h.documentOverlayCache.saveOverlays(_,S.batchId,C)}))})).then((()=>({batchId:b.batchId,changes:vC(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(l,d,h){let f=l.Vu[l.currentUser.toKey()];f||(f=new tn(gt)),f=f.insert(d,h),l.Vu[l.currentUser.toKey()]=f})(r,i.batchId,n),await fd(r,i.changes),await dm(r.remoteStore)}catch(i){const o=N_(i,"Failed to persist write");n.reject(o)}}async function sT(t,e){const n=nt(t);try{const r=await EN(n.localStore,e);e.targetChanges.forEach(((i,o)=>{const l=n.Au.get(o);l&&(At(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?l.hu=!0:i.modifiedDocuments.size>0?At(l.hu,14607):i.removedDocuments.size>0&&(At(l.hu,42227),l.hu=!1))})),await fd(n,r,e)}catch(r){await mc(r)}}function CS(t,e,n){const r=nt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach(((o,l)=>{const d=l.view.va(e);d.snapshot&&i.push(d.snapshot)})),(function(l,d){const h=nt(l);h.onlineState=d;let f=!1;h.queries.forEach(((p,g)=>{for(const b of g.Sa)b.va(d)&&(f=!0)})),f&&P_(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function h6(t,e,n){const r=nt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),o=i&&i.key;if(o){let l=new tn(Qe.comparator);l=l.insert(o,Zn.newNoDocument(o,et.min()));const d=yt().add(o),h=new lm(et.min(),new Map,new tn(gt),l,d);await sT(r,h),r.du=r.du.remove(o),r.Au.delete(e),z_(r)}else await Ny(r.localStore,e,!1).then((()=>zy(r,e,n))).catch(mc)}async function f6(t,e){const n=nt(t),r=e.batch.batchId;try{const i=await SN(n.localStore,e);aT(n,r,null),iT(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await fd(n,i)}catch(i){await mc(i)}}async function m6(t,e,n){const r=nt(t);try{const i=await(function(l,d){const h=nt(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let p;return h.mutationQueue.lookupMutationBatch(f,d).next((g=>(At(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(f,g)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,p,d))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,p))).next((()=>h.localDocuments.getDocuments(f,p)))}))})(r.localStore,e);aT(r,e,n),iT(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await fd(r,i)}catch(i){await mc(i)}}function iT(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function aT(t,e,n){const r=nt(t);let i=r.Vu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function zy(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||oT(t,r)}))}function oT(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(I_(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),z_(t))}function TS(t,e,n){for(const r of n)r instanceof tT?(t.Ru.addReference(r.key,e),p6(t,r)):r instanceof nT?(Ue(B_,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||oT(t,r.key)):Ze(19791,{wu:r})}function p6(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Ue(B_,"New document in limbo: "+n),t.Eu.add(r),z_(t))}function z_(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Qe(Vt.fromString(e)),r=t.fu.next();t.Au.set(r,new s6(n)),t.du=t.du.insert(n,r),GC(t.remoteStore,new ba($s(x_(n.path)),r,"TargetPurposeLimboResolution",em.ce))}}async function fd(t,e,n){const r=nt(t),i=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((d,h)=>{l.push(r.pu(h,e,n).then((f=>{if((f||n)&&r.isPrimaryClient){const p=f?!f.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(f){i.push(f);const p=j_.As(h.targetId,f);o.push(p)}})))})),await Promise.all(l),r.Pu.H_(i),await(async function(h,f){const p=nt(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>De.forEach(f,(b=>De.forEach(b.Es,(_=>p.persistence.referenceDelegate.addReference(g,b.targetId,_))).next((()=>De.forEach(b.ds,(_=>p.persistence.referenceDelegate.removeReference(g,b.targetId,_)))))))))}catch(g){if(!pc(g))throw g;Ue(R_,"Failed to update sequence numbers: "+g)}for(const g of f){const b=g.targetId;if(!g.fromCache){const _=p.Ms.get(b),w=_.snapshotVersion,x=_.withLastLimboFreeSnapshotVersion(w);p.Ms=p.Ms.insert(b,x)}}})(r.localStore,o))}async function g6(t,e){const n=nt(t);if(!n.currentUser.isEqual(e)){Ue(B_,"User change. New user:",e.toKey());const r=await VC(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((d=>{d.forEach((h=>{h.reject(new Le(Ie.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await fd(n,r.Ls)}}function y6(t,e){const n=nt(t),r=n.Au.get(e);if(r&&r.hu)return yt().add(r.key);{let i=yt();const o=n.Iu.get(e);if(!o)return i;for(const l of o){const d=n.Tu.get(l);i=i.unionWith(d.view.nu)}return i}}function lT(t){const e=nt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=sT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=y6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=h6.bind(null,e),e.Pu.H_=e6.bind(null,e.eventManager),e.Pu.yu=t6.bind(null,e.eventManager),e}function _6(t){const e=nt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=f6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=m6.bind(null,e),e}class Pf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=cm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return wN(this.persistence,new bN,e.initialUser,this.serializer)}Cu(e){return new FC(A_.mi,this.serializer)}Du(e){return new RN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Pf.provider={build:()=>new Pf};class b6 extends Pf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){At(this.persistence.referenceDelegate instanceof Of,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new sN(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?yr.withCacheSize(this.cacheSizeBytes):yr.DEFAULT;return new FC((r=>Of.mi(r,n)),this.serializer)}}class Ly{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>CS(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=g6.bind(null,this.syncEngine),await XN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new JN})()}createDatastore(e){const n=cm(e.databaseInfo.databaseId),r=(function(o){return new ON(o)})(e.databaseInfo);return(function(o,l,d,h){return new zN(o,l,d,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,i,o,l,d){return new UN(r,i,o,l,d)})(this.localStore,this.datastore,e.asyncQueue,(n=>CS(this.syncEngine,n,0)),(function(){return bS.v()?new bS:new IN})())}createSyncEngine(e,n){return(function(i,o,l,d,h,f,p){const g=new i6(i,o,l,d,h,f);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=nt(n);Ue(Bo,"RemoteStore shutting down."),r.Ea.add(5),await hd(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ly.provider={build:()=>new Ly};class cT{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ji("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const Ba="FirestoreClient";class v6{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Xn.UNAUTHENTICATED,this.clientId=p_.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{Ue(Ba,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(Ue(Ba,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Si;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=N_(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Yg(t,e){t.asyncQueue.verifyOperationInProgress(),Ue(Ba,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async i=>{r.isEqual(i)||(await VC(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function AS(t,e){t.asyncQueue.verifyOperationInProgress();const n=await x6(t);Ue(Ba,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>xS(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,i)=>xS(e.remoteStore,i))),t._onlineComponents=e}async function x6(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ue(Ba,"Using user provided OfflineComponentProvider");try{await Yg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(i){return i.name==="FirebaseError"?i.code===Ie.FAILED_PRECONDITION||i.code===Ie.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(n))throw n;Yl("Error using user provided cache. Falling back to memory cache: "+n),await Yg(t,new Pf)}}else Ue(Ba,"Using default OfflineComponentProvider"),await Yg(t,new b6(void 0));return t._offlineComponents}async function uT(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ue(Ba,"Using user provided OnlineComponentProvider"),await AS(t,t._uninitializedComponentsProvider._online)):(Ue(Ba,"Using default OnlineComponentProvider"),await AS(t,new Ly))),t._onlineComponents}function w6(t){return uT(t).then((e=>e.syncEngine))}async function dT(t){const e=await uT(t),n=e.eventManager;return n.onListen=a6.bind(null,e.syncEngine),n.onUnlisten=c6.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=o6.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=u6.bind(null,e.syncEngine),n}function S6(t,e,n={}){const r=new Si;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,f){const p=new cT({next:b=>{p.Nu(),l.enqueueAndForget((()=>JC(o,g)));const _=b.docs.has(d);!_&&b.fromCache?f.reject(new Le(Ie.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&b.fromCache&&h&&h.source==="server"?f.reject(new Le(Ie.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(b)},error:b=>f.reject(b)}),g=new eT(x_(d.path),p,{includeMetadataChanges:!0,qa:!0});return ZC(o,g)})(await dT(t),t.asyncQueue,e,n,r))),r.promise}function E6(t,e,n={}){const r=new Si;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,f){const p=new cT({next:b=>{p.Nu(),l.enqueueAndForget((()=>JC(o,g))),b.fromCache&&h.source==="server"?f.reject(new Le(Ie.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(b)},error:b=>f.reject(b)}),g=new eT(d,p,{includeMetadataChanges:!0,qa:!0});return ZC(o,g)})(await dT(t),t.asyncQueue,e,n,r))),r.promise}function hT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const jS=new Map;const fT="firestore.googleapis.com",RS=!0;class IS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Le(Ie.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=fT,this.ssl=RS}else this.host=e.host,this.ssl=e.ssl??RS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=UC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<nN)throw new Le(Ie.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}UM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hT(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Le(Ie.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Le(Ie.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Le(Ie.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hm{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new IS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Le(Ie.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Le(Ie.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new IS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new IM;switch(r.type){case"firstParty":return new OM(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Le(Ie.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=jS.get(n);r&&(Ue("ComponentProvider","Removing Datastore"),jS.delete(n),r.terminate())})(this),Promise.resolve()}}function C6(t,e,n,r={}){t=ms(t,hm);const i=cc(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},d=`${e}:${n}`;i&&(nE(`https://${d}`),rE("Firestore",!0)),o.host!==fT&&o.host!==d&&Yl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:d,ssl:i,emulatorOptions:r};if(!Ci(h,l)&&(t._setSettings(h),r.mockUserToken)){let f,p;if(typeof r.mockUserToken=="string")f=r.mockUserToken,p=Xn.MOCK_USER;else{f=z2(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Le(Ie.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Xn(g)}t._authCredentials=new kM(new XE(f,p))}}class yc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new yc(this.firestore,e,this._query)}}class un{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ra(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new un(this.firestore,e,this._key)}toJSON(){return{type:un._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(ld(n,un._jsonSchema))return new un(e,r||null,new Qe(Vt.fromString(n.referencePath)))}}un._jsonSchemaVersion="firestore/documentReference/1.0",un._jsonSchema={type:wn("string",un._jsonSchemaVersion),referencePath:wn("string")};class Ra extends yc{constructor(e,n,r){super(e,n,x_(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new un(this.firestore,null,new Qe(e))}withConverter(e){return new Ra(this.firestore,e,this._path)}}function T6(t,e,...n){if(t=Sn(t),ZE("collection","path",e),t instanceof hm){const r=Vt.fromString(e,...n);return $w(r),new Ra(t,null,r)}{if(!(t instanceof un||t instanceof Ra))throw new Le(Ie.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Vt.fromString(e,...n));return $w(r),new Ra(t.firestore,null,r)}}function _c(t,e,...n){if(t=Sn(t),arguments.length===1&&(e=p_.newId()),ZE("doc","path",e),t instanceof hm){const r=Vt.fromString(e,...n);return Vw(r),new un(t,null,new Qe(r))}{if(!(t instanceof un||t instanceof Ra))throw new Le(Ie.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Vt.fromString(e,...n));return Vw(r),new un(t.firestore,t instanceof Ra?t.converter:null,new Qe(r))}}const kS="AsyncQueue";class DS{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new qC(this,"async_queue_retry"),this._c=()=>{const r=Kg();r&&Ue(kS,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Kg();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Kg();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new Si;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!pc(e))throw e;Ue(kS,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,ji("INTERNAL UNHANDLED ERROR: ",MS(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=O_.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(i),i}uc(){this.nc&&Ze(47125,{Pc:MS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function MS(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class qo extends hm{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new DS,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new DS(e),this._firestoreClient=void 0,await e}}}function A6(t,e){const n=typeof t=="object"?t:oE(),r=typeof t=="string"?t:Af,i=i_(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=P2("firestore");o&&C6(i,...o)}return i}function fm(t){if(t._terminated)throw new Le(Ie.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||j6(t),t._firestoreClient}function j6(t){const e=t._freezeSettings(),n=(function(i,o,l,d){return new XM(i,o,l,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,hT(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new v6(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(i){const o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(t._componentsProvider))}class Kr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Kr(Hn.fromBase64String(e))}catch(n){throw new Le(Ie.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Kr(Hn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Kr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ld(e,Kr._jsonSchema))return Kr.fromBase64String(e.bytes)}}Kr._jsonSchemaVersion="firestore/bytes/1.0",Kr._jsonSchema={type:wn("string",Kr._jsonSchemaVersion),bytes:wn("string")};class md{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Le(Ie.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Vn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class pd{constructor(e){this._methodName=e}}class Hs{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Le(Ie.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Le(Ie.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return gt(this._lat,e._lat)||gt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Hs._jsonSchemaVersion}}static fromJSON(e){if(ld(e,Hs._jsonSchema))return new Hs(e.latitude,e.longitude)}}Hs._jsonSchemaVersion="firestore/geoPoint/1.0",Hs._jsonSchema={type:wn("string",Hs._jsonSchemaVersion),latitude:wn("number"),longitude:wn("number")};class Gs{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Gs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ld(e,Gs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Gs(e.vectorValues);throw new Le(Ie.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Gs._jsonSchemaVersion="firestore/vectorValue/1.0",Gs._jsonSchema={type:wn("string",Gs._jsonSchemaVersion),vectorValues:wn("object")};const R6=/^__.*__$/;class I6{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new qa(e,this.data,this.fieldMask,n,this.fieldTransforms):new ud(e,this.data,n,this.fieldTransforms)}}class mT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new qa(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function pT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ze(40011,{Ac:t})}}class mm{constructor(e,n,r,i,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new mm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Bf(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(pT(this.Ac)&&R6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class k6{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||cm(e)}Cc(e,n,r,i=!1){return new mm({Ac:e,methodName:n,Dc:r,path:Vn.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function pm(t){const e=t._freezeSettings(),n=cm(t._databaseId);return new k6(t._databaseId,!!e.ignoreUndefinedProperties,n)}function gT(t,e,n,r,i,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,i);F_("Data must be an object, but it was:",l,r);const d=vT(r,l);let h,f;if(o.merge)h=new kr(l.fieldMask),f=l.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const b=Uy(e,g,n);if(!l.contains(b))throw new Le(Ie.INVALID_ARGUMENT,`Field '${b}' is specified in your field mask but missing from your input data.`);wT(p,b)||p.push(b)}h=new kr(p),f=l.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,f=l.fieldTransforms;return new I6(new _r(d),h,f)}class gm extends pd{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof gm}}function yT(t,e,n){return new mm({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class L_ extends pd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=yT(this,e,!0),r=this.vc.map((o=>Ho(o,n))),i=new ec(r);return new AC(e.path,i)}isEqual(e){return e instanceof L_&&Ci(this.vc,e.vc)}}class U_ extends pd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=yT(this,e,!0),r=this.vc.map((o=>Ho(o,n))),i=new tc(r);return new AC(e.path,i)}isEqual(e){return e instanceof U_&&Ci(this.vc,e.vc)}}function _T(t,e,n,r){const i=t.Cc(1,e,n);F_("Data must be an object, but it was:",i,r);const o=[],l=_r.empty();$a(r,((h,f)=>{const p=V_(e,h,n);f=Sn(f);const g=i.yc(p);if(f instanceof gm)o.push(p);else{const b=Ho(f,g);b!=null&&(o.push(p),l.set(p,b))}}));const d=new kr(o);return new mT(l,d,i.fieldTransforms)}function bT(t,e,n,r,i,o){const l=t.Cc(1,e,n),d=[Uy(e,r,n)],h=[i];if(o.length%2!=0)throw new Le(Ie.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let b=0;b<o.length;b+=2)d.push(Uy(e,o[b])),h.push(o[b+1]);const f=[],p=_r.empty();for(let b=d.length-1;b>=0;--b)if(!wT(f,d[b])){const _=d[b];let w=h[b];w=Sn(w);const x=l.yc(_);if(w instanceof gm)f.push(_);else{const S=Ho(w,x);S!=null&&(f.push(_),p.set(_,S))}}const g=new kr(f);return new mT(p,g,l.fieldTransforms)}function D6(t,e,n,r=!1){return Ho(n,t.Cc(r?4:3,e))}function Ho(t,e){if(xT(t=Sn(t)))return F_("Unsupported field value:",e,t),vT(t,e);if(t instanceof pd)return(function(r,i){if(!pT(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const o=[];let l=0;for(const d of r){let h=Ho(d,i.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,i){if((r=Sn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return vO(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Gt.fromDate(r);return{timestampValue:Mf(i.serializer,o)}}if(r instanceof Gt){const o=new Gt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Mf(i.serializer,o)}}if(r instanceof Hs)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Kr)return{bytesValue:MC(i.serializer,r._byteString)};if(r instanceof un){const o=i.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw i.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:C_(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Gs)return(function(l,d){return{mapValue:{fields:{[oC]:{stringValue:lC},[jf]:{arrayValue:{values:l.toArray().map((f=>{if(typeof f!="number")throw d.Sc("VectorValues must only contain numeric values.");return w_(d.serializer,f)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Jf(r)}`)})(t,e)}function vT(t,e){const n={};return tC(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):$a(t,((r,i)=>{const o=Ho(i,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function xT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Gt||t instanceof Hs||t instanceof Kr||t instanceof un||t instanceof pd||t instanceof Gs)}function F_(t,e,n){if(!xT(n)||!JE(n)){const r=Jf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Uy(t,e,n){if((e=Sn(e))instanceof md)return e._internalPath;if(typeof e=="string")return V_(t,e);throw Bf("Field path arguments must be of type string or ",t,!1,void 0,n)}const M6=new RegExp("[~\\*/\\[\\]]");function V_(t,e,n){if(e.search(M6)>=0)throw Bf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new md(...e.split("."))._internalPath}catch{throw Bf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Bf(t,e,n,r,i){const o=r&&!r.isEmpty(),l=i!==void 0;let d=`Function ${e}() called with invalid data`;n&&(d+=" (via `toFirestore()`)"),d+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${i}`),h+=")"),new Le(Ie.INVALID_ARGUMENT,d+t+h)}function wT(t,e){return t.some((n=>n.isEqual(e)))}class ST{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new un(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new O6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field($_("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class O6 extends ST{data(){return super.data()}}function $_(t,e){return typeof e=="string"?V_(t,e):e instanceof md?e._internalPath:e._delegate._internalPath}function N6(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Le(Ie.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class q_{}class P6 extends q_{}function B6(t,e,...n){let r=[];e instanceof q_&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof H_)).length,d=o.filter((h=>h instanceof ym)).length;if(l>1||l>0&&d>0)throw new Le(Ie.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)t=i._apply(t);return t}class ym extends P6{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new ym(e,n,r)}_apply(e){const n=this._parse(e);return ET(e._query,n),new yc(e.firestore,e.converter,Ry(e._query,n))}_parse(e){const n=pm(e.firestore);return(function(o,l,d,h,f,p,g){let b;if(f.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Le(Ie.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){NS(g,p);const w=[];for(const x of g)w.push(OS(h,o,x));b={arrayValue:{values:w}}}else b=OS(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||NS(g,p),b=D6(d,l,g,p==="in"||p==="not-in");return xn.create(f,p,b)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function z6(t,e,n){const r=e,i=$_("where",t);return ym._create(i,r,n)}class H_ extends q_{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new H_(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:ps.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(i,o){let l=i;const d=o.getFlattenedFilters();for(const h of d)ET(l,h),l=Ry(l,h)})(e._query,n),new yc(e.firestore,e.converter,Ry(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function OS(t,e,n){if(typeof(n=Sn(n))=="string"){if(n==="")throw new Le(Ie.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gC(e)&&n.indexOf("/")!==-1)throw new Le(Ie.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Vt.fromString(n));if(!Qe.isDocumentKey(r))throw new Le(Ie.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Xw(t,new Qe(r))}if(n instanceof un)return Xw(t,n._key);throw new Le(Ie.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Jf(n)}.`)}function NS(t,e){if(!Array.isArray(t)||t.length===0)throw new Le(Ie.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ET(t,e){const n=(function(i,o){for(const l of i)for(const d of l.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null})(t.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Le(Ie.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Le(Ie.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class L6{convertValue(e,n="none"){switch(Na(e)){case 0:return null;case 1:return e.booleanValue;case 2:return cn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Oa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ze(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return $a(e,((i,o)=>{r[i]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[jf].arrayValue?.values?.map((r=>cn(r.doubleValue)));return new Gs(n)}convertGeoPoint(e){return new Hs(cn(e.latitude),cn(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=nm(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(qu(e));default:return null}}convertTimestamp(e){const n=Ma(e);return new Gt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Vt.fromString(e);At(LC(r),9688,{name:e});const i=new Hu(r.get(1),r.get(3)),o=new Qe(r.popFirst(5));return i.isEqual(n)||ji(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function CT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class ku{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ko extends ST{constructor(e,n,r,i,o,l){super(e,n,r,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new mf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field($_("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Ie.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=ko._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}ko._jsonSchemaVersion="firestore/documentSnapshot/1.0",ko._jsonSchema={type:wn("string",ko._jsonSchemaVersion),bundleSource:wn("string","DocumentSnapshot"),bundleName:wn("string"),bundle:wn("string")};class mf extends ko{data(e={}){return super.data(e)}}class Wl{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new ku(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new mf(this._firestore,this._userDataWriter,r.key,r,new ku(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Le(Ie.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((d=>{const h=new mf(i._firestore,i._userDataWriter,d.doc.key,d.doc,new ku(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);return d.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((d=>o||d.type!==3)).map((d=>{const h=new mf(i._firestore,i._userDataWriter,d.doc.key,d.doc,new ku(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,p=-1;return d.type!==0&&(f=l.indexOf(d.doc.key),l=l.delete(d.doc.key)),d.type!==1&&(l=l.add(d.doc),p=l.indexOf(d.doc.key)),{type:U6(d.type),doc:h,oldIndex:f,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Ie.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Wl._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=p_.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function U6(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ze(61501,{type:t})}}function F6(t){t=ms(t,un);const e=ms(t.firestore,qo);return S6(fm(e),t._key).then((n=>G6(e,t,n)))}Wl._jsonSchemaVersion="firestore/querySnapshot/1.0",Wl._jsonSchema={type:wn("string",Wl._jsonSchemaVersion),bundleSource:wn("string","QuerySnapshot"),bundleName:wn("string"),bundle:wn("string")};class TT extends L6{constructor(e){super(),this.firestore=e}convertBytes(e){return new Kr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new un(this.firestore,null,n)}}function V6(t){t=ms(t,yc);const e=ms(t.firestore,qo),n=fm(e),r=new TT(e);return N6(t._query),E6(n,t._query).then((i=>new Wl(e,r,t,i)))}function $6(t,e,n){t=ms(t,un);const r=ms(t.firestore,qo),i=CT(t.converter,e,n);return _m(r,[gT(pm(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,vr.none())])}function q6(t,e,n,...r){t=ms(t,un);const i=ms(t.firestore,qo),o=pm(i);let l;return l=typeof(e=Sn(e))=="string"||e instanceof md?bT(o,"updateDoc",t._key,e,n,r):_T(o,"updateDoc",t._key,e),_m(i,[l.toMutation(t._key,vr.exists(!0))])}function H6(t){return _m(ms(t.firestore,qo),[new om(t._key,vr.none())])}function _m(t,e){return(function(r,i){const o=new Si;return r.asyncQueue.enqueueAndForget((async()=>d6(await w6(r),i,o))),o.promise})(fm(t),e)}function G6(t,e,n){const r=n.docs.get(e._key),i=new TT(t);return new ko(t,i,e._key,r,new ku(n.hasPendingWrites,n.fromCache),e.converter)}class W6{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=pm(e)}set(e,n,r){this._verifyNotCommitted();const i=Xg(e,this._firestore),o=CT(i.converter,n,r),l=gT(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(l.toMutation(i._key,vr.none())),this}update(e,n,r,...i){this._verifyNotCommitted();const o=Xg(e,this._firestore);let l;return l=typeof(n=Sn(n))=="string"||n instanceof md?bT(this._dataReader,"WriteBatch.update",o._key,n,r,i):_T(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,vr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Xg(e,this._firestore);return this._mutations=this._mutations.concat(new om(n._key,vr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Le(Ie.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Xg(t,e){if((t=Sn(t)).firestore!==e)throw new Le(Ie.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Wu(...t){return new L_("arrayUnion",t)}function PS(...t){return new U_("arrayRemove",t)}function AT(t){return fm(t=ms(t,qo)),new W6(t,(e=>_m(t,e)))}(function(e,n=!0){(function(i){fc=i})(uc),Ql(new Oo("firestore",((r,{instanceIdentifier:i,options:o})=>{const l=r.getProvider("app").getImmediate(),d=new qo(new DM(r.getProvider("auth-internal")),new NM(l,r.getProvider("app-check-internal")),(function(f,p){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new Le(Ie.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Hu(f.options.projectId,p)})(l,i),l);return o={useFetchStreams:n,...o},d._setSettings(o),d}),"PUBLIC").setMultipleInstances(!0)),Ta(zw,Lw,e),Ta(zw,Lw,"esm2020")})();function Go(){return A6($E)}const Kt={showGroupTotals:!1};function Wo(t,e,n,r=1,i,o){let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const p=e.replace("months/","").split("_");if(p.length>=2){const g=p[p.length-1];l=`months/${p[p.length-2]}/${g}`}}console.log(`[Firebase] ${t}(${r}): ${l}${i===!1?" [NOT FOUND]":""}`)}async function Bt(t,e,n){const r=_c(Go(),t,e),i=`${t}/${e}`,o=await F6(r),l=o.exists(),d=l?o.data():null;return Wo("READ",i,n,1,l),{exists:l,data:d,ref:r}}async function Jn(t,e,n){const r=Go(),i=T6(r,t);let o;if(n&&n.length>0){const f=n.map(p=>z6(p.field,p.op,p.value));o=B6(i,...f)}else o=i;const l=await V6(o),d=l.docs.map(f=>({id:f.id,data:f.data()}));let h=t;if(n&&n.length>0){const f=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${f}`}return Wo("QUERY",h,e,l.docs.length,void 0),{docs:d}}async function cr(t,e,n,r,i){const o=_c(Go(),t,e),l=`${t}/${e}`;return Wo("WRITE",l,r,1,void 0),$6(o,n,i??{})}async function G_(t,e){const r=Go();for(let i=0;i<t.length;i+=500){const o=t.slice(i,i+500),l=AT(r);for(const{collectionPath:d,docId:h,data:f}of o){const p=_c(r,d,h);l.set(p,f)}Wo("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0);try{await l.commit()}catch(d){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,d),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(i/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),d}}}async function Qu(t,e,n,r){const i=_c(Go(),t,e),o=`${t}/${e}`;return Wo("UPDATE",o,r,1,void 0),q6(i,n)}async function Fy(t,e,n){const r=_c(Go(),t,e),i=`${t}/${e}`;return Wo("DELETE",i),H6(r)}async function jT(t,e,n){const i=Go();for(let o=0;o<t.length;o+=500){const l=t.slice(o,o+500),d=AT(i);for(const{collectionPath:h,docId:f}of l){const p=_c(i,h,f);d.delete(p)}Wo("BATCH_DELETE",`${l.length} docs`,e,l.length),await d.commit(),n?.(o+l.length)}}const Ao={mobile:640,tablet:768,wide:1200},Q6=Ao.mobile,gi={primary:"--color-primary",error:"--color-error",errorBg:"--color-error-bg",errorBorder:"--color-error-border",success:"--color-success",warning:"--color-warning",danger:"--color-danger",debt:"--color-debt",zero:"--color-zero"},zf=["January","February","March","April","May","June","July","August","September","October","November","December"],Ws=3,W_=3,en="ungrouped_accounts",Jt="ungrouped_categories";function K6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??en,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function Y6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget!==void 0?r.on_budget:null,is_active:r.is_active!==void 0?r.is_active:null}}),e[en]||(e[en]={name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}),e}function X6(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??Jt,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0,is_hidden:r.is_hidden??!1}}),e}function Z6(t=[]){const e=t.map(r=>({id:r.id,name:r.name,sort_order:r.sort_order??0}));if(!e.some(r=>r.id===Jt)){const r=e.length>0?Math.max(...e.map(i=>i.sort_order)):-1;e.push({id:Jt,name:"Uncategorized",sort_order:r+1})}return e.sort((r,i)=>r.sort_order-i.sort_order),e}function J6(t={}){const e={};return Object.keys(t).forEach(n=>{e[n]={}}),e}async function bm(t){const{exists:e,data:n}=await Bt("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=K6(n.accounts),i=Y6(n.account_groups),o=X6(n.categories),l=Z6(n.category_groups),d=J6(n.month_map);return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:i,categories:o,category_groups:l,month_map:d,percentage_income_months_back:n.percentage_income_months_back},accounts:r,accountGroups:i,categories:o,categoryGroups:l,monthMap:d}}async function Vy(t,e){return e.fetchQuery({queryKey:Ee.budget(t),queryFn:()=>bm(t),staleTime:Yr})}function eP(t,e){const{initialDataLoadComplete:n}=Je(),r=!!t&&e?.enabled!==!1&&n;return Uo({queryKey:t?Ee.budget(t):["budget","none"],queryFn:()=>bm(t),enabled:r,staleTime:Yr})}function Ia(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function bc(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function vm(t,e,n){if(n<1)return null;let r=t,i=e;for(let o=0;o<n;o++)i===1?(r-=1,i=12):i-=1;return{year:r,month:i}}function Ku(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function qe(t,e){return`${t}${e.toString().padStart(2,"0")}`}function $y(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function xm(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1;if(t===r&&e===i){const o=n.getDate();return`${r}-${String(i).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function wm(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}function Ae(t){return Math.round((t+Number.EPSILON)*100)/100}function ht(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function za(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>za(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=za(r));return e}return t}const Yt="__NO_CATEGORY__",zo="No Category";function lt(t){return t===Yt}const Ht="__NO_ACCOUNT__",La="No Account";function Ye(t){return t===Ht}function RT(t,e){return Ae(e.filter(n=>n.category_id===t).reduce((n,r)=>n+r.amount,0))}function IT(t,e){let n=0;for(const r of e)r.from_category_id===t&&!lt(r.from_category_id)&&(n-=r.amount),r.to_category_id===t&&!lt(r.to_category_id)&&(n+=r.amount);return Ae(n)}function kT(t,e){return Ae(e.filter(n=>n.category_id===t&&!lt(n.category_id)).reduce((n,r)=>n+r.amount,0))}function DT(t,e,n){const r={},i={},o={};for(const l of t)lt(l.category_id)||(r[l.category_id]=(r[l.category_id]||0)+l.amount);for(const l of e)lt(l.from_category_id)||(i[l.from_category_id]=(i[l.from_category_id]||0)-l.amount),lt(l.to_category_id)||(i[l.to_category_id]=(i[l.to_category_id]||0)+l.amount);for(const l of n)lt(l.category_id)||(o[l.category_id]=(o[l.category_id]||0)+l.amount);for(const l of Object.keys(r))r[l]=Ae(r[l]);for(const l of Object.keys(i))i[l]=Ae(i[l]);for(const l of Object.keys(o))o[l]=Ae(o[l]);return{spentMap:r,transfersMap:i,adjustmentsMap:o}}function MT(t,e,n,r){const i=RT(t.category_id,e),o=IT(t.category_id,n),l=kT(t.category_id,r),d=Ae(t.start_balance+t.allocated+i+o+l);return{...t,spent:i,transfers:o,adjustments:l,end_balance:d}}function OT(t,e,n,r){return t.map(i=>MT(i,e,n,r))}const tP=Object.freeze(Object.defineProperty({__proto__:null,calculateCategoryBalance:MT,calculateCategoryBalances:OT},Symbol.toStringTag,{value:"Module"}));function nP(t,e){return Ae(e.filter(n=>n.account_id===t).reduce((n,r)=>n+r.amount,0))}function rP(t,e){return Ae(e.filter(n=>n.account_id===t).reduce((n,r)=>n+r.amount,0))}function sP(t,e){let n=0;for(const r of e)r.from_account_id===t&&!Ye(r.from_account_id)&&(n-=r.amount),r.to_account_id===t&&!Ye(r.to_account_id)&&(n+=r.amount);return Ae(n)}function iP(t,e){return Ae(e.filter(n=>n.account_id===t&&!Ye(n.account_id)).reduce((n,r)=>n+r.amount,0))}function aP(t,e,n,r,i){const o=nP(t.account_id,e),l=rP(t.account_id,n),d=sP(t.account_id,r),h=iP(t.account_id,i),f=Ae(o+l+d+h),p=Ae(t.start_balance+f);return{...t,income:o,expenses:l,transfers:d,adjustments:h,net_change:f,end_balance:p}}function oP(t,e,n,r,i){return t.map(o=>aP(o,e,n,r,i))}function gd(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1;let r=e,i=n-W_;for(;i<1;)i+=12,r-=1;return{year:r,month:i}}function Sm(t,e){const n=gd(),r=qe(t,e),i=qe(n.year,n.month);return r<=i}function lP(t,e,n,r){if("spent"in t&&"transfers"in t&&"adjustments"in t&&"end_balance"in t)return t;const[i]=OT([t],e,n,r);return i}function cP(t,e,n,r,i){if("income"in t&&"expenses"in t&&"transfers"in t&&"adjustments"in t&&"net_change"in t&&"end_balance"in t)return t;const[o]=oP([t],e,n,r,i);return o}function uP(t,e,n){const r=Sm(e,n);return{category_id:t.category_id,start_balance:r?Ae(t.start_balance):0,allocated:Ae(t.allocated)}}function dP(t,e,n){const r=Sm(e,n);return{account_id:t.account_id,start_balance:r?Ae(t.start_balance):0}}function yd(t){const e=t.category_balances.map(r=>lP(r,t.expenses,t.transfers,t.adjustments)),n=t.account_balances.map(r=>cP(r,t.income,t.expenses,t.transfers,t.adjustments));return{...t,category_balances:e,account_balances:n}}function _d(t){const e=t.category_balances.map(d=>uP(d,t.year,t.month)),n=t.account_balances.map(d=>dP(d,t.year,t.month)),{total_income:r,total_expenses:i,previous_month_income:o,...l}=t;return{...l,category_balances:e,account_balances:n}}const hP="modulepreload",fP=function(t){return"/"+t},BS={},ka=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let f=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};var l=f;document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=d?.nonce||d?.getAttribute("nonce");i=f(n.map(p=>{if(p=fP(p),p in BS)return;BS[p]=!0;const g=p.endsWith(".css"),b=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const _=document.createElement("link");if(_.rel=g?"stylesheet":hP,g||(_.as="script"),_.crossOrigin="",_.href=p,h&&_.setAttribute("nonce",h),document.head.appendChild(_),g)return new Promise((w,x)=>{_.addEventListener("load",w),_.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(d){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=d,window.dispatchEvent(h),!h.defaultPrevented)throw d}return i.then(d=>{for(const h of d||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})};async function Q_(t,e,n,r,i=1){const o=vm(e,n,i);if(!o)return 0;const{year:l,month:d}=o,h=Ee.month(t,l,d);if(r){const f=r.getQueryData(h);if(f?.month){const p=f.month.income||[];return Ae(p.reduce((g,b)=>g+(b.amount||0),0))}}if(r)try{const{readMonth:f}=await ka(async()=>{const{readMonth:g}=await Promise.resolve().then(()=>pP);return{readMonth:g}},[]),p=await f(t,l,d,{description:`calculating income ${i} month(s) back for ${e}/${n}`});if(p){const g=p.income||[];return Ae(g.reduce((b,_)=>b+(_.amount||0),0))}}catch(f){console.warn(`[calculatePreviousMonthIncome] Could not fetch month ${l}/${d}:`,f)}return 0}async function mP(t,e,n,r,i,o=1){const l=t.income||[],d=t.expenses||[],h=l.reduce((b,_)=>b+(_.amount||0),0),f=d.reduce((b,_)=>b+(_.amount||0),0),p=await Q_(e,n,r,i,o),g={budget_id:e,year_month_ordinal:t.year_month_ordinal??qe(n,r),year:t.year??n,month:t.month??r,income:l,total_income:h,previous_month_income:p,expenses:d,total_expenses:f,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return yd(g)}async function nr(t,e,n,r){const i=Ia(t,e,n),l=(await Vy(t,Pe)).budget.percentage_income_months_back??1;return(await Pe.fetchQuery({queryKey:Ee.month(t,e,n),queryFn:async()=>{const{exists:h,data:f}=await Bt("months",i,r?.description??`reading month ${e}/${n}`);return!h||!f?null:{month:await mP(f,t,e,n,Pe,l)}},staleTime:Yr}))?.month??null}const pP=Object.freeze(Object.defineProperty({__proto__:null,readMonth:nr},Symbol.toStringTag,{value:"Module"}));function NT(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}function PT(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let i=W_;i>0;i--){let o=e,l=n-i;for(;l<1;)l+=12,o-=1;r.push(qe(o,l))}r.push(qe(e,n));for(let i=1;i<=Ws;i++){let o=e,l=n+i;for(;l>12;)l-=12,o+=1;r.push(qe(o,l))}return r}function gP(t,e){const n=Ee.budget(t),r=Pe.getQueryData(n);if(!r?.monthMap||!(e in r.monthMap))return!1;const i=PT();for(const o of i)if(o>=e&&!(o in r.monthMap))return!1;return!0}function yP(t,e,n){const r=Ee.budget(t),i=Pe.getQueryData(r);i&&Pe.setQueryData(r,{...i,monthMap:n,budget:{...i.budget,month_map:n}})}function _P(t,e,n){const r=Ee.budget(t),i=Pe.getQueryData(r);i&&Pe.setQueryData(r,{...i,monthMap:e,budget:{...i.budget,month_map:e}})}function bP(t,e){const n=Ee.budget(t),r=Pe.getQueryData(n);r&&Pe.setQueryData(n,{...r,monthMap:e,budget:{...r.budget,month_map:e}})}function vP(t,e,n,r){const i=qe(e,n),o=Ee.budget(t),l=Pe.getQueryData(o);if(!l)return console.warn(`[removeMonthFromMap] Budget ${t} not found in cache`),{};const d=l.monthMap||{},{[i]:h,...f}=d;return Pe.setQueryData(o,{...l,monthMap:f,budget:{...l.budget,month_map:f}}),r&&r({type:"budget",budgetId:t}),f}async function xP(t,e,n,r){const{bypassDateLimit:i=!1}={},o=new Date,l=o.getFullYear(),d=o.getMonth()+1,h=(e-l)*12+(n-d);if(!i&&h>Ws){const N=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${Ws}). This likely indicates a bug in month navigation.`;throw console.error(N),new Error(N)}const{exists:f,data:p}=await Bt("budgets",t,"validating budget exists before creating month");if(!f||!p){Pe.removeQueries({queryKey:Ee.budget(t)});const N=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(N),new Error(N)}const g=o.toISOString(),b=Ia(t,e,n),_=p.percentage_income_months_back??1;let w=0,x={},S={};if(n>1||e>new Date().getFullYear()-10){const{year:N,month:U}=bc(e,n),q=Ia(t,N,U),I=Ee.month(t,N,U),z=Pe.getQueryData(I);let M=null;if(z?.month){const X=z.month;M={budget_id:X.budget_id,year_month_ordinal:X.year_month_ordinal,year:X.year,month:X.month,income:X.income,expenses:X.expenses,transfers:X.transfers,adjustments:X.adjustments,account_balances:X.account_balances,category_balances:X.category_balances,are_allocations_finalized:X.are_allocations_finalized,created_at:X.created_at,updated_at:X.updated_at}}else try{const{exists:X,data:Y}=await Bt("months",q,"fetching previous month to create start balances for new month");X&&(M=Y)}catch(X){if(X instanceof Error&&X.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${N}/${U}, starting with zero balances`);else throw X}if(M){const X={year_month_ordinal:M.year_month_ordinal??qe(N,U),year:M.year??N,month:M.month??U,income:M.income||[],total_income:M.total_income??0,previous_month_income:M.previous_month_income??0,expenses:M.expenses||[],total_expenses:M.total_expenses??0,transfers:M.transfers||[],adjustments:M.adjustments||[],account_balances:M.account_balances||[],category_balances:M.category_balances||[],are_allocations_finalized:M.are_allocations_finalized??!1,created_at:M.created_at,updated_at:M.updated_at};if(_===1)w=X.total_income;else{const Z=vm(e,n,_);if(Z){const W=Ee.month(t,Z.year,Z.month),te=Pe.getQueryData(W);if(te?.month)w=(te.month.income||[]).reduce((B,H)=>B+(H.amount||0),0);else try{const B=Ia(t,Z.year,Z.month),{exists:H,data:ne}=await Bt("months",B,"fetching month for percentage income");H&&ne?.income&&(w=ne.income.reduce((re,ce)=>re+(ce.amount||0),0))}catch{}}}const{categoryEndBalances:Y,accountEndBalances:G}=NT(X);x=Y,S=G}}const C=Sm(e,n),T=Object.entries(x).map(([N,U])=>({category_id:N,start_balance:C?U:0,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:U})),R=Object.entries(S).map(([N,U])=>({account_id:N,start_balance:C?U:0,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:U})),k={budget_id:t,year_month_ordinal:qe(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:w,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:R,category_balances:T,are_allocations_finalized:!1,created_at:g,updated_at:g},V={budget_id:t,year_month_ordinal:qe(e,n),year:e,month:n,income:[],expenses:[],transfers:[],adjustments:[],account_balances:R,category_balances:T,are_allocations_finalized:!1,created_at:g,updated_at:g};await cr("months",b,V,"creating new month document (first time viewing this month)"),Pe.setQueryData(Ee.month(t,e,n),{month:k});const $=qe(e,n),O={...p.month_map||{},[$]:{}};return _P(t,O),await Qu("budgets",t,{month_map:O,updated_at:g},`adding month ${e}/${n} to budget month_map`),k}async function wP(t,e,n,r,i,o=1){const l=t.income||[],d=t.expenses||[],h=l.reduce((b,_)=>b+(_.amount||0),0),f=d.reduce((b,_)=>b+(_.amount||0),0),p=await Q_(e,n,r,i,o),g={budget_id:e,year_month_ordinal:t.year_month_ordinal??qe(n,r),year:t.year??n,month:t.month??r,income:l,total_income:h,previous_month_income:p,expenses:d,total_expenses:f,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return yd(g)}async function Em(t,e,n,r,i=1){const o=Ia(t,e,n);try{const{exists:l,data:d}=await Bt("months",o,`loading month ${e}/${n}`);return!l||!d?null:await wP(d,t,e,n,r,i)}catch(l){if(l instanceof Error&&l.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw l}}async function BT(t,e,n,r){if(r){const h=Ee.month(t,e,n),f=r.getQueryData(h);if(f?.month){const g=(await Vy(t,r)).budget.percentage_income_months_back??1,b=await Q_(t,e,n,r,g);return{...f.month,previous_month_income:b}}}const i=r?await Vy(t,r):null,o=i?.budget.percentage_income_months_back??1,l=await Em(t,e,n,r,o);if(l)return l;let d=!1;if(r&&i)i.monthMap&&(d=qe(e,n)in i.monthMap);else{const{exists:h,data:f}=await Bt("budgets",t,"checking month_map before creating month");if(h&&f?.month_map){const p=qe(e,n),g=f.month_map;d=p in g}}if(d)return xP(t,e,n);throw new Error(`Month ${e}/${n} does not exist in budget. Cannot create months that are not in month_map.`)}function zT(t,e,n,r){const i=Ut(),{initialDataLoadComplete:o}=Je(),l=t?Ee.month(t,e,n):["month","none"],d=!!t&&r?.enabled!==!1&&o;return Uo({queryKey:l,queryFn:async()=>({month:await BT(t,e,n,i)}),enabled:d,staleTime:Yr})}const zS=Object.freeze(Object.defineProperty({__proto__:null,fetchMonth:BT,getEndBalancesFromMonth:NT,readMonth:nr,readMonthDirect:Em,useMonthQuery:zT},Symbol.toStringTag,{value:"Module"}));async function K_(t){const{exists:e,data:n}=await Bt("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function Y_(t,e){const{initialDataLoadComplete:n}=Je(),r=!!t&&e?.enabled!==!1&&n;return Uo({queryKey:t?Ee.payees(t):["payees","none"],queryFn:()=>K_(t),enabled:r,staleTime:Yr})}async function SP(t,e){const{exists:n,data:r}=await Bt("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const i={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await cr("users",t,i,"creating new user document (first login)"),i}function LT(t,e,n){return Uo({queryKey:t?Ee.user(t):["user","none"],queryFn:()=>SP(t,e),enabled:!!t&&n?.enabled!==!1})}async function EP(t,e){const n=await Jn("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],i=[];for(const o of n.docs){const l=o.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):i.push({budgetId:o.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}return{budgets:r,pendingInvites:i}}function CP(t,e,n){return Uo({queryKey:t?Ee.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?EP(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function TP(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function AP(){const t=await Jn("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=TP(n.data.items),i=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:i})})}return{items:e}}function jP(t){return Uo({queryKey:Ee.feedback(),queryFn:AP,enabled:t?.enabled!==!1})}const bd={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function sc(t,e,n){const r=t.income||[],i=t.expenses||[],o=Ae(r.reduce((_,w)=>_+w.amount,0)),l=Ae(i.reduce((_,w)=>_+w.amount,0)),{spentMap:d,transfersMap:h,adjustmentsMap:f}=DT(i,t.transfers||[],t.adjustments||[]),p=RP(t.category_balances,e.categoryEndBalances,h,f,d),g=IP(t,e.accountEndBalances),b=n!==void 0?n:e.totalIncome;return{...t,total_income:o,total_expenses:l,previous_month_income:b,category_balances:p,account_balances:g,updated_at:new Date().toISOString()}}function RP(t,e,n,r,i){const o=new Map;for(const h of t)lt(h.category_id)||o.set(h.category_id,h);const l=new Set;for(const h of t)lt(h.category_id)||l.add(h.category_id);for(const h of Object.keys(e))lt(h)||l.add(h);for(const h of Object.keys(n))lt(h)||l.add(h);for(const h of Object.keys(r))lt(h)||l.add(h);const d=[];for(const h of l){const f=o.get(h),p=Ae(e[h]??0),g=Ae(f?.allocated??0),b=Ae(i[h]??0),_=Ae(n[h]??0),w=Ae(r[h]??0);d.push({category_id:h,start_balance:p,allocated:g,spent:b,transfers:_,adjustments:w,end_balance:Ae(p+g+b+_+w)})}return d}function IP(t,e){const n=new Set;for(const i of t.income||[])Ye(i.account_id)||n.add(i.account_id);for(const i of t.expenses||[])Ye(i.account_id)||n.add(i.account_id);for(const i of t.transfers||[])Ye(i.from_account_id)||n.add(i.from_account_id),Ye(i.to_account_id)||n.add(i.to_account_id);for(const i of t.adjustments||[])Ye(i.account_id)||n.add(i.account_id);for(const i of Object.keys(e))Ye(i)||n.add(i);for(const i of t.account_balances||[])Ye(i.account_id)||n.add(i.account_id);const r=[];for(const i of n){const o=Ae(e[i]??0),l=Ae((t.income||[]).filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)),d=Ae((t.expenses||[]).filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)),h=Ae((t.transfers||[]).filter(_=>_.from_account_id===i).reduce((_,w)=>_-w.amount,0)),f=Ae((t.transfers||[]).filter(_=>_.to_account_id===i).reduce((_,w)=>_+w.amount,0)),p=Ae(f+h),g=Ae((t.adjustments||[]).filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)),b=Ae(l+d+p+g);r.push({account_id:i,start_balance:o,income:l,expenses:d,transfers:p,adjustments:g,net_change:b,end_balance:Ae(o+b)})}return r}function Lo(t){const e={},n={};for(const r of t.category_balances||[])lt(r.category_id)||(e[r.category_id]=Ae(r.end_balance));for(const r of t.account_balances||[])Ye(r.account_id)||(n[r.account_id]=Ae(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:Ae(t.total_income)}}async function kP(t,e){return Pe.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await Bt("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function qy(t,e,n){const r=await nr(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function DP(t,e,n,r){const i={};e.forEach(b=>{i[b]=0});const o=await qy(t,n,r);if(o?.category_balances){for(const b of o.category_balances)e.includes(b.category_id)&&(i[b.category_id]=b.end_balance);return i}const l={};e.forEach(b=>{l[b]=0});const d=[];o&&d.push(o);let h=n,f=r,p=!1;const g=120;for(let b=0;b<g&&!p;b++){const _=bc(h,f);h=_.year,f=_.month;const w=await qy(t,h,f);if(!w)p=!0;else if(w.category_balances){p=!0;for(const x of w.category_balances)e.includes(x.category_id)&&(l[x.category_id]=x.end_balance)}else d.push(w)}d.reverse(),Object.assign(i,l);for(const b of d){if(b.are_allocations_finalized&&b.category_balances)for(const _ of b.category_balances)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)+_.allocated);if(b.expenses)for(const _ of b.expenses)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)-_.amount)}return i}async function UT(t,e,n,r,i){const o={...n},d=Pe.getQueryData(Ee.budget(t))?.monthMap||{},h=new Date,f=h.getFullYear(),p=h.getMonth()+1;let g=f,b=p+Ws;for(;b>12;)b-=12,g+=1;const _=qe(g,b);let w=r,x=i;const S=Ws*2;for(let C=0;C<S;C++){const T=Ku(w,x);w=T.year,x=T.month;const R=qe(w,x);if(R>_||!(R in d))break;const k=await qy(t,w,x);if(!k)break;if(k.are_allocations_finalized&&k.category_balances)for(const V of k.category_balances)e.includes(V.category_id)&&(o[V.category_id]=(o[V.category_id]||0)+V.allocated);if(k.expenses)for(const V of k.expenses)e.includes(V.category_id)&&(o[V.category_id]=(o[V.category_id]||0)-V.amount)}return o}async function LS(t,e,n,r){const i=await DP(t,e,n,r),o=await UT(t,e,i,n,r);return{current:i,total:o}}function X_(t,e){const n=t.account_group_id?e[t.account_group_id]:void 0,r=n&&n.on_budget!==null?n.on_budget:t.on_budget!==!1,i=n&&n.is_active!==null?n.is_active:t.is_active!==!1;return r&&i}function FT(t,e,n){const r=Object.entries(t).reduce((o,[,l])=>X_(l,n)?o+(l.balance??0):o,0),i=Object.values(e).reduce((o,l)=>{const d=l.balance??0;return o+(d>0?d:0)},0);return Ae(r-i)}const MP=Object.freeze(Object.defineProperty({__proto__:null,calculateTotalAvailable:FT,isAccountOnBudget:X_},Symbol.toStringTag,{value:"Module"}));function OP(t={}){const e={};return Object.keys(t).forEach(n=>{e[n]={}}),e}async function NP(t,e,n,r){const i=Pe.getQueryData(Ee.budget(t));let o=null;if(i?.budget)o=i.budget;else{const{exists:g,data:b}=await Bt("budgets",t,"[recalc] reading budget for cache update");if(!g||!b)return;o=b}if(!o)return;const l={...o.accounts};for(const[g,b]of Object.entries(e))l[g]&&(l[g]={...l[g],balance:Ae(b)});const d={...o.categories};for(const[g,b]of Object.entries(n))d[g]&&(d[g]={...d[g],balance:Ae(b)});const{calculateTotalAvailable:h}=await ka(async()=>{const{calculateTotalAvailable:g}=await Promise.resolve().then(()=>MP);return{calculateTotalAvailable:g}},void 0),f=h(l,d,o.account_groups||{}),{writeBudgetData:p}=await ka(async()=>{const{writeBudgetData:g}=await Promise.resolve().then(()=>tA);return{writeBudgetData:g}},void 0);await p({budgetId:t,updates:{month_map:r},description:"[recalc] updating month_map"}),PP(t,l,d,f,r)}function PP(t,e,n,r,i){const o=Pe.getQueryData(Ee.budget(t));if(o){const l={};for(const[h,f]of Object.entries(o.accounts)){const p=e[h];p&&p.balance!==void 0?l[h]={...f,balance:Ae(p.balance)}:l[h]=f}const d={};for(const[h,f]of Object.entries(o.categories)){const p=n[h];p&&p.balance!==void 0?d[h]={...f,balance:Ae(p.balance)}:d[h]=f}Pe.setQueryData(Ee.budget(t),{...o,accounts:l,categories:d,accountGroups:o.accountGroups,categoryGroups:o.categoryGroups,monthMap:i,budget:{...o.budget,accounts:l,categories:d,account_groups:o.budget.account_groups,category_groups:o.budget.category_groups,month_map:i}})}}async function Z_(t,e,n){const r=qe(e,n);if(gP(t,r))return{addedCount:0,budgetUpdated:!1};const i=Ee.budget(t),o=Pe.getQueryData(i);let l=null;if(o?.budget)l=o.budget;else{const{exists:g,data:b}=await Bt("budgets",t,"reading budget for month_map update");if(!g||!b)return console.warn(`[ensureMonthsInMap] Budget ${t} not found`),{addedCount:0,budgetUpdated:!1};l=b}const h={...l.month_map||{}},f=PT();let p=0;r in h||(h[r]={},p++);for(const g of f)g>=r&&!(g in h)&&(h[g]={},p++);return p===0?{addedCount:0,budgetUpdated:!1}:(yP(t,r,h),await Qu("budgets",t,{month_map:h,updated_at:new Date().toISOString()},`adding ${p} month(s) to budget month_map`),{addedCount:p,budgetUpdated:!0})}async function BP(t,e){if(e.length===0)return{addedCount:0,budgetUpdated:!1};const n=Ee.budget(t),r=Pe.getQueryData(n);let i=null;if(r?.budget)i=r.budget;else{const{exists:h,data:f}=await Bt("budgets",t,"reading budget for batch month_map update");if(!h||!f)return console.warn(`[ensureMonthsInMapBatch] Budget ${t} not found`),{addedCount:0,budgetUpdated:!1};i=f}const l={...i.month_map||{}};let d=0;for(const{year:h,month:f}of e){const p=qe(h,f);p in l||(l[p]={},d++)}return d===0?{addedCount:0,budgetUpdated:!1}:(bP(t,l),await Qu("budgets",t,{month_map:l,updated_at:new Date().toISOString()},`adding ${d} month(s) to budget month_map (batch)`),{addedCount:d,budgetUpdated:!0})}const zP=Object.freeze(Object.defineProperty({__proto__:null,ensureMonthsInMap:Z_,ensureMonthsInMapBatch:BP},Symbol.toStringTag,{value:"Module"}));async function VT(t,e,n){const r=Ia(t,e.year,e.month),i=_d(e);await cr("months",r,i,`writeMonthData: ${n}`)}async function J_(t){const{budgetId:e,month:n,description:r,updateMonthMap:i=!0}=t;await VT(e,n,r||`${n.year}/${n.month}`),Pe.setQueryData(Ee.month(e,n.year,n.month),{month:n}),i&&await Z_(e,n.year,n.month)}function LP(){const t=Ut();return{writeData:Gn({mutationFn:async({budgetId:n,month:r,description:i,updateMonthMap:o=!0})=>(await VT(n,r,i||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,updateMonthMap:o}),onMutate:async({budgetId:n,month:r})=>{const i=Ee.month(n,r.year,r.month);await t.cancelQueries({queryKey:i});const o=t.getQueryData(i);return t.setQueryData(i,{month:r}),{oldMonthQueryData:o,monthKey:i}},onSuccess:async({budgetId:n,year:r,month:i,updateMonthMap:o})=>{o&&await Z_(n,r,i)},onError:(n,r,i)=>{i?.oldMonthQueryData&&t.setQueryData(i.monthKey,i.oldMonthQueryData)}})}}function UP(){const{writeData:t}=LP();return{saveDraftAllocations:async(n,r,i,o)=>{const l=await nr(n,r,i);if(!l)throw new Error(`Month not found: ${r}/${i}`);const{calculateCategoryBalances:d}=await ka(async()=>{const{calculateCategoryBalances:g}=await Promise.resolve().then(()=>tP);return{calculateCategoryBalances:g}},void 0),h=l.category_balances.map(g=>({category_id:g.category_id,start_balance:g.start_balance,allocated:Ae(o[g.category_id]??g.allocated)})),f=d(h,l.expenses||[],l.transfers||[],l.adjustments||[]),p={...l,category_balances:f,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:p,updateMonthMap:!1}),{updatedMonth:p}},isPending:t.isPending,isError:t.isError,error:t.error}}const pe={primary:`var(${gi.primary})`,error:`var(${gi.error})`,errorBg:`var(${gi.errorBg})`,errorBorder:`var(${gi.errorBorder})`,success:`var(${gi.success})`,danger:`var(${gi.danger})`,warning:`var(${gi.warning})`,debt:`var(${gi.debt})`,zero:`var(${gi.zero})`},hs={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},Ua="1px solid color-mix(in srgb, currentColor 20%, transparent)",Lf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},e0={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},FP={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},VP={display:"flex",flexDirection:"column",gap:"0.5rem"},$P={fontSize:"0.9rem",fontWeight:500},Ha={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},qP={...Ha,cursor:"pointer"},t0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},$T={...t0,background:pe.primary,color:"white",border:"none"},HP={...$T,padding:"0.75rem 1.5rem",borderRadius:"8px"},GP={...t0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},WP={...t0,background:"transparent",border:`1px solid ${pe.errorBorder}`,color:pe.error},QP={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s",whiteSpace:"nowrap"},va={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},Uf={display:"flex",flexDirection:"column",gap:"2px"},KP={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},YP={opacity:.4,cursor:"grab"},XP={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:pe.primary,borderRadius:"2px",transition:"opacity 0.15s"},ZP={position:"relative",height:"2rem",marginTop:"-0.25rem"},JP={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:pe.primary,borderRadius:"2px",transition:"opacity 0.15s"},eB={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--surface-base)",padding:"0 0.5rem",whiteSpace:"nowrap"},tB={background:pe.errorBg,border:`1px solid ${pe.errorBorder}`,color:pe.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},nB={background:"transparent",border:"none",color:pe.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},qT={opacity:.7,marginBottom:"1.5rem"},US={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"};function Cm({message:t,children:e,onDismiss:n,style:r}){return u.jsxs("div",{style:{...tB,...r},children:[u.jsx("span",{children:e??t}),n&&u.jsx("button",{onClick:n,style:nB,children:""})]})}const rB={primary:$T,"primary-large":HP,secondary:GP,danger:WP,small:QP},sB={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:pe.warning,color:"var(--text-primary)",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px var(--shadow-overlay)",animation:"tooltipFadeIn 0.15s ease-out"},iB={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${pe.warning}`};function $e({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:i,style:o,actionName:l,disabledReason:d,onClick:h,...f}){const p=rB[t],g=i||e,[b,_]=A.useState(!1);function w(C){h?.(C)}function x(C){g&&d&&(C.preventDefault(),C.stopPropagation(),_(!0),setTimeout(()=>_(!1),3e3))}const S=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return u.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:x,children:[b&&d&&u.jsxs("div",{style:sB,children:[d,u.jsx("div",{style:iB})]}),u.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...S,...o},onClick:w,...f,children:e?n:r})]})}function HT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const d=r.indexOf(n);return{match:!0,score:d===0||/\s/.test(r[d-1])?100:90}}let i=0,o=0,l=0;for(let d=0;d<r.length&&i<n.length;d++)r[d]===n[i]?(i++,l++,o+=l*2):l=0;return i===n.length?{match:!0,score:o}:{match:!1,score:0}}function GT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function WT(t){const e=GT(t),n=[];let r="__initial__";return e.forEach(i=>{i.groupId!==r&&(r=i.groupId,n.push({groupId:i.groupId,groupName:i.groupName,groupSortOrder:i.groupSortOrder,items:[]})),n[n.length-1].items.push(i)}),n}function QT(t,e,n){return e.trim()?t.map(i=>{const o=n(i);let l=0,d=!1;for(const h of o){const f=HT(e,h);f.match&&(d=!0,l=Math.max(l,f.score))}return{item:i,score:l,hasMatch:d}}).filter(({hasMatch:i})=>i).sort((i,o)=>o.score!==i.score?o.score-i.score:!i.item.groupId&&o.item.groupId?1:i.item.groupId&&!o.item.groupId?-1:i.item.groupSortOrder!==o.item.groupSortOrder?i.item.groupSortOrder-o.item.groupSortOrder:i.item.sortOrder-o.item.sortOrder).map(({item:i})=>i):GT(t)}const n0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--surface-base)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px var(--shadow-overlay)",zIndex:1e3},Yu={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function FS({id:t,value:e,onChange:n,payees:r,placeholder:i="Enter payee name",autoFocus:o}){const[l,d]=A.useState(!1),[h,f]=A.useState(-1),p=A.useRef(null),g=A.useRef(null),b=e.trim()?r.map(x=>({payee:x,...HT(e,x)})).filter(x=>x.match).sort((x,S)=>S.score-x.score).slice(0,8).map(x=>x.payee):[];A.useEffect(()=>{function x(S){p.current&&!p.current.contains(S.target)&&d(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function _(x){!l||b.length===0||(x.key==="ArrowDown"?(x.preventDefault(),f(S=>Math.min(S+1,b.length-1))):x.key==="ArrowUp"?(x.preventDefault(),f(S=>Math.max(S-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(b[h]),d(!1),f(-1)):x.key==="Escape"&&(d(!1),f(-1)))}function w(x){n(x),d(!1),f(-1),g.current?.focus()}return u.jsxs("div",{ref:p,style:{position:"relative"},children:[u.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),d(!0),f(-1)},onFocus:()=>d(!0),onKeyDown:_,placeholder:i,autoComplete:"off",autoFocus:o,style:Ha}),l&&b.length>0&&u.jsx("div",{style:{...n0,maxHeight:"200px",overflowY:"auto"},children:b.map((x,S)=>u.jsx("div",{onClick:()=>w(x),style:{...Yu,background:S===h?`color-mix(in srgb, ${pe.primary} 20%, transparent)`:"transparent",borderBottom:S<b.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>f(S),children:x},x))})]})}function KT({id:t,value:e,onChange:n,categories:r,categoryGroups:i,placeholder:o="Search categories...",required:l,showNoCategoryOption:d=!1,showHiddenCategories:h=!1}){const f=Object.fromEntries(i.map(G=>[G.id,G.name])),p=Object.fromEntries(i.map(G=>[G.id,G.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,G])=>!G.is_hidden)),b=Object.entries(g).map(([G,Z])=>({id:G,name:Z.name,groupId:Z.category_group_id,groupName:Z.category_group_id&&f[Z.category_group_id]||null,sortOrder:Z.sort_order,groupSortOrder:Z.category_group_id?p[Z.category_group_id]??999:999})),_=e===Yt,w=_?null:e?r[e]:null,x=_?"":w?.name||"",[S,C]=A.useState(x),[T,R]=A.useState(!1),[k,V]=A.useState(-1),$=A.useRef(null),D=A.useRef(null);A.useEffect(()=>{if(e===Yt)C("");else if(e){const G=r[e];C(G?.name||"")}},[e,r]);const O=QT(b,S,G=>[G.name]),N=WT(O);A.useEffect(()=>{function G(Z){if($.current&&!$.current.contains(Z.target))if(R(!1),e===Yt)C("");else{const W=e?r[e]:null;C(W?.name||"")}}return document.addEventListener("mousedown",G),()=>document.removeEventListener("mousedown",G)},[e,r]);function U(G){if(G.key==="ArrowDown")G.preventDefault(),T?V(Z=>Math.min(Z+1,O.length-1)):(R(!0),V(0));else if(G.key==="ArrowUp")G.preventDefault(),V(Z=>Math.max(Z-1,0));else if(G.key==="Enter")G.preventDefault(),T&&k>=0&&O[k]&&q(O[k]);else if(G.key==="Escape")if(R(!1),V(-1),e===Yt)C("");else{const Z=e?r[e]:null;C(Z?.name||"")}else if(G.key==="Tab")if(T&&k>=0&&O[k])q(O[k]);else if(R(!1),V(-1),e===Yt)C("");else{const Z=e?r[e]:null;C(Z?.name||"")}}function q(G){n(G.id),C(G.id===Yt?"":G.name),R(!1),V(-1)}function I(){n(Yt),C(""),R(!1),V(-1)}function z(G){const Z=G.target.value;C(Z),R(!0),V(Z.trim()?0:-1),Z!==x&&(d&&Z.trim()===""?n(Yt):n(""))}function M(){R(!0),d&&(e===Yt||S.trim()==="")?V(-1):O.length>0&&V(0)}let X=-1;const Y=()=>++X;return u.jsxs("div",{ref:$,style:{position:"relative"},children:[u.jsx("input",{ref:D,id:t,type:"text",value:S,onChange:z,onFocus:M,onKeyDown:U,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Ha,borderColor:l&&!e?pe.error:void 0}}),T&&u.jsxs("div",{style:{...n0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:I,onMouseEnter:()=>V(-1),style:{...Yu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:k===-1?`color-mix(in srgb, ${pe.primary} 20%, transparent)`:"transparent"},children:zo}),N.map((G,Z)=>u.jsxs("div",{children:[G.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:G.groupName}),G.items.map(W=>{const te=Y();return u.jsx("div",{onClick:()=>q(W),style:{...Yu,paddingLeft:G.groupName?"1.2rem":"0.8rem",background:te===k?`color-mix(in srgb, ${pe.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>V(te),children:W.name},W.id)})]},`group-${Z}`)),O.length===0&&S.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function YT({id:t,value:e,onChange:n,accounts:r,accountGroups:i,placeholder:o="Search accounts...",required:l,showNoAccountOption:d=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,X])=>!X.is_hidden)).map(([X,Y])=>({id:X,name:Y.nickname,groupId:Y.account_group_id,groupName:Y.account_group_id&&i[Y.account_group_id]?.name||null,sortOrder:Y.sort_order,groupSortOrder:Y.account_group_id?i[Y.account_group_id]?.sort_order??999:999})),g=e===Ht,b=g?null:r.find(([X])=>X===e)?.[1],_=g?"":b?.nickname||"",[w,x]=A.useState(_),[S,C]=A.useState(!1),[T,R]=A.useState(-1),k=A.useRef(null),V=A.useRef(null);A.useEffect(()=>{if(e===Ht)x("");else if(e){const X=r.find(([Y])=>Y===e)?.[1];x(X?.nickname||"")}},[e,r]);const $=QT(p,w,X=>[X.name]),D=WT($);A.useEffect(()=>{function X(Y){if(k.current&&!k.current.contains(Y.target))if(C(!1),e===Ht)x("");else{const G=r.find(([Z])=>Z===e)?.[1];x(G?.nickname||"")}}return document.addEventListener("mousedown",X),()=>document.removeEventListener("mousedown",X)},[e,r]);function O(X){if(X.key==="ArrowDown")X.preventDefault(),S?R(Y=>Math.min(Y+1,$.length-1)):(C(!0),R(0));else if(X.key==="ArrowUp")X.preventDefault(),R(Y=>Math.max(Y-1,0));else if(X.key==="Enter")X.preventDefault(),S&&T>=0&&$[T]&&N($[T]);else if(X.key==="Escape")if(C(!1),R(-1),e===Ht)x("");else{const Y=r.find(([G])=>G===e)?.[1];x(Y?.nickname||"")}else if(X.key==="Tab")if(S&&T>=0&&$[T])N($[T]);else if(C(!1),R(-1),e===Ht)x("");else{const Y=r.find(([G])=>G===e)?.[1];x(Y?.nickname||"")}}function N(X){n(X.id),x(X.id===Ht?"":X.name),C(!1),R(-1)}function U(){n(Ht),x(""),C(!1),R(-1)}function q(X){const Y=X.target.value;x(Y),C(!0),R(Y.trim()?0:-1),Y!==_&&(d&&Y.trim()===""?n(Ht):n(""))}function I(){C(!0),d&&(e===Ht||w.trim()==="")?R(-1):$.length>0&&R(0)}let z=-1;const M=()=>++z;return u.jsxs("div",{ref:k,style:{position:"relative"},children:[u.jsx("input",{ref:V,id:t,type:"text",value:w,onChange:q,onFocus:I,onKeyDown:O,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Ha,borderColor:l&&!e?pe.error:void 0}}),S&&u.jsxs("div",{style:{...n0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:U,onMouseEnter:()=>R(-1),style:{...Yu,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${pe.primary} 20%, transparent)`:"transparent"},children:La}),D.map((X,Y)=>u.jsxs("div",{children:[X.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:X.groupName}),X.items.map(G=>{const Z=M();return u.jsx("div",{onClick:()=>N(G),style:{...Yu,paddingLeft:X.groupName?"1.2rem":"0.8rem",background:Z===T?`color-mix(in srgb, ${pe.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>R(Z),children:G.name},G.id)})]},`group-${Y}`)),$.length===0&&w.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function Ii({children:t,onSubmit:e,actionName:n}){function r(i){e(i)}return u.jsx("form",{onSubmit:r,style:FP,children:t})}function Nt({label:t,htmlFor:e,children:n,hint:r,style:i}){return u.jsxs("div",{style:{...VP,...i},children:[u.jsx("label",{htmlFor:e,style:$P,children:t}),n,r&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function ki(t){return u.jsx("input",{style:Ha,...t})}function aB(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function Ff({value:t,onChange:e,style:n,autoFocus:r,...i}){const o=A.useRef(null),l=A.useRef(null),d=aB(t);A.useEffect(()=>{r&&l.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function f(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...i}),u.jsx("div",{ref:l,tabIndex:0,onClick:h,onKeyDown:f,style:{...Ha,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:d||"Select date"})]})}function Xu({children:t,...e}){return u.jsx("select",{style:qP,...e,children:t})}function r0({minHeight:t="6rem",style:e,...n}){return u.jsx("textarea",{style:{...Ha,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function Ga({children:t}){return u.jsx("div",{style:KP,children:t})}function Zg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",i=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return i!==void 0?`$${o}.${i.slice(0,2)}`:o?`$${o}`:""}function oB(t){return t.replace(/[$,]/g,"")}function Io({id:t,value:e,onChange:n,placeholder:r="$0.00",required:i,autoFocus:o,style:l}){const[d,h]=A.useState(()=>Zg(e)),f=A.useRef(null);A.useEffect(()=>{const g=Zg(e);oB(d)!==e&&h(g)},[e]);function p(g){const b=g.target.value;if(!b||b==="$"){h(""),n("");return}const w=b.replace(/[^\d.]/g,"").split(".");let x=w[0];w.length>1&&(x+="."+w.slice(1).join("").slice(0,2));const S=Zg(x);h(S),n(x)}return u.jsx("input",{ref:f,id:t,type:"text",inputMode:"decimal",value:d,onChange:p,placeholder:r,required:i,autoFocus:o,style:{...Ha,...l}})}function Oi(t=Q6){const[e,n]=A.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return A.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function i(l){n(l.matches)}i(r),r.addEventListener("change",i);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",i),window.removeEventListener("resize",o)}},[t]),e}function XT(){const[t,e]=A.useState(()=>typeof window>"u"?1200:window.innerWidth);return A.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=Ao.wide,isMedium:t>=Ao.tablet&&t<Ao.wide,isNarrowMedium:t>=Ao.mobile&&t<Ao.tablet,isMobile:t<Ao.mobile}}function Rn(){const{selectedBudgetId:t,currentUserId:e}=Je(),n=eP(t),r=n.data,i=r?.budget||null,o=A.useMemo(()=>r?.accounts||{},[r?.accounts]),l=A.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),d=A.useMemo(()=>r?.categories||{},[r?.categories]),h=A.useMemo(()=>{const k=r?.categoryGroups||[];return k.length>0?[...k]:[]},[r?.categoryGroups]),f=i?.owner_id===e,p=A.useMemo(()=>i?.user_ids||[],[i?.user_ids]),g=A.useMemo(()=>i?.accepted_user_ids||[],[i?.accepted_user_ids]),b=A.useMemo(()=>i?FT(o,d,l):0,[i,o,l,d]),_=A.useMemo(()=>r?.monthMap||{},[r?.monthMap]),w=A.useCallback(k=>{if(!t)return;const V=Pe.getQueryData(Ee.budget(t));V&&Pe.setQueryData(Ee.budget(t),{...V,accounts:k})},[t]),x=A.useCallback(k=>{if(!t)return;const V=Pe.getQueryData(Ee.budget(t));V&&Pe.setQueryData(Ee.budget(t),{...V,accountGroups:k})},[t]),S=A.useCallback(k=>{if(!t)return;const V=Pe.getQueryData(Ee.budget(t));V&&Pe.setQueryData(Ee.budget(t),{...V,categories:k,budget:{...V.budget,categories:k}})},[t]),C=A.useCallback(k=>{if(!t)return;const V=Pe.getQueryData(Ee.budget(t));if(V){const $=[...k];Pe.setQueryData(Ee.budget(t),{...V,categoryGroups:$,budget:{...V.budget,category_groups:$}})}},[t]),T=A.useCallback(async()=>{t&&await Pe.invalidateQueries({queryKey:Ee.budget(t)})},[t]),R=A.useCallback(()=>Object.entries(o).filter(([,k])=>X_(k,l)).reduce((k,[,V])=>k+V.balance,0),[o,l]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:i,accounts:o,accountGroups:l,categories:d,categoryGroups:h,isOwner:f,budgetUserIds:p,acceptedUserIds:g,totalAvailable:b,monthMap:_,setAccountsOptimistic:w,setAccountGroupsOptimistic:x,setCategoriesOptimistic:S,setCategoryGroupsOptimistic:C,refreshBudget:T,getOnBudgetTotal:R}}function Ys(t,e,n){const{addLoadingHold:r,removeLoadingHold:i}=jn(),o=Ut(),l=zT(t,e,n,{enabled:!!t});A.useEffect(()=>{const T=t?Ee.month(t,e,n):null;if(!T){i("month-query");return}const R=!!l.data,k=o.getQueryState(T),V=k?.dataUpdatedAt?Date.now()-k.dataUpdatedAt>Yr:!1;return!R||V&&l.isFetching||l.isLoading?r("month-query","Loading month data..."):i("month-query"),()=>i("month-query")},[l.isLoading,l.isFetching,l.data,t,e,n,o,r,i]);const d=l.data?.month||null,h=A.useMemo(()=>d?.income||[],[d?.income]),f=A.useMemo(()=>d?.expenses||[],[d?.expenses]),p=A.useMemo(()=>d?.transfers||[],[d?.transfers]),g=A.useMemo(()=>d?.adjustments||[],[d?.adjustments]),b=A.useMemo(()=>d?.category_balances||[],[d?.category_balances]),_=A.useMemo(()=>d?.account_balances||[],[d?.account_balances]),w=d?.total_income||0,x=d?.total_expenses||0,S=d?.are_allocations_finalized||!1,C=d?.previous_month_income??0;return{isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,month:d,income:h,expenses:f,transfers:p,adjustments:g,categoryBalances:b,accountBalances:_,totalIncome:w,totalExpenses:x,areAllocationsFinalized:S,previousMonthIncome:C}}const lB={trackChange:()=>{},clearChanges:()=>{},removeChange:()=>{},getChanges:()=>[],hasChanges:()=>!1,isSaving:!1,setIsSaving:()=>{},lastSaveTime:null,setLastSaveTime:()=>{},saveError:null,setSaveError:()=>{},clearSaveError:()=>{},syncError:null,setSyncError:()=>{}},ZT=A.createContext(lB);function cB({children:t}){const[e,n]=A.useState(new Map),[r,i]=A.useState(!1),[o,l]=A.useState(null),[d,h]=A.useState(null),[f,p]=A.useState(null),g=A.useCallback($=>{i($)},[]),b=A.useCallback($=>{l($)},[]),_=A.useCallback($=>{h($)},[]),w=A.useCallback($=>$.type==="month"&&$.year!==void 0&&$.month!==void 0?`${$.type}:${$.budgetId}:${$.year}:${$.month}`:`${$.type}:${$.budgetId}`,[]),x=A.useCallback($=>{n(D=>{const O=new Map(D),N=w($);return O.set(N,{...$,timestamp:Date.now()}),O})},[w]),S=A.useCallback(()=>{n(new Map)},[]),C=A.useCallback($=>{n(D=>{const O=new Map(D),N=w($);return O.delete(N),O})},[w]),T=A.useCallback(()=>Array.from(e.values()),[e]),R=A.useCallback(()=>e.size>0,[e]),k=A.useCallback(()=>{h(null)},[]),V={trackChange:x,clearChanges:S,removeChange:C,getChanges:T,hasChanges:R,isSaving:r,lastSaveTime:o,saveError:d,clearSaveError:k,setIsSaving:g,setLastSaveTime:b,setSaveError:_,syncError:f,setSyncError:p};return u.jsx(ZT.Provider,{value:V,children:t})}function vd(){const t=A.useContext(ZT);if(!t)throw new Error("useSync must be used within a SyncProvider");return t}function Tm(){const{trackChange:t}=vd();return{updateBudgetCacheAndTrack:(n,r)=>{Pe.setQueryData(Ee.budget(n),r),t({type:"budget",budgetId:n})}}}function JT(){const t=Ut(),{currentViewingDocument:e}=Je(),{saveCurrentDocument:n}=In(),{updateBudgetCacheAndTrack:r}=Tm(),i=Gn({onMutate:async l=>{const{budgetId:d,accounts:h}=l,f=Ee.budget(d);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,accounts:h};r(d,b)}if(e.type==="budget")try{await n(d,"budget")}catch(b){console.warn("[useUpdateAccounts] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{accounts:d}=l;return{accounts:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Ee.budget(d.budgetId),h.previousData)}});return{updateAccounts:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function uB(){const t=Ut(),{currentViewingDocument:e}=Je(),{saveCurrentDocument:n}=In(),{updateBudgetCacheAndTrack:r}=Tm(),i=Gn({onMutate:async l=>{const{budgetId:d,accountGroups:h}=l,f=Ee.budget(d);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,accountGroups:h};r(d,b)}if(e.type==="budget")try{await n(d,"budget")}catch(b){console.warn("[useUpdateAccountGroups] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{accountGroups:d}=l;return{accountGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Ee.budget(d.budgetId),h.previousData)}});return{updateAccountGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function eA(){const t=Ut(),{currentViewingDocument:e}=Je(),{saveCurrentDocument:n}=In(),{updateBudgetCacheAndTrack:r}=Tm(),i=Gn({onMutate:async l=>{const{budgetId:d,categories:h}=l,f=Ee.budget(d);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,categories:h,budget:{...p.budget,categories:h}};r(d,b)}if(e.type==="budget")try{await n(d,"budget")}catch(b){console.warn("[useUpdateCategories] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{categories:d}=l;return{categories:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Ee.budget(d.budgetId),h.previousData)}});return{updateCategories:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function dB(){const t=Ut(),{currentViewingDocument:e}=Je(),{saveCurrentDocument:n}=In(),{updateBudgetCacheAndTrack:r}=Tm(),i=Gn({onMutate:async l=>{const{budgetId:d,categoryGroups:h}=l,f=Ee.budget(d);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const b={...p,categoryGroups:h,budget:{...p.budget,category_groups:h}};r(d,b)}if(e.type==="budget")try{await n(d,"budget")}catch(b){console.warn("[useUpdateCategoryGroups] Failed to save current document immediately:",b)}return{previousData:p}},mutationFn:async l=>{const{categoryGroups:d}=l;return{categoryGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(Ee.budget(d.budgetId),h.previousData)}});return{updateCategoryGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}async function vc(t){const{budgetId:e,updates:n,description:r}=t,{total_available:i,is_needs_recalculation:o,...l}=n,d={...l,updated_at:new Date().toISOString()},h=za(d);await cr("budgets",e,h,r,{merge:!0});const f=Pe.getQueryData(Ee.budget(e));f&&Pe.setQueryData(Ee.budget(e),{...f,budget:{...f.budget,...n}})}const tA=Object.freeze(Object.defineProperty({__proto__:null,writeBudgetData:vc},Symbol.toStringTag,{value:"Module"}));function hB(){const t=Ut(),e=Gn({onMutate:async r=>{const{budgetId:i,newName:o}=r,l=Ee.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,name:o.trim()}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,newName:o}=r,l=o.trim();return await vc({budgetId:i,updates:{name:l},description:`renaming budget to "${l}"`}),{newName:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ee.budget(i.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function fB({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:i,saveAccounts:o,saveAccountGroups:l,setError:d}){const h=A.useCallback(async(p,g,b)=>{const _=e[p];if(!_)return;const w=b==="ungrouped"?en:b,x=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===b),S={};Object.entries(e).forEach(([T,R])=>{T!==p&&(S[T]={...R})});let C;if(g==="__group_end__"||x.length===0||!x.find(([T])=>T===g))C=(x.length>0?Math.max(...x.filter(([R])=>R!==p).map(([,R])=>R.sort_order)):-1)+1;else{const T=x.find(([R])=>R===g);if(T){const[,R]=T;C=R.sort_order,Object.entries(S).forEach(([k,V])=>{(V.account_group_id||"ungrouped")===b&&V.sort_order>=C&&(S[k]={...V,sort_order:V.sort_order+1})})}else C=0}if(S[p]={..._,account_group_id:w,sort_order:C},r(S),!!t)try{await o(S)}catch(T){d(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,d]),f=A.useCallback(async(p,g)=>{if(p===g)return;const b=Object.entries(n).sort(([,C],[,T])=>C.sort_order-T.sort_order),_=b.findIndex(([C])=>C===p),w=[...b],[x]=w.splice(_,1);if(g==="__end__")w.push(x);else{const C=w.findIndex(([T])=>T===g);w.splice(C,0,x)}const S={};if(w.forEach(([C,T],R)=>{S[C]={...T,sort_order:R}}),i(S),!!t)try{await l(S)}catch(C){d(C instanceof Error?C.message:"Failed to save new order")}},[t,n,i,l,d]);return{reorderAccountsInGroup:h,reorderGroups:f}}function mB(){const{selectedBudgetId:t}=Je(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o}=Rn(),{updateAccounts:l}=JT(),{updateAccountGroups:d}=uB(),[h,f]=A.useState(null),p=A.useCallback(async U=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accounts:U})},[t,l]),g=A.useCallback(async U=>{if(!t)throw new Error("No budget selected");await d.mutateAsync({budgetId:t,accountGroups:U})},[t,d]),b=A.useCallback(async(U,q)=>{if(!t)throw new Error("No budget selected");await Promise.all([l.mutateAsync({budgetId:t,accounts:U}),d.mutateAsync({budgetId:t,accountGroups:q})])},[t,l,d]),_=A.useMemo(()=>Object.entries(n).filter(([,U])=>!U.is_hidden).reduce((U,[q,I])=>{const z=I.account_group_id||en;return U[z]||(U[z]=[]),U[z].push({...I,id:q}),U},{}),[n]),w=A.useMemo(()=>Object.entries(n).filter(([,U])=>U.is_hidden).map(([U,q])=>({...q,id:U})).sort((U,q)=>U.sort_order-q.sort_order),[n]),x=A.useMemo(()=>Object.entries(r).sort(([,U],[,q])=>U.sort_order-q.sort_order).map(([U,q])=>({...q,id:U})),[r]),S=A.useCallback((U,q)=>{if(!e)return;const I=q||en,z=Object.values(n).filter(Z=>Z.account_group_id===I),M=z.length>0?Math.max(...z.map(Z=>Z.sort_order)):-1,X=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,Y={nickname:U.nickname,description:"",balance:0,account_group_id:I,sort_order:M+1,is_income_account:U.is_income_account??!1,is_income_default:U.is_income_default??!1,is_outgo_account:U.is_outgo_account??!1,is_outgo_default:U.is_outgo_default??!1,on_budget:U.on_budget!==!1,is_active:U.is_active!==!1,is_hidden:U.is_hidden??!1},G={...n};U.is_income_default&&Object.keys(G).forEach(Z=>{G[Z]={...G[Z],is_income_default:!1}}),U.is_outgo_default&&Object.keys(G).forEach(Z=>{G[Z]={...G[Z],is_outgo_default:!1}}),G[X]=Y,i(G),p(G).catch(Z=>f(Z instanceof Error?Z.message:"Failed to create account."))},[e,n,i,p]),C=A.useCallback((U,q)=>{if(!e)return;const I=n[U];if(!I)return;const z=I.account_group_id||en,M=q.account_group_id||en;let X=I.sort_order;if(z!==M){const G=Object.values(n).filter(Z=>Z.account_group_id===M);X=G.length>0?Math.max(...G.map(Z=>Z.sort_order))+1:0}const Y={};Object.entries(n).forEach(([G,Z])=>{G===U?Y[G]={...Z,nickname:q.nickname,account_group_id:M,sort_order:X,is_income_account:q.is_income_account??!1,is_income_default:q.is_income_default??!1,is_outgo_account:q.is_outgo_account??!1,is_outgo_default:q.is_outgo_default??!1,on_budget:q.on_budget!==!1,is_active:q.is_active!==!1,is_hidden:q.is_hidden??!1}:(Y[G]={...Z},q.is_income_default&&!I.is_income_default&&(Y[G].is_income_default=!1),q.is_outgo_default&&!I.is_outgo_default&&(Y[G].is_outgo_default=!1))}),i(Y),p(Y).catch(G=>f(G instanceof Error?G.message:"Failed to save account."))},[e,n,i,p]),T=A.useCallback(U=>{if(!confirm("Are you sure you want to delete this account?")||!e)return;const{[U]:q,...I}=n;i(I),p(I).catch(z=>f(z instanceof Error?z.message:"Failed to delete account."))},[e,n,i,p]),R=A.useCallback(async(U,q)=>{const I=n[U];if(!I)return;const z=I.account_group_id||en,M=Object.entries(n).filter(([,te])=>te.account_group_id===z).sort(([,te],[,B])=>te.sort_order-B.sort_order),X=M.findIndex(([te])=>te===U),Y=q==="up"?X-1:X+1;if(Y<0||Y>=M.length)return;const[G,Z]=M[Y],W={};if(Object.entries(n).forEach(([te,B])=>{te===U?W[te]={...B,sort_order:Z.sort_order}:te===G?W[te]={...B,sort_order:I.sort_order}:W[te]={...B}}),i(W),!!e)try{await p(W)}catch(te){i(n),f(te instanceof Error?te.message:"Failed to move account")}},[e,n,i,p]),k=A.useCallback(U=>{if(!e)return;const q=Object.values(r).map(Y=>Y.sort_order),I=q.length>0?Math.max(...q):-1,z=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,M={name:U.name,sort_order:I+1,expected_balance:U.expected_balance,on_budget:U.on_budget??null,is_active:U.is_active??null},X={...r,[z]:M};o(X),g(X).catch(Y=>f(Y instanceof Error?Y.message:"Failed to create account type."))},[e,r,o,g]),V=A.useCallback((U,q)=>{if(!e)return;const I={...r,[U]:{...r[U],name:q.name,expected_balance:q.expected_balance,on_budget:q.on_budget??null,is_active:q.is_active??null}};o(I),g(I).catch(z=>f(z instanceof Error?z.message:"Failed to update account type."))},[e,r,o,g]),$=A.useCallback(U=>{if(U===en){alert("Cannot delete the default Ungrouped account type.");return}if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e)return;const q={};Object.entries(n).forEach(([M,X])=>{q[M]=X.account_group_id===U?{...X,account_group_id:en}:X});const{[U]:I,...z}=r;i(q),o(z),b(q,z).catch(M=>f(M instanceof Error?M.message:"Failed to delete account type."))},[e,n,r,i,o,b]),D=A.useCallback(async(U,q)=>{const I=Object.entries(r).sort(([,G],[,Z])=>G.sort_order-Z.sort_order),z=I.findIndex(([G])=>G===U),M=q==="up"?z-1:z+1;if(M<0||M>=I.length)return;const[X]=I.splice(z,1);I.splice(M,0,X);const Y={};if(I.forEach(([G,Z],W)=>{Y[G]={...Z,sort_order:W}}),o(Y),!!e)try{await g(Y)}catch(G){o(r),f(G instanceof Error?G.message:"Failed to move account type")}},[e,r,o,g]),{reorderAccountsInGroup:O,reorderGroups:N}=fB({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o,saveAccounts:p,saveAccountGroups:g,setError:f});return{accounts:n,accountGroups:r,accountsByGroup:_,hiddenAccounts:w,sortedGroups:x,currentBudget:e,error:h,setError:f,handleCreateAccount:S,handleUpdateAccount:C,handleDeleteAccount:T,handleMoveAccount:R,handleCreateGroup:k,handleUpdateGroup:V,handleDeleteGroup:$,handleMoveGroup:D,reorderAccountsInGroup:O,reorderGroups:N}}function VS(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,i])=>{if(i.default_monthly_type==="percentage")return;const o=t.category_balances?.find(l=>l.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():i.default_monthly_amount!==void 0&&i.default_monthly_amount>0?n[r]=i.default_monthly_amount.toString():n[r]=""}),n}function pB(){const{addLoadingHold:t,removeLoadingHold:e}=jn(),{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Je(),{categories:o,getOnBudgetTotal:l,totalAvailable:d}=Rn(),{month:h,isLoading:f,previousMonthIncome:p,areAllocationsFinalized:g}=Ys(n,r,i),b=A.useMemo(()=>h?.income?h.income.reduce((B,H)=>B+H.amount,0):0,[h]),{saveDraftAllocations:_}=UP(),{finalizeAllocations:w}=lz(),{deleteAllocations:x}=pA(),S=A.useMemo(()=>VS(h,o),[h,o]),[C,T]=A.useState(S),[R,k]=A.useState(!1),[V,$]=A.useState(null),D=A.useRef(null);A.useMemo(()=>Object.values(o).reduce((B,H)=>B+(H.balance??0),0),[o]),A.useEffect(()=>{if(!h)return;const B=`${h.year}-${h.month}`;D.current!==B&&(k(!1),T(VS(h,o)),D.current=B)},[h,o]);const O=A.useCallback((B,H)=>{if(H.default_monthly_type==="percentage"&&H.default_monthly_amount!==void 0)return Ae(H.default_monthly_amount/100*p);const ne=C[B],re=parseFloat(ne||"0");return isNaN(re)?0:Ae(re)},[C,p]),N=A.useMemo(()=>Object.entries(o).reduce((B,[H,ne])=>{const re=O(H,ne),ce=ne.balance??0;if(ce<0){const _e=Math.abs(ce),Te=Math.max(0,re-_e);return B+Te}return B+re},0),[o,O]),U=l(),q=g?(h?.category_balances||[]).reduce((B,H)=>{const ne=o[H.category_id]?.balance??0,re=H.allocated,ce=ne-re;if(ce<0){const _e=Math.abs(ce);return B+Math.max(0,re-_e)}return B+re},0):0,I=R?d+q:d,z=A.useMemo(()=>R?I-N:I-N+q,[I,N,q,R]),M=A.useCallback((B,H)=>{T(ne=>({...ne,[B]:H}))},[]),X=A.useCallback(()=>{if(!h)return;const B={};Object.entries(o).forEach(([H,ne])=>{if(ne.default_monthly_type==="percentage")return;const re=h.category_balances?.find(ce=>ce.category_id===H);re&&re.allocated>0?B[H]=re.allocated.toString():ne.default_monthly_amount!==void 0&&ne.default_monthly_amount>0?B[H]=ne.default_monthly_amount.toString():B[H]=""}),T(B),k(!1)},[h,o]),Y=A.useCallback(()=>{const B={};return Object.entries(o).forEach(([H,ne])=>{const re=O(H,ne);re>0&&(B[H]=re)}),B},[o,O]),G=A.useCallback(async()=>{if(n){$(null),t("allocations-save","Saving allocations...");try{await _(n,r,i,Y()),k(!1)}catch(B){$(B instanceof Error?B.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,r,i,_,Y,t,e]),Z=A.useCallback(async()=>{if(n){$(null),t("allocations-finalize","Applying allocations...");try{await w({budgetId:n,year:r,month:i,allocations:Y(),onProgress:B=>{t("allocations-finalize",B.message)}}),k(!1)}catch(B){$(B instanceof Error?B.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,r,i,w,Y,t,e]),W=A.useCallback(async()=>{if(n){$(null),t("allocations-delete","Deleting allocations...");try{await x({budgetId:n,year:r,month:i,onProgress:H=>{t("allocations-delete",H.message)}});const B={};Object.entries(o).forEach(([H,ne])=>{ne.default_monthly_type!=="percentage"&&(ne.default_monthly_amount!==void 0&&ne.default_monthly_amount>0?B[H]=ne.default_monthly_amount.toString():B[H]="")}),T(B),k(!1)}catch(B){$(B instanceof Error?B.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,r,i,x,o,t,e]),te=N-q;return{localAllocations:C,isEditingAppliedAllocations:R,error:V,monthLoading:f,onBudgetTotal:U,availableNow:I,currentDraftTotal:N,draftChangeAmount:te,availableAfterApply:z,previousMonthIncome:p,currentMonthIncome:b,allocationsFinalized:g,getAllocationAmount:O,handleAllocationChange:M,resetAllocationsToSaved:X,handleSaveAllocations:G,handleFinalizeAllocations:Z,handleDeleteAllocations:W,setIsEditingAppliedAllocations:k,setError:$}}function gB({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:i}){const o=Object.keys(e),l=o.length>0,d=A.useMemo(()=>{const w={};return Object.entries(e).forEach(([x,S])=>{w[x]={current:S.balance??0,total:S.balance??0}}),w},[e]),[h,f]=A.useState(!1),[p,g]=A.useState(null),b=A.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const w=Object.keys(e),{total:x}=await LS(t,w,n,r),S={};Object.entries(e).forEach(([T,R])=>{const k=R.balance,V=x[T]??0;Math.abs(k-V)>.01&&(S[T]={stored:k,calculated:V})});const C=Object.keys(S).length>0?S:null;return g(C),C},[t,e,n,r]),_=A.useCallback(async()=>{if(!(!t||!l)){f(!0);try{const{total:w}=await LS(t,o,n,r),x={};Object.entries(e).forEach(([S,C])=>{x[S]={...C,balance:w[S]??0}}),await i(x),g(null)}finally{f(!1)}}},[t,e,i,n,r,o,l]);return{categoryBalances:d,loadingBalances:h,categoryBalanceMismatch:p,checkCategoryBalanceMismatch:b,recalculateAndSaveCategoryBalances:_}}function yB({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:i,saveCategories:o,saveCategoryGroups:l,setError:d}){const[h,f]=A.useState(null),[p,g]=A.useState(null),[b,_]=A.useState(null),[w,x]=A.useState(null);function S(O,N){f("category"),g(N),O.dataTransfer.effectAllowed="move"}function C(O,N,U){O.preventDefault(),h==="category"&&(N!==p&&_(N),x(U))}function T(O,N){O.preventDefault(),h==="category"&&(x(N),_(null))}function R(){_(null)}function k(){x(null)}function V(){f(null),g(null),_(null),x(null)}async function $(O,N,U){if(O.preventDefault(),O.stopPropagation(),!p||h!=="category"){V();return}const q=t[p];if(!q)return;const I=U==="ungrouped"?Jt:U,z=Object.entries(t).filter(([,Y])=>(Y.category_group_id||"ungrouped")===U),M={};Object.entries(t).forEach(([Y,G])=>{Y!==p&&(M[Y]=G)});let X;if(N==="__group_end__"||z.length===0||!z.find(([Y])=>Y===N))X=(z.length>0?Math.max(...z.filter(([G])=>G!==p).map(([,G])=>G.sort_order)):-1)+1;else{const Y=z.find(([G])=>G===N);Y?(X=Y[1].sort_order,Object.entries(M).forEach(([G,Z])=>{(Z.category_group_id||"ungrouped")===U&&Z.sort_order>=X&&(M[G]={...Z,sort_order:Z.sort_order+1})})):X=0}if(M[p]={...q,category_group_id:I,sort_order:X},r(M),V(),!!n)try{await o(M)}catch(Y){d(Y instanceof Error?Y.message:"Failed to save changes")}}async function D(O,N){O.preventDefault(),h==="category"&&await $(O,"__group_end__",N)}return{dragType:h,draggedId:p,dragOverId:b,dragOverGroupId:w,setDragOverId:_,setDragOverGroupId:x,handleCategoryDragStart:S,handleCategoryDragOver:C,handleDragOverGroup:T,handleDragLeave:R,handleDragLeaveGroup:k,handleDragEnd:V,handleCategoryDrop:$,handleDropOnGroup:D}}function _B(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Je(),{budget:r,categories:i,categoryGroups:o,isLoading:l,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,getOnBudgetTotal:f}=Rn(),{updateCategories:p}=eA(),{updateCategoryGroups:g}=dB(),[b,_]=A.useState(null),w=A.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:Z})},[t,p]),x=A.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:Z})},[t,g]),S=A.useCallback(async(Z,W)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:Z}),g.mutateAsync({budgetId:t,categoryGroups:W})])},[t,p,g]),{categoryBalances:C,loadingBalances:T,categoryBalanceMismatch:R,checkCategoryBalanceMismatch:k,recalculateAndSaveCategoryBalances:V}=gB({budgetId:t,categories:i,currentYear:e,currentMonth:n,updateCategoriesWithBalances:w}),$=yB({categories:i,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,saveCategories:w,saveCategoryGroups:x,setError:_});async function D(Z,W){if(!r)return;const te=W||Jt,B=Object.values(i).filter(_e=>_e.category_group_id===te),H=B.length>0?Math.max(...B.map(_e=>_e.sort_order)):-1,ne=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,re={name:Z.name,description:Z.description??"",category_group_id:te,sort_order:H+1,default_monthly_amount:Z.default_monthly_amount??0,default_monthly_type:Z.default_monthly_type??"fixed",balance:0,is_hidden:Z.is_hidden??!1},ce={...i,[ne]:re};d(ce);try{await w(ce)}catch(_e){d(i);const Te=_e instanceof Error?_e.message:"Failed to create category";throw _(Te),_e}}async function O(Z,W){if(r)try{const te=i[Z];if(!te)return;const B=te.category_group_id||Jt,H=W.category_group_id||Jt;let ne=te.sort_order;if(B!==H){const ce=Object.values(i).filter(_e=>_e.category_group_id===H&&_e!==te);ne=ce.length>0?Math.max(...ce.map(_e=>_e.sort_order))+1:0}const re={...i,[Z]:{...te,name:W.name,description:W.description??"",category_group_id:H,sort_order:ne,default_monthly_amount:W.default_monthly_amount??0,default_monthly_type:W.default_monthly_type??"fixed",is_hidden:W.is_hidden??!1}};d(re),await w(re)}catch(te){_(te instanceof Error?te.message:"Failed to update category")}}async function N(Z){if(confirm("Are you sure you want to delete this category?")&&r)try{const{[Z]:W,...te}=i;d(te),await w(te)}catch(W){_(W instanceof Error?W.message:"Failed to delete category")}}async function U(Z,W){const te=i[Z];if(!te)return;const B=te.category_group_id||Jt,H=Object.entries(i).filter(([,oe])=>oe.category_group_id===B).sort((oe,be)=>oe[1].sort_order-be[1].sort_order),ne=H.findIndex(([oe])=>oe===Z),re=W==="up"?ne-1:ne+1;if(re<0||re>=H.length)return;const[ce,_e]=H[re],Te={};if(Object.entries(i).forEach(([oe,be])=>{oe===Z?Te[oe]={...be,sort_order:_e.sort_order}:oe===ce?Te[oe]={...be,sort_order:te.sort_order}:Te[oe]=be}),d(Te),!!r)try{await w(Te)}catch(oe){d(i),_(oe instanceof Error?oe.message:"Failed to move category")}}async function q(Z){if(r)try{const W=o.length>0?Math.max(...o.map(H=>H.sort_order)):-1,te={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:Z.name,sort_order:W+1},B=[...o,te];h(B),await x(B)}catch(W){_(W instanceof Error?W.message:"Failed to create group")}}async function I(Z,W){if(r)try{const te=o.map(B=>B.id===Z?{...B,name:W.name}:B);h(te),await x(te)}catch(te){_(te instanceof Error?te.message:"Failed to update group")}}async function z(Z){if(Z===Jt){alert("Cannot delete the default Uncategorized category group.");return}if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const W={};Object.entries(i).forEach(([B,H])=>{W[B]=H.category_group_id===Z?{...H,category_group_id:Jt}:H});const te=o.filter(B=>B.id!==Z);d(W),h(te),await S(W,te)}catch(W){_(W instanceof Error?W.message:"Failed to delete group")}}async function M(Z,W){const te=o.filter(Te=>Te.id!==Jt).sort((Te,oe)=>Te.sort_order-oe.sort_order),B=o.find(Te=>Te.id===Jt),H=te.findIndex(Te=>Te.id===Z),ne=W==="up"?H-1:H+1;if(ne<0||ne>=te.length)return;const[re]=te.splice(H,1);te.splice(ne,0,re);const ce=te.map((Te,oe)=>({...Te,sort_order:oe})),_e=[...ce,...B?[{...B,sort_order:ce.length}]:[]];if(h(_e),!!r)try{await x(_e)}catch(Te){h(o),_(Te instanceof Error?Te.message:"Failed to move group")}}const X=A.useMemo(()=>Object.entries(i).filter(([,Z])=>!Z.is_hidden).reduce((Z,[W,te])=>{const B=te.category_group_id||Jt;return Z[B]||(Z[B]=[]),Z[B].push([W,te]),Z},{}),[i]),Y=A.useMemo(()=>Object.entries(i).filter(([,Z])=>Z.is_hidden).map(([Z,W])=>[Z,W]).sort((Z,W)=>Z[1].sort_order-W[1].sort_order),[i]),G=A.useMemo(()=>[...o].sort((Z,W)=>Z.sort_order-W.sort_order),[o]);return{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:X,hiddenCategories:Y,sortedGroups:G,categoryBalances:C,isLoading:l,loadingBalances:T,error:b,setError:_,getOnBudgetTotal:f,categoryBalanceMismatch:R,checkCategoryBalanceMismatch:k,recalculateAndSaveCategoryBalances:V,handleCreateCategory:D,handleUpdateCategory:O,handleDeleteCategory:N,handleMoveCategory:U,handleCreateGroup:q,handleUpdateGroup:I,handleDeleteGroup:z,handleMoveGroup:M,dragType:$.dragType,draggedId:$.draggedId,dragOverId:$.dragOverId,dragOverGroupId:$.dragOverGroupId,setDragOverId:$.setDragOverId,setDragOverGroupId:$.setDragOverGroupId,handleCategoryDragStart:$.handleCategoryDragStart,handleCategoryDragOver:$.handleCategoryDragOver,handleDragOverGroup:$.handleDragOverGroup,handleDragLeave:$.handleDragLeave,handleDragLeaveGroup:$.handleDragLeaveGroup,handleDragEnd:$.handleDragEnd,handleCategoryDrop:$.handleCategoryDrop,handleDropOnGroup:$.handleDropOnGroup}}function bB({categories:t,categoryBalances:e,totalAvailable:n,onBudgetTotal:r,isDataLoading:i,loadingBalances:o,currentBudget:l}){const d=A.useMemo(()=>Object.values(t).reduce((x,S)=>x+Math.max(0,S.balance??0),0),[t]),h=A.useMemo(()=>Object.values(e).reduce((x,S)=>x+Math.max(0,S.total),0),[e]),f=d,p=A.useMemo(()=>Object.values(t).reduce((x,S)=>x+Math.max(0,S.balance??0),0),[t]),g=n,b=A.useMemo(()=>Math.abs(d-h)>.01,[d,h]),_=A.useMemo(()=>Math.abs(r-(f+g))>.01,[r,f,g]),w=A.useMemo(()=>Math.abs(d-p)>.01,[d,p]);return A.useEffect(()=>{},[b,_,w,d,h,f,g,r,p,i,o,l]),{allocatedFromStored:d,allocatedFromCalculated:h,allocated:f,unallocated:g,monthViewAllTime:p,calculationMismatch:b,relationshipMismatch:_,monthViewMismatch:w}}function vB(t,e,n,r){const i={budget_id:e,year_month_ordinal:t.year_month_ordinal??qe(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return yd(i)}async function xB(t){const e=new Date,n=e.getFullYear(),r=e.getMonth()+1;let i=n,o=r-3;for(;o<=0;)o+=12,i-=1;const l=qe(i,o);return(await Jn("months","useInitialDataLoad: loading initial months",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:l}])).docs.map(f=>{const p=f.data,g=p.year,b=p.month;return vB(p,t,g,b)}).sort((f,p)=>f.year!==p.year?f.year-p.year:f.month-p.month)}function wB(t,e){if(e<1)return t;const n=new Map;for(const r of t)n.set(`${r.year}/${r.month}`,r);return t.map(r=>{const i=vm(r.year,r.month,e);if(!i)return r;const o=n.get(`${i.year}/${i.month}`);if(!o)return r;const l=o.income||[],d=Ae(l.reduce((h,f)=>h+(f.amount||0),0));return{...r,previous_month_income:d}})}async function SB(t){const[e,n,r]=await Promise.all([bm(t),K_(t),xB(t)]),i=e.budget.percentage_income_months_back??1,o=wB(r,i);return{budget:e,payees:n,months:o}}function EB(t,e){return Uo({queryKey:t?["initialDataLoad",t]:["initialDataLoad","none"],queryFn:()=>SB(t),enabled:!!t&&e?.enabled!==!1,staleTime:1/0})}async function CB(t,e,n,r){const i=Ee.month(t,e,n),o=r.getQueryData(i);if(!o?.month)throw new Error(`Month ${e}/${n} not found in cache`);const l=o.month,d=await TB(t,e,n,r),h=sc(l,d);return r.setQueryData(i,{month:h}),h}async function TB(t,e,n,r){const{year:i,month:o}=bc(e,n),l=Ee.month(t,i,o),d=r.getQueryData(l);if(d?.month)return Lo(d.month);try{const h=await nr(t,i,o,{description:`fetching previous month ${i}/${o} for recalculation`});if(h)return Lo(h)}catch(h){console.warn(`[useLocalRecalculation] Could not fetch previous month ${i}/${o}:`,h)}return bd}async function AB(t,e,n){const i=n.getQueryCache().findAll({predicate:h=>h.queryKey[0]==="month"&&h.queryKey[1]===t&&h.state.status==="success"&&h.state.data!=null});if(i.length===0)return;const o=[];for(const h of i){const f=h.queryKey,p=f[2],g=f[3],b=n.getQueryData(h.queryKey);b?.month&&o.push({year:p,month:g,monthDoc:b.month})}o.sort((h,f)=>h.year!==f.year?h.year-f.year:h.month-f.month);const l=new Map;for(const{year:h,month:f,monthDoc:p}of o)l.set(`${h}/${f}`,p);let d=bd;for(const{year:h,month:f,monthDoc:p}of o){const g=vm(h,f,e),b=g?(()=>{const x=l.get(`${g.year}/${g.month}`);if(!x)return 0;const S=x.income||[];return Ae(S.reduce((C,T)=>C+(T.amount||0),0))})():0,_=sc(p,d,b),w=Ee.month(t,h,f);n.setQueryData(w,{month:_}),d=Lo(_)}}const $S=300*1e3;function jB(t,e,n,r){const i={budget_id:e,year_month_ordinal:t.year_month_ordinal??qe(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return yd(i)}function qS(t,e){return e?t?new Date(e)>new Date(t):!0:!1}async function RB(t,e){const n=[],r=new Date,i=r.getFullYear(),o=r.getMonth()+1;let l=i,d=o-3;for(;d<=0;)d+=12,l-=1;const h=qe(l,d),[f,p,g]=await Promise.all([Pe.fetchQuery({queryKey:Ee.budget(t),queryFn:()=>bm(t),staleTime:0}).catch(()=>null),Pe.fetchQuery({queryKey:Ee.payees(t),queryFn:()=>K_(t),staleTime:0}).catch(()=>null),Jn("months","useSyncCheck: checking for remote changes",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:h}]).catch(()=>({docs:[]}))]);if(f){const _=Pe.getQueryData(Ee.budget(t));if(_){const w=_.budget?.updated_at;qS(w,f.budget.updated_at)&&(e.some(S=>S.type==="budget"&&S.budgetId===t)?n.push("Budget document has been updated remotely (you have unsaved local changes)"):Pe.setQueryData(Ee.budget(t),f))}}p!==null&&Pe.getQueryData(Ee.payees(t));const b=g.docs.map(_=>{const w=_.data,x=w.year,S=w.month;return jB(w,t,x,S)});for(const _ of b){const w=Pe.getQueryData(Ee.month(t,_.year,_.month));w?.month&&qS(w.month.updated_at,_.updated_at)&&(e.some(S=>S.type==="month"&&S.budgetId===t&&S.year===_.year&&S.month===_.month)?n.push(`Month ${_.year}/${_.month} has been updated remotely (you have unsaved local changes)`):Pe.setQueryData(Ee.month(t,_.year,_.month),{month:_}))}return n}function IB(t,e){const{setSyncError:n,getChanges:r}=vd(),i=A.useRef(null),o=A.useRef(null),l=A.useRef(0),d=A.useRef(!1);A.useEffect(()=>{if(!t||!e||d.current)return;d.current=!0;const h=async()=>{try{const f=r(),p=await RB(t,f);if(p.length>0){const g=`Sync conflict detected: ${p.join("; ")}`;n(g),$n.add({type:"error",message:g,autoDismissMs:0})}else n(null)}catch(f){console.error("[useSyncCheck] Sync check failed:",f);const p=`Failed to check for sync conflicts: ${f instanceof Error?f.message:String(f)}`;n(p),$n.add({type:"error",message:p,autoDismissMs:0})}};return o.current=setTimeout(()=>{h(),l.current=Date.now(),i.current=setInterval(()=>{h(),l.current=Date.now()},$S)},$S),()=>{o.current&&clearTimeout(o.current),i.current&&clearInterval(i.current),d.current=!1}},[t,e,n,r])}function kB(t,e,n){const r=Ut(),i=A.useRef(null),o=A.useRef(null),l=A.useRef(null),d=A.useCallback((h,f)=>{if(!t)return;const p=Ee.month(t,h,f);if(r.getQueryData(p))return;const b=r.getQueryData(Ee.budget(t)),_=qe(h,f);b?.monthMap&&_ in b.monthMap&&r.prefetchQuery({queryKey:p,queryFn:async()=>{const x=await Em(t,h,f);return x?{month:x}:null},staleTime:Yr}).catch(x=>{console.warn(`[useMonthPrefetch] Failed to prefetch month ${h}/${f}:`,x)})},[t,r]);A.useEffect(()=>{if(!t)return;const h=`${t}-${e}-${n}`;if(l.current===h)return;l.current=h;const f=Ku(e,n);d(f.year,f.month)},[t,e,n,d]),A.useEffect(()=>{if(i.current===null||o.current===null){i.current=e,o.current=n;return}if(i.current===e&&o.current===n)return;if(!t){i.current=e,o.current=n;return}const h=qe(i.current,o.current),g=qe(e,n)>h?Ku(e,n):bc(e,n);d(g.year,g.month),i.current=e,o.current=n},[t,e,n,d])}function DB(t,e){const n={};Object.keys(e).forEach(l=>{n[l]=0});const r=Pe.getQueryData(Ee.budget(t));if(!r)return n;const i=r.budget.month_map||{},o=Object.keys(i).sort();for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),f=Ee.month(t,d,h),p=Pe.getQueryData(f);if(!p?.month)continue;const g=p.month;for(const b of g.account_balances||[])b.account_id&&!Ye(b.account_id)&&n[b.account_id]===0&&(n[b.account_id]=b.start_balance??0)}for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),f=Ee.month(t,d,h),p=Pe.getQueryData(f);if(!p?.month)continue;const g=p.month;for(const b of g.income||[])b.account_id&&!Ye(b.account_id)&&n[b.account_id]!==void 0&&(n[b.account_id]+=b.amount);for(const b of g.expenses||[])b.account_id&&!Ye(b.account_id)&&n[b.account_id]!==void 0&&(n[b.account_id]+=b.amount);for(const b of g.transfers||[])b.to_account_id&&!Ye(b.to_account_id)&&n[b.to_account_id]!==void 0&&(n[b.to_account_id]+=b.amount),b.from_account_id&&!Ye(b.from_account_id)&&n[b.from_account_id]!==void 0&&(n[b.from_account_id]-=b.amount);for(const b of g.adjustments||[])b.account_id&&!Ye(b.account_id)&&n[b.account_id]!==void 0&&(n[b.account_id]+=b.amount)}for(const l of Object.keys(n))n[l]=Ae(n[l]);return n}function nA(t){const e=Pe.getQueryData(Ee.budget(t));if(!e){console.warn("[recalculateBudgetAccountBalancesFromCache] Budget not in cache");return}const n=DB(t,e.accounts),r={};for(const[i,o]of Object.entries(e.accounts))r[i]={...o,balance:Ae(n[i]??o.balance)};Pe.setQueryData(Ee.budget(t),{...e,accounts:r,budget:{...e.budget,accounts:r}})}function HS(t){return{year:parseInt(t.substring(0,4),10),month:parseInt(t.substring(4,6),10)}}async function MB(t){const e=Pe.getQueryData(Ee.budget(t));if(!e){console.warn("[recalculateBudgetCategoryBalancesFromCache] Budget not in cache");return}const n=Object.keys(e.categories);if(n.length===0)return;const r=new Date,i=r.getFullYear(),o=r.getMonth()+1,l=qe(i,o),d=e.monthMap||{},h={};n.forEach(C=>{h[C]=0});const f=Object.keys(d).sort(),p=Ee.month(t,i,o),g=Pe.getQueryData(p);if(g?.month?.category_balances)for(const C of g.month.category_balances)n.includes(C.category_id)&&(h[C.category_id]=C.end_balance??0);else{let C=!1;for(let T=f.length-1;T>=0&&!C;T--){const R=f[T];if(R>l)continue;const{year:k,month:V}=HS(R),$=Ee.month(t,k,V),D=Pe.getQueryData($);if(D?.month?.category_balances){C=!0;for(const O of D.month.category_balances)n.includes(O.category_id)&&(h[O.category_id]=O.end_balance??0)}}if(!C&&f.length>0)for(const T of f){if(T>l)break;const{year:R,month:k}=HS(T),V=Ee.month(t,R,k),$=Pe.getQueryData(V);if($?.month){const D=$.month;if(D.are_allocations_finalized&&D.category_balances)for(const O of D.category_balances)n.includes(O.category_id)&&(h[O.category_id]=(h[O.category_id]||0)+(O.allocated||0));if(D.expenses)for(const O of D.expenses)n.includes(O.category_id)&&(h[O.category_id]=(h[O.category_id]||0)-O.amount);if(D.adjustments)for(const O of D.adjustments)O.category_id&&n.includes(O.category_id)&&(h[O.category_id]=(h[O.category_id]||0)+O.amount);if(D.transfers)for(const O of D.transfers)O.to_category_id&&n.includes(O.to_category_id)&&(h[O.to_category_id]=(h[O.to_category_id]||0)+O.amount),O.from_category_id&&n.includes(O.from_category_id)&&(h[O.from_category_id]=(h[O.from_category_id]||0)-O.amount)}}}const b=qe(i+Math.floor((o+Ws-1)/12),(o+Ws-1)%12+1);let _=i,w=o;for(let C=0;C<Ws*2;C++){const T=Ku(_,w);_=T.year,w=T.month;const R=qe(_,w);if(R>b||!(R in d))break;const k=Ee.month(t,_,w),V=Pe.getQueryData(k);if(!V?.month)break;const $=V.month;if($.are_allocations_finalized&&$.category_balances)for(const D of $.category_balances)n.includes(D.category_id)&&(h[D.category_id]=(h[D.category_id]||0)+(D.allocated||0));if($.expenses)for(const D of $.expenses)n.includes(D.category_id)&&(h[D.category_id]=(h[D.category_id]||0)-D.amount)}const x={};for(const C of n)x[C]=Ae(h[C]||0);const S={};for(const[C,T]of Object.entries(e.categories))S[C]={...T,balance:Ae(x[C]??T.balance)};Pe.setQueryData(Ee.budget(t),{...e,categories:S,budget:{...e.budget,categories:S}})}function OB(t){return{year:parseInt(t.substring(0,4),10),month:parseInt(t.substring(4,6),10)}}function NB(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1,o=qe(r,i);let l=r,d=i+Ws;for(;d>12;)d-=12,l+=1;const h=qe(l,d),f=[],p=Object.keys(e).sort();for(const g of p){if(g<o)continue;if(g>h)break;const{year:b,month:_}=OB(g),w=Ee.month(t,b,_),x=Pe.getQueryState(w),S=!x?.data,C=x?.dataUpdatedAt?Date.now()-x.dataUpdatedAt>Yr:!0;(S||C)&&f.push({year:b,month:_,ordinal:g})}return f}async function rA(t,e,n=!0){const r=Pe.getQueryData(Ee.budget(t));if(!r){console.warn("[ensureMonthsFreshAndRecalculateBalances] Budget not in cache");return}const i=r.monthMap||{},o=NB(t,i);if(!(o.length===0&&!n)){if(o.length>0){e?.(!0,`Refreshing ${o.length} month${o.length>1?"s":""}...`);try{await Promise.all(o.map(({year:l,month:d})=>nr(t,l,d,{description:`refreshing month ${l}/${d} for balance calculation`})))}finally{e?.(!1,"")}}nA(t),await MB(t)}}function sA(t=!0){const{selectedBudgetId:e}=Je(),{addLoadingHold:n,removeLoadingHold:r}=jn(),i=A.useRef(!1);A.useEffect(()=>{if(!t||!e||i.current)return;i.current=!0;let o=null;rA(e,(l,d)=>{l?(o="ensure-balances-fresh",n(o,d)):o&&(r(o),o=null)},!1).catch(l=>{console.error("[useEnsureBalancesFresh] Failed to ensure balances fresh:",l),o&&r(o)})},[t,e,n,r]),A.useEffect(()=>{e||(i.current=!1)},[e])}function PB(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1;let r=e,i=n-3;for(;i<=0;)i+=12,r-=1;return qe(r,i)}function BB(t,e){const n=qe(t,e),r=PB();return n>=r}function zB({budgetId:t,viewingYear:e,viewingMonth:n,initialDataLoadComplete:r,enabled:i=!0}){const o=Ut(),l=A.useRef(!1),d=A.useRef(null),h=A.useCallback(()=>{if(!t||!i||!r)return;const f=["initialDataLoad",t],p=o.getQueryState(f);if(!p?.dataUpdatedAt)return;Date.now()-p.dataUpdatedAt>Yr&&!l.current&&(l.current=!0,o.invalidateQueries({queryKey:f}))},[t,i,r,o]);A.useEffect(()=>{r&&h()},[r,h]),A.useEffect(()=>{if(!i||!r)return;const f=()=>{document.visibilityState==="visible"&&(l.current=!1,h())};return document.addEventListener("visibilitychange",f),()=>{document.removeEventListener("visibilitychange",f)}},[i,r,h]),A.useEffect(()=>{l.current=!1,d.current=null},[t]),A.useEffect(()=>{if(!t||!i||!r||BB(e,n))return;const p=`${t}-${e}-${n}`;if(d.current===p)return;d.current=p;const g=[{year:e,month:n},bc(e,n),Ku(e,n)];for(const{year:b,month:_}of g){const w=Ee.month(t,b,_);if(o.getQueryData(w)){const S=o.getQueryState(w);if(!(S?.dataUpdatedAt?Date.now()-S.dataUpdatedAt>Yr:!1))continue}o.prefetchQuery({queryKey:w,queryFn:async()=>{const S=await Em(t,b,_);return S?{month:S}:null},staleTime:Yr}).catch(S=>{console.warn(`[useStaleDataRefresh] Failed to prefetch month ${b}/${_}:`,S)})}},[t,i,r,e,n,o])}function Fa(){Pe.removeQueries({queryKey:["budget"]}),Pe.removeQueries({queryKey:["month"]}),Pe.removeQueries({queryKey:["accessibleBudgets"]}),Pe.removeQueries({queryKey:["payees"]}),Pe.removeQueries({queryKey:["user"]}),console.log("[Migration] All caches cleared")}async function Am(t){try{const e=await t();return Fa(),e}catch(e){throw Fa(),e}}const iA=A.createContext(null),GS={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function LB({children:t}){const[e,n]=A.useState(GS),r=A.useCallback(()=>({setStage:d=>{n(h=>({...h,stage:d}))},setProgress:d=>{n(h=>({...h,progress:d}))},setCurrentItem:d=>{n(h=>({...h,currentItem:d}))},setDetails:d=>{n(h=>({...h,details:d}))},updateItemProgress:(d,h,f)=>{const p=h>0?Math.round(d/h*100):0;n(g=>({...g,progress:p,currentItem:f||`Item ${d} of ${h}`,details:`${d} / ${h} complete`}))}}),[]),i=A.useCallback(async(d,h)=>{n({isOpen:!0,migrationName:d,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const f=r();try{const p=await h(f);return Fa(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){Fa();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(b=>({...b,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=A.useCallback(()=>{n(d=>d.isComplete?GS:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),d))},[]),l={state:e,runMigrationWithProgress:i,closeModal:o};return u.jsx(iA.Provider,{value:l,children:t})}function xc(){const t=A.useContext(iA);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function s0(t){return(await Jn("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function aA(t,e){return(await Jn("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(i=>({id:i.id,data:i.data,budgetId:i.data.budget_id,year:i.data.year,month:i.data.month})).sort((i,o)=>i.year!==o.year?i.year-o.year:i.month-o.month)}async function rr(t){const e=await s0(t),n=await Jn("months",`${t}: batch reading all months`),r=new Map;for(const i of n.docs){const o=i.data.budget_id,l={id:i.id,data:i.data,budgetId:o,year:i.data.year,month:i.data.month};r.has(o)||r.set(o,[]),r.get(o).push(l)}for(const i of r.values())i.sort((o,l)=>o.year!==l.year?o.year-l.year:o.month-l.month);return{budgets:e,monthsByBudget:r}}async function Wa(t,e){if(t.length===0)return;const n=t.map(o=>{const l=_d(o.data);return{collectionPath:"months",docId:Ia(o.budgetId,o.year,o.month),data:za({...l,updated_at:new Date().toISOString()})}});await G_(n,`${e}: batch writing ${t.length} months`);const r=new Map;for(const o of t)r.has(o.budgetId)||r.set(o.budgetId,[]),r.get(o.budgetId).push({year:o.year,month:o.month});const{ensureMonthsInMapBatch:i}=await ka(async()=>{const{ensureMonthsInMapBatch:o}=await Promise.resolve().then(()=>zP);return{ensureMonthsInMapBatch:o}},void 0);for(const[o,l]of r)try{await i(o,l)}catch(d){console.warn(`[batchWriteMonths] Failed to update month_map for budget ${o}:`,d)}}async function jm(t,e){if(t.length===0)return;const n=t.map(r=>{const i={...r.data};if(i.accounts&&typeof i.accounts=="object"){const o=i.accounts;i.accounts=Object.fromEntries(Object.entries(o).map(([l,d])=>{if(d&&typeof d=="object"){const{balance:h,...f}=d;return[l,f]}return[l,d]}))}if(i.categories&&typeof i.categories=="object"){const o=i.categories;i.categories=Object.fromEntries(Object.entries(o).map(([l,d])=>{if(d&&typeof d=="object"){const{balance:h,...f}=d;return[l,f]}return[l,d]}))}return delete i.total_available,delete i.is_needs_recalculation,{collectionPath:"budgets",docId:r.budgetId,data:za({...i,updated_at:new Date().toISOString()})}});await G_(n,`${e}: batch writing ${t.length} budgets`)}async function oA(t,e,n){if(e.length===0)return;let r=bd;const i=[];for(const p of e){const g=sc(p,r);i.push(g),r=Lo(g)}const o=i.map(p=>({budgetId:t,year:p.year,month:p.month,data:p}));await Wa(o,n);const l=r.accountEndBalances,d=r.categoryEndBalances,{exists:h,data:f}=await Bt("budgets",t,`${n}: reading budget for final update`);if(h&&f){const p=OP(f.month_map||{}),g={...d},b=f.categories||{};for(const _ of Object.keys(b))_ in g||(g[_]=0);await NP(t,l,g,p)}}async function UB(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,i]of n){i.sort((d,h)=>d.year!==h.year?d.year-h.year:d.month-h.month),await Wa(i,e);const l=(await aA(r,e)).map(d=>d.data);await oA(r,l,e)}}async function FB(t){const{exists:e,data:n}=await Bt("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r=Object.fromEntries(Object.entries(n.accounts||{}).map(([o,l])=>{if(l&&typeof l=="object"){const{balance:d,...h}=l;return[o,h]}return[o,l]})),i=Object.fromEntries(Object.entries(n.categories||{}).map(([o,l])=>{if(l&&typeof l=="object"){const{balance:d,...h}=l;return[o,h]}return[o,l]}));await cr("budgets",t,{...n,accounts:r,categories:i,month_map:{},updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} (removing balances)`)}function VB({currentUser:t,onComplete:e}){const[n,r]=A.useState(!1),[i,o]=A.useState(!1),[l,d]=A.useState(null),[h,f]=A.useState(null),[p,g]=A.useState(null);async function b(){if(t){r(!0);try{const w=await Jn("months","delete all months: scanning for all months"),x=[],S=new Set;for(const C of w.docs){const{budget_id:T,year:R,month:k}=C.data;S.add(T),x.push({docId:C.id,budgetId:T,year:R,month:k})}x.sort((C,T)=>C.budgetId!==T.budgetId?C.budgetId.localeCompare(T.budgetId):C.year!==T.year?C.year-T.year:C.month-T.month),d({monthsToDelete:x,monthsCount:x.length,budgetCount:S.size})}catch{}finally{r(!1)}}}async function _(){if(!t||!l||l.monthsToDelete.length===0)return;o(!0),f(null);const w=l.monthsToDelete.length,x=new Set,S=[];for(const V of l.monthsToDelete)x.add(V.budgetId);g({phase:"deleting",deleted:0,total:w,currentMonth:null,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:0});const C=l.monthsToDelete.map(V=>({collectionPath:"months",docId:V.docId}));let T=0;try{await jT(C,"delete all months: batch deleting all month documents",V=>{T=V,g({phase:"deleting",deleted:V,total:w,currentMonth:`Batch ${Math.ceil(V/500)} of ${Math.ceil(w/500)}`,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:Math.round(V/w*70)})}),T=w}catch(V){S.push(`Batch delete failed: ${V instanceof Error?V.message:"Unknown error"}`)}const R=Array.from(x);let k=0;for(const V of R){g({phase:"resetting-budgets",deleted:T,total:w,currentMonth:`Budget ${k+1}/${R.length}`,budgetsRecalculated:k,totalBudgets:R.length,percentComplete:70+Math.round(k/R.length*25)});try{await FB(V),k++}catch{k++}}g({phase:"clearing-cache",deleted:T,total:w,currentMonth:null,budgetsRecalculated:k,totalBudgets:R.length,percentComplete:95}),Fa(),g({phase:"complete",deleted:T,total:w,currentMonth:null,budgetsRecalculated:k,totalBudgets:R.length,percentComplete:100}),f({deleted:T,errors:S,budgetsRecalculated:k}),o(!1),g(null),S.length===0&&(d({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:l,isScanning:n,scanStatus:b,isDeleting:i,deleteResult:h,deleteProgress:p,deleteAllMonths:_}}const Jg="sample@sample.com",Eo="budget_1767746876726_xuj7nzl4l";function $B({currentUser:t,onComplete:e}){const[n,r]=A.useState(!1),[i,o]=A.useState(!1),[l,d]=A.useState(null),[h,f]=A.useState(null),[p,g]=A.useState(null);async function b(){if(t){r(!0);try{let x=(await Jn("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:Jg}])).docs;if(x.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const V=await Bt("budgets",Eo,"delete sample user budget: checking fallback budget ID");V.exists&&V.data&&(console.log("delete sample user budget: found fallback budget",Eo),x=[{id:Eo,data:V.data}])}const S=[];let C=0,T=!1;for(const V of x){const $=V.id,D=V.data.name,N=(await Jn("months",`delete sample user budget: counting months for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length;C+=N,S.push({budgetId:$,budgetName:D,monthCount:N}),(await Jn("payees",`delete sample user budget: checking payees for budget ${$}`,[{field:"budget_id",op:"==",value:$}])).docs.length>0&&(T=!0)}const R=[],k=await Jn("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:Jg}]);k.docs.length>0&&k.docs[0].data.budget_ids?.includes(Eo)&&(S.some(O=>O.budgetId===Eo)||(console.log("delete sample user budget: found stale budget reference in sample user document",Eo),R.push(Eo))),d({budgets:S,totalBudgets:S.length,totalMonths:C,hasPayees:T,staleBudgetIds:R})}catch(w){console.error("Error scanning for sample user budgets:",w)}finally{r(!1)}}}async function _(){if(!t||!l||l.budgets.length===0&&l.staleBudgetIds.length===0)return;o(!0),f(null);const w=[];let x=0,S=0,C=0;const T=l.totalMonths,R=l.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:R,percentComplete:0});for(const V of l.budgets)try{const D=(await Jn("months",`delete sample user budget: fetching month IDs for budget ${V.budgetId}`)).docs.filter(O=>O.data.budget_id===V.budgetId).map(O=>({collectionPath:"months",docId:O.id}));D.length>0&&(await jT(D,`delete sample user budget: deleting ${D.length} months for budget ${V.budgetId}`,O=>{x=O,g({phase:"deleting-months",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:Math.round(x/Math.max(T,1)*60)})}),x=D.length)}catch($){w.push(`Failed to delete months for budget ${V.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:60});for(const V of l.budgets)try{await Fy("payees",V.budgetId,`delete sample user budget: deleting payees for budget ${V.budgetId}`),C++}catch{}g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:70});for(const V of l.budgets)try{await Fy("budgets",V.budgetId,`delete sample user budget: deleting budget ${V.budgetId}`),S++,g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:70+Math.round(S/R*10)})}catch($){w.push(`Failed to delete budget ${V.budgetId}: ${$ instanceof Error?$.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:80});const k=[...l.budgets.map(V=>V.budgetId),...l.staleBudgetIds];try{const V=await Jn("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:Jg}]);if(V.docs.length>0){const $=V.docs[0],D=$.id,O=$.data,N=(O.budget_ids||[]).filter(U=>!k.includes(U));await cr("users",D,{...O,budget_ids:N,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${k.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(V){w.push(`Failed to update sample user document: ${V instanceof Error?V.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:95}),Fa(),g({phase:"complete",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:R,percentComplete:100}),f({budgetsDeleted:S,monthsDeleted:x,payeesDeleted:C,errors:w}),o(!1),g(null),w.length===0&&(d({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:l,isScanning:n,scanStatus:b,isDeleting:i,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:_}}function WS(t){if(!t)return 0;let e=0;for(const n of t)ht(n.start_balance??0)&&e++,ht(n.end_balance??0)&&e++,ht(n.allocated??0)&&e++,ht(n.spent??0)&&e++,ht(n.income??0)&&e++,ht(n.expenses??0)&&e++,ht(n.net_change??0)&&e++;return e}function QS(t){if(!t)return 0;let e=0;for(const n of t)ht(n.amount??0)&&e++;return e}async function KS(){const t=await Jn("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,i=0;for(const g of t.docs){const b=g.data;let _=!1;ht(b.total_available??0)&&(i++,_=!0);const w=b.accounts;if(w&&typeof w=="object")for(const S of Object.values(w))ht(S.balance??0)&&(n++,_=!0);const x=b.categories;if(x&&typeof x=="object")for(const S of Object.values(x))ht(S.balance??0)&&(r++,_=!0),ht(S.default_monthly_amount??0)&&(r++,_=!0);_&&e++}const o=await Jn("months","precision cleanup: scanning all months");let l=0,d=0,h=0,f=0,p=0;for(const g of o.docs){const b=g.data;let _=!1;(ht(b.total_income??0)||ht(b.total_expenses??0)||ht(b.previous_month_income??0))&&(_=!0);const w=QS(b.income);w>0&&(d+=w,_=!0);const x=QS(b.expenses);x>0&&(h+=x,_=!0);const S=WS(b.category_balances);S>0&&(f+=S,_=!0);const C=WS(b.account_balances);C>0&&(p+=C,_=!0),_&&l++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:i,totalMonths:o.docs.length,monthsWithPrecisionIssues:l,incomeValuesWithPrecisionIssues:d,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:f,accountBalancesWithPrecisionIssues:p}}function YS(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=Ae(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=Ae(e.end_balance)),e.allocated!==void 0&&(e.allocated=Ae(e.allocated)),e.spent!==void 0&&(e.spent=Ae(e.spent)),e.income!==void 0&&(e.income=Ae(e.income)),e.expenses!==void 0&&(e.expenses=Ae(e.expenses)),e.transfers!==void 0&&(e.transfers=Ae(e.transfers)),e.adjustments!==void 0&&(e.adjustments=Ae(e.adjustments)),e.net_change!==void 0&&(e.net_change=Ae(e.net_change)),e}function qB(t,e){let n=!1;ht(t.total_available??0)&&(t.total_available=Ae(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,l]of Object.entries(r)){const d=l;ht(d.balance??0)&&(r[o].balance=Ae(d.balance??0),e.accountsFixed++,n=!0)}const i=t.categories;if(i&&typeof i=="object")for(const[o,l]of Object.entries(i)){const d=l;ht(d.balance??0)&&(i[o].balance=Ae(d.balance??0),e.categoriesFixed++,n=!0),ht(d.default_monthly_amount??0)&&(i[o].default_monthly_amount=Ae(d.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function HB(t,e){let n=!1;if(ht(t.total_income??0)&&(t.total_income=Ae(t.total_income??0),n=!0),ht(t.total_expenses??0)&&(t.total_expenses=Ae(t.total_expenses??0),n=!0),ht(t.previous_month_income??0)&&(t.previous_month_income=Ae(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const i of t.income)ht(i.amount??0)?(r.push({...i,amount:Ae(i.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(i);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const i of t.expenses)ht(i.amount??0)?(r.push({...i,amount:Ae(i.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(i);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const i of t.category_balances)ht(i.start_balance??0)||ht(i.end_balance??0)||ht(i.allocated??0)||ht(i.spent??0)||ht(i.transfers??0)||ht(i.adjustments??0)?(r.push(YS(i)),e.categoryBalancesFixed++,n=!0):r.push(i);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const i of t.account_balances)ht(i.start_balance??0)||ht(i.end_balance??0)||ht(i.income??0)||ht(i.expenses??0)||ht(i.transfers??0)||ht(i.adjustments??0)||ht(i.net_change??0)?(r.push(YS(i)),e.accountBalancesFixed++,n=!0):r.push(i);t.account_balances=r}return{fixed:n,data:t}}function GB(t,e,n){const r={...t.data},{fixed:i,data:o}=qB(r,n),l=i?{budgetId:t.id,data:o}:null;i&&n.budgetsProcessed++;const d=[];let h=!1;for(const f of e){const p={...f.data},{fixed:g,data:b}=HB(p,n);g&&(n.monthsProcessed++,h=!0),d.push(b)}return{budgetUpdate:l,fixedMonths:d,hasMonthFixes:h}}async function WB(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await rr("precision cleanup"),r=[],i=[];for(const o of e)try{const l=n.get(o.id)||[],{budgetUpdate:d,fixedMonths:h,hasMonthFixes:f}=GB(o,l,t);d&&r.push(d),(f||h.length>0)&&i.push({budgetId:o.id,months:h})}catch(l){t.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}if(r.length>0)try{await jm(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:l}of i)try{await oA(o,l,"precision cleanup")}catch(d){t.errors.push(`Budget ${o} recalc: ${d instanceof Error?d.message:String(d)}`)}return t}function QB({currentUser:t,onComplete:e}){const[n,r]=A.useState(null),[i,o]=A.useState(!1),[l,d]=A.useState(!1),[h,f]=A.useState(null),[p,g]=A.useState(null),b=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,_=b>0,w=A.useCallback(async()=>{if(t){o(!0),g(null);try{const S=await KS();r(S),f(null)}catch(S){g(S instanceof Error?S.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),x=A.useCallback(async()=>{if(!(!t||!_)){d(!0),g(null);try{const S=await Am(()=>WB());f(S);const C=await KS();r(C),e?.()}catch(S){g(S instanceof Error?S.message:"Failed to run precision cleanup")}finally{d(!1)}}},[t,_,e]);return{status:n,isScanning:i,isRunning:l,result:h,error:p,totalIssues:b,hasIssues:_,hasData:n!==null,scan:w,runCleanup:x}}function Rm(t){const e=t.income||[],n=t.expenses||[],r=Ae(e.reduce((d,h)=>d+h.amount,0)),i=Ae(n.reduce((d,h)=>d+h.amount,0)),o=KB(t),l=YB(t);return{...t,total_income:r,total_expenses:i,account_balances:o,category_balances:l}}function KB(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],i=t.adjustments||[],o=t.account_balances||[],l=new Map;for(const f of o)Ye(f.account_id)||l.set(f.account_id,f);const d=new Set;for(const f of e)Ye(f.account_id)||d.add(f.account_id);for(const f of n)Ye(f.account_id)||d.add(f.account_id);for(const f of r)Ye(f.from_account_id)||d.add(f.from_account_id),Ye(f.to_account_id)||d.add(f.to_account_id);for(const f of i)Ye(f.account_id)||d.add(f.account_id);for(const f of o)Ye(f.account_id)||d.add(f.account_id);const h=[];for(const f of d){const p=l.get(f),g=Ae(p?.start_balance??0),b=Ae(e.filter(R=>R.account_id===f).reduce((R,k)=>R+k.amount,0)),_=Ae(n.filter(R=>R.account_id===f).reduce((R,k)=>R+k.amount,0)),w=Ae(r.filter(R=>R.from_account_id===f).reduce((R,k)=>R-k.amount,0)),x=Ae(r.filter(R=>R.to_account_id===f).reduce((R,k)=>R+k.amount,0)),S=Ae(x+w),C=Ae(i.filter(R=>R.account_id===f).reduce((R,k)=>R+k.amount,0)),T=Ae(b+_+S+C);h.push({account_id:f,start_balance:g,income:b,expenses:_,transfers:S,adjustments:C,net_change:T,end_balance:Ae(g+T)})}return h}function YB(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],i=t.category_balances||[],o=new Map;for(const g of i)lt(g.category_id)||o.set(g.category_id,g);const{spentMap:l,transfersMap:d,adjustmentsMap:h}=DT(e,n,r),f=new Set;for(const g of i)lt(g.category_id)||f.add(g.category_id);for(const g of e)lt(g.category_id)||f.add(g.category_id);for(const g of n)lt(g.from_category_id)||f.add(g.from_category_id),lt(g.to_category_id)||f.add(g.to_category_id);for(const g of r)lt(g.category_id)||f.add(g.category_id);const p=[];for(const g of f){const b=o.get(g),_=l[g]??0,w=d[g]??0,x=h[g]??0;if(b){const S=Ae(b.start_balance),C=Ae(b.allocated);p.push({category_id:g,start_balance:S,allocated:C,spent:_,transfers:w,adjustments:x,end_balance:Ae(S+C+_+w+x)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:_,transfers:w,adjustments:x,end_balance:Ae(_+w+x)})}return p}const XB=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],ZB=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function Im(t){return!t||Ye(t)?!0:XB.includes(t)}function km(t){return!t||lt(t)?!0:ZB.includes(t)}function lA(t){return Im(t.account_id)||km(t.category_id)}function JB(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:Im(t.account_id)?Ht:t.account_id,category_id:km(t.category_id)?Yt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function e3(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],i=[],o=[];let l=0,d=0;for(const f of n)lA(f)?(Im(f.account_id)&&!Ye(f.account_id)&&l++,km(f.category_id)&&!lt(f.category_id)&&d++,o.push(JB(f))):i.push(f);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:Rm({...e,expenses:i,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:l,invalidCategoriesFixed:d}}}async function t3(){const{budgets:t,monthsByBudget:e}=await rr("expense-to-adjustment-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.expenses||[];for(const g of p)lA(g)&&(r++,Im(g.account_id)&&!Ye(g.account_id)&&i++,km(g.category_id)&&!lt(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:i,invalidCategoriesToFix:o}}async function n3(){const{budgets:t,monthsByBudget:e}=await rr("expense-to-adjustment-migration"),n=[];let r=0,i=0,o=0;const l=[];for(const d of t){const h=e.get(d.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:b}=e3(f);p&&g&&(n.push({budgetId:d.id,year:f.year,month:f.month,data:g}),r+=b.expensesMigrated,i+=b.invalidAccountsFixed,o+=b.invalidCategoriesFixed)}catch(p){l.push(`Month ${f.year}/${f.month} in budget ${d.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await Wa(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:i,invalidCategoriesFixed:o,errors:l}}function r3({currentUser:t,onComplete:e}){const[n,r]=A.useState(!1),[i,o]=A.useState(!1),[l,d]=A.useState(null),[h,f]=A.useState(null);async function p(){if(t){r(!0);try{const _=await t3();d(_)}catch(_){console.error("Failed to scan for expense to adjustment migration:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Am(()=>n3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const b=l!==null&&l.expensesToMigrate>0;return{status:l,isScanning:n,scanStatus:p,hasItemsToMigrate:b,isRunning:i,result:h,runMigration:g}}function cA(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const i=t.accounts;if(i)for(const o of Object.keys(i))n.add(o);return{categoryIds:e,accountIds:n}}function xa(t,e){return!t||lt(t)?!1:!e.has(t)}function Us(t,e){return!t||Ye(t)?!1:!e.has(t)}function s3(t,e){const n=t.data;let r=0,i=0,o=0,l=0,d=0,h=0,f=!1;const p=(n.expenses||[]).map(x=>{const S={...x};let C=!1;return xa(x.category_id,e.categoryIds)&&(S.category_id=Yt,r++,C=!0),Us(x.account_id,e.accountIds)&&(S.account_id=Ht,i++,C=!0),C&&(o++,f=!0),S}),g=(n.income||[]).map(x=>{const S={...x};let C=!1;return Us(x.account_id,e.accountIds)&&(S.account_id=Ht,i++,C=!0),C&&(l++,f=!0),S}),b=(n.transfers||[]).map(x=>{const S={...x};let C=!1;return xa(x.from_category_id,e.categoryIds)&&(S.from_category_id=Yt,r++,C=!0),xa(x.to_category_id,e.categoryIds)&&(S.to_category_id=Yt,r++,C=!0),Us(x.from_account_id,e.accountIds)&&(S.from_account_id=Ht,i++,C=!0),Us(x.to_account_id,e.accountIds)&&(S.to_account_id=Ht,i++,C=!0),C&&(d++,f=!0),S}),_=(n.adjustments||[]).map(x=>{const S={...x};let C=!1;return xa(x.category_id,e.categoryIds)&&(S.category_id=Yt,r++,C=!0),Us(x.account_id,e.accountIds)&&(S.account_id=Ht,i++,C=!0),C&&(h++,f=!0),S});return f?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:b,adjustments:_,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function i3(){const{budgets:t,monthsByBudget:e}=await rr("orphaned-id-scan");let n=0,r=0,i=0,o=0,l=0,d=0,h=0;for(const f of t){const p=cA(f.data),g=e.get(f.id)||[];n+=g.length;for(const b of g){const _=b.data;for(const w of _.expenses||[]){let x=!1;xa(w.category_id,p.categoryIds)&&(r++,x=!0),Us(w.account_id,p.accountIds)&&(i++,x=!0),x&&o++}for(const w of _.income||[])Us(w.account_id,p.accountIds)&&(i++,l++);for(const w of _.transfers||[]){let x=!1;xa(w.from_category_id,p.categoryIds)&&(r++,x=!0),xa(w.to_category_id,p.categoryIds)&&(r++,x=!0),Us(w.from_account_id,p.accountIds)&&(i++,x=!0),Us(w.to_account_id,p.accountIds)&&(i++,x=!0),x&&d++}for(const w of _.adjustments||[]){let x=!1;xa(w.category_id,p.categoryIds)&&(r++,x=!0),Us(w.account_id,p.accountIds)&&(i++,x=!0),x&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}async function a3(){const{budgets:t,monthsByBudget:e}=await rr("orphaned-id-cleanup"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=cA(l.data),h=e.get(l.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:b}=s3(f,d);p&&g&&(n.push({budgetId:l.id,year:f.year,month:f.month,data:g}),r+=b.categoryIdsFixed,i+=b.accountIdsFixed)}catch(p){o.push(`Month ${f.year}/${f.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await Wa(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:i,errors:o}}function o3({currentUser:t,onComplete:e}){const[n,r]=A.useState(!1),[i,o]=A.useState(!1),[l,d]=A.useState(null),[h,f]=A.useState(null);async function p(){if(t){r(!0);try{const _=await i3();d(_)}catch(_){console.error("Failed to scan for orphaned IDs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Am(()=>a3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const b=l!==null&&(l.orphanedCategoryIds>0||l.orphanedAccountIds>0);return{status:l,isScanning:n,scanStatus:p,hasItemsToFix:b,isRunning:i,result:h,runMigration:g}}function l3(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,i=lt(t.category_id)&&lt(e.category_id),o=!Ye(t.account_id)&&!Ye(e.account_id),l=t.account_id!==e.account_id;if(i&&o&&l)return{negative:n,positive:r,type:"account"};const d=Ye(t.account_id)&&Ye(e.account_id),h=!lt(t.category_id)&&!lt(e.category_id),f=t.category_id!==e.category_id;return d&&h&&f?{negative:n,positive:r,type:"category"}:null}function uA(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let i=r+1;i<t.length;i++){if(n.has(t[i].id))continue;const o=l3(t[r],t[i]);if(o){e.push(o),n.add(t[r].id),n.add(t[i].id);break}}return e}function c3(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Yt,to_category_id:Yt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Ht,to_account_id:Ht,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function u3(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],i=uA(n);if(i.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=i.map(c3),l=new Set;for(const f of i)l.add(f.negative.id),l.add(f.positive.id);const d=n.filter(f=>!l.has(f.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:d,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:i.length,adjustmentsRemoved:l.size}}}async function d3(){const{budgets:t,monthsByBudget:e}=await rr("adjustments-to-transfers-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.adjustments||[],g=uA(p);r+=g.length;for(const b of g)b.type==="account"?i++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:i,categoryTransferPairs:o}}async function h3(){const{budgets:t,monthsByBudget:e}=await rr("adjustments-to-transfers-migration"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=e.get(l.id)||[];for(const h of d)try{const{needsUpdate:f,updatedMonth:p,stats:g}=u3(h);f&&p&&(n.push({budgetId:l.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,i+=g.adjustmentsRemoved)}catch(f){o.push(`Month ${h.year}/${h.month} in budget ${l.id}: ${f instanceof Error?f.message:String(f)}`)}}return n.length>0&&await Wa(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:i,errors:o}}function f3({currentUser:t,onComplete:e}){const[n,r]=A.useState(!1),[i,o]=A.useState(!1),[l,d]=A.useState(null),[h,f]=A.useState(null);async function p(){if(t){r(!0);try{const _=await d3();d(_)}catch(_){console.error("Failed to scan for adjustment pairs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const _=await Am(()=>h3());f(_),e?.()}catch(_){f({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const b=l!==null&&l.pairsFound>0;return{status:l,isScanning:n,scanStatus:p,hasPairsToConvert:b,isRunning:i,result:h,runMigration:g}}function m3(t){const e=[];let n="",r=!1;for(let i=0;i<t.length;i++){const o=t[i];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function p3(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function g3(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),i=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(i)||n<1||n>12||r<1||r>31?null:{year:i,month:n,day:r}}function y3(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function _3(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function b3(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const i=m3(r);if(i.length<5)continue;const[o,l,d,h,f,p,g]=i;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const b=g3(o);if(!b)continue;const _=_3(l,d),w=p3(f),x=y3(g||"");n.push({recordType:_,date:o,year:b.year,month:b.month,day:b.day,payee:l,category:d,account:h,amount:w,description:p||"",cleared:x,rawLine:r})}return n}function v3(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function x3(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function w3(t){const e=Ye(t.account_id)||!t.account_id||t.account_id.trim()==="",n=lt(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function S3(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const i=Ye(t.from_account_id),o=Ye(t.to_account_id),l=lt(t.from_category_id),d=lt(t.to_category_id);return i&&o&&l&&d?"All from/to account and category IDs are NO_* (must involve at least one real entity)":i&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":l&&d&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function ef(t,e,n,r,i){return t.filter(o=>{const[l,d,h]=e.split("-").map(Number);return o.year!==l||o.month!==d||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||i&&o.description&&o.description.toLowerCase().includes(i.toLowerCase()),!0)})}async function E3(t){const e=[];let n=0,r=0,i=0,o=0;const l=t?b3(t):[],{budgets:d,monthsByBudget:h}=await rr("account-category-validation");for(const f of d){const p=h.get(f.id)||[];for(const g of p){const b=g.data,_=`${b.year}-${String(b.month).padStart(2,"0")}`,w=b.income||[];n+=w.length;for(const T of w){const R=v3(T);R&&e.push({budgetId:f.id,monthKey:_,transactionType:"income",transactionId:T.id,violation:R,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:ef(l,T.date,T.amount,T.payee,T.description)})}const x=b.expenses||[];r+=x.length;for(const T of x){const R=x3(T);R&&e.push({budgetId:f.id,monthKey:_,transactionType:"expense",transactionId:T.id,violation:R,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:ef(l,T.date,T.amount,T.payee,T.description)})}const S=b.adjustments||[];i+=S.length;for(const T of S){const R=w3(T);R&&e.push({budgetId:f.id,monthKey:_,transactionType:"adjustment",transactionId:T.id,violation:R,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:ef(l,T.date,T.amount,void 0,T.description)})}const C=b.transfers||[];o+=C.length;for(const T of C){const R=S3(T);R&&e.push({budgetId:f.id,monthKey:_,transactionType:"transfer",transactionId:T.id,violation:R,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:ef(l,T.date,T.amount,void 0,T.description)})}}}return e.sort((f,p)=>{const g=f.monthKey.localeCompare(p.monthKey);return g!==0?g:f.transactionType.localeCompare(p.transactionType)}),{totalBudgets:d.length,totalMonths:Array.from(h.values()).reduce((f,p)=>f+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:i,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function C3(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,i]of n){e.push("",`## ${r.toUpperCase()} (${i.length} violations)`,"");for(const o of i){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const l of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${l.rawLine}`,`        Type: ${l.recordType}, Date: ${l.date}, Payee: ${l.payee}`,`        Category: ${l.category}, Account: ${l.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function T3({currentUser:t}){const[e,n]=A.useState(!1),[r,i]=A.useState(null),[o,l]=A.useState(null);async function d(h){if(t){n(!0),i(null),l(null);try{const f=await E3(h);i(f),l(C3(f))}catch(f){console.error("Failed to scan transactions:",f),l(`Error scanning: ${f instanceof Error?f.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:d,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}async function A3(){const{budgets:t,monthsByBudget:e}=await rr("remove-total-fields-migration-scan");let n=0,r=0,i=0;for(const l of t){const d=e.get(l.id)||[];for(const h of d){const f=h.data,p="total_income"in f&&f.total_income!==void 0,g="total_expenses"in f&&f.total_expenses!==void 0;p&&r++,g&&i++,(p||g)&&n++}}const o=e.size>0?Array.from(e.values()).reduce((l,d)=>l+d.length,0):0;return{totalBudgets:t.length,totalMonths:o,monthsNeedingMigration:n,monthsWithTotalIncome:r,monthsWithTotalExpenses:i}}async function j3(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await rr("remove-total-fields-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=[];t.setStage("Processing months...");let o=0;for(const d of r.values())o+=d.length;let l=0;for(const d of n)try{const h=r.get(d.id)||[];for(const f of h){l++;const p=f.data;t.updateItemProgress(l,o,`Month ${p.year}/${p.month}`);const g="total_income"in p&&p.total_income!==void 0,b="total_expenses"in p&&p.total_expenses!==void 0;if(g||b){const{total_income:_,total_expenses:w,...x}=p;i.push({budgetId:d.id,year:p.year,month:p.month,data:{...x,updated_at:new Date().toISOString()}}),e.monthsUpdated++}e.monthsProcessed++}h.length>0&&e.budgetsProcessed++}catch(h){e.errors.push(`Budget ${d.id}: ${h instanceof Error?h.message:String(h)}`)}return i.length>0&&(t.setStage(`Writing ${i.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} month(s) to update`),await Wa(i,"remove-total-fields-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function R3({currentUser:t}){const[e,n]=A.useState(!1),[r,i]=A.useState(!1),[o,l]=A.useState(null),[d,h]=A.useState(null),{runMigrationWithProgress:f}=xc();async function p(){if(t){n(!0);try{const w=await A3();l(w)}catch(w){console.error("Failed to scan remove total fields status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Remove Total Fields Migration",x=>j3(x));h(w)}catch(w){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.monthsNeedingMigration>0,_=o?.monthsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:d,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function I3(){const{budgets:t,monthsByBudget:e}=await rr("remove-previous-month-income-migration-scan");let n=0;for(const i of t){const o=e.get(i.id)||[];for(const l of o){const d=l.data;"previous_month_income"in d&&d.previous_month_income!==void 0&&n++}}const r=e.size>0?Array.from(e.values()).reduce((i,o)=>i+o.length,0):0;return{totalBudgets:t.length,totalMonths:r,monthsNeedingMigration:n}}async function k3(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]},{budgets:n,monthsByBudget:r}=await rr("remove-previous-month-income-migration");t.setStage(`Processing ${n.length} budget(s)...`),t.setProgress(0);const i=[];for(let o=0;o<n.length;o++){const l=n[o];t.setProgress(o/n.length*100),t.setCurrentItem(`Budget ${o+1}/${n.length}: ${l.id}`);try{const d=r.get(l.id)||[];for(const h of d){const f=h.data;if("previous_month_income"in f&&f.previous_month_income!==void 0){const{previous_month_income:g,...b}=f;i.push({budgetId:l.id,year:f.year,month:f.month,data:{...b,updated_at:new Date().toISOString()}}),e.monthsUpdated++}e.monthsProcessed++}d.length>0&&e.budgetsProcessed++}catch(d){e.errors.push(`Budget ${l.id}: ${d instanceof Error?d.message:String(d)}`)}}return i.length>0&&(t.setStage(`Writing ${i.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} month(s) to update`),await Wa(i,"remove-previous-month-income-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function D3({currentUser:t}){const[e,n]=A.useState(!1),[r,i]=A.useState(!1),[o,l]=A.useState(null),[d,h]=A.useState(null),{runMigrationWithProgress:f}=xc();async function p(){if(t){n(!0);try{const w=await I3();l(w)}catch(w){console.error("Failed to scan remove previous month income status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Remove Previous Month Income Migration",x=>k3(x));h(w)}catch(w){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.monthsNeedingMigration>0,_=o?.monthsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:d,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function M3(){const t=await s0("percentage-income-months-back-migration-scan");let e=0;for(const n of t)n.data.percentage_income_months_back===void 0&&e++;return{totalBudgets:t.length,budgetsNeedingMigration:e}}async function O3(t){const e={budgetsProcessed:0,budgetsUpdated:0,errors:[]};t.setStage("Reading all budgets..."),t.setProgress(null);const n=await s0("percentage-income-months-back-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const r=[];for(let i=0;i<n.length;i++){const o=n[i];t.updateItemProgress(i+1,n.length,`Budget: ${o.data.name??o.id}`);try{const l=o.data;l.percentage_income_months_back===void 0&&(r.push({budgetId:o.id,data:{...l,percentage_income_months_back:1}}),e.budgetsProcessed++)}catch(l){e.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}}return r.length>0&&(t.setStage("Writing budget updates..."),t.setProgress(null),t.setCurrentItem(`${r.length} budget(s) to update`),await jm(r,"percentage-income-months-back-migration"),e.budgetsUpdated=r.length),t.setStage("Migration complete"),t.setProgress(100),e}function N3({currentUser:t}){const[e,n]=A.useState(!1),[r,i]=A.useState(!1),[o,l]=A.useState(null),[d,h]=A.useState(null),{runMigrationWithProgress:f}=xc();async function p(){if(t){n(!0);try{const w=await M3();l(w)}catch(w){console.error("Failed to scan percentage income months back status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Percentage Income Months Back",x=>O3(x));h(w)}catch(w){h({budgetsProcessed:0,budgetsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.budgetsNeedingMigration>0,_=o?.budgetsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:d,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function P3(){const{budgets:t,monthsByBudget:e}=await rr("recalculate-start-balances-migration-scan"),n=gd(),r=qe(n.year,n.month);let i=0;for(const l of t){const h=(e.get(l.id)||[]).filter(f=>{const p=f.data;return qe(p.year,p.month)<=r});i+=h.length}const o=e.size>0?Array.from(e.values()).reduce((l,d)=>l+d.length,0):0;return{totalBudgets:t.length,totalMonths:o,monthsNeedingRecalculation:i}}async function B3(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await rr("recalculate-start-balances-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=gd(),o=qe(i.year,i.month),l=[];t.setStage("Processing months...");let d=0;for(const f of n){const g=(r.get(f.id)||[]).filter(b=>{const _=b.data;return qe(_.year,_.month)<=o});d+=g.length}let h=0;for(const f of n)try{const g=(r.get(f.id)||[]).filter(_=>{const w=_.data;return qe(w.year,w.month)<=o}).sort((_,w)=>{const x=_.data,S=w.data,C=qe(x.year,x.month),T=qe(S.year,S.month);return C.localeCompare(T)});if(g.length===0){e.budgetsProcessed++;continue}let b=bd;for(const _ of g){h++;const w=_.data,x=w.year,S=w.month;t.updateItemProgress(h,d,`Budget ${f.id}: ${x}/${S}`);const C={budget_id:f.id,year_month_ordinal:w.year_month_ordinal,year:x,month:S,income:w.income||[],total_income:0,previous_month_income:0,expenses:w.expenses||[],total_expenses:0,transfers:w.transfers||[],adjustments:w.adjustments||[],account_balances:w.account_balances||[],category_balances:w.category_balances||[],are_allocations_finalized:w.are_allocations_finalized??!1,created_at:w.created_at,updated_at:w.updated_at},T=yd(C),R=sc(T,b);b=Lo(R);const k=_d(R);l.push({budgetId:f.id,year:x,month:S,data:k}),e.monthsUpdated++,e.monthsProcessed++}e.budgetsProcessed++}catch(p){e.errors.push(`Budget ${f.id}: ${p instanceof Error?p.message:String(p)}`)}return l.length>0&&(t.setStage(`Writing ${l.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${l.length} month(s) to update`),await Wa(l,"recalculate-start-balances-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function z3({currentUser:t}){const[e,n]=A.useState(!1),[r,i]=A.useState(!1),[o,l]=A.useState(null),[d,h]=A.useState(null),{runMigrationWithProgress:f}=xc();async function p(){if(t){n(!0);try{const w=await P3();l(w)}catch(w){console.error("Failed to scan recalculate start balances status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Recalculate Start Balances Migration",x=>B3(x));h(w)}catch(w){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&o.monthsNeedingRecalculation>0,_=o?.monthsNeedingRecalculation??0;return{isScanning:e,isRunning:r,status:o,result:d,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}async function L3(){const{budgets:t,monthsByBudget:e}=await rr("repair-month-map-migration-scan");let n=0,r=0,i=0;for(const l of t){const d=e.get(l.id)||[],f=l.data.month_map||{},p=new Set;for(const _ of d){const w=qe(_.year,_.month);p.add(w)}let g=0;for(const _ of p)_ in f||g++;let b=0;for(const _ of Object.keys(f))p.has(_)||b++;(g>0||b>0)&&(n++,r+=g,i+=b)}const o=e.size>0?Array.from(e.values()).reduce((l,d)=>l+d.length,0):0;return{totalBudgets:t.length,totalMonths:o,budgetsNeedingRepair:n,totalMissingMonths:r,totalOrphanedEntries:i}}async function U3(t){const e={budgetsProcessed:0,budgetsUpdated:0,monthsAdded:0,orphanedEntriesRemoved:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await rr("repair-month-map-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const i=[];t.setStage("Processing budgets...");let o=0;for(const l of n)try{o++;const d=r.get(l.id)||[],f=l.data.month_map||{};t.updateItemProgress(o,n.length,`Budget ${l.id}`);const p=new Set;for(const w of d){const x=qe(w.year,w.month);p.add(x)}const g={...f};let b=0,_=0;for(const w of p)w in g||(g[w]={},b++);for(const w of Object.keys(g))p.has(w)||(delete g[w],_++);(b>0||_>0)&&(i.push({budgetId:l.id,data:{...l.data,month_map:g,updated_at:new Date().toISOString()}}),e.monthsAdded+=b,e.orphanedEntriesRemoved+=_,e.budgetsUpdated++),e.budgetsProcessed++}catch(d){e.errors.push(`Budget ${l.id}: ${d instanceof Error?d.message:String(d)}`)}return i.length>0&&(t.setStage(`Writing ${i.length} budget update(s)...`),t.setProgress(null),t.setCurrentItem(`${i.length} budget(s) to update`),await jm(i,"repair-month-map-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function F3({currentUser:t}){const[e,n]=A.useState(!1),[r,i]=A.useState(!1),[o,l]=A.useState(null),[d,h]=A.useState(null),{runMigrationWithProgress:f}=xc();async function p(){if(t){n(!0);try{const w=await L3();l(w)}catch(w){console.error("Failed to scan repair month map status:",w)}finally{n(!1)}}}async function g(){if(t){i(!0),h(null);try{const w=await f("Repair Month Map Migration",x=>U3(x));h(w)}catch(w){h({budgetsProcessed:0,budgetsUpdated:0,monthsAdded:0,orphanedEntriesRemoved:0,errors:[w instanceof Error?w.message:"Unknown error"]})}finally{i(!1)}}}const b=o!==null&&(o.totalMissingMonths>0||o.totalOrphanedEntries>0),_=o?o.totalMissingMonths+o.totalOrphanedEntries:0;return{isScanning:e,isRunning:r,status:o,result:d,scanStatus:p,runMigration:g,needsMigration:b,totalItemsToFix:_}}function tf(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ey={exports:{}};var XS;function V3(){return XS||(XS=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,o){function l(f,p){if(!i[f]){if(!r[f]){var g=typeof tf=="function"&&tf;if(!p&&g)return g(f,!0);if(d)return d(f,!0);var b=new Error("Cannot find module '"+f+"'");throw b.code="MODULE_NOT_FOUND",b}var _=i[f]={exports:{}};r[f][0].call(_.exports,function(w){var x=r[f][1][w];return l(x||w)},_,_.exports,n,r,i,o)}return i[f].exports}for(var d=typeof tf=="function"&&tf,h=0;h<o.length;h++)l(o[h]);return l})({1:[function(n,r,i){var o=n("./utils"),l=n("./support"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(h){for(var f,p,g,b,_,w,x,S=[],C=0,T=h.length,R=T,k=o.getTypeOf(h)!=="string";C<h.length;)R=T-C,g=k?(f=h[C++],p=C<T?h[C++]:0,C<T?h[C++]:0):(f=h.charCodeAt(C++),p=C<T?h.charCodeAt(C++):0,C<T?h.charCodeAt(C++):0),b=f>>2,_=(3&f)<<4|p>>4,w=1<R?(15&p)<<2|g>>6:64,x=2<R?63&g:64,S.push(d.charAt(b)+d.charAt(_)+d.charAt(w)+d.charAt(x));return S.join("")},i.decode=function(h){var f,p,g,b,_,w,x=0,S=0,C="data:";if(h.substr(0,C.length)===C)throw new Error("Invalid base64 input, it looks like a data url.");var T,R=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===d.charAt(64)&&R--,h.charAt(h.length-2)===d.charAt(64)&&R--,R%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=l.uint8array?new Uint8Array(0|R):new Array(0|R);x<h.length;)f=d.indexOf(h.charAt(x++))<<2|(b=d.indexOf(h.charAt(x++)))>>4,p=(15&b)<<4|(_=d.indexOf(h.charAt(x++)))>>2,g=(3&_)<<6|(w=d.indexOf(h.charAt(x++))),T[S++]=f,_!==64&&(T[S++]=p),w!==64&&(T[S++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var o=n("./external"),l=n("./stream/DataWorker"),d=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function f(p,g,b,_,w){this.compressedSize=p,this.uncompressedSize=g,this.crc32=b,this.compression=_,this.compressedContent=w}f.prototype={getContentWorker:function(){var p=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},f.createWorkerFrom=function(p,g,b){return p.pipe(new d).pipe(new h("uncompressedSize")).pipe(g.compressWorker(b)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=f},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var o=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var o=n("./utils"),l=(function(){for(var d,h=[],f=0;f<256;f++){d=f;for(var p=0;p<8;p++)d=1&d?3988292384^d>>>1:d>>>1;h[f]=d}return h})();r.exports=function(d,h){return d!==void 0&&d.length?o.getTypeOf(d)!=="string"?(function(f,p,g,b){var _=l,w=b+g;f^=-1;for(var x=b;x<w;x++)f=f>>>8^_[255&(f^p[x])];return-1^f})(0|h,d,d.length,0):(function(f,p,g,b){var _=l,w=b+g;f^=-1;for(var x=b;x<w;x++)f=f>>>8^_[255&(f^p.charCodeAt(x))];return-1^f})(0|h,d,d.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=n("pako"),d=n("./utils"),h=n("./stream/GenericWorker"),f=o?"uint8array":"array";function p(g,b){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=b,this.meta={}}i.magic="\b\0",d.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(d.transformTo(f,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(b){g.push({data:b,meta:g.meta})}},i.compressWorker=function(g){return new p("Deflate",g)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function o(_,w){var x,S="";for(x=0;x<w;x++)S+=String.fromCharCode(255&_),_>>>=8;return S}function l(_,w,x,S,C,T){var R,k,V=_.file,$=_.compression,D=T!==f.utf8encode,O=d.transformTo("string",T(V.name)),N=d.transformTo("string",f.utf8encode(V.name)),U=V.comment,q=d.transformTo("string",T(U)),I=d.transformTo("string",f.utf8encode(U)),z=N.length!==V.name.length,M=I.length!==U.length,X="",Y="",G="",Z=V.dir,W=V.date,te={crc32:0,compressedSize:0,uncompressedSize:0};w&&!x||(te.crc32=_.crc32,te.compressedSize=_.compressedSize,te.uncompressedSize=_.uncompressedSize);var B=0;w&&(B|=8),D||!z&&!M||(B|=2048);var H=0,ne=0;Z&&(H|=16),C==="UNIX"?(ne=798,H|=(function(ce,_e){var Te=ce;return ce||(Te=_e?16893:33204),(65535&Te)<<16})(V.unixPermissions,Z)):(ne=20,H|=(function(ce){return 63&(ce||0)})(V.dosPermissions)),R=W.getUTCHours(),R<<=6,R|=W.getUTCMinutes(),R<<=5,R|=W.getUTCSeconds()/2,k=W.getUTCFullYear()-1980,k<<=4,k|=W.getUTCMonth()+1,k<<=5,k|=W.getUTCDate(),z&&(Y=o(1,1)+o(p(O),4)+N,X+="up"+o(Y.length,2)+Y),M&&(G=o(1,1)+o(p(q),4)+I,X+="uc"+o(G.length,2)+G);var re="";return re+=`
\0`,re+=o(B,2),re+=$.magic,re+=o(R,2),re+=o(k,2),re+=o(te.crc32,4),re+=o(te.compressedSize,4),re+=o(te.uncompressedSize,4),re+=o(O.length,2),re+=o(X.length,2),{fileRecord:g.LOCAL_FILE_HEADER+re+O+X,dirRecord:g.CENTRAL_FILE_HEADER+o(ne,2)+re+o(q.length,2)+"\0\0\0\0"+o(H,4)+o(S,4)+O+X+q}}var d=n("../utils"),h=n("../stream/GenericWorker"),f=n("../utf8"),p=n("../crc32"),g=n("../signature");function b(_,w,x,S){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=w,this.zipPlatform=x,this.encodeFileName=S,this.streamFiles=_,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}d.inherits(b,h),b.prototype.push=function(_){var w=_.meta.percent||0,x=this.entriesCount,S=this._sources.length;this.accumulate?this.contentBuffer.push(_):(this.bytesWritten+=_.data.length,h.prototype.push.call(this,{data:_.data,meta:{currentFile:this.currentFile,percent:x?(w+100*(x-S-1))/x:100}}))},b.prototype.openedSource=function(_){this.currentSourceOffset=this.bytesWritten,this.currentFile=_.file.name;var w=this.streamFiles&&!_.file.dir;if(w){var x=l(_,w,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},b.prototype.closedSource=function(_){this.accumulate=!1;var w=this.streamFiles&&!_.file.dir,x=l(_,w,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),w)this.push({data:(function(S){return g.DATA_DESCRIPTOR+o(S.crc32,4)+o(S.compressedSize,4)+o(S.uncompressedSize,4)})(_),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},b.prototype.flush=function(){for(var _=this.bytesWritten,w=0;w<this.dirRecords.length;w++)this.push({data:this.dirRecords[w],meta:{percent:100}});var x=this.bytesWritten-_,S=(function(C,T,R,k,V){var $=d.transformTo("string",V(k));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(C,2)+o(C,2)+o(T,4)+o(R,4)+o($.length,2)+$})(this.dirRecords.length,x,_,this.zipComment,this.encodeFileName);this.push({data:S,meta:{percent:100}})},b.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},b.prototype.registerPrevious=function(_){this._sources.push(_);var w=this;return _.on("data",function(x){w.processChunk(x)}),_.on("end",function(){w.closedSource(w.previous.streamInfo),w._sources.length?w.prepareNextSource():w.end()}),_.on("error",function(x){w.error(x)}),this},b.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},b.prototype.error=function(_){var w=this._sources;if(!h.prototype.error.call(this,_))return!1;for(var x=0;x<w.length;x++)try{w[x].error(_)}catch{}return!0},b.prototype.lock=function(){h.prototype.lock.call(this);for(var _=this._sources,w=0;w<_.length;w++)_[w].lock()},r.exports=b},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var o=n("../compressions"),l=n("./ZipFileWorker");i.generateWorker=function(d,h,f){var p=new l(h.streamFiles,f,h.platform,h.encodeFileName),g=0;try{d.forEach(function(b,_){g++;var w=(function(T,R){var k=T||R,V=o[k];if(!V)throw new Error(k+" is not a valid compression method !");return V})(_.options.compression,h.compression),x=_.options.compressionOptions||h.compressionOptions||{},S=_.dir,C=_.date;_._compressWorker(w,x).withStreamInfo("file",{name:b,dir:S,date:C,comment:_.comment||"",unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(b){p.error(b)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var d in this)typeof this[d]!="function"&&(l[d]=this[d]);return l}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(l,d){return new o().loadAsync(l,d)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var o=n("./utils"),l=n("./external"),d=n("./utf8"),h=n("./zipEntries"),f=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(b){return new l.Promise(function(_,w){var x=b.decompressed.getContentWorker().pipe(new f);x.on("error",function(S){w(S)}).on("end",function(){x.streamInfo.crc32!==b.decompressed.crc32?w(new Error("Corrupted zip : CRC32 mismatch")):_()}).resume()})}r.exports=function(b,_){var w=this;return _=o.extend(_||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:d.utf8decode}),p.isNode&&p.isStream(b)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",b,!0,_.optimizedBinaryString,_.base64).then(function(x){var S=new h(_);return S.load(x),S}).then(function(x){var S=[l.Promise.resolve(x)],C=x.files;if(_.checkCRC32)for(var T=0;T<C.length;T++)S.push(g(C[T]));return l.Promise.all(S)}).then(function(x){for(var S=x.shift(),C=S.files,T=0;T<C.length;T++){var R=C[T],k=R.fileNameStr,V=o.resolve(R.fileNameStr);w.file(V,R.decompressed,{binary:!0,optimizedBinaryString:!0,date:R.date,dir:R.dir,comment:R.fileCommentStr.length?R.fileCommentStr:null,unixPermissions:R.unixPermissions,dosPermissions:R.dosPermissions,createFolders:_.createFolders}),R.dir||(w.file(V).unsafeOriginalName=k)}return S.zipComment.length&&(w.comment=S.zipComment),w})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var o=n("../utils"),l=n("../stream/GenericWorker");function d(h,f){l.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(f)}o.inherits(d,l),d.prototype._bindStream=function(h){var f=this;(this._stream=h).pause(),h.on("data",function(p){f.push({data:p,meta:{percent:0}})}).on("error",function(p){f.isPaused?this.generatedError=p:f.error(p)}).on("end",function(){f.isPaused?f._upstreamEnded=!0:f.end()})},d.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var o=n("readable-stream").Readable;function l(d,h,f){o.call(this,h),this._helper=d;var p=this;d.on("data",function(g,b){p.push(g)||p._helper.pause(),f&&f(b)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},r.exports=l},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,i){function o(V,$,D){var O,N=d.getTypeOf($),U=d.extend(D||{},p);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(V=C(V)),U.createFolders&&(O=S(V))&&T.call(this,O,!0);var q=N==="string"&&U.binary===!1&&U.base64===!1;D&&D.binary!==void 0||(U.binary=!q),($ instanceof g&&$.uncompressedSize===0||U.dir||!$||$.length===0)&&(U.base64=!1,U.binary=!0,$="",U.compression="STORE",N="string");var I=null;I=$ instanceof g||$ instanceof h?$:w.isNode&&w.isStream($)?new x(V,$):d.prepareContent(V,$,U.binary,U.optimizedBinaryString,U.base64);var z=new b(V,I,U);this.files[V]=z}var l=n("./utf8"),d=n("./utils"),h=n("./stream/GenericWorker"),f=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),b=n("./zipObject"),_=n("./generate"),w=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),S=function(V){V.slice(-1)==="/"&&(V=V.substring(0,V.length-1));var $=V.lastIndexOf("/");return 0<$?V.substring(0,$):""},C=function(V){return V.slice(-1)!=="/"&&(V+="/"),V},T=function(V,$){return $=$!==void 0?$:p.createFolders,V=C(V),this.files[V]||o.call(this,V,null,{dir:!0,createFolders:$}),this.files[V]};function R(V){return Object.prototype.toString.call(V)==="[object RegExp]"}var k={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(V){var $,D,O;for($ in this.files)O=this.files[$],(D=$.slice(this.root.length,$.length))&&$.slice(0,this.root.length)===this.root&&V(D,O)},filter:function(V){var $=[];return this.forEach(function(D,O){V(D,O)&&$.push(O)}),$},file:function(V,$,D){if(arguments.length!==1)return V=this.root+V,o.call(this,V,$,D),this;if(R(V)){var O=V;return this.filter(function(U,q){return!q.dir&&O.test(U)})}var N=this.files[this.root+V];return N&&!N.dir?N:null},folder:function(V){if(!V)return this;if(R(V))return this.filter(function(N,U){return U.dir&&V.test(N)});var $=this.root+V,D=T.call(this,$),O=this.clone();return O.root=D.name,O},remove:function(V){V=this.root+V;var $=this.files[V];if($||(V.slice(-1)!=="/"&&(V+="/"),$=this.files[V]),$&&!$.dir)delete this.files[V];else for(var D=this.filter(function(N,U){return U.name.slice(0,V.length)===V}),O=0;O<D.length;O++)delete this.files[D[O].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(V){var $,D={};try{if((D=d.extend(V||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=D.type.toLowerCase(),D.compression=D.compression.toUpperCase(),D.type==="binarystring"&&(D.type="string"),!D.type)throw new Error("No output type specified.");d.checkSupport(D.type),D.platform!=="darwin"&&D.platform!=="freebsd"&&D.platform!=="linux"&&D.platform!=="sunos"||(D.platform="UNIX"),D.platform==="win32"&&(D.platform="DOS");var O=D.comment||this.comment||"";$=_.generateWorker(this,D,O)}catch(N){($=new h("error")).error(N)}return new f($,D.type||"string",D.mimeType)},generateAsync:function(V,$){return this.generateInternalStream(V).accumulate($)},generateNodeStream:function(V,$){return(V=V||{}).type||(V.type="nodebuffer"),this.generateInternalStream(V).toNodejsStream($)}};r.exports=k},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d);for(var h=0;h<this.data.length;h++)d[h]=255&d[h]}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data[this.zero+d]},l.prototype.lastIndexOfSignature=function(d){for(var h=d.charCodeAt(0),f=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),b=this.length-4;0<=b;--b)if(this.data[b]===h&&this.data[b+1]===f&&this.data[b+2]===p&&this.data[b+3]===g)return b-this.zero;return-1},l.prototype.readAndCheckSignature=function(d){var h=d.charCodeAt(0),f=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),b=this.readData(4);return h===b[0]&&f===b[1]&&p===b[2]&&g===b[3]},l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var o=n("../utils");function l(d){this.data=d,this.length=d.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(d){this.checkIndex(this.index+d)},checkIndex:function(d){if(this.length<this.zero+d||d<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+d+"). Corrupted zip ?")},setIndex:function(d){this.checkIndex(d),this.index=d},skip:function(d){this.setIndex(this.index+d)},byteAt:function(){},readInt:function(d){var h,f=0;for(this.checkOffset(d),h=this.index+d-1;h>=this.index;h--)f=(f<<8)+this.byteAt(h);return this.index+=d,f},readString:function(d){return o.transformTo("string",this.readData(d))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var d=this.readInt(4);return new Date(Date.UTC(1980+(d>>25&127),(d>>21&15)-1,d>>16&31,d>>11&31,d>>5&63,(31&d)<<1))}},r.exports=l},{"../utils":32}],19:[function(n,r,i){var o=n("./Uint8ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data.charCodeAt(this.zero+d)},l.prototype.lastIndexOfSignature=function(d){return this.data.lastIndexOf(d)-this.zero},l.prototype.readAndCheckSignature=function(d){return d===this.readData(4)},l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var o=n("./ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var o=n("../utils"),l=n("../support"),d=n("./ArrayReader"),h=n("./StringReader"),f=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var b=o.getTypeOf(g);return o.checkSupport(b),b!=="string"||l.uint8array?b==="nodebuffer"?new f(g):l.uint8array?new p(o.transformTo("uint8array",g)):new d(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var o=n("./GenericWorker"),l=n("../utils");function d(h){o.call(this,"ConvertWorker to "+h),this.destType=h}l.inherits(d,o),d.prototype.processChunk=function(h){this.push({data:l.transformTo(this.destType,h.data),meta:h.meta})},r.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var o=n("./GenericWorker"),l=n("../crc32");function d(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(d,o),d.prototype.processChunk=function(h){this.streamInfo.crc32=l(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(d,l),d.prototype.processChunk=function(h){if(h){var f=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=f+h.data.length}l.prototype.processChunk.call(this,h)},r.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataWorker");var f=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){f.dataIsReady=!0,f.data=p,f.max=p&&p.length||0,f.type=o.getTypeOf(p),f.isPaused||f._tickAndRepeat()},function(p){f.error(p)})}o.inherits(d,l),d.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,f=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,f);break;case"uint8array":h=this.data.subarray(this.index,f);break;case"array":case"nodebuffer":h=this.data.slice(this.index,f)}return this.index=f,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,d){return this._listeners[l].push(d),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,d){if(this._listeners[l])for(var h=0;h<this._listeners[l].length;h++)this._listeners[l][h].call(this,d)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var d=this;return l.on("data",function(h){d.processChunk(h)}),l.on("end",function(){d.end()}),l.on("error",function(h){d.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,d){return this.extraStreamInfo[l]=d,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},r.exports=o},{}],29:[function(n,r,i){var o=n("../utils"),l=n("./ConvertWorker"),d=n("./GenericWorker"),h=n("../base64"),f=n("../support"),p=n("../external"),g=null;if(f.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function b(w,x){return new p.Promise(function(S,C){var T=[],R=w._internalType,k=w._outputType,V=w._mimeType;w.on("data",function($,D){T.push($),x&&x(D)}).on("error",function($){T=[],C($)}).on("end",function(){try{var $=(function(D,O,N){switch(D){case"blob":return o.newBlob(o.transformTo("arraybuffer",O),N);case"base64":return h.encode(O);default:return o.transformTo(D,O)}})(k,(function(D,O){var N,U=0,q=null,I=0;for(N=0;N<O.length;N++)I+=O[N].length;switch(D){case"string":return O.join("");case"array":return Array.prototype.concat.apply([],O);case"uint8array":for(q=new Uint8Array(I),N=0;N<O.length;N++)q.set(O[N],U),U+=O[N].length;return q;case"nodebuffer":return Buffer.concat(O);default:throw new Error("concat : unsupported type '"+D+"'")}})(R,T),V);S($)}catch(D){C(D)}T=[]}).resume()})}function _(w,x,S){var C=x;switch(x){case"blob":case"arraybuffer":C="uint8array";break;case"base64":C="string"}try{this._internalType=C,this._outputType=x,this._mimeType=S,o.checkSupport(C),this._worker=w.pipe(new l(C)),w.lock()}catch(T){this._worker=new d("error"),this._worker.error(T)}}_.prototype={accumulate:function(w){return b(this,w)},on:function(w,x){var S=this;return w==="data"?this._worker.on(w,function(C){x.call(S,C.data,C.meta)}):this._worker.on(w,function(){o.delay(x,arguments,S)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(w){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},w)}},r.exports=_},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),i.blob=l.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var o=n("./utils"),l=n("./support"),d=n("./nodejsUtils"),h=n("./stream/GenericWorker"),f=new Array(256),p=0;p<256;p++)f[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;f[254]=f[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function b(){h.call(this,"utf-8 encode")}i.utf8encode=function(_){return l.nodebuffer?d.newBufferFrom(_,"utf-8"):(function(w){var x,S,C,T,R,k=w.length,V=0;for(T=0;T<k;T++)(64512&(S=w.charCodeAt(T)))==55296&&T+1<k&&(64512&(C=w.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(C-56320),T++),V+=S<128?1:S<2048?2:S<65536?3:4;for(x=l.uint8array?new Uint8Array(V):new Array(V),T=R=0;R<V;T++)(64512&(S=w.charCodeAt(T)))==55296&&T+1<k&&(64512&(C=w.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(C-56320),T++),S<128?x[R++]=S:(S<2048?x[R++]=192|S>>>6:(S<65536?x[R++]=224|S>>>12:(x[R++]=240|S>>>18,x[R++]=128|S>>>12&63),x[R++]=128|S>>>6&63),x[R++]=128|63&S);return x})(_)},i.utf8decode=function(_){return l.nodebuffer?o.transformTo("nodebuffer",_).toString("utf-8"):(function(w){var x,S,C,T,R=w.length,k=new Array(2*R);for(x=S=0;x<R;)if((C=w[x++])<128)k[S++]=C;else if(4<(T=f[C]))k[S++]=65533,x+=T-1;else{for(C&=T===2?31:T===3?15:7;1<T&&x<R;)C=C<<6|63&w[x++],T--;1<T?k[S++]=65533:C<65536?k[S++]=C:(C-=65536,k[S++]=55296|C>>10&1023,k[S++]=56320|1023&C)}return k.length!==S&&(k.subarray?k=k.subarray(0,S):k.length=S),o.applyFromCharCode(k)})(_=o.transformTo(l.uint8array?"uint8array":"array",_))},o.inherits(g,h),g.prototype.processChunk=function(_){var w=o.transformTo(l.uint8array?"uint8array":"array",_.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var x=w;(w=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),w.set(x,this.leftOver.length)}else w=this.leftOver.concat(w);this.leftOver=null}var S=(function(T,R){var k;for((R=R||T.length)>T.length&&(R=T.length),k=R-1;0<=k&&(192&T[k])==128;)k--;return k<0||k===0?R:k+f[T[k]]>R?k:R})(w),C=w;S!==w.length&&(l.uint8array?(C=w.subarray(0,S),this.leftOver=w.subarray(S,w.length)):(C=w.slice(0,S),this.leftOver=w.slice(S,w.length))),this.push({data:i.utf8decode(C),meta:_.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,o.inherits(b,h),b.prototype.processChunk=function(_){this.push({data:i.utf8encode(_.data),meta:_.meta})},i.Utf8EncodeWorker=b},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var o=n("./support"),l=n("./base64"),d=n("./nodejsUtils"),h=n("./external");function f(x){return x}function p(x,S){for(var C=0;C<x.length;++C)S[C]=255&x.charCodeAt(C);return S}n("setimmediate"),i.newBlob=function(x,S){i.checkSupport("blob");try{return new Blob([x],{type:S})}catch{try{var C=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return C.append(x),C.getBlob(S)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(x,S,C){var T=[],R=0,k=x.length;if(k<=C)return String.fromCharCode.apply(null,x);for(;R<k;)S==="array"||S==="nodebuffer"?T.push(String.fromCharCode.apply(null,x.slice(R,Math.min(R+C,k)))):T.push(String.fromCharCode.apply(null,x.subarray(R,Math.min(R+C,k)))),R+=C;return T.join("")},stringifyByChar:function(x){for(var S="",C=0;C<x.length;C++)S+=String.fromCharCode(x[C]);return S},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,d.allocBuffer(1)).length===1}catch{return!1}})()}};function b(x){var S=65536,C=i.getTypeOf(x),T=!0;if(C==="uint8array"?T=g.applyCanBeUsed.uint8array:C==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<S;)try{return g.stringifyByChunk(x,C,S)}catch{S=Math.floor(S/2)}return g.stringifyByChar(x)}function _(x,S){for(var C=0;C<x.length;C++)S[C]=x[C];return S}i.applyFromCharCode=b;var w={};w.string={string:f,array:function(x){return p(x,new Array(x.length))},arraybuffer:function(x){return w.string.uint8array(x).buffer},uint8array:function(x){return p(x,new Uint8Array(x.length))},nodebuffer:function(x){return p(x,d.allocBuffer(x.length))}},w.array={string:b,array:f,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(x)}},w.arraybuffer={string:function(x){return b(new Uint8Array(x))},array:function(x){return _(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:f,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(new Uint8Array(x))}},w.uint8array={string:b,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:f,nodebuffer:function(x){return d.newBufferFrom(x)}},w.nodebuffer={string:b,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return w.nodebuffer.uint8array(x).buffer},uint8array:function(x){return _(x,new Uint8Array(x.length))},nodebuffer:f},i.transformTo=function(x,S){if(S=S||"",!x)return S;i.checkSupport(x);var C=i.getTypeOf(S);return w[C][x](S)},i.resolve=function(x){for(var S=x.split("/"),C=[],T=0;T<S.length;T++){var R=S[T];R==="."||R===""&&T!==0&&T!==S.length-1||(R===".."?C.pop():C.push(R))}return C.join("/")},i.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":o.nodebuffer&&d.isBuffer(x)?"nodebuffer":o.uint8array&&x instanceof Uint8Array?"uint8array":o.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(x){if(!o[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(x){var S,C,T="";for(C=0;C<(x||"").length;C++)T+="\\x"+((S=x.charCodeAt(C))<16?"0":"")+S.toString(16).toUpperCase();return T},i.delay=function(x,S,C){setImmediate(function(){x.apply(C||null,S||[])})},i.inherits=function(x,S){function C(){}C.prototype=S.prototype,x.prototype=new C},i.extend=function(){var x,S,C={};for(x=0;x<arguments.length;x++)for(S in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],S)&&C[S]===void 0&&(C[S]=arguments[x][S]);return C},i.prepareContent=function(x,S,C,T,R){return h.Promise.resolve(S).then(function(k){return o.blob&&(k instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(k))!==-1)&&typeof FileReader<"u"?new h.Promise(function(V,$){var D=new FileReader;D.onload=function(O){V(O.target.result)},D.onerror=function(O){$(O.target.error)},D.readAsArrayBuffer(k)}):k}).then(function(k){var V=i.getTypeOf(k);return V?(V==="arraybuffer"?k=i.transformTo("uint8array",k):V==="string"&&(R?k=l.decode(k):C&&T!==!0&&(k=(function($){return p($,o.uint8array?new Uint8Array($.length):new Array($.length))})(k))),k):h.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./signature"),h=n("./zipEntry"),f=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(b)+", expected "+l.pretty(g)+")")}},isSignature:function(g,b){var _=this.reader.index;this.reader.setIndex(g);var w=this.reader.readString(4)===b;return this.reader.setIndex(_),w},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),b=f.uint8array?"uint8array":"array",_=l.transformTo(b,g);this.zipComment=this.loadOptions.decodeFileName(_)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,b,_,w=this.zip64EndOfCentralSize-44;0<w;)g=this.reader.readInt(2),b=this.reader.readInt(4),_=this.reader.readData(b),this.zip64ExtensibleData[g]={id:g,length:b,value:_}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,b;for(g=0;g<this.files.length;g++)b=this.files[g],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(d.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(d.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(d.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,d.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var b=g;if(this.checkSignature(d.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,d.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var _=this.centralDirOffset+this.centralDirSize;this.zip64&&(_+=20,_+=12+this.zip64EndOfCentralSize);var w=b-_;if(0<w)this.isSignature(b,d.CENTRAL_FILE_HEADER)||(this.reader.zero=w);else if(w<0)throw new Error("Corrupted zip: missing "+Math.abs(w)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./compressedObject"),h=n("./crc32"),f=n("./utf8"),p=n("./compressions"),g=n("./support");function b(_,w){this.options=_,this.loadOptions=w}b.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(_){var w,x;if(_.skip(22),this.fileNameLength=_.readInt(2),x=_.readInt(2),this.fileName=_.readData(this.fileNameLength),_.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((w=(function(S){for(var C in p)if(Object.prototype.hasOwnProperty.call(p,C)&&p[C].magic===S)return p[C];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new d(this.compressedSize,this.uncompressedSize,this.crc32,w,_.readData(this.compressedSize))},readCentralPart:function(_){this.versionMadeBy=_.readInt(2),_.skip(2),this.bitFlag=_.readInt(2),this.compressionMethod=_.readString(2),this.date=_.readDate(),this.crc32=_.readInt(4),this.compressedSize=_.readInt(4),this.uncompressedSize=_.readInt(4);var w=_.readInt(2);if(this.extraFieldsLength=_.readInt(2),this.fileCommentLength=_.readInt(2),this.diskNumberStart=_.readInt(2),this.internalFileAttributes=_.readInt(2),this.externalFileAttributes=_.readInt(4),this.localHeaderOffset=_.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");_.skip(w),this.readExtraFields(_),this.parseZIP64ExtraField(_),this.fileComment=_.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var _=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),_==0&&(this.dosPermissions=63&this.externalFileAttributes),_==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var _=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=_.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=_.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=_.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=_.readInt(4))}},readExtraFields:function(_){var w,x,S,C=_.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});_.index+4<C;)w=_.readInt(2),x=_.readInt(2),S=_.readData(x),this.extraFields[w]={id:w,length:x,value:S};_.setIndex(C)},handleUTF8:function(){var _=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=f.utf8decode(this.fileName),this.fileCommentStr=f.utf8decode(this.fileComment);else{var w=this.findExtraFieldUnicodePath();if(w!==null)this.fileNameStr=w;else{var x=l.transformTo(_,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var C=l.transformTo(_,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(C)}}},findExtraFieldUnicodePath:function(){var _=this.extraFields[28789];if(_){var w=o(_.value);return w.readInt(1)!==1||h(this.fileName)!==w.readInt(4)?null:f.utf8decode(w.readData(_.length-5))}return null},findExtraFieldUnicodeComment:function(){var _=this.extraFields[25461];if(_){var w=o(_.value);return w.readInt(1)!==1||h(this.fileComment)!==w.readInt(4)?null:f.utf8decode(w.readData(_.length-5))}return null}},r.exports=b},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function o(w,x,S){this.name=w,this.dir=S.dir,this.date=S.date,this.comment=S.comment,this.unixPermissions=S.unixPermissions,this.dosPermissions=S.dosPermissions,this._data=x,this._dataBinary=S.binary,this.options={compression:S.compression,compressionOptions:S.compressionOptions}}var l=n("./stream/StreamHelper"),d=n("./stream/DataWorker"),h=n("./utf8"),f=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(w){var x=null,S="string";try{if(!w)throw new Error("No output type specified.");var C=(S=w.toLowerCase())==="string"||S==="text";S!=="binarystring"&&S!=="text"||(S="string"),x=this._decompressWorker();var T=!this._dataBinary;T&&!C&&(x=x.pipe(new h.Utf8EncodeWorker)),!T&&C&&(x=x.pipe(new h.Utf8DecodeWorker))}catch(R){(x=new p("error")).error(R)}return new l(x,S,"")},async:function(w,x){return this.internalStream(w).accumulate(x)},nodeStream:function(w,x){return this.internalStream(w||"nodebuffer").toNodejsStream(x)},_compressWorker:function(w,x){if(this._data instanceof f&&this._data.compression.magic===w.magic)return this._data.getCompressedWorker();var S=this._decompressWorker();return this._dataBinary||(S=S.pipe(new h.Utf8EncodeWorker)),f.createWorkerFrom(S,w,x)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof p?this._data:new d(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],b=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},_=0;_<g.length;_++)o.prototype[g[_]]=b;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(o){var l,d,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var f=0,p=new h(w),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=f=++f%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){w(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(w,0)};else{var b=new o.MessageChannel;b.port1.onmessage=w,l=function(){b.port2.postMessage(0)}}var _=[];function w(){var x,S;d=!0;for(var C=_.length;C;){for(S=_,_=[],x=-1;++x<C;)S[x]();C=_.length}d=!1}r.exports=function(x){_.push(x)!==1||d||l()}}).call(this,typeof Hh<"u"?Hh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var o=n("immediate");function l(){}var d={},h=["REJECTED"],f=["FULFILLED"],p=["PENDING"];function g(C){if(typeof C!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,C!==l&&x(this,C)}function b(C,T,R){this.promise=C,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof R=="function"&&(this.onRejected=R,this.callRejected=this.otherCallRejected)}function _(C,T,R){o(function(){var k;try{k=T(R)}catch(V){return d.reject(C,V)}k===C?d.reject(C,new TypeError("Cannot resolve promise with itself")):d.resolve(C,k)})}function w(C){var T=C&&C.then;if(C&&(typeof C=="object"||typeof C=="function")&&typeof T=="function")return function(){T.apply(C,arguments)}}function x(C,T){var R=!1;function k(D){R||(R=!0,d.reject(C,D))}function V(D){R||(R=!0,d.resolve(C,D))}var $=S(function(){T(V,k)});$.status==="error"&&k($.value)}function S(C,T){var R={};try{R.value=C(T),R.status="success"}catch(k){R.status="error",R.value=k}return R}(r.exports=g).prototype.finally=function(C){if(typeof C!="function")return this;var T=this.constructor;return this.then(function(R){return T.resolve(C()).then(function(){return R})},function(R){return T.resolve(C()).then(function(){throw R})})},g.prototype.catch=function(C){return this.then(null,C)},g.prototype.then=function(C,T){if(typeof C!="function"&&this.state===f||typeof T!="function"&&this.state===h)return this;var R=new this.constructor(l);return this.state!==p?_(R,this.state===f?C:T,this.outcome):this.queue.push(new b(R,C,T)),R},b.prototype.callFulfilled=function(C){d.resolve(this.promise,C)},b.prototype.otherCallFulfilled=function(C){_(this.promise,this.onFulfilled,C)},b.prototype.callRejected=function(C){d.reject(this.promise,C)},b.prototype.otherCallRejected=function(C){_(this.promise,this.onRejected,C)},d.resolve=function(C,T){var R=S(w,T);if(R.status==="error")return d.reject(C,R.value);var k=R.value;if(k)x(C,k);else{C.state=f,C.outcome=T;for(var V=-1,$=C.queue.length;++V<$;)C.queue[V].callFulfilled(T)}return C},d.reject=function(C,T){C.state=h,C.outcome=T;for(var R=-1,k=C.queue.length;++R<k;)C.queue[R].callRejected(T);return C},g.resolve=function(C){return C instanceof this?C:d.resolve(new this(l),C)},g.reject=function(C){var T=new this(l);return d.reject(T,C)},g.all=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=C.length,k=!1;if(!R)return this.resolve([]);for(var V=new Array(R),$=0,D=-1,O=new this(l);++D<R;)N(C[D],D);return O;function N(U,q){T.resolve(U).then(function(I){V[q]=I,++$!==R||k||(k=!0,d.resolve(O,V))},function(I){k||(k=!0,d.reject(O,I))})}},g.race=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=C.length,k=!1;if(!R)return this.resolve([]);for(var V=-1,$=new this(l);++V<R;)D=C[V],T.resolve(D).then(function(O){k||(k=!0,d.resolve($,O))},function(O){k||(k=!0,d.reject($,O))});var D;return $}},{immediate:36}],38:[function(n,r,i){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var o=n("./zlib/deflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/messages"),f=n("./zlib/zstream"),p=Object.prototype.toString,g=0,b=-1,_=0,w=8;function x(C){if(!(this instanceof x))return new x(C);this.options=l.assign({level:b,method:w,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},C||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var R=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(R!==g)throw new Error(h[R]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var k;if(k=typeof T.dictionary=="string"?d.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(R=o.deflateSetDictionary(this.strm,k))!==g)throw new Error(h[R]);this._dict_set=!0}}function S(C,T){var R=new x(T);if(R.push(C,!0),R.err)throw R.msg||h[R.err];return R.result}x.prototype.push=function(C,T){var R,k,V=this.strm,$=this.options.chunkSize;if(this.ended)return!1;k=T===~~T?T:T===!0?4:0,typeof C=="string"?V.input=d.string2buf(C):p.call(C)==="[object ArrayBuffer]"?V.input=new Uint8Array(C):V.input=C,V.next_in=0,V.avail_in=V.input.length;do{if(V.avail_out===0&&(V.output=new l.Buf8($),V.next_out=0,V.avail_out=$),(R=o.deflate(V,k))!==1&&R!==g)return this.onEnd(R),!(this.ended=!0);V.avail_out!==0&&(V.avail_in!==0||k!==4&&k!==2)||(this.options.to==="string"?this.onData(d.buf2binstring(l.shrinkBuf(V.output,V.next_out))):this.onData(l.shrinkBuf(V.output,V.next_out)))}while((0<V.avail_in||V.avail_out===0)&&R!==1);return k===4?(R=o.deflateEnd(this.strm),this.onEnd(R),this.ended=!0,R===g):k!==2||(this.onEnd(g),!(V.avail_out=0))},x.prototype.onData=function(C){this.chunks.push(C)},x.prototype.onEnd=function(C){C===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},i.Deflate=x,i.deflate=S,i.deflateRaw=function(C,T){return(T=T||{}).raw=!0,S(C,T)},i.gzip=function(C,T){return(T=T||{}).gzip=!0,S(C,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var o=n("./zlib/inflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/constants"),f=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),b=Object.prototype.toString;function _(x){if(!(this instanceof _))return new _(x);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},x||{});var S=this.options;S.raw&&0<=S.windowBits&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),!(0<=S.windowBits&&S.windowBits<16)||x&&x.windowBits||(S.windowBits+=32),15<S.windowBits&&S.windowBits<48&&(15&S.windowBits)==0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var C=o.inflateInit2(this.strm,S.windowBits);if(C!==h.Z_OK)throw new Error(f[C]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function w(x,S){var C=new _(S);if(C.push(x,!0),C.err)throw C.msg||f[C.err];return C.result}_.prototype.push=function(x,S){var C,T,R,k,V,$,D=this.strm,O=this.options.chunkSize,N=this.options.dictionary,U=!1;if(this.ended)return!1;T=S===~~S?S:S===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof x=="string"?D.input=d.binstring2buf(x):b.call(x)==="[object ArrayBuffer]"?D.input=new Uint8Array(x):D.input=x,D.next_in=0,D.avail_in=D.input.length;do{if(D.avail_out===0&&(D.output=new l.Buf8(O),D.next_out=0,D.avail_out=O),(C=o.inflate(D,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&N&&($=typeof N=="string"?d.string2buf(N):b.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,C=o.inflateSetDictionary(this.strm,$)),C===h.Z_BUF_ERROR&&U===!0&&(C=h.Z_OK,U=!1),C!==h.Z_STREAM_END&&C!==h.Z_OK)return this.onEnd(C),!(this.ended=!0);D.next_out&&(D.avail_out!==0&&C!==h.Z_STREAM_END&&(D.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(R=d.utf8border(D.output,D.next_out),k=D.next_out-R,V=d.buf2string(D.output,R),D.next_out=k,D.avail_out=O-k,k&&l.arraySet(D.output,D.output,R,k,0),this.onData(V)):this.onData(l.shrinkBuf(D.output,D.next_out)))),D.avail_in===0&&D.avail_out===0&&(U=!0)}while((0<D.avail_in||D.avail_out===0)&&C!==h.Z_STREAM_END);return C===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(C=o.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(D.avail_out=0))},_.prototype.onData=function(x){this.chunks.push(x)},_.prototype.onEnd=function(x){x===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},i.Inflate=_,i.inflate=w,i.inflateRaw=function(x,S){return(S=S||{}).raw=!0,w(x,S)},i.ungzip=w},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(h){for(var f=Array.prototype.slice.call(arguments,1);f.length;){var p=f.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},i.shrinkBuf=function(h,f){return h.length===f?h:h.subarray?h.subarray(0,f):(h.length=f,h)};var l={arraySet:function(h,f,p,g,b){if(f.subarray&&h.subarray)h.set(f.subarray(p,p+g),b);else for(var _=0;_<g;_++)h[b+_]=f[p+_]},flattenChunks:function(h){var f,p,g,b,_,w;for(f=g=0,p=h.length;f<p;f++)g+=h[f].length;for(w=new Uint8Array(g),f=b=0,p=h.length;f<p;f++)_=h[f],w.set(_,b),b+=_.length;return w}},d={arraySet:function(h,f,p,g,b){for(var _=0;_<g;_++)h[b+_]=f[p+_]},flattenChunks:function(h){return[].concat.apply([],h)}};i.setTyped=function(h){h?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,l)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,d))},i.setTyped(o)},{}],42:[function(n,r,i){var o=n("./common"),l=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var h=new o.Buf8(256),f=0;f<256;f++)h[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;function p(g,b){if(b<65537&&(g.subarray&&d||!g.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(g,b));for(var _="",w=0;w<b;w++)_+=String.fromCharCode(g[w]);return _}h[254]=h[254]=1,i.string2buf=function(g){var b,_,w,x,S,C=g.length,T=0;for(x=0;x<C;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(w=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),x++),T+=_<128?1:_<2048?2:_<65536?3:4;for(b=new o.Buf8(T),x=S=0;S<T;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(w=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),x++),_<128?b[S++]=_:(_<2048?b[S++]=192|_>>>6:(_<65536?b[S++]=224|_>>>12:(b[S++]=240|_>>>18,b[S++]=128|_>>>12&63),b[S++]=128|_>>>6&63),b[S++]=128|63&_);return b},i.buf2binstring=function(g){return p(g,g.length)},i.binstring2buf=function(g){for(var b=new o.Buf8(g.length),_=0,w=b.length;_<w;_++)b[_]=g.charCodeAt(_);return b},i.buf2string=function(g,b){var _,w,x,S,C=b||g.length,T=new Array(2*C);for(_=w=0;_<C;)if((x=g[_++])<128)T[w++]=x;else if(4<(S=h[x]))T[w++]=65533,_+=S-1;else{for(x&=S===2?31:S===3?15:7;1<S&&_<C;)x=x<<6|63&g[_++],S--;1<S?T[w++]=65533:x<65536?T[w++]=x:(x-=65536,T[w++]=55296|x>>10&1023,T[w++]=56320|1023&x)}return p(T,w)},i.utf8border=function(g,b){var _;for((b=b||g.length)>g.length&&(b=g.length),_=b-1;0<=_&&(192&g[_])==128;)_--;return _<0||_===0?b:_+h[g[_]]>b?_:b}},{"./common":41}],43:[function(n,r,i){r.exports=function(o,l,d,h){for(var f=65535&o|0,p=o>>>16&65535|0,g=0;d!==0;){for(d-=g=2e3<d?2e3:d;p=p+(f=f+l[h++]|0)|0,--g;);f%=65521,p%=65521}return f|p<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var o=(function(){for(var l,d=[],h=0;h<256;h++){l=h;for(var f=0;f<8;f++)l=1&l?3988292384^l>>>1:l>>>1;d[h]=l}return d})();r.exports=function(l,d,h,f){var p=o,g=f+h;l^=-1;for(var b=f;b<g;b++)l=l>>>8^p[255&(l^d[b])];return-1^l}},{}],46:[function(n,r,i){var o,l=n("../utils/common"),d=n("./trees"),h=n("./adler32"),f=n("./crc32"),p=n("./messages"),g=0,b=4,_=0,w=-2,x=-1,S=4,C=2,T=8,R=9,k=286,V=30,$=19,D=2*k+1,O=15,N=3,U=258,q=U+N+1,I=42,z=113,M=1,X=2,Y=3,G=4;function Z(L,de){return L.msg=p[de],de}function W(L){return(L<<1)-(4<L?9:0)}function te(L){for(var de=L.length;0<=--de;)L[de]=0}function B(L){var de=L.state,ge=de.pending;ge>L.avail_out&&(ge=L.avail_out),ge!==0&&(l.arraySet(L.output,de.pending_buf,de.pending_out,ge,L.next_out),L.next_out+=ge,de.pending_out+=ge,L.total_out+=ge,L.avail_out-=ge,de.pending-=ge,de.pending===0&&(de.pending_out=0))}function H(L,de){d._tr_flush_block(L,0<=L.block_start?L.block_start:-1,L.strstart-L.block_start,de),L.block_start=L.strstart,B(L.strm)}function ne(L,de){L.pending_buf[L.pending++]=de}function re(L,de){L.pending_buf[L.pending++]=de>>>8&255,L.pending_buf[L.pending++]=255&de}function ce(L,de){var ge,ee,J=L.max_chain_length,ae=L.strstart,Se=L.prev_length,we=L.nice_match,ie=L.strstart>L.w_size-q?L.strstart-(L.w_size-q):0,Re=L.window,Be=L.w_mask,Oe=L.prev,He=L.strstart+U,xt=Re[ae+Se-1],rt=Re[ae+Se];L.prev_length>=L.good_match&&(J>>=2),we>L.lookahead&&(we=L.lookahead);do if(Re[(ge=de)+Se]===rt&&Re[ge+Se-1]===xt&&Re[ge]===Re[ae]&&Re[++ge]===Re[ae+1]){ae+=2,ge++;do;while(Re[++ae]===Re[++ge]&&Re[++ae]===Re[++ge]&&Re[++ae]===Re[++ge]&&Re[++ae]===Re[++ge]&&Re[++ae]===Re[++ge]&&Re[++ae]===Re[++ge]&&Re[++ae]===Re[++ge]&&Re[++ae]===Re[++ge]&&ae<He);if(ee=U-(He-ae),ae=He-U,Se<ee){if(L.match_start=de,we<=(Se=ee))break;xt=Re[ae+Se-1],rt=Re[ae+Se]}}while((de=Oe[de&Be])>ie&&--J!=0);return Se<=L.lookahead?Se:L.lookahead}function _e(L){var de,ge,ee,J,ae,Se,we,ie,Re,Be,Oe=L.w_size;do{if(J=L.window_size-L.lookahead-L.strstart,L.strstart>=Oe+(Oe-q)){for(l.arraySet(L.window,L.window,Oe,Oe,0),L.match_start-=Oe,L.strstart-=Oe,L.block_start-=Oe,de=ge=L.hash_size;ee=L.head[--de],L.head[de]=Oe<=ee?ee-Oe:0,--ge;);for(de=ge=Oe;ee=L.prev[--de],L.prev[de]=Oe<=ee?ee-Oe:0,--ge;);J+=Oe}if(L.strm.avail_in===0)break;if(Se=L.strm,we=L.window,ie=L.strstart+L.lookahead,Re=J,Be=void 0,Be=Se.avail_in,Re<Be&&(Be=Re),ge=Be===0?0:(Se.avail_in-=Be,l.arraySet(we,Se.input,Se.next_in,Be,ie),Se.state.wrap===1?Se.adler=h(Se.adler,we,Be,ie):Se.state.wrap===2&&(Se.adler=f(Se.adler,we,Be,ie)),Se.next_in+=Be,Se.total_in+=Be,Be),L.lookahead+=ge,L.lookahead+L.insert>=N)for(ae=L.strstart-L.insert,L.ins_h=L.window[ae],L.ins_h=(L.ins_h<<L.hash_shift^L.window[ae+1])&L.hash_mask;L.insert&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[ae+N-1])&L.hash_mask,L.prev[ae&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=ae,ae++,L.insert--,!(L.lookahead+L.insert<N)););}while(L.lookahead<q&&L.strm.avail_in!==0)}function Te(L,de){for(var ge,ee;;){if(L.lookahead<q){if(_e(L),L.lookahead<q&&de===g)return M;if(L.lookahead===0)break}if(ge=0,L.lookahead>=N&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,ge=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),ge!==0&&L.strstart-ge<=L.w_size-q&&(L.match_length=ce(L,ge)),L.match_length>=N)if(ee=d._tr_tally(L,L.strstart-L.match_start,L.match_length-N),L.lookahead-=L.match_length,L.match_length<=L.max_lazy_match&&L.lookahead>=N){for(L.match_length--;L.strstart++,L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,ge=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart,--L.match_length!=0;);L.strstart++}else L.strstart+=L.match_length,L.match_length=0,L.ins_h=L.window[L.strstart],L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+1])&L.hash_mask;else ee=d._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++;if(ee&&(H(L,!1),L.strm.avail_out===0))return M}return L.insert=L.strstart<N-1?L.strstart:N-1,de===b?(H(L,!0),L.strm.avail_out===0?Y:G):L.last_lit&&(H(L,!1),L.strm.avail_out===0)?M:X}function oe(L,de){for(var ge,ee,J;;){if(L.lookahead<q){if(_e(L),L.lookahead<q&&de===g)return M;if(L.lookahead===0)break}if(ge=0,L.lookahead>=N&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,ge=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),L.prev_length=L.match_length,L.prev_match=L.match_start,L.match_length=N-1,ge!==0&&L.prev_length<L.max_lazy_match&&L.strstart-ge<=L.w_size-q&&(L.match_length=ce(L,ge),L.match_length<=5&&(L.strategy===1||L.match_length===N&&4096<L.strstart-L.match_start)&&(L.match_length=N-1)),L.prev_length>=N&&L.match_length<=L.prev_length){for(J=L.strstart+L.lookahead-N,ee=d._tr_tally(L,L.strstart-1-L.prev_match,L.prev_length-N),L.lookahead-=L.prev_length-1,L.prev_length-=2;++L.strstart<=J&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+N-1])&L.hash_mask,ge=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),--L.prev_length!=0;);if(L.match_available=0,L.match_length=N-1,L.strstart++,ee&&(H(L,!1),L.strm.avail_out===0))return M}else if(L.match_available){if((ee=d._tr_tally(L,0,L.window[L.strstart-1]))&&H(L,!1),L.strstart++,L.lookahead--,L.strm.avail_out===0)return M}else L.match_available=1,L.strstart++,L.lookahead--}return L.match_available&&(ee=d._tr_tally(L,0,L.window[L.strstart-1]),L.match_available=0),L.insert=L.strstart<N-1?L.strstart:N-1,de===b?(H(L,!0),L.strm.avail_out===0?Y:G):L.last_lit&&(H(L,!1),L.strm.avail_out===0)?M:X}function be(L,de,ge,ee,J){this.good_length=L,this.max_lazy=de,this.nice_length=ge,this.max_chain=ee,this.func=J}function Ne(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*D),this.dyn_dtree=new l.Buf16(2*(2*V+1)),this.bl_tree=new l.Buf16(2*(2*$+1)),te(this.dyn_ltree),te(this.dyn_dtree),te(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(O+1),this.heap=new l.Buf16(2*k+1),te(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*k+1),te(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Me(L){var de;return L&&L.state?(L.total_in=L.total_out=0,L.data_type=C,(de=L.state).pending=0,de.pending_out=0,de.wrap<0&&(de.wrap=-de.wrap),de.status=de.wrap?I:z,L.adler=de.wrap===2?0:1,de.last_flush=g,d._tr_init(de),_):Z(L,w)}function Ge(L){var de=Me(L);return de===_&&(function(ge){ge.window_size=2*ge.w_size,te(ge.head),ge.max_lazy_match=o[ge.level].max_lazy,ge.good_match=o[ge.level].good_length,ge.nice_match=o[ge.level].nice_length,ge.max_chain_length=o[ge.level].max_chain,ge.strstart=0,ge.block_start=0,ge.lookahead=0,ge.insert=0,ge.match_length=ge.prev_length=N-1,ge.match_available=0,ge.ins_h=0})(L.state),de}function at(L,de,ge,ee,J,ae){if(!L)return w;var Se=1;if(de===x&&(de=6),ee<0?(Se=0,ee=-ee):15<ee&&(Se=2,ee-=16),J<1||R<J||ge!==T||ee<8||15<ee||de<0||9<de||ae<0||S<ae)return Z(L,w);ee===8&&(ee=9);var we=new Ne;return(L.state=we).strm=L,we.wrap=Se,we.gzhead=null,we.w_bits=ee,we.w_size=1<<we.w_bits,we.w_mask=we.w_size-1,we.hash_bits=J+7,we.hash_size=1<<we.hash_bits,we.hash_mask=we.hash_size-1,we.hash_shift=~~((we.hash_bits+N-1)/N),we.window=new l.Buf8(2*we.w_size),we.head=new l.Buf16(we.hash_size),we.prev=new l.Buf16(we.w_size),we.lit_bufsize=1<<J+6,we.pending_buf_size=4*we.lit_bufsize,we.pending_buf=new l.Buf8(we.pending_buf_size),we.d_buf=1*we.lit_bufsize,we.l_buf=3*we.lit_bufsize,we.level=de,we.strategy=ae,we.method=ge,Ge(L)}o=[new be(0,0,0,0,function(L,de){var ge=65535;for(ge>L.pending_buf_size-5&&(ge=L.pending_buf_size-5);;){if(L.lookahead<=1){if(_e(L),L.lookahead===0&&de===g)return M;if(L.lookahead===0)break}L.strstart+=L.lookahead,L.lookahead=0;var ee=L.block_start+ge;if((L.strstart===0||L.strstart>=ee)&&(L.lookahead=L.strstart-ee,L.strstart=ee,H(L,!1),L.strm.avail_out===0)||L.strstart-L.block_start>=L.w_size-q&&(H(L,!1),L.strm.avail_out===0))return M}return L.insert=0,de===b?(H(L,!0),L.strm.avail_out===0?Y:G):(L.strstart>L.block_start&&(H(L,!1),L.strm.avail_out),M)}),new be(4,4,8,4,Te),new be(4,5,16,8,Te),new be(4,6,32,32,Te),new be(4,4,16,16,oe),new be(8,16,32,32,oe),new be(8,16,128,128,oe),new be(8,32,128,256,oe),new be(32,128,258,1024,oe),new be(32,258,258,4096,oe)],i.deflateInit=function(L,de){return at(L,de,T,15,8,0)},i.deflateInit2=at,i.deflateReset=Ge,i.deflateResetKeep=Me,i.deflateSetHeader=function(L,de){return L&&L.state?L.state.wrap!==2?w:(L.state.gzhead=de,_):w},i.deflate=function(L,de){var ge,ee,J,ae;if(!L||!L.state||5<de||de<0)return L?Z(L,w):w;if(ee=L.state,!L.output||!L.input&&L.avail_in!==0||ee.status===666&&de!==b)return Z(L,L.avail_out===0?-5:w);if(ee.strm=L,ge=ee.last_flush,ee.last_flush=de,ee.status===I)if(ee.wrap===2)L.adler=0,ne(ee,31),ne(ee,139),ne(ee,8),ee.gzhead?(ne(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),ne(ee,255&ee.gzhead.time),ne(ee,ee.gzhead.time>>8&255),ne(ee,ee.gzhead.time>>16&255),ne(ee,ee.gzhead.time>>24&255),ne(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),ne(ee,255&ee.gzhead.os),ee.gzhead.extra&&ee.gzhead.extra.length&&(ne(ee,255&ee.gzhead.extra.length),ne(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(L.adler=f(L.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=69):(ne(ee,0),ne(ee,0),ne(ee,0),ne(ee,0),ne(ee,0),ne(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),ne(ee,3),ee.status=z);else{var Se=T+(ee.w_bits-8<<4)<<8;Se|=(2<=ee.strategy||ee.level<2?0:ee.level<6?1:ee.level===6?2:3)<<6,ee.strstart!==0&&(Se|=32),Se+=31-Se%31,ee.status=z,re(ee,Se),ee.strstart!==0&&(re(ee,L.adler>>>16),re(ee,65535&L.adler)),L.adler=1}if(ee.status===69)if(ee.gzhead.extra){for(J=ee.pending;ee.gzindex<(65535&ee.gzhead.extra.length)&&(ee.pending!==ee.pending_buf_size||(ee.gzhead.hcrc&&ee.pending>J&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-J,J)),B(L),J=ee.pending,ee.pending!==ee.pending_buf_size));)ne(ee,255&ee.gzhead.extra[ee.gzindex]),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>J&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-J,J)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=73)}else ee.status=73;if(ee.status===73)if(ee.gzhead.name){J=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>J&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-J,J)),B(L),J=ee.pending,ee.pending===ee.pending_buf_size)){ae=1;break}ae=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0,ne(ee,ae)}while(ae!==0);ee.gzhead.hcrc&&ee.pending>J&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-J,J)),ae===0&&(ee.gzindex=0,ee.status=91)}else ee.status=91;if(ee.status===91)if(ee.gzhead.comment){J=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>J&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-J,J)),B(L),J=ee.pending,ee.pending===ee.pending_buf_size)){ae=1;break}ae=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0,ne(ee,ae)}while(ae!==0);ee.gzhead.hcrc&&ee.pending>J&&(L.adler=f(L.adler,ee.pending_buf,ee.pending-J,J)),ae===0&&(ee.status=103)}else ee.status=103;if(ee.status===103&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&B(L),ee.pending+2<=ee.pending_buf_size&&(ne(ee,255&L.adler),ne(ee,L.adler>>8&255),L.adler=0,ee.status=z)):ee.status=z),ee.pending!==0){if(B(L),L.avail_out===0)return ee.last_flush=-1,_}else if(L.avail_in===0&&W(de)<=W(ge)&&de!==b)return Z(L,-5);if(ee.status===666&&L.avail_in!==0)return Z(L,-5);if(L.avail_in!==0||ee.lookahead!==0||de!==g&&ee.status!==666){var we=ee.strategy===2?(function(ie,Re){for(var Be;;){if(ie.lookahead===0&&(_e(ie),ie.lookahead===0)){if(Re===g)return M;break}if(ie.match_length=0,Be=d._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++,Be&&(H(ie,!1),ie.strm.avail_out===0))return M}return ie.insert=0,Re===b?(H(ie,!0),ie.strm.avail_out===0?Y:G):ie.last_lit&&(H(ie,!1),ie.strm.avail_out===0)?M:X})(ee,de):ee.strategy===3?(function(ie,Re){for(var Be,Oe,He,xt,rt=ie.window;;){if(ie.lookahead<=U){if(_e(ie),ie.lookahead<=U&&Re===g)return M;if(ie.lookahead===0)break}if(ie.match_length=0,ie.lookahead>=N&&0<ie.strstart&&(Oe=rt[He=ie.strstart-1])===rt[++He]&&Oe===rt[++He]&&Oe===rt[++He]){xt=ie.strstart+U;do;while(Oe===rt[++He]&&Oe===rt[++He]&&Oe===rt[++He]&&Oe===rt[++He]&&Oe===rt[++He]&&Oe===rt[++He]&&Oe===rt[++He]&&Oe===rt[++He]&&He<xt);ie.match_length=U-(xt-He),ie.match_length>ie.lookahead&&(ie.match_length=ie.lookahead)}if(ie.match_length>=N?(Be=d._tr_tally(ie,1,ie.match_length-N),ie.lookahead-=ie.match_length,ie.strstart+=ie.match_length,ie.match_length=0):(Be=d._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++),Be&&(H(ie,!1),ie.strm.avail_out===0))return M}return ie.insert=0,Re===b?(H(ie,!0),ie.strm.avail_out===0?Y:G):ie.last_lit&&(H(ie,!1),ie.strm.avail_out===0)?M:X})(ee,de):o[ee.level].func(ee,de);if(we!==Y&&we!==G||(ee.status=666),we===M||we===Y)return L.avail_out===0&&(ee.last_flush=-1),_;if(we===X&&(de===1?d._tr_align(ee):de!==5&&(d._tr_stored_block(ee,0,0,!1),de===3&&(te(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),B(L),L.avail_out===0))return ee.last_flush=-1,_}return de!==b?_:ee.wrap<=0?1:(ee.wrap===2?(ne(ee,255&L.adler),ne(ee,L.adler>>8&255),ne(ee,L.adler>>16&255),ne(ee,L.adler>>24&255),ne(ee,255&L.total_in),ne(ee,L.total_in>>8&255),ne(ee,L.total_in>>16&255),ne(ee,L.total_in>>24&255)):(re(ee,L.adler>>>16),re(ee,65535&L.adler)),B(L),0<ee.wrap&&(ee.wrap=-ee.wrap),ee.pending!==0?_:1)},i.deflateEnd=function(L){var de;return L&&L.state?(de=L.state.status)!==I&&de!==69&&de!==73&&de!==91&&de!==103&&de!==z&&de!==666?Z(L,w):(L.state=null,de===z?Z(L,-3):_):w},i.deflateSetDictionary=function(L,de){var ge,ee,J,ae,Se,we,ie,Re,Be=de.length;if(!L||!L.state||(ae=(ge=L.state).wrap)===2||ae===1&&ge.status!==I||ge.lookahead)return w;for(ae===1&&(L.adler=h(L.adler,de,Be,0)),ge.wrap=0,Be>=ge.w_size&&(ae===0&&(te(ge.head),ge.strstart=0,ge.block_start=0,ge.insert=0),Re=new l.Buf8(ge.w_size),l.arraySet(Re,de,Be-ge.w_size,ge.w_size,0),de=Re,Be=ge.w_size),Se=L.avail_in,we=L.next_in,ie=L.input,L.avail_in=Be,L.next_in=0,L.input=de,_e(ge);ge.lookahead>=N;){for(ee=ge.strstart,J=ge.lookahead-(N-1);ge.ins_h=(ge.ins_h<<ge.hash_shift^ge.window[ee+N-1])&ge.hash_mask,ge.prev[ee&ge.w_mask]=ge.head[ge.ins_h],ge.head[ge.ins_h]=ee,ee++,--J;);ge.strstart=ee,ge.lookahead=N-1,_e(ge)}return ge.strstart+=ge.lookahead,ge.block_start=ge.strstart,ge.insert=ge.lookahead,ge.lookahead=0,ge.match_length=ge.prev_length=N-1,ge.match_available=0,L.next_in=we,L.input=ie,L.avail_in=Se,ge.wrap=ae,_},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(o,l){var d,h,f,p,g,b,_,w,x,S,C,T,R,k,V,$,D,O,N,U,q,I,z,M,X;d=o.state,h=o.next_in,M=o.input,f=h+(o.avail_in-5),p=o.next_out,X=o.output,g=p-(l-o.avail_out),b=p+(o.avail_out-257),_=d.dmax,w=d.wsize,x=d.whave,S=d.wnext,C=d.window,T=d.hold,R=d.bits,k=d.lencode,V=d.distcode,$=(1<<d.lenbits)-1,D=(1<<d.distbits)-1;e:do{R<15&&(T+=M[h++]<<R,R+=8,T+=M[h++]<<R,R+=8),O=k[T&$];t:for(;;){if(T>>>=N=O>>>24,R-=N,(N=O>>>16&255)===0)X[p++]=65535&O;else{if(!(16&N)){if((64&N)==0){O=k[(65535&O)+(T&(1<<N)-1)];continue t}if(32&N){d.mode=12;break e}o.msg="invalid literal/length code",d.mode=30;break e}U=65535&O,(N&=15)&&(R<N&&(T+=M[h++]<<R,R+=8),U+=T&(1<<N)-1,T>>>=N,R-=N),R<15&&(T+=M[h++]<<R,R+=8,T+=M[h++]<<R,R+=8),O=V[T&D];n:for(;;){if(T>>>=N=O>>>24,R-=N,!(16&(N=O>>>16&255))){if((64&N)==0){O=V[(65535&O)+(T&(1<<N)-1)];continue n}o.msg="invalid distance code",d.mode=30;break e}if(q=65535&O,R<(N&=15)&&(T+=M[h++]<<R,(R+=8)<N&&(T+=M[h++]<<R,R+=8)),_<(q+=T&(1<<N)-1)){o.msg="invalid distance too far back",d.mode=30;break e}if(T>>>=N,R-=N,(N=p-g)<q){if(x<(N=q-N)&&d.sane){o.msg="invalid distance too far back",d.mode=30;break e}if(z=C,(I=0)===S){if(I+=w-N,N<U){for(U-=N;X[p++]=C[I++],--N;);I=p-q,z=X}}else if(S<N){if(I+=w+S-N,(N-=S)<U){for(U-=N;X[p++]=C[I++],--N;);if(I=0,S<U){for(U-=N=S;X[p++]=C[I++],--N;);I=p-q,z=X}}}else if(I+=S-N,N<U){for(U-=N;X[p++]=C[I++],--N;);I=p-q,z=X}for(;2<U;)X[p++]=z[I++],X[p++]=z[I++],X[p++]=z[I++],U-=3;U&&(X[p++]=z[I++],1<U&&(X[p++]=z[I++]))}else{for(I=p-q;X[p++]=X[I++],X[p++]=X[I++],X[p++]=X[I++],2<(U-=3););U&&(X[p++]=X[I++],1<U&&(X[p++]=X[I++]))}break}}break}}while(h<f&&p<b);h-=U=R>>3,T&=(1<<(R-=U<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<f?f-h+5:5-(h-f),o.avail_out=p<b?b-p+257:257-(p-b),d.hold=T,d.bits=R}},{}],49:[function(n,r,i){var o=n("../utils/common"),l=n("./adler32"),d=n("./crc32"),h=n("./inffast"),f=n("./inftrees"),p=1,g=2,b=0,_=-2,w=1,x=852,S=592;function C(I){return(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function R(I){var z;return I&&I.state?(z=I.state,I.total_in=I.total_out=z.total=0,I.msg="",z.wrap&&(I.adler=1&z.wrap),z.mode=w,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new o.Buf32(x),z.distcode=z.distdyn=new o.Buf32(S),z.sane=1,z.back=-1,b):_}function k(I){var z;return I&&I.state?((z=I.state).wsize=0,z.whave=0,z.wnext=0,R(I)):_}function V(I,z){var M,X;return I&&I.state?(X=I.state,z<0?(M=0,z=-z):(M=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?_:(X.window!==null&&X.wbits!==z&&(X.window=null),X.wrap=M,X.wbits=z,k(I))):_}function $(I,z){var M,X;return I?(X=new T,(I.state=X).window=null,(M=V(I,z))!==b&&(I.state=null),M):_}var D,O,N=!0;function U(I){if(N){var z;for(D=new o.Buf32(512),O=new o.Buf32(32),z=0;z<144;)I.lens[z++]=8;for(;z<256;)I.lens[z++]=9;for(;z<280;)I.lens[z++]=7;for(;z<288;)I.lens[z++]=8;for(f(p,I.lens,0,288,D,0,I.work,{bits:9}),z=0;z<32;)I.lens[z++]=5;f(g,I.lens,0,32,O,0,I.work,{bits:5}),N=!1}I.lencode=D,I.lenbits=9,I.distcode=O,I.distbits=5}function q(I,z,M,X){var Y,G=I.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new o.Buf8(G.wsize)),X>=G.wsize?(o.arraySet(G.window,z,M-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(X<(Y=G.wsize-G.wnext)&&(Y=X),o.arraySet(G.window,z,M-X,Y,G.wnext),(X-=Y)?(o.arraySet(G.window,z,M-X,X,0),G.wnext=X,G.whave=G.wsize):(G.wnext+=Y,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=Y))),0}i.inflateReset=k,i.inflateReset2=V,i.inflateResetKeep=R,i.inflateInit=function(I){return $(I,15)},i.inflateInit2=$,i.inflate=function(I,z){var M,X,Y,G,Z,W,te,B,H,ne,re,ce,_e,Te,oe,be,Ne,Me,Ge,at,L,de,ge,ee,J=0,ae=new o.Buf8(4),Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!I||!I.state||!I.output||!I.input&&I.avail_in!==0)return _;(M=I.state).mode===12&&(M.mode=13),Z=I.next_out,Y=I.output,te=I.avail_out,G=I.next_in,X=I.input,W=I.avail_in,B=M.hold,H=M.bits,ne=W,re=te,de=b;e:for(;;)switch(M.mode){case w:if(M.wrap===0){M.mode=13;break}for(;H<16;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}if(2&M.wrap&&B===35615){ae[M.check=0]=255&B,ae[1]=B>>>8&255,M.check=d(M.check,ae,2,0),H=B=0,M.mode=2;break}if(M.flags=0,M.head&&(M.head.done=!1),!(1&M.wrap)||(((255&B)<<8)+(B>>8))%31){I.msg="incorrect header check",M.mode=30;break}if((15&B)!=8){I.msg="unknown compression method",M.mode=30;break}if(H-=4,L=8+(15&(B>>>=4)),M.wbits===0)M.wbits=L;else if(L>M.wbits){I.msg="invalid window size",M.mode=30;break}M.dmax=1<<L,I.adler=M.check=1,M.mode=512&B?10:12,H=B=0;break;case 2:for(;H<16;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}if(M.flags=B,(255&M.flags)!=8){I.msg="unknown compression method",M.mode=30;break}if(57344&M.flags){I.msg="unknown header flags set",M.mode=30;break}M.head&&(M.head.text=B>>8&1),512&M.flags&&(ae[0]=255&B,ae[1]=B>>>8&255,M.check=d(M.check,ae,2,0)),H=B=0,M.mode=3;case 3:for(;H<32;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}M.head&&(M.head.time=B),512&M.flags&&(ae[0]=255&B,ae[1]=B>>>8&255,ae[2]=B>>>16&255,ae[3]=B>>>24&255,M.check=d(M.check,ae,4,0)),H=B=0,M.mode=4;case 4:for(;H<16;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}M.head&&(M.head.xflags=255&B,M.head.os=B>>8),512&M.flags&&(ae[0]=255&B,ae[1]=B>>>8&255,M.check=d(M.check,ae,2,0)),H=B=0,M.mode=5;case 5:if(1024&M.flags){for(;H<16;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}M.length=B,M.head&&(M.head.extra_len=B),512&M.flags&&(ae[0]=255&B,ae[1]=B>>>8&255,M.check=d(M.check,ae,2,0)),H=B=0}else M.head&&(M.head.extra=null);M.mode=6;case 6:if(1024&M.flags&&(W<(ce=M.length)&&(ce=W),ce&&(M.head&&(L=M.head.extra_len-M.length,M.head.extra||(M.head.extra=new Array(M.head.extra_len)),o.arraySet(M.head.extra,X,G,ce,L)),512&M.flags&&(M.check=d(M.check,X,ce,G)),W-=ce,G+=ce,M.length-=ce),M.length))break e;M.length=0,M.mode=7;case 7:if(2048&M.flags){if(W===0)break e;for(ce=0;L=X[G+ce++],M.head&&L&&M.length<65536&&(M.head.name+=String.fromCharCode(L)),L&&ce<W;);if(512&M.flags&&(M.check=d(M.check,X,ce,G)),W-=ce,G+=ce,L)break e}else M.head&&(M.head.name=null);M.length=0,M.mode=8;case 8:if(4096&M.flags){if(W===0)break e;for(ce=0;L=X[G+ce++],M.head&&L&&M.length<65536&&(M.head.comment+=String.fromCharCode(L)),L&&ce<W;);if(512&M.flags&&(M.check=d(M.check,X,ce,G)),W-=ce,G+=ce,L)break e}else M.head&&(M.head.comment=null);M.mode=9;case 9:if(512&M.flags){for(;H<16;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}if(B!==(65535&M.check)){I.msg="header crc mismatch",M.mode=30;break}H=B=0}M.head&&(M.head.hcrc=M.flags>>9&1,M.head.done=!0),I.adler=M.check=0,M.mode=12;break;case 10:for(;H<32;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}I.adler=M.check=C(B),H=B=0,M.mode=11;case 11:if(M.havedict===0)return I.next_out=Z,I.avail_out=te,I.next_in=G,I.avail_in=W,M.hold=B,M.bits=H,2;I.adler=M.check=1,M.mode=12;case 12:if(z===5||z===6)break e;case 13:if(M.last){B>>>=7&H,H-=7&H,M.mode=27;break}for(;H<3;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}switch(M.last=1&B,H-=1,3&(B>>>=1)){case 0:M.mode=14;break;case 1:if(U(M),M.mode=20,z!==6)break;B>>>=2,H-=2;break e;case 2:M.mode=17;break;case 3:I.msg="invalid block type",M.mode=30}B>>>=2,H-=2;break;case 14:for(B>>>=7&H,H-=7&H;H<32;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}if((65535&B)!=(B>>>16^65535)){I.msg="invalid stored block lengths",M.mode=30;break}if(M.length=65535&B,H=B=0,M.mode=15,z===6)break e;case 15:M.mode=16;case 16:if(ce=M.length){if(W<ce&&(ce=W),te<ce&&(ce=te),ce===0)break e;o.arraySet(Y,X,G,ce,Z),W-=ce,G+=ce,te-=ce,Z+=ce,M.length-=ce;break}M.mode=12;break;case 17:for(;H<14;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}if(M.nlen=257+(31&B),B>>>=5,H-=5,M.ndist=1+(31&B),B>>>=5,H-=5,M.ncode=4+(15&B),B>>>=4,H-=4,286<M.nlen||30<M.ndist){I.msg="too many length or distance symbols",M.mode=30;break}M.have=0,M.mode=18;case 18:for(;M.have<M.ncode;){for(;H<3;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}M.lens[Se[M.have++]]=7&B,B>>>=3,H-=3}for(;M.have<19;)M.lens[Se[M.have++]]=0;if(M.lencode=M.lendyn,M.lenbits=7,ge={bits:M.lenbits},de=f(0,M.lens,0,19,M.lencode,0,M.work,ge),M.lenbits=ge.bits,de){I.msg="invalid code lengths set",M.mode=30;break}M.have=0,M.mode=19;case 19:for(;M.have<M.nlen+M.ndist;){for(;be=(J=M.lencode[B&(1<<M.lenbits)-1])>>>16&255,Ne=65535&J,!((oe=J>>>24)<=H);){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}if(Ne<16)B>>>=oe,H-=oe,M.lens[M.have++]=Ne;else{if(Ne===16){for(ee=oe+2;H<ee;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}if(B>>>=oe,H-=oe,M.have===0){I.msg="invalid bit length repeat",M.mode=30;break}L=M.lens[M.have-1],ce=3+(3&B),B>>>=2,H-=2}else if(Ne===17){for(ee=oe+3;H<ee;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}H-=oe,L=0,ce=3+(7&(B>>>=oe)),B>>>=3,H-=3}else{for(ee=oe+7;H<ee;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}H-=oe,L=0,ce=11+(127&(B>>>=oe)),B>>>=7,H-=7}if(M.have+ce>M.nlen+M.ndist){I.msg="invalid bit length repeat",M.mode=30;break}for(;ce--;)M.lens[M.have++]=L}}if(M.mode===30)break;if(M.lens[256]===0){I.msg="invalid code -- missing end-of-block",M.mode=30;break}if(M.lenbits=9,ge={bits:M.lenbits},de=f(p,M.lens,0,M.nlen,M.lencode,0,M.work,ge),M.lenbits=ge.bits,de){I.msg="invalid literal/lengths set",M.mode=30;break}if(M.distbits=6,M.distcode=M.distdyn,ge={bits:M.distbits},de=f(g,M.lens,M.nlen,M.ndist,M.distcode,0,M.work,ge),M.distbits=ge.bits,de){I.msg="invalid distances set",M.mode=30;break}if(M.mode=20,z===6)break e;case 20:M.mode=21;case 21:if(6<=W&&258<=te){I.next_out=Z,I.avail_out=te,I.next_in=G,I.avail_in=W,M.hold=B,M.bits=H,h(I,re),Z=I.next_out,Y=I.output,te=I.avail_out,G=I.next_in,X=I.input,W=I.avail_in,B=M.hold,H=M.bits,M.mode===12&&(M.back=-1);break}for(M.back=0;be=(J=M.lencode[B&(1<<M.lenbits)-1])>>>16&255,Ne=65535&J,!((oe=J>>>24)<=H);){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}if(be&&(240&be)==0){for(Me=oe,Ge=be,at=Ne;be=(J=M.lencode[at+((B&(1<<Me+Ge)-1)>>Me)])>>>16&255,Ne=65535&J,!(Me+(oe=J>>>24)<=H);){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}B>>>=Me,H-=Me,M.back+=Me}if(B>>>=oe,H-=oe,M.back+=oe,M.length=Ne,be===0){M.mode=26;break}if(32&be){M.back=-1,M.mode=12;break}if(64&be){I.msg="invalid literal/length code",M.mode=30;break}M.extra=15&be,M.mode=22;case 22:if(M.extra){for(ee=M.extra;H<ee;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}M.length+=B&(1<<M.extra)-1,B>>>=M.extra,H-=M.extra,M.back+=M.extra}M.was=M.length,M.mode=23;case 23:for(;be=(J=M.distcode[B&(1<<M.distbits)-1])>>>16&255,Ne=65535&J,!((oe=J>>>24)<=H);){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}if((240&be)==0){for(Me=oe,Ge=be,at=Ne;be=(J=M.distcode[at+((B&(1<<Me+Ge)-1)>>Me)])>>>16&255,Ne=65535&J,!(Me+(oe=J>>>24)<=H);){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}B>>>=Me,H-=Me,M.back+=Me}if(B>>>=oe,H-=oe,M.back+=oe,64&be){I.msg="invalid distance code",M.mode=30;break}M.offset=Ne,M.extra=15&be,M.mode=24;case 24:if(M.extra){for(ee=M.extra;H<ee;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}M.offset+=B&(1<<M.extra)-1,B>>>=M.extra,H-=M.extra,M.back+=M.extra}if(M.offset>M.dmax){I.msg="invalid distance too far back",M.mode=30;break}M.mode=25;case 25:if(te===0)break e;if(ce=re-te,M.offset>ce){if((ce=M.offset-ce)>M.whave&&M.sane){I.msg="invalid distance too far back",M.mode=30;break}_e=ce>M.wnext?(ce-=M.wnext,M.wsize-ce):M.wnext-ce,ce>M.length&&(ce=M.length),Te=M.window}else Te=Y,_e=Z-M.offset,ce=M.length;for(te<ce&&(ce=te),te-=ce,M.length-=ce;Y[Z++]=Te[_e++],--ce;);M.length===0&&(M.mode=21);break;case 26:if(te===0)break e;Y[Z++]=M.length,te--,M.mode=21;break;case 27:if(M.wrap){for(;H<32;){if(W===0)break e;W--,B|=X[G++]<<H,H+=8}if(re-=te,I.total_out+=re,M.total+=re,re&&(I.adler=M.check=M.flags?d(M.check,Y,re,Z-re):l(M.check,Y,re,Z-re)),re=te,(M.flags?B:C(B))!==M.check){I.msg="incorrect data check",M.mode=30;break}H=B=0}M.mode=28;case 28:if(M.wrap&&M.flags){for(;H<32;){if(W===0)break e;W--,B+=X[G++]<<H,H+=8}if(B!==(4294967295&M.total)){I.msg="incorrect length check",M.mode=30;break}H=B=0}M.mode=29;case 29:de=1;break e;case 30:de=-3;break e;case 31:return-4;default:return _}return I.next_out=Z,I.avail_out=te,I.next_in=G,I.avail_in=W,M.hold=B,M.bits=H,(M.wsize||re!==I.avail_out&&M.mode<30&&(M.mode<27||z!==4))&&q(I,I.output,I.next_out,re-I.avail_out)?(M.mode=31,-4):(ne-=I.avail_in,re-=I.avail_out,I.total_in+=ne,I.total_out+=re,M.total+=re,M.wrap&&re&&(I.adler=M.check=M.flags?d(M.check,Y,re,I.next_out-re):l(M.check,Y,re,I.next_out-re)),I.data_type=M.bits+(M.last?64:0)+(M.mode===12?128:0)+(M.mode===20||M.mode===15?256:0),(ne==0&&re===0||z===4)&&de===b&&(de=-5),de)},i.inflateEnd=function(I){if(!I||!I.state)return _;var z=I.state;return z.window&&(z.window=null),I.state=null,b},i.inflateGetHeader=function(I,z){var M;return I&&I.state?(2&(M=I.state).wrap)==0?_:((M.head=z).done=!1,b):_},i.inflateSetDictionary=function(I,z){var M,X=z.length;return I&&I.state?(M=I.state).wrap!==0&&M.mode!==11?_:M.mode===11&&l(1,z,X,0)!==M.check?-3:q(I,z,X,X)?(M.mode=31,-4):(M.havedict=1,b):_},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var o=n("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,b,_,w,x,S,C){var T,R,k,V,$,D,O,N,U,q=C.bits,I=0,z=0,M=0,X=0,Y=0,G=0,Z=0,W=0,te=0,B=0,H=null,ne=0,re=new o.Buf16(16),ce=new o.Buf16(16),_e=null,Te=0;for(I=0;I<=15;I++)re[I]=0;for(z=0;z<_;z++)re[g[b+z]]++;for(Y=q,X=15;1<=X&&re[X]===0;X--);if(X<Y&&(Y=X),X===0)return w[x++]=20971520,w[x++]=20971520,C.bits=1,0;for(M=1;M<X&&re[M]===0;M++);for(Y<M&&(Y=M),I=W=1;I<=15;I++)if(W<<=1,(W-=re[I])<0)return-1;if(0<W&&(p===0||X!==1))return-1;for(ce[1]=0,I=1;I<15;I++)ce[I+1]=ce[I]+re[I];for(z=0;z<_;z++)g[b+z]!==0&&(S[ce[g[b+z]]++]=z);if(D=p===0?(H=_e=S,19):p===1?(H=l,ne-=257,_e=d,Te-=257,256):(H=h,_e=f,-1),I=M,$=x,Z=z=B=0,k=-1,V=(te=1<<(G=Y))-1,p===1&&852<te||p===2&&592<te)return 1;for(;;){for(O=I-Z,U=S[z]<D?(N=0,S[z]):S[z]>D?(N=_e[Te+S[z]],H[ne+S[z]]):(N=96,0),T=1<<I-Z,M=R=1<<G;w[$+(B>>Z)+(R-=T)]=O<<24|N<<16|U|0,R!==0;);for(T=1<<I-1;B&T;)T>>=1;if(T!==0?(B&=T-1,B+=T):B=0,z++,--re[I]==0){if(I===X)break;I=g[b+S[z]]}if(Y<I&&(B&V)!==k){for(Z===0&&(Z=Y),$+=M,W=1<<(G=I-Z);G+Z<X&&!((W-=re[G+Z])<=0);)G++,W<<=1;if(te+=1<<G,p===1&&852<te||p===2&&592<te)return 1;w[k=B&V]=Y<<24|G<<16|$-x|0}}return B!==0&&(w[$+B]=I-Z<<24|64<<16|0),C.bits=Y,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var o=n("../utils/common"),l=0,d=1;function h(J){for(var ae=J.length;0<=--ae;)J[ae]=0}var f=0,p=29,g=256,b=g+1+p,_=30,w=19,x=2*b+1,S=15,C=16,T=7,R=256,k=16,V=17,$=18,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],O=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(b+2));h(q);var I=new Array(2*_);h(I);var z=new Array(512);h(z);var M=new Array(256);h(M);var X=new Array(p);h(X);var Y,G,Z,W=new Array(_);function te(J,ae,Se,we,ie){this.static_tree=J,this.extra_bits=ae,this.extra_base=Se,this.elems=we,this.max_length=ie,this.has_stree=J&&J.length}function B(J,ae){this.dyn_tree=J,this.max_code=0,this.stat_desc=ae}function H(J){return J<256?z[J]:z[256+(J>>>7)]}function ne(J,ae){J.pending_buf[J.pending++]=255&ae,J.pending_buf[J.pending++]=ae>>>8&255}function re(J,ae,Se){J.bi_valid>C-Se?(J.bi_buf|=ae<<J.bi_valid&65535,ne(J,J.bi_buf),J.bi_buf=ae>>C-J.bi_valid,J.bi_valid+=Se-C):(J.bi_buf|=ae<<J.bi_valid&65535,J.bi_valid+=Se)}function ce(J,ae,Se){re(J,Se[2*ae],Se[2*ae+1])}function _e(J,ae){for(var Se=0;Se|=1&J,J>>>=1,Se<<=1,0<--ae;);return Se>>>1}function Te(J,ae,Se){var we,ie,Re=new Array(S+1),Be=0;for(we=1;we<=S;we++)Re[we]=Be=Be+Se[we-1]<<1;for(ie=0;ie<=ae;ie++){var Oe=J[2*ie+1];Oe!==0&&(J[2*ie]=_e(Re[Oe]++,Oe))}}function oe(J){var ae;for(ae=0;ae<b;ae++)J.dyn_ltree[2*ae]=0;for(ae=0;ae<_;ae++)J.dyn_dtree[2*ae]=0;for(ae=0;ae<w;ae++)J.bl_tree[2*ae]=0;J.dyn_ltree[2*R]=1,J.opt_len=J.static_len=0,J.last_lit=J.matches=0}function be(J){8<J.bi_valid?ne(J,J.bi_buf):0<J.bi_valid&&(J.pending_buf[J.pending++]=J.bi_buf),J.bi_buf=0,J.bi_valid=0}function Ne(J,ae,Se,we){var ie=2*ae,Re=2*Se;return J[ie]<J[Re]||J[ie]===J[Re]&&we[ae]<=we[Se]}function Me(J,ae,Se){for(var we=J.heap[Se],ie=Se<<1;ie<=J.heap_len&&(ie<J.heap_len&&Ne(ae,J.heap[ie+1],J.heap[ie],J.depth)&&ie++,!Ne(ae,we,J.heap[ie],J.depth));)J.heap[Se]=J.heap[ie],Se=ie,ie<<=1;J.heap[Se]=we}function Ge(J,ae,Se){var we,ie,Re,Be,Oe=0;if(J.last_lit!==0)for(;we=J.pending_buf[J.d_buf+2*Oe]<<8|J.pending_buf[J.d_buf+2*Oe+1],ie=J.pending_buf[J.l_buf+Oe],Oe++,we===0?ce(J,ie,ae):(ce(J,(Re=M[ie])+g+1,ae),(Be=D[Re])!==0&&re(J,ie-=X[Re],Be),ce(J,Re=H(--we),Se),(Be=O[Re])!==0&&re(J,we-=W[Re],Be)),Oe<J.last_lit;);ce(J,R,ae)}function at(J,ae){var Se,we,ie,Re=ae.dyn_tree,Be=ae.stat_desc.static_tree,Oe=ae.stat_desc.has_stree,He=ae.stat_desc.elems,xt=-1;for(J.heap_len=0,J.heap_max=x,Se=0;Se<He;Se++)Re[2*Se]!==0?(J.heap[++J.heap_len]=xt=Se,J.depth[Se]=0):Re[2*Se+1]=0;for(;J.heap_len<2;)Re[2*(ie=J.heap[++J.heap_len]=xt<2?++xt:0)]=1,J.depth[ie]=0,J.opt_len--,Oe&&(J.static_len-=Be[2*ie+1]);for(ae.max_code=xt,Se=J.heap_len>>1;1<=Se;Se--)Me(J,Re,Se);for(ie=He;Se=J.heap[1],J.heap[1]=J.heap[J.heap_len--],Me(J,Re,1),we=J.heap[1],J.heap[--J.heap_max]=Se,J.heap[--J.heap_max]=we,Re[2*ie]=Re[2*Se]+Re[2*we],J.depth[ie]=(J.depth[Se]>=J.depth[we]?J.depth[Se]:J.depth[we])+1,Re[2*Se+1]=Re[2*we+1]=ie,J.heap[1]=ie++,Me(J,Re,1),2<=J.heap_len;);J.heap[--J.heap_max]=J.heap[1],(function(rt,Wn){var gs,sr,ys,vt,nn,Qn,Et=Wn.dyn_tree,Ka=Wn.max_code,Ni=Wn.stat_desc.static_tree,Qo=Wn.stat_desc.has_stree,Or=Wn.stat_desc.extra_bits,_s=Wn.stat_desc.extra_base,Ft=Wn.stat_desc.max_length,ir=0;for(vt=0;vt<=S;vt++)rt.bl_count[vt]=0;for(Et[2*rt.heap[rt.heap_max]+1]=0,gs=rt.heap_max+1;gs<x;gs++)Ft<(vt=Et[2*Et[2*(sr=rt.heap[gs])+1]+1]+1)&&(vt=Ft,ir++),Et[2*sr+1]=vt,Ka<sr||(rt.bl_count[vt]++,nn=0,_s<=sr&&(nn=Or[sr-_s]),Qn=Et[2*sr],rt.opt_len+=Qn*(vt+nn),Qo&&(rt.static_len+=Qn*(Ni[2*sr+1]+nn)));if(ir!==0){do{for(vt=Ft-1;rt.bl_count[vt]===0;)vt--;rt.bl_count[vt]--,rt.bl_count[vt+1]+=2,rt.bl_count[Ft]--,ir-=2}while(0<ir);for(vt=Ft;vt!==0;vt--)for(sr=rt.bl_count[vt];sr!==0;)Ka<(ys=rt.heap[--gs])||(Et[2*ys+1]!==vt&&(rt.opt_len+=(vt-Et[2*ys+1])*Et[2*ys],Et[2*ys+1]=vt),sr--)}})(J,ae),Te(Re,xt,J.bl_count)}function L(J,ae,Se){var we,ie,Re=-1,Be=ae[1],Oe=0,He=7,xt=4;for(Be===0&&(He=138,xt=3),ae[2*(Se+1)+1]=65535,we=0;we<=Se;we++)ie=Be,Be=ae[2*(we+1)+1],++Oe<He&&ie===Be||(Oe<xt?J.bl_tree[2*ie]+=Oe:ie!==0?(ie!==Re&&J.bl_tree[2*ie]++,J.bl_tree[2*k]++):Oe<=10?J.bl_tree[2*V]++:J.bl_tree[2*$]++,Re=ie,xt=(Oe=0)===Be?(He=138,3):ie===Be?(He=6,3):(He=7,4))}function de(J,ae,Se){var we,ie,Re=-1,Be=ae[1],Oe=0,He=7,xt=4;for(Be===0&&(He=138,xt=3),we=0;we<=Se;we++)if(ie=Be,Be=ae[2*(we+1)+1],!(++Oe<He&&ie===Be)){if(Oe<xt)for(;ce(J,ie,J.bl_tree),--Oe!=0;);else ie!==0?(ie!==Re&&(ce(J,ie,J.bl_tree),Oe--),ce(J,k,J.bl_tree),re(J,Oe-3,2)):Oe<=10?(ce(J,V,J.bl_tree),re(J,Oe-3,3)):(ce(J,$,J.bl_tree),re(J,Oe-11,7));Re=ie,xt=(Oe=0)===Be?(He=138,3):ie===Be?(He=6,3):(He=7,4)}}h(W);var ge=!1;function ee(J,ae,Se,we){re(J,(f<<1)+(we?1:0),3),(function(ie,Re,Be,Oe){be(ie),ne(ie,Be),ne(ie,~Be),o.arraySet(ie.pending_buf,ie.window,Re,Be,ie.pending),ie.pending+=Be})(J,ae,Se)}i._tr_init=function(J){ge||((function(){var ae,Se,we,ie,Re,Be=new Array(S+1);for(ie=we=0;ie<p-1;ie++)for(X[ie]=we,ae=0;ae<1<<D[ie];ae++)M[we++]=ie;for(M[we-1]=ie,ie=Re=0;ie<16;ie++)for(W[ie]=Re,ae=0;ae<1<<O[ie];ae++)z[Re++]=ie;for(Re>>=7;ie<_;ie++)for(W[ie]=Re<<7,ae=0;ae<1<<O[ie]-7;ae++)z[256+Re++]=ie;for(Se=0;Se<=S;Se++)Be[Se]=0;for(ae=0;ae<=143;)q[2*ae+1]=8,ae++,Be[8]++;for(;ae<=255;)q[2*ae+1]=9,ae++,Be[9]++;for(;ae<=279;)q[2*ae+1]=7,ae++,Be[7]++;for(;ae<=287;)q[2*ae+1]=8,ae++,Be[8]++;for(Te(q,b+1,Be),ae=0;ae<_;ae++)I[2*ae+1]=5,I[2*ae]=_e(ae,5);Y=new te(q,D,g+1,b,S),G=new te(I,O,0,_,S),Z=new te(new Array(0),N,0,w,T)})(),ge=!0),J.l_desc=new B(J.dyn_ltree,Y),J.d_desc=new B(J.dyn_dtree,G),J.bl_desc=new B(J.bl_tree,Z),J.bi_buf=0,J.bi_valid=0,oe(J)},i._tr_stored_block=ee,i._tr_flush_block=function(J,ae,Se,we){var ie,Re,Be=0;0<J.level?(J.strm.data_type===2&&(J.strm.data_type=(function(Oe){var He,xt=4093624447;for(He=0;He<=31;He++,xt>>>=1)if(1&xt&&Oe.dyn_ltree[2*He]!==0)return l;if(Oe.dyn_ltree[18]!==0||Oe.dyn_ltree[20]!==0||Oe.dyn_ltree[26]!==0)return d;for(He=32;He<g;He++)if(Oe.dyn_ltree[2*He]!==0)return d;return l})(J)),at(J,J.l_desc),at(J,J.d_desc),Be=(function(Oe){var He;for(L(Oe,Oe.dyn_ltree,Oe.l_desc.max_code),L(Oe,Oe.dyn_dtree,Oe.d_desc.max_code),at(Oe,Oe.bl_desc),He=w-1;3<=He&&Oe.bl_tree[2*U[He]+1]===0;He--);return Oe.opt_len+=3*(He+1)+5+5+4,He})(J),ie=J.opt_len+3+7>>>3,(Re=J.static_len+3+7>>>3)<=ie&&(ie=Re)):ie=Re=Se+5,Se+4<=ie&&ae!==-1?ee(J,ae,Se,we):J.strategy===4||Re===ie?(re(J,2+(we?1:0),3),Ge(J,q,I)):(re(J,4+(we?1:0),3),(function(Oe,He,xt,rt){var Wn;for(re(Oe,He-257,5),re(Oe,xt-1,5),re(Oe,rt-4,4),Wn=0;Wn<rt;Wn++)re(Oe,Oe.bl_tree[2*U[Wn]+1],3);de(Oe,Oe.dyn_ltree,He-1),de(Oe,Oe.dyn_dtree,xt-1)})(J,J.l_desc.max_code+1,J.d_desc.max_code+1,Be+1),Ge(J,J.dyn_ltree,J.dyn_dtree)),oe(J),we&&be(J)},i._tr_tally=function(J,ae,Se){return J.pending_buf[J.d_buf+2*J.last_lit]=ae>>>8&255,J.pending_buf[J.d_buf+2*J.last_lit+1]=255&ae,J.pending_buf[J.l_buf+J.last_lit]=255&Se,J.last_lit++,ae===0?J.dyn_ltree[2*Se]++:(J.matches++,ae--,J.dyn_ltree[2*(M[Se]+g+1)]++,J.dyn_dtree[2*H(ae)]++),J.last_lit===J.lit_bufsize-1},i._tr_align=function(J){re(J,2,3),ce(J,R,q),(function(ae){ae.bi_valid===16?(ne(ae,ae.bi_buf),ae.bi_buf=0,ae.bi_valid=0):8<=ae.bi_valid&&(ae.pending_buf[ae.pending++]=255&ae.bi_buf,ae.bi_buf>>=8,ae.bi_valid-=8)})(J)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(o){(function(l,d){if(!l.setImmediate){var h,f,p,g,b=1,_={},w=!1,x=l.document,S=Object.getPrototypeOf&&Object.getPrototypeOf(l);S=S&&S.setTimeout?S:l,h={}.toString.call(l.process)==="[object process]"?function(k){process.nextTick(function(){T(k)})}:(function(){if(l.postMessage&&!l.importScripts){var k=!0,V=l.onmessage;return l.onmessage=function(){k=!1},l.postMessage("","*"),l.onmessage=V,k}})()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",R,!1):l.attachEvent("onmessage",R),function(k){l.postMessage(g+k,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(k){T(k.data)},function(k){p.port2.postMessage(k)}):x&&"onreadystatechange"in x.createElement("script")?(f=x.documentElement,function(k){var V=x.createElement("script");V.onreadystatechange=function(){T(k),V.onreadystatechange=null,f.removeChild(V),V=null},f.appendChild(V)}):function(k){setTimeout(T,0,k)},S.setImmediate=function(k){typeof k!="function"&&(k=new Function(""+k));for(var V=new Array(arguments.length-1),$=0;$<V.length;$++)V[$]=arguments[$+1];var D={callback:k,args:V};return _[b]=D,h(b),b++},S.clearImmediate=C}function C(k){delete _[k]}function T(k){if(w)setTimeout(T,0,k);else{var V=_[k];if(V){w=!0;try{(function($){var D=$.callback,O=$.args;switch(O.length){case 0:D();break;case 1:D(O[0]);break;case 2:D(O[0],O[1]);break;case 3:D(O[0],O[1],O[2]);break;default:D.apply(d,O)}})(V)}finally{C(k),w=!1}}}}function R(k){k.source===l&&typeof k.data=="string"&&k.data.indexOf(g)===0&&T(+k.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Hh<"u"?Hh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(ey)),ey.exports}var $3=V3();const Dm=eR($3);function q3({currentUser:t,budgetId:e}){const[n,r]=A.useState(!1),[i,o]=A.useState(null),[l,d]=A.useState(null);async function h(){if(!t){d("Must be logged in to download budget");return}if(!e){d("No budget selected");return}r(!0),d(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:f,data:p}=await Bt("budgets",e,`downloading budget ${e}`);if(!f||!p){d(`Budget ${e} not found`);return}const g=await aA(e,"download-budget");let b=null;try{const{exists:I,data:z}=await Bt("payees",e,`downloading payees for budget ${e}`);I&&z&&(b=z)}catch(I){console.warn(`Could not read payees for budget ${e}:`,I)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const _=new Dm,w=new Date,x=w.toISOString().split("T")[0],S=`budget_${e}`,{accounts:C,account_groups:T,categories:R,category_groups:k,...V}=p;_.file(`${S}/budget.json`,JSON.stringify(V,null,2)),_.file(`${S}/accounts.json`,JSON.stringify(C||{},null,2)),_.file(`${S}/account_groups.json`,JSON.stringify(T||{},null,2)),_.file(`${S}/categories.json`,JSON.stringify(R||{},null,2)),_.file(`${S}/category_groups.json`,JSON.stringify(k||[],null,2)),b&&_.file(`${S}/payees.json`,JSON.stringify(b,null,2));let $=0;for(const I of g){const z=I.data,M=`${S}/months/month_${z.year}_${String(z.month).padStart(2,"0")}`,X={};if(z.are_allocations_finalized&&z.category_balances)for(const Y of z.category_balances)Y.allocated!==void 0&&(X[Y.category_id]=Y.allocated);_.file(`${M}/metadata.json`,JSON.stringify({budget_id:z.budget_id,year_month_ordinal:z.year_month_ordinal,year:z.year,month:z.month,total_income:z.total_income,previous_month_income:z.previous_month_income,total_expenses:z.total_expenses,are_allocations_finalized:z.are_allocations_finalized,created_at:z.created_at,updated_at:z.updated_at,...z.are_allocations_finalized&&{allocations:X},downloaded_at:w.toISOString()},null,2)),_.file(`${M}/income.json`,JSON.stringify(z.income||[],null,2)),_.file(`${M}/expenses.json`,JSON.stringify(z.expenses||[],null,2)),_.file(`${M}/transfers.json`,JSON.stringify(z.transfers||[],null,2)),_.file(`${M}/adjustments.json`,JSON.stringify(z.adjustments||[],null,2)),_.file(`${M}/account_balances.json`,JSON.stringify(z.account_balances||[],null,2)),_.file(`${M}/category_balances.json`,JSON.stringify(z.category_balances||[],null,2)),$++,o({phase:"processing",current:$,total:g.length,percentComplete:20+Math.round($/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const D=await _.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const N=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),U=URL.createObjectURL(D),q=document.createElement("a");q.href=U,q.download=`${x}_${N}_${e}.zip`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(U)}catch(f){d(f instanceof Error?f.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:i,error:l,downloadBudget:h}}async function H3(t){const n=await new Dm().loadAsync(t),r=new Set,i=new Set;for(const[o]of Object.entries(n.files)){const l=o.match(/^budget_([^/]+)\//);if(l){const d=l[1];r.add(d),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&i.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:i.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function G3(t,e,n){const i=`${`${e}/months/`}${n}/`,o=`${i}metadata.json`,l=t.files[o];if(!l)return null;const d=await l.async("string"),h=JSON.parse(d),{downloaded_at:f,allocations:p,...g}=h,b=async S=>{const C=`${i}${S}`,T=t.files[C];if(T){const R=await T.async("string");return JSON.parse(R)}return[]},_={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await b("income.json"),expenses:await b("expenses.json"),transfers:await b("transfers.json"),adjustments:await b("adjustments.json"),account_balances:[],category_balances:[]},w=za(_);let x=Rm(w);if(h.are_allocations_finalized&&p!==void 0){const S=new Map;for(const R of x.category_balances)S.set(R.category_id,R);const C=[],T=new Set;for(const R of x.category_balances){const k=p[R.category_id];if(k!==void 0){const V=Ae(k);C.push({...R,allocated:V,end_balance:Ae(R.start_balance+V+R.spent+R.transfers+R.adjustments)})}else C.push(R);T.add(R.category_id)}for(const[R,k]of Object.entries(p))if(!T.has(R)){const V=Ae(k);C.push({category_id:R,start_balance:0,allocated:V,spent:0,transfers:0,adjustments:0,end_balance:V})}x={...x,category_balances:C}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:x}}async function W3(t,e){const n=`budget_${e}`,r=async $=>{const D=t.files[$];if(D){const O=await D.async("string");return JSON.parse(O)}return null},i=`${n}/budget.json`,o=`${n}/accounts.json`,l=`${n}/account_groups.json`,d=`${n}/categories.json`,h=`${n}/category_groups.json`,f=await r(i);if(!f)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(l)||{},b=await r(d)||{},_=await r(h)||[],w=za({...f,accounts:p,account_groups:g,categories:b,category_groups:_}),x={budgetId:e,data:w},S=`${n}/payees.json`,C=await r(S);let T=null;if(C){const $={...C,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:za($)}}const R=`${n}/months/`,k=new Set;for(const $ of Object.keys(t.files))if($.startsWith(R)&&$.includes("/metadata.json")){const D=$.split("/months/")[1].split("/")[0];k.add(D)}const V=[];for(const $ of k){const D=await G3(t,n,$);D&&V.push(D)}return{budgetUpdate:x,monthUpdates:V,payeeWrite:T}}function Q3({currentUser:t}){const[e,n]=A.useState(!1),[r,i]=A.useState(!1),[o,l]=A.useState(null),[d,h]=A.useState(null),[f,p]=A.useState(null),[g,b]=A.useState(null);async function _(x){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),l(null),b(null);try{const S=await H3(x);l(S)}catch(S){p(S instanceof Error?S.message:"Failed to parse zip file")}finally{n(!1)}}async function w(x){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}i(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const S=[];let C=0,T=0,R=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const V=await new Dm().loadAsync(x);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const $=[],D=[],O=[];for(let N=0;N<o.budgetsToRestore.length;N++){const U=o.budgetsToRestore[N];try{const{budgetUpdate:q,monthUpdates:I,payeeWrite:z}=await W3(V,U);$.push(q),D.push(...I),z&&O.push(z),h({phase:"uploading",current:N+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((N+1)/o.budgetsToRestore.length*50)})}catch(q){S.push(`Budget ${U}: ${q instanceof Error?q.message:String(q)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),$.length>0)try{console.log(`[Upload] Writing ${$.length} budget(s)...`),await jm($,"upload-budget"),C=$.length,console.log(`[Upload] Successfully wrote ${C} budget(s)`)}catch(N){const U=`Failed to write budgets: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${U}`,N),S.push(U),N}if(O.length>0)try{console.log(`[Upload] Writing ${O.length} payee doc(s)...`),await G_(O,"upload-budget: writing payees"),R=O.length,console.log(`[Upload] Successfully wrote ${R} payee doc(s)`)}catch(N){const U=`Failed to write payees: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${U}`,N),S.push(U),N}if(D.length>0)try{console.log(`[Upload] Writing ${D.length} month(s) and recalculating...`),await UB(D,"upload-budget"),T=D.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(N){const U=`Failed to write months: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${U}`,N),S.push(U),N}h({phase:"complete",current:1,total:1,percentComplete:100}),b({success:S.length===0,budgetsRestored:C,monthsRestored:T,payeesRestored:R,errors:S}),console.log("[Upload] Clearing all caches after upload..."),Fa()}catch(k){const V=k instanceof Error?k.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",k),console.error("[Upload] Error details:",{errorMessage:V,budgetsRestored:C,monthsRestored:T,payeesRestored:R,errorsSoFar:S}),p(V),b({success:!1,budgetsRestored:C,monthsRestored:T,payeesRestored:R,errors:[...S,V]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),Fa()}finally{i(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:d,error:f,result:g,scanZipFile:_,uploadBudget:w}}function K3({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:i="Move to end"}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:ZP,children:[u.jsx("div",{style:{...JP,opacity:t?1:.3,boxShadow:t?"0 0 8px var(--shadow-primary)":"none"}}),t&&u.jsx("span",{style:eB,children:i})]})}function Xt(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function br(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Fn(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Pt(t){return t===0?"$0.00":`${t>0?"+":"-"}${Xt(t)}`}function zt(t){return`${t>=0?"+":"-"}${Xt(t)}`}function ct(t){return t===0?pe.zero:t>0?pe.success:pe.danger}function dn(t){return t===0?pe.zero:t>0?pe.success:pe.debt}function wc(t){return t===0?pe.zero:t<0?pe.error:pe.success}function Sc(t){return t===0?pe.zero:t>0?pe.success:pe.error}async function dA(t,e){const{exists:n,data:r}=await Bt("feedback",t,`VALIDATION-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function i0(t){const{docId:e,items:n,description:r}=t;await cr("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function Y3(t,e,n,r){const{exists:i}=await Bt("feedback",t,"checking if user has existing feedback document");i?await cr("feedback",t,{items:Wu(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await cr("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}function hA(){const t=Ut(),e=Gn({onMutate:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,f=o||i,p=Ee.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),b=`feedback_optimistic_${Date.now()}`,_={id:b,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d,doc_id:f,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,_]}),{previousData:g,optimisticId:b}},mutationFn:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,f=o||i,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d};return await Y3(f,p,o,"submitting new feedback"),{feedbackItem:p,docId:f}},onSuccess:(r,i,o)=>{if(!o?.optimisticId)return;const l=t.getQueryData(Ee.feedback());l&&t.setQueryData(Ee.feedback(),{items:l.items.map(d=>d.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:i.userEmail}:d)})},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ee.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function X3(){const t=Ut(),e=Gn({onMutate:async r=>{const{item:i}=r,o=Ee.feedback(),l=!i.is_done,d=l?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(f=>f.id===i.id?{...f,is_done:l,completed_at:d}:f)}),{previousData:h}},mutationFn:async r=>{const{item:i}=r,o=!i.is_done,l=o?new Date().toISOString():null,d=await dA(i.doc_id,"toggle feedback");let h=!1;const f=d.items.map(p=>p.id===i.id?(h=!0,{...p,is_done:o,completed_at:l}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:i.id,inDocument:i.doc_id,availableIds:d.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${i.id}, Doc ID: ${i.doc_id}`);return await i0({docId:i.doc_id,items:f,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:i.id,isDone:o,completedAt:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ee.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function Z3(){const t=Ut(),e=Gn({onMutate:async r=>{const{docId:i,items:o}=r,l=Ee.feedback();await t.cancelQueries({queryKey:l});const d=t.getQueryData(l),h=new Map;return o.forEach(f=>{h.set(f.id,f.sort_order)}),d&&t.setQueryData(l,{items:d.items.map(f=>f.doc_id===i&&h.has(f.id)?{...f,sort_order:h.get(f.id)}:f)}),{previousData:d}},mutationFn:async r=>{const{docId:i,items:o}=r;return await i0({docId:i,items:o,description:"saving reordered feedback items"}),{docId:i,items:o}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ee.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}const Zu={critical_bug:{label:"Critical Bug",color:"var(--color-error)",bgColor:"var(--color-error-bg)"},bug:{label:"Bug",color:"var(--color-warning)",bgColor:"var(--color-warning-bg)"},new_feature:{label:"New Feature",color:"var(--color-success)",bgColor:"var(--color-success-bg)"},core_feature:{label:"Core Feature",color:"var(--color-migration-blue)",bgColor:"var(--color-migration-blue-bg)"},qol:{label:"QOL",color:"var(--color-migration-purple)",bgColor:"var(--color-migration-purple-bg)"}};function Qs({isOpen:t,onClose:e,title:n,children:r,width:i="28rem"}){if(!t)return null;function o(){e()}return u.jsx("div",{style:{position:"fixed",inset:0,background:"var(--modal-backdrop)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:u.jsxs("div",{style:{background:"var(--surface-base)",color:"var(--text-primary)",borderRadius:"12px",padding:"1.5rem",width:i,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px var(--shadow-overlay)"},onClick:l=>l.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[u.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const J3=2e3;function ez(){const[t,e]=A.useState(!1),[n,r]=A.useState(""),[i,o]=A.useState("bug"),[l,d]=A.useState(!1),h=A.useContext(xd),p=Mi().get_current_firebase_user(),g=tr(),{submitFeedback:b}=hA();if(A.useEffect(()=>{if(l){const x=setTimeout(()=>d(!1),J3);return()=>clearTimeout(x)}},[l]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function w(x){x.preventDefault(),!(!n.trim()||!h.username||!p)&&(b.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:i,currentPath:g.pathname}),r(""),o("bug"),e(!1),d(!0))}return u.jsxs(u.Fragment,{children:[l&&u.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"var(--banner-success)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px var(--shadow-overlay)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[u.jsx("span",{children:""}),u.jsx("span",{children:"Feedback submitted!"})]}),u.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:pe.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px var(--shadow-overlay)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:x=>{x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 16px var(--shadow-overlay)"},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 4px 12px var(--shadow-overlay)"},children:""}),u.jsx(Qs,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:u.jsxs("form",{onSubmit:w,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(x=>{const S=Zu[x],C=i===x;return u.jsxs("button",{type:"button",onClick:()=>{S.label,o(x)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${S.color}`,borderRadius:"0.5rem",background:C?S.bgColor:"transparent",color:C?S.color:"var(--text-muted)",cursor:"pointer",fontWeight:C?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:C?1:.5,boxShadow:C?`0 0 12px ${S.bgColor}`:"none",position:"relative"},children:[S.label,C&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},x)})}),u.jsx(r0,{value:n,onChange:x=>r(x.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),u.jsxs(Ga,{children:[u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),u.jsx($e,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function Qr({children:t,labelStyle:e,...n}){return u.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[u.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:pe.primary},...n}),t]})}function a0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[i,o]=A.useState(r);return u.jsxs("div",{style:{marginTop:"2rem"},children:[u.jsxs("button",{onClick:()=>o(!i),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[u.jsx("span",{style:{transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),i&&n]})}const tz=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},nz=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Vf(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,i=e.filter(S=>!S.hidden),o=i.length,l=tz(o),d=nz(o),h=Math.floor(100/d),f=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",b=r==="segmented",_=S=>{const C="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return b?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:S?C:T,cursor:"pointer",fontWeight:S?600:400,fontSize:"0.95rem",color:"inherit",opacity:S?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:S?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:S?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:S?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:S?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:S?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},w=(S,C)=>u.jsxs(u.Fragment,{children:[u.jsx("span",{children:S.label}),S.checkmark&&u.jsx("span",{style:{color:pe.success,fontWeight:600},children:""}),p&&C&&u.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),x=()=>b?`
        .${f} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${f} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${f} > button,
        .${f} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${f} > button:last-child,
        .${f} > a:last-child {
          margin-right: 0;
        }
        .${f} > button::before,
        .${f} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 var(--sticky-header-bg), 1px 0 0 var(--sticky-header-bg);
        }
        .${f} > button:nth-child(1),
        .${f} > a:nth-child(1) {
          z-index: 4;
        }
        .${f} > button:nth-child(2),
        .${f} > a:nth-child(2) {
          z-index: 3;
        }
        .${f} > button:nth-child(3),
        .${f} > a:nth-child(3) {
          z-index: 2;
        }
        .${f} > button:nth-child(4),
        .${f} > a:nth-child(4) {
          z-index: 1;
        }
        .${f} > button.tab-active,
        .${f} > a.tab-active {
          z-index: 10;
        }
        .${f} > button.tab-active::before,
        .${f} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${f} > button:not(.tab-active):hover,
        .${f} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${f} > button:not(.tab-active):hover::before,
        .${f} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${f} {
            padding-left: 0;
            padding-right: 0;
          }
          .${f} > button,
          .${f} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${f} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${l}px) {
        .${f} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return u.jsxs(u.Fragment,{children:[u.jsx("style",{children:`
        ${x()}
        .${f} > button,
        .${f} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${f} > button:hover,
        .${f} > button:focus,
        .${f} > a:hover,
        .${f} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${b?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),u.jsx("div",{className:f,children:i.map(S=>{const C=n===S.id;return t.mode==="link"?u.jsx(Tn,{to:`${t.linkPrefix}/${S.id}`,onClick:()=>(`${S.label}`,void 0),style:_(C),className:C?"tab-active":"",children:w(S,C)},S.id):u.jsx("button",{onClick:()=>{`${S.label}`,t.onTabChange(S.id)},style:_(C),className:C?"tab-active":"",children:w(S,C)},S.id)})})]})}function fA({items:t}){const[e,n]=A.useState(!1),r=A.useRef(null),o=tr().pathname;A.useEffect(()=>{function d(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[e]),A.useEffect(()=>{function d(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[e]);const l=t.filter(d=>d.hidden?!1:d.to?d.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):d.to==="/account"||d.to==="/"?o!==d.to:!o.startsWith(d.to):!0);return u.jsxs("div",{ref:r,style:{position:"relative"},children:[u.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&u.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"var(--overlay-panel-bg)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px var(--shadow-overlay)",zIndex:1e3,overflow:"hidden"},children:l.map((d,h)=>{if(d.divider)return u.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const f=u.jsxs(u.Fragment,{children:[d.icon&&u.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:d.icon}),u.jsx("span",{children:d.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return d.to?u.jsx(Tn,{to:d.to,style:p,onMouseEnter:b=>Object.assign(b.currentTarget.style,g),onMouseLeave:b=>b.currentTarget.style.background="transparent",onClick:()=>{`${d.label}`,n(!1)},children:f},h):u.jsx("button",{onClick:()=>{`${d.label}`,d.onClick?.(),n(!1)},style:p,onMouseEnter:b=>Object.assign(b.currentTarget.style,g),onMouseLeave:b=>b.currentTarget.style.background="transparent",children:f},h)})})]})}function rz({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Je(),i=tr(),l=[...i.pathname==="/budget"||i.pathname.startsWith("/budget/")&&!i.pathname.startsWith("/budget/settings")&&!i.pathname.startsWith("/budget/admin")&&!i.pathname.startsWith("/budget/analytics")&&!i.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return u.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[u.jsx("div",{style:{flex:"0 0 auto"},children:e?u.jsx(Tn,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):u.jsx(Tn,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:u.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),u.jsx("div",{style:{flex:"0 0 auto"},children:n?u.jsx("div",{style:{width:"1.5rem"}}):u.jsx(fA,{items:l})})]})}function mA({children:t,style:e}){return u.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function Ju({message:t,linkText:e,linkTo:n}){return u.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${pe.warning} 12%, transparent)`,border:`2px solid ${pe.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsx("p",{style:{margin:0,fontWeight:500,color:pe.warning,fontSize:"0.95rem"},children:t}),u.jsxs(Tn,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:pe.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}const sz={success:{bgColor:"var(--banner-success)",color:"white",icon:""},error:{bgColor:"var(--banner-error)",color:"white",icon:""},warning:{bgColor:"var(--banner-warning)",color:"white",icon:""},info:{bgColor:"var(--banner-info)",color:"white",icon:""}};function iz({item:t,onDismiss:e}){const[n,r]=A.useState(!1);if(A.useEffect(()=>{if(t){if(r(!0),t.autoDismissMs&&t.autoDismissMs>0){const o=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),200)},t.autoDismissMs);return()=>clearTimeout(o)}}else r(!1)},[t,e]),!t||!n)return null;const i=sz[t.type];return u.jsxs("div",{style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",left:"1.5rem",maxWidth:"600px",margin:"0 auto",background:i.bgColor,color:i.color,padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px var(--shadow-overlay)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:n?"fadeInUp 0.2s ease-out":"fadeOut 0.2s ease-out",cursor:"pointer"},onClick:()=>{r(!1),setTimeout(()=>e(t.id),200)},children:[u.jsx("span",{children:i.icon}),u.jsx("span",{style:{flex:1},children:t.message}),u.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:""})]})}class az{items=[];listeners=new Set;nextId=1;add(e){const n=`banner-${this.nextId++}`,r={...e,id:n};return this.items.push(r),this.notify(),n}remove(e){this.items=this.items.filter(n=>n.id!==e),this.notify()}getCurrent(){return this.items[0]||null}subscribe(e){return this.listeners.add(e),e(this.getCurrent()),()=>{this.listeners.delete(e)}}notify(){const e=this.getCurrent();this.listeners.forEach(n=>n(e))}}const $n=new az;function In(){const{removeChange:t,getChanges:e,clearChanges:n,hasChanges:r,setIsSaving:i,setLastSaveTime:o,setSaveError:l}=vd(),d=A.useRef(!1),h=A.useCallback(async(_,w,x,S)=>{const C=Ee.month(_,w,x),T=Pe.getQueryData(C);if(!T?.month)throw new Error(`Month ${w}/${x} not found in cache`);await J_({budgetId:_,month:T.month,description:`${S}: ${w}/${x}`,updateMonthMap:!1})},[]),f=A.useCallback(async(_,w)=>{const x=Ee.budget(_),S=Pe.getQueryData(x);if(!S)throw new Error(`Budget ${_} not found in cache`);const C=Object.fromEntries(Object.entries(S.budget.accounts||{}).map(([R,k])=>{const{balance:V,...$}=k;return[R,$]})),T=Object.fromEntries(Object.entries(S.budget.categories||{}).map(([R,k])=>{const{balance:V,...$}=k;return[R,$]}));await vc({budgetId:_,updates:{name:S.budget.name,user_ids:S.budget.user_ids,accepted_user_ids:S.budget.accepted_user_ids,owner_id:S.budget.owner_id,owner_email:S.budget.owner_email,accounts:C,account_groups:S.budget.account_groups,categories:T,category_groups:S.budget.category_groups,month_map:S.budget.month_map},description:`${w}: budget`})},[]),p=A.useCallback(async(_,w)=>{const x=Ee.payees(_),S=Pe.getQueryData(x);if(!S)throw new Error(`Payees for budget ${_} not found in cache`);await cr("payees",_,{budget_id:_,payees:S,updated_at:new Date().toISOString()},`${w}: payees`)},[]),g=A.useCallback(async(_="periodic save")=>{if(d.current||!r())return;d.current=!0,i(!0),l(null);const w=e(),x=[];try{const S=[],C=new Set,T=new Set;for(const R of w)R.type==="month"&&R.year!==void 0&&R.month!==void 0?S.push({budgetId:R.budgetId,year:R.year,month:R.month}):R.type==="budget"?C.add(R.budgetId):R.type==="payees"&&T.add(R.budgetId);for(const{budgetId:R,year:k,month:V}of S){const $=Ee.month(R,k,V),D=Pe.getQueryData($);if(D?.month){const O=Rm(D.month);Pe.setQueryData($,{month:O})}}for(const{budgetId:R,year:k,month:V}of S)try{await h(R,k,V,_)}catch($){const D=`Failed to save month ${k}/${V}: ${$ instanceof Error?$.message:String($)}`;x.push(D),console.error("[useBackgroundSave]",D,$)}for(const R of C)try{nA(R)}catch(k){console.warn("[useBackgroundSave] Failed to recalculate budget account balances from cache:",k)}for(const R of C)try{await f(R,_)}catch(k){const V=`Failed to save budget: ${k instanceof Error?k.message:String(k)}`;x.push(V),console.error("[useBackgroundSave]",V,k)}for(const R of T)try{await p(R,_)}catch(k){const V=`Failed to save payees: ${k instanceof Error?k.message:String(k)}`;x.push(V),console.error("[useBackgroundSave]",V,k)}if(x.length===0)n(),o(Date.now()),$n.add({type:"success",message:"All changes saved successfully",autoDismissMs:2e3});else throw new Error(x.join("; "))}catch(S){const C=S instanceof Error?S.message:String(S);throw l(C),$n.add({type:"error",message:`Failed to save changes: ${C}`,autoDismissMs:0}),S}finally{d.current=!1,i(!1)}},[r,e,n,h,f,p,i,o,l]),b=A.useCallback(async(_,w,x,S)=>{try{i(!0),l(null),w==="month"&&x!==void 0&&S!==void 0?(await h(_,x,S,"immediate save (current viewing document)"),t({type:"month",budgetId:_,year:x,month:S}),o(Date.now())):w==="budget"&&(await f(_,"immediate save (current viewing document)"),t({type:"budget",budgetId:_}),o(Date.now()))}catch(C){const T=C instanceof Error?C.message:String(C);throw l(T),$n.add({type:"error",message:`Failed to save current document: ${T}`,autoDismissMs:0}),C}finally{i(!1)}},[h,f,t,i,o,l]);return{saveAllChanges:g,saveCurrentDocument:b}}async function oz(t,e,n,r){const i=Pe.getQueryData(Ee.budget(t));if(!i){console.warn("[mutationHelpers] Budget not in cache, skipping local recalculation");return}const o=i.budget.month_map,l=qe(e,n),d=[];for(const[h]of Object.entries(o))if(h>=l){const f=parseInt(h.substring(0,4),10),p=parseInt(h.substring(4,6),10);d.push({year:f,month:p})}d.sort((h,f)=>h.year!==f.year?h.year-f.year:h.month-f.month);for(const{year:h,month:f}of d)try{await CB(t,h,f,Pe),r&&r({type:"month",budgetId:t,year:h,month:f})}catch(p){console.warn(`[mutationHelpers] Failed to recalculate month ${h}/${f} locally:`,p)}}function xr(){const{trackChange:t}=vd(),{addLoadingHold:e,removeLoadingHold:n}=jn();return{updateMonthCacheAndTrack:(o,l,d,h)=>{Pe.setQueryData(Ee.month(o,l,d),{month:h}),t({type:"month",budgetId:o,year:l,month:d})},recalculateMonthAndCascade:async(o,l,d,h)=>{const f="recalculate-month-cascade",p=h||((C,T)=>{C?e(f,T):n(f)}),g=Ee.month(o,l,d),b=Pe.getQueryData(g);if(b?.month){const C=Rm(b.month);Pe.setQueryData(g,{month:C})}const _=gd(),w=qe(_.year,_.month),x=qe(l,d),S=x<w;if(await oz(o,l,d,t),S){p(!0,"Saving start balances...");try{const C=Pe.getQueryData(Ee.budget(o));if(!C){console.warn("[mutationHelpers] Budget not in cache, skipping start_balance save");return}const T=C.monthMap||{},R=[];for(const[k]of Object.entries(T))if(k>=x&&k<=w){const V=parseInt(k.substring(0,4),10),$=parseInt(k.substring(4,6),10);R.push({year:V,month:$})}R.sort((k,V)=>k.year!==V.year?k.year-V.year:k.month-V.month);for(const{year:k,month:V}of R){const $=Ee.month(o,k,V),D=Pe.getQueryData($);if(D?.month){const O=_d(D.month);await J_({budgetId:o,month:O,description:`recalculation: saving start_balance for ${k}/${V}`,updateMonthMap:!1})}}}catch(C){console.error("[mutationHelpers] Failed to save start_balance for months at/before window:",C)}finally{p(!1,"")}}try{await rA(o,p)}catch(C){console.warn("[mutationHelpers] Failed to ensure months fresh and recalculate balances:",C)}t({type:"budget",budgetId:o})},trackChange:t}}function lz(){const{currentViewingDocument:t}=Je(),{saveCurrentDocument:e}=In(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{finalizeAllocations:async o=>{const{budgetId:l,year:d,month:h,allocations:f,onProgress:p}=o;p?.({phase:"saving",message:"Saving allocations..."});const g=await nr(l,d,h);if(!g)throw new Error(`Month not found: ${d}/${h}`);const b=g.category_balances?.map(S=>S.category_id)??[],_=g.category_balances.map(S=>{const C=Ae(f[S.category_id]??S.allocated);return{...S,allocated:C}});for(const[S,C]of Object.entries(f))b.includes(S)||_.push({category_id:S,start_balance:0,allocated:Ae(C),spent:0,transfers:0,adjustments:0,end_balance:0});const w={...g,category_balances:_,are_allocations_finalized:!0,updated_at:new Date().toISOString()};n(l,d,h,w),p?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(S){console.warn("[useFinalizeAllocations] Failed to recalculate month and cascade:",S)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(S){console.warn("[useFinalizeAllocations] Failed to save current document immediately:",S)}return p?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:w}},isPending:!1,isError:!1,error:null}}function pA(){const{currentViewingDocument:t}=Je(),{saveCurrentDocument:e}=In(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{deleteAllocations:async o=>{const{budgetId:l,year:d,month:h,onProgress:f}=o;f?.({phase:"saving",message:"Deleting allocations..."});const p=await nr(l,d,h);if(!p)throw new Error(`Month not found: ${d}/${h}`);const g=p.category_balances.map(w=>({...w,allocated:0})),b={...p,category_balances:g,are_allocations_finalized:!1,updated_at:new Date().toISOString()};n(l,d,h,b),f?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(w){console.warn("[useDeleteAllocations] Failed to recalculate month and cascade:",w)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(w){console.warn("[useDeleteAllocations] Failed to save current document immediately:",w)}return f?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:b}},isPending:!1,isError:!1,error:null}}async function Mm(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const i=[...n,r].sort((o,l)=>o.toLowerCase().localeCompare(l.toLowerCase()));return await cr("payees",t,{budget_id:t,payees:i,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),i}function cz(t,e){const n={id:e,amount:Ae(t.amount),account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function uz(){const t=Ut(),{currentViewingDocument:e}=Je(),{saveCurrentDocument:n}=In(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=xr(),l=Gn({onMutate:async h=>{const{budgetId:f,year:p,month:g}=h,b=Ee.month(f,p,g);await t.cancelQueries({queryKey:b});const _=t.getQueryData(b),w=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=cz(h,w);if(_?.month){const C={..._.month,income:[..._.month.income||[],x],updated_at:new Date().toISOString()};r(f,p,g,C)}try{await i(f,p,g)}catch(C){console.warn("[useAddIncome] Failed to recalculate month and cascade:",C)}if(h.payee?.trim()){const C=t.getQueryData(Ee.payees(f))||[],T=await Mm(f,h.payee,C);T&&(t.setQueryData(Ee.payees(f),T),o({type:"payees",budgetId:f}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(f,"month",p,g)}catch(C){console.warn("[useAddIncome] Failed to save current document immediately:",C)}return{previousData:_,incomeId:w,newIncome:x}},mutationFn:async h=>{const{budgetId:f,year:p,month:g}=h,b=Ee.month(f,p,g),_=t.getQueryData(b);if(!_?.month)throw new Error("No month data in cache after optimistic update");const w=_.month,x=w.income?.[w.income.length-1];if(!x)throw new Error("Could not find new income in updated month");return{updatedMonth:w,newIncome:x}},onError:(h,f,p)=>{if(p?.previousData){const{budgetId:g,year:b,month:_}=f;t.setQueryData(Ee.month(g,b,_),p.previousData)}}});return{addIncome:async(h,f,p,g,b,_,w,x)=>l.mutateAsync({budgetId:h,year:f,month:p,amount:g,accountId:b,date:_,payee:w,description:x}),isPending:l.isPending,isError:l.isError,error:l.error}}function dz(t,e,n,r,i,o){if(!t)return!0;const l=t.payee||void 0,d=i?.trim()||void 0,h=t.description||void 0,f=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||d!==l||f!==h}function hz(){const t=Ut(),{currentViewingDocument:e}=Je(),{saveCurrentDocument:n}=In(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=xr();return{updateIncome:async(d,h,f,p,g,b,_,w,x)=>{const S=await nr(d,h,f);if(!S)throw new Error(`Month not found: ${h}/${f}`);const C=(S.income||[]).find($=>$.id===p);if(!dz(C,g,b,_,w,x))return{updatedMonth:S,noOp:!0};const T={id:p,amount:Ae(g),account_id:b,date:_,created_at:(S.income||[]).find($=>$.id===p)?.created_at||new Date().toISOString()};w?.trim()&&(T.payee=w.trim()),x&&(T.description=x);const R=(S.income||[]).map($=>$.id===p?T:$),k={...S,income:R,updated_at:new Date().toISOString()};r(d,h,f,k);try{await i(d,h,f)}catch($){console.warn("[useUpdateIncome] Failed to recalculate month and cascade:",$)}if(w?.trim()){const $=t.getQueryData(Ee.payees(d))||[],D=await Mm(d,w,$);D&&(t.setQueryData(Ee.payees(d),D),o({type:"payees",budgetId:d}))}if(e.type==="month"&&e.year===h&&e.month===f)try{await n(d,"month",h,f)}catch($){console.warn("[useUpdateIncome] Failed to save current document immediately:",$)}return{updatedMonth:k}},isPending:!1,isError:!1,error:null}}function fz(){const{currentViewingDocument:t}=Je(),{saveCurrentDocument:e}=In(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{deleteIncome:async(o,l,d,h)=>{const f=await nr(o,l,d);if(!f)throw new Error(`Month not found: ${l}/${d}`);const p=(f.income||[]).filter(_=>_.id!==h),g={...f,income:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteIncome] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteIncome] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function mz(t,e){const n={id:e,amount:Ae(t.amount),category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function pz(){const t=Ut(),{currentViewingDocument:e}=Je(),{saveCurrentDocument:n}=In(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=xr(),l=Gn({onMutate:async h=>{const{budgetId:f,year:p,month:g}=h,b=Ee.month(f,p,g);await t.cancelQueries({queryKey:b});const _=t.getQueryData(b),w=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=mz(h,w);if(_?.month){const C={..._.month,expenses:[..._.month.expenses||[],x],updated_at:new Date().toISOString()};r(f,p,g,C)}try{await i(f,p,g)}catch(C){console.warn("[useAddExpense] Failed to recalculate month and cascade:",C)}if(h.payee?.trim()){const C=t.getQueryData(Ee.payees(f))||[],T=await Mm(f,h.payee,C);T&&(t.setQueryData(Ee.payees(f),T),o({type:"payees",budgetId:f}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(f,"month",p,g)}catch(C){console.warn("[useAddExpense] Failed to save current document immediately:",C)}return{previousData:_,expenseId:w,newExpense:x}},mutationFn:async h=>{const{budgetId:f,year:p,month:g}=h,b=Ee.month(f,p,g),_=t.getQueryData(b);if(!_?.month)throw new Error("No month data in cache after optimistic update");const w=_.month,x=w.expenses?.[w.expenses.length-1];if(!x)throw new Error("Could not find new expense in updated month");return{updatedMonth:w,newExpense:x}},onError:(h,f,p)=>{if(p?.previousData){const{budgetId:g,year:b,month:_}=f;t.setQueryData(Ee.month(g,b,_),p.previousData)}}});return{addExpense:async(h,f,p,g,b,_,w,x,S,C)=>l.mutateAsync({budgetId:h,year:f,month:p,amount:g,categoryId:b,accountId:_,date:w,payee:x,description:S,cleared:C}),isPending:l.isPending,isError:l.isError,error:l.error}}function gz(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||i!==t.date||f!==h||g!==p||d!==t.cleared}function yz(){const t=Ut(),{currentViewingDocument:e}=Je(),{saveCurrentDocument:n}=In(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=xr();return{updateExpense:async(l,d,h,f,p,g,b,_,w,x,S)=>{const C=await nr(l,d,h);if(!C)throw new Error(`Month not found: ${d}/${h}`);const T=(C.expenses||[]).find(D=>D.id===f);if(!gz(T,p,g,b,_,w,x,S))return{updatedMonth:C,noOp:!0};const R={id:f,amount:Ae(p),category_id:g,account_id:b,date:_,created_at:C.expenses?.find(D=>D.id===f)?.created_at||new Date().toISOString()};w?.trim()&&(R.payee=w.trim()),x&&(R.description=x),S!==void 0&&(R.cleared=S);const k=(C.expenses||[]).map(D=>D.id===f?R:D),V={...C,expenses:k,updated_at:new Date().toISOString()};r(l,d,h,V);try{await i(l,d,h)}catch(D){console.warn("[useUpdateExpense] Failed to recalculate month and cascade:",D)}if(w?.trim()){const D=t.getQueryData(Ee.payees(l))||[],O=await Mm(l,w,D);O&&t.setQueryData(Ee.payees(l),O)}if(e.type==="month"&&e.year===d&&e.month===h)try{await n(l,"month",d,h)}catch(D){console.warn("[useUpdateExpense] Failed to save current document immediately:",D)}return{updatedMonth:V}},isPending:!1,isError:!1,error:null}}function _z(){const{currentViewingDocument:t}=Je(),{saveCurrentDocument:e}=In(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{deleteExpense:async(o,l,d,h)=>{const f=await nr(o,l,d);if(!f)throw new Error(`Month not found: ${l}/${d}`);const p=(f.expenses||[]).filter(_=>_.id!==h),g={...f,expenses:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteExpense] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteExpense] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function bz(t,e){const n={id:e,amount:Ae(t.amount),from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function vz(){const t=Ut(),{currentViewingDocument:e}=Je(),{saveCurrentDocument:n}=In(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=xr(),o=Gn({onMutate:async d=>{const{budgetId:h,year:f,month:p}=d,g=Ee.month(h,f,p);await t.cancelQueries({queryKey:g});const b=t.getQueryData(g),_=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,w=bz(d,_);if(b?.month){const S={...b.month,transfers:[...b.month.transfers||[],w],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await i(h,f,p)}catch(S){console.warn("[useAddTransfer] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddTransfer] Failed to save current document immediately:",S)}return{previousData:b,transferId:_,newTransfer:w}},mutationFn:async d=>{const{budgetId:h,year:f,month:p}=d,g=Ee.month(h,f,p),b=t.getQueryData(g);if(!b?.month)throw new Error("No month data in cache after optimistic update");const _=b.month,w=_.transfers?.[_.transfers.length-1];if(!w)throw new Error("Could not find new transfer in updated month");return{updatedMonth:_,newTransfer:w}},onError:(d,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:b}=h;t.setQueryData(Ee.month(p,g,b),f.previousData)}}});return{addTransfer:async(d,h,f,p,g,b,_,w,x,S,C)=>o.mutateAsync({budgetId:d,year:h,month:f,amount:p,fromAccountId:g,toAccountId:b,fromCategoryId:_,toCategoryId:w,date:x,description:S,cleared:C}),isPending:o.isPending,isError:o.isError,error:o.error}}function xz(t,e,n,r,i,o,l,d,h){if(!t)return!0;const f=t.description||void 0,p=d||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||i!==t.from_category_id||o!==t.to_category_id||l!==t.date||p!==f||h!==t.cleared}function wz(){const{currentViewingDocument:t}=Je(),{saveCurrentDocument:e}=In(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{updateTransfer:async(o,l,d,h,f,p,g,b,_,w,x,S)=>{const C=await nr(o,l,d);if(!C)throw new Error(`Month not found: ${l}/${d}`);const T=(C.transfers||[]).find(D=>D.id===h);if(!xz(T,f,p,g,b,_,w,x,S))return{updatedMonth:C,noOp:!0};const R={id:h,amount:Ae(f),from_account_id:p,to_account_id:g,from_category_id:b,to_category_id:_,date:w,created_at:C.transfers?.find(D=>D.id===h)?.created_at||new Date().toISOString()};x&&(R.description=x),S!==void 0&&(R.cleared=S);const k=(C.transfers||[]).map(D=>D.id===h?R:D),V={...C,transfers:k,updated_at:new Date().toISOString()};n(o,l,d,V);try{await r(o,l,d)}catch(D){console.warn("[useUpdateTransfer] Failed to recalculate month and cascade:",D)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(D){console.warn("[useUpdateTransfer] Failed to save current document immediately:",D)}return{updatedMonth:V}},isPending:!1,isError:!1,error:null}}function Sz(){const{currentViewingDocument:t}=Je(),{saveCurrentDocument:e}=In(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{deleteTransfer:async(o,l,d,h)=>{const f=await nr(o,l,d);if(!f)throw new Error(`Month not found: ${l}/${d}`);const p=(f.transfers||[]).filter(_=>_.id!==h),g={...f,transfers:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteTransfer] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteTransfer] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function Ez(t,e){const n={id:e,amount:Ae(t.amount),account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function Cz(){const t=Ut(),{currentViewingDocument:e}=Je(),{saveCurrentDocument:n}=In(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=xr(),o=Gn({onMutate:async d=>{const{budgetId:h,year:f,month:p}=d,g=Ee.month(h,f,p);await t.cancelQueries({queryKey:g});const b=t.getQueryData(g),_=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,w=Ez(d,_);if(b?.month){const S={...b.month,adjustments:[...b.month.adjustments||[],w],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await i(h,f,p)}catch(S){console.warn("[useAddAdjustment] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddAdjustment] Failed to save current document immediately:",S)}return{previousData:b,adjustmentId:_,newAdjustment:w}},mutationFn:async d=>{const{budgetId:h,year:f,month:p}=d,g=Ee.month(h,f,p),b=t.getQueryData(g);if(!b?.month)throw new Error("No month data in cache after optimistic update");const _=b.month,w=_.adjustments?.[_.adjustments.length-1];if(!w)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:_,newAdjustment:w}},onError:(d,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:b}=h;t.setQueryData(Ee.month(p,g,b),f.previousData)}}});return{addAdjustment:async(d,h,f,p,g,b,_,w,x,S)=>o.mutateAsync({budgetId:d,year:h,month:f,amount:p,accountId:g,categoryId:b,date:_,payee:w,description:x,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function Tz(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||i!==t.date||f!==h||g!==p||d!==t.cleared}function Az(){const{currentViewingDocument:t}=Je(),{saveCurrentDocument:e}=In(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{updateAdjustment:async(o,l,d,h,f,p,g,b,_,w,x)=>{const S=await nr(o,l,d);if(!S)throw new Error(`Month not found: ${l}/${d}`);const C=(S.adjustments||[]).find($=>$.id===h);if(!Tz(C,f,p,g,b,_,w,x))return{updatedMonth:S,noOp:!0};const T={id:h,amount:Ae(f),account_id:p,category_id:g,date:b,created_at:S.adjustments?.find($=>$.id===h)?.created_at||new Date().toISOString()};_?.trim()&&(T.payee=_.trim()),w&&(T.description=w),x!==void 0&&(T.cleared=x);const R=(S.adjustments||[]).map($=>$.id===h?T:$),k={...S,adjustments:R,updated_at:new Date().toISOString()};n(o,l,d,k);try{await r(o,l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to recalculate month and cascade:",$)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch($){console.warn("[useUpdateAdjustment] Failed to save current document immediately:",$)}return{updatedMonth:k}},isPending:!1,isError:!1,error:null}}function jz(){const{currentViewingDocument:t}=Je(),{saveCurrentDocument:e}=In(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=xr();return{deleteAdjustment:async(o,l,d,h)=>{const f=await nr(o,l,d);if(!f)throw new Error(`Month not found: ${l}/${d}`);const p=(f.adjustments||[]).filter(_=>_.id!==h),g={...f,adjustments:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteAdjustment] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteAdjustment] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function Rz({budgetId:t,enabled:e,initialDataLoadComplete:n,months:r}){const{addLoadingHold:i,removeLoadingHold:o}=jn(),{updateAccounts:l}=JT(),{updateCategories:d}=eA(),h=A.useRef(!1);A.useEffect(()=>{if(!e||!t||!n||r.length===0||h.current)return;h.current=!0,(async()=>{try{i("initial-balance-calculation","Calculating balances...");const p=Pe.getQueryData(Ee.budget(t));if(!p){console.warn("[useInitialBalanceCalculation] No budget data in cache"),o("initial-balance-calculation");return}const{budget:g,accounts:b,categories:_}=p,w=Object.keys(_),x=[...r].sort((W,te)=>W.year!==te.year?W.year-te.year:W.month-te.month),S=gd(),C=qe(S.year,S.month),T=x[0],R=T?qe(T.year,T.month):null;let k=null;if(R&&R<=C)k=x.find(W=>qe(W.year,W.month)===C)||null;else{const{readMonth:W}=await ka(async()=>{const{readMonth:te}=await Promise.resolve().then(()=>zS);return{readMonth:te}},void 0);k=await W(t,S.year,S.month,{description:"initial balance calculation: fetching first window month"})}let V=!1;k&&(V=(k.category_balances||[]).some(W=>!lt(W.category_id)&&W.start_balance!==0)||(k.account_balances||[]).some(W=>!Ye(W.account_id)&&W.start_balance!==0));let $=bd;const D=[];if(!V&&k){let W=S.year,te=S.month,B=!1;const H=120;for(let ne=0;ne<H&&!B;ne++){const re=bc(W,te);W=re.year,te=re.month;const{readMonth:ce}=await ka(async()=>{const{readMonth:Te}=await Promise.resolve().then(()=>zS);return{readMonth:Te}},void 0),_e=await ce(t,W,te,{description:"initial balance calculation: walking backward to find start_balance"});if(!_e)B=!0;else if((_e.category_balances||[]).some(oe=>!lt(oe.category_id)&&oe.start_balance!==0)||(_e.account_balances||[]).some(oe=>!Ye(oe.account_id)&&oe.start_balance!==0)){B=!0;const oe={},be={};for(const Ne of _e.category_balances||[])lt(Ne.category_id)||(oe[Ne.category_id]=Ae(Ne.end_balance??0));for(const Ne of _e.account_balances||[])Ye(Ne.account_id)||(be[Ne.account_id]=Ae(Ne.end_balance??0));$={categoryEndBalances:oe,accountEndBalances:be,totalIncome:Ae(_e.total_income??0)}}else D.push(_e)}D.reverse();for(const ne of D){const re=sc(ne,$,ne.previous_month_income);if($=Lo(re),Sm(ne.year,ne.month)){const ce=_d(re);await J_({budgetId:t,month:ce,description:`initial balance calculation: ensuring start_balance for ${ne.year}/${ne.month}`,updateMonthMap:!1})}}}else if(T){const W={},te={};for(const B of T.category_balances||[])lt(B.category_id)||(W[B.category_id]=Ae(B.start_balance??0));for(const B of T.account_balances||[])Ye(B.account_id)||(te[B.account_id]=Ae(B.start_balance??0));$={categoryEndBalances:W,accountEndBalances:te,totalIncome:Ae(T.previous_month_income??0)}}const O=[];for(const W of x){const te=sc(W,$,W.previous_month_income);O.push(te),$=Lo(te)}const N=$.accountEndBalances,U=$.categoryEndBalances,q=O.length>0?O[O.length-1]:x.length>0?x[x.length-1]:null;let I;q?I=await UT(t,w,U,q.year,q.month):(I={},w.forEach(W=>{I[W]=0}));const z={};Object.entries(b).forEach(([W,te])=>{z[W]={...te,balance:Ae(N[W]??0)}});const M={};Object.entries(_).forEach(([W,te])=>{M[W]={...te,balance:Ae(I[W]??0)}});const X=g.month_map||{},Y=new Set(x.map(W=>qe(W.year,W.month))),G={};for(const W of Object.keys(X))Y.has(W)?G[W]={}:G[W]=X[W];for(const W of x){const te=qe(W.year,W.month);te in G||(G[te]={})}for(const W of O)Pe.setQueryData(Ee.month(t,W.year,W.month),{month:W});if(JSON.stringify(g.month_map)!==JSON.stringify(G)){i("initial-balance-calculation","Saving month map...");const{writeBudgetData:W}=await ka(async()=>{const{writeBudgetData:te}=await Promise.resolve().then(()=>tA);return{writeBudgetData:te}},void 0);await W({budgetId:t,updates:{month_map:G},description:"initial balance calculation: updating month_map"})}Pe.setQueryData(Ee.budget(t),{...p,budget:{...g,month_map:G},accounts:z,categories:M})}catch(p){const g=p instanceof Error?p.message:"Failed to calculate initial balances";console.error("[useInitialBalanceCalculation] Error calculating balances:",p),$n.add({type:"error",message:`Initial balance calculation failed: ${g}`,autoDismissMs:1e4})}finally{o("initial-balance-calculation")}})()},[e,t,n,r,i,o,l,d]),A.useEffect(()=>{t||(h.current=!1)},[t])}const Iz={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastBalancesTab:"categories",lastTransactionsTab:"income",lastSettingsTab:"categories",lastAdminTab:"budget",currentViewingDocument:{type:null},setCurrentViewingDocument:()=>{},setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,initialDataLoadComplete:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},gA=A.createContext(Iz);function kz({children:t}){const n=Mi().get_current_firebase_user(),[r,i]=A.useState(null),[o,l]=A.useState(new Date().getFullYear()),[d,h]=A.useState(new Date().getMonth()+1),[f,p]=A.useState("categories"),[g,b]=A.useState("categories"),[_,w]=A.useState("income"),x=A.useCallback(Me=>{p(Me),Me==="categories"||Me==="accounts"?b(Me):w(Me)},[]),[S,C]=A.useState("categories"),[T,R]=A.useState("budget"),[k,V]=A.useState("Budget"),$=A.useCallback(Me=>{V(Ge=>Ge===Me?Ge:Me)},[]),[D,O]=A.useState({type:null}),[N,U]=A.useState(!1),[q,I]=A.useState(!1),z=LT(n?.uid||null,n?.email||null),M=z.data&&z.data.budget_ids.length===0,X=CP(n?.uid||null,z.data||null,{enabled:!!n?.uid&&!!z.data&&M}),Y=EB(r,{enabled:!!r&&N}),[G,Z]=A.useState(!1);A.useEffect(()=>{if(!Y.data){Z(!1);return}const{budget:Me,payees:Ge,months:at}=Y.data,L=Date.now();Pe.setQueryData(Ee.budget(r),Me,{updatedAt:L}),Pe.setQueryData(Ee.payees(r),Ge,{updatedAt:L});for(const de of at)Pe.setQueryData(Ee.month(r,de.year,de.month),{month:de},{updatedAt:L});Z(!0)},[Y.data,r]),Rz({budgetId:r,enabled:!!r&&N&&G,initialDataLoadComplete:G,months:Y.data?.months||[]}),A.useEffect(()=>{r||Z(!1)},[r]);const W=z.data?.permission_flags?.is_admin===!0,te=z.data?.permission_flags?.is_test===!0,B=X.data?.pendingInvites||[],H=X.data?.budgets||[],ne=B.length>0;A.useEffect(()=>{if(!n||N||z.isLoading)return;const Me=z.data;if(!(!Me&&!z.isError))if(Me&&Me.budget_ids.length>0)i(Me.budget_ids[0]),I(!1),U(!0);else{if(X.isLoading)return;const Ge=X.data;I(!(Ge?.pendingInvites&&Ge.pendingInvites.length>0)),U(!0)}},[n,N,z.data,z.isLoading,z.isError,X.data,X.isLoading]);const re=A.useCallback(()=>{d===1?(l(Me=>Me-1),h(12)):h(Me=>Me-1)},[d]),ce=A.useCallback(()=>{d===12?(l(Me=>Me+1),h(1)):h(Me=>Me+1)},[d]),_e=A.useCallback(async Me=>{(Me?.force||!X.data)&&await X.refetch()},[X]),Te=A.useCallback(Me=>{i(Me),I(!1)},[]),oe=A.useCallback(async Me=>{if(!n)return null;try{const Ge=await kP(Me,n.uid);return Ge&&Ge.isInvited&&!Ge.hasAccepted?{budgetId:Me,budgetName:Ge.budgetName,ownerEmail:Ge.ownerEmail}:null}catch(Ge){return console.error("[BudgetContext] Error checking budget invite:",Ge),null}},[n]),be=A.useCallback(()=>Pe.clear(),[]),Ne={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:d,lastActiveTab:f,lastBalancesTab:g,lastTransactionsTab:_,lastSettingsTab:S,lastAdminTab:T,currentViewingDocument:D,setCurrentViewingDocument:O,setSelectedBudgetId:i,setCurrentYear:l,setCurrentMonthNumber:h,setLastActiveTab:x,setLastSettingsTab:C,setLastAdminTab:R,pageTitle:k,setPageTitle:$,isInitialized:N,needsFirstBudget:q,initialDataLoadComplete:G,goToPreviousMonth:re,goToNextMonth:ce,pendingInvites:B,hasPendingInvites:ne,accessibleBudgets:H,isAdmin:W,isTest:te,loadAccessibleBudgets:_e,switchToBudget:Te,checkBudgetInvite:oe,clearCache:be};return u.jsx(gA.Provider,{value:Ne,children:t})}function Je(){const t=A.useContext(gA);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const Dz=function(){},Mz={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:Dz},xd=A.createContext(Mz);function ZS({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:i,editName:o,isRenaming:l,onAccept:d,onSwitch:h,onStartEdit:f,onCancelEdit:p,onEditNameChange:g,onSaveEdit:b}){const _=e&&t.isOwner;return u.jsx("div",{style:{background:e?"color-mix(in srgb, var(--color-primary) 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, var(--color-primary) 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:i?u.jsxs("form",{onSubmit:b,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:u.jsx("input",{type:"text",value:o,onChange:w=>g(w.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[u.jsx("button",{type:"submit",disabled:l||!o.trim(),style:{background:"var(--color-success)",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:l||!o.trim()?.7:1,fontSize:"0.8rem"},children:l?"Saving...":"Save"}),u.jsx("button",{type:"button",onClick:p,disabled:l,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontWeight:500,opacity:l?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[u.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&u.jsx("span",{style:{background:"color-mix(in srgb, var(--color-success) 20%, transparent)",color:"var(--color-success)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&u.jsx("span",{style:{background:"color-mix(in srgb, var(--color-warning) 20%, transparent)",color:"var(--color-warning)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),_&&u.jsx("button",{onClick:f,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),u.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?u.jsx("button",{onClick:d,disabled:n,style:{background:"var(--color-success)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:u.jsx("button",{onClick:h,disabled:r,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}function yA({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in Zu?n:"bug",i=Zu[r];return u.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:i.bgColor,color:i.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:i.label})}function Oz({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:d,onToggleDone:h,onTypeClick:f}){return u.jsxs("div",{onDragOver:p=>{p.stopPropagation(),i(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),d(p)},style:{position:"relative"},children:[u.jsx("div",{style:{...XP,opacity:n?1:0,boxShadow:n?"0 0 8px var(--shadow-primary)":"none"}}),u.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:l,style:{...e0,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{...YP},children:""}),u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:pe.primary,flexShrink:0}}),u.jsx(yA,{type:t.feedback_type,onClick:f})]}),u.jsxs("div",{style:{marginLeft:"3.25rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",$y(t.created_at)]})]})]})]})}function Nz({item:t,onToggleDone:e,onTypeClick:n}){return u.jsxs("div",{style:{...e0,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:pe.primary,flexShrink:0}}),u.jsx(yA,{type:t.feedback_type,onClick:n})]}),u.jsxs("div",{style:{marginLeft:"2rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",$y(t.created_at)]}),t.completed_at&&u.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:pe.success},children:[" Completed: ",$y(t.completed_at)]})]})]})}function qn({noMargin:t}={}){return u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid var(--border-strong)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function _A(){const{state:t,closeModal:e}=xc();if(!t.isOpen)return null;const n=t.isComplete;return u.jsx("div",{style:{position:"fixed",inset:0,background:"var(--modal-backdrop)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:u.jsxs("div",{style:{background:"var(--surface-base)",color:"var(--text-primary)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px var(--shadow-overlay)"},onClick:r=>r.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&u.jsx(qn,{noMargin:!0}),t.migrationName]}),n&&u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),u.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"var(--color-error)":t.isComplete?"var(--color-success)":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),u.jsx("div",{style:{background:"var(--border-subtle)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?u.jsx("div",{style:{background:t.error?"var(--color-error)":t.isComplete?"var(--color-success)":"var(--color-primary)",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):u.jsx("div",{style:{background:t.error?"var(--color-error)":"var(--color-primary)",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&u.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&u.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&u.jsx("div",{style:{background:"var(--color-error-bg)",border:"1px solid var(--color-error-border)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"var(--color-error)"},children:t.error}),t.isComplete&&u.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"var(--color-error-bg)":"var(--color-primary)",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&u.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),u.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function _i({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:i=!1,onDownloadBackup:o,isDownloading:l=!1}){const[d,h]=A.useState(!1),f=A.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=A.useCallback(()=>{n(d?"downloaded":"already-have")},[d,n]),g=A.useCallback(()=>{n("cancelled"),e()},[n,e]);return u.jsxs(Qs,{isOpen:t,onClose:g,title:" Backup Recommended",children:[u.jsx("div",{style:{background:i?"color-mix(in srgb, var(--color-error) 15%, transparent)":"color-mix(in srgb, var(--color-warning) 15%, transparent)",border:`1px solid ${i?"color-mix(in srgb, var(--color-error) 40%, transparent)":"color-mix(in srgb, var(--color-warning) 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:i?"var(--color-error-light)":"var(--color-warning-light)",fontWeight:500,fontSize:"0.95rem"},children:i?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",u.jsx("strong",{children:r})]}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx($e,{variant:"secondary",onClick:f,disabled:l,actionName:"Download Backup Before Migration",style:{width:"100%"},children:l?u.jsxs(u.Fragment,{children:[u.jsx(qn,{noMargin:!0})," Downloading Backup..."]}):d?" Backup Downloaded":" Download Backup Now"})}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),u.jsx($e,{variant:i?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:l,children:d?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function bi({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,i]=A.useState(!1),[o,l]=A.useState(!1),[d,h]=A.useState(null),f=A.useCallback(_=>{h(()=>_),i(!0)},[]),p=A.useCallback(_=>{_!=="cancelled"&&d&&d(),h(null),i(!1)},[d]),g=A.useCallback(()=>{h(null),i(!1)},[]),b=A.useCallback(async()=>{if(n){l(!0);try{await n()}finally{l(!1)}}},[n]);return{promptBeforeAction:f,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?b:void 0,isDownloading:o}}}const Pz={onetime:{borderColor:"color-mix(in srgb, var(--color-migration-purple) 30%, transparent)",iconBg:"color-mix(in srgb, var(--color-migration-purple) 15%, transparent)",headerBg:"color-mix(in srgb, var(--color-migration-purple) 8%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, var(--color-migration-blue) 30%, transparent)",iconBg:"color-mix(in srgb, var(--color-migration-blue) 15%, transparent)",headerBg:"color-mix(in srgb, var(--color-migration-blue) 8%, transparent)"},utility:{borderColor:"color-mix(in srgb, var(--color-migration-green) 30%, transparent)",iconBg:"color-mix(in srgb, var(--color-migration-green) 15%, transparent)",headerBg:"color-mix(in srgb, var(--color-migration-green) 8%, transparent)"}};function o0({title:t,icon:e,description:n,type:r,children:i,onValidateAll:o,isValidating:l=!1,isAnyRunning:d=!1}){const h=Pz[r],f=l||d,p=()=>{o&&!f&&o()};return u.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[u.jsxs("div",{style:{background:h.headerBg,padding:"1.25rem 1.5rem",borderBottom:`2px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.875rem",flex:1},children:[u.jsx("span",{style:{fontSize:"1.75rem",background:h.iconBg,padding:"0.625rem",borderRadius:"10px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"48px",minHeight:"48px"},children:e}),u.jsxs("div",{children:[u.jsx("h3",{style:{margin:"0 0 0.375rem 0",fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em"},children:t}),u.jsx("p",{style:{margin:0,opacity:.75,fontSize:"0.9rem",lineHeight:1.4},children:n})]})]}),o&&u.jsx("button",{onClick:p,disabled:f,style:{background:"color-mix(in srgb, var(--color-migration-blue) 20%, transparent)",color:"var(--color-migration-blue-light)",border:"1px solid color-mix(in srgb, var(--color-migration-blue) 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:f?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:f?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:l?u.jsxs(u.Fragment,{children:[u.jsx(qn,{noMargin:!0})," Validating..."]}):" Validate All"})]}),u.jsx("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 1%, transparent)"},children:i})]})}const Bz={unknown:{color:"var(--text-muted)",icon:"",text:"Unknown"},clean:{color:"var(--color-success)",icon:"",text:"Clean"},"needs-action":{color:"var(--color-warning)",icon:"",text:"Needs Action"},running:{color:"var(--color-migration-blue-light)",icon:"",text:"Running"},complete:{color:"var(--color-success)",icon:"",text:"Complete"},error:{color:"var(--color-error)",icon:"",text:"Error"}};function Qa({name:t,description:e,status:n,statusText:r,onCheck:i,isChecking:o,onRun:l,isRunning:d=!1,actionText:h="Run",disabled:f=!1,itemCount:p,details:g,isDestructive:b=!1}){const[_,w]=A.useState(!1),x=Bz[n],S=r||x.text,C=f||d||o,T=()=>{i()},R=()=>{l&&l()},k=()=>{g&&w(!_)};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${x.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||o?u.jsx(qn,{noMargin:!0}):x.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),u.jsxs("div",{style:{color:x.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[S,p!==void 0&&p>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${x.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:T,disabled:C,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",opacity:C?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?u.jsx(qn,{noMargin:!0}):""}),l&&n==="needs-action"&&u.jsx("button",{onClick:R,disabled:C,style:{background:b?"var(--color-error)":"var(--color-primary)",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:C?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:d?u.jsx(qn,{noMargin:!0}):h}),g&&u.jsx("button",{onClick:k,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:_?"Collapse details":"Expand details",children:_?"":""})]})]}),_&&g&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function zz({name:t,description:e,onAction:n,actionText:r,actionIcon:i,isRunning:o=!1,disabled:l=!1,progress:d,error:h,isDestructive:f=!1}){const p=l||o,g=()=>{n()};return u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&u.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-error)",marginTop:"0.25rem"},children:h})]}),d!==void 0&&o&&u.jsxs("div",{style:{width:"100px",flexShrink:0},children:[u.jsx("div",{style:{background:"var(--border-subtle)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:u.jsx("div",{style:{background:f?"var(--color-error)":"var(--color-primary)",height:"100%",width:`${d}%`,transition:"width 0.3s"}})}),u.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[d,"%"]})]}),u.jsx("button",{onClick:g,disabled:p,style:{background:f?"var(--color-error)":"var(--color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?u.jsxs(u.Fragment,{children:[u.jsx(qn,{noMargin:!0})," Running..."]}):u.jsxs(u.Fragment,{children:[i&&u.jsx("span",{children:i}),r]})})]})})}function Lz(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function Uz(t,e,n,r){return e?n?`${r} month(s) need migration`:"No data to migrate":"No data scanned"}function Fz(t,e,n,r,i){return t?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&u.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.monthsProcessed>0&&u.jsxs("li",{children:[t.monthsProcessed," month(s) processed"]}),t.monthsUpdated>0&&u.jsxs("li",{children:[t.monthsUpdated," month(s) updated"]}),t.monthsUpdated===0&&t.monthsProcessed>0&&u.jsx("li",{children:"No months needed updates"})]}),t.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[u.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>u.jsx("li",{children:o},l)),t.errors.length>3&&u.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," month(s) with total_income or total_expenses fields."]}),r&&u.jsxs("div",{style:{opacity:.6,fontSize:"0.8rem"},children:[r.monthsWithTotalIncome>0&&`${r.monthsWithTotalIncome} with total_income`,r.monthsWithTotalIncome>0&&r.monthsWithTotalExpenses>0&&", ",r.monthsWithTotalExpenses>0&&`${r.monthsWithTotalExpenses} with total_expenses`]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All months are clean.",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalMonths," month(s) across ",r.totalBudgets," budget(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months with total_income or total_expenses fields."})}function Vz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){return u.jsx(Qa,{name:"Remove Total Fields Migration",description:"Removes total_income and total_expenses from month documents. These are calculated from income/expenses arrays on-the-fly.",status:Lz(t,e,n,o,l),statusText:Uz(t,e,n,r),isChecking:i,isRunning:o,onCheck:d,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:Fz(l,e,n,t,r)})}function $z(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function qz(t,e,n,r){return e?n?`${r} month(s) need migration`:"No data to migrate":"No data scanned"}function Hz(t,e,n,r,i){return t?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&u.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.monthsProcessed>0&&u.jsxs("li",{children:[t.monthsProcessed," month(s) processed"]}),t.monthsUpdated>0&&u.jsxs("li",{children:[t.monthsUpdated," month(s) updated"]}),t.monthsUpdated===0&&t.monthsProcessed>0&&u.jsx("li",{children:"No months needed updates"})]}),t.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[u.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>u.jsx("li",{children:o},l)),t.errors.length>3&&u.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," month(s) with previous_month_income field."]}),u.jsx("div",{style:{opacity:.6,fontSize:"0.8rem"},children:"This field is now calculated from the previous month's income array."})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All months are clean.",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalMonths," month(s) across ",r.totalBudgets," budget(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months with previous_month_income field."})}function Gz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){return u.jsx(Qa,{name:"Remove Previous Month Income Migration",description:"Removes previous_month_income from month documents. This is calculated from the previous month's income array on-the-fly.",status:$z(t,e,n,o,l),statusText:qz(t,e,n,r),isChecking:i,isRunning:o,onCheck:d,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:Hz(l,e,n,t,r)})}function Wz(t,e,n,r,i){return r?"running":i?i.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function Qz(t,e,n,r){return e?n?`${r} budget(s) need migration`:"No data to migrate":"No data scanned"}function Kz(t,e,n,r,i){return t?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&u.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.budgetsUpdated>0&&u.jsxs("li",{children:[t.budgetsUpdated," budget(s) updated"]}),t.budgetsUpdated===0&&t.budgetsProcessed>0&&u.jsx("li",{children:"No budgets needed updates"})]}),t.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[u.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,l)=>u.jsx("li",{children:o},l)),t.errors.length>3&&u.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",i," budget(s) missing percentage_income_months_back."]}),u.jsx("div",{style:{opacity:.6,fontSize:"0.8rem"},children:"Adds percentage_income_months_back: 1 so percentage-based allocations use previous month income by default."})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All budgets have percentage_income_months_back set.",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalBudgets," budget(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for budgets missing percentage_income_months_back."})}function Yz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){return u.jsx(Qa,{name:"Percentage Income Months Back",description:"Adds percentage_income_months_back to all budgets (default 1). Use budget settings to change how many months back percentage-based allocation income is taken from.",status:Wz(t,e,n,o,l),statusText:Qz(t,e,n,r),isChecking:i,isRunning:o,onCheck:d,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:Kz(l,e,n,t,r)})}function Xz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,removeTotalFieldsMigration:r,removePreviousMonthIncomeMigration:i,percentageIncomeMonthsBackMigration:o}){const l=r.isRunning||i.isRunning||o.isRunning;return u.jsx(u.Fragment,{children:u.jsxs(o0,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:l,children:[u.jsx(Vz,{status:r.status,hasData:r.hasData,needsMigration:r.needsMigration,totalItemsToFix:r.totalItemsToFix,isChecking:r.isScanning,isRunning:r.isRunning,result:r.result,onCheck:r.scanStatus,onRun:r.runMigration,disabled:t}),u.jsx(Gz,{status:i.status,hasData:i.hasData,needsMigration:i.needsMigration,totalItemsToFix:i.totalItemsToFix,isChecking:i.isScanning,isRunning:i.isRunning,result:i.result,onCheck:i.scanStatus,onRun:i.runMigration,disabled:t}),u.jsx(Yz,{status:o.status,hasData:!!o.status,needsMigration:o.needsMigration,totalItemsToFix:o.totalItemsToFix,isChecking:o.isScanning,isRunning:o.isRunning,result:o.result,onCheck:o.scanStatus,onRun:o.runMigration,disabled:t})]})})}const bA={unknown:{color:"var(--text-muted)",icon:""},clean:{color:"var(--color-success)",icon:""},"needs-action":{color:"var(--color-warning)",icon:""},running:{color:"var(--color-migration-blue-light)",icon:""},complete:{color:"var(--color-success)",icon:""},error:{color:"var(--color-error)",icon:""}};function Zz({check:t,disabled:e}){const n=bA[t.status],r=e||t.isRunning||t.isChecking;return u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?u.jsx(qn,{noMargin:!0}):n.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&u.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),u.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?u.jsx(qn,{noMargin:!0}):""}),t.canFix&&t.onFix&&u.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?u.jsx(qn,{noMargin:!0}):"Fix"})]})]})}function Jz({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:i,totalIssues:o,isScanning:l,isRunning:d,disabled:h,onRunOrphaned:f,onRunExpense:p,onRunTransfers:g}){const[b,_]=A.useState(!1),x=d?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?i?"needs-action":"clean":"unknown",S=bA[x],C=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(k=>k.transactionType==="income").length>0&&u.jsxs("span",{children:["Income: ",t.status.violations.filter(k=>k.transactionType==="income").length," "]}),t.status.violations.filter(k=>k.transactionType==="expense").length>0&&u.jsxs("span",{children:["Expenses: ",t.status.violations.filter(k=>k.transactionType==="expense").length," "]}),t.status.violations.filter(k=>k.transactionType==="adjustment").length>0&&u.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(k=>k.transactionType==="adjustment").length," "]}),t.status.violations.filter(k=>k.transactionType==="transfer").length>0&&u.jsxs("span",{children:["Transfers: ",t.status.violations.filter(k=>k.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:ty(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:f,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&u.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&u.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:ty(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:ty(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&u.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&u.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||d||l,R=()=>{C.forEach(k=>k.onCheck())};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${S.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||l?u.jsx(qn,{noMargin:!0}):S.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),u.jsxs("div",{style:{color:S.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[x==="unknown"?"Unknown":x==="clean"?"Clean":x==="running"?"Running":"Needs Action",o>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${S.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:R,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:l?u.jsx(qn,{noMargin:!0}):""}),u.jsx("button",{onClick:()=>_(!b),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:b?"Collapse":"Expand",children:b?"":""})]})]}),b&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:C.map(k=>u.jsx(Zz,{check:k,disabled:h},k.id))})]})}function ty(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function e4({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return _>0?`Fixed ${_}`:"Complete"}},b=()=>{if(l){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsFixed>0&&u.jsxs("li",{children:[l.accountsFixed," account balance(s) fixed"]}),l.categoriesFixed>0&&u.jsxs("li",{children:[l.categoriesFixed," category value(s) fixed"]}),l.totalAvailableFixed>0&&u.jsxs("li",{children:[l.totalAvailableFixed," total_available value(s) fixed"]}),l.monthsProcessed>0&&u.jsxs("li",{children:[l.monthsProcessed," month(s) updated"]}),l.incomeValuesFixed>0&&u.jsxs("li",{children:[l.incomeValuesFixed," income amount(s) fixed"]}),l.expenseValuesFixed>0&&u.jsxs("li",{children:[l.expenseValuesFixed," expense amount(s) fixed"]}),l.categoryBalancesFixed>0&&u.jsxs("li",{children:[l.categoryBalancesFixed," category balance(s) fixed"]}),l.accountBalancesFixed>0&&u.jsxs("li",{children:[l.accountBalancesFixed," account balance(s) fixed"]}),_===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((w,x)=>u.jsx("li",{children:w},x)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:"Precision issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&u.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return u.jsx(Qa,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:d,isChecking:i,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:f,itemCount:n?r:void 0,details:b(),isDestructive:!0})}function t4({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0)return l.monthsUpdated>0?`Updated ${l.monthsUpdated} month(s)`:"Complete"},b=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Recalculation complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) processed"]}),l.monthsProcessed>0&&u.jsxs("li",{children:[l.monthsProcessed," month(s) processed"]}),l.monthsUpdated>0&&u.jsxs("li",{children:[l.monthsUpdated," month(s) updated"]}),l.monthsUpdated===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((_,w)=>u.jsx("li",{children:_},w)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:"Months needing recalculation:"}),u.jsx("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:u.jsxs("li",{children:[t.monthsNeedingRecalculation," month(s) from first month up to earliest window month"]})}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All start balances are up to date.",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months needing recalculation."});return u.jsx(Qa,{name:"Recalculate Start Balances",description:"Recalculates and saves start_balance for all months from the first month up to the earliest month in the window",status:p(),statusText:g(),onCheck:d,isChecking:i,onRun:h,isRunning:o,actionText:n?`Recalculate ${r}`:void 0,disabled:f,itemCount:n?r:void 0,details:b(),isDestructive:!0})}function n4({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:f}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.monthsAdded+l.orphanedEntriesRemoved;return _>0?`Fixed ${_} issue(s)`:"Complete"}},b=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Repair complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) processed"]}),l.budgetsUpdated>0&&u.jsxs("li",{children:[l.budgetsUpdated," budget(s) updated"]}),l.monthsAdded>0&&u.jsxs("li",{children:[l.monthsAdded," month(s) added to month_map"]}),l.orphanedEntriesRemoved>0&&u.jsxs("li",{children:[l.orphanedEntriesRemoved," orphaned entry(ies) removed"]}),l.monthsAdded===0&&l.orphanedEntriesRemoved===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((_,w)=>u.jsx("li",{children:_},w)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:"Month_map issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.totalMissingMonths>0&&u.jsxs("li",{children:[t.totalMissingMonths," month(s) missing from month_map"]}),t.totalOrphanedEntries>0&&u.jsxs("li",{children:[t.totalOrphanedEntries," orphaned entry(ies) in month_map"]}),t.budgetsNeedingRepair>0&&u.jsxs("li",{children:[t.budgetsNeedingRepair," budget(s) need repair"]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All month_map entries are up to date.",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for month_map issues."});return u.jsx(Qa,{name:"Repair Month Map",description:"Updates month_map for all budgets by adding missing months and removing orphaned entries",status:p(),statusText:g(),onCheck:d,isChecking:i,onRun:h,isRunning:o,actionText:n?`Repair ${r}`:void 0,disabled:f,itemCount:n?r:void 0,details:b(),isDestructive:!0})}function r4({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,precisionCleanup:d,recalculateStartBalances:h,repairMonthMap:f}){const p=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning||h.isScanning||f.isScanning,g=i.isRunning||o.isRunning||l.isRunning||d.isRunning||h.isRunning||f.isRunning,b=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan(),h.scanStatus(),f.scanStatus()])},_=bi({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),w=bi({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),x=bi({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),S=bi({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),C=bi({migrationName:"Recalculate Start Balances Migration",isDestructive:!0,onDownloadBackup:e}),T=bi({migrationName:"Repair Month Map Migration",isDestructive:!0,onDownloadBackup:e}),R=r.hasViolations||i.hasItemsToFix||o.hasItemsToMigrate||l.hasPairsToConvert,k=(r.violationCount||0)+(i.totalOrphaned||0)+(o.totalToMigrate||0)+(l.totalPairs||0);return u.jsxs(u.Fragment,{children:[u.jsxs(o0,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:b,isValidating:p,isAnyRunning:g,children:[u.jsx(Jz,{accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,needsAction:R,totalIssues:k,isScanning:r.isScanning||i.isScanning||o.isScanning||l.isScanning,isRunning:i.isRunning||o.isRunning||l.isRunning,disabled:t,onRunOrphaned:()=>_.promptBeforeAction(i.runMigration),onRunExpense:()=>w.promptBeforeAction(o.runMigration),onRunTransfers:()=>x.promptBeforeAction(l.runMigration)}),u.jsx(e4,{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isChecking:d.isScanning,isRunning:d.isRunning,result:d.result,onCheck:d.scan,onRun:()=>S.promptBeforeAction(d.runCleanup),disabled:t}),u.jsx(t4,{status:h.status,hasData:h.hasData,needsMigration:h.needsMigration,totalItemsToFix:h.totalItemsToFix,isChecking:h.isScanning,isRunning:h.isRunning,result:h.result,onCheck:h.scanStatus,onRun:()=>C.promptBeforeAction(h.runMigration),disabled:t}),u.jsx(n4,{status:f.status,hasData:f.hasData,needsMigration:f.needsMigration,totalItemsToFix:f.totalItemsToFix,isChecking:f.isScanning,isRunning:f.isRunning,result:f.result,onCheck:f.scanStatus,onRun:()=>T.promptBeforeAction(f.runMigration),disabled:t})]}),u.jsx(_i,{..._.promptProps,isDownloading:n}),u.jsx(_i,{...w.promptProps,isDownloading:n}),u.jsx(_i,{...x.promptProps,isDownloading:n}),u.jsx(_i,{...S.promptProps,isDownloading:n}),u.jsx(_i,{...C.promptProps,isDownloading:n}),u.jsx(_i,{...T.promptProps,isDownloading:n})]})}function s4({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:i,isUploading:o,uploadStatus:l,uploadProgress:d,uploadError:h,uploadResult:f,onScan:p,onUpload:g,disabled:b}){const _=A.useRef(null),[w,x]=A.useState(null),[S,C]=A.useState(!1),T=async q=>{const I=q.target.files?.[0];I&&(x(I),await p(I))},R=l!==null,k=R&&(l.budgetsFound>0||l.monthsFound>0),V=b||t||i||o,$=f?.success?"var(--color-success)":k?"var(--color-warning)":R?"var(--color-success)":"var(--text-muted)",D=f?.success?"":o||i||t?"":k?"":R?"":"",O=f?.success?"Uploaded":o?"Uploading":i?"Scanning":t?"Downloading":k?`${l.budgetsFound} budget(s), ${l.monthsFound} month(s) ready`:R?"Nothing to upload":"Select file",N=t?e?.percentComplete:d?.percentComplete,U=n||h;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${$} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||i||t?u.jsx(qn,{noMargin:!0}):D}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),u.jsx("div",{style:{color:$,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:O}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{r()},disabled:V,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:V?"not-allowed":"pointer",fontSize:"0.8rem",opacity:V?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?u.jsx(qn,{noMargin:!0}):""}),u.jsx("input",{ref:_,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),u.jsx("button",{onClick:()=>_.current?.click(),disabled:V,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:V?"not-allowed":"pointer",fontSize:"0.8rem",opacity:V?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:i?u.jsx(qn,{noMargin:!0}):""}),k&&w&&u.jsx("button",{onClick:async()=>{await g(w)},disabled:V,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:V?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:V?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?u.jsx(qn,{noMargin:!0}):"Upload"}),(R||f||U)&&u.jsx("button",{onClick:()=>C(!S),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:S?"Collapse":"Expand",children:S?"":""})]})]}),(t||o)&&N!==void 0&&u.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[u.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${N}%`,height:"100%",background:"var(--color-primary)",transition:"width 0.3s ease"}})}),u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:d?.phase,": ",N,"%"]})]}),S&&(R||f||U)&&u.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[U&&u.jsxs("div",{style:{marginBottom:"0.75rem",color:"var(--color-error)"},children:[" Error: ",U]}),f&&u.jsx("div",{style:{marginBottom:l?"0.75rem":0,color:f.success?"var(--color-success)":"var(--color-error)"},children:f.success?u.jsxs(u.Fragment,{children:[" Restored ",f.budgetsRestored," budget(s), ",f.monthsRestored," month(s), ",f.payeesRestored," payee doc(s)"]}):u.jsxs(u.Fragment,{children:[" Upload failed: ",f.errors.join(", ")]})}),l&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:[u.jsx("strong",{children:"Found in zip:"})," ",l.budgetsFound," budget(s), ",l.monthsFound," month(s), ",l.payeesFound," payee doc(s)"]}),l.budgetsToRestore.length>0&&u.jsxs("div",{children:[u.jsx("strong",{children:"Budgets to restore:"})," ",l.budgetsToRestore.join(", ")]})]})]})]})}function i4({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:i,deleteResult:o,onCheck:l,onDelete:d,disabled:h}){const[f,p]=A.useState(!1),g=()=>i?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",b=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,_=()=>{p(!0)},w=()=>{p(!1),d()},x=()=>o?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&u.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[u.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((S,C)=>u.jsx("li",{children:S},C)),o.errors.length>3&&u.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?u.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-error)"},children:" DESTRUCTIVE ACTION"}),u.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return u.jsxs(u.Fragment,{children:[u.jsx(Qa,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:b(),onCheck:l,isChecking:r,onRun:e>0?_:void 0,isRunning:i,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:x(),isDestructive:!0}),u.jsxs(Qs,{isOpen:f,onClose:()=>p(!1),title:" Delete All Months?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, var(--color-error) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-error) 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"var(--color-error-light)",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"var(--color-error)"},children:[e," month(s)"]})," across"," ",u.jsxs("strong",{style:{color:"var(--color-error)"},children:[n," budget(s)"]}),"."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"All account balances  $0"}),u.jsx("li",{children:"All category balances  $0"}),u.jsx("li",{children:"Month history cleared"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),u.jsxs($e,{variant:"danger",actionName:"Confirm Delete All Months",onClick:w,children:[" Delete All ",e," Months"]})]})]})]})}function a4({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:i,isDeleting:o,deleteResult:l,onCheck:d,onDelete:h,disabled:f}){const[p,g]=A.useState(!1),b=t?.staleBudgetIds??[],_=b.length>0,w=()=>o?"running":e?l&&l.errors.length===0?"complete":n===0&&!_?"clean":"needs-action":"unknown",x=()=>l&&l.errors.length===0?`Deleted ${l.budgetsDeleted}`:n===0&&!_?"Clean":_?`${b.length} stale ref(s)`:`${n} budget(s)`,S=()=>{g(!0)},C=()=>{g(!1),h()},T=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsDeleted>0&&u.jsxs("li",{children:[l.budgetsDeleted," budget(s) deleted"]}),l.monthsDeleted>0&&u.jsxs("li",{children:[l.monthsDeleted," month(s) deleted"]}),l.payeesDeleted>0&&u.jsxs("li",{children:[l.payeesDeleted," payee doc(s) deleted"]})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((k,V)=>u.jsx("li",{children:k},V)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n===0&&!_?u.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):_?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:" Found stale budget references:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[b.slice(0,3).map(k=>u.jsx("li",{style:{opacity:.8},children:k},k)),b.length>3&&u.jsxs("li",{style:{opacity:.6},children:["...and ",b.length-3," more"]})]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:" Sample user budget found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[n," budget(s)"]}),u.jsxs("li",{children:[r," month(s)"]})]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),R=n>0||_;return u.jsxs(u.Fragment,{children:[u.jsx(Qa,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:w(),statusText:x(),onCheck:d,isChecking:i,onRun:R?S:void 0,isRunning:o,actionText:"Delete",disabled:f,itemCount:R?n||b.length:void 0,details:T(),isDestructive:!0}),u.jsxs(Qs,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, var(--color-warning) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-warning) 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"var(--color-warning-light)",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"var(--color-warning)"},children:[n," budget(s)"]})," and"," ",u.jsxs("strong",{style:{color:"var(--color-warning)"},children:[r," month(s)"]}),"."]}),_&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",u.jsxs("strong",{style:{color:"var(--color-warning)"},children:[b.length," stale reference(s)"]})," from the user document."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"Budget document deleted"}),u.jsx("li",{children:"All month documents deleted"}),u.jsx("li",{children:"Payees document deleted"}),u.jsx("li",{children:"User will see onboarding flow"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),u.jsx($e,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:C,children:" Delete Sample User Data"})]})]})]})}function o4({onClearCache:t,disabled:e}){const[n,r]=A.useState(!1),i=()=>{r(!0)},o=()=>{r(!1),t()};return u.jsxs(u.Fragment,{children:[u.jsx(zz,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:i,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),u.jsxs(Qs,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data and reload the page. The app will fetch fresh data from Firestore for everything."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),u.jsx($e,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function l4({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,deleteAllMonths:i,deleteSampleUserBudget:o,onClearCache:l}){const d=r.isDownloading||r.isUploading||i.isDeleting||o.isDeleting,h=bi({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),f=bi({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),p=bi({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e});return u.jsxs(u.Fragment,{children:[u.jsxs(o0,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:d,children:[u.jsx(s4,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async g=>{p.promptBeforeAction(()=>{r.uploadBudget(g).catch(b=>console.error("Upload failed:",b))})},disabled:t}),u.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[u.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),u.jsx(i4,{status:i.status,hasData:i.hasData,monthsCount:i.monthsCount,budgetCount:i.budgetCount,isChecking:i.isScanning,isDeleting:i.isDeleting,deleteResult:i.deleteResult,deleteProgress:i.deleteProgress,onCheck:i.scanStatus,onDelete:()=>h.promptBeforeAction(i.deleteAllMonths),disabled:t}),u.jsx(a4,{status:o.status,hasData:o.hasData,totalBudgets:o.totalBudgets,totalMonths:o.totalMonths,isChecking:o.isScanning,isDeleting:o.isDeleting,deleteResult:o.deleteResult,deleteProgress:o.deleteProgress,onCheck:o.scanStatus,onDelete:()=>f.promptBeforeAction(o.deleteSampleUserBudget),disabled:t}),u.jsx(o4,{onClearCache:l,disabled:t})]})]}),u.jsx(_i,{...h.promptProps,isDownloading:n}),u.jsx(_i,{...f.promptProps,isDownloading:n}),u.jsx(_i,{...p.promptProps,isDownloading:n})]})}function c4({message:t="Loading...",spinnerColor:e=pe.primary,children:n,spinnerSize:r=4}){return u.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"var(--loading-overlay-bg)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[u.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid var(--loading-overlay-content-border)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),u.jsx("p",{style:{color:"var(--loading-overlay-text)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,u.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function u4(){return u.jsxs("div",{style:Lf,children:[u.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:u.jsx(Tn,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),u.jsx("h1",{children:"Tarron Lane Homepage"}),u.jsx("nav",{children:u.jsxs("ul",{children:[u.jsx("li",{children:u.jsx(Tn,{to:"/sql-test",children:"SQL Test"})}),u.jsx("li",{children:u.jsx(Tn,{to:"/budget",children:"Budget"})}),u.jsx("li",{children:u.jsx(Tn,{to:"/account",children:"Account"})})]})})]})}function d4(){const t=A.useContext(xd),e=Mi(),[n,r]=A.useState(!1),i=tr(),o=td(),l=i.state?.from||"/";A.useEffect(()=>{t.is_logged_in&&l!=="/"&&o(l,{replace:!0})},[t.is_logged_in,l,o]);function d(){r(!0),e.logout_firebase_user().then(function(){Pe.clear(),window.location.href="/"})}return u.jsxs("div",{style:Lf,children:[u.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx(Tn,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),u.jsxs(Tn,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),u.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:u.jsx(fA,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),u.jsx("h1",{children:"Account"}),t.is_logged_in?n?u.jsx("p",{children:"Logging Out..."}):u.jsxs(u.Fragment,{children:[u.jsxs("p",{children:["You are logged in as ",t.username]}),u.jsx("button",{onClick:d,style:{marginTop:"1rem"},children:"Logout"})]}):u.jsx(h4,{})]})}function h4(){const t=Mi(),[e,n]=A.useState(""),[r,i]=A.useState(""),[o,l]=A.useState(!1),[d,h]=A.useState(!1),[f,p]=A.useState("");function g(w){n(w.target.value)}function b(w){i(w.target.value)}function _(w){w.preventDefault(),h(!0),p(""),Pe.clear(),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return u.jsxs("form",{onSubmit:_,children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"username",children:"Email: "}),u.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"password",children:"Password: "}),u.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[u.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:b,style:{paddingRight:"2rem"}}),u.jsx("button",{type:"button",onClick:()=>l(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),d?u.jsx("p",{children:"Logging in..."}):u.jsx("button",{children:"Login"}),f&&u.jsx("p",{style:{color:"red"},children:f})]})}const f4={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"};function m4({activeTab:t,setActiveTab:e,lastBalancesTab:n,lastTransactionsTab:r,allocationsFinalized:i}){const o=f4[t],l=A.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),d=A.useMemo(()=>[{id:"categories",label:"Categories",checkmark:i},{id:"accounts",label:"Accounts"}],[i]),h=A.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),f=g=>{e(g==="balances"?n:r)},p=o==="balances"?d:h;return u.jsxs("div",{children:[u.jsx(Vf,{mode:"button",tabs:l,activeTab:o,onTabChange:f,variant:"segmented"}),u.jsx(Vf,{mode:"button",tabs:p,activeTab:t,onTabChange:g=>e(g),variant:"secondary"})]})}function JS({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:i}){const[o,l]=A.useState(!1),d=n||e,h=t==="prev"?"":"",f=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(l(!0),setTimeout(()=>l(!1),2e3)):i())};return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("button",{onClick:p,onMouseEnter:()=>e&&l(!0),onMouseLeave:()=>l(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:d?"not-allowed":"pointer",fontSize:"1.25rem",opacity:d?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:f,children:h}),o&&e&&r&&u.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:pe.warning,color:"var(--color-warning-on-warning)",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px var(--shadow-overlay)"},children:r})]})}function p4({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:i,maxOrdinal:o,minAllowed:l,maxAllowed:d,monthMap:h,onYearChange:f,onMonthChange:p,onGo:g}){const b=t>l.year,_=t<d.year,w=Number(qe(t,e)),x=h?qe(t,e)in h:!1,S=w<=o,C=(x||S)&&w>=i;return u.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[u.jsx("button",{onClick:()=>f(t-1),disabled:!b,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:b?"pointer":"not-allowed",fontSize:"0.8rem",opacity:b?1:.3},title:b?"Previous year":"Cannot go further back",children:""}),u.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),u.jsx("button",{onClick:()=>f(t+1),disabled:!_,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:_?"pointer":"not-allowed",fontSize:"0.8rem",opacity:_?1:.3},title:_?"Next year":"Cannot go further ahead",children:""})]}),u.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:zf.map((T,R)=>{const k=R+1,V=k===e,$=t===n&&k===r,D=Number(qe(t,k)),O=qe(t,k),N=D<i,U=D>o,q=D<Number(qe(n,r)),I=h?O in h:!1,z=N||U||q&&!I;let M=T;return N?M="Too far in the past":U?M="Too far in the future":q&&!I&&(M="Month not in budget"),u.jsx("button",{onClick:()=>p(k),disabled:z,style:{background:V?pe.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:$?`1px solid ${pe.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:z?"not-allowed":"pointer",fontSize:"0.7rem",color:V?"var(--color-primary-on-primary)":"inherit",opacity:z?.3:1,transition:"background 0.15s"},title:M,children:T.slice(0,3)},k)})}),u.jsxs("button",{onClick:g,disabled:!C,style:{width:"100%",background:C?pe.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:C?"pointer":"not-allowed",fontSize:"0.85rem",color:C?"var(--color-primary-on-primary)":"inherit",fontWeight:500,opacity:C?1:.5},children:["Go to ",zf[e-1]," ",t]})]})}function g4({isOpen:t,onClose:e,year:n,month:r,isDeleting:i,onConfirm:o}){return u.jsxs(Qs,{isOpen:t,onClose:e,title:" Delete Month?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, var(--color-error) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-error) 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsxs("p",{style:{margin:0,color:"var(--color-error-light)",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",zf[r-1]," ",n,"!"]})}),u.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:i,children:"Cancel"}),u.jsx($e,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:i,children:i?"Deleting...":" Delete Month"})]})]})}function y4(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+Ws;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function _4(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-W_;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function b4(t){return Object.keys(t).sort()[0]}function v4(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function x4(t){const e=b4(t);return e?v4(e):_4()}function e1(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function w4(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function S4({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=jn(),{currentYear:r,currentMonthNumber:i,isAdmin:o,selectedBudgetId:l,setCurrentYear:d,setCurrentMonthNumber:h}=Je(),{budget:f,monthMap:p}=Rn(),{month:g}=Ys(l,r,i),b=e1(r,i),_=w4(r,i),w=y4(),x=Number(qe(w.year,w.month)),C=Number(qe(_.year,_.month))>x,T=qe(b.year,b.month),R=p?T in p:!1,k=!R,V=x4(p||{}),$=Number(qe(V.year,V.month)),[D,O]=A.useState(!1),[N,U]=A.useState(!1),[q,I]=A.useState(r),[z,M]=A.useState(i),[X,Y]=A.useState(!1),[G,Z]=A.useState(!1),W=A.useRef(null),te=(()=>{if(!p||Object.keys(p).length===0)return!1;const _e=qe(r,i),Te=Math.max(...Object.keys(p).map(Number));return Number(_e)===Te})(),{trackChange:B}=vd();async function H(){if(l){Z(!0);try{const _e=Ia(l,r,i);vP(l,r,i,B),await Fy("months",_e,`deleting month ${r}/${i}`),`${r}${i}`,Pe.removeQueries({queryKey:Ee.month(l,r,i)});const Te=e1(r,i);Y(!1),O(!1),window.location.href=`/budget/${Te.year}/${Te.month}/categories`}catch(_e){console.error("Failed to delete month:",_e),alert(`Failed to delete month: ${_e instanceof Error?_e.message:"Unknown error"}`)}finally{Z(!1)}}}A.useEffect(()=>{if(!D)return;function _e(Te){W.current&&!W.current.contains(Te.target)&&(O(!1),U(!1))}return document.addEventListener("mousedown",_e),()=>document.removeEventListener("mousedown",_e)},[D]);function ne(){N||(I(r),M(i)),U(!N)}function re(){d(q),h(z),U(!1),O(!1)}async function ce(){if(!g||!f)return;const _e=new Date,oe=`${_e.toISOString().split("T")[0]}_month_${r}_${String(i).padStart(2,"0")}`,be=new Dm,Ne=[{name:`${oe}_income.json`,data:g.income||[]},{name:`${oe}_expenses.json`,data:g.expenses||[]},{name:`${oe}_transfers.json`,data:g.transfers||[]},{name:`${oe}_adjustments.json`,data:g.adjustments||[]},{name:`${oe}_account_balances.json`,data:g.account_balances||[]},{name:`${oe}_category_balances.json`,data:g.category_balances||[]}],Me={budget_id:f.id,budget_name:f.name,year_month_ordinal:g.year_month_ordinal,year:g.year,month:g.month,total_income:g.total_income,previous_month_income:g.previous_month_income,total_expenses:g.total_expenses,are_allocations_finalized:g.are_allocations_finalized,created_at:g.created_at,updated_at:g.updated_at,downloaded_at:_e.toISOString()};Ne.push({name:`${oe}_metadata.json`,data:Me});for(const de of Ne)be.file(de.name,JSON.stringify(de.data,null,2));const Ge=await be.generateAsync({type:"blob"}),at=URL.createObjectURL(Ge),L=document.createElement("a");L.href=at,L.download=`${oe}.zip`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(at),O(!1)}return u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[u.jsx(JS,{direction:"prev",isDisabled:k,isLoading:n,disabledReason:R?void 0:"No previous month available in this budget",onNavigate:t}),u.jsxs("div",{ref:W,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[zf[i-1]," ",r]}),u.jsx("button",{onClick:()=>O(!D),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:D?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&u.jsxs(u.Fragment,{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:pe.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),u.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),D&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--sticky-header-bg)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px var(--shadow-overlay)"},children:[u.jsx("button",{onClick:ne,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),N&&u.jsx(p4,{pickerYear:q,pickerMonth:z,currentYear:r,currentMonthNumber:i,minOrdinal:$,maxOrdinal:x,minAllowed:V,maxAllowed:w,monthMap:p,onYearChange:I,onMonthChange:M,onGo:re}),o&&g&&u.jsx("button",{onClick:()=>{ce()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&g&&te&&u.jsx("button",{onClick:()=>Y(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"var(--color-error)",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),u.jsx(JS,{direction:"next",isDisabled:C,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),u.jsx(g4,{isOpen:X,onClose:()=>Y(!1),year:r,month:i,isDeleting:G,onConfirm:H})]})}const l0={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},E4={...l0,background:pe.primary,border:"none",color:"white"},C4={...l0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},T4={...l0,background:"transparent",border:`1px solid ${pe.errorBorder}`,color:pe.error},t1=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${pe.error} 15%, transparent)`:`color-mix(in srgb, ${pe.success} 15%, transparent)`,border:`1px solid ${t?pe.errorBorder:"var(--color-success-border)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?pe.error:pe.success,transition:"all 0.15s ease",flexShrink:0});function c0({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,config:h,onSubmit:f,onCancel:p,onDelete:g,extraContent:b}){const{isWide:_}=XT(),{showCategory:w=!1,showCleared:x=!1,showSignToggle:S=!1,accountLabel:C="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:R="Optional note",submitLabel:k}=h,V=new Date().toISOString().split("T")[0],[$,D]=A.useState(o?.date||d||V),[O,N]=A.useState(o?.payee||""),[U,q]=A.useState(o?.categoryId||(h.showNoCategoryOption?Yt:"")),[I,z]=A.useState(o?.accountId||l||(h.showNoAccountOption?Ht:t[0]?t[0][0]:"")),M=o?.amount!==void 0?Math.abs(o.amount):void 0,[X,Y]=A.useState(M?.toString()||""),[G,Z]=A.useState(o?.description||""),[W,te]=A.useState(o?.cleared||!1),[B,H]=A.useState(()=>S?o?.amount!==void 0?o.amount<0:!1:!0),[ne,re]=A.useState(!1),ce={},_e=[];t.forEach(([we,ie])=>{ie.account_group_id?(ce[ie.account_group_id]||(ce[ie.account_group_id]=[]),ce[ie.account_group_id].push([we,ie])):_e.push([we,ie])});function Te(we){we.preventDefault();const ie=parseFloat(X);if(isNaN(ie)||ie<=0||w&&!U||!I||!$)return;if(U===Yt&&I===Ht){re(!0);return}re(!1);const Oe=S&&B?-ie:ie;f({date:$,payee:O.trim()||void 0,categoryId:w?U:void 0,accountId:I,amount:Oe,description:G.trim()||void 0,cleared:x?W:void 0})}!(U===Yt&&I===Ht)&&ne&&re(!1);const Me=h.showNoAccountOption?u.jsx(YT,{id:"txn-account",value:I,onChange:z,accounts:t,accountGroups:e,placeholder:La,required:!0,showNoAccountOption:!0}):u.jsxs(Xu,{id:"txn-account",value:I,onChange:we=>z(we.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([we,ie])=>{const Re=ce[we];return Re?.length?u.jsx("optgroup",{label:ie.name,children:Re.map(([Be,Oe])=>u.jsx("option",{value:Be,children:Oe.nickname},Be))},we):null}),_e.length>0&&u.jsx("optgroup",{label:"Other",children:_e.map(([we,ie])=>u.jsx("option",{value:we,children:ie.nickname},we))})]}),Ge=w&&n&&r?u.jsx(Nt,{label:"Category",htmlFor:"txn-category",children:u.jsx(KT,{id:"txn-category",value:U,onChange:q,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?zo:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,at=x?u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Qr,{id:"txn-cleared",checked:W,onChange:we=>te(we.target.checked)})]}):null,L=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:k,style:E4,children:""}),u.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:C4,children:""}),g&&u.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:T4,children:""})]})]}),de=ne?u.jsx("div",{style:{background:`color-mix(in srgb, ${pe.error} 15%, transparent)`,border:`1px solid ${pe.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:pe.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,ge=u.jsxs(Ga,{children:[u.jsx($e,{type:"submit",actionName:k,children:k}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&u.jsx($e,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),ee=w&&n&&r,J={fontSize:"0.85rem",padding:"0.5rem"};if(!_)return u.jsxs(Ii,{actionName:k,onSubmit:Te,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Nt,{label:"Date",htmlFor:"txn-date",children:u.jsx(Ff,{id:"txn-date",value:$,onChange:we=>D(we.target.value),required:!0,autoFocus:!0})}),u.jsx(Nt,{label:S?B?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>H(!B),style:t1(B),title:B?"Click to make this a refund (+)":"Click to make this an expense (-)",children:B?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(Io,{id:"txn-amount",value:X,onChange:Y,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:B?pe.error:pe.success}})})]}):u.jsx(Io,{id:"txn-amount",value:X,onChange:Y,placeholder:"$0.00",required:!0})})]}),u.jsx(Nt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(FS,{id:"txn-payee",value:O,onChange:N,payees:i,placeholder:T})}),Ge,u.jsx(Nt,{label:C,htmlFor:"txn-account",children:Me}),u.jsx(Nt,{label:"Description (optional)",htmlFor:"txn-description",children:u.jsx(ki,{id:"txn-description",value:G,onChange:we=>Z(we.target.value),placeholder:R})}),x&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Qr,{id:"txn-cleared-stacked",checked:W,onChange:we=>te(we.target.checked)}),u.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),de,b]}),ge]});const ae=S?"8.25rem":"6rem",Se=ee?x?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${ae} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${ae} minmax(10rem, 2fr) auto`:x?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${ae} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${ae} minmax(12rem, 2fr) auto`;return u.jsxs(Ii,{actionName:k,onSubmit:Te,children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:Se,gap:"1rem",alignItems:"end"},children:[u.jsx(Nt,{label:"Date",htmlFor:"txn-date",children:u.jsx(Ff,{id:"txn-date",value:$,onChange:we=>D(we.target.value),required:!0,style:J,autoFocus:!0})}),u.jsx(Nt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(FS,{id:"txn-payee",value:O,onChange:N,payees:i,placeholder:T})}),Ge,u.jsx(Nt,{label:C,htmlFor:"txn-account",children:Me}),u.jsx(Nt,{label:S?B?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>H(!B),style:t1(B),title:B?"Click to make this a refund (+)":"Click to make this an expense (-)",children:B?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(Io,{id:"txn-amount",value:X,onChange:Y,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:B?pe.error:pe.success}})})]}):u.jsx(Io,{id:"txn-amount",value:X,onChange:Y,placeholder:"$0.00",required:!0})}),u.jsx(Nt,{label:"Description",htmlFor:"txn-description",children:u.jsx(ki,{id:"txn-description",value:G,onChange:we=>Z(we.target.value),placeholder:R,style:J})}),at,L]}),de,b]})}function n1({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:f}){function p(g){l(g.amount,g.accountId,g.date,g.payee,g.description)}return u.jsx(c0,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:i,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:f},onSubmit:p,onCancel:d,onDelete:h})}function A4({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:i,isMobile:o,isEvenRow:l}){const d=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,f=l?"transparent":"var(--row-alt-bg)";if(o)return u.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:f,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:d}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsxs("span",{style:{fontWeight:600,color:pe.success,fontFamily:"monospace"},children:["+",Xt(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:f,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:d})}),u.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...p,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:pe.success,fontFamily:"monospace"},children:["+",Xt(t.amount)]}),u.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Nl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function j4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Je(),{accounts:o,accountGroups:l}=Rn(),{month:d,isLoading:h}=Ys(t,e,n),{addIncome:f}=uz(),{updateIncome:p}=hz(),{deleteIncome:g}=fz(),b=Oi(),[_,w]=A.useState(null),[x,S]=A.useState(!1),[C,T]=A.useState(null),V=Y_(t,{enabled:x||C!==null}).data||[];function $(G){const Z=G.account_group_id?l[G.account_group_id]:void 0;return Z&&Z.is_active!==null?Z.is_active:G.is_active!==!1}function D(G){const Z=G.account_group_id?l[G.account_group_id]:void 0;return Z&&Z.on_budget!==null?Z.on_budget:G.on_budget!==!1}const O=Object.entries(o).filter(([,G])=>$(G)&&D(G)),N=O.filter(([,G])=>G.is_income_account),U=N.length>0?N:O,q=O.find(([,G])=>G.is_income_default),I=q?q[0]:void 0,z=d?.income.reduce((G,Z)=>G+Z.amount,0)||0;function M(G,Z,W,te,B){if(!t)return;w(null),S(!1);const{year:H,month:ne}=wm(W);(H!==e||ne!==n)&&(r(H),i(ne)),f(t,H,ne,G,Z,W,te,B).catch(re=>{w(re instanceof Error?re.message:"Failed to add income")})}function X(G,Z,W,te,B,H){t&&(w(null),T(null),p(t,e,n,G,Z,W,te,B,H).catch(ne=>{w(ne instanceof Error?ne.message:"Failed to update income")}))}function Y(G){t&&confirm("Are you sure you want to delete this income entry?")&&(w(null),g(t,e,n,G).catch(Z=>{w(Z instanceof Error?Z.message:"Failed to delete income")}))}return u.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[_&&u.jsx("div",{style:{background:`color-mix(in srgb, ${pe.error} 15%, transparent)`,border:`1px solid ${pe.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:pe.error},children:_}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:b?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:b?"block":"grid",gridTemplateColumns:b?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Income:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ct(z),fontWeight:600},children:Xt(z)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!x&&u.jsx($e,{actionName:"Open Add Income Form",onClick:()=>S(!0),disabled:U.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!b&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Nl,children:"Date"}),u.jsx("div",{style:Nl,children:"Payee"}),u.jsx("div",{style:Nl,children:"Account"}),u.jsx("div",{style:{...Nl,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:Nl,children:"Description"}),u.jsx("div",{style:Nl})]})]}),u.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),U.length===0&&u.jsx(Ju,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),x&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(n1,{accounts:U,accountGroups:l,payees:V,defaultAccountId:I,defaultDate:xm(e,n),onSubmit:M,onCancel:()=>S(!1),submitLabel:"Add Income",isMobile:b})}),d?.income.slice().sort((G,Z)=>(G.date||"").localeCompare(Z.date||"")).map((G,Z)=>C===G.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(n1,{accounts:U,accountGroups:l,payees:V,initialData:G,onSubmit:(W,te,B,H,ne)=>X(G.id,W,te,B,H,ne),onCancel:()=>T(null),onDelete:()=>Y(G.id),submitLabel:"Save",isMobile:b})},G.id):u.jsx(A4,{income:G,accountName:Ye(G.account_id)?La:o[G.account_id]?.nickname||"Unknown Account",accountGroupName:Ye(G.account_id)?void 0:o[G.account_id]?.account_group_id?l[o[G.account_id].account_group_id]?.name:void 0,onEdit:()=>{G.payee||`${G.amount}`,T(G.id)},onDelete:()=>Y(G.id),isMobile:b,isEvenRow:Z%2===0},G.id)),(!d?.income||d.income.length===0)&&!x&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function r1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function b(_){h(_.amount,_.categoryId,_.accountId,_.date,_.payee,_.description,_.cleared)}return u.jsx(c0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:b,onCancel:f,onDelete:p})}function R4({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=d?"transparent":"var(--row-alt-bg)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:pe.success},title:"Cleared",children:""})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",f]})]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx("span",{style:{fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:zt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:zt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?pe.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const ma={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function I4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Je(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=Rn(),{month:f,isLoading:p}=Ys(t,e,n),{addExpense:g}=pz(),{updateExpense:b}=yz(),{deleteExpense:_}=_z(),w=Oi(),[x,S]=A.useState(null),[C,T]=A.useState(!1),[R,k]=A.useState(null),D=Y_(t,{enabled:C||R!==null}).data||[];function O(W){const te=W.account_group_id?l[W.account_group_id]:void 0;return te&&te.is_active!==null?te.is_active:W.is_active!==!1}function N(W){const te=W.account_group_id?l[W.account_group_id]:void 0;return te&&te.on_budget!==null?te.on_budget:W.on_budget!==!1}const U=Object.entries(o).filter(([,W])=>O(W)&&N(W)),q=U.filter(([,W])=>W.is_outgo_account),I=q.length>0?q:U,z=U.find(([,W])=>W.is_outgo_default),M=z?z[0]:void 0,X=f?.expenses?.reduce((W,te)=>W+te.amount,0)||0;function Y(W,te,B,H,ne,re,ce){if(!t)return;S(null),T(!1);const{year:_e,month:Te}=wm(H);(_e!==e||Te!==n)&&(r(_e),i(Te)),g(t,_e,Te,W,te,B,H,ne,re,ce).catch(oe=>{S(oe instanceof Error?oe.message:"Failed to add expense")})}function G(W,te,B,H,ne,re,ce,_e){t&&(S(null),k(null),b(t,e,n,W,te,B,H,ne,re,ce,_e).catch(Te=>{S(Te instanceof Error?Te.message:"Failed to update expense")}))}function Z(W){t&&confirm("Are you sure you want to delete this expense?")&&(S(null),_(t,e,n,W).catch(te=>{S(te instanceof Error?te.message:"Failed to delete expense")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${pe.error} 15%, transparent)`,border:`1px solid ${pe.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:pe.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:w?"block":"grid",gridTemplateColumns:w?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ct(X),fontWeight:600},children:zt(X)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx($e,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:I.length===0||Object.keys(d).length===0,disabledReason:I.length===0&&Object.keys(d).length===0?"Create accounts and categories first":I.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!w&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ma,children:"Date"}),u.jsx("div",{style:ma,children:"Payee"}),u.jsx("div",{style:{...ma,textAlign:"center"},children:"Category"}),u.jsx("div",{style:ma,children:"Account"}),u.jsx("div",{style:{...ma,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:ma,children:"Description"}),u.jsx("div",{style:{...ma,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:ma})]})]}),I.length===0&&u.jsx(Ju,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(d).length===0&&u.jsx(Ju,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(r1,{accounts:I,accountGroups:l,categories:d,categoryGroups:h,payees:D,defaultAccountId:M,defaultDate:xm(e,n),onSubmit:Y,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:w})}),f?.expenses?.slice().sort((W,te)=>(W.date||"").localeCompare(te.date||"")).map((W,te)=>R===W.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(r1,{accounts:I,accountGroups:l,categories:d,categoryGroups:h,payees:D,initialData:W,onSubmit:(B,H,ne,re,ce,_e,Te)=>G(W.id,B,H,ne,re,ce,_e,Te),onCancel:()=>k(null),onDelete:()=>Z(W.id),submitLabel:"Save",isMobile:w})},W.id):u.jsx(R4,{expense:W,categoryName:lt(W.category_id)?zo:d[W.category_id]?.name||"Unknown Category",accountName:Ye(W.account_id)?La:o[W.account_id]?.nickname||"Unknown Account",accountGroupName:Ye(W.account_id)?void 0:o[W.account_id]?.account_group_id?l[o[W.account_id].account_group_id]?.name:void 0,onEdit:()=>{W.payee||`${W.amount}`,k(W.id)},onDelete:()=>Z(W.id),isMobile:w,isEvenRow:te%2===0},W.id)),(!f?.expenses||f.expenses.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const k4={background:pe.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},D4={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},M4={background:"transparent",border:`1px solid ${pe.errorBorder}`,color:pe.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function s1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:f}){const{isWide:p}=XT(),g=new Date().toISOString().split("T")[0],[b,_]=A.useState(i?.date||o||g),[w,x]=A.useState(i?.amount?.toString()||""),[S,C]=A.useState(i?.from_account_id||Ht),[T,R]=A.useState(i?.to_account_id||Ht),[k,V]=A.useState(i?.from_category_id||Yt),[$,D]=A.useState(i?.to_category_id||Yt),[O,N]=A.useState(i?.description||""),[U,q]=A.useState(i?.cleared||!1),[I,z]=A.useState(null),M=k===Yt,X=$===Yt,Y=S===Ht,G=T===Ht;function Z(){return M&&X&&(Y&&G)?'A transfer must move between real categories or real accounts  not all "No" options.':Y!==G?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':M!==X?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}Z()===null&&I!==null&&z(null);function te(oe){oe.preventDefault();const be=parseFloat(w);if(isNaN(be)||be<=0||!S||!T||!k||!$||!b)return;const Ne=Z();if(Ne){z(Ne);return}z(null),l(be,S,T,k,$,b,O.trim()||void 0,U)}const B=I?u.jsx("div",{style:{background:`color-mix(in srgb, ${pe.error} 15%, transparent)`,border:`1px solid ${pe.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:pe.error,marginTop:"0.5rem"},children:I}):null,H=(oe,be,Ne,Me)=>u.jsx(Nt,{label:Me,htmlFor:oe,children:u.jsx(YT,{id:oe,value:be,onChange:Ne,accounts:t,accountGroups:e,placeholder:La,required:!0,showNoAccountOption:!0})}),ne=(oe,be,Ne,Me)=>u.jsx(Nt,{label:Me,htmlFor:oe,children:u.jsx(KT,{id:oe,value:be,onChange:Ne,categories:n,categoryGroups:r,placeholder:zo,required:!0,showNoCategoryOption:!0})}),re=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Qr,{id:"transfer-cleared",checked:U,onChange:oe=>q(oe.target.checked)})]}),ce=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:f,style:k4,children:""}),u.jsx("button",{type:"button",onClick:()=>{d()},title:"Cancel",style:D4,children:""}),h&&u.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:M4,children:""})]})]}),_e=u.jsxs(Ga,{children:[u.jsx($e,{type:"submit",actionName:f,children:f}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:d,children:"Cancel"}),h&&u.jsx($e,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),Te={fontSize:"0.85rem",padding:"0.5rem"};return p?u.jsx(Ii,{actionName:f,onSubmit:te,children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx(Nt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(Ff,{id:"transfer-date",value:b,onChange:oe=>_(oe.target.value),required:!0,style:Te,autoFocus:!0})}),u.jsx(Nt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(Io,{id:"transfer-amount",value:w,onChange:x,placeholder:"$0.00",required:!0})}),ne("from-category",k,V,"From Category"),H("from-account",S,C,"From Account"),u.jsx(Nt,{label:"Description",htmlFor:"transfer-description",children:u.jsx(ki,{id:"transfer-description",value:O,onChange:oe=>N(oe.target.value),placeholder:"e.g., Transfer",style:Te})})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),u.jsx("div",{}),ne("to-category",$,D,"To Category"),H("to-account",T,R,"To Account"),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[re,ce]})]}),B]})}):u.jsxs(Ii,{actionName:f,onSubmit:te,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Nt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(Ff,{id:"transfer-date",value:b,onChange:oe=>_(oe.target.value),required:!0,autoFocus:!0})}),u.jsx(Nt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(Io,{id:"transfer-amount",value:w,onChange:x,placeholder:"$0.00",required:!0})})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[ne("from-category",k,V,"From Cat."),H("from-account",S,C,"From Acct.")]}),u.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[ne("to-category",$,D,"To Cat."),H("to-account",T,R,"To Acct.")]})]}),u.jsx(Nt,{label:"Description (optional)",htmlFor:"transfer-description",children:u.jsx(ki,{id:"transfer-description",value:O,onChange:oe=>N(oe.target.value),placeholder:"e.g., Transfer to savings"})}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Qr,{id:"transfer-cleared-stacked",checked:U,onChange:oe=>q(oe.target.checked)}),u.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),B]}),_e]})}function O4({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:i,fromAccountGroupName:o,toAccountGroupName:l,isFromCategoryNo:d,isToCategoryNo:h,isFromAccountNo:f,isToAccountNo:p,onEdit:g,onDelete:b,isMobile:_,isEvenRow:w}){const x=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",S=w?"transparent":"var(--row-alt-bg)";if(_)return u.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:S,cursor:"pointer",transition:"background 0.15s"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:x}),u.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Xt(t.amount)}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:pe.success},title:"Cleared",children:""})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:d?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),f?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),u.jsx("span",{children:r})]})]}),u.jsx("span",{style:{opacity:.5},children:""}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:i}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[l&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:l}),u.jsx("span",{children:i})]})]})]}),t.description&&u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const C={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...C,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:x})}),u.jsx("div",{style:{...C,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Xt(t.amount)}),u.jsx("div",{style:{...C,justifyContent:"center"},children:u.jsx("span",{style:d?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...C,overflow:"hidden"},children:f?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),u.jsx("div",{style:{...C,justifyContent:"center",fontSize:"1rem"},children:u.jsx("span",{style:{opacity:.5},children:""})}),u.jsx("div",{style:{...C,justifyContent:"center"},children:u.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),u.jsx("div",{style:{...C,overflow:"hidden"},children:p?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:i}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[l&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i})]})}),u.jsx("div",{style:{...C,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...C,justifyContent:"center",color:t.cleared?pe.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...C,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:b,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const zs={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function N4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Je(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=Rn(),{month:f,isLoading:p}=Ys(t,e,n),{addTransfer:g}=vz(),{updateTransfer:b}=wz(),{deleteTransfer:_}=Sz(),w=Oi(),[x,S]=A.useState(null),[C,T]=A.useState(!1),[R,k]=A.useState(null);function V(I){const z=I.account_group_id?l[I.account_group_id]:void 0;return z&&z.is_active!==null?z.is_active:I.is_active!==!1}function $(I){const z=I.account_group_id?l[I.account_group_id]:void 0;return z&&z.on_budget!==null?z.on_budget:I.on_budget!==!1}const D=Object.entries(o).filter(([,I])=>V(I)&&$(I));function O(I,z,M,X,Y,G,Z,W){if(!t)return;S(null),T(!1);const{year:te,month:B}=wm(G);(te!==e||B!==n)&&(r(te),i(B)),g(t,te,B,I,z,M,X,Y,G,Z,W).catch(H=>{S(H instanceof Error?H.message:"Failed to add transfer")})}function N(I,z,M,X,Y,G,Z,W,te){t&&(S(null),k(null),b(t,e,n,I,z,M,X,Y,G,Z,W,te).catch(B=>{S(B instanceof Error?B.message:"Failed to update transfer")}))}function U(I){t&&confirm("Are you sure you want to delete this transfer?")&&(S(null),_(t,e,n,I).catch(z=>{S(z instanceof Error?z.message:"Failed to delete transfer")}))}const q=D.length>=1&&Object.keys(d).length>=1;return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${pe.error} 15%, transparent)`,border:`1px solid ${pe.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:pe.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:w?"block":"grid",gridTemplateColumns:w?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx($e,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!q,disabledReason:D.length===0&&Object.keys(d).length===0?"Create accounts and categories first":D.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!w&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:zs,children:"Date"}),u.jsx("div",{style:{...zs,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:{...zs,textAlign:"center"},children:"From Cat"}),u.jsx("div",{style:zs,children:"From Acct"}),u.jsx("div",{style:zs}),u.jsx("div",{style:{...zs,textAlign:"center"},children:"To Cat"}),u.jsx("div",{style:zs,children:"To Acct"}),u.jsx("div",{style:zs,children:"Description"}),u.jsx("div",{style:{...zs,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:zs})]})]}),!q&&u.jsx(Ju,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(s1,{accounts:D,accountGroups:l,categories:d,categoryGroups:h,defaultDate:xm(e,n),onSubmit:O,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),f?.transfers?.slice().sort((I,z)=>(I.date||"").localeCompare(z.date||"")).map((I,z)=>R===I.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(s1,{accounts:D,accountGroups:l,categories:d,categoryGroups:h,initialData:I,onSubmit:(M,X,Y,G,Z,W,te,B)=>N(I.id,M,X,Y,G,Z,W,te,B),onCancel:()=>k(null),onDelete:()=>U(I.id),submitLabel:"Save"})},I.id):u.jsx(O4,{transfer:I,fromCategoryName:lt(I.from_category_id)?zo:d[I.from_category_id]?.name||"Unknown",toCategoryName:lt(I.to_category_id)?zo:d[I.to_category_id]?.name||"Unknown",fromAccountName:Ye(I.from_account_id)?La:o[I.from_account_id]?.nickname||"Unknown",toAccountName:Ye(I.to_account_id)?La:o[I.to_account_id]?.nickname||"Unknown",fromAccountGroupName:Ye(I.from_account_id)?void 0:o[I.from_account_id]?.account_group_id?l[o[I.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:Ye(I.to_account_id)?void 0:o[I.to_account_id]?.account_group_id?l[o[I.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:lt(I.from_category_id),isToCategoryNo:lt(I.to_category_id),isFromAccountNo:Ye(I.from_account_id),isToAccountNo:Ye(I.to_account_id),onEdit:()=>{I.description||`${I.amount}`,k(I.id)},onDelete:()=>U(I.id),isMobile:w,isEvenRow:z%2===0},I.id)),(!f?.transfers||f.transfers.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function i1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function b(_){h(_.amount,_.accountId,_.categoryId,_.date,_.payee,_.description,_.cleared)}return u.jsx(c0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:b,onCancel:f,onDelete:p})}function P4({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=d?"transparent":"var(--row-alt-bg)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:pe.success},title:"Cleared",children:""})]}),u.jsx("span",{style:{fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:zt(t.amount)})]}),u.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:f})]})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:ct(t.amount),fontFamily:"monospace"},children:zt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?pe.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Co={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function B4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Je(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=Rn(),{month:f,isLoading:p}=Ys(t,e,n),{addAdjustment:g}=Cz(),{updateAdjustment:b}=Az(),{deleteAdjustment:_}=jz(),w=Oi(),[x,S]=A.useState(null),[C,T]=A.useState(!1),[R,k]=A.useState(null),D=Y_(t,{enabled:C||R!==null}).data||[];function O(M){const X=M.account_group_id?l[M.account_group_id]:void 0;return X&&X.is_active!==null?X.is_active:M.is_active!==!1}function N(M){const X=M.account_group_id?l[M.account_group_id]:void 0;return X&&X.on_budget!==null?X.on_budget:M.on_budget!==!1}const U=Object.entries(o).filter(([,M])=>O(M)&&N(M));function q(M,X,Y,G,Z,W,te){if(!t)return;S(null),T(!1);const{year:B,month:H}=wm(G);(B!==e||H!==n)&&(r(B),i(H)),g(t,B,H,M,X,Y,G,Z,W,te).catch(ne=>{S(ne instanceof Error?ne.message:"Failed to add adjustment")})}function I(M,X,Y,G,Z,W,te,B){t&&(S(null),k(null),b(t,e,n,M,X,Y,G,Z,W,te,B).catch(H=>{S(H instanceof Error?H.message:"Failed to update adjustment")}))}function z(M){t&&confirm("Are you sure you want to delete this adjustment?")&&(S(null),_(t,e,n,M).catch(X=>{S(X instanceof Error?X.message:"Failed to delete adjustment")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${pe.error} 15%, transparent)`,border:`1px solid ${pe.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:pe.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:w?"block":"grid",gridTemplateColumns:w?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx($e,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(d).length===0&&U.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!w&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Co,children:"Date"}),u.jsx("div",{style:{...Co,textAlign:"center"},children:"Category"}),u.jsx("div",{style:Co,children:"Account"}),u.jsx("div",{style:{...Co,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:Co,children:"Description"}),u.jsx("div",{style:{...Co,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:Co})]})]}),U.length===0&&Object.keys(d).length===0&&u.jsx(Ju,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(i1,{accounts:U,accountGroups:l,categories:d,categoryGroups:h,payees:D,defaultDate:xm(e,n),onSubmit:q,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),f?.adjustments?.slice().sort((M,X)=>(M.date||"").localeCompare(X.date||"")).map((M,X)=>R===M.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(i1,{accounts:U,accountGroups:l,categories:d,categoryGroups:h,payees:D,initialData:M,onSubmit:(Y,G,Z,W,te,B,H)=>I(M.id,Y,G,Z,W,te,B,H),onCancel:()=>k(null),onDelete:()=>z(M.id),submitLabel:"Save"})},M.id):u.jsx(P4,{adjustment:M,categoryName:lt(M.category_id)?zo:d[M.category_id]?.name||"Unknown Category",accountName:Ye(M.account_id)?La:o[M.account_id]?.nickname||"Unknown Account",accountGroupName:Ye(M.account_id)?void 0:o[M.account_id]?.account_group_id?l[o[M.account_id].account_group_id]?.name:void 0,onEdit:()=>{M.description||`${M.amount}`,k(M.id)},onDelete:()=>z(M.id),isMobile:w,isEvenRow:X%2===0},M.id)),(!f?.adjustments||f.adjustments.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function z4({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:i}=jn(),{selectedBudgetId:o,currentYear:l,currentMonthNumber:d}=Je(),{deleteAllocations:h}=pA(),[f,p]=A.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:l,month:d}),e(),n?.()}catch(b){p(b instanceof Error?b.message:"Failed to delete allocations")}finally{i("allocations-delete")}}};return u.jsxs(Qs,{isOpen:t,onClose:e,title:"Delete Allocations",children:[f&&u.jsx(Cm,{message:f,onDismiss:()=>p(null)}),u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),u.jsx($e,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function vA({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:i,draftChangeAmount:o,availableAfterApply:l,currentDraftTotal:d}){const h=t&&d!==void 0?d:i.allocated;return u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?u.jsx("span",{style:{color:ct(n),fontWeight:600},children:Fn(n)}):u.jsx("span",{style:{color:pe.success,fontWeight:600},children:Fn(r)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:" "}),u.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),u.jsx("span",{style:{color:Sc(t?h:i.allocated),fontWeight:600,...t?hs:{}},children:Fn(t?h:i.allocated)}),e&&o!==0&&u.jsxs("span",{style:{fontSize:"0.85em",color:o>0?pe.warning:pe.success,marginLeft:"0.25rem"},children:["(",zt(o),")"]})]}),!t&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Spent: "}),u.jsx("span",{style:{color:wc(i.spent),fontWeight:600},children:Fn(i.spent)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:"= "}),u.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?u.jsx("span",{style:{color:ct(l),fontWeight:600,...hs},children:Fn(l)}):u.jsx("span",{style:{color:ct(i.allocated+i.spent),fontWeight:600},children:Fn(i.allocated+i.spent)})]})]})}function L4({totals:t}){return u.jsxs(u.Fragment,{children:[u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Start: "}),u.jsx("span",{style:{color:ct(t.start),fontWeight:600},children:Fn(t.start)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Inc: "}),u.jsx("span",{style:{color:pe.success,fontWeight:600},children:Fn(t.income)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Exp: "}),u.jsx("span",{style:{color:wc(t.expenses),fontWeight:600},children:Fn(t.expenses)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"End: "}),u.jsx("span",{style:{color:ct(t.end),fontWeight:600},children:Fn(t.end)})]})]})}function u0({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:i,onEdit:o,onCancel:l,onDelete:d}){const h={fontSize:"0.8rem",padding:"0.4em 0.8em",height:32,minHeight:32,boxSizing:"border-box",lineHeight:1,display:"inline-flex",alignItems:"center",justifyContent:"center"};return u.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:"0.5rem",flexShrink:0},children:[t&&!e&&u.jsxs(u.Fragment,{children:[u.jsx($e,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:h,children:" Save"}),u.jsx($e,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:h,children:" Apply"})]}),!t&&n&&u.jsx($e,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:h,children:" Edit Allocations"}),e&&u.jsxs(u.Fragment,{children:[u.jsx($e,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:h,children:" Apply"}),u.jsx($e,{actionName:"Cancel Edit Allocations",onClick:l,variant:"secondary",style:h,children:""}),u.jsx($e,{actionName:"Open Delete Allocations Modal",onClick:d,variant:"secondary",style:{...h,color:pe.error},children:""})]})]})}function a1(t){return t===0?pe.zero:t>0?pe.success:pe.error}function U4({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,projectedAllTime:l}){const d=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=d?t.default_monthly_amount/100*r:0,f=d?h.toFixed(2):n,p=i&&!d,g=i?l:t.balance??0,b=t.balance??0,_=b<0,w=_?Math.abs(b):0,x=d?h:parseFloat(n)||0,S=_?Math.min(x,w):0,C=_?Math.max(0,x-w):0,T=_&&x>0&&C>0;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.name})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{style:{color:dn(e.start_balance)},children:br(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:f?`$${f}`:"",onChange:R=>{const k=R.target.value.replace(/[^\d.]/g,"");o(k)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),_&&x>0&&u.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[u.jsxs("span",{style:{color:pe.debt,display:"block"},children:[Xt(S),"  debt"]}),T&&u.jsxs("span",{style:{color:pe.success,display:"block"},children:[Xt(C),"  balance"]})]})]}):u.jsx("span",{style:{color:Sc(e.allocated)},children:zt(e.allocated)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),u.jsx("span",{style:{color:wc(e.spent)},children:Pt(e.spent)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:dn(e.end_balance),...i&&!d?hs:{}},children:br(e.end_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:i?"Proj. All-Time":"All-Time"}),u.jsx("span",{style:{color:dn(g),...i&&!d?hs:{}},children:br(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&u.jsxs("span",{style:{color:a1(e.transfers)},children:[zt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{style:{color:a1(e.adjustments)},children:[zt(e.adjustments)," adjust"]})]}),i&&d&&u.jsx("div",{style:{marginTop:"0.5rem"},children:u.jsxs("span",{style:{fontSize:"0.8rem"},children:[u.jsxs("span",{style:{opacity:.6},children:[Xt(r),"  "]}),u.jsxs("span",{style:{color:pe.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.6},children:" = "}),u.jsx("span",{style:{color:pe.success},children:Xt(h)})]})})]})}function $f(t){return t===0?pe.zero:t>0?pe.success:pe.error}function o1({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:i,savedAllocations:o,previousMonthIncome:l,isDraftMode:d,onAllocationChange:h,isMobile:f,isUngrouped:p,isFirstGroup:g=!1,getAllocationAmount:b,gridTemplateColumns:_}){const w={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:g?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},x=n.allocated+n.spent+n.transfers+n.adjustments,S=e.reduce((C,[T,R])=>{const k=R.balance??0;let V=k;if(d){const $=b(T,R),D=o[T]??0,O=$-D;V=k+O}return C+Math.max(0,V)},0);return u.jsxs("div",{style:{display:"contents"},children:[!f&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...w,paddingLeft:"0.5rem",opacity:p?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:dn(n.start)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:d?"center":"flex-end",color:Sc(n.allocated)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:wc(n.spent)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:$f(n.transfers)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:$f(n.adjustments)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:dn(x)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:dn(n.end),paddingRight:"1rem",borderRight:"2px solid var(--border-muted)"},children:Kt.showGroupTotals}),u.jsx("div",{style:{...w,justifyContent:"flex-end",color:dn(S)},children:Kt.showGroupTotals})]}),!d&&f&&u.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:g?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:p?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Kt.showGroupTotals]}),e.map(([C,T],R)=>{const k=r(C);if(!k)return null;const V=T.balance??0;let $=V;if(d){const D=b(C,T),O=o[C]??0,N=D-O;$=V+N}return f?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(U4,{category:T,balance:k,localAllocation:i[C]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:D=>h(C,D),projectedAllTime:$})},C):u.jsx(F4,{category:T,balance:k,localAllocation:i[C]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:D=>h(C,D),allTimeBalance:$,isEvenRow:R%2===0,gridTemplateColumns:_},C)})]})}function F4({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,allTimeBalance:l,isEvenRow:d,gridTemplateColumns:h}){const f=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,p=f?t.default_monthly_amount/100*r:0,g=f?p.toFixed(2):n,b=t.balance??0,_=b<0,w=_?Math.abs(b):0,x=f?p:parseFloat(n)||0,S=_?Math.min(x,w):0,C=_?Math.max(0,x-w):0,T=_&&x>0&&C>0,R=d?"transparent":"var(--row-alt-bg)",k={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},V=e.allocated+e.spent+e.transfers+e.adjustments;return u.jsxs("div",{style:{gridColumn:"1 / -1",background:R,display:"grid",gridTemplateColumns:h},children:[u.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid var(--border-subtle)",minHeight:"2.4rem",boxSizing:"border-box"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...k,justifyContent:"flex-end",color:dn(e.start_balance)},children:br(e.start_balance)}),i?u.jsx("div",{style:{...k,justifyContent:"center",flexDirection:"column",gap:"0.1rem"},children:f?u.jsxs("span",{style:{fontSize:"0.85rem"},children:[u.jsxs("span",{style:{color:pe.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.5},children:" = "}),u.jsx("span",{style:{color:pe.success},children:Xt(p)})]}):u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:g?`$${g}`:"",onChange:$=>{const D=$.target.value.replace(/[^\d.]/g,"");o(D)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),_&&x>0&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[u.jsxs("span",{style:{color:pe.debt},children:[Xt(S),"  debt"]}),T&&u.jsxs("span",{style:{color:pe.success},children:[Xt(C),"  bal"]})]})]})}):(()=>{const $=e.start_balance<0,D=$?Math.abs(e.start_balance):0,O=$?Math.min(e.allocated,D):0,N=$?Math.max(0,e.allocated-D):0,U=$&&e.allocated>0;return u.jsxs("div",{style:{...k,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:Sc(e.allocated)},children:[u.jsxs("span",{children:["+",Xt(e.allocated)]}),U&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsxs("span",{style:{color:pe.debt},children:[Xt(O),"  debt"]}),N>0&&u.jsxs("span",{style:{color:pe.success},children:[Xt(N),"  bal"]})]})]})})(),u.jsx("div",{style:{...k,justifyContent:"flex-end",color:wc(e.spent)},children:Pt(e.spent)}),u.jsx("div",{style:{...k,justifyContent:"flex-end",color:$f(e.transfers)},children:zt(e.transfers)}),u.jsx("div",{style:{...k,justifyContent:"flex-end",color:$f(e.adjustments)},children:zt(e.adjustments)}),u.jsx("div",{style:{...k,justifyContent:"flex-end",color:dn(V),...i&&!f?hs:{}},children:zt(V)}),u.jsx("div",{style:{...k,justifyContent:"flex-end",fontWeight:600,color:dn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid var(--border-muted)",...i&&!f?hs:{}},children:br(e.end_balance)}),u.jsx("div",{style:{...k,justifyContent:"flex-end",color:dn(l),...i&&!f?hs:{}},children:br(l)})]})}function V4(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,i])=>n||!i.is_hidden).reduce((i,[o,l])=>{const d=l.category_group_id||"ungrouped";return i[d]||(i[d]=[]),i[d].push([o,l]),i},{});return Object.keys(r).forEach(i=>{r[i].sort((o,l)=>o[1].sort_order-l[1].sort_order)}),r}function $4(t,e,n,r,i){const o={};t?.category_balances&&t.category_balances.forEach(d=>{o[d.category_id]=d});const l={};return Object.entries(e).forEach(([d,h])=>{const f=o[d],p=Ae(f?.start_balance??0);let g=0;n?g=Ae(i(d,h)):r&&f&&(g=Ae(f.allocated));const b=RT(d,t?.expenses||[]),_=IT(d,t?.transfers||[]),w=kT(d,t?.adjustments||[]);l[d]={category_id:d,start_balance:p,allocated:g,spent:b,transfers:_,adjustments:w,end_balance:Ae(p+g+b+_+w)}}),l}function q4(t,e){const n={};t?.account_balances&&t.account_balances.forEach(i=>{n[i.account_id]=i});const r={};return Object.entries(e).forEach(([i,o])=>{const l=n[i],d=Ae(l?.start_balance??o.balance);let h=0;t?.income&&(h=Ae(t.income.filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)));let f=0;t?.expenses&&(f=Ae(t.expenses.filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)));let p=0;if(t?.transfers){let _=0;t.transfers.forEach(w=>{w.to_account_id===i&&(_+=w.amount),w.from_account_id===i&&(_-=w.amount)}),p=Ae(_)}let g=0;t?.adjustments&&(g=Ae(t.adjustments.filter(_=>_.account_id===i).reduce((_,w)=>_+w.amount,0)));const b=Ae(h+f+p+g);r[i]={account_id:i,start_balance:d,income:h,expenses:f,transfers:p,adjustments:g,net_change:b,end_balance:Ae(d+b)}}),r}function H4(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function G4(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+Math.max(0,n.end_balance)}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function xA(t,e){const n={},r={};return t?.account_balances&&t.account_balances.forEach(i=>{r[i.account_id]=i}),t?(Object.entries(e).forEach(([i,o])=>{const l=r[i],d=Ae(l?.start_balance??o.balance);let h=0,f=0;t?.income&&t.income.filter(T=>T.account_id===i).forEach(T=>{f+=T.amount,h+=T.amount});let p=0,g=0;t?.expenses&&t.expenses.filter(T=>T.account_id===i).forEach(T=>{g+=T.amount,T.cleared===!0&&(p+=T.amount)});let b=0,_=0;t?.transfers&&t.transfers.forEach(T=>{T.to_account_id===i&&(_+=T.amount,T.cleared===!0&&(b+=T.amount)),T.from_account_id===i&&(_-=T.amount,T.cleared===!0&&(b-=T.amount))});let w=0,x=0;t?.adjustments&&t.adjustments.filter(T=>T.account_id===i).forEach(T=>{x+=T.amount,T.cleared===!0&&(w+=T.amount)});const S=Ae(h+p+b+w),C=Ae(f+g+_+x);n[i]={account_id:i,cleared_balance:Ae(d+S),uncleared_balance:Ae(d+C)}}),n):(Object.entries(e).forEach(([i,o])=>{const l=Ae(o.balance??0);n[i]={account_id:i,cleared_balance:l,uncleared_balance:l}}),n)}function l1(t){return t===0?pe.zero:t>0?pe.success:pe.error}function W4({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h}){const f={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...f,gap:"0.75rem"},children:["Grand Totals",!t&&u.jsx(u0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h})]}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(n.start)},children:br(n.start)}),u.jsxs("div",{style:{...f,justifyContent:t?"center":"flex-end",color:Sc(n.allocated),...t?hs:{}},children:["+",Xt(n.allocated)]}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:wc(n.spent)},children:Pt(n.spent)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:l1(n.transfers)},children:zt(n.transfers)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:l1(n.adjustments)},children:zt(n.adjustments)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(p),...t?hs:{}},children:zt(p)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(n.end),paddingRight:"1rem",borderRight:"2px solid var(--border-muted)",...t?hs:{}},children:br(n.end)}),u.jsx("div",{style:{...f,justifyContent:"flex-end",color:dn(r),...t?hs:{}},children:br(r)})]})}function Q4({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l,onSave:d,onApply:h,onEdit:f,onCancel:p,onDelete:g}){return u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(vA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l}),u.jsx(u0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:d,onApply:h,onEdit:f,onCancel:p,onDelete:g})]})}const yi={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid var(--border-medium)"};function K4(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Je(),{categories:r,categoryGroups:i}=Rn(),{month:o}=Ys(t,e,n),l=Oi(),[d,h]=A.useState(!1),{localAllocations:f,isEditingAppliedAllocations:p,error:g,availableNow:b,currentDraftTotal:_,draftChangeAmount:w,availableAfterApply:x,previousMonthIncome:S,currentMonthIncome:C,allocationsFinalized:T,getAllocationAmount:R,handleAllocationChange:k,resetAllocationsToSaved:V,handleSaveAllocations:$,handleFinalizeAllocations:D,setIsEditingAppliedAllocations:O,setError:N}=pB(),U=[...i].sort((te,B)=>te.sort_order-B.sort_order),q=A.useMemo(()=>V4(r),[r]),I=!T||p,z=A.useMemo(()=>$4(o,r,I,T,R),[o,r,I,T,R]),M=te=>z[te],X=A.useMemo(()=>G4(z),[z]),Y=A.useMemo(()=>{const te={};if(o?.category_balances)for(const B of o.category_balances)te[B.category_id]=B.allocated;return te},[o]),G=A.useMemo(()=>Object.entries(r).reduce((te,[B,H])=>{const ne=H.balance??0;let re=ne;if(I){const ce=R(B,H),_e=Y[B]??0,Te=ce-_e;re=ne+Te}return te+Math.max(0,re)},0),[r,I,R,Y]),Z=A.useMemo(()=>Object.values(r).reduce((te,B)=>te+Math.max(0,B.balance??0),0),[r]);A.useEffect(()=>{if(!t||I)return;if(Math.abs(G-Z)>.01){const B=Math.abs(G-Z);console.error("[MonthCategories] Month View vs Settings Mismatch:",{grandAllTime:G,settingsPageAllocated:Z,difference:B,message:'Month view "ALL-TIME" does not match settings page "Allocated" total. These should always match.'}),$n.add({type:"error",message:`Balance display mismatch: Month view "ALL-TIME" (${Xt(G)})  Settings "Allocated" (${Xt(Z)}). Difference: ${Xt(B)}. Budget may need recalculation.`,autoDismissMs:1e4})}},[G,Z,I,t]);const W={onSave:$,onApply:D,onEdit:()=>O(!0),onCancel:V,onDelete:()=>h(!0)};return u.jsxs(u.Fragment,{children:[g&&u.jsx(Cm,{message:g,onDismiss:()=>N(null)}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:l?"1fr":I?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",display:l?"block":"grid",gridTemplateColumns:l?void 0:"subgrid"},children:[I&&u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:l?"column":"row",flexWrap:"wrap",alignItems:l?"stretch":"center",gap:l?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:l?"0.5rem":"0.25rem"},children:[u.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:l?void 0:1,alignItems:"center"},children:u.jsx(vA,{isDraftMode:I,isEditingAppliedAllocations:p,availableNow:b,currentMonthIncome:C,balanceTotals:X,draftChangeAmount:w,availableAfterApply:x,currentDraftTotal:_})}),u.jsx(u0,{isDraftMode:I,isEditingAppliedAllocations:p,allocationsFinalized:T,...W})]}),!l&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:yi,children:"Category"}),u.jsx("div",{style:{...yi,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...yi,textAlign:I?"center":"right"},children:"Allocated"}),u.jsx("div",{style:{...yi,textAlign:"right"},children:"Spent"}),u.jsx("div",{style:{...yi,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...yi,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...yi,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...yi,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid var(--border-muted)"},children:"End"}),u.jsx("div",{style:{...yi,textAlign:"right"},children:"All-Time"})]}),!l&&u.jsx(W4,{isDraftMode:I,allocationsFinalized:T,balanceTotals:X,grandAllTime:G,...W}),!I&&l&&u.jsx(Q4,{allocationsFinalized:T,availableNow:b,currentMonthIncome:C,balanceTotals:X,draftChangeAmount:w,availableAfterApply:x,currentDraftTotal:_,...W})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",u.jsx(Tn,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),U.map((te,B)=>{const H=q[te.id]||[];if(H.length===0)return null;const ne=H.reduce((re,[ce])=>{const _e=M(ce);return _e?{start:re.start+_e.start_balance,allocated:re.allocated+_e.allocated,spent:re.spent+_e.spent,transfers:re.transfers+_e.transfers,adjustments:re.adjustments+_e.adjustments,end:re.end+_e.end_balance}:re},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(o1,{name:te.name,categories:H,groupTotals:ne,getCategoryBalance:M,localAllocations:f,savedAllocations:Y,previousMonthIncome:S,isDraftMode:I,onAllocationChange:k,isMobile:l,isFirstGroup:B===0,getAllocationAmount:R,gridTemplateColumns:I?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},te.id)}),q[Jt]?.length>0&&(()=>{const te=q[Jt],B=te.reduce((ne,[re])=>{const ce=M(re);return ce?{start:ne.start+ce.start_balance,allocated:ne.allocated+ce.allocated,spent:ne.spent+ce.spent,transfers:ne.transfers+ce.transfers,adjustments:ne.adjustments+ce.adjustments,end:ne.end+ce.end_balance}:ne},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0}),H=U.length===0;return u.jsx(o1,{name:"Uncategorized",categories:te,groupTotals:B,getCategoryBalance:M,localAllocations:f,savedAllocations:Y,previousMonthIncome:S,isDraftMode:I,onAllocationChange:k,isMobile:l,isUngrouped:!0,isFirstGroup:H,getAllocationAmount:R,gridTemplateColumns:I?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},Jt)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),u.jsx(z4,{isOpen:d,onClose:()=>h(!1),onDeleted:()=>O(!1)})]})}function wA(t){return t===0?pe.zero:t>0?pe.success:pe.error}function SA(t){return t===0?pe.zero:t<0?pe.error:pe.success}function wa(t){return t===0?pe.zero:t>0?pe.success:pe.error}function c1({name:t,accounts:e,groupTotals:n,accountBalances:r,accountClearedBalances:i,isMobile:o,isUngrouped:l,isFirstGroup:d=!1}){const h={padding:"0.6rem 0.5rem",marginTop:d?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!o&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...h,opacity:l?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:ct(n.start)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:wA(n.income)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:SA(n.expenses)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:wa(n.transfers)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:wa(n.adjustments)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:wa(n.netChange)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end",color:ct(n.end)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end"},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end"},children:Kt.showGroupTotals}),u.jsx("div",{style:{...h,justifyContent:"flex-end"},children:Kt.showGroupTotals})]}),o&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:d?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:l?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),Kt.showGroupTotals]}),e.map(([f,p],g)=>{const b=r[f];if(!b)return null;const _=i?.[f];return o?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(X4,{account:p,balance:b,clearedBalance:_})},f):u.jsx(Y4,{account:p,balance:b,clearedBalance:_,isEvenRow:g%2===0},f)})]})}function Y4({account:t,balance:e,clearedBalance:n,isEvenRow:r}){const i=r?"transparent":"var(--row-alt-bg)",o={padding:"0.5rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:i,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsx("div",{style:{...o,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid var(--border-subtle)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(e.start_balance)},children:Pt(e.start_balance)}),u.jsxs("div",{style:{...o,justifyContent:"flex-end",color:wA(e.income)},children:["+",Xt(e.income)]}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:SA(e.expenses)},children:Pt(e.expenses)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:wa(e.transfers)},children:zt(e.transfers)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:wa(e.adjustments)},children:zt(e.adjustments)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",color:wa(e.net_change)},children:zt(e.net_change)}),u.jsx("div",{style:{...o,justifyContent:"flex-end",fontWeight:600,color:ct(e.end_balance)},children:Pt(e.end_balance)}),n?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(n.uncleared_balance),fontWeight:600},children:Pt(n.uncleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"var(--text-muted)"},children:""}),n?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:ct(n.cleared_balance)},children:Math.abs(n.uncleared_balance-n.cleared_balance)<.01?u.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""}):Pt(n.cleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"var(--text-muted)"},children:""}),n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?u.jsx("div",{style:{...o,justifyContent:"flex-end",color:wa(n.uncleared_balance-n.cleared_balance)},children:zt(n.uncleared_balance-n.cleared_balance)}):u.jsx("div",{style:{...o,justifyContent:"flex-end",opacity:.3,color:"var(--text-muted)"},children:""})]})}function X4({account:t,balance:e,clearedBalance:n}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.nickname})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:n&&Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?"1fr 1fr 1fr 1fr":"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{children:Pt(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),u.jsx("span",{style:{color:ct(e.net_change)},children:zt(e.net_change)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:ct(e.end_balance)},children:Pt(e.end_balance)})]}),n&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Total"}),u.jsx("span",{style:{color:ct(n.uncleared_balance),fontWeight:600},children:Pt(n.uncleared_balance)})]}),Math.abs(n.uncleared_balance-n.cleared_balance)>=.01?u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),u.jsx("span",{style:{color:ct(n.cleared_balance)},children:Pt(n.cleared_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),u.jsx("span",{style:{color:wa(n.uncleared_balance-n.cleared_balance)},children:zt(n.uncleared_balance-n.cleared_balance)})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Cleared"}),u.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Uncleared"}),u.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]})]})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&u.jsxs("span",{children:[zt(e.income)," income"]}),e.expenses!==0&&u.jsxs("span",{children:[Pt(e.expenses)," expenses"]}),e.transfers!==0&&u.jsxs("span",{children:[zt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{children:[zt(e.adjustments)," adjust"]})]})]})}const cs={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid var(--border-medium)"};function Z4(t){return t===0?pe.zero:t>0?pe.success:pe.error}function J4(t){return t===0?pe.zero:t<0?pe.error:pe.success}function ny(t){return t===0?pe.zero:t>0?pe.success:pe.error}function eL(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Je(),{accounts:r,accountGroups:i}=Rn(),{month:o}=Ys(t,e,n),l=Oi(),d=A.useMemo(()=>Object.entries(i).map(([S,C])=>({id:S,...C})).sort((S,C)=>S.sort_order-C.sort_order),[i]),h=A.useMemo(()=>{const S={};return Object.entries(r).filter(([,C])=>!C.is_hidden).forEach(([C,T])=>{const R=T.account_group_id||en;S[R]||(S[R]=[]),S[R].push([C,T])}),Object.keys(S).forEach(C=>{S[C].sort((T,R)=>T[1].sort_order-R[1].sort_order)}),S},[r]),f=A.useMemo(()=>q4(o,r),[o,r]),p=A.useMemo(()=>xA(o,r),[o,r]),g=A.useMemo(()=>H4(f),[f]),b=g.income+g.expenses,_=A.useMemo(()=>Object.keys(p).length===0?null:Object.values(p).reduce((S,C)=>S+C.uncleared_balance,0),[p]),x={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)",fontWeight:600};return u.jsx(u.Fragment,{children:u.jsxs("div",{style:{display:"grid",gridTemplateColumns:l?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",display:l?"block":"grid",gridTemplateColumns:l?void 0:"subgrid"},children:[!l&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:cs,children:"Account"}),u.jsx("div",{style:{...cs,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...cs,textAlign:"right"},children:"Income"}),u.jsx("div",{style:{...cs,textAlign:"right"},children:"Expenses"}),u.jsx("div",{style:{...cs,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...cs,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...cs,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...cs,textAlign:"right"},children:"End"}),u.jsx("div",{style:{...cs,textAlign:"right"},children:"Total"}),u.jsx("div",{style:{...cs,textAlign:"right"},children:"Cleared"}),u.jsx("div",{style:{...cs,textAlign:"right"},children:"Uncleared"})]}),l?u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(L4,{totals:g})]}):u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{...x},children:"Grand Totals"}),u.jsx("div",{style:{...x,justifyContent:"flex-end",color:ct(g.start)},children:Pt(g.start)}),u.jsxs("div",{style:{...x,justifyContent:"flex-end",color:Z4(g.income)},children:["+",Xt(g.income)]}),u.jsx("div",{style:{...x,justifyContent:"flex-end",color:J4(g.expenses)},children:Pt(g.expenses)}),u.jsx("div",{style:{...x,justifyContent:"flex-end",color:ny(g.transfers)},children:zt(g.transfers)}),u.jsx("div",{style:{...x,justifyContent:"flex-end",color:ny(g.adjustments)},children:zt(g.adjustments)}),u.jsx("div",{style:{...x,justifyContent:"flex-end",color:ny(b)},children:zt(b)}),u.jsx("div",{style:{...x,justifyContent:"flex-end",color:ct(g.end)},children:Pt(g.end)}),u.jsx("div",{style:{...x,justifyContent:"flex-end",color:_!==null?ct(_):void 0},children:_!==null?Pt(_):u.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})}),u.jsx("div",{style:{...x,justifyContent:"flex-end"},children:(()=>{if(Object.keys(p).length===0)return u.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""});const S=Object.values(p).reduce((T,R)=>T+R.cleared_balance,0),C=Object.values(p).reduce((T,R)=>T+R.uncleared_balance,0);return Math.abs(C-S)<.01?u.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""}):Pt(S)})()}),u.jsx("div",{style:{...x,justifyContent:"flex-end"},children:(()=>{if(Object.keys(p).length===0)return u.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""});const S=Object.values(p).reduce((R,k)=>R+k.cleared_balance,0),T=Object.values(p).reduce((R,k)=>R+k.uncleared_balance,0)-S;return Math.abs(T)<.01?u.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""}):zt(T)})()})]})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",u.jsx(Tn,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),d.map((S,C)=>{const T=h[S.id]||[];if(T.length===0)return null;const R=T.reduce((k,[V])=>{const $=f[V];return $?{start:k.start+$.start_balance,income:k.income+$.income,expenses:k.expenses+$.expenses,transfers:k.transfers+$.transfers,adjustments:k.adjustments+$.adjustments,netChange:k.netChange+$.net_change,end:k.end+$.end_balance}:k},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(c1,{name:S.name,accounts:T,groupTotals:R,accountBalances:f,accountClearedBalances:p,isMobile:l,isFirstGroup:C===0},S.id)}),h[en]?.length>0&&(()=>{const S=h[en],C=S.reduce((R,[k])=>{const V=f[k];return V?{start:R.start+V.start_balance,income:R.income+V.income,expenses:R.expenses+V.expenses,transfers:R.transfers+V.transfers,adjustments:R.adjustments+V.adjustments,netChange:R.netChange+V.net_change,end:R.end+V.end_balance}:R},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0}),T=d.length===0;return u.jsx(c1,{name:"Ungrouped",accounts:S,groupTotals:C,accountBalances:f,accountClearedBalances:p,isMobile:l,isUngrouped:!0,isFirstGroup:T},en)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})})}const tL=["income","categories","accounts","spend","transfers","adjustments"];function ry(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&tL.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function nL(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function u1(){const t=KR(),e=td(),[n,r]=B1(),{addLoadingHold:i,removeLoadingHold:o}=jn(),{selectedBudgetId:l,setSelectedBudgetId:d,currentYear:h,currentMonthNumber:f,lastActiveTab:p,lastBalancesTab:g,lastTransactionsTab:b,setCurrentYear:_,setCurrentMonthNumber:w,setLastActiveTab:x,setPageTitle:S,goToPreviousMonth:C,goToNextMonth:T,hasPendingInvites:R,needsFirstBudget:k,initialDataLoadComplete:V}=Je(),{budget:$,isLoading:D}=Rn(),O=!D,[N,U]=A.useState(!1);A.useEffect(()=>(!O||!V?i("budget-data","Loading budget data..."):o("budget-data"),()=>o("budget-data")),[O,V,i,o]);const q=A.useRef(!1),I=n.get("error"),[z,M]=A.useState(I);A.useEffect(()=>{I&&(n.delete("error"),r(n,{replace:!0}))},[I,n,r]);const X=A.useMemo(()=>{const{tab:ne}=ry(t);return ne??p},[t,p]),Y=ne=>{e(`/budget/${h}/${f}/${ne}`),x(ne)};A.useEffect(()=>{const{tab:ne}=ry(t);ne!=null&&x(X)},[X,t,x]),A.useEffect(()=>{if(q.current)return;const{year:ne,month:re}=ry(t);ne&&_(ne),re&&w(re),q.current=!0},[t,_,w]),A.useEffect(()=>{if(!q.current)return;const ne=`/budget/${h}/${f}/${X}`,re=`/budget/${t.year}/${t.month}/${t.tab}`;ne!==re&&e(ne,{replace:!0})},[h,f,X,e,t]);const{month:G,error:Z,isLoading:W}=Ys(O&&V?l:null,h,f);A.useEffect(()=>{if(!Z||N)return;const ne=Z.message||"";if(ne.includes("Budget")&&ne.includes("does not exist")){queueMicrotask(()=>{d(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(ne.includes("months in the past")||ne.includes("Refusing to create month"))&&queueMicrotask(()=>{i("month-redirect","Redirecting to current month..."),U(!0);const{year:re,month:ce}=nL();M(`Cannot create month ${h}/${f} - it's too far in the past. Redirected to current month.`),_(re),w(ce)})},[Z,N,h,f,_,w,i,d,e]),A.useEffect(()=>{N&&G&&!W&&queueMicrotask(()=>{U(!1),o("month-redirect")})},[N,G,W,o]),A.useLayoutEffect(()=>{S($?.name||"Budget")},[$?.name,S]);const{setCurrentViewingDocument:te}=Je();if(A.useEffect(()=>($&&h&&f&&te({type:"month",year:h,month:f}),()=>{te({type:null})}),[$,h,f,te]),A.useEffect(()=>{if(O&&!N){if(!$&&!l){e("/budget/my-budgets",{replace:!0});return}if(!$&&R){e("/budget/my-budgets",{replace:!0});return}if(k){e("/budget/my-budgets",{replace:!0});return}}},[O,N,$,l,R,k,e]),kB(V?l:null,h,f),zB({budgetId:l,viewingYear:h,viewingMonth:f,initialDataLoadComplete:V,enabled:!!l&&V}),!O||!V||N||!$)return null;function B(){M(null),C()}function H(){M(null),T()}return u.jsxs(u.Fragment,{children:[z&&u.jsx(Cm,{message:z,onDismiss:()=>M(null)}),u.jsx(S4,{onPreviousMonth:B,onNextMonth:H}),u.jsx(m4,{activeTab:X,setActiveTab:Y,lastBalancesTab:g,lastTransactionsTab:b,allocationsFinalized:G?.are_allocations_finalized}),X==="income"&&u.jsx(j4,{},`${h}-${f}`),X==="categories"&&u.jsx(K4,{},`${h}-${f}`),X==="accounts"&&u.jsx(eL,{},`${h}-${f}`),X==="spend"&&u.jsx(I4,{},`${h}-${f}`),X==="transfers"&&u.jsx(N4,{},`${h}-${f}`),X==="adjustments"&&u.jsx(B4,{},`${h}-${f}`)]})}function rL(){const{setPageTitle:t}=Je();return A.useLayoutEffect(()=>{t("Analytics")},[t]),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[u.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),u.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),u.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),u.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),u.jsx(Tn,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:pe.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function sL(){const t=Ut();return{createBudget:Gn({mutationFn:async({name:n,userId:r,userEmail:i})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString(),d={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:i,accounts:{},account_groups:{[en]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},categories:{},category_groups:[{id:Jt,name:"Uncategorized",sort_order:0}],month_map:{},percentage_income_months_back:1,created_at:l,updated_at:l};return await cr("budgets",o,d,"creating new budget document"),await cr("users",r,{uid:r,email:i,budget_ids:Wu(o),updated_at:l},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...d}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Ee.user(r)}),t.invalidateQueries({queryKey:Ee.accessibleBudgets(r)})}})}}function iL(){const t=Ut();return{acceptInvite:Gn({mutationFn:async({budgetId:n,userId:r})=>{const i=new Date().toISOString(),{exists:o,data:l}=await Bt("budgets",n,"validating user was invited to this budget");if(!o||!l)throw new Error("Budget not found");if(!l.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(l.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await cr("users",r,{uid:r,budget_ids:Wu(n),updated_at:i},"adding accepted budget to user's budget list",{merge:!0}),await cr("budgets",n,{accepted_user_ids:Wu(r),updated_at:i},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Ee.user(r)}),t.invalidateQueries({queryKey:Ee.accessibleBudgets(r)}),t.invalidateQueries({queryKey:Ee.budget(n.budgetId)})}})}}function aL(){const t=Ut(),e=Gn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=Ee.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:[...d.budget.user_ids,o]}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r,{exists:l,data:d}=await Bt("budgets",i,"validating user is not already invited");if(!l||!d)throw new Error("Budget not found");if(d.user_ids?.includes(o))throw new Error("User is already invited");return await vc({budgetId:i,updates:{user_ids:Wu(o)},description:"adding user to budget's invited users list"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ee.budget(i.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function oL(){const t=Ut(),e=Gn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=Ee.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:d.budget.user_ids.filter(h=>h!==o),accepted_user_ids:d.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r;return await vc({budgetId:i,updates:{user_ids:PS(o),accepted_user_ids:PS(o)},description:"removing user from budget's access lists"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(Ee.budget(i.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function lL({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"var(--color-error-bg)",border:"1px solid var(--color-error-border)",color:"var(--color-error)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"var(--color-error)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function cL({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"var(--color-success-bg)",border:"1px solid var(--color-success-border)",color:"var(--color-success)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"var(--color-success)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function uL({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:i,onCheckInvite:o,onAcceptInvite:l,onCancel:d}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Join Budget by ID"]}),u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?u.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-success) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-success) 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[u.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&u.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[u.jsx("button",{onClick:l,disabled:i===r.budgetId,style:{background:"var(--color-success)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:1},children:i===r.budgetId?"Accepting...":"Accept Invitation"}),u.jsx("button",{onClick:d,disabled:i===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:.8},children:"Cancel"})]})]}):u.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function dL({currentUserId:t}){return u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[u.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),u.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function hL(){const{addLoadingHold:t,removeLoadingHold:e}=jn(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:i,loadAccessibleBudgets:o,switchToBudget:l,checkBudgetInvite:d,isInitialized:h,setPageTitle:f,needsFirstBudget:p}=Je(),{requireUserEmail:g}=Mi(),b=A.useRef(!1),[_,w]=B1(),x=_.get("context");A.useEffect(()=>{x&&(_.delete("context"),w(_,{replace:!0}))},[x,_,w]);const S=x==="budget-not-found",C=p&&i.length===0;A.useLayoutEffect(()=>{f("My Budgets")},[f]),A.useEffect(()=>{h&&!b.current&&(b.current=!0,o())},[h,o]);const{budget:T,isLoading:R}=Rn(),{renameBudget:k}=hB(),{acceptInvite:V}=iL(),{createBudget:$}=sL(),[D,O]=A.useState(null),[N,U]=A.useState(null),[q,I]=A.useState(null),[z,M]=A.useState(null),[X,Y]=A.useState(null),[G,Z]=A.useState(""),[W,te]=A.useState(!1),[B,H]=A.useState(""),[ne,re]=A.useState(!1),[ce,_e]=A.useState(null),[Te,oe]=A.useState(""),[be,Ne]=A.useState(!1);async function Me(ie){if(ie!==T?.id){O(ie),I(null),M(null);try{await l(ie),M("Switched to budget successfully!"),await o({force:!0})}catch(Re){I(Re instanceof Error?Re.message:"Failed to switch budget")}finally{O(null)}}}async function Ge(ie){if(r){U(ie),I(null),M(null);try{await V.mutateAsync({budgetId:ie,userId:r}),M("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(Re){I(Re instanceof Error?Re.message:"Failed to accept invitation")}finally{U(null)}}}async function at(ie){if(ie.preventDefault(),!!B.trim()){re(!0),I(null),_e(null);try{const Re=await d(B.trim());Re?_e(Re):I("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Re){I(Re instanceof Error?Re.message:"Failed to check invitation")}finally{re(!1)}}}async function L(){if(!(!ce||!r)){ce.budgetName,U(ce.budgetId),I(null);try{await V.mutateAsync({budgetId:ce.budgetId,userId:r}),M(`Successfully joined "${ce.budgetName}"!`),_e(null),H(""),await o({force:!0})}catch(ie){I(ie instanceof Error?ie.message:"Failed to accept invitation")}finally{U(null)}}}function de(ie,Re){Z(Re),Y(ie)}async function ge(ie){if(ie.preventDefault(),!(!G.trim()||!X||!n)){G.trim(),te(!0),I(null),M(null);try{await k.mutateAsync({budgetId:n,newName:G.trim()}),M("Budget renamed successfully!"),Y(null),await o({force:!0})}catch(Re){I(Re instanceof Error?Re.message:"Failed to rename budget")}finally{te(!1)}}}async function ee(ie){if(ie.preventDefault(),!!r){Te.trim(),Ne(!0),I(null),M(null);try{const Re=await $.mutateAsync({name:Te.trim()||"My Budget",userId:r,userEmail:g()});await l(Re.budgetId),M("Budget created successfully!"),oe(""),await o({force:!0})}catch(Re){I(Re instanceof Error?Re.message:"Failed to create budget")}finally{Ne(!1)}}}const J=i.filter(ie=>!ie.isPending),ae=i.filter(ie=>ie.isPending);if(A.useEffect(()=>(R||!h?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[R,h,t,e]),R||!h)return null;let Se="My Budgets",we="Switch between budgets, accept invitations, or create a new budget.";return S?(Se="Budget Not Found",we="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):C&&(Se="Welcome!",we="Get started by creating your first budget or accepting an invitation."),u.jsxs("div",{children:[u.jsx("h1",{children:Se}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:we}),q&&u.jsx(lL,{message:q,onDismiss:()=>I(null)}),z&&u.jsx(cL,{message:z,onDismiss:()=>M(null)}),ae.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-warning) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-warning) 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Pending Invitations (",ae.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:ae.map(ie=>u.jsx(ZS,{budget:ie,isCurrent:!1,isAccepting:N===ie.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>Ge(ie.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},ie.id))})]}),J.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Your Budgets (",J.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:J.map(ie=>u.jsx(ZS,{budget:ie,isCurrent:ie.id===n,isAccepting:!1,isSwitching:D===ie.id,isEditing:X===ie.id,editName:X===ie.id?G:"",isRenaming:W,onAccept:()=>{},onSwitch:()=>Me(ie.id),onStartEdit:()=>de(ie.id,ie.name),onCancelEdit:()=>{Y(null),Z("")},onEditNameChange:Z,onSaveEdit:ge},ie.id))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-primary) 8%, transparent)",border:"1px solid color-mix(in srgb, var(--color-primary) 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Create New Budget"]}),u.jsxs("form",{onSubmit:ee,children:[u.jsxs("div",{style:{marginBottom:"1rem"},children:[u.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),u.jsx("input",{type:"text",value:Te,onChange:ie=>oe(ie.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),u.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),u.jsx("button",{type:"submit",disabled:be,style:{background:pe.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:be?"not-allowed":"pointer",fontWeight:500,opacity:be?.7:1,fontSize:"0.9rem"},children:be?"Creating...":"Create Budget"})]})]}),u.jsx(uL,{budgetIdInput:B,setBudgetIdInput:H,isCheckingManual:ne,manualInvite:ce,isAccepting:N,onCheckInvite:at,onAcceptInvite:L,onCancel:()=>{_e(null),H("")}}),r&&u.jsx(dL,{currentUserId:r})]})}const fL=["general","accounts","categories","users"];function mL(){const{addLoadingHold:t,removeLoadingHold:e}=jn(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:i,selectedBudgetId:o,setCurrentViewingDocument:l}=Je();A.useLayoutEffect(()=>{i("Budget Settings")},[i]),A.useEffect(()=>(o&&l({type:"budget"}),()=>{l({type:null})}),[o,l]);const{isOwner:d,isLoading:h,isFetching:f}=Rn();A.useEffect(()=>(h||f?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[h,f,t,e]);const p=tr(),g=p.pathname==="/budget/settings",b=A.useMemo(()=>{const C=p.pathname;return C.includes("/settings/general")?"general":C.includes("/settings/accounts")?"accounts":C.includes("/settings/categories")?"categories":C.includes("/settings/users")?"users":"general"},[p.pathname]),_=b==="users";A.useEffect(()=>{g||r(b)},[b,g,r]);function w(){return!fL.includes(n)||n==="users"&&!d?"general":n}const x=A.useMemo(()=>[{id:"general",label:"General",icon:""},{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!d}],[d]);return h||f?null:!d&&_?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Tn,{to:"/budget/settings/general",children:"Go to General "})})]}):u.jsxs("div",{children:[u.jsx(Vf,{mode:"link",linkPrefix:"/budget/settings",tabs:x,activeTab:g?w():b}),g?u.jsx(Hf,{to:`/budget/settings/${w()}`,replace:!0}):u.jsx(mA,{children:u.jsx(Gf,{})})]})}const sy=1,iy=12;function pL(){const{selectedBudgetId:t}=Je(),{budget:e,isLoading:n}=Rn(),r=e?.percentage_income_months_back??1,[i,o]=A.useState(r),[l,d]=A.useState(!1),[h,f]=A.useState(null);A.useEffect(()=>{o(e?.percentage_income_months_back??1)},[e?.percentage_income_months_back]);const p=Math.min(iy,Math.max(sy,Math.round(Number(i))||1));async function g(){if(!t)return;const _=p;f(null),d(!0);try{await vc({budgetId:t,updates:{percentage_income_months_back:_},description:"update percentage income months back"}),Pe.setQueryData(Ee.budget(t),w=>w&&{...w,budget:{...w.budget,percentage_income_months_back:_}}),await AB(t,_,Pe),o(_),f(null)}catch(w){const x=w instanceof Error?w.message:"Failed to save";console.error("[Settings/General] Failed to save percentage income months back:",w),$n.add({type:"error",message:"Failed to save setting. See console for details.",autoDismissMs:0}),f(x)}finally{d(!1)}}const b=p!==r;return n||!e?u.jsx("div",{style:{padding:"1rem"},children:u.jsx("p",{style:{opacity:.7},children:"Loading..."})}):u.jsxs("div",{style:{padding:"1rem",maxWidth:"32rem"},children:[u.jsx("h3",{style:{marginTop:0,marginBottom:"1rem"},children:"Budget behavior"}),u.jsxs("div",{style:{marginBottom:"1.5rem"},children:[u.jsx("label",{htmlFor:"percentage-income-months-back",style:{display:"block",marginBottom:"0.35rem",fontWeight:500},children:"Income reference for % allocations (months back)"}),u.jsx("p",{style:{fontSize:"0.85rem",opacity:.7,margin:"0 0 0.5rem 0"},children:"Percentage-based category allocations use income from this many months ago. Use 1 for previous month or 2 if you budget for the month after next."}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[u.jsx("input",{id:"percentage-income-months-back",type:"number",min:sy,max:iy,value:i,onChange:_=>{const w=_.target.value;o(w===""?1:Math.min(iy,Math.max(sy,Math.round(Number(w))||1)))},style:{width:"4rem",padding:"0.4rem 0.5rem",fontSize:"1rem",border:"1px solid var(--border-medium)",borderRadius:"6px"}}),u.jsx("span",{style:{opacity:.7},children:"month(s) back"}),b&&u.jsx("button",{type:"button",onClick:g,disabled:l,style:{padding:"0.4rem 0.75rem",background:"var(--color-primary)",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer",opacity:l?.7:1},children:l?"Saving":"Save"})]}),h&&u.jsx("p",{style:{marginTop:"0.5rem",color:"var(--color-error)",fontSize:"0.9rem"},"aria-live":"polite",children:"Save failed. See banner for details."})]}),u.jsx("p",{style:{fontSize:"0.8rem",opacity:.6},children:"Changing this only affects non-finalized allocation calculations. Finalized months keep their existing amounts."})]})}function d0({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:i,showGroupSelector:o=!1,showIncomeSettings:l=!1,hasExistingIncomeDefault:d=!1,hasExistingOutgoDefault:h=!1,currentGroupId:f,onDelete:p}){const[g,b]=A.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),_=g.account_group_id||f,w=_?i.find(k=>k.id===_):null,x=!!(w&&w.is_active!==null),S=!!(w&&w.on_budget!==null);function C(k){k.preventDefault(),g.nickname.trim()&&e(g)}function T(k){b({...g,is_income_account:k,is_income_default:k?g.is_income_default:!1})}function R(k){b({...g,is_outgo_account:k,is_outgo_default:k?g.is_outgo_default:!1})}return u.jsxs(Ii,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:C,children:[u.jsx(Nt,{label:"Account Nickname",htmlFor:"account-nickname",children:u.jsx(ki,{id:"account-nickname",type:"text",value:g.nickname,onChange:k=>b({...g,nickname:k.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&u.jsx(Nt,{label:"Account Type",htmlFor:"account-group",children:u.jsxs(Xu,{id:"account-group",value:g.account_group_id||en,onChange:k=>b({...g,account_group_id:k.target.value===en?null:k.target.value}),children:[u.jsx("option",{value:en,children:"Ungrouped"}),i.map(k=>u.jsx("option",{value:k.id,children:k.name},k.id))]})}),l&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Qr,{id:"is-active",checked:(()=>{if(x&&w){const k=w.is_active;return k===null||k===void 0?!1:k}return g.is_active??!0})(),onChange:k=>b({...g,is_active:k.target.checked}),disabled:x,children:u.jsx("span",{style:{opacity:x?.5:1},children:"Active account"})}),x&&w&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:pe.warning},children:['Set by account type "',w.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Qr,{id:"on-budget",checked:(()=>{if(S&&w){const k=w.on_budget;return k===null||k===void 0?!1:k}return g.on_budget??!0})(),onChange:k=>b({...g,on_budget:k.target.checked}),disabled:S,children:u.jsx("span",{style:{opacity:S?.5:1},children:"On budget (affects budget totals)"})}),S&&w&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:pe.warning},children:['Set by account type "',w.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Qr,{id:"is-hidden",checked:g.is_hidden||!1,onChange:k=>b({...g,is_hidden:k.target.checked}),children:"Hidden account"}),u.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),u.jsx(Qr,{id:"is-income-account",checked:g.is_income_account||!1,onChange:k=>T(k.target.checked),children:"Show in income deposit list"}),g.is_income_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Qr,{id:"is-income-default",checked:g.is_income_default||!1,onChange:k=>b({...g,is_income_default:k.target.checked}),disabled:d&&!t?.is_income_default,children:"Default account for new income"}),d&&!t?.is_income_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),u.jsx(Qr,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:k=>R(k.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Qr,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:k=>b({...g,is_outgo_default:k.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),u.jsxs(Ga,{children:[u.jsx($e,{type:"submit",actionName:r,children:r}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"}),p&&u.jsx($e,{type:"button",variant:"secondary",actionName:"Delete Account",onClick:k=>{k.preventDefault(),p()},style:{color:"var(--color-validation-error)",borderColor:"var(--color-validation-error)"},children:" Delete"})]})]})}function d1({label:t,value:e,onChange:n,trueLabel:r,falseLabel:i,undefinedLabel:o}){function l(){n(e===void 0?!0:e===!0?!1:void 0)}const d=e===!0?r:e===!1?i:o,h=e===!0?pe.success:e===!1?pe.warning:"inherit",f=e===!0?"":e===!1?"":"";return u.jsxs("button",{type:"button",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[u.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:f}),u.jsxs("span",{style:{flex:1},children:[u.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",u.jsx("span",{style:{fontWeight:500,color:h},children:d})]}),u.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function h1({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=A.useState(t||{name:"",expected_balance:"positive"});function l(d){d.preventDefault(),i.name.trim()&&e(i)}return u.jsxs(Ii,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:l,children:[u.jsx(Nt,{label:"Account Type Name",htmlFor:"group-name",children:u.jsx(ki,{id:"group-name",type:"text",value:i.name,onChange:d=>o({...i,name:d.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),u.jsx(Nt,{label:"Expected Balance",htmlFor:"expected-balance",children:u.jsxs(Xu,{id:"expected-balance",value:i.expected_balance,onChange:d=>o({...i,expected_balance:d.target.value}),children:[u.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),u.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),u.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),u.jsx(d1,{label:"Active status",value:i.is_active,onChange:d=>o({...i,is_active:d}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),u.jsx(d1,{label:"Budget status",value:i.on_budget,onChange:d=>o({...i,on_budget:d}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),u.jsxs(Ga,{children:[u.jsx($e,{type:"submit",actionName:r,children:r}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function Pl({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${pe.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${pe.success} 40%, transparent)`,color:pe.success,opacity:1},warning:{background:`color-mix(in srgb, ${pe.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${pe.warning} 35%, transparent)`,color:pe.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${pe.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${pe.success} 25%, transparent)`,color:pe.success,opacity:.7},expense:{background:`color-mix(in srgb, ${pe.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${pe.warning} 25%, transparent)`,color:pe.warning,opacity:.7}}[n];return u.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[u.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function f1({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(l=>l.id===t.account_group_id):null,i=r&&r.is_active!==null?r.is_active:t.is_active!==!1,o=r&&r.on_budget!==null?r.on_budget:t.on_budget!==!1;if(!i){const l=r&&r.is_active!==null;n.push(u.jsx(Pl,{icon:"",label:"Inactive",variant:"warning",title:l?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const l=r&&r.on_budget!==null;n.push(u.jsx(Pl,{icon:"",label:"Off Budget",variant:"warning",title:l?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(u.jsx(Pl,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(u.jsx(Pl,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(u.jsx(Pl,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(u.jsx(Pl,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:u.jsx(u.Fragment,{children:n})}function gL({account:t,accountIndex:e,allGroups:n,allAccounts:r,clearedBalance:i,onEdit:o,onDelete:l,onMoveUp:d,onMoveDown:h,canMoveUp:f,canMoveDown:p,editingAccountId:g,setEditingAccountId:b,onUpdateAccount:_,isMobile:w}){if(g===t.id)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(d0,{initialData:{nickname:t.nickname,account_group_id:t.account_group_id,is_income_account:t.is_income_account,is_income_default:t.is_income_default,is_outgo_account:t.is_outgo_account,is_outgo_default:t.is_outgo_default,on_budget:t.on_budget,is_active:t.is_active},onSubmit:T=>{_(t.id,T),b(null)},onCancel:()=>b(null),onDelete:()=>{t.nickname,l(t.id),b(null)},submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:t.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([T,R])=>R.is_income_default&&T!==t.id),hasExistingOutgoDefault:Object.entries(r).some(([T,R])=>R.is_outgo_default&&T!==t.id)})});if(w)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.nickname}),u.jsx("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:i?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total"}),u.jsx("span",{style:{color:ct(i.uncleared_balance),fontWeight:600},children:Pt(i.uncleared_balance)})]}),Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),u.jsx("span",{style:{color:ct(i.cleared_balance)},children:Pt(i.cleared_balance)})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),u.jsx("span",{style:{color:ct(i.uncleared_balance-i.cleared_balance)},children:Pt(i.uncleared_balance-i.cleared_balance)})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),u.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),u.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]})]})]}):u.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:u.jsx("span",{style:{color:ct(t.balance),fontWeight:600},children:Pt(t.balance)})})})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.5rem"},children:u.jsx(f1,{account:t,accountGroups:n})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),d()},disabled:!f,style:{background:"transparent",border:"none",cursor:f?"pointer":"default",opacity:f?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const S=e%2===0?"transparent":"var(--row-alt-bg)",C={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1.5fr 1fr"},children:[u.jsx("div",{style:{...C,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid var(--border-subtle)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),i?u.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(i.uncleared_balance),fontWeight:600},children:Pt(i.uncleared_balance)}):u.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(t.balance),fontWeight:600},children:Pt(t.balance)}),i?u.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(i.cleared_balance)},children:Math.abs(i.uncleared_balance-i.cleared_balance)<.01?u.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""}):Pt(i.cleared_balance)}):u.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(t.balance),fontWeight:600},children:Pt(t.balance)}),i&&Math.abs(i.uncleared_balance-i.cleared_balance)>=.01?u.jsx("div",{style:{...C,justifyContent:"flex-end",color:ct(i.uncleared_balance-i.cleared_balance)},children:Pt(i.uncleared_balance-i.cleared_balance)}):u.jsx("div",{style:{...C,justifyContent:"flex-end",opacity:.3,color:"var(--text-muted)"},children:""}),u.jsx("div",{style:{...C,gap:"0.25rem",flexWrap:"wrap"},children:u.jsx(f1,{account:t,accountGroups:n})}),u.jsxs("div",{style:{...C,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),d()},disabled:!f,style:{background:"transparent",border:"none",cursor:f?"pointer":"default",opacity:f?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function m1({group:t,accounts:e,allGroups:n,allAccounts:r,accountClearedBalances:i,editingAccountId:o,createForGroupId:l,setEditingAccountId:d,setCreateForGroupId:h,onUpdateAccount:f,onDeleteAccount:p,onMoveAccount:g,onCreateAccount:b,isMobile:_,isUngrouped:w,canMoveGroupUp:x,canMoveGroupDown:S,onEditGroup:C,onDeleteGroup:T,onMoveGroupUp:R,onMoveGroupDown:k}){const V=[...e].sort((D,O)=>D.sort_order-O.sort_order);V.reduce((D,O)=>D+O.balance,0);const $={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!_&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...$,opacity:w?.7:1,justifyContent:"space-between"},children:[u.jsxs("span",{children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",V.length,")"]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!w&&u.jsxs(u.Fragment,{children:[u.jsx($e,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,C()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:Uf,children:[u.jsx("button",{onClick:R,disabled:!x,style:{...va,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:k,disabled:!S,style:{...va,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})})]}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$}),u.jsx("div",{style:$})]}),_&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:w?.7:1},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",V.length,")"]})]}),Kt.showGroupTotals]}),!w&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx($e,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,C()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:Uf,children:[u.jsx("button",{onClick:R,disabled:!x,style:{...va,opacity:x?.6:.2,cursor:x?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:k,disabled:!S,style:{...va,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]}),V.map((D,O)=>u.jsx(gL,{account:D,accountIndex:O,totalAccounts:V.length,allGroups:n,allAccounts:r,clearedBalance:i?.[D.id],onEdit:d,onDelete:p,onMoveUp:()=>g(D.id,"up"),onMoveDown:()=>g(D.id,"down"),canMoveUp:O>0,canMoveDown:O<V.length-1,editingAccountId:o,setEditingAccountId:d,onUpdateAccount:f,isMobile:_},D.id)),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(d0,{initialData:{nickname:"",account_group_id:t.id},onSubmit:D=>b(D,t.id),onCancel:()=>h(null),submitLabel:"Create",accountGroups:n,showIncomeSettings:!0,currentGroupId:t.id})})]})}function yL({hiddenAccounts:t,accounts:e,sortedGroups:n,editingAccountId:r,setEditingAccountId:i,onUpdateAccount:o}){return t.length===0?null:u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(a0,{title:"Hidden Accounts",count:t.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.map(l=>r===l.id?u.jsx(d0,{initialData:{nickname:l.nickname,account_group_id:l.account_group_id,is_income_account:l.is_income_account,is_income_default:l.is_income_default,is_outgo_account:l.is_outgo_account,is_outgo_default:l.is_outgo_default,on_budget:l.on_budget,is_active:l.is_active,is_hidden:l.is_hidden},onSubmit:d=>{o(l.id,d),i(null)},onCancel:()=>i(null),submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:l.account_group_id,hasExistingIncomeDefault:Object.entries(e).some(([d,h])=>h.is_income_default&&d!==l.id),hasExistingOutgoDefault:Object.entries(e).some(([d,h])=>h.is_outgo_default&&d!==l.id)},l.id):u.jsxs("div",{onClick:()=>i(l.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:l.nickname}),u.jsx("span",{style:{color:ct(l.balance),fontWeight:500},children:Pt(l.balance)})]},l.id))})]})})}function _L(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Je(),{isLoading:r,isFetching:i,accounts:o}=Rn(),{month:l}=Ys(t,e,n),{accounts:d,accountsByGroup:h,hiddenAccounts:f,sortedGroups:p,currentBudget:g,error:b,setError:_,handleCreateAccount:w,handleUpdateAccount:x,handleDeleteAccount:S,handleMoveAccount:C,handleCreateGroup:T,handleUpdateGroup:R,handleDeleteGroup:k,handleMoveGroup:V}=mB(),$=Oi(),{addLoadingHold:D,removeLoadingHold:O}=jn(),N=r||i||!g;sA(!N&&!!g),A.useEffect(()=>(N?D("accounts","Loading accounts..."):O("accounts"),()=>O("accounts")),[N,D,O]);const[U,q]=A.useState(null),[I,z]=A.useState(null),[M,X]=A.useState(null),[Y,G]=A.useState(!1),Z=A.useMemo(()=>{const re=Object.values(d),ce=re.reduce((oe,be)=>oe+(be.balance??0),0);let _e=0,Te=0;for(const oe of re){const be=p.find(Me=>Me.id===oe.account_group_id);oe.on_budget===!0||oe.on_budget===void 0&&be?.on_budget!==!1?_e+=oe.balance??0:Te+=oe.balance??0}return{count:re.length,groupCount:p.filter(oe=>oe.id!==en).length,totalBalance:ce,onBudgetTotal:_e,offBudgetTotal:Te}},[d,p]),W=A.useMemo(()=>p.filter(re=>re.id!==en),[p]),te=A.useMemo(()=>({id:en,name:"Ungrouped",sort_order:W.length,expected_balance:"any",on_budget:null,is_active:null}),[W.length]),B=h[en]||[],H=A.useMemo(()=>l?xA(l,o):{},[l,o]),ne={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid var(--border-medium)"};return A.useEffect(()=>{b&&(console.error("[Settings/Accounts] Error:",b),$n.add({type:"error",message:"Failed to update accounts. See console for details.",autoDismissMs:0}),_(null))},[b,_]),N||!g?N?null:u.jsx("p",{children:"No budget found. Please log in."}):u.jsxs("div",{children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:$?"1fr":"2fr 1fr 1fr 1fr 1.5fr 1fr",marginBottom:"1.5rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"var(--sticky-header-bg)",display:$?"block":"grid",gridTemplateColumns:$?void 0:"subgrid"},children:[u.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:u.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid var(--border-medium)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:ct(Z.onBudgetTotal),fontWeight:600},children:Fn(Z.onBudgetTotal)})]}),Z.offBudgetTotal!==0&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),u.jsx("span",{style:{fontWeight:600,opacity:.7},children:Fn(Z.offBudgetTotal)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:ct(Z.totalBalance),fontWeight:600},children:Fn(Z.totalBalance)})]}),u.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:"Use  buttons to reorder accounts."})]})})}),!$&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ne,children:"Account"}),u.jsx("div",{style:{...ne,textAlign:"right"},children:"Total"}),u.jsx("div",{style:{...ne,textAlign:"right"},children:"Cleared"}),u.jsx("div",{style:{...ne,textAlign:"right"},children:"Uncleared"}),u.jsx("div",{style:ne,children:"Flags"}),u.jsx("div",{style:{...ne,textAlign:"right"},children:"Actions"})]})]}),Object.keys(d).length===0&&W.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No accounts yet. Create an account type first, then add accounts!"}),W.map((re,ce)=>{const _e=h[re.id]||[];return _e.length===0&&M!==re.id&&I!==re.id?null:M===re.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(h1,{initialData:{name:re.name,expected_balance:re.expected_balance||"positive",on_budget:re.on_budget??void 0,is_active:re.is_active??void 0},onSubmit:Te=>{R(re.id,Te),X(null)},onCancel:()=>X(null),submitLabel:"Save"})},re.id):u.jsx(m1,{group:re,accounts:_e,allGroups:W,allAccounts:d,accountClearedBalances:H,editingAccountId:U,createForGroupId:I,setEditingAccountId:q,setCreateForGroupId:z,onUpdateAccount:(Te,oe)=>{x(Te,oe),q(null)},onDeleteAccount:S,onMoveAccount:C,onCreateAccount:w,isMobile:$,canMoveGroupUp:ce>0,canMoveGroupDown:ce<W.length-1,onEditGroup:()=>X(re.id),onDeleteGroup:()=>k(re.id),onMoveGroupUp:()=>V(re.id,"up"),onMoveGroupDown:()=>V(re.id,"down")},re.id)}),(B.length>0||I==="ungrouped")&&u.jsx(m1,{group:te,accounts:B,allGroups:W,allAccounts:d,accountClearedBalances:H,editingAccountId:U,createForGroupId:I,setEditingAccountId:q,setCreateForGroupId:z,onUpdateAccount:(re,ce)=>{x(re,ce),q(null)},onDeleteAccount:S,onMoveAccount:C,onCreateAccount:w,isMobile:$,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{}}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),u.jsx(yL,{hiddenAccounts:f,accounts:d,sortedGroups:W,editingAccountId:U,setEditingAccountId:q,onUpdateAccount:x}),Y?u.jsx(h1,{onSubmit:re=>{T(re),G(!1)},onCancel:()=>G(!1),submitLabel:"Create Account Type"}):u.jsx($e,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>G(!0),children:"+ Add Account Type"})]})}function h0({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:i=[],showGroupSelector:o=!1,onDelete:l}){const[d,h]=A.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[f,p]=A.useState(t?.default_monthly_amount?.toString()||""),[g,b]=A.useState(t?.default_monthly_type||"fixed"),[_,w]=A.useState(!1);function x(S){if(S.preventDefault(),!d.name.trim())return;w(!0);const C=parseFloat(f),T=!isNaN(C)&&C>0;Promise.resolve(e({...d,description:d.description?.trim()||void 0,default_monthly_amount:T?C:void 0,default_monthly_type:T?g:void 0})).catch(R=>{console.error("[CategoryForm] Error submitting form:",R)}).finally(()=>{w(!1)}),n()}return u.jsxs(Ii,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:x,children:[u.jsx(Nt,{label:"Category Name",htmlFor:"category-name",children:u.jsx(ki,{id:"category-name",type:"text",value:d.name,onChange:S=>h({...d,name:S.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),u.jsx(Nt,{label:"Description (optional)",htmlFor:"category-description",children:u.jsx(r0,{id:"category-description",value:d.description||"",onChange:S=>h({...d,description:S.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&u.jsx(Nt,{label:"Category Group",htmlFor:"category-group",children:u.jsxs(Xu,{id:"category-group",value:d.category_group_id||Jt,onChange:S=>h({...d,category_group_id:S.target.value===Jt?null:S.target.value}),children:[u.jsx("option",{value:Jt,children:"Uncategorized"}),i.map(S=>u.jsx("option",{value:S.id,children:S.name},S.id))]})}),u.jsxs(Nt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[u.jsxs(Xu,{id:"default-type",value:g,onChange:S=>b(S.target.value),style:{width:"auto",flex:"0 0 auto"},children:[u.jsx("option",{value:"fixed",children:"Fixed $"}),u.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?u.jsx(Io,{id:"default-amount",value:f,onChange:p,placeholder:"$0.00"}):u.jsx(ki,{id:"default-amount",type:"number",value:f,onChange:S=>p(S.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&u.jsx("span",{style:{opacity:.6},children:"%"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[u.jsx(Qr,{id:"is-hidden",checked:d.is_hidden||!1,onChange:S=>h({...d,is_hidden:S.target.checked}),children:"Hidden category"}),u.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),u.jsxs(Ga,{children:[u.jsx($e,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:_,children:r}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"}),l&&u.jsx($e,{type:"button",variant:"secondary",actionName:"Delete Category",onClick:S=>{S.preventDefault(),l()},style:{color:"var(--color-validation-error)",borderColor:"var(--color-validation-error)"},children:" Delete"})]})]})}function p1({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=A.useState(t||{name:""}),[l,d]=A.useState(!1);function h(f){f.preventDefault(),i.name.trim()&&(d(!0),e(i))}return u.jsxs(Ii,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[u.jsx(Nt,{label:"Group Name",htmlFor:"group-name",children:u.jsx(ki,{id:"group-name",type:"text",value:i.name,onChange:f=>o({...i,name:f.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),u.jsxs(Ga,{children:[u.jsx($e,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:l,children:r}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function bL({category:t,catId:e,categoryIndex:n,categoryGroups:r,categoryBalances:i,loadingBalances:o,onEdit:l,onDelete:d,onMoveUp:h,onMoveDown:f,canMoveUp:p,canMoveDown:g,editingCategoryId:b,setEditingCategoryId:_,onUpdateCategory:w,isMobile:x}){const S=i[e]||{current:0,total:0};if(b===e)return u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(h0,{initialData:{name:t.name,description:t.description,category_group_id:t.category_group_id,default_monthly_amount:t.default_monthly_amount,default_monthly_type:t.default_monthly_type,is_hidden:t.is_hidden},onSubmit:k=>{w(e,k),_(null)},onCancel:()=>_(null),onDelete:()=>{t.name,d(e),_(null)},submitLabel:"Save",categoryGroups:r,showGroupSelector:!0})});if(x)return u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("span",{style:{fontWeight:500},children:t.name}),u.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:[t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Default"}),u.jsx("span",{style:{opacity:.7},children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${Xt(t.default_monthly_amount)}/mo`})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Available Now"}),u.jsx("span",{style:{color:dn(S.current),fontWeight:600},children:o?"...":br(S.current)})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total Allocated"}),u.jsx("span",{style:{color:dn(S.total)},children:o?"...":br(S.total)})]})]})]}),t.description&&u.jsx("p",{style:{fontSize:"0.8rem",opacity:.6,margin:"0 0 0.5rem 0"},children:t.description}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.8,marginBottom:"0.5rem"},children:["Default: ",t.default_monthly_type==="percentage"?u.jsxs(u.Fragment,{children:[u.jsxs("span",{style:{color:pe.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{color:pe.success,fontWeight:500},children:t.default_monthly_amount}),"/mo"]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[u.jsx("button",{onClick:k=>{k.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:k=>{k.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:k=>{k.stopPropagation(),f()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const T=n%2===0?"transparent":"var(--row-alt-bg)",R={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{gridColumn:"1 / -1",background:T,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 2fr 1fr"},children:[u.jsx("div",{style:{...R,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid var(--border-subtle)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...R,justifyContent:"flex-end",opacity:.7,fontSize:"0.85rem"},children:t.default_monthly_amount!==void 0&&t.default_monthly_amount>0?u.jsx("span",{children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${br(t.default_monthly_amount)}/mo`}):u.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"var(--text-muted)"},children:""})}),u.jsx("div",{style:{...R,justifyContent:"flex-end",color:dn(S.current),fontWeight:600},children:o?"...":br(S.current)}),u.jsx("div",{style:{...R,justifyContent:"flex-end",color:dn(S.total)},children:o?"...":br(S.total)}),u.jsx("div",{style:{...R,opacity:.7,fontSize:"0.85rem"},children:t.description?u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description}):u.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"var(--text-muted)"},children:""})}),u.jsxs("div",{style:{...R,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:k=>{k.stopPropagation(),t.name,l(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),u.jsx("button",{onClick:k=>{k.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),u.jsx("button",{onClick:k=>{k.stopPropagation(),f()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function g1({group:t,categories:e,categoryGroups:n,categoryBalances:r,loadingBalances:i,editingCategoryId:o,createForGroupId:l,setEditingCategoryId:d,setCreateForGroupId:h,handleUpdateCategory:f,handleDeleteCategory:p,handleMoveCategory:g,handleCreateCategory:b,isMobile:_,isUngrouped:w,startRowIndex:x=0,canMoveGroupUp:S,canMoveGroupDown:C,onEditGroup:T,onDeleteGroup:R,onMoveGroupUp:k,onMoveGroupDown:V}){const $=A.useMemo(()=>[...e].sort((U,q)=>U[1].sort_order-q[1].sort_order),[e]),D=$.reduce((U,[q])=>{const I=r[q];return U+(I?.current||0)},0),O=x===0,N={padding:"0.6rem 0.5rem",marginTop:O?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600,minWidth:0,overflow:"visible"};return u.jsxs("div",{style:{display:"contents"},children:[!_&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{...N,opacity:w?.7:1},children:u.jsxs("span",{style:{whiteSpace:"nowrap"},children:[u.jsx("span",{children:t.name}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",$.length,")"]})]})}),u.jsx("div",{style:N}),u.jsx("div",{style:{...N,justifyContent:"flex-end",color:dn(D)},children:Kt.showGroupTotals}),u.jsx("div",{style:{...N,justifyContent:"flex-end",color:dn($.reduce((U,[q])=>{const I=r[q];return U+(I?.total||0)},0))},children:Kt.showGroupTotals}),u.jsx("div",{style:N}),u.jsx("div",{style:{...N,justifyContent:"flex-end",gap:"0.25rem"},children:!w&&u.jsxs(u.Fragment,{children:[u.jsx($e,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,R()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:Uf,children:[u.jsx("button",{onClick:k,disabled:!S,style:{...va,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:V,disabled:!C,style:{...va,opacity:C?.6:.2,cursor:C?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})})]}),_&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:O?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:Ua,background:"var(--row-alt-bg)"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:w?.7:1,whiteSpace:"nowrap"},children:[t.name,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",$.length,")"]})]}),Kt.showGroupTotals]}),!w&&u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[u.jsx($e,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:l!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,R()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:Uf,children:[u.jsx("button",{onClick:k,disabled:!S,style:{...va,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:V,disabled:!C,style:{...va,opacity:C?.6:.2,cursor:C?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]}),$.map(([U,q],I)=>{const z=x+I;return u.jsx(bL,{category:q,catId:U,categoryIndex:z,totalCategories:$.length,categoryGroups:n,categoryBalances:r,loadingBalances:i,onEdit:d,onDelete:p,onMoveUp:()=>g(U,"up"),onMoveDown:()=>g(U,"down"),canMoveUp:I>0,canMoveDown:I<$.length-1,editingCategoryId:o,setEditingCategoryId:d,onUpdateCategory:f,isMobile:_},U)}),l===t.id&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:u.jsx(h0,{initialData:{name:"",category_group_id:t.id},onSubmit:U=>b(U,t.id),onCancel:()=>h(null),submitLabel:"Create",categoryGroups:n})})]})}function vL({onBudgetTotal:t,allocated:e,unallocated:n,relationshipMismatch:r,calculationMismatch:i}){return u.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:u.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid var(--border-medium)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Categories:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On Budget: "}),u.jsx("span",{style:{color:ct(t),fontWeight:600},children:Fn(t)})]}),u.jsx("span",{style:{opacity:r?1:.5,color:r?"var(--color-error)":void 0,fontWeight:r?700:void 0},children:r?"":"="}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Allocated: "}),u.jsx("span",{style:{color:Sc(e),fontWeight:600},children:Fn(e)})]}),u.jsx("span",{style:{opacity:r?1:.5,color:r?"var(--color-error)":void 0,fontWeight:r?700:void 0},children:"+"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Unallocated: "}),u.jsx("span",{style:{color:ct(n),fontWeight:600},children:Fn(n)})]}),u.jsx("span",{style:{opacity:.6},children:"Use  buttons to reorder categories."})]})})})}function xL(){const{isLoading:t,isFetching:e,totalAvailable:n}=Rn(),{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:l,hiddenCategories:d,sortedGroups:h,categoryBalances:f,isLoading:p,loadingBalances:g,error:b,setError:_,getOnBudgetTotal:w,handleCreateCategory:x,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateGroup:R,handleUpdateGroup:k,handleDeleteGroup:V,handleMoveGroup:$}=_B(),D=Oi(),{addLoadingHold:O,removeLoadingHold:N}=jn(),U=t||p||e||!r;sA(!U&&!!r),A.useEffect(()=>(U?O("categories","Loading categories..."):N("categories"),()=>N("categories")),[U,O,N]);const[q,I]=A.useState(null),[z,M]=A.useState(null),[X,Y]=A.useState(null),[G,Z]=A.useState(!1),W=A.useMemo(()=>h.filter(oe=>oe.id!==Jt),[h]),te=A.useMemo(()=>({id:Jt,name:"Uncategorized",sort_order:W.length}),[W.length]),B=(l[Jt]||[]).sort((oe,be)=>oe[1].sort_order-be[1].sort_order);A.useEffect(()=>{b&&(console.error("[Settings/Categories] Error:",b),$n.add({type:"error",message:"Failed to update categories. See console for details.",autoDismissMs:0}),_(null))},[b,_]);const H=A.useMemo(()=>w(),[w]),{allocated:ne,unallocated:re,calculationMismatch:ce,relationshipMismatch:_e}=bB({categories:i,categoryBalances:f,totalAvailable:n,onBudgetTotal:H,isDataLoading:U,loadingBalances:g,currentBudget:r});if(U||!r)return U?null:u.jsx("p",{children:"No budget found. Please log in."});const Te={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid var(--border-medium)"};return u.jsxs("div",{children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:D?"1fr":"2fr 1fr 1fr 1fr 2fr 1fr",marginBottom:"1.5rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"var(--sticky-header-bg)",display:D?"block":"grid",gridTemplateColumns:D?void 0:"subgrid"},children:[u.jsx(vL,{onBudgetTotal:H,allocated:ne,unallocated:re,relationshipMismatch:_e,calculationMismatch:ce}),!D&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Te,children:"Category"}),u.jsx("div",{style:{...Te,textAlign:"right"},children:"Default"}),u.jsx("div",{style:{...Te,textAlign:"right"},children:"Available Now"}),u.jsx("div",{style:{...Te,textAlign:"right"},children:"Total Allocated"}),u.jsx("div",{style:Te,children:"Description"}),u.jsx("div",{style:{...Te,textAlign:"right"},children:"Actions"})]})]}),Object.keys(i).length===0&&o.length===0&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No categories yet. Create a group first, then add categories!"}),(()=>{const oe={};let be=0;return W.forEach(Ne=>{const Me=(l[Ne.id]||[]).sort((Ge,at)=>Ge[1].sort_order-at[1].sort_order);oe[Ne.id]=be,be+=Me.length}),W.map((Ne,Me)=>{const Ge=(l[Ne.id]||[]).sort((at,L)=>at[1].sort_order-L[1].sort_order);return Ge.length===0&&X!==Ne.id&&z!==Ne.id?null:X===Ne.id?u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(p1,{initialData:{name:Ne.name},onSubmit:at=>{k(Ne.id,at),Y(null)},onCancel:()=>Y(null),submitLabel:"Save"})},Ne.id):u.jsx(g1,{group:Ne,categories:Ge,categoryGroups:o,categoryBalances:f,loadingBalances:g,editingCategoryId:q,createForGroupId:z,setEditingCategoryId:I,setCreateForGroupId:M,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateCategory:x,isMobile:D,canMoveGroupUp:Me>0,canMoveGroupDown:Me<W.length-1,onEditGroup:()=>Y(Ne.id),onDeleteGroup:()=>V(Ne.id),onMoveGroupUp:()=>$(Ne.id,"up"),onMoveGroupDown:()=>$(Ne.id,"down"),startRowIndex:oe[Ne.id]??0},Ne.id)})})(),(B.length>0||z==="ungrouped")&&(()=>{const oe=W.reduce((be,Ne)=>{const Me=(l[Ne.id]||[]).sort((Ge,at)=>Ge[1].sort_order-at[1].sort_order);return be+Me.length},0);return u.jsx(g1,{group:te,categories:B,categoryGroups:o,categoryBalances:f,loadingBalances:g,editingCategoryId:q,createForGroupId:z,setEditingCategoryId:I,setCreateForGroupId:M,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateCategory:x,isMobile:D,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{},startRowIndex:oe})})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),d.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(a0,{title:"Hidden Categories",count:d.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:d.map(([oe,be])=>q===oe?u.jsx(h0,{initialData:{name:be.name,description:be.description,category_group_id:be.category_group_id,default_monthly_amount:be.default_monthly_amount,default_monthly_type:be.default_monthly_type,is_hidden:be.is_hidden},onSubmit:Ne=>{S(oe,Ne),I(null)},onCancel:()=>I(null),submitLabel:"Save",categoryGroups:o,showGroupSelector:!0},oe):u.jsxs("div",{onClick:()=>I(oe),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:be.name}),u.jsx("span",{style:{color:ct(be.balance),fontWeight:500},children:Fn(be.balance)})]},oe))})]})}),G?u.jsx(p1,{onSubmit:oe=>{R(oe),Z(!1)},onCancel:()=>Z(!1),submitLabel:"Create Group"}):u.jsx($e,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>Z(!0),children:"+ Add Category Group"})]})}function wL(){const{selectedBudgetId:t,currentUserId:e}=Je(),{addLoadingHold:n,removeLoadingHold:r}=jn(),{budget:i,budgetUserIds:o,acceptedUserIds:l,isLoading:d}=Rn();A.useEffect(()=>(d||!i?n("users","Loading users..."):r("users"),()=>r("users")),[d,i,n,r]);const{inviteUser:h}=aL(),{revokeUser:f}=oL(),[p,g]=A.useState(""),[b,_]=A.useState(!1),[w,x]=A.useState(null),[S,C]=A.useState(null);if(d)return null;if(!i)return u.jsx("p",{children:"No budget found."});async function T($){if($.preventDefault(),!(!p.trim()||!i||!t)){_(!0),x(null),C(null);try{await h.mutateAsync({budgetId:t,userId:p.trim()}),g(""),C("Invite sent! The user can now accept the invitation from their account.")}catch(D){x(D instanceof Error?D.message:"Failed to invite user")}finally{_(!1)}}}async function R($){if(!i||!t)return;if($===i.owner_id){x("Cannot revoke the budget owner");return}if($===e){x("Cannot revoke yourself from the budget");return}const D=l.includes($);if(confirm(D?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){x(null),C(null);try{await f.mutateAsync({budgetId:t,userId:$}),C(D?"User access revoked.":"Invitation cancelled.")}catch(N){x(N instanceof Error?N.message:"Failed to revoke user")}}}const k=o.filter($=>l.includes($)),V=o.filter($=>!l.includes($));return u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),w&&u.jsxs("div",{style:{background:"var(--color-error-bg)",border:"1px solid var(--color-error-border)",color:"var(--color-error)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:w}),u.jsx("button",{onClick:()=>x(null),style:{background:"transparent",border:"none",color:"var(--color-error)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),S&&u.jsxs("div",{style:{background:"var(--color-success-bg)",border:"1px solid var(--color-success-border)",color:"var(--color-success)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:S}),u.jsx("button",{onClick:()=>C(null),style:{background:"transparent",border:"none",color:"var(--color-success)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",k.length,")"]}),k.length===0?u.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:k.map($=>{const D=$===i.owner_id,O=$===e;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),D&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),O&&u.jsx("span",{style:{background:"color-mix(in srgb, var(--color-success) 20%, transparent)",color:"var(--color-success)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!D&&!O&&u.jsx("button",{onClick:()=>R($),style:{background:"transparent",border:"1px solid var(--color-error-border)",color:"var(--color-error)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},$)})})]}),V.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",V.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:V.map($=>u.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-warning) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-warning) 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:$}),u.jsx("span",{style:{background:"color-mix(in srgb, var(--color-warning) 20%, transparent)",color:"var(--color-warning)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),u.jsx("button",{onClick:()=>R($),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},$))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),u.jsxs("form",{onSubmit:T,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:p,onChange:$=>g($.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:b||!p.trim(),style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:b||!p.trim()?"not-allowed":"pointer",fontWeight:500,opacity:b||!p.trim()?.7:1,whiteSpace:"nowrap"},children:b?"Inviting...":"Send Invite"})]}),u.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),u.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:i.id})]})]})}const SL=["budget","feedback","migration","tests"];function EL(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:i}=Je(),l=Mi().get_current_firebase_user(),d=LT(l?.uid||null,l?.email||null);A.useLayoutEffect(()=>{i("Budget Admin")},[i]);const h=tr(),f=h.pathname==="/budget/admin",p=A.useMemo(()=>{const w=h.pathname;return w.includes("/admin/budget")?"budget":w.includes("/admin/feedback")?"feedback":w.includes("/admin/migration")?"migration":w.includes("/admin/tests")?"tests":"budget"},[h.pathname]),g=p==="tests";A.useEffect(()=>{f||r(p)},[p,f,r]);function b(){return!SL.includes(n)||n==="tests"&&!e?"budget":n}const _=A.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return d.isLoading||d.isFetching?null:t?!e&&g?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Tn,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):u.jsxs("div",{children:[u.jsx(Vf,{mode:"link",linkPrefix:"/budget/admin",tabs:_,activeTab:p}),f?u.jsx(Hf,{to:`/budget/admin/${b()}`,replace:!0}):u.jsx(Gf,{})]}):u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Tn,{to:"/budget",children:"Go to Budget "})})]})}function CL(){const{addLoadingHold:t,removeLoadingHold:e}=jn(),{isAdmin:n}=Je(),{budget:r,accounts:i,accountGroups:o,categories:l,categoryGroups:d,isOwner:h,isLoading:f}=Rn();return A.useEffect(()=>(f?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[f,t,e]),f?null:r?u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),u.jsx("strong",{children:r.name})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),u.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),u.jsx("strong",{children:r.owner_email||r.owner_id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),u.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",u.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),u.jsx("button",{onClick:()=>{const p={...r,accounts:i,account_groups:o,categories:l,category_groups:d,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),b=URL.createObjectURL(g),_=document.createElement("a");_.href=b,_.download=`budget_${r.id}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(b)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):u.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function y1({selectedType:t,onSelect:e}){return u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=Zu[n],i=t==="feature"?"new_feature":t,o=i===n||!i&&n==="bug";return u.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"var(--text-muted)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function TL(){const[t,e]=A.useState(null),[n,r]=A.useState(null),[i,o]=A.useState(!1),[l,d]=A.useState(""),[h,f]=A.useState("bug"),[p,g]=A.useState(null),[b,_]=A.useState(!1),[w,x]=A.useState(null),S=A.useContext(xd),T=Mi().get_current_firebase_user(),R=Ut(),k=jP(),{submitFeedback:V}=hA(),{toggleFeedback:$}=X3(),{updateSortOrder:D}=Z3(),O=k.data?.items||[],N=Oi(),{addLoadingHold:U,removeLoadingHold:q}=jn();A.useEffect(()=>(k.isLoading?U("settings-feedback","Loading feedback..."):q("settings-feedback"),()=>q("settings-feedback")),[k.isLoading,U,q]);function I(oe){oe.preventDefault(),!(!l.trim()||!S.username||!T)&&(V.mutate({userId:T.uid,userEmail:S.username,text:l.trim(),feedbackType:h,currentPath:"/settings/feedback"}),d(""),f("bug"),o(!1))}function z(oe){oe.is_done?M(oe):g(oe)}async function M(oe){try{await $.mutateAsync({item:oe})}catch(be){console.error("[Feedback] Error updating feedback:",be),$n.add({type:"error",message:"Failed to update feedback",autoDismissMs:5e3})}}function X(){p&&(M(p),g(null))}async function Y(){_(!1);const oe="mark-all-feedback-complete";U(oe,`Marking ${W.length} item${W.length!==1?"s":""} as complete...`);try{const be=new Date().toISOString(),Ne=new Set(W.map(de=>de.id)),Me=new Map;for(const de of W)Me.has(de.doc_id)||Me.set(de.doc_id,[]),Me.get(de.doc_id).push(de);const Ge=[];for(const[de,ge]of Me){const ee=(async()=>{const ae=(await dA(de,"mark all feedback complete")).items.map(Se=>Ne.has(Se.id)?{...Se,is_done:!0,completed_at:be}:Se);await i0({docId:de,items:ae,description:`marking ${ge.length} feedback item${ge.length!==1?"s":""} as complete`})})();Ge.push(ee)}await Promise.all(Ge);const at=Ee.feedback(),L=R.getQueryData(at);L&&R.setQueryData(at,{items:L.items.map(de=>Ne.has(de.id)?{...de,is_done:!0,completed_at:be}:de)}),await R.invalidateQueries({queryKey:at}),$n.add({type:"success",message:`Marked ${W.length} item${W.length!==1?"s":""} as complete`,autoDismissMs:3e3})}catch(be){console.error("[Feedback] Error marking all as complete:",be),$n.add({type:"error",message:"Failed to mark all items as complete",autoDismissMs:5e3}),await R.invalidateQueries({queryKey:Ee.feedback()})}finally{q(oe)}}function G(){Y()}async function Z(oe){if(w){try{const Ne=O.filter(Me=>Me.doc_id===w.doc_id).map(Me=>({id:Me.id,text:Me.text,created_at:Me.created_at,is_done:Me.is_done,completed_at:Me.completed_at,sort_order:Me.sort_order,feedback_type:Me.id===w.id?oe:Me.feedback_type}));await D.mutateAsync({docId:w.doc_id,items:Ne})}catch(be){console.error("[Feedback] Error updating feedback type:",be),$n.add({type:"error",message:"Failed to update feedback type",autoDismissMs:5e3})}x(null)}}const W=O.filter(oe=>!oe.is_done).sort((oe,be)=>oe.sort_order-be.sort_order),te=O.filter(oe=>oe.is_done).sort((oe,be)=>new Date(be.completed_at||0).getTime()-new Date(oe.completed_at||0).getTime());function B(oe,be){e(be),oe.dataTransfer.effectAllowed="move"}function H(oe,be){oe.preventDefault(),be!==t&&r(be)}function ne(){r(null)}function re(){e(null),r(null)}async function ce(oe,be){if(oe.preventDefault(),!t||t===be){re();return}const Ne=W.findIndex(de=>de.id===t),Me=[...W],[Ge]=Me.splice(Ne,1);if(be==="__end__")Me.push(Ge);else{const de=Me.findIndex(ge=>ge.id===be);Me.splice(de,0,Ge)}const at=Me.map((de,ge)=>({...de,sort_order:ge}));re();const L=new Map;for(const de of at)L.has(de.doc_id)||L.set(de.doc_id,[]),L.get(de.doc_id).push({id:de.id,text:de.text,created_at:de.created_at,is_done:de.is_done,completed_at:de.completed_at,sort_order:de.sort_order,feedback_type:de.feedback_type});for(const de of te)L.has(de.doc_id)||L.set(de.doc_id,[]),L.get(de.doc_id).push({id:de.id,text:de.text,created_at:de.created_at,is_done:de.is_done,completed_at:de.completed_at,sort_order:de.sort_order,feedback_type:de.feedback_type});try{for(const[de,ge]of L)await D.mutateAsync({docId:de,items:ge})}catch(de){console.error("[Feedback] Error saving order:",de),$n.add({type:"error",message:"Failed to save order",autoDismissMs:5e3})}}function _e(){const oe=Te(W),be=new Blob([oe],{type:"text/markdown"}),Ne=URL.createObjectURL(be),Me=document.createElement("a");Me.href=Ne,Me.download=`feedback-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(Me),Me.click(),document.body.removeChild(Me),URL.revokeObjectURL(Ne)}function Te(oe){let be=`# Feedback Export

`;return be+=`Generated: ${new Date().toISOString()}

`,oe.length>0&&(be+=`## Pending

`,oe.forEach((Ne,Me)=>{const Ge=Ne.feedback_type?Zu[Ne.feedback_type]?.label||Ne.feedback_type:"Unknown";be+=`### ${Me+1}. [${Ge}] ${Ne.text.split(`
`)[0].substring(0,60)}${Ne.text.split(`
`)[0].length>60?"...":""}

`,be+=`- **Type:** ${Ge}
`,be+=`- **Created:** ${Ne.created_at}
`,be+=`- **User:** ${Ne.user_email||Ne.doc_id}
`,be+=`- **ID:** ${Ne.id}

`,be+=`${Ne.text}

`,be+=`---

`})),be}return k.isLoading?null:u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",flexDirection:N?"column":"row",justifyContent:"space-between",alignItems:N?"stretch":"flex-start",gap:N?"0.75rem":"1rem",marginTop:"1.5rem",marginBottom:"0.5rem"},children:[u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Feedback"}),u.jsx("p",{style:{...qT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexDirection:N?"column":"row"},children:[u.jsx($e,{variant:"secondary",actionName:"Download Feedback as Markdown",onClick:_e,disabled:W.length===0,style:N?{width:"100%"}:void 0,children:"Download Markdown"}),u.jsx($e,{variant:"secondary",actionName:"Mark All Complete",onClick:()=>_(!0),disabled:W.length===0,style:N?{width:"100%"}:void 0,children:"Mark All Complete"})]})]}),u.jsxs("div",{style:US,children:[W.length===0&&!i&&u.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),W.map(oe=>u.jsx(Oz,{item:oe,isDragging:t===oe.id,isDragOver:n===oe.id,onDragStart:be=>B(be,oe.id),onDragOver:be=>H(be,oe.id),onDragLeave:ne,onDragEnd:re,onDrop:be=>ce(be,oe.id),onToggleDone:()=>z(oe),onTypeClick:()=>x(oe)},oe.id)),t&&W.length>0&&u.jsx(K3,{isActive:n==="__end__",onDragOver:oe=>H(oe,"__end__"),onDragLeave:ne,onDrop:oe=>ce(oe,"__end__")})]}),i?u.jsxs(Ii,{actionName:"Add Feedback",onSubmit:I,children:[u.jsx(y1,{selectedType:h,onSelect:f}),u.jsx(r0,{value:l,onChange:oe=>d(oe.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),u.jsxs(Ga,{children:[u.jsx($e,{type:"submit",actionName:"Add Feedback",disabled:!l.trim(),children:"Add Feedback"}),u.jsx($e,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{o(!1),d(""),f("bug")},children:"Cancel"})]})]}):u.jsx($e,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>o(!0),children:"+ Add Feedback"}),te.length>0&&u.jsx(a0,{title:"Completed",count:te.length,children:u.jsx("div",{style:{...US,marginTop:"0.5rem"},children:te.map(oe=>u.jsx(Nz,{item:oe,onToggleDone:()=>z(oe),onTypeClick:()=>x(oe)},oe.id))})}),u.jsxs(Qs,{isOpen:p!==null,onClose:()=>g(null),title:"Mark as Complete",children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),p&&u.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"var(--row-alt-bg)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',p.text,'"']}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>g(null),children:"Cancel"}),u.jsx($e,{variant:"primary",actionName:"Confirm Mark Complete",onClick:X,children:"Mark Complete"})]})]}),u.jsxs(Qs,{isOpen:b,onClose:()=>_(!1),title:"Mark All as Complete",children:[u.jsxs("p",{style:{margin:"0 0 1.5rem 0"},children:["Are you sure you want to mark all ",W.length," pending feedback item",W.length!==1?"s":""," as complete?"]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx($e,{variant:"secondary",actionName:"Cancel Mark All Complete",onClick:()=>_(!1),children:"Cancel"}),u.jsx($e,{variant:"primary",actionName:"Confirm Mark All Complete",onClick:G,children:"Mark All Complete"})]})]}),u.jsxs(Qs,{isOpen:w!==null,onClose:()=>x(null),title:"Change Feedback Type",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),u.jsx(y1,{selectedType:w?.feedback_type||"bug",onSelect:Z}),u.jsx($e,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>x(null),style:{width:"100%"},children:"Cancel"})]})]})}function AL(){Pe.clear(),window.location.reload()}function jL(){const e=Mi().get_current_firebase_user(),{selectedBudgetId:n}=Je(),r=R3({currentUser:e}),i=D3({currentUser:e}),o=N3({currentUser:e}),l=T3({currentUser:e}),d=o3({currentUser:e}),h=r3({currentUser:e}),f=f3({currentUser:e}),p=QB({currentUser:e}),g=z3({currentUser:e}),b=F3({currentUser:e}),_=q3({currentUser:e,budgetId:n}),w=Q3({currentUser:e}),x=VB({currentUser:e}),S=$B({currentUser:e}),C=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning||h.isScanning||f.isScanning||p.isScanning||g.isScanning||b.isScanning||x.isScanning||S.isScanning,T=r.isRunning||i.isRunning||o.isRunning||d.isRunning||h.isRunning||f.isRunning||p.isRunning||g.isRunning||b.isRunning||x.isDeleting||S.isDeleting||_.isDownloading||w.isUploading,R=async()=>{await Promise.all([r.scanStatus(),i.scanStatus(),o.scanStatus(),l.scan(),d.scanStatus(),h.scanStatus(),f.scanStatus(),p.scan(),g.scanStatus(),b.scanStatus(),x.scanStatus(),S.scanStatus()])};return u.jsxs("div",{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("h2",{style:{margin:0},children:"Data Migrations"}),u.jsxs("button",{onClick:R,disabled:C||T,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:C||T?"not-allowed":"pointer",fontWeight:500,opacity:C||T?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[u.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:C?u.jsx(qn,{noMargin:!0}):""}),"Refresh All"]})]}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),u.jsx(Xz,{disabled:!e,onDownloadBackup:_.downloadBudget,isDownloadingBackup:_.isDownloading,removeTotalFieldsMigration:{status:r.status,hasData:!!r.status,needsMigration:r.needsMigration,totalItemsToFix:r.totalItemsToFix,isScanning:r.isScanning,isRunning:r.isRunning,result:r.result,scanStatus:r.scanStatus,runMigration:r.runMigration},removePreviousMonthIncomeMigration:{status:i.status,hasData:!!i.status,needsMigration:i.needsMigration,totalItemsToFix:i.totalItemsToFix,isScanning:i.isScanning,isRunning:i.isRunning,result:i.result,scanStatus:i.scanStatus,runMigration:i.runMigration},percentageIncomeMonthsBackMigration:{status:o.status,hasData:!!o.status,needsMigration:o.needsMigration,totalItemsToFix:o.totalItemsToFix,isScanning:o.isScanning,isRunning:o.isRunning,result:o.result,scanStatus:o.scanStatus,runMigration:o.runMigration}}),u.jsx(r4,{disabled:!e,onDownloadBackup:_.downloadBudget,isDownloadingBackup:_.isDownloading,accountCategoryValidation:{status:l.status,hasData:!!l.status,hasViolations:l.hasViolations,violationCount:l.violationCount,isScanning:l.isScanning,report:l.report,scan:l.scan},orphanedIdCleanup:{status:d.status,hasData:!!d.status,hasItemsToFix:d.hasItemsToFix,totalOrphaned:d.status?d.status.orphanedCategoryIds+d.status.orphanedAccountIds:0,isScanning:d.isScanning,isRunning:d.isRunning,result:d.result,scanStatus:d.scanStatus,runMigration:d.runMigration},expenseToAdjustment:{status:h.status,hasData:!!h.status,hasItemsToMigrate:h.hasItemsToMigrate,totalToMigrate:h.status?.expensesToMigrate??0,isScanning:h.isScanning,isRunning:h.isRunning,result:h.result,scanStatus:h.scanStatus,runMigration:h.runMigration},adjustmentsToTransfers:{status:f.status,hasData:!!f.status,hasPairsToConvert:f.hasPairsToConvert,totalPairs:f.status?.pairsFound??0,isScanning:f.isScanning,isRunning:f.isRunning,result:f.result,scanStatus:f.scanStatus,runMigration:f.runMigration},precisionCleanup:{status:p.status,hasData:p.hasData,hasIssues:p.hasIssues,totalIssues:p.totalIssues,isScanning:p.isScanning,isRunning:p.isRunning,result:p.result,scan:p.scan,runCleanup:p.runCleanup},recalculateStartBalances:{status:g.status,hasData:!!g.status,needsMigration:g.needsMigration,totalItemsToFix:g.totalItemsToFix,isScanning:g.isScanning,isRunning:g.isRunning,result:g.result,scanStatus:g.scanStatus,runMigration:g.runMigration},repairMonthMap:{status:b.status,hasData:!!b.status,needsMigration:b.needsMigration,totalItemsToFix:b.totalItemsToFix,isScanning:b.isScanning,isRunning:b.isRunning,result:b.result,scanStatus:b.scanStatus,runMigration:b.runMigration}}),u.jsx(l4,{disabled:!e,onDownloadBackup:_.downloadBudget,isDownloadingBackup:_.isDownloading,budgetDownloadUpload:{isDownloading:_.isDownloading,downloadProgress:_.progress,downloadError:_.error,downloadBudget:_.downloadBudget,isScanning:w.isScanning,isUploading:w.isUploading,uploadStatus:w.status,uploadProgress:w.progress,uploadError:w.error,uploadResult:w.result,scanZipFile:w.scanZipFile,uploadBudget:w.uploadBudget},deleteAllMonths:{status:x.status,hasData:!!x.status,monthsCount:x.status?.monthsCount??0,budgetCount:x.status?.budgetCount??0,isScanning:x.isScanning,isDeleting:x.isDeleting,deleteResult:x.deleteResult,deleteProgress:x.deleteProgress,scanStatus:x.scanStatus,deleteAllMonths:x.deleteAllMonths},deleteSampleUserBudget:{status:S.status,hasData:!!S.status,totalBudgets:S.status?.totalBudgets??0,totalMonths:S.status?.totalMonths??0,isScanning:S.isScanning,isDeleting:S.isDeleting,deleteResult:S.deleteResult,deleteProgress:S.deleteProgress,scanStatus:S.scanStatus,deleteSampleUserBudget:S.deleteSampleUserBudget},onClearCache:AL}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:u.jsxs("p",{style:{margin:0,opacity:.7},children:[u.jsx("strong",{children:"Note:"})," These migrations will process ",u.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),u.jsx(_A,{})]})}function Bl({name:t,description:e,expectedBehavior:n,result:r,onRun:i,disabled:o,expectedToSucceed:l}){const d=r?.status==="passed"?pe.success:r?.status==="failed"?pe.danger:r?.status==="running"?pe.warning:"inherit";return u.jsxs("div",{style:{...e0,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1},children:[u.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),u.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),u.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:l?pe.success:pe.warning},children:["Expected: ",n]})]}),u.jsx($e,{onClick:i,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&u.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,fontSize:"0.85rem",color:d},children:r.message})]})}function RL({totalCount:t,passedCount:e,failedCount:n}){return u.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[u.jsxs("span",{children:["Total: ",u.jsx("strong",{children:t})]}),u.jsxs("span",{style:{color:pe.success},children:["Passed: ",u.jsx("strong",{children:e})]}),u.jsxs("span",{style:{color:pe.danger},children:["Failed: ",u.jsx("strong",{children:n})]})]})}const _1=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function IL(){const{currentUserId:t}=Je(),[e,n]=A.useState([]),[r,i]=A.useState(!1);function o(_,w){n(x=>x.map(S=>S.name===_?{...S,...w}:S))}async function l(_,w,x){o(_,{status:"running",message:"Running..."});try{const S=await w();x?o(_,{status:"failed",message:` ${S}`}):o(_,{status:"passed",message:` ${S}`})}catch(S){const C=S instanceof Error?S.message:"Unknown error";x?o(_,{status:"passed",message:` Blocked as expected: ${C}`}):o(_,{status:"failed",message:` ${C}`})}}async function d(){i(!0),n(_1.map(_=>({..._,status:"pending",message:""})));for(const _ of _1)await h(_.name);i(!1)}async function h(_){switch(_){case"Read unauthorized budget":await l(_,async()=>(await Bt("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await l(_,async()=>(await Bt("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await l(_,async()=>(await Bt("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:w}=await Bt("users",t,"security test: reading own user to get current is_admin value"),x=w?.permission_flags?.is_admin??!1;return await Qu("users",t,{"permission_flags.is_admin":!x},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:w}=await Bt("users",t,"security test: reading own user to get current is_test value"),x=w?.permission_flags?.is_test??!1;return await Qu("users",t,{"permission_flags.is_test":!x},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{exists:w}=await Bt("users",t,"security test: reading own user document (should succeed)");if(w)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function f(_){e.find(x=>x.name===_)||n(x=>[...x,{name:_,status:"pending",message:"",expectedToFail:!0}]),i(!0),await h(_),i(!1)}const p=e.filter(_=>_.status==="passed").length,g=e.filter(_=>_.status==="failed").length,b=e.length;return u.jsxs("div",{children:[u.jsx("p",{style:qT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),u.jsx("div",{style:{marginBottom:"1.5rem"},children:u.jsx($e,{onClick:d,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&u.jsx(RL,{totalCount:b,passedCount:p,failedCount:g}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),u.jsx(Bl,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read unauthorized budget"),onRun:()=>f("Read unauthorized budget"),disabled:r}),u.jsx(Bl,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read another user's document"),onRun:()=>f("Read another user's document"),disabled:r}),u.jsx(Bl,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(_=>_.name==="Read unauthorized budget month"),onRun:()=>f("Read unauthorized budget month"),disabled:r}),u.jsx(Bl,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_admin in own permission_flags"),onRun:()=>f("Toggle is_admin in own permission_flags"),disabled:r}),u.jsx(Bl,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_test in own permission_flags"),onRun:()=>f("Toggle is_test in own permission_flags"),disabled:r}),u.jsx(Bl,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(_=>_.name==="Read own user document"),onRun:()=>f("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&u.jsxs(Cm,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function kL({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=jn(),r=A.useContext(xd),i=tr();return A.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?u.jsx(u.Fragment,{children:t}):u.jsx(Gf,{}):u.jsx(Hf,{to:"/account",state:{from:i.pathname},replace:!0}):null}function DL(){const{addLoadingHold:t,removeLoadingHold:e}=jn(),{isInitialized:n,pageTitle:r}=Je(),{isLoading:i,error:o}=Rn();return A.useEffect(()=>{n?e("budget-init"):t("budget-init",i?"Fetching data from server...":"Loading budget...")},[n,i,t,e]),A.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),u.jsx("div",{style:Lf,children:u.jsxs("p",{style:{color:"var(--color-error)"},children:["Error: ",o.message]})})):u.jsx("div",{style:{...Lf,paddingBottom:"5rem"},children:u.jsxs(mA,{children:[u.jsx(rz,{title:r}),n&&u.jsx(Gf,{})]})})}const ML={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function OL(){const{isLoading:t,loadingMessage:e}=jn();return t?u.jsx(c4,{message:e}):null}function NL(){const[t,e]=A.useState(null);return A.useEffect(()=>$n.subscribe(e),[]),t?u.jsx(iz,{item:t,onDismiss:n=>$n.remove(n)}):null}function PL(){const{selectedBudgetId:t,isInitialized:e}=Je(),n=Ut(),r=t?["initialDataLoad",t]:null,i=r?n.getQueryState(r)?.status==="success":!1;return In(),IB(t,i&&e),u.jsxs(u.Fragment,{children:[u.jsxs(uI,{children:[u.jsx(bn,{path:"/",element:u.jsx(u4,{})}),u.jsx(bn,{path:"/account",element:u.jsx(d4,{})}),u.jsx(bn,{path:"/budget",element:u.jsx(kL,{}),children:u.jsxs(bn,{element:u.jsx(DL,{}),children:[u.jsx(bn,{index:!0,element:u.jsx(u1,{})}),u.jsx(bn,{path:":year/:month/:tab/:view?",element:u.jsx(u1,{})}),u.jsx(bn,{path:"analytics",element:u.jsx(rL,{})}),u.jsx(bn,{path:"my-budgets",element:u.jsx(hL,{})}),u.jsxs(bn,{path:"settings",element:u.jsx(mL,{}),children:[u.jsx(bn,{index:!0,element:u.jsx(Hf,{to:"general",replace:!0})}),u.jsx(bn,{path:"general",element:u.jsx(pL,{})}),u.jsx(bn,{path:"accounts",element:u.jsx(_L,{})}),u.jsx(bn,{path:"categories",element:u.jsx(xL,{})}),u.jsx(bn,{path:"users",element:u.jsx(wL,{})})]}),u.jsxs(bn,{path:"admin",element:u.jsx(EL,{}),children:[u.jsx(bn,{path:"budget",element:u.jsx(CL,{})}),u.jsx(bn,{path:"feedback",element:u.jsx(TL,{})}),u.jsx(bn,{path:"migration",element:u.jsx(jL,{})}),u.jsx(bn,{path:"tests",element:u.jsx(IL,{})})]})]})})]}),u.jsx(ez,{}),u.jsx(_A,{}),u.jsx(NL,{})]})}function BL(){const[t,e]=A.useState(ML),n=Mi(),r=A.useRef(!1),{addLoadingHold:i,removeLoadingHold:o}=jn();return A.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(l=>{e({is_logged_in:l!=null,is_auth_checked:!0,username:l?.email??"",set_user_context:e})}))},[n]),A.useEffect(()=>{t.is_auth_checked?o("auth"):i("auth","Authenticating...")},[t.is_auth_checked,i,o]),t.is_auth_checked?u.jsx(xd.Provider,{value:t,children:u.jsx(RM,{children:u.jsx(kz,{children:u.jsx(cB,{children:u.jsx(LB,{children:u.jsx(NI,{children:u.jsx(PL,{})})})})})})}):null}function zL(){return u.jsxs(A2,{children:[u.jsx(OL,{}),u.jsx(BL,{})]})}uR.createRoot(document.getElementById("root")).render(u.jsx(A.StrictMode,{children:u.jsx(zL,{})}));
