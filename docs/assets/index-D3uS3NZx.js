(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var zh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function q5(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Eg={exports:{}},gu={};var Ax;function H5(){if(Ax)return gu;Ax=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,o){var l=null;if(o!==void 0&&(l=""+o),i.key!==void 0&&(l=""+i.key),"key"in i){o={};for(var d in i)d!=="key"&&(o[d]=i[d])}else o=i;return i=o.ref,{$$typeof:t,type:r,key:l,ref:i!==void 0?i:null,props:o}}return gu.Fragment=e,gu.jsx=n,gu.jsxs=n,gu}var jx;function G5(){return jx||(jx=1,Eg.exports=H5()),Eg.exports}var u=G5(),Cg={exports:{}},tt={};var Rx;function Q5(){if(Rx)return tt;Rx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),v=Symbol.iterator;function _(B){return B===null||typeof B!="object"?null:(B=v&&B[v]||B["@@iterator"],typeof B=="function"?B:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function C(B,G,te){this.props=B,this.context=G,this.refs=S,this.updater=te||E}C.prototype.isReactComponent={},C.prototype.setState=function(B,G){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,G,"setState")},C.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function T(){}T.prototype=C.prototype;function A(B,G,te){this.props=B,this.context=G,this.refs=S,this.updater=te||E}var L=A.prototype=new T;L.constructor=A,x(L,C.prototype),L.isPureReactComponent=!0;var F=Array.isArray;function H(){}var O={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function N(B,G,te){var ie=te.ref;return{$$typeof:t,type:B,key:G,ref:ie!==void 0?ie:null,props:te}}function U(B,G){return N(B.type,G,B.props)}function $(B){return typeof B=="object"&&B!==null&&B.$$typeof===t}function j(B){var G={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(te){return G[te]})}var M=/\/+/g;function R(B,G){return typeof B=="object"&&B!==null&&B.key!=null?j(""+B.key):G.toString(36)}function K(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(H,H):(B.status="pending",B.then(function(G){B.status==="pending"&&(B.status="fulfilled",B.value=G)},function(G){B.status==="pending"&&(B.status="rejected",B.reason=G)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function W(B,G,te,ie,ae){var fe=typeof B;(fe==="undefined"||fe==="boolean")&&(B=null);var Ee=!1;if(B===null)Ee=!0;else switch(fe){case"bigint":case"string":case"number":Ee=!0;break;case"object":switch(B.$$typeof){case t:case e:Ee=!0;break;case p:return Ee=B._init,W(Ee(B._payload),G,te,ie,ae)}}if(Ee)return ae=ae(B),Ee=ie===""?"."+R(B,0):ie,F(ae)?(te="",Ee!=null&&(te=Ee.replace(M,"$&/")+"/"),W(ae,G,te,"",function(he){return he})):ae!=null&&($(ae)&&(ae=U(ae,te+(ae.key==null||B&&B.key===ae.key?"":(""+ae.key).replace(M,"$&/")+"/")+Ee)),G.push(ae)),1;Ee=0;var me=ie===""?".":ie+":";if(F(B))for(var Ce=0;Ce<B.length;Ce++)ie=B[Ce],fe=me+R(ie,Ce),Ee+=W(ie,G,te,fe,ae);else if(Ce=_(B),typeof Ce=="function")for(B=Ce.call(B),Ce=0;!(ie=B.next()).done;)ie=ie.value,fe=me+R(ie,Ce++),Ee+=W(ie,G,te,fe,ae);else if(fe==="object"){if(typeof B.then=="function")return W(K(B),G,te,ie,ae);throw G=String(B),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return Ee}function q(B,G,te){if(B==null)return B;var ie=[],ae=0;return W(B,ie,"","",function(fe){return G.call(te,fe,ae++)}),ie}function Z(B){if(B._status===-1){var G=B._result;G=G(),G.then(function(te){(B._status===0||B._status===-1)&&(B._status=1,B._result=te)},function(te){(B._status===0||B._status===-1)&&(B._status=2,B._result=te)}),B._status===-1&&(B._status=0,B._result=G)}if(B._status===1)return B._result.default;throw B._result}var X=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)},ne={map:q,forEach:function(B,G,te){q(B,function(){G.apply(this,arguments)},te)},count:function(B){var G=0;return q(B,function(){G++}),G},toArray:function(B){return q(B,function(G){return G})||[]},only:function(B){if(!$(B))throw Error("React.Children.only expected to receive a single React element child.");return B}};return tt.Activity=g,tt.Children=ne,tt.Component=C,tt.Fragment=n,tt.Profiler=i,tt.PureComponent=A,tt.StrictMode=r,tt.Suspense=h,tt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,tt.__COMPILER_RUNTIME={__proto__:null,c:function(B){return O.H.useMemoCache(B)}},tt.cache=function(B){return function(){return B.apply(null,arguments)}},tt.cacheSignal=function(){return null},tt.cloneElement=function(B,G,te){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var ie=x({},B.props),ae=B.key;if(G!=null)for(fe in G.key!==void 0&&(ae=""+G.key),G)!I.call(G,fe)||fe==="key"||fe==="__self"||fe==="__source"||fe==="ref"&&G.ref===void 0||(ie[fe]=G[fe]);var fe=arguments.length-2;if(fe===1)ie.children=te;else if(1<fe){for(var Ee=Array(fe),me=0;me<fe;me++)Ee[me]=arguments[me+2];ie.children=Ee}return N(B.type,ae,ie)},tt.createContext=function(B){return B={$$typeof:l,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:o,_context:B},B},tt.createElement=function(B,G,te){var ie,ae={},fe=null;if(G!=null)for(ie in G.key!==void 0&&(fe=""+G.key),G)I.call(G,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(ae[ie]=G[ie]);var Ee=arguments.length-2;if(Ee===1)ae.children=te;else if(1<Ee){for(var me=Array(Ee),Ce=0;Ce<Ee;Ce++)me[Ce]=arguments[Ce+2];ae.children=me}if(B&&B.defaultProps)for(ie in Ee=B.defaultProps,Ee)ae[ie]===void 0&&(ae[ie]=Ee[ie]);return N(B,fe,ae)},tt.createRef=function(){return{current:null}},tt.forwardRef=function(B){return{$$typeof:d,render:B}},tt.isValidElement=$,tt.lazy=function(B){return{$$typeof:p,_payload:{_status:-1,_result:B},_init:Z}},tt.memo=function(B,G){return{$$typeof:m,type:B,compare:G===void 0?null:G}},tt.startTransition=function(B){var G=O.T,te={};O.T=te;try{var ie=B(),ae=O.S;ae!==null&&ae(te,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(H,X)}catch(fe){X(fe)}finally{G!==null&&te.types!==null&&(G.types=te.types),O.T=G}},tt.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},tt.use=function(B){return O.H.use(B)},tt.useActionState=function(B,G,te){return O.H.useActionState(B,G,te)},tt.useCallback=function(B,G){return O.H.useCallback(B,G)},tt.useContext=function(B){return O.H.useContext(B)},tt.useDebugValue=function(){},tt.useDeferredValue=function(B,G){return O.H.useDeferredValue(B,G)},tt.useEffect=function(B,G){return O.H.useEffect(B,G)},tt.useEffectEvent=function(B){return O.H.useEffectEvent(B)},tt.useId=function(){return O.H.useId()},tt.useImperativeHandle=function(B,G,te){return O.H.useImperativeHandle(B,G,te)},tt.useInsertionEffect=function(B,G){return O.H.useInsertionEffect(B,G)},tt.useLayoutEffect=function(B,G){return O.H.useLayoutEffect(B,G)},tt.useMemo=function(B,G){return O.H.useMemo(B,G)},tt.useOptimistic=function(B,G){return O.H.useOptimistic(B,G)},tt.useReducer=function(B,G,te){return O.H.useReducer(B,G,te)},tt.useRef=function(B){return O.H.useRef(B)},tt.useState=function(B){return O.H.useState(B)},tt.useSyncExternalStore=function(B,G,te){return O.H.useSyncExternalStore(B,G,te)},tt.useTransition=function(){return O.H.useTransition()},tt.version="19.2.3",tt}var Dx;function zy(){return Dx||(Dx=1,Cg.exports=Q5()),Cg.exports}var k=zy(),Tg={exports:{}},yu={},Ag={exports:{}},jg={};var Ix;function W5(){return Ix||(Ix=1,(function(t){function e(W,q){var Z=W.length;W.push(q);e:for(;0<Z;){var X=Z-1>>>1,ne=W[X];if(0<i(ne,q))W[X]=q,W[Z]=ne,Z=X;else break e}}function n(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var q=W[0],Z=W.pop();if(Z!==q){W[0]=Z;e:for(var X=0,ne=W.length,B=ne>>>1;X<B;){var G=2*(X+1)-1,te=W[G],ie=G+1,ae=W[ie];if(0>i(te,Z))ie<ne&&0>i(ae,te)?(W[X]=ae,W[ie]=Z,X=ie):(W[X]=te,W[G]=Z,X=G);else if(ie<ne&&0>i(ae,Z))W[X]=ae,W[ie]=Z,X=ie;else break e}}return q}function i(W,q){var Z=W.sortIndex-q.sortIndex;return Z!==0?Z:W.id-q.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,d=l.now();t.unstable_now=function(){return l.now()-d}}var h=[],m=[],p=1,g=null,v=3,_=!1,E=!1,x=!1,S=!1,C=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function L(W){for(var q=n(m);q!==null;){if(q.callback===null)r(m);else if(q.startTime<=W)r(m),q.sortIndex=q.expirationTime,e(h,q);else break;q=n(m)}}function F(W){if(x=!1,L(W),!E)if(n(h)!==null)E=!0,H||(H=!0,j());else{var q=n(m);q!==null&&K(F,q.startTime-W)}}var H=!1,O=-1,I=5,N=-1;function U(){return S?!0:!(t.unstable_now()-N<I)}function $(){if(S=!1,H){var W=t.unstable_now();N=W;var q=!0;try{e:{E=!1,x&&(x=!1,T(O),O=-1),_=!0;var Z=v;try{t:{for(L(W),g=n(h);g!==null&&!(g.expirationTime>W&&U());){var X=g.callback;if(typeof X=="function"){g.callback=null,v=g.priorityLevel;var ne=X(g.expirationTime<=W);if(W=t.unstable_now(),typeof ne=="function"){g.callback=ne,L(W),q=!0;break t}g===n(h)&&r(h),L(W)}else r(h);g=n(h)}if(g!==null)q=!0;else{var B=n(m);B!==null&&K(F,B.startTime-W),q=!1}}break e}finally{g=null,v=Z,_=!1}q=void 0}}finally{q?j():H=!1}}}var j;if(typeof A=="function")j=function(){A($)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,R=M.port2;M.port1.onmessage=$,j=function(){R.postMessage(null)}}else j=function(){C($,0)};function K(W,q){O=C(function(){W(t.unstable_now())},q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(W){W.callback=null},t.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<W?Math.floor(1e3/W):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(W){switch(v){case 1:case 2:case 3:var q=3;break;default:q=v}var Z=v;v=q;try{return W()}finally{v=Z}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(W,q){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var Z=v;v=W;try{return q()}finally{v=Z}},t.unstable_scheduleCallback=function(W,q,Z){var X=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?X+Z:X):Z=X,W){case 1:var ne=-1;break;case 2:ne=250;break;case 5:ne=1073741823;break;case 4:ne=1e4;break;default:ne=5e3}return ne=Z+ne,W={id:p++,callback:q,priorityLevel:W,startTime:Z,expirationTime:ne,sortIndex:-1},Z>X?(W.sortIndex=Z,e(m,W),n(h)===null&&W===n(m)&&(x?(T(O),O=-1):x=!0,K(F,Z-X))):(W.sortIndex=ne,e(h,W),E||_||(E=!0,H||(H=!0,j()))),W},t.unstable_shouldYield=U,t.unstable_wrapCallback=function(W){var q=v;return function(){var Z=v;v=q;try{return W.apply(this,arguments)}finally{v=Z}}}})(jg)),jg}var kx;function K5(){return kx||(kx=1,Ag.exports=W5()),Ag.exports}var Rg={exports:{}},Wn={};var Ox;function Y5(){if(Ox)return Wn;Ox=1;var t=zy();function e(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)m+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(h,m,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:m,implementation:p}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,m){if(h==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return Wn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Wn.createPortal=function(h,m){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return o(h,m,null,p)},Wn.flushSync=function(h){var m=l.T,p=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=m,r.p=p,r.d.f()}},Wn.preconnect=function(h,m){typeof h=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,r.d.C(h,m))},Wn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Wn.preinit=function(h,m){if(typeof h=="string"&&m&&typeof m.as=="string"){var p=m.as,g=d(p,m.crossOrigin),v=typeof m.integrity=="string"?m.integrity:void 0,_=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;p==="style"?r.d.S(h,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:_}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:v,fetchPriority:_,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},Wn.preinitModule=function(h,m){if(typeof h=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var p=d(m.as,m.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&r.d.M(h)},Wn.preload=function(h,m){if(typeof h=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var p=m.as,g=d(p,m.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},Wn.preloadModule=function(h,m){if(typeof h=="string")if(m){var p=d(m.as,m.crossOrigin);r.d.m(h,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:p,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else r.d.m(h)},Wn.requestFormReset=function(h){r.d.r(h)},Wn.unstable_batchedUpdates=function(h,m){return h(m)},Wn.useFormState=function(h,m,p){return l.H.useFormState(h,m,p)},Wn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Wn.version="19.2.3",Wn}var Mx;function X5(){if(Mx)return Rg.exports;Mx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Rg.exports=Y5(),Rg.exports}var Nx;function Z5(){if(Nx)return yu;Nx=1;var t=K5(),e=zy(),n=X5();function r(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function l(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function d(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function m(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(r(188));return a!==s?null:s}for(var c=s,f=a;;){var b=c.return;if(b===null)break;var w=b.alternate;if(w===null){if(f=b.return,f!==null){c=f;continue}break}if(b.child===w.child){for(w=b.child;w;){if(w===c)return h(b),s;if(w===f)return h(b),a;w=w.sibling}throw Error(r(188))}if(c.return!==f.return)c=b,f=w;else{for(var P=!1,Q=b.child;Q;){if(Q===c){P=!0,c=b,f=w;break}if(Q===f){P=!0,f=b,c=w;break}Q=Q.sibling}if(!P){for(Q=w.child;Q;){if(Q===c){P=!0,c=w,f=b;break}if(Q===f){P=!0,f=w,c=b;break}Q=Q.sibling}if(!P)throw Error(r(189))}}if(c.alternate!==f)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?s:a}function p(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=p(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,v=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),A=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),$=Symbol.iterator;function j(s){return s===null||typeof s!="object"?null:(s=$&&s[$]||s["@@iterator"],typeof s=="function"?s:null)}var M=Symbol.for("react.client.reference");function R(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===M?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case x:return"Fragment";case C:return"Profiler";case S:return"StrictMode";case F:return"Suspense";case H:return"SuspenseList";case N:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case E:return"Portal";case A:return s.displayName||"Context";case T:return(s._context.displayName||"Context")+".Consumer";case L:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case O:return a=s.displayName||null,a!==null?a:R(s.type)||"Memo";case I:a=s._payload,s=s._init;try{return R(s(a))}catch{}}return null}var K=Array.isArray,W=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},X=[],ne=-1;function B(s){return{current:s}}function G(s){0>ne||(s.current=X[ne],X[ne]=null,ne--)}function te(s,a){ne++,X[ne]=s.current,s.current=a}var ie=B(null),ae=B(null),fe=B(null),Ee=B(null);function me(s,a){switch(te(fe,a),te(ae,s),te(ie,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?Yv(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=Yv(a),s=Xv(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}G(ie),te(ie,s)}function Ce(){G(ie),G(ae),G(fe)}function he(s){s.memoizedState!==null&&te(Ee,s);var a=ie.current,c=Xv(a,s.type);a!==c&&(te(ae,s),te(ie,c))}function Me(s){ae.current===s&&(G(ie),G(ae)),Ee.current===s&&(G(Ee),hu._currentValue=Z)}var qe,Oe;function z(s){if(qe===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);qe=a&&a[1]||"",Oe=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+qe+s+Oe}var ce=!1;function pe(s,a){if(!s||ce)return"";ce=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(a){var De=function(){throw Error()};if(Object.defineProperty(De.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(De,[])}catch(we){var be=we}Reflect.construct(s,[],De)}else{try{De.call()}catch(we){be=we}s.call(De.prototype)}}else{try{throw Error()}catch(we){be=we}(De=s())&&typeof De.catch=="function"&&De.catch(function(){})}}catch(we){if(we&&be&&typeof we.stack=="string")return[we.stack,be.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=f.DetermineComponentFrameRoot(),P=w[0],Q=w[1];if(P&&Q){var re=P.split(`
`),_e=Q.split(`
`);for(b=f=0;f<re.length&&!re[f].includes("DetermineComponentFrameRoot");)f++;for(;b<_e.length&&!_e[b].includes("DetermineComponentFrameRoot");)b++;if(f===re.length||b===_e.length)for(f=re.length-1,b=_e.length-1;1<=f&&0<=b&&re[f]!==_e[b];)b--;for(;1<=f&&0<=b;f--,b--)if(re[f]!==_e[b]){if(f!==1||b!==1)do if(f--,b--,0>b||re[f]!==_e[b]){var Te=`
`+re[f].replace(" at new "," at ");return s.displayName&&Te.includes("<anonymous>")&&(Te=Te.replace("<anonymous>",s.displayName)),Te}while(1<=f&&0<=b);break}}}finally{ce=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?z(c):""}function ee(s,a){switch(s.tag){case 26:case 27:case 5:return z(s.type);case 16:return z("Lazy");case 13:return s.child!==a&&a!==null?z("Suspense Fallback"):z("Suspense");case 19:return z("SuspenseList");case 0:case 15:return pe(s.type,!1);case 11:return pe(s.type.render,!1);case 1:return pe(s.type,!0);case 31:return z("Activity");default:return""}}function J(s){try{var a="",c=null;do a+=ee(s,c),c=s,s=s.return;while(s);return a}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var se=Object.prototype.hasOwnProperty,xe=t.unstable_scheduleCallback,Se=t.unstable_cancelCallback,oe=t.unstable_shouldYield,je=t.unstable_requestPaint,ze=t.unstable_now,Ne=t.unstable_getCurrentPriorityLevel,Ge=t.unstable_ImmediatePriority,xt=t.unstable_UserBlockingPriority,st=t.unstable_NormalPriority,Gn=t.unstable_LowPriority,ms=t.unstable_IdlePriority,Jn=t.log,ps=t.unstable_setDisableYieldValue,bt=null,Zt=null;function Qn(s){if(typeof Jn=="function"&&ps(s),Zt&&typeof Zt.setStrictMode=="function")try{Zt.setStrictMode(bt,s)}catch{}}var Et=Math.clz32?Math.clz32:zo,za=Math.log,Ti=Math.LN2;function zo(s){return s>>>=0,s===0?32:31-(za(s)/Ti|0)|0}var jr=256,gs=262144,Lt=4194304;function er(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function ys(s,a,c){var f=s.pendingLanes;if(f===0)return 0;var b=0,w=s.suspendedLanes,P=s.pingedLanes;s=s.warmLanes;var Q=f&134217727;return Q!==0?(f=Q&~w,f!==0?b=er(f):(P&=Q,P!==0?b=er(P):c||(c=Q&~s,c!==0&&(b=er(c))))):(Q=f&~w,Q!==0?b=er(Q):P!==0?b=er(P):c||(c=f&~s,c!==0&&(b=er(c)))),b===0?0:a!==0&&a!==b&&(a&w)===0&&(w=b&-b,c=a&-a,w>=c||w===32&&(c&4194048)!==0)?a:b}function Qr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function jm(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function md(){var s=Lt;return Lt<<=1,(Lt&62914560)===0&&(Lt=4194304),s}function _s(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function Ba(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Rm(s,a,c,f,b,w){var P=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var Q=s.entanglements,re=s.expirationTimes,_e=s.hiddenUpdates;for(c=P&~c;0<c;){var Te=31-Et(c),De=1<<Te;Q[Te]=0,re[Te]=-1;var be=_e[Te];if(be!==null)for(_e[Te]=null,Te=0;Te<be.length;Te++){var we=be[Te];we!==null&&(we.lane&=-536870913)}c&=~De}f!==0&&La(s,f,0),w!==0&&b===0&&s.tag!==0&&(s.suspendedLanes|=w&~(P&~a))}function La(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var f=31-Et(a);s.entangledLanes|=a,s.entanglements[f]=s.entanglements[f]|1073741824|c&261930}function yc(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var f=31-Et(c),b=1<<f;b&a|s[f]&a&&(s[f]|=a),c&=~b}}function _c(s,a){var c=a&-a;return c=(c&42)!==0?1:Ua(c),(c&(s.suspendedLanes|a))!==0?0:c}function Ua(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Gs(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function pd(){var s=q.p;return s!==0?s:(s=window.event,s===void 0?32:vx(s.type))}function Wr(s,a){var c=q.p;try{return q.p=s,a()}finally{q.p=c}}var Kr=Math.random().toString(36).slice(2),on="__reactFiber$"+Kr,jn="__reactProps$"+Kr,bs="__reactContainer$"+Kr,Bo="__reactEvents$"+Kr,Dm="__reactListeners$"+Kr,gd="__reactHandles$"+Kr,yd="__reactResources$"+Kr,vs="__reactMarker$"+Kr;function Lo(s){delete s[on],delete s[jn],delete s[Bo],delete s[Dm],delete s[gd]}function xs(s){var a=s[on];if(a)return a;for(var c=s.parentNode;c;){if(a=c[bs]||c[on]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=sx(s);s!==null;){if(c=s[on])return c;s=sx(s)}return a}s=c,c=s.parentNode}return null}function Rr(s){if(s=s[on]||s[bs]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function gr(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(r(33))}function ws(s){var a=s[yd];return a||(a=s[yd]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function ln(s){s[vs]=!0}var bc=new Set,vc={};function Ss(s,a){Es(s,a),Es(s+"Capture",a)}function Es(s,a){for(vc[s]=a,s=0;s<a.length;s++)bc.add(a[s])}var xc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),wc={},Sc={};function _d(s){return se.call(Sc,s)?!0:se.call(wc,s)?!1:xc.test(s)?Sc[s]=!0:(wc[s]=!0,!1)}function Uo(s,a,c){if(_d(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var f=a.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function yr(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function cn(s,a,c,f){if(f===null)s.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+f)}}function Rn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Ai(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ec(s,a,c){var f=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var b=f.get,w=f.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return b.call(this)},set:function(P){c=""+P,w.call(this,P)}}),Object.defineProperty(s,a,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(P){c=""+P},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function Rt(s){if(!s._valueTracker){var a=Ai(s)?"checked":"value";s._valueTracker=Ec(s,a,""+s[a])}}function Fa(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),f="";return s&&(f=Ai(s)?s.checked?"true":"false":s.value),s=f,s!==c?(a.setValue(s),!0):!1}function Cs(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Va=/[\n"\\]/g;function ir(s){return s.replace(Va,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Fo(s,a,c,f,b,w,P,Q){s.name="",P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?s.type=P:s.removeAttribute("type"),a!=null?P==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+Rn(a)):s.value!==""+Rn(a)&&(s.value=""+Rn(a)):P!=="submit"&&P!=="reset"||s.removeAttribute("value"),a!=null?Cc(s,P,Rn(a)):c!=null?Cc(s,P,Rn(c)):f!=null&&s.removeAttribute("value"),b==null&&w!=null&&(s.defaultChecked=!!w),b!=null&&(s.checked=b&&typeof b!="function"&&typeof b!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?s.name=""+Rn(Q):s.removeAttribute("name")}function bd(s,a,c,f,b,w,P,Q){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(s.type=w),a!=null||c!=null){if(!(w!=="submit"&&w!=="reset"||a!=null)){Rt(s);return}c=c!=null?""+Rn(c):"",a=a!=null?""+Rn(a):c,Q||a===s.value||(s.value=a),s.defaultValue=a}f=f??b,f=typeof f!="function"&&typeof f!="symbol"&&!!f,s.checked=Q?s.checked:!!f,s.defaultChecked=!!f,P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(s.name=P),Rt(s)}function Cc(s,a,c){a==="number"&&Cs(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function ji(s,a,c,f){if(s=s.options,a){a={};for(var b=0;b<c.length;b++)a["$"+c[b]]=!0;for(c=0;c<s.length;c++)b=a.hasOwnProperty("$"+s[c].value),s[c].selected!==b&&(s[c].selected=b),b&&f&&(s[c].defaultSelected=!0)}else{for(c=""+Rn(c),a=null,b=0;b<s.length;b++){if(s[b].value===c){s[b].selected=!0,f&&(s[b].defaultSelected=!0);return}a!==null||s[b].disabled||(a=s[b])}a!==null&&(a.selected=!0)}}function vd(s,a,c){if(a!=null&&(a=""+Rn(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+Rn(c):""}function Ri(s,a,c,f){if(a==null){if(f!=null){if(c!=null)throw Error(r(92));if(K(f)){if(1<f.length)throw Error(r(93));f=f[0]}c=f}c==null&&(c=""),a=c}c=Rn(a),s.defaultValue=c,f=s.textContent,f===c&&f!==""&&f!==null&&(s.value=f),Rt(s)}function ar(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var xd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tc(s,a,c){var f=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":f?s.setProperty(a,c):typeof c!="number"||c===0||xd.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Ac(s,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(s=s.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||a!=null&&a.hasOwnProperty(f)||(f.indexOf("--")===0?s.setProperty(f,""):f==="float"?s.cssFloat="":s[f]="");for(var b in a)f=a[b],a.hasOwnProperty(b)&&c[b]!==f&&Tc(s,b,f)}else for(var w in a)a.hasOwnProperty(w)&&Tc(s,w,a[w])}function Vo(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Di=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function $o(s){return Di.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Yr(){}var jc=null;function Dr(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Ii=null,Ts=null;function $a(s){var a=Rr(s);if(a&&(s=a.stateNode)){var c=s[jn]||null;e:switch(s=a.stateNode,a.type){case"input":if(Fo(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+ir(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var f=c[a];if(f!==s&&f.form===s.form){var b=f[jn]||null;if(!b)throw Error(r(90));Fo(f,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(a=0;a<c.length;a++)f=c[a],f.form===s.form&&Fa(f)}break e;case"textarea":vd(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&ji(s,!!c.multiple,a,!1)}}}var qo=!1;function ki(s,a,c){if(qo)return s(a,c);qo=!0;try{var f=s(a);return f}finally{if(qo=!1,(Ii!==null||Ts!==null)&&(ph(),Ii&&(a=Ii,s=Ts,Ts=Ii=null,$a(a),s)))for(a=0;a<s.length;a++)$a(s[a])}}function Xr(s,a){var c=s.stateNode;if(c===null)return null;var f=c[jn]||null;if(f===null)return null;c=f[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var Ir=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qa=!1;if(Ir)try{var kt={};Object.defineProperty(kt,"passive",{get:function(){qa=!0}}),window.addEventListener("test",kt,kt),window.removeEventListener("test",kt,kt)}catch{qa=!1}var As=null,Rc=null,Ha=null;function Dc(){if(Ha)return Ha;var s,a=Rc,c=a.length,f,b="value"in As?As.value:As.textContent,w=b.length;for(s=0;s<c&&a[s]===b[s];s++);var P=c-s;for(f=1;f<=P&&a[c-f]===b[w-f];f++);return Ha=b.slice(s,1<f?1-f:void 0)}function Ga(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Qs(){return!0}function Zr(){return!1}function Mn(s){function a(c,f,b,w,P){this._reactName=c,this._targetInst=b,this.type=f,this.nativeEvent=w,this.target=P,this.currentTarget=null;for(var Q in s)s.hasOwnProperty(Q)&&(c=s[Q],this[Q]=c?c(w):w[Q]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Qs:Zr,this.isPropagationStopped=Zr,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Qs)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Qs)},persist:function(){},isPersistent:Qs}),a}var Ws={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},js=Mn(Ws),Oi=g({},Ws,{view:0,detail:0}),Ic=Mn(Oi),Mi,Ho,Rs,Go=g({},Oi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ni,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Rs&&(Rs&&s.type==="mousemove"?(Mi=s.screenX-Rs.screenX,Ho=s.screenY-Rs.screenY):Ho=Mi=0,Rs=s),Mi)},movementY:function(s){return"movementY"in s?s.movementY:Ho}}),kc=Mn(Go),Qa=g({},Go,{dataTransfer:0}),Sd=Mn(Qa),Ed=g({},Oi,{relatedTarget:0}),Wa=Mn(Ed),Oc=g({},Ws,{animationName:0,elapsedTime:0,pseudoElement:0}),Cd=Mn(Oc),Qo=g({},Ws,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Td=Mn(Qo),Ad=g({},Ws,{data:0}),Ds=Mn(Ad),jd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Id(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=Dd[s])?!!a[s]:!1}function Ni(){return Id}var tr=g({},Oi,{key:function(s){if(s.key){var a=jd[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=Ga(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Rd[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ni,charCode:function(s){return s.type==="keypress"?Ga(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Ga(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),kd=Mn(tr),Od=g({},Go,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ks=Mn(Od),y=g({},Oi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ni}),D=Mn(y),V=g({},Ws,{propertyName:0,elapsedTime:0,pseudoElement:0}),Y=Mn(V),ge=g({},Go,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),ve=Mn(ge),Be=g({},Ws,{newState:0,oldState:0}),it=Mn(Be),tn=[9,13,27,32],Ct=Ir&&"CompositionEvent"in window,Qt=null;Ir&&"documentMode"in document&&(Qt=document.documentMode);var kr=Ir&&"TextEvent"in window&&!Qt,Is=Ir&&(!Ct||Qt&&8<Qt&&11>=Qt),Jr=" ",es=!1;function Ka(s,a){switch(s){case"keyup":return tn.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wo(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Ko=!1;function mA(s,a){switch(s){case"compositionend":return Wo(a);case"keypress":return a.which!==32?null:(es=!0,Jr);case"textInput":return s=a.data,s===Jr&&es?null:s;default:return null}}function pA(s,a){if(Ko)return s==="compositionend"||!Ct&&Ka(s,a)?(s=Dc(),Ha=Rc=As=null,Ko=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Is&&a.locale!=="ko"?null:a.data;default:return null}}var gA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function o_(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!gA[s.type]:a==="textarea"}function l_(s,a,c,f){Ii?Ts?Ts.push(f):Ts=[f]:Ii=f,a=wh(a,"onChange"),0<a.length&&(c=new js("onChange","change",null,c,f),s.push({event:c,listeners:a}))}var Mc=null,Nc=null;function yA(s){qv(s,0)}function Md(s){var a=gr(s);if(Fa(a))return s}function c_(s,a){if(s==="change")return a}var u_=!1;if(Ir){var Im;if(Ir){var km="oninput"in document;if(!km){var d_=document.createElement("div");d_.setAttribute("oninput","return;"),km=typeof d_.oninput=="function"}Im=km}else Im=!1;u_=Im&&(!document.documentMode||9<document.documentMode)}function h_(){Mc&&(Mc.detachEvent("onpropertychange",f_),Nc=Mc=null)}function f_(s){if(s.propertyName==="value"&&Md(Nc)){var a=[];l_(a,Nc,s,Dr(s)),ki(yA,a)}}function _A(s,a,c){s==="focusin"?(h_(),Mc=a,Nc=c,Mc.attachEvent("onpropertychange",f_)):s==="focusout"&&h_()}function bA(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Md(Nc)}function vA(s,a){if(s==="click")return Md(a)}function xA(s,a){if(s==="input"||s==="change")return Md(a)}function wA(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var _r=typeof Object.is=="function"?Object.is:wA;function Pc(s,a){if(_r(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),f=Object.keys(a);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var b=c[f];if(!se.call(a,b)||!_r(s[b],a[b]))return!1}return!0}function m_(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function p_(s,a){var c=m_(s);s=0;for(var f;c;){if(c.nodeType===3){if(f=s+c.textContent.length,s<=a&&f>=a)return{node:c,offset:a-s};s=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=m_(c)}}function g_(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?g_(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function y_(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=Cs(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=Cs(s.document)}return a}function Om(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var SA=Ir&&"documentMode"in document&&11>=document.documentMode,Yo=null,Mm=null,zc=null,Nm=!1;function __(s,a,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Nm||Yo==null||Yo!==Cs(f)||(f=Yo,"selectionStart"in f&&Om(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),zc&&Pc(zc,f)||(zc=f,f=wh(Mm,"onSelect"),0<f.length&&(a=new js("onSelect","select",null,a,c),s.push({event:a,listeners:f}),a.target=Yo)))}function Ya(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var Xo={animationend:Ya("Animation","AnimationEnd"),animationiteration:Ya("Animation","AnimationIteration"),animationstart:Ya("Animation","AnimationStart"),transitionrun:Ya("Transition","TransitionRun"),transitionstart:Ya("Transition","TransitionStart"),transitioncancel:Ya("Transition","TransitionCancel"),transitionend:Ya("Transition","TransitionEnd")},Pm={},b_={};Ir&&(b_=document.createElement("div").style,"AnimationEvent"in window||(delete Xo.animationend.animation,delete Xo.animationiteration.animation,delete Xo.animationstart.animation),"TransitionEvent"in window||delete Xo.transitionend.transition);function Xa(s){if(Pm[s])return Pm[s];if(!Xo[s])return s;var a=Xo[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in b_)return Pm[s]=a[c];return s}var v_=Xa("animationend"),x_=Xa("animationiteration"),w_=Xa("animationstart"),EA=Xa("transitionrun"),CA=Xa("transitionstart"),TA=Xa("transitioncancel"),S_=Xa("transitionend"),E_=new Map,zm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");zm.push("scrollEnd");function ts(s,a){E_.set(s,a),Ss(a,[s])}var Nd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Or=[],Zo=0,Bm=0;function Pd(){for(var s=Zo,a=Bm=Zo=0;a<s;){var c=Or[a];Or[a++]=null;var f=Or[a];Or[a++]=null;var b=Or[a];Or[a++]=null;var w=Or[a];if(Or[a++]=null,f!==null&&b!==null){var P=f.pending;P===null?b.next=b:(b.next=P.next,P.next=b),f.pending=b}w!==0&&C_(c,b,w)}}function zd(s,a,c,f){Or[Zo++]=s,Or[Zo++]=a,Or[Zo++]=c,Or[Zo++]=f,Bm|=f,s.lanes|=f,s=s.alternate,s!==null&&(s.lanes|=f)}function Lm(s,a,c,f){return zd(s,a,c,f),Bd(s)}function Za(s,a){return zd(s,null,null,a),Bd(s)}function C_(s,a,c){s.lanes|=c;var f=s.alternate;f!==null&&(f.lanes|=c);for(var b=!1,w=s.return;w!==null;)w.childLanes|=c,f=w.alternate,f!==null&&(f.childLanes|=c),w.tag===22&&(s=w.stateNode,s===null||s._visibility&1||(b=!0)),s=w,w=w.return;return s.tag===3?(w=s.stateNode,b&&a!==null&&(b=31-Et(c),s=w.hiddenUpdates,f=s[b],f===null?s[b]=[a]:f.push(a),a.lane=c|536870912),w):null}function Bd(s){if(50<iu)throw iu=0,Wp=null,Error(r(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var Jo={};function AA(s,a,c,f){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function br(s,a,c,f){return new AA(s,a,c,f)}function Um(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Ys(s,a){var c=s.alternate;return c===null?(c=br(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function T_(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Ld(s,a,c,f,b,w){var P=0;if(f=s,typeof s=="function")Um(s)&&(P=1);else if(typeof s=="string")P=k5(s,c,ie.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case N:return s=br(31,c,a,b),s.elementType=N,s.lanes=w,s;case x:return Ja(c.children,b,w,a);case S:P=8,b|=24;break;case C:return s=br(12,c,a,b|2),s.elementType=C,s.lanes=w,s;case F:return s=br(13,c,a,b),s.elementType=F,s.lanes=w,s;case H:return s=br(19,c,a,b),s.elementType=H,s.lanes=w,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case A:P=10;break e;case T:P=9;break e;case L:P=11;break e;case O:P=14;break e;case I:P=16,f=null;break e}P=29,c=Error(r(130,s===null?"null":typeof s,"")),f=null}return a=br(P,c,a,b),a.elementType=s,a.type=f,a.lanes=w,a}function Ja(s,a,c,f){return s=br(7,s,f,a),s.lanes=c,s}function Fm(s,a,c){return s=br(6,s,null,a),s.lanes=c,s}function A_(s){var a=br(18,null,null,0);return a.stateNode=s,a}function Vm(s,a,c){return a=br(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var j_=new WeakMap;function Mr(s,a){if(typeof s=="object"&&s!==null){var c=j_.get(s);return c!==void 0?c:(a={value:s,source:a,stack:J(a)},j_.set(s,a),a)}return{value:s,source:a,stack:J(a)}}var el=[],tl=0,Ud=null,Bc=0,Nr=[],Pr=0,Pi=null,ks=1,Os="";function Xs(s,a){el[tl++]=Bc,el[tl++]=Ud,Ud=s,Bc=a}function R_(s,a,c){Nr[Pr++]=ks,Nr[Pr++]=Os,Nr[Pr++]=Pi,Pi=s;var f=ks;s=Os;var b=32-Et(f)-1;f&=~(1<<b),c+=1;var w=32-Et(a)+b;if(30<w){var P=b-b%5;w=(f&(1<<P)-1).toString(32),f>>=P,b-=P,ks=1<<32-Et(a)+b|c<<b|f,Os=w+s}else ks=1<<w|c<<b|f,Os=s}function $m(s){s.return!==null&&(Xs(s,1),R_(s,1,0))}function qm(s){for(;s===Ud;)Ud=el[--tl],el[tl]=null,Bc=el[--tl],el[tl]=null;for(;s===Pi;)Pi=Nr[--Pr],Nr[Pr]=null,Os=Nr[--Pr],Nr[Pr]=null,ks=Nr[--Pr],Nr[Pr]=null}function D_(s,a){Nr[Pr++]=ks,Nr[Pr++]=Os,Nr[Pr++]=Pi,ks=a.id,Os=a.overflow,Pi=s}var Nn=null,Vt=null,yt=!1,zi=null,zr=!1,Hm=Error(r(519));function Bi(s){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Lc(Mr(a,s)),Hm}function I_(s){var a=s.stateNode,c=s.type,f=s.memoizedProps;switch(a[on]=s,a[jn]=f,c){case"dialog":ut("cancel",a),ut("close",a);break;case"iframe":case"object":case"embed":ut("load",a);break;case"video":case"audio":for(c=0;c<ou.length;c++)ut(ou[c],a);break;case"source":ut("error",a);break;case"img":case"image":case"link":ut("error",a),ut("load",a);break;case"details":ut("toggle",a);break;case"input":ut("invalid",a),bd(a,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":ut("invalid",a);break;case"textarea":ut("invalid",a),Ri(a,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||f.suppressHydrationWarning===!0||Wv(a.textContent,c)?(f.popover!=null&&(ut("beforetoggle",a),ut("toggle",a)),f.onScroll!=null&&ut("scroll",a),f.onScrollEnd!=null&&ut("scrollend",a),f.onClick!=null&&(a.onclick=Yr),a=!0):a=!1,a||Bi(s,!0)}function k_(s){for(Nn=s.return;Nn;)switch(Nn.tag){case 5:case 31:case 13:zr=!1;return;case 27:case 3:zr=!0;return;default:Nn=Nn.return}}function nl(s){if(s!==Nn)return!1;if(!yt)return k_(s),yt=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||cg(s.type,s.memoizedProps)),c=!c),c&&Vt&&Bi(s),k_(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));Vt=rx(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));Vt=rx(s)}else a===27?(a=Vt,Zi(s.type)?(s=mg,mg=null,Vt=s):Vt=a):Vt=Nn?Lr(s.stateNode.nextSibling):null;return!0}function eo(){Vt=Nn=null,yt=!1}function Gm(){var s=zi;return s!==null&&(ur===null?ur=s:ur.push.apply(ur,s),zi=null),s}function Lc(s){zi===null?zi=[s]:zi.push(s)}var Qm=B(null),to=null,Zs=null;function Li(s,a,c){te(Qm,a._currentValue),a._currentValue=c}function Js(s){s._currentValue=Qm.current,G(Qm)}function Wm(s,a,c){for(;s!==null;){var f=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,f!==null&&(f.childLanes|=a)):f!==null&&(f.childLanes&a)!==a&&(f.childLanes|=a),s===c)break;s=s.return}}function Km(s,a,c,f){var b=s.child;for(b!==null&&(b.return=s);b!==null;){var w=b.dependencies;if(w!==null){var P=b.child;w=w.firstContext;e:for(;w!==null;){var Q=w;w=b;for(var re=0;re<a.length;re++)if(Q.context===a[re]){w.lanes|=c,Q=w.alternate,Q!==null&&(Q.lanes|=c),Wm(w.return,c,s),f||(P=null);break e}w=Q.next}}else if(b.tag===18){if(P=b.return,P===null)throw Error(r(341));P.lanes|=c,w=P.alternate,w!==null&&(w.lanes|=c),Wm(P,c,s),P=null}else P=b.child;if(P!==null)P.return=b;else for(P=b;P!==null;){if(P===s){P=null;break}if(b=P.sibling,b!==null){b.return=P.return,P=b;break}P=P.return}b=P}}function rl(s,a,c,f){s=null;for(var b=a,w=!1;b!==null;){if(!w){if((b.flags&524288)!==0)w=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var P=b.alternate;if(P===null)throw Error(r(387));if(P=P.memoizedProps,P!==null){var Q=b.type;_r(b.pendingProps.value,P.value)||(s!==null?s.push(Q):s=[Q])}}else if(b===Ee.current){if(P=b.alternate,P===null)throw Error(r(387));P.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(s!==null?s.push(hu):s=[hu])}b=b.return}s!==null&&Km(a,s,c,f),a.flags|=262144}function Fd(s){for(s=s.firstContext;s!==null;){if(!_r(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function no(s){to=s,Zs=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Pn(s){return O_(to,s)}function Vd(s,a){return to===null&&no(s),O_(s,a)}function O_(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},Zs===null){if(s===null)throw Error(r(308));Zs=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else Zs=Zs.next=a;return c}var jA=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,f){s.push(f)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},RA=t.unstable_scheduleCallback,DA=t.unstable_NormalPriority,un={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ym(){return{controller:new jA,data:new Map,refCount:0}}function Uc(s){s.refCount--,s.refCount===0&&RA(DA,function(){s.controller.abort()})}var Fc=null,Xm=0,sl=0,il=null;function IA(s,a){if(Fc===null){var c=Fc=[];Xm=0,sl=eg(),il={status:"pending",value:void 0,then:function(f){c.push(f)}}}return Xm++,a.then(M_,M_),a}function M_(){if(--Xm===0&&Fc!==null){il!==null&&(il.status="fulfilled");var s=Fc;Fc=null,sl=0,il=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function kA(s,a){var c=[],f={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return s.then(function(){f.status="fulfilled",f.value=a;for(var b=0;b<c.length;b++)(0,c[b])(a)},function(b){for(f.status="rejected",f.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),f}var N_=W.S;W.S=function(s,a){_v=ze(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&IA(s,a),N_!==null&&N_(s,a)};var ro=B(null);function Zm(){var s=ro.current;return s!==null?s:zt.pooledCache}function $d(s,a){a===null?te(ro,ro.current):te(ro,a.pool)}function P_(){var s=Zm();return s===null?null:{parent:un._currentValue,pool:s}}var al=Error(r(460)),Jm=Error(r(474)),qd=Error(r(542)),Hd={then:function(){}};function z_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function B_(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(Yr,Yr),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,U_(s),s;default:if(typeof a.status=="string")a.then(Yr,Yr);else{if(s=zt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=a,s.status="pending",s.then(function(f){if(a.status==="pending"){var b=a;b.status="fulfilled",b.value=f}},function(f){if(a.status==="pending"){var b=a;b.status="rejected",b.reason=f}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,U_(s),s}throw io=a,al}}function so(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(io=c,al):c}}var io=null;function L_(){if(io===null)throw Error(r(459));var s=io;return io=null,s}function U_(s){if(s===al||s===qd)throw Error(r(483))}var ol=null,Vc=0;function Gd(s){var a=Vc;return Vc+=1,ol===null&&(ol=[]),B_(ol,s,a)}function $c(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function Qd(s,a){throw a.$$typeof===v?Error(r(525)):(s=Object.prototype.toString.call(a),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function F_(s){function a(de,le){if(s){var ye=de.deletions;ye===null?(de.deletions=[le],de.flags|=16):ye.push(le)}}function c(de,le){if(!s)return null;for(;le!==null;)a(de,le),le=le.sibling;return null}function f(de){for(var le=new Map;de!==null;)de.key!==null?le.set(de.key,de):le.set(de.index,de),de=de.sibling;return le}function b(de,le){return de=Ys(de,le),de.index=0,de.sibling=null,de}function w(de,le,ye){return de.index=ye,s?(ye=de.alternate,ye!==null?(ye=ye.index,ye<le?(de.flags|=67108866,le):ye):(de.flags|=67108866,le)):(de.flags|=1048576,le)}function P(de){return s&&de.alternate===null&&(de.flags|=67108866),de}function Q(de,le,ye,Ae){return le===null||le.tag!==6?(le=Fm(ye,de.mode,Ae),le.return=de,le):(le=b(le,ye),le.return=de,le)}function re(de,le,ye,Ae){var Qe=ye.type;return Qe===x?Te(de,le,ye.props.children,Ae,ye.key):le!==null&&(le.elementType===Qe||typeof Qe=="object"&&Qe!==null&&Qe.$$typeof===I&&so(Qe)===le.type)?(le=b(le,ye.props),$c(le,ye),le.return=de,le):(le=Ld(ye.type,ye.key,ye.props,null,de.mode,Ae),$c(le,ye),le.return=de,le)}function _e(de,le,ye,Ae){return le===null||le.tag!==4||le.stateNode.containerInfo!==ye.containerInfo||le.stateNode.implementation!==ye.implementation?(le=Vm(ye,de.mode,Ae),le.return=de,le):(le=b(le,ye.children||[]),le.return=de,le)}function Te(de,le,ye,Ae,Qe){return le===null||le.tag!==7?(le=Ja(ye,de.mode,Ae,Qe),le.return=de,le):(le=b(le,ye),le.return=de,le)}function De(de,le,ye){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=Fm(""+le,de.mode,ye),le.return=de,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case _:return ye=Ld(le.type,le.key,le.props,null,de.mode,ye),$c(ye,le),ye.return=de,ye;case E:return le=Vm(le,de.mode,ye),le.return=de,le;case I:return le=so(le),De(de,le,ye)}if(K(le)||j(le))return le=Ja(le,de.mode,ye,null),le.return=de,le;if(typeof le.then=="function")return De(de,Gd(le),ye);if(le.$$typeof===A)return De(de,Vd(de,le),ye);Qd(de,le)}return null}function be(de,le,ye,Ae){var Qe=le!==null?le.key:null;if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return Qe!==null?null:Q(de,le,""+ye,Ae);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case _:return ye.key===Qe?re(de,le,ye,Ae):null;case E:return ye.key===Qe?_e(de,le,ye,Ae):null;case I:return ye=so(ye),be(de,le,ye,Ae)}if(K(ye)||j(ye))return Qe!==null?null:Te(de,le,ye,Ae,null);if(typeof ye.then=="function")return be(de,le,Gd(ye),Ae);if(ye.$$typeof===A)return be(de,le,Vd(de,ye),Ae);Qd(de,ye)}return null}function we(de,le,ye,Ae,Qe){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return de=de.get(ye)||null,Q(le,de,""+Ae,Qe);if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case _:return de=de.get(Ae.key===null?ye:Ae.key)||null,re(le,de,Ae,Qe);case E:return de=de.get(Ae.key===null?ye:Ae.key)||null,_e(le,de,Ae,Qe);case I:return Ae=so(Ae),we(de,le,ye,Ae,Qe)}if(K(Ae)||j(Ae))return de=de.get(ye)||null,Te(le,de,Ae,Qe,null);if(typeof Ae.then=="function")return we(de,le,ye,Gd(Ae),Qe);if(Ae.$$typeof===A)return we(de,le,ye,Vd(le,Ae),Qe);Qd(le,Ae)}return null}function $e(de,le,ye,Ae){for(var Qe=null,wt=null,He=le,ot=le=0,ft=null;He!==null&&ot<ye.length;ot++){He.index>ot?(ft=He,He=null):ft=He.sibling;var St=be(de,He,ye[ot],Ae);if(St===null){He===null&&(He=ft);break}s&&He&&St.alternate===null&&a(de,He),le=w(St,le,ot),wt===null?Qe=St:wt.sibling=St,wt=St,He=ft}if(ot===ye.length)return c(de,He),yt&&Xs(de,ot),Qe;if(He===null){for(;ot<ye.length;ot++)He=De(de,ye[ot],Ae),He!==null&&(le=w(He,le,ot),wt===null?Qe=He:wt.sibling=He,wt=He);return yt&&Xs(de,ot),Qe}for(He=f(He);ot<ye.length;ot++)ft=we(He,de,ot,ye[ot],Ae),ft!==null&&(s&&ft.alternate!==null&&He.delete(ft.key===null?ot:ft.key),le=w(ft,le,ot),wt===null?Qe=ft:wt.sibling=ft,wt=ft);return s&&He.forEach(function(ra){return a(de,ra)}),yt&&Xs(de,ot),Qe}function Ke(de,le,ye,Ae){if(ye==null)throw Error(r(151));for(var Qe=null,wt=null,He=le,ot=le=0,ft=null,St=ye.next();He!==null&&!St.done;ot++,St=ye.next()){He.index>ot?(ft=He,He=null):ft=He.sibling;var ra=be(de,He,St.value,Ae);if(ra===null){He===null&&(He=ft);break}s&&He&&ra.alternate===null&&a(de,He),le=w(ra,le,ot),wt===null?Qe=ra:wt.sibling=ra,wt=ra,He=ft}if(St.done)return c(de,He),yt&&Xs(de,ot),Qe;if(He===null){for(;!St.done;ot++,St=ye.next())St=De(de,St.value,Ae),St!==null&&(le=w(St,le,ot),wt===null?Qe=St:wt.sibling=St,wt=St);return yt&&Xs(de,ot),Qe}for(He=f(He);!St.done;ot++,St=ye.next())St=we(He,de,ot,St.value,Ae),St!==null&&(s&&St.alternate!==null&&He.delete(St.key===null?ot:St.key),le=w(St,le,ot),wt===null?Qe=St:wt.sibling=St,wt=St);return s&&He.forEach(function($5){return a(de,$5)}),yt&&Xs(de,ot),Qe}function Nt(de,le,ye,Ae){if(typeof ye=="object"&&ye!==null&&ye.type===x&&ye.key===null&&(ye=ye.props.children),typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case _:e:{for(var Qe=ye.key;le!==null;){if(le.key===Qe){if(Qe=ye.type,Qe===x){if(le.tag===7){c(de,le.sibling),Ae=b(le,ye.props.children),Ae.return=de,de=Ae;break e}}else if(le.elementType===Qe||typeof Qe=="object"&&Qe!==null&&Qe.$$typeof===I&&so(Qe)===le.type){c(de,le.sibling),Ae=b(le,ye.props),$c(Ae,ye),Ae.return=de,de=Ae;break e}c(de,le);break}else a(de,le);le=le.sibling}ye.type===x?(Ae=Ja(ye.props.children,de.mode,Ae,ye.key),Ae.return=de,de=Ae):(Ae=Ld(ye.type,ye.key,ye.props,null,de.mode,Ae),$c(Ae,ye),Ae.return=de,de=Ae)}return P(de);case E:e:{for(Qe=ye.key;le!==null;){if(le.key===Qe)if(le.tag===4&&le.stateNode.containerInfo===ye.containerInfo&&le.stateNode.implementation===ye.implementation){c(de,le.sibling),Ae=b(le,ye.children||[]),Ae.return=de,de=Ae;break e}else{c(de,le);break}else a(de,le);le=le.sibling}Ae=Vm(ye,de.mode,Ae),Ae.return=de,de=Ae}return P(de);case I:return ye=so(ye),Nt(de,le,ye,Ae)}if(K(ye))return $e(de,le,ye,Ae);if(j(ye)){if(Qe=j(ye),typeof Qe!="function")throw Error(r(150));return ye=Qe.call(ye),Ke(de,le,ye,Ae)}if(typeof ye.then=="function")return Nt(de,le,Gd(ye),Ae);if(ye.$$typeof===A)return Nt(de,le,Vd(de,ye),Ae);Qd(de,ye)}return typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint"?(ye=""+ye,le!==null&&le.tag===6?(c(de,le.sibling),Ae=b(le,ye),Ae.return=de,de=Ae):(c(de,le),Ae=Fm(ye,de.mode,Ae),Ae.return=de,de=Ae),P(de)):c(de,le)}return function(de,le,ye,Ae){try{Vc=0;var Qe=Nt(de,le,ye,Ae);return ol=null,Qe}catch(He){if(He===al||He===qd)throw He;var wt=br(29,He,null,de.mode);return wt.lanes=Ae,wt.return=de,wt}}}var ao=F_(!0),V_=F_(!1),Ui=!1;function ep(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function tp(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Fi(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Vi(s,a,c){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(Tt&2)!==0){var b=f.pending;return b===null?a.next=a:(a.next=b.next,b.next=a),f.pending=a,a=Bd(s),C_(s,null,c),a}return zd(s,f,a,c),Bd(s)}function qc(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var f=a.lanes;f&=s.pendingLanes,c|=f,a.lanes=c,yc(s,c)}}function np(s,a){var c=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var b=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var P={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};w===null?b=w=P:w=w.next=P,c=c.next}while(c!==null);w===null?b=w=a:w=w.next=a}else b=w=a;c={baseState:f.baseState,firstBaseUpdate:b,lastBaseUpdate:w,shared:f.shared,callbacks:f.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var rp=!1;function Hc(){if(rp){var s=il;if(s!==null)throw s}}function Gc(s,a,c,f){rp=!1;var b=s.updateQueue;Ui=!1;var w=b.firstBaseUpdate,P=b.lastBaseUpdate,Q=b.shared.pending;if(Q!==null){b.shared.pending=null;var re=Q,_e=re.next;re.next=null,P===null?w=_e:P.next=_e,P=re;var Te=s.alternate;Te!==null&&(Te=Te.updateQueue,Q=Te.lastBaseUpdate,Q!==P&&(Q===null?Te.firstBaseUpdate=_e:Q.next=_e,Te.lastBaseUpdate=re))}if(w!==null){var De=b.baseState;P=0,Te=_e=re=null,Q=w;do{var be=Q.lane&-536870913,we=be!==Q.lane;if(we?(ht&be)===be:(f&be)===be){be!==0&&be===sl&&(rp=!0),Te!==null&&(Te=Te.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var $e=s,Ke=Q;be=a;var Nt=c;switch(Ke.tag){case 1:if($e=Ke.payload,typeof $e=="function"){De=$e.call(Nt,De,be);break e}De=$e;break e;case 3:$e.flags=$e.flags&-65537|128;case 0:if($e=Ke.payload,be=typeof $e=="function"?$e.call(Nt,De,be):$e,be==null)break e;De=g({},De,be);break e;case 2:Ui=!0}}be=Q.callback,be!==null&&(s.flags|=64,we&&(s.flags|=8192),we=b.callbacks,we===null?b.callbacks=[be]:we.push(be))}else we={lane:be,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Te===null?(_e=Te=we,re=De):Te=Te.next=we,P|=be;if(Q=Q.next,Q===null){if(Q=b.shared.pending,Q===null)break;we=Q,Q=we.next,we.next=null,b.lastBaseUpdate=we,b.shared.pending=null}}while(!0);Te===null&&(re=De),b.baseState=re,b.firstBaseUpdate=_e,b.lastBaseUpdate=Te,w===null&&(b.shared.lanes=0),Qi|=P,s.lanes=P,s.memoizedState=De}}function $_(s,a){if(typeof s!="function")throw Error(r(191,s));s.call(a)}function q_(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)$_(c[s],a)}var ll=B(null),Wd=B(0);function H_(s,a){s=li,te(Wd,s),te(ll,a),li=s|a.baseLanes}function sp(){te(Wd,li),te(ll,ll.current)}function ip(){li=Wd.current,G(ll),G(Wd)}var vr=B(null),Br=null;function $i(s){var a=s.alternate;te(nn,nn.current&1),te(vr,s),Br===null&&(a===null||ll.current!==null||a.memoizedState!==null)&&(Br=s)}function ap(s){te(nn,nn.current),te(vr,s),Br===null&&(Br=s)}function G_(s){s.tag===22?(te(nn,nn.current),te(vr,s),Br===null&&(Br=s)):qi()}function qi(){te(nn,nn.current),te(vr,vr.current)}function xr(s){G(vr),Br===s&&(Br=null),G(nn)}var nn=B(0);function Kd(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||hg(c)||fg(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ei=0,at=null,Ot=null,dn=null,Yd=!1,cl=!1,oo=!1,Xd=0,Qc=0,ul=null,OA=0;function Jt(){throw Error(r(321))}function op(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!_r(s[c],a[c]))return!1;return!0}function lp(s,a,c,f,b,w){return ei=w,at=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,W.H=s===null||s.memoizedState===null?Rb:Sp,oo=!1,w=c(f,b),oo=!1,cl&&(w=W_(a,c,f,b)),Q_(s),w}function Q_(s){W.H=Yc;var a=Ot!==null&&Ot.next!==null;if(ei=0,dn=Ot=at=null,Yd=!1,Qc=0,ul=null,a)throw Error(r(300));s===null||hn||(s=s.dependencies,s!==null&&Fd(s)&&(hn=!0))}function W_(s,a,c,f){at=s;var b=0;do{if(cl&&(ul=null),Qc=0,cl=!1,25<=b)throw Error(r(301));if(b+=1,dn=Ot=null,s.updateQueue!=null){var w=s.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}W.H=Db,w=a(c,f)}while(cl);return w}function MA(){var s=W.H,a=s.useState()[0];return a=typeof a.then=="function"?Wc(a):a,s=s.useState()[0],(Ot!==null?Ot.memoizedState:null)!==s&&(at.flags|=1024),a}function cp(){var s=Xd!==0;return Xd=0,s}function up(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function dp(s){if(Yd){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}Yd=!1}ei=0,dn=Ot=at=null,cl=!1,Qc=Xd=0,ul=null}function nr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dn===null?at.memoizedState=dn=s:dn=dn.next=s,dn}function rn(){if(Ot===null){var s=at.alternate;s=s!==null?s.memoizedState:null}else s=Ot.next;var a=dn===null?at.memoizedState:dn.next;if(a!==null)dn=a,Ot=s;else{if(s===null)throw at.alternate===null?Error(r(467)):Error(r(310));Ot=s,s={memoizedState:Ot.memoizedState,baseState:Ot.baseState,baseQueue:Ot.baseQueue,queue:Ot.queue,next:null},dn===null?at.memoizedState=dn=s:dn=dn.next=s}return dn}function Zd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Wc(s){var a=Qc;return Qc+=1,ul===null&&(ul=[]),s=B_(ul,s,a),a=at,(dn===null?a.memoizedState:dn.next)===null&&(a=a.alternate,W.H=a===null||a.memoizedState===null?Rb:Sp),s}function Jd(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Wc(s);if(s.$$typeof===A)return Pn(s)}throw Error(r(438,String(s)))}function hp(s){var a=null,c=at.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var f=at.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(a={data:f.data.map(function(b){return b.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=Zd(),at.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),f=0;f<s;f++)c[f]=U;return a.index++,c}function ti(s,a){return typeof a=="function"?a(s):a}function eh(s){var a=rn();return fp(a,Ot,s)}function fp(s,a,c){var f=s.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=c;var b=s.baseQueue,w=f.pending;if(w!==null){if(b!==null){var P=b.next;b.next=w.next,w.next=P}a.baseQueue=b=w,f.pending=null}if(w=s.baseState,b===null)s.memoizedState=w;else{a=b.next;var Q=P=null,re=null,_e=a,Te=!1;do{var De=_e.lane&-536870913;if(De!==_e.lane?(ht&De)===De:(ei&De)===De){var be=_e.revertLane;if(be===0)re!==null&&(re=re.next={lane:0,revertLane:0,gesture:null,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null}),De===sl&&(Te=!0);else if((ei&be)===be){_e=_e.next,be===sl&&(Te=!0);continue}else De={lane:0,revertLane:_e.revertLane,gesture:null,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null},re===null?(Q=re=De,P=w):re=re.next=De,at.lanes|=be,Qi|=be;De=_e.action,oo&&c(w,De),w=_e.hasEagerState?_e.eagerState:c(w,De)}else be={lane:De,revertLane:_e.revertLane,gesture:_e.gesture,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null},re===null?(Q=re=be,P=w):re=re.next=be,at.lanes|=De,Qi|=De;_e=_e.next}while(_e!==null&&_e!==a);if(re===null?P=w:re.next=Q,!_r(w,s.memoizedState)&&(hn=!0,Te&&(c=il,c!==null)))throw c;s.memoizedState=w,s.baseState=P,s.baseQueue=re,f.lastRenderedState=w}return b===null&&(f.lanes=0),[s.memoizedState,f.dispatch]}function mp(s){var a=rn(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var f=c.dispatch,b=c.pending,w=a.memoizedState;if(b!==null){c.pending=null;var P=b=b.next;do w=s(w,P.action),P=P.next;while(P!==b);_r(w,a.memoizedState)||(hn=!0),a.memoizedState=w,a.baseQueue===null&&(a.baseState=w),c.lastRenderedState=w}return[w,f]}function K_(s,a,c){var f=at,b=rn(),w=yt;if(w){if(c===void 0)throw Error(r(407));c=c()}else c=a();var P=!_r((Ot||b).memoizedState,c);if(P&&(b.memoizedState=c,hn=!0),b=b.queue,yp(Z_.bind(null,f,b,s),[s]),b.getSnapshot!==a||P||dn!==null&&dn.memoizedState.tag&1){if(f.flags|=2048,dl(9,{destroy:void 0},X_.bind(null,f,b,c,a),null),zt===null)throw Error(r(349));w||(ei&127)!==0||Y_(f,a,c)}return c}function Y_(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=at.updateQueue,a===null?(a=Zd(),at.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function X_(s,a,c,f){a.value=c,a.getSnapshot=f,J_(a)&&eb(s)}function Z_(s,a,c){return c(function(){J_(a)&&eb(s)})}function J_(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!_r(s,c)}catch{return!0}}function eb(s){var a=Za(s,2);a!==null&&dr(a,s,2)}function pp(s){var a=nr();if(typeof s=="function"){var c=s;if(s=c(),oo){Qn(!0);try{c()}finally{Qn(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ti,lastRenderedState:s},a}function tb(s,a,c,f){return s.baseState=c,fp(s,Ot,typeof f=="function"?f:ti)}function NA(s,a,c,f,b){if(rh(s))throw Error(r(485));if(s=a.action,s!==null){var w={payload:b,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(P){w.listeners.push(P)}};W.T!==null?c(!0):w.isTransition=!1,f(w),c=a.pending,c===null?(w.next=a.pending=w,nb(a,w)):(w.next=c.next,a.pending=c.next=w)}}function nb(s,a){var c=a.action,f=a.payload,b=s.state;if(a.isTransition){var w=W.T,P={};W.T=P;try{var Q=c(b,f),re=W.S;re!==null&&re(P,Q),rb(s,a,Q)}catch(_e){gp(s,a,_e)}finally{w!==null&&P.types!==null&&(w.types=P.types),W.T=w}}else try{w=c(b,f),rb(s,a,w)}catch(_e){gp(s,a,_e)}}function rb(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){sb(s,a,f)},function(f){return gp(s,a,f)}):sb(s,a,c)}function sb(s,a,c){a.status="fulfilled",a.value=c,ib(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,nb(s,c)))}function gp(s,a,c){var f=s.pending;if(s.pending=null,f!==null){f=f.next;do a.status="rejected",a.reason=c,ib(a),a=a.next;while(a!==f)}s.action=null}function ib(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function ab(s,a){return a}function ob(s,a){if(yt){var c=zt.formState;if(c!==null){e:{var f=at;if(yt){if(Vt){t:{for(var b=Vt,w=zr;b.nodeType!==8;){if(!w){b=null;break t}if(b=Lr(b.nextSibling),b===null){b=null;break t}}w=b.data,b=w==="F!"||w==="F"?b:null}if(b){Vt=Lr(b.nextSibling),f=b.data==="F!";break e}}Bi(f)}f=!1}f&&(a=c[0])}}return c=nr(),c.memoizedState=c.baseState=a,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ab,lastRenderedState:a},c.queue=f,c=Tb.bind(null,at,f),f.dispatch=c,f=pp(!1),w=wp.bind(null,at,!1,f.queue),f=nr(),b={state:a,dispatch:null,action:s,pending:null},f.queue=b,c=NA.bind(null,at,b,w,c),b.dispatch=c,f.memoizedState=s,[a,c,!1]}function lb(s){var a=rn();return cb(a,Ot,s)}function cb(s,a,c){if(a=fp(s,a,ab)[0],s=eh(ti)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var f=Wc(a)}catch(P){throw P===al?qd:P}else f=a;a=rn();var b=a.queue,w=b.dispatch;return c!==a.memoizedState&&(at.flags|=2048,dl(9,{destroy:void 0},PA.bind(null,b,c),null)),[f,w,s]}function PA(s,a){s.action=a}function ub(s){var a=rn(),c=Ot;if(c!==null)return cb(a,c,s);rn(),a=a.memoizedState,c=rn();var f=c.queue.dispatch;return c.memoizedState=s,[a,f,!1]}function dl(s,a,c,f){return s={tag:s,create:c,deps:f,inst:a,next:null},a=at.updateQueue,a===null&&(a=Zd(),at.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(f=c.next,c.next=s,s.next=f,a.lastEffect=s),s}function db(){return rn().memoizedState}function th(s,a,c,f){var b=nr();at.flags|=s,b.memoizedState=dl(1|a,{destroy:void 0},c,f===void 0?null:f)}function nh(s,a,c,f){var b=rn();f=f===void 0?null:f;var w=b.memoizedState.inst;Ot!==null&&f!==null&&op(f,Ot.memoizedState.deps)?b.memoizedState=dl(a,w,c,f):(at.flags|=s,b.memoizedState=dl(1|a,w,c,f))}function hb(s,a){th(8390656,8,s,a)}function yp(s,a){nh(2048,8,s,a)}function zA(s){at.flags|=4;var a=at.updateQueue;if(a===null)a=Zd(),at.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function fb(s){var a=rn().memoizedState;return zA({ref:a,nextImpl:s}),function(){if((Tt&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function mb(s,a){return nh(4,2,s,a)}function pb(s,a){return nh(4,4,s,a)}function gb(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function yb(s,a,c){c=c!=null?c.concat([s]):null,nh(4,4,gb.bind(null,a,s),c)}function _p(){}function _b(s,a){var c=rn();a=a===void 0?null:a;var f=c.memoizedState;return a!==null&&op(a,f[1])?f[0]:(c.memoizedState=[s,a],s)}function bb(s,a){var c=rn();a=a===void 0?null:a;var f=c.memoizedState;if(a!==null&&op(a,f[1]))return f[0];if(f=s(),oo){Qn(!0);try{s()}finally{Qn(!1)}}return c.memoizedState=[f,a],f}function bp(s,a,c){return c===void 0||(ei&1073741824)!==0&&(ht&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=vv(),at.lanes|=s,Qi|=s,c)}function vb(s,a,c,f){return _r(c,a)?c:ll.current!==null?(s=bp(s,c,f),_r(s,a)||(hn=!0),s):(ei&42)===0||(ei&1073741824)!==0&&(ht&261930)===0?(hn=!0,s.memoizedState=c):(s=vv(),at.lanes|=s,Qi|=s,a)}function xb(s,a,c,f,b){var w=q.p;q.p=w!==0&&8>w?w:8;var P=W.T,Q={};W.T=Q,wp(s,!1,a,c);try{var re=b(),_e=W.S;if(_e!==null&&_e(Q,re),re!==null&&typeof re=="object"&&typeof re.then=="function"){var Te=kA(re,f);Kc(s,a,Te,Er(s))}else Kc(s,a,f,Er(s))}catch(De){Kc(s,a,{then:function(){},status:"rejected",reason:De},Er())}finally{q.p=w,P!==null&&Q.types!==null&&(P.types=Q.types),W.T=P}}function BA(){}function vp(s,a,c,f){if(s.tag!==5)throw Error(r(476));var b=wb(s).queue;xb(s,b,a,Z,c===null?BA:function(){return Sb(s),c(f)})}function wb(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ti,lastRenderedState:Z},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ti,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function Sb(s){var a=wb(s);a.next===null&&(a=s.alternate.memoizedState),Kc(s,a.next.queue,{},Er())}function xp(){return Pn(hu)}function Eb(){return rn().memoizedState}function Cb(){return rn().memoizedState}function LA(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=Er();s=Fi(c);var f=Vi(a,s,c);f!==null&&(dr(f,a,c),qc(f,a,c)),a={cache:Ym()},s.payload=a;return}a=a.return}}function UA(s,a,c){var f=Er();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},rh(s)?Ab(a,c):(c=Lm(s,a,c,f),c!==null&&(dr(c,s,f),jb(c,a,f)))}function Tb(s,a,c){var f=Er();Kc(s,a,c,f)}function Kc(s,a,c,f){var b={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(rh(s))Ab(a,b);else{var w=s.alternate;if(s.lanes===0&&(w===null||w.lanes===0)&&(w=a.lastRenderedReducer,w!==null))try{var P=a.lastRenderedState,Q=w(P,c);if(b.hasEagerState=!0,b.eagerState=Q,_r(Q,P))return zd(s,a,b,0),zt===null&&Pd(),!1}catch{}if(c=Lm(s,a,b,f),c!==null)return dr(c,s,f),jb(c,a,f),!0}return!1}function wp(s,a,c,f){if(f={lane:2,revertLane:eg(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},rh(s)){if(a)throw Error(r(479))}else a=Lm(s,c,f,2),a!==null&&dr(a,s,2)}function rh(s){var a=s.alternate;return s===at||a!==null&&a===at}function Ab(s,a){cl=Yd=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function jb(s,a,c){if((c&4194048)!==0){var f=a.lanes;f&=s.pendingLanes,c|=f,a.lanes=c,yc(s,c)}}var Yc={readContext:Pn,use:Jd,useCallback:Jt,useContext:Jt,useEffect:Jt,useImperativeHandle:Jt,useLayoutEffect:Jt,useInsertionEffect:Jt,useMemo:Jt,useReducer:Jt,useRef:Jt,useState:Jt,useDebugValue:Jt,useDeferredValue:Jt,useTransition:Jt,useSyncExternalStore:Jt,useId:Jt,useHostTransitionStatus:Jt,useFormState:Jt,useActionState:Jt,useOptimistic:Jt,useMemoCache:Jt,useCacheRefresh:Jt};Yc.useEffectEvent=Jt;var Rb={readContext:Pn,use:Jd,useCallback:function(s,a){return nr().memoizedState=[s,a===void 0?null:a],s},useContext:Pn,useEffect:hb,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,th(4194308,4,gb.bind(null,a,s),c)},useLayoutEffect:function(s,a){return th(4194308,4,s,a)},useInsertionEffect:function(s,a){th(4,2,s,a)},useMemo:function(s,a){var c=nr();a=a===void 0?null:a;var f=s();if(oo){Qn(!0);try{s()}finally{Qn(!1)}}return c.memoizedState=[f,a],f},useReducer:function(s,a,c){var f=nr();if(c!==void 0){var b=c(a);if(oo){Qn(!0);try{c(a)}finally{Qn(!1)}}}else b=a;return f.memoizedState=f.baseState=b,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:b},f.queue=s,s=s.dispatch=UA.bind(null,at,s),[f.memoizedState,s]},useRef:function(s){var a=nr();return s={current:s},a.memoizedState=s},useState:function(s){s=pp(s);var a=s.queue,c=Tb.bind(null,at,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:_p,useDeferredValue:function(s,a){var c=nr();return bp(c,s,a)},useTransition:function(){var s=pp(!1);return s=xb.bind(null,at,s.queue,!0,!1),nr().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var f=at,b=nr();if(yt){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),zt===null)throw Error(r(349));(ht&127)!==0||Y_(f,a,c)}b.memoizedState=c;var w={value:c,getSnapshot:a};return b.queue=w,hb(Z_.bind(null,f,w,s),[s]),f.flags|=2048,dl(9,{destroy:void 0},X_.bind(null,f,w,c,a),null),c},useId:function(){var s=nr(),a=zt.identifierPrefix;if(yt){var c=Os,f=ks;c=(f&~(1<<32-Et(f)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Xd++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=OA++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:xp,useFormState:ob,useActionState:ob,useOptimistic:function(s){var a=nr();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=wp.bind(null,at,!0,c),c.dispatch=a,[s,a]},useMemoCache:hp,useCacheRefresh:function(){return nr().memoizedState=LA.bind(null,at)},useEffectEvent:function(s){var a=nr(),c={impl:s};return a.memoizedState=c,function(){if((Tt&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},Sp={readContext:Pn,use:Jd,useCallback:_b,useContext:Pn,useEffect:yp,useImperativeHandle:yb,useInsertionEffect:mb,useLayoutEffect:pb,useMemo:bb,useReducer:eh,useRef:db,useState:function(){return eh(ti)},useDebugValue:_p,useDeferredValue:function(s,a){var c=rn();return vb(c,Ot.memoizedState,s,a)},useTransition:function(){var s=eh(ti)[0],a=rn().memoizedState;return[typeof s=="boolean"?s:Wc(s),a]},useSyncExternalStore:K_,useId:Eb,useHostTransitionStatus:xp,useFormState:lb,useActionState:lb,useOptimistic:function(s,a){var c=rn();return tb(c,Ot,s,a)},useMemoCache:hp,useCacheRefresh:Cb};Sp.useEffectEvent=fb;var Db={readContext:Pn,use:Jd,useCallback:_b,useContext:Pn,useEffect:yp,useImperativeHandle:yb,useInsertionEffect:mb,useLayoutEffect:pb,useMemo:bb,useReducer:mp,useRef:db,useState:function(){return mp(ti)},useDebugValue:_p,useDeferredValue:function(s,a){var c=rn();return Ot===null?bp(c,s,a):vb(c,Ot.memoizedState,s,a)},useTransition:function(){var s=mp(ti)[0],a=rn().memoizedState;return[typeof s=="boolean"?s:Wc(s),a]},useSyncExternalStore:K_,useId:Eb,useHostTransitionStatus:xp,useFormState:ub,useActionState:ub,useOptimistic:function(s,a){var c=rn();return Ot!==null?tb(c,Ot,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:hp,useCacheRefresh:Cb};Db.useEffectEvent=fb;function Ep(s,a,c,f){a=s.memoizedState,c=c(f,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var Cp={enqueueSetState:function(s,a,c){s=s._reactInternals;var f=Er(),b=Fi(f);b.payload=a,c!=null&&(b.callback=c),a=Vi(s,b,f),a!==null&&(dr(a,s,f),qc(a,s,f))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var f=Er(),b=Fi(f);b.tag=1,b.payload=a,c!=null&&(b.callback=c),a=Vi(s,b,f),a!==null&&(dr(a,s,f),qc(a,s,f))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=Er(),f=Fi(c);f.tag=2,a!=null&&(f.callback=a),a=Vi(s,f,c),a!==null&&(dr(a,s,c),qc(a,s,c))}};function Ib(s,a,c,f,b,w,P){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,w,P):a.prototype&&a.prototype.isPureReactComponent?!Pc(c,f)||!Pc(b,w):!0}function kb(s,a,c,f){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,f),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,f),a.state!==s&&Cp.enqueueReplaceState(a,a.state,null)}function lo(s,a){var c=a;if("ref"in a){c={};for(var f in a)f!=="ref"&&(c[f]=a[f])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var b in s)c[b]===void 0&&(c[b]=s[b])}return c}function Ob(s){Nd(s)}function Mb(s){console.error(s)}function Nb(s){Nd(s)}function sh(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(f){setTimeout(function(){throw f})}}function Pb(s,a,c){try{var f=s.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function Tp(s,a,c){return c=Fi(c),c.tag=3,c.payload={element:null},c.callback=function(){sh(s,a)},c}function zb(s){return s=Fi(s),s.tag=3,s}function Bb(s,a,c,f){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var w=f.value;s.payload=function(){return b(w)},s.callback=function(){Pb(a,c,f)}}var P=c.stateNode;P!==null&&typeof P.componentDidCatch=="function"&&(s.callback=function(){Pb(a,c,f),typeof b!="function"&&(Wi===null?Wi=new Set([this]):Wi.add(this));var Q=f.stack;this.componentDidCatch(f.value,{componentStack:Q!==null?Q:""})})}function FA(s,a,c,f,b){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(a=c.alternate,a!==null&&rl(a,c,b,!0),c=vr.current,c!==null){switch(c.tag){case 31:case 13:return Br===null?gh():c.alternate===null&&en===0&&(en=3),c.flags&=-257,c.flags|=65536,c.lanes=b,f===Hd?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([f]):a.add(f),Xp(s,f,b)),!1;case 22:return c.flags|=65536,f===Hd?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([f]):c.add(f)),Xp(s,f,b)),!1}throw Error(r(435,c.tag))}return Xp(s,f,b),gh(),!1}if(yt)return a=vr.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=b,f!==Hm&&(s=Error(r(422),{cause:f}),Lc(Mr(s,c)))):(f!==Hm&&(a=Error(r(423),{cause:f}),Lc(Mr(a,c))),s=s.current.alternate,s.flags|=65536,b&=-b,s.lanes|=b,f=Mr(f,c),b=Tp(s.stateNode,f,b),np(s,b),en!==4&&(en=2)),!1;var w=Error(r(520),{cause:f});if(w=Mr(w,c),su===null?su=[w]:su.push(w),en!==4&&(en=2),a===null)return!0;f=Mr(f,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=b&-b,c.lanes|=s,s=Tp(c.stateNode,f,s),np(c,s),!1;case 1:if(a=c.type,w=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Wi===null||!Wi.has(w))))return c.flags|=65536,b&=-b,c.lanes|=b,b=zb(b),Bb(b,s,c,f),np(c,b),!1}c=c.return}while(c!==null);return!1}var Ap=Error(r(461)),hn=!1;function zn(s,a,c,f){a.child=s===null?V_(a,null,c,f):ao(a,s.child,c,f)}function Lb(s,a,c,f,b){c=c.render;var w=a.ref;if("ref"in f){var P={};for(var Q in f)Q!=="ref"&&(P[Q]=f[Q])}else P=f;return no(a),f=lp(s,a,c,P,w,b),Q=cp(),s!==null&&!hn?(up(s,a,b),ni(s,a,b)):(yt&&Q&&$m(a),a.flags|=1,zn(s,a,f,b),a.child)}function Ub(s,a,c,f,b){if(s===null){var w=c.type;return typeof w=="function"&&!Um(w)&&w.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=w,Fb(s,a,w,f,b)):(s=Ld(c.type,null,f,a,a.mode,b),s.ref=a.ref,s.return=a,a.child=s)}if(w=s.child,!Np(s,b)){var P=w.memoizedProps;if(c=c.compare,c=c!==null?c:Pc,c(P,f)&&s.ref===a.ref)return ni(s,a,b)}return a.flags|=1,s=Ys(w,f),s.ref=a.ref,s.return=a,a.child=s}function Fb(s,a,c,f,b){if(s!==null){var w=s.memoizedProps;if(Pc(w,f)&&s.ref===a.ref)if(hn=!1,a.pendingProps=f=w,Np(s,b))(s.flags&131072)!==0&&(hn=!0);else return a.lanes=s.lanes,ni(s,a,b)}return jp(s,a,c,f,b)}function Vb(s,a,c,f){var b=f.children,w=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((a.flags&128)!==0){if(w=w!==null?w.baseLanes|c:c,s!==null){for(f=a.child=s.child,b=0;f!==null;)b=b|f.lanes|f.childLanes,f=f.sibling;f=b&~w}else f=0,a.child=null;return $b(s,a,w,c,f)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&$d(a,w!==null?w.cachePool:null),w!==null?H_(a,w):sp(),G_(a);else return f=a.lanes=536870912,$b(s,a,w!==null?w.baseLanes|c:c,c,f)}else w!==null?($d(a,w.cachePool),H_(a,w),qi(),a.memoizedState=null):(s!==null&&$d(a,null),sp(),qi());return zn(s,a,b,c),a.child}function Xc(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function $b(s,a,c,f,b){var w=Zm();return w=w===null?null:{parent:un._currentValue,pool:w},a.memoizedState={baseLanes:c,cachePool:w},s!==null&&$d(a,null),sp(),G_(a),s!==null&&rl(s,a,f,!0),a.childLanes=b,null}function ih(s,a){return a=oh({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function qb(s,a,c){return ao(a,s.child,null,c),s=ih(a,a.pendingProps),s.flags|=2,xr(a),a.memoizedState=null,s}function VA(s,a,c){var f=a.pendingProps,b=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(yt){if(f.mode==="hidden")return s=ih(a,f),a.lanes=536870912,Xc(null,s);if(ap(a),(s=Vt)?(s=nx(s,zr),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Pi!==null?{id:ks,overflow:Os}:null,retryLane:536870912,hydrationErrors:null},c=A_(s),c.return=a,a.child=c,Nn=a,Vt=null)):s=null,s===null)throw Bi(a);return a.lanes=536870912,null}return ih(a,f)}var w=s.memoizedState;if(w!==null){var P=w.dehydrated;if(ap(a),b)if(a.flags&256)a.flags&=-257,a=qb(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(r(558));else if(hn||rl(s,a,c,!1),b=(c&s.childLanes)!==0,hn||b){if(f=zt,f!==null&&(P=_c(f,c),P!==0&&P!==w.retryLane))throw w.retryLane=P,Za(s,P),dr(f,s,P),Ap;gh(),a=qb(s,a,c)}else s=w.treeContext,Vt=Lr(P.nextSibling),Nn=a,yt=!0,zi=null,zr=!1,s!==null&&D_(a,s),a=ih(a,f),a.flags|=4096;return a}return s=Ys(s.child,{mode:f.mode,children:f.children}),s.ref=a.ref,a.child=s,s.return=a,s}function ah(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function jp(s,a,c,f,b){return no(a),c=lp(s,a,c,f,void 0,b),f=cp(),s!==null&&!hn?(up(s,a,b),ni(s,a,b)):(yt&&f&&$m(a),a.flags|=1,zn(s,a,c,b),a.child)}function Hb(s,a,c,f,b,w){return no(a),a.updateQueue=null,c=W_(a,f,c,b),Q_(s),f=cp(),s!==null&&!hn?(up(s,a,w),ni(s,a,w)):(yt&&f&&$m(a),a.flags|=1,zn(s,a,c,w),a.child)}function Gb(s,a,c,f,b){if(no(a),a.stateNode===null){var w=Jo,P=c.contextType;typeof P=="object"&&P!==null&&(w=Pn(P)),w=new c(f,w),a.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=Cp,a.stateNode=w,w._reactInternals=a,w=a.stateNode,w.props=f,w.state=a.memoizedState,w.refs={},ep(a),P=c.contextType,w.context=typeof P=="object"&&P!==null?Pn(P):Jo,w.state=a.memoizedState,P=c.getDerivedStateFromProps,typeof P=="function"&&(Ep(a,c,P,f),w.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(P=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),P!==w.state&&Cp.enqueueReplaceState(w,w.state,null),Gc(a,f,w,b),Hc(),w.state=a.memoizedState),typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!0}else if(s===null){w=a.stateNode;var Q=a.memoizedProps,re=lo(c,Q);w.props=re;var _e=w.context,Te=c.contextType;P=Jo,typeof Te=="object"&&Te!==null&&(P=Pn(Te));var De=c.getDerivedStateFromProps;Te=typeof De=="function"||typeof w.getSnapshotBeforeUpdate=="function",Q=a.pendingProps!==Q,Te||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(Q||_e!==P)&&kb(a,w,f,P),Ui=!1;var be=a.memoizedState;w.state=be,Gc(a,f,w,b),Hc(),_e=a.memoizedState,Q||be!==_e||Ui?(typeof De=="function"&&(Ep(a,c,De,f),_e=a.memoizedState),(re=Ui||Ib(a,c,re,f,be,_e,P))?(Te||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(a.flags|=4194308)):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=f,a.memoizedState=_e),w.props=f,w.state=_e,w.context=P,f=re):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!1)}else{w=a.stateNode,tp(s,a),P=a.memoizedProps,Te=lo(c,P),w.props=Te,De=a.pendingProps,be=w.context,_e=c.contextType,re=Jo,typeof _e=="object"&&_e!==null&&(re=Pn(_e)),Q=c.getDerivedStateFromProps,(_e=typeof Q=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(P!==De||be!==re)&&kb(a,w,f,re),Ui=!1,be=a.memoizedState,w.state=be,Gc(a,f,w,b),Hc();var we=a.memoizedState;P!==De||be!==we||Ui||s!==null&&s.dependencies!==null&&Fd(s.dependencies)?(typeof Q=="function"&&(Ep(a,c,Q,f),we=a.memoizedState),(Te=Ui||Ib(a,c,Te,f,be,we,re)||s!==null&&s.dependencies!==null&&Fd(s.dependencies))?(_e||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(f,we,re),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(f,we,re)),typeof w.componentDidUpdate=="function"&&(a.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof w.componentDidUpdate!="function"||P===s.memoizedProps&&be===s.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||P===s.memoizedProps&&be===s.memoizedState||(a.flags|=1024),a.memoizedProps=f,a.memoizedState=we),w.props=f,w.state=we,w.context=re,f=Te):(typeof w.componentDidUpdate!="function"||P===s.memoizedProps&&be===s.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||P===s.memoizedProps&&be===s.memoizedState||(a.flags|=1024),f=!1)}return w=f,ah(s,a),f=(a.flags&128)!==0,w||f?(w=a.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:w.render(),a.flags|=1,s!==null&&f?(a.child=ao(a,s.child,null,b),a.child=ao(a,null,c,b)):zn(s,a,c,b),a.memoizedState=w.state,s=a.child):s=ni(s,a,b),s}function Qb(s,a,c,f){return eo(),a.flags|=256,zn(s,a,c,f),a.child}var Rp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Dp(s){return{baseLanes:s,cachePool:P_()}}function Ip(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=Sr),s}function Wb(s,a,c){var f=a.pendingProps,b=!1,w=(a.flags&128)!==0,P;if((P=w)||(P=s!==null&&s.memoizedState===null?!1:(nn.current&2)!==0),P&&(b=!0,a.flags&=-129),P=(a.flags&32)!==0,a.flags&=-33,s===null){if(yt){if(b?$i(a):qi(),(s=Vt)?(s=nx(s,zr),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Pi!==null?{id:ks,overflow:Os}:null,retryLane:536870912,hydrationErrors:null},c=A_(s),c.return=a,a.child=c,Nn=a,Vt=null)):s=null,s===null)throw Bi(a);return fg(s)?a.lanes=32:a.lanes=536870912,null}var Q=f.children;return f=f.fallback,b?(qi(),b=a.mode,Q=oh({mode:"hidden",children:Q},b),f=Ja(f,b,c,null),Q.return=a,f.return=a,Q.sibling=f,a.child=Q,f=a.child,f.memoizedState=Dp(c),f.childLanes=Ip(s,P,c),a.memoizedState=Rp,Xc(null,f)):($i(a),kp(a,Q))}var re=s.memoizedState;if(re!==null&&(Q=re.dehydrated,Q!==null)){if(w)a.flags&256?($i(a),a.flags&=-257,a=Op(s,a,c)):a.memoizedState!==null?(qi(),a.child=s.child,a.flags|=128,a=null):(qi(),Q=f.fallback,b=a.mode,f=oh({mode:"visible",children:f.children},b),Q=Ja(Q,b,c,null),Q.flags|=2,f.return=a,Q.return=a,f.sibling=Q,a.child=f,ao(a,s.child,null,c),f=a.child,f.memoizedState=Dp(c),f.childLanes=Ip(s,P,c),a.memoizedState=Rp,a=Xc(null,f));else if($i(a),fg(Q)){if(P=Q.nextSibling&&Q.nextSibling.dataset,P)var _e=P.dgst;P=_e,f=Error(r(419)),f.stack="",f.digest=P,Lc({value:f,source:null,stack:null}),a=Op(s,a,c)}else if(hn||rl(s,a,c,!1),P=(c&s.childLanes)!==0,hn||P){if(P=zt,P!==null&&(f=_c(P,c),f!==0&&f!==re.retryLane))throw re.retryLane=f,Za(s,f),dr(P,s,f),Ap;hg(Q)||gh(),a=Op(s,a,c)}else hg(Q)?(a.flags|=192,a.child=s.child,a=null):(s=re.treeContext,Vt=Lr(Q.nextSibling),Nn=a,yt=!0,zi=null,zr=!1,s!==null&&D_(a,s),a=kp(a,f.children),a.flags|=4096);return a}return b?(qi(),Q=f.fallback,b=a.mode,re=s.child,_e=re.sibling,f=Ys(re,{mode:"hidden",children:f.children}),f.subtreeFlags=re.subtreeFlags&65011712,_e!==null?Q=Ys(_e,Q):(Q=Ja(Q,b,c,null),Q.flags|=2),Q.return=a,f.return=a,f.sibling=Q,a.child=f,Xc(null,f),f=a.child,Q=s.child.memoizedState,Q===null?Q=Dp(c):(b=Q.cachePool,b!==null?(re=un._currentValue,b=b.parent!==re?{parent:re,pool:re}:b):b=P_(),Q={baseLanes:Q.baseLanes|c,cachePool:b}),f.memoizedState=Q,f.childLanes=Ip(s,P,c),a.memoizedState=Rp,Xc(s.child,f)):($i(a),c=s.child,s=c.sibling,c=Ys(c,{mode:"visible",children:f.children}),c.return=a,c.sibling=null,s!==null&&(P=a.deletions,P===null?(a.deletions=[s],a.flags|=16):P.push(s)),a.child=c,a.memoizedState=null,c)}function kp(s,a){return a=oh({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function oh(s,a){return s=br(22,s,null,a),s.lanes=0,s}function Op(s,a,c){return ao(a,s.child,null,c),s=kp(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function Kb(s,a,c){s.lanes|=a;var f=s.alternate;f!==null&&(f.lanes|=a),Wm(s.return,a,c)}function Mp(s,a,c,f,b,w){var P=s.memoizedState;P===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:b,treeForkCount:w}:(P.isBackwards=a,P.rendering=null,P.renderingStartTime=0,P.last=f,P.tail=c,P.tailMode=b,P.treeForkCount=w)}function Yb(s,a,c){var f=a.pendingProps,b=f.revealOrder,w=f.tail;f=f.children;var P=nn.current,Q=(P&2)!==0;if(Q?(P=P&1|2,a.flags|=128):P&=1,te(nn,P),zn(s,a,f,c),f=yt?Bc:0,!Q&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Kb(s,c,a);else if(s.tag===19)Kb(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(b){case"forwards":for(c=a.child,b=null;c!==null;)s=c.alternate,s!==null&&Kd(s)===null&&(b=c),c=c.sibling;c=b,c===null?(b=a.child,a.child=null):(b=c.sibling,c.sibling=null),Mp(a,!1,b,c,w,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=a.child,a.child=null;b!==null;){if(s=b.alternate,s!==null&&Kd(s)===null){a.child=b;break}s=b.sibling,b.sibling=c,c=b,b=s}Mp(a,!0,c,null,w,f);break;case"together":Mp(a,!1,null,null,void 0,f);break;default:a.memoizedState=null}return a.child}function ni(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),Qi|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(rl(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(r(153));if(a.child!==null){for(s=a.child,c=Ys(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=Ys(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Np(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&Fd(s)))}function $A(s,a,c){switch(a.tag){case 3:me(a,a.stateNode.containerInfo),Li(a,un,s.memoizedState.cache),eo();break;case 27:case 5:he(a);break;case 4:me(a,a.stateNode.containerInfo);break;case 10:Li(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,ap(a),null;break;case 13:var f=a.memoizedState;if(f!==null)return f.dehydrated!==null?($i(a),a.flags|=128,null):(c&a.child.childLanes)!==0?Wb(s,a,c):($i(a),s=ni(s,a,c),s!==null?s.sibling:null);$i(a);break;case 19:var b=(s.flags&128)!==0;if(f=(c&a.childLanes)!==0,f||(rl(s,a,c,!1),f=(c&a.childLanes)!==0),b){if(f)return Yb(s,a,c);a.flags|=128}if(b=a.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),te(nn,nn.current),f)break;return null;case 22:return a.lanes=0,Vb(s,a,c,a.pendingProps);case 24:Li(a,un,s.memoizedState.cache)}return ni(s,a,c)}function Xb(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)hn=!0;else{if(!Np(s,c)&&(a.flags&128)===0)return hn=!1,$A(s,a,c);hn=(s.flags&131072)!==0}else hn=!1,yt&&(a.flags&1048576)!==0&&R_(a,Bc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var f=a.pendingProps;if(s=so(a.elementType),a.type=s,typeof s=="function")Um(s)?(f=lo(s,f),a.tag=1,a=Gb(null,a,s,f,c)):(a.tag=0,a=jp(null,a,s,f,c));else{if(s!=null){var b=s.$$typeof;if(b===L){a.tag=11,a=Lb(null,a,s,f,c);break e}else if(b===O){a.tag=14,a=Ub(null,a,s,f,c);break e}}throw a=R(s)||s,Error(r(306,a,""))}}return a;case 0:return jp(s,a,a.type,a.pendingProps,c);case 1:return f=a.type,b=lo(f,a.pendingProps),Gb(s,a,f,b,c);case 3:e:{if(me(a,a.stateNode.containerInfo),s===null)throw Error(r(387));f=a.pendingProps;var w=a.memoizedState;b=w.element,tp(s,a),Gc(a,f,null,c);var P=a.memoizedState;if(f=P.cache,Li(a,un,f),f!==w.cache&&Km(a,[un],c,!0),Hc(),f=P.element,w.isDehydrated)if(w={element:f,isDehydrated:!1,cache:P.cache},a.updateQueue.baseState=w,a.memoizedState=w,a.flags&256){a=Qb(s,a,f,c);break e}else if(f!==b){b=Mr(Error(r(424)),a),Lc(b),a=Qb(s,a,f,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,Vt=Lr(s.firstChild),Nn=a,yt=!0,zi=null,zr=!0,c=V_(a,null,f,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(eo(),f===b){a=ni(s,a,c);break e}zn(s,a,f,c)}a=a.child}return a;case 26:return ah(s,a),s===null?(c=lx(a.type,null,a.pendingProps,null))?a.memoizedState=c:yt||(c=a.type,s=a.pendingProps,f=Sh(fe.current).createElement(c),f[on]=a,f[jn]=s,Bn(f,c,s),ln(f),a.stateNode=f):a.memoizedState=lx(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return he(a),s===null&&yt&&(f=a.stateNode=ix(a.type,a.pendingProps,fe.current),Nn=a,zr=!0,b=Vt,Zi(a.type)?(mg=b,Vt=Lr(f.firstChild)):Vt=b),zn(s,a,a.pendingProps.children,c),ah(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&yt&&((b=f=Vt)&&(f=b5(f,a.type,a.pendingProps,zr),f!==null?(a.stateNode=f,Nn=a,Vt=Lr(f.firstChild),zr=!1,b=!0):b=!1),b||Bi(a)),he(a),b=a.type,w=a.pendingProps,P=s!==null?s.memoizedProps:null,f=w.children,cg(b,w)?f=null:P!==null&&cg(b,P)&&(a.flags|=32),a.memoizedState!==null&&(b=lp(s,a,MA,null,null,c),hu._currentValue=b),ah(s,a),zn(s,a,f,c),a.child;case 6:return s===null&&yt&&((s=c=Vt)&&(c=v5(c,a.pendingProps,zr),c!==null?(a.stateNode=c,Nn=a,Vt=null,s=!0):s=!1),s||Bi(a)),null;case 13:return Wb(s,a,c);case 4:return me(a,a.stateNode.containerInfo),f=a.pendingProps,s===null?a.child=ao(a,null,f,c):zn(s,a,f,c),a.child;case 11:return Lb(s,a,a.type,a.pendingProps,c);case 7:return zn(s,a,a.pendingProps,c),a.child;case 8:return zn(s,a,a.pendingProps.children,c),a.child;case 12:return zn(s,a,a.pendingProps.children,c),a.child;case 10:return f=a.pendingProps,Li(a,a.type,f.value),zn(s,a,f.children,c),a.child;case 9:return b=a.type._context,f=a.pendingProps.children,no(a),b=Pn(b),f=f(b),a.flags|=1,zn(s,a,f,c),a.child;case 14:return Ub(s,a,a.type,a.pendingProps,c);case 15:return Fb(s,a,a.type,a.pendingProps,c);case 19:return Yb(s,a,c);case 31:return VA(s,a,c);case 22:return Vb(s,a,c,a.pendingProps);case 24:return no(a),f=Pn(un),s===null?(b=Zm(),b===null&&(b=zt,w=Ym(),b.pooledCache=w,w.refCount++,w!==null&&(b.pooledCacheLanes|=c),b=w),a.memoizedState={parent:f,cache:b},ep(a),Li(a,un,b)):((s.lanes&c)!==0&&(tp(s,a),Gc(a,null,null,c),Hc()),b=s.memoizedState,w=a.memoizedState,b.parent!==f?(b={parent:f,cache:f},a.memoizedState=b,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=b),Li(a,un,f)):(f=w.cache,Li(a,un,f),f!==b.cache&&Km(a,[un],c,!0))),zn(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function ri(s){s.flags|=4}function Pp(s,a,c,f,b){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(b&335544128)===b)if(s.stateNode.complete)s.flags|=8192;else if(Ev())s.flags|=8192;else throw io=Hd,Jm}else s.flags&=-16777217}function Zb(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!fx(a))if(Ev())s.flags|=8192;else throw io=Hd,Jm}function lh(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?md():536870912,s.lanes|=a,pl|=a)}function Zc(s,a){if(!yt)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function $t(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,f=0;if(a)for(var b=s.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags&65011712,f|=b.flags&65011712,b.return=s,b=b.sibling;else for(b=s.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags,f|=b.flags,b.return=s,b=b.sibling;return s.subtreeFlags|=f,s.childLanes=c,a}function qA(s,a,c){var f=a.pendingProps;switch(qm(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $t(a),null;case 1:return $t(a),null;case 3:return c=a.stateNode,f=null,s!==null&&(f=s.memoizedState.cache),a.memoizedState.cache!==f&&(a.flags|=2048),Js(un),Ce(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(nl(a)?ri(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Gm())),$t(a),null;case 26:var b=a.type,w=a.memoizedState;return s===null?(ri(a),w!==null?($t(a),Zb(a,w)):($t(a),Pp(a,b,null,f,c))):w?w!==s.memoizedState?(ri(a),$t(a),Zb(a,w)):($t(a),a.flags&=-16777217):(s=s.memoizedProps,s!==f&&ri(a),$t(a),Pp(a,b,s,f,c)),null;case 27:if(Me(a),c=fe.current,b=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==f&&ri(a);else{if(!f){if(a.stateNode===null)throw Error(r(166));return $t(a),null}s=ie.current,nl(a)?I_(a):(s=ix(b,f,c),a.stateNode=s,ri(a))}return $t(a),null;case 5:if(Me(a),b=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==f&&ri(a);else{if(!f){if(a.stateNode===null)throw Error(r(166));return $t(a),null}if(w=ie.current,nl(a))I_(a);else{var P=Sh(fe.current);switch(w){case 1:w=P.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:w=P.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":w=P.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":w=P.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":w=P.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof f.is=="string"?P.createElement("select",{is:f.is}):P.createElement("select"),f.multiple?w.multiple=!0:f.size&&(w.size=f.size);break;default:w=typeof f.is=="string"?P.createElement(b,{is:f.is}):P.createElement(b)}}w[on]=a,w[jn]=f;e:for(P=a.child;P!==null;){if(P.tag===5||P.tag===6)w.appendChild(P.stateNode);else if(P.tag!==4&&P.tag!==27&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===a)break e;for(;P.sibling===null;){if(P.return===null||P.return===a)break e;P=P.return}P.sibling.return=P.return,P=P.sibling}a.stateNode=w;e:switch(Bn(w,b,f),b){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&ri(a)}}return $t(a),Pp(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==f&&ri(a);else{if(typeof f!="string"&&a.stateNode===null)throw Error(r(166));if(s=fe.current,nl(a)){if(s=a.stateNode,c=a.memoizedProps,f=null,b=Nn,b!==null)switch(b.tag){case 27:case 5:f=b.memoizedProps}s[on]=a,s=!!(s.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||Wv(s.nodeValue,c)),s||Bi(a,!0)}else s=Sh(s).createTextNode(f),s[on]=a,a.stateNode=s}return $t(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(f=nl(a),c!==null){if(s===null){if(!f)throw Error(r(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[on]=a}else eo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;$t(a),s=!1}else c=Gm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(xr(a),a):(xr(a),null);if((a.flags&128)!==0)throw Error(r(558))}return $t(a),null;case 13:if(f=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(b=nl(a),f!==null&&f.dehydrated!==null){if(s===null){if(!b)throw Error(r(318));if(b=a.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(r(317));b[on]=a}else eo(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;$t(a),b=!1}else b=Gm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=b),b=!0;if(!b)return a.flags&256?(xr(a),a):(xr(a),null)}return xr(a),(a.flags&128)!==0?(a.lanes=c,a):(c=f!==null,s=s!==null&&s.memoizedState!==null,c&&(f=a.child,b=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(b=f.alternate.memoizedState.cachePool.pool),w=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(w=f.memoizedState.cachePool.pool),w!==b&&(f.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),lh(a,a.updateQueue),$t(a),null);case 4:return Ce(),s===null&&sg(a.stateNode.containerInfo),$t(a),null;case 10:return Js(a.type),$t(a),null;case 19:if(G(nn),f=a.memoizedState,f===null)return $t(a),null;if(b=(a.flags&128)!==0,w=f.rendering,w===null)if(b)Zc(f,!1);else{if(en!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(w=Kd(s),w!==null){for(a.flags|=128,Zc(f,!1),s=w.updateQueue,a.updateQueue=s,lh(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)T_(c,s),c=c.sibling;return te(nn,nn.current&1|2),yt&&Xs(a,f.treeForkCount),a.child}s=s.sibling}f.tail!==null&&ze()>fh&&(a.flags|=128,b=!0,Zc(f,!1),a.lanes=4194304)}else{if(!b)if(s=Kd(w),s!==null){if(a.flags|=128,b=!0,s=s.updateQueue,a.updateQueue=s,lh(a,s),Zc(f,!0),f.tail===null&&f.tailMode==="hidden"&&!w.alternate&&!yt)return $t(a),null}else 2*ze()-f.renderingStartTime>fh&&c!==536870912&&(a.flags|=128,b=!0,Zc(f,!1),a.lanes=4194304);f.isBackwards?(w.sibling=a.child,a.child=w):(s=f.last,s!==null?s.sibling=w:a.child=w,f.last=w)}return f.tail!==null?(s=f.tail,f.rendering=s,f.tail=s.sibling,f.renderingStartTime=ze(),s.sibling=null,c=nn.current,te(nn,b?c&1|2:c&1),yt&&Xs(a,f.treeForkCount),s):($t(a),null);case 22:case 23:return xr(a),ip(),f=a.memoizedState!==null,s!==null?s.memoizedState!==null!==f&&(a.flags|=8192):f&&(a.flags|=8192),f?(c&536870912)!==0&&(a.flags&128)===0&&($t(a),a.subtreeFlags&6&&(a.flags|=8192)):$t(a),c=a.updateQueue,c!==null&&lh(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),f=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),f!==c&&(a.flags|=2048),s!==null&&G(ro),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),Js(un),$t(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function HA(s,a){switch(qm(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return Js(un),Ce(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Me(a),null;case 31:if(a.memoizedState!==null){if(xr(a),a.alternate===null)throw Error(r(340));eo()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(xr(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(r(340));eo()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return G(nn),null;case 4:return Ce(),null;case 10:return Js(a.type),null;case 22:case 23:return xr(a),ip(),s!==null&&G(ro),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return Js(un),null;case 25:return null;default:return null}}function Jb(s,a){switch(qm(a),a.tag){case 3:Js(un),Ce();break;case 26:case 27:case 5:Me(a);break;case 4:Ce();break;case 31:a.memoizedState!==null&&xr(a);break;case 13:xr(a);break;case 19:G(nn);break;case 10:Js(a.type);break;case 22:case 23:xr(a),ip(),s!==null&&G(ro);break;case 24:Js(un)}}function Jc(s,a){try{var c=a.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var b=f.next;c=b;do{if((c.tag&s)===s){f=void 0;var w=c.create,P=c.inst;f=w(),P.destroy=f}c=c.next}while(c!==b)}}catch(Q){It(a,a.return,Q)}}function Hi(s,a,c){try{var f=a.updateQueue,b=f!==null?f.lastEffect:null;if(b!==null){var w=b.next;f=w;do{if((f.tag&s)===s){var P=f.inst,Q=P.destroy;if(Q!==void 0){P.destroy=void 0,b=a;var re=c,_e=Q;try{_e()}catch(Te){It(b,re,Te)}}}f=f.next}while(f!==w)}}catch(Te){It(a,a.return,Te)}}function ev(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{q_(a,c)}catch(f){It(s,s.return,f)}}}function tv(s,a,c){c.props=lo(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(f){It(s,a,f)}}function eu(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var f=s.stateNode;break;case 30:f=s.stateNode;break;default:f=s.stateNode}typeof c=="function"?s.refCleanup=c(f):c.current=f}}catch(b){It(s,a,b)}}function Ms(s,a){var c=s.ref,f=s.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(b){It(s,a,b)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){It(s,a,b)}else c.current=null}function nv(s){var a=s.type,c=s.memoizedProps,f=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(b){It(s,s.return,b)}}function zp(s,a,c){try{var f=s.stateNode;f5(f,s.type,c,a),f[jn]=a}catch(b){It(s,s.return,b)}}function rv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Zi(s.type)||s.tag===4}function Bp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||rv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Zi(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Lp(s,a,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=Yr));else if(f!==4&&(f===27&&Zi(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Lp(s,a,c),s=s.sibling;s!==null;)Lp(s,a,c),s=s.sibling}function ch(s,a,c){var f=s.tag;if(f===5||f===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(f!==4&&(f===27&&Zi(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(ch(s,a,c),s=s.sibling;s!==null;)ch(s,a,c),s=s.sibling}function sv(s){var a=s.stateNode,c=s.memoizedProps;try{for(var f=s.type,b=a.attributes;b.length;)a.removeAttributeNode(b[0]);Bn(a,f,c),a[on]=s,a[jn]=c}catch(w){It(s,s.return,w)}}var si=!1,fn=!1,Up=!1,iv=typeof WeakSet=="function"?WeakSet:Set,Dn=null;function GA(s,a){if(s=s.containerInfo,og=Dh,s=y_(s),Om(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var b=f.anchorOffset,w=f.focusNode;f=f.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var P=0,Q=-1,re=-1,_e=0,Te=0,De=s,be=null;t:for(;;){for(var we;De!==c||b!==0&&De.nodeType!==3||(Q=P+b),De!==w||f!==0&&De.nodeType!==3||(re=P+f),De.nodeType===3&&(P+=De.nodeValue.length),(we=De.firstChild)!==null;)be=De,De=we;for(;;){if(De===s)break t;if(be===c&&++_e===b&&(Q=P),be===w&&++Te===f&&(re=P),(we=De.nextSibling)!==null)break;De=be,be=De.parentNode}De=we}c=Q===-1||re===-1?null:{start:Q,end:re}}else c=null}c=c||{start:0,end:0}}else c=null;for(lg={focusedElem:s,selectionRange:c},Dh=!1,Dn=a;Dn!==null;)if(a=Dn,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,Dn=s;else for(;Dn!==null;){switch(a=Dn,w=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)b=s[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&w!==null){s=void 0,c=a,b=w.memoizedProps,w=w.memoizedState,f=c.stateNode;try{var $e=lo(c.type,b);s=f.getSnapshotBeforeUpdate($e,w),f.__reactInternalSnapshotBeforeUpdate=s}catch(Ke){It(c,c.return,Ke)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)dg(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":dg(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=a.sibling,s!==null){s.return=a.return,Dn=s;break}Dn=a.return}}function av(s,a,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:ai(s,c),f&4&&Jc(5,c);break;case 1:if(ai(s,c),f&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(P){It(c,c.return,P)}else{var b=lo(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(b,a,s.__reactInternalSnapshotBeforeUpdate)}catch(P){It(c,c.return,P)}}f&64&&ev(c),f&512&&eu(c,c.return);break;case 3:if(ai(s,c),f&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{q_(s,a)}catch(P){It(c,c.return,P)}}break;case 27:a===null&&f&4&&sv(c);case 26:case 5:ai(s,c),a===null&&f&4&&nv(c),f&512&&eu(c,c.return);break;case 12:ai(s,c);break;case 31:ai(s,c),f&4&&cv(s,c);break;case 13:ai(s,c),f&4&&uv(s,c),f&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=t5.bind(null,c),x5(s,c))));break;case 22:if(f=c.memoizedState!==null||si,!f){a=a!==null&&a.memoizedState!==null||fn,b=si;var w=fn;si=f,(fn=a)&&!w?oi(s,c,(c.subtreeFlags&8772)!==0):ai(s,c),si=b,fn=w}break;case 30:break;default:ai(s,c)}}function ov(s){var a=s.alternate;a!==null&&(s.alternate=null,ov(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&Lo(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Wt=null,or=!1;function ii(s,a,c){for(c=c.child;c!==null;)lv(s,a,c),c=c.sibling}function lv(s,a,c){if(Zt&&typeof Zt.onCommitFiberUnmount=="function")try{Zt.onCommitFiberUnmount(bt,c)}catch{}switch(c.tag){case 26:fn||Ms(c,a),ii(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:fn||Ms(c,a);var f=Wt,b=or;Zi(c.type)&&(Wt=c.stateNode,or=!1),ii(s,a,c),cu(c.stateNode),Wt=f,or=b;break;case 5:fn||Ms(c,a);case 6:if(f=Wt,b=or,Wt=null,ii(s,a,c),Wt=f,or=b,Wt!==null)if(or)try{(Wt.nodeType===9?Wt.body:Wt.nodeName==="HTML"?Wt.ownerDocument.body:Wt).removeChild(c.stateNode)}catch(w){It(c,a,w)}else try{Wt.removeChild(c.stateNode)}catch(w){It(c,a,w)}break;case 18:Wt!==null&&(or?(s=Wt,ex(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Sl(s)):ex(Wt,c.stateNode));break;case 4:f=Wt,b=or,Wt=c.stateNode.containerInfo,or=!0,ii(s,a,c),Wt=f,or=b;break;case 0:case 11:case 14:case 15:Hi(2,c,a),fn||Hi(4,c,a),ii(s,a,c);break;case 1:fn||(Ms(c,a),f=c.stateNode,typeof f.componentWillUnmount=="function"&&tv(c,a,f)),ii(s,a,c);break;case 21:ii(s,a,c);break;case 22:fn=(f=fn)||c.memoizedState!==null,ii(s,a,c),fn=f;break;default:ii(s,a,c)}}function cv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Sl(s)}catch(c){It(a,a.return,c)}}}function uv(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Sl(s)}catch(c){It(a,a.return,c)}}function QA(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new iv),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new iv),a;default:throw Error(r(435,s.tag))}}function uh(s,a){var c=QA(s);a.forEach(function(f){if(!c.has(f)){c.add(f);var b=n5.bind(null,s,f);f.then(b,b)}})}function lr(s,a){var c=a.deletions;if(c!==null)for(var f=0;f<c.length;f++){var b=c[f],w=s,P=a,Q=P;e:for(;Q!==null;){switch(Q.tag){case 27:if(Zi(Q.type)){Wt=Q.stateNode,or=!1;break e}break;case 5:Wt=Q.stateNode,or=!1;break e;case 3:case 4:Wt=Q.stateNode.containerInfo,or=!0;break e}Q=Q.return}if(Wt===null)throw Error(r(160));lv(w,P,b),Wt=null,or=!1,w=b.alternate,w!==null&&(w.return=null),b.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)dv(a,s),a=a.sibling}var ns=null;function dv(s,a){var c=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:lr(a,s),cr(s),f&4&&(Hi(3,s,s.return),Jc(3,s),Hi(5,s,s.return));break;case 1:lr(a,s),cr(s),f&512&&(fn||c===null||Ms(c,c.return)),f&64&&si&&(s=s.updateQueue,s!==null&&(f=s.callbacks,f!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var b=ns;if(lr(a,s),cr(s),f&512&&(fn||c===null||Ms(c,c.return)),f&4){var w=c!==null?c.memoizedState:null;if(f=s.memoizedState,c===null)if(f===null)if(s.stateNode===null){e:{f=s.type,c=s.memoizedProps,b=b.ownerDocument||b;t:switch(f){case"title":w=b.getElementsByTagName("title")[0],(!w||w[vs]||w[on]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=b.createElement(f),b.head.insertBefore(w,b.querySelector("head > title"))),Bn(w,f,c),w[on]=s,ln(w),f=w;break e;case"link":var P=dx("link","href",b).get(f+(c.href||""));if(P){for(var Q=0;Q<P.length;Q++)if(w=P[Q],w.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&w.getAttribute("rel")===(c.rel==null?null:c.rel)&&w.getAttribute("title")===(c.title==null?null:c.title)&&w.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){P.splice(Q,1);break t}}w=b.createElement(f),Bn(w,f,c),b.head.appendChild(w);break;case"meta":if(P=dx("meta","content",b).get(f+(c.content||""))){for(Q=0;Q<P.length;Q++)if(w=P[Q],w.getAttribute("content")===(c.content==null?null:""+c.content)&&w.getAttribute("name")===(c.name==null?null:c.name)&&w.getAttribute("property")===(c.property==null?null:c.property)&&w.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&w.getAttribute("charset")===(c.charSet==null?null:c.charSet)){P.splice(Q,1);break t}}w=b.createElement(f),Bn(w,f,c),b.head.appendChild(w);break;default:throw Error(r(468,f))}w[on]=s,ln(w),f=w}s.stateNode=f}else hx(b,s.type,s.stateNode);else s.stateNode=ux(b,f,s.memoizedProps);else w!==f?(w===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):w.count--,f===null?hx(b,s.type,s.stateNode):ux(b,f,s.memoizedProps)):f===null&&s.stateNode!==null&&zp(s,s.memoizedProps,c.memoizedProps)}break;case 27:lr(a,s),cr(s),f&512&&(fn||c===null||Ms(c,c.return)),c!==null&&f&4&&zp(s,s.memoizedProps,c.memoizedProps);break;case 5:if(lr(a,s),cr(s),f&512&&(fn||c===null||Ms(c,c.return)),s.flags&32){b=s.stateNode;try{ar(b,"")}catch($e){It(s,s.return,$e)}}f&4&&s.stateNode!=null&&(b=s.memoizedProps,zp(s,b,c!==null?c.memoizedProps:b)),f&1024&&(Up=!0);break;case 6:if(lr(a,s),cr(s),f&4){if(s.stateNode===null)throw Error(r(162));f=s.memoizedProps,c=s.stateNode;try{c.nodeValue=f}catch($e){It(s,s.return,$e)}}break;case 3:if(Th=null,b=ns,ns=Eh(a.containerInfo),lr(a,s),ns=b,cr(s),f&4&&c!==null&&c.memoizedState.isDehydrated)try{Sl(a.containerInfo)}catch($e){It(s,s.return,$e)}Up&&(Up=!1,hv(s));break;case 4:f=ns,ns=Eh(s.stateNode.containerInfo),lr(a,s),cr(s),ns=f;break;case 12:lr(a,s),cr(s);break;case 31:lr(a,s),cr(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,uh(s,f)));break;case 13:lr(a,s),cr(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(hh=ze()),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,uh(s,f)));break;case 22:b=s.memoizedState!==null;var re=c!==null&&c.memoizedState!==null,_e=si,Te=fn;if(si=_e||b,fn=Te||re,lr(a,s),fn=Te,si=_e,cr(s),f&8192)e:for(a=s.stateNode,a._visibility=b?a._visibility&-2:a._visibility|1,b&&(c===null||re||si||fn||co(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){re=c=a;try{if(w=re.stateNode,b)P=w.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none";else{Q=re.stateNode;var De=re.memoizedProps.style,be=De!=null&&De.hasOwnProperty("display")?De.display:null;Q.style.display=be==null||typeof be=="boolean"?"":(""+be).trim()}}catch($e){It(re,re.return,$e)}}}else if(a.tag===6){if(c===null){re=a;try{re.stateNode.nodeValue=b?"":re.memoizedProps}catch($e){It(re,re.return,$e)}}}else if(a.tag===18){if(c===null){re=a;try{var we=re.stateNode;b?tx(we,!0):tx(re.stateNode,!1)}catch($e){It(re,re.return,$e)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}f&4&&(f=s.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,uh(s,c))));break;case 19:lr(a,s),cr(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,uh(s,f)));break;case 30:break;case 21:break;default:lr(a,s),cr(s)}}function cr(s){var a=s.flags;if(a&2){try{for(var c,f=s.return;f!==null;){if(rv(f)){c=f;break}f=f.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var b=c.stateNode,w=Bp(s);ch(s,w,b);break;case 5:var P=c.stateNode;c.flags&32&&(ar(P,""),c.flags&=-33);var Q=Bp(s);ch(s,Q,P);break;case 3:case 4:var re=c.stateNode.containerInfo,_e=Bp(s);Lp(s,_e,re);break;default:throw Error(r(161))}}catch(Te){It(s,s.return,Te)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function hv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;hv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function ai(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)av(s,a.alternate,a),a=a.sibling}function co(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:Hi(4,a,a.return),co(a);break;case 1:Ms(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&tv(a,a.return,c),co(a);break;case 27:cu(a.stateNode);case 26:case 5:Ms(a,a.return),co(a);break;case 22:a.memoizedState===null&&co(a);break;case 30:co(a);break;default:co(a)}s=s.sibling}}function oi(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var f=a.alternate,b=s,w=a,P=w.flags;switch(w.tag){case 0:case 11:case 15:oi(b,w,c),Jc(4,w);break;case 1:if(oi(b,w,c),f=w,b=f.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(_e){It(f,f.return,_e)}if(f=w,b=f.updateQueue,b!==null){var Q=f.stateNode;try{var re=b.shared.hiddenCallbacks;if(re!==null)for(b.shared.hiddenCallbacks=null,b=0;b<re.length;b++)$_(re[b],Q)}catch(_e){It(f,f.return,_e)}}c&&P&64&&ev(w),eu(w,w.return);break;case 27:sv(w);case 26:case 5:oi(b,w,c),c&&f===null&&P&4&&nv(w),eu(w,w.return);break;case 12:oi(b,w,c);break;case 31:oi(b,w,c),c&&P&4&&cv(b,w);break;case 13:oi(b,w,c),c&&P&4&&uv(b,w);break;case 22:w.memoizedState===null&&oi(b,w,c),eu(w,w.return);break;case 30:break;default:oi(b,w,c)}a=a.sibling}}function Fp(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Uc(c))}function Vp(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Uc(s))}function rs(s,a,c,f){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)fv(s,a,c,f),a=a.sibling}function fv(s,a,c,f){var b=a.flags;switch(a.tag){case 0:case 11:case 15:rs(s,a,c,f),b&2048&&Jc(9,a);break;case 1:rs(s,a,c,f);break;case 3:rs(s,a,c,f),b&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Uc(s)));break;case 12:if(b&2048){rs(s,a,c,f),s=a.stateNode;try{var w=a.memoizedProps,P=w.id,Q=w.onPostCommit;typeof Q=="function"&&Q(P,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(re){It(a,a.return,re)}}else rs(s,a,c,f);break;case 31:rs(s,a,c,f);break;case 13:rs(s,a,c,f);break;case 23:break;case 22:w=a.stateNode,P=a.alternate,a.memoizedState!==null?w._visibility&2?rs(s,a,c,f):tu(s,a):w._visibility&2?rs(s,a,c,f):(w._visibility|=2,hl(s,a,c,f,(a.subtreeFlags&10256)!==0||!1)),b&2048&&Fp(P,a);break;case 24:rs(s,a,c,f),b&2048&&Vp(a.alternate,a);break;default:rs(s,a,c,f)}}function hl(s,a,c,f,b){for(b=b&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var w=s,P=a,Q=c,re=f,_e=P.flags;switch(P.tag){case 0:case 11:case 15:hl(w,P,Q,re,b),Jc(8,P);break;case 23:break;case 22:var Te=P.stateNode;P.memoizedState!==null?Te._visibility&2?hl(w,P,Q,re,b):tu(w,P):(Te._visibility|=2,hl(w,P,Q,re,b)),b&&_e&2048&&Fp(P.alternate,P);break;case 24:hl(w,P,Q,re,b),b&&_e&2048&&Vp(P.alternate,P);break;default:hl(w,P,Q,re,b)}a=a.sibling}}function tu(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,f=a,b=f.flags;switch(f.tag){case 22:tu(c,f),b&2048&&Fp(f.alternate,f);break;case 24:tu(c,f),b&2048&&Vp(f.alternate,f);break;default:tu(c,f)}a=a.sibling}}var nu=8192;function fl(s,a,c){if(s.subtreeFlags&nu)for(s=s.child;s!==null;)mv(s,a,c),s=s.sibling}function mv(s,a,c){switch(s.tag){case 26:fl(s,a,c),s.flags&nu&&s.memoizedState!==null&&O5(c,ns,s.memoizedState,s.memoizedProps);break;case 5:fl(s,a,c);break;case 3:case 4:var f=ns;ns=Eh(s.stateNode.containerInfo),fl(s,a,c),ns=f;break;case 22:s.memoizedState===null&&(f=s.alternate,f!==null&&f.memoizedState!==null?(f=nu,nu=16777216,fl(s,a,c),nu=f):fl(s,a,c));break;default:fl(s,a,c)}}function pv(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function ru(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];Dn=f,yv(f,s)}pv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)gv(s),s=s.sibling}function gv(s){switch(s.tag){case 0:case 11:case 15:ru(s),s.flags&2048&&Hi(9,s,s.return);break;case 3:ru(s);break;case 12:ru(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,dh(s)):ru(s);break;default:ru(s)}}function dh(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var f=a[c];Dn=f,yv(f,s)}pv(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:Hi(8,a,a.return),dh(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,dh(a));break;default:dh(a)}s=s.sibling}}function yv(s,a){for(;Dn!==null;){var c=Dn;switch(c.tag){case 0:case 11:case 15:Hi(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Uc(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,Dn=f;else e:for(c=s;Dn!==null;){f=Dn;var b=f.sibling,w=f.return;if(ov(f),f===c){Dn=null;break e}if(b!==null){b.return=w,Dn=b;break e}Dn=w}}}var WA={getCacheForType:function(s){var a=Pn(un),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return Pn(un).controller.signal}},KA=typeof WeakMap=="function"?WeakMap:Map,Tt=0,zt=null,ct=null,ht=0,Dt=0,wr=null,Gi=!1,ml=!1,$p=!1,li=0,en=0,Qi=0,uo=0,qp=0,Sr=0,pl=0,su=null,ur=null,Hp=!1,hh=0,_v=0,fh=1/0,mh=null,Wi=null,vn=0,Ki=null,gl=null,ci=0,Gp=0,Qp=null,bv=null,iu=0,Wp=null;function Er(){return(Tt&2)!==0&&ht!==0?ht&-ht:W.T!==null?eg():pd()}function vv(){if(Sr===0)if((ht&536870912)===0||yt){var s=gs;gs<<=1,(gs&3932160)===0&&(gs=262144),Sr=s}else Sr=536870912;return s=vr.current,s!==null&&(s.flags|=32),Sr}function dr(s,a,c){(s===zt&&(Dt===2||Dt===9)||s.cancelPendingCommit!==null)&&(yl(s,0),Yi(s,ht,Sr,!1)),Ba(s,c),((Tt&2)===0||s!==zt)&&(s===zt&&((Tt&2)===0&&(uo|=c),en===4&&Yi(s,ht,Sr,!1)),Ns(s))}function xv(s,a,c){if((Tt&6)!==0)throw Error(r(327));var f=!c&&(a&127)===0&&(a&s.expiredLanes)===0||Qr(s,a),b=f?ZA(s,a):Yp(s,a,!0),w=f;do{if(b===0){ml&&!f&&Yi(s,a,0,!1);break}else{if(c=s.current.alternate,w&&!YA(c)){b=Yp(s,a,!1),w=!1;continue}if(b===2){if(w=a,s.errorRecoveryDisabledLanes&w)var P=0;else P=s.pendingLanes&-536870913,P=P!==0?P:P&536870912?536870912:0;if(P!==0){a=P;e:{var Q=s;b=su;var re=Q.current.memoizedState.isDehydrated;if(re&&(yl(Q,P).flags|=256),P=Yp(Q,P,!1),P!==2){if($p&&!re){Q.errorRecoveryDisabledLanes|=w,uo|=w,b=4;break e}w=ur,ur=b,w!==null&&(ur===null?ur=w:ur.push.apply(ur,w))}b=P}if(w=!1,b!==2)continue}}if(b===1){yl(s,0),Yi(s,a,0,!0);break}e:{switch(f=s,w=b,w){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:Yi(f,a,Sr,!Gi);break e;case 2:ur=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(b=hh+300-ze(),10<b)){if(Yi(f,a,Sr,!Gi),ys(f,0,!0)!==0)break e;ci=a,f.timeoutHandle=Zv(wv.bind(null,f,c,ur,mh,Hp,a,Sr,uo,pl,Gi,w,"Throttled",-0,0),b);break e}wv(f,c,ur,mh,Hp,a,Sr,uo,pl,Gi,w,null,-0,0)}}break}while(!0);Ns(s)}function wv(s,a,c,f,b,w,P,Q,re,_e,Te,De,be,we){if(s.timeoutHandle=-1,De=a.subtreeFlags,De&8192||(De&16785408)===16785408){De={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Yr},mv(a,w,De);var $e=(w&62914560)===w?hh-ze():(w&4194048)===w?_v-ze():0;if($e=M5(De,$e),$e!==null){ci=w,s.cancelPendingCommit=$e(Dv.bind(null,s,a,w,c,f,b,P,Q,re,Te,De,null,be,we)),Yi(s,w,P,!_e);return}}Dv(s,a,w,c,f,b,P,Q,re)}function YA(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var b=c[f],w=b.getSnapshot;b=b.value;try{if(!_r(w(),b))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Yi(s,a,c,f){a&=~qp,a&=~uo,s.suspendedLanes|=a,s.pingedLanes&=~a,f&&(s.warmLanes|=a),f=s.expirationTimes;for(var b=a;0<b;){var w=31-Et(b),P=1<<w;f[w]=-1,b&=~P}c!==0&&La(s,c,a)}function ph(){return(Tt&6)===0?(au(0),!1):!0}function Kp(){if(ct!==null){if(Dt===0)var s=ct.return;else s=ct,Zs=to=null,dp(s),ol=null,Vc=0,s=ct;for(;s!==null;)Jb(s.alternate,s),s=s.return;ct=null}}function yl(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,g5(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),ci=0,Kp(),zt=s,ct=c=Ys(s.current,null),ht=a,Dt=0,wr=null,Gi=!1,ml=Qr(s,a),$p=!1,pl=Sr=qp=uo=Qi=en=0,ur=su=null,Hp=!1,(a&8)!==0&&(a|=a&32);var f=s.entangledLanes;if(f!==0)for(s=s.entanglements,f&=a;0<f;){var b=31-Et(f),w=1<<b;a|=s[b],f&=~w}return li=a,Pd(),c}function Sv(s,a){at=null,W.H=Yc,a===al||a===qd?(a=L_(),Dt=3):a===Jm?(a=L_(),Dt=4):Dt=a===Ap?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,wr=a,ct===null&&(en=1,sh(s,Mr(a,s.current)))}function Ev(){var s=vr.current;return s===null?!0:(ht&4194048)===ht?Br===null:(ht&62914560)===ht||(ht&536870912)!==0?s===Br:!1}function Cv(){var s=W.H;return W.H=Yc,s===null?Yc:s}function Tv(){var s=W.A;return W.A=WA,s}function gh(){en=4,Gi||(ht&4194048)!==ht&&vr.current!==null||(ml=!0),(Qi&134217727)===0&&(uo&134217727)===0||zt===null||Yi(zt,ht,Sr,!1)}function Yp(s,a,c){var f=Tt;Tt|=2;var b=Cv(),w=Tv();(zt!==s||ht!==a)&&(mh=null,yl(s,a)),a=!1;var P=en;e:do try{if(Dt!==0&&ct!==null){var Q=ct,re=wr;switch(Dt){case 8:Kp(),P=6;break e;case 3:case 2:case 9:case 6:vr.current===null&&(a=!0);var _e=Dt;if(Dt=0,wr=null,_l(s,Q,re,_e),c&&ml){P=0;break e}break;default:_e=Dt,Dt=0,wr=null,_l(s,Q,re,_e)}}XA(),P=en;break}catch(Te){Sv(s,Te)}while(!0);return a&&s.shellSuspendCounter++,Zs=to=null,Tt=f,W.H=b,W.A=w,ct===null&&(zt=null,ht=0,Pd()),P}function XA(){for(;ct!==null;)Av(ct)}function ZA(s,a){var c=Tt;Tt|=2;var f=Cv(),b=Tv();zt!==s||ht!==a?(mh=null,fh=ze()+500,yl(s,a)):ml=Qr(s,a);e:do try{if(Dt!==0&&ct!==null){a=ct;var w=wr;t:switch(Dt){case 1:Dt=0,wr=null,_l(s,a,w,1);break;case 2:case 9:if(z_(w)){Dt=0,wr=null,jv(a);break}a=function(){Dt!==2&&Dt!==9||zt!==s||(Dt=7),Ns(s)},w.then(a,a);break e;case 3:Dt=7;break e;case 4:Dt=5;break e;case 7:z_(w)?(Dt=0,wr=null,jv(a)):(Dt=0,wr=null,_l(s,a,w,7));break;case 5:var P=null;switch(ct.tag){case 26:P=ct.memoizedState;case 5:case 27:var Q=ct;if(P?fx(P):Q.stateNode.complete){Dt=0,wr=null;var re=Q.sibling;if(re!==null)ct=re;else{var _e=Q.return;_e!==null?(ct=_e,yh(_e)):ct=null}break t}}Dt=0,wr=null,_l(s,a,w,5);break;case 6:Dt=0,wr=null,_l(s,a,w,6);break;case 8:Kp(),en=6;break e;default:throw Error(r(462))}}JA();break}catch(Te){Sv(s,Te)}while(!0);return Zs=to=null,W.H=f,W.A=b,Tt=c,ct!==null?0:(zt=null,ht=0,Pd(),en)}function JA(){for(;ct!==null&&!oe();)Av(ct)}function Av(s){var a=Xb(s.alternate,s,li);s.memoizedProps=s.pendingProps,a===null?yh(s):ct=a}function jv(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=Hb(c,a,a.pendingProps,a.type,void 0,ht);break;case 11:a=Hb(c,a,a.pendingProps,a.type.render,a.ref,ht);break;case 5:dp(a);default:Jb(c,a),a=ct=T_(a,li),a=Xb(c,a,li)}s.memoizedProps=s.pendingProps,a===null?yh(s):ct=a}function _l(s,a,c,f){Zs=to=null,dp(a),ol=null,Vc=0;var b=a.return;try{if(FA(s,b,a,c,ht)){en=1,sh(s,Mr(c,s.current)),ct=null;return}}catch(w){if(b!==null)throw ct=b,w;en=1,sh(s,Mr(c,s.current)),ct=null;return}a.flags&32768?(yt||f===1?s=!0:ml||(ht&536870912)!==0?s=!1:(Gi=s=!0,(f===2||f===9||f===3||f===6)&&(f=vr.current,f!==null&&f.tag===13&&(f.flags|=16384))),Rv(a,s)):yh(a)}function yh(s){var a=s;do{if((a.flags&32768)!==0){Rv(a,Gi);return}s=a.return;var c=qA(a.alternate,a,li);if(c!==null){ct=c;return}if(a=a.sibling,a!==null){ct=a;return}ct=a=s}while(a!==null);en===0&&(en=5)}function Rv(s,a){do{var c=HA(s.alternate,s);if(c!==null){c.flags&=32767,ct=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){ct=s;return}ct=s=c}while(s!==null);en=6,ct=null}function Dv(s,a,c,f,b,w,P,Q,re){s.cancelPendingCommit=null;do _h();while(vn!==0);if((Tt&6)!==0)throw Error(r(327));if(a!==null){if(a===s.current)throw Error(r(177));if(w=a.lanes|a.childLanes,w|=Bm,Rm(s,c,w,P,Q,re),s===zt&&(ct=zt=null,ht=0),gl=a,Ki=s,ci=c,Gp=w,Qp=b,bv=f,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,r5(st,function(){return Nv(),null})):(s.callbackNode=null,s.callbackPriority=0),f=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||f){f=W.T,W.T=null,b=q.p,q.p=2,P=Tt,Tt|=4;try{GA(s,a,c)}finally{Tt=P,q.p=b,W.T=f}}vn=1,Iv(),kv(),Ov()}}function Iv(){if(vn===1){vn=0;var s=Ki,a=gl,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=W.T,W.T=null;var f=q.p;q.p=2;var b=Tt;Tt|=4;try{dv(a,s);var w=lg,P=y_(s.containerInfo),Q=w.focusedElem,re=w.selectionRange;if(P!==Q&&Q&&Q.ownerDocument&&g_(Q.ownerDocument.documentElement,Q)){if(re!==null&&Om(Q)){var _e=re.start,Te=re.end;if(Te===void 0&&(Te=_e),"selectionStart"in Q)Q.selectionStart=_e,Q.selectionEnd=Math.min(Te,Q.value.length);else{var De=Q.ownerDocument||document,be=De&&De.defaultView||window;if(be.getSelection){var we=be.getSelection(),$e=Q.textContent.length,Ke=Math.min(re.start,$e),Nt=re.end===void 0?Ke:Math.min(re.end,$e);!we.extend&&Ke>Nt&&(P=Nt,Nt=Ke,Ke=P);var de=p_(Q,Ke),le=p_(Q,Nt);if(de&&le&&(we.rangeCount!==1||we.anchorNode!==de.node||we.anchorOffset!==de.offset||we.focusNode!==le.node||we.focusOffset!==le.offset)){var ye=De.createRange();ye.setStart(de.node,de.offset),we.removeAllRanges(),Ke>Nt?(we.addRange(ye),we.extend(le.node,le.offset)):(ye.setEnd(le.node,le.offset),we.addRange(ye))}}}}for(De=[],we=Q;we=we.parentNode;)we.nodeType===1&&De.push({element:we,left:we.scrollLeft,top:we.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<De.length;Q++){var Ae=De[Q];Ae.element.scrollLeft=Ae.left,Ae.element.scrollTop=Ae.top}}Dh=!!og,lg=og=null}finally{Tt=b,q.p=f,W.T=c}}s.current=a,vn=2}}function kv(){if(vn===2){vn=0;var s=Ki,a=gl,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=W.T,W.T=null;var f=q.p;q.p=2;var b=Tt;Tt|=4;try{av(s,a.alternate,a)}finally{Tt=b,q.p=f,W.T=c}}vn=3}}function Ov(){if(vn===4||vn===3){vn=0,je();var s=Ki,a=gl,c=ci,f=bv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?vn=5:(vn=0,gl=Ki=null,Mv(s,s.pendingLanes));var b=s.pendingLanes;if(b===0&&(Wi=null),Gs(c),a=a.stateNode,Zt&&typeof Zt.onCommitFiberRoot=="function")try{Zt.onCommitFiberRoot(bt,a,void 0,(a.current.flags&128)===128)}catch{}if(f!==null){a=W.T,b=q.p,q.p=2,W.T=null;try{for(var w=s.onRecoverableError,P=0;P<f.length;P++){var Q=f[P];w(Q.value,{componentStack:Q.stack})}}finally{W.T=a,q.p=b}}(ci&3)!==0&&_h(),Ns(s),b=s.pendingLanes,(c&261930)!==0&&(b&42)!==0?s===Wp?iu++:(iu=0,Wp=s):iu=0,au(0)}}function Mv(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Uc(a)))}function _h(){return Iv(),kv(),Ov(),Nv()}function Nv(){if(vn!==5)return!1;var s=Ki,a=Gp;Gp=0;var c=Gs(ci),f=W.T,b=q.p;try{q.p=32>c?32:c,W.T=null,c=Qp,Qp=null;var w=Ki,P=ci;if(vn=0,gl=Ki=null,ci=0,(Tt&6)!==0)throw Error(r(331));var Q=Tt;if(Tt|=4,gv(w.current),fv(w,w.current,P,c),Tt=Q,au(0,!1),Zt&&typeof Zt.onPostCommitFiberRoot=="function")try{Zt.onPostCommitFiberRoot(bt,w)}catch{}return!0}finally{q.p=b,W.T=f,Mv(s,a)}}function Pv(s,a,c){a=Mr(c,a),a=Tp(s.stateNode,a,2),s=Vi(s,a,2),s!==null&&(Ba(s,2),Ns(s))}function It(s,a,c){if(s.tag===3)Pv(s,s,c);else for(;a!==null;){if(a.tag===3){Pv(a,s,c);break}else if(a.tag===1){var f=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Wi===null||!Wi.has(f))){s=Mr(c,s),c=zb(2),f=Vi(a,c,2),f!==null&&(Bb(c,f,a,s),Ba(f,2),Ns(f));break}}a=a.return}}function Xp(s,a,c){var f=s.pingCache;if(f===null){f=s.pingCache=new KA;var b=new Set;f.set(a,b)}else b=f.get(a),b===void 0&&(b=new Set,f.set(a,b));b.has(c)||($p=!0,b.add(c),s=e5.bind(null,s,a,c),a.then(s,s))}function e5(s,a,c){var f=s.pingCache;f!==null&&f.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,zt===s&&(ht&c)===c&&(en===4||en===3&&(ht&62914560)===ht&&300>ze()-hh?(Tt&2)===0&&yl(s,0):qp|=c,pl===ht&&(pl=0)),Ns(s)}function zv(s,a){a===0&&(a=md()),s=Za(s,a),s!==null&&(Ba(s,a),Ns(s))}function t5(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),zv(s,c)}function n5(s,a){var c=0;switch(s.tag){case 31:case 13:var f=s.stateNode,b=s.memoizedState;b!==null&&(c=b.retryLane);break;case 19:f=s.stateNode;break;case 22:f=s.stateNode._retryCache;break;default:throw Error(r(314))}f!==null&&f.delete(a),zv(s,c)}function r5(s,a){return xe(s,a)}var bh=null,bl=null,Zp=!1,vh=!1,Jp=!1,Xi=0;function Ns(s){s!==bl&&s.next===null&&(bl===null?bh=bl=s:bl=bl.next=s),vh=!0,Zp||(Zp=!0,i5())}function au(s,a){if(!Jp&&vh){Jp=!0;do for(var c=!1,f=bh;f!==null;){if(s!==0){var b=f.pendingLanes;if(b===0)var w=0;else{var P=f.suspendedLanes,Q=f.pingedLanes;w=(1<<31-Et(42|s)+1)-1,w&=b&~(P&~Q),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(c=!0,Fv(f,w))}else w=ht,w=ys(f,f===zt?w:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(w&3)===0||Qr(f,w)||(c=!0,Fv(f,w));f=f.next}while(c);Jp=!1}}function s5(){Bv()}function Bv(){vh=Zp=!1;var s=0;Xi!==0&&p5()&&(s=Xi);for(var a=ze(),c=null,f=bh;f!==null;){var b=f.next,w=Lv(f,a);w===0?(f.next=null,c===null?bh=b:c.next=b,b===null&&(bl=c)):(c=f,(s!==0||(w&3)!==0)&&(vh=!0)),f=b}vn!==0&&vn!==5||au(s),Xi!==0&&(Xi=0)}function Lv(s,a){for(var c=s.suspendedLanes,f=s.pingedLanes,b=s.expirationTimes,w=s.pendingLanes&-62914561;0<w;){var P=31-Et(w),Q=1<<P,re=b[P];re===-1?((Q&c)===0||(Q&f)!==0)&&(b[P]=jm(Q,a)):re<=a&&(s.expiredLanes|=Q),w&=~Q}if(a=zt,c=ht,c=ys(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f=s.callbackNode,c===0||s===a&&(Dt===2||Dt===9)||s.cancelPendingCommit!==null)return f!==null&&f!==null&&Se(f),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Qr(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(f!==null&&Se(f),Gs(c)){case 2:case 8:c=xt;break;case 32:c=st;break;case 268435456:c=ms;break;default:c=st}return f=Uv.bind(null,s),c=xe(c,f),s.callbackPriority=a,s.callbackNode=c,a}return f!==null&&f!==null&&Se(f),s.callbackPriority=2,s.callbackNode=null,2}function Uv(s,a){if(vn!==0&&vn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(_h()&&s.callbackNode!==c)return null;var f=ht;return f=ys(s,s===zt?f:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f===0?null:(xv(s,f,a),Lv(s,ze()),s.callbackNode!=null&&s.callbackNode===c?Uv.bind(null,s):null)}function Fv(s,a){if(_h())return null;xv(s,a,!0)}function i5(){y5(function(){(Tt&6)!==0?xe(Ge,s5):Bv()})}function eg(){if(Xi===0){var s=sl;s===0&&(s=jr,jr<<=1,(jr&261888)===0&&(jr=256)),Xi=s}return Xi}function Vv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:$o(""+s)}function $v(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function a5(s,a,c,f,b){if(a==="submit"&&c&&c.stateNode===b){var w=Vv((b[jn]||null).action),P=f.submitter;P&&(a=(a=P[jn]||null)?Vv(a.formAction):P.getAttribute("formAction"),a!==null&&(w=a,P=null));var Q=new js("action","action",null,f,b);s.push({event:Q,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Xi!==0){var re=P?$v(b,P):new FormData(b);vp(c,{pending:!0,data:re,method:b.method,action:w},null,re)}}else typeof w=="function"&&(Q.preventDefault(),re=P?$v(b,P):new FormData(b),vp(c,{pending:!0,data:re,method:b.method,action:w},w,re))},currentTarget:b}]})}}for(var tg=0;tg<zm.length;tg++){var ng=zm[tg],o5=ng.toLowerCase(),l5=ng[0].toUpperCase()+ng.slice(1);ts(o5,"on"+l5)}ts(v_,"onAnimationEnd"),ts(x_,"onAnimationIteration"),ts(w_,"onAnimationStart"),ts("dblclick","onDoubleClick"),ts("focusin","onFocus"),ts("focusout","onBlur"),ts(EA,"onTransitionRun"),ts(CA,"onTransitionStart"),ts(TA,"onTransitionCancel"),ts(S_,"onTransitionEnd"),Es("onMouseEnter",["mouseout","mouseover"]),Es("onMouseLeave",["mouseout","mouseover"]),Es("onPointerEnter",["pointerout","pointerover"]),Es("onPointerLeave",["pointerout","pointerover"]),Ss("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ss("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ss("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ss("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ss("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ss("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ou="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),c5=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ou));function qv(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var f=s[c],b=f.event;f=f.listeners;e:{var w=void 0;if(a)for(var P=f.length-1;0<=P;P--){var Q=f[P],re=Q.instance,_e=Q.currentTarget;if(Q=Q.listener,re!==w&&b.isPropagationStopped())break e;w=Q,b.currentTarget=_e;try{w(b)}catch(Te){Nd(Te)}b.currentTarget=null,w=re}else for(P=0;P<f.length;P++){if(Q=f[P],re=Q.instance,_e=Q.currentTarget,Q=Q.listener,re!==w&&b.isPropagationStopped())break e;w=Q,b.currentTarget=_e;try{w(b)}catch(Te){Nd(Te)}b.currentTarget=null,w=re}}}}function ut(s,a){var c=a[Bo];c===void 0&&(c=a[Bo]=new Set);var f=s+"__bubble";c.has(f)||(Hv(a,s,2,!1),c.add(f))}function rg(s,a,c){var f=0;a&&(f|=4),Hv(c,s,f,a)}var xh="_reactListening"+Math.random().toString(36).slice(2);function sg(s){if(!s[xh]){s[xh]=!0,bc.forEach(function(c){c!=="selectionchange"&&(c5.has(c)||rg(c,!1,s),rg(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[xh]||(a[xh]=!0,rg("selectionchange",!1,a))}}function Hv(s,a,c,f){switch(vx(a)){case 2:var b=z5;break;case 8:b=B5;break;default:b=bg}c=b.bind(null,a,c,s),b=void 0,!qa||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(b=!0),f?b!==void 0?s.addEventListener(a,c,{capture:!0,passive:b}):s.addEventListener(a,c,!0):b!==void 0?s.addEventListener(a,c,{passive:b}):s.addEventListener(a,c,!1)}function ig(s,a,c,f,b){var w=f;if((a&1)===0&&(a&2)===0&&f!==null)e:for(;;){if(f===null)return;var P=f.tag;if(P===3||P===4){var Q=f.stateNode.containerInfo;if(Q===b)break;if(P===4)for(P=f.return;P!==null;){var re=P.tag;if((re===3||re===4)&&P.stateNode.containerInfo===b)return;P=P.return}for(;Q!==null;){if(P=xs(Q),P===null)return;if(re=P.tag,re===5||re===6||re===26||re===27){f=w=P;continue e}Q=Q.parentNode}}f=f.return}ki(function(){var _e=w,Te=Dr(c),De=[];e:{var be=E_.get(s);if(be!==void 0){var we=js,$e=s;switch(s){case"keypress":if(Ga(c)===0)break e;case"keydown":case"keyup":we=kd;break;case"focusin":$e="focus",we=Wa;break;case"focusout":$e="blur",we=Wa;break;case"beforeblur":case"afterblur":we=Wa;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":we=kc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":we=Sd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":we=D;break;case v_:case x_:case w_:we=Cd;break;case S_:we=Y;break;case"scroll":case"scrollend":we=Ic;break;case"wheel":we=ve;break;case"copy":case"cut":case"paste":we=Td;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":we=Ks;break;case"toggle":case"beforetoggle":we=it}var Ke=(a&4)!==0,Nt=!Ke&&(s==="scroll"||s==="scrollend"),de=Ke?be!==null?be+"Capture":null:be;Ke=[];for(var le=_e,ye;le!==null;){var Ae=le;if(ye=Ae.stateNode,Ae=Ae.tag,Ae!==5&&Ae!==26&&Ae!==27||ye===null||de===null||(Ae=Xr(le,de),Ae!=null&&Ke.push(lu(le,Ae,ye))),Nt)break;le=le.return}0<Ke.length&&(be=new we(be,$e,null,c,Te),De.push({event:be,listeners:Ke}))}}if((a&7)===0){e:{if(be=s==="mouseover"||s==="pointerover",we=s==="mouseout"||s==="pointerout",be&&c!==jc&&($e=c.relatedTarget||c.fromElement)&&(xs($e)||$e[bs]))break e;if((we||be)&&(be=Te.window===Te?Te:(be=Te.ownerDocument)?be.defaultView||be.parentWindow:window,we?($e=c.relatedTarget||c.toElement,we=_e,$e=$e?xs($e):null,$e!==null&&(Nt=o($e),Ke=$e.tag,$e!==Nt||Ke!==5&&Ke!==27&&Ke!==6)&&($e=null)):(we=null,$e=_e),we!==$e)){if(Ke=kc,Ae="onMouseLeave",de="onMouseEnter",le="mouse",(s==="pointerout"||s==="pointerover")&&(Ke=Ks,Ae="onPointerLeave",de="onPointerEnter",le="pointer"),Nt=we==null?be:gr(we),ye=$e==null?be:gr($e),be=new Ke(Ae,le+"leave",we,c,Te),be.target=Nt,be.relatedTarget=ye,Ae=null,xs(Te)===_e&&(Ke=new Ke(de,le+"enter",$e,c,Te),Ke.target=ye,Ke.relatedTarget=Nt,Ae=Ke),Nt=Ae,we&&$e)t:{for(Ke=u5,de=we,le=$e,ye=0,Ae=de;Ae;Ae=Ke(Ae))ye++;Ae=0;for(var Qe=le;Qe;Qe=Ke(Qe))Ae++;for(;0<ye-Ae;)de=Ke(de),ye--;for(;0<Ae-ye;)le=Ke(le),Ae--;for(;ye--;){if(de===le||le!==null&&de===le.alternate){Ke=de;break t}de=Ke(de),le=Ke(le)}Ke=null}else Ke=null;we!==null&&Gv(De,be,we,Ke,!1),$e!==null&&Nt!==null&&Gv(De,Nt,$e,Ke,!0)}}e:{if(be=_e?gr(_e):window,we=be.nodeName&&be.nodeName.toLowerCase(),we==="select"||we==="input"&&be.type==="file")var wt=c_;else if(o_(be))if(u_)wt=xA;else{wt=bA;var He=_A}else we=be.nodeName,!we||we.toLowerCase()!=="input"||be.type!=="checkbox"&&be.type!=="radio"?_e&&Vo(_e.elementType)&&(wt=c_):wt=vA;if(wt&&(wt=wt(s,_e))){l_(De,wt,c,Te);break e}He&&He(s,be,_e),s==="focusout"&&_e&&be.type==="number"&&_e.memoizedProps.value!=null&&Cc(be,"number",be.value)}switch(He=_e?gr(_e):window,s){case"focusin":(o_(He)||He.contentEditable==="true")&&(Yo=He,Mm=_e,zc=null);break;case"focusout":zc=Mm=Yo=null;break;case"mousedown":Nm=!0;break;case"contextmenu":case"mouseup":case"dragend":Nm=!1,__(De,c,Te);break;case"selectionchange":if(SA)break;case"keydown":case"keyup":__(De,c,Te)}var ot;if(Ct)e:{switch(s){case"compositionstart":var ft="onCompositionStart";break e;case"compositionend":ft="onCompositionEnd";break e;case"compositionupdate":ft="onCompositionUpdate";break e}ft=void 0}else Ko?Ka(s,c)&&(ft="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(ft="onCompositionStart");ft&&(Is&&c.locale!=="ko"&&(Ko||ft!=="onCompositionStart"?ft==="onCompositionEnd"&&Ko&&(ot=Dc()):(As=Te,Rc="value"in As?As.value:As.textContent,Ko=!0)),He=wh(_e,ft),0<He.length&&(ft=new Ds(ft,s,null,c,Te),De.push({event:ft,listeners:He}),ot?ft.data=ot:(ot=Wo(c),ot!==null&&(ft.data=ot)))),(ot=kr?mA(s,c):pA(s,c))&&(ft=wh(_e,"onBeforeInput"),0<ft.length&&(He=new Ds("onBeforeInput","beforeinput",null,c,Te),De.push({event:He,listeners:ft}),He.data=ot)),a5(De,s,_e,c,Te)}qv(De,a)})}function lu(s,a,c){return{instance:s,listener:a,currentTarget:c}}function wh(s,a){for(var c=a+"Capture",f=[];s!==null;){var b=s,w=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||w===null||(b=Xr(s,c),b!=null&&f.unshift(lu(s,b,w)),b=Xr(s,a),b!=null&&f.push(lu(s,b,w))),s.tag===3)return f;s=s.return}return[]}function u5(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Gv(s,a,c,f,b){for(var w=a._reactName,P=[];c!==null&&c!==f;){var Q=c,re=Q.alternate,_e=Q.stateNode;if(Q=Q.tag,re!==null&&re===f)break;Q!==5&&Q!==26&&Q!==27||_e===null||(re=_e,b?(_e=Xr(c,w),_e!=null&&P.unshift(lu(c,_e,re))):b||(_e=Xr(c,w),_e!=null&&P.push(lu(c,_e,re)))),c=c.return}P.length!==0&&s.push({event:a,listeners:P})}var d5=/\r\n?/g,h5=/\u0000|\uFFFD/g;function Qv(s){return(typeof s=="string"?s:""+s).replace(d5,`
`).replace(h5,"")}function Wv(s,a){return a=Qv(a),Qv(s)===a}function Mt(s,a,c,f,b,w){switch(c){case"children":typeof f=="string"?a==="body"||a==="textarea"&&f===""||ar(s,f):(typeof f=="number"||typeof f=="bigint")&&a!=="body"&&ar(s,""+f);break;case"className":yr(s,"class",f);break;case"tabIndex":yr(s,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":yr(s,c,f);break;case"style":Ac(s,f,w);break;case"data":if(a!=="object"){yr(s,"data",f);break}case"src":case"href":if(f===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=$o(""+f),s.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(c==="formAction"?(a!=="input"&&Mt(s,a,"name",b.name,b,null),Mt(s,a,"formEncType",b.formEncType,b,null),Mt(s,a,"formMethod",b.formMethod,b,null),Mt(s,a,"formTarget",b.formTarget,b,null)):(Mt(s,a,"encType",b.encType,b,null),Mt(s,a,"method",b.method,b,null),Mt(s,a,"target",b.target,b,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(c);break}f=$o(""+f),s.setAttribute(c,f);break;case"onClick":f!=null&&(s.onclick=Yr);break;case"onScroll":f!=null&&ut("scroll",s);break;case"onScrollEnd":f!=null&&ut("scrollend",s);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"multiple":s.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":s.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){s.removeAttribute("xlink:href");break}c=$o(""+f),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""+f):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":f===!0?s.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(c,f):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?s.setAttribute(c,f):s.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?s.removeAttribute(c):s.setAttribute(c,f);break;case"popover":ut("beforetoggle",s),ut("toggle",s),Uo(s,"popover",f);break;case"xlinkActuate":cn(s,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":cn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":cn(s,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":cn(s,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":cn(s,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":cn(s,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":cn(s,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":cn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":cn(s,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Uo(s,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=wd.get(c)||c,Uo(s,c,f))}}function ag(s,a,c,f,b,w){switch(c){case"style":Ac(s,f,w);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"children":typeof f=="string"?ar(s,f):(typeof f=="number"||typeof f=="bigint")&&ar(s,""+f);break;case"onScroll":f!=null&&ut("scroll",s);break;case"onScrollEnd":f!=null&&ut("scrollend",s);break;case"onClick":f!=null&&(s.onclick=Yr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!vc.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),a=c.slice(2,b?c.length-7:void 0),w=s[jn]||null,w=w!=null?w[c]:null,typeof w=="function"&&s.removeEventListener(a,w,b),typeof f=="function")){typeof w!="function"&&w!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,f,b);break e}c in s?s[c]=f:f===!0?s.setAttribute(c,""):Uo(s,c,f)}}}function Bn(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ut("error",s),ut("load",s);var f=!1,b=!1,w;for(w in c)if(c.hasOwnProperty(w)){var P=c[w];if(P!=null)switch(w){case"src":f=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Mt(s,a,w,P,c,null)}}b&&Mt(s,a,"srcSet",c.srcSet,c,null),f&&Mt(s,a,"src",c.src,c,null);return;case"input":ut("invalid",s);var Q=w=P=b=null,re=null,_e=null;for(f in c)if(c.hasOwnProperty(f)){var Te=c[f];if(Te!=null)switch(f){case"name":b=Te;break;case"type":P=Te;break;case"checked":re=Te;break;case"defaultChecked":_e=Te;break;case"value":w=Te;break;case"defaultValue":Q=Te;break;case"children":case"dangerouslySetInnerHTML":if(Te!=null)throw Error(r(137,a));break;default:Mt(s,a,f,Te,c,null)}}bd(s,w,Q,re,_e,P,b,!1);return;case"select":ut("invalid",s),f=P=w=null;for(b in c)if(c.hasOwnProperty(b)&&(Q=c[b],Q!=null))switch(b){case"value":w=Q;break;case"defaultValue":P=Q;break;case"multiple":f=Q;default:Mt(s,a,b,Q,c,null)}a=w,c=P,s.multiple=!!f,a!=null?ji(s,!!f,a,!1):c!=null&&ji(s,!!f,c,!0);return;case"textarea":ut("invalid",s),w=b=f=null;for(P in c)if(c.hasOwnProperty(P)&&(Q=c[P],Q!=null))switch(P){case"value":f=Q;break;case"defaultValue":b=Q;break;case"children":w=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(r(91));break;default:Mt(s,a,P,Q,c,null)}Ri(s,f,b,w);return;case"option":for(re in c)c.hasOwnProperty(re)&&(f=c[re],f!=null)&&(re==="selected"?s.selected=f&&typeof f!="function"&&typeof f!="symbol":Mt(s,a,re,f,c,null));return;case"dialog":ut("beforetoggle",s),ut("toggle",s),ut("cancel",s),ut("close",s);break;case"iframe":case"object":ut("load",s);break;case"video":case"audio":for(f=0;f<ou.length;f++)ut(ou[f],s);break;case"image":ut("error",s),ut("load",s);break;case"details":ut("toggle",s);break;case"embed":case"source":case"link":ut("error",s),ut("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(_e in c)if(c.hasOwnProperty(_e)&&(f=c[_e],f!=null))switch(_e){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Mt(s,a,_e,f,c,null)}return;default:if(Vo(a)){for(Te in c)c.hasOwnProperty(Te)&&(f=c[Te],f!==void 0&&ag(s,a,Te,f,c,void 0));return}}for(Q in c)c.hasOwnProperty(Q)&&(f=c[Q],f!=null&&Mt(s,a,Q,f,c,null))}function f5(s,a,c,f){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,w=null,P=null,Q=null,re=null,_e=null,Te=null;for(we in c){var De=c[we];if(c.hasOwnProperty(we)&&De!=null)switch(we){case"checked":break;case"value":break;case"defaultValue":re=De;default:f.hasOwnProperty(we)||Mt(s,a,we,null,f,De)}}for(var be in f){var we=f[be];if(De=c[be],f.hasOwnProperty(be)&&(we!=null||De!=null))switch(be){case"type":w=we;break;case"name":b=we;break;case"checked":_e=we;break;case"defaultChecked":Te=we;break;case"value":P=we;break;case"defaultValue":Q=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(r(137,a));break;default:we!==De&&Mt(s,a,be,we,f,De)}}Fo(s,P,Q,re,_e,Te,w,b);return;case"select":we=P=Q=be=null;for(w in c)if(re=c[w],c.hasOwnProperty(w)&&re!=null)switch(w){case"value":break;case"multiple":we=re;default:f.hasOwnProperty(w)||Mt(s,a,w,null,f,re)}for(b in f)if(w=f[b],re=c[b],f.hasOwnProperty(b)&&(w!=null||re!=null))switch(b){case"value":be=w;break;case"defaultValue":Q=w;break;case"multiple":P=w;default:w!==re&&Mt(s,a,b,w,f,re)}a=Q,c=P,f=we,be!=null?ji(s,!!c,be,!1):!!f!=!!c&&(a!=null?ji(s,!!c,a,!0):ji(s,!!c,c?[]:"",!1));return;case"textarea":we=be=null;for(Q in c)if(b=c[Q],c.hasOwnProperty(Q)&&b!=null&&!f.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:Mt(s,a,Q,null,f,b)}for(P in f)if(b=f[P],w=c[P],f.hasOwnProperty(P)&&(b!=null||w!=null))switch(P){case"value":be=b;break;case"defaultValue":we=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(r(91));break;default:b!==w&&Mt(s,a,P,b,f,w)}vd(s,be,we);return;case"option":for(var $e in c)be=c[$e],c.hasOwnProperty($e)&&be!=null&&!f.hasOwnProperty($e)&&($e==="selected"?s.selected=!1:Mt(s,a,$e,null,f,be));for(re in f)be=f[re],we=c[re],f.hasOwnProperty(re)&&be!==we&&(be!=null||we!=null)&&(re==="selected"?s.selected=be&&typeof be!="function"&&typeof be!="symbol":Mt(s,a,re,be,f,we));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ke in c)be=c[Ke],c.hasOwnProperty(Ke)&&be!=null&&!f.hasOwnProperty(Ke)&&Mt(s,a,Ke,null,f,be);for(_e in f)if(be=f[_e],we=c[_e],f.hasOwnProperty(_e)&&be!==we&&(be!=null||we!=null))switch(_e){case"children":case"dangerouslySetInnerHTML":if(be!=null)throw Error(r(137,a));break;default:Mt(s,a,_e,be,f,we)}return;default:if(Vo(a)){for(var Nt in c)be=c[Nt],c.hasOwnProperty(Nt)&&be!==void 0&&!f.hasOwnProperty(Nt)&&ag(s,a,Nt,void 0,f,be);for(Te in f)be=f[Te],we=c[Te],!f.hasOwnProperty(Te)||be===we||be===void 0&&we===void 0||ag(s,a,Te,be,f,we);return}}for(var de in c)be=c[de],c.hasOwnProperty(de)&&be!=null&&!f.hasOwnProperty(de)&&Mt(s,a,de,null,f,be);for(De in f)be=f[De],we=c[De],!f.hasOwnProperty(De)||be===we||be==null&&we==null||Mt(s,a,De,be,f,we)}function Kv(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function m5(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var b=c[f],w=b.transferSize,P=b.initiatorType,Q=b.duration;if(w&&Q&&Kv(P)){for(P=0,Q=b.responseEnd,f+=1;f<c.length;f++){var re=c[f],_e=re.startTime;if(_e>Q)break;var Te=re.transferSize,De=re.initiatorType;Te&&Kv(De)&&(re=re.responseEnd,P+=Te*(re<Q?1:(Q-_e)/(re-_e)))}if(--f,a+=8*(w+P)/(b.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var og=null,lg=null;function Sh(s){return s.nodeType===9?s:s.ownerDocument}function Yv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Xv(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function cg(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var ug=null;function p5(){var s=window.event;return s&&s.type==="popstate"?s===ug?!1:(ug=s,!0):(ug=null,!1)}var Zv=typeof setTimeout=="function"?setTimeout:void 0,g5=typeof clearTimeout=="function"?clearTimeout:void 0,Jv=typeof Promise=="function"?Promise:void 0,y5=typeof queueMicrotask=="function"?queueMicrotask:typeof Jv<"u"?function(s){return Jv.resolve(null).then(s).catch(_5)}:Zv;function _5(s){setTimeout(function(){throw s})}function Zi(s){return s==="head"}function ex(s,a){var c=a,f=0;do{var b=c.nextSibling;if(s.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(f===0){s.removeChild(b),Sl(a);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")cu(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,cu(c);for(var w=c.firstChild;w;){var P=w.nextSibling,Q=w.nodeName;w[vs]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&w.rel.toLowerCase()==="stylesheet"||c.removeChild(w),w=P}}else c==="body"&&cu(s.ownerDocument.body);c=b}while(c);Sl(a)}function tx(s,a){var c=s;s=0;do{var f=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=f}while(c)}function dg(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":dg(c),Lo(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function b5(s,a,c,f){for(;s.nodeType===1;){var b=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!f&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(f){if(!s[vs])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(w=s.getAttribute("rel"),w==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(w!==b.rel||s.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||s.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||s.getAttribute("title")!==(b.title==null?null:b.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(w=s.getAttribute("src"),(w!==(b.src==null?null:b.src)||s.getAttribute("type")!==(b.type==null?null:b.type)||s.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&w&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var w=b.name==null?null:""+b.name;if(b.type==="hidden"&&s.getAttribute("name")===w)return s}else return s;if(s=Lr(s.nextSibling),s===null)break}return null}function v5(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=Lr(s.nextSibling),s===null))return null;return s}function nx(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=Lr(s.nextSibling),s===null))return null;return s}function hg(s){return s.data==="$?"||s.data==="$~"}function fg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function x5(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var f=function(){a(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),s._reactRetry=f}}function Lr(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var mg=null;function rx(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return Lr(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function sx(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function ix(s,a,c){switch(a=Sh(c),s){case"html":if(s=a.documentElement,!s)throw Error(r(452));return s;case"head":if(s=a.head,!s)throw Error(r(453));return s;case"body":if(s=a.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function cu(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);Lo(s)}var Ur=new Map,ax=new Set;function Eh(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var ui=q.d;q.d={f:w5,r:S5,D:E5,C:C5,L:T5,m:A5,X:R5,S:j5,M:D5};function w5(){var s=ui.f(),a=ph();return s||a}function S5(s){var a=Rr(s);a!==null&&a.tag===5&&a.type==="form"?Sb(a):ui.r(s)}var vl=typeof document>"u"?null:document;function ox(s,a,c){var f=vl;if(f&&typeof a=="string"&&a){var b=ir(a);b='link[rel="'+s+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),ax.has(b)||(ax.add(b),s={rel:s,crossOrigin:c,href:a},f.querySelector(b)===null&&(a=f.createElement("link"),Bn(a,"link",s),ln(a),f.head.appendChild(a)))}}function E5(s){ui.D(s),ox("dns-prefetch",s,null)}function C5(s,a){ui.C(s,a),ox("preconnect",s,a)}function T5(s,a,c){ui.L(s,a,c);var f=vl;if(f&&s&&a){var b='link[rel="preload"][as="'+ir(a)+'"]';a==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+ir(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+ir(c.imageSizes)+'"]')):b+='[href="'+ir(s)+'"]';var w=b;switch(a){case"style":w=xl(s);break;case"script":w=wl(s)}Ur.has(w)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),Ur.set(w,s),f.querySelector(b)!==null||a==="style"&&f.querySelector(uu(w))||a==="script"&&f.querySelector(du(w))||(a=f.createElement("link"),Bn(a,"link",s),ln(a),f.head.appendChild(a)))}}function A5(s,a){ui.m(s,a);var c=vl;if(c&&s){var f=a&&typeof a.as=="string"?a.as:"script",b='link[rel="modulepreload"][as="'+ir(f)+'"][href="'+ir(s)+'"]',w=b;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=wl(s)}if(!Ur.has(w)&&(s=g({rel:"modulepreload",href:s},a),Ur.set(w,s),c.querySelector(b)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(du(w)))return}f=c.createElement("link"),Bn(f,"link",s),ln(f),c.head.appendChild(f)}}}function j5(s,a,c){ui.S(s,a,c);var f=vl;if(f&&s){var b=ws(f).hoistableStyles,w=xl(s);a=a||"default";var P=b.get(w);if(!P){var Q={loading:0,preload:null};if(P=f.querySelector(uu(w)))Q.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=Ur.get(w))&&pg(s,c);var re=P=f.createElement("link");ln(re),Bn(re,"link",s),re._p=new Promise(function(_e,Te){re.onload=_e,re.onerror=Te}),re.addEventListener("load",function(){Q.loading|=1}),re.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,Ch(P,a,f)}P={type:"stylesheet",instance:P,count:1,state:Q},b.set(w,P)}}}function R5(s,a){ui.X(s,a);var c=vl;if(c&&s){var f=ws(c).hoistableScripts,b=wl(s),w=f.get(b);w||(w=c.querySelector(du(b)),w||(s=g({src:s,async:!0},a),(a=Ur.get(b))&&gg(s,a),w=c.createElement("script"),ln(w),Bn(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(b,w))}}function D5(s,a){ui.M(s,a);var c=vl;if(c&&s){var f=ws(c).hoistableScripts,b=wl(s),w=f.get(b);w||(w=c.querySelector(du(b)),w||(s=g({src:s,async:!0,type:"module"},a),(a=Ur.get(b))&&gg(s,a),w=c.createElement("script"),ln(w),Bn(w,"link",s),c.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(b,w))}}function lx(s,a,c,f){var b=(b=fe.current)?Eh(b):null;if(!b)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=xl(c.href),c=ws(b).hoistableStyles,f=c.get(a),f||(f={type:"style",instance:null,count:0,state:null},c.set(a,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=xl(c.href);var w=ws(b).hoistableStyles,P=w.get(s);if(P||(b=b.ownerDocument||b,P={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(s,P),(w=b.querySelector(uu(s)))&&!w._p&&(P.instance=w,P.state.loading=5),Ur.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Ur.set(s,c),w||I5(b,s,c,P.state))),a&&f===null)throw Error(r(528,""));return P}if(a&&f!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=wl(c),c=ws(b).hoistableScripts,f=c.get(a),f||(f={type:"script",instance:null,count:0,state:null},c.set(a,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function xl(s){return'href="'+ir(s)+'"'}function uu(s){return'link[rel="stylesheet"]['+s+"]"}function cx(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function I5(s,a,c,f){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?f.loading=1:(a=s.createElement("link"),f.preload=a,a.addEventListener("load",function(){return f.loading|=1}),a.addEventListener("error",function(){return f.loading|=2}),Bn(a,"link",c),ln(a),s.head.appendChild(a))}function wl(s){return'[src="'+ir(s)+'"]'}function du(s){return"script[async]"+s}function ux(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var f=s.querySelector('style[data-href~="'+ir(c.href)+'"]');if(f)return a.instance=f,ln(f),f;var b=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(s.ownerDocument||s).createElement("style"),ln(f),Bn(f,"style",b),Ch(f,c.precedence,s),a.instance=f;case"stylesheet":b=xl(c.href);var w=s.querySelector(uu(b));if(w)return a.state.loading|=4,a.instance=w,ln(w),w;f=cx(c),(b=Ur.get(b))&&pg(f,b),w=(s.ownerDocument||s).createElement("link"),ln(w);var P=w;return P._p=new Promise(function(Q,re){P.onload=Q,P.onerror=re}),Bn(w,"link",f),a.state.loading|=4,Ch(w,c.precedence,s),a.instance=w;case"script":return w=wl(c.src),(b=s.querySelector(du(w)))?(a.instance=b,ln(b),b):(f=c,(b=Ur.get(w))&&(f=g({},c),gg(f,b)),s=s.ownerDocument||s,b=s.createElement("script"),ln(b),Bn(b,"link",f),s.head.appendChild(b),a.instance=b);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(f=a.instance,a.state.loading|=4,Ch(f,c.precedence,s));return a.instance}function Ch(s,a,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=f.length?f[f.length-1]:null,w=b,P=0;P<f.length;P++){var Q=f[P];if(Q.dataset.precedence===a)w=Q;else if(w!==b)break}w?w.parentNode.insertBefore(s,w.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function pg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function gg(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var Th=null;function dx(s,a,c){if(Th===null){var f=new Map,b=Th=new Map;b.set(c,f)}else b=Th,f=b.get(c),f||(f=new Map,b.set(c,f));if(f.has(s))return f;for(f.set(s,null),c=c.getElementsByTagName(s),b=0;b<c.length;b++){var w=c[b];if(!(w[vs]||w[on]||s==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var P=w.getAttribute(a)||"";P=s+P;var Q=f.get(P);Q?Q.push(w):f.set(P,[w])}}return f}function hx(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function k5(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function fx(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function O5(s,a,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=xl(f.href),w=a.querySelector(uu(b));if(w){a=w._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=Ah.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=w,ln(w);return}w=a.ownerDocument||a,f=cx(f),(b=Ur.get(b))&&pg(f,b),w=w.createElement("link"),ln(w);var P=w;P._p=new Promise(function(Q,re){P.onload=Q,P.onerror=re}),Bn(w,"link",f),c.instance=w}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=Ah.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var yg=0;function M5(s,a){return s.stylesheets&&s.count===0&&Rh(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var f=setTimeout(function(){if(s.stylesheets&&Rh(s,s.stylesheets),s.unsuspend){var w=s.unsuspend;s.unsuspend=null,w()}},6e4+a);0<s.imgBytes&&yg===0&&(yg=62500*m5());var b=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Rh(s,s.stylesheets),s.unsuspend)){var w=s.unsuspend;s.unsuspend=null,w()}},(s.imgBytes>yg?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(f),clearTimeout(b)}}:null}function Ah(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Rh(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var jh=null;function Rh(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,jh=new Map,a.forEach(N5,s),jh=null,Ah.call(s))}function N5(s,a){if(!(a.state.loading&4)){var c=jh.get(s);if(c)var f=c.get(null);else{c=new Map,jh.set(s,c);for(var b=s.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<b.length;w++){var P=b[w];(P.nodeName==="LINK"||P.getAttribute("media")!=="not all")&&(c.set(P.dataset.precedence,P),f=P)}f&&c.set(null,f)}b=a.instance,P=b.getAttribute("data-precedence"),w=c.get(P)||f,w===f&&c.set(null,b),c.set(P,b),this.count++,f=Ah.bind(this),b.addEventListener("load",f),b.addEventListener("error",f),w?w.parentNode.insertBefore(b,w.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(b,s.firstChild)),a.state.loading|=4}}var hu={$$typeof:A,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function P5(s,a,c,f,b,w,P,Q,re){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_s(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_s(0),this.hiddenUpdates=_s(null),this.identifierPrefix=f,this.onUncaughtError=b,this.onCaughtError=w,this.onRecoverableError=P,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=re,this.incompleteTransitions=new Map}function mx(s,a,c,f,b,w,P,Q,re,_e,Te,De){return s=new P5(s,a,c,P,re,_e,Te,De,Q),a=1,w===!0&&(a|=24),w=br(3,null,null,a),s.current=w,w.stateNode=s,a=Ym(),a.refCount++,s.pooledCache=a,a.refCount++,w.memoizedState={element:f,isDehydrated:c,cache:a},ep(w),s}function px(s){return s?(s=Jo,s):Jo}function gx(s,a,c,f,b,w){b=px(b),f.context===null?f.context=b:f.pendingContext=b,f=Fi(a),f.payload={element:c},w=w===void 0?null:w,w!==null&&(f.callback=w),c=Vi(s,f,a),c!==null&&(dr(c,s,a),qc(c,s,a))}function yx(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function _g(s,a){yx(s,a),(s=s.alternate)&&yx(s,a)}function _x(s){if(s.tag===13||s.tag===31){var a=Za(s,67108864);a!==null&&dr(a,s,67108864),_g(s,67108864)}}function bx(s){if(s.tag===13||s.tag===31){var a=Er();a=Ua(a);var c=Za(s,a);c!==null&&dr(c,s,a),_g(s,a)}}var Dh=!0;function z5(s,a,c,f){var b=W.T;W.T=null;var w=q.p;try{q.p=2,bg(s,a,c,f)}finally{q.p=w,W.T=b}}function B5(s,a,c,f){var b=W.T;W.T=null;var w=q.p;try{q.p=8,bg(s,a,c,f)}finally{q.p=w,W.T=b}}function bg(s,a,c,f){if(Dh){var b=vg(f);if(b===null)ig(s,a,f,Ih,c),xx(s,f);else if(U5(b,s,a,c,f))f.stopPropagation();else if(xx(s,f),a&4&&-1<L5.indexOf(s)){for(;b!==null;){var w=Rr(b);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var P=er(w.pendingLanes);if(P!==0){var Q=w;for(Q.pendingLanes|=2,Q.entangledLanes|=2;P;){var re=1<<31-Et(P);Q.entanglements[1]|=re,P&=~re}Ns(w),(Tt&6)===0&&(fh=ze()+500,au(0))}}break;case 31:case 13:Q=Za(w,2),Q!==null&&dr(Q,w,2),ph(),_g(w,2)}if(w=vg(f),w===null&&ig(s,a,f,Ih,c),w===b)break;b=w}b!==null&&f.stopPropagation()}else ig(s,a,f,null,c)}}function vg(s){return s=Dr(s),xg(s)}var Ih=null;function xg(s){if(Ih=null,s=xs(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=l(a),s!==null)return s;s=null}else if(c===31){if(s=d(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return Ih=s,null}function vx(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ne()){case Ge:return 2;case xt:return 8;case st:case Gn:return 32;case ms:return 268435456;default:return 32}default:return 32}}var wg=!1,Ji=null,ea=null,ta=null,fu=new Map,mu=new Map,na=[],L5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function xx(s,a){switch(s){case"focusin":case"focusout":Ji=null;break;case"dragenter":case"dragleave":ea=null;break;case"mouseover":case"mouseout":ta=null;break;case"pointerover":case"pointerout":fu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":mu.delete(a.pointerId)}}function pu(s,a,c,f,b,w){return s===null||s.nativeEvent!==w?(s={blockedOn:a,domEventName:c,eventSystemFlags:f,nativeEvent:w,targetContainers:[b]},a!==null&&(a=Rr(a),a!==null&&_x(a)),s):(s.eventSystemFlags|=f,a=s.targetContainers,b!==null&&a.indexOf(b)===-1&&a.push(b),s)}function U5(s,a,c,f,b){switch(a){case"focusin":return Ji=pu(Ji,s,a,c,f,b),!0;case"dragenter":return ea=pu(ea,s,a,c,f,b),!0;case"mouseover":return ta=pu(ta,s,a,c,f,b),!0;case"pointerover":var w=b.pointerId;return fu.set(w,pu(fu.get(w)||null,s,a,c,f,b)),!0;case"gotpointercapture":return w=b.pointerId,mu.set(w,pu(mu.get(w)||null,s,a,c,f,b)),!0}return!1}function wx(s){var a=xs(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){s.blockedOn=a,Wr(s.priority,function(){bx(c)});return}}else if(a===31){if(a=d(c),a!==null){s.blockedOn=a,Wr(s.priority,function(){bx(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function kh(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=vg(s.nativeEvent);if(c===null){c=s.nativeEvent;var f=new c.constructor(c.type,c);jc=f,c.target.dispatchEvent(f),jc=null}else return a=Rr(c),a!==null&&_x(a),s.blockedOn=c,!1;a.shift()}return!0}function Sx(s,a,c){kh(s)&&c.delete(a)}function F5(){wg=!1,Ji!==null&&kh(Ji)&&(Ji=null),ea!==null&&kh(ea)&&(ea=null),ta!==null&&kh(ta)&&(ta=null),fu.forEach(Sx),mu.forEach(Sx)}function Oh(s,a){s.blockedOn===a&&(s.blockedOn=null,wg||(wg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,F5)))}var Mh=null;function Ex(s){Mh!==s&&(Mh=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Mh===s&&(Mh=null);for(var a=0;a<s.length;a+=3){var c=s[a],f=s[a+1],b=s[a+2];if(typeof f!="function"){if(xg(f||c)===null)continue;break}var w=Rr(c);w!==null&&(s.splice(a,3),a-=3,vp(w,{pending:!0,data:b,method:c.method,action:f},f,b))}}))}function Sl(s){function a(re){return Oh(re,s)}Ji!==null&&Oh(Ji,s),ea!==null&&Oh(ea,s),ta!==null&&Oh(ta,s),fu.forEach(a),mu.forEach(a);for(var c=0;c<na.length;c++){var f=na[c];f.blockedOn===s&&(f.blockedOn=null)}for(;0<na.length&&(c=na[0],c.blockedOn===null);)wx(c),c.blockedOn===null&&na.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var b=c[f],w=c[f+1],P=b[jn]||null;if(typeof w=="function")P||Ex(c);else if(P){var Q=null;if(w&&w.hasAttribute("formAction")){if(b=w,P=w[jn]||null)Q=P.formAction;else if(xg(b)!==null)continue}else Q=P.action;typeof Q=="function"?c[f+1]=Q:(c.splice(f,3),f-=3),Ex(c)}}}function Cx(){function s(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(P){return b=P})},focusReset:"manual",scroll:"manual"})}function a(){b!==null&&(b(),b=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,b=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),b!==null&&(b(),b=null)}}}function Sg(s){this._internalRoot=s}Nh.prototype.render=Sg.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,f=Er();gx(c,f,s,a,null,null)},Nh.prototype.unmount=Sg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;gx(s.current,2,null,s,null,null),ph(),a[bs]=null}};function Nh(s){this._internalRoot=s}Nh.prototype.unstable_scheduleHydration=function(s){if(s){var a=pd();s={blockedOn:null,target:s,priority:a};for(var c=0;c<na.length&&a!==0&&a<na[c].priority;c++);na.splice(c,0,s),c===0&&wx(s)}};var Tx=e.version;if(Tx!=="19.2.3")throw Error(r(527,Tx,"19.2.3"));q.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=m(a),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var V5={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:W,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ph=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ph.isDisabled&&Ph.supportsFiber)try{bt=Ph.inject(V5),Zt=Ph}catch{}}return yu.createRoot=function(s,a){if(!i(s))throw Error(r(299));var c=!1,f="",b=Ob,w=Mb,P=Nb;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onUncaughtError!==void 0&&(b=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(P=a.onRecoverableError)),a=mx(s,1,!1,null,null,c,f,null,b,w,P,Cx),s[bs]=a.current,sg(s),new Sg(a)},yu.hydrateRoot=function(s,a,c){if(!i(s))throw Error(r(299));var f=!1,b="",w=Ob,P=Mb,Q=Nb,re=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(w=c.onUncaughtError),c.onCaughtError!==void 0&&(P=c.onCaughtError),c.onRecoverableError!==void 0&&(Q=c.onRecoverableError),c.formState!==void 0&&(re=c.formState)),a=mx(s,1,!0,a,c??null,f,b,re,w,P,Q,Cx),a.context=px(null),c=a.current,f=Er(),f=Ua(f),b=Fi(f),b.callback=null,Vi(c,b,f),c=f,a.current.lanes=c,Ba(a,c),Ns(a),s[bs]=a.current,sg(s),new Nh(a)},yu.version="19.2.3",yu}var Px;function J5(){if(Px)return Tg.exports;Px=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Tg.exports=Z5(),Tg.exports}var e2=J5();var zx="popstate";function t2(t={}){function e(r,i){let{pathname:o,search:l,hash:d}=r.location;return Jg("",{pathname:o,search:l,hash:d},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:Iu(i)}return r2(e,n,null,t)}function Yt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Tr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function n2(){return Math.random().toString(36).substring(2,10)}function Bx(t,e){return{usr:t.state,key:t.key,idx:e}}function Jg(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Zl(e):e,state:n,key:e&&e.key||r||n2()}}function Iu({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Zl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function r2(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,l=i.history,d="POP",h=null,m=p();m==null&&(m=0,l.replaceState({...l.state,idx:m},""));function p(){return(l.state||{idx:null}).idx}function g(){d="POP";let S=p(),C=S==null?null:S-m;m=S,h&&h({action:d,location:x.location,delta:C})}function v(S,C){d="PUSH";let T=Jg(x.location,S,C);m=p()+1;let A=Bx(T,m),L=x.createHref(T);try{l.pushState(A,"",L)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;i.location.assign(L)}o&&h&&h({action:d,location:x.location,delta:1})}function _(S,C){d="REPLACE";let T=Jg(x.location,S,C);m=p();let A=Bx(T,m),L=x.createHref(T);l.replaceState(A,"",L),o&&h&&h({action:d,location:x.location,delta:0})}function E(S){return s2(S)}let x={get action(){return d},get location(){return t(i,l)},listen(S){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(zx,g),h=S,()=>{i.removeEventListener(zx,g),h=null}},createHref(S){return e(i,S)},createURL:E,encodeLocation(S){let C=E(S);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:v,replace:_,go(S){return l.go(S)}};return x}function s2(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Yt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Iu(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function lS(t,e,n="/"){return i2(t,e,n,!1)}function i2(t,e,n,r){let i=typeof e=="string"?Zl(e):e,o=gi(i.pathname||"/",n);if(o==null)return null;let l=cS(t);a2(l);let d=null;for(let h=0;d==null&&h<l.length;++h){let m=y2(o);d=p2(l[h],m,r)}return d}function cS(t,e=[],n=[],r="",i=!1){let o=(l,d,h=i,m)=>{let p={relativePath:m===void 0?l.path||"":m,caseSensitive:l.caseSensitive===!0,childrenIndex:d,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;Yt(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=mi([r,p.relativePath]),v=n.concat(p);l.children&&l.children.length>0&&(Yt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),cS(l.children,e,v,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:f2(g,l.index),routesMeta:v})};return t.forEach((l,d)=>{if(l.path===""||!l.path?.includes("?"))o(l,d);else for(let h of uS(l.path))o(l,d,!0,h)}),e}function uS(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let l=uS(r.join("/")),d=[];return d.push(...l.map(h=>h===""?o:[o,h].join("/"))),i&&d.push(...l),d.map(h=>t.startsWith("/")&&h===""?"/":h)}function a2(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:m2(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var o2=/^:[\w-]+$/,l2=3,c2=2,u2=1,d2=10,h2=-2,Lx=t=>t==="*";function f2(t,e){let n=t.split("/"),r=n.length;return n.some(Lx)&&(r+=h2),e&&(r+=c2),n.filter(i=>!Lx(i)).reduce((i,o)=>i+(o2.test(o)?l2:o===""?u2:d2),r)}function m2(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function p2(t,e,n=!1){let{routesMeta:r}=t,i={},o="/",l=[];for(let d=0;d<r.length;++d){let h=r[d],m=d===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=of({path:h.relativePath,caseSensitive:h.caseSensitive,end:m},p),v=h.route;if(!g&&m&&n&&!r[r.length-1].route.index&&(g=of({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(i,g.params),l.push({params:i,pathname:mi([o,g.pathname]),pathnameBase:x2(mi([o,g.pathnameBase])),route:v}),g.pathnameBase!=="/"&&(o=mi([o,g.pathnameBase]))}return l}function of(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=g2(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],l=o.replace(/(.)\/+$/,"$1"),d=i.slice(1);return{params:r.reduce((m,{paramName:p,isOptional:g},v)=>{if(p==="*"){let E=d[v]||"";l=o.slice(0,o.length-E.length).replace(/(.)\/+$/,"$1")}const _=d[v];return g&&!_?m[p]=void 0:m[p]=(_||"").replace(/%2F/g,"/"),m},{}),pathname:o,pathnameBase:l,pattern:t}}function g2(t,e=!1,n=!0){Tr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,d,h)=>(r.push({paramName:d,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function y2(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Tr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function gi(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var dS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_2=t=>dS.test(t);function b2(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?Zl(t):t,o;if(n)if(_2(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),Tr(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${n}`)}n.startsWith("/")?o=Ux(n.substring(1),"/"):o=Ux(n,e)}else o=e;return{pathname:o,search:w2(r),hash:S2(i)}}function Ux(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Dg(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function v2(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function By(t){let e=v2(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Ly(t,e,n,r=!1){let i;typeof t=="string"?i=Zl(t):(i={...t},Yt(!i.pathname||!i.pathname.includes("?"),Dg("?","pathname","search",i)),Yt(!i.pathname||!i.pathname.includes("#"),Dg("#","pathname","hash",i)),Yt(!i.search||!i.search.includes("#"),Dg("#","search","hash",i)));let o=t===""||i.pathname==="",l=o?"/":i.pathname,d;if(l==null)d=n;else{let g=e.length-1;if(!r&&l.startsWith("..")){let v=l.split("/");for(;v[0]==="..";)v.shift(),g-=1;i.pathname=v.join("/")}d=g>=0?e[g]:"/"}let h=b2(i,d),m=l&&l!=="/"&&l.endsWith("/"),p=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(m||p)&&(h.pathname+="/"),h}var mi=t=>t.join("/").replace(/\/\/+/g,"/"),x2=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),w2=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,S2=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,E2=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function C2(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function T2(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var hS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function fS(t,e){let n=t;if(typeof n!="string"||!dS.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(hS)try{let o=new URL(window.location.href),l=n.startsWith("//")?new URL(o.protocol+n):new URL(n),d=gi(l.pathname,e);l.origin===o.origin&&d!=null?n=d+l.search+l.hash:i=!0}catch{Tr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var mS=["POST","PUT","PATCH","DELETE"];new Set(mS);var A2=["GET",...mS];new Set(A2);var Jl=k.createContext(null);Jl.displayName="DataRouter";var Uf=k.createContext(null);Uf.displayName="DataRouterState";var j2=k.createContext(!1),pS=k.createContext({isTransitioning:!1});pS.displayName="ViewTransition";var R2=k.createContext(new Map);R2.displayName="Fetchers";var D2=k.createContext(null);D2.displayName="Await";var Ar=k.createContext(null);Ar.displayName="Navigation";var Wu=k.createContext(null);Wu.displayName="Location";var Hr=k.createContext({outlet:null,matches:[],isDataRoute:!1});Hr.displayName="Route";var Uy=k.createContext(null);Uy.displayName="RouteError";var gS="REACT_ROUTER_ERROR",I2="REDIRECT",k2="ROUTE_ERROR_RESPONSE";function O2(t){if(t.startsWith(`${gS}:${I2}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function M2(t){if(t.startsWith(`${gS}:${k2}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new E2(e.status,e.statusText,e.data)}catch{}}function N2(t,{relative:e}={}){Yt(ec(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=k.useContext(Ar),{hash:i,pathname:o,search:l}=Yu(t,{relative:e}),d=o;return n!=="/"&&(d=o==="/"?n:mi([n,o])),r.createHref({pathname:d,search:l,hash:i})}function ec(){return k.useContext(Wu)!=null}function On(){return Yt(ec(),"useLocation() may be used only in the context of a <Router> component."),k.useContext(Wu).location}var yS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function _S(t){k.useContext(Ar).static||k.useLayoutEffect(t)}function Ku(){let{isDataRoute:t}=k.useContext(Hr);return t?X2():P2()}function P2(){Yt(ec(),"useNavigate() may be used only in the context of a <Router> component.");let t=k.useContext(Jl),{basename:e,navigator:n}=k.useContext(Ar),{matches:r}=k.useContext(Hr),{pathname:i}=On(),o=JSON.stringify(By(r)),l=k.useRef(!1);return _S(()=>{l.current=!0}),k.useCallback((h,m={})=>{if(Tr(l.current,yS),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=Ly(h,JSON.parse(o),i,m.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:mi([e,p.pathname])),(m.replace?n.replace:n.push)(p,m.state,m)},[e,n,o,i,t])}var z2=k.createContext(null);function B2(t){let e=k.useContext(Hr).outlet;return k.useMemo(()=>e&&k.createElement(z2.Provider,{value:t},e),[e,t])}function L2(){let{matches:t}=k.useContext(Hr),e=t[t.length-1];return e?e.params:{}}function Yu(t,{relative:e}={}){let{matches:n}=k.useContext(Hr),{pathname:r}=On(),i=JSON.stringify(By(n));return k.useMemo(()=>Ly(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function U2(t,e){return bS(t,e)}function bS(t,e,n,r,i){Yt(ec(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=k.useContext(Ar),{matches:l}=k.useContext(Hr),d=l[l.length-1],h=d?d.params:{},m=d?d.pathname:"/",p=d?d.pathnameBase:"/",g=d&&d.route;{let T=g&&g.path||"";xS(m,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let v=On(),_;if(e){let T=typeof e=="string"?Zl(e):e;Yt(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),_=T}else _=v;let E=_.pathname||"/",x=E;if(p!=="/"){let T=p.replace(/^\//,"").split("/");x="/"+E.replace(/^\//,"").split("/").slice(T.length).join("/")}let S=lS(t,{pathname:x});Tr(g||S!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),Tr(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=H2(S&&S.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:mi([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:mi([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),l,n,r,i);return e&&C?k.createElement(Wu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},C):C}function F2(){let t=Y2(),e=C2(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=k.createElement(k.Fragment,null,k.createElement("p",null," Hey developer "),k.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",k.createElement("code",{style:o},"ErrorBoundary")," or"," ",k.createElement("code",{style:o},"errorElement")," prop on your route.")),k.createElement(k.Fragment,null,k.createElement("h2",null,"Unexpected Application Error!"),k.createElement("h3",{style:{fontStyle:"italic"}},e),n?k.createElement("pre",{style:i},n):null,l)}var V2=k.createElement(F2,null),vS=class extends k.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=M2(t.digest);n&&(t=n)}let e=t!==void 0?k.createElement(Hr.Provider,{value:this.props.routeContext},k.createElement(Uy.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?k.createElement($2,{error:t},e):e}};vS.contextType=j2;var Ig=new WeakMap;function $2({children:t,error:e}){let{basename:n}=k.useContext(Ar);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=O2(e.digest);if(r){let i=Ig.get(e);if(i)throw i;let o=fS(r.location,n);if(hS&&!Ig.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw Ig.set(e,l),l}return k.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function q2({routeContext:t,match:e,children:n}){let r=k.useContext(Jl);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),k.createElement(Hr.Provider,{value:t},n)}function H2(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=n?.errors;if(l!=null){let p=o.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Yt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let d=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:v,errors:_}=n,E=g.route.loader&&!v.hasOwnProperty(g.route.id)&&(!_||_[g.route.id]===void 0);if(g.route.lazy||E){d=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let m=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:T2(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,v)=>{let _,E=!1,x=null,S=null;n&&(_=l&&g.route.id?l[g.route.id]:void 0,x=g.route.errorElement||V2,d&&(h<0&&v===0?(xS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),E=!0,S=null):h===v&&(E=!0,S=g.route.hydrateFallbackElement||null)));let C=e.concat(o.slice(0,v+1)),T=()=>{let A;return _?A=x:E?A=S:g.route.Component?A=k.createElement(g.route.Component,null):g.route.element?A=g.route.element:A=p,k.createElement(q2,{match:g,routeContext:{outlet:p,matches:C,isDataRoute:n!=null},children:A})};return n&&(g.route.ErrorBoundary||g.route.errorElement||v===0)?k.createElement(vS,{location:n.location,revalidation:n.revalidation,component:x,error:_,children:T(),routeContext:{outlet:null,matches:C,isDataRoute:!0},onError:m}):T()},null)}function Fy(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function G2(t){let e=k.useContext(Jl);return Yt(e,Fy(t)),e}function Q2(t){let e=k.useContext(Uf);return Yt(e,Fy(t)),e}function W2(t){let e=k.useContext(Hr);return Yt(e,Fy(t)),e}function Vy(t){let e=W2(t),n=e.matches[e.matches.length-1];return Yt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function K2(){return Vy("useRouteId")}function Y2(){let t=k.useContext(Uy),e=Q2("useRouteError"),n=Vy("useRouteError");return t!==void 0?t:e.errors?.[n]}function X2(){let{router:t}=G2("useNavigate"),e=Vy("useNavigate"),n=k.useRef(!1);return _S(()=>{n.current=!0}),k.useCallback(async(i,o={})=>{Tr(n.current,yS),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...o}))},[t,e])}var Fx={};function xS(t,e,n){!e&&!Fx[t]&&(Fx[t]=!0,Tr(!1,n))}k.memo(Z2);function Z2({routes:t,future:e,state:n,onError:r}){return bS(t,void 0,n,r,e)}function Ff({to:t,replace:e,state:n,relative:r}){Yt(ec(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=k.useContext(Ar);Tr(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=k.useContext(Hr),{pathname:l}=On(),d=Ku(),h=Ly(t,By(o),l,r==="path"),m=JSON.stringify(h);return k.useEffect(()=>{d(JSON.parse(m),{replace:e,state:n,relative:r})},[d,m,r,e,n]),null}function Vf(t){return B2(t.context)}function xn(t){Yt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function J2({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:o=!1,unstable_useTransitions:l}){Yt(!ec(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=t.replace(/^\/*/,"/"),h=k.useMemo(()=>({basename:d,navigator:i,static:o,unstable_useTransitions:l,future:{}}),[d,i,o,l]);typeof n=="string"&&(n=Zl(n));let{pathname:m="/",search:p="",hash:g="",state:v=null,key:_="default"}=n,E=k.useMemo(()=>{let x=gi(m,d);return x==null?null:{location:{pathname:x,search:p,hash:g,state:v,key:_},navigationType:r}},[d,m,p,g,v,_,r]);return Tr(E!=null,`<Router basename="${d}"> is not able to match the URL "${m}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),E==null?null:k.createElement(Ar.Provider,{value:h},k.createElement(Wu.Provider,{children:e,value:E}))}function ej({children:t,location:e}){return U2(ey(t),e)}function ey(t,e=[]){let n=[];return k.Children.forEach(t,(r,i)=>{if(!k.isValidElement(r))return;let o=[...e,i];if(r.type===k.Fragment){n.push.apply(n,ey(r.props.children,o));return}Yt(r.type===xn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Yt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=ey(r.props.children,o)),n.push(l)}),n}var Wh="get",Kh="application/x-www-form-urlencoded";function $f(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function tj(t){return $f(t)&&t.tagName.toLowerCase()==="button"}function nj(t){return $f(t)&&t.tagName.toLowerCase()==="form"}function rj(t){return $f(t)&&t.tagName.toLowerCase()==="input"}function sj(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function ij(t,e){return t.button===0&&(!e||e==="_self")&&!sj(t)}function ty(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function aj(t,e){let n=ty(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(o=>{n.append(i,o)})}),n}var Bh=null;function oj(){if(Bh===null)try{new FormData(document.createElement("form"),0),Bh=!1}catch{Bh=!0}return Bh}var lj=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function kg(t){return t!=null&&!lj.has(t)?(Tr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Kh}"`),null):t}function cj(t,e){let n,r,i,o,l;if(nj(t)){let d=t.getAttribute("action");r=d?gi(d,e):null,n=t.getAttribute("method")||Wh,i=kg(t.getAttribute("enctype"))||Kh,o=new FormData(t)}else if(tj(t)||rj(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||d.getAttribute("action");if(r=h?gi(h,e):null,n=t.getAttribute("formmethod")||d.getAttribute("method")||Wh,i=kg(t.getAttribute("formenctype"))||kg(d.getAttribute("enctype"))||Kh,o=new FormData(d,t),!oj()){let{name:m,type:p,value:g}=t;if(p==="image"){let v=m?`${m}.`:"";o.append(`${v}x`,"0"),o.append(`${v}y`,"0")}else m&&o.append(m,g)}}else{if($f(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Wh,r=null,i=Kh,l=t}return o&&i==="text/plain"&&(l=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function $y(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function uj(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&gi(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function dj(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function hj(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function fj(t,e,n){let r=await Promise.all(t.map(async i=>{let o=e.routes[i.route.id];if(o){let l=await dj(o,n);return l.links?l.links():[]}return[]}));return yj(r.flat(1).filter(hj).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Vx(t,e,n,r,i,o){let l=(h,m)=>n[m]?h.route.id!==n[m].route.id:!0,d=(h,m)=>n[m].pathname!==h.pathname||n[m].route.path?.endsWith("*")&&n[m].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,m)=>l(h,m)||d(h,m)):o==="data"?e.filter((h,m)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,m)||d(h,m))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function mj(t,e,{includeHydrateFallback:n}={}){return pj(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function pj(t){return[...new Set(t)]}function gj(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function yj(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let o=JSON.stringify(gj(i));return n.has(o)||(n.add(o),r.push({key:o,link:i})),r},[])}function wS(){let t=k.useContext(Jl);return $y(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function _j(){let t=k.useContext(Uf);return $y(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var qy=k.createContext(void 0);qy.displayName="FrameworkContext";function SS(){let t=k.useContext(qy);return $y(t,"You must render this element inside a <HydratedRouter> element"),t}function bj(t,e){let n=k.useContext(qy),[r,i]=k.useState(!1),[o,l]=k.useState(!1),{onFocus:d,onBlur:h,onMouseEnter:m,onMouseLeave:p,onTouchStart:g}=e,v=k.useRef(null);k.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=C=>{C.forEach(T=>{l(T.isIntersecting)})},S=new IntersectionObserver(x,{threshold:.5});return v.current&&S.observe(v.current),()=>{S.disconnect()}}},[t]),k.useEffect(()=>{if(r){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[r]);let _=()=>{i(!0)},E=()=>{i(!1),l(!1)};return n?t!=="intent"?[o,v,{}]:[o,v,{onFocus:_u(d,_),onBlur:_u(h,E),onMouseEnter:_u(m,_),onMouseLeave:_u(p,E),onTouchStart:_u(g,_)}]:[!1,v,{}]}function _u(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function vj({page:t,...e}){let{router:n}=wS(),r=k.useMemo(()=>lS(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?k.createElement(wj,{page:t,matches:r,...e}):null}function xj(t){let{manifest:e,routeModules:n}=SS(),[r,i]=k.useState([]);return k.useEffect(()=>{let o=!1;return fj(t,e,n).then(l=>{o||i(l)}),()=>{o=!0}},[t,e,n]),r}function wj({page:t,matches:e,...n}){let r=On(),{manifest:i,routeModules:o}=SS(),{basename:l}=wS(),{loaderData:d,matches:h}=_j(),m=k.useMemo(()=>Vx(t,e,h,i,r,"data"),[t,e,h,i,r]),p=k.useMemo(()=>Vx(t,e,h,i,r,"assets"),[t,e,h,i,r]),g=k.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let E=new Set,x=!1;if(e.forEach(C=>{let T=i.routes[C.route.id];!T||!T.hasLoader||(!m.some(A=>A.route.id===C.route.id)&&C.route.id in d&&o[C.route.id]?.shouldRevalidate||T.hasClientLoader?x=!0:E.add(C.route.id))}),E.size===0)return[];let S=uj(t,l,"data");return x&&E.size>0&&S.searchParams.set("_routes",e.filter(C=>E.has(C.route.id)).map(C=>C.route.id).join(",")),[S.pathname+S.search]},[l,d,r,i,m,e,t,o]),v=k.useMemo(()=>mj(p,i),[p,i]),_=xj(p);return k.createElement(k.Fragment,null,g.map(E=>k.createElement("link",{key:E,rel:"prefetch",as:"fetch",href:E,...n})),v.map(E=>k.createElement("link",{key:E,rel:"modulepreload",href:E,...n})),_.map(({key:E,link:x})=>k.createElement("link",{key:E,nonce:n.nonce,...x})))}function Sj(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var Ej=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Ej&&(window.__reactRouterVersion="7.11.0")}catch{}function Cj({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=k.useRef();i.current==null&&(i.current=t2({window:r,v5Compat:!0}));let o=i.current,[l,d]=k.useState({action:o.action,location:o.location}),h=k.useCallback(m=>{n===!1?d(m):k.startTransition(()=>d(m))},[n]);return k.useLayoutEffect(()=>o.listen(h),[o,h]),k.createElement(J2,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:n})}var ES=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Cn=k.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:o,replace:l,state:d,target:h,to:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,..._},E){let{basename:x,unstable_useTransitions:S}=k.useContext(Ar),C=typeof m=="string"&&ES.test(m),T=fS(m,x);m=T.to;let A=N2(m,{relative:i}),[L,F,H]=bj(r,_),O=Rj(m,{replace:l,state:d,target:h,preventScrollReset:p,relative:i,viewTransition:g,unstable_defaultShouldRevalidate:v,unstable_useTransitions:S});function I(U){e&&e(U),U.defaultPrevented||O(U)}let N=k.createElement("a",{..._,...H,href:T.absoluteURL||A,onClick:T.isExternal||o?e:I,ref:Sj(E,F),target:h,"data-discover":!C&&n==="render"?"true":void 0});return L&&!C?k.createElement(k.Fragment,null,N,k.createElement(vj,{page:A})):N});Cn.displayName="Link";var Tj=k.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:o,to:l,viewTransition:d,children:h,...m},p){let g=Yu(l,{relative:m.relative}),v=On(),_=k.useContext(Uf),{navigator:E,basename:x}=k.useContext(Ar),S=_!=null&&Mj(g)&&d===!0,C=E.encodeLocation?E.encodeLocation(g).pathname:g.pathname,T=v.pathname,A=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;n||(T=T.toLowerCase(),A=A?A.toLowerCase():null,C=C.toLowerCase()),A&&x&&(A=gi(A,x)||A);const L=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let F=T===C||!i&&T.startsWith(C)&&T.charAt(L)==="/",H=A!=null&&(A===C||!i&&A.startsWith(C)&&A.charAt(C.length)==="/"),O={isActive:F,isPending:H,isTransitioning:S},I=F?e:void 0,N;typeof r=="function"?N=r(O):N=[r,F?"active":null,H?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let U=typeof o=="function"?o(O):o;return k.createElement(Cn,{...m,"aria-current":I,className:N,ref:p,style:U,to:l,viewTransition:d},typeof h=="function"?h(O):h)});Tj.displayName="NavLink";var Aj=k.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:o,method:l=Wh,action:d,onSubmit:h,relative:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v,..._},E)=>{let{unstable_useTransitions:x}=k.useContext(Ar),S=kj(),C=Oj(d,{relative:m}),T=l.toLowerCase()==="get"?"get":"post",A=typeof d=="string"&&ES.test(d),L=F=>{if(h&&h(F),F.defaultPrevented)return;F.preventDefault();let H=F.nativeEvent.submitter,O=H?.getAttribute("formmethod")||l,I=()=>S(H||F.currentTarget,{fetcherKey:e,method:O,navigate:n,replace:i,state:o,relative:m,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:v});x&&n!==!1?k.startTransition(()=>I()):I()};return k.createElement("form",{ref:E,method:T,action:C,onSubmit:r?h:L,..._,"data-discover":!A&&t==="render"?"true":void 0})});Aj.displayName="Form";function jj(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function CS(t){let e=k.useContext(Jl);return Yt(e,jj(t)),e}function Rj(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d,unstable_useTransitions:h}={}){let m=Ku(),p=On(),g=Yu(t,{relative:o});return k.useCallback(v=>{if(ij(v,e)){v.preventDefault();let _=n!==void 0?n:Iu(p)===Iu(g),E=()=>m(t,{replace:_,state:r,preventScrollReset:i,relative:o,viewTransition:l,unstable_defaultShouldRevalidate:d});h?k.startTransition(()=>E()):E()}},[p,m,g,n,r,e,t,i,o,l,d,h])}function TS(t){Tr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=k.useRef(ty(t)),n=k.useRef(!1),r=On(),i=k.useMemo(()=>aj(r.search,n.current?null:e.current),[r.search]),o=Ku(),l=k.useCallback((d,h)=>{const m=ty(typeof d=="function"?d(new URLSearchParams(i)):d);n.current=!0,o("?"+m,h)},[o,i]);return[i,l]}var Dj=0,Ij=()=>`__${String(++Dj)}__`;function kj(){let{router:t}=CS("useSubmit"),{basename:e}=k.useContext(Ar),n=K2(),r=t.fetch,i=t.navigate;return k.useCallback(async(o,l={})=>{let{action:d,method:h,encType:m,formData:p,body:g}=cj(o,e);if(l.navigate===!1){let v=l.fetcherKey||Ij();await r(v,n,l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||m,flushSync:l.flushSync})}else await i(l.action||d,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:p,body:g,formMethod:l.method||h,formEncType:l.encType||m,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[r,i,e,n])}function Oj(t,{relative:e}={}){let{basename:n}=k.useContext(Ar),r=k.useContext(Hr);Yt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...Yu(t||".",{relative:e})},l=On();if(t==null){o.search=l.search;let d=new URLSearchParams(o.search),h=d.getAll("index");if(h.some(p=>p==="")){d.delete("index"),h.filter(g=>g).forEach(g=>d.append("index",g));let p=d.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:mi([n,o.pathname])),Iu(o)}function Mj(t,{relative:e}={}){let n=k.useContext(pS);Yt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=CS("useViewTransitionState"),i=Yu(t,{relative:e});if(!n.isTransitioning)return!1;let o=gi(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=gi(n.nextLocation.pathname,r)||n.nextLocation.pathname;return of(i.pathname,l)!=null||of(i.pathname,o)!=null}var tc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Nj={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Pj=class{#e=Nj;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},go=new Pj;function zj(t){setTimeout(t,0)}var wo=typeof window>"u"||"Deno"in globalThis;function rr(){}function Bj(t,e){return typeof t=="function"?t(e):t}function ny(t){return typeof t=="number"&&t>=0&&t!==1/0}function AS(t,e){return Math.max(t+(e||0)-Date.now(),0)}function fa(t,e){return typeof t=="function"?t(e):t}function Fr(t,e){return typeof t=="function"?t(e):t}function $x(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:o,queryKey:l,stale:d}=t;if(l){if(r){if(e.queryHash!==Hy(l,e.options))return!1}else if(!ku(e.queryKey,l))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof d=="boolean"&&e.isStale()!==d||i&&i!==e.state.fetchStatus||o&&!o(e))}function qx(t,e){const{exact:n,status:r,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(So(e.options.mutationKey)!==So(o))return!1}else if(!ku(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function Hy(t,e){return(e?.queryKeyHashFn||So)(t)}function So(t){return JSON.stringify(t,(e,n)=>ry(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function ku(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>ku(t[n],e[n])):!1}var Lj=Object.prototype.hasOwnProperty;function jS(t,e){if(t===e)return t;const n=Hx(t)&&Hx(e);if(!n&&!(ry(t)&&ry(e)))return e;const i=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),l=o.length,d=n?new Array(l):{};let h=0;for(let m=0;m<l;m++){const p=n?m:o[m],g=t[p],v=e[p];if(g===v){d[p]=g,(n?m<i:Lj.call(t,p))&&h++;continue}if(g===null||v===null||typeof g!="object"||typeof v!="object"){d[p]=v;continue}const _=jS(g,v);d[p]=_,_===g&&h++}return i===l&&h===i?t:d}function lf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Hx(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function ry(t){if(!Gx(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Gx(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Gx(t){return Object.prototype.toString.call(t)==="[object Object]"}function Uj(t){return new Promise(e=>{go.setTimeout(e,t)})}function sy(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?jS(t,e):e}function Fj(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function Vj(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Gy=Symbol();function RS(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Gy?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function DS(t,e){return typeof t=="function"?t(...e):!!t}var $j=class extends tc{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!wo&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Qy=new $j;function iy(){let t,e;const n=new Promise((i,o)=>{t=i,e=o});n.status="pending",n.catch(()=>{});function r(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},n.reject=i=>{r({status:"rejected",reason:i}),e(i)},n}var qj=zj;function Hj(){let t=[],e=0,n=d=>{d()},r=d=>{d()},i=qj;const o=d=>{e?t.push(d):i(()=>{n(d)})},l=()=>{const d=t;t=[],d.length&&i(()=>{r(()=>{d.forEach(h=>{n(h)})})})};return{batch:d=>{let h;e++;try{h=d()}finally{e--,e||l()}return h},batchCalls:d=>(...h)=>{o(()=>{d(...h)})},schedule:o,setNotifyFunction:d=>{n=d},setBatchNotifyFunction:d=>{r=d},setScheduler:d=>{i=d}}}var En=Hj(),Gj=class extends tc{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!wo&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},cf=new Gj;function Qj(t){return Math.min(1e3*2**t,3e4)}function IS(t){return(t??"online")==="online"?cf.isOnline():!0}var ay=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function kS(t){let e=!1,n=0,r;const i=iy(),o=()=>i.status!=="pending",l=x=>{if(!o()){const S=new ay(x);v(S),t.onCancel?.(S)}},d=()=>{e=!0},h=()=>{e=!1},m=()=>Qy.isFocused()&&(t.networkMode==="always"||cf.isOnline())&&t.canRun(),p=()=>IS(t.networkMode)&&t.canRun(),g=x=>{o()||(r?.(),i.resolve(x))},v=x=>{o()||(r?.(),i.reject(x))},_=()=>new Promise(x=>{r=S=>{(o()||m())&&x(S)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),E=()=>{if(o())return;let x;const S=n===0?t.initialPromise:void 0;try{x=S??t.fn()}catch(C){x=Promise.reject(C)}Promise.resolve(x).then(g).catch(C=>{if(o())return;const T=t.retry??(wo?0:3),A=t.retryDelay??Qj,L=typeof A=="function"?A(n,C):A,F=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,C);if(e||!F){v(C);return}n++,t.onFail?.(n,C),Uj(L).then(()=>m()?void 0:_()).then(()=>{e?v(C):E()})})};return{promise:i,status:()=>i.status,cancel:l,continue:()=>(r?.(),i),cancelRetry:d,continueRetry:h,canStart:p,start:()=>(p()?E():_().then(E),i)}}var OS=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ny(this.gcTime)&&(this.#e=go.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(wo?1/0:300*1e3))}clearGcTimeout(){this.#e&&(go.clearTimeout(this.#e),this.#e=void 0)}},Wj=class extends OS{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=Wx(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=Wx(this.options);n.data!==void 0&&(this.setState(Qx(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=sy(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#i({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(rr).catch(rr):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Fr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Gy||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>fa(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!AS(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(m=>m.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,i=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=RS(this.options,n),p=(()=>{const g={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},d=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:o};return i(h),h})();this.options.behavior?.onFetch(d,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==d.fetchOptions?.meta)&&this.#i({type:"fetch",meta:d.fetchOptions?.meta}),this.#r=kS({initialPromise:n?.initialPromise,fn:d.fetchFn,onCancel:h=>{h instanceof ay&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,m)=>{this.#i({type:"failed",failureCount:h,error:m})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:d.options.retry,retryDelay:d.options.retryDelay,networkMode:d.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof ay){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#i({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#i(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...MS(r.data,this.options),fetchMeta:e.meta??null};case"success":const i={...r,...Qx(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),En.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function MS(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:IS(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Qx(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Wx(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Kj=class extends tc{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#o=iy(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Kx(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return oy(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return oy(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Fr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!lf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&Yx(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Fr(this.options.enabled,this.#t)!==Fr(e.enabled,this.#t)||fa(this.options.staleTime,this.#t)!==fa(e.staleTime,this.#t))&&this.#g();const i=this.#y();r&&(this.#t!==n||Fr(this.options.enabled,this.#t)!==Fr(e.enabled,this.#t)||i!==this.#l)&&this.#_(i)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return Xj(this,n)&&(this.#s=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(rr)),e}#g(){this.#v();const t=fa(this.options.staleTime,this.#t);if(wo||this.#s.isStale||!ny(t))return;const n=AS(this.#s.dataUpdatedAt,t)+1;this.#c=go.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!(wo||Fr(this.options.enabled,this.#t)===!1||!ny(this.#l)||this.#l===0)&&(this.#u=go.setInterval(()=>{(this.options.refetchIntervalInBackground||Qy.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(go.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(go.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,i=this.#s,o=this.#r,l=this.#a,h=t!==n?t.state:this.#n,{state:m}=t;let p={...m},g=!1,v;if(e._optimisticResults){const I=this.hasListeners(),N=!I&&Kx(t,e),U=I&&Yx(t,n,e,r);(N||U)&&(p={...p,...MS(m.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:_,errorUpdatedAt:E,status:x}=p;v=p.data;let S=!1;if(e.placeholderData!==void 0&&v===void 0&&x==="pending"){let I;i?.isPlaceholderData&&e.placeholderData===l?.placeholderData?(I=i.data,S=!0):I=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,I!==void 0&&(x="success",v=sy(i?.data,I,e),g=!0)}if(e.select&&v!==void 0&&!S)if(i&&v===o?.data&&e.select===this.#p)v=this.#h;else try{this.#p=e.select,v=e.select(v),v=sy(i?.data,v,e),this.#h=v,this.#i=null}catch(I){this.#i=I}this.#i&&(_=this.#i,v=this.#h,E=Date.now(),x="error");const C=p.fetchStatus==="fetching",T=x==="pending",A=x==="error",L=T&&C,F=v!==void 0,O={status:x,fetchStatus:p.fetchStatus,isPending:T,isSuccess:x==="success",isError:A,isInitialLoading:L,isLoading:L,data:v,dataUpdatedAt:p.dataUpdatedAt,error:_,errorUpdatedAt:E,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:C,isRefetching:C&&!T,isLoadingError:A&&!F,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:A&&F,isStale:Wy(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Fr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const I=$=>{O.status==="error"?$.reject(O.error):O.data!==void 0&&$.resolve(O.data)},N=()=>{const $=this.#o=O.promise=iy();I($)},U=this.#o;switch(U.status){case"pending":t.queryHash===n.queryHash&&I(U);break;case"fulfilled":(O.status==="error"||O.data!==U.value)&&N();break;case"rejected":(O.status!=="error"||O.error!==U.reason)&&N();break}}return O}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),lf(e,t))return;this.#s=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#m.size)return!0;const o=new Set(i??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#s).some(l=>{const d=l;return this.#s[d]!==t[d]&&o.has(d)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){En.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function Yj(t,e){return Fr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Kx(t,e){return Yj(t,e)||t.state.data!==void 0&&oy(t,e,e.refetchOnMount)}function oy(t,e,n){if(Fr(e.enabled,t)!==!1&&fa(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&Wy(t,e)}return!1}function Yx(t,e,n,r){return(t!==e||Fr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&Wy(t,n)}function Wy(t,e){return Fr(e.enabled,t)!==!1&&t.isStaleByTime(fa(e.staleTime,t))}function Xj(t,e){return!lf(t.getCurrentResult(),e)}function Xx(t){return{onFetch:(e,n)=>{const r=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],l=e.state.data?.pageParams||[];let d={pages:[],pageParams:[]},h=0;const m=async()=>{let p=!1;const g=E=>{Object.defineProperty(E,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},v=RS(e.options,e.fetchOptions),_=async(E,x,S)=>{if(p)return Promise.reject();if(x==null&&E.pages.length)return Promise.resolve(E);const T=(()=>{const H={client:e.client,queryKey:e.queryKey,pageParam:x,direction:S?"backward":"forward",meta:e.options.meta};return g(H),H})(),A=await v(T),{maxPages:L}=e.options,F=S?Vj:Fj;return{pages:F(E.pages,A,L),pageParams:F(E.pageParams,x,L)}};if(i&&o.length){const E=i==="backward",x=E?Zj:Zx,S={pages:o,pageParams:l},C=x(r,S);d=await _(S,C,E)}else{const E=t??o.length;do{const x=h===0?l[0]??r.initialPageParam:Zx(r,d);if(h>0&&x==null)break;d=await _(d,x),h++}while(h<E)}return d};e.options.persister?e.fetchFn=()=>e.options.persister?.(m,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=m}}}function Zx(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function Zj(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var Jj=class extends OS{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||NS(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=kS({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(l,d)=>{this.#r({type:"failed",failureCount:l,error:d})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",o=!this.#s.canStart();try{if(i)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const d=await this.options.onMutate?.(e,r);d!==this.state.context&&this.#r({type:"pending",context:d,variables:e,isPaused:o})}const l=await this.#s.start();return await this.#n.config.onSuccess?.(l,e,this.state.context,this,r),await this.options.onSuccess?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(l,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(l,null,e,this.state.context,r),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#n.config.onError?.(l,e,this.state.context,this,r),await this.options.onError?.(l,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,l,e,this.state.context,r),l}finally{this.#r({type:"error",error:l})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),En.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function NS(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var eR=class extends tc{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new Jj({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Lh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Lh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Lh(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(i=>i.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Lh(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){En.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>qx(e,n))}findAll(t={}){return this.getAll().filter(e=>qx(t,e))}notify(t){En.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return En.batch(()=>Promise.all(t.map(e=>e.continue().catch(rr))))}};function Lh(t){return t.options.scope?.id}var tR=class extends tc{#e;#t=void 0;#n;#s;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),lf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&So(n.mutationKey)!==So(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??NS();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){En.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#s.onSuccess?.(e.data,n,r,i),this.#s.onSettled?.(e.data,null,n,r,i)):e?.type==="error"&&(this.#s.onError?.(e.error,n,r,i),this.#s.onSettled?.(void 0,e.error,n,r,i))}this.listeners.forEach(n=>{n(this.#t)})})}},nR=class extends tc{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,i=e.queryHash??Hy(r,e);let o=this.get(i);return o||(o=new Wj({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){En.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>$x(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>$x(t,n)):e}notify(t){En.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){En.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){En.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},rR=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(t={}){this.#e=t.queryCache||new nR,this.#t=t.mutationCache||new eR,this.#n=t.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=Qy.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=cf.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(fa(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,l=Bj(e,o);if(l!==void 0)return this.#e.build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return En.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;En.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return En.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=En.batch(()=>this.#e.findAll(t).map(i=>i.cancel(n)));return Promise.all(r).then(rr).catch(rr)}invalidateQueries(t,e={}){return En.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=En.batch(()=>this.#e.findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let o=i.fetch(void 0,n);return n.throwOnError||(o=o.catch(rr)),i.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(rr)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(fa(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(rr).catch(rr)}fetchInfiniteQuery(t){return t.behavior=Xx(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(rr).catch(rr)}ensureInfiniteQueryData(t){return t.behavior=Xx(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return cf.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#s.set(So(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{ku(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(So(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{ku(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Hy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Gy&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},PS=k.createContext(void 0),Ft=t=>{const e=k.useContext(PS);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},sR=({client:t,children:e})=>(k.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),u.jsx(PS.Provider,{value:t,children:e})),zS=k.createContext(!1),iR=()=>k.useContext(zS);zS.Provider;function aR(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var oR=k.createContext(aR()),lR=()=>k.useContext(oR),cR=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},uR=t=>{k.useEffect(()=>{t.clearReset()},[t])},dR=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||DS(n,[t.error,r])),hR=t=>{if(t.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...i)=>n(r(...i)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},fR=(t,e)=>t.isLoading&&t.isFetching&&!e,mR=(t,e)=>t?.suspense&&e.isPending,Jx=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function pR(t,e,n){const r=iR(),i=lR(),o=Ft(),l=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(l),l._optimisticResults=r?"isRestoring":"optimistic",hR(l),cR(l,i),uR(i);const d=!o.getQueryCache().get(l.queryHash),[h]=k.useState(()=>new e(o,l)),m=h.getOptimisticResult(l),p=!r&&t.subscribed!==!1;if(k.useSyncExternalStore(k.useCallback(g=>{const v=p?h.subscribe(En.batchCalls(g)):rr;return h.updateResult(),v},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),k.useEffect(()=>{h.setOptions(l)},[l,h]),mR(l,m))throw Jx(l,h,i);if(dR({result:m,errorResetBoundary:i,throwOnError:l.throwOnError,query:o.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw m.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(l,m),l.experimental_prefetchInRender&&!wo&&fR(m,r)&&(d?Jx(l,h,i):o.getQueryCache().get(l.queryHash)?.promise)?.catch(rr).finally(()=>{h.updateResult()}),l.notifyOnChangeProps?m:h.trackResult(m)}function Ro(t,e){return pR(t,Kj)}function Hn(t,e){const n=Ft(),[r]=k.useState(()=>new tR(n,t));k.useEffect(()=>{r.setOptions(t)},[r,t]);const i=k.useSyncExternalStore(k.useCallback(l=>r.subscribe(En.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=k.useCallback((l,d)=>{r.mutate(l,d).catch(rr)},[r]);if(i.error&&DS(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}const gR={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},BS=k.createContext(gR);function yR({children:t}){const[e,n]=k.useState(new Map),r=k.useCallback((h,m)=>{n(p=>new Map(p).set(h,m))},[]),i=k.useCallback(h=>{n(m=>{const p=new Map(m);return p.delete(h),p})},[]),o=e.size>0,l=e.size>0&&Array.from(e.values()).pop()||"Loading...",d={isLoading:o,loadingMessage:l,addLoadingHold:r,removeLoadingHold:i};return u.jsx(BS.Provider,{value:d,children:t})}function sr(){const t=k.useContext(BS);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const _R=()=>{};var ew={};const LS=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},bR=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],l=t[n++],d=t[n++],h=((i&7)<<18|(o&63)<<12|(l&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|l&63)}}return e.join("")},US={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],l=i+1<t.length,d=l?t[i+1]:0,h=i+2<t.length,m=h?t[i+2]:0,p=o>>2,g=(o&3)<<4|d>>4;let v=(d&15)<<2|m>>6,_=m&63;h||(_=64,l||(v=64)),r.push(n[p],n[g],n[v],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(LS(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):bR(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],d=i<t.length?n[t.charAt(i)]:0;++i;const m=i<t.length?n[t.charAt(i)]:64;++i;const g=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||d==null||m==null||g==null)throw new vR;const v=o<<2|d>>4;if(r.push(v),m!==64){const _=d<<4&240|m>>2;if(r.push(_),g!==64){const E=m<<6&192|g;r.push(E)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class vR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const xR=function(t){const e=LS(t);return US.encodeByteArray(e,!0)},uf=function(t){return xR(t).replace(/\./g,"")},FS=function(t){try{return US.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function wR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const SR=()=>wR().__FIREBASE_DEFAULTS__,ER=()=>{if(typeof process>"u"||typeof ew>"u")return;const t=ew.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},CR=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&FS(t[1]);return e&&JSON.parse(e)},qf=()=>{try{return _R()||SR()||ER()||CR()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},VS=t=>qf()?.emulatorHosts?.[t],TR=t=>{const e=VS(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},$S=()=>qf()?.config,qS=t=>qf()?.[`_${t}`];class AR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function nc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function HS(t){return(await fetch(t,{credentials:"include"})).ok}function jR(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[uf(JSON.stringify(n)),uf(JSON.stringify(l)),""].join(".")}const Cu={};function RR(){const t={prod:[],emulator:[]};for(const e of Object.keys(Cu))Cu[e]?t.emulator.push(e):t.prod.push(e);return t}function DR(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let tw=!1;function GS(t,e){if(typeof window>"u"||typeof document>"u"||!nc(window.location.host)||Cu[t]===e||Cu[t]||tw)return;Cu[t]=e;function n(v){return`__firebase__banner__${v}`}const r="__firebase__banner",o=RR().prod.length>0;function l(){const v=document.getElementById(r);v&&v.remove()}function d(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function h(v,_){v.setAttribute("width","24"),v.setAttribute("id",_),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function m(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{tw=!0,l()},v}function p(v,_){v.setAttribute("id",_),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function g(){const v=DR(r),_=n("text"),E=document.getElementById(_)||document.createElement("span"),x=n("learnmore"),S=document.getElementById(x)||document.createElement("a"),C=n("preprendIcon"),T=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const A=v.element;d(A),p(S,x);const L=m();h(T,C),A.append(T,E,S,L),document.body.appendChild(A)}o?(E.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,E.innerText="Preview backend running in this workspace."),E.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function Zn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function IR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Zn())}function kR(){const t=qf()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function OR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function MR(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function NR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function PR(){const t=Zn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function zR(){return!kR()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function BR(){try{return typeof indexedDB=="object"}catch{return!1}}function LR(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(n){e(n)}})}const UR="FirebaseError";class Ei extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=UR,Object.setPrototypeOf(this,Ei.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xu.prototype.create)}}class Xu{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],l=o?FR(o,r):"Error",d=`${this.serviceName}: ${l} (${i}).`;return new Ei(i,d,r)}}function FR(t,e){return t.replace(VR,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const VR=/\{\$([^}]+)}/g;function $R(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function yi(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],l=e[i];if(nw(o)&&nw(l)){if(!yi(o,l))return!1}else if(o!==l)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function nw(t){return t!==null&&typeof t=="object"}function Zu(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function bu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function vu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function qR(t,e){const n=new HR(t,e);return n.subscribe.bind(n)}class HR{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");GR(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=Og),i.error===void 0&&(i.error=Og),i.complete===void 0&&(i.complete=Og);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function GR(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Og(){}function _n(t){return t&&t._delegate?t._delegate:t}class Eo{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const mo="[DEFAULT]";class QR{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new AR;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(KR(e))try{this.getOrInitializeService({instanceIdentifier:mo})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=mo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=mo){return this.instances.has(e)}getOptions(e=mo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);r===d&&l.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:WR(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=mo){return this.component?this.component.multipleInstances?e:mo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function WR(t){return t===mo?void 0:t}function KR(t){return t.instantiationMode==="EAGER"}class YR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new QR(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var mt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(mt||(mt={}));const XR={debug:mt.DEBUG,verbose:mt.VERBOSE,info:mt.INFO,warn:mt.WARN,error:mt.ERROR,silent:mt.SILENT},ZR=mt.INFO,JR={[mt.DEBUG]:"log",[mt.VERBOSE]:"log",[mt.INFO]:"info",[mt.WARN]:"warn",[mt.ERROR]:"error"},eD=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=JR[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ky{constructor(e){this.name=e,this._logLevel=ZR,this._logHandler=eD,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in mt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?XR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,mt.DEBUG,...e),this._logHandler(this,mt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,mt.VERBOSE,...e),this._logHandler(this,mt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,mt.INFO,...e),this._logHandler(this,mt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,mt.WARN,...e),this._logHandler(this,mt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,mt.ERROR,...e),this._logHandler(this,mt.ERROR,...e)}}const tD=(t,e)=>e.some(n=>t instanceof n);let rw,sw;function nD(){return rw||(rw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function rD(){return sw||(sw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const QS=new WeakMap,ly=new WeakMap,WS=new WeakMap,Mg=new WeakMap,Yy=new WeakMap;function sD(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(ma(t.result)),i()},l=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&QS.set(n,t)}).catch(()=>{}),Yy.set(e,t),e}function iD(t){if(ly.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),i()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});ly.set(t,e)}let cy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return ly.get(t);if(e==="objectStoreNames")return t.objectStoreNames||WS.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ma(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function aD(t){cy=t(cy)}function oD(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Ng(this),e,...n);return WS.set(r,e.sort?e.sort():[e]),ma(r)}:rD().includes(t)?function(...e){return t.apply(Ng(this),e),ma(QS.get(this))}:function(...e){return ma(t.apply(Ng(this),e))}}function lD(t){return typeof t=="function"?oD(t):(t instanceof IDBTransaction&&iD(t),tD(t,nD())?new Proxy(t,cy):t)}function ma(t){if(t instanceof IDBRequest)return sD(t);if(Mg.has(t))return Mg.get(t);const e=lD(t);return e!==t&&(Mg.set(t,e),Yy.set(e,t)),e}const Ng=t=>Yy.get(t);function cD(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(t,e),d=ma(l);return r&&l.addEventListener("upgradeneeded",h=>{r(ma(l.result),h.oldVersion,h.newVersion,ma(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),d.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",m=>i(m.oldVersion,m.newVersion,m))}).catch(()=>{}),d}const uD=["get","getKey","getAll","getAllKeys","count"],dD=["put","add","delete","clear"],Pg=new Map;function iw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Pg.get(e))return Pg.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=dD.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||uD.includes(n)))return;const o=async function(l,...d){const h=this.transaction(l,i?"readwrite":"readonly");let m=h.store;return r&&(m=m.index(d.shift())),(await Promise.all([m[n](...d),i&&h.done]))[0]};return Pg.set(e,o),o}aD(t=>({...t,get:(e,n,r)=>iw(e,n)||t.get(e,n,r),has:(e,n)=>!!iw(e,n)||t.has(e,n)}));class hD{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(fD(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function fD(t){return t.getComponent()?.type==="VERSION"}const uy="@firebase/app",aw="0.14.6";const _i=new Ky("@firebase/app"),mD="@firebase/app-compat",pD="@firebase/analytics-compat",gD="@firebase/analytics",yD="@firebase/app-check-compat",_D="@firebase/app-check",bD="@firebase/auth",vD="@firebase/auth-compat",xD="@firebase/database",wD="@firebase/data-connect",SD="@firebase/database-compat",ED="@firebase/functions",CD="@firebase/functions-compat",TD="@firebase/installations",AD="@firebase/installations-compat",jD="@firebase/messaging",RD="@firebase/messaging-compat",DD="@firebase/performance",ID="@firebase/performance-compat",kD="@firebase/remote-config",OD="@firebase/remote-config-compat",MD="@firebase/storage",ND="@firebase/storage-compat",PD="@firebase/firestore",zD="@firebase/ai",BD="@firebase/firestore-compat",LD="firebase",UD="12.6.0";const dy="[DEFAULT]",FD={[uy]:"fire-core",[mD]:"fire-core-compat",[gD]:"fire-analytics",[pD]:"fire-analytics-compat",[_D]:"fire-app-check",[yD]:"fire-app-check-compat",[bD]:"fire-auth",[vD]:"fire-auth-compat",[xD]:"fire-rtdb",[wD]:"fire-data-connect",[SD]:"fire-rtdb-compat",[ED]:"fire-fn",[CD]:"fire-fn-compat",[TD]:"fire-iid",[AD]:"fire-iid-compat",[jD]:"fire-fcm",[RD]:"fire-fcm-compat",[DD]:"fire-perf",[ID]:"fire-perf-compat",[kD]:"fire-rc",[OD]:"fire-rc-compat",[MD]:"fire-gcs",[ND]:"fire-gcs-compat",[PD]:"fire-fst",[BD]:"fire-fst-compat",[zD]:"fire-vertex","fire-js":"fire-js",[LD]:"fire-js-all"};const df=new Map,VD=new Map,hy=new Map;function ow(t,e){try{t.container.addComponent(e)}catch(n){_i.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Ll(t){const e=t.name;if(hy.has(e))return _i.debug(`There were multiple attempts to register component ${e}.`),!1;hy.set(e,t);for(const n of df.values())ow(n,t);for(const n of VD.values())ow(n,t);return!0}function Xy(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ss(t){return t==null?!1:t.settings!==void 0}const $D={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},pa=new Xu("app","Firebase",$D);class qD{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Eo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw pa.create("app-deleted",{appName:this._name})}}const rc=UD;function KS(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:dy,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw pa.create("bad-app-name",{appName:String(i)});if(n||(n=$S()),!n)throw pa.create("no-options");const o=df.get(i);if(o){if(yi(n,o.options)&&yi(r,o.config))return o;throw pa.create("duplicate-app",{appName:i})}const l=new YR(i);for(const h of hy.values())l.addComponent(h);const d=new qD(n,r,l);return df.set(i,d),d}function YS(t=dy){const e=df.get(t);if(!e&&t===dy&&$S())return KS();if(!e)throw pa.create("no-app",{appName:t});return e}function ga(t,e,n){let r=FD[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${e}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),_i.warn(l.join(" "));return}Ll(new Eo(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const HD="firebase-heartbeat-database",GD=1,Ou="firebase-heartbeat-store";let zg=null;function XS(){return zg||(zg=cD(HD,GD,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Ou)}catch(n){console.warn(n)}}}}).catch(t=>{throw pa.create("idb-open",{originalErrorMessage:t.message})})),zg}async function QD(t){try{const n=(await XS()).transaction(Ou),r=await n.objectStore(Ou).get(ZS(t));return await n.done,r}catch(e){if(e instanceof Ei)_i.warn(e.message);else{const n=pa.create("idb-get",{originalErrorMessage:e?.message});_i.warn(n.message)}}}async function lw(t,e){try{const r=(await XS()).transaction(Ou,"readwrite");await r.objectStore(Ou).put(e,ZS(t)),await r.done}catch(n){if(n instanceof Ei)_i.warn(n.message);else{const r=pa.create("idb-set",{originalErrorMessage:n?.message});_i.warn(r.message)}}}function ZS(t){return`${t.name}!${t.options.appId}`}const WD=1024,KD=30;class YD{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new ZD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=cw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>KD){const i=JD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){_i.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=cw(),{heartbeatsToSend:n,unsentEntries:r}=XD(this._heartbeatsCache.heartbeats),i=uf(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return _i.warn(e),""}}}function cw(){return new Date().toISOString().substring(0,10)}function XD(t,e=WD){const n=[];let r=t.slice();for(const i of t){const o=n.find(l=>l.agent===i.agent);if(o){if(o.dates.push(i.date),uw(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),uw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class ZD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return BR()?LR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await QD(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return lw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return lw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function uw(t){return uf(JSON.stringify({version:2,heartbeats:t})).length}function JD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function eI(t){Ll(new Eo("platform-logger",e=>new hD(e),"PRIVATE")),Ll(new Eo("heartbeat",e=>new YD(e),"PRIVATE")),ga(uy,aw,t),ga(uy,aw,"esm2020"),ga("fire-js","")}eI("");function JS(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const tI=JS,eE=new Xu("auth","Firebase",JS());const hf=new Ky("@firebase/auth");function nI(t,...e){hf.logLevel<=mt.WARN&&hf.warn(`Auth (${rc}): ${t}`,...e)}function Yh(t,...e){hf.logLevel<=mt.ERROR&&hf.error(`Auth (${rc}): ${t}`,...e)}function cs(t,...e){throw Zy(t,...e)}function Ls(t,...e){return Zy(t,...e)}function tE(t,e,n){const r={...tI(),[e]:n};return new Xu("auth","Firebase",r).create(e,{appName:t.name})}function ya(t){return tE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Zy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return eE.create(t,...e)}function Ye(t,e,...n){if(!t)throw Zy(e,...n)}function hi(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Yh(e),new Error(e)}function bi(t,e){t||hi(e)}function fy(){return typeof self<"u"&&self.location?.href||""}function rI(){return dw()==="http:"||dw()==="https:"}function dw(){return typeof self<"u"&&self.location?.protocol||null}function sI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(rI()||MR()||"connection"in navigator)?navigator.onLine:!0}function iI(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class Ju{constructor(e,n){this.shortDelay=e,this.longDelay=n,bi(n>e,"Short delay should be less than long delay!"),this.isMobile=IR()||NR()}get(){return sI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Jy(t,e){bi(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class nE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;hi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;hi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;hi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const aI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const oI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],lI=new Ju(3e4,6e4);function Do(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ra(t,e,n,r,i={}){return rE(t,i,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const d=Zu({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const m={method:e,headers:h,...o};return OR()||(m.referrerPolicy="no-referrer"),t.emulatorConfig&&nc(t.emulatorConfig.host)&&(m.credentials="include"),nE.fetch()(await sE(t,t.config.apiHost,n,d),m)})}async function rE(t,e,n){t._canInitEmulator=!1;const r={...aI,...e};try{const i=new uI(t),o=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Uh(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const d=o.ok?l.errorMessage:l.error.message,[h,m]=d.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Uh(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Uh(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw Uh(t,"user-disabled",l);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(m)throw tE(t,p,m);cs(t,p)}}catch(i){if(i instanceof Ei)throw i;cs(t,"network-request-failed",{message:String(i)})}}async function Hf(t,e,n,r,i={}){const o=await Ra(t,e,n,r,i);return"mfaPendingCredential"in o&&cs(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function sE(t,e,n,r){const i=`${e}${n}?${r}`,o=t,l=o.config.emulator?Jy(t.config,i):`${t.config.apiScheme}://${i}`;return oI.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function cI(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class uI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Ls(this.auth,"network-request-failed")),lI.get())})}}function Uh(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Ls(t,e,r);return i.customData._tokenResponse=n,i}function hw(t){return t!==void 0&&t.enterprise!==void 0}class dI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return cI(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function hI(t,e){return Ra(t,"GET","/v2/recaptchaConfig",Do(t,e))}async function fI(t,e){return Ra(t,"POST","/v1/accounts:delete",e)}async function ff(t,e){return Ra(t,"POST","/v1/accounts:lookup",e)}function Tu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function mI(t,e=!1){const n=_n(t),r=await n.getIdToken(e),i=e0(r);Ye(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o=typeof i.firebase=="object"?i.firebase:void 0,l=o?.sign_in_provider;return{claims:i,token:r,authTime:Tu(Bg(i.auth_time)),issuedAtTime:Tu(Bg(i.iat)),expirationTime:Tu(Bg(i.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Bg(t){return Number(t)*1e3}function e0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Yh("JWT malformed, contained fewer than 3 sections"),null;try{const i=FS(n);return i?JSON.parse(i):(Yh("Failed to decode base64 JWT payload"),null)}catch(i){return Yh("Caught error parsing JWT payload as JSON",i?.toString()),null}}function fw(t){const e=e0(t);return Ye(e,"internal-error"),Ye(typeof e.exp<"u","internal-error"),Ye(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Mu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Ei&&pI(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function pI({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class gI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class my{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Tu(this.lastLoginAt),this.creationTime=Tu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function mf(t){const e=t.auth,n=await t.getIdToken(),r=await Mu(t,ff(e,{idToken:n}));Ye(r?.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=i.providerUserInfo?.length?iE(i.providerUserInfo):[],l=_I(t.providerData,o),d=t.isAnonymous,h=!(t.email&&i.passwordHash)&&!l?.length,m=d?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new my(i.createdAt,i.lastLoginAt),isAnonymous:m};Object.assign(t,p)}async function yI(t){const e=_n(t);await mf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function _I(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function iE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function bI(t,e){const n=await rE(t,{},async()=>{const r=Zu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=t.config,l=await sE(t,i,"/v1/token",`key=${o}`),d=await t._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:d,body:r};return t.emulatorConfig&&nc(t.emulatorConfig.host)&&(h.credentials="include"),nE.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function vI(t,e){return Ra(t,"POST","/v2/accounts:revokeToken",Do(t,e))}class Ol{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ye(e.idToken,"internal-error"),Ye(typeof e.idToken<"u","internal-error"),Ye(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):fw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ye(e.length!==0,"internal-error");const n=fw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ye(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:o}=await bI(e,n);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:o}=n,l=new Ol;return r&&(Ye(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),i&&(Ye(typeof i=="string","internal-error",{appName:e}),l.accessToken=i),o&&(Ye(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ol,this.toJSON())}_performRefresh(){return hi("not implemented")}}function sa(t,e){Ye(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class is{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new gI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new my(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Mu(this,this.stsTokenManager.getToken(this.auth,e));return Ye(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return mI(this,e)}reload(){return yI(this)}_assign(e){this!==e&&(Ye(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new is({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ye(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await mf(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ss(this.auth.app))return Promise.reject(ya(this.auth));const e=await this.getIdToken();return await Mu(this,fI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,d=n.tenantId??void 0,h=n._redirectEventId??void 0,m=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:v,isAnonymous:_,providerData:E,stsTokenManager:x}=n;Ye(g&&x,e,"internal-error");const S=Ol.fromJSON(this.name,x);Ye(typeof g=="string",e,"internal-error"),sa(r,e.name),sa(i,e.name),Ye(typeof v=="boolean",e,"internal-error"),Ye(typeof _=="boolean",e,"internal-error"),sa(o,e.name),sa(l,e.name),sa(d,e.name),sa(h,e.name),sa(m,e.name),sa(p,e.name);const C=new is({uid:g,auth:e,email:i,emailVerified:v,displayName:r,isAnonymous:_,photoURL:l,phoneNumber:o,tenantId:d,stsTokenManager:S,createdAt:m,lastLoginAt:p});return E&&Array.isArray(E)&&(C.providerData=E.map(T=>({...T}))),h&&(C._redirectEventId=h),C}static async _fromIdTokenResponse(e,n,r=!1){const i=new Ol;i.updateFromServerResponse(n);const o=new is({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await mf(o),o}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];Ye(i.localId!==void 0,"internal-error");const o=i.providerUserInfo!==void 0?iE(i.providerUserInfo):[],l=!(i.email&&i.passwordHash)&&!o?.length,d=new Ol;d.updateFromIdToken(r);const h=new is({uid:i.localId,auth:e,stsTokenManager:d,isAnonymous:l}),m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new my(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,m),h}}const mw=new Map;function fi(t){bi(t instanceof Function,"Expected a class definition");let e=mw.get(t);return e?(bi(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,mw.set(t,e),e)}class aE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}aE.type="NONE";const pw=aE;function Xh(t,e,n){return`firebase:${t}:${e}:${n}`}class Ml{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:o}=this.auth;this.fullUserKey=Xh(this.userKey,i.apiKey,o),this.fullPersistenceKey=Xh("persistence",i.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await ff(this.auth,{idToken:e}).catch(()=>{});return n?is._fromGetAccountInfoResponse(this.auth,n,e):null}return is._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Ml(fi(pw),e,r);const i=(await Promise.all(n.map(async m=>{if(await m._isAvailable())return m}))).filter(m=>m);let o=i[0]||fi(pw);const l=Xh(r,e.config.apiKey,e.name);let d=null;for(const m of n)try{const p=await m._get(l);if(p){let g;if(typeof p=="string"){const v=await ff(e,{idToken:p}).catch(()=>{});if(!v)break;g=await is._fromGetAccountInfoResponse(e,v,p)}else g=is._fromJSON(e,p);m!==o&&(d=g),o=m;break}}catch{}const h=i.filter(m=>m._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Ml(o,e,r):(o=h[0],d&&await o._set(l,d.toJSON()),await Promise.all(n.map(async m=>{if(m!==o)try{await m._remove(l)}catch{}})),new Ml(o,e,r))}}function gw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(uE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(oE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(hE(e))return"Blackberry";if(fE(e))return"Webos";if(lE(e))return"Safari";if((e.includes("chrome/")||cE(e))&&!e.includes("edge/"))return"Chrome";if(dE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function oE(t=Zn()){return/firefox\//i.test(t)}function lE(t=Zn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function cE(t=Zn()){return/crios\//i.test(t)}function uE(t=Zn()){return/iemobile/i.test(t)}function dE(t=Zn()){return/android/i.test(t)}function hE(t=Zn()){return/blackberry/i.test(t)}function fE(t=Zn()){return/webos/i.test(t)}function t0(t=Zn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function xI(t=Zn()){return t0(t)&&!!window.navigator?.standalone}function wI(){return PR()&&document.documentMode===10}function mE(t=Zn()){return t0(t)||dE(t)||fE(t)||hE(t)||/windows phone/i.test(t)||uE(t)}function pE(t,e=[]){let n;switch(t){case"Browser":n=gw(Zn());break;case"Worker":n=`${gw(Zn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${rc}/${r}`}class SI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,d)=>{try{const h=e(o);l(h)}catch(h){d(h)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function EI(t,e={}){return Ra(t,"GET","/v2/passwordPolicy",Do(t,e))}const CI=6;class TI{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??CI,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class AI{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new yw(this),this.idTokenSubscription=new yw(this),this.beforeStateQueue=new SI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=eE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=fi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Ml.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await ff(this,{idToken:e}),r=await is._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(ss(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===l)&&d?.user&&(r=d.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ye(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await mf(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=iI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ss(this.app))return Promise.reject(ya(this));const n=e?_n(e):null;return n&&Ye(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ye(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ss(this.app)?Promise.reject(ya(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ss(this.app)?Promise.reject(ya(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(fi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await EI(this),n=new TI(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Xu("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await vI(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&fi(e)||this._popupRedirectResolver;Ye(n,this,"argument-error"),this.redirectPersistenceManager=await Ml.create(this,[fi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ye(d,this,"internal-error"),d.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,i);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ye(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=pE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(ss(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&nI(`Error while retrieving App Check token: ${e.error}`),e?.token}}function sc(t){return _n(t)}class yw{constructor(e){this.auth=e,this.observer=null,this.addObserver=qR(n=>this.observer=n)}get next(){return Ye(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Gf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function jI(t){Gf=t}function gE(t){return Gf.loadJS(t)}function RI(){return Gf.recaptchaEnterpriseScript}function DI(){return Gf.gapiScript}function II(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class kI{constructor(){this.enterprise=new OI}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class OI{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const MI="recaptcha-enterprise",yE="NO_RECAPTCHA";class NI{constructor(e){this.type=MI,this.auth=sc(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,d)=>{hI(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)d(new Error("recaptcha Enterprise site key undefined"));else{const m=new dI(h);return o.tenantId==null?o._agentRecaptchaConfig=m:o._tenantRecaptchaConfigs[o.tenantId]=m,l(m.siteKey)}}).catch(h=>{d(h)})})}function i(o,l,d){const h=window.grecaptcha;hw(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(m=>{l(m)}).catch(()=>{l(yE)})}):d(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new kI().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(d=>{if(!n&&hw(window.grecaptcha))i(d,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=RI();h.length!==0&&(h+=d),gE(h).then(()=>{i(d,o,l)}).catch(m=>{l(m)})}}).catch(d=>{l(d)})})}}async function _w(t,e,n,r=!1,i=!1){const o=new NI(t);let l;if(i)l=yE;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const d={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in d){const h=d.phoneEnrollmentInfo.phoneNumber,m=d.phoneEnrollmentInfo.recaptchaToken;Object.assign(d,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:m,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in d){const h=d.phoneSignInInfo.recaptchaToken;Object.assign(d,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return d}return r?Object.assign(d,{captchaResp:l}):Object.assign(d,{captchaResponse:l}),Object.assign(d,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(d,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),d}async function bw(t,e,n,r,i){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await _w(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await _w(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function PI(t,e){const n=Xy(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),o=n.getOptions();if(yi(o,e??{}))return i;cs(i,"already-initialized")}return n.initialize({options:e})}function zI(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(fi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function BI(t,e,n){const r=sc(t);Ye(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,o=_E(e),{host:l,port:d}=LI(e),h=d===null?"":`:${d}`,m={url:`${o}//${l}${h}/`},p=Object.freeze({host:l,port:d,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Ye(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ye(yi(m,r.config.emulator)&&yi(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=m,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,nc(l)?(HS(`${o}//${l}${h}`),GS("Auth",!0)):UI()}function _E(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function LI(t){const e=_E(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const o=i[1];return{host:o,port:vw(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:vw(l)}}}function vw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function UI(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class n0{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return hi("not implemented")}_getIdTokenResponse(e){return hi("not implemented")}_linkToIdToken(e,n){return hi("not implemented")}_getReauthenticationResolver(e){return hi("not implemented")}}async function FI(t,e){return Ra(t,"POST","/v1/accounts:signUp",e)}async function VI(t,e){return Hf(t,"POST","/v1/accounts:signInWithPassword",Do(t,e))}async function $I(t,e){return Hf(t,"POST","/v1/accounts:signInWithEmailLink",Do(t,e))}async function qI(t,e){return Hf(t,"POST","/v1/accounts:signInWithEmailLink",Do(t,e))}class Nu extends n0{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Nu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Nu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return bw(e,n,"signInWithPassword",VI);case"emailLink":return $I(e,{email:this._email,oobCode:this._password});default:cs(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return bw(e,r,"signUpPassword",FI);case"emailLink":return qI(e,{idToken:n,email:this._email,oobCode:this._password});default:cs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Nl(t,e){return Hf(t,"POST","/v1/accounts:signInWithIdp",Do(t,e))}const HI="http://localhost";class Co extends n0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Co(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):cs("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...o}=n;if(!r||!i)return null;const l=new Co(r,i);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return Nl(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Nl(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Nl(e,n)}buildRequest(){const e={requestUri:HI,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Zu(n)}return e}}function GI(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function QI(t){const e=bu(vu(t)).link,n=e?bu(vu(e)).deep_link_id:null,r=bu(vu(t)).deep_link_id;return(r?bu(vu(r)).link:null)||r||n||e||t}class r0{constructor(e){const n=bu(vu(e)),r=n.apiKey??null,i=n.oobCode??null,o=GI(n.mode??null);Ye(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=QI(e);try{return new r0(n)}catch{return null}}}class ic{constructor(){this.providerId=ic.PROVIDER_ID}static credential(e,n){return Nu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=r0.parseLink(n);return Ye(r,"argument-error"),Nu._fromEmailAndCode(e,r.code,r.tenantId)}}ic.PROVIDER_ID="password";ic.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ic.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class bE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ed extends bE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class oa extends ed{constructor(){super("facebook.com")}static credential(e){return Co._fromParams({providerId:oa.PROVIDER_ID,signInMethod:oa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return oa.credentialFromTaggedObject(e)}static credentialFromError(e){return oa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return oa.credential(e.oauthAccessToken)}catch{return null}}}oa.FACEBOOK_SIGN_IN_METHOD="facebook.com";oa.PROVIDER_ID="facebook.com";class la extends ed{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Co._fromParams({providerId:la.PROVIDER_ID,signInMethod:la.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return la.credentialFromTaggedObject(e)}static credentialFromError(e){return la.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return la.credential(n,r)}catch{return null}}}la.GOOGLE_SIGN_IN_METHOD="google.com";la.PROVIDER_ID="google.com";class ca extends ed{constructor(){super("github.com")}static credential(e){return Co._fromParams({providerId:ca.PROVIDER_ID,signInMethod:ca.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ca.credentialFromTaggedObject(e)}static credentialFromError(e){return ca.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ca.credential(e.oauthAccessToken)}catch{return null}}}ca.GITHUB_SIGN_IN_METHOD="github.com";ca.PROVIDER_ID="github.com";class ua extends ed{constructor(){super("twitter.com")}static credential(e,n){return Co._fromParams({providerId:ua.PROVIDER_ID,signInMethod:ua.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ua.credentialFromTaggedObject(e)}static credentialFromError(e){return ua.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return ua.credential(n,r)}catch{return null}}}ua.TWITTER_SIGN_IN_METHOD="twitter.com";ua.PROVIDER_ID="twitter.com";class Ul{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const o=await is._fromIdTokenResponse(e,r,i),l=xw(r);return new Ul({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=xw(r);return new Ul({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function xw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class pf extends Ei{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,pf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new pf(e,n,r,i)}}function vE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?pf._fromErrorAndOperation(t,o,e,r):o})}async function WI(t,e,n=!1){const r=await Mu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Ul._forOperation(t,"link",r)}async function KI(t,e,n=!1){const{auth:r}=t;if(ss(r.app))return Promise.reject(ya(r));const i="reauthenticate";try{const o=await Mu(t,vE(r,i,e,t),n);Ye(o.idToken,r,"internal-error");const l=e0(o.idToken);Ye(l,r,"internal-error");const{sub:d}=l;return Ye(t.uid===d,r,"user-mismatch"),Ul._forOperation(t,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&cs(r,"user-mismatch"),o}}async function xE(t,e,n=!1){if(ss(t.app))return Promise.reject(ya(t));const r="signIn",i=await vE(t,r,e),o=await Ul._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(o.user),o}async function YI(t,e){return xE(sc(t),e)}async function XI(t){const e=sc(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function ZI(t,e,n){return ss(t.app)?Promise.reject(ya(t)):YI(_n(t),ic.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&XI(t),r})}function JI(t,e,n,r){return _n(t).onIdTokenChanged(e,n,r)}function ek(t,e,n){return _n(t).beforeAuthStateChanged(e,n)}function tk(t,e,n,r){return _n(t).onAuthStateChanged(e,n,r)}function nk(t){return _n(t).signOut()}const gf="__sak";class wE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(gf,"1"),this.storage.removeItem(gf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const rk=1e3,sk=10;class SE extends wE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=mE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,d,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);wI()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,sk):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},rk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}SE.type="LOCAL";const ik=SE;class EE extends wE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}EE.type="SESSION";const CE=EE;function ak(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class Qf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new Qf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:o}=n.data,l=this.handlersMap[i];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const d=Array.from(l).map(async m=>m(n.origin,o)),h=await ak(d);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Qf.receivers=[];function s0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class ok{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,l;return new Promise((d,h)=>{const m=s0("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:i,onMessage(g){const v=g;if(v.data.eventId===m)switch(v.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),d(v.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),i.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:m,data:n},[i.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Us(){return window}function lk(t){Us().location.href=t}function TE(){return typeof Us().WorkerGlobalScope<"u"&&typeof Us().importScripts=="function"}async function ck(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function uk(){return navigator?.serviceWorker?.controller||null}function dk(){return TE()?self:null}const AE="firebaseLocalStorageDb",hk=1,yf="firebaseLocalStorage",jE="fbase_key";class td{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Wf(t,e){return t.transaction([yf],e?"readwrite":"readonly").objectStore(yf)}function fk(){const t=indexedDB.deleteDatabase(AE);return new td(t).toPromise()}function py(){const t=indexedDB.open(AE,hk);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(yf,{keyPath:jE})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(yf)?e(r):(r.close(),await fk(),e(await py()))})})}async function ww(t,e,n){const r=Wf(t,!0).put({[jE]:e,value:n});return new td(r).toPromise()}async function mk(t,e){const n=Wf(t,!1).get(e),r=await new td(n).toPromise();return r===void 0?null:r.value}function Sw(t,e){const n=Wf(t,!0).delete(e);return new td(n).toPromise()}const pk=800,gk=3;class RE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await py(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>gk)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return TE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Qf._getInstance(dk()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await ck(),!this.activeServiceWorker)return;this.sender=new ok(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||uk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await py();return await ww(e,gf,"1"),await Sw(e,gf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>ww(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>mk(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Sw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const o=Wf(i,!1).getAll();return new td(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:o}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(o)&&(this.notifyListeners(i,o),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),pk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}RE.type="LOCAL";const yk=RE;new Ju(3e4,6e4);function _k(t,e){return e?fi(e):(Ye(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class i0 extends n0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Nl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Nl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Nl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function bk(t){return xE(t.auth,new i0(t),t.bypassAuthState)}function vk(t){const{auth:e,user:n}=t;return Ye(n,e,"internal-error"),KI(n,new i0(t),t.bypassAuthState)}async function xk(t){const{auth:e,user:n}=t;return Ye(n,e,"internal-error"),WI(n,new i0(t),t.bypassAuthState)}class DE{constructor(e,n,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:o,error:l,type:d}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(h))}catch(m){this.reject(m)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return bk;case"linkViaPopup":case"linkViaRedirect":return xk;case"reauthViaPopup":case"reauthViaRedirect":return vk;default:cs(this.auth,"internal-error")}}resolve(e){bi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){bi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const wk=new Ju(2e3,1e4);class kl extends DE{constructor(e,n,r,i,o){super(e,n,i,o),this.provider=r,this.authWindow=null,this.pollId=null,kl.currentPopupAction&&kl.currentPopupAction.cancel(),kl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ye(e,this.auth,"internal-error"),e}async onExecution(){bi(this.filter.length===1,"Popup operations only handle one event");const e=s0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Ls(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ls(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,kl.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ls(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,wk.get())};e()}}kl.currentPopupAction=null;const Sk="pendingRedirect",Zh=new Map;class Ek extends DE{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Zh.get(this.auth._key());if(!e){try{const r=await Ck(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Zh.set(this.auth._key(),e)}return this.bypassAuthState||Zh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Ck(t,e){const n=jk(e),r=Ak(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function Tk(t,e){Zh.set(t._key(),e)}function Ak(t){return fi(t._redirectPersistence)}function jk(t){return Xh(Sk,t.config.apiKey,t.name)}async function Rk(t,e,n=!1){if(ss(t.app))return Promise.reject(ya(t));const r=sc(t),i=_k(r,e),l=await new Ek(r,i,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const Dk=600*1e3;class Ik{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!kk(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!IE(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Ls(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Dk&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ew(e))}saveEventToCache(e){this.cachedEventUids.add(Ew(e)),this.lastProcessedEventTime=Date.now()}}function Ew(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function IE({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function kk(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return IE(t);default:return!1}}async function Ok(t,e={}){return Ra(t,"GET","/v1/projects",e)}const Mk=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Nk=/^https?/;async function Pk(t){if(t.config.emulator)return;const{authorizedDomains:e}=await Ok(t);for(const n of e)try{if(zk(n))return}catch{}cs(t,"unauthorized-domain")}function zk(t){const e=fy(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!Nk.test(n))return!1;if(Mk.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Bk=new Ju(3e4,6e4);function Cw(){const t=Us().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function Lk(t){return new Promise((e,n)=>{function r(){Cw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Cw(),n(Ls(t,"network-request-failed"))},timeout:Bk.get()})}if(Us().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Us().gapi?.load)r();else{const i=II("iframefcb");return Us()[i]=()=>{gapi.load?r():n(Ls(t,"network-request-failed"))},gE(`${DI()}?onload=${i}`).catch(o=>n(o))}}).catch(e=>{throw Jh=null,e})}let Jh=null;function Uk(t){return Jh=Jh||Lk(t),Jh}const Fk=new Ju(5e3,15e3),Vk="__/auth/iframe",$k="emulator/auth/iframe",qk={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Hk=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Gk(t){const e=t.config;Ye(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Jy(e,$k):`https://${t.config.authDomain}/${Vk}`,r={apiKey:e.apiKey,appName:t.name,v:rc},i=Hk.get(t.config.apiHost);i&&(r.eid=i);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${Zu(r).slice(1)}`}async function Qk(t){const e=await Uk(t),n=Us().gapi;return Ye(n,t,"internal-error"),e.open({where:document.body,url:Gk(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:qk,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});const l=Ls(t,"network-request-failed"),d=Us().setTimeout(()=>{o(l)},Fk.get());function h(){Us().clearTimeout(d),i(r)}r.ping(h).then(h,()=>{o(l)})}))}const Wk={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Kk=500,Yk=600,Xk="_blank",Zk="http://localhost";class Tw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Jk(t,e,n,r=Kk,i=Yk){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const h={...Wk,width:r.toString(),height:i.toString(),top:o,left:l},m=Zn().toLowerCase();n&&(d=cE(m)?Xk:n),oE(m)&&(e=e||Zk,h.scrollbars="yes");const p=Object.entries(h).reduce((v,[_,E])=>`${v}${_}=${E},`,"");if(xI(m)&&d!=="_self")return eO(e||"",d),new Tw(null);const g=window.open(e||"",d,p);Ye(g,t,"popup-blocked");try{g.focus()}catch{}return new Tw(g)}function eO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const tO="__/auth/handler",nO="emulator/auth/handler",rO=encodeURIComponent("fac");async function Aw(t,e,n,r,i,o){Ye(t.config.authDomain,t,"auth-domain-config-required"),Ye(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:rc,eventId:i};if(e instanceof bE){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",$R(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))l[p]=g}if(e instanceof ed){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(l.scopes=p.join(","))}t.tenantId&&(l.tid=t.tenantId);const d=l;for(const p of Object.keys(d))d[p]===void 0&&delete d[p];const h=await t._getAppCheckToken(),m=h?`#${rO}=${encodeURIComponent(h)}`:"";return`${sO(t)}?${Zu(d).slice(1)}${m}`}function sO({config:t}){return t.emulator?Jy(t,nO):`https://${t.authDomain}/${tO}`}const Lg="webStorageSupport";class iO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=CE,this._completeRedirectFn=Rk,this._overrideRedirectResult=Tk}async _openPopup(e,n,r,i){bi(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Aw(e,n,r,fy(),i);return Jk(e,o,s0())}async _openRedirect(e,n,r,i){await this._originValidation(e);const o=await Aw(e,n,r,fy(),i);return lk(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:o}=this.eventManagers[n];return i?Promise.resolve(i):(bi(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await Qk(e),r=new Ik(e);return n.register("authEvent",i=>(Ye(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Lg,{type:Lg},i=>{const o=i?.[0]?.[Lg];o!==void 0&&n(!!o),cs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=Pk(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return mE()||lE()||t0()}}const aO=iO;var jw="@firebase/auth",Rw="1.12.0";class oO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ye(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function lO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function cO(t){Ll(new Eo("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:d}=r.options;Ye(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:d,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:pE(t)},m=new AI(r,i,o,h);return zI(m,n),m},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Ll(new Eo("auth-internal",e=>{const n=sc(e.getProvider("auth").getImmediate());return(r=>new oO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ga(jw,Rw,lO(t)),ga(jw,Rw,"esm2020")}const uO=300,dO=qS("authIdTokenMaxAge")||uO;let Dw=null;const hO=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>dO)return;const i=n?.token;Dw!==i&&(Dw=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function fO(t=YS()){const e=Xy(t,"auth");if(e.isInitialized())return e.getImmediate();const n=PI(t,{popupRedirectResolver:aO,persistence:[yk,ik,CE]}),r=qS("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=hO(o.toString());ek(n,l,()=>l(n.currentUser)),JI(n,d=>l(d))}}const i=VS("auth");return i&&BI(n,`http://${i}`),n}function mO(){return document.getElementsByTagName("head")?.[0]??document}jI({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const o=Ls("internal-error");o.customData=i,n(o)},r.type="text/javascript",r.charset="UTF-8",mO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});cO("Browser");var pO="firebase",gO="12.7.0";ga(pO,gO,"app");const yO={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},kE=KS(yO);function Da(){const t=fO(kE);async function e(){return!1}async function n(h,m){return ZI(t,h,m)}function r(){return nk(t)}function i(h){tk(t,m=>{h(m)})}function o(){return t.currentUser}function l(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:i,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:l}}const ac=300*1e3,_O=1800*1e3,Ve=new rR({defaultOptions:{queries:{staleTime:ac,gcTime:_O,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Ve.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const ke={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};function bO({children:t}){return u.jsx(sR,{client:Ve,children:t})}var Iw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var _a,OE;(function(){var t;function e(O,I){function N(){}N.prototype=I.prototype,O.F=I.prototype,O.prototype=new N,O.prototype.constructor=O,O.D=function(U,$,j){for(var M=Array(arguments.length-2),R=2;R<arguments.length;R++)M[R-2]=arguments[R];return I.prototype[$].apply(U,M)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(O,I,N){N||(N=0);const U=Array(16);if(typeof I=="string")for(var $=0;$<16;++$)U[$]=I.charCodeAt(N++)|I.charCodeAt(N++)<<8|I.charCodeAt(N++)<<16|I.charCodeAt(N++)<<24;else for($=0;$<16;++$)U[$]=I[N++]|I[N++]<<8|I[N++]<<16|I[N++]<<24;I=O.g[0],N=O.g[1],$=O.g[2];let j=O.g[3],M;M=I+(j^N&($^j))+U[0]+3614090360&4294967295,I=N+(M<<7&4294967295|M>>>25),M=j+($^I&(N^$))+U[1]+3905402710&4294967295,j=I+(M<<12&4294967295|M>>>20),M=$+(N^j&(I^N))+U[2]+606105819&4294967295,$=j+(M<<17&4294967295|M>>>15),M=N+(I^$&(j^I))+U[3]+3250441966&4294967295,N=$+(M<<22&4294967295|M>>>10),M=I+(j^N&($^j))+U[4]+4118548399&4294967295,I=N+(M<<7&4294967295|M>>>25),M=j+($^I&(N^$))+U[5]+1200080426&4294967295,j=I+(M<<12&4294967295|M>>>20),M=$+(N^j&(I^N))+U[6]+2821735955&4294967295,$=j+(M<<17&4294967295|M>>>15),M=N+(I^$&(j^I))+U[7]+4249261313&4294967295,N=$+(M<<22&4294967295|M>>>10),M=I+(j^N&($^j))+U[8]+1770035416&4294967295,I=N+(M<<7&4294967295|M>>>25),M=j+($^I&(N^$))+U[9]+2336552879&4294967295,j=I+(M<<12&4294967295|M>>>20),M=$+(N^j&(I^N))+U[10]+4294925233&4294967295,$=j+(M<<17&4294967295|M>>>15),M=N+(I^$&(j^I))+U[11]+2304563134&4294967295,N=$+(M<<22&4294967295|M>>>10),M=I+(j^N&($^j))+U[12]+1804603682&4294967295,I=N+(M<<7&4294967295|M>>>25),M=j+($^I&(N^$))+U[13]+4254626195&4294967295,j=I+(M<<12&4294967295|M>>>20),M=$+(N^j&(I^N))+U[14]+2792965006&4294967295,$=j+(M<<17&4294967295|M>>>15),M=N+(I^$&(j^I))+U[15]+1236535329&4294967295,N=$+(M<<22&4294967295|M>>>10),M=I+($^j&(N^$))+U[1]+4129170786&4294967295,I=N+(M<<5&4294967295|M>>>27),M=j+(N^$&(I^N))+U[6]+3225465664&4294967295,j=I+(M<<9&4294967295|M>>>23),M=$+(I^N&(j^I))+U[11]+643717713&4294967295,$=j+(M<<14&4294967295|M>>>18),M=N+(j^I&($^j))+U[0]+3921069994&4294967295,N=$+(M<<20&4294967295|M>>>12),M=I+($^j&(N^$))+U[5]+3593408605&4294967295,I=N+(M<<5&4294967295|M>>>27),M=j+(N^$&(I^N))+U[10]+38016083&4294967295,j=I+(M<<9&4294967295|M>>>23),M=$+(I^N&(j^I))+U[15]+3634488961&4294967295,$=j+(M<<14&4294967295|M>>>18),M=N+(j^I&($^j))+U[4]+3889429448&4294967295,N=$+(M<<20&4294967295|M>>>12),M=I+($^j&(N^$))+U[9]+568446438&4294967295,I=N+(M<<5&4294967295|M>>>27),M=j+(N^$&(I^N))+U[14]+3275163606&4294967295,j=I+(M<<9&4294967295|M>>>23),M=$+(I^N&(j^I))+U[3]+4107603335&4294967295,$=j+(M<<14&4294967295|M>>>18),M=N+(j^I&($^j))+U[8]+1163531501&4294967295,N=$+(M<<20&4294967295|M>>>12),M=I+($^j&(N^$))+U[13]+2850285829&4294967295,I=N+(M<<5&4294967295|M>>>27),M=j+(N^$&(I^N))+U[2]+4243563512&4294967295,j=I+(M<<9&4294967295|M>>>23),M=$+(I^N&(j^I))+U[7]+1735328473&4294967295,$=j+(M<<14&4294967295|M>>>18),M=N+(j^I&($^j))+U[12]+2368359562&4294967295,N=$+(M<<20&4294967295|M>>>12),M=I+(N^$^j)+U[5]+4294588738&4294967295,I=N+(M<<4&4294967295|M>>>28),M=j+(I^N^$)+U[8]+2272392833&4294967295,j=I+(M<<11&4294967295|M>>>21),M=$+(j^I^N)+U[11]+1839030562&4294967295,$=j+(M<<16&4294967295|M>>>16),M=N+($^j^I)+U[14]+4259657740&4294967295,N=$+(M<<23&4294967295|M>>>9),M=I+(N^$^j)+U[1]+2763975236&4294967295,I=N+(M<<4&4294967295|M>>>28),M=j+(I^N^$)+U[4]+1272893353&4294967295,j=I+(M<<11&4294967295|M>>>21),M=$+(j^I^N)+U[7]+4139469664&4294967295,$=j+(M<<16&4294967295|M>>>16),M=N+($^j^I)+U[10]+3200236656&4294967295,N=$+(M<<23&4294967295|M>>>9),M=I+(N^$^j)+U[13]+681279174&4294967295,I=N+(M<<4&4294967295|M>>>28),M=j+(I^N^$)+U[0]+3936430074&4294967295,j=I+(M<<11&4294967295|M>>>21),M=$+(j^I^N)+U[3]+3572445317&4294967295,$=j+(M<<16&4294967295|M>>>16),M=N+($^j^I)+U[6]+76029189&4294967295,N=$+(M<<23&4294967295|M>>>9),M=I+(N^$^j)+U[9]+3654602809&4294967295,I=N+(M<<4&4294967295|M>>>28),M=j+(I^N^$)+U[12]+3873151461&4294967295,j=I+(M<<11&4294967295|M>>>21),M=$+(j^I^N)+U[15]+530742520&4294967295,$=j+(M<<16&4294967295|M>>>16),M=N+($^j^I)+U[2]+3299628645&4294967295,N=$+(M<<23&4294967295|M>>>9),M=I+($^(N|~j))+U[0]+4096336452&4294967295,I=N+(M<<6&4294967295|M>>>26),M=j+(N^(I|~$))+U[7]+1126891415&4294967295,j=I+(M<<10&4294967295|M>>>22),M=$+(I^(j|~N))+U[14]+2878612391&4294967295,$=j+(M<<15&4294967295|M>>>17),M=N+(j^($|~I))+U[5]+4237533241&4294967295,N=$+(M<<21&4294967295|M>>>11),M=I+($^(N|~j))+U[12]+1700485571&4294967295,I=N+(M<<6&4294967295|M>>>26),M=j+(N^(I|~$))+U[3]+2399980690&4294967295,j=I+(M<<10&4294967295|M>>>22),M=$+(I^(j|~N))+U[10]+4293915773&4294967295,$=j+(M<<15&4294967295|M>>>17),M=N+(j^($|~I))+U[1]+2240044497&4294967295,N=$+(M<<21&4294967295|M>>>11),M=I+($^(N|~j))+U[8]+1873313359&4294967295,I=N+(M<<6&4294967295|M>>>26),M=j+(N^(I|~$))+U[15]+4264355552&4294967295,j=I+(M<<10&4294967295|M>>>22),M=$+(I^(j|~N))+U[6]+2734768916&4294967295,$=j+(M<<15&4294967295|M>>>17),M=N+(j^($|~I))+U[13]+1309151649&4294967295,N=$+(M<<21&4294967295|M>>>11),M=I+($^(N|~j))+U[4]+4149444226&4294967295,I=N+(M<<6&4294967295|M>>>26),M=j+(N^(I|~$))+U[11]+3174756917&4294967295,j=I+(M<<10&4294967295|M>>>22),M=$+(I^(j|~N))+U[2]+718787259&4294967295,$=j+(M<<15&4294967295|M>>>17),M=N+(j^($|~I))+U[9]+3951481745&4294967295,O.g[0]=O.g[0]+I&4294967295,O.g[1]=O.g[1]+($+(M<<21&4294967295|M>>>11))&4294967295,O.g[2]=O.g[2]+$&4294967295,O.g[3]=O.g[3]+j&4294967295}r.prototype.v=function(O,I){I===void 0&&(I=O.length);const N=I-this.blockSize,U=this.C;let $=this.h,j=0;for(;j<I;){if($==0)for(;j<=N;)i(this,O,j),j+=this.blockSize;if(typeof O=="string"){for(;j<I;)if(U[$++]=O.charCodeAt(j++),$==this.blockSize){i(this,U),$=0;break}}else for(;j<I;)if(U[$++]=O[j++],$==this.blockSize){i(this,U),$=0;break}}this.h=$,this.o+=I},r.prototype.A=function(){var O=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);O[0]=128;for(var I=1;I<O.length-8;++I)O[I]=0;I=this.o*8;for(var N=O.length-8;N<O.length;++N)O[N]=I&255,I/=256;for(this.v(O),O=Array(16),I=0,N=0;N<4;++N)for(let U=0;U<32;U+=8)O[I++]=this.g[N]>>>U&255;return O};function o(O,I){var N=d;return Object.prototype.hasOwnProperty.call(N,O)?N[O]:N[O]=I(O)}function l(O,I){this.h=I;const N=[];let U=!0;for(let $=O.length-1;$>=0;$--){const j=O[$]|0;U&&j==I||(N[$]=j,U=!1)}this.g=N}var d={};function h(O){return-128<=O&&O<128?o(O,function(I){return new l([I|0],I<0?-1:0)}):new l([O|0],O<0?-1:0)}function m(O){if(isNaN(O)||!isFinite(O))return g;if(O<0)return S(m(-O));const I=[];let N=1;for(let U=0;O>=N;U++)I[U]=O/N|0,N*=4294967296;return new l(I,0)}function p(O,I){if(O.length==0)throw Error("number format error: empty string");if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(O.charAt(0)=="-")return S(p(O.substring(1),I));if(O.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=m(Math.pow(I,8));let U=g;for(let j=0;j<O.length;j+=8){var $=Math.min(8,O.length-j);const M=parseInt(O.substring(j,j+$),I);$<8?($=m(Math.pow(I,$)),U=U.j($).add(m(M))):(U=U.j(N),U=U.add(m(M)))}return U}var g=h(0),v=h(1),_=h(16777216);t=l.prototype,t.m=function(){if(x(this))return-S(this).m();let O=0,I=1;for(let N=0;N<this.g.length;N++){const U=this.i(N);O+=(U>=0?U:4294967296+U)*I,I*=4294967296}return O},t.toString=function(O){if(O=O||10,O<2||36<O)throw Error("radix out of range: "+O);if(E(this))return"0";if(x(this))return"-"+S(this).toString(O);const I=m(Math.pow(O,6));var N=this;let U="";for(;;){const $=L(N,I).g;N=C(N,$.j(I));let j=((N.g.length>0?N.g[0]:N.h)>>>0).toString(O);if(N=$,E(N))return j+U;for(;j.length<6;)j="0"+j;U=j+U}},t.i=function(O){return O<0?0:O<this.g.length?this.g[O]:this.h};function E(O){if(O.h!=0)return!1;for(let I=0;I<O.g.length;I++)if(O.g[I]!=0)return!1;return!0}function x(O){return O.h==-1}t.l=function(O){return O=C(this,O),x(O)?-1:E(O)?0:1};function S(O){const I=O.g.length,N=[];for(let U=0;U<I;U++)N[U]=~O.g[U];return new l(N,~O.h).add(v)}t.abs=function(){return x(this)?S(this):this},t.add=function(O){const I=Math.max(this.g.length,O.g.length),N=[];let U=0;for(let $=0;$<=I;$++){let j=U+(this.i($)&65535)+(O.i($)&65535),M=(j>>>16)+(this.i($)>>>16)+(O.i($)>>>16);U=M>>>16,j&=65535,M&=65535,N[$]=M<<16|j}return new l(N,N[N.length-1]&-2147483648?-1:0)};function C(O,I){return O.add(S(I))}t.j=function(O){if(E(this)||E(O))return g;if(x(this))return x(O)?S(this).j(S(O)):S(S(this).j(O));if(x(O))return S(this.j(S(O)));if(this.l(_)<0&&O.l(_)<0)return m(this.m()*O.m());const I=this.g.length+O.g.length,N=[];for(var U=0;U<2*I;U++)N[U]=0;for(U=0;U<this.g.length;U++)for(let $=0;$<O.g.length;$++){const j=this.i(U)>>>16,M=this.i(U)&65535,R=O.i($)>>>16,K=O.i($)&65535;N[2*U+2*$]+=M*K,T(N,2*U+2*$),N[2*U+2*$+1]+=j*K,T(N,2*U+2*$+1),N[2*U+2*$+1]+=M*R,T(N,2*U+2*$+1),N[2*U+2*$+2]+=j*R,T(N,2*U+2*$+2)}for(O=0;O<I;O++)N[O]=N[2*O+1]<<16|N[2*O];for(O=I;O<2*I;O++)N[O]=0;return new l(N,0)};function T(O,I){for(;(O[I]&65535)!=O[I];)O[I+1]+=O[I]>>>16,O[I]&=65535,I++}function A(O,I){this.g=O,this.h=I}function L(O,I){if(E(I))throw Error("division by zero");if(E(O))return new A(g,g);if(x(O))return I=L(S(O),I),new A(S(I.g),S(I.h));if(x(I))return I=L(O,S(I)),new A(S(I.g),I.h);if(O.g.length>30){if(x(O)||x(I))throw Error("slowDivide_ only works with positive integers.");for(var N=v,U=I;U.l(O)<=0;)N=F(N),U=F(U);var $=H(N,1),j=H(U,1);for(U=H(U,2),N=H(N,2);!E(U);){var M=j.add(U);M.l(O)<=0&&($=$.add(N),j=M),U=H(U,1),N=H(N,1)}return I=C(O,$.j(I)),new A($,I)}for($=g;O.l(I)>=0;){for(N=Math.max(1,Math.floor(O.m()/I.m())),U=Math.ceil(Math.log(N)/Math.LN2),U=U<=48?1:Math.pow(2,U-48),j=m(N),M=j.j(I);x(M)||M.l(O)>0;)N-=U,j=m(N),M=j.j(I);E(j)&&(j=v),$=$.add(j),O=C(O,M)}return new A($,O)}t.B=function(O){return L(this,O).h},t.and=function(O){const I=Math.max(this.g.length,O.g.length),N=[];for(let U=0;U<I;U++)N[U]=this.i(U)&O.i(U);return new l(N,this.h&O.h)},t.or=function(O){const I=Math.max(this.g.length,O.g.length),N=[];for(let U=0;U<I;U++)N[U]=this.i(U)|O.i(U);return new l(N,this.h|O.h)},t.xor=function(O){const I=Math.max(this.g.length,O.g.length),N=[];for(let U=0;U<I;U++)N[U]=this.i(U)^O.i(U);return new l(N,this.h^O.h)};function F(O){const I=O.g.length+1,N=[];for(let U=0;U<I;U++)N[U]=O.i(U)<<1|O.i(U-1)>>>31;return new l(N,O.h)}function H(O,I){const N=I>>5;I%=32;const U=O.g.length-N,$=[];for(let j=0;j<U;j++)$[j]=I>0?O.i(j+N)>>>I|O.i(j+N+1)<<32-I:O.i(j+N);return new l($,O.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,OE=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=m,l.fromString=p,_a=l}).apply(typeof Iw<"u"?Iw:typeof self<"u"?self:typeof window<"u"?window:{});var Fh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ME,xu,NE,ef,gy,PE,zE,BE;(function(){var t,e=Object.defineProperty;function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Fh=="object"&&Fh];for(var D=0;D<y.length;++D){var V=y[D];if(V&&V.Math==Math)return V}throw Error("Cannot find global object")}var r=n(this);function i(y,D){if(D)e:{var V=r;y=y.split(".");for(var Y=0;Y<y.length-1;Y++){var ge=y[Y];if(!(ge in V))break e;V=V[ge]}y=y[y.length-1],Y=V[y],D=D(Y),D!=Y&&D!=null&&e(V,y,{configurable:!0,writable:!0,value:D})}}i("Symbol.dispose",function(y){return y||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(y){return y||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(y){return y||function(D){var V=[],Y;for(Y in D)Object.prototype.hasOwnProperty.call(D,Y)&&V.push([Y,D[Y]]);return V}});var o=o||{},l=this||self;function d(y){var D=typeof y;return D=="object"&&y!=null||D=="function"}function h(y,D,V){return y.call.apply(y.bind,arguments)}function m(y,D,V){return m=h,m.apply(null,arguments)}function p(y,D){var V=Array.prototype.slice.call(arguments,1);return function(){var Y=V.slice();return Y.push.apply(Y,arguments),y.apply(this,Y)}}function g(y,D){function V(){}V.prototype=D.prototype,y.Z=D.prototype,y.prototype=new V,y.prototype.constructor=y,y.Ob=function(Y,ge,ve){for(var Be=Array(arguments.length-2),it=2;it<arguments.length;it++)Be[it-2]=arguments[it];return D.prototype[ge].apply(Y,Be)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?y=>y&&AsyncContext.Snapshot.wrap(y):y=>y;function _(y){const D=y.length;if(D>0){const V=Array(D);for(let Y=0;Y<D;Y++)V[Y]=y[Y];return V}return[]}function E(y,D){for(let Y=1;Y<arguments.length;Y++){const ge=arguments[Y];var V=typeof ge;if(V=V!="object"?V:ge?Array.isArray(ge)?"array":V:"null",V=="array"||V=="object"&&typeof ge.length=="number"){V=y.length||0;const ve=ge.length||0;y.length=V+ve;for(let Be=0;Be<ve;Be++)y[V+Be]=ge[Be]}else y.push(ge)}}class x{constructor(D,V){this.i=D,this.j=V,this.h=0,this.g=null}get(){let D;return this.h>0?(this.h--,D=this.g,this.g=D.next,D.next=null):D=this.i(),D}}function S(y){l.setTimeout(()=>{throw y},0)}function C(){var y=O;let D=null;return y.g&&(D=y.g,y.g=y.g.next,y.g||(y.h=null),D.next=null),D}class T{constructor(){this.h=this.g=null}add(D,V){const Y=A.get();Y.set(D,V),this.h?this.h.next=Y:this.g=Y,this.h=Y}}var A=new x(()=>new L,y=>y.reset());class L{constructor(){this.next=this.g=this.h=null}set(D,V){this.h=D,this.g=V,this.next=null}reset(){this.next=this.g=this.h=null}}let F,H=!1,O=new T,I=()=>{const y=Promise.resolve(void 0);F=()=>{y.then(N)}};function N(){for(var y;y=C();){try{y.h.call(y.g)}catch(V){S(V)}var D=A;D.j(y),D.h<100&&(D.h++,y.next=D.g,D.g=y)}H=!1}function U(){this.u=this.u,this.C=this.C}U.prototype.u=!1,U.prototype.dispose=function(){this.u||(this.u=!0,this.N())},U.prototype[Symbol.dispose]=function(){this.dispose()},U.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function $(y,D){this.type=y,this.g=this.target=D,this.defaultPrevented=!1}$.prototype.h=function(){this.defaultPrevented=!0};var j=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var y=!1,D=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const V=()=>{};l.addEventListener("test",V,D),l.removeEventListener("test",V,D)}catch{}return y})();function M(y){return/^[\s\xa0]*$/.test(y)}function R(y,D){$.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y&&this.init(y,D)}g(R,$),R.prototype.init=function(y,D){const V=this.type=y.type,Y=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;this.target=y.target||y.srcElement,this.g=D,D=y.relatedTarget,D||(V=="mouseover"?D=y.fromElement:V=="mouseout"&&(D=y.toElement)),this.relatedTarget=D,Y?(this.clientX=Y.clientX!==void 0?Y.clientX:Y.pageX,this.clientY=Y.clientY!==void 0?Y.clientY:Y.pageY,this.screenX=Y.screenX||0,this.screenY=Y.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=y.pointerType,this.state=y.state,this.i=y,y.defaultPrevented&&R.Z.h.call(this)},R.prototype.h=function(){R.Z.h.call(this);const y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var K="closure_listenable_"+(Math.random()*1e6|0),W=0;function q(y,D,V,Y,ge){this.listener=y,this.proxy=null,this.src=D,this.type=V,this.capture=!!Y,this.ha=ge,this.key=++W,this.da=this.fa=!1}function Z(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function X(y,D,V){for(const Y in y)D.call(V,y[Y],Y,y)}function ne(y,D){for(const V in y)D.call(void 0,y[V],V,y)}function B(y){const D={};for(const V in y)D[V]=y[V];return D}const G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(y,D){let V,Y;for(let ge=1;ge<arguments.length;ge++){Y=arguments[ge];for(V in Y)y[V]=Y[V];for(let ve=0;ve<G.length;ve++)V=G[ve],Object.prototype.hasOwnProperty.call(Y,V)&&(y[V]=Y[V])}}function ie(y){this.src=y,this.g={},this.h=0}ie.prototype.add=function(y,D,V,Y,ge){const ve=y.toString();y=this.g[ve],y||(y=this.g[ve]=[],this.h++);const Be=fe(y,D,Y,ge);return Be>-1?(D=y[Be],V||(D.fa=!1)):(D=new q(D,this.src,ve,!!Y,ge),D.fa=V,y.push(D)),D};function ae(y,D){const V=D.type;if(V in y.g){var Y=y.g[V],ge=Array.prototype.indexOf.call(Y,D,void 0),ve;(ve=ge>=0)&&Array.prototype.splice.call(Y,ge,1),ve&&(Z(D),y.g[V].length==0&&(delete y.g[V],y.h--))}}function fe(y,D,V,Y){for(let ge=0;ge<y.length;++ge){const ve=y[ge];if(!ve.da&&ve.listener==D&&ve.capture==!!V&&ve.ha==Y)return ge}return-1}var Ee="closure_lm_"+(Math.random()*1e6|0),me={};function Ce(y,D,V,Y,ge){if(Array.isArray(D)){for(let ve=0;ve<D.length;ve++)Ce(y,D[ve],V,Y,ge);return null}return V=J(V),y&&y[K]?y.J(D,V,d(Y)?!!Y.capture:!1,ge):he(y,D,V,!1,Y,ge)}function he(y,D,V,Y,ge,ve){if(!D)throw Error("Invalid event type");const Be=d(ge)?!!ge.capture:!!ge;let it=pe(y);if(it||(y[Ee]=it=new ie(y)),V=it.add(D,V,Y,Be,ve),V.proxy)return V;if(Y=Me(),V.proxy=Y,Y.src=y,Y.listener=V,y.addEventListener)j||(ge=Be),ge===void 0&&(ge=!1),y.addEventListener(D.toString(),Y,ge);else if(y.attachEvent)y.attachEvent(z(D.toString()),Y);else if(y.addListener&&y.removeListener)y.addListener(Y);else throw Error("addEventListener and attachEvent are unavailable.");return V}function Me(){function y(V){return D.call(y.src,y.listener,V)}const D=ce;return y}function qe(y,D,V,Y,ge){if(Array.isArray(D))for(var ve=0;ve<D.length;ve++)qe(y,D[ve],V,Y,ge);else Y=d(Y)?!!Y.capture:!!Y,V=J(V),y&&y[K]?(y=y.i,ve=String(D).toString(),ve in y.g&&(D=y.g[ve],V=fe(D,V,Y,ge),V>-1&&(Z(D[V]),Array.prototype.splice.call(D,V,1),D.length==0&&(delete y.g[ve],y.h--)))):y&&(y=pe(y))&&(D=y.g[D.toString()],y=-1,D&&(y=fe(D,V,Y,ge)),(V=y>-1?D[y]:null)&&Oe(V))}function Oe(y){if(typeof y!="number"&&y&&!y.da){var D=y.src;if(D&&D[K])ae(D.i,y);else{var V=y.type,Y=y.proxy;D.removeEventListener?D.removeEventListener(V,Y,y.capture):D.detachEvent?D.detachEvent(z(V),Y):D.addListener&&D.removeListener&&D.removeListener(Y),(V=pe(D))?(ae(V,y),V.h==0&&(V.src=null,D[Ee]=null)):Z(y)}}}function z(y){return y in me?me[y]:me[y]="on"+y}function ce(y,D){if(y.da)y=!0;else{D=new R(D,this);const V=y.listener,Y=y.ha||y.src;y.fa&&Oe(y),y=V.call(Y,D)}return y}function pe(y){return y=y[Ee],y instanceof ie?y:null}var ee="__closure_events_fn_"+(Math.random()*1e9>>>0);function J(y){return typeof y=="function"?y:(y[ee]||(y[ee]=function(D){return y.handleEvent(D)}),y[ee])}function se(){U.call(this),this.i=new ie(this),this.M=this,this.G=null}g(se,U),se.prototype[K]=!0,se.prototype.removeEventListener=function(y,D,V,Y){qe(this,y,D,V,Y)};function xe(y,D){var V,Y=y.G;if(Y)for(V=[];Y;Y=Y.G)V.push(Y);if(y=y.M,Y=D.type||D,typeof D=="string")D=new $(D,y);else if(D instanceof $)D.target=D.target||y;else{var ge=D;D=new $(Y,y),te(D,ge)}ge=!0;let ve,Be;if(V)for(Be=V.length-1;Be>=0;Be--)ve=D.g=V[Be],ge=Se(ve,Y,!0,D)&&ge;if(ve=D.g=y,ge=Se(ve,Y,!0,D)&&ge,ge=Se(ve,Y,!1,D)&&ge,V)for(Be=0;Be<V.length;Be++)ve=D.g=V[Be],ge=Se(ve,Y,!1,D)&&ge}se.prototype.N=function(){if(se.Z.N.call(this),this.i){var y=this.i;for(const D in y.g){const V=y.g[D];for(let Y=0;Y<V.length;Y++)Z(V[Y]);delete y.g[D],y.h--}}this.G=null},se.prototype.J=function(y,D,V,Y){return this.i.add(String(y),D,!1,V,Y)},se.prototype.K=function(y,D,V,Y){return this.i.add(String(y),D,!0,V,Y)};function Se(y,D,V,Y){if(D=y.i.g[String(D)],!D)return!0;D=D.concat();let ge=!0;for(let ve=0;ve<D.length;++ve){const Be=D[ve];if(Be&&!Be.da&&Be.capture==V){const it=Be.listener,tn=Be.ha||Be.src;Be.fa&&ae(y.i,Be),ge=it.call(tn,Y)!==!1&&ge}}return ge&&!Y.defaultPrevented}function oe(y,D){if(typeof y!="function")if(y&&typeof y.handleEvent=="function")y=m(y.handleEvent,y);else throw Error("Invalid listener argument");return Number(D)>2147483647?-1:l.setTimeout(y,D||0)}function je(y){y.g=oe(()=>{y.g=null,y.i&&(y.i=!1,je(y))},y.l);const D=y.h;y.h=null,y.m.apply(null,D)}class ze extends U{constructor(D,V){super(),this.m=D,this.l=V,this.h=null,this.i=!1,this.g=null}j(D){this.h=arguments,this.g?this.i=!0:je(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ne(y){U.call(this),this.h=y,this.g={}}g(Ne,U);var Ge=[];function xt(y){X(y.g,function(D,V){this.g.hasOwnProperty(V)&&Oe(D)},y),y.g={}}Ne.prototype.N=function(){Ne.Z.N.call(this),xt(this)},Ne.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var st=l.JSON.stringify,Gn=l.JSON.parse,ms=class{stringify(y){return l.JSON.stringify(y,void 0)}parse(y){return l.JSON.parse(y,void 0)}};function Jn(){}function ps(){}var bt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Zt(){$.call(this,"d")}g(Zt,$);function Qn(){$.call(this,"c")}g(Qn,$);var Et={},za=null;function Ti(){return za=za||new se}Et.Ia="serverreachability";function zo(y){$.call(this,Et.Ia,y)}g(zo,$);function jr(y){const D=Ti();xe(D,new zo(D))}Et.STAT_EVENT="statevent";function gs(y,D){$.call(this,Et.STAT_EVENT,y),this.stat=D}g(gs,$);function Lt(y){const D=Ti();xe(D,new gs(D,y))}Et.Ja="timingevent";function er(y,D){$.call(this,Et.Ja,y),this.size=D}g(er,$);function ys(y,D){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){y()},D)}function Qr(){this.g=!0}Qr.prototype.ua=function(){this.g=!1};function jm(y,D,V,Y,ge,ve){y.info(function(){if(y.g)if(ve){var Be="",it=ve.split("&");for(let Ct=0;Ct<it.length;Ct++){var tn=it[Ct].split("=");if(tn.length>1){const Qt=tn[0];tn=tn[1];const kr=Qt.split("_");Be=kr.length>=2&&kr[1]=="type"?Be+(Qt+"="+tn+"&"):Be+(Qt+"=redacted&")}}}else Be=null;else Be=ve;return"XMLHTTP REQ ("+Y+") [attempt "+ge+"]: "+D+`
`+V+`
`+Be})}function md(y,D,V,Y,ge,ve,Be){y.info(function(){return"XMLHTTP RESP ("+Y+") [ attempt "+ge+"]: "+D+`
`+V+`
`+ve+" "+Be})}function _s(y,D,V,Y){y.info(function(){return"XMLHTTP TEXT ("+D+"): "+Rm(y,V)+(Y?" "+Y:"")})}function Ba(y,D){y.info(function(){return"TIMEOUT: "+D})}Qr.prototype.info=function(){};function Rm(y,D){if(!y.g)return D;if(!D)return null;try{const ve=JSON.parse(D);if(ve){for(y=0;y<ve.length;y++)if(Array.isArray(ve[y])){var V=ve[y];if(!(V.length<2)){var Y=V[1];if(Array.isArray(Y)&&!(Y.length<1)){var ge=Y[0];if(ge!="noop"&&ge!="stop"&&ge!="close")for(let Be=1;Be<Y.length;Be++)Y[Be]=""}}}}return st(ve)}catch{return D}}var La={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},yc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},_c;function Ua(){}g(Ua,Jn),Ua.prototype.g=function(){return new XMLHttpRequest},_c=new Ua;function Gs(y){return encodeURIComponent(String(y))}function pd(y){var D=1;y=y.split(":");const V=[];for(;D>0&&y.length;)V.push(y.shift()),D--;return y.length&&V.push(y.join(":")),V}function Wr(y,D,V,Y){this.j=y,this.i=D,this.l=V,this.S=Y||1,this.V=new Ne(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Kr}function Kr(){this.i=null,this.g="",this.h=!1}var on={},jn={};function bs(y,D,V){y.M=1,y.A=Fa(cn(D)),y.u=V,y.R=!0,Bo(y,null)}function Bo(y,D){y.F=Date.now(),vs(y),y.B=cn(y.A);var V=y.B,Y=y.S;Array.isArray(Y)||(Y=[String(Y)]),Vo(V.i,"t",Y),y.C=0,V=y.j.L,y.h=new Kr,y.g=Dd(y.j,V?D:null,!y.u),y.P>0&&(y.O=new ze(m(y.Y,y,y.g),y.P)),D=y.V,V=y.g,Y=y.ba;var ge="readystatechange";Array.isArray(ge)||(ge&&(Ge[0]=ge.toString()),ge=Ge);for(let ve=0;ve<ge.length;ve++){const Be=Ce(V,ge[ve],Y||D.handleEvent,!1,D.h||D);if(!Be)break;D.g[Be.key]=Be}D=y.J?B(y.J):{},y.u?(y.v||(y.v="POST"),D["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.B,y.v,y.u,D)):(y.v="GET",y.g.ea(y.B,y.v,null,D)),jr(),jm(y.i,y.v,y.B,y.l,y.S,y.u)}Wr.prototype.ba=function(y){y=y.target;const D=this.O;D&&Zr(y)==3?D.j():this.Y(y)},Wr.prototype.Y=function(y){try{if(y==this.g)e:{const it=Zr(this.g),tn=this.g.ya(),Ct=this.g.ca();if(!(it<3)&&(it!=3||this.g&&(this.h.h||this.g.la()||Mn(this.g)))){this.K||it!=4||tn==7||(tn==8||Ct<=0?jr(3):jr(2)),xs(this);var D=this.g.ca();this.X=D;var V=Dm(this);if(this.o=D==200,md(this.i,this.v,this.B,this.l,this.S,it,D),this.o){if(this.U&&!this.L){t:{if(this.g){var Y,ge=this.g;if((Y=ge.g?ge.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(Y)){var ve=Y;break t}}ve=null}if(y=ve)_s(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ws(this,y);else{this.o=!1,this.m=3,Lt(12),gr(this),Rr(this);break e}}if(this.R){y=!0;let Qt;for(;!this.K&&this.C<V.length;)if(Qt=yd(this,V),Qt==jn){it==4&&(this.m=4,Lt(14),y=!1),_s(this.i,this.l,null,"[Incomplete Response]");break}else if(Qt==on){this.m=4,Lt(15),_s(this.i,this.l,V,"[Invalid Chunk]"),y=!1;break}else _s(this.i,this.l,Qt,null),ws(this,Qt);if(gd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),it!=4||V.length!=0||this.h.h||(this.m=1,Lt(16),y=!1),this.o=this.o&&y,!y)_s(this.i,this.l,V,"[Invalid Chunked Response]"),gr(this),Rr(this);else if(V.length>0&&!this.W){this.W=!0;var Be=this.j;Be.g==this&&Be.aa&&!Be.P&&(Be.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),Oc(Be),Be.P=!0,Lt(11))}}else _s(this.i,this.l,V,null),ws(this,V);it==4&&gr(this),this.o&&!this.K&&(it==4?Td(this.j,this):(this.o=!1,vs(this)))}else Ws(this.g),D==400&&V.indexOf("Unknown SID")>0?(this.m=3,Lt(12)):(this.m=0,Lt(13)),gr(this),Rr(this)}}}catch{}};function Dm(y){if(!gd(y))return y.g.la();const D=Mn(y.g);if(D==="")return"";let V="";const Y=D.length,ge=Zr(y.g)==4;if(!y.h.i){if(typeof TextDecoder>"u")return gr(y),Rr(y),"";y.h.i=new l.TextDecoder}for(let ve=0;ve<Y;ve++)y.h.h=!0,V+=y.h.i.decode(D[ve],{stream:!(ge&&ve==Y-1)});return D.length=0,y.h.g+=V,y.C=0,y.h.g}function gd(y){return y.g?y.v=="GET"&&y.M!=2&&y.j.Aa:!1}function yd(y,D){var V=y.C,Y=D.indexOf(`
`,V);return Y==-1?jn:(V=Number(D.substring(V,Y)),isNaN(V)?on:(Y+=1,Y+V>D.length?jn:(D=D.slice(Y,Y+V),y.C=Y+V,D)))}Wr.prototype.cancel=function(){this.K=!0,gr(this)};function vs(y){y.T=Date.now()+y.H,Lo(y,y.H)}function Lo(y,D){if(y.D!=null)throw Error("WatchDog timer not null");y.D=ys(m(y.aa,y),D)}function xs(y){y.D&&(l.clearTimeout(y.D),y.D=null)}Wr.prototype.aa=function(){this.D=null;const y=Date.now();y-this.T>=0?(Ba(this.i,this.B),this.M!=2&&(jr(),Lt(17)),gr(this),this.m=2,Rr(this)):Lo(this,this.T-y)};function Rr(y){y.j.I==0||y.K||Td(y.j,y)}function gr(y){xs(y);var D=y.O;D&&typeof D.dispose=="function"&&D.dispose(),y.O=null,xt(y.V),y.g&&(D=y.g,y.g=null,D.abort(),D.dispose())}function ws(y,D){try{var V=y.j;if(V.I!=0&&(V.g==y||Es(V.h,y))){if(!y.L&&Es(V.h,y)&&V.I==3){try{var Y=V.Ba.g.parse(D)}catch{Y=null}if(Array.isArray(Y)&&Y.length==3){var ge=Y;if(ge[0]==0){e:if(!V.v){if(V.g)if(V.g.F+3e3<y.F)Qo(V),Mi(V);else break e;Wa(V),Lt(18)}}else V.xa=ge[1],0<V.xa-V.K&&ge[2]<37500&&V.F&&V.A==0&&!V.C&&(V.C=ys(m(V.Va,V),6e3));Ss(V.h)<=1&&V.ta&&(V.ta=void 0)}else Ds(V,11)}else if((y.L||V.g==y)&&Qo(V),!M(D))for(ge=V.Ba.g.parse(D),D=0;D<ge.length;D++){let Ct=ge[D];const Qt=Ct[0];if(!(Qt<=V.K))if(V.K=Qt,Ct=Ct[1],V.I==2)if(Ct[0]=="c"){V.M=Ct[1],V.ba=Ct[2];const kr=Ct[3];kr!=null&&(V.ka=kr,V.j.info("VER="+V.ka));const Is=Ct[4];Is!=null&&(V.za=Is,V.j.info("SVER="+V.za));const Jr=Ct[5];Jr!=null&&typeof Jr=="number"&&Jr>0&&(Y=1.5*Jr,V.O=Y,V.j.info("backChannelRequestTimeoutMs_="+Y)),Y=V;const es=y.g;if(es){const Ka=es.g?es.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ka){var ve=Y.h;ve.g||Ka.indexOf("spdy")==-1&&Ka.indexOf("quic")==-1&&Ka.indexOf("h2")==-1||(ve.j=ve.l,ve.g=new Set,ve.h&&(xc(ve,ve.h),ve.h=null))}if(Y.G){const Wo=es.g?es.g.getResponseHeader("X-HTTP-Session-Id"):null;Wo&&(Y.wa=Wo,Rt(Y.J,Y.G,Wo))}}V.I=3,V.l&&V.l.ra(),V.aa&&(V.T=Date.now()-y.F,V.j.info("Handshake RTT: "+V.T+"ms")),Y=V;var Be=y;if(Y.na=Rd(Y,Y.L?Y.ba:null,Y.W),Be.L){wc(Y.h,Be);var it=Be,tn=Y.O;tn&&(it.H=tn),it.D&&(xs(it),vs(it)),Y.g=Be}else Ed(Y);V.i.length>0&&Rs(V)}else Ct[0]!="stop"&&Ct[0]!="close"||Ds(V,7);else V.I==3&&(Ct[0]=="stop"||Ct[0]=="close"?Ct[0]=="stop"?Ds(V,7):Ic(V):Ct[0]!="noop"&&V.l&&V.l.qa(Ct),V.A=0)}}jr(4)}catch{}}var ln=class{constructor(y,D){this.g=y,this.map=D}};function bc(y){this.l=y||10,l.PerformanceNavigationTiming?(y=l.performance.getEntriesByType("navigation"),y=y.length>0&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function vc(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function Ss(y){return y.h?1:y.g?y.g.size:0}function Es(y,D){return y.h?y.h==D:y.g?y.g.has(D):!1}function xc(y,D){y.g?y.g.add(D):y.h=D}function wc(y,D){y.h&&y.h==D?y.h=null:y.g&&y.g.has(D)&&y.g.delete(D)}bc.prototype.cancel=function(){if(this.i=Sc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function Sc(y){if(y.h!=null)return y.i.concat(y.h.G);if(y.g!=null&&y.g.size!==0){let D=y.i;for(const V of y.g.values())D=D.concat(V.G);return D}return _(y.i)}var _d=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Uo(y,D){if(y){y=y.split("&");for(let V=0;V<y.length;V++){const Y=y[V].indexOf("=");let ge,ve=null;Y>=0?(ge=y[V].substring(0,Y),ve=y[V].substring(Y+1)):ge=y[V],D(ge,ve?decodeURIComponent(ve.replace(/\+/g," ")):"")}}}function yr(y){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let D;y instanceof yr?(this.l=y.l,Rn(this,y.j),this.o=y.o,this.g=y.g,Ai(this,y.u),this.h=y.h,Ec(this,wd(y.i)),this.m=y.m):y&&(D=String(y).match(_d))?(this.l=!1,Rn(this,D[1]||"",!0),this.o=Cs(D[2]||""),this.g=Cs(D[3]||"",!0),Ai(this,D[4]),this.h=Cs(D[5]||"",!0),Ec(this,D[6]||"",!0),this.m=Cs(D[7]||"")):(this.l=!1,this.i=new Ri(null,this.l))}yr.prototype.toString=function(){const y=[];var D=this.j;D&&y.push(Va(D,Fo,!0),":");var V=this.g;return(V||D=="file")&&(y.push("//"),(D=this.o)&&y.push(Va(D,Fo,!0),"@"),y.push(Gs(V).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),V=this.u,V!=null&&y.push(":",String(V))),(V=this.h)&&(this.g&&V.charAt(0)!="/"&&y.push("/"),y.push(Va(V,V.charAt(0)=="/"?Cc:bd,!0))),(V=this.i.toString())&&y.push("?",V),(V=this.m)&&y.push("#",Va(V,vd)),y.join("")},yr.prototype.resolve=function(y){const D=cn(this);let V=!!y.j;V?Rn(D,y.j):V=!!y.o,V?D.o=y.o:V=!!y.g,V?D.g=y.g:V=y.u!=null;var Y=y.h;if(V)Ai(D,y.u);else if(V=!!y.h){if(Y.charAt(0)!="/")if(this.g&&!this.h)Y="/"+Y;else{var ge=D.h.lastIndexOf("/");ge!=-1&&(Y=D.h.slice(0,ge+1)+Y)}if(ge=Y,ge==".."||ge==".")Y="";else if(ge.indexOf("./")!=-1||ge.indexOf("/.")!=-1){Y=ge.lastIndexOf("/",0)==0,ge=ge.split("/");const ve=[];for(let Be=0;Be<ge.length;){const it=ge[Be++];it=="."?Y&&Be==ge.length&&ve.push(""):it==".."?((ve.length>1||ve.length==1&&ve[0]!="")&&ve.pop(),Y&&Be==ge.length&&ve.push("")):(ve.push(it),Y=!0)}Y=ve.join("/")}else Y=ge}return V?D.h=Y:V=y.i.toString()!=="",V?Ec(D,wd(y.i)):V=!!y.m,V&&(D.m=y.m),D};function cn(y){return new yr(y)}function Rn(y,D,V){y.j=V?Cs(D,!0):D,y.j&&(y.j=y.j.replace(/:$/,""))}function Ai(y,D){if(D){if(D=Number(D),isNaN(D)||D<0)throw Error("Bad port number "+D);y.u=D}else y.u=null}function Ec(y,D,V){D instanceof Ri?(y.i=D,$o(y.i,y.l)):(V||(D=Va(D,ji)),y.i=new Ri(D,y.l))}function Rt(y,D,V){y.i.set(D,V)}function Fa(y){return Rt(y,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),y}function Cs(y,D){return y?D?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function Va(y,D,V){return typeof y=="string"?(y=encodeURI(y).replace(D,ir),V&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function ir(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var Fo=/[#\/\?@]/g,bd=/[#\?:]/g,Cc=/[#\?]/g,ji=/[#\?@]/g,vd=/#/g;function Ri(y,D){this.h=this.g=null,this.i=y||null,this.j=!!D}function ar(y){y.g||(y.g=new Map,y.h=0,y.i&&Uo(y.i,function(D,V){y.add(decodeURIComponent(D.replace(/\+/g," ")),V)}))}t=Ri.prototype,t.add=function(y,D){ar(this),this.i=null,y=Di(this,y);let V=this.g.get(y);return V||this.g.set(y,V=[]),V.push(D),this.h+=1,this};function xd(y,D){ar(y),D=Di(y,D),y.g.has(D)&&(y.i=null,y.h-=y.g.get(D).length,y.g.delete(D))}function Tc(y,D){return ar(y),D=Di(y,D),y.g.has(D)}t.forEach=function(y,D){ar(this),this.g.forEach(function(V,Y){V.forEach(function(ge){y.call(D,ge,Y,this)},this)},this)};function Ac(y,D){ar(y);let V=[];if(typeof D=="string")Tc(y,D)&&(V=V.concat(y.g.get(Di(y,D))));else for(y=Array.from(y.g.values()),D=0;D<y.length;D++)V=V.concat(y[D]);return V}t.set=function(y,D){return ar(this),this.i=null,y=Di(this,y),Tc(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[D]),this.h+=1,this},t.get=function(y,D){return y?(y=Ac(this,y),y.length>0?String(y[0]):D):D};function Vo(y,D,V){xd(y,D),V.length>0&&(y.i=null,y.g.set(Di(y,D),_(V)),y.h+=V.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],D=Array.from(this.g.keys());for(let Y=0;Y<D.length;Y++){var V=D[Y];const ge=Gs(V);V=Ac(this,V);for(let ve=0;ve<V.length;ve++){let Be=ge;V[ve]!==""&&(Be+="="+Gs(V[ve])),y.push(Be)}}return this.i=y.join("&")};function wd(y){const D=new Ri;return D.i=y.i,y.g&&(D.g=new Map(y.g),D.h=y.h),D}function Di(y,D){return D=String(D),y.j&&(D=D.toLowerCase()),D}function $o(y,D){D&&!y.j&&(ar(y),y.i=null,y.g.forEach(function(V,Y){const ge=Y.toLowerCase();Y!=ge&&(xd(this,Y),Vo(this,ge,V))},y)),y.j=D}function Yr(y,D){const V=new Qr;if(l.Image){const Y=new Image;Y.onload=p(Dr,V,"TestLoadImage: loaded",!0,D,Y),Y.onerror=p(Dr,V,"TestLoadImage: error",!1,D,Y),Y.onabort=p(Dr,V,"TestLoadImage: abort",!1,D,Y),Y.ontimeout=p(Dr,V,"TestLoadImage: timeout",!1,D,Y),l.setTimeout(function(){Y.ontimeout&&Y.ontimeout()},1e4),Y.src=y}else D(!1)}function jc(y,D){const V=new Qr,Y=new AbortController,ge=setTimeout(()=>{Y.abort(),Dr(V,"TestPingServer: timeout",!1,D)},1e4);fetch(y,{signal:Y.signal}).then(ve=>{clearTimeout(ge),ve.ok?Dr(V,"TestPingServer: ok",!0,D):Dr(V,"TestPingServer: server error",!1,D)}).catch(()=>{clearTimeout(ge),Dr(V,"TestPingServer: error",!1,D)})}function Dr(y,D,V,Y,ge){try{ge&&(ge.onload=null,ge.onerror=null,ge.onabort=null,ge.ontimeout=null),Y(V)}catch{}}function Ii(){this.g=new ms}function Ts(y){this.i=y.Sb||null,this.h=y.ab||!1}g(Ts,Jn),Ts.prototype.g=function(){return new $a(this.i,this.h)};function $a(y,D){se.call(this),this.H=y,this.o=D,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g($a,se),t=$a.prototype,t.open=function(y,D){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=y,this.D=D,this.readyState=1,Xr(this)},t.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const D={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};y&&(D.body=y),(this.H||l).fetch(new Request(this.D,D)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,ki(this)),this.readyState=0},t.Pa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,Xr(this)),this.g&&(this.readyState=3,Xr(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;qo(this)}else y.text().then(this.Oa.bind(this),this.ga.bind(this))};function qo(y){y.j.read().then(y.Ma.bind(y)).catch(y.ga.bind(y))}t.Ma=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var D=y.value?y.value:new Uint8Array(0);(D=this.B.decode(D,{stream:!y.done}))&&(this.response=this.responseText+=D)}y.done?ki(this):Xr(this),this.readyState==3&&qo(this)}},t.Oa=function(y){this.g&&(this.response=this.responseText=y,ki(this))},t.Na=function(y){this.g&&(this.response=y,ki(this))},t.ga=function(){this.g&&ki(this)};function ki(y){y.readyState=4,y.l=null,y.j=null,y.B=null,Xr(y)}t.setRequestHeader=function(y,D){this.A.append(y,D)},t.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],D=this.h.entries();for(var V=D.next();!V.done;)V=V.value,y.push(V[0]+": "+V[1]),V=D.next();return y.join(`\r
`)};function Xr(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty($a.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Ir(y){let D="";return X(y,function(V,Y){D+=Y,D+=":",D+=V,D+=`\r
`}),D}function qa(y,D,V){e:{for(Y in V){var Y=!1;break e}Y=!0}Y||(V=Ir(V),typeof y=="string"?V!=null&&Gs(V):Rt(y,D,V))}function kt(y){se.call(this),this.headers=new Map,this.L=y||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(kt,se);var As=/^https?$/i,Rc=["POST","PUT"];t=kt.prototype,t.Fa=function(y){this.H=y},t.ea=function(y,D,V,Y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);D=D?D.toUpperCase():"GET",this.D=y,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():_c.g(),this.g.onreadystatechange=v(m(this.Ca,this));try{this.B=!0,this.g.open(D,String(y),!0),this.B=!1}catch(ve){Ha(this,ve);return}if(y=V||"",V=new Map(this.headers),Y)if(Object.getPrototypeOf(Y)===Object.prototype)for(var ge in Y)V.set(ge,Y[ge]);else if(typeof Y.keys=="function"&&typeof Y.get=="function")for(const ve of Y.keys())V.set(ve,Y.get(ve));else throw Error("Unknown input type for opt_headers: "+String(Y));Y=Array.from(V.keys()).find(ve=>ve.toLowerCase()=="content-type"),ge=l.FormData&&y instanceof l.FormData,!(Array.prototype.indexOf.call(Rc,D,void 0)>=0)||Y||ge||V.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ve,Be]of V)this.g.setRequestHeader(ve,Be);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(y),this.v=!1}catch(ve){Ha(this,ve)}};function Ha(y,D){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=D,y.o=5,Dc(y),Qs(y)}function Dc(y){y.A||(y.A=!0,xe(y,"complete"),xe(y,"error"))}t.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=y||7,xe(this,"complete"),xe(this,"abort"),Qs(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Qs(this,!0)),kt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Ga(this):this.Xa())},t.Xa=function(){Ga(this)};function Ga(y){if(y.h&&typeof o<"u"){if(y.v&&Zr(y)==4)setTimeout(y.Ca.bind(y),0);else if(xe(y,"readystatechange"),Zr(y)==4){y.h=!1;try{const ve=y.ca();e:switch(ve){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var D=!0;break e;default:D=!1}var V;if(!(V=D)){var Y;if(Y=ve===0){let Be=String(y.D).match(_d)[1]||null;!Be&&l.self&&l.self.location&&(Be=l.self.location.protocol.slice(0,-1)),Y=!As.test(Be?Be.toLowerCase():"")}V=Y}if(V)xe(y,"complete"),xe(y,"success");else{y.o=6;try{var ge=Zr(y)>2?y.g.statusText:""}catch{ge=""}y.l=ge+" ["+y.ca()+"]",Dc(y)}}finally{Qs(y)}}}}function Qs(y,D){if(y.g){y.m&&(clearTimeout(y.m),y.m=null);const V=y.g;y.g=null,D||xe(y,"ready");try{V.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Zr(y){return y.g?y.g.readyState:0}t.ca=function(){try{return Zr(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(y){if(this.g){var D=this.g.responseText;return y&&D.indexOf(y)==0&&(D=D.substring(y.length)),Gn(D)}};function Mn(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.F){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function Ws(y){const D={};y=(y.g&&Zr(y)>=2&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let Y=0;Y<y.length;Y++){if(M(y[Y]))continue;var V=pd(y[Y]);const ge=V[0];if(V=V[1],typeof V!="string")continue;V=V.trim();const ve=D[ge]||[];D[ge]=ve,ve.push(V)}ne(D,function(Y){return Y.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function js(y,D,V){return V&&V.internalChannelParams&&V.internalChannelParams[y]||D}function Oi(y){this.za=0,this.i=[],this.j=new Qr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=js("failFast",!1,y),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=js("baseRetryDelayMs",5e3,y),this.Za=js("retryDelaySeedMs",1e4,y),this.Ta=js("forwardChannelMaxRetries",2,y),this.va=js("forwardChannelRequestTimeoutMs",2e4,y),this.ma=y&&y.xmlHttpFactory||void 0,this.Ua=y&&y.Rb||void 0,this.Aa=y&&y.useFetchStreams||!1,this.O=void 0,this.L=y&&y.supportsCrossDomainXhr||!1,this.M="",this.h=new bc(y&&y.concurrentRequestLimit),this.Ba=new Ii,this.S=y&&y.fastHandshake||!1,this.R=y&&y.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=y&&y.Pb||!1,y&&y.ua&&this.j.ua(),y&&y.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&y&&y.detectBufferingProxy||!1,this.ia=void 0,y&&y.longPollingTimeout&&y.longPollingTimeout>0&&(this.ia=y.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Oi.prototype,t.ka=8,t.I=1,t.connect=function(y,D,V,Y){Lt(0),this.W=y,this.H=D||{},V&&Y!==void 0&&(this.H.OSID=V,this.H.OAID=Y),this.F=this.X,this.J=Rd(this,null,this.W),Rs(this)};function Ic(y){if(Ho(y),y.I==3){var D=y.V++,V=cn(y.J);if(Rt(V,"SID",y.M),Rt(V,"RID",D),Rt(V,"TYPE","terminate"),Qa(y,V),D=new Wr(y,y.j,D),D.M=2,D.A=Fa(cn(V)),V=!1,l.navigator&&l.navigator.sendBeacon)try{V=l.navigator.sendBeacon(D.A.toString(),"")}catch{}!V&&l.Image&&(new Image().src=D.A,V=!0),V||(D.g=Dd(D.j,null),D.g.ea(D.A)),D.F=Date.now(),vs(D)}jd(y)}function Mi(y){y.g&&(Oc(y),y.g.cancel(),y.g=null)}function Ho(y){Mi(y),y.v&&(l.clearTimeout(y.v),y.v=null),Qo(y),y.h.cancel(),y.m&&(typeof y.m=="number"&&l.clearTimeout(y.m),y.m=null)}function Rs(y){if(!vc(y.h)&&!y.m){y.m=!0;var D=y.Ea;F||I(),H||(F(),H=!0),O.add(D,y),y.D=0}}function Go(y,D){return Ss(y.h)>=y.h.j-(y.m?1:0)?!1:y.m?(y.i=D.G.concat(y.i),!0):y.I==1||y.I==2||y.D>=(y.Sa?0:y.Ta)?!1:(y.m=ys(m(y.Ea,y,D),Ad(y,y.D)),y.D++,!0)}t.Ea=function(y){if(this.m)if(this.m=null,this.I==1){if(!y){this.V=Math.floor(Math.random()*1e5),y=this.V++;const ge=new Wr(this,this.j,y);let ve=this.o;if(this.U&&(ve?(ve=B(ve),te(ve,this.U)):ve=this.U),this.u!==null||this.R||(ge.J=ve,ve=null),this.S)e:{for(var D=0,V=0;V<this.i.length;V++){t:{var Y=this.i[V];if("__data__"in Y.map&&(Y=Y.map.__data__,typeof Y=="string")){Y=Y.length;break t}Y=void 0}if(Y===void 0)break;if(D+=Y,D>4096){D=V;break e}if(D===4096||V===this.i.length-1){D=V+1;break e}}D=1e3}else D=1e3;D=Sd(this,ge,D),V=cn(this.J),Rt(V,"RID",y),Rt(V,"CVER",22),this.G&&Rt(V,"X-HTTP-Session-Id",this.G),Qa(this,V),ve&&(this.R?D="headers="+Gs(Ir(ve))+"&"+D:this.u&&qa(V,this.u,ve)),xc(this.h,ge),this.Ra&&Rt(V,"TYPE","init"),this.S?(Rt(V,"$req",D),Rt(V,"SID","null"),ge.U=!0,bs(ge,V,null)):bs(ge,V,D),this.I=2}}else this.I==3&&(y?kc(this,y):this.i.length==0||vc(this.h)||kc(this))};function kc(y,D){var V;D?V=D.l:V=y.V++;const Y=cn(y.J);Rt(Y,"SID",y.M),Rt(Y,"RID",V),Rt(Y,"AID",y.K),Qa(y,Y),y.u&&y.o&&qa(Y,y.u,y.o),V=new Wr(y,y.j,V,y.D+1),y.u===null&&(V.J=y.o),D&&(y.i=D.G.concat(y.i)),D=Sd(y,V,1e3),V.H=Math.round(y.va*.5)+Math.round(y.va*.5*Math.random()),xc(y.h,V),bs(V,Y,D)}function Qa(y,D){y.H&&X(y.H,function(V,Y){Rt(D,Y,V)}),y.l&&X({},function(V,Y){Rt(D,Y,V)})}function Sd(y,D,V){V=Math.min(y.i.length,V);const Y=y.l?m(y.l.Ka,y.l,y):null;e:{var ge=y.i;let it=-1;for(;;){const tn=["count="+V];it==-1?V>0?(it=ge[0].g,tn.push("ofs="+it)):it=0:tn.push("ofs="+it);let Ct=!0;for(let Qt=0;Qt<V;Qt++){var ve=ge[Qt].g;const kr=ge[Qt].map;if(ve-=it,ve<0)it=Math.max(0,ge[Qt].g-100),Ct=!1;else try{ve="req"+ve+"_"||"";try{var Be=kr instanceof Map?kr:Object.entries(kr);for(const[Is,Jr]of Be){let es=Jr;d(Jr)&&(es=st(Jr)),tn.push(ve+Is+"="+encodeURIComponent(es))}}catch(Is){throw tn.push(ve+"type="+encodeURIComponent("_badmap")),Is}}catch{Y&&Y(kr)}}if(Ct){Be=tn.join("&");break e}}Be=void 0}return y=y.i.splice(0,V),D.G=y,Be}function Ed(y){if(!y.g&&!y.v){y.Y=1;var D=y.Da;F||I(),H||(F(),H=!0),O.add(D,y),y.A=0}}function Wa(y){return y.g||y.v||y.A>=3?!1:(y.Y++,y.v=ys(m(y.Da,y),Ad(y,y.A)),y.A++,!0)}t.Da=function(){if(this.v=null,Cd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var y=4*this.T;this.j.info("BP detection timer enabled: "+y),this.B=ys(m(this.Wa,this),y)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Lt(10),Mi(this),Cd(this))};function Oc(y){y.B!=null&&(l.clearTimeout(y.B),y.B=null)}function Cd(y){y.g=new Wr(y,y.j,"rpc",y.Y),y.u===null&&(y.g.J=y.o),y.g.P=0;var D=cn(y.na);Rt(D,"RID","rpc"),Rt(D,"SID",y.M),Rt(D,"AID",y.K),Rt(D,"CI",y.F?"0":"1"),!y.F&&y.ia&&Rt(D,"TO",y.ia),Rt(D,"TYPE","xmlhttp"),Qa(y,D),y.u&&y.o&&qa(D,y.u,y.o),y.O&&(y.g.H=y.O);var V=y.g;y=y.ba,V.M=1,V.A=Fa(cn(D)),V.u=null,V.R=!0,Bo(V,y)}t.Va=function(){this.C!=null&&(this.C=null,Mi(this),Wa(this),Lt(19))};function Qo(y){y.C!=null&&(l.clearTimeout(y.C),y.C=null)}function Td(y,D){var V=null;if(y.g==D){Qo(y),Oc(y),y.g=null;var Y=2}else if(Es(y.h,D))V=D.G,wc(y.h,D),Y=1;else return;if(y.I!=0){if(D.o)if(Y==1){V=D.u?D.u.length:0,D=Date.now()-D.F;var ge=y.D;Y=Ti(),xe(Y,new er(Y,V)),Rs(y)}else Ed(y);else if(ge=D.m,ge==3||ge==0&&D.X>0||!(Y==1&&Go(y,D)||Y==2&&Wa(y)))switch(V&&V.length>0&&(D=y.h,D.i=D.i.concat(V)),ge){case 1:Ds(y,5);break;case 4:Ds(y,10);break;case 3:Ds(y,6);break;default:Ds(y,2)}}}function Ad(y,D){let V=y.Qa+Math.floor(Math.random()*y.Za);return y.isActive()||(V*=2),V*D}function Ds(y,D){if(y.j.info("Error code "+D),D==2){var V=m(y.bb,y),Y=y.Ua;const ge=!Y;Y=new yr(Y||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Rn(Y,"https"),Fa(Y),ge?Yr(Y.toString(),V):jc(Y.toString(),V)}else Lt(2);y.I=0,y.l&&y.l.pa(D),jd(y),Ho(y)}t.bb=function(y){y?(this.j.info("Successfully pinged google.com"),Lt(2)):(this.j.info("Failed to ping google.com"),Lt(1))};function jd(y){if(y.I=0,y.ja=[],y.l){const D=Sc(y.h);(D.length!=0||y.i.length!=0)&&(E(y.ja,D),E(y.ja,y.i),y.h.i.length=0,_(y.i),y.i.length=0),y.l.oa()}}function Rd(y,D,V){var Y=V instanceof yr?cn(V):new yr(V);if(Y.g!="")D&&(Y.g=D+"."+Y.g),Ai(Y,Y.u);else{var ge=l.location;Y=ge.protocol,D=D?D+"."+ge.hostname:ge.hostname,ge=+ge.port;const ve=new yr(null);Y&&Rn(ve,Y),D&&(ve.g=D),ge&&Ai(ve,ge),V&&(ve.h=V),Y=ve}return V=y.G,D=y.wa,V&&D&&Rt(Y,V,D),Rt(Y,"VER",y.ka),Qa(y,Y),Y}function Dd(y,D,V){if(D&&!y.L)throw Error("Can't create secondary domain capable XhrIo object.");return D=y.Aa&&!y.ma?new kt(new Ts({ab:V})):new kt(y.ma),D.Fa(y.L),D}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Id(){}t=Id.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Ni(){}Ni.prototype.g=function(y,D){return new tr(y,D)};function tr(y,D){se.call(this),this.g=new Oi(D),this.l=y,this.h=D&&D.messageUrlParams||null,y=D&&D.messageHeaders||null,D&&D.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=D&&D.initMessageHeaders||null,D&&D.messageContentType&&(y?y["X-WebChannel-Content-Type"]=D.messageContentType:y={"X-WebChannel-Content-Type":D.messageContentType}),D&&D.sa&&(y?y["X-WebChannel-Client-Profile"]=D.sa:y={"X-WebChannel-Client-Profile":D.sa}),this.g.U=y,(y=D&&D.Qb)&&!M(y)&&(this.g.u=y),this.A=D&&D.supportsCrossDomainXhr||!1,this.v=D&&D.sendRawJson||!1,(D=D&&D.httpSessionIdParam)&&!M(D)&&(this.g.G=D,y=this.h,y!==null&&D in y&&(y=this.h,D in y&&delete y[D])),this.j=new Ks(this)}g(tr,se),tr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tr.prototype.close=function(){Ic(this.g)},tr.prototype.o=function(y){var D=this.g;if(typeof y=="string"){var V={};V.__data__=y,y=V}else this.v&&(V={},V.__data__=st(y),y=V);D.i.push(new ln(D.Ya++,y)),D.I==3&&Rs(D)},tr.prototype.N=function(){this.g.l=null,delete this.j,Ic(this.g),delete this.g,tr.Z.N.call(this)};function kd(y){Zt.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var D=y.__sm__;if(D){e:{for(const V in D){y=V;break e}y=void 0}(this.i=y)&&(y=this.i,D=D!==null&&y in D?D[y]:void 0),this.data=D}else this.data=y}g(kd,Zt);function Od(){Qn.call(this),this.status=1}g(Od,Qn);function Ks(y){this.g=y}g(Ks,Id),Ks.prototype.ra=function(){xe(this.g,"a")},Ks.prototype.qa=function(y){xe(this.g,new kd(y))},Ks.prototype.pa=function(y){xe(this.g,new Od)},Ks.prototype.oa=function(){xe(this.g,"b")},Ni.prototype.createWebChannel=Ni.prototype.g,tr.prototype.send=tr.prototype.o,tr.prototype.open=tr.prototype.m,tr.prototype.close=tr.prototype.close,BE=function(){return new Ni},zE=function(){return Ti()},PE=Et,gy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},La.NO_ERROR=0,La.TIMEOUT=8,La.HTTP_ERROR=6,ef=La,yc.COMPLETE="complete",NE=yc,ps.EventType=bt,bt.OPEN="a",bt.CLOSE="b",bt.ERROR="c",bt.MESSAGE="d",se.prototype.listen=se.prototype.J,xu=ps,kt.prototype.listenOnce=kt.prototype.K,kt.prototype.getLastError=kt.prototype.Ha,kt.prototype.getLastErrorCode=kt.prototype.ya,kt.prototype.getStatus=kt.prototype.ca,kt.prototype.getResponseJson=kt.prototype.La,kt.prototype.getResponseText=kt.prototype.la,kt.prototype.send=kt.prototype.ea,kt.prototype.setWithCredentials=kt.prototype.Fa,ME=kt}).apply(typeof Fh<"u"?Fh:typeof self<"u"?self:typeof window<"u"?window:{});const kw="@firebase/firestore",Ow="4.9.3";class Yn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Yn.UNAUTHENTICATED=new Yn(null),Yn.GOOGLE_CREDENTIALS=new Yn("google-credentials-uid"),Yn.FIRST_PARTY=new Yn("first-party-uid"),Yn.MOCK_USER=new Yn("mock-user");let oc="12.7.0";const To=new Ky("@firebase/firestore");function jl(){return To.logLevel}function Ue(t,...e){if(To.logLevel<=mt.DEBUG){const n=e.map(a0);To.debug(`Firestore (${oc}): ${t}`,...n)}}function vi(t,...e){if(To.logLevel<=mt.ERROR){const n=e.map(a0);To.error(`Firestore (${oc}): ${t}`,...n)}}function Fl(t,...e){if(To.logLevel<=mt.WARN){const n=e.map(a0);To.warn(`Firestore (${oc}): ${t}`,...n)}}function a0(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Xe(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,LE(t,r,n)}function LE(t,e,n){let r=`FIRESTORE (${oc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw vi(r),new Error(r)}function jt(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||LE(e,i,r)}function rt(t,e){return t}const Re={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Le extends Ei{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class pi{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class UE{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class vO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Yn.UNAUTHENTICATED)))}shutdown(){}}class xO{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class wO{constructor(e){this.t=e,this.currentUser=Yn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){jt(this.o===void 0,42304);let r=this.i;const i=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new pi;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new pi,e.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await i(this.currentUser)}))},d=h=>{Ue("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>d(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?d(h):(Ue("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new pi)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Ue("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(jt(typeof r.accessToken=="string",31837,{l:r}),new UE(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return jt(e===null||typeof e=="string",2055,{h:e}),new Yn(e)}}class SO{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Yn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class EO{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new SO(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Yn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Mw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class CO{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ss(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){jt(this.o===void 0,3512);const r=o=>{o.error!=null&&Ue("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Ue("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const i=o=>{Ue("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>i(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):Ue("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Mw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(jt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Mw(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function TO(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class o0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=TO(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%62))}return r}}function pt(t,e){return t<e?-1:t>e?1:0}function yy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),o=e.charAt(r);if(i!==o)return Ug(i)===Ug(o)?pt(i,o):Ug(i)?1:-1}return pt(t.length,e.length)}const AO=55296,jO=57343;function Ug(t){const e=t.charCodeAt(0);return e>=AO&&e<=jO}function Vl(t,e,n){return t.length===e.length&&t.every(((r,i)=>n(r,e[i])))}const Nw="__name__";class zs{constructor(e,n,r){n===void 0?n=0:n>e.length&&Xe(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Xe(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return zs.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof zs?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=zs.compareSegments(e.get(i),n.get(i));if(o!==0)return o}return pt(e.length,n.length)}static compareSegments(e,n){const r=zs.isNumericId(e),i=zs.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?zs.extractNumericId(e).compare(zs.extractNumericId(n)):yy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return _a.fromString(e.substring(4,e.length-2))}}class Ut extends zs{construct(e,n,r){return new Ut(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Le(Re.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((i=>i.length>0)))}return new Ut(n)}static emptyPath(){return new Ut([])}}const RO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Un extends zs{construct(e,n,r){return new Un(e,n,r)}static isValidIdentifier(e){return RO.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Un.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Nw}static keyField(){return new Un([Nw])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new Le(Re.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;i<e.length;){const d=e[i];if(d==="\\"){if(i+1===e.length)throw new Le(Re.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Le(Re.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else d==="`"?(l=!l,i++):d!=="."||l?(r+=d,i++):(o(),i++)}if(o(),l)throw new Le(Re.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Un(n)}static emptyPath(){return new Un([])}}class We{constructor(e){this.path=e}static fromPath(e){return new We(Ut.fromString(e))}static fromName(e){return new We(Ut.fromString(e).popFirst(5))}static empty(){return new We(Ut.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ut.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ut.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new We(new Ut(e.slice()))}}function FE(t,e,n){if(!n)throw new Le(Re.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function DO(t,e,n,r){if(e===!0&&r===!0)throw new Le(Re.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Pw(t){if(!We.isDocumentKey(t))throw new Le(Re.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function zw(t){if(We.isDocumentKey(t))throw new Le(Re.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function VE(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Kf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Xe(12329,{type:typeof t})}function us(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Le(Re.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Kf(t);throw new Le(Re.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function yn(t,e){const n={typeString:t};return e&&(n.value=e),n}function nd(t,e){if(!VE(t))throw new Le(Re.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(i&&typeof l!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Le(Re.INVALID_ARGUMENT,n);return!0}const Bw=-62135596800,Lw=1e6;class Ht{static now(){return Ht.fromMillis(Date.now())}static fromDate(e){return Ht.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Lw);return new Ht(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Le(Re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Le(Re.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Bw)throw new Le(Re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Le(Re.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Lw}_compareTo(e){return this.seconds===e.seconds?pt(this.nanoseconds,e.nanoseconds):pt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ht._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(nd(e,Ht._jsonSchema))return new Ht(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Bw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ht._jsonSchemaVersion="firestore/timestamp/1.0",Ht._jsonSchema={type:yn("string",Ht._jsonSchemaVersion),seconds:yn("number"),nanoseconds:yn("number")};class et{static fromTimestamp(e){return new et(e)}static min(){return new et(new Ht(0,0))}static max(){return new et(new Ht(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Pu=-1;function IO(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=et.fromTimestamp(r===1e9?new Ht(n+1,0):new Ht(n,r));return new va(i,We.empty(),e)}function kO(t){return new va(t.readTime,t.key,Pu)}class va{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new va(et.min(),We.empty(),Pu)}static max(){return new va(et.max(),We.empty(),Pu)}}function OO(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=We.comparator(t.documentKey,e.documentKey),n!==0?n:pt(t.largestBatchId,e.largestBatchId))}const MO="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class NO{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function lc(t){if(t.code!==Re.FAILED_PRECONDITION||t.message!==MO)throw t;Ue("LocalStore","Unexpectedly lost primary lease")}class Ie{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Xe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new Ie(((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof Ie?n:Ie.resolve(n)}catch(n){return Ie.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):Ie.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):Ie.reject(n)}static resolve(e){return new Ie(((n,r)=>{n(e)}))}static reject(e){return new Ie(((n,r)=>{r(e)}))}static waitFor(e){return new Ie(((n,r)=>{let i=0,o=0,l=!1;e.forEach((d=>{++i,d.next((()=>{++o,l&&o===i&&n()}),(h=>r(h)))})),l=!0,o===i&&n()}))}static or(e){let n=Ie.resolve(!1);for(const r of e)n=n.next((i=>i?Ie.resolve(i):r()));return n}static forEach(e,n){const r=[];return e.forEach(((i,o)=>{r.push(n.call(this,i,o))})),this.waitFor(r)}static mapArray(e,n){return new Ie(((r,i)=>{const o=e.length,l=new Array(o);let d=0;for(let h=0;h<o;h++){const m=h;n(e[m]).next((p=>{l[m]=p,++d,d===o&&r(l)}),(p=>i(p)))}}))}static doWhile(e,n){return new Ie(((r,i)=>{const o=()=>{e()===!0?n().next((()=>{o()}),i):r()};o()}))}}function PO(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function cc(t){return t.name==="IndexedDbTransactionError"}class Yf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Yf.ce=-1;const l0=-1;function Xf(t){return t==null}function _f(t){return t===0&&1/t==-1/0}function zO(t){return typeof t=="number"&&Number.isInteger(t)&&!_f(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const $E="";function BO(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Uw(e)),e=LO(t.get(n),e);return Uw(e)}function LO(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case $E:n+="";break;default:n+=o}}return n}function Uw(t){return t+$E+""}function Fw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ia(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function qE(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Xt{constructor(e,n){this.comparator=e,this.root=n||Ln.EMPTY}insert(e,n){return new Xt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Ln.BLACK,null,null))}remove(e){return new Xt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ln.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Vh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Vh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Vh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Vh(this.root,e,this.comparator,!0)}}class Vh{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ln{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??Ln.RED,this.left=i??Ln.EMPTY,this.right=o??Ln.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new Ln(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ln.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Ln.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ln.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ln.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Xe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Xe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Xe(27949);return e+(this.isRed()?0:1)}}Ln.EMPTY=null,Ln.RED=!0,Ln.BLACK=!1;Ln.EMPTY=new class{constructor(){this.size=0}get key(){throw Xe(57766)}get value(){throw Xe(16141)}get color(){throw Xe(16727)}get left(){throw Xe(29726)}get right(){throw Xe(36894)}copy(e,n,r,i,o){return this}insert(e,n,r){return new Ln(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Tn{constructor(e){this.comparator=e,this.data=new Xt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Vw(this.data.getIterator())}getIteratorFrom(e){return new Vw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof Tn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new Tn(this.comparator);return n.data=e,n}}class Vw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Cr{constructor(e){this.fields=e,e.sort(Un.comparator)}static empty(){return new Cr([])}unionWith(e){let n=new Tn(Un.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Cr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Vl(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class HE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class $n{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new HE("Invalid base64 string: "+o):o}})(e);return new $n(n)}static fromUint8Array(e){const n=(function(i){let o="";for(let l=0;l<i.length;++l)o+=String.fromCharCode(i[l]);return o})(e);return new $n(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return pt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$n.EMPTY_BYTE_STRING=new $n("");const UO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xa(t){if(jt(!!t,39018),typeof t=="string"){let e=0;const n=UO.exec(t);if(jt(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:sn(t.seconds),nanos:sn(t.nanos)}}function sn(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function wa(t){return typeof t=="string"?$n.fromBase64String(t):$n.fromUint8Array(t)}const GE="server_timestamp",QE="__type__",WE="__previous_value__",KE="__local_write_time__";function c0(t){return(t?.mapValue?.fields||{})[QE]?.stringValue===GE}function Zf(t){const e=t.mapValue.fields[WE];return c0(e)?Zf(e):e}function zu(t){const e=xa(t.mapValue.fields[KE].timestampValue);return new Ht(e.seconds,e.nanos)}class FO{constructor(e,n,r,i,o,l,d,h,m,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=d,this.longPollingOptions=h,this.useFetchStreams=m,this.isUsingEmulator=p}}const bf="(default)";class Bu{constructor(e,n){this.projectId=e,this.database=n||bf}static empty(){return new Bu("","")}get isDefaultDatabase(){return this.database===bf}isEqual(e){return e instanceof Bu&&e.projectId===this.projectId&&e.database===this.database}}const YE="__type__",VO="__max__",$h={mapValue:{}},XE="__vector__",vf="value";function Sa(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?c0(t)?4:qO(t)?9007199254740991:$O(t)?10:11:Xe(28295,{value:t})}function Hs(t,e){if(t===e)return!0;const n=Sa(t);if(n!==Sa(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return zu(t).isEqual(zu(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const l=xa(i.timestampValue),d=xa(o.timestampValue);return l.seconds===d.seconds&&l.nanos===d.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(i,o){return wa(i.bytesValue).isEqual(wa(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(i,o){return sn(i.geoPointValue.latitude)===sn(o.geoPointValue.latitude)&&sn(i.geoPointValue.longitude)===sn(o.geoPointValue.longitude)})(t,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return sn(i.integerValue)===sn(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const l=sn(i.doubleValue),d=sn(o.doubleValue);return l===d?_f(l)===_f(d):isNaN(l)&&isNaN(d)}return!1})(t,e);case 9:return Vl(t.arrayValue.values||[],e.arrayValue.values||[],Hs);case 10:case 11:return(function(i,o){const l=i.mapValue.fields||{},d=o.mapValue.fields||{};if(Fw(l)!==Fw(d))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(d[h]===void 0||!Hs(l[h],d[h])))return!1;return!0})(t,e);default:return Xe(52216,{left:t})}}function Lu(t,e){return(t.values||[]).find((n=>Hs(n,e)))!==void 0}function $l(t,e){if(t===e)return 0;const n=Sa(t),r=Sa(e);if(n!==r)return pt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return pt(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const d=sn(o.integerValue||o.doubleValue),h=sn(l.integerValue||l.doubleValue);return d<h?-1:d>h?1:d===h?0:isNaN(d)?isNaN(h)?0:-1:1})(t,e);case 3:return $w(t.timestampValue,e.timestampValue);case 4:return $w(zu(t),zu(e));case 5:return yy(t.stringValue,e.stringValue);case 6:return(function(o,l){const d=wa(o),h=wa(l);return d.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const d=o.split("/"),h=l.split("/");for(let m=0;m<d.length&&m<h.length;m++){const p=pt(d[m],h[m]);if(p!==0)return p}return pt(d.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const d=pt(sn(o.latitude),sn(l.latitude));return d!==0?d:pt(sn(o.longitude),sn(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return qw(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const d=o.fields||{},h=l.fields||{},m=d[vf]?.arrayValue,p=h[vf]?.arrayValue,g=pt(m?.values?.length||0,p?.values?.length||0);return g!==0?g:qw(m,p)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===$h.mapValue&&l===$h.mapValue)return 0;if(o===$h.mapValue)return 1;if(l===$h.mapValue)return-1;const d=o.fields||{},h=Object.keys(d),m=l.fields||{},p=Object.keys(m);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const v=yy(h[g],p[g]);if(v!==0)return v;const _=$l(d[h[g]],m[p[g]]);if(_!==0)return _}return pt(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Xe(23264,{he:n})}}function $w(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return pt(t,e);const n=xa(t),r=xa(e),i=pt(n.seconds,r.seconds);return i!==0?i:pt(n.nanos,r.nanos)}function qw(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=$l(n[i],r[i]);if(o)return o}return pt(n.length,r.length)}function ql(t){return _y(t)}function _y(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=xa(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return wa(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return We.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=_y(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const l of r)o?o=!1:i+=",",i+=`${l}:${_y(n.fields[l])}`;return i+"}"})(t.mapValue):Xe(61005,{value:t})}function tf(t){switch(Sa(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Zf(t);return e?16+tf(e):16;case 5:return 2*t.stringValue.length;case 6:return wa(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,o)=>i+tf(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let i=0;return Ia(r.fields,((o,l)=>{i+=o.length+tf(l)})),i})(t.mapValue);default:throw Xe(13486,{value:t})}}function Hw(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function by(t){return!!t&&"integerValue"in t}function u0(t){return!!t&&"arrayValue"in t}function Gw(t){return!!t&&"nullValue"in t}function Qw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function nf(t){return!!t&&"mapValue"in t}function $O(t){return(t?.mapValue?.fields||{})[YE]?.stringValue===XE}function Au(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Ia(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Au(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Au(t.arrayValue.values[n]);return e}return{...t}}function qO(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===VO}class fr{constructor(e){this.value=e}static empty(){return new fr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!nf(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Au(n)}setAll(e){let n=Un.emptyPath(),r={},i=[];e.forEach(((l,d)=>{if(!n.isImmediateParentOf(d)){const h=this.getFieldsMap(n);this.applyChanges(h,r,i),r={},i=[],n=d.popLast()}l?r[d.lastSegment()]=Au(l):i.push(d.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());nf(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Hs(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];nf(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Ia(n,((i,o)=>e[i]=o));for(const i of r)delete e[i]}clone(){return new fr(Au(this.value))}}function ZE(t){const e=[];return Ia(t.fields,((n,r)=>{const i=new Un([n]);if(nf(r)){const o=ZE(r.mapValue).fields;if(o.length===0)e.push(i);else for(const l of o)e.push(i.child(l))}else e.push(i)})),new Cr(e)}class Xn{constructor(e,n,r,i,o,l,d){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=l,this.documentState=d}static newInvalidDocument(e){return new Xn(e,0,et.min(),et.min(),et.min(),fr.empty(),0)}static newFoundDocument(e,n,r,i){return new Xn(e,1,n,et.min(),r,i,0)}static newNoDocument(e,n){return new Xn(e,2,n,et.min(),et.min(),fr.empty(),0)}static newUnknownDocument(e,n){return new Xn(e,3,n,et.min(),et.min(),fr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(et.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=fr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=fr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=et.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Xn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Xn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class xf{constructor(e,n){this.position=e,this.inclusive=n}}function Ww(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],l=t.position[i];if(o.field.isKeyField()?r=We.comparator(We.fromName(l.referenceValue),n.key):r=$l(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Kw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Hs(t.position[n],e.position[n]))return!1;return!0}class wf{constructor(e,n="asc"){this.field=e,this.dir=n}}function HO(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class JE{}class gn extends JE{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new QO(e,n,r):n==="array-contains"?new YO(e,r):n==="in"?new XO(e,r):n==="not-in"?new ZO(e,r):n==="array-contains-any"?new JO(e,r):new gn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new WO(e,r):new KO(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison($l(n,this.value)):n!==null&&Sa(this.value)===Sa(n)&&this.matchesComparison($l(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Xe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ds extends JE{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ds(e,n)}matches(e){return eC(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function eC(t){return t.op==="and"}function tC(t){return GO(t)&&eC(t)}function GO(t){for(const e of t.filters)if(e instanceof ds)return!1;return!0}function vy(t){if(t instanceof gn)return t.field.canonicalString()+t.op.toString()+ql(t.value);if(tC(t))return t.filters.map((e=>vy(e))).join(",");{const e=t.filters.map((n=>vy(n))).join(",");return`${t.op}(${e})`}}function nC(t,e){return t instanceof gn?(function(r,i){return i instanceof gn&&r.op===i.op&&r.field.isEqual(i.field)&&Hs(r.value,i.value)})(t,e):t instanceof ds?(function(r,i){return i instanceof ds&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((o,l,d)=>o&&nC(l,i.filters[d])),!0):!1})(t,e):void Xe(19439)}function rC(t){return t instanceof gn?(function(n){return`${n.field.canonicalString()} ${n.op} ${ql(n.value)}`})(t):t instanceof ds?(function(n){return n.op.toString()+" {"+n.getFilters().map(rC).join(" ,")+"}"})(t):"Filter"}class QO extends gn{constructor(e,n,r){super(e,n,r),this.key=We.fromName(r.referenceValue)}matches(e){const n=We.comparator(e.key,this.key);return this.matchesComparison(n)}}class WO extends gn{constructor(e,n){super(e,"in",n),this.keys=sC("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class KO extends gn{constructor(e,n){super(e,"not-in",n),this.keys=sC("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function sC(t,e){return(e.arrayValue?.values||[]).map((n=>We.fromName(n.referenceValue)))}class YO extends gn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return u0(n)&&Lu(n.arrayValue,this.value)}}class XO extends gn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Lu(this.value.arrayValue,n)}}class ZO extends gn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Lu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Lu(this.value.arrayValue,n)}}class JO extends gn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!u0(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Lu(this.value.arrayValue,r)))}}class eM{constructor(e,n=null,r=[],i=[],o=null,l=null,d=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=l,this.endAt=d,this.Te=null}}function Yw(t,e=null,n=[],r=[],i=null,o=null,l=null){return new eM(t,e,n,r,i,o,l)}function d0(t){const e=rt(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>vy(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Xf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>ql(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>ql(r))).join(",")),e.Te=n}return e.Te}function h0(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!HO(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!nC(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Kw(t.startAt,e.startAt)&&Kw(t.endAt,e.endAt)}function xy(t){return We.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class rd{constructor(e,n=null,r=[],i=[],o=null,l="F",d=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=l,this.startAt=d,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function tM(t,e,n,r,i,o,l,d){return new rd(t,e,n,r,i,o,l,d)}function f0(t){return new rd(t)}function Xw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function iC(t){return t.collectionGroup!==null}function ju(t){const e=rt(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let d=new Tn(Un.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((m=>{m.isInequality()&&(d=d.add(m.field))}))})),d})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new wf(o,r))})),n.has(Un.keyField().canonicalString())||e.Ie.push(new wf(Un.keyField(),r))}return e.Ie}function Fs(t){const e=rt(t);return e.Ee||(e.Ee=nM(e,ju(t))),e.Ee}function nM(t,e){if(t.limitType==="F")return Yw(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((i=>{const o=i.dir==="desc"?"asc":"desc";return new wf(i.field,o)}));const n=t.endAt?new xf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new xf(t.startAt.position,t.startAt.inclusive):null;return Yw(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function wy(t,e){const n=t.filters.concat([e]);return new rd(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Sy(t,e,n){return new rd(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Jf(t,e){return h0(Fs(t),Fs(e))&&t.limitType===e.limitType}function aC(t){return`${d0(Fs(t))}|lt:${t.limitType}`}function Rl(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((i=>rC(i))).join(", ")}]`),Xf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((i=>ql(i))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((i=>ql(i))).join(",")),`Target(${r})`})(Fs(t))}; limitType=${t.limitType})`}function em(t,e){return e.isFoundDocument()&&(function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):We.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,i){for(const o of ju(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0})(t,e)&&(function(r,i){return!(r.startAt&&!(function(l,d,h){const m=Ww(l,d,h);return l.inclusive?m<=0:m<0})(r.startAt,ju(r),i)||r.endAt&&!(function(l,d,h){const m=Ww(l,d,h);return l.inclusive?m>=0:m>0})(r.endAt,ju(r),i))})(t,e)}function rM(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function oC(t){return(e,n)=>{let r=!1;for(const i of ju(t)){const o=sM(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function sM(t,e,n){const r=t.field.isKeyField()?We.comparator(e.key,n.key):(function(o,l,d){const h=l.data.field(o),m=d.data.field(o);return h!==null&&m!==null?$l(h,m):Xe(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Xe(19790,{direction:t.dir})}}class Io{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ia(this.inner,((n,r)=>{for(const[i,o]of r)e(i,o)}))}isEmpty(){return qE(this.inner)}size(){return this.innerSize}}const iM=new Xt(We.comparator);function xi(){return iM}const lC=new Xt(We.comparator);function wu(...t){let e=lC;for(const n of t)e=e.insert(n.key,n);return e}function cC(t){let e=lC;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function yo(){return Ru()}function uC(){return Ru()}function Ru(){return new Io((t=>t.toString()),((t,e)=>t.isEqual(e)))}const aM=new Xt(We.comparator),oM=new Tn(We.comparator);function gt(...t){let e=oM;for(const n of t)e=e.add(n);return e}const lM=new Tn(pt);function cM(){return lM}function m0(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_f(e)?"-0":e}}function dC(t){return{integerValue:""+t}}function uM(t,e){return zO(e)?dC(e):m0(t,e)}class tm{constructor(){this._=void 0}}function dM(t,e,n){return t instanceof Sf?(function(i,o){const l={fields:{[QE]:{stringValue:GE},[KE]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&c0(o)&&(o=Zf(o)),o&&(l.fields[WE]=o),{mapValue:l}})(n,e):t instanceof Hl?fC(t,e):t instanceof Gl?mC(t,e):(function(i,o){const l=hC(i,o),d=Zw(l)+Zw(i.Ae);return by(l)&&by(i.Ae)?dC(d):m0(i.serializer,d)})(t,e)}function hM(t,e,n){return t instanceof Hl?fC(t,e):t instanceof Gl?mC(t,e):n}function hC(t,e){return t instanceof Ef?(function(r){return by(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class Sf extends tm{}class Hl extends tm{constructor(e){super(),this.elements=e}}function fC(t,e){const n=pC(e);for(const r of t.elements)n.some((i=>Hs(i,r)))||n.push(r);return{arrayValue:{values:n}}}class Gl extends tm{constructor(e){super(),this.elements=e}}function mC(t,e){let n=pC(e);for(const r of t.elements)n=n.filter((i=>!Hs(i,r)));return{arrayValue:{values:n}}}class Ef extends tm{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function Zw(t){return sn(t.integerValue||t.doubleValue)}function pC(t){return u0(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class gC{constructor(e,n){this.field=e,this.transform=n}}function fM(t,e){return t.field.isEqual(e.field)&&(function(r,i){return r instanceof Hl&&i instanceof Hl||r instanceof Gl&&i instanceof Gl?Vl(r.elements,i.elements,Hs):r instanceof Ef&&i instanceof Ef?Hs(r.Ae,i.Ae):r instanceof Sf&&i instanceof Sf})(t.transform,e.transform)}class mM{constructor(e,n){this.version=e,this.transformResults=n}}class mr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new mr}static exists(e){return new mr(void 0,e)}static updateTime(e){return new mr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rf(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class nm{}function yC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new rm(t.key,mr.none()):new sd(t.key,t.data,mr.none());{const n=t.data,r=fr.empty();let i=new Tn(Un.comparator);for(let o of e.fields)if(!i.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),i=i.add(o)}return new ka(t.key,r,new Cr(i.toArray()),mr.none())}}function pM(t,e,n){t instanceof sd?(function(i,o,l){const d=i.value.clone(),h=e1(i.fieldTransforms,o,l.transformResults);d.setAll(h),o.convertToFoundDocument(l.version,d).setHasCommittedMutations()})(t,e,n):t instanceof ka?(function(i,o,l){if(!rf(i.precondition,o))return void o.convertToUnknownDocument(l.version);const d=e1(i.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(_C(i)),h.setAll(d),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(i,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function Du(t,e,n,r){return t instanceof sd?(function(o,l,d,h){if(!rf(o.precondition,l))return d;const m=o.value.clone(),p=t1(o.fieldTransforms,h,l);return m.setAll(p),l.convertToFoundDocument(l.version,m).setHasLocalMutations(),null})(t,e,n,r):t instanceof ka?(function(o,l,d,h){if(!rf(o.precondition,l))return d;const m=t1(o.fieldTransforms,h,l),p=l.data;return p.setAll(_C(o)),p.setAll(m),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),d===null?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,l,d){return rf(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):d})(t,e,n)}function gM(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=hC(r.transform,i||null);o!=null&&(n===null&&(n=fr.empty()),n.set(r.field,o))}return n||null}function Jw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Vl(r,i,((o,l)=>fM(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class sd extends nm{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ka extends nm{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function _C(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function e1(t,e,n){const r=new Map;jt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const o=t[i],l=o.transform,d=e.data.field(o.field);r.set(o.field,hM(l,d,n[i]))}return r}function t1(t,e,n){const r=new Map;for(const i of t){const o=i.transform,l=n.data.field(i.field);r.set(i.field,dM(o,l,e))}return r}class rm extends nm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class yM extends nm{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class _M{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&pM(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Du(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Du(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=uC();return this.mutations.forEach((i=>{const o=e.get(i.key),l=o.overlayedDocument;let d=this.applyToLocalView(l,o.mutatedFields);d=n.has(i.key)?null:d;const h=yC(l,d);h!==null&&r.set(i.key,h),l.isValidDocument()||l.convertToNoDocument(et.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),gt())}isEqual(e){return this.batchId===e.batchId&&Vl(this.mutations,e.mutations,((n,r)=>Jw(n,r)))&&Vl(this.baseMutations,e.baseMutations,((n,r)=>Jw(n,r)))}}class p0{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){jt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return aM})();const o=e.mutations;for(let l=0;l<o.length;l++)i=i.insert(o[l].key,r[l].version);return new p0(e,n,r,i)}}class bM{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class vM{constructor(e,n){this.count=e,this.unchangedNames=n}}var mn,_t;function xM(t){switch(t){case Re.OK:return Xe(64938);case Re.CANCELLED:case Re.UNKNOWN:case Re.DEADLINE_EXCEEDED:case Re.RESOURCE_EXHAUSTED:case Re.INTERNAL:case Re.UNAVAILABLE:case Re.UNAUTHENTICATED:return!1;case Re.INVALID_ARGUMENT:case Re.NOT_FOUND:case Re.ALREADY_EXISTS:case Re.PERMISSION_DENIED:case Re.FAILED_PRECONDITION:case Re.ABORTED:case Re.OUT_OF_RANGE:case Re.UNIMPLEMENTED:case Re.DATA_LOSS:return!0;default:return Xe(15467,{code:t})}}function bC(t){if(t===void 0)return vi("GRPC error has no .code"),Re.UNKNOWN;switch(t){case mn.OK:return Re.OK;case mn.CANCELLED:return Re.CANCELLED;case mn.UNKNOWN:return Re.UNKNOWN;case mn.DEADLINE_EXCEEDED:return Re.DEADLINE_EXCEEDED;case mn.RESOURCE_EXHAUSTED:return Re.RESOURCE_EXHAUSTED;case mn.INTERNAL:return Re.INTERNAL;case mn.UNAVAILABLE:return Re.UNAVAILABLE;case mn.UNAUTHENTICATED:return Re.UNAUTHENTICATED;case mn.INVALID_ARGUMENT:return Re.INVALID_ARGUMENT;case mn.NOT_FOUND:return Re.NOT_FOUND;case mn.ALREADY_EXISTS:return Re.ALREADY_EXISTS;case mn.PERMISSION_DENIED:return Re.PERMISSION_DENIED;case mn.FAILED_PRECONDITION:return Re.FAILED_PRECONDITION;case mn.ABORTED:return Re.ABORTED;case mn.OUT_OF_RANGE:return Re.OUT_OF_RANGE;case mn.UNIMPLEMENTED:return Re.UNIMPLEMENTED;case mn.DATA_LOSS:return Re.DATA_LOSS;default:return Xe(39323,{code:t})}}(_t=mn||(mn={}))[_t.OK=0]="OK",_t[_t.CANCELLED=1]="CANCELLED",_t[_t.UNKNOWN=2]="UNKNOWN",_t[_t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_t[_t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_t[_t.NOT_FOUND=5]="NOT_FOUND",_t[_t.ALREADY_EXISTS=6]="ALREADY_EXISTS",_t[_t.PERMISSION_DENIED=7]="PERMISSION_DENIED",_t[_t.UNAUTHENTICATED=16]="UNAUTHENTICATED",_t[_t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_t[_t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_t[_t.ABORTED=10]="ABORTED",_t[_t.OUT_OF_RANGE=11]="OUT_OF_RANGE",_t[_t.UNIMPLEMENTED=12]="UNIMPLEMENTED",_t[_t.INTERNAL=13]="INTERNAL",_t[_t.UNAVAILABLE=14]="UNAVAILABLE",_t[_t.DATA_LOSS=15]="DATA_LOSS";function wM(){return new TextEncoder}const SM=new _a([4294967295,4294967295],0);function n1(t){const e=wM().encode(t),n=new OE;return n.update(e),new Uint8Array(n.digest())}function r1(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new _a([n,r],0),new _a([i,o],0)]}class g0{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Su(`Invalid padding: ${n}`);if(r<0)throw new Su(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Su(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Su(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=_a.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(_a.fromNumber(r)));return i.compare(SM)===1&&(i=new _a([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=n1(e),[r,i]=r1(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new g0(o,i,n);return r.forEach((d=>l.insert(d))),l}insert(e){if(this.ge===0)return;const n=n1(e),[r,i]=r1(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,i,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Su extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class sm{constructor(e,n,r,i,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,id.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new sm(et.min(),i,new Xt(pt),xi(),gt())}}class id{constructor(e,n,r,i,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new id(r,n,gt(),gt(),gt())}}class sf{constructor(e,n,r,i){this.be=e,this.removedTargetIds=n,this.key=r,this.De=i}}class vC{constructor(e,n){this.targetId=e,this.Ce=n}}class xC{constructor(e,n,r=$n.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class s1{constructor(){this.ve=0,this.Fe=i1(),this.Me=$n.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=gt(),n=gt(),r=gt();return this.Fe.forEach(((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Xe(38017,{changeType:o})}})),new id(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=i1()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,jt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class EM{constructor(e){this.Ge=e,this.ze=new Map,this.je=xi(),this.Je=qh(),this.He=qh(),this.Ye=new Xt(pt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Xe(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,i)=>{this.rt(i)&&n(i)}))}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const o=i.target;if(xy(o))if(r===0){const l=new We(o.path);this.et(n,l,Xn.newNoDocument(l,et.min()))}else jt(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const d=this.ut(e),h=d?this.ct(d,e,l):1;if(h!==0){this.it(n);const m=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,m)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let l,d;try{l=wa(r).toUint8Array()}catch(h){if(h instanceof HE)return Fl("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{d=new g0(l,i,o)}catch(h){return Fl(h instanceof Su?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return d.ge===0?null:d}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach((o=>{const l=this.Ge.ht(),d=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.et(n,o,null),i++)})),i}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const d=this.ot(l);if(d){if(o.current&&xy(d.target)){const h=new We(d.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Xn.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=gt();this.He.forEach(((o,l)=>{let d=!0;l.forEachWhile((h=>{const m=this.ot(h);return!m||m.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const i=new sm(e,n,this.Ye,this.je,r);return this.je=xi(),this.Je=qh(),this.He=qh(),this.Ye=new Xt(pt),i}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.Qe(n,1):i.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new s1,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new Tn(pt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new Tn(pt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Ue("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new s1),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function qh(){return new Xt(We.comparator)}function i1(){return new Xt(We.comparator)}const CM={asc:"ASCENDING",desc:"DESCENDING"},TM={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},AM={and:"AND",or:"OR"};class jM{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Ey(t,e){return t.useProto3Json||Xf(e)?e:{value:e}}function Cf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function wC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function RM(t,e){return Cf(t,e.toTimestamp())}function Vs(t){return jt(!!t,49232),et.fromTimestamp((function(n){const r=xa(n);return new Ht(r.seconds,r.nanos)})(t))}function y0(t,e){return Cy(t,e).canonicalString()}function Cy(t,e){const n=(function(i){return new Ut(["projects",i.projectId,"databases",i.database])})(t).child("documents");return e===void 0?n:n.child(e)}function SC(t){const e=Ut.fromString(t);return jt(jC(e),10190,{key:e.toString()}),e}function Ty(t,e){return y0(t.databaseId,e.path)}function Fg(t,e){const n=SC(e);if(n.get(1)!==t.databaseId.projectId)throw new Le(Re.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Le(Re.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new We(CC(n))}function EC(t,e){return y0(t.databaseId,e)}function DM(t){const e=SC(t);return e.length===4?Ut.emptyPath():CC(e)}function Ay(t){return new Ut(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function CC(t){return jt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function a1(t,e,n){return{name:Ty(t,e),fields:n.value.mapValue.fields}}function IM(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:Xe(39313,{state:m})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(m,p){return m.useProto3Json?(jt(p===void 0||typeof p=="string",58123),$n.fromBase64String(p||"")):(jt(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),$n.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,d=l&&(function(m){const p=m.code===void 0?Re.UNKNOWN:bC(m.code);return new Le(p,m.message||"")})(l);n=new xC(r,i,o,d||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Fg(t,r.document.name),o=Vs(r.document.updateTime),l=r.document.createTime?Vs(r.document.createTime):et.min(),d=new fr({mapValue:{fields:r.document.fields}}),h=Xn.newFoundDocument(i,o,l,d),m=r.targetIds||[],p=r.removedTargetIds||[];n=new sf(m,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Fg(t,r.document),o=r.readTime?Vs(r.readTime):et.min(),l=Xn.newNoDocument(i,o),d=r.removedTargetIds||[];n=new sf([],d,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Fg(t,r.document),o=r.removedTargetIds||[];n=new sf([],o,i,null)}else{if(!("filter"in e))return Xe(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,l=new vM(i,o),d=r.targetId;n=new vC(d,l)}}return n}function kM(t,e){let n;if(e instanceof sd)n={update:a1(t,e.key,e.value)};else if(e instanceof rm)n={delete:Ty(t,e.key)};else if(e instanceof ka)n={update:a1(t,e.key,e.data),updateMask:FM(e.fieldMask)};else{if(!(e instanceof yM))return Xe(16599,{Vt:e.type});n={verify:Ty(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const d=l.transform;if(d instanceof Sf)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Hl)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof Gl)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof Ef)return{fieldPath:l.field.canonicalString(),increment:d.Ae};throw Xe(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:RM(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Xe(27497)})(t,e.precondition)),n}function OM(t,e){return t&&t.length>0?(jt(e!==void 0,14353),t.map((n=>(function(i,o){let l=i.updateTime?Vs(i.updateTime):Vs(o);return l.isEqual(et.min())&&(l=Vs(o)),new mM(l,i.transformResults||[])})(n,e)))):[]}function MM(t,e){return{documents:[EC(t,e.path)]}}function NM(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=EC(t,i);const o=(function(m){if(m.length!==0)return AC(ds.create(m,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(m){if(m.length!==0)return m.map((p=>(function(v){return{field:Dl(v.field),direction:BM(v.dir)}})(p)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const d=Ey(t,e.limit);return d!==null&&(n.structuredQuery.limit=d),e.startAt&&(n.structuredQuery.startAt=(function(m){return{before:m.inclusive,values:m.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(m){return{before:!m.inclusive,values:m.position}})(e.endAt)),{ft:n,parent:i}}function PM(t){let e=DM(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){jt(r===1,65062);const p=n.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const v=TC(g);return v instanceof ds&&tC(v)?v.getFilters():[v]})(n.where));let l=[];n.orderBy&&(l=(function(g){return g.map((v=>(function(E){return new wf(Il(E.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(E.direction))})(v)))})(n.orderBy));let d=null;n.limit&&(d=(function(g){let v;return v=typeof g=="object"?g.value:g,Xf(v)?null:v})(n.limit));let h=null;n.startAt&&(h=(function(g){const v=!!g.before,_=g.values||[];return new xf(_,v)})(n.startAt));let m=null;return n.endAt&&(m=(function(g){const v=!g.before,_=g.values||[];return new xf(_,v)})(n.endAt)),tM(e,i,l,o,d,"F",h,m)}function zM(t,e){const n=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Xe(28987,{purpose:i})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function TC(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Il(n.unaryFilter.field);return gn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Il(n.unaryFilter.field);return gn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Il(n.unaryFilter.field);return gn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Il(n.unaryFilter.field);return gn.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Xe(61313);default:return Xe(60726)}})(t):t.fieldFilter!==void 0?(function(n){return gn.create(Il(n.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Xe(58110);default:return Xe(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return ds.create(n.compositeFilter.filters.map((r=>TC(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Xe(1026)}})(n.compositeFilter.op))})(t):Xe(30097,{filter:t})}function BM(t){return CM[t]}function LM(t){return TM[t]}function UM(t){return AM[t]}function Dl(t){return{fieldPath:t.canonicalString()}}function Il(t){return Un.fromServerFormat(t.fieldPath)}function AC(t){return t instanceof gn?(function(n){if(n.op==="=="){if(Qw(n.value))return{unaryFilter:{field:Dl(n.field),op:"IS_NAN"}};if(Gw(n.value))return{unaryFilter:{field:Dl(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Qw(n.value))return{unaryFilter:{field:Dl(n.field),op:"IS_NOT_NAN"}};if(Gw(n.value))return{unaryFilter:{field:Dl(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dl(n.field),op:LM(n.op),value:n.value}}})(t):t instanceof ds?(function(n){const r=n.getFilters().map((i=>AC(i)));return r.length===1?r[0]:{compositeFilter:{op:UM(n.op),filters:r}}})(t):Xe(54877,{filter:t})}function FM(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function jC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class da{constructor(e,n,r,i,o=et.min(),l=et.min(),d=$n.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=d,this.expectedCount=h}withSequenceNumber(e){return new da(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class VM{constructor(e){this.yt=e}}function $M(t){const e=PM({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Sy(e,e.limit,"L"):e}class qM{constructor(){this.Cn=new HM}addToCollectionParentIndex(e,n){return this.Cn.add(n),Ie.resolve()}getCollectionParents(e,n){return Ie.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return Ie.resolve()}deleteFieldIndex(e,n){return Ie.resolve()}deleteAllFieldIndexes(e){return Ie.resolve()}createTargetIndexes(e,n){return Ie.resolve()}getDocumentsMatchingTarget(e,n){return Ie.resolve(null)}getIndexType(e,n){return Ie.resolve(0)}getFieldIndexes(e,n){return Ie.resolve([])}getNextCollectionGroupToUpdate(e){return Ie.resolve(null)}getMinOffset(e,n){return Ie.resolve(va.min())}getMinOffsetFromCollectionGroup(e,n){return Ie.resolve(va.min())}updateCollectionGroup(e,n,r){return Ie.resolve()}updateIndexEntries(e,n){return Ie.resolve()}}class HM{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new Tn(Ut.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Tn(Ut.comparator)).toArray()}}const o1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},RC=41943040;class hr{static withCacheSize(e){return new hr(e,hr.DEFAULT_COLLECTION_PERCENTILE,hr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}hr.DEFAULT_COLLECTION_PERCENTILE=10,hr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hr.DEFAULT=new hr(RC,hr.DEFAULT_COLLECTION_PERCENTILE,hr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hr.DISABLED=new hr(-1,0,0);class Ql{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ql(0)}static cr(){return new Ql(-1)}}const l1="LruGarbageCollector",GM=1048576;function c1([t,e],[n,r]){const i=pt(t,n);return i===0?pt(e,r):i}class QM{constructor(e){this.Ir=e,this.buffer=new Tn(c1),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();c1(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class WM{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ue(l1,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){cc(n)?Ue(l1,"Ignoring IndexedDB error during garbage collection: ",n):await lc(n)}await this.Vr(3e5)}))}}class KM{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return Ie.resolve(Yf.ce);const r=new QM(n);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Ue("LruGarbageCollector","Garbage collection skipped; disabled"),Ie.resolve(o1)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Ue("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),o1):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,i,o,l,d,h,m;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Ue("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,l=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,d=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(m=Date.now(),jl()<=mt.DEBUG&&Ue("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-p}ms
	Determined least recently used ${i} in `+(d-l)+`ms
	Removed ${o} targets in `+(h-d)+`ms
	Removed ${g} documents in `+(m-h)+`ms
Total Duration: ${m-p}ms`),Ie.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:g}))))}}function YM(t,e){return new KM(t,e)}class XM{constructor(){this.changes=new Io((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Xn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?Ie.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ZM{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class JM{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,n)))).next((i=>(r!==null&&Du(r.mutation,i,Cr.empty(),Ht.now()),i)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,gt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=gt()){const i=yo();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,r).next((o=>{let l=wu();return o.forEach(((d,h)=>{l=l.insert(d,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=yo();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,gt())))}populateOverlays(e,n,r){const i=[];return r.forEach((o=>{n.has(o)||i.push(o)})),this.documentOverlayCache.getOverlays(e,i).next((o=>{o.forEach(((l,d)=>{n.set(l,d)}))}))}computeViews(e,n,r,i){let o=xi();const l=Ru(),d=(function(){return Ru()})();return n.forEach(((h,m)=>{const p=r.get(m.key);i.has(m.key)&&(p===void 0||p.mutation instanceof ka)?o=o.insert(m.key,m):p!==void 0?(l.set(m.key,p.mutation.getFieldMask()),Du(p.mutation,m,p.mutation.getFieldMask(),Ht.now())):l.set(m.key,Cr.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((m,p)=>l.set(m,p))),n.forEach(((m,p)=>d.set(m,new ZM(p,l.get(m)??null)))),d)))}recalculateAndSaveOverlays(e,n){const r=Ru();let i=new Xt(((l,d)=>l-d)),o=gt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const d of l)d.keys().forEach((h=>{const m=n.get(h);if(m===null)return;let p=r.get(h)||Cr.empty();p=d.applyToLocalView(m,p),r.set(h,p);const g=(i.get(d.batchId)||gt()).add(h);i=i.insert(d.batchId,g)}))})).next((()=>{const l=[],d=i.getReverseIterator();for(;d.hasNext();){const h=d.getNext(),m=h.key,p=h.value,g=uC();p.forEach((v=>{if(!o.has(v)){const _=yC(n.get(v),r.get(v));_!==null&&g.set(v,_),o=o.add(v)}})),l.push(this.documentOverlayCache.saveOverlays(e,m,g))}return Ie.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,i){return(function(l){return We.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):iC(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next((o=>{const l=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):Ie.resolve(yo());let d=Pu,h=o;return l.next((m=>Ie.forEach(m,((p,g)=>(d<g.largestBatchId&&(d=g.largestBatchId),o.get(p)?Ie.resolve():this.remoteDocumentCache.getEntry(e,p).next((v=>{h=h.insert(p,v)}))))).next((()=>this.populateOverlays(e,m,o))).next((()=>this.computeViews(e,h,m,gt()))).next((p=>({batchId:d,changes:cC(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new We(n)).next((r=>{let i=wu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let l=wu();return this.indexManager.getCollectionParents(e,o).next((d=>Ie.forEach(d,(h=>{const m=(function(g,v){return new rd(v,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,r,i).next((p=>{p.forEach(((g,v)=>{l=l.insert(g,v)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i)))).next((l=>{o.forEach(((h,m)=>{const p=m.getKey();l.get(p)===null&&(l=l.insert(p,Xn.newInvalidDocument(p)))}));let d=wu();return l.forEach(((h,m)=>{const p=o.get(h);p!==void 0&&Du(p.mutation,m,Cr.empty(),Ht.now()),em(n,m)&&(d=d.insert(h,m))})),d}))}}class eN{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return Ie.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(i){return{id:i.id,version:i.version,createTime:Vs(i.createTime)}})(n)),Ie.resolve()}getNamedQuery(e,n){return Ie.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(i){return{name:i.name,query:$M(i.bundledQuery),readTime:Vs(i.readTime)}})(n)),Ie.resolve()}}class tN{constructor(){this.overlays=new Xt(We.comparator),this.qr=new Map}getOverlay(e,n){return Ie.resolve(this.overlays.get(n))}getOverlays(e,n){const r=yo();return Ie.forEach(n,(i=>this.getOverlay(e,i).next((o=>{o!==null&&r.set(i,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((i,o)=>{this.St(e,n,o)})),Ie.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),Ie.resolve()}getOverlaysForCollection(e,n,r){const i=yo(),o=n.length+1,l=new We(n.child("")),d=this.overlays.getIteratorFrom(l);for(;d.hasNext();){const h=d.getNext().value,m=h.getKey();if(!n.isPrefixOf(m.path))break;m.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return Ie.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new Xt(((m,p)=>m-p));const l=this.overlays.getIterator();for(;l.hasNext();){const m=l.getNext().value;if(m.getKey().getCollectionGroup()===n&&m.largestBatchId>r){let p=o.get(m.largestBatchId);p===null&&(p=yo(),o=o.insert(m.largestBatchId,p)),p.set(m.getKey(),m)}}const d=yo(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((m,p)=>d.set(m,p))),!(d.size()>=i)););return Ie.resolve(d)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const l=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new bM(n,r));let o=this.qr.get(n);o===void 0&&(o=gt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class nN{constructor(){this.sessionToken=$n.EMPTY_BYTE_STRING}getSessionToken(e){return Ie.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,Ie.resolve()}}class _0{constructor(){this.Qr=new Tn(In.$r),this.Ur=new Tn(In.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new In(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new In(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new We(new Ut([])),r=new In(n,e),i=new In(n,e+1),o=[];return this.Ur.forEachInRange([r,i],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new We(new Ut([])),r=new In(n,e),i=new In(n,e+1);let o=gt();return this.Ur.forEachInRange([r,i],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new In(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class In{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return We.comparator(e.key,n.key)||pt(e.Yr,n.Yr)}static Kr(e,n){return pt(e.Yr,n.Yr)||We.comparator(e.key,n.key)}}class rN{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new Tn(In.$r)}checkEmpty(e){return Ie.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new _M(o,n,r,i);this.mutationQueue.push(l);for(const d of i)this.Zr=this.Zr.add(new In(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return Ie.resolve(l)}lookupMutationBatch(e,n){return Ie.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ei(r),o=i<0?0:i;return Ie.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return Ie.resolve(this.mutationQueue.length===0?l0:this.tr-1)}getAllMutationBatches(e){return Ie.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new In(n,0),i=new In(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],(l=>{const d=this.Xr(l.Yr);o.push(d)})),Ie.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Tn(pt);return n.forEach((i=>{const o=new In(i,0),l=new In(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(d=>{r=r.add(d.Yr)}))})),Ie.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;We.isDocumentKey(o)||(o=o.child(""));const l=new In(new We(o),0);let d=new Tn(pt);return this.Zr.forEachWhile((h=>{const m=h.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(d=d.add(h.Yr)),!0)}),l),Ie.resolve(this.ti(d))}ti(e){const n=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&n.push(i)})),n}removeMutationBatch(e,n){jt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return Ie.forEach(n.mutations,(i=>{const o=new In(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new In(n,0),i=this.Zr.firstAfterOrEqual(r);return Ie.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ie.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class sN{constructor(e){this.ri=e,this.docs=(function(){return new Xt(We.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return Ie.resolve(r?r.document.mutableCopy():Xn.newInvalidDocument(n))}getEntries(e,n){let r=xi();return n.forEach((i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Xn.newInvalidDocument(i))})),Ie.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=xi();const l=n.path,d=new We(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(d);for(;h.hasNext();){const{key:m,value:{document:p}}=h.getNext();if(!l.isPrefixOf(m.path))break;m.path.length>l.length+1||OO(kO(p),r)<=0||(i.has(p.key)||em(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return Ie.resolve(o)}getAllFromCollectionGroup(e,n,r,i){Xe(9500)}ii(e,n){return Ie.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new iN(this)}getSize(e){return Ie.resolve(this.size)}}class iN extends XM{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?n.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),Ie.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class aN{constructor(e){this.persistence=e,this.si=new Io((n=>d0(n)),h0),this.lastRemoteSnapshotVersion=et.min(),this.highestTargetId=0,this.oi=0,this._i=new _0,this.targetCount=0,this.ai=Ql.ur()}forEachTarget(e,n){return this.si.forEach(((r,i)=>n(i))),Ie.resolve()}getLastRemoteSnapshotVersion(e){return Ie.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ie.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Ie.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),Ie.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Ql(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,Ie.resolve()}updateTargetData(e,n){return this.Pr(n),Ie.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,Ie.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.si.forEach(((l,d)=>{d.sequenceNumber<=n&&r.get(d.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)})),Ie.waitFor(o).next((()=>i))}getTargetCount(e){return Ie.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return Ie.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),Ie.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach((l=>{o.push(i.markPotentiallyOrphaned(e,l))})),Ie.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),Ie.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return Ie.resolve(r)}containsKey(e,n){return Ie.resolve(this._i.containsKey(n))}}class DC{constructor(e,n){this.ui={},this.overlays={},this.ci=new Yf(0),this.li=!1,this.li=!0,this.hi=new nN,this.referenceDelegate=e(this),this.Pi=new aN(this),this.indexManager=new qM,this.remoteDocumentCache=(function(i){return new sN(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new VM(n),this.Ii=new eN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new tN,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new rN(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Ue("MemoryPersistence","Starting transaction:",e);const i=new oN(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((o=>this.referenceDelegate.di(i).next((()=>o)))).toPromise().then((o=>(i.raiseOnCommittedEvent(),o)))}Ai(e,n){return Ie.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class oN extends NO{constructor(e){super(),this.currentSequenceNumber=e}}class b0{constructor(e){this.persistence=e,this.Ri=new _0,this.Vi=null}static mi(e){return new b0(e)}get fi(){if(this.Vi)return this.Vi;throw Xe(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),Ie.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),Ie.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),Ie.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((i=>{i.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ie.forEach(this.fi,(r=>{const i=We.fromPath(r);return this.gi(e,i).next((o=>{o||n.removeEntry(i,et.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return Ie.or([()=>Ie.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Tf{constructor(e,n){this.persistence=e,this.pi=new Io((r=>BO(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=YM(this,n)}static mi(e,n){return new Tf(e,n)}Ei(){}di(e){return Ie.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((i=>r+i))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return Ie.forEach(this.pi,((r,i)=>this.br(e,r,i).next((o=>o?Ie.resolve():n(i)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,(l=>this.br(e,l,n).next((d=>{d||(r++,o.removeEntry(l,et.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),Ie.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),Ie.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),Ie.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),Ie.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=tf(e.data.value)),n}br(e,n,r){return Ie.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.pi.get(n);return Ie.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class v0{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=i}static As(e,n){let r=gt(),i=gt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new v0(e,n.fromCache,r,i)}}class lN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class cN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return zR()?8:PO(Zn())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,i,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new lN;return this.Ss(e,n,l).next((d=>{if(o.result=d,this.Vs)return this.bs(e,n,l,d.size)}))})).next((()=>o.result))}bs(e,n,r,i){return r.documentReadCount<this.fs?(jl()<=mt.DEBUG&&Ue("QueryEngine","SDK will not create cache indexes for query:",Rl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Ie.resolve()):(jl()<=mt.DEBUG&&Ue("QueryEngine","Query:",Rl(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(jl()<=mt.DEBUG&&Ue("QueryEngine","The SDK decides to create cache indexes for query:",Rl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Fs(n))):Ie.resolve())}ys(e,n){if(Xw(n))return Ie.resolve(null);let r=Fs(n);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(n.limit!==null&&i===1&&(n=Sy(n,null,"F"),r=Fs(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=gt(...o);return this.ps.getDocuments(e,l).next((d=>this.indexManager.getMinOffset(e,r).next((h=>{const m=this.Ds(n,d);return this.Cs(n,m,l,h.readTime)?this.ys(e,Sy(n,null,"F")):this.vs(e,m,n,h)}))))})))))}ws(e,n,r,i){return Xw(n)||i.isEqual(et.min())?Ie.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,i)?Ie.resolve(null):(jl()<=mt.DEBUG&&Ue("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Rl(n)),this.vs(e,l,n,IO(i,Pu)).next((d=>d)))}))}Ds(e,n){let r=new Tn(oC(e));return n.forEach(((i,o)=>{em(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,n,r){return jl()<=mt.DEBUG&&Ue("QueryEngine","Using full collection scan to execute query:",Rl(n)),this.ps.getDocumentsMatchingQuery(e,n,va.min(),r)}vs(e,n,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const x0="LocalStore",uN=3e8;class dN{constructor(e,n,r,i){this.persistence=e,this.Fs=n,this.serializer=i,this.Ms=new Xt(pt),this.xs=new Io((o=>d0(o)),h0),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new JM(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function hN(t,e,n,r){return new dN(t,e,n,r)}async function IC(t,e){const n=rt(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next((o=>(i=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],d=[];let h=gt();for(const m of i){l.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}for(const m of o){d.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((m=>({Ls:m,removedBatchIds:l,addedBatchIds:d})))}))}))}function fN(t,e){const n=rt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,h,m,p){const g=m.batch,v=g.keys();let _=Ie.resolve();return v.forEach((E=>{_=_.next((()=>p.getEntry(h,E))).next((x=>{const S=m.docVersions.get(E);jt(S!==null,48541),x.version.compareTo(S)<0&&(g.applyToRemoteDocument(x,m),x.isValidDocument()&&(x.setReadTime(m.commitVersion),p.addEntry(x)))}))})),_.next((()=>d.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(d){let h=gt();for(let m=0;m<d.mutationResults.length;++m)d.mutationResults[m].transformResults.length>0&&(h=h.add(d.batch.mutations[m].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,i)))}))}function kC(t){const e=rt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function mN(t,e){const n=rt(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const d=[];e.targetChanges.forEach(((p,g)=>{const v=i.get(g);if(!v)return;d.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let _=v.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?_=_.withResumeToken($n.EMPTY_BYTE_STRING,et.min()).withLastLimboFreeSnapshotVersion(et.min()):p.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(p.resumeToken,r)),i=i.insert(g,_),(function(x,S,C){return x.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=uN?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(v,_,p)&&d.push(n.Pi.updateTargetData(o,_))}));let h=xi(),m=gt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&d.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),d.push(pN(o,l,e.documentUpdates).next((p=>{h=p.ks,m=p.qs}))),!r.isEqual(et.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));d.push(p)}return Ie.waitFor(d).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,m))).next((()=>h))})).then((o=>(n.Ms=i,o)))}function pN(t,e,n){let r=gt(),i=gt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=xi();return n.forEach(((d,h)=>{const m=o.get(d);h.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(d)),h.isNoDocument()&&h.version.isEqual(et.min())?(e.removeEntry(d,h.readTime),l=l.insert(d,h)):!m.isValidDocument()||h.version.compareTo(m.version)>0||h.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(h),l=l.insert(d,h)):Ue(x0,"Ignoring outdated watch update for ",d,". Current version:",m.version," Watch version:",h.version)})),{ks:l,qs:i}}))}function gN(t,e){const n=rt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=l0),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function yN(t,e){const n=rt(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return n.Pi.getTargetData(r,e).next((o=>o?(i=o,Ie.resolve(i)):n.Pi.allocateTargetId(r).next((l=>(i=new da(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=n.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function jy(t,e,n){const r=rt(t),i=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!cc(l))throw l;Ue(x0,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function u1(t,e,n){const r=rt(t);let i=et.min(),o=gt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,m,p){const g=rt(h),v=g.xs.get(p);return v!==void 0?Ie.resolve(g.Ms.get(v)):g.Pi.getTargetData(m,p)})(r,l,Fs(e)).next((d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,d.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?i:et.min(),n?o:gt()))).next((d=>(_N(r,rM(e),d),{documents:d,Qs:o})))))}function _N(t,e,n){let r=t.Os.get(e)||et.min();n.forEach(((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class d1{constructor(){this.activeTargetIds=cM()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class bN{constructor(){this.Mo=new d1,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new d1,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class vN{Oo(e){}shutdown(){}}const h1="ConnectivityMonitor";class f1{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ue(h1,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ue(h1,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Hh=null;function Ry(){return Hh===null?Hh=(function(){return 268435456+Math.round(2147483648*Math.random())})():Hh++,"0x"+Hh.toString(16)}const Vg="RestConnection",xN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class wN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===bf?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,n,r,i,o){const l=Ry(),d=this.zo(e,n.toUriEncodedString());Ue(Vg,`Sending RPC '${e}' ${l}:`,d,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);const{host:m}=new URL(d),p=nc(m);return this.Jo(e,d,h,r,p).then((g=>(Ue(Vg,`Received RPC '${e}' ${l}: `,g),g)),(g=>{throw Fl(Vg,`RPC '${e}' ${l} failed with error: `,g,"url: ",d,"request:",r),g}))}Ho(e,n,r,i,o,l){return this.Go(e,n,r,i,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+oc})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((i,o)=>e[o]=i)),r&&r.headers.forEach(((i,o)=>e[o]=i))}zo(e,n){const r=xN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class SN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Kn="WebChannelConnection";class EN extends wN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,o){const l=Ry();return new Promise(((d,h)=>{const m=new ME;m.setWithCredentials(!0),m.listenOnce(NE.COMPLETE,(()=>{try{switch(m.getLastErrorCode()){case ef.NO_ERROR:const g=m.getResponseJson();Ue(Kn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),d(g);break;case ef.TIMEOUT:Ue(Kn,`RPC '${e}' ${l} timed out`),h(new Le(Re.DEADLINE_EXCEEDED,"Request time out"));break;case ef.HTTP_ERROR:const v=m.getStatus();if(Ue(Kn,`RPC '${e}' ${l} failed with status:`,v,"response text:",m.getResponseText()),v>0){let _=m.getResponseJson();Array.isArray(_)&&(_=_[0]);const E=_?.error;if(E&&E.status&&E.message){const x=(function(C){const T=C.toLowerCase().replace(/_/g,"-");return Object.values(Re).indexOf(T)>=0?T:Re.UNKNOWN})(E.status);h(new Le(x,E.message))}else h(new Le(Re.UNKNOWN,"Server responded with status "+m.getStatus()))}else h(new Le(Re.UNAVAILABLE,"Connection failed."));break;default:Xe(9055,{l_:e,streamId:l,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{Ue(Kn,`RPC '${e}' ${l} completed.`)}}));const p=JSON.stringify(i);Ue(Kn,`RPC '${e}' ${l} sending request:`,i),m.send(n,"POST",p,r,15)}))}T_(e,n,r){const i=Ry(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=BE(),d=zE(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(h.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");Ue(Kn,`Creating RPC '${e}' stream ${i}: ${p}`,h);const g=l.createWebChannel(p,h);this.I_(g);let v=!1,_=!1;const E=new SN({Yo:S=>{_?Ue(Kn,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(v||(Ue(Kn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),v=!0),Ue(Kn,`RPC '${e}' stream ${i} sending:`,S),g.send(S))},Zo:()=>g.close()}),x=(S,C,T)=>{S.listen(C,(A=>{try{T(A)}catch(L){setTimeout((()=>{throw L}),0)}}))};return x(g,xu.EventType.OPEN,(()=>{_||(Ue(Kn,`RPC '${e}' stream ${i} transport opened.`),E.o_())})),x(g,xu.EventType.CLOSE,(()=>{_||(_=!0,Ue(Kn,`RPC '${e}' stream ${i} transport closed`),E.a_(),this.E_(g))})),x(g,xu.EventType.ERROR,(S=>{_||(_=!0,Fl(Kn,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),E.a_(new Le(Re.UNAVAILABLE,"The operation could not be completed")))})),x(g,xu.EventType.MESSAGE,(S=>{if(!_){const C=S.data[0];jt(!!C,16349);const T=C,A=T?.error||T[0]?.error;if(A){Ue(Kn,`RPC '${e}' stream ${i} received error:`,A);const L=A.status;let F=(function(I){const N=mn[I];if(N!==void 0)return bC(N)})(L),H=A.message;F===void 0&&(F=Re.INTERNAL,H="Unknown error status: "+L+" with message "+A.message),_=!0,E.a_(new Le(F,H)),g.close()}else Ue(Kn,`RPC '${e}' stream ${i} received:`,C),E.u_(C)}})),x(d,PE.STAT_EVENT,(S=>{S.stat===gy.PROXY?Ue(Kn,`RPC '${e}' stream ${i} detected buffering proxy`):S.stat===gy.NOPROXY&&Ue(Kn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{E.__()}),0),E}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function $g(){return typeof document<"u"?document:null}function im(t){return new jM(t,!0)}class OC{constructor(e,n,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&Ue("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const m1="PersistentStream";class MC{constructor(e,n,r,i,o,l,d,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=d,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new OC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===Re.RESOURCE_EXHAUSTED?(vi(n.toString()),vi("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===Re.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===n&&this.G_(r,i)}),(r=>{e((()=>{const i=new Le(Re.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ue(m1,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Ue(m1,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class CN extends MC{constructor(e,n,r,i,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=IM(this.serializer,e),r=(function(o){if(!("targetChange"in o))return et.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?et.min():l.readTime?Vs(l.readTime):et.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Ay(this.serializer),n.addTarget=(function(o,l){let d;const h=l.target;if(d=xy(h)?{documents:MM(o,h)}:{query:NM(o,h).ft},d.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){d.resumeToken=wC(o,l.resumeToken);const m=Ey(o,l.expectedCount);m!==null&&(d.expectedCount=m)}else if(l.snapshotVersion.compareTo(et.min())>0){d.readTime=Cf(o,l.snapshotVersion.toTimestamp());const m=Ey(o,l.expectedCount);m!==null&&(d.expectedCount=m)}return d})(this.serializer,e);const r=zM(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Ay(this.serializer),n.removeTarget=e,this.q_(n)}}class TN extends MC{constructor(e,n,r,i,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return jt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,jt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){jt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=OM(e.writeResults,e.commitTime),r=Vs(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Ay(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>kM(this.serializer,r)))};this.q_(n)}}class AN{}class jN extends AN{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Le(Re.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,Cy(n,r),i,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===Re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Le(Re.UNKNOWN,o.toString())}))}Ho(e,n,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,d])=>this.connection.Ho(e,Cy(n,r),i,l,d,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===Re.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Le(Re.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class RN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(vi(n),this.aa=!1):Ue("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Ao="RemoteStore";class DN{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{ko(this)&&(Ue(Ao,"Restarting streams for network reachability change."),await(async function(h){const m=rt(h);m.Ea.add(4),await ad(m),m.Ra.set("Unknown"),m.Ea.delete(4),await am(m)})(this))}))})),this.Ra=new RN(r,i)}}async function am(t){if(ko(t))for(const e of t.da)await e(!0)}async function ad(t){for(const e of t.da)await e(!1)}function NC(t,e){const n=rt(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),C0(n)?E0(n):uc(n).O_()&&S0(n,e))}function w0(t,e){const n=rt(t),r=uc(n);n.Ia.delete(e),r.O_()&&PC(n,e),n.Ia.size===0&&(r.O_()?r.L_():ko(n)&&n.Ra.set("Unknown"))}function S0(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(et.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}uc(t).Y_(e)}function PC(t,e){t.Va.Ue(e),uc(t).Z_(e)}function E0(t){t.Va=new EM({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),uc(t).start(),t.Ra.ua()}function C0(t){return ko(t)&&!uc(t).x_()&&t.Ia.size>0}function ko(t){return rt(t).Ea.size===0}function zC(t){t.Va=void 0}async function IN(t){t.Ra.set("Online")}async function kN(t){t.Ia.forEach(((e,n)=>{S0(t,e)}))}async function ON(t,e){zC(t),C0(t)?(t.Ra.ha(e),E0(t)):t.Ra.set("Unknown")}async function MN(t,e,n){if(t.Ra.set("Online"),e instanceof xC&&e.state===2&&e.cause)try{await(async function(i,o){const l=o.cause;for(const d of o.targetIds)i.Ia.has(d)&&(await i.remoteSyncer.rejectListen(d,l),i.Ia.delete(d),i.Va.removeTarget(d))})(t,e)}catch(r){Ue(Ao,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Af(t,r)}else if(e instanceof sf?t.Va.Ze(e):e instanceof vC?t.Va.st(e):t.Va.tt(e),!n.isEqual(et.min()))try{const r=await kC(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const d=o.Va.Tt(l);return d.targetChanges.forEach(((h,m)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(m);p&&o.Ia.set(m,p.withResumeToken(h.resumeToken,l))}})),d.targetMismatches.forEach(((h,m)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken($n.EMPTY_BYTE_STRING,p.snapshotVersion)),PC(o,h);const g=new da(p.target,h,m,p.sequenceNumber);S0(o,g)})),o.remoteSyncer.applyRemoteEvent(d)})(t,n)}catch(r){Ue(Ao,"Failed to raise snapshot:",r),await Af(t,r)}}async function Af(t,e,n){if(!cc(e))throw e;t.Ea.add(1),await ad(t),t.Ra.set("Offline"),n||(n=()=>kC(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ue(Ao,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await am(t)}))}function BC(t,e){return e().catch((n=>Af(t,n,e)))}async function om(t){const e=rt(t),n=Ea(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:l0;for(;NN(e);)try{const i=await gN(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,PN(e,i)}catch(i){await Af(e,i)}LC(e)&&UC(e)}function NN(t){return ko(t)&&t.Ta.length<10}function PN(t,e){t.Ta.push(e);const n=Ea(t);n.O_()&&n.X_&&n.ea(e.mutations)}function LC(t){return ko(t)&&!Ea(t).x_()&&t.Ta.length>0}function UC(t){Ea(t).start()}async function zN(t){Ea(t).ra()}async function BN(t){const e=Ea(t);for(const n of t.Ta)e.ea(n.mutations)}async function LN(t,e,n){const r=t.Ta.shift(),i=p0.from(r,e,n);await BC(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await om(t)}async function UN(t,e){e&&Ea(t).X_&&await(async function(r,i){if((function(l){return xM(l)&&l!==Re.ABORTED})(i.code)){const o=r.Ta.shift();Ea(r).B_(),await BC(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i))),await om(r)}})(t,e),LC(t)&&UC(t)}async function p1(t,e){const n=rt(t);n.asyncQueue.verifyOperationInProgress(),Ue(Ao,"RemoteStore received new credentials");const r=ko(n);n.Ea.add(3),await ad(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await am(n)}async function FN(t,e){const n=rt(t);e?(n.Ea.delete(2),await am(n)):e||(n.Ea.add(2),await ad(n),n.Ra.set("Unknown"))}function uc(t){return t.ma||(t.ma=(function(n,r,i){const o=rt(n);return o.sa(),new CN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:IN.bind(null,t),t_:kN.bind(null,t),r_:ON.bind(null,t),H_:MN.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),C0(t)?E0(t):t.Ra.set("Unknown")):(await t.ma.stop(),zC(t))}))),t.ma}function Ea(t){return t.fa||(t.fa=(function(n,r,i){const o=rt(n);return o.sa(),new TN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:zN.bind(null,t),r_:UN.bind(null,t),ta:BN.bind(null,t),na:LN.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await om(t)):(await t.fa.stop(),t.Ta.length>0&&(Ue(Ao,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class T0{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new pi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const l=Date.now()+r,d=new T0(e,n,l,i,o);return d.start(r),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Le(Re.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function A0(t,e){if(vi("AsyncQueue",`${e}: ${t}`),cc(t))return new Le(Re.UNAVAILABLE,`${e}: ${t}`);throw t}class Pl{static emptySet(e){return new Pl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||We.comparator(n.key,r.key):(n,r)=>We.comparator(n.key,r.key),this.keyedMap=wu(),this.sortedSet=new Xt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Pl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Pl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class g1{constructor(){this.ga=new Xt(We.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Xe(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class Wl{constructor(e,n,r,i,o,l,d,h,m){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=d,this.excludesMetadataChanges=h,this.hasCachedResults=m}static fromInitialDocuments(e,n,r,i,o){const l=[];return n.forEach((d=>{l.push({type:0,doc:d})})),new Wl(e,n,Pl.emptySet(n),l,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Jf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}class VN{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class $N{constructor(){this.queries=y1(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=rt(n),o=i.queries;i.queries=y1(),o.forEach(((l,d)=>{for(const h of d.Sa)h.onError(r)}))})(this,new Le(Re.ABORTED,"Firestore shutting down"))}}function y1(){return new Io((t=>aC(t)),Jf)}async function FC(t,e){const n=rt(t);let r=3;const i=e.query;let o=n.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new VN,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(i,!0);break;case 1:o.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(l){const d=A0(l,`Initialization of query '${Rl(e.query)}' failed`);return void e.onError(d)}n.queries.set(i,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&j0(n)}async function VC(t,e){const n=rt(t),r=e.query;let i=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function qN(t,e){const n=rt(t);let r=!1;for(const i of e){const o=i.query,l=n.queries.get(o);if(l){for(const d of l.Sa)d.Fa(i)&&(r=!0);l.wa=i}}r&&j0(n)}function HN(t,e,n){const r=rt(t),i=r.queries.get(e);if(i)for(const o of i.Sa)o.onError(n);r.queries.delete(e)}function j0(t){t.Ca.forEach((e=>{e.next()}))}var Dy,_1;(_1=Dy||(Dy={})).Ma="default",_1.Cache="cache";class $C{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Wl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Wl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Dy.Cache}}class qC{constructor(e){this.key=e}}class HC{constructor(e){this.key=e}}class GN{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=gt(),this.mutatedKeys=gt(),this.eu=oC(e),this.tu=new Pl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new g1,i=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=i,d=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,m=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((p,g)=>{const v=i.get(p),_=em(this.query,g)?g:null,E=!!v&&this.mutatedKeys.has(v.key),x=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let S=!1;v&&_?v.data.isEqual(_.data)?E!==x&&(r.track({type:3,doc:_}),S=!0):this.su(v,_)||(r.track({type:2,doc:_}),S=!0,(h&&this.eu(_,h)>0||m&&this.eu(_,m)<0)&&(d=!0)):!v&&_?(r.track({type:0,doc:_}),S=!0):v&&!_&&(r.track({type:1,doc:v}),S=!0,(h||m)&&(d=!0)),S&&(_?(l=l.add(_),o=x?o.add(p):o.delete(p)):(l=l.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const p=this.query.limitType==="F"?l.last():l.first();l=l.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:l,iu:r,Cs:d,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((p,g)=>(function(_,E){const x=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xe(20277,{Rt:S})}};return x(_)-x(E)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),i=i??!1;const d=n&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,m=h!==this.Za;return this.Za=h,l.length!==0||m?{snapshot:new Wl(this.query,e.tu,o,l,e.mutatedKeys,h===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new g1,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=gt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new HC(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new qC(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=gt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Wl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const R0="SyncEngine";class QN{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class WN{constructor(e){this.key=e,this.hu=!1}}class KN{constructor(e,n,r,i,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new Io((d=>aC(d)),Jf),this.Iu=new Map,this.Eu=new Set,this.du=new Xt(We.comparator),this.Au=new Map,this.Ru=new _0,this.Vu={},this.mu=new Map,this.fu=Ql.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function YN(t,e,n=!0){const r=XC(t);let i;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await GC(r,e,n,!0),i}async function XN(t,e){const n=XC(t);await GC(n,e,!0,!1)}async function GC(t,e,n,r){const i=await yN(t.localStore,Fs(e)),o=i.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let d;return r&&(d=await ZN(t,e,o,l==="current",i.resumeToken)),t.isPrimaryClient&&n&&NC(t.remoteStore,i),d}async function ZN(t,e,n,r,i){t.pu=(g,v,_)=>(async function(x,S,C,T){let A=S.view.ru(C);A.Cs&&(A=await u1(x.localStore,S.query,!1).then((({documents:O})=>S.view.ru(O,A))));const L=T&&T.targetChanges.get(S.targetId),F=T&&T.targetMismatches.get(S.targetId)!=null,H=S.view.applyChanges(A,x.isPrimaryClient,L,F);return v1(x,S.targetId,H.au),H.snapshot})(t,g,v,_);const o=await u1(t.localStore,e,!0),l=new GN(e,o.Qs),d=l.ru(o.documents),h=id.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),m=l.applyChanges(d,t.isPrimaryClient,h);v1(t,n,m.au);const p=new QN(e,n,l);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),m.snapshot}async function JN(t,e,n){const r=rt(t),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter((l=>!Jf(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await jy(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&w0(r.remoteStore,i.targetId),Iy(r,i.targetId)})).catch(lc)):(Iy(r,i.targetId),await jy(r.localStore,i.targetId,!0))}async function e4(t,e){const n=rt(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),w0(n.remoteStore,r.targetId))}async function t4(t,e,n){const r=l4(t);try{const i=await(function(l,d){const h=rt(l),m=Ht.now(),p=d.reduce(((_,E)=>_.add(E.key)),gt());let g,v;return h.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let E=xi(),x=gt();return h.Ns.getEntries(_,p).next((S=>{E=S,E.forEach(((C,T)=>{T.isValidDocument()||(x=x.add(C))}))})).next((()=>h.localDocuments.getOverlayedDocuments(_,E))).next((S=>{g=S;const C=[];for(const T of d){const A=gM(T,g.get(T.key).overlayedDocument);A!=null&&C.push(new ka(T.key,A,ZE(A.value.mapValue),mr.exists(!0)))}return h.mutationQueue.addMutationBatch(_,m,C,d)})).next((S=>{v=S;const C=S.applyToLocalDocumentSet(g,x);return h.documentOverlayCache.saveOverlays(_,S.batchId,C)}))})).then((()=>({batchId:v.batchId,changes:cC(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(l,d,h){let m=l.Vu[l.currentUser.toKey()];m||(m=new Xt(pt)),m=m.insert(d,h),l.Vu[l.currentUser.toKey()]=m})(r,i.batchId,n),await od(r,i.changes),await om(r.remoteStore)}catch(i){const o=A0(i,"Failed to persist write");n.reject(o)}}async function QC(t,e){const n=rt(t);try{const r=await mN(n.localStore,e);e.targetChanges.forEach(((i,o)=>{const l=n.Au.get(o);l&&(jt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?l.hu=!0:i.modifiedDocuments.size>0?jt(l.hu,14607):i.removedDocuments.size>0&&(jt(l.hu,42227),l.hu=!1))})),await od(n,r,e)}catch(r){await lc(r)}}function b1(t,e,n){const r=rt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach(((o,l)=>{const d=l.view.va(e);d.snapshot&&i.push(d.snapshot)})),(function(l,d){const h=rt(l);h.onlineState=d;let m=!1;h.queries.forEach(((p,g)=>{for(const v of g.Sa)v.va(d)&&(m=!0)})),m&&j0(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function n4(t,e,n){const r=rt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),o=i&&i.key;if(o){let l=new Xt(We.comparator);l=l.insert(o,Xn.newNoDocument(o,et.min()));const d=gt().add(o),h=new sm(et.min(),new Map,new Xt(pt),l,d);await QC(r,h),r.du=r.du.remove(o),r.Au.delete(e),D0(r)}else await jy(r.localStore,e,!1).then((()=>Iy(r,e,n))).catch(lc)}async function r4(t,e){const n=rt(t),r=e.batch.batchId;try{const i=await fN(n.localStore,e);KC(n,r,null),WC(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await od(n,i)}catch(i){await lc(i)}}async function s4(t,e,n){const r=rt(t);try{const i=await(function(l,d){const h=rt(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(m=>{let p;return h.mutationQueue.lookupMutationBatch(m,d).next((g=>(jt(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(m,g)))).next((()=>h.mutationQueue.performConsistencyCheck(m))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(m,p,d))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,p))).next((()=>h.localDocuments.getDocuments(m,p)))}))})(r.localStore,e);KC(r,e,n),WC(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await od(r,i)}catch(i){await lc(i)}}function WC(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function KC(t,e,n){const r=rt(t);let i=r.Vu[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Iy(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||YC(t,r)}))}function YC(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(w0(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),D0(t))}function v1(t,e,n){for(const r of n)r instanceof qC?(t.Ru.addReference(r.key,e),i4(t,r)):r instanceof HC?(Ue(R0,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||YC(t,r.key)):Xe(19791,{wu:r})}function i4(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Ue(R0,"New document in limbo: "+n),t.Eu.add(r),D0(t))}function D0(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new We(Ut.fromString(e)),r=t.fu.next();t.Au.set(r,new WN(n)),t.du=t.du.insert(n,r),NC(t.remoteStore,new da(Fs(f0(n.path)),r,"TargetPurposeLimboResolution",Yf.ce))}}async function od(t,e,n){const r=rt(t),i=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((d,h)=>{l.push(r.pu(h,e,n).then((m=>{if((m||n)&&r.isPrimaryClient){const p=m?!m.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(m){i.push(m);const p=v0.As(h.targetId,m);o.push(p)}})))})),await Promise.all(l),r.Pu.H_(i),await(async function(h,m){const p=rt(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>Ie.forEach(m,(v=>Ie.forEach(v.Es,(_=>p.persistence.referenceDelegate.addReference(g,v.targetId,_))).next((()=>Ie.forEach(v.ds,(_=>p.persistence.referenceDelegate.removeReference(g,v.targetId,_)))))))))}catch(g){if(!cc(g))throw g;Ue(x0,"Failed to update sequence numbers: "+g)}for(const g of m){const v=g.targetId;if(!g.fromCache){const _=p.Ms.get(v),E=_.snapshotVersion,x=_.withLastLimboFreeSnapshotVersion(E);p.Ms=p.Ms.insert(v,x)}}})(r.localStore,o))}async function a4(t,e){const n=rt(t);if(!n.currentUser.isEqual(e)){Ue(R0,"User change. New user:",e.toKey());const r=await IC(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((d=>{d.forEach((h=>{h.reject(new Le(Re.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await od(n,r.Ls)}}function o4(t,e){const n=rt(t),r=n.Au.get(e);if(r&&r.hu)return gt().add(r.key);{let i=gt();const o=n.Iu.get(e);if(!o)return i;for(const l of o){const d=n.Tu.get(l);i=i.unionWith(d.view.nu)}return i}}function XC(t){const e=rt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=QC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=o4.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=n4.bind(null,e),e.Pu.H_=qN.bind(null,e.eventManager),e.Pu.yu=HN.bind(null,e.eventManager),e}function l4(t){const e=rt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=r4.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=s4.bind(null,e),e}class jf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=im(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return hN(this.persistence,new cN,e.initialUser,this.serializer)}Cu(e){return new DC(b0.mi,this.serializer)}Du(e){return new bN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}jf.provider={build:()=>new jf};class c4 extends jf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){jt(this.persistence.referenceDelegate instanceof Tf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new WM(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?hr.withCacheSize(this.cacheSizeBytes):hr.DEFAULT;return new DC((r=>Tf.mi(r,n)),this.serializer)}}class ky{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>b1(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=a4.bind(null,this.syncEngine),await FN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new $N})()}createDatastore(e){const n=im(e.databaseInfo.databaseId),r=(function(o){return new EN(o)})(e.databaseInfo);return(function(o,l,d,h){return new jN(o,l,d,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,i,o,l,d){return new DN(r,i,o,l,d)})(this.localStore,this.datastore,e.asyncQueue,(n=>b1(this.syncEngine,n,0)),(function(){return f1.v()?new f1:new vN})())}createSyncEngine(e,n){return(function(i,o,l,d,h,m,p){const g=new KN(i,o,l,d,h,m);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=rt(n);Ue(Ao,"RemoteStore shutting down."),r.Ea.add(5),await ad(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ky.provider={build:()=>new ky};class ZC{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):vi("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const Ca="FirestoreClient";class u4{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Yn.UNAUTHENTICATED,this.clientId=o0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{Ue(Ca,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(Ue(Ca,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new pi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=A0(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function qg(t,e){t.asyncQueue.verifyOperationInProgress(),Ue(Ca,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async i=>{r.isEqual(i)||(await IC(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function x1(t,e){t.asyncQueue.verifyOperationInProgress();const n=await d4(t);Ue(Ca,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>p1(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,i)=>p1(e.remoteStore,i))),t._onlineComponents=e}async function d4(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ue(Ca,"Using user provided OfflineComponentProvider");try{await qg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(i){return i.name==="FirebaseError"?i.code===Re.FAILED_PRECONDITION||i.code===Re.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(n))throw n;Fl("Error using user provided cache. Falling back to memory cache: "+n),await qg(t,new jf)}}else Ue(Ca,"Using default OfflineComponentProvider"),await qg(t,new c4(void 0));return t._offlineComponents}async function JC(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ue(Ca,"Using user provided OnlineComponentProvider"),await x1(t,t._uninitializedComponentsProvider._online)):(Ue(Ca,"Using default OnlineComponentProvider"),await x1(t,new ky))),t._onlineComponents}function h4(t){return JC(t).then((e=>e.syncEngine))}async function eT(t){const e=await JC(t),n=e.eventManager;return n.onListen=YN.bind(null,e.syncEngine),n.onUnlisten=JN.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=XN.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=e4.bind(null,e.syncEngine),n}function f4(t,e,n={}){const r=new pi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,m){const p=new ZC({next:v=>{p.Nu(),l.enqueueAndForget((()=>VC(o,g)));const _=v.docs.has(d);!_&&v.fromCache?m.reject(new Le(Re.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&v.fromCache&&h&&h.source==="server"?m.reject(new Le(Re.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(v)},error:v=>m.reject(v)}),g=new $C(f0(d.path),p,{includeMetadataChanges:!0,qa:!0});return FC(o,g)})(await eT(t),t.asyncQueue,e,n,r))),r.promise}function m4(t,e,n={}){const r=new pi;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,m){const p=new ZC({next:v=>{p.Nu(),l.enqueueAndForget((()=>VC(o,g))),v.fromCache&&h.source==="server"?m.reject(new Le(Re.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(v)},error:v=>m.reject(v)}),g=new $C(d,p,{includeMetadataChanges:!0,qa:!0});return FC(o,g)})(await eT(t),t.asyncQueue,e,n,r))),r.promise}function tT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const w1=new Map;const nT="firestore.googleapis.com",S1=!0;class E1{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Le(Re.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=nT,this.ssl=S1}else this.host=e.host,this.ssl=e.ssl??S1;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=RC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<GM)throw new Le(Re.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}DO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=tT(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Le(Re.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Le(Re.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Le(Re.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lm{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new E1({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Le(Re.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Le(Re.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new E1(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new vO;switch(r.type){case"firstParty":return new EO(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Le(Re.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=w1.get(n);r&&(Ue("ComponentProvider","Removing Datastore"),w1.delete(n),r.terminate())})(this),Promise.resolve()}}function p4(t,e,n,r={}){t=us(t,lm);const i=nc(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},d=`${e}:${n}`;i&&(HS(`https://${d}`),GS("Firestore",!0)),o.host!==nT&&o.host!==d&&Fl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:d,ssl:i,emulatorOptions:r};if(!yi(h,l)&&(t._setSettings(h),r.mockUserToken)){let m,p;if(typeof r.mockUserToken=="string")m=r.mockUserToken,p=Yn.MOCK_USER;else{m=jR(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Le(Re.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Yn(g)}t._authCredentials=new xO(new UE(m,p))}}class dc{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new dc(this.firestore,e,this._query)}}class an{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ba(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new an(this.firestore,e,this._key)}toJSON(){return{type:an._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(nd(n,an._jsonSchema))return new an(e,r||null,new We(Ut.fromString(n.referencePath)))}}an._jsonSchemaVersion="firestore/documentReference/1.0",an._jsonSchema={type:yn("string",an._jsonSchemaVersion),referencePath:yn("string")};class ba extends dc{constructor(e,n,r){super(e,n,f0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new an(this.firestore,null,new We(e))}withConverter(e){return new ba(this.firestore,e,this._path)}}function g4(t,e,...n){if(t=_n(t),FE("collection","path",e),t instanceof lm){const r=Ut.fromString(e,...n);return zw(r),new ba(t,null,r)}{if(!(t instanceof an||t instanceof ba))throw new Le(Re.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ut.fromString(e,...n));return zw(r),new ba(t.firestore,null,r)}}function hc(t,e,...n){if(t=_n(t),arguments.length===1&&(e=o0.newId()),FE("doc","path",e),t instanceof lm){const r=Ut.fromString(e,...n);return Pw(r),new an(t,null,new We(r))}{if(!(t instanceof an||t instanceof ba))throw new Le(Re.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ut.fromString(e,...n));return Pw(r),new an(t.firestore,t instanceof ba?t.converter:null,new We(r))}}const C1="AsyncQueue";class T1{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new OC(this,"async_queue_retry"),this._c=()=>{const r=$g();r&&Ue(C1,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=$g();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=$g();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new pi;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!cc(e))throw e;Ue(C1,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,vi("INTERNAL UNHANDLED ERROR: ",A1(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=T0.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(i),i}uc(){this.nc&&Xe(47125,{Pc:A1(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function A1(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Oo extends lm{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new T1,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new T1(e),this._firestoreClient=void 0,await e}}}function y4(t,e){const n=typeof t=="object"?t:YS(),r=typeof t=="string"?t:bf,i=Xy(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=TR("firestore");o&&p4(i,...o)}return i}function cm(t){if(t._terminated)throw new Le(Re.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||_4(t),t._firestoreClient}function _4(t){const e=t._freezeSettings(),n=(function(i,o,l,d){return new FO(i,o,l,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,tT(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new u4(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(i){const o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(t._componentsProvider))}class $r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $r($n.fromBase64String(e))}catch(n){throw new Le(Re.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new $r($n.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:$r._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(nd(e,$r._jsonSchema))return $r.fromBase64String(e.bytes)}}$r._jsonSchemaVersion="firestore/bytes/1.0",$r._jsonSchema={type:yn("string",$r._jsonSchemaVersion),bytes:yn("string")};class ld{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Le(Re.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Un(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class cd{constructor(e){this._methodName=e}}class $s{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Le(Re.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Le(Re.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return pt(this._lat,e._lat)||pt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:$s._jsonSchemaVersion}}static fromJSON(e){if(nd(e,$s._jsonSchema))return new $s(e.latitude,e.longitude)}}$s._jsonSchemaVersion="firestore/geoPoint/1.0",$s._jsonSchema={type:yn("string",$s._jsonSchemaVersion),latitude:yn("number"),longitude:yn("number")};class qs{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:qs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(nd(e,qs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new qs(e.vectorValues);throw new Le(Re.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}qs._jsonSchemaVersion="firestore/vectorValue/1.0",qs._jsonSchema={type:yn("string",qs._jsonSchemaVersion),vectorValues:yn("object")};const b4=/^__.*__$/;class v4{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new ka(e,this.data,this.fieldMask,n,this.fieldTransforms):new sd(e,this.data,n,this.fieldTransforms)}}class rT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new ka(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function sT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xe(40011,{Ac:t})}}class um{constructor(e,n,r,i,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new um({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Rf(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(sT(this.Ac)&&b4.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class x4{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||im(e)}Cc(e,n,r,i=!1){return new um({Ac:e,methodName:n,Dc:r,path:Un.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function dm(t){const e=t._freezeSettings(),n=im(t._databaseId);return new x4(t._databaseId,!!e.ignoreUndefinedProperties,n)}function iT(t,e,n,r,i,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,i);O0("Data must be an object, but it was:",l,r);const d=cT(r,l);let h,m;if(o.merge)h=new Cr(l.fieldMask),m=l.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const v=Oy(e,g,n);if(!l.contains(v))throw new Le(Re.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);dT(p,v)||p.push(v)}h=new Cr(p),m=l.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,m=l.fieldTransforms;return new v4(new fr(d),h,m)}class hm extends cd{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof hm}}function aT(t,e,n){return new um({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class I0 extends cd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=aT(this,e,!0),r=this.vc.map((o=>Mo(o,n))),i=new Hl(r);return new gC(e.path,i)}isEqual(e){return e instanceof I0&&yi(this.vc,e.vc)}}class k0 extends cd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=aT(this,e,!0),r=this.vc.map((o=>Mo(o,n))),i=new Gl(r);return new gC(e.path,i)}isEqual(e){return e instanceof k0&&yi(this.vc,e.vc)}}function oT(t,e,n,r){const i=t.Cc(1,e,n);O0("Data must be an object, but it was:",i,r);const o=[],l=fr.empty();Ia(r,((h,m)=>{const p=M0(e,h,n);m=_n(m);const g=i.yc(p);if(m instanceof hm)o.push(p);else{const v=Mo(m,g);v!=null&&(o.push(p),l.set(p,v))}}));const d=new Cr(o);return new rT(l,d,i.fieldTransforms)}function lT(t,e,n,r,i,o){const l=t.Cc(1,e,n),d=[Oy(e,r,n)],h=[i];if(o.length%2!=0)throw new Le(Re.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)d.push(Oy(e,o[v])),h.push(o[v+1]);const m=[],p=fr.empty();for(let v=d.length-1;v>=0;--v)if(!dT(m,d[v])){const _=d[v];let E=h[v];E=_n(E);const x=l.yc(_);if(E instanceof hm)m.push(_);else{const S=Mo(E,x);S!=null&&(m.push(_),p.set(_,S))}}const g=new Cr(m);return new rT(p,g,l.fieldTransforms)}function w4(t,e,n,r=!1){return Mo(n,t.Cc(r?4:3,e))}function Mo(t,e){if(uT(t=_n(t)))return O0("Unsupported field value:",e,t),cT(t,e);if(t instanceof cd)return(function(r,i){if(!sT(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const o=[];let l=0;for(const d of r){let h=Mo(d,i.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,i){if((r=_n(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return uM(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Ht.fromDate(r);return{timestampValue:Cf(i.serializer,o)}}if(r instanceof Ht){const o=new Ht(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Cf(i.serializer,o)}}if(r instanceof $s)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof $r)return{bytesValue:wC(i.serializer,r._byteString)};if(r instanceof an){const o=i.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw i.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:y0(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof qs)return(function(l,d){return{mapValue:{fields:{[YE]:{stringValue:XE},[vf]:{arrayValue:{values:l.toArray().map((m=>{if(typeof m!="number")throw d.Sc("VectorValues must only contain numeric values.");return m0(d.serializer,m)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Kf(r)}`)})(t,e)}function cT(t,e){const n={};return qE(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ia(t,((r,i)=>{const o=Mo(i,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function uT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Ht||t instanceof $s||t instanceof $r||t instanceof an||t instanceof cd||t instanceof qs)}function O0(t,e,n){if(!uT(n)||!VE(n)){const r=Kf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Oy(t,e,n){if((e=_n(e))instanceof ld)return e._internalPath;if(typeof e=="string")return M0(t,e);throw Rf("Field path arguments must be of type string or ",t,!1,void 0,n)}const S4=new RegExp("[~\\*/\\[\\]]");function M0(t,e,n){if(e.search(S4)>=0)throw Rf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new ld(...e.split("."))._internalPath}catch{throw Rf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Rf(t,e,n,r,i){const o=r&&!r.isEmpty(),l=i!==void 0;let d=`Function ${e}() called with invalid data`;n&&(d+=" (via `toFirestore()`)"),d+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${i}`),h+=")"),new Le(Re.INVALID_ARGUMENT,d+t+h)}function dT(t,e){return t.some((n=>n.isEqual(e)))}class hT{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new an(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new E4(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(N0("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class E4 extends hT{data(){return super.data()}}function N0(t,e){return typeof e=="string"?M0(t,e):e instanceof ld?e._internalPath:e._delegate._internalPath}function C4(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Le(Re.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class P0{}class T4 extends P0{}function A4(t,e,...n){let r=[];e instanceof P0&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof z0)).length,d=o.filter((h=>h instanceof fm)).length;if(l>1||l>0&&d>0)throw new Le(Re.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)t=i._apply(t);return t}class fm extends T4{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new fm(e,n,r)}_apply(e){const n=this._parse(e);return fT(e._query,n),new dc(e.firestore,e.converter,wy(e._query,n))}_parse(e){const n=dm(e.firestore);return(function(o,l,d,h,m,p,g){let v;if(m.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Le(Re.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){R1(g,p);const E=[];for(const x of g)E.push(j1(h,o,x));v={arrayValue:{values:E}}}else v=j1(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||R1(g,p),v=w4(d,l,g,p==="in"||p==="not-in");return gn.create(m,p,v)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function j4(t,e,n){const r=e,i=N0("where",t);return fm._create(i,r,n)}class z0 extends P0{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new z0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:ds.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(i,o){let l=i;const d=o.getFlattenedFilters();for(const h of d)fT(l,h),l=wy(l,h)})(e._query,n),new dc(e.firestore,e.converter,wy(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function j1(t,e,n){if(typeof(n=_n(n))=="string"){if(n==="")throw new Le(Re.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iC(e)&&n.indexOf("/")!==-1)throw new Le(Re.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ut.fromString(n));if(!We.isDocumentKey(r))throw new Le(Re.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Hw(t,new We(r))}if(n instanceof an)return Hw(t,n._key);throw new Le(Re.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Kf(n)}.`)}function R1(t,e){if(!Array.isArray(t)||t.length===0)throw new Le(Re.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function fT(t,e){const n=(function(i,o){for(const l of i)for(const d of l.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null})(t.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Le(Re.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Le(Re.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class R4{convertValue(e,n="none"){switch(Sa(e)){case 0:return null;case 1:return e.booleanValue;case 2:return sn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(wa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Xe(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ia(e,((i,o)=>{r[i]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[vf].arrayValue?.values?.map((r=>sn(r.doubleValue)));return new qs(n)}convertGeoPoint(e){return new $s(sn(e.latitude),sn(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Zf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(zu(e));default:return null}}convertTimestamp(e){const n=xa(e);return new Ht(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ut.fromString(e);jt(jC(r),9688,{name:e});const i=new Bu(r.get(1),r.get(3)),o=new We(r.popFirst(5));return i.isEqual(n)||vi(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function mT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Eu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class xo extends hT{constructor(e,n,r,i,o,l){super(e,n,r,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new af(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(N0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Re.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=xo._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}xo._jsonSchemaVersion="firestore/documentSnapshot/1.0",xo._jsonSchema={type:yn("string",xo._jsonSchemaVersion),bundleSource:yn("string","DocumentSnapshot"),bundleName:yn("string"),bundle:yn("string")};class af extends xo{data(e={}){return super.data(e)}}class zl{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Eu(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new af(this._firestore,this._userDataWriter,r.key,r,new Eu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Le(Re.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((d=>{const h=new af(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Eu(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);return d.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((d=>o||d.type!==3)).map((d=>{const h=new af(i._firestore,i._userDataWriter,d.doc.key,d.doc,new Eu(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,p=-1;return d.type!==0&&(m=l.indexOf(d.doc.key),l=l.delete(d.doc.key)),d.type!==1&&(l=l.add(d.doc),p=l.indexOf(d.doc.key)),{type:D4(d.type),doc:h,oldIndex:m,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Re.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=zl._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=o0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function D4(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xe(61501,{type:t})}}function I4(t){t=us(t,an);const e=us(t.firestore,Oo);return f4(cm(e),t._key).then((n=>P4(e,t,n)))}zl._jsonSchemaVersion="firestore/querySnapshot/1.0",zl._jsonSchema={type:yn("string",zl._jsonSchemaVersion),bundleSource:yn("string","QuerySnapshot"),bundleName:yn("string"),bundle:yn("string")};class pT extends R4{constructor(e){super(),this.firestore=e}convertBytes(e){return new $r(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new an(this.firestore,null,n)}}function k4(t){t=us(t,dc);const e=us(t.firestore,Oo),n=cm(e),r=new pT(e);return C4(t._query),m4(n,t._query).then((i=>new zl(e,r,t,i)))}function O4(t,e,n){t=us(t,an);const r=us(t.firestore,Oo),i=mT(t.converter,e,n);return mm(r,[iT(dm(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,mr.none())])}function M4(t,e,n,...r){t=us(t,an);const i=us(t.firestore,Oo),o=dm(i);let l;return l=typeof(e=_n(e))=="string"||e instanceof ld?lT(o,"updateDoc",t._key,e,n,r):oT(o,"updateDoc",t._key,e),mm(i,[l.toMutation(t._key,mr.exists(!0))])}function N4(t){return mm(us(t.firestore,Oo),[new rm(t._key,mr.none())])}function mm(t,e){return(function(r,i){const o=new pi;return r.asyncQueue.enqueueAndForget((async()=>t4(await h4(r),i,o))),o.promise})(cm(t),e)}function P4(t,e,n){const r=n.docs.get(e._key),i=new pT(t);return new xo(t,i,e._key,r,new Eu(n.hasPendingWrites,n.fromCache),e.converter)}class z4{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=dm(e)}set(e,n,r){this._verifyNotCommitted();const i=Hg(e,this._firestore),o=mT(i.converter,n,r),l=iT(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(l.toMutation(i._key,mr.none())),this}update(e,n,r,...i){this._verifyNotCommitted();const o=Hg(e,this._firestore);let l;return l=typeof(n=_n(n))=="string"||n instanceof ld?lT(this._dataReader,"WriteBatch.update",o._key,n,r,i):oT(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,mr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Hg(e,this._firestore);return this._mutations=this._mutations.concat(new rm(n._key,mr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Le(Re.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Hg(t,e){if((t=_n(t)).firestore!==e)throw new Le(Re.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Uu(...t){return new I0("arrayUnion",t)}function D1(...t){return new k0("arrayRemove",t)}function gT(t){return cm(t=us(t,Oo)),new z4(t,(e=>mm(t,e)))}(function(e,n=!0){(function(i){oc=i})(rc),Ll(new Eo("firestore",((r,{instanceIdentifier:i,options:o})=>{const l=r.getProvider("app").getImmediate(),d=new Oo(new wO(r.getProvider("auth-internal")),new CO(l,r.getProvider("app-check-internal")),(function(m,p){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new Le(Re.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bu(m.options.projectId,p)})(l,i),l);return o={useFetchStreams:n,...o},d._setSettings(o),d}),"PUBLIC").setMultipleInstances(!0)),ga(kw,Ow,e),ga(kw,Ow,"esm2020")})();function No(){return y4(kE)}const wn={showGroupTotals:!1};function Po(t,e,n,r=1,i,o){let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const p=e.replace("months/","").split("_");if(p.length>=2){const g=p[p.length-1];l=`months/${p[p.length-2]}/${g}`}}console.log(`[Firebase] ${t}(${r}): ${l}${i===!1?" [NOT FOUND]":""}`)}async function At(t,e,n){const r=hc(No(),t,e),i=`${t}/${e}`,o=await I4(r),l=o.exists(),d=l?o.data():null;return Po("READ",i,n,1,l),{exists:l,data:d,ref:r}}async function kn(t,e,n){const r=No(),i=g4(r,t);let o;if(n&&n.length>0){const m=n.map(p=>j4(p.field,p.op,p.value));o=A4(i,...m)}else o=i;const l=await k4(o),d=l.docs.map(m=>({id:m.id,data:m.data()}));let h=t;if(n&&n.length>0){const m=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${m}`}return Po("QUERY",h,e,l.docs.length,void 0),{docs:d}}async function qn(t,e,n,r,i){const o=hc(No(),t,e),l=`${t}/${e}`;return Po("WRITE",l,r,1,void 0),O4(o,n,i??{})}async function pm(t,e){const r=No();for(let i=0;i<t.length;i+=500){const o=t.slice(i,i+500),l=gT(r);for(const{collectionPath:d,docId:h,data:m}of o){const p=hc(r,d,h);l.set(p,m)}Po("BATCH_WRITE",`${o.length} docs`,e,o.length,void 0);try{await l.commit()}catch(d){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,d),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(i/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),d}}}async function Df(t,e,n,r){const i=hc(No(),t,e),o=`${t}/${e}`;return Po("UPDATE",o,r,1,void 0),M4(i,n)}async function My(t,e,n){const r=hc(No(),t,e),i=`${t}/${e}`;return Po("DELETE",i),N4(r)}async function yT(t,e,n){const i=No();for(let o=0;o<t.length;o+=500){const l=t.slice(o,o+500),d=gT(i);for(const{collectionPath:h,docId:m}of l){const p=hc(i,h,m);d.delete(p)}Po("BATCH_DELETE",`${l.length} docs`,e,l.length),await d.commit(),n?.(o+l.length)}}const po={mobile:640,tablet:768,wide:1200},B4=po.mobile,Fu=["January","February","March","April","May","June","July","August","September","October","November","December"],If=3,kf=3,pn="ungrouped_accounts",Sn="ungrouped_categories";function L4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:r.balance??0,account_group_id:r.account_group_id??pn,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function U4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget!==void 0?r.on_budget:null,is_active:r.is_active!==void 0?r.is_active:null}}),e[pn]||(e[pn]={name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}),e}function F4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??Sn,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:r.balance??0,is_hidden:r.is_hidden??!1}}),e}function V4(t=[]){const e=t.map(r=>({id:r.id,name:r.name,sort_order:r.sort_order??0}));return e.some(r=>r.id===Sn)||e.push({id:Sn,name:"Uncategorized",sort_order:0}),e.sort((r,i)=>r.sort_order-i.sort_order),e}function $4(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}async function B0(t){const{exists:e,data:n}=await At("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const r=L4(n.accounts),i=U4(n.account_groups),o=F4(n.categories),l=V4(n.category_groups),d=n.total_available??0,h=$4(n.month_map),m=n.is_needs_recalculation??!1;return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:i,categories:o,category_groups:l,total_available:d,is_needs_recalculation:m,month_map:h},accounts:r,accountGroups:i,categories:o,categoryGroups:l,isNeedsRecalculation:m,monthMap:h}}function q4(t,e){const{initialDataLoadComplete:n}=Ze(),r=!!t&&e?.enabled!==!1&&n;return Ro({queryKey:t?ke.budget(t):["budget","none"],queryFn:()=>B0(t),enabled:r,staleTime:ac})}function hs(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function Kl(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function _T(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function vt(t,e){return`${t}${e.toString().padStart(2,"0")}`}function Ny(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function gm(t,e){const n=new Date,r=n.getFullYear(),i=n.getMonth()+1;if(t===r&&e===i){const o=n.getDate();return`${r}-${String(i).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function ym(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}function Pe(t){return Math.round((t+Number.EPSILON)*100)/100}function dt(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function Ta(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>Ta(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=Ta(r));return e}return t}function H4(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??vt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function Gr(t,e,n,r){const i=hs(t,e,n);return(await Ve.fetchQuery({queryKey:ke.month(t,e,n),queryFn:async()=>{const{exists:l,data:d}=await At("months",i,r?.description??`reading month ${e}/${n}`);return!l||!d?null:{month:H4(d,t,e,n)}},staleTime:ac}))?.month??null}async function G4(t,e,n){const r=vt(e,n);return(await kn("months","getFutureMonths: querying months after specified month",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">",value:r}])).docs.map(l=>({id:l.id,...l.data})).sort((l,d)=>l.year!==d.year?l.year-d.year:l.month-d.month)}function Q4(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}function W4(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let i=kf;i>0;i--){let o=e,l=n-i;for(;l<1;)l+=12,o-=1;r.push(vt(o,l))}r.push(vt(e,n));for(let i=1;i<=If;i++){let o=e,l=n+i;for(;l>12;)l-=12,o+=1;r.push(vt(o,l))}return r}function K4(t,e){const n=ke.budget(t),r=Ve.getQueryData(n);if(!r?.monthMap)return!1;for(const[i,o]of Object.entries(r.monthMap))if(i>=e&&!o.needs_recalculation)return!1;return!0}function Y4(t,e,n){const r=ke.budget(t),i=Ve.getQueryData(r);i&&Ve.setQueryData(r,{...i,isNeedsRecalculation:!0,monthMap:n,budget:{...i.budget,is_needs_recalculation:!0,month_map:n}})}function X4(t,e,n){const r=ke.budget(t),i=Ve.getQueryData(r);i&&Ve.setQueryData(r,{...i,monthMap:e,budget:{...i.budget,month_map:e}})}function Z4(t,e,n,r){const i=vt(e,n),o=ke.budget(t),l=Ve.getQueryData(o);if(!l)return console.warn(`[removeMonthFromMap] Budget ${t} not found in cache`),{};const d=l.monthMap||{},{[i]:h,...m}=d,p=m;return Ve.setQueryData(o,{...l,monthMap:p,budget:{...l.budget,month_map:p}}),r&&r({type:"budget",budgetId:t}),p}async function J4(t,e,n,r){const{bypassDateLimit:i=!1}={},o=new Date,l=o.getFullYear(),d=o.getMonth()+1,h=(e-l)*12+(n-d);if(!i&&h>If){const I=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${If}). This likely indicates a bug in month navigation.`;throw console.error(I),new Error(I)}if(!i&&h<-kf){const I=`[createMonth] Refusing to create month ${e}/${n} - it's ${Math.abs(h)} months in the past (max allowed: ${kf}). Existing months can still be viewed, but new months cannot be created this far back.`;throw console.error(I),new Error(I)}const{exists:m,data:p}=await At("budgets",t,"validating budget exists before creating month");if(!m||!p){Ve.removeQueries({queryKey:ke.budget(t)});const I=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(I),new Error(I)}const g=o.toISOString(),v=hs(t,e,n);let _=0,E={},x={};if(n>1||e>new Date().getFullYear()-10){const{year:I,month:N}=Kl(e,n),U=hs(t,I,N);try{const{exists:$,data:j}=await At("months",U,"fetching previous month to create start balances for new month");if($&&j){const M={budget_id:t,year_month_ordinal:j.year_month_ordinal??vt(I,N),year:j.year??I,month:j.month??N,income:j.income||[],total_income:j.total_income??0,previous_month_income:j.previous_month_income??0,expenses:j.expenses||[],total_expenses:j.total_expenses??0,transfers:j.transfers||[],adjustments:j.adjustments||[],account_balances:j.account_balances||[],category_balances:j.category_balances||[],are_allocations_finalized:j.are_allocations_finalized??!1,created_at:j.created_at,updated_at:j.updated_at};_=M.total_income;const{categoryEndBalances:R,accountEndBalances:K}=Q4(M);E=R,x=K}}catch($){if($ instanceof Error&&$.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${I}/${N}, starting with zero balances`);else throw $}}const S=Object.entries(E).map(([I,N])=>({category_id:I,start_balance:N,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:N})),C=Object.entries(x).map(([I,N])=>({account_id:I,start_balance:N,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:N})),T={budget_id:t,year_month_ordinal:vt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:_,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:C,category_balances:S,are_allocations_finalized:!1,created_at:g,updated_at:g},A={budget_id:t,year_month_ordinal:vt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:_,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:C,category_balances:S,are_allocations_finalized:!1,created_at:g,updated_at:g};await qn("months",v,A,"creating new month document (first time viewing this month)"),Ve.setQueryData(ke.month(t,e,n),{month:T});const L=vt(e,n),H={...p.month_map||{},[L]:{needs_recalculation:!1}},O=H;return X4(t,O),await Df("budgets",t,{month_map:O,updated_at:g},`adding month ${e}/${n} to budget month_map`),T}function e6(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??vt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function L0(t,e,n){const r=hs(t,e,n);try{const{exists:i,data:o}=await At("months",r,`loading month ${e}/${n}`);return!i||!o?null:e6(o,t,e,n)}catch(i){if(i instanceof Error&&i.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw i}}async function t6(t,e,n,r){const i=await L0(t,e,n);if(i)return i;let o=!1;if(r){const l=r.getQueryData(ke.budget(t));l?.monthMap&&(o=vt(e,n)in l.monthMap)}else{const{exists:l,data:d}=await At("budgets",t,"checking month_map before creating month");if(l&&d?.month_map){const h=vt(e,n),m=d.month_map;o=h in m}}if(o)return J4(t,e,n);throw new Error(`Month ${e}/${n} does not exist in budget. Cannot create months that are not in month_map.`)}function n6(t,e,n,r){const i=Ft(),{initialDataLoadComplete:o}=Ze(),l=t?ke.month(t,e,n):["month","none"],d=!!t&&r?.enabled!==!1&&o;return Ro({queryKey:l,queryFn:async()=>({month:await t6(t,e,n,i)}),enabled:d,staleTime:ac})}async function U0(t){const{exists:e,data:n}=await At("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function F0(t,e){const{initialDataLoadComplete:n}=Ze(),r=!!t&&e?.enabled!==!1&&n;return Ro({queryKey:t?ke.payees(t):["payees","none"],queryFn:()=>U0(t),enabled:r,staleTime:ac})}async function r6(t,e){const{exists:n,data:r}=await At("users",t,"loading user profile (cache miss or stale)");if(n&&r)return r;const i={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await qn("users",t,i,"creating new user document (first login)"),i}function s6(t,e,n){return Ro({queryKey:t?ke.user(t):["user","none"],queryFn:()=>r6(t,e),enabled:!!t&&n?.enabled!==!1})}async function i6(t,e){const n=await kn("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),r=[],i=[];for(const o of n.docs){const l=o.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(o.id)?r.push({id:o.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):i.push({budgetId:o.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}return{budgets:r,pendingInvites:i}}function a6(t,e,n){return Ro({queryKey:t?ke.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?i6(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function o6(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function l6(){const t=await kn("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=o6(n.data.items),i=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:i})})}return{items:e}}function c6(t){return Ro({queryKey:ke.feedback(),queryFn:l6,enabled:t?.enabled!==!1})}const Kt="__NO_CATEGORY__",jo="No Category";function lt(t){return t===Kt}const qt="__NO_ACCOUNT__",Aa="No Account";function nt(t){return t===qt}const V0={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function $0(t,e){const n=t.income||[],r=t.expenses||[],i=Pe(n.reduce((g,v)=>g+v.amount,0)),o=Pe(r.reduce((g,v)=>g+v.amount,0)),l=u6(t),{transfersMap:d,adjustmentsMap:h}=d6(t),m=h6(t.category_balances,e.categoryEndBalances,l,d,h),p=f6(t,e.accountEndBalances);return{...t,total_income:i,total_expenses:o,previous_month_income:e.totalIncome,category_balances:m,account_balances:p,updated_at:new Date().toISOString()}}function u6(t){const e={};for(const n of t.transfers||[])lt(n.from_category_id)||(e[n.from_category_id]=(e[n.from_category_id]||0)-n.amount),lt(n.to_category_id)||(e[n.to_category_id]=(e[n.to_category_id]||0)+n.amount);for(const n of t.adjustments||[])lt(n.category_id)||(e[n.category_id]=(e[n.category_id]||0)+n.amount);for(const n of Object.keys(e))e[n]=Pe(e[n]);return e}function d6(t){const e={},n={};for(const r of t.transfers||[])lt(r.from_category_id)||(e[r.from_category_id]=(e[r.from_category_id]||0)-r.amount),lt(r.to_category_id)||(e[r.to_category_id]=(e[r.to_category_id]||0)+r.amount);for(const r of t.adjustments||[])lt(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(e))e[r]=Pe(e[r]);for(const r of Object.keys(n))n[r]=Pe(n[r]);return{transfersMap:e,adjustmentsMap:n}}function h6(t,e,n,r,i){const o=new Map;for(const h of t)lt(h.category_id)||o.set(h.category_id,h);const l=new Set;for(const h of t)lt(h.category_id)||l.add(h.category_id);for(const h of Object.keys(e))lt(h)||l.add(h);for(const h of Object.keys(n))lt(h)||l.add(h);const d=[];for(const h of l){const m=o.get(h),p=Pe(e[h]??0),g=Pe(m?.allocated??0),v=Pe(m?.spent??0),_=Pe(r[h]??0),E=Pe(i[h]??0);d.push({category_id:h,start_balance:p,allocated:g,spent:v,transfers:_,adjustments:E,end_balance:Pe(p+g+v+_+E)})}return d}function f6(t,e){const n=new Set;for(const i of t.income||[])nt(i.account_id)||n.add(i.account_id);for(const i of t.expenses||[])nt(i.account_id)||n.add(i.account_id);for(const i of t.transfers||[])nt(i.from_account_id)||n.add(i.from_account_id),nt(i.to_account_id)||n.add(i.to_account_id);for(const i of t.adjustments||[])nt(i.account_id)||n.add(i.account_id);for(const i of Object.keys(e))nt(i)||n.add(i);for(const i of t.account_balances||[])nt(i.account_id)||n.add(i.account_id);const r=[];for(const i of n){const o=Pe(e[i]??0),l=Pe((t.income||[]).filter(_=>_.account_id===i).reduce((_,E)=>_+E.amount,0)),d=Pe((t.expenses||[]).filter(_=>_.account_id===i).reduce((_,E)=>_+E.amount,0)),h=Pe((t.transfers||[]).filter(_=>_.from_account_id===i).reduce((_,E)=>_-E.amount,0)),m=Pe((t.transfers||[]).filter(_=>_.to_account_id===i).reduce((_,E)=>_+E.amount,0)),p=Pe(m+h),g=Pe((t.adjustments||[]).filter(_=>_.account_id===i).reduce((_,E)=>_+E.amount,0)),v=Pe(l+d+p+g);r.push({account_id:i,start_balance:o,income:l,expenses:d,transfers:p,adjustments:g,net_change:v,end_balance:Pe(o+v)})}return r}function Vu(t){const e={},n={};for(const r of t.category_balances||[])lt(r.category_id)||(e[r.category_id]=Pe(r.end_balance));for(const r of t.account_balances||[])nt(r.account_id)||(n[r.account_id]=Pe(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:Pe(t.total_income)}}const m6=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function p6(t){return{year:parseInt(t.slice(0,4),10),month:parseInt(t.slice(4,6),10)}}function bT(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={needs_recalculation:r?.needs_recalculation??!1}}),e}function vT(t){return Object.entries(t).filter(([,e])=>e.needs_recalculation).map(([e])=>e).sort()}function g6(t){return Object.keys(t).sort()}async function y6(t,e){const{year:n,month:r}=p6(e),i=hs(t,n,r),{exists:o,data:l}=await At("months",i,`[recalc] fetching month ${n}/${r}`);return!o||!l?null:{id:i,budget_id:t,year_month_ordinal:l.year_month_ordinal??vt(n,r),year:l.year??n,month:l.month??r,income:l.income||[],total_income:l.total_income??0,previous_month_income:l.previous_month_income??0,expenses:l.expenses||[],total_expenses:l.total_expenses??0,transfers:l.transfers||[],adjustments:l.adjustments||[],account_balances:l.account_balances||[],category_balances:l.category_balances||[],are_allocations_finalized:l.are_allocations_finalized??!1,created_at:l.created_at,updated_at:l.updated_at}}async function _6(t,e,n){n?.(0,e.length);const r=await Promise.all(e.map(i=>y6(t,i)));return n?.(e.length,e.length),r.filter(i=>i!==null)}function q0(t){const e={};for(const n of Object.keys(t))e[n]={needs_recalculation:!1};return e}function H0(t,e,n){const r=Object.entries(t).reduce((o,[,l])=>{const d=l.account_group_id?n[l.account_group_id]:void 0,h=d&&d.on_budget!==null?d.on_budget:l.on_budget!==!1,m=d&&d.is_active!==null?d.is_active:l.is_active!==!1;return h&&m?o+(l.balance??0):o},0),i=Object.values(e).reduce((o,l)=>{const d=l.balance??0;return o+(d>0?d:0)},0);return Pe(r-i)}async function xT(t,e,n,r){const{exists:i,data:o}=await At("budgets",t,"[recalc] reading budget for balance update");if(!i||!o)return;const l={...o.accounts};for(const[p,g]of Object.entries(e))l[p]&&(l[p]={...l[p],balance:Pe(g)});const d={...o.categories};for(const[p,g]of Object.entries(n))d[p]&&(d[p]={...d[p],balance:Pe(g)});const h=q0(r),m=H0(l,d,o.account_groups||{});await qn("budgets",t,{...o,accounts:l,categories:d,total_available:m,is_needs_recalculation:!1,month_map:h,updated_at:new Date().toISOString()},"[recalc] saving balances and clearing flags"),v6(t,l,d,m,h)}function b6(t,e){const n=Ve.getQueryData(ke.budget(t));n&&Ve.setQueryData(ke.budget(t),{...n,isNeedsRecalculation:!1,monthMap:e,budget:{...n.budget,is_needs_recalculation:!1,month_map:e}})}function v6(t,e,n,r,i){const o=Ve.getQueryData(ke.budget(t));if(o){const l={};for(const[h,m]of Object.entries(o.accounts)){const p=e[h];l[h]=p?{...m,balance:p.balance??m.balance}:m}const d={};for(const[h,m]of Object.entries(o.categories)){const p=n[h];d[h]=p?{...m,balance:p.balance??m.balance}:m}Ve.setQueryData(ke.budget(t),{...o,accounts:l,categories:d,isNeedsRecalculation:!1,monthMap:i,budget:{...o.budget,accounts:e,categories:n,total_available:r,is_needs_recalculation:!1,month_map:i}})}}async function I1(t,e){const{exists:n,data:r}=await At("budgets",t,"[recalc] reading budget to clear flags");if(!n||!r)return;const i=q0(e);await qn("budgets",t,{...r,total_available:H0(r.accounts||{},r.categories||{},r.account_groups||{}),is_needs_recalculation:!1,month_map:i,updated_at:new Date().toISOString()},"[recalc] clearing flags"),b6(t,i)}const Gg=new Map;async function x6(t,e={}){const n=Gg.get(t);if(n)return n;const r=w6(t,e);Gg.set(t,r);try{return await r}finally{Gg.delete(t)}}async function w6(t,e={}){const{onProgress:n}=e;n?.({phase:"reading-budget",monthsProcessed:0,totalMonths:0,percentComplete:5});const{exists:r,data:i}=await At("budgets",t,"[recalc] reading budget for month_map");if(!r||!i)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const o=bT(i.month_map),l=vT(o);if(l.length===0&&!i.is_needs_recalculation)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const d=g6(o),h=l.length>0?l[0]:null;if(!h)return await I1(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const m=d.indexOf(h),p=m>0,g=p?d.slice(m-1):d.slice(m),v=p?g.length-1:g.length;n?.({phase:"fetching-months",monthsFetched:0,totalMonthsToFetch:g.length,monthsProcessed:0,totalMonths:v,percentComplete:10});const _=await _6(t,g,(O,I)=>{n?.({phase:"fetching-months",monthsFetched:O,totalMonthsToFetch:I,monthsProcessed:0,totalMonths:v,percentComplete:O===0?10:30})});if(_.length===0)return await I1(t,o),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const E=p?1:0,x=_.length-1,S=x-E+1;let C=V0;p&&_.length>0&&(C=Vu(_[0]));const T=[];let A=0;for(let O=E;O<=x;O++){const I=_[O],N=`${m6[I.month-1]} ${I.year}`;n?.({phase:"recalculating",currentMonth:N,monthsProcessed:A,totalMonths:S,percentComplete:Math.round(30+A/S*40)});const U=$0(I,C);T.push(U),C=Vu(U),A++}n?.({phase:"saving",monthsProcessed:A,totalMonths:S,percentComplete:75});const L=T.map(O=>({collectionPath:"months",docId:hs(t,O.year,O.month),data:O}));await pm(L,`[recalc] batch write ${T.length} months`);for(const O of T)Ve.setQueryData(ke.month(t,O.year,O.month),{month:O});n?.({phase:"saving",monthsProcessed:A,totalMonths:S,percentComplete:92});const F=C.accountEndBalances,H=C.categoryEndBalances;return await xT(t,F,H,o),n?.({phase:"complete",monthsProcessed:A,totalMonths:S,percentComplete:100}),{monthsRecalculated:A,budgetUpdated:!0,finalAccountBalances:F}}async function S6(t,e,n){const r=vt(e,n);if(K4(t,r))return{markedCount:0,budgetUpdated:!1};const{exists:i,data:o}=await At("budgets",t,"reading budget for month_map update");if(!i||!o)return console.warn(`[markMonthsNeedRecalculation] Budget ${t} not found`),{markedCount:0,budgetUpdated:!1};const d={...o.month_map||{}},h=W4();for(const v of h)d[v]||(d[v]={needs_recalculation:!1});let m=0;for(const v of h)v>=r&&(d[v]?.needs_recalculation||(d[v]={needs_recalculation:!0},m++));const p=o.is_needs_recalculation===!0;if(m===0&&p)return{markedCount:0,budgetUpdated:!1};const g=d;return Y4(t,r,g),await Df("budgets",t,{is_needs_recalculation:!0,month_map:g,updated_at:new Date().toISOString()},`marking budget and ${m} future months as needing recalculation`),{markedCount:m,budgetUpdated:!0}}async function E6(t,e){return Ve.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await At("budgets",t,"checking if user has pending invite for budget");return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function Py(t,e,n){const r=await Gr(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function C6(t,e,n,r){const i={};e.forEach(v=>{i[v]=0});const o=await Py(t,n,r);if(o?.category_balances){for(const v of o.category_balances)e.includes(v.category_id)&&(i[v.category_id]=v.end_balance);return i}const l={};e.forEach(v=>{l[v]=0});const d=[];o&&d.push(o);let h=n,m=r,p=!1;const g=120;for(let v=0;v<g&&!p;v++){const _=Kl(h,m);h=_.year,m=_.month;const E=await Py(t,h,m);if(!E)p=!0;else if(E.category_balances){p=!0;for(const x of E.category_balances)e.includes(x.category_id)&&(l[x.category_id]=x.end_balance)}else d.push(E)}d.reverse(),Object.assign(i,l);for(const v of d){if(v.are_allocations_finalized&&v.category_balances)for(const _ of v.category_balances)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)+_.allocated);if(v.expenses)for(const _ of v.expenses)e.includes(_.category_id)&&(i[_.category_id]=(i[_.category_id]||0)-_.amount)}return i}async function T6(t,e,n,r,i){const o={...n};let l=r,d=i;const h=24;for(let m=0;m<h;m++){const p=_T(l,d);l=p.year,d=p.month;const g=await Py(t,l,d);if(!g)break;if(g.are_allocations_finalized&&g.category_balances)for(const v of g.category_balances)e.includes(v.category_id)&&(o[v.category_id]=(o[v.category_id]||0)+v.allocated);if(g.expenses)for(const v of g.expenses)e.includes(v.category_id)&&(o[v.category_id]=(o[v.category_id]||0)-v.amount)}return o}async function k1(t,e,n,r){const i=await C6(t,e,n,r),o=await T6(t,e,i,n,r);return{current:i,total:o}}async function wT(t,e,n){const r=hs(t,e.year,e.month);await qn("months",r,e,`writeMonthData: ${n}`)}async function ST(t,e,n){await S6(t,e,n)}async function ET(t){const{budgetId:e,month:n,description:r,cascadeRecalculation:i=!0}=t;await wT(e,n,r||`${n.year}/${n.month}`),Ve.setQueryData(ke.month(e,n.year,n.month),{month:n}),i&&await ST(e,n.year,n.month)}function A6(){const t=Ft();return{writeData:Hn({mutationFn:async({budgetId:n,month:r,description:i,cascadeRecalculation:o=!0})=>(await wT(n,r,i||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,cascadeRecalculation:o}),onMutate:async({budgetId:n,month:r})=>{const i=ke.month(n,r.year,r.month);await t.cancelQueries({queryKey:i});const o=t.getQueryData(i);return t.setQueryData(i,{month:r}),{oldMonthQueryData:o,monthKey:i}},onSuccess:async({budgetId:n,year:r,month:i,cascadeRecalculation:o})=>{o&&await ST(n,r,i)},onError:(n,r,i)=>{i?.oldMonthQueryData&&t.setQueryData(i.monthKey,i.oldMonthQueryData)}})}}function j6(t,e,n,r){const i={};t.category_balances&&t.category_balances.forEach(h=>{i[h.category_id]=h});const o=t.expenses??[],l={};for(const h of t.transfers||[])lt(h.from_category_id)||(l[h.from_category_id]=(l[h.from_category_id]||0)-h.amount),lt(h.to_category_id)||(l[h.to_category_id]=(l[h.to_category_id]||0)+h.amount);const d={};for(const h of t.adjustments||[])lt(h.category_id)||(d[h.category_id]=(d[h.category_id]||0)+h.amount);return e.map(h=>{const m=i[h],p=Pe(m?.start_balance??0),g=Pe(n[h]??0),v=Pe(o.filter(x=>x.category_id===h).reduce((x,S)=>x+S.amount,0)),_=Pe(l[h]??0),E=Pe(d[h]??0);return{category_id:h,start_balance:p,allocated:g,spent:v,transfers:_,adjustments:E,end_balance:Pe(p+g+v+_+E)}})}function R6(){const{writeData:t}=A6();return{saveDraftAllocations:async(n,r,i,o)=>{const l=await Gr(n,r,i);if(!l)throw new Error(`Month not found: ${r}/${i}`);const d=l.category_balances.map(m=>({...m,allocated:o[m.category_id]??m.allocated})),h={...l,category_balances:d,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:h,cascadeRecalculation:!1}),{updatedMonth:h}},isPending:t.isPending,isError:t.isError,error:t.error}}const ue={primary:"#646cff",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},as={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},Of="1px solid color-mix(in srgb, currentColor 20%, transparent)",Mf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},ud={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},D6={...ud,padding:"0.6rem 0.875rem",gap:"0.5rem"},I6={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},k6={display:"flex",flexDirection:"column",gap:"0.5rem"},O6={fontSize:"0.9rem",fontWeight:500},Oa={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},M6={...Oa,cursor:"pointer"},G0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},CT={...G0,background:ue.primary,color:"white",border:"none"},N6={...CT,padding:"0.75rem 1.5rem",borderRadius:"8px"},P6={...G0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},z6={...G0,background:"transparent",border:`1px solid ${ue.errorBorder}`,color:ue.error},B6={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s"},L6={display:"flex",gap:"0.5rem"},U6={display:"flex",gap:"0.25rem"},TT={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.9rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"2rem",minHeight:"2rem",transition:"opacity 0.15s, border-color 0.15s"},F6={...TT,borderColor:ue.errorBorder,color:ue.error},Yl={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},Q0={display:"flex",flexDirection:"column",gap:"2px"},V6={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},AT={opacity:.4,cursor:"grab"},jT={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:ue.primary,borderRadius:"2px",transition:"opacity 0.15s"},$6={position:"relative",height:"2rem",marginTop:"-0.25rem"},q6={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ue.primary,borderRadius:"2px",transition:"opacity 0.15s"},H6={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},G6={background:ue.errorBg,border:`1px solid ${ue.errorBorder}`,color:ue.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},Q6={background:"transparent",border:"none",color:ue.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},RT={opacity:.7,marginBottom:"1.5rem"},_m={margin:0,fontSize:"0.85rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6},W0={fontWeight:500,fontSize:"1.1rem"},Xl={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"};function fc({message:t,children:e,onDismiss:n,style:r}){return u.jsxs("div",{style:{...G6,...r},children:[u.jsx("span",{children:e??t}),n&&u.jsx("button",{onClick:n,style:Q6,children:""})]})}const W6={primary:CT,"primary-large":N6,secondary:P6,danger:z6,small:B6},K6={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:ue.warning,color:"#1a1a1a",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",animation:"tooltipFadeIn 0.15s ease-out"},Y6={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${ue.warning}`};function Fe({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:i,style:o,actionName:l,disabledReason:d,onClick:h,...m}){const p=W6[t],g=i||e,[v,_]=k.useState(!1);function E(C){h?.(C)}function x(C){g&&d&&(C.preventDefault(),C.stopPropagation(),_(!0),setTimeout(()=>_(!1),3e3))}const S=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return u.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:x,children:[v&&d&&u.jsxs("div",{style:K6,children:[d,u.jsx("div",{style:Y6})]}),u.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...S,...o},onClick:E,...m,children:e?n:r})]})}function DT(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const d=r.indexOf(n);return{match:!0,score:d===0||/\s/.test(r[d-1])?100:90}}let i=0,o=0,l=0;for(let d=0;d<r.length&&i<n.length;d++)r[d]===n[i]?(i++,l++,o+=l*2):l=0;return i===n.length?{match:!0,score:o}:{match:!1,score:0}}function IT(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function kT(t){const e=IT(t),n=[];let r="__initial__";return e.forEach(i=>{i.groupId!==r&&(r=i.groupId,n.push({groupId:i.groupId,groupName:i.groupName,groupSortOrder:i.groupSortOrder,items:[]})),n[n.length-1].items.push(i)}),n}function OT(t,e,n){return e.trim()?t.map(i=>{const o=n(i);let l=0,d=!1;for(const h of o){const m=DT(e,h);m.match&&(d=!0,l=Math.max(l,m.score))}return{item:i,score:l,hasMatch:d}}).filter(({hasMatch:i})=>i).sort((i,o)=>o.score!==i.score?o.score-i.score:!i.item.groupId&&o.item.groupId?1:i.item.groupId&&!o.item.groupId?-1:i.item.groupSortOrder!==o.item.groupSortOrder?i.item.groupSortOrder-o.item.groupSortOrder:i.item.sortOrder-o.item.sortOrder).map(({item:i})=>i):IT(t)}const K0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},$u={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function O1({id:t,value:e,onChange:n,payees:r,placeholder:i="Enter payee name",autoFocus:o}){const[l,d]=k.useState(!1),[h,m]=k.useState(-1),p=k.useRef(null),g=k.useRef(null),v=e.trim()?r.map(x=>({payee:x,...DT(e,x)})).filter(x=>x.match).sort((x,S)=>S.score-x.score).slice(0,8).map(x=>x.payee):[];k.useEffect(()=>{function x(S){p.current&&!p.current.contains(S.target)&&d(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);function _(x){!l||v.length===0||(x.key==="ArrowDown"?(x.preventDefault(),m(S=>Math.min(S+1,v.length-1))):x.key==="ArrowUp"?(x.preventDefault(),m(S=>Math.max(S-1,-1))):x.key==="Enter"&&h>=0?(x.preventDefault(),n(v[h]),d(!1),m(-1)):x.key==="Escape"&&(d(!1),m(-1)))}function E(x){n(x),d(!1),m(-1),g.current?.focus()}return u.jsxs("div",{ref:p,style:{position:"relative"},children:[u.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:x=>{n(x.target.value),d(!0),m(-1)},onFocus:()=>d(!0),onKeyDown:_,placeholder:i,autoComplete:"off",autoFocus:o,style:Oa}),l&&v.length>0&&u.jsx("div",{style:{...K0,maxHeight:"200px",overflowY:"auto"},children:v.map((x,S)=>u.jsx("div",{onClick:()=>E(x),style:{...$u,background:S===h?`color-mix(in srgb, ${ue.primary} 20%, transparent)`:"transparent",borderBottom:S<v.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>m(S),children:x},x))})]})}function MT({id:t,value:e,onChange:n,categories:r,categoryGroups:i,placeholder:o="Search categories...",required:l,showNoCategoryOption:d=!1,showHiddenCategories:h=!1}){const m=Object.fromEntries(i.map(q=>[q.id,q.name])),p=Object.fromEntries(i.map(q=>[q.id,q.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,q])=>!q.is_hidden)),v=Object.entries(g).map(([q,Z])=>({id:q,name:Z.name,groupId:Z.category_group_id,groupName:Z.category_group_id&&m[Z.category_group_id]||null,sortOrder:Z.sort_order,groupSortOrder:Z.category_group_id?p[Z.category_group_id]??999:999})),_=e===Kt,E=_?null:e?r[e]:null,x=_?"":E?.name||"",[S,C]=k.useState(x),[T,A]=k.useState(!1),[L,F]=k.useState(-1),H=k.useRef(null),O=k.useRef(null);k.useEffect(()=>{if(e===Kt)C("");else if(e){const q=r[e];C(q?.name||"")}},[e,r]);const I=OT(v,S,q=>[q.name]),N=kT(I);k.useEffect(()=>{function q(Z){if(H.current&&!H.current.contains(Z.target))if(A(!1),e===Kt)C("");else{const X=e?r[e]:null;C(X?.name||"")}}return document.addEventListener("mousedown",q),()=>document.removeEventListener("mousedown",q)},[e,r]);function U(q){if(q.key==="ArrowDown")q.preventDefault(),T?F(Z=>Math.min(Z+1,I.length-1)):(A(!0),F(0));else if(q.key==="ArrowUp")q.preventDefault(),F(Z=>Math.max(Z-1,0));else if(q.key==="Enter")q.preventDefault(),T&&L>=0&&I[L]&&$(I[L]);else if(q.key==="Escape")if(A(!1),F(-1),e===Kt)C("");else{const Z=e?r[e]:null;C(Z?.name||"")}else if(q.key==="Tab")if(T&&L>=0&&I[L])$(I[L]);else if(A(!1),F(-1),e===Kt)C("");else{const Z=e?r[e]:null;C(Z?.name||"")}}function $(q){n(q.id),C(q.id===Kt?"":q.name),A(!1),F(-1)}function j(){n(Kt),C(""),A(!1),F(-1)}function M(q){const Z=q.target.value;C(Z),A(!0),F(Z.trim()?0:-1),Z!==x&&(d&&Z.trim()===""?n(Kt):n(""))}function R(){A(!0),d&&(e===Kt||S.trim()==="")?F(-1):I.length>0&&F(0)}let K=-1;const W=()=>++K;return u.jsxs("div",{ref:H,style:{position:"relative"},children:[u.jsx("input",{ref:O,id:t,type:"text",value:S,onChange:M,onFocus:R,onKeyDown:U,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Oa,borderColor:l&&!e?ue.error:void 0}}),T&&u.jsxs("div",{style:{...K0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:j,onMouseEnter:()=>F(-1),style:{...$u,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:L===-1?`color-mix(in srgb, ${ue.primary} 20%, transparent)`:"transparent"},children:jo}),N.map((q,Z)=>u.jsxs("div",{children:[q.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:q.groupName}),q.items.map(X=>{const ne=W();return u.jsx("div",{onClick:()=>$(X),style:{...$u,paddingLeft:q.groupName?"1.2rem":"0.8rem",background:ne===L?`color-mix(in srgb, ${ue.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>F(ne),children:X.name},X.id)})]},`group-${Z}`)),I.length===0&&S.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function NT({id:t,value:e,onChange:n,accounts:r,accountGroups:i,placeholder:o="Search accounts...",required:l,showNoAccountOption:d=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,K])=>!K.is_hidden)).map(([K,W])=>({id:K,name:W.nickname,groupId:W.account_group_id,groupName:W.account_group_id&&i[W.account_group_id]?.name||null,sortOrder:W.sort_order,groupSortOrder:W.account_group_id?i[W.account_group_id]?.sort_order??999:999})),g=e===qt,v=g?null:r.find(([K])=>K===e)?.[1],_=g?"":v?.nickname||"",[E,x]=k.useState(_),[S,C]=k.useState(!1),[T,A]=k.useState(-1),L=k.useRef(null),F=k.useRef(null);k.useEffect(()=>{if(e===qt)x("");else if(e){const K=r.find(([W])=>W===e)?.[1];x(K?.nickname||"")}},[e,r]);const H=OT(p,E,K=>[K.name]),O=kT(H);k.useEffect(()=>{function K(W){if(L.current&&!L.current.contains(W.target))if(C(!1),e===qt)x("");else{const q=r.find(([Z])=>Z===e)?.[1];x(q?.nickname||"")}}return document.addEventListener("mousedown",K),()=>document.removeEventListener("mousedown",K)},[e,r]);function I(K){if(K.key==="ArrowDown")K.preventDefault(),S?A(W=>Math.min(W+1,H.length-1)):(C(!0),A(0));else if(K.key==="ArrowUp")K.preventDefault(),A(W=>Math.max(W-1,0));else if(K.key==="Enter")K.preventDefault(),S&&T>=0&&H[T]&&N(H[T]);else if(K.key==="Escape")if(C(!1),A(-1),e===qt)x("");else{const W=r.find(([q])=>q===e)?.[1];x(W?.nickname||"")}else if(K.key==="Tab")if(S&&T>=0&&H[T])N(H[T]);else if(C(!1),A(-1),e===qt)x("");else{const W=r.find(([q])=>q===e)?.[1];x(W?.nickname||"")}}function N(K){n(K.id),x(K.id===qt?"":K.name),C(!1),A(-1)}function U(){n(qt),x(""),C(!1),A(-1)}function $(K){const W=K.target.value;x(W),C(!0),A(W.trim()?0:-1),W!==_&&(d&&W.trim()===""?n(qt):n(""))}function j(){C(!0),d&&(e===qt||E.trim()==="")?A(-1):H.length>0&&A(0)}let M=-1;const R=()=>++M;return u.jsxs("div",{ref:L,style:{position:"relative"},children:[u.jsx("input",{ref:F,id:t,type:"text",value:E,onChange:$,onFocus:j,onKeyDown:I,placeholder:o,autoComplete:"off",required:l&&!d,style:{...Oa,borderColor:l&&!e?ue.error:void 0}}),S&&u.jsxs("div",{style:{...K0,maxHeight:"250px",overflowY:"auto"},children:[d&&u.jsx("div",{onClick:U,onMouseEnter:()=>A(-1),style:{...$u,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${ue.primary} 20%, transparent)`:"transparent"},children:Aa}),O.map((K,W)=>u.jsxs("div",{children:[K.groupName&&u.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:K.groupName}),K.items.map(q=>{const Z=R();return u.jsx("div",{onClick:()=>N(q),style:{...$u,paddingLeft:K.groupName?"1.2rem":"0.8rem",background:Z===T?`color-mix(in srgb, ${ue.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>A(Z),children:q.name},q.id)})]},`group-${W}`)),H.length===0&&E.trim()&&!d&&u.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function wi({children:t,onSubmit:e,actionName:n}){function r(i){e(i)}return u.jsx("form",{onSubmit:r,style:I6,children:t})}function Pt({label:t,htmlFor:e,children:n,hint:r,style:i}){return u.jsxs("div",{style:{...k6,...i},children:[u.jsx("label",{htmlFor:e,style:O6,children:t}),n,r&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function Si(t){return u.jsx("input",{style:Oa,...t})}function X6(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function Nf({value:t,onChange:e,style:n,autoFocus:r,...i}){const o=k.useRef(null),l=k.useRef(null),d=X6(t);k.useEffect(()=>{r&&l.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function m(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...i}),u.jsx("div",{ref:l,tabIndex:0,onClick:h,onKeyDown:m,style:{...Oa,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:d||"Select date"})]})}function qu({children:t,...e}){return u.jsx("select",{style:M6,...e,children:t})}function Y0({minHeight:t="6rem",style:e,...n}){return u.jsx("textarea",{style:{...Oa,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function Ma({children:t}){return u.jsx("div",{style:V6,children:t})}function Qg(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",i=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return i!==void 0?`$${o}.${i.slice(0,2)}`:o?`$${o}`:""}function Z6(t){return t.replace(/[$,]/g,"")}function _o({id:t,value:e,onChange:n,placeholder:r="$0.00",required:i,autoFocus:o,style:l}){const[d,h]=k.useState(()=>Qg(e)),m=k.useRef(null);k.useEffect(()=>{const g=Qg(e);Z6(d)!==e&&h(g)},[e]);function p(g){const v=g.target.value;if(!v||v==="$"){h(""),n("");return}const E=v.replace(/[^\d.]/g,"").split(".");let x=E[0];E.length>1&&(x+="."+E.slice(1).join("").slice(0,2));const S=Qg(x);h(S),n(x)}return u.jsx("input",{ref:m,id:t,type:"text",inputMode:"decimal",value:d,onChange:p,placeholder:r,required:i,autoFocus:o,style:{...Oa,...l}})}function fs(t=B4){const[e,n]=k.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return k.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function i(l){n(l.matches)}i(r),r.addEventListener("change",i);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",i),window.removeEventListener("resize",o)}},[t]),e}function PT(){const[t,e]=k.useState(()=>typeof window>"u"?1200:window.innerWidth);return k.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=po.wide,isMedium:t>=po.tablet&&t<po.wide,isNarrowMedium:t>=po.mobile&&t<po.tablet,isMobile:t<po.mobile}}function An(){const{selectedBudgetId:t,currentUserId:e}=Ze(),n=q4(t),r=n.data,i=r?.budget||null,o=k.useMemo(()=>r?.accounts||{},[r?.accounts]),l=k.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),d=k.useMemo(()=>r?.categories||{},[r?.categories]),h=k.useMemo(()=>r?.categoryGroups||[],[r?.categoryGroups]),m=i?.owner_id===e,p=k.useMemo(()=>i?.user_ids||[],[i?.user_ids]),g=k.useMemo(()=>i?.accepted_user_ids||[],[i?.accepted_user_ids]),v=i?.total_available??0,_=k.useMemo(()=>r?.monthMap||{},[r?.monthMap]),E=k.useCallback(L=>{if(!t)return;const F=Ve.getQueryData(ke.budget(t));F&&Ve.setQueryData(ke.budget(t),{...F,accounts:L})},[t]),x=k.useCallback(L=>{if(!t)return;const F=Ve.getQueryData(ke.budget(t));F&&Ve.setQueryData(ke.budget(t),{...F,accountGroups:L})},[t]),S=k.useCallback(L=>{if(!t)return;const F=Ve.getQueryData(ke.budget(t));F&&Ve.setQueryData(ke.budget(t),{...F,categories:L})},[t]),C=k.useCallback(L=>{if(!t)return;const F=Ve.getQueryData(ke.budget(t));F&&Ve.setQueryData(ke.budget(t),{...F,categoryGroups:L})},[t]),T=k.useCallback(async()=>{t&&await Ve.invalidateQueries({queryKey:ke.budget(t)})},[t]),A=k.useCallback(()=>Object.entries(o).filter(([,L])=>{const F=L.account_group_id?l[L.account_group_id]:void 0,H=F&&F.on_budget!==null?F.on_budget:L.on_budget!==!1,O=F&&F.is_active!==null?F.is_active:L.is_active!==!1;return H&&O}).reduce((L,[,F])=>L+F.balance,0),[o,l]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:i,accounts:o,accountGroups:l,categories:d,categoryGroups:h,isOwner:m,budgetUserIds:p,acceptedUserIds:g,totalAvailable:v,monthMap:_,setAccountsOptimistic:E,setAccountGroupsOptimistic:x,setCategoriesOptimistic:S,setCategoryGroupsOptimistic:C,refreshBudget:T,getOnBudgetTotal:A}}function Ci(t,e,n){const{addLoadingHold:r,removeLoadingHold:i}=sr(),o=Ft(),l=n6(t,e,n,{enabled:!!t});k.useEffect(()=>{const T=t?ke.month(t,e,n):null;return!(T?o.getQueryData(T):null)&&l.isLoading?r("month-query","Loading month data..."):i("month-query"),()=>i("month-query")},[l.isLoading,t,e,n,o,r,i]);const d=l.data?.month||null,h=k.useMemo(()=>d?.income||[],[d?.income]),m=k.useMemo(()=>d?.expenses||[],[d?.expenses]),p=k.useMemo(()=>d?.transfers||[],[d?.transfers]),g=k.useMemo(()=>d?.adjustments||[],[d?.adjustments]),v=k.useMemo(()=>d?.category_balances||[],[d?.category_balances]),_=k.useMemo(()=>d?.account_balances||[],[d?.account_balances]),E=d?.total_income||0,x=d?.total_expenses||0,S=d?.are_allocations_finalized||!1,C=d?.previous_month_income??0;return{isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,month:d,income:h,expenses:m,transfers:p,adjustments:g,categoryBalances:v,accountBalances:_,totalIncome:E,totalExpenses:x,areAllocationsFinalized:S,previousMonthIncome:C}}const J6={trackChange:()=>{},clearChanges:()=>{},removeChange:()=>{},getChanges:()=>[],hasChanges:()=>!1,isSaving:!1,setIsSaving:()=>{},lastSaveTime:null,setLastSaveTime:()=>{},saveError:null,setSaveError:()=>{},clearSaveError:()=>{},syncError:null,setSyncError:()=>{}},zT=k.createContext(J6);function e3({children:t}){const[e,n]=k.useState(new Map),[r,i]=k.useState(!1),[o,l]=k.useState(null),[d,h]=k.useState(null),[m,p]=k.useState(null),g=k.useCallback(H=>{i(H)},[]),v=k.useCallback(H=>{l(H)},[]),_=k.useCallback(H=>{h(H)},[]),E=k.useCallback(H=>H.type==="month"&&H.year!==void 0&&H.month!==void 0?`${H.type}:${H.budgetId}:${H.year}:${H.month}`:`${H.type}:${H.budgetId}`,[]),x=k.useCallback(H=>{n(O=>{const I=new Map(O),N=E(H);return I.set(N,{...H,timestamp:Date.now()}),I})},[E]),S=k.useCallback(()=>{n(new Map)},[]),C=k.useCallback(H=>{n(O=>{const I=new Map(O),N=E(H);return I.delete(N),I})},[E]),T=k.useCallback(()=>Array.from(e.values()),[e]),A=k.useCallback(()=>e.size>0,[e]),L=k.useCallback(()=>{h(null)},[]),F={trackChange:x,clearChanges:S,removeChange:C,getChanges:T,hasChanges:A,isSaving:r,lastSaveTime:o,saveError:d,clearSaveError:L,setIsSaving:g,setLastSaveTime:v,setSaveError:_,syncError:m,setSyncError:p};return u.jsx(zT.Provider,{value:F,children:t})}function mc(){const t=k.useContext(zT);if(!t)throw new Error("useSync must be used within a SyncProvider");return t}function bm(){const{trackChange:t}=mc();return{updateBudgetCacheAndTrack:(n,r)=>{Ve.setQueryData(ke.budget(n),r),t({type:"budget",budgetId:n})}}}function BT(){const t=Ft(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=bn(),{updateBudgetCacheAndTrack:r}=bm(),i=Hn({onMutate:async l=>{const{budgetId:d,accounts:h}=l,m=ke.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,accounts:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateAccounts] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{accounts:d}=l;return{accounts:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(ke.budget(d.budgetId),h.previousData)}});return{updateAccounts:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function t3(){const t=Ft(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=bn(),{updateBudgetCacheAndTrack:r}=bm(),i=Hn({onMutate:async l=>{const{budgetId:d,accountGroups:h}=l,m=ke.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,accountGroups:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateAccountGroups] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{accountGroups:d}=l;return{accountGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(ke.budget(d.budgetId),h.previousData)}});return{updateAccountGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function LT(){const t=Ft(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=bn(),{updateBudgetCacheAndTrack:r}=bm(),i=Hn({onMutate:async l=>{const{budgetId:d,categories:h}=l,m=ke.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,categories:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateCategories] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{categories:d}=l;return{categories:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(ke.budget(d.budgetId),h.previousData)}});return{updateCategories:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}function n3(){const t=Ft(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=bn(),{updateBudgetCacheAndTrack:r}=bm(),i=Hn({onMutate:async l=>{const{budgetId:d,categoryGroups:h}=l,m=ke.budget(d);await t.cancelQueries({queryKey:m});const p=t.getQueryData(m);if(p){const v={...p,categoryGroups:h};r(d,v)}if(e.type==="budget")try{await n(d,"budget")}catch(v){console.warn("[useUpdateCategoryGroups] Failed to save current document immediately:",v)}return{previousData:p}},mutationFn:async l=>{const{categoryGroups:d}=l;return{categoryGroups:d}},onError:(l,d,h)=>{h?.previousData&&t.setQueryData(ke.budget(d.budgetId),h.previousData)}});return{updateCategoryGroups:{mutate:l=>i.mutate(l),mutateAsync:l=>i.mutateAsync(l),isPending:i.isPending,isError:i.isError,error:i.error,reset:i.reset}}}async function vm(t){const{budgetId:e,updates:n,description:r}=t,i={...n,updated_at:new Date().toISOString()},o=Ta(i);await qn("budgets",e,o,r,{merge:!0});const l=Ve.getQueryData(ke.budget(e));l&&Ve.setQueryData(ke.budget(e),{...l,budget:{...l.budget,...n}})}function r3(){const t=Ft(),e=Hn({onMutate:async r=>{const{budgetId:i,newName:o}=r,l=ke.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,name:o.trim()}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,newName:o}=r,l=o.trim();return await vm({budgetId:i,updates:{name:l},description:`renaming budget to "${l}"`}),{newName:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.budget(i.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function s3({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:i,saveAccounts:o,saveAccountGroups:l,setError:d}){const h=k.useCallback(async(p,g,v)=>{const _=e[p];if(!_)return;const E=v==="ungrouped"?pn:v,x=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===v),S={};Object.entries(e).forEach(([T,A])=>{T!==p&&(S[T]={...A})});let C;if(g==="__group_end__"||x.length===0||!x.find(([T])=>T===g))C=(x.length>0?Math.max(...x.filter(([A])=>A!==p).map(([,A])=>A.sort_order)):-1)+1;else{const T=x.find(([A])=>A===g);if(T){const[,A]=T;C=A.sort_order,Object.entries(S).forEach(([L,F])=>{(F.account_group_id||"ungrouped")===v&&F.sort_order>=C&&(S[L]={...F,sort_order:F.sort_order+1})})}else C=0}if(S[p]={..._,account_group_id:E,sort_order:C},r(S),!!t)try{await o(S)}catch(T){d(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,d]),m=k.useCallback(async(p,g)=>{if(p===g)return;const v=Object.entries(n).sort(([,C],[,T])=>C.sort_order-T.sort_order),_=v.findIndex(([C])=>C===p),E=[...v],[x]=E.splice(_,1);if(g==="__end__")E.push(x);else{const C=E.findIndex(([T])=>T===g);E.splice(C,0,x)}const S={};if(E.forEach(([C,T],A)=>{S[C]={...T,sort_order:A}}),i(S),!!t)try{await l(S)}catch(C){d(C instanceof Error?C.message:"Failed to save new order")}},[t,n,i,l,d]);return{reorderAccountsInGroup:h,reorderGroups:m}}function i3(){const{selectedBudgetId:t}=Ze(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o}=An(),{updateAccounts:l}=BT(),{updateAccountGroups:d}=t3(),[h,m]=k.useState(null),p=k.useCallback(async U=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accounts:U})},[t,l]),g=k.useCallback(async U=>{if(!t)throw new Error("No budget selected");await d.mutateAsync({budgetId:t,accountGroups:U})},[t,d]),v=k.useCallback(async(U,$)=>{if(!t)throw new Error("No budget selected");await Promise.all([l.mutateAsync({budgetId:t,accounts:U}),d.mutateAsync({budgetId:t,accountGroups:$})])},[t,l,d]),_=k.useMemo(()=>Object.entries(n).filter(([,U])=>!U.is_hidden).reduce((U,[$,j])=>{const M=j.account_group_id||pn;return U[M]||(U[M]=[]),U[M].push({...j,id:$}),U},{}),[n]),E=k.useMemo(()=>Object.entries(n).filter(([,U])=>U.is_hidden).map(([U,$])=>({...$,id:U})).sort((U,$)=>U.sort_order-$.sort_order),[n]),x=k.useMemo(()=>Object.entries(r).sort(([,U],[,$])=>U.sort_order-$.sort_order).map(([U,$])=>({...$,id:U})),[r]),S=k.useCallback((U,$)=>{if(!e)return;const j=$||pn,M=Object.values(n).filter(Z=>Z.account_group_id===j),R=M.length>0?Math.max(...M.map(Z=>Z.sort_order)):-1,K=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,W={nickname:U.nickname,description:"",balance:0,account_group_id:j,sort_order:R+1,is_income_account:U.is_income_account??!1,is_income_default:U.is_income_default??!1,is_outgo_account:U.is_outgo_account??!1,is_outgo_default:U.is_outgo_default??!1,on_budget:U.on_budget!==!1,is_active:U.is_active!==!1,is_hidden:U.is_hidden??!1},q={...n};U.is_income_default&&Object.keys(q).forEach(Z=>{q[Z]={...q[Z],is_income_default:!1}}),U.is_outgo_default&&Object.keys(q).forEach(Z=>{q[Z]={...q[Z],is_outgo_default:!1}}),q[K]=W,i(q),p(q).catch(Z=>m(Z instanceof Error?Z.message:"Failed to create account."))},[e,n,i,p]),C=k.useCallback((U,$)=>{if(!e)return;const j=n[U];if(!j)return;const M=j.account_group_id||pn,R=$.account_group_id||pn;let K=j.sort_order;if(M!==R){const q=Object.values(n).filter(Z=>Z.account_group_id===R);K=q.length>0?Math.max(...q.map(Z=>Z.sort_order))+1:0}const W={};Object.entries(n).forEach(([q,Z])=>{q===U?W[q]={...Z,nickname:$.nickname,account_group_id:R,sort_order:K,is_income_account:$.is_income_account??!1,is_income_default:$.is_income_default??!1,is_outgo_account:$.is_outgo_account??!1,is_outgo_default:$.is_outgo_default??!1,on_budget:$.on_budget!==!1,is_active:$.is_active!==!1,is_hidden:$.is_hidden??!1}:(W[q]={...Z},$.is_income_default&&!j.is_income_default&&(W[q].is_income_default=!1),$.is_outgo_default&&!j.is_outgo_default&&(W[q].is_outgo_default=!1))}),i(W),p(W).catch(q=>m(q instanceof Error?q.message:"Failed to save account."))},[e,n,i,p]),T=k.useCallback(U=>{if(!confirm("Are you sure you want to delete this account?")||!e)return;const{[U]:$,...j}=n;i(j),p(j).catch(M=>m(M instanceof Error?M.message:"Failed to delete account."))},[e,n,i,p]),A=k.useCallback(async(U,$)=>{const j=n[U];if(!j)return;const M=j.account_group_id||pn,R=Object.entries(n).filter(([,ne])=>ne.account_group_id===M).sort(([,ne],[,B])=>ne.sort_order-B.sort_order),K=R.findIndex(([ne])=>ne===U),W=$==="up"?K-1:K+1;if(W<0||W>=R.length)return;const[q,Z]=R[W],X={};if(Object.entries(n).forEach(([ne,B])=>{ne===U?X[ne]={...B,sort_order:Z.sort_order}:ne===q?X[ne]={...B,sort_order:j.sort_order}:X[ne]={...B}}),i(X),!!e)try{await p(X)}catch(ne){i(n),m(ne instanceof Error?ne.message:"Failed to move account")}},[e,n,i,p]),L=k.useCallback(U=>{if(!e)return;const $=Object.values(r).map(W=>W.sort_order),j=$.length>0?Math.max(...$):-1,M=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,R={name:U.name,sort_order:j+1,expected_balance:U.expected_balance,on_budget:U.on_budget??null,is_active:U.is_active??null},K={...r,[M]:R};o(K),g(K).catch(W=>m(W instanceof Error?W.message:"Failed to create account type."))},[e,r,o,g]),F=k.useCallback((U,$)=>{if(!e)return;const j={...r,[U]:{...r[U],name:$.name,expected_balance:$.expected_balance,on_budget:$.on_budget??null,is_active:$.is_active??null}};o(j),g(j).catch(M=>m(M instanceof Error?M.message:"Failed to update account type."))},[e,r,o,g]),H=k.useCallback(U=>{if(U===pn){alert("Cannot delete the default Ungrouped account type.");return}if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e)return;const $={};Object.entries(n).forEach(([R,K])=>{$[R]=K.account_group_id===U?{...K,account_group_id:pn}:K});const{[U]:j,...M}=r;i($),o(M),v($,M).catch(R=>m(R instanceof Error?R.message:"Failed to delete account type."))},[e,n,r,i,o,v]),O=k.useCallback(async(U,$)=>{const j=Object.entries(r).sort(([,q],[,Z])=>q.sort_order-Z.sort_order),M=j.findIndex(([q])=>q===U),R=$==="up"?M-1:M+1;if(R<0||R>=j.length)return;const[K]=j.splice(M,1);j.splice(R,0,K);const W={};if(j.forEach(([q,Z],X)=>{W[q]={...Z,sort_order:X}}),o(W),!!e)try{await g(W)}catch(q){o(r),m(q instanceof Error?q.message:"Failed to move account type")}},[e,r,o,g]),{reorderAccountsInGroup:I,reorderGroups:N}=s3({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:i,setAccountGroupsOptimistic:o,saveAccounts:p,saveAccountGroups:g,setError:m});return{accounts:n,accountGroups:r,accountsByGroup:_,hiddenAccounts:E,sortedGroups:x,currentBudget:e,error:h,setError:m,handleCreateAccount:S,handleUpdateAccount:C,handleDeleteAccount:T,handleMoveAccount:A,handleCreateGroup:L,handleUpdateGroup:F,handleDeleteGroup:H,handleMoveGroup:O,reorderAccountsInGroup:I,reorderGroups:N}}function M1(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,i])=>{if(i.default_monthly_type==="percentage")return;const o=t.category_balances?.find(l=>l.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():i.default_monthly_amount!==void 0&&i.default_monthly_amount>0?n[r]=i.default_monthly_amount.toString():n[r]=""}),n}function a3(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Ze(),{categories:o,getOnBudgetTotal:l,totalAvailable:d}=An(),{month:h,isLoading:m,previousMonthIncome:p,areAllocationsFinalized:g}=Ci(n,r,i),v=k.useMemo(()=>h?.income?h.income.reduce((B,G)=>B+G.amount,0):0,[h]),{saveDraftAllocations:_}=R6(),{finalizeAllocations:E}=MP(),{deleteAllocations:x}=ZT(),S=k.useMemo(()=>M1(h,o),[h,o]),[C,T]=k.useState(S),[A,L]=k.useState(!1),[F,H]=k.useState(null),O=k.useRef(null);k.useMemo(()=>Object.values(o).reduce((B,G)=>B+(G.balance??0),0),[o]),k.useEffect(()=>{if(!h)return;const B=`${h.year}-${h.month}`;O.current!==B&&(L(!1),T(M1(h,o)),O.current=B)},[h,o]);const I=k.useCallback((B,G)=>{if(G.default_monthly_type==="percentage"&&G.default_monthly_amount!==void 0)return Pe(G.default_monthly_amount/100*p);const te=C[B],ie=parseFloat(te||"0");return isNaN(ie)?0:Pe(ie)},[C,p]),N=k.useMemo(()=>Object.entries(o).reduce((B,[G,te])=>{const ie=I(G,te),ae=te.balance??0;if(ae<0){const fe=Math.abs(ae),Ee=Math.max(0,ie-fe);return B+Ee}return B+ie},0),[o,I]),U=l(),$=g?(h?.category_balances||[]).reduce((B,G)=>{const te=o[G.category_id]?.balance??0,ie=G.allocated,ae=te-ie;if(ae<0){const fe=Math.abs(ae);return B+Math.max(0,ie-fe)}return B+ie},0):0,j=A?d+$:d,M=k.useMemo(()=>A?j-N:j-N+$,[j,N,$,A]),R=k.useCallback((B,G)=>{T(te=>({...te,[B]:G}))},[]),K=k.useCallback(()=>{if(!h)return;const B={};Object.entries(o).forEach(([G,te])=>{if(te.default_monthly_type==="percentage")return;const ie=h.category_balances?.find(ae=>ae.category_id===G);ie&&ie.allocated>0?B[G]=ie.allocated.toString():te.default_monthly_amount!==void 0&&te.default_monthly_amount>0?B[G]=te.default_monthly_amount.toString():B[G]=""}),T(B),L(!1)},[h,o]),W=k.useCallback(()=>{const B={};return Object.entries(o).forEach(([G,te])=>{const ie=I(G,te);ie>0&&(B[G]=ie)}),B},[o,I]),q=k.useCallback(async()=>{if(n){H(null),t("allocations-save","Saving allocations...");try{await _(n,r,i,W()),L(!1)}catch(B){H(B instanceof Error?B.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,r,i,_,W,t,e]),Z=k.useCallback(async()=>{if(n){H(null),t("allocations-finalize","Applying allocations...");try{await E({budgetId:n,year:r,month:i,allocations:W(),onProgress:B=>{t("allocations-finalize",B.message)}}),L(!1)}catch(B){H(B instanceof Error?B.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,r,i,E,W,t,e]),X=k.useCallback(async()=>{if(n){H(null),t("allocations-delete","Deleting allocations...");try{await x({budgetId:n,year:r,month:i,onProgress:G=>{t("allocations-delete",G.message)}});const B={};Object.entries(o).forEach(([G,te])=>{te.default_monthly_type!=="percentage"&&(te.default_monthly_amount!==void 0&&te.default_monthly_amount>0?B[G]=te.default_monthly_amount.toString():B[G]="")}),T(B),L(!1)}catch(B){H(B instanceof Error?B.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,r,i,x,o,t,e]),ne=N-$;return{localAllocations:C,isEditingAppliedAllocations:A,error:F,monthLoading:m,onBudgetTotal:U,availableNow:j,currentDraftTotal:N,draftChangeAmount:ne,availableAfterApply:M,previousMonthIncome:p,currentMonthIncome:v,allocationsFinalized:g,getAllocationAmount:I,handleAllocationChange:R,resetAllocationsToSaved:K,handleSaveAllocations:q,handleFinalizeAllocations:Z,handleDeleteAllocations:X,setIsEditingAppliedAllocations:L,setError:H}}function o3({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:i}){const o=k.useMemo(()=>{const v={};return Object.entries(e).forEach(([_,E])=>{v[_]={current:E.balance??0,total:E.balance??0}}),v},[e]),[l,d]=k.useState(!1),[h,m]=k.useState(null),p=k.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const v=Object.keys(e),{total:_}=await k1(t,v,n,r),E={};Object.entries(e).forEach(([S,C])=>{const T=C.balance,A=_[S]??0;Math.abs(T-A)>.01&&(E[S]={stored:T,calculated:A})});const x=Object.keys(E).length>0?E:null;return m(x),x},[t,e,n,r]),g=k.useCallback(async()=>{if(!(!t||Object.keys(e).length===0)){d(!0);try{const v=Object.keys(e),{total:_}=await k1(t,v,n,r),E={};Object.entries(e).forEach(([x,S])=>{E[x]={...S,balance:_[x]??0}}),await i(E),m(null)}finally{d(!1)}}},[t,e,i,n,r]);return{categoryBalances:o,loadingBalances:l,categoryBalanceMismatch:h,checkCategoryBalanceMismatch:p,recalculateAndSaveCategoryBalances:g}}function l3({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:i,saveCategories:o,saveCategoryGroups:l,setError:d}){const[h,m]=k.useState(null),[p,g]=k.useState(null),[v,_]=k.useState(null),[E,x]=k.useState(null);function S(U,$){m("category"),g($),U.dataTransfer.effectAllowed="move"}function C(U,$,j){U.preventDefault(),h==="category"&&($!==p&&_($),x(j))}function T(U,$){U.preventDefault(),h==="category"?(x($),_(null)):h==="group"&&$!==p&&_($)}function A(){_(null)}function L(){x(null)}function F(){m(null),g(null),_(null),x(null)}async function H(U,$,j){if(U.preventDefault(),U.stopPropagation(),!p||h!=="category"){F();return}const M=t[p];if(!M)return;const R=j==="ungrouped"?Sn:j,K=Object.entries(t).filter(([,Z])=>(Z.category_group_id||"ungrouped")===j),W={};Object.entries(t).forEach(([Z,X])=>{Z!==p&&(W[Z]=X)});let q;if($==="__group_end__"||K.length===0||!K.find(([Z])=>Z===$))q=(K.length>0?Math.max(...K.filter(([X])=>X!==p).map(([,X])=>X.sort_order)):-1)+1;else{const Z=K.find(([X])=>X===$);Z?(q=Z[1].sort_order,Object.entries(W).forEach(([X,ne])=>{(ne.category_group_id||"ungrouped")===j&&ne.sort_order>=q&&(W[X]={...ne,sort_order:ne.sort_order+1})})):q=0}if(W[p]={...M,category_group_id:R,sort_order:q},r(W),F(),!!n)try{await o(W)}catch(Z){d(Z instanceof Error?Z.message:"Failed to save changes")}}async function O(U,$){U.preventDefault(),h==="category"?await H(U,"__group_end__",$):h==="group"&&await N(U,$)}function I(U,$){U.stopPropagation(),m("group"),g($),U.dataTransfer.effectAllowed="move"}async function N(U,$){if(U.preventDefault(),!p||h!=="group"||p===$){F();return}const j=e.findIndex(W=>W.id===p),M=[...e],[R]=M.splice(j,1);if($==="__end__")M.push(R);else{const W=M.findIndex(q=>q.id===$);M.splice(W,0,R)}const K=M.map((W,q)=>({...W,sort_order:q}));if(i(K),F(),!!n)try{await l(K)}catch(W){d(W instanceof Error?W.message:"Failed to save new order")}}return{dragType:h,draggedId:p,dragOverId:v,dragOverGroupId:E,setDragOverId:_,setDragOverGroupId:x,handleCategoryDragStart:S,handleCategoryDragOver:C,handleDragOverGroup:T,handleDragLeave:A,handleDragLeaveGroup:L,handleDragEnd:F,handleCategoryDrop:H,handleDropOnGroup:O,handleGroupDragStart:I,handleGroupDrop:N}}function c3(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ze(),{budget:r,categories:i,categoryGroups:o,isLoading:l,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,getOnBudgetTotal:m}=An(),{updateCategories:p}=LT(),{updateCategoryGroups:g}=n3(),[v,_]=k.useState(null),E=k.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:Z})},[t,p]),x=k.useCallback(async Z=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:Z})},[t,g]),S=k.useCallback(async(Z,X)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:Z}),g.mutateAsync({budgetId:t,categoryGroups:X})])},[t,p,g]),{categoryBalances:C,loadingBalances:T,categoryBalanceMismatch:A,checkCategoryBalanceMismatch:L,recalculateAndSaveCategoryBalances:F}=o3({budgetId:t,categories:i,currentYear:e,currentMonth:n,updateCategoriesWithBalances:E}),H=l3({categories:i,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:d,setCategoryGroupsOptimistic:h,saveCategories:E,saveCategoryGroups:x,setError:_});async function O(Z,X){if(!r)return;const ne=X||Sn,B=Object.values(i).filter(fe=>fe.category_group_id===ne),G=B.length>0?Math.max(...B.map(fe=>fe.sort_order)):-1,te=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,ie={name:Z.name,description:Z.description??"",category_group_id:ne,sort_order:G+1,default_monthly_amount:Z.default_monthly_amount??0,default_monthly_type:Z.default_monthly_type??"fixed",balance:0,is_hidden:Z.is_hidden??!1},ae={...i,[te]:ie};d(ae);try{await E(ae)}catch(fe){d(i),_(fe instanceof Error?fe.message:"Failed to create category")}}async function I(Z,X){if(r)try{const ne=i[Z];if(!ne)return;const B=ne.category_group_id||Sn,G=X.category_group_id||Sn;let te=ne.sort_order;if(B!==G){const ae=Object.values(i).filter(fe=>fe.category_group_id===G).filter((fe,Ee,me)=>i[Z]!==me[Ee]);te=ae.length>0?Math.max(...ae.map(fe=>fe.sort_order))+1:0}const ie={...i,[Z]:{...ne,name:X.name,description:X.description??"",category_group_id:G,sort_order:te,default_monthly_amount:X.default_monthly_amount??0,default_monthly_type:X.default_monthly_type??"fixed",is_hidden:X.is_hidden??!1}};d(ie),await E(ie)}catch(ne){_(ne instanceof Error?ne.message:"Failed to update category")}}async function N(Z){if(confirm("Are you sure you want to delete this category?")&&r)try{const{[Z]:X,...ne}=i;d(ne),await E(ne)}catch(X){_(X instanceof Error?X.message:"Failed to delete category")}}async function U(Z,X){const ne=i[Z];if(!ne)return;const B=ne.category_group_id||Sn,G=Object.entries(i).filter(([,me])=>me.category_group_id===B).sort((me,Ce)=>me[1].sort_order-Ce[1].sort_order),te=G.findIndex(([me])=>me===Z),ie=X==="up"?te-1:te+1;if(ie<0||ie>=G.length)return;const[ae,fe]=G[ie],Ee={};if(Object.entries(i).forEach(([me,Ce])=>{me===Z?Ee[me]={...Ce,sort_order:fe.sort_order}:me===ae?Ee[me]={...Ce,sort_order:ne.sort_order}:Ee[me]=Ce}),d(Ee),!!r)try{await E(Ee)}catch(me){d(i),_(me instanceof Error?me.message:"Failed to move category")}}async function $(Z){if(r)try{const X=o.length>0?Math.max(...o.map(G=>G.sort_order)):-1,ne={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:Z.name,sort_order:X+1},B=[...o,ne];h(B),await x(B)}catch(X){_(X instanceof Error?X.message:"Failed to create group")}}async function j(Z,X){if(r)try{const ne=o.map(B=>B.id===Z?{...B,name:X.name}:B);h(ne),await x(ne)}catch(ne){_(ne instanceof Error?ne.message:"Failed to update group")}}async function M(Z){if(Z===Sn){alert("Cannot delete the default Uncategorized category group.");return}if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const X={};Object.entries(i).forEach(([B,G])=>{X[B]=G.category_group_id===Z?{...G,category_group_id:Sn}:G});const ne=o.filter(B=>B.id!==Z);d(X),h(ne),await S(X,ne)}catch(X){_(X instanceof Error?X.message:"Failed to delete group")}}async function R(Z,X){const ne=[...o].sort((ae,fe)=>ae.sort_order-fe.sort_order),B=ne.findIndex(ae=>ae.id===Z),G=X==="up"?B-1:B+1;if(G<0||G>=ne.length)return;const[te]=ne.splice(B,1);ne.splice(G,0,te);const ie=ne.map((ae,fe)=>({...ae,sort_order:fe}));if(h(ie),!!r)try{await x(ie)}catch(ae){h(o),_(ae instanceof Error?ae.message:"Failed to move group")}}const K=Object.entries(i).filter(([,Z])=>!Z.is_hidden).reduce((Z,[X,ne])=>{const B=ne.category_group_id||Sn;return Z[B]||(Z[B]=[]),Z[B].push([X,ne]),Z},{}),W=Object.entries(i).filter(([,Z])=>Z.is_hidden).map(([Z,X])=>[Z,X]).sort((Z,X)=>Z[1].sort_order-X[1].sort_order),q=[...o].sort((Z,X)=>Z.sort_order-X.sort_order);return{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:K,hiddenCategories:W,sortedGroups:q,categoryBalances:C,isLoading:l,loadingBalances:T,error:v,setError:_,getOnBudgetTotal:m,categoryBalanceMismatch:A,checkCategoryBalanceMismatch:L,recalculateAndSaveCategoryBalances:F,handleCreateCategory:O,handleUpdateCategory:I,handleDeleteCategory:N,handleMoveCategory:U,handleCreateGroup:$,handleUpdateGroup:j,handleDeleteGroup:M,handleMoveGroup:R,dragType:H.dragType,draggedId:H.draggedId,dragOverId:H.dragOverId,dragOverGroupId:H.dragOverGroupId,setDragOverId:H.setDragOverId,setDragOverGroupId:H.setDragOverGroupId,handleCategoryDragStart:H.handleCategoryDragStart,handleCategoryDragOver:H.handleCategoryDragOver,handleDragOverGroup:H.handleDragOverGroup,handleDragLeave:H.handleDragLeave,handleDragLeaveGroup:H.handleDragLeaveGroup,handleDragEnd:H.handleDragEnd,handleCategoryDrop:H.handleCategoryDrop,handleDropOnGroup:H.handleDropOnGroup,handleGroupDragStart:H.handleGroupDragStart,handleGroupDrop:H.handleGroupDrop}}function u3(t){switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return t.totalMonthsToFetch?`Loading ${t.totalMonthsToFetch} months...`:"Loading months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating balances...";case"saving":return t.totalMonths?`Saving ${t.totalMonths} months...`:"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating..."}}function dd({budgetId:t,year:e,month:n,monthMap:r,checkAnyMonth:i=!1,requireMonthLoaded:o=!1,currentMonth:l,additionalCondition:d=!0,onProgress:h,onError:m,logPrefix:p="[AutoRecalc]"}){const[g,v]=k.useState(null),_=k.useRef(!1),E=k.useRef(null),x=k.useRef(null),S=On(),C=k.useRef(null),{addLoadingHold:T,removeLoadingHold:A}=sr();return k.useEffect(()=>{if(!t||!d||o&&!l)return;let L;const F=S.pathname;if(i){C.current!==F&&(E.current=null,C.current=F);const I=vT(r);if(I.length===0||_.current||(L=`any-${I[0]}`,E.current===L))return}else{if(e===void 0||n===void 0){console.warn(`${p} year and month are required when checkAnyMonth is false`);return}const I=vt(e,n),N=r[I]?.needs_recalculation===!0;if(L=`${e}-${n}`,(C.current!==F||x.current!==L)&&(E.current=null,C.current=F,x.current=L),E.current===L)return;if(!N||_.current){E.current=L;return}`${e}${String(n).padStart(2,"0")}`}_.current=!0,E.current=L;const H=`recalc-${t}`;T(H,"Recalculating balances..."),x6(t,{onProgress:I=>{v(I);const N=u3(I);T(H,N),h?.(I)}}).then(()=>{Ve.invalidateQueries({queryKey:["month",t]})}).catch(I=>{const N=I instanceof Error?I:new Error(String(I));m?m(N):console.error(`${p} Recalculation failed:`,N)}).finally(()=>{_.current=!1,v(null),A(H)})},[t,e,n,r,i,o,l,d,h,m,p,S.pathname,T,A]),{recalcProgress:g,isRecalculating:g!==null}}function d3(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??vt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function h3(t){const e=new Date,n=e.getFullYear(),r=e.getMonth()+1;let i=n,o=r-3;for(;o<=0;)o+=12,i-=1;const l=vt(i,o);return(await kn("months","useInitialDataLoad: loading initial months",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:l}])).docs.map(m=>{const p=m.data,g=p.year,v=p.month;return d3(p,t,g,v)}).sort((m,p)=>m.year!==p.year?m.year-p.year:m.month-p.month)}async function f3(t){const[e,n,r]=await Promise.all([B0(t),U0(t),h3(t)]);return{budget:e,payees:n,months:r}}function m3(t,e){return Ro({queryKey:t?["initialDataLoad",t]:["initialDataLoad","none"],queryFn:()=>f3(t),enabled:!!t&&e?.enabled!==!1,staleTime:1/0})}async function p3(t,e,n,r){const i=ke.month(t,e,n),o=r.getQueryData(i);if(!o?.month)throw new Error(`Month ${e}/${n} not found in cache`);const l=o.month,d=await g3(t,e,n,r),h=$0(l,d);return r.setQueryData(i,{month:h}),h}async function g3(t,e,n,r){const{year:i,month:o}=Kl(e,n),l=ke.month(t,i,o),d=r.getQueryData(l);if(d?.month)return Vu(d.month);try{const h=await L0(t,i,o);if(h)return r.setQueryData(l,{month:h}),Vu(h)}catch(h){console.warn(`[useLocalRecalculation] Could not fetch previous month ${i}/${o}:`,h)}return V0}function y3(){const t=On(),{saveAllChanges:e}=bn(),{hasChanges:n}=mc(),r=k.useRef(null);k.useEffect(()=>{const i=t.pathname;if(r.current===null){r.current=i;return}r.current!==i&&n()&&queueMicrotask(()=>{e("navigation save (page change)").catch(o=>{console.error("[useNavigationSave] Failed to save on navigation:",o)})}),r.current=i},[t.pathname,n,e])}const N1=300*1e3;function _3(t,e,n,r){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??vt(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}function P1(t,e){return e?t?new Date(e)>new Date(t):!0:!1}async function b3(t,e){const n=[],r=new Date,i=r.getFullYear(),o=r.getMonth()+1;let l=i,d=o-3;for(;d<=0;)d+=12,l-=1;const h=vt(l,d),[m,p,g]=await Promise.all([Ve.fetchQuery({queryKey:ke.budget(t),queryFn:()=>B0(t),staleTime:0}).catch(()=>null),Ve.fetchQuery({queryKey:ke.payees(t),queryFn:()=>U0(t),staleTime:0}).catch(()=>null),kn("months","useSyncCheck: checking for remote changes",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:h}]).catch(()=>({docs:[]}))]);if(m){const _=Ve.getQueryData(ke.budget(t));if(_){const E=_.budget?.updated_at;P1(E,m.budget.updated_at)&&(e.some(S=>S.type==="budget"&&S.budgetId===t)?n.push("Budget document has been updated remotely (you have unsaved local changes)"):Ve.setQueryData(ke.budget(t),m))}}p!==null&&Ve.getQueryData(ke.payees(t));const v=g.docs.map(_=>{const E=_.data,x=E.year,S=E.month;return _3(E,t,x,S)});for(const _ of v){const E=Ve.getQueryData(ke.month(t,_.year,_.month));E?.month&&P1(E.month.updated_at,_.updated_at)&&(e.some(S=>S.type==="month"&&S.budgetId===t&&S.year===_.year&&S.month===_.month)?n.push(`Month ${_.year}/${_.month} has been updated remotely (you have unsaved local changes)`):Ve.setQueryData(ke.month(t,_.year,_.month),{month:_}))}return n}function v3(t,e){const{setSyncError:n,getChanges:r}=mc(),i=k.useRef(null),o=k.useRef(null),l=k.useRef(0),d=k.useRef(!1);k.useEffect(()=>{if(!t||!e||d.current)return;d.current=!0;const h=async()=>{try{const m=r(),p=await b3(t,m);if(p.length>0){const g=`Sync conflict detected: ${p.join("; ")}`;n(g),qr.add({type:"error",message:g,autoDismissMs:0})}else n(null)}catch(m){console.error("[useSyncCheck] Sync check failed:",m);const p=`Failed to check for sync conflicts: ${m instanceof Error?m.message:String(m)}`;n(p),qr.add({type:"error",message:p,autoDismissMs:0})}};return o.current=setTimeout(()=>{h(),l.current=Date.now(),i.current=setInterval(()=>{h(),l.current=Date.now()},N1)},N1),()=>{o.current&&clearTimeout(o.current),i.current&&clearInterval(i.current),d.current=!1}},[t,e,n,r])}function x3(t,e,n){const r=Ft(),i=k.useRef(null),o=k.useRef(null);k.useEffect(()=>{if(i.current===null||o.current===null){i.current=e,o.current=n;return}if(i.current===e&&o.current===n)return;if(!t){i.current=e,o.current=n;return}const l=vt(i.current,o.current),m=vt(e,n)>l?_T(e,n):Kl(e,n),p=ke.month(t,m.year,m.month);if(!r.getQueryData(p)){const v=r.getQueryData(ke.budget(t)),_=vt(m.year,m.month);v?.monthMap&&_ in v.monthMap&&r.prefetchQuery({queryKey:p,queryFn:async()=>{const x=await L0(t,m.year,m.month);return x?{month:x}:null},staleTime:ac}).catch(x=>{console.warn(`[useMonthPrefetch] Failed to prefetch month ${m.year}/${m.month}:`,x)})}i.current=e,o.current=n},[t,e,n,r])}function ja(){Ve.removeQueries({queryKey:["budget"]}),Ve.removeQueries({queryKey:["month"]}),Ve.removeQueries({queryKey:["accessibleBudgets"]}),Ve.removeQueries({queryKey:["payees"]}),Ve.removeQueries({queryKey:["user"]}),console.log("[Migration] All caches cleared")}async function xm(t){try{const e=await t();return ja(),e}catch(e){throw ja(),e}}const UT=k.createContext(null),z1={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function w3({children:t}){const[e,n]=k.useState(z1),r=k.useCallback(()=>({setStage:d=>{n(h=>({...h,stage:d}))},setProgress:d=>{n(h=>({...h,progress:d}))},setCurrentItem:d=>{n(h=>({...h,currentItem:d}))},setDetails:d=>{n(h=>({...h,details:d}))},updateItemProgress:(d,h,m)=>{const p=h>0?Math.round(d/h*100):0;n(g=>({...g,progress:p,currentItem:m||`Item ${d} of ${h}`,details:`${d} / ${h} complete`}))}}),[]),i=k.useCallback(async(d,h)=>{n({isOpen:!0,migrationName:d,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const m=r();try{const p=await h(m);return ja(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){ja();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(v=>({...v,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=k.useCallback(()=>{n(d=>d.isComplete?z1:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),d))},[]),l={state:e,runMigrationWithProgress:i,closeModal:o};return u.jsx(UT.Provider,{value:l,children:t})}function S3(){const t=k.useContext(UT);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function E3(t){return(await kn("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function FT(t,e){return(await kn("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(i=>({id:i.id,data:i.data,budgetId:i.data.budget_id,year:i.data.year,month:i.data.month})).sort((i,o)=>i.year!==o.year?i.year-o.year:i.month-o.month)}async function Na(t){const e=await E3(t),n=await kn("months",`${t}: batch reading all months`),r=new Map;for(const i of n.docs){const o=i.data.budget_id,l={id:i.id,data:i.data,budgetId:o,year:i.data.year,month:i.data.month};r.has(o)||r.set(o,[]),r.get(o).push(l)}for(const i of r.values())i.sort((o,l)=>o.year!==l.year?o.year-l.year:o.month-l.month);return{budgets:e,monthsByBudget:r}}async function hd(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"months",docId:hs(r.budgetId,r.year,r.month),data:Ta({...r.data,updated_at:new Date().toISOString()})}));await pm(n,`${e}: batch writing ${t.length} months`)}async function VT(t,e){if(t.length===0)return;const n=t.map(r=>({collectionPath:"budgets",docId:r.budgetId,data:Ta({...r.data,updated_at:new Date().toISOString()})}));await pm(n,`${e}: batch writing ${t.length} budgets`)}async function $T(t,e,n){if(e.length===0)return;let r=V0;const i=[];for(const p of e){const g=$0(p,r);i.push(g),r=Vu(g)}const o=i.map(p=>({budgetId:t,year:p.year,month:p.month,data:p}));await hd(o,n);const l=r.accountEndBalances,d=r.categoryEndBalances,{exists:h,data:m}=await At("budgets",t,`${n}: reading budget for final update`);if(h&&m){const p=bT(m.month_map||{}),g=q0(p),v={...d},_=m.categories||{};for(const E of Object.keys(_))E in v||(v[E]=0);await xT(t,l,v,g)}}async function C3(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,i]of n){i.sort((d,h)=>d.year!==h.year?d.year-h.year:d.month-h.month),await hd(i,e);const l=(await FT(r,e)).map(d=>d.data);await $T(r,l,e)}}async function T3(t){const{exists:e,data:n}=await At("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const r={...n.accounts};for(const o of Object.keys(r))r[o]&&typeof r[o]=="object"&&(r[o]={...r[o],balance:0});const i={...n.categories};for(const o of Object.keys(i))i[o]&&typeof i[o]=="object"&&(i[o]={...i[o],balance:0});await qn("budgets",t,{...n,accounts:r,categories:i,month_map:{},total_available:0,is_needs_recalculation:!1,updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} balances to zero`)}function A3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,m]=k.useState(null),[p,g]=k.useState(null);async function v(){if(t){r(!0);try{const E=await kn("months","delete all months: scanning for all months"),x=[],S=new Set;for(const C of E.docs){const{budget_id:T,year:A,month:L}=C.data;S.add(T),x.push({docId:C.id,budgetId:T,year:A,month:L})}x.sort((C,T)=>C.budgetId!==T.budgetId?C.budgetId.localeCompare(T.budgetId):C.year!==T.year?C.year-T.year:C.month-T.month),d({monthsToDelete:x,monthsCount:x.length,budgetCount:S.size})}catch{}finally{r(!1)}}}async function _(){if(!t||!l||l.monthsToDelete.length===0)return;o(!0),m(null);const E=l.monthsToDelete.length,x=new Set,S=[];for(const F of l.monthsToDelete)x.add(F.budgetId);g({phase:"deleting",deleted:0,total:E,currentMonth:null,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:0});const C=l.monthsToDelete.map(F=>({collectionPath:"months",docId:F.docId}));let T=0;try{await yT(C,"delete all months: batch deleting all month documents",F=>{T=F,g({phase:"deleting",deleted:F,total:E,currentMonth:`Batch ${Math.ceil(F/500)} of ${Math.ceil(E/500)}`,budgetsRecalculated:0,totalBudgets:l.budgetCount,percentComplete:Math.round(F/E*70)})}),T=E}catch(F){S.push(`Batch delete failed: ${F instanceof Error?F.message:"Unknown error"}`)}const A=Array.from(x);let L=0;for(const F of A){g({phase:"resetting-budgets",deleted:T,total:E,currentMonth:`Budget ${L+1}/${A.length}`,budgetsRecalculated:L,totalBudgets:A.length,percentComplete:70+Math.round(L/A.length*25)});try{await T3(F),L++}catch{L++}}g({phase:"clearing-cache",deleted:T,total:E,currentMonth:null,budgetsRecalculated:L,totalBudgets:A.length,percentComplete:95}),ja(),g({phase:"complete",deleted:T,total:E,currentMonth:null,budgetsRecalculated:L,totalBudgets:A.length,percentComplete:100}),m({deleted:T,errors:S,budgetsRecalculated:L}),o(!1),g(null),S.length===0&&(d({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:i,deleteResult:h,deleteProgress:p,deleteAllMonths:_}}const Wg="sample@sample.com",ho="budget_1767746876726_xuj7nzl4l";function j3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,m]=k.useState(null),[p,g]=k.useState(null);async function v(){if(t){r(!0);try{let x=(await kn("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:Wg}])).docs;if(x.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const F=await At("budgets",ho,"delete sample user budget: checking fallback budget ID");F.exists&&F.data&&(console.log("delete sample user budget: found fallback budget",ho),x=[{id:ho,data:F.data}])}const S=[];let C=0,T=!1;for(const F of x){const H=F.id,O=F.data.name,N=(await kn("months",`delete sample user budget: counting months for budget ${H}`,[{field:"budget_id",op:"==",value:H}])).docs.length;C+=N,S.push({budgetId:H,budgetName:O,monthCount:N}),(await kn("payees",`delete sample user budget: checking payees for budget ${H}`,[{field:"budget_id",op:"==",value:H}])).docs.length>0&&(T=!0)}const A=[],L=await kn("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:Wg}]);L.docs.length>0&&L.docs[0].data.budget_ids?.includes(ho)&&(S.some(I=>I.budgetId===ho)||(console.log("delete sample user budget: found stale budget reference in sample user document",ho),A.push(ho))),d({budgets:S,totalBudgets:S.length,totalMonths:C,hasPayees:T,staleBudgetIds:A})}catch(E){console.error("Error scanning for sample user budgets:",E)}finally{r(!1)}}}async function _(){if(!t||!l||l.budgets.length===0&&l.staleBudgetIds.length===0)return;o(!0),m(null);const E=[];let x=0,S=0,C=0;const T=l.totalMonths,A=l.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:A,percentComplete:0});for(const F of l.budgets)try{const O=(await kn("months",`delete sample user budget: fetching month IDs for budget ${F.budgetId}`)).docs.filter(I=>I.data.budget_id===F.budgetId).map(I=>({collectionPath:"months",docId:I.id}));O.length>0&&(await yT(O,`delete sample user budget: deleting ${O.length} months for budget ${F.budgetId}`,I=>{x=I,g({phase:"deleting-months",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:Math.round(x/Math.max(T,1)*60)})}),x=O.length)}catch(H){E.push(`Failed to delete months for budget ${F.budgetId}: ${H instanceof Error?H.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:60});for(const F of l.budgets)try{await My("payees",F.budgetId,`delete sample user budget: deleting payees for budget ${F.budgetId}`),C++}catch{}g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:70});for(const F of l.budgets)try{await My("budgets",F.budgetId,`delete sample user budget: deleting budget ${F.budgetId}`),S++,g({phase:"deleting-budgets",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:70+Math.round(S/A*10)})}catch(H){E.push(`Failed to delete budget ${F.budgetId}: ${H instanceof Error?H.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:80});const L=[...l.budgets.map(F=>F.budgetId),...l.staleBudgetIds];try{const F=await kn("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:Wg}]);if(F.docs.length>0){const H=F.docs[0],O=H.id,I=H.data,N=(I.budget_ids||[]).filter(U=>!L.includes(U));await qn("users",O,{...I,budget_ids:N,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${L.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(F){E.push(`Failed to update sample user document: ${F instanceof Error?F.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:95}),ja(),g({phase:"complete",monthsDeleted:x,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:100}),m({budgetsDeleted:S,monthsDeleted:x,payeesDeleted:C,errors:E}),o(!1),g(null),E.length===0&&(d({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:l,isScanning:n,scanStatus:v,isDeleting:i,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:_}}function B1(t){if(!t)return 0;let e=0;for(const n of t)dt(n.start_balance??0)&&e++,dt(n.end_balance??0)&&e++,dt(n.allocated??0)&&e++,dt(n.spent??0)&&e++,dt(n.income??0)&&e++,dt(n.expenses??0)&&e++,dt(n.net_change??0)&&e++;return e}function L1(t){if(!t)return 0;let e=0;for(const n of t)dt(n.amount??0)&&e++;return e}async function U1(){const t=await kn("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,i=0;for(const g of t.docs){const v=g.data;let _=!1;dt(v.total_available??0)&&(i++,_=!0);const E=v.accounts;if(E&&typeof E=="object")for(const S of Object.values(E))dt(S.balance??0)&&(n++,_=!0);const x=v.categories;if(x&&typeof x=="object")for(const S of Object.values(x))dt(S.balance??0)&&(r++,_=!0),dt(S.default_monthly_amount??0)&&(r++,_=!0);_&&e++}const o=await kn("months","precision cleanup: scanning all months");let l=0,d=0,h=0,m=0,p=0;for(const g of o.docs){const v=g.data;let _=!1;(dt(v.total_income??0)||dt(v.total_expenses??0)||dt(v.previous_month_income??0))&&(_=!0);const E=L1(v.income);E>0&&(d+=E,_=!0);const x=L1(v.expenses);x>0&&(h+=x,_=!0);const S=B1(v.category_balances);S>0&&(m+=S,_=!0);const C=B1(v.account_balances);C>0&&(p+=C,_=!0),_&&l++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:i,totalMonths:o.docs.length,monthsWithPrecisionIssues:l,incomeValuesWithPrecisionIssues:d,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:m,accountBalancesWithPrecisionIssues:p}}function F1(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=Pe(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=Pe(e.end_balance)),e.allocated!==void 0&&(e.allocated=Pe(e.allocated)),e.spent!==void 0&&(e.spent=Pe(e.spent)),e.income!==void 0&&(e.income=Pe(e.income)),e.expenses!==void 0&&(e.expenses=Pe(e.expenses)),e.transfers!==void 0&&(e.transfers=Pe(e.transfers)),e.adjustments!==void 0&&(e.adjustments=Pe(e.adjustments)),e.net_change!==void 0&&(e.net_change=Pe(e.net_change)),e}function R3(t,e){let n=!1;dt(t.total_available??0)&&(t.total_available=Pe(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,l]of Object.entries(r)){const d=l;dt(d.balance??0)&&(r[o].balance=Pe(d.balance??0),e.accountsFixed++,n=!0)}const i=t.categories;if(i&&typeof i=="object")for(const[o,l]of Object.entries(i)){const d=l;dt(d.balance??0)&&(i[o].balance=Pe(d.balance??0),e.categoriesFixed++,n=!0),dt(d.default_monthly_amount??0)&&(i[o].default_monthly_amount=Pe(d.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function D3(t,e){let n=!1;if(dt(t.total_income??0)&&(t.total_income=Pe(t.total_income??0),n=!0),dt(t.total_expenses??0)&&(t.total_expenses=Pe(t.total_expenses??0),n=!0),dt(t.previous_month_income??0)&&(t.previous_month_income=Pe(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const i of t.income)dt(i.amount??0)?(r.push({...i,amount:Pe(i.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(i);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const i of t.expenses)dt(i.amount??0)?(r.push({...i,amount:Pe(i.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(i);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const i of t.category_balances)dt(i.start_balance??0)||dt(i.end_balance??0)||dt(i.allocated??0)||dt(i.spent??0)||dt(i.transfers??0)||dt(i.adjustments??0)?(r.push(F1(i)),e.categoryBalancesFixed++,n=!0):r.push(i);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const i of t.account_balances)dt(i.start_balance??0)||dt(i.end_balance??0)||dt(i.income??0)||dt(i.expenses??0)||dt(i.transfers??0)||dt(i.adjustments??0)||dt(i.net_change??0)?(r.push(F1(i)),e.accountBalancesFixed++,n=!0):r.push(i);t.account_balances=r}return{fixed:n,data:t}}function I3(t,e,n){const r={...t.data},{fixed:i,data:o}=R3(r,n),l=i?{budgetId:t.id,data:o}:null;i&&n.budgetsProcessed++;const d=[];let h=!1;for(const m of e){const p={...m.data},{fixed:g,data:v}=D3(p,n);g&&(n.monthsProcessed++,h=!0),d.push(v)}return{budgetUpdate:l,fixedMonths:d,hasMonthFixes:h}}async function k3(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await Na("precision cleanup"),r=[],i=[];for(const o of e)try{const l=n.get(o.id)||[],{budgetUpdate:d,fixedMonths:h,hasMonthFixes:m}=I3(o,l,t);d&&r.push(d),(m||h.length>0)&&i.push({budgetId:o.id,months:h})}catch(l){t.errors.push(`Budget ${o.id}: ${l instanceof Error?l.message:String(l)}`)}if(r.length>0)try{await VT(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:l}of i)try{await $T(o,l,"precision cleanup")}catch(d){t.errors.push(`Budget ${o} recalc: ${d instanceof Error?d.message:String(d)}`)}return t}function O3({currentUser:t,onComplete:e}){const[n,r]=k.useState(null),[i,o]=k.useState(!1),[l,d]=k.useState(!1),[h,m]=k.useState(null),[p,g]=k.useState(null),v=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,_=v>0,E=k.useCallback(async()=>{if(t){o(!0),g(null);try{const S=await U1();r(S),m(null)}catch(S){g(S instanceof Error?S.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),x=k.useCallback(async()=>{if(!(!t||!_)){d(!0),g(null);try{const S=await xm(()=>k3());m(S);const C=await U1();r(C),e?.()}catch(S){g(S instanceof Error?S.message:"Failed to run precision cleanup")}finally{d(!1)}}},[t,_,e]);return{status:n,isScanning:i,isRunning:l,result:h,error:p,totalIssues:v,hasIssues:_,hasData:n!==null,scan:E,runCleanup:x}}function wm(t){const e=t.income||[],n=t.expenses||[],r=Pe(e.reduce((d,h)=>d+h.amount,0)),i=Pe(n.reduce((d,h)=>d+h.amount,0)),o=M3(t),l=N3(t);return{...t,total_income:r,total_expenses:i,account_balances:o,category_balances:l}}function M3(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],i=t.adjustments||[],o=t.account_balances||[],l=new Map;for(const m of o)nt(m.account_id)||l.set(m.account_id,m);const d=new Set;for(const m of e)nt(m.account_id)||d.add(m.account_id);for(const m of n)nt(m.account_id)||d.add(m.account_id);for(const m of r)nt(m.from_account_id)||d.add(m.from_account_id),nt(m.to_account_id)||d.add(m.to_account_id);for(const m of i)nt(m.account_id)||d.add(m.account_id);for(const m of o)nt(m.account_id)||d.add(m.account_id);const h=[];for(const m of d){const p=l.get(m),g=Pe(p?.start_balance??0),v=Pe(e.filter(A=>A.account_id===m).reduce((A,L)=>A+L.amount,0)),_=Pe(n.filter(A=>A.account_id===m).reduce((A,L)=>A+L.amount,0)),E=Pe(r.filter(A=>A.from_account_id===m).reduce((A,L)=>A-L.amount,0)),x=Pe(r.filter(A=>A.to_account_id===m).reduce((A,L)=>A+L.amount,0)),S=Pe(x+E),C=Pe(i.filter(A=>A.account_id===m).reduce((A,L)=>A+L.amount,0)),T=Pe(v+_+S+C);h.push({account_id:m,start_balance:g,income:v,expenses:_,transfers:S,adjustments:C,net_change:T,end_balance:Pe(g+T)})}return h}function N3(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],i=t.category_balances||[],o=new Map;for(const g of i)lt(g.category_id)||o.set(g.category_id,g);const l=new Map;for(const g of e){if(lt(g.category_id))continue;const v=l.get(g.category_id)||0;l.set(g.category_id,v+g.amount)}const d=new Map;for(const g of n){if(!lt(g.from_category_id)){const v=d.get(g.from_category_id)||0;d.set(g.from_category_id,v-g.amount)}if(!lt(g.to_category_id)){const v=d.get(g.to_category_id)||0;d.set(g.to_category_id,v+g.amount)}}const h=new Map;for(const g of r)if(!lt(g.category_id)){const v=h.get(g.category_id)||0;h.set(g.category_id,v+g.amount)}const m=new Set;for(const g of i)lt(g.category_id)||m.add(g.category_id);for(const g of e)lt(g.category_id)||m.add(g.category_id);for(const g of n)lt(g.from_category_id)||m.add(g.from_category_id),lt(g.to_category_id)||m.add(g.to_category_id);for(const g of r)lt(g.category_id)||m.add(g.category_id);const p=[];for(const g of m){const v=o.get(g),_=Pe(l.get(g)??0),E=Pe(d.get(g)??0),x=Pe(h.get(g)??0);if(v){const S=Pe(v.start_balance),C=Pe(v.allocated);p.push({category_id:g,start_balance:S,allocated:C,spent:_,transfers:E,adjustments:x,end_balance:Pe(S+C+_+E+x)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:_,transfers:E,adjustments:x,end_balance:Pe(_+E+x)})}return p}const P3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],z3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function Sm(t){return!t||nt(t)?!0:P3.includes(t)}function Em(t){return!t||lt(t)?!0:z3.includes(t)}function qT(t){return Sm(t.account_id)||Em(t.category_id)}function B3(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:Sm(t.account_id)?qt:t.account_id,category_id:Em(t.category_id)?Kt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function L3(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],i=[],o=[];let l=0,d=0;for(const m of n)qT(m)?(Sm(m.account_id)&&!nt(m.account_id)&&l++,Em(m.category_id)&&!lt(m.category_id)&&d++,o.push(B3(m))):i.push(m);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:wm({...e,expenses:i,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:l,invalidCategoriesFixed:d}}}async function U3(){const{budgets:t,monthsByBudget:e}=await Na("expense-to-adjustment-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.expenses||[];for(const g of p)qT(g)&&(r++,Sm(g.account_id)&&!nt(g.account_id)&&i++,Em(g.category_id)&&!lt(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:i,invalidCategoriesToFix:o}}async function F3(){const{budgets:t,monthsByBudget:e}=await Na("expense-to-adjustment-migration"),n=[];let r=0,i=0,o=0;const l=[];for(const d of t){const h=e.get(d.id)||[];for(const m of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=L3(m);p&&g&&(n.push({budgetId:d.id,year:m.year,month:m.month,data:g}),r+=v.expensesMigrated,i+=v.invalidAccountsFixed,o+=v.invalidCategoriesFixed)}catch(p){l.push(`Month ${m.year}/${m.month} in budget ${d.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await hd(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:i,invalidCategoriesFixed:o,errors:l}}function V3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,m]=k.useState(null);async function p(){if(t){r(!0);try{const _=await U3();d(_)}catch(_){console.error("Failed to scan for expense to adjustment migration:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const _=await xm(()=>F3());m(_),e?.()}catch(_){m({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.expensesToMigrate>0;return{status:l,isScanning:n,scanStatus:p,hasItemsToMigrate:v,isRunning:i,result:h,runMigration:g}}function HT(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const i=t.accounts;if(i)for(const o of Object.keys(i))n.add(o);return{categoryIds:e,accountIds:n}}function ha(t,e){return!t||lt(t)?!1:!e.has(t)}function Bs(t,e){return!t||nt(t)?!1:!e.has(t)}function $3(t,e){const n=t.data;let r=0,i=0,o=0,l=0,d=0,h=0,m=!1;const p=(n.expenses||[]).map(x=>{const S={...x};let C=!1;return ha(x.category_id,e.categoryIds)&&(S.category_id=Kt,r++,C=!0),Bs(x.account_id,e.accountIds)&&(S.account_id=qt,i++,C=!0),C&&(o++,m=!0),S}),g=(n.income||[]).map(x=>{const S={...x};let C=!1;return Bs(x.account_id,e.accountIds)&&(S.account_id=qt,i++,C=!0),C&&(l++,m=!0),S}),v=(n.transfers||[]).map(x=>{const S={...x};let C=!1;return ha(x.from_category_id,e.categoryIds)&&(S.from_category_id=Kt,r++,C=!0),ha(x.to_category_id,e.categoryIds)&&(S.to_category_id=Kt,r++,C=!0),Bs(x.from_account_id,e.accountIds)&&(S.from_account_id=qt,i++,C=!0),Bs(x.to_account_id,e.accountIds)&&(S.to_account_id=qt,i++,C=!0),C&&(d++,m=!0),S}),_=(n.adjustments||[]).map(x=>{const S={...x};let C=!1;return ha(x.category_id,e.categoryIds)&&(S.category_id=Kt,r++,C=!0),Bs(x.account_id,e.accountIds)&&(S.account_id=qt,i++,C=!0),C&&(h++,m=!0),S});return m?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:v,adjustments:_,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function q3(){const{budgets:t,monthsByBudget:e}=await Na("orphaned-id-scan");let n=0,r=0,i=0,o=0,l=0,d=0,h=0;for(const m of t){const p=HT(m.data),g=e.get(m.id)||[];n+=g.length;for(const v of g){const _=v.data;for(const E of _.expenses||[]){let x=!1;ha(E.category_id,p.categoryIds)&&(r++,x=!0),Bs(E.account_id,p.accountIds)&&(i++,x=!0),x&&o++}for(const E of _.income||[])Bs(E.account_id,p.accountIds)&&(i++,l++);for(const E of _.transfers||[]){let x=!1;ha(E.from_category_id,p.categoryIds)&&(r++,x=!0),ha(E.to_category_id,p.categoryIds)&&(r++,x=!0),Bs(E.from_account_id,p.accountIds)&&(i++,x=!0),Bs(E.to_account_id,p.accountIds)&&(i++,x=!0),x&&d++}for(const E of _.adjustments||[]){let x=!1;ha(E.category_id,p.categoryIds)&&(r++,x=!0),Bs(E.account_id,p.accountIds)&&(i++,x=!0),x&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:i,affectedExpenses:o,affectedIncome:l,affectedTransfers:d,affectedAdjustments:h}}async function H3(){const{budgets:t,monthsByBudget:e}=await Na("orphaned-id-cleanup"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=HT(l.data),h=e.get(l.id)||[];for(const m of h)try{const{needsUpdate:p,updatedMonth:g,stats:v}=$3(m,d);p&&g&&(n.push({budgetId:l.id,year:m.year,month:m.month,data:g}),r+=v.categoryIdsFixed,i+=v.accountIdsFixed)}catch(p){o.push(`Month ${m.year}/${m.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await hd(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:i,errors:o}}function G3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,m]=k.useState(null);async function p(){if(t){r(!0);try{const _=await q3();d(_)}catch(_){console.error("Failed to scan for orphaned IDs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const _=await xm(()=>H3());m(_),e?.()}catch(_){m({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&(l.orphanedCategoryIds>0||l.orphanedAccountIds>0);return{status:l,isScanning:n,scanStatus:p,hasItemsToFix:v,isRunning:i,result:h,runMigration:g}}function Q3(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,i=lt(t.category_id)&&lt(e.category_id),o=!nt(t.account_id)&&!nt(e.account_id),l=t.account_id!==e.account_id;if(i&&o&&l)return{negative:n,positive:r,type:"account"};const d=nt(t.account_id)&&nt(e.account_id),h=!lt(t.category_id)&&!lt(e.category_id),m=t.category_id!==e.category_id;return d&&h&&m?{negative:n,positive:r,type:"category"}:null}function GT(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let i=r+1;i<t.length;i++){if(n.has(t[i].id))continue;const o=Q3(t[r],t[i]);if(o){e.push(o),n.add(t[r].id),n.add(t[i].id);break}}return e}function W3(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Kt,to_category_id:Kt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:qt,to_account_id:qt,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function K3(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],i=GT(n);if(i.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=i.map(W3),l=new Set;for(const m of i)l.add(m.negative.id),l.add(m.positive.id);const d=n.filter(m=>!l.has(m.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:d,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:i.length,adjustmentsRemoved:l.size}}}async function Y3(){const{budgets:t,monthsByBudget:e}=await Na("adjustments-to-transfers-scan");let n=0,r=0,i=0,o=0;for(const l of t){const d=e.get(l.id)||[];n+=d.length;for(const h of d){const p=h.data.adjustments||[],g=GT(p);r+=g.length;for(const v of g)v.type==="account"?i++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:i,categoryTransferPairs:o}}async function X3(){const{budgets:t,monthsByBudget:e}=await Na("adjustments-to-transfers-migration"),n=[];let r=0,i=0;const o=[];for(const l of t){const d=e.get(l.id)||[];for(const h of d)try{const{needsUpdate:m,updatedMonth:p,stats:g}=K3(h);m&&p&&(n.push({budgetId:l.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,i+=g.adjustmentsRemoved)}catch(m){o.push(`Month ${h.year}/${h.month} in budget ${l.id}: ${m instanceof Error?m.message:String(m)}`)}}return n.length>0&&await hd(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:i,errors:o}}function Z3({currentUser:t,onComplete:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(!1),[l,d]=k.useState(null),[h,m]=k.useState(null);async function p(){if(t){r(!0);try{const _=await Y3();d(_)}catch(_){console.error("Failed to scan for adjustment pairs:",_)}finally{r(!1)}}}async function g(){if(t){o(!0),m(null);try{const _=await xm(()=>X3());m(_),e?.()}catch(_){m({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[_ instanceof Error?_.message:"Unknown error"]})}finally{o(!1)}}}const v=l!==null&&l.pairsFound>0;return{status:l,isScanning:n,scanStatus:p,hasPairsToConvert:v,isRunning:i,result:h,runMigration:g}}function J3(t){const e=[];let n="",r=!1;for(let i=0;i<t.length;i++){const o=t[i];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function eP(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function tP(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),i=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(i)||n<1||n>12||r<1||r>31?null:{year:i,month:n,day:r}}function nP(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function rP(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function sP(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const i=J3(r);if(i.length<5)continue;const[o,l,d,h,m,p,g]=i;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const v=tP(o);if(!v)continue;const _=rP(l,d),E=eP(m),x=nP(g||"");n.push({recordType:_,date:o,year:v.year,month:v.month,day:v.day,payee:l,category:d,account:h,amount:E,description:p||"",cleared:x,rawLine:r})}return n}function iP(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function aP(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function oP(t){const e=nt(t.account_id)||!t.account_id||t.account_id.trim()==="",n=lt(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function lP(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const i=nt(t.from_account_id),o=nt(t.to_account_id),l=lt(t.from_category_id),d=lt(t.to_category_id);return i&&o&&l&&d?"All from/to account and category IDs are NO_* (must involve at least one real entity)":i&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":l&&d&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function Gh(t,e,n,r,i){return t.filter(o=>{const[l,d,h]=e.split("-").map(Number);return o.year!==l||o.month!==d||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||i&&o.description&&o.description.toLowerCase().includes(i.toLowerCase()),!0)})}async function cP(t){const e=[];let n=0,r=0,i=0,o=0;const l=t?sP(t):[],{budgets:d,monthsByBudget:h}=await Na("account-category-validation");for(const m of d){const p=h.get(m.id)||[];for(const g of p){const v=g.data,_=`${v.year}-${String(v.month).padStart(2,"0")}`,E=v.income||[];n+=E.length;for(const T of E){const A=iP(T);A&&e.push({budgetId:m.id,monthKey:_,transactionType:"income",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:Gh(l,T.date,T.amount,T.payee,T.description)})}const x=v.expenses||[];r+=x.length;for(const T of x){const A=aP(T);A&&e.push({budgetId:m.id,monthKey:_,transactionType:"expense",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Gh(l,T.date,T.amount,T.payee,T.description)})}const S=v.adjustments||[];i+=S.length;for(const T of S){const A=oP(T);A&&e.push({budgetId:m.id,monthKey:_,transactionType:"adjustment",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:Gh(l,T.date,T.amount,void 0,T.description)})}const C=v.transfers||[];o+=C.length;for(const T of C){const A=lP(T);A&&e.push({budgetId:m.id,monthKey:_,transactionType:"transfer",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:Gh(l,T.date,T.amount,void 0,T.description)})}}}return e.sort((m,p)=>{const g=m.monthKey.localeCompare(p.monthKey);return g!==0?g:m.transactionType.localeCompare(p.transactionType)}),{totalBudgets:d.length,totalMonths:Array.from(h.values()).reduce((m,p)=>m+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:i,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function uP(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,i]of n){e.push("",`## ${r.toUpperCase()} (${i.length} violations)`,"");for(const o of i){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const l of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${l.rawLine}`,`        Type: ${l.recordType}, Date: ${l.date}, Payee: ${l.payee}`,`        Category: ${l.category}, Account: ${l.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function dP({currentUser:t}){const[e,n]=k.useState(!1),[r,i]=k.useState(null),[o,l]=k.useState(null);async function d(h){if(t){n(!0),i(null),l(null);try{const m=await cP(h);i(m),l(uP(m))}catch(m){console.error("Failed to scan transactions:",m),l(`Error scanning: ${m instanceof Error?m.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:d,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}function Qh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Kg={exports:{}};var V1;function hP(){return V1||(V1=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,i,o){function l(m,p){if(!i[m]){if(!r[m]){var g=typeof Qh=="function"&&Qh;if(!p&&g)return g(m,!0);if(d)return d(m,!0);var v=new Error("Cannot find module '"+m+"'");throw v.code="MODULE_NOT_FOUND",v}var _=i[m]={exports:{}};r[m][0].call(_.exports,function(E){var x=r[m][1][E];return l(x||E)},_,_.exports,n,r,i,o)}return i[m].exports}for(var d=typeof Qh=="function"&&Qh,h=0;h<o.length;h++)l(o[h]);return l})({1:[function(n,r,i){var o=n("./utils"),l=n("./support"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(h){for(var m,p,g,v,_,E,x,S=[],C=0,T=h.length,A=T,L=o.getTypeOf(h)!=="string";C<h.length;)A=T-C,g=L?(m=h[C++],p=C<T?h[C++]:0,C<T?h[C++]:0):(m=h.charCodeAt(C++),p=C<T?h.charCodeAt(C++):0,C<T?h.charCodeAt(C++):0),v=m>>2,_=(3&m)<<4|p>>4,E=1<A?(15&p)<<2|g>>6:64,x=2<A?63&g:64,S.push(d.charAt(v)+d.charAt(_)+d.charAt(E)+d.charAt(x));return S.join("")},i.decode=function(h){var m,p,g,v,_,E,x=0,S=0,C="data:";if(h.substr(0,C.length)===C)throw new Error("Invalid base64 input, it looks like a data url.");var T,A=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===d.charAt(64)&&A--,h.charAt(h.length-2)===d.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=l.uint8array?new Uint8Array(0|A):new Array(0|A);x<h.length;)m=d.indexOf(h.charAt(x++))<<2|(v=d.indexOf(h.charAt(x++)))>>4,p=(15&v)<<4|(_=d.indexOf(h.charAt(x++)))>>2,g=(3&_)<<6|(E=d.indexOf(h.charAt(x++))),T[S++]=m,_!==64&&(T[S++]=p),E!==64&&(T[S++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var o=n("./external"),l=n("./stream/DataWorker"),d=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function m(p,g,v,_,E){this.compressedSize=p,this.uncompressedSize=g,this.crc32=v,this.compression=_,this.compressedContent=E}m.prototype={getContentWorker:function(){var p=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},m.createWorkerFrom=function(p,g,v){return p.pipe(new d).pipe(new h("uncompressedSize")).pipe(g.compressWorker(v)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=m},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var o=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var o=n("./utils"),l=(function(){for(var d,h=[],m=0;m<256;m++){d=m;for(var p=0;p<8;p++)d=1&d?3988292384^d>>>1:d>>>1;h[m]=d}return h})();r.exports=function(d,h){return d!==void 0&&d.length?o.getTypeOf(d)!=="string"?(function(m,p,g,v){var _=l,E=v+g;m^=-1;for(var x=v;x<E;x++)m=m>>>8^_[255&(m^p[x])];return-1^m})(0|h,d,d.length,0):(function(m,p,g,v){var _=l,E=v+g;m^=-1;for(var x=v;x<E;x++)m=m>>>8^_[255&(m^p.charCodeAt(x))];return-1^m})(0|h,d,d.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=n("pako"),d=n("./utils"),h=n("./stream/GenericWorker"),m=o?"uint8array":"array";function p(g,v){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=v,this.meta={}}i.magic="\b\0",d.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(d.transformTo(m,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(v){g.push({data:v,meta:g.meta})}},i.compressWorker=function(g){return new p("Deflate",g)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function o(_,E){var x,S="";for(x=0;x<E;x++)S+=String.fromCharCode(255&_),_>>>=8;return S}function l(_,E,x,S,C,T){var A,L,F=_.file,H=_.compression,O=T!==m.utf8encode,I=d.transformTo("string",T(F.name)),N=d.transformTo("string",m.utf8encode(F.name)),U=F.comment,$=d.transformTo("string",T(U)),j=d.transformTo("string",m.utf8encode(U)),M=N.length!==F.name.length,R=j.length!==U.length,K="",W="",q="",Z=F.dir,X=F.date,ne={crc32:0,compressedSize:0,uncompressedSize:0};E&&!x||(ne.crc32=_.crc32,ne.compressedSize=_.compressedSize,ne.uncompressedSize=_.uncompressedSize);var B=0;E&&(B|=8),O||!M&&!R||(B|=2048);var G=0,te=0;Z&&(G|=16),C==="UNIX"?(te=798,G|=(function(ae,fe){var Ee=ae;return ae||(Ee=fe?16893:33204),(65535&Ee)<<16})(F.unixPermissions,Z)):(te=20,G|=(function(ae){return 63&(ae||0)})(F.dosPermissions)),A=X.getUTCHours(),A<<=6,A|=X.getUTCMinutes(),A<<=5,A|=X.getUTCSeconds()/2,L=X.getUTCFullYear()-1980,L<<=4,L|=X.getUTCMonth()+1,L<<=5,L|=X.getUTCDate(),M&&(W=o(1,1)+o(p(I),4)+N,K+="up"+o(W.length,2)+W),R&&(q=o(1,1)+o(p($),4)+j,K+="uc"+o(q.length,2)+q);var ie="";return ie+=`
\0`,ie+=o(B,2),ie+=H.magic,ie+=o(A,2),ie+=o(L,2),ie+=o(ne.crc32,4),ie+=o(ne.compressedSize,4),ie+=o(ne.uncompressedSize,4),ie+=o(I.length,2),ie+=o(K.length,2),{fileRecord:g.LOCAL_FILE_HEADER+ie+I+K,dirRecord:g.CENTRAL_FILE_HEADER+o(te,2)+ie+o($.length,2)+"\0\0\0\0"+o(G,4)+o(S,4)+I+K+$}}var d=n("../utils"),h=n("../stream/GenericWorker"),m=n("../utf8"),p=n("../crc32"),g=n("../signature");function v(_,E,x,S){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=E,this.zipPlatform=x,this.encodeFileName=S,this.streamFiles=_,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}d.inherits(v,h),v.prototype.push=function(_){var E=_.meta.percent||0,x=this.entriesCount,S=this._sources.length;this.accumulate?this.contentBuffer.push(_):(this.bytesWritten+=_.data.length,h.prototype.push.call(this,{data:_.data,meta:{currentFile:this.currentFile,percent:x?(E+100*(x-S-1))/x:100}}))},v.prototype.openedSource=function(_){this.currentSourceOffset=this.bytesWritten,this.currentFile=_.file.name;var E=this.streamFiles&&!_.file.dir;if(E){var x=l(_,E,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},v.prototype.closedSource=function(_){this.accumulate=!1;var E=this.streamFiles&&!_.file.dir,x=l(_,E,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),E)this.push({data:(function(S){return g.DATA_DESCRIPTOR+o(S.crc32,4)+o(S.compressedSize,4)+o(S.uncompressedSize,4)})(_),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},v.prototype.flush=function(){for(var _=this.bytesWritten,E=0;E<this.dirRecords.length;E++)this.push({data:this.dirRecords[E],meta:{percent:100}});var x=this.bytesWritten-_,S=(function(C,T,A,L,F){var H=d.transformTo("string",F(L));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(C,2)+o(C,2)+o(T,4)+o(A,4)+o(H.length,2)+H})(this.dirRecords.length,x,_,this.zipComment,this.encodeFileName);this.push({data:S,meta:{percent:100}})},v.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},v.prototype.registerPrevious=function(_){this._sources.push(_);var E=this;return _.on("data",function(x){E.processChunk(x)}),_.on("end",function(){E.closedSource(E.previous.streamInfo),E._sources.length?E.prepareNextSource():E.end()}),_.on("error",function(x){E.error(x)}),this},v.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},v.prototype.error=function(_){var E=this._sources;if(!h.prototype.error.call(this,_))return!1;for(var x=0;x<E.length;x++)try{E[x].error(_)}catch{}return!0},v.prototype.lock=function(){h.prototype.lock.call(this);for(var _=this._sources,E=0;E<_.length;E++)_[E].lock()},r.exports=v},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var o=n("../compressions"),l=n("./ZipFileWorker");i.generateWorker=function(d,h,m){var p=new l(h.streamFiles,m,h.platform,h.encodeFileName),g=0;try{d.forEach(function(v,_){g++;var E=(function(T,A){var L=T||A,F=o[L];if(!F)throw new Error(L+" is not a valid compression method !");return F})(_.options.compression,h.compression),x=_.options.compressionOptions||h.compressionOptions||{},S=_.dir,C=_.date;_._compressWorker(E,x).withStreamInfo("file",{name:v,dir:S,date:C,comment:_.comment||"",unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(v){p.error(v)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var d in this)typeof this[d]!="function"&&(l[d]=this[d]);return l}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(l,d){return new o().loadAsync(l,d)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var o=n("./utils"),l=n("./external"),d=n("./utf8"),h=n("./zipEntries"),m=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(v){return new l.Promise(function(_,E){var x=v.decompressed.getContentWorker().pipe(new m);x.on("error",function(S){E(S)}).on("end",function(){x.streamInfo.crc32!==v.decompressed.crc32?E(new Error("Corrupted zip : CRC32 mismatch")):_()}).resume()})}r.exports=function(v,_){var E=this;return _=o.extend(_||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:d.utf8decode}),p.isNode&&p.isStream(v)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",v,!0,_.optimizedBinaryString,_.base64).then(function(x){var S=new h(_);return S.load(x),S}).then(function(x){var S=[l.Promise.resolve(x)],C=x.files;if(_.checkCRC32)for(var T=0;T<C.length;T++)S.push(g(C[T]));return l.Promise.all(S)}).then(function(x){for(var S=x.shift(),C=S.files,T=0;T<C.length;T++){var A=C[T],L=A.fileNameStr,F=o.resolve(A.fileNameStr);E.file(F,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:_.createFolders}),A.dir||(E.file(F).unsafeOriginalName=L)}return S.zipComment.length&&(E.comment=S.zipComment),E})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var o=n("../utils"),l=n("../stream/GenericWorker");function d(h,m){l.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(m)}o.inherits(d,l),d.prototype._bindStream=function(h){var m=this;(this._stream=h).pause(),h.on("data",function(p){m.push({data:p,meta:{percent:0}})}).on("error",function(p){m.isPaused?this.generatedError=p:m.error(p)}).on("end",function(){m.isPaused?m._upstreamEnded=!0:m.end()})},d.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var o=n("readable-stream").Readable;function l(d,h,m){o.call(this,h),this._helper=d;var p=this;d.on("data",function(g,v){p.push(g)||p._helper.pause(),m&&m(v)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},r.exports=l},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,i){function o(F,H,O){var I,N=d.getTypeOf(H),U=d.extend(O||{},p);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(F=C(F)),U.createFolders&&(I=S(F))&&T.call(this,I,!0);var $=N==="string"&&U.binary===!1&&U.base64===!1;O&&O.binary!==void 0||(U.binary=!$),(H instanceof g&&H.uncompressedSize===0||U.dir||!H||H.length===0)&&(U.base64=!1,U.binary=!0,H="",U.compression="STORE",N="string");var j=null;j=H instanceof g||H instanceof h?H:E.isNode&&E.isStream(H)?new x(F,H):d.prepareContent(F,H,U.binary,U.optimizedBinaryString,U.base64);var M=new v(F,j,U);this.files[F]=M}var l=n("./utf8"),d=n("./utils"),h=n("./stream/GenericWorker"),m=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),v=n("./zipObject"),_=n("./generate"),E=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),S=function(F){F.slice(-1)==="/"&&(F=F.substring(0,F.length-1));var H=F.lastIndexOf("/");return 0<H?F.substring(0,H):""},C=function(F){return F.slice(-1)!=="/"&&(F+="/"),F},T=function(F,H){return H=H!==void 0?H:p.createFolders,F=C(F),this.files[F]||o.call(this,F,null,{dir:!0,createFolders:H}),this.files[F]};function A(F){return Object.prototype.toString.call(F)==="[object RegExp]"}var L={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(F){var H,O,I;for(H in this.files)I=this.files[H],(O=H.slice(this.root.length,H.length))&&H.slice(0,this.root.length)===this.root&&F(O,I)},filter:function(F){var H=[];return this.forEach(function(O,I){F(O,I)&&H.push(I)}),H},file:function(F,H,O){if(arguments.length!==1)return F=this.root+F,o.call(this,F,H,O),this;if(A(F)){var I=F;return this.filter(function(U,$){return!$.dir&&I.test(U)})}var N=this.files[this.root+F];return N&&!N.dir?N:null},folder:function(F){if(!F)return this;if(A(F))return this.filter(function(N,U){return U.dir&&F.test(N)});var H=this.root+F,O=T.call(this,H),I=this.clone();return I.root=O.name,I},remove:function(F){F=this.root+F;var H=this.files[F];if(H||(F.slice(-1)!=="/"&&(F+="/"),H=this.files[F]),H&&!H.dir)delete this.files[F];else for(var O=this.filter(function(N,U){return U.name.slice(0,F.length)===F}),I=0;I<O.length;I++)delete this.files[O[I].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(F){var H,O={};try{if((O=d.extend(F||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");d.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var I=O.comment||this.comment||"";H=_.generateWorker(this,O,I)}catch(N){(H=new h("error")).error(N)}return new m(H,O.type||"string",O.mimeType)},generateAsync:function(F,H){return this.generateInternalStream(F).accumulate(H)},generateNodeStream:function(F,H){return(F=F||{}).type||(F.type="nodebuffer"),this.generateInternalStream(F).toNodejsStream(H)}};r.exports=L},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d);for(var h=0;h<this.data.length;h++)d[h]=255&d[h]}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data[this.zero+d]},l.prototype.lastIndexOfSignature=function(d){for(var h=d.charCodeAt(0),m=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.length-4;0<=v;--v)if(this.data[v]===h&&this.data[v+1]===m&&this.data[v+2]===p&&this.data[v+3]===g)return v-this.zero;return-1},l.prototype.readAndCheckSignature=function(d){var h=d.charCodeAt(0),m=d.charCodeAt(1),p=d.charCodeAt(2),g=d.charCodeAt(3),v=this.readData(4);return h===v[0]&&m===v[1]&&p===v[2]&&g===v[3]},l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var o=n("../utils");function l(d){this.data=d,this.length=d.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(d){this.checkIndex(this.index+d)},checkIndex:function(d){if(this.length<this.zero+d||d<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+d+"). Corrupted zip ?")},setIndex:function(d){this.checkIndex(d),this.index=d},skip:function(d){this.setIndex(this.index+d)},byteAt:function(){},readInt:function(d){var h,m=0;for(this.checkOffset(d),h=this.index+d-1;h>=this.index;h--)m=(m<<8)+this.byteAt(h);return this.index+=d,m},readString:function(d){return o.transformTo("string",this.readData(d))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var d=this.readInt(4);return new Date(Date.UTC(1980+(d>>25&127),(d>>21&15)-1,d>>16&31,d>>11&31,d>>5&63,(31&d)<<1))}},r.exports=l},{"../utils":32}],19:[function(n,r,i){var o=n("./Uint8ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var o=n("./DataReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.byteAt=function(d){return this.data.charCodeAt(this.zero+d)},l.prototype.lastIndexOfSignature=function(d){return this.data.lastIndexOf(d)-this.zero},l.prototype.readAndCheckSignature=function(d){return d===this.readData(4)},l.prototype.readData=function(d){this.checkOffset(d);var h=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var o=n("./ArrayReader");function l(d){o.call(this,d)}n("../utils").inherits(l,o),l.prototype.readData=function(d){if(this.checkOffset(d),d===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+d);return this.index+=d,h},r.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var o=n("../utils"),l=n("../support"),d=n("./ArrayReader"),h=n("./StringReader"),m=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var v=o.getTypeOf(g);return o.checkSupport(v),v!=="string"||l.uint8array?v==="nodebuffer"?new m(g):l.uint8array?new p(o.transformTo("uint8array",g)):new d(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var o=n("./GenericWorker"),l=n("../utils");function d(h){o.call(this,"ConvertWorker to "+h),this.destType=h}l.inherits(d,o),d.prototype.processChunk=function(h){this.push({data:l.transformTo(this.destType,h.data),meta:h.meta})},r.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var o=n("./GenericWorker"),l=n("../crc32");function d(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(d,o),d.prototype.processChunk=function(h){this.streamInfo.crc32=l(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(d,l),d.prototype.processChunk=function(h){if(h){var m=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=m+h.data.length}l.prototype.processChunk.call(this,h)},r.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var o=n("../utils"),l=n("./GenericWorker");function d(h){l.call(this,"DataWorker");var m=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){m.dataIsReady=!0,m.data=p,m.max=p&&p.length||0,m.type=o.getTypeOf(p),m.isPaused||m._tickAndRepeat()},function(p){m.error(p)})}o.inherits(d,l),d.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,m=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,m);break;case"uint8array":h=this.data.subarray(this.index,m);break;case"array":case"nodebuffer":h=this.data.slice(this.index,m)}return this.index=m,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,d){return this._listeners[l].push(d),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,d){if(this._listeners[l])for(var h=0;h<this._listeners[l].length;h++)this._listeners[l][h].call(this,d)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var d=this;return l.on("data",function(h){d.processChunk(h)}),l.on("end",function(){d.end()}),l.on("error",function(h){d.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,d){return this.extraStreamInfo[l]=d,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},r.exports=o},{}],29:[function(n,r,i){var o=n("../utils"),l=n("./ConvertWorker"),d=n("./GenericWorker"),h=n("../base64"),m=n("../support"),p=n("../external"),g=null;if(m.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function v(E,x){return new p.Promise(function(S,C){var T=[],A=E._internalType,L=E._outputType,F=E._mimeType;E.on("data",function(H,O){T.push(H),x&&x(O)}).on("error",function(H){T=[],C(H)}).on("end",function(){try{var H=(function(O,I,N){switch(O){case"blob":return o.newBlob(o.transformTo("arraybuffer",I),N);case"base64":return h.encode(I);default:return o.transformTo(O,I)}})(L,(function(O,I){var N,U=0,$=null,j=0;for(N=0;N<I.length;N++)j+=I[N].length;switch(O){case"string":return I.join("");case"array":return Array.prototype.concat.apply([],I);case"uint8array":for($=new Uint8Array(j),N=0;N<I.length;N++)$.set(I[N],U),U+=I[N].length;return $;case"nodebuffer":return Buffer.concat(I);default:throw new Error("concat : unsupported type '"+O+"'")}})(A,T),F);S(H)}catch(O){C(O)}T=[]}).resume()})}function _(E,x,S){var C=x;switch(x){case"blob":case"arraybuffer":C="uint8array";break;case"base64":C="string"}try{this._internalType=C,this._outputType=x,this._mimeType=S,o.checkSupport(C),this._worker=E.pipe(new l(C)),E.lock()}catch(T){this._worker=new d("error"),this._worker.error(T)}}_.prototype={accumulate:function(E){return v(this,E)},on:function(E,x){var S=this;return E==="data"?this._worker.on(E,function(C){x.call(S,C.data,C.meta)}):this._worker.on(E,function(){o.delay(x,arguments,S)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(E){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},E)}},r.exports=_},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),i.blob=l.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var o=n("./utils"),l=n("./support"),d=n("./nodejsUtils"),h=n("./stream/GenericWorker"),m=new Array(256),p=0;p<256;p++)m[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;m[254]=m[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function v(){h.call(this,"utf-8 encode")}i.utf8encode=function(_){return l.nodebuffer?d.newBufferFrom(_,"utf-8"):(function(E){var x,S,C,T,A,L=E.length,F=0;for(T=0;T<L;T++)(64512&(S=E.charCodeAt(T)))==55296&&T+1<L&&(64512&(C=E.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(C-56320),T++),F+=S<128?1:S<2048?2:S<65536?3:4;for(x=l.uint8array?new Uint8Array(F):new Array(F),T=A=0;A<F;T++)(64512&(S=E.charCodeAt(T)))==55296&&T+1<L&&(64512&(C=E.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(C-56320),T++),S<128?x[A++]=S:(S<2048?x[A++]=192|S>>>6:(S<65536?x[A++]=224|S>>>12:(x[A++]=240|S>>>18,x[A++]=128|S>>>12&63),x[A++]=128|S>>>6&63),x[A++]=128|63&S);return x})(_)},i.utf8decode=function(_){return l.nodebuffer?o.transformTo("nodebuffer",_).toString("utf-8"):(function(E){var x,S,C,T,A=E.length,L=new Array(2*A);for(x=S=0;x<A;)if((C=E[x++])<128)L[S++]=C;else if(4<(T=m[C]))L[S++]=65533,x+=T-1;else{for(C&=T===2?31:T===3?15:7;1<T&&x<A;)C=C<<6|63&E[x++],T--;1<T?L[S++]=65533:C<65536?L[S++]=C:(C-=65536,L[S++]=55296|C>>10&1023,L[S++]=56320|1023&C)}return L.length!==S&&(L.subarray?L=L.subarray(0,S):L.length=S),o.applyFromCharCode(L)})(_=o.transformTo(l.uint8array?"uint8array":"array",_))},o.inherits(g,h),g.prototype.processChunk=function(_){var E=o.transformTo(l.uint8array?"uint8array":"array",_.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var x=E;(E=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),E.set(x,this.leftOver.length)}else E=this.leftOver.concat(E);this.leftOver=null}var S=(function(T,A){var L;for((A=A||T.length)>T.length&&(A=T.length),L=A-1;0<=L&&(192&T[L])==128;)L--;return L<0||L===0?A:L+m[T[L]]>A?L:A})(E),C=E;S!==E.length&&(l.uint8array?(C=E.subarray(0,S),this.leftOver=E.subarray(S,E.length)):(C=E.slice(0,S),this.leftOver=E.slice(S,E.length))),this.push({data:i.utf8decode(C),meta:_.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=g,o.inherits(v,h),v.prototype.processChunk=function(_){this.push({data:i.utf8encode(_.data),meta:_.meta})},i.Utf8EncodeWorker=v},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var o=n("./support"),l=n("./base64"),d=n("./nodejsUtils"),h=n("./external");function m(x){return x}function p(x,S){for(var C=0;C<x.length;++C)S[C]=255&x.charCodeAt(C);return S}n("setimmediate"),i.newBlob=function(x,S){i.checkSupport("blob");try{return new Blob([x],{type:S})}catch{try{var C=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return C.append(x),C.getBlob(S)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(x,S,C){var T=[],A=0,L=x.length;if(L<=C)return String.fromCharCode.apply(null,x);for(;A<L;)S==="array"||S==="nodebuffer"?T.push(String.fromCharCode.apply(null,x.slice(A,Math.min(A+C,L)))):T.push(String.fromCharCode.apply(null,x.subarray(A,Math.min(A+C,L)))),A+=C;return T.join("")},stringifyByChar:function(x){for(var S="",C=0;C<x.length;C++)S+=String.fromCharCode(x[C]);return S},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,d.allocBuffer(1)).length===1}catch{return!1}})()}};function v(x){var S=65536,C=i.getTypeOf(x),T=!0;if(C==="uint8array"?T=g.applyCanBeUsed.uint8array:C==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<S;)try{return g.stringifyByChunk(x,C,S)}catch{S=Math.floor(S/2)}return g.stringifyByChar(x)}function _(x,S){for(var C=0;C<x.length;C++)S[C]=x[C];return S}i.applyFromCharCode=v;var E={};E.string={string:m,array:function(x){return p(x,new Array(x.length))},arraybuffer:function(x){return E.string.uint8array(x).buffer},uint8array:function(x){return p(x,new Uint8Array(x.length))},nodebuffer:function(x){return p(x,d.allocBuffer(x.length))}},E.array={string:v,array:m,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(x)}},E.arraybuffer={string:function(x){return v(new Uint8Array(x))},array:function(x){return _(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:m,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return d.newBufferFrom(new Uint8Array(x))}},E.uint8array={string:v,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:m,nodebuffer:function(x){return d.newBufferFrom(x)}},E.nodebuffer={string:v,array:function(x){return _(x,new Array(x.length))},arraybuffer:function(x){return E.nodebuffer.uint8array(x).buffer},uint8array:function(x){return _(x,new Uint8Array(x.length))},nodebuffer:m},i.transformTo=function(x,S){if(S=S||"",!x)return S;i.checkSupport(x);var C=i.getTypeOf(S);return E[C][x](S)},i.resolve=function(x){for(var S=x.split("/"),C=[],T=0;T<S.length;T++){var A=S[T];A==="."||A===""&&T!==0&&T!==S.length-1||(A===".."?C.pop():C.push(A))}return C.join("/")},i.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":o.nodebuffer&&d.isBuffer(x)?"nodebuffer":o.uint8array&&x instanceof Uint8Array?"uint8array":o.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(x){if(!o[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(x){var S,C,T="";for(C=0;C<(x||"").length;C++)T+="\\x"+((S=x.charCodeAt(C))<16?"0":"")+S.toString(16).toUpperCase();return T},i.delay=function(x,S,C){setImmediate(function(){x.apply(C||null,S||[])})},i.inherits=function(x,S){function C(){}C.prototype=S.prototype,x.prototype=new C},i.extend=function(){var x,S,C={};for(x=0;x<arguments.length;x++)for(S in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],S)&&C[S]===void 0&&(C[S]=arguments[x][S]);return C},i.prepareContent=function(x,S,C,T,A){return h.Promise.resolve(S).then(function(L){return o.blob&&(L instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(L))!==-1)&&typeof FileReader<"u"?new h.Promise(function(F,H){var O=new FileReader;O.onload=function(I){F(I.target.result)},O.onerror=function(I){H(I.target.error)},O.readAsArrayBuffer(L)}):L}).then(function(L){var F=i.getTypeOf(L);return F?(F==="arraybuffer"?L=i.transformTo("uint8array",L):F==="string"&&(A?L=l.decode(L):C&&T!==!0&&(L=(function(H){return p(H,o.uint8array?new Uint8Array(H.length):new Array(H.length))})(L))),L):h.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./signature"),h=n("./zipEntry"),m=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var v=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(v)+", expected "+l.pretty(g)+")")}},isSignature:function(g,v){var _=this.reader.index;this.reader.setIndex(g);var E=this.reader.readString(4)===v;return this.reader.setIndex(_),E},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),v=m.uint8array?"uint8array":"array",_=l.transformTo(v,g);this.zipComment=this.loadOptions.decodeFileName(_)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,v,_,E=this.zip64EndOfCentralSize-44;0<E;)g=this.reader.readInt(2),v=this.reader.readInt(4),_=this.reader.readData(v),this.zip64ExtensibleData[g]={id:g,length:v,value:_}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,v;for(g=0;g<this.files.length;g++)v=this.files[g],this.reader.setIndex(v.localHeaderOffset),this.checkSignature(d.LOCAL_FILE_HEADER),v.readLocalPart(this.reader),v.handleUTF8(),v.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(d.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(d.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,d.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var v=g;if(this.checkSignature(d.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,d.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var _=this.centralDirOffset+this.centralDirSize;this.zip64&&(_+=20,_+=12+this.zip64EndOfCentralSize);var E=v-_;if(0<E)this.isSignature(v,d.CENTRAL_FILE_HEADER)||(this.reader.zero=E);else if(E<0)throw new Error("Corrupted zip: missing "+Math.abs(E)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var o=n("./reader/readerFor"),l=n("./utils"),d=n("./compressedObject"),h=n("./crc32"),m=n("./utf8"),p=n("./compressions"),g=n("./support");function v(_,E){this.options=_,this.loadOptions=E}v.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(_){var E,x;if(_.skip(22),this.fileNameLength=_.readInt(2),x=_.readInt(2),this.fileName=_.readData(this.fileNameLength),_.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((E=(function(S){for(var C in p)if(Object.prototype.hasOwnProperty.call(p,C)&&p[C].magic===S)return p[C];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new d(this.compressedSize,this.uncompressedSize,this.crc32,E,_.readData(this.compressedSize))},readCentralPart:function(_){this.versionMadeBy=_.readInt(2),_.skip(2),this.bitFlag=_.readInt(2),this.compressionMethod=_.readString(2),this.date=_.readDate(),this.crc32=_.readInt(4),this.compressedSize=_.readInt(4),this.uncompressedSize=_.readInt(4);var E=_.readInt(2);if(this.extraFieldsLength=_.readInt(2),this.fileCommentLength=_.readInt(2),this.diskNumberStart=_.readInt(2),this.internalFileAttributes=_.readInt(2),this.externalFileAttributes=_.readInt(4),this.localHeaderOffset=_.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");_.skip(E),this.readExtraFields(_),this.parseZIP64ExtraField(_),this.fileComment=_.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var _=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),_==0&&(this.dosPermissions=63&this.externalFileAttributes),_==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var _=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=_.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=_.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=_.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=_.readInt(4))}},readExtraFields:function(_){var E,x,S,C=_.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});_.index+4<C;)E=_.readInt(2),x=_.readInt(2),S=_.readData(x),this.extraFields[E]={id:E,length:x,value:S};_.setIndex(C)},handleUTF8:function(){var _=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=m.utf8decode(this.fileName),this.fileCommentStr=m.utf8decode(this.fileComment);else{var E=this.findExtraFieldUnicodePath();if(E!==null)this.fileNameStr=E;else{var x=l.transformTo(_,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var C=l.transformTo(_,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(C)}}},findExtraFieldUnicodePath:function(){var _=this.extraFields[28789];if(_){var E=o(_.value);return E.readInt(1)!==1||h(this.fileName)!==E.readInt(4)?null:m.utf8decode(E.readData(_.length-5))}return null},findExtraFieldUnicodeComment:function(){var _=this.extraFields[25461];if(_){var E=o(_.value);return E.readInt(1)!==1||h(this.fileComment)!==E.readInt(4)?null:m.utf8decode(E.readData(_.length-5))}return null}},r.exports=v},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function o(E,x,S){this.name=E,this.dir=S.dir,this.date=S.date,this.comment=S.comment,this.unixPermissions=S.unixPermissions,this.dosPermissions=S.dosPermissions,this._data=x,this._dataBinary=S.binary,this.options={compression:S.compression,compressionOptions:S.compressionOptions}}var l=n("./stream/StreamHelper"),d=n("./stream/DataWorker"),h=n("./utf8"),m=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(E){var x=null,S="string";try{if(!E)throw new Error("No output type specified.");var C=(S=E.toLowerCase())==="string"||S==="text";S!=="binarystring"&&S!=="text"||(S="string"),x=this._decompressWorker();var T=!this._dataBinary;T&&!C&&(x=x.pipe(new h.Utf8EncodeWorker)),!T&&C&&(x=x.pipe(new h.Utf8DecodeWorker))}catch(A){(x=new p("error")).error(A)}return new l(x,S,"")},async:function(E,x){return this.internalStream(E).accumulate(x)},nodeStream:function(E,x){return this.internalStream(E||"nodebuffer").toNodejsStream(x)},_compressWorker:function(E,x){if(this._data instanceof m&&this._data.compression.magic===E.magic)return this._data.getCompressedWorker();var S=this._decompressWorker();return this._dataBinary||(S=S.pipe(new h.Utf8EncodeWorker)),m.createWorkerFrom(S,E,x)},_decompressWorker:function(){return this._data instanceof m?this._data.getContentWorker():this._data instanceof p?this._data:new d(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],v=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},_=0;_<g.length;_++)o.prototype[g[_]]=v;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(o){var l,d,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var m=0,p=new h(E),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=m=++m%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){E(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(E,0)};else{var v=new o.MessageChannel;v.port1.onmessage=E,l=function(){v.port2.postMessage(0)}}var _=[];function E(){var x,S;d=!0;for(var C=_.length;C;){for(S=_,_=[],x=-1;++x<C;)S[x]();C=_.length}d=!1}r.exports=function(x){_.push(x)!==1||d||l()}}).call(this,typeof zh<"u"?zh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var o=n("immediate");function l(){}var d={},h=["REJECTED"],m=["FULFILLED"],p=["PENDING"];function g(C){if(typeof C!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,C!==l&&x(this,C)}function v(C,T,A){this.promise=C,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function _(C,T,A){o(function(){var L;try{L=T(A)}catch(F){return d.reject(C,F)}L===C?d.reject(C,new TypeError("Cannot resolve promise with itself")):d.resolve(C,L)})}function E(C){var T=C&&C.then;if(C&&(typeof C=="object"||typeof C=="function")&&typeof T=="function")return function(){T.apply(C,arguments)}}function x(C,T){var A=!1;function L(O){A||(A=!0,d.reject(C,O))}function F(O){A||(A=!0,d.resolve(C,O))}var H=S(function(){T(F,L)});H.status==="error"&&L(H.value)}function S(C,T){var A={};try{A.value=C(T),A.status="success"}catch(L){A.status="error",A.value=L}return A}(r.exports=g).prototype.finally=function(C){if(typeof C!="function")return this;var T=this.constructor;return this.then(function(A){return T.resolve(C()).then(function(){return A})},function(A){return T.resolve(C()).then(function(){throw A})})},g.prototype.catch=function(C){return this.then(null,C)},g.prototype.then=function(C,T){if(typeof C!="function"&&this.state===m||typeof T!="function"&&this.state===h)return this;var A=new this.constructor(l);return this.state!==p?_(A,this.state===m?C:T,this.outcome):this.queue.push(new v(A,C,T)),A},v.prototype.callFulfilled=function(C){d.resolve(this.promise,C)},v.prototype.otherCallFulfilled=function(C){_(this.promise,this.onFulfilled,C)},v.prototype.callRejected=function(C){d.reject(this.promise,C)},v.prototype.otherCallRejected=function(C){_(this.promise,this.onRejected,C)},d.resolve=function(C,T){var A=S(E,T);if(A.status==="error")return d.reject(C,A.value);var L=A.value;if(L)x(C,L);else{C.state=m,C.outcome=T;for(var F=-1,H=C.queue.length;++F<H;)C.queue[F].callFulfilled(T)}return C},d.reject=function(C,T){C.state=h,C.outcome=T;for(var A=-1,L=C.queue.length;++A<L;)C.queue[A].callRejected(T);return C},g.resolve=function(C){return C instanceof this?C:d.resolve(new this(l),C)},g.reject=function(C){var T=new this(l);return d.reject(T,C)},g.all=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=C.length,L=!1;if(!A)return this.resolve([]);for(var F=new Array(A),H=0,O=-1,I=new this(l);++O<A;)N(C[O],O);return I;function N(U,$){T.resolve(U).then(function(j){F[$]=j,++H!==A||L||(L=!0,d.resolve(I,F))},function(j){L||(L=!0,d.reject(I,j))})}},g.race=function(C){var T=this;if(Object.prototype.toString.call(C)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=C.length,L=!1;if(!A)return this.resolve([]);for(var F=-1,H=new this(l);++F<A;)O=C[F],T.resolve(O).then(function(I){L||(L=!0,d.resolve(H,I))},function(I){L||(L=!0,d.reject(H,I))});var O;return H}},{immediate:36}],38:[function(n,r,i){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var o=n("./zlib/deflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/messages"),m=n("./zlib/zstream"),p=Object.prototype.toString,g=0,v=-1,_=0,E=8;function x(C){if(!(this instanceof x))return new x(C);this.options=l.assign({level:v,method:E,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},C||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var A=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(A!==g)throw new Error(h[A]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var L;if(L=typeof T.dictionary=="string"?d.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(A=o.deflateSetDictionary(this.strm,L))!==g)throw new Error(h[A]);this._dict_set=!0}}function S(C,T){var A=new x(T);if(A.push(C,!0),A.err)throw A.msg||h[A.err];return A.result}x.prototype.push=function(C,T){var A,L,F=this.strm,H=this.options.chunkSize;if(this.ended)return!1;L=T===~~T?T:T===!0?4:0,typeof C=="string"?F.input=d.string2buf(C):p.call(C)==="[object ArrayBuffer]"?F.input=new Uint8Array(C):F.input=C,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new l.Buf8(H),F.next_out=0,F.avail_out=H),(A=o.deflate(F,L))!==1&&A!==g)return this.onEnd(A),!(this.ended=!0);F.avail_out!==0&&(F.avail_in!==0||L!==4&&L!==2)||(this.options.to==="string"?this.onData(d.buf2binstring(l.shrinkBuf(F.output,F.next_out))):this.onData(l.shrinkBuf(F.output,F.next_out)))}while((0<F.avail_in||F.avail_out===0)&&A!==1);return L===4?(A=o.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===g):L!==2||(this.onEnd(g),!(F.avail_out=0))},x.prototype.onData=function(C){this.chunks.push(C)},x.prototype.onEnd=function(C){C===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},i.Deflate=x,i.deflate=S,i.deflateRaw=function(C,T){return(T=T||{}).raw=!0,S(C,T)},i.gzip=function(C,T){return(T=T||{}).gzip=!0,S(C,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var o=n("./zlib/inflate"),l=n("./utils/common"),d=n("./utils/strings"),h=n("./zlib/constants"),m=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),v=Object.prototype.toString;function _(x){if(!(this instanceof _))return new _(x);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},x||{});var S=this.options;S.raw&&0<=S.windowBits&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),!(0<=S.windowBits&&S.windowBits<16)||x&&x.windowBits||(S.windowBits+=32),15<S.windowBits&&S.windowBits<48&&(15&S.windowBits)==0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var C=o.inflateInit2(this.strm,S.windowBits);if(C!==h.Z_OK)throw new Error(m[C]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function E(x,S){var C=new _(S);if(C.push(x,!0),C.err)throw C.msg||m[C.err];return C.result}_.prototype.push=function(x,S){var C,T,A,L,F,H,O=this.strm,I=this.options.chunkSize,N=this.options.dictionary,U=!1;if(this.ended)return!1;T=S===~~S?S:S===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof x=="string"?O.input=d.binstring2buf(x):v.call(x)==="[object ArrayBuffer]"?O.input=new Uint8Array(x):O.input=x,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new l.Buf8(I),O.next_out=0,O.avail_out=I),(C=o.inflate(O,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&N&&(H=typeof N=="string"?d.string2buf(N):v.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,C=o.inflateSetDictionary(this.strm,H)),C===h.Z_BUF_ERROR&&U===!0&&(C=h.Z_OK,U=!1),C!==h.Z_STREAM_END&&C!==h.Z_OK)return this.onEnd(C),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&C!==h.Z_STREAM_END&&(O.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=d.utf8border(O.output,O.next_out),L=O.next_out-A,F=d.buf2string(O.output,A),O.next_out=L,O.avail_out=I-L,L&&l.arraySet(O.output,O.output,A,L,0),this.onData(F)):this.onData(l.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(U=!0)}while((0<O.avail_in||O.avail_out===0)&&C!==h.Z_STREAM_END);return C===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(C=o.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(O.avail_out=0))},_.prototype.onData=function(x){this.chunks.push(x)},_.prototype.onEnd=function(x){x===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},i.Inflate=_,i.inflate=E,i.inflateRaw=function(x,S){return(S=S||{}).raw=!0,E(x,S)},i.ungzip=E},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(h){for(var m=Array.prototype.slice.call(arguments,1);m.length;){var p=m.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},i.shrinkBuf=function(h,m){return h.length===m?h:h.subarray?h.subarray(0,m):(h.length=m,h)};var l={arraySet:function(h,m,p,g,v){if(m.subarray&&h.subarray)h.set(m.subarray(p,p+g),v);else for(var _=0;_<g;_++)h[v+_]=m[p+_]},flattenChunks:function(h){var m,p,g,v,_,E;for(m=g=0,p=h.length;m<p;m++)g+=h[m].length;for(E=new Uint8Array(g),m=v=0,p=h.length;m<p;m++)_=h[m],E.set(_,v),v+=_.length;return E}},d={arraySet:function(h,m,p,g,v){for(var _=0;_<g;_++)h[v+_]=m[p+_]},flattenChunks:function(h){return[].concat.apply([],h)}};i.setTyped=function(h){h?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,l)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,d))},i.setTyped(o)},{}],42:[function(n,r,i){var o=n("./common"),l=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var h=new o.Buf8(256),m=0;m<256;m++)h[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;function p(g,v){if(v<65537&&(g.subarray&&d||!g.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(g,v));for(var _="",E=0;E<v;E++)_+=String.fromCharCode(g[E]);return _}h[254]=h[254]=1,i.string2buf=function(g){var v,_,E,x,S,C=g.length,T=0;for(x=0;x<C;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(E=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(E-56320),x++),T+=_<128?1:_<2048?2:_<65536?3:4;for(v=new o.Buf8(T),x=S=0;S<T;x++)(64512&(_=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(E=g.charCodeAt(x+1)))==56320&&(_=65536+(_-55296<<10)+(E-56320),x++),_<128?v[S++]=_:(_<2048?v[S++]=192|_>>>6:(_<65536?v[S++]=224|_>>>12:(v[S++]=240|_>>>18,v[S++]=128|_>>>12&63),v[S++]=128|_>>>6&63),v[S++]=128|63&_);return v},i.buf2binstring=function(g){return p(g,g.length)},i.binstring2buf=function(g){for(var v=new o.Buf8(g.length),_=0,E=v.length;_<E;_++)v[_]=g.charCodeAt(_);return v},i.buf2string=function(g,v){var _,E,x,S,C=v||g.length,T=new Array(2*C);for(_=E=0;_<C;)if((x=g[_++])<128)T[E++]=x;else if(4<(S=h[x]))T[E++]=65533,_+=S-1;else{for(x&=S===2?31:S===3?15:7;1<S&&_<C;)x=x<<6|63&g[_++],S--;1<S?T[E++]=65533:x<65536?T[E++]=x:(x-=65536,T[E++]=55296|x>>10&1023,T[E++]=56320|1023&x)}return p(T,E)},i.utf8border=function(g,v){var _;for((v=v||g.length)>g.length&&(v=g.length),_=v-1;0<=_&&(192&g[_])==128;)_--;return _<0||_===0?v:_+h[g[_]]>v?_:v}},{"./common":41}],43:[function(n,r,i){r.exports=function(o,l,d,h){for(var m=65535&o|0,p=o>>>16&65535|0,g=0;d!==0;){for(d-=g=2e3<d?2e3:d;p=p+(m=m+l[h++]|0)|0,--g;);m%=65521,p%=65521}return m|p<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var o=(function(){for(var l,d=[],h=0;h<256;h++){l=h;for(var m=0;m<8;m++)l=1&l?3988292384^l>>>1:l>>>1;d[h]=l}return d})();r.exports=function(l,d,h,m){var p=o,g=m+h;l^=-1;for(var v=m;v<g;v++)l=l>>>8^p[255&(l^d[v])];return-1^l}},{}],46:[function(n,r,i){var o,l=n("../utils/common"),d=n("./trees"),h=n("./adler32"),m=n("./crc32"),p=n("./messages"),g=0,v=4,_=0,E=-2,x=-1,S=4,C=2,T=8,A=9,L=286,F=30,H=19,O=2*L+1,I=15,N=3,U=258,$=U+N+1,j=42,M=113,R=1,K=2,W=3,q=4;function Z(z,ce){return z.msg=p[ce],ce}function X(z){return(z<<1)-(4<z?9:0)}function ne(z){for(var ce=z.length;0<=--ce;)z[ce]=0}function B(z){var ce=z.state,pe=ce.pending;pe>z.avail_out&&(pe=z.avail_out),pe!==0&&(l.arraySet(z.output,ce.pending_buf,ce.pending_out,pe,z.next_out),z.next_out+=pe,ce.pending_out+=pe,z.total_out+=pe,z.avail_out-=pe,ce.pending-=pe,ce.pending===0&&(ce.pending_out=0))}function G(z,ce){d._tr_flush_block(z,0<=z.block_start?z.block_start:-1,z.strstart-z.block_start,ce),z.block_start=z.strstart,B(z.strm)}function te(z,ce){z.pending_buf[z.pending++]=ce}function ie(z,ce){z.pending_buf[z.pending++]=ce>>>8&255,z.pending_buf[z.pending++]=255&ce}function ae(z,ce){var pe,ee,J=z.max_chain_length,se=z.strstart,xe=z.prev_length,Se=z.nice_match,oe=z.strstart>z.w_size-$?z.strstart-(z.w_size-$):0,je=z.window,ze=z.w_mask,Ne=z.prev,Ge=z.strstart+U,xt=je[se+xe-1],st=je[se+xe];z.prev_length>=z.good_match&&(J>>=2),Se>z.lookahead&&(Se=z.lookahead);do if(je[(pe=ce)+xe]===st&&je[pe+xe-1]===xt&&je[pe]===je[se]&&je[++pe]===je[se+1]){se+=2,pe++;do;while(je[++se]===je[++pe]&&je[++se]===je[++pe]&&je[++se]===je[++pe]&&je[++se]===je[++pe]&&je[++se]===je[++pe]&&je[++se]===je[++pe]&&je[++se]===je[++pe]&&je[++se]===je[++pe]&&se<Ge);if(ee=U-(Ge-se),se=Ge-U,xe<ee){if(z.match_start=ce,Se<=(xe=ee))break;xt=je[se+xe-1],st=je[se+xe]}}while((ce=Ne[ce&ze])>oe&&--J!=0);return xe<=z.lookahead?xe:z.lookahead}function fe(z){var ce,pe,ee,J,se,xe,Se,oe,je,ze,Ne=z.w_size;do{if(J=z.window_size-z.lookahead-z.strstart,z.strstart>=Ne+(Ne-$)){for(l.arraySet(z.window,z.window,Ne,Ne,0),z.match_start-=Ne,z.strstart-=Ne,z.block_start-=Ne,ce=pe=z.hash_size;ee=z.head[--ce],z.head[ce]=Ne<=ee?ee-Ne:0,--pe;);for(ce=pe=Ne;ee=z.prev[--ce],z.prev[ce]=Ne<=ee?ee-Ne:0,--pe;);J+=Ne}if(z.strm.avail_in===0)break;if(xe=z.strm,Se=z.window,oe=z.strstart+z.lookahead,je=J,ze=void 0,ze=xe.avail_in,je<ze&&(ze=je),pe=ze===0?0:(xe.avail_in-=ze,l.arraySet(Se,xe.input,xe.next_in,ze,oe),xe.state.wrap===1?xe.adler=h(xe.adler,Se,ze,oe):xe.state.wrap===2&&(xe.adler=m(xe.adler,Se,ze,oe)),xe.next_in+=ze,xe.total_in+=ze,ze),z.lookahead+=pe,z.lookahead+z.insert>=N)for(se=z.strstart-z.insert,z.ins_h=z.window[se],z.ins_h=(z.ins_h<<z.hash_shift^z.window[se+1])&z.hash_mask;z.insert&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[se+N-1])&z.hash_mask,z.prev[se&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=se,se++,z.insert--,!(z.lookahead+z.insert<N)););}while(z.lookahead<$&&z.strm.avail_in!==0)}function Ee(z,ce){for(var pe,ee;;){if(z.lookahead<$){if(fe(z),z.lookahead<$&&ce===g)return R;if(z.lookahead===0)break}if(pe=0,z.lookahead>=N&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+N-1])&z.hash_mask,pe=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),pe!==0&&z.strstart-pe<=z.w_size-$&&(z.match_length=ae(z,pe)),z.match_length>=N)if(ee=d._tr_tally(z,z.strstart-z.match_start,z.match_length-N),z.lookahead-=z.match_length,z.match_length<=z.max_lazy_match&&z.lookahead>=N){for(z.match_length--;z.strstart++,z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+N-1])&z.hash_mask,pe=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart,--z.match_length!=0;);z.strstart++}else z.strstart+=z.match_length,z.match_length=0,z.ins_h=z.window[z.strstart],z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+1])&z.hash_mask;else ee=d._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++;if(ee&&(G(z,!1),z.strm.avail_out===0))return R}return z.insert=z.strstart<N-1?z.strstart:N-1,ce===v?(G(z,!0),z.strm.avail_out===0?W:q):z.last_lit&&(G(z,!1),z.strm.avail_out===0)?R:K}function me(z,ce){for(var pe,ee,J;;){if(z.lookahead<$){if(fe(z),z.lookahead<$&&ce===g)return R;if(z.lookahead===0)break}if(pe=0,z.lookahead>=N&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+N-1])&z.hash_mask,pe=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),z.prev_length=z.match_length,z.prev_match=z.match_start,z.match_length=N-1,pe!==0&&z.prev_length<z.max_lazy_match&&z.strstart-pe<=z.w_size-$&&(z.match_length=ae(z,pe),z.match_length<=5&&(z.strategy===1||z.match_length===N&&4096<z.strstart-z.match_start)&&(z.match_length=N-1)),z.prev_length>=N&&z.match_length<=z.prev_length){for(J=z.strstart+z.lookahead-N,ee=d._tr_tally(z,z.strstart-1-z.prev_match,z.prev_length-N),z.lookahead-=z.prev_length-1,z.prev_length-=2;++z.strstart<=J&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+N-1])&z.hash_mask,pe=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),--z.prev_length!=0;);if(z.match_available=0,z.match_length=N-1,z.strstart++,ee&&(G(z,!1),z.strm.avail_out===0))return R}else if(z.match_available){if((ee=d._tr_tally(z,0,z.window[z.strstart-1]))&&G(z,!1),z.strstart++,z.lookahead--,z.strm.avail_out===0)return R}else z.match_available=1,z.strstart++,z.lookahead--}return z.match_available&&(ee=d._tr_tally(z,0,z.window[z.strstart-1]),z.match_available=0),z.insert=z.strstart<N-1?z.strstart:N-1,ce===v?(G(z,!0),z.strm.avail_out===0?W:q):z.last_lit&&(G(z,!1),z.strm.avail_out===0)?R:K}function Ce(z,ce,pe,ee,J){this.good_length=z,this.max_lazy=ce,this.nice_length=pe,this.max_chain=ee,this.func=J}function he(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*O),this.dyn_dtree=new l.Buf16(2*(2*F+1)),this.bl_tree=new l.Buf16(2*(2*H+1)),ne(this.dyn_ltree),ne(this.dyn_dtree),ne(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(I+1),this.heap=new l.Buf16(2*L+1),ne(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*L+1),ne(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Me(z){var ce;return z&&z.state?(z.total_in=z.total_out=0,z.data_type=C,(ce=z.state).pending=0,ce.pending_out=0,ce.wrap<0&&(ce.wrap=-ce.wrap),ce.status=ce.wrap?j:M,z.adler=ce.wrap===2?0:1,ce.last_flush=g,d._tr_init(ce),_):Z(z,E)}function qe(z){var ce=Me(z);return ce===_&&(function(pe){pe.window_size=2*pe.w_size,ne(pe.head),pe.max_lazy_match=o[pe.level].max_lazy,pe.good_match=o[pe.level].good_length,pe.nice_match=o[pe.level].nice_length,pe.max_chain_length=o[pe.level].max_chain,pe.strstart=0,pe.block_start=0,pe.lookahead=0,pe.insert=0,pe.match_length=pe.prev_length=N-1,pe.match_available=0,pe.ins_h=0})(z.state),ce}function Oe(z,ce,pe,ee,J,se){if(!z)return E;var xe=1;if(ce===x&&(ce=6),ee<0?(xe=0,ee=-ee):15<ee&&(xe=2,ee-=16),J<1||A<J||pe!==T||ee<8||15<ee||ce<0||9<ce||se<0||S<se)return Z(z,E);ee===8&&(ee=9);var Se=new he;return(z.state=Se).strm=z,Se.wrap=xe,Se.gzhead=null,Se.w_bits=ee,Se.w_size=1<<Se.w_bits,Se.w_mask=Se.w_size-1,Se.hash_bits=J+7,Se.hash_size=1<<Se.hash_bits,Se.hash_mask=Se.hash_size-1,Se.hash_shift=~~((Se.hash_bits+N-1)/N),Se.window=new l.Buf8(2*Se.w_size),Se.head=new l.Buf16(Se.hash_size),Se.prev=new l.Buf16(Se.w_size),Se.lit_bufsize=1<<J+6,Se.pending_buf_size=4*Se.lit_bufsize,Se.pending_buf=new l.Buf8(Se.pending_buf_size),Se.d_buf=1*Se.lit_bufsize,Se.l_buf=3*Se.lit_bufsize,Se.level=ce,Se.strategy=se,Se.method=pe,qe(z)}o=[new Ce(0,0,0,0,function(z,ce){var pe=65535;for(pe>z.pending_buf_size-5&&(pe=z.pending_buf_size-5);;){if(z.lookahead<=1){if(fe(z),z.lookahead===0&&ce===g)return R;if(z.lookahead===0)break}z.strstart+=z.lookahead,z.lookahead=0;var ee=z.block_start+pe;if((z.strstart===0||z.strstart>=ee)&&(z.lookahead=z.strstart-ee,z.strstart=ee,G(z,!1),z.strm.avail_out===0)||z.strstart-z.block_start>=z.w_size-$&&(G(z,!1),z.strm.avail_out===0))return R}return z.insert=0,ce===v?(G(z,!0),z.strm.avail_out===0?W:q):(z.strstart>z.block_start&&(G(z,!1),z.strm.avail_out),R)}),new Ce(4,4,8,4,Ee),new Ce(4,5,16,8,Ee),new Ce(4,6,32,32,Ee),new Ce(4,4,16,16,me),new Ce(8,16,32,32,me),new Ce(8,16,128,128,me),new Ce(8,32,128,256,me),new Ce(32,128,258,1024,me),new Ce(32,258,258,4096,me)],i.deflateInit=function(z,ce){return Oe(z,ce,T,15,8,0)},i.deflateInit2=Oe,i.deflateReset=qe,i.deflateResetKeep=Me,i.deflateSetHeader=function(z,ce){return z&&z.state?z.state.wrap!==2?E:(z.state.gzhead=ce,_):E},i.deflate=function(z,ce){var pe,ee,J,se;if(!z||!z.state||5<ce||ce<0)return z?Z(z,E):E;if(ee=z.state,!z.output||!z.input&&z.avail_in!==0||ee.status===666&&ce!==v)return Z(z,z.avail_out===0?-5:E);if(ee.strm=z,pe=ee.last_flush,ee.last_flush=ce,ee.status===j)if(ee.wrap===2)z.adler=0,te(ee,31),te(ee,139),te(ee,8),ee.gzhead?(te(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),te(ee,255&ee.gzhead.time),te(ee,ee.gzhead.time>>8&255),te(ee,ee.gzhead.time>>16&255),te(ee,ee.gzhead.time>>24&255),te(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),te(ee,255&ee.gzhead.os),ee.gzhead.extra&&ee.gzhead.extra.length&&(te(ee,255&ee.gzhead.extra.length),te(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(z.adler=m(z.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=69):(te(ee,0),te(ee,0),te(ee,0),te(ee,0),te(ee,0),te(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),te(ee,3),ee.status=M);else{var xe=T+(ee.w_bits-8<<4)<<8;xe|=(2<=ee.strategy||ee.level<2?0:ee.level<6?1:ee.level===6?2:3)<<6,ee.strstart!==0&&(xe|=32),xe+=31-xe%31,ee.status=M,ie(ee,xe),ee.strstart!==0&&(ie(ee,z.adler>>>16),ie(ee,65535&z.adler)),z.adler=1}if(ee.status===69)if(ee.gzhead.extra){for(J=ee.pending;ee.gzindex<(65535&ee.gzhead.extra.length)&&(ee.pending!==ee.pending_buf_size||(ee.gzhead.hcrc&&ee.pending>J&&(z.adler=m(z.adler,ee.pending_buf,ee.pending-J,J)),B(z),J=ee.pending,ee.pending!==ee.pending_buf_size));)te(ee,255&ee.gzhead.extra[ee.gzindex]),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>J&&(z.adler=m(z.adler,ee.pending_buf,ee.pending-J,J)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=73)}else ee.status=73;if(ee.status===73)if(ee.gzhead.name){J=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>J&&(z.adler=m(z.adler,ee.pending_buf,ee.pending-J,J)),B(z),J=ee.pending,ee.pending===ee.pending_buf_size)){se=1;break}se=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0,te(ee,se)}while(se!==0);ee.gzhead.hcrc&&ee.pending>J&&(z.adler=m(z.adler,ee.pending_buf,ee.pending-J,J)),se===0&&(ee.gzindex=0,ee.status=91)}else ee.status=91;if(ee.status===91)if(ee.gzhead.comment){J=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>J&&(z.adler=m(z.adler,ee.pending_buf,ee.pending-J,J)),B(z),J=ee.pending,ee.pending===ee.pending_buf_size)){se=1;break}se=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0,te(ee,se)}while(se!==0);ee.gzhead.hcrc&&ee.pending>J&&(z.adler=m(z.adler,ee.pending_buf,ee.pending-J,J)),se===0&&(ee.status=103)}else ee.status=103;if(ee.status===103&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&B(z),ee.pending+2<=ee.pending_buf_size&&(te(ee,255&z.adler),te(ee,z.adler>>8&255),z.adler=0,ee.status=M)):ee.status=M),ee.pending!==0){if(B(z),z.avail_out===0)return ee.last_flush=-1,_}else if(z.avail_in===0&&X(ce)<=X(pe)&&ce!==v)return Z(z,-5);if(ee.status===666&&z.avail_in!==0)return Z(z,-5);if(z.avail_in!==0||ee.lookahead!==0||ce!==g&&ee.status!==666){var Se=ee.strategy===2?(function(oe,je){for(var ze;;){if(oe.lookahead===0&&(fe(oe),oe.lookahead===0)){if(je===g)return R;break}if(oe.match_length=0,ze=d._tr_tally(oe,0,oe.window[oe.strstart]),oe.lookahead--,oe.strstart++,ze&&(G(oe,!1),oe.strm.avail_out===0))return R}return oe.insert=0,je===v?(G(oe,!0),oe.strm.avail_out===0?W:q):oe.last_lit&&(G(oe,!1),oe.strm.avail_out===0)?R:K})(ee,ce):ee.strategy===3?(function(oe,je){for(var ze,Ne,Ge,xt,st=oe.window;;){if(oe.lookahead<=U){if(fe(oe),oe.lookahead<=U&&je===g)return R;if(oe.lookahead===0)break}if(oe.match_length=0,oe.lookahead>=N&&0<oe.strstart&&(Ne=st[Ge=oe.strstart-1])===st[++Ge]&&Ne===st[++Ge]&&Ne===st[++Ge]){xt=oe.strstart+U;do;while(Ne===st[++Ge]&&Ne===st[++Ge]&&Ne===st[++Ge]&&Ne===st[++Ge]&&Ne===st[++Ge]&&Ne===st[++Ge]&&Ne===st[++Ge]&&Ne===st[++Ge]&&Ge<xt);oe.match_length=U-(xt-Ge),oe.match_length>oe.lookahead&&(oe.match_length=oe.lookahead)}if(oe.match_length>=N?(ze=d._tr_tally(oe,1,oe.match_length-N),oe.lookahead-=oe.match_length,oe.strstart+=oe.match_length,oe.match_length=0):(ze=d._tr_tally(oe,0,oe.window[oe.strstart]),oe.lookahead--,oe.strstart++),ze&&(G(oe,!1),oe.strm.avail_out===0))return R}return oe.insert=0,je===v?(G(oe,!0),oe.strm.avail_out===0?W:q):oe.last_lit&&(G(oe,!1),oe.strm.avail_out===0)?R:K})(ee,ce):o[ee.level].func(ee,ce);if(Se!==W&&Se!==q||(ee.status=666),Se===R||Se===W)return z.avail_out===0&&(ee.last_flush=-1),_;if(Se===K&&(ce===1?d._tr_align(ee):ce!==5&&(d._tr_stored_block(ee,0,0,!1),ce===3&&(ne(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),B(z),z.avail_out===0))return ee.last_flush=-1,_}return ce!==v?_:ee.wrap<=0?1:(ee.wrap===2?(te(ee,255&z.adler),te(ee,z.adler>>8&255),te(ee,z.adler>>16&255),te(ee,z.adler>>24&255),te(ee,255&z.total_in),te(ee,z.total_in>>8&255),te(ee,z.total_in>>16&255),te(ee,z.total_in>>24&255)):(ie(ee,z.adler>>>16),ie(ee,65535&z.adler)),B(z),0<ee.wrap&&(ee.wrap=-ee.wrap),ee.pending!==0?_:1)},i.deflateEnd=function(z){var ce;return z&&z.state?(ce=z.state.status)!==j&&ce!==69&&ce!==73&&ce!==91&&ce!==103&&ce!==M&&ce!==666?Z(z,E):(z.state=null,ce===M?Z(z,-3):_):E},i.deflateSetDictionary=function(z,ce){var pe,ee,J,se,xe,Se,oe,je,ze=ce.length;if(!z||!z.state||(se=(pe=z.state).wrap)===2||se===1&&pe.status!==j||pe.lookahead)return E;for(se===1&&(z.adler=h(z.adler,ce,ze,0)),pe.wrap=0,ze>=pe.w_size&&(se===0&&(ne(pe.head),pe.strstart=0,pe.block_start=0,pe.insert=0),je=new l.Buf8(pe.w_size),l.arraySet(je,ce,ze-pe.w_size,pe.w_size,0),ce=je,ze=pe.w_size),xe=z.avail_in,Se=z.next_in,oe=z.input,z.avail_in=ze,z.next_in=0,z.input=ce,fe(pe);pe.lookahead>=N;){for(ee=pe.strstart,J=pe.lookahead-(N-1);pe.ins_h=(pe.ins_h<<pe.hash_shift^pe.window[ee+N-1])&pe.hash_mask,pe.prev[ee&pe.w_mask]=pe.head[pe.ins_h],pe.head[pe.ins_h]=ee,ee++,--J;);pe.strstart=ee,pe.lookahead=N-1,fe(pe)}return pe.strstart+=pe.lookahead,pe.block_start=pe.strstart,pe.insert=pe.lookahead,pe.lookahead=0,pe.match_length=pe.prev_length=N-1,pe.match_available=0,z.next_in=Se,z.input=oe,z.avail_in=xe,pe.wrap=se,_},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(o,l){var d,h,m,p,g,v,_,E,x,S,C,T,A,L,F,H,O,I,N,U,$,j,M,R,K;d=o.state,h=o.next_in,R=o.input,m=h+(o.avail_in-5),p=o.next_out,K=o.output,g=p-(l-o.avail_out),v=p+(o.avail_out-257),_=d.dmax,E=d.wsize,x=d.whave,S=d.wnext,C=d.window,T=d.hold,A=d.bits,L=d.lencode,F=d.distcode,H=(1<<d.lenbits)-1,O=(1<<d.distbits)-1;e:do{A<15&&(T+=R[h++]<<A,A+=8,T+=R[h++]<<A,A+=8),I=L[T&H];t:for(;;){if(T>>>=N=I>>>24,A-=N,(N=I>>>16&255)===0)K[p++]=65535&I;else{if(!(16&N)){if((64&N)==0){I=L[(65535&I)+(T&(1<<N)-1)];continue t}if(32&N){d.mode=12;break e}o.msg="invalid literal/length code",d.mode=30;break e}U=65535&I,(N&=15)&&(A<N&&(T+=R[h++]<<A,A+=8),U+=T&(1<<N)-1,T>>>=N,A-=N),A<15&&(T+=R[h++]<<A,A+=8,T+=R[h++]<<A,A+=8),I=F[T&O];n:for(;;){if(T>>>=N=I>>>24,A-=N,!(16&(N=I>>>16&255))){if((64&N)==0){I=F[(65535&I)+(T&(1<<N)-1)];continue n}o.msg="invalid distance code",d.mode=30;break e}if($=65535&I,A<(N&=15)&&(T+=R[h++]<<A,(A+=8)<N&&(T+=R[h++]<<A,A+=8)),_<($+=T&(1<<N)-1)){o.msg="invalid distance too far back",d.mode=30;break e}if(T>>>=N,A-=N,(N=p-g)<$){if(x<(N=$-N)&&d.sane){o.msg="invalid distance too far back",d.mode=30;break e}if(M=C,(j=0)===S){if(j+=E-N,N<U){for(U-=N;K[p++]=C[j++],--N;);j=p-$,M=K}}else if(S<N){if(j+=E+S-N,(N-=S)<U){for(U-=N;K[p++]=C[j++],--N;);if(j=0,S<U){for(U-=N=S;K[p++]=C[j++],--N;);j=p-$,M=K}}}else if(j+=S-N,N<U){for(U-=N;K[p++]=C[j++],--N;);j=p-$,M=K}for(;2<U;)K[p++]=M[j++],K[p++]=M[j++],K[p++]=M[j++],U-=3;U&&(K[p++]=M[j++],1<U&&(K[p++]=M[j++]))}else{for(j=p-$;K[p++]=K[j++],K[p++]=K[j++],K[p++]=K[j++],2<(U-=3););U&&(K[p++]=K[j++],1<U&&(K[p++]=K[j++]))}break}}break}}while(h<m&&p<v);h-=U=A>>3,T&=(1<<(A-=U<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<m?m-h+5:5-(h-m),o.avail_out=p<v?v-p+257:257-(p-v),d.hold=T,d.bits=A}},{}],49:[function(n,r,i){var o=n("../utils/common"),l=n("./adler32"),d=n("./crc32"),h=n("./inffast"),m=n("./inftrees"),p=1,g=2,v=0,_=-2,E=1,x=852,S=592;function C(j){return(j>>>24&255)+(j>>>8&65280)+((65280&j)<<8)+((255&j)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(j){var M;return j&&j.state?(M=j.state,j.total_in=j.total_out=M.total=0,j.msg="",M.wrap&&(j.adler=1&M.wrap),M.mode=E,M.last=0,M.havedict=0,M.dmax=32768,M.head=null,M.hold=0,M.bits=0,M.lencode=M.lendyn=new o.Buf32(x),M.distcode=M.distdyn=new o.Buf32(S),M.sane=1,M.back=-1,v):_}function L(j){var M;return j&&j.state?((M=j.state).wsize=0,M.whave=0,M.wnext=0,A(j)):_}function F(j,M){var R,K;return j&&j.state?(K=j.state,M<0?(R=0,M=-M):(R=1+(M>>4),M<48&&(M&=15)),M&&(M<8||15<M)?_:(K.window!==null&&K.wbits!==M&&(K.window=null),K.wrap=R,K.wbits=M,L(j))):_}function H(j,M){var R,K;return j?(K=new T,(j.state=K).window=null,(R=F(j,M))!==v&&(j.state=null),R):_}var O,I,N=!0;function U(j){if(N){var M;for(O=new o.Buf32(512),I=new o.Buf32(32),M=0;M<144;)j.lens[M++]=8;for(;M<256;)j.lens[M++]=9;for(;M<280;)j.lens[M++]=7;for(;M<288;)j.lens[M++]=8;for(m(p,j.lens,0,288,O,0,j.work,{bits:9}),M=0;M<32;)j.lens[M++]=5;m(g,j.lens,0,32,I,0,j.work,{bits:5}),N=!1}j.lencode=O,j.lenbits=9,j.distcode=I,j.distbits=5}function $(j,M,R,K){var W,q=j.state;return q.window===null&&(q.wsize=1<<q.wbits,q.wnext=0,q.whave=0,q.window=new o.Buf8(q.wsize)),K>=q.wsize?(o.arraySet(q.window,M,R-q.wsize,q.wsize,0),q.wnext=0,q.whave=q.wsize):(K<(W=q.wsize-q.wnext)&&(W=K),o.arraySet(q.window,M,R-K,W,q.wnext),(K-=W)?(o.arraySet(q.window,M,R-K,K,0),q.wnext=K,q.whave=q.wsize):(q.wnext+=W,q.wnext===q.wsize&&(q.wnext=0),q.whave<q.wsize&&(q.whave+=W))),0}i.inflateReset=L,i.inflateReset2=F,i.inflateResetKeep=A,i.inflateInit=function(j){return H(j,15)},i.inflateInit2=H,i.inflate=function(j,M){var R,K,W,q,Z,X,ne,B,G,te,ie,ae,fe,Ee,me,Ce,he,Me,qe,Oe,z,ce,pe,ee,J=0,se=new o.Buf8(4),xe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!j||!j.state||!j.output||!j.input&&j.avail_in!==0)return _;(R=j.state).mode===12&&(R.mode=13),Z=j.next_out,W=j.output,ne=j.avail_out,q=j.next_in,K=j.input,X=j.avail_in,B=R.hold,G=R.bits,te=X,ie=ne,ce=v;e:for(;;)switch(R.mode){case E:if(R.wrap===0){R.mode=13;break}for(;G<16;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}if(2&R.wrap&&B===35615){se[R.check=0]=255&B,se[1]=B>>>8&255,R.check=d(R.check,se,2,0),G=B=0,R.mode=2;break}if(R.flags=0,R.head&&(R.head.done=!1),!(1&R.wrap)||(((255&B)<<8)+(B>>8))%31){j.msg="incorrect header check",R.mode=30;break}if((15&B)!=8){j.msg="unknown compression method",R.mode=30;break}if(G-=4,z=8+(15&(B>>>=4)),R.wbits===0)R.wbits=z;else if(z>R.wbits){j.msg="invalid window size",R.mode=30;break}R.dmax=1<<z,j.adler=R.check=1,R.mode=512&B?10:12,G=B=0;break;case 2:for(;G<16;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}if(R.flags=B,(255&R.flags)!=8){j.msg="unknown compression method",R.mode=30;break}if(57344&R.flags){j.msg="unknown header flags set",R.mode=30;break}R.head&&(R.head.text=B>>8&1),512&R.flags&&(se[0]=255&B,se[1]=B>>>8&255,R.check=d(R.check,se,2,0)),G=B=0,R.mode=3;case 3:for(;G<32;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}R.head&&(R.head.time=B),512&R.flags&&(se[0]=255&B,se[1]=B>>>8&255,se[2]=B>>>16&255,se[3]=B>>>24&255,R.check=d(R.check,se,4,0)),G=B=0,R.mode=4;case 4:for(;G<16;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}R.head&&(R.head.xflags=255&B,R.head.os=B>>8),512&R.flags&&(se[0]=255&B,se[1]=B>>>8&255,R.check=d(R.check,se,2,0)),G=B=0,R.mode=5;case 5:if(1024&R.flags){for(;G<16;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}R.length=B,R.head&&(R.head.extra_len=B),512&R.flags&&(se[0]=255&B,se[1]=B>>>8&255,R.check=d(R.check,se,2,0)),G=B=0}else R.head&&(R.head.extra=null);R.mode=6;case 6:if(1024&R.flags&&(X<(ae=R.length)&&(ae=X),ae&&(R.head&&(z=R.head.extra_len-R.length,R.head.extra||(R.head.extra=new Array(R.head.extra_len)),o.arraySet(R.head.extra,K,q,ae,z)),512&R.flags&&(R.check=d(R.check,K,ae,q)),X-=ae,q+=ae,R.length-=ae),R.length))break e;R.length=0,R.mode=7;case 7:if(2048&R.flags){if(X===0)break e;for(ae=0;z=K[q+ae++],R.head&&z&&R.length<65536&&(R.head.name+=String.fromCharCode(z)),z&&ae<X;);if(512&R.flags&&(R.check=d(R.check,K,ae,q)),X-=ae,q+=ae,z)break e}else R.head&&(R.head.name=null);R.length=0,R.mode=8;case 8:if(4096&R.flags){if(X===0)break e;for(ae=0;z=K[q+ae++],R.head&&z&&R.length<65536&&(R.head.comment+=String.fromCharCode(z)),z&&ae<X;);if(512&R.flags&&(R.check=d(R.check,K,ae,q)),X-=ae,q+=ae,z)break e}else R.head&&(R.head.comment=null);R.mode=9;case 9:if(512&R.flags){for(;G<16;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}if(B!==(65535&R.check)){j.msg="header crc mismatch",R.mode=30;break}G=B=0}R.head&&(R.head.hcrc=R.flags>>9&1,R.head.done=!0),j.adler=R.check=0,R.mode=12;break;case 10:for(;G<32;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}j.adler=R.check=C(B),G=B=0,R.mode=11;case 11:if(R.havedict===0)return j.next_out=Z,j.avail_out=ne,j.next_in=q,j.avail_in=X,R.hold=B,R.bits=G,2;j.adler=R.check=1,R.mode=12;case 12:if(M===5||M===6)break e;case 13:if(R.last){B>>>=7&G,G-=7&G,R.mode=27;break}for(;G<3;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}switch(R.last=1&B,G-=1,3&(B>>>=1)){case 0:R.mode=14;break;case 1:if(U(R),R.mode=20,M!==6)break;B>>>=2,G-=2;break e;case 2:R.mode=17;break;case 3:j.msg="invalid block type",R.mode=30}B>>>=2,G-=2;break;case 14:for(B>>>=7&G,G-=7&G;G<32;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}if((65535&B)!=(B>>>16^65535)){j.msg="invalid stored block lengths",R.mode=30;break}if(R.length=65535&B,G=B=0,R.mode=15,M===6)break e;case 15:R.mode=16;case 16:if(ae=R.length){if(X<ae&&(ae=X),ne<ae&&(ae=ne),ae===0)break e;o.arraySet(W,K,q,ae,Z),X-=ae,q+=ae,ne-=ae,Z+=ae,R.length-=ae;break}R.mode=12;break;case 17:for(;G<14;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}if(R.nlen=257+(31&B),B>>>=5,G-=5,R.ndist=1+(31&B),B>>>=5,G-=5,R.ncode=4+(15&B),B>>>=4,G-=4,286<R.nlen||30<R.ndist){j.msg="too many length or distance symbols",R.mode=30;break}R.have=0,R.mode=18;case 18:for(;R.have<R.ncode;){for(;G<3;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}R.lens[xe[R.have++]]=7&B,B>>>=3,G-=3}for(;R.have<19;)R.lens[xe[R.have++]]=0;if(R.lencode=R.lendyn,R.lenbits=7,pe={bits:R.lenbits},ce=m(0,R.lens,0,19,R.lencode,0,R.work,pe),R.lenbits=pe.bits,ce){j.msg="invalid code lengths set",R.mode=30;break}R.have=0,R.mode=19;case 19:for(;R.have<R.nlen+R.ndist;){for(;Ce=(J=R.lencode[B&(1<<R.lenbits)-1])>>>16&255,he=65535&J,!((me=J>>>24)<=G);){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}if(he<16)B>>>=me,G-=me,R.lens[R.have++]=he;else{if(he===16){for(ee=me+2;G<ee;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}if(B>>>=me,G-=me,R.have===0){j.msg="invalid bit length repeat",R.mode=30;break}z=R.lens[R.have-1],ae=3+(3&B),B>>>=2,G-=2}else if(he===17){for(ee=me+3;G<ee;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}G-=me,z=0,ae=3+(7&(B>>>=me)),B>>>=3,G-=3}else{for(ee=me+7;G<ee;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}G-=me,z=0,ae=11+(127&(B>>>=me)),B>>>=7,G-=7}if(R.have+ae>R.nlen+R.ndist){j.msg="invalid bit length repeat",R.mode=30;break}for(;ae--;)R.lens[R.have++]=z}}if(R.mode===30)break;if(R.lens[256]===0){j.msg="invalid code -- missing end-of-block",R.mode=30;break}if(R.lenbits=9,pe={bits:R.lenbits},ce=m(p,R.lens,0,R.nlen,R.lencode,0,R.work,pe),R.lenbits=pe.bits,ce){j.msg="invalid literal/lengths set",R.mode=30;break}if(R.distbits=6,R.distcode=R.distdyn,pe={bits:R.distbits},ce=m(g,R.lens,R.nlen,R.ndist,R.distcode,0,R.work,pe),R.distbits=pe.bits,ce){j.msg="invalid distances set",R.mode=30;break}if(R.mode=20,M===6)break e;case 20:R.mode=21;case 21:if(6<=X&&258<=ne){j.next_out=Z,j.avail_out=ne,j.next_in=q,j.avail_in=X,R.hold=B,R.bits=G,h(j,ie),Z=j.next_out,W=j.output,ne=j.avail_out,q=j.next_in,K=j.input,X=j.avail_in,B=R.hold,G=R.bits,R.mode===12&&(R.back=-1);break}for(R.back=0;Ce=(J=R.lencode[B&(1<<R.lenbits)-1])>>>16&255,he=65535&J,!((me=J>>>24)<=G);){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}if(Ce&&(240&Ce)==0){for(Me=me,qe=Ce,Oe=he;Ce=(J=R.lencode[Oe+((B&(1<<Me+qe)-1)>>Me)])>>>16&255,he=65535&J,!(Me+(me=J>>>24)<=G);){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}B>>>=Me,G-=Me,R.back+=Me}if(B>>>=me,G-=me,R.back+=me,R.length=he,Ce===0){R.mode=26;break}if(32&Ce){R.back=-1,R.mode=12;break}if(64&Ce){j.msg="invalid literal/length code",R.mode=30;break}R.extra=15&Ce,R.mode=22;case 22:if(R.extra){for(ee=R.extra;G<ee;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}R.length+=B&(1<<R.extra)-1,B>>>=R.extra,G-=R.extra,R.back+=R.extra}R.was=R.length,R.mode=23;case 23:for(;Ce=(J=R.distcode[B&(1<<R.distbits)-1])>>>16&255,he=65535&J,!((me=J>>>24)<=G);){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}if((240&Ce)==0){for(Me=me,qe=Ce,Oe=he;Ce=(J=R.distcode[Oe+((B&(1<<Me+qe)-1)>>Me)])>>>16&255,he=65535&J,!(Me+(me=J>>>24)<=G);){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}B>>>=Me,G-=Me,R.back+=Me}if(B>>>=me,G-=me,R.back+=me,64&Ce){j.msg="invalid distance code",R.mode=30;break}R.offset=he,R.extra=15&Ce,R.mode=24;case 24:if(R.extra){for(ee=R.extra;G<ee;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}R.offset+=B&(1<<R.extra)-1,B>>>=R.extra,G-=R.extra,R.back+=R.extra}if(R.offset>R.dmax){j.msg="invalid distance too far back",R.mode=30;break}R.mode=25;case 25:if(ne===0)break e;if(ae=ie-ne,R.offset>ae){if((ae=R.offset-ae)>R.whave&&R.sane){j.msg="invalid distance too far back",R.mode=30;break}fe=ae>R.wnext?(ae-=R.wnext,R.wsize-ae):R.wnext-ae,ae>R.length&&(ae=R.length),Ee=R.window}else Ee=W,fe=Z-R.offset,ae=R.length;for(ne<ae&&(ae=ne),ne-=ae,R.length-=ae;W[Z++]=Ee[fe++],--ae;);R.length===0&&(R.mode=21);break;case 26:if(ne===0)break e;W[Z++]=R.length,ne--,R.mode=21;break;case 27:if(R.wrap){for(;G<32;){if(X===0)break e;X--,B|=K[q++]<<G,G+=8}if(ie-=ne,j.total_out+=ie,R.total+=ie,ie&&(j.adler=R.check=R.flags?d(R.check,W,ie,Z-ie):l(R.check,W,ie,Z-ie)),ie=ne,(R.flags?B:C(B))!==R.check){j.msg="incorrect data check",R.mode=30;break}G=B=0}R.mode=28;case 28:if(R.wrap&&R.flags){for(;G<32;){if(X===0)break e;X--,B+=K[q++]<<G,G+=8}if(B!==(4294967295&R.total)){j.msg="incorrect length check",R.mode=30;break}G=B=0}R.mode=29;case 29:ce=1;break e;case 30:ce=-3;break e;case 31:return-4;default:return _}return j.next_out=Z,j.avail_out=ne,j.next_in=q,j.avail_in=X,R.hold=B,R.bits=G,(R.wsize||ie!==j.avail_out&&R.mode<30&&(R.mode<27||M!==4))&&$(j,j.output,j.next_out,ie-j.avail_out)?(R.mode=31,-4):(te-=j.avail_in,ie-=j.avail_out,j.total_in+=te,j.total_out+=ie,R.total+=ie,R.wrap&&ie&&(j.adler=R.check=R.flags?d(R.check,W,ie,j.next_out-ie):l(R.check,W,ie,j.next_out-ie)),j.data_type=R.bits+(R.last?64:0)+(R.mode===12?128:0)+(R.mode===20||R.mode===15?256:0),(te==0&&ie===0||M===4)&&ce===v&&(ce=-5),ce)},i.inflateEnd=function(j){if(!j||!j.state)return _;var M=j.state;return M.window&&(M.window=null),j.state=null,v},i.inflateGetHeader=function(j,M){var R;return j&&j.state?(2&(R=j.state).wrap)==0?_:((R.head=M).done=!1,v):_},i.inflateSetDictionary=function(j,M){var R,K=M.length;return j&&j.state?(R=j.state).wrap!==0&&R.mode!==11?_:R.mode===11&&l(1,M,K,0)!==R.check?-3:$(j,M,K,K)?(R.mode=31,-4):(R.havedict=1,v):_},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var o=n("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,v,_,E,x,S,C){var T,A,L,F,H,O,I,N,U,$=C.bits,j=0,M=0,R=0,K=0,W=0,q=0,Z=0,X=0,ne=0,B=0,G=null,te=0,ie=new o.Buf16(16),ae=new o.Buf16(16),fe=null,Ee=0;for(j=0;j<=15;j++)ie[j]=0;for(M=0;M<_;M++)ie[g[v+M]]++;for(W=$,K=15;1<=K&&ie[K]===0;K--);if(K<W&&(W=K),K===0)return E[x++]=20971520,E[x++]=20971520,C.bits=1,0;for(R=1;R<K&&ie[R]===0;R++);for(W<R&&(W=R),j=X=1;j<=15;j++)if(X<<=1,(X-=ie[j])<0)return-1;if(0<X&&(p===0||K!==1))return-1;for(ae[1]=0,j=1;j<15;j++)ae[j+1]=ae[j]+ie[j];for(M=0;M<_;M++)g[v+M]!==0&&(S[ae[g[v+M]]++]=M);if(O=p===0?(G=fe=S,19):p===1?(G=l,te-=257,fe=d,Ee-=257,256):(G=h,fe=m,-1),j=R,H=x,Z=M=B=0,L=-1,F=(ne=1<<(q=W))-1,p===1&&852<ne||p===2&&592<ne)return 1;for(;;){for(I=j-Z,U=S[M]<O?(N=0,S[M]):S[M]>O?(N=fe[Ee+S[M]],G[te+S[M]]):(N=96,0),T=1<<j-Z,R=A=1<<q;E[H+(B>>Z)+(A-=T)]=I<<24|N<<16|U|0,A!==0;);for(T=1<<j-1;B&T;)T>>=1;if(T!==0?(B&=T-1,B+=T):B=0,M++,--ie[j]==0){if(j===K)break;j=g[v+S[M]]}if(W<j&&(B&F)!==L){for(Z===0&&(Z=W),H+=R,X=1<<(q=j-Z);q+Z<K&&!((X-=ie[q+Z])<=0);)q++,X<<=1;if(ne+=1<<q,p===1&&852<ne||p===2&&592<ne)return 1;E[L=B&F]=W<<24|q<<16|H-x|0}}return B!==0&&(E[H+B]=j-Z<<24|64<<16|0),C.bits=W,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var o=n("../utils/common"),l=0,d=1;function h(J){for(var se=J.length;0<=--se;)J[se]=0}var m=0,p=29,g=256,v=g+1+p,_=30,E=19,x=2*v+1,S=15,C=16,T=7,A=256,L=16,F=17,H=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],I=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(v+2));h($);var j=new Array(2*_);h(j);var M=new Array(512);h(M);var R=new Array(256);h(R);var K=new Array(p);h(K);var W,q,Z,X=new Array(_);function ne(J,se,xe,Se,oe){this.static_tree=J,this.extra_bits=se,this.extra_base=xe,this.elems=Se,this.max_length=oe,this.has_stree=J&&J.length}function B(J,se){this.dyn_tree=J,this.max_code=0,this.stat_desc=se}function G(J){return J<256?M[J]:M[256+(J>>>7)]}function te(J,se){J.pending_buf[J.pending++]=255&se,J.pending_buf[J.pending++]=se>>>8&255}function ie(J,se,xe){J.bi_valid>C-xe?(J.bi_buf|=se<<J.bi_valid&65535,te(J,J.bi_buf),J.bi_buf=se>>C-J.bi_valid,J.bi_valid+=xe-C):(J.bi_buf|=se<<J.bi_valid&65535,J.bi_valid+=xe)}function ae(J,se,xe){ie(J,xe[2*se],xe[2*se+1])}function fe(J,se){for(var xe=0;xe|=1&J,J>>>=1,xe<<=1,0<--se;);return xe>>>1}function Ee(J,se,xe){var Se,oe,je=new Array(S+1),ze=0;for(Se=1;Se<=S;Se++)je[Se]=ze=ze+xe[Se-1]<<1;for(oe=0;oe<=se;oe++){var Ne=J[2*oe+1];Ne!==0&&(J[2*oe]=fe(je[Ne]++,Ne))}}function me(J){var se;for(se=0;se<v;se++)J.dyn_ltree[2*se]=0;for(se=0;se<_;se++)J.dyn_dtree[2*se]=0;for(se=0;se<E;se++)J.bl_tree[2*se]=0;J.dyn_ltree[2*A]=1,J.opt_len=J.static_len=0,J.last_lit=J.matches=0}function Ce(J){8<J.bi_valid?te(J,J.bi_buf):0<J.bi_valid&&(J.pending_buf[J.pending++]=J.bi_buf),J.bi_buf=0,J.bi_valid=0}function he(J,se,xe,Se){var oe=2*se,je=2*xe;return J[oe]<J[je]||J[oe]===J[je]&&Se[se]<=Se[xe]}function Me(J,se,xe){for(var Se=J.heap[xe],oe=xe<<1;oe<=J.heap_len&&(oe<J.heap_len&&he(se,J.heap[oe+1],J.heap[oe],J.depth)&&oe++,!he(se,Se,J.heap[oe],J.depth));)J.heap[xe]=J.heap[oe],xe=oe,oe<<=1;J.heap[xe]=Se}function qe(J,se,xe){var Se,oe,je,ze,Ne=0;if(J.last_lit!==0)for(;Se=J.pending_buf[J.d_buf+2*Ne]<<8|J.pending_buf[J.d_buf+2*Ne+1],oe=J.pending_buf[J.l_buf+Ne],Ne++,Se===0?ae(J,oe,se):(ae(J,(je=R[oe])+g+1,se),(ze=O[je])!==0&&ie(J,oe-=K[je],ze),ae(J,je=G(--Se),xe),(ze=I[je])!==0&&ie(J,Se-=X[je],ze)),Ne<J.last_lit;);ae(J,A,se)}function Oe(J,se){var xe,Se,oe,je=se.dyn_tree,ze=se.stat_desc.static_tree,Ne=se.stat_desc.has_stree,Ge=se.stat_desc.elems,xt=-1;for(J.heap_len=0,J.heap_max=x,xe=0;xe<Ge;xe++)je[2*xe]!==0?(J.heap[++J.heap_len]=xt=xe,J.depth[xe]=0):je[2*xe+1]=0;for(;J.heap_len<2;)je[2*(oe=J.heap[++J.heap_len]=xt<2?++xt:0)]=1,J.depth[oe]=0,J.opt_len--,Ne&&(J.static_len-=ze[2*oe+1]);for(se.max_code=xt,xe=J.heap_len>>1;1<=xe;xe--)Me(J,je,xe);for(oe=Ge;xe=J.heap[1],J.heap[1]=J.heap[J.heap_len--],Me(J,je,1),Se=J.heap[1],J.heap[--J.heap_max]=xe,J.heap[--J.heap_max]=Se,je[2*oe]=je[2*xe]+je[2*Se],J.depth[oe]=(J.depth[xe]>=J.depth[Se]?J.depth[xe]:J.depth[Se])+1,je[2*xe+1]=je[2*Se+1]=oe,J.heap[1]=oe++,Me(J,je,1),2<=J.heap_len;);J.heap[--J.heap_max]=J.heap[1],(function(st,Gn){var ms,Jn,ps,bt,Zt,Qn,Et=Gn.dyn_tree,za=Gn.max_code,Ti=Gn.stat_desc.static_tree,zo=Gn.stat_desc.has_stree,jr=Gn.stat_desc.extra_bits,gs=Gn.stat_desc.extra_base,Lt=Gn.stat_desc.max_length,er=0;for(bt=0;bt<=S;bt++)st.bl_count[bt]=0;for(Et[2*st.heap[st.heap_max]+1]=0,ms=st.heap_max+1;ms<x;ms++)Lt<(bt=Et[2*Et[2*(Jn=st.heap[ms])+1]+1]+1)&&(bt=Lt,er++),Et[2*Jn+1]=bt,za<Jn||(st.bl_count[bt]++,Zt=0,gs<=Jn&&(Zt=jr[Jn-gs]),Qn=Et[2*Jn],st.opt_len+=Qn*(bt+Zt),zo&&(st.static_len+=Qn*(Ti[2*Jn+1]+Zt)));if(er!==0){do{for(bt=Lt-1;st.bl_count[bt]===0;)bt--;st.bl_count[bt]--,st.bl_count[bt+1]+=2,st.bl_count[Lt]--,er-=2}while(0<er);for(bt=Lt;bt!==0;bt--)for(Jn=st.bl_count[bt];Jn!==0;)za<(ps=st.heap[--ms])||(Et[2*ps+1]!==bt&&(st.opt_len+=(bt-Et[2*ps+1])*Et[2*ps],Et[2*ps+1]=bt),Jn--)}})(J,se),Ee(je,xt,J.bl_count)}function z(J,se,xe){var Se,oe,je=-1,ze=se[1],Ne=0,Ge=7,xt=4;for(ze===0&&(Ge=138,xt=3),se[2*(xe+1)+1]=65535,Se=0;Se<=xe;Se++)oe=ze,ze=se[2*(Se+1)+1],++Ne<Ge&&oe===ze||(Ne<xt?J.bl_tree[2*oe]+=Ne:oe!==0?(oe!==je&&J.bl_tree[2*oe]++,J.bl_tree[2*L]++):Ne<=10?J.bl_tree[2*F]++:J.bl_tree[2*H]++,je=oe,xt=(Ne=0)===ze?(Ge=138,3):oe===ze?(Ge=6,3):(Ge=7,4))}function ce(J,se,xe){var Se,oe,je=-1,ze=se[1],Ne=0,Ge=7,xt=4;for(ze===0&&(Ge=138,xt=3),Se=0;Se<=xe;Se++)if(oe=ze,ze=se[2*(Se+1)+1],!(++Ne<Ge&&oe===ze)){if(Ne<xt)for(;ae(J,oe,J.bl_tree),--Ne!=0;);else oe!==0?(oe!==je&&(ae(J,oe,J.bl_tree),Ne--),ae(J,L,J.bl_tree),ie(J,Ne-3,2)):Ne<=10?(ae(J,F,J.bl_tree),ie(J,Ne-3,3)):(ae(J,H,J.bl_tree),ie(J,Ne-11,7));je=oe,xt=(Ne=0)===ze?(Ge=138,3):oe===ze?(Ge=6,3):(Ge=7,4)}}h(X);var pe=!1;function ee(J,se,xe,Se){ie(J,(m<<1)+(Se?1:0),3),(function(oe,je,ze,Ne){Ce(oe),te(oe,ze),te(oe,~ze),o.arraySet(oe.pending_buf,oe.window,je,ze,oe.pending),oe.pending+=ze})(J,se,xe)}i._tr_init=function(J){pe||((function(){var se,xe,Se,oe,je,ze=new Array(S+1);for(oe=Se=0;oe<p-1;oe++)for(K[oe]=Se,se=0;se<1<<O[oe];se++)R[Se++]=oe;for(R[Se-1]=oe,oe=je=0;oe<16;oe++)for(X[oe]=je,se=0;se<1<<I[oe];se++)M[je++]=oe;for(je>>=7;oe<_;oe++)for(X[oe]=je<<7,se=0;se<1<<I[oe]-7;se++)M[256+je++]=oe;for(xe=0;xe<=S;xe++)ze[xe]=0;for(se=0;se<=143;)$[2*se+1]=8,se++,ze[8]++;for(;se<=255;)$[2*se+1]=9,se++,ze[9]++;for(;se<=279;)$[2*se+1]=7,se++,ze[7]++;for(;se<=287;)$[2*se+1]=8,se++,ze[8]++;for(Ee($,v+1,ze),se=0;se<_;se++)j[2*se+1]=5,j[2*se]=fe(se,5);W=new ne($,O,g+1,v,S),q=new ne(j,I,0,_,S),Z=new ne(new Array(0),N,0,E,T)})(),pe=!0),J.l_desc=new B(J.dyn_ltree,W),J.d_desc=new B(J.dyn_dtree,q),J.bl_desc=new B(J.bl_tree,Z),J.bi_buf=0,J.bi_valid=0,me(J)},i._tr_stored_block=ee,i._tr_flush_block=function(J,se,xe,Se){var oe,je,ze=0;0<J.level?(J.strm.data_type===2&&(J.strm.data_type=(function(Ne){var Ge,xt=4093624447;for(Ge=0;Ge<=31;Ge++,xt>>>=1)if(1&xt&&Ne.dyn_ltree[2*Ge]!==0)return l;if(Ne.dyn_ltree[18]!==0||Ne.dyn_ltree[20]!==0||Ne.dyn_ltree[26]!==0)return d;for(Ge=32;Ge<g;Ge++)if(Ne.dyn_ltree[2*Ge]!==0)return d;return l})(J)),Oe(J,J.l_desc),Oe(J,J.d_desc),ze=(function(Ne){var Ge;for(z(Ne,Ne.dyn_ltree,Ne.l_desc.max_code),z(Ne,Ne.dyn_dtree,Ne.d_desc.max_code),Oe(Ne,Ne.bl_desc),Ge=E-1;3<=Ge&&Ne.bl_tree[2*U[Ge]+1]===0;Ge--);return Ne.opt_len+=3*(Ge+1)+5+5+4,Ge})(J),oe=J.opt_len+3+7>>>3,(je=J.static_len+3+7>>>3)<=oe&&(oe=je)):oe=je=xe+5,xe+4<=oe&&se!==-1?ee(J,se,xe,Se):J.strategy===4||je===oe?(ie(J,2+(Se?1:0),3),qe(J,$,j)):(ie(J,4+(Se?1:0),3),(function(Ne,Ge,xt,st){var Gn;for(ie(Ne,Ge-257,5),ie(Ne,xt-1,5),ie(Ne,st-4,4),Gn=0;Gn<st;Gn++)ie(Ne,Ne.bl_tree[2*U[Gn]+1],3);ce(Ne,Ne.dyn_ltree,Ge-1),ce(Ne,Ne.dyn_dtree,xt-1)})(J,J.l_desc.max_code+1,J.d_desc.max_code+1,ze+1),qe(J,J.dyn_ltree,J.dyn_dtree)),me(J),Se&&Ce(J)},i._tr_tally=function(J,se,xe){return J.pending_buf[J.d_buf+2*J.last_lit]=se>>>8&255,J.pending_buf[J.d_buf+2*J.last_lit+1]=255&se,J.pending_buf[J.l_buf+J.last_lit]=255&xe,J.last_lit++,se===0?J.dyn_ltree[2*xe]++:(J.matches++,se--,J.dyn_ltree[2*(R[xe]+g+1)]++,J.dyn_dtree[2*G(se)]++),J.last_lit===J.lit_bufsize-1},i._tr_align=function(J){ie(J,2,3),ae(J,A,$),(function(se){se.bi_valid===16?(te(se,se.bi_buf),se.bi_buf=0,se.bi_valid=0):8<=se.bi_valid&&(se.pending_buf[se.pending++]=255&se.bi_buf,se.bi_buf>>=8,se.bi_valid-=8)})(J)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(o){(function(l,d){if(!l.setImmediate){var h,m,p,g,v=1,_={},E=!1,x=l.document,S=Object.getPrototypeOf&&Object.getPrototypeOf(l);S=S&&S.setTimeout?S:l,h={}.toString.call(l.process)==="[object process]"?function(L){process.nextTick(function(){T(L)})}:(function(){if(l.postMessage&&!l.importScripts){var L=!0,F=l.onmessage;return l.onmessage=function(){L=!1},l.postMessage("","*"),l.onmessage=F,L}})()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",A,!1):l.attachEvent("onmessage",A),function(L){l.postMessage(g+L,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(L){T(L.data)},function(L){p.port2.postMessage(L)}):x&&"onreadystatechange"in x.createElement("script")?(m=x.documentElement,function(L){var F=x.createElement("script");F.onreadystatechange=function(){T(L),F.onreadystatechange=null,m.removeChild(F),F=null},m.appendChild(F)}):function(L){setTimeout(T,0,L)},S.setImmediate=function(L){typeof L!="function"&&(L=new Function(""+L));for(var F=new Array(arguments.length-1),H=0;H<F.length;H++)F[H]=arguments[H+1];var O={callback:L,args:F};return _[v]=O,h(v),v++},S.clearImmediate=C}function C(L){delete _[L]}function T(L){if(E)setTimeout(T,0,L);else{var F=_[L];if(F){E=!0;try{(function(H){var O=H.callback,I=H.args;switch(I.length){case 0:O();break;case 1:O(I[0]);break;case 2:O(I[0],I[1]);break;case 3:O(I[0],I[1],I[2]);break;default:O.apply(d,I)}})(F)}finally{C(L),E=!1}}}}function A(L){L.source===l&&typeof L.data=="string"&&L.data.indexOf(g)===0&&T(+L.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof zh<"u"?zh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Kg)),Kg.exports}var fP=hP();const Cm=q5(fP);function mP({currentUser:t,budgetId:e}){const[n,r]=k.useState(!1),[i,o]=k.useState(null),[l,d]=k.useState(null);async function h(){if(!t){d("Must be logged in to download budget");return}if(!e){d("No budget selected");return}r(!0),d(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:m,data:p}=await At("budgets",e,`downloading budget ${e}`);if(!m||!p){d(`Budget ${e} not found`);return}const g=await FT(e,"download-budget");let v=null;try{const{exists:j,data:M}=await At("payees",e,`downloading payees for budget ${e}`);j&&M&&(v=M)}catch(j){console.warn(`Could not read payees for budget ${e}:`,j)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const _=new Cm,E=new Date,x=E.toISOString().split("T")[0],S=`budget_${e}`,{accounts:C,account_groups:T,categories:A,category_groups:L,...F}=p;_.file(`${S}/budget.json`,JSON.stringify(F,null,2)),_.file(`${S}/accounts.json`,JSON.stringify(C||{},null,2)),_.file(`${S}/account_groups.json`,JSON.stringify(T||{},null,2)),_.file(`${S}/categories.json`,JSON.stringify(A||{},null,2)),_.file(`${S}/category_groups.json`,JSON.stringify(L||[],null,2)),v&&_.file(`${S}/payees.json`,JSON.stringify(v,null,2));let H=0;for(const j of g){const M=j.data,R=`${S}/months/month_${M.year}_${String(M.month).padStart(2,"0")}`,K={};if(M.are_allocations_finalized&&M.category_balances)for(const W of M.category_balances)W.allocated!==void 0&&(K[W.category_id]=W.allocated);_.file(`${R}/metadata.json`,JSON.stringify({budget_id:M.budget_id,year_month_ordinal:M.year_month_ordinal,year:M.year,month:M.month,total_income:M.total_income,previous_month_income:M.previous_month_income,total_expenses:M.total_expenses,are_allocations_finalized:M.are_allocations_finalized,created_at:M.created_at,updated_at:M.updated_at,...M.are_allocations_finalized&&{allocations:K},downloaded_at:E.toISOString()},null,2)),_.file(`${R}/income.json`,JSON.stringify(M.income||[],null,2)),_.file(`${R}/expenses.json`,JSON.stringify(M.expenses||[],null,2)),_.file(`${R}/transfers.json`,JSON.stringify(M.transfers||[],null,2)),_.file(`${R}/adjustments.json`,JSON.stringify(M.adjustments||[],null,2)),_.file(`${R}/account_balances.json`,JSON.stringify(M.account_balances||[],null,2)),_.file(`${R}/category_balances.json`,JSON.stringify(M.category_balances||[],null,2)),H++,o({phase:"processing",current:H,total:g.length,percentComplete:20+Math.round(H/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const O=await _.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const N=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),U=URL.createObjectURL(O),$=document.createElement("a");$.href=U,$.download=`${x}_${N}_${e}.zip`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(U)}catch(m){d(m instanceof Error?m.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:i,error:l,downloadBudget:h}}async function pP(t){const n=await new Cm().loadAsync(t),r=new Set,i=new Set;for(const[o]of Object.entries(n.files)){const l=o.match(/^budget_([^/]+)\//);if(l){const d=l[1];r.add(d),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&i.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:i.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function gP(t,e,n){const i=`${`${e}/months/`}${n}/`,o=`${i}metadata.json`,l=t.files[o];if(!l)return null;const d=await l.async("string"),h=JSON.parse(d),{downloaded_at:m,allocations:p,...g}=h,v=async S=>{const C=`${i}${S}`,T=t.files[C];if(T){const A=await T.async("string");return JSON.parse(A)}return[]},_={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await v("income.json"),expenses:await v("expenses.json"),transfers:await v("transfers.json"),adjustments:await v("adjustments.json"),account_balances:[],category_balances:[]},E=Ta(_);let x=wm(E);if(h.are_allocations_finalized&&p!==void 0){const S=new Map;for(const A of x.category_balances)S.set(A.category_id,A);const C=[],T=new Set;for(const A of x.category_balances){const L=p[A.category_id];if(L!==void 0){const F=Pe(L);C.push({...A,allocated:F,end_balance:Pe(A.start_balance+F+A.spent+A.transfers+A.adjustments)})}else C.push(A);T.add(A.category_id)}for(const[A,L]of Object.entries(p))if(!T.has(A)){const F=Pe(L);C.push({category_id:A,start_balance:0,allocated:F,spent:0,transfers:0,adjustments:0,end_balance:F})}x={...x,category_balances:C}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:x}}async function yP(t,e){const n=`budget_${e}`,r=async H=>{const O=t.files[H];if(O){const I=await O.async("string");return JSON.parse(I)}return null},i=`${n}/budget.json`,o=`${n}/accounts.json`,l=`${n}/account_groups.json`,d=`${n}/categories.json`,h=`${n}/category_groups.json`,m=await r(i);if(!m)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(l)||{},v=await r(d)||{},_=await r(h)||[],E=Ta({...m,accounts:p,account_groups:g,categories:v,category_groups:_}),x={budgetId:e,data:E},S=`${n}/payees.json`,C=await r(S);let T=null;if(C){const H={...C,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:Ta(H)}}const A=`${n}/months/`,L=new Set;for(const H of Object.keys(t.files))if(H.startsWith(A)&&H.includes("/metadata.json")){const O=H.split("/months/")[1].split("/")[0];L.add(O)}const F=[];for(const H of L){const O=await gP(t,n,H);O&&F.push(O)}return{budgetUpdate:x,monthUpdates:F,payeeWrite:T}}function _P({currentUser:t}){const[e,n]=k.useState(!1),[r,i]=k.useState(!1),[o,l]=k.useState(null),[d,h]=k.useState(null),[m,p]=k.useState(null),[g,v]=k.useState(null);async function _(x){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),l(null),v(null);try{const S=await pP(x);l(S)}catch(S){p(S instanceof Error?S.message:"Failed to parse zip file")}finally{n(!1)}}async function E(x){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}i(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const S=[];let C=0,T=0,A=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const F=await new Cm().loadAsync(x);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const H=[],O=[],I=[];for(let N=0;N<o.budgetsToRestore.length;N++){const U=o.budgetsToRestore[N];try{const{budgetUpdate:$,monthUpdates:j,payeeWrite:M}=await yP(F,U);H.push($),O.push(...j),M&&I.push(M),h({phase:"uploading",current:N+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((N+1)/o.budgetsToRestore.length*50)})}catch($){S.push(`Budget ${U}: ${$ instanceof Error?$.message:String($)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),H.length>0)try{console.log(`[Upload] Writing ${H.length} budget(s)...`),await VT(H,"upload-budget"),C=H.length,console.log(`[Upload] Successfully wrote ${C} budget(s)`)}catch(N){const U=`Failed to write budgets: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${U}`,N),S.push(U),N}if(I.length>0)try{console.log(`[Upload] Writing ${I.length} payee doc(s)...`),await pm(I,"upload-budget: writing payees"),A=I.length,console.log(`[Upload] Successfully wrote ${A} payee doc(s)`)}catch(N){const U=`Failed to write payees: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${U}`,N),S.push(U),N}if(O.length>0)try{console.log(`[Upload] Writing ${O.length} month(s) and recalculating...`),await C3(O,"upload-budget"),T=O.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(N){const U=`Failed to write months: ${N instanceof Error?N.message:String(N)}`;throw console.error(`[Upload] ${U}`,N),S.push(U),N}h({phase:"complete",current:1,total:1,percentComplete:100}),v({success:S.length===0,budgetsRestored:C,monthsRestored:T,payeesRestored:A,errors:S}),console.log("[Upload] Clearing all caches after upload..."),ja()}catch(L){const F=L instanceof Error?L.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",L),console.error("[Upload] Error details:",{errorMessage:F,budgetsRestored:C,monthsRestored:T,payeesRestored:A,errorsSoFar:S}),p(F),v({success:!1,budgetsRestored:C,monthsRestored:T,payeesRestored:A,errors:[...S,F]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),ja()}finally{i(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:d,error:m,result:g,scanZipFile:_,uploadBudget:E}}function Tm({children:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:d,onEdit:h,onDelete:m,onMoveUp:p,onMoveDown:g,canMoveUp:v=!0,canMoveDown:_=!0,itemName:E}){const x=fs(),S=p||g;return u.jsxs("div",{onDragOver:C=>{C.stopPropagation(),i(C)},onDragLeave:C=>{C.stopPropagation(),o()},onDrop:C=>{C.stopPropagation(),d(C)},style:{position:"relative"},children:[u.jsx("div",{style:{...jT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),u.jsxs("div",{style:{...x?D6:ud,opacity:e?.5:1},children:[u.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:x?"0.5rem":"0.75rem",minWidth:0},children:[u.jsx("span",{draggable:!0,onDragStart:C=>{r(C)},onDragEnd:()=>{l()},style:{...AT,fontSize:x?"0.9rem":void 0,cursor:"grab",padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder",children:""}),u.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis"},children:t})]}),u.jsxs("div",{style:x?U6:L6,children:[x?u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:()=>{h()},style:TT,title:"Edit","aria-label":"Edit",children:""}),u.jsx("button",{onClick:()=>{m()},style:F6,title:"Delete","aria-label":"Delete",children:""})]}):u.jsxs(u.Fragment,{children:[u.jsx(Fe,{variant:"secondary",actionName:`Edit ${E||"Item"}`,onClick:h,children:"Edit"}),u.jsx(Fe,{variant:"danger",actionName:`Delete ${E||"Item"}`,onClick:m,children:"Delete"})]}),S&&u.jsxs("div",{style:Q0,children:[u.jsx("button",{onClick:C=>{C.stopPropagation(),p?.()},disabled:!v,style:{...Yl,opacity:v?.6:.2,cursor:v?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:C=>{C.stopPropagation(),g?.()},disabled:!_,style:{...Yl,opacity:_?.6:.2,cursor:_?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})]})}function X0({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:i="Move to end"}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:$6,children:[u.jsx("div",{style:{...q6,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&u.jsx("span",{style:H6,children:i})]})}function Je(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function os(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Pa(t){return t===0?"$0.00":`${t>0?"+":"-"}${Je(t)}`}function Gt(t){return`${t>=0?"+":"-"}${Je(t)}`}function Bt(t){return t===0?ue.zero:t>0?ue.success:ue.danger}function Fn(t){return t===0?ue.zero:t>0?ue.success:ue.debt}function pc(t){return t===0?ue.zero:t<0?ue.error:ue.success}function gc(t){return t===0?ue.zero:t>0?ue.success:ue.error}async function QT(t,e){const{exists:n,data:r}=await At("feedback",t,`VALIDATION-READ: ${e}`);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function Z0(t){const{docId:e,items:n,description:r}=t;await qn("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function bP(t,e,n,r){const{exists:i}=await At("feedback",t,"checking if user has existing feedback document");i?await qn("feedback",t,{items:Uu(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await qn("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r)}function WT(){const t=Ft(),e=Hn({onMutate:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,m=o||i,p=ke.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),v=`feedback_optimistic_${Date.now()}`,_={id:v,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d,doc_id:m,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,_]}),{previousData:g,optimisticId:v}},mutationFn:async r=>{const{userId:i,userEmail:o,text:l,feedbackType:d,currentPath:h}=r,m=o||i,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${l}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:d};return await bP(m,p,o,"submitting new feedback"),{feedbackItem:p,docId:m}},onSuccess:(r,i,o)=>{if(!o?.optimisticId)return;const l=t.getQueryData(ke.feedback());l&&t.setQueryData(ke.feedback(),{items:l.items.map(d=>d.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:i.userEmail}:d)})},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function vP(){const t=Ft(),e=Hn({onMutate:async r=>{const{item:i}=r,o=ke.feedback(),l=!i.is_done,d=l?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(m=>m.id===i.id?{...m,is_done:l,completed_at:d}:m)}),{previousData:h}},mutationFn:async r=>{const{item:i}=r,o=!i.is_done,l=o?new Date().toISOString():null,d=await QT(i.doc_id,"toggle feedback");let h=!1;const m=d.items.map(p=>p.id===i.id?(h=!0,{...p,is_done:o,completed_at:l}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:i.id,inDocument:i.doc_id,availableIds:d.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${i.id}, Doc ID: ${i.doc_id}`);return await Z0({docId:i.doc_id,items:m,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:i.id,isDone:o,completedAt:l}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function xP(){const t=Ft(),e=Hn({onMutate:async r=>{const{docId:i,items:o}=r,l=ke.feedback();await t.cancelQueries({queryKey:l});const d=t.getQueryData(l),h=new Map;return o.forEach(m=>{h.set(m.id,m.sort_order)}),d&&t.setQueryData(l,{items:d.items.map(m=>m.doc_id===i&&h.has(m.id)?{...m,sort_order:h.get(m.id)}:m)}),{previousData:d}},mutationFn:async r=>{const{docId:i,items:o}=r;return await Z0({docId:i,items:o,description:"saving reordered feedback items"}),{docId:i,items:o}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function ls({isOpen:t,onClose:e,title:n,children:r,width:i="28rem"}){if(!t)return null;function o(){e()}return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:i,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:l=>l.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[u.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const wP=2e3,SP={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function EP(){const[t,e]=k.useState(!1),[n,r]=k.useState(""),[i,o]=k.useState("bug"),[l,d]=k.useState(!1),h=k.useContext(fd),p=Da().get_current_firebase_user(),g=On(),{submitFeedback:v}=WT();if(k.useEffect(()=>{if(l){const x=setTimeout(()=>d(!1),wP);return()=>clearTimeout(x)}},[l]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function E(x){x.preventDefault(),!(!n.trim()||!h.username||!p)&&(v.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:i,currentPath:g.pathname}),r(""),o("bug"),e(!1),d(!0))}return u.jsxs(u.Fragment,{children:[l&&u.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[u.jsx("span",{children:""}),u.jsx("span",{children:"Feedback submitted!"})]}),u.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:ue.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:x=>{x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),u.jsx(ls,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:u.jsxs("form",{onSubmit:E,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(x=>{const S=SP[x],C=i===x;return u.jsxs("button",{type:"button",onClick:()=>{S.label,o(x)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${S.color}`,borderRadius:"0.5rem",background:C?S.bgColor:"transparent",color:C?S.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:C?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:C?1:.5,boxShadow:C?`0 0 12px ${S.bgColor}`:"none",position:"relative"},children:[S.label,C&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},x)})}),u.jsx(Y0,{value:n,onChange:x=>r(x.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),u.jsxs(Ma,{children:[u.jsx(Fe,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),u.jsx(Fe,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function Vr({children:t,labelStyle:e,...n}){return u.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[u.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:ue.primary},...n}),t]})}function J0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[i,o]=k.useState(r);return u.jsxs("div",{style:{marginTop:"2rem"},children:[u.jsxs("button",{onClick:()=>o(!i),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[u.jsx("span",{style:{transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),i&&n]})}const CP=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},TP=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function Pf(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,i=e.filter(S=>!S.hidden),o=i.length,l=CP(o),d=TP(o),h=Math.floor(100/d),m=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",v=r==="segmented",_=S=>{const C="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return v?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:S?C:T,cursor:"pointer",fontWeight:S?600:400,fontSize:"0.95rem",color:"inherit",opacity:S?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:S?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:S?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:S?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:S?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:S?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},E=(S,C)=>u.jsxs(u.Fragment,{children:[u.jsx("span",{children:S.label}),S.checkmark&&u.jsx("span",{style:{color:ue.success,fontWeight:600},children:""}),p&&C&&u.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),x=()=>v?`
        .${m} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${m} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${m} > button,
        .${m} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${m} > button:last-child,
        .${m} > a:last-child {
          margin-right: 0;
        }
        .${m} > button::before,
        .${m} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 #242424, 1px 0 0 #242424;
        }
        .${m} > button:nth-child(1),
        .${m} > a:nth-child(1) {
          z-index: 4;
        }
        .${m} > button:nth-child(2),
        .${m} > a:nth-child(2) {
          z-index: 3;
        }
        .${m} > button:nth-child(3),
        .${m} > a:nth-child(3) {
          z-index: 2;
        }
        .${m} > button:nth-child(4),
        .${m} > a:nth-child(4) {
          z-index: 1;
        }
        .${m} > button.tab-active,
        .${m} > a.tab-active {
          z-index: 10;
        }
        .${m} > button.tab-active::before,
        .${m} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${m} > button:not(.tab-active):hover,
        .${m} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${m} > button:not(.tab-active):hover::before,
        .${m} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${m} {
            padding-left: 0;
            padding-right: 0;
          }
          .${m} > button,
          .${m} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${m} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${l}px) {
        .${m} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return u.jsxs(u.Fragment,{children:[u.jsx("style",{children:`
        ${x()}
        .${m} > button,
        .${m} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${m} > button:hover,
        .${m} > button:focus,
        .${m} > a:hover,
        .${m} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${v?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),u.jsx("div",{className:m,children:i.map(S=>{const C=n===S.id;return t.mode==="link"?u.jsx(Cn,{to:`${t.linkPrefix}/${S.id}`,onClick:()=>(`${S.label}`,void 0),style:_(C),className:C?"tab-active":"",children:E(S,C)},S.id):u.jsx("button",{onClick:()=>{`${S.label}`,t.onTabChange(S.id)},style:_(C),className:C?"tab-active":"",children:E(S,C)},S.id)})})]})}function KT({items:t}){const[e,n]=k.useState(!1),r=k.useRef(null),o=On().pathname;k.useEffect(()=>{function d(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[e]),k.useEffect(()=>{function d(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[e]);const l=t.filter(d=>d.hidden?!1:d.to?d.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):d.to==="/account"||d.to==="/"?o!==d.to:!o.startsWith(d.to):!0);return u.jsxs("div",{ref:r,style:{position:"relative"},children:[u.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&u.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:l.map((d,h)=>{if(d.divider)return u.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const m=u.jsxs(u.Fragment,{children:[d.icon&&u.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:d.icon}),u.jsx("span",{children:d.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return d.to?u.jsx(Cn,{to:d.to,style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",onClick:()=>{`${d.label}`,n(!1)},children:m},h):u.jsx("button",{onClick:()=>{`${d.label}`,d.onClick?.(),n(!1)},style:p,onMouseEnter:v=>Object.assign(v.currentTarget.style,g),onMouseLeave:v=>v.currentTarget.style.background="transparent",children:m},h)})})]})}function AP({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Ze(),i=On(),l=[...i.pathname==="/budget"||i.pathname.startsWith("/budget/")&&!i.pathname.startsWith("/budget/settings")&&!i.pathname.startsWith("/budget/admin")&&!i.pathname.startsWith("/budget/analytics")&&!i.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return u.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[u.jsx("div",{style:{flex:"0 0 auto"},children:e?u.jsx(Cn,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):u.jsx(Cn,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:u.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),u.jsx("div",{style:{flex:"0 0 auto"},children:n?u.jsx("div",{style:{width:"1.5rem"}}):u.jsx(KT,{items:l})})]})}function YT({children:t,style:e}){return u.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function Hu({message:t,linkText:e,linkTo:n}){return u.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${ue.warning} 12%, transparent)`,border:`2px solid ${ue.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsx("p",{style:{margin:0,fontWeight:500,color:ue.warning,fontSize:"0.95rem"},children:t}),u.jsxs(Cn,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:ue.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}const jP={success:{bgColor:"rgba(46, 213, 115, 0.95)",color:"white",icon:""},error:{bgColor:"rgba(255, 71, 87, 0.95)",color:"white",icon:""},warning:{bgColor:"rgba(255, 165, 2, 0.95)",color:"white",icon:""},info:{bgColor:"rgba(30, 144, 255, 0.95)",color:"white",icon:""}};function RP({item:t,onDismiss:e}){const[n,r]=k.useState(!1);if(k.useEffect(()=>{if(t){if(r(!0),t.autoDismissMs&&t.autoDismissMs>0){const o=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),200)},t.autoDismissMs);return()=>clearTimeout(o)}}else r(!1)},[t,e]),!t||!n)return null;const i=jP[t.type];return u.jsxs("div",{style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",left:"1.5rem",maxWidth:"600px",margin:"0 auto",background:i.bgColor,color:i.color,padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:n?"fadeInUp 0.2s ease-out":"fadeOut 0.2s ease-out",cursor:"pointer"},onClick:()=>{r(!1),setTimeout(()=>e(t.id),200)},children:[u.jsx("span",{children:i.icon}),u.jsx("span",{style:{flex:1},children:t.message}),u.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:""})]})}class DP{items=[];listeners=new Set;nextId=1;add(e){const n=`banner-${this.nextId++}`,r={...e,id:n};return this.items.push(r),this.notify(),n}remove(e){this.items=this.items.filter(n=>n.id!==e),this.notify()}getCurrent(){return this.items[0]||null}subscribe(e){return this.listeners.add(e),e(this.getCurrent()),()=>{this.listeners.delete(e)}}notify(){const e=this.getCurrent();this.listeners.forEach(n=>n(e))}}const qr=new DP;function IP(t,e){const n={};Object.keys(e).forEach(l=>{n[l]=0});const r=Ve.getQueryData(ke.budget(t));if(!r)return n;const i=r.budget.month_map||{},o=Object.keys(i).sort();for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),m=ke.month(t,d,h),p=Ve.getQueryData(m);if(!p?.month)continue;const g=p.month;for(const v of g.account_balances||[])v.account_id&&!nt(v.account_id)&&n[v.account_id]===0&&(n[v.account_id]=v.start_balance??0)}for(const l of o){const d=parseInt(l.substring(0,4),10),h=parseInt(l.substring(4,6),10),m=ke.month(t,d,h),p=Ve.getQueryData(m);if(!p?.month)continue;const g=p.month;for(const v of g.income||[])v.account_id&&!nt(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount);for(const v of g.expenses||[])v.account_id&&!nt(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount);for(const v of g.transfers||[])v.to_account_id&&!nt(v.to_account_id)&&n[v.to_account_id]!==void 0&&(n[v.to_account_id]+=v.amount),v.from_account_id&&!nt(v.from_account_id)&&n[v.from_account_id]!==void 0&&(n[v.from_account_id]-=v.amount);for(const v of g.adjustments||[])v.account_id&&!nt(v.account_id)&&n[v.account_id]!==void 0&&(n[v.account_id]+=v.amount)}for(const l of Object.keys(n))n[l]=Pe(n[l]);return n}function XT(t){const e=Ve.getQueryData(ke.budget(t));if(!e){console.warn("[recalculateBudgetAccountBalancesFromCache] Budget not in cache");return}const n=IP(t,e.accounts),r={};for(const[o,l]of Object.entries(e.accounts))r[o]={...l,balance:n[o]??l.balance};const i=H0(r,e.categories,e.accountGroups);Ve.setQueryData(ke.budget(t),{...e,accounts:r,budget:{...e.budget,accounts:r,total_available:i}})}const kP=300*1e3;function bn(){const{removeChange:t,getChanges:e,clearChanges:n,hasChanges:r,setIsSaving:i,setLastSaveTime:o,setSaveError:l}=mc(),d=k.useRef(null),h=k.useRef(!1),m=k.useCallback(async(E,x,S,C)=>{const T=ke.month(E,x,S),A=Ve.getQueryData(T);if(!A?.month)throw new Error(`Month ${x}/${S} not found in cache`);await ET({budgetId:E,month:A.month,description:`${C}: ${x}/${S}`,cascadeRecalculation:!1})},[]),p=k.useCallback(async(E,x)=>{const S=ke.budget(E),C=Ve.getQueryData(S);if(!C)throw new Error(`Budget ${E} not found in cache`);await vm({budgetId:E,updates:{name:C.budget.name,user_ids:C.budget.user_ids,accepted_user_ids:C.budget.accepted_user_ids,owner_id:C.budget.owner_id,owner_email:C.budget.owner_email,accounts:C.budget.accounts,account_groups:C.budget.account_groups,categories:C.budget.categories,category_groups:C.budget.category_groups,total_available:C.budget.total_available,is_needs_recalculation:C.budget.is_needs_recalculation,month_map:C.budget.month_map},description:`${x}: budget`})},[]),g=k.useCallback(async(E,x)=>{const S=ke.payees(E),C=Ve.getQueryData(S);if(!C)throw new Error(`Payees for budget ${E} not found in cache`);await qn("payees",E,{budget_id:E,payees:C,updated_at:new Date().toISOString()},`${x}: payees`)},[]),v=k.useCallback(async(E="periodic save")=>{if(h.current||!r())return;h.current=!0,i(!0),l(null);const x=e(),S=[];try{const C=[],T=new Set,A=new Set;for(const L of x)L.type==="month"&&L.year!==void 0&&L.month!==void 0?C.push({budgetId:L.budgetId,year:L.year,month:L.month}):L.type==="budget"?T.add(L.budgetId):L.type==="payees"&&A.add(L.budgetId);for(const{budgetId:L,year:F,month:H}of C){const O=ke.month(L,F,H),I=Ve.getQueryData(O);if(I?.month){const N=wm(I.month);Ve.setQueryData(O,{month:N})}}for(const{budgetId:L,year:F,month:H}of C)try{await m(L,F,H,E)}catch(O){const I=`Failed to save month ${F}/${H}: ${O instanceof Error?O.message:String(O)}`;S.push(I),console.error("[useBackgroundSave]",I,O)}for(const L of T)try{XT(L)}catch(F){console.warn("[useBackgroundSave] Failed to recalculate budget account balances from cache:",F)}for(const L of T)try{await p(L,E)}catch(F){const H=`Failed to save budget: ${F instanceof Error?F.message:String(F)}`;S.push(H),console.error("[useBackgroundSave]",H,F)}for(const L of A)try{await g(L,E)}catch(F){const H=`Failed to save payees: ${F instanceof Error?F.message:String(F)}`;S.push(H),console.error("[useBackgroundSave]",H,F)}if(S.length===0)n(),o(Date.now()),qr.add({type:"success",message:"All changes saved successfully",autoDismissMs:2e3});else throw new Error(S.join("; "))}catch(C){const T=C instanceof Error?C.message:String(C);throw l(T),qr.add({type:"error",message:`Failed to save changes: ${T}`,autoDismissMs:0}),C}finally{h.current=!1,i(!1)}},[r,e,n,m,p,g,i,o,l]),_=k.useCallback(async(E,x,S,C)=>{try{i(!0),l(null),x==="month"&&S!==void 0&&C!==void 0?(await m(E,S,C,"immediate save (current viewing document)"),t({type:"month",budgetId:E,year:S,month:C}),o(Date.now())):x==="budget"&&(await p(E,"immediate save (current viewing document)"),t({type:"budget",budgetId:E}),o(Date.now()))}catch(T){const A=T instanceof Error?T.message:String(T);throw l(A),qr.add({type:"error",message:`Failed to save current document: ${A}`,autoDismissMs:0}),T}finally{i(!1)}},[m,p,t,i,o,l]);return k.useEffect(()=>(d.current&&clearInterval(d.current),d.current=setInterval(()=>{r()&&v("periodic save (5-minute timer)").catch(x=>{console.error("[useBackgroundSave] Periodic save failed:",x)})},kP),()=>{d.current&&clearInterval(d.current)}),[r,v]),{saveAllChanges:v,saveCurrentDocument:_}}async function OP(t,e,n,r){const i=Ve.getQueryData(ke.budget(t));if(!i){console.warn("[mutationHelpers] Budget not in cache, skipping local recalculation");return}const o=i.budget.month_map,l=vt(e,n),d=[];for(const[h]of Object.entries(o))if(h>=l){const m=parseInt(h.substring(0,4),10),p=parseInt(h.substring(4,6),10);d.push({year:m,month:p})}d.sort((h,m)=>h.year!==m.year?h.year-m.year:h.month-m.month);for(const{year:h,month:m}of d)try{await p3(t,h,m,Ve),r&&r({type:"month",budgetId:t,year:h,month:m})}catch(p){console.warn(`[mutationHelpers] Failed to recalculate month ${h}/${m} locally:`,p)}}function pr(){const{trackChange:t}=mc();return{updateMonthCacheAndTrack:(r,i,o,l)=>{Ve.setQueryData(ke.month(r,i,o),{month:l}),t({type:"month",budgetId:r,year:i,month:o})},recalculateMonthAndCascade:async(r,i,o)=>{const l=ke.month(r,i,o),d=Ve.getQueryData(l);if(d?.month){const h=wm(d.month);Ve.setQueryData(l,{month:h})}await OP(r,i,o,t);try{XT(r),t({type:"budget",budgetId:r})}catch(h){console.warn("[mutationHelpers] Failed to recalculate budget account balances from cache:",h),t({type:"budget",budgetId:r})}},trackChange:t}}function MP(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=bn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{finalizeAllocations:async o=>{const{budgetId:l,year:d,month:h,allocations:m,onProgress:p}=o;p?.({phase:"saving",message:"Saving allocations..."});const g=await Gr(l,d,h);if(!g)throw new Error(`Month not found: ${d}/${h}`);const v=g.category_balances?.map(C=>C.category_id)??[],_=v.length>0?v:Object.keys(m),E=_.length>0?j6(g,_,m):g.category_balances,x={...g,category_balances:E,are_allocations_finalized:!0,updated_at:new Date().toISOString()};n(l,d,h,x),p?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(C){console.warn("[useFinalizeAllocations] Failed to recalculate month and cascade:",C)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(C){console.warn("[useFinalizeAllocations] Failed to save current document immediately:",C)}return p?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:x}},isPending:!1,isError:!1,error:null}}function ZT(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=bn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{deleteAllocations:async o=>{const{budgetId:l,year:d,month:h,onProgress:m}=o;m?.({phase:"saving",message:"Deleting allocations..."});const p=await Gr(l,d,h);if(!p)throw new Error(`Month not found: ${d}/${h}`);const g=p.category_balances.map(E=>({...E,allocated:0,end_balance:E.start_balance-E.spent})),v={...p,category_balances:g,are_allocations_finalized:!1,updated_at:new Date().toISOString()};n(l,d,h,v),m?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(l,d,h)}catch(E){console.warn("[useDeleteAllocations] Failed to recalculate month and cascade:",E)}if(t.type==="month"&&t.year===d&&t.month===h)try{await e(l,"month",d,h)}catch(E){console.warn("[useDeleteAllocations] Failed to save current document immediately:",E)}return m?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:v}},isPending:!1,isError:!1,error:null}}async function Am(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const i=[...n,r].sort((o,l)=>o.toLowerCase().localeCompare(l.toLowerCase()));return await qn("payees",t,{budget_id:t,payees:i,updated_at:new Date().toISOString()},`adding new payee "${r}" to autocomplete list`),i}function NP(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function PP(){const t=Ft(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=bn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=pr(),l=Hn({onMutate:async h=>{const{budgetId:m,year:p,month:g}=h,v=ke.month(m,p,g);await t.cancelQueries({queryKey:v});const _=t.getQueryData(v),E=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=NP(h,E);if(_?.month){const C={..._.month,income:[..._.month.income||[],x],updated_at:new Date().toISOString()};r(m,p,g,C)}try{await i(m,p,g)}catch(C){console.warn("[useAddIncome] Failed to recalculate month and cascade:",C)}if(h.payee?.trim()){const C=t.getQueryData(ke.payees(m))||[],T=await Am(m,h.payee,C);T&&(t.setQueryData(ke.payees(m),T),o({type:"payees",budgetId:m}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(m,"month",p,g)}catch(C){console.warn("[useAddIncome] Failed to save current document immediately:",C)}return{previousData:_,incomeId:E,newIncome:x}},mutationFn:async h=>{const{budgetId:m,year:p,month:g}=h,v=ke.month(m,p,g),_=t.getQueryData(v);if(!_?.month)throw new Error("No month data in cache after optimistic update");const E=_.month,x=E.income?.[E.income.length-1];if(!x)throw new Error("Could not find new income in updated month");return{updatedMonth:E,newIncome:x}},onError:(h,m,p)=>{if(p?.previousData){const{budgetId:g,year:v,month:_}=m;t.setQueryData(ke.month(g,v,_),p.previousData)}}});return{addIncome:async(h,m,p,g,v,_,E,x)=>l.mutateAsync({budgetId:h,year:m,month:p,amount:g,accountId:v,date:_,payee:E,description:x}),isPending:l.isPending,isError:l.isError,error:l.error}}function zP(t,e,n,r,i,o){if(!t)return!0;const l=t.payee||void 0,d=i?.trim()||void 0,h=t.description||void 0,m=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||d!==l||m!==h}function BP(){const t=Ft(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=bn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=pr();return{updateIncome:async(d,h,m,p,g,v,_,E,x)=>{const S=await Gr(d,h,m);if(!S)throw new Error(`Month not found: ${h}/${m}`);const C=(S.income||[]).find(H=>H.id===p);if(!zP(C,g,v,_,E,x))return{updatedMonth:S,noOp:!0};const T={id:p,amount:g,account_id:v,date:_,created_at:(S.income||[]).find(H=>H.id===p)?.created_at||new Date().toISOString()};E?.trim()&&(T.payee=E.trim()),x&&(T.description=x);const A=(S.income||[]).map(H=>H.id===p?T:H),L={...S,income:A,updated_at:new Date().toISOString()};r(d,h,m,L);try{await i(d,h,m)}catch(H){console.warn("[useUpdateIncome] Failed to recalculate month and cascade:",H)}if(E?.trim()){const H=t.getQueryData(ke.payees(d))||[],O=await Am(d,E,H);O&&(t.setQueryData(ke.payees(d),O),o({type:"payees",budgetId:d}))}if(e.type==="month"&&e.year===h&&e.month===m)try{await n(d,"month",h,m)}catch(H){console.warn("[useUpdateIncome] Failed to save current document immediately:",H)}return{updatedMonth:L}},isPending:!1,isError:!1,error:null}}function LP(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=bn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{deleteIncome:async(o,l,d,h)=>{const m=await Gr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.income||[]).filter(_=>_.id!==h),g={...m,income:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteIncome] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteIncome] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function UP(t,e){const n={id:e,amount:t.amount,category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function FP(){const t=Ft(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=bn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i,trackChange:o}=pr(),l=Hn({onMutate:async h=>{const{budgetId:m,year:p,month:g}=h,v=ke.month(m,p,g);await t.cancelQueries({queryKey:v});const _=t.getQueryData(v),E=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=UP(h,E);if(_?.month){const C={..._.month,expenses:[..._.month.expenses||[],x],updated_at:new Date().toISOString()};r(m,p,g,C)}try{await i(m,p,g)}catch(C){console.warn("[useAddExpense] Failed to recalculate month and cascade:",C)}if(h.payee?.trim()){const C=t.getQueryData(ke.payees(m))||[],T=await Am(m,h.payee,C);T&&(t.setQueryData(ke.payees(m),T),o({type:"payees",budgetId:m}))}if(e.type==="month"&&e.year===p&&e.month===g)try{await n(m,"month",p,g)}catch(C){console.warn("[useAddExpense] Failed to save current document immediately:",C)}return{previousData:_,expenseId:E,newExpense:x}},mutationFn:async h=>{const{budgetId:m,year:p,month:g}=h,v=ke.month(m,p,g),_=t.getQueryData(v);if(!_?.month)throw new Error("No month data in cache after optimistic update");const E=_.month,x=E.expenses?.[E.expenses.length-1];if(!x)throw new Error("Could not find new expense in updated month");return{updatedMonth:E,newExpense:x}},onError:(h,m,p)=>{if(p?.previousData){const{budgetId:g,year:v,month:_}=m;t.setQueryData(ke.month(g,v,_),p.previousData)}}});return{addExpense:async(h,m,p,g,v,_,E,x,S,C)=>l.mutateAsync({budgetId:h,year:m,month:p,amount:g,categoryId:v,accountId:_,date:E,payee:x,description:S,cleared:C}),isPending:l.isPending,isError:l.isError,error:l.error}}function VP(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,m=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||i!==t.date||m!==h||g!==p||d!==t.cleared}function $P(){const t=Ft(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=bn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=pr();return{updateExpense:async(l,d,h,m,p,g,v,_,E,x,S)=>{const C=await Gr(l,d,h);if(!C)throw new Error(`Month not found: ${d}/${h}`);const T=(C.expenses||[]).find(O=>O.id===m);if(!VP(T,p,g,v,_,E,x,S))return{updatedMonth:C,noOp:!0};const A={id:m,amount:p,category_id:g,account_id:v,date:_,created_at:C.expenses?.find(O=>O.id===m)?.created_at||new Date().toISOString()};E?.trim()&&(A.payee=E.trim()),x&&(A.description=x),S!==void 0&&(A.cleared=S);const L=(C.expenses||[]).map(O=>O.id===m?A:O),F={...C,expenses:L,updated_at:new Date().toISOString()};r(l,d,h,F);try{await i(l,d,h)}catch(O){console.warn("[useUpdateExpense] Failed to recalculate month and cascade:",O)}if(E?.trim()){const O=t.getQueryData(ke.payees(l))||[],I=await Am(l,E,O);I&&t.setQueryData(ke.payees(l),I)}if(e.type==="month"&&e.year===d&&e.month===h)try{await n(l,"month",d,h)}catch(O){console.warn("[useUpdateExpense] Failed to save current document immediately:",O)}return{updatedMonth:F}},isPending:!1,isError:!1,error:null}}function qP(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=bn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{deleteExpense:async(o,l,d,h)=>{const m=await Gr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.expenses||[]).filter(_=>_.id!==h),g={...m,expenses:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteExpense] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteExpense] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function HP(t,e){const n={id:e,amount:t.amount,from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function GP(){const t=Ft(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=bn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=pr(),o=Hn({onMutate:async d=>{const{budgetId:h,year:m,month:p}=d,g=ke.month(h,m,p);await t.cancelQueries({queryKey:g});const v=t.getQueryData(g),_=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,E=HP(d,_);if(v?.month){const S={...v.month,transfers:[...v.month.transfers||[],E],updated_at:new Date().toISOString()};r(h,m,p,S)}try{await i(h,m,p)}catch(S){console.warn("[useAddTransfer] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===m&&e.month===p)try{await n(h,"month",m,p)}catch(S){console.warn("[useAddTransfer] Failed to save current document immediately:",S)}return{previousData:v,transferId:_,newTransfer:E}},mutationFn:async d=>{const{budgetId:h,year:m,month:p}=d,g=ke.month(h,m,p),v=t.getQueryData(g);if(!v?.month)throw new Error("No month data in cache after optimistic update");const _=v.month,E=_.transfers?.[_.transfers.length-1];if(!E)throw new Error("Could not find new transfer in updated month");return{updatedMonth:_,newTransfer:E}},onError:(d,h,m)=>{if(m?.previousData){const{budgetId:p,year:g,month:v}=h;t.setQueryData(ke.month(p,g,v),m.previousData)}}});return{addTransfer:async(d,h,m,p,g,v,_,E,x,S,C)=>o.mutateAsync({budgetId:d,year:h,month:m,amount:p,fromAccountId:g,toAccountId:v,fromCategoryId:_,toCategoryId:E,date:x,description:S,cleared:C}),isPending:o.isPending,isError:o.isError,error:o.error}}function QP(t,e,n,r,i,o,l,d,h){if(!t)return!0;const m=t.description||void 0,p=d||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||i!==t.from_category_id||o!==t.to_category_id||l!==t.date||p!==m||h!==t.cleared}function WP(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=bn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{updateTransfer:async(o,l,d,h,m,p,g,v,_,E,x,S)=>{const C=await Gr(o,l,d);if(!C)throw new Error(`Month not found: ${l}/${d}`);const T=(C.transfers||[]).find(O=>O.id===h);if(!QP(T,m,p,g,v,_,E,x,S))return{updatedMonth:C,noOp:!0};const A={id:h,amount:m,from_account_id:p,to_account_id:g,from_category_id:v,to_category_id:_,date:E,created_at:C.transfers?.find(O=>O.id===h)?.created_at||new Date().toISOString()};x&&(A.description=x),S!==void 0&&(A.cleared=S);const L=(C.transfers||[]).map(O=>O.id===h?A:O),F={...C,transfers:L,updated_at:new Date().toISOString()};n(o,l,d,F);try{await r(o,l,d)}catch(O){console.warn("[useUpdateTransfer] Failed to recalculate month and cascade:",O)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(O){console.warn("[useUpdateTransfer] Failed to save current document immediately:",O)}return{updatedMonth:F}},isPending:!1,isError:!1,error:null}}function KP(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=bn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{deleteTransfer:async(o,l,d,h)=>{const m=await Gr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.transfers||[]).filter(_=>_.id!==h),g={...m,transfers:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteTransfer] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteTransfer] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function YP(t,e){const n={id:e,amount:t.amount,account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function XP(){const t=Ft(),{currentViewingDocument:e}=Ze(),{saveCurrentDocument:n}=bn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:i}=pr(),o=Hn({onMutate:async d=>{const{budgetId:h,year:m,month:p}=d,g=ke.month(h,m,p);await t.cancelQueries({queryKey:g});const v=t.getQueryData(g),_=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,E=YP(d,_);if(v?.month){const S={...v.month,adjustments:[...v.month.adjustments||[],E],updated_at:new Date().toISOString()};r(h,m,p,S)}try{await i(h,m,p)}catch(S){console.warn("[useAddAdjustment] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===m&&e.month===p)try{await n(h,"month",m,p)}catch(S){console.warn("[useAddAdjustment] Failed to save current document immediately:",S)}return{previousData:v,adjustmentId:_,newAdjustment:E}},mutationFn:async d=>{const{budgetId:h,year:m,month:p}=d,g=ke.month(h,m,p),v=t.getQueryData(g);if(!v?.month)throw new Error("No month data in cache after optimistic update");const _=v.month,E=_.adjustments?.[_.adjustments.length-1];if(!E)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:_,newAdjustment:E}},onError:(d,h,m)=>{if(m?.previousData){const{budgetId:p,year:g,month:v}=h;t.setQueryData(ke.month(p,g,v),m.previousData)}}});return{addAdjustment:async(d,h,m,p,g,v,_,E,x,S)=>o.mutateAsync({budgetId:d,year:h,month:m,amount:p,accountId:g,categoryId:v,date:_,payee:E,description:x,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function ZP(t,e,n,r,i,o,l,d){if(!t)return!0;const h=t.payee||void 0,m=o?.trim()||void 0,p=t.description||void 0,g=l||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||i!==t.date||m!==h||g!==p||d!==t.cleared}function JP(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=bn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{updateAdjustment:async(o,l,d,h,m,p,g,v,_,E,x)=>{const S=await Gr(o,l,d);if(!S)throw new Error(`Month not found: ${l}/${d}`);const C=(S.adjustments||[]).find(H=>H.id===h);if(!ZP(C,m,p,g,v,_,E,x))return{updatedMonth:S,noOp:!0};const T={id:h,amount:m,account_id:p,category_id:g,date:v,created_at:S.adjustments?.find(H=>H.id===h)?.created_at||new Date().toISOString()};_?.trim()&&(T.payee=_.trim()),E&&(T.description=E),x!==void 0&&(T.cleared=x);const A=(S.adjustments||[]).map(H=>H.id===h?T:H),L={...S,adjustments:A,updated_at:new Date().toISOString()};n(o,l,d,L);try{await r(o,l,d)}catch(H){console.warn("[useUpdateAdjustment] Failed to recalculate month and cascade:",H)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(H){console.warn("[useUpdateAdjustment] Failed to save current document immediately:",H)}return{updatedMonth:L}},isPending:!1,isError:!1,error:null}}function ez(){const{currentViewingDocument:t}=Ze(),{saveCurrentDocument:e}=bn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=pr();return{deleteAdjustment:async(o,l,d,h)=>{const m=await Gr(o,l,d);if(!m)throw new Error(`Month not found: ${l}/${d}`);const p=(m.adjustments||[]).filter(_=>_.id!==h),g={...m,adjustments:p,updated_at:new Date().toISOString()};n(o,l,d,g);try{await r(o,l,d)}catch(_){console.warn("[useDeleteAdjustment] Failed to recalculate month and cascade:",_)}if(t.type==="month"&&t.year===l&&t.month===d)try{await e(o,"month",l,d)}catch(_){console.warn("[useDeleteAdjustment] Failed to save current document immediately:",_)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}const tz={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",currentViewingDocument:{type:null},setCurrentViewingDocument:()=>{},setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,initialDataLoadComplete:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},JT=k.createContext(tz);function nz({children:t}){const n=Da().get_current_firebase_user(),[r,i]=k.useState(null),[o,l]=k.useState(new Date().getFullYear()),[d,h]=k.useState(new Date().getMonth()+1),[m,p]=k.useState("categories"),[g,v]=k.useState("categories"),[_,E]=k.useState("budget"),[x,S]=k.useState("Budget"),C=k.useCallback(fe=>{S(Ee=>Ee===fe?Ee:fe)},[]),[T,A]=k.useState({type:null}),[L,F]=k.useState(!1),[H,O]=k.useState(!1),I=s6(n?.uid||null,n?.email||null),N=I.data&&I.data.budget_ids.length===0,U=a6(n?.uid||null,I.data||null,{enabled:!!n?.uid&&!!I.data&&N}),$=m3(r,{enabled:!!r&&L}),[j,M]=k.useState(!1);k.useEffect(()=>{if(!$.data){M(!1);return}const{budget:fe,payees:Ee,months:me}=$.data,Ce=Date.now();Ve.setQueryData(ke.budget(r),fe,{updatedAt:Ce}),Ve.setQueryData(ke.payees(r),Ee,{updatedAt:Ce});for(const he of me)Ve.setQueryData(ke.month(r,he.year,he.month),{month:he},{updatedAt:Ce});M(!0)},[$.data,r]),k.useEffect(()=>{r||M(!1)},[r]);const R=I.data?.permission_flags?.is_admin===!0,K=I.data?.permission_flags?.is_test===!0,W=U.data?.pendingInvites||[],q=U.data?.budgets||[],Z=W.length>0;k.useEffect(()=>{if(!n||L||I.isLoading)return;const fe=I.data;if(!(!fe&&!I.isError))if(fe&&fe.budget_ids.length>0)i(fe.budget_ids[0]),O(!1),F(!0);else{if(U.isLoading)return;const Ee=U.data;O(!(Ee?.pendingInvites&&Ee.pendingInvites.length>0)),F(!0)}},[n,L,I.data,I.isLoading,I.isError,U.data,U.isLoading]);const X=k.useCallback(()=>{d===1?(l(fe=>fe-1),h(12)):h(fe=>fe-1)},[d]),ne=k.useCallback(()=>{d===12?(l(fe=>fe+1),h(1)):h(fe=>fe+1)},[d]),B=k.useCallback(async fe=>{(fe?.force||!U.data)&&await U.refetch()},[U]),G=k.useCallback(fe=>{i(fe),O(!1)},[]),te=k.useCallback(async fe=>{if(!n)return null;try{const Ee=await E6(fe,n.uid);return Ee&&Ee.isInvited&&!Ee.hasAccepted?{budgetId:fe,budgetName:Ee.budgetName,ownerEmail:Ee.ownerEmail}:null}catch(Ee){return console.error("[BudgetContext] Error checking budget invite:",Ee),null}},[n]),ie=k.useCallback(()=>{Ve.clear()},[]),ae={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:o,currentMonthNumber:d,lastActiveTab:m,lastSettingsTab:g,lastAdminTab:_,currentViewingDocument:T,setCurrentViewingDocument:A,setSelectedBudgetId:i,setCurrentYear:l,setCurrentMonthNumber:h,setLastActiveTab:p,setLastSettingsTab:v,setLastAdminTab:E,pageTitle:x,setPageTitle:C,isInitialized:L,needsFirstBudget:H,initialDataLoadComplete:j,goToPreviousMonth:X,goToNextMonth:ne,pendingInvites:W,hasPendingInvites:Z,accessibleBudgets:q,isAdmin:R,isTest:K,loadAccessibleBudgets:B,switchToBudget:G,checkBudgetInvite:te,clearCache:ie};return u.jsx(JT.Provider,{value:ae,children:t})}function Ze(){const t=k.useContext(JT);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const rz=function(){},sz={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:rz},fd=k.createContext(sz);function $1({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:i,editName:o,isRenaming:l,onAccept:d,onSwitch:h,onStartEdit:m,onCancelEdit:p,onEditNameChange:g,onSaveEdit:v}){const _=e&&t.isOwner;return u.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:i?u.jsxs("form",{onSubmit:v,children:[u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:u.jsx("input",{type:"text",value:o,onChange:E=>g(E.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[u.jsx("button",{type:"submit",disabled:l||!o.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:l||!o.trim()?.7:1,fontSize:"0.8rem"},children:l?"Saving...":"Save"}),u.jsx("button",{type:"button",onClick:p,disabled:l,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:l?"not-allowed":"pointer",fontWeight:500,opacity:l?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[u.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[u.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),_&&u.jsx("button",{onClick:m,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),u.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?u.jsx("button",{onClick:d,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:u.jsx("button",{onClick:h,disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}const zf={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function eA({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in zf?n:"bug",i=zf[r];return u.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:i.bgColor,color:i.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:i.label})}function iz({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:i,onDragLeave:o,onDragEnd:l,onDrop:d,onToggleDone:h,onTypeClick:m}){return u.jsxs("div",{onDragOver:p=>{p.stopPropagation(),i(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),d(p)},style:{position:"relative"},children:[u.jsx("div",{style:{...jT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),u.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:l,style:{...ud,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{...AT},children:""}),u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ue.primary,flexShrink:0}}),u.jsx(eA,{type:t.feedback_type,onClick:m})]}),u.jsxs("div",{style:{marginLeft:"3.25rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",Ny(t.created_at)]})]})]})]})}function az({item:t,onToggleDone:e,onTypeClick:n}){return u.jsxs("div",{style:{...ud,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ue.primary,flexShrink:0}}),u.jsx(eA,{type:t.feedback_type,onClick:n})]}),u.jsxs("div",{style:{marginLeft:"2rem"},children:[u.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",Ny(t.created_at)]}),t.completed_at&&u.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:ue.success},children:[" Completed: ",Ny(t.completed_at)]})]})]})}function Vn({noMargin:t}={}){return u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function tA(){const{state:t,closeModal:e}=S3();if(!t.isOpen)return null;const n=t.isComplete;return u.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:u.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:r=>r.stopPropagation(),children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&u.jsx(Vn,{noMargin:!0}),t.migrationName]}),n&&u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),u.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"#ef4444":t.isComplete?"#22c55e":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?u.jsx("div",{style:{background:t.error?"#ef4444":t.isComplete?"#22c55e":"#646cff",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):u.jsx("div",{style:{background:t.error?"#ef4444":"#646cff",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&u.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&u.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&u.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"#ef4444"},children:t.error}),t.isComplete&&u.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"rgba(239, 68, 68, 0.2)":"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&u.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),u.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function bo({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:i=!1,onDownloadBackup:o,isDownloading:l=!1}){const[d,h]=k.useState(!1),m=k.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=k.useCallback(()=>{n(d?"downloaded":"already-have")},[d,n]),g=k.useCallback(()=>{n("cancelled"),e()},[n,e]);return u.jsxs(ls,{isOpen:t,onClose:g,title:" Backup Recommended",children:[u.jsx("div",{style:{background:i?"color-mix(in srgb, #ef4444 15%, transparent)":"color-mix(in srgb, #f59e0b 15%, transparent)",border:`1px solid ${i?"color-mix(in srgb, #ef4444 40%, transparent)":"color-mix(in srgb, #f59e0b 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:i?"#fca5a5":"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:i?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",u.jsx("strong",{children:r})]}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx(Fe,{variant:"secondary",onClick:m,disabled:l,actionName:"Download Backup Before Migration",style:{width:"100%"},children:l?u.jsxs(u.Fragment,{children:[u.jsx(Vn,{noMargin:!0})," Downloading Backup..."]}):d?" Backup Downloaded":" Download Backup Now"})}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Fe,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),u.jsx(Fe,{variant:i?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:l,children:d?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function vo({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,i]=k.useState(!1),[o,l]=k.useState(!1),[d,h]=k.useState(null),m=k.useCallback(_=>{h(()=>_),i(!0)},[]),p=k.useCallback(_=>{_!=="cancelled"&&d&&d(),h(null),i(!1)},[d]),g=k.useCallback(()=>{h(null),i(!1)},[]),v=k.useCallback(async()=>{if(n){l(!0);try{await n()}finally{l(!1)}}},[n]);return{promptBeforeAction:m,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?v:void 0,isDownloading:o}}}const oz={onetime:{borderColor:"color-mix(in srgb, #a855f7 30%, transparent)",iconBg:"color-mix(in srgb, #a855f7 15%, transparent)",headerBg:"color-mix(in srgb, #a855f7 8%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, #3b82f6 30%, transparent)",iconBg:"color-mix(in srgb, #3b82f6 15%, transparent)",headerBg:"color-mix(in srgb, #3b82f6 8%, transparent)"},utility:{borderColor:"color-mix(in srgb, #22c55e 30%, transparent)",iconBg:"color-mix(in srgb, #22c55e 15%, transparent)",headerBg:"color-mix(in srgb, #22c55e 8%, transparent)"}};function e_({title:t,icon:e,description:n,type:r,children:i,onValidateAll:o,isValidating:l=!1,isAnyRunning:d=!1}){const h=oz[r],m=l||d,p=()=>{o&&!m&&o()};return u.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[u.jsxs("div",{style:{background:h.headerBg,padding:"1.25rem 1.5rem",borderBottom:`2px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.875rem",flex:1},children:[u.jsx("span",{style:{fontSize:"1.75rem",background:h.iconBg,padding:"0.625rem",borderRadius:"10px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"48px",minHeight:"48px"},children:e}),u.jsxs("div",{children:[u.jsx("h3",{style:{margin:"0 0 0.375rem 0",fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em"},children:t}),u.jsx("p",{style:{margin:0,opacity:.75,fontSize:"0.9rem",lineHeight:1.4},children:n})]})]}),o&&u.jsx("button",{onClick:p,disabled:m,style:{background:"color-mix(in srgb, #3b82f6 20%, transparent)",color:"#60a5fa",border:"1px solid color-mix(in srgb, #3b82f6 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:m?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:m?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:l?u.jsxs(u.Fragment,{children:[u.jsx(Vn,{noMargin:!0})," Validating..."]}):" Validate All"})]}),u.jsx("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 1%, transparent)"},children:i})]})}const lz={unknown:{color:"#9ca3af",icon:"",text:"Unknown"},clean:{color:"#22c55e",icon:"",text:"Clean"},"needs-action":{color:"#f59e0b",icon:"",text:"Needs Action"},running:{color:"#60a5fa",icon:"",text:"Running"},complete:{color:"#22c55e",icon:"",text:"Complete"},error:{color:"#ef4444",icon:"",text:"Error"}};function t_({name:t,description:e,status:n,statusText:r,onCheck:i,isChecking:o,onRun:l,isRunning:d=!1,actionText:h="Run",disabled:m=!1,itemCount:p,details:g,isDestructive:v=!1}){const[_,E]=k.useState(!1),x=lz[n],S=r||x.text,C=m||d||o,T=()=>{i()},A=()=>{l&&l()},L=()=>{g&&E(!_)};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${x.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||o?u.jsx(Vn,{noMargin:!0}):x.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),u.jsxs("div",{style:{color:x.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[S,p!==void 0&&p>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${x.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:T,disabled:C,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",opacity:C?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?u.jsx(Vn,{noMargin:!0}):""}),l&&n==="needs-action"&&u.jsx("button",{onClick:A,disabled:C,style:{background:v?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:C?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:C?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:d?u.jsx(Vn,{noMargin:!0}):h}),g&&u.jsx("button",{onClick:L,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:_?"Collapse details":"Expand details",children:_?"":""})]})]}),_&&g&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function cz({name:t,description:e,onAction:n,actionText:r,actionIcon:i,isRunning:o=!1,disabled:l=!1,progress:d,error:h,isDestructive:m=!1}){const p=l||o,g=()=>{n()};return u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&u.jsx("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.25rem"},children:h})]}),d!==void 0&&o&&u.jsxs("div",{style:{width:"100px",flexShrink:0},children:[u.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:u.jsx("div",{style:{background:m?"#ef4444":"#646cff",height:"100%",width:`${d}%`,transition:"width 0.3s"}})}),u.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[d,"%"]})]}),u.jsx("button",{onClick:g,disabled:p,style:{background:m?"#ef4444":"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?u.jsxs(u.Fragment,{children:[u.jsx(Vn,{noMargin:!0})," Running..."]}):u.jsxs(u.Fragment,{children:[i&&u.jsx("span",{children:i}),r]})})]})})}function uz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n}){return u.jsx(u.Fragment,{children:u.jsx(e_,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:!1,children:null})})}const nA={unknown:{color:"#9ca3af",icon:""},clean:{color:"#22c55e",icon:""},"needs-action":{color:"#f59e0b",icon:""},running:{color:"#60a5fa",icon:""},complete:{color:"#22c55e",icon:""},error:{color:"#ef4444",icon:""}};function dz({check:t,disabled:e}){const n=nA[t.status],r=e||t.isRunning||t.isChecking;return u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?u.jsx(Vn,{noMargin:!0}):n.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&u.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),u.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?u.jsx(Vn,{noMargin:!0}):""}),t.canFix&&t.onFix&&u.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"#646cff",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?u.jsx(Vn,{noMargin:!0}):"Fix"})]})]})}function hz({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:i,totalIssues:o,isScanning:l,isRunning:d,disabled:h,onRunOrphaned:m,onRunExpense:p,onRunTransfers:g}){const[v,_]=k.useState(!1),x=d?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?i?"needs-action":"clean":"unknown",S=nA[x],C=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(L=>L.transactionType==="income").length>0&&u.jsxs("span",{children:["Income: ",t.status.violations.filter(L=>L.transactionType==="income").length," "]}),t.status.violations.filter(L=>L.transactionType==="expense").length>0&&u.jsxs("span",{children:["Expenses: ",t.status.violations.filter(L=>L.transactionType==="expense").length," "]}),t.status.violations.filter(L=>L.transactionType==="adjustment").length>0&&u.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(L=>L.transactionType==="adjustment").length," "]}),t.status.violations.filter(L=>L.transactionType==="transfer").length>0&&u.jsxs("span",{children:["Transfers: ",t.status.violations.filter(L=>L.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:Yg(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:m,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&u.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&u.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:Yg(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:Yg(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&u.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&u.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&u.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||d||l,A=()=>{C.forEach(L=>L.onCheck())};return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${S.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:d||l?u.jsx(Vn,{noMargin:!0}):S.icon}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),u.jsxs("div",{style:{color:S.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[x==="unknown"?"Unknown":x==="clean"?"Clean":x==="running"?"Running":"Needs Action",o>0&&u.jsx("span",{style:{background:`color-mix(in srgb, ${S.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:A,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:l?u.jsx(Vn,{noMargin:!0}):""}),u.jsx("button",{onClick:()=>_(!v),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:v?"Collapse":"Expand",children:v?"":""})]})]}),v&&u.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:C.map(L=>u.jsx(dz,{check:L,disabled:h},L.id))})]})}function Yg(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function fz({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:i,isRunning:o,result:l,onCheck:d,onRun:h,disabled:m}){const p=()=>o?"running":e?l&&l.errors.length===0?"complete":l&&l.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(l&&l.errors.length===0){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return _>0?`Fixed ${_}`:"Complete"}},v=()=>{if(l){const _=l.accountsFixed+l.categoriesFixed+l.totalAvailableFixed+l.incomeValuesFixed+l.expenseValuesFixed+l.categoryBalancesFixed+l.accountBalancesFixed;return u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Cleanup complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsProcessed>0&&u.jsxs("li",{children:[l.budgetsProcessed," budget(s) updated"]}),l.accountsFixed>0&&u.jsxs("li",{children:[l.accountsFixed," account balance(s) fixed"]}),l.categoriesFixed>0&&u.jsxs("li",{children:[l.categoriesFixed," category value(s) fixed"]}),l.totalAvailableFixed>0&&u.jsxs("li",{children:[l.totalAvailableFixed," total_available value(s) fixed"]}),l.monthsProcessed>0&&u.jsxs("li",{children:[l.monthsProcessed," month(s) updated"]}),l.incomeValuesFixed>0&&u.jsxs("li",{children:[l.incomeValuesFixed," income amount(s) fixed"]}),l.expenseValuesFixed>0&&u.jsxs("li",{children:[l.expenseValuesFixed," expense amount(s) fixed"]}),l.categoryBalancesFixed>0&&u.jsxs("li",{children:[l.categoryBalancesFixed," category balance(s) fixed"]}),l.accountBalancesFixed>0&&u.jsxs("li",{children:[l.accountBalancesFixed," account balance(s) fixed"]}),_===0&&u.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((E,x)=>u.jsx("li",{children:E},x)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]})}return e?n?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#fbbf24"},children:"Precision issues found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&u.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&u.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&u.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),u.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",u.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return u.jsx(t_,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:d,isChecking:i,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:m,itemCount:n?r:void 0,details:v(),isDestructive:!0})}function mz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,precisionCleanup:d}){const h=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning,m=i.isRunning||o.isRunning||l.isRunning||d.isRunning,p=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan()])},g=vo({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),v=vo({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),_=vo({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),E=vo({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),x=r.hasViolations||i.hasItemsToFix||o.hasItemsToMigrate||l.hasPairsToConvert,S=(r.violationCount||0)+(i.totalOrphaned||0)+(o.totalToMigrate||0)+(l.totalPairs||0);return u.jsxs(u.Fragment,{children:[u.jsxs(e_,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:p,isValidating:h,isAnyRunning:m,children:[u.jsx(hz,{accountCategoryValidation:r,orphanedIdCleanup:i,expenseToAdjustment:o,adjustmentsToTransfers:l,needsAction:x,totalIssues:S,isScanning:r.isScanning||i.isScanning||o.isScanning||l.isScanning,isRunning:i.isRunning||o.isRunning||l.isRunning,disabled:t,onRunOrphaned:()=>g.promptBeforeAction(i.runMigration),onRunExpense:()=>v.promptBeforeAction(o.runMigration),onRunTransfers:()=>_.promptBeforeAction(l.runMigration)}),u.jsx(fz,{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isChecking:d.isScanning,isRunning:d.isRunning,result:d.result,onCheck:d.scan,onRun:()=>E.promptBeforeAction(d.runCleanup),disabled:t})]}),u.jsx(bo,{...g.promptProps,isDownloading:n}),u.jsx(bo,{...v.promptProps,isDownloading:n}),u.jsx(bo,{..._.promptProps,isDownloading:n}),u.jsx(bo,{...E.promptProps,isDownloading:n})]})}function pz({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:i,isUploading:o,uploadStatus:l,uploadProgress:d,uploadError:h,uploadResult:m,onScan:p,onUpload:g,disabled:v}){const _=k.useRef(null),[E,x]=k.useState(null),[S,C]=k.useState(!1),T=async $=>{const j=$.target.files?.[0];j&&(x(j),await p(j))},A=l!==null,L=A&&(l.budgetsFound>0||l.monthsFound>0),F=v||t||i||o,H=m?.success?"#22c55e":L?"#f59e0b":A?"#22c55e":"#9ca3af",O=m?.success?"":o||i||t?"":L?"":A?"":"",I=m?.success?"Uploaded":o?"Uploading":i?"Scanning":t?"Downloading":L?`${l.budgetsFound} budget(s), ${l.monthsFound} month(s) ready`:A?"Nothing to upload":"Select file",N=t?e?.percentComplete:d?.percentComplete,U=n||h;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[u.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${H} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||i||t?u.jsx(Vn,{noMargin:!0}):O}),u.jsxs("div",{style:{flex:1,minWidth:0},children:[u.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),u.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),u.jsx("div",{style:{color:H,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:I}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[u.jsx("button",{onClick:()=>{r()},disabled:F,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:F?"not-allowed":"pointer",fontSize:"0.8rem",opacity:F?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?u.jsx(Vn,{noMargin:!0}):""}),u.jsx("input",{ref:_,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),u.jsx("button",{onClick:()=>_.current?.click(),disabled:F,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:F?"not-allowed":"pointer",fontSize:"0.8rem",opacity:F?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:i?u.jsx(Vn,{noMargin:!0}):""}),L&&E&&u.jsx("button",{onClick:async()=>{await g(E)},disabled:F,style:{background:"#646cff",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:F?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:F?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?u.jsx(Vn,{noMargin:!0}):"Upload"}),(A||m||U)&&u.jsx("button",{onClick:()=>C(!S),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:S?"Collapse":"Expand",children:S?"":""})]})]}),(t||o)&&N!==void 0&&u.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[u.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${N}%`,height:"100%",background:"#646cff",transition:"width 0.3s ease"}})}),u.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:d?.phase,": ",N,"%"]})]}),S&&(A||m||U)&&u.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[U&&u.jsxs("div",{style:{marginBottom:"0.75rem",color:"#ef4444"},children:[" Error: ",U]}),m&&u.jsx("div",{style:{marginBottom:l?"0.75rem":0,color:m.success?"#22c55e":"#ef4444"},children:m.success?u.jsxs(u.Fragment,{children:[" Restored ",m.budgetsRestored," budget(s), ",m.monthsRestored," month(s), ",m.payeesRestored," payee doc(s)"]}):u.jsxs(u.Fragment,{children:[" Upload failed: ",m.errors.join(", ")]})}),l&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{marginBottom:"0.25rem"},children:[u.jsx("strong",{children:"Found in zip:"})," ",l.budgetsFound," budget(s), ",l.monthsFound," month(s), ",l.payeesFound," payee doc(s)"]}),l.budgetsToRestore.length>0&&u.jsxs("div",{children:[u.jsx("strong",{children:"Budgets to restore:"})," ",l.budgetsToRestore.join(", ")]})]})]})]})}function gz({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:i,deleteResult:o,onCheck:l,onDelete:d,disabled:h}){const[m,p]=k.useState(!1),g=()=>i?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",v=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,_=()=>{p(!0)},E=()=>{p(!1),d()},x=()=>o?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&u.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((S,C)=>u.jsx("li",{children:S},C)),o.errors.length>3&&u.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?u.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#ef4444"},children:" DESTRUCTIVE ACTION"}),u.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return u.jsxs(u.Fragment,{children:[u.jsx(t_,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:v(),onCheck:l,isChecking:r,onRun:e>0?_:void 0,isRunning:i,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:x(),isDestructive:!0}),u.jsxs(ls,{isOpen:m,onClose:()=>p(!1),title:" Delete All Months?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#ef4444"},children:[e," month(s)"]})," across"," ",u.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget(s)"]}),"."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"All account balances  $0"}),u.jsx("li",{children:"All category balances  $0"}),u.jsx("li",{children:"Month history cleared"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Fe,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),u.jsxs(Fe,{variant:"danger",actionName:"Confirm Delete All Months",onClick:E,children:[" Delete All ",e," Months"]})]})]})]})}function yz({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:i,isDeleting:o,deleteResult:l,onCheck:d,onDelete:h,disabled:m}){const[p,g]=k.useState(!1),v=t?.staleBudgetIds??[],_=v.length>0,E=()=>o?"running":e?l&&l.errors.length===0?"complete":n===0&&!_?"clean":"needs-action":"unknown",x=()=>l&&l.errors.length===0?`Deleted ${l.budgetsDeleted}`:n===0&&!_?"Clean":_?`${v.length} stale ref(s)`:`${n} budget(s)`,S=()=>{g(!0)},C=()=>{g(!1),h()},T=()=>l?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:l.errors.length>0?" Completed with errors":" Deletion complete"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[l.budgetsDeleted>0&&u.jsxs("li",{children:[l.budgetsDeleted," budget(s) deleted"]}),l.monthsDeleted>0&&u.jsxs("li",{children:[l.monthsDeleted," month(s) deleted"]}),l.payeesDeleted>0&&u.jsxs("li",{children:[l.payeesDeleted," payee doc(s) deleted"]})]}),l.errors.length>0&&u.jsxs("div",{style:{marginTop:"0.5rem",color:"#ef4444"},children:[u.jsxs("div",{children:["Errors (",l.errors.length,"):"]}),u.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[l.errors.slice(0,3).map((L,F)=>u.jsx("li",{children:L},F)),l.errors.length>3&&u.jsxs("li",{children:["...and ",l.errors.length-3," more"]})]})]})]}):e?n===0&&!_?u.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):_?u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Found stale budget references:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[v.slice(0,3).map(L=>u.jsx("li",{style:{opacity:.8},children:L},L)),v.length>3&&u.jsxs("li",{style:{opacity:.6},children:["...and ",v.length-3," more"]})]})]}):u.jsxs("div",{style:{fontSize:"0.85rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem",color:"#f59e0b"},children:" Sample user budget found:"}),u.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[u.jsxs("li",{children:[n," budget(s)"]}),u.jsxs("li",{children:[r," month(s)"]})]}),u.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):u.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),A=n>0||_;return u.jsxs(u.Fragment,{children:[u.jsx(t_,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:E(),statusText:x(),onCheck:d,isChecking:i,onRun:A?S:void 0,isRunning:o,actionText:"Delete",disabled:m,itemCount:A?n||v.length:void 0,details:T(),isDestructive:!0}),u.jsxs(ls,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #f59e0b 15%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsx("p",{style:{margin:0,color:"#fcd34d",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[n," budget(s)"]})," and"," ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[r," month(s)"]}),"."]}),_&&u.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",u.jsxs("strong",{style:{color:"#f59e0b"},children:[v.length," stale reference(s)"]})," from the user document."]}),u.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[u.jsx("li",{children:"Budget document deleted"}),u.jsx("li",{children:"All month documents deleted"}),u.jsx("li",{children:"Payees document deleted"}),u.jsx("li",{children:"User will see onboarding flow"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Fe,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),u.jsx(Fe,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:C,children:" Delete Sample User Data"})]})]})]})}function _z({onClearCache:t,disabled:e}){const[n,r]=k.useState(!1),i=()=>{r(!0)},o=()=>{r(!1),t()};return u.jsxs(u.Fragment,{children:[u.jsx(cz,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:i,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),u.jsxs(ls,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data and reload the page. The app will fetch fresh data from Firestore for everything."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Fe,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),u.jsx(Fe,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function bz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,deleteAllMonths:i,deleteSampleUserBudget:o,onClearCache:l}){const d=r.isDownloading||r.isUploading||i.isDeleting||o.isDeleting,h=vo({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),m=vo({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),p=vo({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e});return u.jsxs(u.Fragment,{children:[u.jsxs(e_,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:d,children:[u.jsx(pz,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async g=>{p.promptBeforeAction(()=>{r.uploadBudget(g).catch(v=>console.error("Upload failed:",v))})},disabled:t}),u.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[u.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),u.jsx(gz,{status:i.status,hasData:i.hasData,monthsCount:i.monthsCount,budgetCount:i.budgetCount,isChecking:i.isScanning,isDeleting:i.isDeleting,deleteResult:i.deleteResult,deleteProgress:i.deleteProgress,onCheck:i.scanStatus,onDelete:()=>h.promptBeforeAction(i.deleteAllMonths),disabled:t}),u.jsx(yz,{status:o.status,hasData:o.hasData,totalBudgets:o.totalBudgets,totalMonths:o.totalMonths,isChecking:o.isScanning,isDeleting:o.isDeleting,deleteResult:o.deleteResult,deleteProgress:o.deleteProgress,onCheck:o.scanStatus,onDelete:()=>m.promptBeforeAction(o.deleteSampleUserBudget),disabled:t}),u.jsx(_z,{onClearCache:l,disabled:t})]})]}),u.jsx(bo,{...h.promptProps,isDownloading:n}),u.jsx(bo,{...m.promptProps,isDownloading:n}),u.jsx(bo,{...p.promptProps,isDownloading:n})]})}function n_({message:t="Loading...",spinnerColor:e=ue.primary,children:n,spinnerSize:r=4}){return u.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[u.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,u.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function rA({percent:t,gradient:e="linear-gradient(90deg, #646cff, #8b5cf6)",width:n=300}){return u.jsx("div",{style:{width:`${n}px`,height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden"},children:u.jsx("div",{style:{width:`${t}%`,height:"100%",background:e,borderRadius:"4px",transition:"width 0.3s ease-out"}})})}function Bf({value:t,label:e,color:n="#646cff"}){return u.jsxs("div",{style:{textAlign:"center"},children:[u.jsx("p",{style:{color:n,fontSize:"1.5rem",fontWeight:700,margin:0},children:t}),u.jsx("p",{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.8rem",margin:"0.25rem 0 0",textTransform:"uppercase",letterSpacing:"0.05em"},children:e})]})}function sA({percent:t}){return u.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:"0.9rem",margin:0},children:[t,"% complete"]})}function vz(){return u.jsxs("div",{style:Mf,children:[u.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:u.jsx(Cn,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),u.jsx("h1",{children:"Tarron Lane Homepage"}),u.jsx("nav",{children:u.jsxs("ul",{children:[u.jsx("li",{children:u.jsx(Cn,{to:"/sql-test",children:"SQL Test"})}),u.jsx("li",{children:u.jsx(Cn,{to:"/budget",children:"Budget"})}),u.jsx("li",{children:u.jsx(Cn,{to:"/account",children:"Account"})})]})})]})}function xz(){const t=k.useContext(fd),e=Da(),[n,r]=k.useState(!1),i=On(),o=Ku(),l=i.state?.from||"/";k.useEffect(()=>{t.is_logged_in&&l!=="/"&&o(l,{replace:!0})},[t.is_logged_in,l,o]);function d(){r(!0),e.logout_firebase_user().then(function(){Ve.clear(),window.location.href="/"})}return u.jsxs("div",{style:Mf,children:[u.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx(Cn,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),u.jsxs(Cn,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[u.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),u.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),u.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:u.jsx(KT,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),u.jsx("h1",{children:"Account"}),t.is_logged_in?n?u.jsx("p",{children:"Logging Out..."}):u.jsxs(u.Fragment,{children:[u.jsxs("p",{children:["You are logged in as ",t.username]}),u.jsx("button",{onClick:d,style:{marginTop:"1rem"},children:"Logout"})]}):u.jsx(wz,{})]})}function wz(){const t=Da(),[e,n]=k.useState(""),[r,i]=k.useState(""),[o,l]=k.useState(!1),[d,h]=k.useState(!1),[m,p]=k.useState("");function g(E){n(E.target.value)}function v(E){i(E.target.value)}function _(E){E.preventDefault(),h(!0),p(""),Ve.clear(),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return u.jsxs("form",{onSubmit:_,children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"username",children:"Email: "}),u.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"password",children:"Password: "}),u.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[u.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:v,style:{paddingRight:"2rem"}}),u.jsx("button",{type:"button",onClick:()=>l(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),d?u.jsx("p",{children:"Logging in..."}):u.jsx("button",{children:"Login"}),m&&u.jsx("p",{style:{color:"red"},children:m})]})}const Sz={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"},Ez={balances:"categories",transactions:"income"};function Cz({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const r=Sz[t],i=k.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),o=k.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"}],[n]),l=k.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),d=m=>{e(Ez[m])},h=r==="balances"?o:l;return u.jsxs("div",{children:[u.jsx(Pf,{mode:"button",tabs:i,activeTab:r,onTabChange:d,variant:"segmented"}),u.jsx(Pf,{mode:"button",tabs:h,activeTab:t,onTabChange:m=>e(m),variant:"secondary"})]})}function Tz({isOpen:t,onClose:e,onProceed:n,results:r}){const[i,o]=k.useState("from_current"),l=!r||r.status==="confirming",d=r&&!["confirming","done","error"].includes(r.status),h=l||r?.status==="done"||r?.status==="error";function m(){h&&(e(),o("from_current"))}function p(){n(i)}return u.jsx(ls,{isOpen:t,onClose:m,title:"Recalculate Balances",width:"540px",children:u.jsxs("div",{style:{padding:"0.5rem 0"},children:[l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.95rem",lineHeight:1.5},children:"Choose what to recalculate:"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(H1,{selected:i==="from_current",onClick:()=>o("from_current"),title:"From current month forward",description:"Recalculate from this month onward. Use for quick fixes."}),u.jsx(H1,{selected:i==="all_months",onClick:()=>o("all_months"),title:"All months from beginning",description:"Recalculate entire history. Use after migrations or data repairs.",recommended:!0})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[u.jsx(El,{status:"waiting",label:"Find all months to process"}),u.jsx(El,{status:"waiting",label:"Process months"}),u.jsx(El,{status:"waiting",label:"Update budget totals"})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Fe,{variant:"secondary",actionName:"Cancel Recalculation",onClick:e,children:"Cancel"}),u.jsx(Fe,{actionName:"Proceed with Recalculation",onClick:p,children:"Proceed"})]})]}),!l&&u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Recalculating category balances and account balances..."}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx(El,{status:r?.status==="pending"?"waiting":"complete",label:"Find all months to process",detail:r&&r.status!=="pending"?`Found ${r.monthsFound||0} month${r.monthsFound!==1?"s":""}`:void 0}),u.jsx(El,{status:q1(r?.status,["pending","finding_months"],"processing_months"),label:"Process months",detail:r?.status==="processing_months"?`Processing: ${r.currentMonthLabel} (${(r.currentMonthIndex||0)+1}/${r.monthsFound||0})`:r?.monthsProcessed!==void 0?`Processed ${r.monthsProcessed} month${r.monthsProcessed!==1?"s":""}`:void 0}),u.jsx(El,{status:r?.status==="error"?"error":q1(r?.status,["pending","finding_months","processing_months"],"updating_budget"),label:"Update budget totals",detail:r?.status==="error"?r.error:void 0,isError:r?.status==="error"})]}),r?.status==="done"&&u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:`color-mix(in srgb, ${ue.success} 10%, transparent)`,border:`1px solid ${ue.success}`,borderRadius:"8px",textAlign:"center"},children:[u.jsx("p",{style:{margin:0,fontWeight:600,color:ue.success},children:" Recalculation complete!"}),u.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",opacity:.8},children:[r.monthsProcessed," month",r.monthsProcessed!==1?"s":""," processed",u.jsx("br",{}),"Total Income: ",Je(r.totalIncomeRecalculated||0),u.jsx("br",{}),"Total Expenses: ",Je(r.totalExpensesRecalculated||0)]})]}),(r?.status==="done"||r?.status==="error")&&u.jsx("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"center"},children:u.jsx(Fe,{actionName:"Close Recalculation Modal",onClick:e,children:"Done"})}),d&&u.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"Please wait, do not close this window..."})]})]})})}function q1(t,e,n){return!t||e.includes(t)?t===n?"active":"waiting":t===n?"active":"complete"}function El({status:t,label:e,detail:n,isError:r}){const i=t==="waiting"?"":t==="active"?"":t==="error"?"":"";return u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[u.jsx("span",{style:{fontSize:"1.1rem",width:"1.5rem",textAlign:"center"},children:i}),u.jsxs("div",{style:{flex:1},children:[u.jsx("p",{style:{margin:0,fontWeight:500},children:e}),n&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:r?1:.6,color:r?ue.error:"inherit"},children:n})]})]})}function H1({selected:t,onClick:e,title:n,description:r,recommended:i}){return u.jsxs("button",{type:"button",onClick:e,style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem 1rem",background:t?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",border:t?"2px solid #646cff":"2px solid transparent",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.15s ease"},children:[u.jsx("span",{style:{width:"20px",height:"20px",borderRadius:"50%",border:t?"6px solid #646cff":"2px solid rgba(128,128,128,0.5)",flexShrink:0,marginTop:"2px",background:t?"white":"transparent"}}),u.jsxs("div",{style:{flex:1},children:[u.jsxs("p",{style:{margin:0,fontWeight:600,fontSize:"0.95rem"},children:[n,i&&u.jsx("span",{style:{marginLeft:"0.5rem",padding:"0.15rem 0.5rem",background:ue.success,color:"white",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,verticalAlign:"middle"},children:"RECOMMENDED"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:r})]})]})}function Xg(t){return t==="no_category"||t==="NO_CATEGORY"}function Az(t,e){const n={};for(const r of t)Xg(r.from_category_id)||(n[r.from_category_id]=(n[r.from_category_id]||0)-r.amount),Xg(r.to_category_id)||(n[r.to_category_id]=(n[r.to_category_id]||0)+r.amount);for(const r of e)Xg(r.category_id)||(n[r.category_id]=(n[r.category_id]||0)+r.amount);for(const r of Object.keys(n))n[r]=Pe(n[r]);return n}async function jz(t,e,n,r,i,o,l){const d=hs(t,e.year,e.month),{exists:h,data:m}=await At("months",d,"recalculate: reading full month data");if(!h||!m)return null;const p=m.income||[],g=m.expenses||[],v=m.transfers||[],_=m.adjustments||[],E=m.are_allocations_finalized||!1,x=Pe(p.reduce((I,N)=>I+N.amount,0)),S=Pe(g.reduce((I,N)=>I+N.amount,0)),C={};if(m.category_balances)for(const I of m.category_balances)C[I.category_id]={allocated:I.allocated??0};const T=Az(v,_),A=n.map(I=>{const N=Pe(i[I]??0);let U=0;E&&C[I]&&(U=Pe(C[I].allocated));let $=0;g.length>0&&($=Pe(g.filter(W=>W.category_id===I).reduce((W,q)=>W+q.amount,0)));const j=T[I]??0,M=Pe(v.filter(W=>W.from_category_id===I||W.to_category_id===I).reduce((W,q)=>q.from_category_id===I?W-q.amount:q.to_category_id===I?W+q.amount:W,0)),R=Pe(_.filter(W=>W.category_id===I).reduce((W,q)=>W+q.amount,0)),K=Pe(N+U+$+j);return{category_id:I,start_balance:N,allocated:U,spent:$,transfers:M,adjustments:R,end_balance:K}});A.forEach(I=>{i[I.category_id]=I.end_balance});const L=Object.keys(r),F={},H=L.map(I=>{const N=Pe(p.filter(q=>q.account_id===I).reduce((q,Z)=>q+Z.amount,0)),U=Pe(g.filter(q=>q.account_id===I).reduce((q,Z)=>q+Z.amount,0)),$=Pe(v.filter(q=>q.from_account_id===I).reduce((q,Z)=>q-Z.amount,0)),j=Pe(v.filter(q=>q.to_account_id===I).reduce((q,Z)=>q+Z.amount,0)),M=Pe(_.filter(q=>q.account_id===I).reduce((q,Z)=>q+Z.amount,0)),R=Pe(N+U+$+j+M);F[I]=R;const K=Pe(o[I]??0),W=Pe($+j);return{account_id:I,start_balance:K,income:N,expenses:U,transfers:W,adjustments:M,net_change:R,end_balance:Pe(K+R)}});for(const I of H)o[I.account_id]=I.end_balance;return{updatedMonth:{budget_id:t,year_month_ordinal:vt(e.year,e.month),year:e.year,month:e.month,income:p,total_income:x,previous_month_income:l,expenses:g,total_expenses:S,transfers:v,adjustments:_,account_balances:H,category_balances:A,are_allocations_finalized:E,created_at:m.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},totalIncome:x,totalExpenses:S,accountNetChanges:F}}function r_({isDisabled:t,onCloseMenu:e}){const{selectedBudgetId:n,currentYear:r,currentMonthNumber:i}=Ze(),{categories:o,accounts:l}=An(),{updateAccounts:d}=BT(),{updateCategories:h}=LT(),[m,p]=k.useState(!1),[g,v]=k.useState(!1),[_,E]=k.useState(null);function x(){v(!0),E({status:"confirming"})}async function S(T){if(n){p(!0),E({status:"pending"});try{E({status:"finding_months"});let A;if(T==="all_months")A=(await kn("months","recalculate: querying all months for full recalculation",[{field:"budget_id",op:"==",value:n}])).docs.map(M=>({year:M.data.year,month:M.data.month})).sort((M,R)=>M.year!==R.year?M.year-R.year:M.month-R.month);else{const j=new Date,M=r||j.getFullYear(),R=i||j.getMonth()+1,{year:K,month:W}=Kl(M,R);A=await G4(n,K,W)}const L=Object.keys(o);E({status:"finding_months",monthsFound:A.length}),await new Promise(j=>setTimeout(j,100));const F={},H={};if(T==="from_current"){const j=new Date,M=r||j.getFullYear(),R=i||j.getMonth()+1,{year:K,month:W}=Kl(M,R),q=hs(n,K,W),{exists:Z,data:X}=await At("months",q,"recalculate: reading previous month for starting balances");if(Z&&X?.category_balances)for(const ne of X.category_balances)F[ne.category_id]=ne.end_balance??0;if(Z&&X?.account_balances)for(const ne of X.account_balances)H[ne.account_id]=ne.end_balance??0}L.forEach(j=>{F[j]===void 0&&(F[j]=0)}),Object.keys(l).forEach(j=>{H[j]===void 0&&(H[j]=0)});let O=0,I=0,N=0;for(let j=0;j<A.length;j++){const M=A[j],R=`${Fu[M.month-1]} ${M.year}`;E({status:"processing_months",monthsFound:A.length,currentMonthIndex:j,currentMonthLabel:R});const K=await jz(n,M,L,l,F,H,N);K&&(O+=K.totalIncome,I+=K.totalExpenses,N=K.totalIncome,await ET({budgetId:n,month:K.updatedMonth,description:"recalculate all months"}),await new Promise(W=>setTimeout(W,50)))}const U={};Object.entries(l).forEach(([j,M])=>{U[j]={...M,balance:H[j]??0}}),await d.mutateAsync({budgetId:n,accounts:U}),E({status:"updating_budget",monthsFound:A.length,monthsProcessed:A.length,totalIncomeRecalculated:O,totalExpensesRecalculated:I});const $={};Object.entries(o).forEach(([j,M])=>{$[j]={...M,balance:F[j]??0}}),await h.mutateAsync({budgetId:n,categories:$});for(const j of A)Ve.invalidateQueries({queryKey:ke.month(n,j.year,j.month)});E({status:"done",monthsFound:A.length,monthsProcessed:A.length,totalIncomeRecalculated:O,totalExpensesRecalculated:I})}catch(A){console.error("Recalculate error:",A),E({status:"error",error:A instanceof Error?A.message:"Failed to recalculate"})}finally{p(!1)}}}function C(){v(!1),E(null),e?.()}return u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:x,disabled:t||m,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.5rem",cursor:t||m?"not-allowed":"pointer",opacity:t||m?.5:1,fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center"},title:"Recalculate balances from this month forward",children:[m?"":""," Recalculate"]}),u.jsx(Tz,{isOpen:g,onClose:C,onProceed:S,results:_})]})}function G1({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:i}){const[o,l]=k.useState(!1),d=n||e,h=t==="prev"?"":"",m=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(l(!0),setTimeout(()=>l(!1),2e3)):i())};return u.jsxs("div",{style:{position:"relative"},children:[u.jsx("button",{onClick:p,onMouseEnter:()=>e&&l(!0),onMouseLeave:()=>l(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:d?"not-allowed":"pointer",fontSize:"1.25rem",opacity:d?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:m,children:h}),o&&e&&u.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:ue.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:r})]})}function Rz({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:i,maxOrdinal:o,minAllowed:l,maxAllowed:d,onYearChange:h,onMonthChange:m,onGo:p}){const g=t>l.year,v=t<d.year,_=Number(vt(t,e)),E=_>=i&&_<=o;return u.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[u.jsx("button",{onClick:()=>h(t-1),disabled:!g,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:g?"pointer":"not-allowed",fontSize:"0.8rem",opacity:g?1:.3},title:g?"Previous year":"Cannot go further back",children:""}),u.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),u.jsx("button",{onClick:()=>h(t+1),disabled:!v,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:v?"pointer":"not-allowed",fontSize:"0.8rem",opacity:v?1:.3},title:v?"Next year":"Cannot go further ahead",children:""})]}),u.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:Fu.map((x,S)=>{const C=S+1,T=C===e,A=t===n&&C===r,L=Number(vt(t,C)),F=L<i,H=L>o,O=F||H;let I=x;return F?I="Too far in the past":H&&(I="Too far in the future"),u.jsx("button",{onClick:()=>m(C),disabled:O,style:{background:T?ue.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:A?`1px solid ${ue.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:O?"not-allowed":"pointer",fontSize:"0.7rem",color:T?"#fff":"inherit",opacity:O?.3:1,transition:"background 0.15s"},title:I,children:x.slice(0,3)},C)})}),u.jsxs("button",{onClick:p,disabled:!E,style:{width:"100%",background:E?ue.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:E?"pointer":"not-allowed",fontSize:"0.85rem",color:E?"#fff":"inherit",fontWeight:500,opacity:E?1:.5},children:["Go to ",Fu[e-1]," ",t]})]})}function Dz({isOpen:t,onClose:e,year:n,month:r,isDeleting:i,onConfirm:o}){return u.jsxs(ls,{isOpen:t,onClose:e,title:" Delete Month?",children:[u.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:u.jsxs("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",Fu[r-1]," ",n,"!"]})}),u.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),u.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Fe,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:i,children:"Cancel"}),u.jsx(Fe,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:i,children:i?"Deleting...":" Delete Month"})]})]})}function Iz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+If;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function kz(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-kf;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function Oz(t){return Object.keys(t).sort()[0]}function Mz(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function Nz(t){const e=kz(),n=Oz(t);if(!n)return e;const r=vt(e.year,e.month);return n<r?Mz(n):e}function Q1(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function Pz(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function zz({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=sr(),{currentYear:r,currentMonthNumber:i,isAdmin:o,selectedBudgetId:l,setCurrentYear:d,setCurrentMonthNumber:h}=Ze(),{budget:m,monthMap:p}=An(),{month:g}=Ci(l,r,i),v=Q1(r,i),_=Pz(r,i),E=Nz(p),x=Iz(),S=Number(vt(E.year,E.month)),C=Number(vt(x.year,x.month)),T=Number(vt(v.year,v.month)),A=Number(vt(_.year,_.month)),L=T<S,F=A>C,[H,O]=k.useState(!1),[I,N]=k.useState(!1),[U,$]=k.useState(r),[j,M]=k.useState(i),[R,K]=k.useState(!1),[W,q]=k.useState(!1),Z=k.useRef(null),X=(()=>{if(!p||Object.keys(p).length===0)return!1;const ae=vt(r,i),fe=Math.max(...Object.keys(p).map(Number));return Number(ae)===fe})(),{trackChange:ne}=mc();async function B(){if(l){q(!0);try{const ae=hs(l,r,i);Z4(l,r,i,ne),await My("months",ae,`deleting month ${r}/${i}`),`${r}${i}`,Ve.removeQueries({queryKey:ke.month(l,r,i)});const fe=Q1(r,i);K(!1),O(!1),window.location.href=`/budget/${fe.year}/${fe.month}/categories`}catch(ae){console.error("Failed to delete month:",ae),alert(`Failed to delete month: ${ae instanceof Error?ae.message:"Unknown error"}`)}finally{q(!1)}}}k.useEffect(()=>{if(!H)return;function ae(fe){Z.current&&!Z.current.contains(fe.target)&&(O(!1),N(!1))}return document.addEventListener("mousedown",ae),()=>document.removeEventListener("mousedown",ae)},[H]);function G(){I||($(r),M(i)),N(!I)}function te(){d(U),h(j),N(!1),O(!1)}async function ie(){if(!g||!m)return;const ae=new Date,Ee=`${ae.toISOString().split("T")[0]}_month_${r}_${String(i).padStart(2,"0")}`,me=new Cm,Ce=[{name:`${Ee}_income.json`,data:g.income||[]},{name:`${Ee}_expenses.json`,data:g.expenses||[]},{name:`${Ee}_transfers.json`,data:g.transfers||[]},{name:`${Ee}_adjustments.json`,data:g.adjustments||[]},{name:`${Ee}_account_balances.json`,data:g.account_balances||[]},{name:`${Ee}_category_balances.json`,data:g.category_balances||[]}],he={budget_id:m.id,budget_name:m.name,year_month_ordinal:g.year_month_ordinal,year:g.year,month:g.month,total_income:g.total_income,previous_month_income:g.previous_month_income,total_expenses:g.total_expenses,are_allocations_finalized:g.are_allocations_finalized,created_at:g.created_at,updated_at:g.updated_at,downloaded_at:ae.toISOString()};Ce.push({name:`${Ee}_metadata.json`,data:he});for(const z of Ce)me.file(z.name,JSON.stringify(z.data,null,2));const Me=await me.generateAsync({type:"blob"}),qe=URL.createObjectURL(Me),Oe=document.createElement("a");Oe.href=qe,Oe.download=`${Ee}.zip`,document.body.appendChild(Oe),Oe.click(),document.body.removeChild(Oe),URL.revokeObjectURL(qe),O(!1)}return u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[u.jsx(G1,{direction:"prev",isDisabled:L,isLoading:n,disabledReason:"Cannot create months more than 3 months into the past",onNavigate:t}),u.jsxs("div",{ref:Z,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[u.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[Fu[i-1]," ",r]}),u.jsx("button",{onClick:()=>O(!H),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:H?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&u.jsxs(u.Fragment,{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[u.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:ue.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),u.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),H&&u.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[u.jsx(r_,{isDisabled:n,onCloseMenu:()=>O(!1)}),u.jsx("button",{onClick:G,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),I&&u.jsx(Rz,{pickerYear:U,pickerMonth:j,currentYear:r,currentMonthNumber:i,minOrdinal:S,maxOrdinal:C,minAllowed:E,maxAllowed:x,onYearChange:$,onMonthChange:M,onGo:te}),o&&g&&u.jsx("button",{onClick:()=>{ie()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),o&&g&&X&&u.jsx("button",{onClick:()=>K(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"#ef4444",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),u.jsx(G1,{direction:"next",isDisabled:F,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e}),u.jsx(Dz,{isOpen:R,onClose:()=>K(!1),year:r,month:i,isDeleting:W,onConfirm:B})]})}const s_={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},Bz={...s_,background:ue.primary,border:"none",color:"white"},Lz={...s_,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},Uz={...s_,background:"transparent",border:`1px solid ${ue.errorBorder}`,color:ue.error},W1=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${ue.error} 15%, transparent)`:`color-mix(in srgb, ${ue.success} 15%, transparent)`,border:`1px solid ${t?ue.errorBorder:"rgba(74, 222, 128, 0.4)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?ue.error:ue.success,transition:"all 0.15s ease",flexShrink:0});function i_({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,config:h,onSubmit:m,onCancel:p,onDelete:g,extraContent:v}){const{isWide:_}=PT(),{showCategory:E=!1,showCleared:x=!1,showSignToggle:S=!1,accountLabel:C="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:A="Optional note",submitLabel:L}=h,F=new Date().toISOString().split("T")[0],[H,O]=k.useState(o?.date||d||F),[I,N]=k.useState(o?.payee||""),[U,$]=k.useState(o?.categoryId||(h.showNoCategoryOption?Kt:"")),[j,M]=k.useState(o?.accountId||l||(h.showNoAccountOption?qt:t[0]?t[0][0]:"")),R=o?.amount!==void 0?Math.abs(o.amount):void 0,[K,W]=k.useState(R?.toString()||""),[q,Z]=k.useState(o?.description||""),[X,ne]=k.useState(o?.cleared||!1),[B,G]=k.useState(()=>S?o?.amount!==void 0?o.amount<0:!1:!0),[te,ie]=k.useState(!1),ae={},fe=[];t.forEach(([Se,oe])=>{oe.account_group_id?(ae[oe.account_group_id]||(ae[oe.account_group_id]=[]),ae[oe.account_group_id].push([Se,oe])):fe.push([Se,oe])});function Ee(Se){Se.preventDefault();const oe=parseFloat(K);if(isNaN(oe)||oe<=0||E&&!U||!j||!H)return;if(U===Kt&&j===qt){ie(!0);return}ie(!1);const Ne=S&&B?-oe:oe;m({date:H,payee:I.trim()||void 0,categoryId:E?U:void 0,accountId:j,amount:Ne,description:q.trim()||void 0,cleared:x?X:void 0})}!(U===Kt&&j===qt)&&te&&ie(!1);const Me=h.showNoAccountOption?u.jsx(NT,{id:"txn-account",value:j,onChange:M,accounts:t,accountGroups:e,placeholder:Aa,required:!0,showNoAccountOption:!0}):u.jsxs(qu,{id:"txn-account",value:j,onChange:Se=>M(Se.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([Se,oe])=>{const je=ae[Se];return je?.length?u.jsx("optgroup",{label:oe.name,children:je.map(([ze,Ne])=>u.jsx("option",{value:ze,children:Ne.nickname},ze))},Se):null}),fe.length>0&&u.jsx("optgroup",{label:"Other",children:fe.map(([Se,oe])=>u.jsx("option",{value:Se,children:oe.nickname},Se))})]}),qe=E&&n&&r?u.jsx(Pt,{label:"Category",htmlFor:"txn-category",children:u.jsx(MT,{id:"txn-category",value:U,onChange:$,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?jo:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,Oe=x?u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Vr,{id:"txn-cleared",checked:X,onChange:Se=>ne(Se.target.checked)})]}):null,z=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:L,style:Bz,children:""}),u.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:Lz,children:""}),g&&u.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:Uz,children:""})]})]}),ce=te?u.jsx("div",{style:{background:`color-mix(in srgb, ${ue.error} 15%, transparent)`,border:`1px solid ${ue.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ue.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,pe=u.jsxs(Ma,{children:[u.jsx(Fe,{type:"submit",actionName:L,children:L}),u.jsx(Fe,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&u.jsx(Fe,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),ee=E&&n&&r,J={fontSize:"0.85rem",padding:"0.5rem"};if(!_)return u.jsxs(wi,{actionName:L,onSubmit:Ee,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Pt,{label:"Date",htmlFor:"txn-date",children:u.jsx(Nf,{id:"txn-date",value:H,onChange:Se=>O(Se.target.value),required:!0,autoFocus:!0})}),u.jsx(Pt,{label:S?B?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>G(!B),style:W1(B),title:B?"Click to make this a refund (+)":"Click to make this an expense (-)",children:B?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(_o,{id:"txn-amount",value:K,onChange:W,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:B?ue.error:ue.success}})})]}):u.jsx(_o,{id:"txn-amount",value:K,onChange:W,placeholder:"$0.00",required:!0})})]}),u.jsx(Pt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(O1,{id:"txn-payee",value:I,onChange:N,payees:i,placeholder:T})}),qe,u.jsx(Pt,{label:C,htmlFor:"txn-account",children:Me}),u.jsx(Pt,{label:"Description (optional)",htmlFor:"txn-description",children:u.jsx(Si,{id:"txn-description",value:q,onChange:Se=>Z(Se.target.value),placeholder:A})}),x&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Vr,{id:"txn-cleared-stacked",checked:X,onChange:Se=>ne(Se.target.checked)}),u.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),ce,v]}),pe]});const se=S?"8.25rem":"6rem",xe=ee?x?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${se} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${se} minmax(10rem, 2fr) auto`:x?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${se} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${se} minmax(12rem, 2fr) auto`;return u.jsxs(wi,{actionName:L,onSubmit:Ee,children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:xe,gap:"1rem",alignItems:"end"},children:[u.jsx(Pt,{label:"Date",htmlFor:"txn-date",children:u.jsx(Nf,{id:"txn-date",value:H,onChange:Se=>O(Se.target.value),required:!0,style:J,autoFocus:!0})}),u.jsx(Pt,{label:"Payee",htmlFor:"txn-payee",children:u.jsx(O1,{id:"txn-payee",value:I,onChange:N,payees:i,placeholder:T})}),qe,u.jsx(Pt,{label:C,htmlFor:"txn-account",children:Me}),u.jsx(Pt,{label:S?B?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:S?u.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[u.jsx("button",{type:"button",onClick:()=>G(!B),style:W1(B),title:B?"Click to make this a refund (+)":"Click to make this an expense (-)",children:B?"":"+"}),u.jsx("div",{style:{flex:1},children:u.jsx(_o,{id:"txn-amount",value:K,onChange:W,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:B?ue.error:ue.success}})})]}):u.jsx(_o,{id:"txn-amount",value:K,onChange:W,placeholder:"$0.00",required:!0})}),u.jsx(Pt,{label:"Description",htmlFor:"txn-description",children:u.jsx(Si,{id:"txn-description",value:q,onChange:Se=>Z(Se.target.value),placeholder:A,style:J})}),Oe,z]}),ce,v]})}function K1({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:m}){function p(g){l(g.amount,g.accountId,g.date,g.payee,g.description)}return u.jsx(i_,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:i,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:m},onSubmit:p,onCancel:d,onDelete:h})}function Fz({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:i,isMobile:o,isEvenRow:l}){const d=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,m=l?"transparent":"rgba(255,255,255,0.04)";if(o)return u.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:m,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:d}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsxs("span",{style:{fontWeight:600,color:ue.success,fontFamily:"monospace"},children:["+",Je(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",background:m,display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:d})}),u.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...p,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:ue.success,fontFamily:"monospace"},children:["+",Je(t.amount)]}),u.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Cl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Vz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ze(),{accounts:o,accountGroups:l}=An(),{month:d,isLoading:h}=Ci(t,e,n),{addIncome:m}=PP(),{updateIncome:p}=BP(),{deleteIncome:g}=LP(),v=fs(),[_,E]=k.useState(null),[x,S]=k.useState(!1),[C,T]=k.useState(null),F=F0(t,{enabled:x||C!==null}).data||[];function H(q){const Z=q.account_group_id?l[q.account_group_id]:void 0;return Z&&Z.is_active!==null?Z.is_active:q.is_active!==!1}function O(q){const Z=q.account_group_id?l[q.account_group_id]:void 0;return Z&&Z.on_budget!==null?Z.on_budget:q.on_budget!==!1}const I=Object.entries(o).filter(([,q])=>H(q)&&O(q)),N=I.filter(([,q])=>q.is_income_account),U=N.length>0?N:I,$=I.find(([,q])=>q.is_income_default),j=$?$[0]:void 0,M=d?.income.reduce((q,Z)=>q+Z.amount,0)||0;function R(q,Z,X,ne,B){if(!t)return;E(null),S(!1);const{year:G,month:te}=ym(X);(G!==e||te!==n)&&(r(G),i(te)),m(t,G,te,q,Z,X,ne,B).catch(ie=>{E(ie instanceof Error?ie.message:"Failed to add income")})}function K(q,Z,X,ne,B,G){t&&(E(null),T(null),p(t,e,n,q,Z,X,ne,B,G).catch(te=>{E(te instanceof Error?te.message:"Failed to update income")}))}function W(q){t&&confirm("Are you sure you want to delete this income entry?")&&(E(null),g(t,e,n,q).catch(Z=>{E(Z instanceof Error?Z.message:"Failed to delete income")}))}return u.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[_&&u.jsx("div",{style:{background:`color-mix(in srgb, ${ue.error} 15%, transparent)`,border:`1px solid ${ue.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ue.error},children:_}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:v?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:v?"block":"grid",gridTemplateColumns:v?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Income:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:Bt(M),fontWeight:600},children:Je(M)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!x&&u.jsx(Fe,{actionName:"Open Add Income Form",onClick:()=>S(!0),disabled:U.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!v&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Cl,children:"Date"}),u.jsx("div",{style:Cl,children:"Payee"}),u.jsx("div",{style:Cl,children:"Account"}),u.jsx("div",{style:{...Cl,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:Cl,children:"Description"}),u.jsx("div",{style:Cl})]})]}),u.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),U.length===0&&u.jsx(Hu,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),x&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(K1,{accounts:U,accountGroups:l,payees:F,defaultAccountId:j,defaultDate:gm(e,n),onSubmit:R,onCancel:()=>S(!1),submitLabel:"Add Income",isMobile:v})}),d?.income.slice().sort((q,Z)=>(q.date||"").localeCompare(Z.date||"")).map((q,Z)=>C===q.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(K1,{accounts:U,accountGroups:l,payees:F,initialData:q,onSubmit:(X,ne,B,G,te)=>K(q.id,X,ne,B,G,te),onCancel:()=>T(null),onDelete:()=>W(q.id),submitLabel:"Save",isMobile:v})},q.id):u.jsx(Fz,{income:q,accountName:nt(q.account_id)?Aa:o[q.account_id]?.nickname||"Unknown Account",accountGroupName:nt(q.account_id)?void 0:o[q.account_id]?.account_group_id?l[o[q.account_id].account_group_id]?.name:void 0,onEdit:()=>{q.payee||`${q.amount}`,T(q.id)},onDelete:()=>W(q.id),isMobile:v,isEvenRow:Z%2===0},q.id)),(!d?.income||d.income.length===0)&&!x&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function Y1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:m,onDelete:p,submitLabel:g}){function v(_){h(_.amount,_.categoryId,_.accountId,_.date,_.payee,_.description,_.cleared)}return u.jsx(i_,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:v,onCancel:m,onDelete:p})}function $z({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),u.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:ue.success},title:"Cleared",children:""})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",m]})]})]}),u.jsx("div",{style:{display:"flex",alignItems:"center"},children:u.jsx("span",{style:{fontWeight:600,color:Bt(t.amount),fontFamily:"monospace"},children:Gt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",background:p,display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:Bt(t.amount),fontFamily:"monospace"},children:Gt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?ue.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const ia={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function qz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ze(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=An(),{month:m,isLoading:p}=Ci(t,e,n),{addExpense:g}=FP(),{updateExpense:v}=$P(),{deleteExpense:_}=qP(),E=fs(),[x,S]=k.useState(null),[C,T]=k.useState(!1),[A,L]=k.useState(null),O=F0(t,{enabled:C||A!==null}).data||[];function I(X){const ne=X.account_group_id?l[X.account_group_id]:void 0;return ne&&ne.is_active!==null?ne.is_active:X.is_active!==!1}function N(X){const ne=X.account_group_id?l[X.account_group_id]:void 0;return ne&&ne.on_budget!==null?ne.on_budget:X.on_budget!==!1}const U=Object.entries(o).filter(([,X])=>I(X)&&N(X)),$=U.filter(([,X])=>X.is_outgo_account),j=$.length>0?$:U,M=U.find(([,X])=>X.is_outgo_default),R=M?M[0]:void 0,K=m?.expenses?.reduce((X,ne)=>X+ne.amount,0)||0;function W(X,ne,B,G,te,ie,ae){if(!t)return;S(null),T(!1);const{year:fe,month:Ee}=ym(G);(fe!==e||Ee!==n)&&(r(fe),i(Ee)),g(t,fe,Ee,X,ne,B,G,te,ie,ae).catch(me=>{S(me instanceof Error?me.message:"Failed to add expense")})}function q(X,ne,B,G,te,ie,ae,fe){t&&(S(null),L(null),v(t,e,n,X,ne,B,G,te,ie,ae,fe).catch(Ee=>{S(Ee instanceof Error?Ee.message:"Failed to update expense")}))}function Z(X){t&&confirm("Are you sure you want to delete this expense?")&&(S(null),_(t,e,n,X).catch(ne=>{S(ne instanceof Error?ne.message:"Failed to delete expense")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${ue.error} 15%, transparent)`,border:`1px solid ${ue.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ue.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:E?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:E?"block":"grid",gridTemplateColumns:E?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:Bt(K),fontWeight:600},children:Gt(K)})]})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx(Fe,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:j.length===0||Object.keys(d).length===0,disabledReason:j.length===0&&Object.keys(d).length===0?"Create accounts and categories first":j.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!E&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:ia,children:"Date"}),u.jsx("div",{style:ia,children:"Payee"}),u.jsx("div",{style:{...ia,textAlign:"center"},children:"Category"}),u.jsx("div",{style:ia,children:"Account"}),u.jsx("div",{style:{...ia,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:ia,children:"Description"}),u.jsx("div",{style:{...ia,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:ia})]})]}),j.length===0&&u.jsx(Hu,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(d).length===0&&u.jsx(Hu,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(Y1,{accounts:j,accountGroups:l,categories:d,categoryGroups:h,payees:O,defaultAccountId:R,defaultDate:gm(e,n),onSubmit:W,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:E})}),m?.expenses?.slice().sort((X,ne)=>(X.date||"").localeCompare(ne.date||"")).map((X,ne)=>A===X.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(Y1,{accounts:j,accountGroups:l,categories:d,categoryGroups:h,payees:O,initialData:X,onSubmit:(B,G,te,ie,ae,fe,Ee)=>q(X.id,B,G,te,ie,ae,fe,Ee),onCancel:()=>L(null),onDelete:()=>Z(X.id),submitLabel:"Save",isMobile:E})},X.id):u.jsx($z,{expense:X,categoryName:lt(X.category_id)?jo:d[X.category_id]?.name||"Unknown Category",accountName:nt(X.account_id)?Aa:o[X.account_id]?.nickname||"Unknown Account",accountGroupName:nt(X.account_id)?void 0:o[X.account_id]?.account_group_id?l[o[X.account_id].account_group_id]?.name:void 0,onEdit:()=>{X.payee||`${X.amount}`,L(X.id)},onDelete:()=>Z(X.id),isMobile:E,isEvenRow:ne%2===0},X.id)),(!m?.expenses||m.expenses.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const Hz={background:ue.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},Gz={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},Qz={background:"transparent",border:`1px solid ${ue.errorBorder}`,color:ue.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function X1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:i,defaultDate:o,onSubmit:l,onCancel:d,onDelete:h,submitLabel:m}){const{isWide:p}=PT(),g=new Date().toISOString().split("T")[0],[v,_]=k.useState(i?.date||o||g),[E,x]=k.useState(i?.amount?.toString()||""),[S,C]=k.useState(i?.from_account_id||qt),[T,A]=k.useState(i?.to_account_id||qt),[L,F]=k.useState(i?.from_category_id||Kt),[H,O]=k.useState(i?.to_category_id||Kt),[I,N]=k.useState(i?.description||""),[U,$]=k.useState(i?.cleared||!1),[j,M]=k.useState(null),R=L===Kt,K=H===Kt,W=S===qt,q=T===qt;function Z(){return R&&K&&(W&&q)?'A transfer must move between real categories or real accounts  not all "No" options.':W!==q?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':R!==K?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}Z()===null&&j!==null&&M(null);function ne(me){me.preventDefault();const Ce=parseFloat(E);if(isNaN(Ce)||Ce<=0||!S||!T||!L||!H||!v)return;const he=Z();if(he){M(he);return}M(null),l(Ce,S,T,L,H,v,I.trim()||void 0,U)}const B=j?u.jsx("div",{style:{background:`color-mix(in srgb, ${ue.error} 15%, transparent)`,border:`1px solid ${ue.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:ue.error,marginTop:"0.5rem"},children:j}):null,G=(me,Ce,he,Me)=>u.jsx(Pt,{label:Me,htmlFor:me,children:u.jsx(NT,{id:me,value:Ce,onChange:he,accounts:t,accountGroups:e,placeholder:Aa,required:!0,showNoAccountOption:!0})}),te=(me,Ce,he,Me)=>u.jsx(Pt,{label:Me,htmlFor:me,children:u.jsx(MT,{id:me,value:Ce,onChange:he,categories:n,categoryGroups:r,placeholder:jo,required:!0,showNoCategoryOption:!0})}),ie=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[u.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),u.jsx(Vr,{id:"transfer-cleared",checked:U,onChange:me=>$(me.target.checked)})]}),ae=u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),u.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[u.jsx("button",{type:"submit",title:m,style:Hz,children:""}),u.jsx("button",{type:"button",onClick:()=>{d()},title:"Cancel",style:Gz,children:""}),h&&u.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:Qz,children:""})]})]}),fe=u.jsxs(Ma,{children:[u.jsx(Fe,{type:"submit",actionName:m,children:m}),u.jsx(Fe,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:d,children:"Cancel"}),h&&u.jsx(Fe,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),Ee={fontSize:"0.85rem",padding:"0.5rem"};return p?u.jsx(wi,{actionName:m,onSubmit:ne,children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx(Pt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(Nf,{id:"transfer-date",value:v,onChange:me=>_(me.target.value),required:!0,style:Ee,autoFocus:!0})}),u.jsx(Pt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(_o,{id:"transfer-amount",value:E,onChange:x,placeholder:"$0.00",required:!0})}),te("from-category",L,F,"From Category"),G("from-account",S,C,"From Account"),u.jsx(Pt,{label:"Description",htmlFor:"transfer-description",children:u.jsx(Si,{id:"transfer-description",value:I,onChange:me=>N(me.target.value),placeholder:"e.g., Transfer",style:Ee})})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),u.jsx("div",{}),te("to-category",H,O,"To Category"),G("to-account",T,A,"To Account"),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[ie,ae]})]}),B]})}):u.jsxs(wi,{actionName:m,onSubmit:ne,children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[u.jsx(Pt,{label:"Date",htmlFor:"transfer-date",children:u.jsx(Nf,{id:"transfer-date",value:v,onChange:me=>_(me.target.value),required:!0,autoFocus:!0})}),u.jsx(Pt,{label:"Amount",htmlFor:"transfer-amount",children:u.jsx(_o,{id:"transfer-amount",value:E,onChange:x,placeholder:"$0.00",required:!0})})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[te("from-category",L,F,"From Cat."),G("from-account",S,C,"From Acct.")]}),u.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[te("to-category",H,O,"To Cat."),G("to-account",T,A,"To Acct.")]})]}),u.jsx(Pt,{label:"Description (optional)",htmlFor:"transfer-description",children:u.jsx(Si,{id:"transfer-description",value:I,onChange:me=>N(me.target.value),placeholder:"e.g., Transfer to savings"})}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx(Vr,{id:"transfer-cleared-stacked",checked:U,onChange:me=>$(me.target.checked)}),u.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),B]}),fe]})}function Wz({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:i,fromAccountGroupName:o,toAccountGroupName:l,isFromCategoryNo:d,isToCategoryNo:h,isFromAccountNo:m,isToAccountNo:p,onEdit:g,onDelete:v,isMobile:_,isEvenRow:E}){const x=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",S=E?"transparent":"rgba(255,255,255,0.04)";if(_)return u.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:S,cursor:"pointer",transition:"background 0.15s"},children:[u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:x}),u.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Je(t.amount)}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:ue.success},title:"Cleared",children:""})]})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:d?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),m?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),u.jsx("span",{children:r})]})]}),u.jsx("span",{style:{opacity:.5},children:""}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?u.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:i}):u.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[l&&u.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:l}),u.jsx("span",{children:i})]})]})]}),t.description&&u.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const C={padding:"0.6rem 0.5rem",background:S,display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...C,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:x})}),u.jsx("div",{style:{...C,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Je(t.amount)}),u.jsx("div",{style:{...C,justifyContent:"center"},children:u.jsx("span",{style:d?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...C,overflow:"hidden"},children:m?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),u.jsx("div",{style:{...C,justifyContent:"center",fontSize:"1rem"},children:u.jsx("span",{style:{opacity:.5},children:""})}),u.jsx("div",{style:{...C,justifyContent:"center"},children:u.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),u.jsx("div",{style:{...C,overflow:"hidden"},children:p?u.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:i}):u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[l&&u.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),u.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i})]})}),u.jsx("div",{style:{...C,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...C,justifyContent:"center",color:t.cleared?ue.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...C,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:v,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Ps={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Kz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ze(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=An(),{month:m,isLoading:p}=Ci(t,e,n),{addTransfer:g}=GP(),{updateTransfer:v}=WP(),{deleteTransfer:_}=KP(),E=fs(),[x,S]=k.useState(null),[C,T]=k.useState(!1),[A,L]=k.useState(null);function F(j){const M=j.account_group_id?l[j.account_group_id]:void 0;return M&&M.is_active!==null?M.is_active:j.is_active!==!1}function H(j){const M=j.account_group_id?l[j.account_group_id]:void 0;return M&&M.on_budget!==null?M.on_budget:j.on_budget!==!1}const O=Object.entries(o).filter(([,j])=>F(j)&&H(j));function I(j,M,R,K,W,q,Z,X){if(!t)return;S(null),T(!1);const{year:ne,month:B}=ym(q);(ne!==e||B!==n)&&(r(ne),i(B)),g(t,ne,B,j,M,R,K,W,q,Z,X).catch(G=>{S(G instanceof Error?G.message:"Failed to add transfer")})}function N(j,M,R,K,W,q,Z,X,ne){t&&(S(null),L(null),v(t,e,n,j,M,R,K,W,q,Z,X,ne).catch(B=>{S(B instanceof Error?B.message:"Failed to update transfer")}))}function U(j){t&&confirm("Are you sure you want to delete this transfer?")&&(S(null),_(t,e,n,j).catch(M=>{S(M instanceof Error?M.message:"Failed to delete transfer")}))}const $=O.length>=1&&Object.keys(d).length>=1;return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${ue.error} 15%, transparent)`,border:`1px solid ${ue.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ue.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:E?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:E?"block":"grid",gridTemplateColumns:E?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx(Fe,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!$,disabledReason:O.length===0&&Object.keys(d).length===0?"Create accounts and categories first":O.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!E&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:Ps,children:"Date"}),u.jsx("div",{style:{...Ps,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:{...Ps,textAlign:"center"},children:"From Cat"}),u.jsx("div",{style:Ps,children:"From Acct"}),u.jsx("div",{style:Ps}),u.jsx("div",{style:{...Ps,textAlign:"center"},children:"To Cat"}),u.jsx("div",{style:Ps,children:"To Acct"}),u.jsx("div",{style:Ps,children:"Description"}),u.jsx("div",{style:{...Ps,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:Ps})]})]}),!$&&u.jsx(Hu,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(X1,{accounts:O,accountGroups:l,categories:d,categoryGroups:h,defaultDate:gm(e,n),onSubmit:I,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),m?.transfers?.slice().sort((j,M)=>(j.date||"").localeCompare(M.date||"")).map((j,M)=>A===j.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(X1,{accounts:O,accountGroups:l,categories:d,categoryGroups:h,initialData:j,onSubmit:(R,K,W,q,Z,X,ne,B)=>N(j.id,R,K,W,q,Z,X,ne,B),onCancel:()=>L(null),onDelete:()=>U(j.id),submitLabel:"Save"})},j.id):u.jsx(Wz,{transfer:j,fromCategoryName:lt(j.from_category_id)?jo:d[j.from_category_id]?.name||"Unknown",toCategoryName:lt(j.to_category_id)?jo:d[j.to_category_id]?.name||"Unknown",fromAccountName:nt(j.from_account_id)?Aa:o[j.from_account_id]?.nickname||"Unknown",toAccountName:nt(j.to_account_id)?Aa:o[j.to_account_id]?.nickname||"Unknown",fromAccountGroupName:nt(j.from_account_id)?void 0:o[j.from_account_id]?.account_group_id?l[o[j.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:nt(j.to_account_id)?void 0:o[j.to_account_id]?.account_group_id?l[o[j.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:lt(j.from_category_id),isToCategoryNo:lt(j.to_category_id),isFromAccountNo:nt(j.from_account_id),isToAccountNo:nt(j.to_account_id),onEdit:()=>{j.description||`${j.amount}`,L(j.id)},onDelete:()=>U(j.id),isMobile:E,isEvenRow:M%2===0},j.id)),(!m?.transfers||m.transfers.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function Z1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o,defaultAccountId:l,defaultDate:d,onSubmit:h,onCancel:m,onDelete:p,submitLabel:g}){function v(_){h(_.amount,_.accountId,_.categoryId,_.date,_.payee,_.description,_.cleared)}return u.jsx(i_,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:i,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:l,defaultDate:d,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:v,onCancel:m,onDelete:p})}function Yz({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:i,onDelete:o,isMobile:l,isEvenRow:d}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",m=r?`${r} / ${n}`:n,p=d?"transparent":"rgba(255,255,255,0.04)";if(l)return u.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&u.jsx("span",{style:{fontSize:"0.7rem",color:ue.success},title:"Cleared",children:""})]}),u.jsx("span",{style:{fontWeight:600,color:Bt(t.amount),fontFamily:"monospace"},children:Gt(t.amount)})]}),u.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[u.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:m})]})]});const g={padding:"0.6rem 0.5rem",background:p,display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:u.jsx("span",{style:{opacity:.6},children:h})}),u.jsx("div",{style:{...g,justifyContent:"center"},children:u.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),u.jsx("div",{style:{...g,overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:m})}),u.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:Bt(t.amount),fontFamily:"monospace"},children:Gt(t.amount)}),u.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),u.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?ue.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),u.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[u.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),u.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const fo={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function Xz(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:i}=Ze(),{accounts:o,accountGroups:l,categories:d,categoryGroups:h}=An(),{month:m,isLoading:p}=Ci(t,e,n),{addAdjustment:g}=XP(),{updateAdjustment:v}=JP(),{deleteAdjustment:_}=ez(),E=fs(),[x,S]=k.useState(null),[C,T]=k.useState(!1),[A,L]=k.useState(null),O=F0(t,{enabled:C||A!==null}).data||[];function I(R){const K=R.account_group_id?l[R.account_group_id]:void 0;return K&&K.is_active!==null?K.is_active:R.is_active!==!1}function N(R){const K=R.account_group_id?l[R.account_group_id]:void 0;return K&&K.on_budget!==null?K.on_budget:R.on_budget!==!1}const U=Object.entries(o).filter(([,R])=>I(R)&&N(R));function $(R,K,W,q,Z,X,ne){if(!t)return;S(null),T(!1);const{year:B,month:G}=ym(q);(B!==e||G!==n)&&(r(B),i(G)),g(t,B,G,R,K,W,q,Z,X,ne).catch(te=>{S(te instanceof Error?te.message:"Failed to add adjustment")})}function j(R,K,W,q,Z,X,ne,B){t&&(S(null),L(null),v(t,e,n,R,K,W,q,Z,X,ne,B).catch(G=>{S(G instanceof Error?G.message:"Failed to update adjustment")}))}function M(R){t&&confirm("Are you sure you want to delete this adjustment?")&&(S(null),_(t,e,n,R).catch(K=>{S(K instanceof Error?K.message:"Failed to delete adjustment")}))}return u.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[x&&u.jsx("div",{style:{background:`color-mix(in srgb, ${ue.error} 15%, transparent)`,border:`1px solid ${ue.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ue.error},children:x}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:E?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:E?"block":"grid",gridTemplateColumns:E?void 0:"subgrid"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),u.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!C&&u.jsx(Fe,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(d).length===0&&U.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!E&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:fo,children:"Date"}),u.jsx("div",{style:{...fo,textAlign:"center"},children:"Category"}),u.jsx("div",{style:fo,children:"Account"}),u.jsx("div",{style:{...fo,textAlign:"right"},children:"Amount"}),u.jsx("div",{style:fo,children:"Description"}),u.jsx("div",{style:{...fo,textAlign:"center"},children:"Clr"}),u.jsx("div",{style:fo})]})]}),U.length===0&&Object.keys(d).length===0&&u.jsx(Hu,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),C&&u.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:u.jsx(Z1,{accounts:U,accountGroups:l,categories:d,categoryGroups:h,payees:O,defaultDate:gm(e,n),onSubmit:$,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),m?.adjustments?.slice().sort((R,K)=>(R.date||"").localeCompare(K.date||"")).map((R,K)=>A===R.id?u.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:u.jsx(Z1,{accounts:U,accountGroups:l,categories:d,categoryGroups:h,payees:O,initialData:R,onSubmit:(W,q,Z,X,ne,B,G)=>j(R.id,W,q,Z,X,ne,B,G),onCancel:()=>L(null),onDelete:()=>M(R.id),submitLabel:"Save"})},R.id):u.jsx(Yz,{adjustment:R,categoryName:lt(R.category_id)?jo:d[R.category_id]?.name||"Unknown Category",accountName:nt(R.account_id)?Aa:o[R.account_id]?.nickname||"Unknown Account",accountGroupName:nt(R.account_id)?void 0:o[R.account_id]?.account_group_id?l[o[R.account_id].account_group_id]?.name:void 0,onEdit:()=>{R.description||`${R.amount}`,L(R.id)},onDelete:()=>M(R.id),isMobile:E,isEvenRow:K%2===0},R.id)),(!m?.adjustments||m.adjustments.length===0)&&!C&&u.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function Zz({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:i}=sr(),{selectedBudgetId:o,currentYear:l,currentMonthNumber:d}=Ze(),{deleteAllocations:h}=ZT(),[m,p]=k.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:l,month:d}),e(),n?.()}catch(v){p(v instanceof Error?v.message:"Failed to delete allocations")}finally{i("allocations-delete")}}};return u.jsxs(ls,{isOpen:t,onClose:e,title:"Delete Allocations",children:[m&&u.jsx(fc,{message:m,onDismiss:()=>p(null)}),u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Fe,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),u.jsx(Fe,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function iA({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:r,balanceTotals:i,draftChangeAmount:o,availableAfterApply:l,currentDraftTotal:d}){const h=t&&d!==void 0?d:i.allocated;return u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?u.jsx("span",{style:{color:Bt(n),fontWeight:600},children:Je(n)}):u.jsxs("span",{style:{color:ue.success,fontWeight:600},children:["+",Je(r)]})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:" "}),u.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),u.jsxs("span",{style:{color:gc(t?h:i.allocated),fontWeight:600,...t?as:{}},children:[t?"":"+",Je(t?h:i.allocated)]}),e&&o!==0&&u.jsxs("span",{style:{fontSize:"0.85em",color:o>0?ue.warning:ue.success,marginLeft:"0.25rem"},children:["(",Gt(o),")"]})]}),!t&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Spent: "}),u.jsx("span",{style:{color:pc(i.spent),fontWeight:600},children:Pa(i.spent)})]}),u.jsxs("span",{children:[t&&u.jsx("span",{style:{opacity:.6},children:"= "}),u.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?u.jsx("span",{style:{color:Bt(l),fontWeight:600,...as},children:Je(l)}):u.jsx("span",{style:{color:Bt(i.allocated+i.spent),fontWeight:600},children:Je(i.allocated+i.spent)})]})]})}function Jz({totals:t}){return u.jsxs(u.Fragment,{children:[u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Start: "}),u.jsx("span",{style:{color:Bt(t.start),fontWeight:600},children:Je(t.start)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Inc: "}),u.jsxs("span",{style:{color:ue.success,fontWeight:600},children:["+",Je(t.income)]})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Exp: "}),u.jsx("span",{style:{color:pc(t.expenses),fontWeight:600},children:Pa(t.expenses)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"End: "}),u.jsx("span",{style:{color:Bt(t.end),fontWeight:600},children:Je(t.end)})]})]})}function a_({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:i,onEdit:o,onCancel:l,onDelete:d}){return u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&u.jsxs(u.Fragment,{children:[u.jsx(Fe,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),u.jsx(Fe,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&u.jsx(Fe,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&u.jsxs(u.Fragment,{children:[u.jsx(Fe,{actionName:"Apply Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),u.jsx(Fe,{actionName:"Cancel Edit Allocations",onClick:l,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),u.jsx(Fe,{actionName:"Open Delete Allocations Modal",onClick:d,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:ue.error},children:""})]})]})}function J1(t){return t===0?ue.zero:t>0?ue.success:ue.error}function eB({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,projectedAllTime:l}){const d=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=d?t.default_monthly_amount/100*r:0,m=d?h.toFixed(2):n,p=i&&!d,g=i?l:t.balance??0,v=t.balance??0,_=v<0,E=_?Math.abs(v):0,x=d?h:parseFloat(n)||0,S=_?Math.min(x,E):0,C=_?Math.max(0,x-E):0,T=_&&x>0&&C>0;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.name})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{style:{color:Fn(e.start_balance)},children:os(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:m?`$${m}`:"",onChange:A=>{const L=A.target.value.replace(/[^\d.]/g,"");o(L)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),_&&x>0&&u.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[u.jsxs("span",{style:{color:ue.debt,display:"block"},children:[Je(S),"  debt"]}),T&&u.jsxs("span",{style:{color:ue.success,display:"block"},children:[Je(C),"  balance"]})]})]}):u.jsx("span",{style:{color:gc(e.allocated)},children:Gt(e.allocated)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),u.jsx("span",{style:{color:pc(e.spent)},children:Pa(e.spent)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:Fn(e.end_balance),...i&&!d?as:{}},children:os(e.end_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:i?"Proj. All-Time":"All-Time"}),u.jsx("span",{style:{color:Fn(g),...i&&!d?as:{}},children:os(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&u.jsxs("span",{style:{color:J1(e.transfers)},children:[Gt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{style:{color:J1(e.adjustments)},children:[Gt(e.adjustments)," adjust"]})]}),i&&d&&u.jsx("div",{style:{marginTop:"0.5rem"},children:u.jsxs("span",{style:{fontSize:"0.8rem"},children:[u.jsxs("span",{style:{opacity:.6},children:[Je(r),"  "]}),u.jsxs("span",{style:{color:ue.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.6},children:" = "}),u.jsx("span",{style:{color:ue.success},children:Je(h)})]})})]})}function Lf(t){return t===0?ue.zero:t>0?ue.success:ue.error}function eS({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:i,savedAllocations:o,previousMonthIncome:l,isDraftMode:d,onAllocationChange:h,isMobile:m,isUngrouped:p,getAllocationAmount:g}){const v={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Of,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},_=n.allocated+n.spent+n.transfers+n.adjustments,E=e.reduce((x,[S,C])=>{const T=C.balance??0;if(d){const A=g(S,C),L=o[S]??0,F=A-L;return x+T+F}return x+T},0);return u.jsxs("div",{style:{display:"contents"},children:[!m&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...v,paddingLeft:"0.5rem",opacity:p?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Fn(n.start)},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:d?"center":"flex-end",color:gc(n.allocated)},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:pc(n.spent)},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Lf(n.transfers)},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Lf(n.adjustments)},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Fn(_)},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Fn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:wn.showGroupTotals}),u.jsx("div",{style:{...v,justifyContent:"flex-end",color:Fn(E)},children:wn.showGroupTotals})]}),!d&&m&&u.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Of,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:p?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),wn.showGroupTotals]}),e.map(([x,S],C)=>{const T=r(x);if(!T)return null;const A=S.balance??0;let L=A;if(d){const F=g(x,S),H=o[x]??0,O=F-H;L=A+O}return m?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(eB,{category:S,balance:T,localAllocation:i[x]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:F=>h(x,F),projectedAllTime:L})},x):u.jsx(tB,{category:S,balance:T,localAllocation:i[x]||"",previousMonthIncome:l,isDraftMode:d,onAllocationChange:F=>h(x,F),allTimeBalance:L,isEvenRow:C%2===0},x)})]})}function tB({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:i,onAllocationChange:o,allTimeBalance:l,isEvenRow:d}){const h=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,m=h?t.default_monthly_amount/100*r:0,p=h?m.toFixed(2):n,g=t.balance??0,v=g<0,_=v?Math.abs(g):0,E=h?m:parseFloat(n)||0,x=v?Math.min(E,_):0,S=v?Math.max(0,E-_):0,C=v&&E>0&&S>0,T=d?"transparent":"rgba(255,255,255,0.04)",A={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",background:T,display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},L=e.allocated+e.spent+e.transfers+e.adjustments;return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",background:T,display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:Fn(e.start_balance)},children:os(e.start_balance)}),i?u.jsx("div",{style:{...A,justifyContent:"center",flexDirection:"column",gap:"0.1rem",paddingTop:"0.35rem",paddingBottom:"0.35rem"},children:h?u.jsxs("span",{style:{fontSize:"0.85rem"},children:[u.jsxs("span",{style:{color:ue.success},children:[t.default_monthly_amount,"%"]}),u.jsx("span",{style:{opacity:.5},children:" = "}),u.jsx("span",{style:{color:ue.success},children:Je(m)})]}):u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",inputMode:"decimal",value:p?`$${p}`:"",onChange:F=>{const H=F.target.value.replace(/[^\d.]/g,"");o(H)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),v&&E>0&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[u.jsxs("span",{style:{color:ue.debt},children:[Je(x),"  debt"]}),C&&u.jsxs("span",{style:{color:ue.success},children:[Je(S),"  bal"]})]})]})}):(()=>{const F=e.start_balance<0,H=F?Math.abs(e.start_balance):0,O=F?Math.min(e.allocated,H):0,I=F?Math.max(0,e.allocated-H):0,N=F&&e.allocated>0;return u.jsxs("div",{style:{...A,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:gc(e.allocated)},children:[u.jsxs("span",{children:["+",Je(e.allocated)]}),N&&u.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[u.jsxs("span",{style:{color:ue.debt},children:[Je(O),"  debt"]}),I>0&&u.jsxs("span",{style:{color:ue.success},children:[Je(I),"  bal"]})]})]})})(),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:pc(e.spent)},children:Pa(e.spent)}),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:Lf(e.transfers)},children:Gt(e.transfers)}),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:Lf(e.adjustments)},children:Gt(e.adjustments)}),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:Fn(L),...i&&!h?as:{}},children:Gt(L)}),u.jsx("div",{style:{...A,justifyContent:"flex-end",fontWeight:600,color:Fn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...i&&!h?as:{}},children:os(e.end_balance)}),u.jsx("div",{style:{...A,justifyContent:"flex-end",color:Fn(l),...i&&!h?as:{}},children:os(l)})]})}function nB(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,i])=>n||!i.is_hidden).reduce((i,[o,l])=>{const d=l.category_group_id||"ungrouped";return i[d]||(i[d]=[]),i[d].push([o,l]),i},{});return Object.keys(r).forEach(i=>{r[i].sort((o,l)=>o[1].sort_order-l[1].sort_order)}),r}function rB(t,e,n,r,i){const o={};t?.category_balances&&t.category_balances.forEach(d=>{o[d.category_id]=d});const l={};return Object.entries(e).forEach(([d,h])=>{const m=o[d],p=m?.start_balance??0,g=m?.spent??0;let v=0;n?v=i(d,h):r&&m&&(v=m.allocated);let _=0;t?.transfers&&t.transfers.forEach(x=>{x.to_category_id===d&&(_+=x.amount),x.from_category_id===d&&(_-=x.amount)});let E=0;t?.adjustments&&(E=t.adjustments.filter(x=>x.category_id===d).reduce((x,S)=>x+S.amount,0)),l[d]={category_id:d,start_balance:p,allocated:v,spent:g,transfers:_,adjustments:E,end_balance:p+v+g+_+E}}),l}function sB(t,e){const n={};t?.account_balances&&t.account_balances.forEach(i=>{n[i.account_id]=i});const r={};return Object.entries(e).forEach(([i,o])=>{const d=n[i]?.start_balance??o.balance;let h=0;t?.income&&(h=t.income.filter(_=>_.account_id===i).reduce((_,E)=>_+E.amount,0));let m=0;t?.expenses&&(m=t.expenses.filter(_=>_.account_id===i).reduce((_,E)=>_+E.amount,0));let p=0;t?.transfers&&t.transfers.forEach(_=>{_.to_account_id===i&&(p+=_.amount),_.from_account_id===i&&(p-=_.amount)});let g=0;t?.adjustments&&(g=t.adjustments.filter(_=>_.account_id===i).reduce((_,E)=>_+E.amount,0));const v=h+m+p+g;r[i]={account_id:i,start_balance:d,income:h,expenses:m,transfers:p,adjustments:g,net_change:v,end_balance:d+v}}),r}function iB(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function aB(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+n.end_balance}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function tS(t){return t===0?ue.zero:t>0?ue.success:ue.error}function oB({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h}){const m={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...m,gap:"0.75rem"},children:["Grand Totals",!t&&u.jsx(a_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:i,onApply:o,onEdit:l,onCancel:d,onDelete:h})]}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:Fn(n.start)},children:os(n.start)}),u.jsxs("div",{style:{...m,justifyContent:t?"center":"flex-end",color:gc(n.allocated),...t?as:{}},children:["+",Je(n.allocated)]}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:pc(n.spent)},children:Pa(n.spent)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:tS(n.transfers)},children:Gt(n.transfers)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:tS(n.adjustments)},children:Gt(n.adjustments)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:Fn(p),...t?as:{}},children:Gt(p)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:Fn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)",...t?as:{}},children:os(n.end)}),u.jsx("div",{style:{...m,justifyContent:"flex-end",color:Fn(r),...t?as:{}},children:os(r)})]})}function lB({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l,onSave:d,onApply:h,onEdit:m,onCancel:p,onDelete:g}){return u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(iA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:i,availableAfterApply:o,currentDraftTotal:l}),u.jsx(a_,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:d,onApply:h,onEdit:m,onCancel:p,onDelete:g})]})}const di={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function cB(t){if(!t)return"";switch(t.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return t.currentMonth?`Recalculating ${t.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}}function uB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ze(),{categories:r,categoryGroups:i,monthMap:o}=An(),{month:l}=Ci(t,e,n),d=fs(),[h,m]=k.useState(null);dd({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:G=>m(G),logPrefix:"[MonthCategories]"});const[p,g]=k.useState(!1),{localAllocations:v,isEditingAppliedAllocations:_,error:E,availableNow:x,currentDraftTotal:S,draftChangeAmount:C,availableAfterApply:T,previousMonthIncome:A,currentMonthIncome:L,allocationsFinalized:F,getAllocationAmount:H,handleAllocationChange:O,resetAllocationsToSaved:I,handleSaveAllocations:N,handleFinalizeAllocations:U,setIsEditingAppliedAllocations:$,setError:j}=a3(),M=[...i].sort((G,te)=>G.sort_order-te.sort_order),R=k.useMemo(()=>nB(r),[r]),K=!F||_,W=k.useMemo(()=>rB(l,r,K,F,H),[l,r,K,F,H]),q=G=>W[G],Z=k.useMemo(()=>aB(W),[W]),X=k.useMemo(()=>{const G={};if(l?.category_balances)for(const te of l.category_balances)G[te.category_id]=te.allocated;return G},[l]),ne=k.useMemo(()=>Object.entries(r).reduce((G,[te,ie])=>{const ae=ie.balance??0;if(K){const fe=H(te,ie),Ee=X[te]??0,me=fe-Ee;return G+ae+me}return G+ae},0),[r,K,H,X]),B={onSave:N,onApply:U,onEdit:()=>$(!0),onCancel:I,onDelete:()=>g(!0)};return u.jsxs(u.Fragment,{children:[h&&u.jsxs(n_,{message:cB(h),spinnerColor:"#22c55e",children:[u.jsx(rA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),u.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&u.jsx(Bf,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&u.jsx(Bf,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),u.jsx(sA,{percent:h.percentComplete})]}),E&&u.jsx(fc,{message:E,onDismiss:()=>j(null)}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":K?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:d?"block":"grid",gridTemplateColumns:d?void 0:"subgrid"},children:[K&&u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:d?"column":"row",flexWrap:"wrap",alignItems:d?"stretch":"center",gap:d?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:d?"0.5rem":"0.25rem"},children:[u.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:d?void 0:1,alignItems:"center"},children:u.jsx(iA,{isDraftMode:K,isEditingAppliedAllocations:_,availableNow:x,currentMonthIncome:L,balanceTotals:Z,draftChangeAmount:C,availableAfterApply:T,currentDraftTotal:S})}),u.jsx(a_,{isDraftMode:K,isEditingAppliedAllocations:_,allocationsFinalized:F,...B})]}),!d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:di,children:"Category"}),u.jsx("div",{style:{...di,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...di,textAlign:K?"center":"right"},children:"Allocated"}),u.jsx("div",{style:{...di,textAlign:"right"},children:"Spent"}),u.jsx("div",{style:{...di,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...di,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...di,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...di,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),u.jsx("div",{style:{...di,textAlign:"right"},children:"All-Time"})]}),!d&&u.jsx(oB,{isDraftMode:K,allocationsFinalized:F,balanceTotals:Z,grandAllTime:ne,...B}),!K&&d&&u.jsx(lB,{allocationsFinalized:F,availableNow:x,currentMonthIncome:L,balanceTotals:Z,draftChangeAmount:C,availableAfterApply:T,currentDraftTotal:S,...B})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",u.jsx(Cn,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),M.map(G=>{const te=R[G.id]||[];if(te.length===0)return null;const ie=te.reduce((ae,[fe])=>{const Ee=q(fe);return Ee?{start:ae.start+Ee.start_balance,allocated:ae.allocated+Ee.allocated,spent:ae.spent+Ee.spent,transfers:ae.transfers+Ee.transfers,adjustments:ae.adjustments+Ee.adjustments,end:ae.end+Ee.end_balance}:ae},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(eS,{name:G.name,categories:te,groupTotals:ie,getCategoryBalance:q,localAllocations:v,savedAllocations:X,previousMonthIncome:A,isDraftMode:K,onAllocationChange:O,isMobile:d,getAllocationAmount:H},G.id)}),R[Sn]?.length>0&&(()=>{const G=R[Sn],te=G.reduce((ie,[ae])=>{const fe=q(ae);return fe?{start:ie.start+fe.start_balance,allocated:ie.allocated+fe.allocated,spent:ie.spent+fe.spent,transfers:ie.transfers+fe.transfers,adjustments:ie.adjustments+fe.adjustments,end:ie.end+fe.end_balance}:ie},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return u.jsx(eS,{name:"Uncategorized",categories:G,groupTotals:te,getCategoryBalance:q,localAllocations:v,savedAllocations:X,previousMonthIncome:A,isDraftMode:K,onAllocationChange:O,isMobile:d,isUngrouped:!0,getAllocationAmount:H},Sn)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),u.jsx(Zz,{isOpen:p,onClose:()=>g(!1),onDeleted:()=>$(!1)})]})}function aA(t){return t===0?ue.zero:t>0?ue.success:ue.error}function oA(t){return t===0?ue.zero:t<0?ue.error:ue.success}function Bl(t){return t===0?ue.zero:t>0?ue.success:ue.error}function nS({name:t,accounts:e,groupTotals:n,accountBalances:r,isMobile:i,isUngrouped:o}){const l={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Of,background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return u.jsxs("div",{style:{display:"contents"},children:[!i&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{...l,opacity:o?.7:1},children:[u.jsx("span",{children:t}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:Bt(n.start)},children:wn.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:aA(n.income)},children:wn.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:oA(n.expenses)},children:wn.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:Bl(n.transfers)},children:wn.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:Bl(n.adjustments)},children:wn.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:Bl(n.netChange)},children:wn.showGroupTotals}),u.jsx("div",{style:{...l,justifyContent:"flex-end",color:Bt(n.end)},children:wn.showGroupTotals})]}),i&&u.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",borderBottom:Of,background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("span",{style:{fontWeight:600,opacity:o?.7:1},children:[t,u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),wn.showGroupTotals]}),e.map(([d,h],m)=>{const p=r[d];return p?i?u.jsx("div",{style:{gridColumn:"1 / -1"},children:u.jsx(hB,{account:h,balance:p})},d):u.jsx(dB,{account:h,balance:p,isEvenRow:m%2===0},d):null})]})}function dB({account:t,balance:e,isEvenRow:n}){const i={padding:"0.5rem 0.5rem",background:n?"transparent":"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem"};return u.jsxs("div",{style:{display:"contents"},children:[u.jsx("div",{style:{...i,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),u.jsx("div",{style:{...i,justifyContent:"flex-end",color:Bt(e.start_balance)},children:Je(e.start_balance)}),u.jsxs("div",{style:{...i,justifyContent:"flex-end",color:aA(e.income)},children:["+",Je(e.income)]}),u.jsx("div",{style:{...i,justifyContent:"flex-end",color:oA(e.expenses)},children:Pa(e.expenses)}),u.jsx("div",{style:{...i,justifyContent:"flex-end",color:Bl(e.transfers)},children:Gt(e.transfers)}),u.jsx("div",{style:{...i,justifyContent:"flex-end",color:Bl(e.adjustments)},children:Gt(e.adjustments)}),u.jsx("div",{style:{...i,justifyContent:"flex-end",color:Bl(e.net_change)},children:Gt(e.net_change)}),u.jsx("div",{style:{...i,justifyContent:"flex-end",fontWeight:600,color:Bt(e.end_balance)},children:Je(e.end_balance)})]})}function hB({account:t,balance:e}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx("span",{style:{fontWeight:500},children:t.nickname})}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),u.jsx("span",{children:Je(e.start_balance)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),u.jsx("span",{style:{color:Bt(e.net_change)},children:Gt(e.net_change)})]}),u.jsxs("div",{children:[u.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),u.jsx("span",{style:{color:Bt(e.end_balance)},children:Je(e.end_balance)})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&u.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&u.jsxs("span",{children:[Gt(e.income)," income"]}),e.expenses!==0&&u.jsxs("span",{children:[Pa(e.expenses)," expenses"]}),e.transfers!==0&&u.jsxs("span",{children:[Gt(e.transfers)," transfers"]}),e.adjustments!==0&&u.jsxs("span",{children:[Gt(e.adjustments)," adjust"]})]})]})}const aa={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function fB(t){return t===0?ue.zero:t>0?ue.success:ue.error}function mB(t){return t===0?ue.zero:t<0?ue.error:ue.success}function Zg(t){return t===0?ue.zero:t>0?ue.success:ue.error}function pB(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Ze(),{accounts:r,accountGroups:i,monthMap:o}=An(),{month:l}=Ci(t,e,n),d=fs(),[h,m]=k.useState(null);dd({budgetId:t,year:e,month:n,monthMap:o,requireMonthLoaded:!0,currentMonth:l,onProgress:T=>m(T),logPrefix:"[MonthAccounts]"});const p=k.useMemo(()=>Object.entries(i).map(([T,A])=>({id:T,...A})).sort((T,A)=>T.sort_order-A.sort_order),[i]),g=k.useMemo(()=>{const T={};return Object.entries(r).filter(([,A])=>!A.is_hidden).forEach(([A,L])=>{const F=L.account_group_id||pn;T[F]||(T[F]=[]),T[F].push([A,L])}),Object.keys(T).forEach(A=>{T[A].sort((L,F)=>L[1].sort_order-F[1].sort_order)}),T},[r]),v=k.useMemo(()=>sB(l,r),[l,r]),_=k.useMemo(()=>iB(v),[v]),E=_.income+_.expenses,S={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600},C=()=>{if(!h)return"";switch(h.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return h.currentMonth?`Recalculating ${h.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}};return u.jsxs(u.Fragment,{children:[h&&u.jsxs(n_,{message:C(),spinnerColor:"#22c55e",children:[u.jsx(rA,{percent:h.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),u.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(h.totalMonthsToFetch??0)>0&&u.jsx(Bf,{value:`${h.monthsFetched||0}/${h.totalMonthsToFetch}`,label:"Months Loaded",color:h.phase==="fetching-months"?"#22c55e":"#6b7280"}),(h.totalMonths??0)>0&&u.jsx(Bf,{value:`${h.monthsProcessed}/${h.totalMonths}`,label:"Months Recalculated",color:h.phase==="recalculating"?"#22c55e":"#6b7280"})]}),u.jsx(sA,{percent:h.percentComplete})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"},children:[u.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:d?"block":"grid",gridTemplateColumns:d?void 0:"subgrid"},children:[!d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:aa,children:"Account"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Start"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Income"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Expenses"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Transfers"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Adjust"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"Net Change"}),u.jsx("div",{style:{...aa,textAlign:"right"},children:"End"})]}),d?u.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[u.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),u.jsx(Jz,{totals:_})]}):u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{...S},children:"Grand Totals"}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:Bt(_.start)},children:Je(_.start)}),u.jsxs("div",{style:{...S,justifyContent:"flex-end",color:fB(_.income)},children:["+",Je(_.income)]}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:mB(_.expenses)},children:Pa(_.expenses)}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:Zg(_.transfers)},children:Gt(_.transfers)}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:Zg(_.adjustments)},children:Gt(_.adjustments)}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:Zg(E)},children:Gt(E)}),u.jsx("div",{style:{...S,justifyContent:"flex-end",color:Bt(_.end)},children:Je(_.end)})]})]}),Object.keys(r).length===0&&u.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",u.jsx(Cn,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),p.map(T=>{const A=g[T.id]||[];if(A.length===0)return null;const L=A.reduce((F,[H])=>{const O=v[H];return O?{start:F.start+O.start_balance,income:F.income+O.income,expenses:F.expenses+O.expenses,transfers:F.transfers+O.transfers,adjustments:F.adjustments+O.adjustments,netChange:F.netChange+O.net_change,end:F.end+O.end_balance}:F},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(nS,{name:T.name,accounts:A,groupTotals:L,accountBalances:v,isMobile:d},T.id)}),g[pn]?.length>0&&(()=>{const T=g[pn],A=T.reduce((L,[F])=>{const H=v[F];return H?{start:L.start+H.start_balance,income:L.income+H.income,expenses:L.expenses+H.expenses,transfers:L.transfers+H.transfers,adjustments:L.adjustments+H.adjustments,netChange:L.netChange+H.net_change,end:L.end+H.end_balance}:L},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return u.jsx(nS,{name:"Ungrouped",accounts:T,groupTotals:A,accountBalances:v,isMobile:d,isUngrouped:!0},pn)})(),u.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const gB=["income","categories","accounts","spend","transfers","adjustments"];function rS(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&gB.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function yB(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function sS(){const t=L2(),e=Ku(),[n,r]=TS(),{addLoadingHold:i,removeLoadingHold:o}=sr(),{selectedBudgetId:l,setSelectedBudgetId:d,currentYear:h,currentMonthNumber:m,lastActiveTab:p,setCurrentYear:g,setCurrentMonthNumber:v,setLastActiveTab:_,setPageTitle:E,goToPreviousMonth:x,goToNextMonth:S,hasPendingInvites:C,needsFirstBudget:T,initialDataLoadComplete:A}=Ze(),{budget:L,isLoading:F,monthMap:H}=An(),O=!F,[I,N]=k.useState(!1);k.useEffect(()=>(!O||!A?i("budget-data","Loading budget data..."):o("budget-data"),()=>o("budget-data")),[O,A,i,o]);const U=k.useRef(!1),$=n.get("error"),[j,M]=k.useState($);k.useEffect(()=>{$&&(n.delete("error"),r(n,{replace:!0}))},[$,n,r]);const[R,K]=k.useState(()=>{const{tab:te}=rS(t);return te??p}),W=te=>{K(te),_(te)};k.useEffect(()=>{if(U.current)return;const{year:te,month:ie}=rS(t);te&&g(te),ie&&v(ie),U.current=!0},[t,g,v]),k.useEffect(()=>{if(!U.current)return;const te=`/budget/${h}/${m}/${R}`,ie=`/budget/${t.year}/${t.month}/${t.tab}`;te!==ie&&e(te,{replace:!0})},[h,m,R,e,t]);const{month:q,error:Z,isLoading:X}=Ci(O?l:null,h,m);k.useEffect(()=>{if(!Z||I)return;const te=Z.message||"";if(te.includes("Budget")&&te.includes("does not exist")){queueMicrotask(()=>{d(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}(te.includes("months in the past")||te.includes("Refusing to create month"))&&queueMicrotask(()=>{i("month-redirect","Redirecting to current month..."),N(!0);const{year:ie,month:ae}=yB();M(`Cannot create month ${h}/${m} - it's too far in the past. Redirected to current month.`),g(ie),v(ae)})},[Z,I,h,m,g,v,i,d,e]),k.useEffect(()=>{I&&q&&!X&&queueMicrotask(()=>{N(!1),o("month-redirect")})},[I,q,X,o]),k.useLayoutEffect(()=>{E(L?.name||"Budget")},[L?.name,E]);const{setCurrentViewingDocument:ne}=Ze();if(k.useEffect(()=>(L&&h&&m&&ne({type:"month",year:h,month:m}),()=>{ne({type:null})}),[L,h,m,ne]),k.useEffect(()=>{if(O&&!I){if(!L&&!l){e("/budget/my-budgets",{replace:!0});return}if(!L&&C){e("/budget/my-budgets",{replace:!0});return}if(T){e("/budget/my-budgets",{replace:!0});return}}},[O,I,L,l,C,T,e]),x3(l,h,m),dd({budgetId:l,year:h,month:m,monthMap:H,additionalCondition:O&&!!L,logPrefix:"[Budget]"}),!O||!A||I||!L)return null;function B(){M(null),x()}function G(){M(null),S()}return u.jsxs(u.Fragment,{children:[j&&u.jsx(fc,{message:j,onDismiss:()=>M(null)}),u.jsx(zz,{onPreviousMonth:B,onNextMonth:G}),u.jsx(Cz,{activeTab:R,setActiveTab:W,allocationsFinalized:q?.are_allocations_finalized}),R==="income"&&u.jsx(Vz,{},`${h}-${m}`),R==="categories"&&u.jsx(uB,{},`${h}-${m}`),R==="accounts"&&u.jsx(pB,{},`${h}-${m}`),R==="spend"&&u.jsx(qz,{},`${h}-${m}`),R==="transfers"&&u.jsx(Kz,{},`${h}-${m}`),R==="adjustments"&&u.jsx(Xz,{},`${h}-${m}`)]})}function _B(){const{setPageTitle:t}=Ze();return k.useLayoutEffect(()=>{t("Analytics")},[t]),u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[u.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),u.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),u.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),u.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),u.jsx(Cn,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:ue.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function bB(){const t=Ft();return{createBudget:Hn({mutationFn:async({name:n,userId:r,userEmail:i})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString(),d={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:i,accounts:{},account_groups:{[pn]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},categories:{},category_groups:[{id:Sn,name:"Uncategorized",sort_order:0}],total_available:0,is_needs_recalculation:!1,month_map:{},created_at:l,updated_at:l};return await qn("budgets",o,d,"creating new budget document"),await qn("users",r,{uid:r,email:i,budget_ids:Uu(o),updated_at:l},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...d}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:ke.user(r)}),t.invalidateQueries({queryKey:ke.accessibleBudgets(r)})}})}}function vB(){const t=Ft();return{acceptInvite:Hn({mutationFn:async({budgetId:n,userId:r})=>{const i=new Date().toISOString(),{exists:o,data:l}=await At("budgets",n,"validating user was invited to this budget");if(!o||!l)throw new Error("Budget not found");if(!l.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(l.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await qn("users",r,{uid:r,budget_ids:Uu(n),updated_at:i},"adding accepted budget to user's budget list",{merge:!0}),await qn("budgets",n,{accepted_user_ids:Uu(r),updated_at:i},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:ke.user(r)}),t.invalidateQueries({queryKey:ke.accessibleBudgets(r)}),t.invalidateQueries({queryKey:ke.budget(n.budgetId)})}})}}function xB(){const t=Ft(),e=Hn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=ke.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:[...d.budget.user_ids,o]}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r,{exists:l,data:d}=await At("budgets",i,"validating user is not already invited");if(!l||!d)throw new Error("Budget not found");if(d.user_ids?.includes(o))throw new Error("User is already invited");return await vm({budgetId:i,updates:{user_ids:Uu(o)},description:"adding user to budget's invited users list"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.budget(i.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function wB(){const t=Ft(),e=Hn({onMutate:async r=>{const{budgetId:i,userId:o}=r,l=ke.budget(i);await t.cancelQueries({queryKey:l});const d=t.getQueryData(l);return d&&t.setQueryData(l,{...d,budget:{...d.budget,user_ids:d.budget.user_ids.filter(h=>h!==o),accepted_user_ids:d.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:d}},mutationFn:async r=>{const{budgetId:i,userId:o}=r;return await vm({budgetId:i,updates:{user_ids:D1(o),accepted_user_ids:D1(o)},description:"removing user from budget's access lists"}),{budgetId:i}},onError:(r,i,o)=>{o?.previousData&&t.setQueryData(ke.budget(i.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function SB({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function EB({message:t,onDismiss:e}){return u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:t}),u.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function CB({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:i,onCheckInvite:o,onAcceptInvite:l,onCancel:d}){return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Join Budget by ID"]}),u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?u.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[u.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[u.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&u.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[u.jsx("button",{onClick:l,disabled:i===r.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:1},children:i===r.budgetId?"Accepting...":"Accept Invitation"}),u.jsx("button",{onClick:d,disabled:i===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:i===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:i===r.budgetId?.7:.8},children:"Cancel"})]})]}):u.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function TB({currentUserId:t}){return u.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[u.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),u.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function AB(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{selectedBudgetId:n,currentUserId:r,accessibleBudgets:i,loadAccessibleBudgets:o,switchToBudget:l,checkBudgetInvite:d,isInitialized:h,setPageTitle:m,needsFirstBudget:p}=Ze(),{requireUserEmail:g}=Da(),v=k.useRef(!1),[_,E]=TS(),x=_.get("context");k.useEffect(()=>{x&&(_.delete("context"),E(_,{replace:!0}))},[x,_,E]);const S=x==="budget-not-found",C=p&&i.length===0;k.useLayoutEffect(()=>{m("My Budgets")},[m]),k.useEffect(()=>{h&&!v.current&&(v.current=!0,o())},[h,o]);const{budget:T,isLoading:A}=An(),{renameBudget:L}=r3(),{acceptInvite:F}=vB(),{createBudget:H}=bB(),[O,I]=k.useState(null),[N,U]=k.useState(null),[$,j]=k.useState(null),[M,R]=k.useState(null),[K,W]=k.useState(null),[q,Z]=k.useState(""),[X,ne]=k.useState(!1),[B,G]=k.useState(""),[te,ie]=k.useState(!1),[ae,fe]=k.useState(null),[Ee,me]=k.useState(""),[Ce,he]=k.useState(!1);async function Me(oe){if(oe!==T?.id){I(oe),j(null),R(null);try{await l(oe),R("Switched to budget successfully!"),await o({force:!0})}catch(je){j(je instanceof Error?je.message:"Failed to switch budget")}finally{I(null)}}}async function qe(oe){if(r){U(oe),j(null),R(null);try{await F.mutateAsync({budgetId:oe,userId:r}),R("Invitation accepted! You now have access to this budget."),await o({force:!0})}catch(je){j(je instanceof Error?je.message:"Failed to accept invitation")}finally{U(null)}}}async function Oe(oe){if(oe.preventDefault(),!!B.trim()){ie(!0),j(null),fe(null);try{const je=await d(B.trim());je?fe(je):j("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(je){j(je instanceof Error?je.message:"Failed to check invitation")}finally{ie(!1)}}}async function z(){if(!(!ae||!r)){ae.budgetName,U(ae.budgetId),j(null);try{await F.mutateAsync({budgetId:ae.budgetId,userId:r}),R(`Successfully joined "${ae.budgetName}"!`),fe(null),G(""),await o({force:!0})}catch(oe){j(oe instanceof Error?oe.message:"Failed to accept invitation")}finally{U(null)}}}function ce(oe,je){Z(je),W(oe)}async function pe(oe){if(oe.preventDefault(),!(!q.trim()||!K||!n)){q.trim(),ne(!0),j(null),R(null);try{await L.mutateAsync({budgetId:n,newName:q.trim()}),R("Budget renamed successfully!"),W(null),await o({force:!0})}catch(je){j(je instanceof Error?je.message:"Failed to rename budget")}finally{ne(!1)}}}async function ee(oe){if(oe.preventDefault(),!!r){Ee.trim(),he(!0),j(null),R(null);try{const je=await H.mutateAsync({name:Ee.trim()||"My Budget",userId:r,userEmail:g()});await l(je.budgetId),R("Budget created successfully!"),me(""),await o({force:!0})}catch(je){j(je instanceof Error?je.message:"Failed to create budget")}finally{he(!1)}}}const J=i.filter(oe=>!oe.isPending),se=i.filter(oe=>oe.isPending);if(k.useEffect(()=>(A||!h?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[A,h,t,e]),A||!h)return null;let xe="My Budgets",Se="Switch between budgets, accept invitations, or create a new budget.";return S?(xe="Budget Not Found",Se="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):C&&(xe="Welcome!",Se="Get started by creating your first budget or accepting an invitation."),u.jsxs("div",{children:[u.jsx("h1",{children:xe}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:Se}),$&&u.jsx(SB,{message:$,onDismiss:()=>j(null)}),M&&u.jsx(EB,{message:M,onDismiss:()=>R(null)}),se.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Pending Invitations (",se.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:se.map(oe=>u.jsx($1,{budget:oe,isCurrent:!1,isAccepting:N===oe.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>qe(oe.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},oe.id))})]}),J.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Your Budgets (",J.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:J.map(oe=>u.jsx($1,{budget:oe,isCurrent:oe.id===n,isAccepting:!1,isSwitching:O===oe.id,isEditing:K===oe.id,editName:K===oe.id?q:"",isRenaming:X,onAccept:()=>{},onSwitch:()=>Me(oe.id),onStartEdit:()=>ce(oe.id,oe.name),onCancelEdit:()=>{W(null),Z("")},onEditNameChange:Z,onSaveEdit:pe},oe.id))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""})," Create New Budget"]}),u.jsxs("form",{onSubmit:ee,children:[u.jsxs("div",{style:{marginBottom:"1rem"},children:[u.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),u.jsx("input",{type:"text",value:Ee,onChange:oe=>me(oe.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),u.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),u.jsx("button",{type:"submit",disabled:Ce,style:{background:ue.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:Ce?"not-allowed":"pointer",fontWeight:500,opacity:Ce?.7:1,fontSize:"0.9rem"},children:Ce?"Creating...":"Create Budget"})]})]}),u.jsx(CB,{budgetIdInput:B,setBudgetIdInput:G,isCheckingManual:te,manualInvite:ae,isAccepting:N,onCheckInvite:Oe,onAcceptInvite:z,onCancel:()=>{fe(null),G("")}}),r&&u.jsx(TB,{currentUserId:r})]})}const jB=["accounts","categories","users"];function RB(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:i,selectedBudgetId:o,setCurrentViewingDocument:l}=Ze();k.useLayoutEffect(()=>{i("Budget Settings")},[i]),k.useEffect(()=>(o&&l({type:"budget"}),()=>{l({type:null})}),[o,l]);const{isOwner:d,isLoading:h}=An();k.useEffect(()=>(h?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[h,t,e]);const m=On(),p=m.pathname==="/budget/settings",g=k.useMemo(()=>{const S=m.pathname;return S.includes("/settings/accounts")?"accounts":S.includes("/settings/categories")?"categories":S.includes("/settings/users")?"users":"categories"},[m.pathname]),v=g==="users";k.useEffect(()=>{p||r(g)},[g,p,r]);function _(){return!jB.includes(n)||n==="users"&&!d?"categories":n}const E=k.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!d}],[d]);return h?null:!d&&v?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Cn,{to:"/budget/settings/categories",children:"Go to Categories "})})]}):u.jsxs("div",{children:[u.jsx(Pf,{mode:"link",linkPrefix:"/budget/settings",tabs:E,activeTab:p?_():g}),p?u.jsx(Ff,{to:`/budget/settings/${_()}`,replace:!0}):u.jsx(YT,{children:u.jsx(Vf,{})})]})}function Gu({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:i,showGroupSelector:o=!1,showIncomeSettings:l=!1,hasExistingIncomeDefault:d=!1,hasExistingOutgoDefault:h=!1,currentGroupId:m}){const[p,g]=k.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),v=p.account_group_id||m,_=v?i.find(A=>A.id===v):null,E=_?.is_active!==null,x=_?.on_budget!==null;function S(A){A.preventDefault(),p.nickname.trim()&&e(p)}function C(A){g({...p,is_income_account:A,is_income_default:A?p.is_income_default:!1})}function T(A){g({...p,is_outgo_account:A,is_outgo_default:A?p.is_outgo_default:!1})}return u.jsxs(wi,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:S,children:[u.jsx(Pt,{label:"Account Nickname",htmlFor:"account-nickname",children:u.jsx(Si,{id:"account-nickname",type:"text",value:p.nickname,onChange:A=>g({...p,nickname:A.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&u.jsx(Pt,{label:"Account Type",htmlFor:"account-group",children:u.jsxs(qu,{id:"account-group",value:p.account_group_id||pn,onChange:A=>g({...p,account_group_id:A.target.value===pn?null:A.target.value}),children:[u.jsx("option",{value:pn,children:"Ungrouped"}),i.map(A=>u.jsx("option",{value:A.id,children:A.name},A.id))]})}),l&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Vr,{id:"is-active",checked:E?_.is_active:p.is_active!==!1,onChange:A=>g({...p,is_active:A.target.checked}),disabled:E,children:u.jsx("span",{style:{opacity:E?.5:1},children:"Active account"})}),E&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ue.warning},children:['Set by account type "',_.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Vr,{id:"on-budget",checked:x?_.on_budget:p.on_budget!==!1,onChange:A=>g({...p,on_budget:A.target.checked}),disabled:x,children:u.jsx("span",{style:{opacity:x?.5:1},children:"On budget (affects budget totals)"})}),x&&u.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ue.warning},children:['Set by account type "',_.name,'"']})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[u.jsx(Vr,{id:"is-hidden",checked:p.is_hidden||!1,onChange:A=>g({...p,is_hidden:A.target.checked}),children:"Hidden account"}),u.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),u.jsx(Vr,{id:"is-income-account",checked:p.is_income_account||!1,onChange:A=>C(A.target.checked),children:"Show in income deposit list"}),p.is_income_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Vr,{id:"is-income-default",checked:p.is_income_default||!1,onChange:A=>g({...p,is_income_default:A.target.checked}),disabled:d&&!t?.is_income_default,children:"Default account for new income"}),d&&!t?.is_income_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),u.jsx(Vr,{id:"is-outgo-account",checked:p.is_outgo_account||!1,onChange:A=>T(A.target.checked),children:"Show in expense account list"}),p.is_outgo_account&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[u.jsx(Vr,{id:"is-outgo-default",checked:p.is_outgo_default||!1,onChange:A=>g({...p,is_outgo_default:A.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&u.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),u.jsxs(Ma,{children:[u.jsx(Fe,{type:"submit",actionName:r,children:r}),u.jsx(Fe,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"})]})]})}function iS({label:t,value:e,onChange:n,trueLabel:r,falseLabel:i,undefinedLabel:o}){function l(){n(e===void 0?!0:e===!0?!1:void 0)}const d=e===!0?r:e===!1?i:o,h=e===!0?ue.success:e===!1?ue.warning:"inherit",m=e===!0?"":e===!1?"":"";return u.jsxs("button",{type:"button",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[u.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:m}),u.jsxs("span",{style:{flex:1},children:[u.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",u.jsx("span",{style:{fontWeight:500,color:h},children:d})]}),u.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function lA({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=k.useState(t||{name:"",expected_balance:"positive"});function l(d){d.preventDefault(),i.name.trim()&&e(i)}return u.jsxs(wi,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:l,children:[u.jsx(Pt,{label:"Account Type Name",htmlFor:"group-name",children:u.jsx(Si,{id:"group-name",type:"text",value:i.name,onChange:d=>o({...i,name:d.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),u.jsx(Pt,{label:"Expected Balance",htmlFor:"expected-balance",children:u.jsxs(qu,{id:"expected-balance",value:i.expected_balance,onChange:d=>o({...i,expected_balance:d.target.value}),children:[u.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),u.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),u.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",u.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),u.jsx(iS,{label:"Active status",value:i.is_active,onChange:d=>o({...i,is_active:d}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),u.jsx(iS,{label:"Budget status",value:i.on_budget,onChange:d=>o({...i,on_budget:d}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),u.jsxs(Ma,{children:[u.jsx(Fe,{type:"submit",actionName:r,children:r}),u.jsx(Fe,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function Tl({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${ue.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${ue.success} 40%, transparent)`,color:ue.success,opacity:1},warning:{background:`color-mix(in srgb, ${ue.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${ue.warning} 35%, transparent)`,color:ue.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${ue.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ue.success} 25%, transparent)`,color:ue.success,opacity:.7},expense:{background:`color-mix(in srgb, ${ue.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ue.warning} 25%, transparent)`,color:ue.warning,opacity:.7}}[n];return u.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[u.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function cA({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(l=>l.id===t.account_group_id):null,i=r&&r.is_active!==null?r.is_active:t.is_active!==!1,o=r&&r.on_budget!==null?r.on_budget:t.on_budget!==!1;if(!i){const l=r&&r.is_active!==null;n.push(u.jsx(Tl,{icon:"",label:l?"Inactive (type)":"Inactive",variant:"warning",title:l?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const l=r&&r.on_budget!==null;n.push(u.jsx(Tl,{icon:"",label:l?"Off Budget (type)":"Off Budget",variant:"warning",title:l?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(u.jsx(Tl,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(u.jsx(Tl,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(u.jsx(Tl,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(u.jsx(Tl,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:u.jsx(u.Fragment,{children:n})}function DB({group:t}){const e=[];return t.is_active===!1?e.push(u.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ue.warning} 20%, transparent)`,color:ue.warning,whiteSpace:"nowrap"},title:"All accounts in this type are inactive",children:"All Inactive"},"inactive")):t.is_active===!0&&e.push(u.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ue.success} 20%, transparent)`,color:ue.success,whiteSpace:"nowrap"},title:"All accounts in this type are active",children:"All Active"},"active")),t.on_budget===!1?e.push(u.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ue.warning} 20%, transparent)`,color:ue.warning,whiteSpace:"nowrap"},title:"All accounts in this type are off budget",children:"All Off Budget"},"off-budget")):t.on_budget===!0&&e.push(u.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ue.success} 20%, transparent)`,color:ue.success,whiteSpace:"nowrap"},title:"All accounts in this type are on budget",children:"All On Budget"},"on-budget")),e.length===0?null:u.jsx(u.Fragment,{children:e})}function uA({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[u.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ue.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&u.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function IB({group:t,accountCount:e,groupTotal:n,canMoveUp:r,canMoveDown:i,isMobile:o,createForGroupId:l,onEdit:d,onDelete:h,onMoveUp:m,onMoveDown:p,onAddAccount:g}){return u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:o?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:o?"wrap":"nowrap"},children:[u.jsxs("h3",{style:{..._m,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0,flexWrap:"wrap"},children:[!o&&u.jsx("span",{style:{cursor:"grab",opacity:.4},children:""}),u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:t.name}),u.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]}),wn.showGroupTotals,u.jsx(DB,{group:t})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!o&&u.jsx(Fe,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:g,disabled:l!==null,children:"+ Account"}),u.jsx("button",{onClick:()=>{t.name,d()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),u.jsx("button",{onClick:()=>{t.name,h()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),u.jsxs("div",{style:Q0,children:[u.jsx("button",{onClick:m,disabled:!r,style:{...Yl,opacity:r?.6:.2,cursor:r?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),u.jsx("button",{onClick:p,disabled:!i,style:{...Yl,opacity:i?.6:.2,cursor:i?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})}function kB(t,e){return!e||e==="any"||t===0?!1:e==="positive"&&t<0||e==="negative"&&t>0}function OB(t,e){return!e||e==="any"||t===0?null:e==="positive"&&t<0?"Unexpected negative balance":e==="negative"&&t>0?"Unexpected positive balance (credit owed to you?)":null}function MB({group:t,groupIndex:e,totalGroups:n,accounts:r,allGroups:i,allAccounts:o,editingAccountId:l,editingGroupId:d,createForGroupId:h,setEditingAccountId:m,setEditingGroupId:p,setCreateForGroupId:g,dragType:v,draggedId:_,dragOverId:E,dragOverGroupId:x,setDragOverId:S,setDragOverGroupId:C,onAccountDragStart:T,onAccountDragOver:A,onAccountDrop:L,onGroupDragStart:F,onGroupDragOver:H,onGroupDrop:O,onDragLeave:I,onDragLeaveGroup:N,onDragEnd:U,onDropOnGroup:$,onCreateAccount:j,onUpdateAccount:M,onDeleteAccount:R,onMoveAccount:K,onUpdateGroup:W,onDeleteGroup:q,onMoveGroup:Z}){const X=fs(),ne=[...r].sort((he,Me)=>he.sort_order-Me.sort_order),B=v==="group"&&_===t.id,G=v==="group"&&E===t.id,te=v==="account"&&x===t.id,ae=(_&&v==="account"?o[_]:null)&&Object.entries(o).find(([he])=>he===_)?.[1]&&Object.entries(o).find(([he])=>he===_)?.[1]?.account_group_id!==t.id,fe=v==="group"&&G&&_!==t.id,Ee=e>0,me=e<n-1,Ce=ne.reduce((he,Me)=>he+Me.balance,0);return u.jsxs("div",{children:[v==="group"&&!B&&u.jsxs("div",{onDragOver:he=>{he.preventDefault(),S(t.id)},onDragLeave:I,onDrop:he=>O(he,t.id),style:{position:"relative",height:fe?"2.5rem":"0.5rem",marginBottom:fe?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[u.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ue.primary,borderRadius:"2px",opacity:fe?1:0,transition:"opacity 0.15s",boxShadow:fe?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),fe&&u.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),u.jsx("div",{draggable:d!==t.id,onDragStart:he=>F(he,t.id),onDragOver:he=>H(he,t.id),onDragLeave:N,onDragEnd:U,onDrop:he=>$(he,t.id),style:{background:B?"color-mix(in srgb, currentColor 3%, transparent)":te&&ae?`color-mix(in srgb, ${ue.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:B?.5:1,border:te&&ae?`2px dashed ${ue.primary}`:"2px solid transparent",cursor:d===t.id?"default":"grab",transition:"all 0.15s"},children:d===t.id?u.jsx(lA,{initialData:{name:t.name,expected_balance:t.expected_balance||"positive",on_budget:t.on_budget??void 0,is_active:t.is_active??void 0},onSubmit:he=>W(t.id,he),onCancel:()=>p(null),submitLabel:"Save"}):u.jsxs(u.Fragment,{children:[u.jsx(IB,{group:t,accountCount:ne.length,groupTotal:Ce,canMoveUp:Ee,canMoveDown:me,isMobile:X,createForGroupId:h,onEdit:()=>p(t.id),onDelete:()=>q(t.id),onMoveUp:()=>Z(t.id,"up"),onMoveDown:()=>Z(t.id,"down"),onAddAccount:()=>g(t.id)}),X&&u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx(Fe,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>g(t.id),disabled:h!==null,children:"+ Account"})}),u.jsxs("div",{style:Xl,children:[ne.map((he,Me)=>l===he.id?u.jsx(Gu,{initialData:{nickname:he.nickname,account_group_id:he.account_group_id,is_income_account:he.is_income_account,is_income_default:he.is_income_default,is_outgo_account:he.is_outgo_account,is_outgo_default:he.is_outgo_default,on_budget:he.on_budget,is_active:he.is_active},onSubmit:qe=>M(he.id,qe),onCancel:()=>m(null),submitLabel:"Save",accountGroups:i,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:he.account_group_id,hasExistingIncomeDefault:Object.entries(o).some(([qe,Oe])=>Oe.is_income_default&&qe!==he.id),hasExistingOutgoDefault:Object.entries(o).some(([qe,Oe])=>Oe.is_outgo_default&&qe!==he.id)},he.id):u.jsx(Tm,{isDragging:v==="account"&&_===he.id,isDragOver:E===he.id,onDragStart:qe=>{qe.stopPropagation(),T(qe,he.id)},onDragOver:qe=>A(qe,he.id,t.id),onDragLeave:I,onDragEnd:U,onDrop:qe=>L(qe,he.id,t.id),onEdit:()=>{he.nickname,m(he.id)},onDelete:()=>{he.nickname,R(he.id)},onMoveUp:()=>K(he.id,"up"),onMoveDown:()=>K(he.id,"down"),canMoveUp:Me>0,canMoveDown:Me<ne.length-1,children:u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:W0,children:he.nickname}),u.jsx(cA,{account:he,accountGroups:i})]}),u.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:Bt(he.balance)},children:[Je(he.balance),kB(he.balance,t.expected_balance)&&u.jsx("span",{title:OB(he.balance,t.expected_balance)||"",style:{marginLeft:"0.5rem",fontSize:"0.85rem"},children:""})]})]})},he.id)),ne.length===0&&!h&&u.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No accounts in this type"}),v==="account"&&ne.length>0&&u.jsx(uA,{groupId:t.id,isActive:E===`__end__${t.id}`,onDragOver:he=>{he.preventDefault(),he.stopPropagation(),S(`__end__${t.id}`),C(t.id)},onDragLeave:he=>{he.stopPropagation(),S(null)},onDrop:he=>{he.stopPropagation(),L(he,"__group_end__",t.id)}}),h===t.id&&u.jsx(Gu,{initialData:{nickname:"",account_group_id:t.id},onSubmit:he=>j(he,t.id),onCancel:()=>g(null),submitLabel:"Create",accountGroups:i,showIncomeSettings:!0,currentGroupId:t.id})]}),h!==t.id&&u.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:u.jsx(Fe,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>g(t.id),disabled:h!==null,children:"+ Add Account"})})]})})]})}function NB({accounts:t,allGroups:e,allAccounts:n,hasGroups:r,editingAccountId:i,createForGroupId:o,setEditingAccountId:l,setCreateForGroupId:d,dragType:h,draggedId:m,dragOverId:p,dragOverGroupId:g,setDragOverId:v,setDragOverGroupId:_,onAccountDragStart:E,onAccountDragOver:x,onAccountDrop:S,onDragOverGroup:C,onDropOnGroup:T,onDragLeave:A,onDragLeaveGroup:L,onDragEnd:F,onCreateAccount:H,onUpdateAccount:O,onDeleteAccount:I,onMoveAccount:N}){const U=[...t].sort((R,K)=>R.sort_order-K.sort_order),$=h==="account"&&g==="ungrouped",M=(m&&h==="account"?n[m]:null)&&Object.entries(n).find(([R])=>R===m)?.[1]&&Object.entries(n).find(([R])=>R===m)?.[1]?.account_group_id!==null;return U.length===0&&!o&&r&&h!=="account"?null:(U.reduce((R,K)=>R+K.balance,0),u.jsxs("div",{onDragOver:R=>C(R,"ungrouped"),onDragLeave:L,onDrop:R=>T(R,"ungrouped"),style:{background:$&&M?`color-mix(in srgb, ${ue.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:$&&M?`2px dashed ${ue.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[u.jsxs("h3",{style:{..._m,margin:0,opacity:.7,display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:"Ungrouped"}),u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",U.length,")"]}),wn.showGroupTotals]}),u.jsx(Fe,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>d("ungrouped"),disabled:o!==null,children:"+ Account"})]}),u.jsxs("div",{style:Xl,children:[U.map((R,K)=>i===R.id?u.jsx(Gu,{initialData:{nickname:R.nickname,account_group_id:R.account_group_id,is_income_account:R.is_income_account,is_income_default:R.is_income_default,is_outgo_account:R.is_outgo_account,is_outgo_default:R.is_outgo_default,on_budget:R.on_budget,is_active:R.is_active},onSubmit:W=>O(R.id,W),onCancel:()=>l(null),submitLabel:"Save",accountGroups:e,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:null,hasExistingIncomeDefault:Object.entries(n).some(([W,q])=>q.is_income_default&&W!==R.id),hasExistingOutgoDefault:Object.entries(n).some(([W,q])=>q.is_outgo_default&&W!==R.id)},R.id):u.jsx(Tm,{isDragging:h==="account"&&m===R.id,isDragOver:p===R.id,onDragStart:W=>E(W,R.id),onDragOver:W=>x(W,R.id,"ungrouped"),onDragLeave:A,onDragEnd:F,onDrop:W=>S(W,R.id,"ungrouped"),onEdit:()=>{R.nickname,l(R.id)},onDelete:()=>{R.nickname,I(R.id)},onMoveUp:()=>N(R.id,"up"),onMoveDown:()=>N(R.id,"down"),canMoveUp:K>0,canMoveDown:K<U.length-1,children:u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("span",{style:W0,children:R.nickname}),u.jsx(cA,{account:R,accountGroups:e})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:Bt(R.balance)},children:Je(R.balance)})]})},R.id)),U.length===0&&h==="account"&&u.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to ungroup"}),h==="account"&&U.length>0&&u.jsx(uA,{groupId:"ungrouped",isActive:p==="__end__ungrouped",onDragOver:R=>{R.preventDefault(),R.stopPropagation(),v("__end__ungrouped"),_("ungrouped")},onDragLeave:R=>{R.stopPropagation(),v(null)},onDrop:R=>{R.stopPropagation(),S(R,"__group_end__","ungrouped")}}),o==="ungrouped"&&u.jsx(Gu,{initialData:{nickname:"",account_group_id:null},onSubmit:R=>H(R,"ungrouped"),onCancel:()=>d(null),submitLabel:"Create",accountGroups:e,showIncomeSettings:!0,currentGroupId:null})]}),o!=="ungrouped"&&u.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:u.jsx(Fe,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>d("ungrouped"),disabled:o!==null,children:"+ Add Account"})})]}))}function PB(){const{selectedBudgetId:t}=Ze(),{monthMap:e,isLoading:n}=An(),{accounts:r,accountsByGroup:i,hiddenAccounts:o,sortedGroups:l,currentBudget:d,error:h,setError:m,handleCreateAccount:p,handleUpdateAccount:g,handleDeleteAccount:v,handleMoveAccount:_,handleCreateGroup:E,handleUpdateGroup:x,handleDeleteGroup:S,handleMoveGroup:C,reorderAccountsInGroup:T,reorderGroups:A}=i3(),L=fs();dd({budgetId:t,monthMap:e,checkAnyMonth:!0,additionalCondition:!n&&!!d,logPrefix:"[Settings/Accounts]"});const[F,H]=k.useState(null),[O,I]=k.useState(null),[N,U]=k.useState(null),[$,j]=k.useState(!1),[M,R]=k.useState(null),[K,W]=k.useState(null),[q,Z]=k.useState(null),[X,ne]=k.useState(null);function B(Oe,z){R("account"),W(z),Oe.dataTransfer.effectAllowed="move"}function G(Oe,z,ce){Oe.preventDefault(),M==="account"&&(z!==K&&Z(z),ne(ce))}function te(Oe,z){Oe.preventDefault(),M==="account"?(ne(z),Z(null)):M==="group"&&z!==K&&Z(z)}function ie(){Z(null)}function ae(){ne(null)}function fe(){R(null),W(null),Z(null),ne(null)}async function Ee(Oe,z,ce){if(Oe.preventDefault(),Oe.stopPropagation(),!K||M!=="account"){fe();return}await T(K,z,ce),fe()}async function me(Oe,z){Oe.preventDefault(),M==="account"?await Ee(Oe,"__group_end__",z):M==="group"&&await he(Oe,z)}function Ce(Oe,z){Oe.stopPropagation(),R("group"),W(z),Oe.dataTransfer.effectAllowed="move"}async function he(Oe,z){if(Oe.preventDefault(),!K||M!=="group"||K===z){fe();return}await A(K,z),fe()}const Me=k.useMemo(()=>{const Oe=Object.values(r),z=Oe.reduce((ee,J)=>ee+(J.balance??0),0);let ce=0,pe=0;for(const ee of Oe){const J=l.find(xe=>xe.id===ee.account_group_id);ee.on_budget===!0||ee.on_budget===void 0&&J?.on_budget!==!1?ce+=ee.balance??0:pe+=ee.balance??0}return{count:Oe.length,groupCount:l.length,totalBalance:z,onBudgetTotal:ce,offBudgetTotal:pe}},[r,l]);if(!d)return u.jsx("p",{children:"No budget found. Please log in."});const qe=i[pn]||[];return u.jsxs("div",{children:[h&&u.jsx(fc,{message:h,onDismiss:()=>m(null)}),u.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:Bt(Me.onBudgetTotal),fontWeight:600},children:Je(Me.onBudgetTotal)})]}),Me.offBudgetTotal!==0&&u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),u.jsx("span",{style:{fontWeight:600,opacity:.7},children:Je(Me.offBudgetTotal)})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Total: "}),u.jsx("span",{style:{color:Bt(Me.totalBalance),fontWeight:600},children:Je(Me.totalBalance)})]}),u.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:L?"Drag to move.":"Drag between types or use  to reorder."})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:u.jsx(r_,{})})]})}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(r).length===0&&l.length===0&&u.jsx("p",{style:{opacity:.7},children:"No accounts yet. Create an account type first, then add accounts!"}),l.map((Oe,z)=>u.jsx(MB,{group:Oe,groupIndex:z,totalGroups:l.length,accounts:i[Oe.id]||[],allGroups:l,allAccounts:r,editingAccountId:F,editingGroupId:N,createForGroupId:O,setEditingAccountId:H,setEditingGroupId:U,setCreateForGroupId:I,dragType:M,draggedId:K,dragOverId:q,dragOverGroupId:X,setDragOverId:Z,setDragOverGroupId:ne,onAccountDragStart:B,onAccountDragOver:G,onAccountDrop:Ee,onGroupDragStart:Ce,onGroupDragOver:te,onGroupDrop:he,onDragLeave:ie,onDragLeaveGroup:ae,onDragEnd:fe,onDropOnGroup:me,onCreateAccount:p,onUpdateAccount:(ce,pe)=>{g(ce,pe),H(null)},onDeleteAccount:v,onMoveAccount:_,onUpdateGroup:(ce,pe)=>{x(ce,pe),U(null)},onDeleteGroup:S,onMoveGroup:C},Oe.id)),M==="group"&&l.length>0&&u.jsx(X0,{isActive:q==="__end__",onDragOver:Oe=>{Oe.preventDefault(),Z("__end__")},onDragLeave:ie,onDrop:Oe=>he(Oe,"__end__"),label:"Move account type to end"}),u.jsx(NB,{accounts:qe,allGroups:l,allAccounts:r,hasGroups:l.length>0,editingAccountId:F,createForGroupId:O,setEditingAccountId:H,setCreateForGroupId:I,dragType:M,draggedId:K,dragOverId:q,dragOverGroupId:X,setDragOverId:Z,setDragOverGroupId:ne,onAccountDragStart:B,onAccountDragOver:G,onAccountDrop:Ee,onDragOverGroup:te,onDropOnGroup:me,onDragLeave:ie,onDragLeaveGroup:ae,onDragEnd:fe,onCreateAccount:p,onUpdateAccount:(Oe,z)=>{g(Oe,z),H(null)},onDeleteAccount:v,onMoveAccount:_})]}),o.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(J0,{title:"Hidden Accounts",count:o.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:o.map(Oe=>F===Oe.id?u.jsx(Gu,{initialData:{nickname:Oe.nickname,account_group_id:Oe.account_group_id,is_income_account:Oe.is_income_account,is_income_default:Oe.is_income_default,is_outgo_account:Oe.is_outgo_account,is_outgo_default:Oe.is_outgo_default,on_budget:Oe.on_budget,is_active:Oe.is_active,is_hidden:Oe.is_hidden},onSubmit:z=>{g(Oe.id,z),H(null)},onCancel:()=>H(null),submitLabel:"Save",accountGroups:l,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:Oe.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([z,ce])=>ce.is_income_default&&z!==Oe.id),hasExistingOutgoDefault:Object.entries(r).some(([z,ce])=>ce.is_outgo_default&&z!==Oe.id)},Oe.id):u.jsxs("div",{onClick:()=>H(Oe.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:Oe.nickname}),u.jsx("span",{style:{color:Bt(Oe.balance),fontWeight:500},children:Je(Oe.balance)})]},Oe.id))})]})}),$?u.jsx(lA,{onSubmit:Oe=>{E(Oe),j(!1)},onCancel:()=>j(!1),submitLabel:"Create Account Type"}):u.jsx(Fe,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>j(!0),children:"+ Add Account Type"})]})}function Qu({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:i=[],showGroupSelector:o=!1}){const[l,d]=k.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[h,m]=k.useState(t?.default_monthly_amount?.toString()||""),[p,g]=k.useState(t?.default_monthly_type||"fixed"),[v,_]=k.useState(!1);function E(x){if(x.preventDefault(),!l.name.trim())return;_(!0);const S=parseFloat(h),C=!isNaN(S)&&S>0;e({...l,description:l.description?.trim()||void 0,default_monthly_amount:C?S:void 0,default_monthly_type:C?p:void 0})}return u.jsxs(wi,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:E,children:[u.jsx(Pt,{label:"Category Name",htmlFor:"category-name",children:u.jsx(Si,{id:"category-name",type:"text",value:l.name,onChange:x=>d({...l,name:x.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),u.jsx(Pt,{label:"Description (optional)",htmlFor:"category-description",children:u.jsx(Y0,{id:"category-description",value:l.description||"",onChange:x=>d({...l,description:x.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&u.jsx(Pt,{label:"Category Group",htmlFor:"category-group",children:u.jsxs(qu,{id:"category-group",value:l.category_group_id||Sn,onChange:x=>d({...l,category_group_id:x.target.value===Sn?null:x.target.value}),children:[u.jsx("option",{value:Sn,children:"Uncategorized"}),i.map(x=>u.jsx("option",{value:x.id,children:x.name},x.id))]})}),u.jsxs(Pt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[u.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[u.jsxs(qu,{id:"default-type",value:p,onChange:x=>g(x.target.value),style:{width:"auto",flex:"0 0 auto"},children:[u.jsx("option",{value:"fixed",children:"Fixed $"}),u.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),p==="fixed"?u.jsx(_o,{id:"default-amount",value:h,onChange:m,placeholder:"$0.00"}):u.jsx(Si,{id:"default-amount",type:"number",value:h,onChange:x=>m(x.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),p==="percentage"&&u.jsx("span",{style:{opacity:.6},children:"%"})]}),u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:p==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&u.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[u.jsx(Vr,{id:"is-hidden",checked:l.is_hidden||!1,onChange:x=>d({...l,is_hidden:x.target.checked}),children:"Hidden category"}),u.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),u.jsxs(Ma,{children:[u.jsx(Fe,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:v,children:r}),u.jsx(Fe,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"})]})]})}function dA({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[i,o]=k.useState(t||{name:""}),[l,d]=k.useState(!1);function h(m){m.preventDefault(),i.name.trim()&&(d(!0),e(i))}return u.jsxs(wi,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[u.jsx(Pt,{label:"Group Name",htmlFor:"group-name",children:u.jsx(Si,{id:"group-name",type:"text",value:i.name,onChange:m=>o({...i,name:m.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),u.jsxs(Ma,{children:[u.jsx(Fe,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:l,children:r}),u.jsx(Fe,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function hA({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r}){return u.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[u.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ue.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&u.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function fA({category:t,catId:e,categoryBalances:n,loadingBalances:r}){const i=n[e]||{current:0,total:0};return u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[u.jsx("span",{style:W0,children:t.name}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&u.jsxs("span",{style:{fontSize:"0.75rem",opacity:.8,background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.15rem 0.4rem",borderRadius:"4px"},children:["Default: ",t.default_monthly_type==="percentage"?u.jsxs(u.Fragment,{children:[u.jsxs("span",{style:{color:ue.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):u.jsxs(u.Fragment,{children:[u.jsx("span",{style:{color:ue.success,fontWeight:500},children:Je(t.default_monthly_amount)}),"/mo"]})]})]}),t.description&&u.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",opacity:.6,lineHeight:1.3},children:t.description}),u.jsxs("div",{style:{marginTop:"0.25rem"},children:[u.jsxs("p",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:Fn(i.current)},children:[r?"...":os(i.current),u.jsx("span",{style:{fontSize:"0.75rem",fontWeight:400,opacity:.6,marginLeft:"0.35rem"},children:"available now"})]}),u.jsxs("p",{style:{margin:"0.15rem 0 0 0",fontSize:"0.85rem",fontWeight:500,color:Fn(i.total),opacity:.75},children:[r?"...":os(i.total),u.jsx("span",{style:{fontSize:"0.7rem",fontWeight:400,opacity:.7,marginLeft:"0.35rem"},children:"total allocated"})]})]})]})}function zB({group:t,categoryCount:e,canMoveUp:n,canMoveDown:r,isMobile:i,createForGroupId:o,onEdit:l,onDelete:d,onMoveUp:h,onMoveDown:m,onAddCategory:p,onDragStart:g,onDragEnd:v}){return u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:i?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:i?"wrap":"nowrap"},children:[u.jsxs("h3",{style:{..._m,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0},children:[!i&&u.jsx("span",{draggable:!0,onDragStart:g,onDragEnd:v,style:{cursor:"grab",opacity:.4,padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder group",children:""}),u.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),u.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]})]}),u.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!i&&u.jsx(Fe,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:p,disabled:o!==null,children:"+ Category"}),u.jsx("button",{onClick:()=>{t.name,l()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),u.jsx("button",{onClick:()=>{t.name,d()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),u.jsxs("div",{style:Q0,children:[u.jsx("button",{onClick:h,disabled:!n,style:{...Yl,opacity:n?.6:.2,cursor:n?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),u.jsx("button",{onClick:m,disabled:!r,style:{...Yl,opacity:r?.6:.2,cursor:r?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]})}function BB({group:t,groupIndex:e,groupCategories:n,sortedGroups:r,categoryGroups:i,categoryBalances:o,loadingBalances:l,dragType:d,draggedId:h,dragOverId:m,dragOverGroupId:p,editingCategoryId:g,setEditingCategoryId:v,createForGroupId:_,setCreateForGroupId:E,editingGroupId:x,setEditingGroupId:S,handleCreateCategory:C,handleUpdateCategory:T,handleDeleteCategory:A,handleMoveCategory:L,handleUpdateGroup:F,handleDeleteGroup:H,handleMoveGroup:O,handleCategoryDragStart:I,handleCategoryDragOver:N,handleDragOverGroup:U,handleDragLeave:$,handleDragLeaveGroup:j,handleDragEnd:M,handleCategoryDrop:R,handleDropOnGroup:K,handleGroupDragStart:W,handleGroupDrop:q,setDragOverId:Z,setDragOverGroupId:X,isMobile:ne,categories:B}){const G=d==="group"&&h===t.id,te=d==="group"&&m===t.id,ie=d==="category"&&p===t.id,ae=h&&d==="category"?B[h]:null,fe=ae&&(ae.category_group_id||"ungrouped")!==t.id,Ee=d==="group"&&te&&h!==t.id,me=e>0,Ce=e<r.length-1;return u.jsxs("div",{children:[d==="group"&&!G&&u.jsxs("div",{onDragOver:he=>{he.preventDefault(),Z(t.id)},onDragLeave:$,onDrop:he=>q(he,t.id),style:{position:"relative",height:Ee?"2.5rem":"0.5rem",marginBottom:Ee?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[u.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ue.primary,borderRadius:"2px",opacity:Ee?1:0,transition:"opacity 0.15s",boxShadow:Ee?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),Ee&&u.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),u.jsx("div",{onDragOver:he=>U(he,t.id),onDragLeave:j,onDrop:he=>K(he,t.id),style:{background:G?"color-mix(in srgb, currentColor 3%, transparent)":ie&&fe?`color-mix(in srgb, ${ue.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:G?.5:1,border:ie&&fe?`2px dashed ${ue.primary}`:"2px solid transparent",transition:"all 0.15s"},children:x===t.id?u.jsx(dA,{initialData:{name:t.name},onSubmit:he=>F(t.id,he),onCancel:()=>S(null),submitLabel:"Save"}):u.jsxs(u.Fragment,{children:[u.jsx(zB,{group:t,categoryCount:n.length,canMoveUp:me,canMoveDown:Ce,isMobile:ne,createForGroupId:_,onEdit:()=>S(t.id),onDelete:()=>H(t.id),onMoveUp:()=>O(t.id,"up"),onMoveDown:()=>O(t.id,"down"),onAddCategory:()=>E(t.id),onDragStart:he=>W(he,t.id),onDragEnd:M}),ne&&u.jsx("div",{style:{marginBottom:"0.5rem"},children:u.jsx(Fe,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>E(t.id),disabled:_!==null,children:"+ Category"})}),u.jsxs("div",{style:Xl,children:[n.map(([he,Me])=>g===he?u.jsx(Qu,{initialData:{name:Me.name,description:Me.description,category_group_id:Me.category_group_id,default_monthly_amount:Me.default_monthly_amount,default_monthly_type:Me.default_monthly_type,is_hidden:Me.is_hidden},onSubmit:qe=>{T(he,qe),v(null)},onCancel:()=>v(null),submitLabel:"Save",categoryGroups:i,showGroupSelector:!0},he):u.jsx(Tm,{isDragging:d==="category"&&h===he,isDragOver:m===he,onDragStart:qe=>{qe.stopPropagation(),I(qe,he)},onDragOver:qe=>N(qe,he,t.id),onDragLeave:$,onDragEnd:M,onDrop:qe=>R(qe,he,t.id),onEdit:()=>{Me.name,v(he)},onDelete:()=>{Me.name,A(he)},onMoveUp:()=>L(he,"up"),onMoveDown:()=>L(he,"down"),canMoveUp:n.findIndex(([qe])=>qe===he)>0,canMoveDown:n.findIndex(([qe])=>qe===he)<n.length-1,children:u.jsx(fA,{category:Me,catId:he,categoryBalances:o,loadingBalances:l})},he)),n.length===0&&!_&&u.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No categories in this group"}),d==="category"&&n.length>0&&u.jsx(hA,{groupId:t.id,isActive:m===`__end__${t.id}`,onDragOver:he=>{he.preventDefault(),he.stopPropagation(),Z(`__end__${t.id}`),X(t.id)},onDragLeave:he=>{he.stopPropagation(),Z(null)},onDrop:he=>{he.stopPropagation(),R(he,"__group_end__",t.id)}}),_===t.id&&u.jsx(Qu,{initialData:{name:"",category_group_id:t.id},onSubmit:he=>C(he,t.id),onCancel:()=>E(null),submitLabel:"Create",categoryGroups:i})]}),_!==t.id&&u.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:u.jsx(Fe,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>E(t.id),disabled:_!==null,children:"+ Add Category"})})]})})]})}function LB({ungroupedCategories:t,categoryGroups:e,categoryBalances:n,loadingBalances:r,dragType:i,draggedId:o,dragOverId:l,dragOverGroupId:d,editingCategoryId:h,setEditingCategoryId:m,createForGroupId:p,setCreateForGroupId:g,handleCreateCategory:v,handleUpdateCategory:_,handleDeleteCategory:E,handleMoveCategory:x,handleCategoryDragStart:S,handleCategoryDragOver:C,handleDragOverGroup:T,handleDragLeaveGroup:A,handleDragLeave:L,handleDragEnd:F,handleCategoryDrop:H,handleDropOnGroup:O,setDragOverId:I,setDragOverGroupId:N,categories:U,hasGroups:$}){const j=i==="category"&&d==="ungrouped",M=o&&i==="category"?U[o]:null,R=M&&M.category_group_id!==null;return t.length===0&&!p&&$&&i!=="category"?null:u.jsxs("div",{onDragOver:K=>T(K,"ungrouped"),onDragLeave:A,onDrop:K=>O(K,"ungrouped"),style:{background:j&&R?`color-mix(in srgb, ${ue.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:j&&R?`2px dashed ${ue.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[u.jsxs("h3",{style:{..._m,margin:0,opacity:.7},children:["Uncategorized",u.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",t.length,")"]})]}),u.jsx(Fe,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>g("ungrouped"),disabled:p!==null,children:"+ Category"})]}),u.jsxs("div",{style:Xl,children:[t.map(([K,W])=>h===K?u.jsx(Qu,{initialData:{name:W.name,description:W.description,category_group_id:W.category_group_id,default_monthly_amount:W.default_monthly_amount,default_monthly_type:W.default_monthly_type,is_hidden:W.is_hidden},onSubmit:q=>{_(K,q),m(null)},onCancel:()=>m(null),submitLabel:"Save",categoryGroups:e,showGroupSelector:!0},K):u.jsx(Tm,{isDragging:i==="category"&&o===K,isDragOver:l===K,onDragStart:q=>S(q,K),onDragOver:q=>C(q,K,"ungrouped"),onDragLeave:L,onDragEnd:F,onDrop:q=>H(q,K,"ungrouped"),onEdit:()=>{W.name,m(K)},onDelete:()=>{W.name,E(K)},onMoveUp:()=>x(K,"up"),onMoveDown:()=>x(K,"down"),canMoveUp:t.findIndex(([q])=>q===K)>0,canMoveDown:t.findIndex(([q])=>q===K)<t.length-1,children:u.jsx(fA,{category:W,catId:K,categoryBalances:n,loadingBalances:r})},K)),t.length===0&&i==="category"&&u.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to uncategorize"}),i==="category"&&t.length>0&&u.jsx(hA,{groupId:"ungrouped",isActive:l==="__end__ungrouped",onDragOver:K=>{K.preventDefault(),K.stopPropagation(),I("__end__ungrouped"),N("ungrouped")},onDragLeave:K=>{K.stopPropagation(),I(null)},onDrop:K=>{K.stopPropagation(),H(K,"__group_end__","ungrouped")}}),p==="ungrouped"&&u.jsx(Qu,{initialData:{name:"",category_group_id:null},onSubmit:K=>v(K,"ungrouped"),onCancel:()=>g(null),submitLabel:"Create",categoryGroups:e})]}),p!=="ungrouped"&&u.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:u.jsx(Fe,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>g("ungrouped"),disabled:p!==null,children:"+ Add Category"})})]})}function UB(){const{selectedBudgetId:t}=Ze(),{monthMap:e,isLoading:n}=An(),{currentBudget:r,categories:i,categoryGroups:o,categoriesByGroup:l,hiddenCategories:d,sortedGroups:h,categoryBalances:m,isLoading:p,loadingBalances:g,error:v,setError:_,getOnBudgetTotal:E,handleCreateCategory:x,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCreateGroup:A,handleUpdateGroup:L,handleDeleteGroup:F,handleMoveGroup:H,dragType:O,draggedId:I,dragOverId:N,dragOverGroupId:U,setDragOverId:$,setDragOverGroupId:j,handleCategoryDragStart:M,handleCategoryDragOver:R,handleDragOverGroup:K,handleDragLeave:W,handleDragLeaveGroup:q,handleDragEnd:Z,handleCategoryDrop:X,handleDropOnGroup:ne,handleGroupDragStart:B,handleGroupDrop:G}=c3();dd({budgetId:t,monthMap:e,checkAnyMonth:!0,additionalCondition:!n&&!p&&!!r,logPrefix:"[Settings/Categories]"});const te=fs(),{addLoadingHold:ie,removeLoadingHold:ae}=sr();k.useEffect(()=>(p?ie("categories","Loading categories..."):ae("categories"),()=>ae("categories")),[p,ie,ae]);const[fe,Ee]=k.useState(null),[me,Ce]=k.useState(null),[he,Me]=k.useState(null),[qe,Oe]=k.useState(!1);if(!r)return u.jsx("p",{children:"No budget found. Please log in."});const z=Object.values(m).reduce((J,se)=>J+se.current,0),ce=Object.values(m).reduce((J,se)=>J+se.total,0),pe=E()-z,ee=Math.abs(ce-z)>.01;return p?null:u.jsxs("div",{children:[v&&u.jsx(fc,{message:v,onDismiss:()=>_(null)}),u.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[u.jsx("span",{style:{fontWeight:600},children:"Categories:"}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),u.jsx("span",{style:{color:Bt(E()),fontWeight:600},children:Je(E())})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Allocated: "}),u.jsx("span",{style:{color:gc(z),fontWeight:600},children:g?"...":Je(z)}),ee&&u.jsxs("span",{style:{opacity:.5,fontSize:"0.8rem"},children:[" (",Je(ce)," total)"]})]}),u.jsxs("span",{children:[u.jsx("span",{style:{opacity:.6},children:"Available: "}),u.jsx("span",{style:{color:Bt(pe),fontWeight:600},children:g?"...":Je(pe)})]}),u.jsx("span",{style:{opacity:.6},children:te?"Drag to move between groups.":"Drag categories between groups, or use  to reorder."})]}),u.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:u.jsx(r_,{})})]})}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(i).length===0&&o.length===0&&u.jsx("p",{style:{opacity:.7},children:"No categories yet. Create a group first, then add categories!"}),h.map((J,se)=>{const xe=(l[J.id]||[]).sort((Se,oe)=>Se[1].sort_order-oe[1].sort_order);return u.jsx(BB,{group:J,groupIndex:se,groupCategories:xe,sortedGroups:h,categoryGroups:o,categoryBalances:m,loadingBalances:g,dragType:O,draggedId:I,dragOverId:N,dragOverGroupId:U,editingCategoryId:fe,setEditingCategoryId:Ee,createForGroupId:me,setCreateForGroupId:Ce,editingGroupId:he,setEditingGroupId:Me,handleCreateCategory:x,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleUpdateGroup:L,handleDeleteGroup:F,handleMoveGroup:H,handleCategoryDragStart:M,handleCategoryDragOver:R,handleDragOverGroup:K,handleDragLeave:W,handleDragLeaveGroup:q,handleDragEnd:Z,handleCategoryDrop:X,handleDropOnGroup:ne,handleGroupDragStart:B,handleGroupDrop:G,setDragOverId:$,setDragOverGroupId:j,isMobile:te,categories:i},J.id)}),O==="group"&&h.length>0&&u.jsx(X0,{isActive:N==="__end__",onDragOver:J=>{J.preventDefault(),$("__end__")},onDragLeave:W,onDrop:J=>G(J,"__end__"),label:"Move group to end"}),u.jsx(LB,{ungroupedCategories:(l[Sn]||[]).sort((J,se)=>J[1].sort_order-se[1].sort_order),categoryGroups:o,categoryBalances:m,loadingBalances:g,dragType:O,draggedId:I,dragOverId:N,dragOverGroupId:U,editingCategoryId:fe,setEditingCategoryId:Ee,createForGroupId:me,setCreateForGroupId:Ce,handleCreateCategory:x,handleUpdateCategory:S,handleDeleteCategory:C,handleMoveCategory:T,handleCategoryDragStart:M,handleCategoryDragOver:R,handleDragOverGroup:K,handleDragLeaveGroup:q,handleDragLeave:W,handleDragEnd:Z,handleCategoryDrop:X,handleDropOnGroup:ne,setDragOverId:$,setDragOverGroupId:j,categories:i,hasGroups:o.length>0})]}),d.length>0&&u.jsx("div",{style:{marginBottom:"2rem"},children:u.jsxs(J0,{title:"Hidden Categories",count:d.length,children:[u.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[u.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[u.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),u.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:d.map(([J,se])=>fe===J?u.jsx(Qu,{initialData:{name:se.name,description:se.description,category_group_id:se.category_group_id,default_monthly_amount:se.default_monthly_amount,default_monthly_type:se.default_monthly_type,is_hidden:se.is_hidden},onSubmit:xe=>{S(J,xe),Ee(null)},onCancel:()=>Ee(null),submitLabel:"Save",categoryGroups:o,showGroupSelector:!0},J):u.jsxs("div",{onClick:()=>Ee(J),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[u.jsx("span",{children:se.name}),u.jsx("span",{style:{color:Bt(se.balance),fontWeight:500},children:Je(se.balance)})]},J))})]})}),qe?u.jsx(dA,{onSubmit:J=>{A(J),Oe(!1)},onCancel:()=>Oe(!1),submitLabel:"Create Group"}):u.jsx(Fe,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>Oe(!0),children:"+ Add Category Group"})]})}function FB(){const{selectedBudgetId:t,currentUserId:e}=Ze(),{budget:n,budgetUserIds:r,acceptedUserIds:i}=An(),{inviteUser:o}=xB(),{revokeUser:l}=wB(),[d,h]=k.useState(""),[m,p]=k.useState(!1),[g,v]=k.useState(null),[_,E]=k.useState(null);if(!n)return u.jsx("p",{children:"No budget found."});async function x(A){if(A.preventDefault(),!(!d.trim()||!n||!t)){p(!0),v(null),E(null);try{await o.mutateAsync({budgetId:t,userId:d.trim()}),h(""),E("Invite sent! The user can now accept the invitation from their account.")}catch(L){v(L instanceof Error?L.message:"Failed to invite user")}finally{p(!1)}}}async function S(A){if(!n||!t)return;if(A===n.owner_id){v("Cannot revoke the budget owner");return}if(A===e){v("Cannot revoke yourself from the budget");return}const L=i.includes(A);if(confirm(L?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){v(null),E(null);try{await l.mutateAsync({budgetId:t,userId:A}),E(L?"User access revoked.":"Invitation cancelled.")}catch(H){v(H instanceof Error?H.message:"Failed to revoke user")}}}const C=r.filter(A=>i.includes(A)),T=r.filter(A=>!i.includes(A));return u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),g&&u.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:g}),u.jsx("button",{onClick:()=>v(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),_&&u.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx("span",{children:_}),u.jsx("button",{onClick:()=>E(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",C.length,")"]}),C.length===0?u.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:C.map(A=>{const L=A===n.owner_id,F=A===e;return u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:A}),L&&u.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),F&&u.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!L&&!F&&u.jsx("button",{onClick:()=>S(A),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},A)})})]}),T.length>0&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[u.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",T.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:T.map(A=>u.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[u.jsx("div",{style:{flex:1,minWidth:0},children:u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[u.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:A}),u.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),u.jsx("button",{onClick:()=>S(A),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},A))})]}),u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),u.jsxs("form",{onSubmit:x,style:{display:"flex",gap:"0.75rem"},children:[u.jsx("input",{type:"text",value:d,onChange:A=>h(A.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),u.jsx("button",{type:"submit",disabled:m||!d.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:m||!d.trim()?"not-allowed":"pointer",fontWeight:500,opacity:m||!d.trim()?.7:1,whiteSpace:"nowrap"},children:m?"Inviting...":"Send Invite"})]}),u.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),u.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:n.id})]})]})}const VB=["budget","feedback","migration","tests"];function $B(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:i}=Ze();k.useLayoutEffect(()=>{i("Budget Admin")},[i]);const o=On(),l=o.pathname==="/budget/admin",d=k.useMemo(()=>{const g=o.pathname;return g.includes("/admin/budget")?"budget":g.includes("/admin/feedback")?"feedback":g.includes("/admin/migration")?"migration":g.includes("/admin/tests")?"tests":"budget"},[o.pathname]),h=d==="tests";k.useEffect(()=>{l||r(d)},[d,l,r]);function m(){return!VB.includes(n)||n==="tests"&&!e?"budget":n}const p=k.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return t?!e&&h?u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Cn,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):u.jsxs("div",{children:[u.jsx(Pf,{mode:"link",linkPrefix:"/budget/admin",tabs:p,activeTab:d}),l?u.jsx(Ff,{to:`/budget/admin/${m()}`,replace:!0}):u.jsx(Vf,{})]}):u.jsxs("div",{children:[u.jsx("h1",{children:"Access Denied"}),u.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),u.jsx("p",{style:{marginTop:"1rem"},children:u.jsx(Cn,{to:"/budget",children:"Go to Budget "})})]})}function qB(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{isAdmin:n}=Ze(),{budget:r,accounts:i,accountGroups:o,categories:l,categoryGroups:d,isOwner:h,isLoading:m}=An();return k.useEffect(()=>(m?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[m,t,e]),m?null:r?u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),u.jsx("strong",{children:r.name})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),u.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),u.jsx("strong",{children:r.owner_email||r.owner_id})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.jsx("span",{children:""}),u.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),u.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",u.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&u.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[u.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),u.jsx("button",{onClick:()=>{const p={...r,accounts:i,account_groups:o,categories:l,category_groups:d,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),v=URL.createObjectURL(g),_=document.createElement("a");_.href=v,_.download=`budget_${r.id}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(v)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):u.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function aS({selectedType:t,onSelect:e}){return u.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=zf[n],i=t==="feature"?"new_feature":t,o=i===n||!i&&n==="bug";return u.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&u.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function HB(){const[t,e]=k.useState(null),[n,r]=k.useState(null),[i,o]=k.useState(!1),[l,d]=k.useState(""),[h,m]=k.useState("bug"),[p,g]=k.useState(null),[v,_]=k.useState(!1),[E,x]=k.useState(null),S=k.useContext(fd),T=Da().get_current_firebase_user(),A=Ft(),L=c6(),{submitFeedback:F}=WT(),{toggleFeedback:H}=vP(),{updateSortOrder:O}=xP(),I=L.data?.items||[],N=fs(),{addLoadingHold:U,removeLoadingHold:$}=sr();k.useEffect(()=>(L.isLoading?U("settings-feedback","Loading feedback..."):$("settings-feedback"),()=>$("settings-feedback")),[L.isLoading,U,$]);function j(me){me.preventDefault(),!(!l.trim()||!S.username||!T)&&(F.mutate({userId:T.uid,userEmail:S.username,text:l.trim(),feedbackType:h,currentPath:"/settings/feedback"}),d(""),m("bug"),o(!1))}function M(me){me.is_done?R(me):g(me)}async function R(me){try{await H.mutateAsync({item:me})}catch(Ce){console.error("[Feedback] Error updating feedback:",Ce),qr.add({type:"error",message:"Failed to update feedback",autoDismissMs:5e3})}}function K(){p&&(R(p),g(null))}async function W(){_(!1);const me="mark-all-feedback-complete";U(me,`Marking ${X.length} item${X.length!==1?"s":""} as complete...`);try{const Ce=new Date().toISOString(),he=new Set(X.map(ce=>ce.id)),Me=new Map;for(const ce of X)Me.has(ce.doc_id)||Me.set(ce.doc_id,[]),Me.get(ce.doc_id).push(ce);const qe=[];for(const[ce,pe]of Me){const ee=(async()=>{const se=(await QT(ce,"mark all feedback complete")).items.map(xe=>he.has(xe.id)?{...xe,is_done:!0,completed_at:Ce}:xe);await Z0({docId:ce,items:se,description:`marking ${pe.length} feedback item${pe.length!==1?"s":""} as complete`})})();qe.push(ee)}await Promise.all(qe);const Oe=ke.feedback(),z=A.getQueryData(Oe);z&&A.setQueryData(Oe,{items:z.items.map(ce=>he.has(ce.id)?{...ce,is_done:!0,completed_at:Ce}:ce)}),await A.invalidateQueries({queryKey:Oe}),qr.add({type:"success",message:`Marked ${X.length} item${X.length!==1?"s":""} as complete`,autoDismissMs:3e3})}catch(Ce){console.error("[Feedback] Error marking all as complete:",Ce),qr.add({type:"error",message:"Failed to mark all items as complete",autoDismissMs:5e3}),await A.invalidateQueries({queryKey:ke.feedback()})}finally{$(me)}}function q(){W()}async function Z(me){if(E){try{const he=I.filter(Me=>Me.doc_id===E.doc_id).map(Me=>({id:Me.id,text:Me.text,created_at:Me.created_at,is_done:Me.is_done,completed_at:Me.completed_at,sort_order:Me.sort_order,feedback_type:Me.id===E.id?me:Me.feedback_type}));await O.mutateAsync({docId:E.doc_id,items:he})}catch(Ce){console.error("[Feedback] Error updating feedback type:",Ce),qr.add({type:"error",message:"Failed to update feedback type",autoDismissMs:5e3})}x(null)}}const X=I.filter(me=>!me.is_done).sort((me,Ce)=>me.sort_order-Ce.sort_order),ne=I.filter(me=>me.is_done).sort((me,Ce)=>new Date(Ce.completed_at||0).getTime()-new Date(me.completed_at||0).getTime());function B(me,Ce){e(Ce),me.dataTransfer.effectAllowed="move"}function G(me,Ce){me.preventDefault(),Ce!==t&&r(Ce)}function te(){r(null)}function ie(){e(null),r(null)}async function ae(me,Ce){if(me.preventDefault(),!t||t===Ce){ie();return}const he=X.findIndex(ce=>ce.id===t),Me=[...X],[qe]=Me.splice(he,1);if(Ce==="__end__")Me.push(qe);else{const ce=Me.findIndex(pe=>pe.id===Ce);Me.splice(ce,0,qe)}const Oe=Me.map((ce,pe)=>({...ce,sort_order:pe}));ie();const z=new Map;for(const ce of Oe)z.has(ce.doc_id)||z.set(ce.doc_id,[]),z.get(ce.doc_id).push({id:ce.id,text:ce.text,created_at:ce.created_at,is_done:ce.is_done,completed_at:ce.completed_at,sort_order:ce.sort_order,feedback_type:ce.feedback_type});for(const ce of ne)z.has(ce.doc_id)||z.set(ce.doc_id,[]),z.get(ce.doc_id).push({id:ce.id,text:ce.text,created_at:ce.created_at,is_done:ce.is_done,completed_at:ce.completed_at,sort_order:ce.sort_order,feedback_type:ce.feedback_type});try{for(const[ce,pe]of z)await O.mutateAsync({docId:ce,items:pe})}catch(ce){console.error("[Feedback] Error saving order:",ce),qr.add({type:"error",message:"Failed to save order",autoDismissMs:5e3})}}function fe(){const me=Ee(X),Ce=new Blob([me],{type:"text/markdown"}),he=URL.createObjectURL(Ce),Me=document.createElement("a");Me.href=he,Me.download=`feedback-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(Me),Me.click(),document.body.removeChild(Me),URL.revokeObjectURL(he)}function Ee(me){let Ce=`# Feedback Export

`;return Ce+=`Generated: ${new Date().toISOString()}

`,me.length>0&&(Ce+=`## Pending

`,me.forEach((he,Me)=>{const qe=he.feedback_type?zf[he.feedback_type]?.label||he.feedback_type:"Unknown";Ce+=`### ${Me+1}. [${qe}] ${he.text.split(`
`)[0].substring(0,60)}${he.text.split(`
`)[0].length>60?"...":""}

`,Ce+=`- **Type:** ${qe}
`,Ce+=`- **Created:** ${he.created_at}
`,Ce+=`- **User:** ${he.user_email||he.doc_id}
`,Ce+=`- **ID:** ${he.id}

`,Ce+=`${he.text}

`,Ce+=`---

`})),Ce}return L.isLoading?null:u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",flexDirection:N?"column":"row",justifyContent:"space-between",alignItems:N?"stretch":"flex-start",gap:N?"0.75rem":"1rem",marginTop:"1.5rem",marginBottom:"0.5rem"},children:[u.jsxs("div",{children:[u.jsx("h2",{style:{marginTop:0},children:"Feedback"}),u.jsx("p",{style:{...RT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."})]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexDirection:N?"column":"row"},children:[u.jsx(Fe,{variant:"secondary",actionName:"Download Feedback as Markdown",onClick:fe,disabled:X.length===0,style:N?{width:"100%"}:void 0,children:"Download Markdown"}),u.jsx(Fe,{variant:"secondary",actionName:"Mark All Complete",onClick:()=>_(!0),disabled:X.length===0,style:N?{width:"100%"}:void 0,children:"Mark All Complete"})]})]}),u.jsxs("div",{style:Xl,children:[X.length===0&&!i&&u.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),X.map(me=>u.jsx(iz,{item:me,isDragging:t===me.id,isDragOver:n===me.id,onDragStart:Ce=>B(Ce,me.id),onDragOver:Ce=>G(Ce,me.id),onDragLeave:te,onDragEnd:ie,onDrop:Ce=>ae(Ce,me.id),onToggleDone:()=>M(me),onTypeClick:()=>x(me)},me.id)),t&&X.length>0&&u.jsx(X0,{isActive:n==="__end__",onDragOver:me=>G(me,"__end__"),onDragLeave:te,onDrop:me=>ae(me,"__end__")})]}),i?u.jsxs(wi,{actionName:"Add Feedback",onSubmit:j,children:[u.jsx(aS,{selectedType:h,onSelect:m}),u.jsx(Y0,{value:l,onChange:me=>d(me.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),u.jsxs(Ma,{children:[u.jsx(Fe,{type:"submit",actionName:"Add Feedback",disabled:!l.trim(),children:"Add Feedback"}),u.jsx(Fe,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{o(!1),d(""),m("bug")},children:"Cancel"})]})]}):u.jsx(Fe,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>o(!0),children:"+ Add Feedback"}),ne.length>0&&u.jsx(J0,{title:"Completed",count:ne.length,children:u.jsx("div",{style:{...Xl,marginTop:"0.5rem"},children:ne.map(me=>u.jsx(az,{item:me,onToggleDone:()=>M(me),onTypeClick:()=>x(me)},me.id))})}),u.jsxs(ls,{isOpen:p!==null,onClose:()=>g(null),title:"Mark as Complete",children:[u.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),p&&u.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',p.text,'"']}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Fe,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>g(null),children:"Cancel"}),u.jsx(Fe,{variant:"primary",actionName:"Confirm Mark Complete",onClick:K,children:"Mark Complete"})]})]}),u.jsxs(ls,{isOpen:v,onClose:()=>_(!1),title:"Mark All as Complete",children:[u.jsxs("p",{style:{margin:"0 0 1.5rem 0"},children:["Are you sure you want to mark all ",X.length," pending feedback item",X.length!==1?"s":""," as complete?"]}),u.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[u.jsx(Fe,{variant:"secondary",actionName:"Cancel Mark All Complete",onClick:()=>_(!1),children:"Cancel"}),u.jsx(Fe,{variant:"primary",actionName:"Confirm Mark All Complete",onClick:q,children:"Mark All Complete"})]})]}),u.jsxs(ls,{isOpen:E!==null,onClose:()=>x(null),title:"Change Feedback Type",children:[u.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),u.jsx(aS,{selectedType:E?.feedback_type||"bug",onSelect:Z}),u.jsx(Fe,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>x(null),style:{width:"100%"},children:"Cancel"})]})]})}function GB(){Ve.clear(),window.location.reload()}function QB(){const e=Da().get_current_firebase_user(),{selectedBudgetId:n}=Ze(),r=dP({currentUser:e}),i=G3({currentUser:e}),o=V3({currentUser:e}),l=Z3({currentUser:e}),d=O3({currentUser:e}),h=mP({currentUser:e,budgetId:n}),m=_P({currentUser:e}),p=A3({currentUser:e}),g=j3({currentUser:e}),v=r.isScanning||i.isScanning||o.isScanning||l.isScanning||d.isScanning||p.isScanning||g.isScanning,_=i.isRunning||o.isRunning||l.isRunning||d.isRunning||p.isDeleting||g.isDeleting||h.isDownloading||m.isUploading,E=async()=>{await Promise.all([r.scan(),i.scanStatus(),o.scanStatus(),l.scanStatus(),d.scan(),p.scanStatus(),g.scanStatus()])};return u.jsxs("div",{children:[u.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[u.jsx("h2",{style:{margin:0},children:"Data Migrations"}),u.jsxs("button",{onClick:E,disabled:v||_,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:v||_?"not-allowed":"pointer",fontWeight:500,opacity:v||_?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[u.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:v?u.jsx(Vn,{noMargin:!0}):""}),"Refresh All"]})]}),u.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),u.jsx(uz,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading}),u.jsx(mz,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading,accountCategoryValidation:{status:r.status,hasData:!!r.status,hasViolations:r.hasViolations,violationCount:r.violationCount,isScanning:r.isScanning,report:r.report,scan:r.scan},orphanedIdCleanup:{status:i.status,hasData:!!i.status,hasItemsToFix:i.hasItemsToFix,totalOrphaned:i.status?i.status.orphanedCategoryIds+i.status.orphanedAccountIds:0,isScanning:i.isScanning,isRunning:i.isRunning,result:i.result,scanStatus:i.scanStatus,runMigration:i.runMigration},expenseToAdjustment:{status:o.status,hasData:!!o.status,hasItemsToMigrate:o.hasItemsToMigrate,totalToMigrate:o.status?.expensesToMigrate??0,isScanning:o.isScanning,isRunning:o.isRunning,result:o.result,scanStatus:o.scanStatus,runMigration:o.runMigration},adjustmentsToTransfers:{status:l.status,hasData:!!l.status,hasPairsToConvert:l.hasPairsToConvert,totalPairs:l.status?.pairsFound??0,isScanning:l.isScanning,isRunning:l.isRunning,result:l.result,scanStatus:l.scanStatus,runMigration:l.runMigration},precisionCleanup:{status:d.status,hasData:d.hasData,hasIssues:d.hasIssues,totalIssues:d.totalIssues,isScanning:d.isScanning,isRunning:d.isRunning,result:d.result,scan:d.scan,runCleanup:d.runCleanup}}),u.jsx(bz,{disabled:!e,onDownloadBackup:h.downloadBudget,isDownloadingBackup:h.isDownloading,budgetDownloadUpload:{isDownloading:h.isDownloading,downloadProgress:h.progress,downloadError:h.error,downloadBudget:h.downloadBudget,isScanning:m.isScanning,isUploading:m.isUploading,uploadStatus:m.status,uploadProgress:m.progress,uploadError:m.error,uploadResult:m.result,scanZipFile:m.scanZipFile,uploadBudget:m.uploadBudget},deleteAllMonths:{status:p.status,hasData:!!p.status,monthsCount:p.status?.monthsCount??0,budgetCount:p.status?.budgetCount??0,isScanning:p.isScanning,isDeleting:p.isDeleting,deleteResult:p.deleteResult,deleteProgress:p.deleteProgress,scanStatus:p.scanStatus,deleteAllMonths:p.deleteAllMonths},deleteSampleUserBudget:{status:g.status,hasData:!!g.status,totalBudgets:g.status?.totalBudgets??0,totalMonths:g.status?.totalMonths??0,isScanning:g.isScanning,isDeleting:g.isDeleting,deleteResult:g.deleteResult,deleteProgress:g.deleteProgress,scanStatus:g.scanStatus,deleteSampleUserBudget:g.deleteSampleUserBudget},onClearCache:GB}),u.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:u.jsxs("p",{style:{margin:0,opacity:.7},children:[u.jsx("strong",{children:"Note:"})," These migrations will process ",u.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),u.jsx(tA,{})]})}function Al({name:t,description:e,expectedBehavior:n,result:r,onRun:i,disabled:o,expectedToSucceed:l}){const d=r?.status==="passed"?ue.success:r?.status==="failed"?ue.danger:r?.status==="running"?ue.warning:"inherit";return u.jsxs("div",{style:{...ud,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[u.jsxs("div",{style:{flex:1},children:[u.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),u.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),u.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:l?ue.success:ue.warning},children:["Expected: ",n]})]}),u.jsx(Fe,{onClick:i,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&u.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${d} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${d} 30%, transparent)`,fontSize:"0.85rem",color:d},children:r.message})]})}function WB({totalCount:t,passedCount:e,failedCount:n}){return u.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[u.jsxs("span",{children:["Total: ",u.jsx("strong",{children:t})]}),u.jsxs("span",{style:{color:ue.success},children:["Passed: ",u.jsx("strong",{children:e})]}),u.jsxs("span",{style:{color:ue.danger},children:["Failed: ",u.jsx("strong",{children:n})]})]})}const oS=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function KB(){const{currentUserId:t}=Ze(),[e,n]=k.useState([]),[r,i]=k.useState(!1);function o(_,E){n(x=>x.map(S=>S.name===_?{...S,...E}:S))}async function l(_,E,x){o(_,{status:"running",message:"Running..."});try{const S=await E();x?o(_,{status:"failed",message:` ${S}`}):o(_,{status:"passed",message:` ${S}`})}catch(S){const C=S instanceof Error?S.message:"Unknown error";x?o(_,{status:"passed",message:` Blocked as expected: ${C}`}):o(_,{status:"failed",message:` ${C}`})}}async function d(){i(!0),n(oS.map(_=>({..._,status:"pending",message:""})));for(const _ of oS)await h(_.name);i(!1)}async function h(_){switch(_){case"Read unauthorized budget":await l(_,async()=>(await At("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await l(_,async()=>(await At("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await l(_,async()=>(await At("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:E}=await At("users",t,"security test: reading own user to get current is_admin value"),x=E?.permission_flags?.is_admin??!1;return await Df("users",t,{"permission_flags.is_admin":!x},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{data:E}=await At("users",t,"security test: reading own user to get current is_test value"),x=E?.permission_flags?.is_test??!1;return await Df("users",t,{"permission_flags.is_test":!x},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${x} to ${!x} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await l(_,async()=>{if(!t)throw new Error("Not authenticated");const{exists:E}=await At("users",t,"security test: reading own user document (should succeed)");if(E)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function m(_){e.find(x=>x.name===_)||n(x=>[...x,{name:_,status:"pending",message:"",expectedToFail:!0}]),i(!0),await h(_),i(!1)}const p=e.filter(_=>_.status==="passed").length,g=e.filter(_=>_.status==="failed").length,v=e.length;return u.jsxs("div",{children:[u.jsx("p",{style:RT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),u.jsx("div",{style:{marginBottom:"1.5rem"},children:u.jsx(Fe,{onClick:d,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&u.jsx(WB,{totalCount:v,passedCount:p,failedCount:g}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[u.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),u.jsx(Al,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read unauthorized budget"),onRun:()=>m("Read unauthorized budget"),disabled:r}),u.jsx(Al,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(_=>_.name==="Read another user's document"),onRun:()=>m("Read another user's document"),disabled:r}),u.jsx(Al,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(_=>_.name==="Read unauthorized budget month"),onRun:()=>m("Read unauthorized budget month"),disabled:r}),u.jsx(Al,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_admin in own permission_flags"),onRun:()=>m("Toggle is_admin in own permission_flags"),disabled:r}),u.jsx(Al,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(_=>_.name==="Toggle is_test in own permission_flags"),onRun:()=>m("Toggle is_test in own permission_flags"),disabled:r}),u.jsx(Al,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(_=>_.name==="Read own user document"),onRun:()=>m("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&u.jsxs(fc,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function YB({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=sr(),r=k.useContext(fd),i=On();return k.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?u.jsx(u.Fragment,{children:t}):u.jsx(Vf,{}):u.jsx(Ff,{to:"/account",state:{from:i.pathname},replace:!0}):null}function XB(){const{addLoadingHold:t,removeLoadingHold:e}=sr(),{isInitialized:n,pageTitle:r}=Ze(),{isLoading:i,error:o}=An();return k.useEffect(()=>{n?e("budget-init"):t("budget-init",i?"Fetching data from server...":"Loading budget...")},[n,i,t,e]),k.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),u.jsx("div",{style:Mf,children:u.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",o.message]})})):u.jsx("div",{style:{...Mf,paddingBottom:"5rem"},children:u.jsxs(YT,{children:[u.jsx(AP,{title:r}),n&&u.jsx(Vf,{})]})})}const ZB={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function JB(){const{isLoading:t,loadingMessage:e}=sr();return t?u.jsx(n_,{message:e}):null}function eL(){const[t,e]=k.useState(null);return k.useEffect(()=>qr.subscribe(e),[]),t?u.jsx(RP,{item:t,onDismiss:n=>qr.remove(n)}):null}function tL(){const{selectedBudgetId:t,isInitialized:e}=Ze(),n=Ft(),r=t?["initialDataLoad",t]:null,i=r?n.getQueryState(r)?.status==="success":!1;return bn(),y3(),v3(t,i&&e),u.jsxs(u.Fragment,{children:[u.jsxs(ej,{children:[u.jsx(xn,{path:"/",element:u.jsx(vz,{})}),u.jsx(xn,{path:"/account",element:u.jsx(xz,{})}),u.jsx(xn,{path:"/budget",element:u.jsx(YB,{}),children:u.jsxs(xn,{element:u.jsx(XB,{}),children:[u.jsx(xn,{index:!0,element:u.jsx(sS,{})}),u.jsx(xn,{path:":year/:month/:tab/:view?",element:u.jsx(sS,{})}),u.jsx(xn,{path:"analytics",element:u.jsx(_B,{})}),u.jsx(xn,{path:"my-budgets",element:u.jsx(AB,{})}),u.jsxs(xn,{path:"settings",element:u.jsx(RB,{}),children:[u.jsx(xn,{index:!0,element:u.jsx(Ff,{to:"categories",replace:!0})}),u.jsx(xn,{path:"accounts",element:u.jsx(PB,{})}),u.jsx(xn,{path:"categories",element:u.jsx(UB,{})}),u.jsx(xn,{path:"users",element:u.jsx(FB,{})})]}),u.jsxs(xn,{path:"admin",element:u.jsx($B,{}),children:[u.jsx(xn,{path:"budget",element:u.jsx(qB,{})}),u.jsx(xn,{path:"feedback",element:u.jsx(HB,{})}),u.jsx(xn,{path:"migration",element:u.jsx(QB,{})}),u.jsx(xn,{path:"tests",element:u.jsx(KB,{})})]})]})})]}),u.jsx(EP,{}),u.jsx(tA,{}),u.jsx(eL,{})]})}function nL(){const[t,e]=k.useState(ZB),n=Da(),r=k.useRef(!1),{addLoadingHold:i,removeLoadingHold:o}=sr();return k.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(l=>{e({is_logged_in:l!=null,is_auth_checked:!0,username:l?.email??"",set_user_context:e})}))},[n]),k.useEffect(()=>{t.is_auth_checked?o("auth"):i("auth","Authenticating...")},[t.is_auth_checked,i,o]),t.is_auth_checked?u.jsx(fd.Provider,{value:t,children:u.jsx(bO,{children:u.jsx(nz,{children:u.jsx(e3,{children:u.jsx(w3,{children:u.jsx(Cj,{children:u.jsx(tL,{})})})})})})}):null}function rL(){return u.jsxs(yR,{children:[u.jsx(JB,{}),u.jsx(nL,{})]})}e2.createRoot(document.getElementById("root")).render(u.jsx(k.StrictMode,{children:u.jsx(rL,{})}));
