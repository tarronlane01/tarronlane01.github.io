(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();var Jh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Lp={exports:{}},Au={};var qx;function pR(){if(qx)return Au;qx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,s,o){var c=null;if(o!==void 0&&(c=""+o),s.key!==void 0&&(c=""+s.key),"key"in s){o={};for(var l in s)l!=="key"&&(o[l]=s[l])}else o=s;return s=o.ref,{$$typeof:t,type:r,key:c,ref:s!==void 0?s:null,props:o}}return Au.Fragment=e,Au.jsx=n,Au.jsxs=n,Au}var Hx;function yR(){return Hx||(Hx=1,Lp.exports=pR()),Lp.exports}var d=yR(),Up={exports:{}},nt={};var Wx;function _R(){if(Wx)return nt;Wx=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),_=Symbol.iterator;function y(P){return P===null||typeof P!="object"?null:(P=_&&P[_]||P["@@iterator"],typeof P=="function"?P:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,S={};function E(P,G,ee){this.props=P,this.context=G,this.refs=S,this.updater=ee||x}E.prototype.isReactComponent={},E.prototype.setState=function(P,G){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,G,"setState")},E.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function T(){}T.prototype=E.prototype;function A(P,G,ee){this.props=P,this.context=G,this.refs=S,this.updater=ee||x}var M=A.prototype=new T;M.constructor=A,w(M,E.prototype),M.isPureReactComponent=!0;var L=Array.isArray;function H(){}var O={H:null,A:null,T:null,S:null},j=Object.prototype.hasOwnProperty;function B(P,G,ee){var re=ee.ref;return{$$typeof:t,type:P,key:G,ref:re!==void 0?re:null,props:ee}}function V(P,G){return B(P.type,G,P.props)}function $(P){return typeof P=="object"&&P!==null&&P.$$typeof===t}function k(P){var G={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(ee){return G[ee]})}var N=/\/+/g;function D(P,G){return typeof P=="object"&&P!==null&&P.key!=null?k(""+P.key):G.toString(36)}function X(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(H,H):(P.status="pending",P.then(function(G){P.status==="pending"&&(P.status="fulfilled",P.value=G)},function(G){P.status==="pending"&&(P.status="rejected",P.reason=G)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function K(P,G,ee,re,se){var ge=typeof P;(ge==="undefined"||ge==="boolean")&&(P=null);var Ce=!1;if(P===null)Ce=!0;else switch(ge){case"bigint":case"string":case"number":Ce=!0;break;case"object":switch(P.$$typeof){case t:case e:Ce=!0;break;case p:return Ce=P._init,K(Ce(P._payload),G,ee,re,se)}}if(Ce)return se=se(P),Ce=re===""?"."+D(P,0):re,L(se)?(ee="",Ce!=null&&(ee=Ce.replace(N,"$&/")+"/"),K(se,G,ee,"",function(Me){return Me})):se!=null&&($(se)&&(se=V(se,ee+(se.key==null||P&&P.key===se.key?"":(""+se.key).replace(N,"$&/")+"/")+Ce)),G.push(se)),1;Ce=0;var ie=re===""?".":re+":";if(L(P))for(var le=0;le<P.length;le++)re=P[le],ge=ie+D(re,le),Ce+=K(re,G,ee,ge,se);else if(le=y(P),typeof le=="function")for(P=le.call(P),le=0;!(re=P.next()).done;)re=re.value,ge=ie+D(re,le++),Ce+=K(re,G,ee,ge,se);else if(ge==="object"){if(typeof P.then=="function")return K(X(P),G,ee,re,se);throw G=String(P),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return Ce}function q(P,G,ee){if(P==null)return P;var re=[],se=0;return K(P,re,"","",function(ge){return G.call(ee,ge,se++)}),re}function te(P){if(P._status===-1){var G=P._result;G=G(),G.then(function(ee){(P._status===0||P._status===-1)&&(P._status=1,P._result=ee)},function(ee){(P._status===0||P._status===-1)&&(P._status=2,P._result=ee)}),P._status===-1&&(P._status=0,P._result=G)}if(P._status===1)return P._result.default;throw P._result}var Q=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},ae={map:q,forEach:function(P,G,ee){q(P,function(){G.apply(this,arguments)},ee)},count:function(P){var G=0;return q(P,function(){G++}),G},toArray:function(P){return q(P,function(G){return G})||[]},only:function(P){if(!$(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return nt.Activity=g,nt.Children=ae,nt.Component=E,nt.Fragment=n,nt.Profiler=s,nt.PureComponent=A,nt.StrictMode=r,nt.Suspense=h,nt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,nt.__COMPILER_RUNTIME={__proto__:null,c:function(P){return O.H.useMemoCache(P)}},nt.cache=function(P){return function(){return P.apply(null,arguments)}},nt.cacheSignal=function(){return null},nt.cloneElement=function(P,G,ee){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var re=w({},P.props),se=P.key;if(G!=null)for(ge in G.key!==void 0&&(se=""+G.key),G)!j.call(G,ge)||ge==="key"||ge==="__self"||ge==="__source"||ge==="ref"&&G.ref===void 0||(re[ge]=G[ge]);var ge=arguments.length-2;if(ge===1)re.children=ee;else if(1<ge){for(var Ce=Array(ge),ie=0;ie<ge;ie++)Ce[ie]=arguments[ie+2];re.children=Ce}return B(P.type,se,re)},nt.createContext=function(P){return P={$$typeof:c,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:o,_context:P},P},nt.createElement=function(P,G,ee){var re,se={},ge=null;if(G!=null)for(re in G.key!==void 0&&(ge=""+G.key),G)j.call(G,re)&&re!=="key"&&re!=="__self"&&re!=="__source"&&(se[re]=G[re]);var Ce=arguments.length-2;if(Ce===1)se.children=ee;else if(1<Ce){for(var ie=Array(Ce),le=0;le<Ce;le++)ie[le]=arguments[le+2];se.children=ie}if(P&&P.defaultProps)for(re in Ce=P.defaultProps,Ce)se[re]===void 0&&(se[re]=Ce[re]);return B(P,ge,se)},nt.createRef=function(){return{current:null}},nt.forwardRef=function(P){return{$$typeof:l,render:P}},nt.isValidElement=$,nt.lazy=function(P){return{$$typeof:p,_payload:{_status:-1,_result:P},_init:te}},nt.memo=function(P,G){return{$$typeof:f,type:P,compare:G===void 0?null:G}},nt.startTransition=function(P){var G=O.T,ee={};O.T=ee;try{var re=P(),se=O.S;se!==null&&se(ee,re),typeof re=="object"&&re!==null&&typeof re.then=="function"&&re.then(H,Q)}catch(ge){Q(ge)}finally{G!==null&&ee.types!==null&&(G.types=ee.types),O.T=G}},nt.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},nt.use=function(P){return O.H.use(P)},nt.useActionState=function(P,G,ee){return O.H.useActionState(P,G,ee)},nt.useCallback=function(P,G){return O.H.useCallback(P,G)},nt.useContext=function(P){return O.H.useContext(P)},nt.useDebugValue=function(){},nt.useDeferredValue=function(P,G){return O.H.useDeferredValue(P,G)},nt.useEffect=function(P,G){return O.H.useEffect(P,G)},nt.useEffectEvent=function(P){return O.H.useEffectEvent(P)},nt.useId=function(){return O.H.useId()},nt.useImperativeHandle=function(P,G,ee){return O.H.useImperativeHandle(P,G,ee)},nt.useInsertionEffect=function(P,G){return O.H.useInsertionEffect(P,G)},nt.useLayoutEffect=function(P,G){return O.H.useLayoutEffect(P,G)},nt.useMemo=function(P,G){return O.H.useMemo(P,G)},nt.useOptimistic=function(P,G){return O.H.useOptimistic(P,G)},nt.useReducer=function(P,G,ee){return O.H.useReducer(P,G,ee)},nt.useRef=function(P){return O.H.useRef(P)},nt.useState=function(P){return O.H.useState(P)},nt.useSyncExternalStore=function(P,G,ee){return O.H.useSyncExternalStore(P,G,ee)},nt.useTransition=function(){return O.H.useTransition()},nt.version="19.2.3",nt}var Qx;function e_(){return Qx||(Qx=1,Up.exports=_R()),Up.exports}var R=e_(),Fp={exports:{}},ju={},Vp={exports:{}},$p={};var Kx;function bR(){return Kx||(Kx=1,(function(t){function e(K,q){var te=K.length;K.push(q);e:for(;0<te;){var Q=te-1>>>1,ae=K[Q];if(0<s(ae,q))K[Q]=q,K[te]=ae,te=Q;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var q=K[0],te=K.pop();if(te!==q){K[0]=te;e:for(var Q=0,ae=K.length,P=ae>>>1;Q<P;){var G=2*(Q+1)-1,ee=K[G],re=G+1,se=K[re];if(0>s(ee,te))re<ae&&0>s(se,ee)?(K[Q]=se,K[re]=te,Q=re):(K[Q]=ee,K[G]=te,Q=G);else if(re<ae&&0>s(se,te))K[Q]=se,K[re]=te,Q=re;else break e}}return q}function s(K,q){var te=K.sortIndex-q.sortIndex;return te!==0?te:K.id-q.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var c=Date,l=c.now();t.unstable_now=function(){return c.now()-l}}var h=[],f=[],p=1,g=null,_=3,y=!1,x=!1,w=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function M(K){for(var q=n(f);q!==null;){if(q.callback===null)r(f);else if(q.startTime<=K)r(f),q.sortIndex=q.expirationTime,e(h,q);else break;q=n(f)}}function L(K){if(w=!1,M(K),!x)if(n(h)!==null)x=!0,H||(H=!0,k());else{var q=n(f);q!==null&&X(L,q.startTime-K)}}var H=!1,O=-1,j=5,B=-1;function V(){return S?!0:!(t.unstable_now()-B<j)}function $(){if(S=!1,H){var K=t.unstable_now();B=K;var q=!0;try{e:{x=!1,w&&(w=!1,T(O),O=-1),y=!0;var te=_;try{t:{for(M(K),g=n(h);g!==null&&!(g.expirationTime>K&&V());){var Q=g.callback;if(typeof Q=="function"){g.callback=null,_=g.priorityLevel;var ae=Q(g.expirationTime<=K);if(K=t.unstable_now(),typeof ae=="function"){g.callback=ae,M(K),q=!0;break t}g===n(h)&&r(h),M(K)}else r(h);g=n(h)}if(g!==null)q=!0;else{var P=n(f);P!==null&&X(L,P.startTime-K),q=!1}}break e}finally{g=null,_=te,y=!1}q=void 0}}finally{q?k():H=!1}}}var k;if(typeof A=="function")k=function(){A($)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,D=N.port2;N.port1.onmessage=$,k=function(){D.postMessage(null)}}else k=function(){E($,0)};function X(K,q){O=E(function(){K(t.unstable_now())},q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return _},t.unstable_next=function(K){switch(_){case 1:case 2:case 3:var q=3;break;default:q=_}var te=_;_=q;try{return K()}finally{_=te}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(K,q){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var te=_;_=K;try{return q()}finally{_=te}},t.unstable_scheduleCallback=function(K,q,te){var Q=t.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?Q+te:Q):te=Q,K){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=te+ae,K={id:p++,callback:q,priorityLevel:K,startTime:te,expirationTime:ae,sortIndex:-1},te>Q?(K.sortIndex=te,e(f,K),n(h)===null&&K===n(f)&&(w?(T(O),O=-1):w=!0,X(L,te-Q))):(K.sortIndex=ae,e(h,K),x||y||(x=!0,H||(H=!0,k()))),K},t.unstable_shouldYield=V,t.unstable_wrapCallback=function(K){var q=_;return function(){var te=_;_=q;try{return K.apply(this,arguments)}finally{_=te}}}})($p)),$p}var Yx;function vR(){return Yx||(Yx=1,Vp.exports=bR()),Vp.exports}var Gp={exports:{}},Yn={};var Xx;function xR(){if(Xx)return Yn;Xx=1;var t=e_();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(h,f,p){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:g==null?null:""+g,children:h,containerInfo:f,implementation:p}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Yn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Yn.createPortal=function(h,f){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(h,f,null,p)},Yn.flushSync=function(h){var f=c.T,p=r.p;try{if(c.T=null,r.p=2,h)return h()}finally{c.T=f,r.p=p,r.d.f()}},Yn.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,r.d.C(h,f))},Yn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},Yn.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var p=f.as,g=l(p,f.crossOrigin),_=typeof f.integrity=="string"?f.integrity:void 0,y=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;p==="style"?r.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:g,integrity:_,fetchPriority:y}):p==="script"&&r.d.X(h,{crossOrigin:g,integrity:_,fetchPriority:y,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Yn.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var p=l(f.as,f.crossOrigin);r.d.M(h,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&r.d.M(h)},Yn.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var p=f.as,g=l(p,f.crossOrigin);r.d.L(h,p,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Yn.preloadModule=function(h,f){if(typeof h=="string")if(f){var p=l(f.as,f.crossOrigin);r.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else r.d.m(h)},Yn.requestFormReset=function(h){r.d.r(h)},Yn.unstable_batchedUpdates=function(h,f){return h(f)},Yn.useFormState=function(h,f,p){return c.H.useFormState(h,f,p)},Yn.useFormStatus=function(){return c.H.useHostTransitionStatus()},Yn.version="19.2.3",Yn}var Zx;function wR(){if(Zx)return Gp.exports;Zx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Gp.exports=xR(),Gp.exports}var Jx;function SR(){if(Jx)return ju;Jx=1;var t=vR(),e=e_(),n=wR();function r(i){var a="https://react.dev/errors/"+i;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)a+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function o(i){var a=i,u=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,(a.flags&4098)!==0&&(u=a.return),i=a.return;while(i)}return a.tag===3?u:null}function c(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function l(i){if(i.tag===31){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function h(i){if(o(i)!==i)throw Error(r(188))}function f(i){var a=i.alternate;if(!a){if(a=o(i),a===null)throw Error(r(188));return a!==i?null:i}for(var u=i,m=a;;){var v=u.return;if(v===null)break;var C=v.alternate;if(C===null){if(m=v.return,m!==null){u=m;continue}break}if(v.child===C.child){for(C=v.child;C;){if(C===u)return h(v),i;if(C===m)return h(v),a;C=C.sibling}throw Error(r(188))}if(u.return!==m.return)u=v,m=C;else{for(var z=!1,W=v.child;W;){if(W===u){z=!0,u=v,m=C;break}if(W===m){z=!0,m=v,u=C;break}W=W.sibling}if(!z){for(W=C.child;W;){if(W===u){z=!0,u=C,m=v;break}if(W===m){z=!0,m=C,u=v;break}W=W.sibling}if(!z)throw Error(r(189))}}if(u.alternate!==m)throw Error(r(190))}if(u.tag!==3)throw Error(r(188));return u.stateNode.current===u?i:a}function p(i){var a=i.tag;if(a===5||a===26||a===27||a===6)return i;for(i=i.child;i!==null;){if(a=p(i),a!==null)return a;i=i.sibling}return null}var g=Object.assign,_=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),A=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),$=Symbol.iterator;function k(i){return i===null||typeof i!="object"?null:(i=$&&i[$]||i["@@iterator"],typeof i=="function"?i:null)}var N=Symbol.for("react.client.reference");function D(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===N?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case w:return"Fragment";case E:return"Profiler";case S:return"StrictMode";case L:return"Suspense";case H:return"SuspenseList";case B:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case x:return"Portal";case A:return i.displayName||"Context";case T:return(i._context.displayName||"Context")+".Consumer";case M:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case O:return a=i.displayName||null,a!==null?a:D(i.type)||"Memo";case j:a=i._payload,i=i._init;try{return D(i(a))}catch{}}return null}var X=Array.isArray,K=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},Q=[],ae=-1;function P(i){return{current:i}}function G(i){0>ae||(i.current=Q[ae],Q[ae]=null,ae--)}function ee(i,a){ae++,Q[ae]=i.current,i.current=a}var re=P(null),se=P(null),ge=P(null),Ce=P(null);function ie(i,a){switch(ee(ge,a),ee(se,i),ee(re,null),a.nodeType){case 9:case 11:i=(i=a.documentElement)&&(i=i.namespaceURI)?mx(i):0;break;default:if(i=a.tagName,a=a.namespaceURI)a=mx(a),i=gx(a,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}G(re),ee(re,i)}function le(){G(re),G(se),G(ge)}function Me(i){i.memoizedState!==null&&ee(Ce,i);var a=re.current,u=gx(a,i.type);a!==u&&(ee(se,i),ee(re,u))}function Be(i){se.current===i&&(G(re),G(se)),Ce.current===i&&(G(Ce),Su._currentValue=te)}var Ze,st;function U(i){if(Ze===void 0)try{throw Error()}catch(u){var a=u.stack.trim().match(/\n( *(at )?)/);Ze=a&&a[1]||"",st=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ze+i+st}var fe=!1;function ue(i,a){if(!i||fe)return"";fe=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(a){var De=function(){throw Error()};if(Object.defineProperty(De.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(De,[])}catch(we){var be=we}Reflect.construct(i,[],De)}else{try{De.call()}catch(we){be=we}i.call(De.prototype)}}else{try{throw Error()}catch(we){be=we}(De=i())&&typeof De.catch=="function"&&De.catch(function(){})}}catch(we){if(we&&be&&typeof we.stack=="string")return[we.stack,be.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=m.DetermineComponentFrameRoot(),z=C[0],W=C[1];if(z&&W){var ne=z.split(`
`),_e=W.split(`
`);for(v=m=0;m<ne.length&&!ne[m].includes("DetermineComponentFrameRoot");)m++;for(;v<_e.length&&!_e[v].includes("DetermineComponentFrameRoot");)v++;if(m===ne.length||v===_e.length)for(m=ne.length-1,v=_e.length-1;1<=m&&0<=v&&ne[m]!==_e[v];)v--;for(;1<=m&&0<=v;m--,v--)if(ne[m]!==_e[v]){if(m!==1||v!==1)do if(m--,v--,0>v||ne[m]!==_e[v]){var je=`
`+ne[m].replace(" at new "," at ");return i.displayName&&je.includes("<anonymous>")&&(je=je.replace("<anonymous>",i.displayName)),je}while(1<=m&&0<=v);break}}}finally{fe=!1,Error.prepareStackTrace=u}return(u=i?i.displayName||i.name:"")?U(u):""}function J(i,a){switch(i.tag){case 26:case 27:case 5:return U(i.type);case 16:return U("Lazy");case 13:return i.child!==a&&a!==null?U("Suspense Fallback"):U("Suspense");case 19:return U("SuspenseList");case 0:case 15:return ue(i.type,!1);case 11:return ue(i.type.render,!1);case 1:return ue(i.type,!0);case 31:return U("Activity");default:return""}}function Z(i){try{var a="",u=null;do a+=J(i,u),u=i,i=i.return;while(i);return a}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var oe=Object.prototype.hasOwnProperty,Se=t.unstable_scheduleCallback,xe=t.unstable_cancelCallback,de=t.unstable_shouldYield,Ne=t.unstable_requestPaint,Ae=t.unstable_now,Ie=t.unstable_getCurrentPriorityLevel,qe=t.unstable_ImmediatePriority,wt=t.unstable_UserBlockingPriority,it=t.unstable_NormalPriority,Qn=t.unstable_LowPriority,bi=t.unstable_IdlePriority,ir=t.log,vi=t.unstable_setDisableYieldValue,xt=null,nn=null;function Kn(i){if(typeof ir=="function"&&vi(i),nn&&typeof nn.setStrictMode=="function")try{nn.setStrictMode(xt,i)}catch{}}var Et=Math.clz32?Math.clz32:ec,Za=Math.log,$s=Math.LN2;function ec(i){return i>>>=0,i===0?32:31-(Za(i)/$s|0)|0}var Pr=256,xi=262144,Ut=4194304;function sr(i){var a=i&42;if(a!==0)return a;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function wi(i,a,u){var m=i.pendingLanes;if(m===0)return 0;var v=0,C=i.suspendedLanes,z=i.pingedLanes;i=i.warmLanes;var W=m&134217727;return W!==0?(m=W&~C,m!==0?v=sr(m):(z&=W,z!==0?v=sr(z):u||(u=W&~i,u!==0&&(v=sr(u))))):(W=m&~C,W!==0?v=sr(W):z!==0?v=sr(z):u||(u=m&~i,u!==0&&(v=sr(u)))),v===0?0:a!==0&&a!==v&&(a&C)===0&&(C=v&-v,u=a&-a,C>=u||C===32&&(u&4194048)!==0)?a:v}function ti(i,a){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&a)===0}function $m(i,a){switch(i){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Id(){var i=Ut;return Ut<<=1,(Ut&62914560)===0&&(Ut=4194304),i}function Si(i){for(var a=[],u=0;31>u;u++)a.push(i);return a}function Ja(i,a){i.pendingLanes|=a,a!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function Gm(i,a,u,m,v,C){var z=i.pendingLanes;i.pendingLanes=u,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=u,i.entangledLanes&=u,i.errorRecoveryDisabledLanes&=u,i.shellSuspendCounter=0;var W=i.entanglements,ne=i.expirationTimes,_e=i.hiddenUpdates;for(u=z&~u;0<u;){var je=31-Et(u),De=1<<je;W[je]=0,ne[je]=-1;var be=_e[je];if(be!==null)for(_e[je]=null,je=0;je<be.length;je++){var we=be[je];we!==null&&(we.lane&=-536870913)}u&=~De}m!==0&&eo(i,m,0),C!==0&&v===0&&i.tag!==0&&(i.suspendedLanes|=C&~(z&~a))}function eo(i,a,u){i.pendingLanes|=a,i.suspendedLanes&=~a;var m=31-Et(a);i.entangledLanes|=a,i.entanglements[m]=i.entanglements[m]|1073741824|u&261930}function jl(i,a){var u=i.entangledLanes|=a;for(i=i.entanglements;u;){var m=31-Et(u),v=1<<m;v&a|i[m]&a&&(i[m]|=a),u&=~v}}function Rl(i,a){var u=a&-a;return u=(u&42)!==0?1:to(u),(u&(i.suspendedLanes|a))!==0?0:u}function to(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function is(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function kd(){var i=q.p;return i!==0?i:(i=window.event,i===void 0?32:zx(i.type))}function ni(i,a){var u=q.p;try{return q.p=i,a()}finally{q.p=u}}var ri=Math.random().toString(36).slice(2),fn="__reactFiber$"+ri,Mn="__reactProps$"+ri,Ci="__reactContainer$"+ri,tc="__reactEvents$"+ri,qm="__reactListeners$"+ri,Dd="__reactHandles$"+ri,Md="__reactResources$"+ri,Ei="__reactMarker$"+ri;function nc(i){delete i[fn],delete i[Mn],delete i[tc],delete i[qm],delete i[Dd]}function Ti(i){var a=i[fn];if(a)return a;for(var u=i.parentNode;u;){if(a=u[Ci]||u[fn]){if(u=a.alternate,a.child!==null||u!==null&&u.child!==null)for(i=wx(i);i!==null;){if(u=i[fn])return u;i=wx(i)}return a}i=u,u=i.parentNode}return null}function zr(i){if(i=i[fn]||i[Ci]){var a=i.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return i}return null}function Cr(i){var a=i.tag;if(a===5||a===26||a===27||a===6)return i.stateNode;throw Error(r(33))}function Ai(i){var a=i[Md];return a||(a=i[Md]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function mn(i){i[Ei]=!0}var Il=new Set,kl={};function ji(i,a){Ri(i,a),Ri(i+"Capture",a)}function Ri(i,a){for(kl[i]=a,i=0;i<a.length;i++)Il.add(a[i])}var Dl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ml={},Ol={};function Od(i){return oe.call(Ol,i)?!0:oe.call(Ml,i)?!1:Dl.test(i)?Ol[i]=!0:(Ml[i]=!0,!1)}function rc(i,a,u){if(Od(a))if(u===null)i.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":i.removeAttribute(a);return;case"boolean":var m=a.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){i.removeAttribute(a);return}}i.setAttribute(a,""+u)}}function Er(i,a,u){if(u===null)i.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(a);return}i.setAttribute(a,""+u)}}function gn(i,a,u,m){if(m===null)i.removeAttribute(u);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(u);return}i.setAttributeNS(a,u,""+m)}}function On(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Gs(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Nl(i,a,u){var m=Object.getOwnPropertyDescriptor(i.constructor.prototype,a);if(!i.hasOwnProperty(a)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var v=m.get,C=m.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return v.call(this)},set:function(z){u=""+z,C.call(this,z)}}),Object.defineProperty(i,a,{enumerable:m.enumerable}),{getValue:function(){return u},setValue:function(z){u=""+z},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function It(i){if(!i._valueTracker){var a=Gs(i)?"checked":"value";i._valueTracker=Nl(i,a,""+i[a])}}function no(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var u=a.getValue(),m="";return i&&(m=Gs(i)?i.checked?"true":"false":i.value),i=m,i!==u?(a.setValue(i),!0):!1}function Ii(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var ro=/[\n"\\]/g;function hr(i){return i.replace(ro,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function ic(i,a,u,m,v,C,z,W){i.name="",z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?i.type=z:i.removeAttribute("type"),a!=null?z==="number"?(a===0&&i.value===""||i.value!=a)&&(i.value=""+On(a)):i.value!==""+On(a)&&(i.value=""+On(a)):z!=="submit"&&z!=="reset"||i.removeAttribute("value"),a!=null?Bl(i,z,On(a)):u!=null?Bl(i,z,On(u)):m!=null&&i.removeAttribute("value"),v==null&&C!=null&&(i.defaultChecked=!!C),v!=null&&(i.checked=v&&typeof v!="function"&&typeof v!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?i.name=""+On(W):i.removeAttribute("name")}function Nd(i,a,u,m,v,C,z,W){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(i.type=C),a!=null||u!=null){if(!(C!=="submit"&&C!=="reset"||a!=null)){It(i);return}u=u!=null?""+On(u):"",a=a!=null?""+On(a):u,W||a===i.value||(i.value=a),i.defaultValue=a}m=m??v,m=typeof m!="function"&&typeof m!="symbol"&&!!m,i.checked=W?i.checked:!!m,i.defaultChecked=!!m,z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(i.name=z),It(i)}function Bl(i,a,u){a==="number"&&Ii(i.ownerDocument)===i||i.defaultValue===""+u||(i.defaultValue=""+u)}function qs(i,a,u,m){if(i=i.options,a){a={};for(var v=0;v<u.length;v++)a["$"+u[v]]=!0;for(u=0;u<i.length;u++)v=a.hasOwnProperty("$"+i[u].value),i[u].selected!==v&&(i[u].selected=v),v&&m&&(i[u].defaultSelected=!0)}else{for(u=""+On(u),a=null,v=0;v<i.length;v++){if(i[v].value===u){i[v].selected=!0,m&&(i[v].defaultSelected=!0);return}a!==null||i[v].disabled||(a=i[v])}a!==null&&(a.selected=!0)}}function Bd(i,a,u){if(a!=null&&(a=""+On(a),a!==i.value&&(i.value=a),u==null)){i.defaultValue!==a&&(i.defaultValue=a);return}i.defaultValue=u!=null?""+On(u):""}function Hs(i,a,u,m){if(a==null){if(m!=null){if(u!=null)throw Error(r(92));if(X(m)){if(1<m.length)throw Error(r(93));m=m[0]}u=m}u==null&&(u=""),a=u}u=On(a),i.defaultValue=u,m=i.textContent,m===u&&m!==""&&m!==null&&(i.value=m),It(i)}function fr(i,a){if(a){var u=i.firstChild;if(u&&u===i.lastChild&&u.nodeType===3){u.nodeValue=a;return}}i.textContent=a}var Pd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Pl(i,a,u){var m=a.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?m?i.setProperty(a,""):a==="float"?i.cssFloat="":i[a]="":m?i.setProperty(a,u):typeof u!="number"||u===0||Pd.has(a)?a==="float"?i.cssFloat=u:i[a]=(""+u).trim():i[a]=u+"px"}function zl(i,a,u){if(a!=null&&typeof a!="object")throw Error(r(62));if(i=i.style,u!=null){for(var m in u)!u.hasOwnProperty(m)||a!=null&&a.hasOwnProperty(m)||(m.indexOf("--")===0?i.setProperty(m,""):m==="float"?i.cssFloat="":i[m]="");for(var v in a)m=a[v],a.hasOwnProperty(v)&&u[v]!==m&&Pl(i,v,m)}else for(var C in a)a.hasOwnProperty(C)&&Pl(i,C,a[C])}function sc(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ws=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ac(i){return Ws.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function ii(){}var Ll=null;function Lr(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Qs=null,ki=null;function io(i){var a=zr(i);if(a&&(i=a.stateNode)){var u=i[Mn]||null;e:switch(i=a.stateNode,a.type){case"input":if(ic(i,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),a=u.name,u.type==="radio"&&a!=null){for(u=i;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+hr(""+a)+'"][type="radio"]'),a=0;a<u.length;a++){var m=u[a];if(m!==i&&m.form===i.form){var v=m[Mn]||null;if(!v)throw Error(r(90));ic(m,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(a=0;a<u.length;a++)m=u[a],m.form===i.form&&no(m)}break e;case"textarea":Bd(i,u.value,u.defaultValue);break e;case"select":a=u.value,a!=null&&qs(i,!!u.multiple,a,!1)}}}var oc=!1;function Ks(i,a,u){if(oc)return i(a,u);oc=!0;try{var m=i(a);return m}finally{if(oc=!1,(Qs!==null||ki!==null)&&(kh(),Qs&&(a=Qs,i=ki,ki=Qs=null,io(a),i)))for(a=0;a<i.length;a++)io(i[a])}}function si(i,a){var u=i.stateNode;if(u===null)return null;var m=u[Mn]||null;if(m===null)return null;u=m[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(i=i.type,m=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!m;break e;default:i=!1}if(i)return null;if(u&&typeof u!="function")throw Error(r(231,a,typeof u));return u}var Ur=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),so=!1;if(Ur)try{var Mt={};Object.defineProperty(Mt,"passive",{get:function(){so=!0}}),window.addEventListener("test",Mt,Mt),window.removeEventListener("test",Mt,Mt)}catch{so=!1}var Di=null,Ul=null,ao=null;function Fl(){if(ao)return ao;var i,a=Ul,u=a.length,m,v="value"in Di?Di.value:Di.textContent,C=v.length;for(i=0;i<u&&a[i]===v[i];i++);var z=u-i;for(m=1;m<=z&&a[u-m]===v[C-m];m++);return ao=v.slice(i,1<m?1-m:void 0)}function oo(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function ss(){return!0}function ai(){return!1}function zn(i){function a(u,m,v,C,z){this._reactName=u,this._targetInst=v,this.type=m,this.nativeEvent=C,this.target=z,this.currentTarget=null;for(var W in i)i.hasOwnProperty(W)&&(u=i[W],this[W]=u?u(C):C[W]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?ss:ai,this.isPropagationStopped=ai,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=ss)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=ss)},persist:function(){},isPersistent:ss}),a}var as={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Mi=zn(as),Ys=g({},as,{view:0,detail:0}),Vl=zn(Ys),Xs,cc,Oi,lc=g({},Ys,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zs,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Oi&&(Oi&&i.type==="mousemove"?(Xs=i.screenX-Oi.screenX,cc=i.screenY-Oi.screenY):cc=Xs=0,Oi=i),Xs)},movementY:function(i){return"movementY"in i?i.movementY:cc}}),$l=zn(lc),co=g({},lc,{dataTransfer:0}),Ld=zn(co),Ud=g({},Ys,{relatedTarget:0}),lo=zn(Ud),Gl=g({},as,{animationName:0,elapsedTime:0,pseudoElement:0}),Fd=zn(Gl),uc=g({},as,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Vd=zn(uc),$d=g({},as,{data:0}),Ni=zn($d),Gd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Hd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Wd(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=Hd[i])?!!a[i]:!1}function Zs(){return Wd}var ar=g({},Ys,{key:function(i){if(i.key){var a=Gd[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=oo(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?qd[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zs,charCode:function(i){return i.type==="keypress"?oo(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?oo(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Qd=zn(ar),Kd=g({},lc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),os=zn(Kd),b=g({},Ys,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zs}),I=zn(b),F=g({},as,{propertyName:0,elapsedTime:0,pseudoElement:0}),Y=zn(F),pe=g({},lc,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),ve=zn(pe),ze=g({},as,{newState:0,oldState:0}),at=zn(ze),on=[9,13,27,32],Tt=Ur&&"CompositionEvent"in window,Kt=null;Ur&&"documentMode"in document&&(Kt=document.documentMode);var Fr=Ur&&"TextEvent"in window&&!Kt,Bi=Ur&&(!Tt||Kt&&8<Kt&&11>=Kt),oi=" ",ci=!1;function uo(i,a){switch(i){case"keyup":return on.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dc(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var hc=!1;function LA(i,a){switch(i){case"compositionend":return dc(a);case"keypress":return a.which!==32?null:(ci=!0,oi);case"textInput":return i=a.data,i===oi&&ci?null:i;default:return null}}function UA(i,a){if(hc)return i==="compositionend"||!Tt&&uo(i,a)?(i=Fl(),ao=Ul=Di=null,hc=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Bi&&a.locale!=="ko"?null:a.data;default:return null}}var FA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function E0(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!FA[i.type]:a==="textarea"}function T0(i,a,u,m){Qs?ki?ki.push(m):ki=[m]:Qs=m,a=zh(a,"onChange"),0<a.length&&(u=new Mi("onChange","change",null,u,m),i.push({event:u,listeners:a}))}var ql=null,Hl=null;function VA(i){cx(i,0)}function Yd(i){var a=Cr(i);if(no(a))return i}function A0(i,a){if(i==="change")return a}var j0=!1;if(Ur){var Hm;if(Ur){var Wm="oninput"in document;if(!Wm){var R0=document.createElement("div");R0.setAttribute("oninput","return;"),Wm=typeof R0.oninput=="function"}Hm=Wm}else Hm=!1;j0=Hm&&(!document.documentMode||9<document.documentMode)}function I0(){ql&&(ql.detachEvent("onpropertychange",k0),Hl=ql=null)}function k0(i){if(i.propertyName==="value"&&Yd(Hl)){var a=[];T0(a,Hl,i,Lr(i)),Ks(VA,a)}}function $A(i,a,u){i==="focusin"?(I0(),ql=a,Hl=u,ql.attachEvent("onpropertychange",k0)):i==="focusout"&&I0()}function GA(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Yd(Hl)}function qA(i,a){if(i==="click")return Yd(a)}function HA(i,a){if(i==="input"||i==="change")return Yd(a)}function WA(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var Tr=typeof Object.is=="function"?Object.is:WA;function Wl(i,a){if(Tr(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var u=Object.keys(i),m=Object.keys(a);if(u.length!==m.length)return!1;for(m=0;m<u.length;m++){var v=u[m];if(!oe.call(a,v)||!Tr(i[v],a[v]))return!1}return!0}function D0(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function M0(i,a){var u=D0(i);i=0;for(var m;u;){if(u.nodeType===3){if(m=i+u.textContent.length,i<=a&&m>=a)return{node:u,offset:a-i};i=m}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=D0(u)}}function O0(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?O0(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function N0(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var a=Ii(i.document);a instanceof i.HTMLIFrameElement;){try{var u=typeof a.contentWindow.location.href=="string"}catch{u=!1}if(u)i=a.contentWindow;else break;a=Ii(i.document)}return a}function Qm(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}var QA=Ur&&"documentMode"in document&&11>=document.documentMode,fc=null,Km=null,Ql=null,Ym=!1;function B0(i,a,u){var m=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Ym||fc==null||fc!==Ii(m)||(m=fc,"selectionStart"in m&&Qm(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Ql&&Wl(Ql,m)||(Ql=m,m=zh(Km,"onSelect"),0<m.length&&(a=new Mi("onSelect","select",null,a,u),i.push({event:a,listeners:m}),a.target=fc)))}function ho(i,a){var u={};return u[i.toLowerCase()]=a.toLowerCase(),u["Webkit"+i]="webkit"+a,u["Moz"+i]="moz"+a,u}var mc={animationend:ho("Animation","AnimationEnd"),animationiteration:ho("Animation","AnimationIteration"),animationstart:ho("Animation","AnimationStart"),transitionrun:ho("Transition","TransitionRun"),transitionstart:ho("Transition","TransitionStart"),transitioncancel:ho("Transition","TransitionCancel"),transitionend:ho("Transition","TransitionEnd")},Xm={},P0={};Ur&&(P0=document.createElement("div").style,"AnimationEvent"in window||(delete mc.animationend.animation,delete mc.animationiteration.animation,delete mc.animationstart.animation),"TransitionEvent"in window||delete mc.transitionend.transition);function fo(i){if(Xm[i])return Xm[i];if(!mc[i])return i;var a=mc[i],u;for(u in a)if(a.hasOwnProperty(u)&&u in P0)return Xm[i]=a[u];return i}var z0=fo("animationend"),L0=fo("animationiteration"),U0=fo("animationstart"),KA=fo("transitionrun"),YA=fo("transitionstart"),XA=fo("transitioncancel"),F0=fo("transitionend"),V0=new Map,Zm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Zm.push("scrollEnd");function li(i,a){V0.set(i,a),ji(a,[i])}var Xd=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Vr=[],gc=0,Jm=0;function Zd(){for(var i=gc,a=Jm=gc=0;a<i;){var u=Vr[a];Vr[a++]=null;var m=Vr[a];Vr[a++]=null;var v=Vr[a];Vr[a++]=null;var C=Vr[a];if(Vr[a++]=null,m!==null&&v!==null){var z=m.pending;z===null?v.next=v:(v.next=z.next,z.next=v),m.pending=v}C!==0&&$0(u,v,C)}}function Jd(i,a,u,m){Vr[gc++]=i,Vr[gc++]=a,Vr[gc++]=u,Vr[gc++]=m,Jm|=m,i.lanes|=m,i=i.alternate,i!==null&&(i.lanes|=m)}function eg(i,a,u,m){return Jd(i,a,u,m),eh(i)}function mo(i,a){return Jd(i,null,null,a),eh(i)}function $0(i,a,u){i.lanes|=u;var m=i.alternate;m!==null&&(m.lanes|=u);for(var v=!1,C=i.return;C!==null;)C.childLanes|=u,m=C.alternate,m!==null&&(m.childLanes|=u),C.tag===22&&(i=C.stateNode,i===null||i._visibility&1||(v=!0)),i=C,C=C.return;return i.tag===3?(C=i.stateNode,v&&a!==null&&(v=31-Et(u),i=C.hiddenUpdates,m=i[v],m===null?i[v]=[a]:m.push(a),a.lane=u|536870912),C):null}function eh(i){if(50<pu)throw pu=0,lp=null,Error(r(185));for(var a=i.return;a!==null;)i=a,a=i.return;return i.tag===3?i.stateNode:null}var pc={};function ZA(i,a,u,m){this.tag=i,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ar(i,a,u,m){return new ZA(i,a,u,m)}function tg(i){return i=i.prototype,!(!i||!i.isReactComponent)}function cs(i,a){var u=i.alternate;return u===null?(u=Ar(i.tag,a,i.key,i.mode),u.elementType=i.elementType,u.type=i.type,u.stateNode=i.stateNode,u.alternate=i,i.alternate=u):(u.pendingProps=a,u.type=i.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=i.flags&65011712,u.childLanes=i.childLanes,u.lanes=i.lanes,u.child=i.child,u.memoizedProps=i.memoizedProps,u.memoizedState=i.memoizedState,u.updateQueue=i.updateQueue,a=i.dependencies,u.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},u.sibling=i.sibling,u.index=i.index,u.ref=i.ref,u.refCleanup=i.refCleanup,u}function G0(i,a){i.flags&=65011714;var u=i.alternate;return u===null?(i.childLanes=0,i.lanes=a,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=u.childLanes,i.lanes=u.lanes,i.child=u.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=u.memoizedProps,i.memoizedState=u.memoizedState,i.updateQueue=u.updateQueue,i.type=u.type,a=u.dependencies,i.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),i}function th(i,a,u,m,v,C){var z=0;if(m=i,typeof i=="function")tg(i)&&(z=1);else if(typeof i=="string")z=rR(i,u,re.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case B:return i=Ar(31,u,a,v),i.elementType=B,i.lanes=C,i;case w:return go(u.children,v,C,a);case S:z=8,v|=24;break;case E:return i=Ar(12,u,a,v|2),i.elementType=E,i.lanes=C,i;case L:return i=Ar(13,u,a,v),i.elementType=L,i.lanes=C,i;case H:return i=Ar(19,u,a,v),i.elementType=H,i.lanes=C,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case A:z=10;break e;case T:z=9;break e;case M:z=11;break e;case O:z=14;break e;case j:z=16,m=null;break e}z=29,u=Error(r(130,i===null?"null":typeof i,"")),m=null}return a=Ar(z,u,a,v),a.elementType=i,a.type=m,a.lanes=C,a}function go(i,a,u,m){return i=Ar(7,i,m,a),i.lanes=u,i}function ng(i,a,u){return i=Ar(6,i,null,a),i.lanes=u,i}function q0(i){var a=Ar(18,null,null,0);return a.stateNode=i,a}function rg(i,a,u){return a=Ar(4,i.children!==null?i.children:[],i.key,a),a.lanes=u,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}var H0=new WeakMap;function $r(i,a){if(typeof i=="object"&&i!==null){var u=H0.get(i);return u!==void 0?u:(a={value:i,source:a,stack:Z(a)},H0.set(i,a),a)}return{value:i,source:a,stack:Z(a)}}var yc=[],_c=0,nh=null,Kl=0,Gr=[],qr=0,Js=null,Pi=1,zi="";function ls(i,a){yc[_c++]=Kl,yc[_c++]=nh,nh=i,Kl=a}function W0(i,a,u){Gr[qr++]=Pi,Gr[qr++]=zi,Gr[qr++]=Js,Js=i;var m=Pi;i=zi;var v=32-Et(m)-1;m&=~(1<<v),u+=1;var C=32-Et(a)+v;if(30<C){var z=v-v%5;C=(m&(1<<z)-1).toString(32),m>>=z,v-=z,Pi=1<<32-Et(a)+v|u<<v|m,zi=C+i}else Pi=1<<C|u<<v|m,zi=i}function ig(i){i.return!==null&&(ls(i,1),W0(i,1,0))}function sg(i){for(;i===nh;)nh=yc[--_c],yc[_c]=null,Kl=yc[--_c],yc[_c]=null;for(;i===Js;)Js=Gr[--qr],Gr[qr]=null,zi=Gr[--qr],Gr[qr]=null,Pi=Gr[--qr],Gr[qr]=null}function Q0(i,a){Gr[qr++]=Pi,Gr[qr++]=zi,Gr[qr++]=Js,Pi=a.id,zi=a.overflow,Js=i}var Ln=null,Gt=null,_t=!1,ea=null,Hr=!1,ag=Error(r(519));function ta(i){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Yl($r(a,i)),ag}function K0(i){var a=i.stateNode,u=i.type,m=i.memoizedProps;switch(a[fn]=i,a[Mn]=m,u){case"dialog":dt("cancel",a),dt("close",a);break;case"iframe":case"object":case"embed":dt("load",a);break;case"video":case"audio":for(u=0;u<_u.length;u++)dt(_u[u],a);break;case"source":dt("error",a);break;case"img":case"image":case"link":dt("error",a),dt("load",a);break;case"details":dt("toggle",a);break;case"input":dt("invalid",a),Nd(a,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":dt("invalid",a);break;case"textarea":dt("invalid",a),Hs(a,m.value,m.defaultValue,m.children)}u=m.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||a.textContent===""+u||m.suppressHydrationWarning===!0||hx(a.textContent,u)?(m.popover!=null&&(dt("beforetoggle",a),dt("toggle",a)),m.onScroll!=null&&dt("scroll",a),m.onScrollEnd!=null&&dt("scrollend",a),m.onClick!=null&&(a.onclick=ii),a=!0):a=!1,a||ta(i,!0)}function Y0(i){for(Ln=i.return;Ln;)switch(Ln.tag){case 5:case 31:case 13:Hr=!1;return;case 27:case 3:Hr=!0;return;default:Ln=Ln.return}}function bc(i){if(i!==Ln)return!1;if(!_t)return Y0(i),_t=!0,!1;var a=i.tag,u;if((u=a!==3&&a!==27)&&((u=a===5)&&(u=i.type,u=!(u!=="form"&&u!=="button")||Cp(i.type,i.memoizedProps)),u=!u),u&&Gt&&ta(i),Y0(i),a===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(317));Gt=xx(i)}else if(a===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(317));Gt=xx(i)}else a===27?(a=Gt,ga(i.type)?(i=Rp,Rp=null,Gt=i):Gt=a):Gt=Ln?Qr(i.stateNode.nextSibling):null;return!0}function po(){Gt=Ln=null,_t=!1}function og(){var i=ea;return i!==null&&(yr===null?yr=i:yr.push.apply(yr,i),ea=null),i}function Yl(i){ea===null?ea=[i]:ea.push(i)}var cg=P(null),yo=null,us=null;function na(i,a,u){ee(cg,a._currentValue),a._currentValue=u}function ds(i){i._currentValue=cg.current,G(cg)}function lg(i,a,u){for(;i!==null;){var m=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,m!==null&&(m.childLanes|=a)):m!==null&&(m.childLanes&a)!==a&&(m.childLanes|=a),i===u)break;i=i.return}}function ug(i,a,u,m){var v=i.child;for(v!==null&&(v.return=i);v!==null;){var C=v.dependencies;if(C!==null){var z=v.child;C=C.firstContext;e:for(;C!==null;){var W=C;C=v;for(var ne=0;ne<a.length;ne++)if(W.context===a[ne]){C.lanes|=u,W=C.alternate,W!==null&&(W.lanes|=u),lg(C.return,u,i),m||(z=null);break e}C=W.next}}else if(v.tag===18){if(z=v.return,z===null)throw Error(r(341));z.lanes|=u,C=z.alternate,C!==null&&(C.lanes|=u),lg(z,u,i),z=null}else z=v.child;if(z!==null)z.return=v;else for(z=v;z!==null;){if(z===i){z=null;break}if(v=z.sibling,v!==null){v.return=z.return,z=v;break}z=z.return}v=z}}function vc(i,a,u,m){i=null;for(var v=a,C=!1;v!==null;){if(!C){if((v.flags&524288)!==0)C=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var z=v.alternate;if(z===null)throw Error(r(387));if(z=z.memoizedProps,z!==null){var W=v.type;Tr(v.pendingProps.value,z.value)||(i!==null?i.push(W):i=[W])}}else if(v===Ce.current){if(z=v.alternate,z===null)throw Error(r(387));z.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(i!==null?i.push(Su):i=[Su])}v=v.return}i!==null&&ug(a,i,u,m),a.flags|=262144}function rh(i){for(i=i.firstContext;i!==null;){if(!Tr(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function _o(i){yo=i,us=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Un(i){return X0(yo,i)}function ih(i,a){return yo===null&&_o(i),X0(i,a)}function X0(i,a){var u=a._currentValue;if(a={context:a,memoizedValue:u,next:null},us===null){if(i===null)throw Error(r(308));us=a,i.dependencies={lanes:0,firstContext:a},i.flags|=524288}else us=us.next=a;return u}var JA=typeof AbortController<"u"?AbortController:function(){var i=[],a=this.signal={aborted:!1,addEventListener:function(u,m){i.push(m)}};this.abort=function(){a.aborted=!0,i.forEach(function(u){return u()})}},ej=t.unstable_scheduleCallback,tj=t.unstable_NormalPriority,pn={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function dg(){return{controller:new JA,data:new Map,refCount:0}}function Xl(i){i.refCount--,i.refCount===0&&ej(tj,function(){i.controller.abort()})}var Zl=null,hg=0,xc=0,wc=null;function nj(i,a){if(Zl===null){var u=Zl=[];hg=0,xc=gp(),wc={status:"pending",value:void 0,then:function(m){u.push(m)}}}return hg++,a.then(Z0,Z0),a}function Z0(){if(--hg===0&&Zl!==null){wc!==null&&(wc.status="fulfilled");var i=Zl;Zl=null,xc=0,wc=null;for(var a=0;a<i.length;a++)(0,i[a])()}}function rj(i,a){var u=[],m={status:"pending",value:null,reason:null,then:function(v){u.push(v)}};return i.then(function(){m.status="fulfilled",m.value=a;for(var v=0;v<u.length;v++)(0,u[v])(a)},function(v){for(m.status="rejected",m.reason=v,v=0;v<u.length;v++)(0,u[v])(void 0)}),m}var J0=K.S;K.S=function(i,a){Bv=Ae(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&nj(i,a),J0!==null&&J0(i,a)};var bo=P(null);function fg(){var i=bo.current;return i!==null?i:Lt.pooledCache}function sh(i,a){a===null?ee(bo,bo.current):ee(bo,a.pool)}function eb(){var i=fg();return i===null?null:{parent:pn._currentValue,pool:i}}var Sc=Error(r(460)),mg=Error(r(474)),ah=Error(r(542)),oh={then:function(){}};function tb(i){return i=i.status,i==="fulfilled"||i==="rejected"}function nb(i,a,u){switch(u=i[u],u===void 0?i.push(a):u!==a&&(a.then(ii,ii),a=u),a.status){case"fulfilled":return a.value;case"rejected":throw i=a.reason,ib(i),i;default:if(typeof a.status=="string")a.then(ii,ii);else{if(i=Lt,i!==null&&100<i.shellSuspendCounter)throw Error(r(482));i=a,i.status="pending",i.then(function(m){if(a.status==="pending"){var v=a;v.status="fulfilled",v.value=m}},function(m){if(a.status==="pending"){var v=a;v.status="rejected",v.reason=m}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw i=a.reason,ib(i),i}throw xo=a,Sc}}function vo(i){try{var a=i._init;return a(i._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(xo=u,Sc):u}}var xo=null;function rb(){if(xo===null)throw Error(r(459));var i=xo;return xo=null,i}function ib(i){if(i===Sc||i===ah)throw Error(r(483))}var Cc=null,Jl=0;function ch(i){var a=Jl;return Jl+=1,Cc===null&&(Cc=[]),nb(Cc,i,a)}function eu(i,a){a=a.props.ref,i.ref=a!==void 0?a:null}function lh(i,a){throw a.$$typeof===_?Error(r(525)):(i=Object.prototype.toString.call(a),Error(r(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i)))}function sb(i){function a(he,ce){if(i){var ye=he.deletions;ye===null?(he.deletions=[ce],he.flags|=16):ye.push(ce)}}function u(he,ce){if(!i)return null;for(;ce!==null;)a(he,ce),ce=ce.sibling;return null}function m(he){for(var ce=new Map;he!==null;)he.key!==null?ce.set(he.key,he):ce.set(he.index,he),he=he.sibling;return ce}function v(he,ce){return he=cs(he,ce),he.index=0,he.sibling=null,he}function C(he,ce,ye){return he.index=ye,i?(ye=he.alternate,ye!==null?(ye=ye.index,ye<ce?(he.flags|=67108866,ce):ye):(he.flags|=67108866,ce)):(he.flags|=1048576,ce)}function z(he){return i&&he.alternate===null&&(he.flags|=67108866),he}function W(he,ce,ye,Re){return ce===null||ce.tag!==6?(ce=ng(ye,he.mode,Re),ce.return=he,ce):(ce=v(ce,ye),ce.return=he,ce)}function ne(he,ce,ye,Re){var He=ye.type;return He===w?je(he,ce,ye.props.children,Re,ye.key):ce!==null&&(ce.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===j&&vo(He)===ce.type)?(ce=v(ce,ye.props),eu(ce,ye),ce.return=he,ce):(ce=th(ye.type,ye.key,ye.props,null,he.mode,Re),eu(ce,ye),ce.return=he,ce)}function _e(he,ce,ye,Re){return ce===null||ce.tag!==4||ce.stateNode.containerInfo!==ye.containerInfo||ce.stateNode.implementation!==ye.implementation?(ce=rg(ye,he.mode,Re),ce.return=he,ce):(ce=v(ce,ye.children||[]),ce.return=he,ce)}function je(he,ce,ye,Re,He){return ce===null||ce.tag!==7?(ce=go(ye,he.mode,Re,He),ce.return=he,ce):(ce=v(ce,ye),ce.return=he,ce)}function De(he,ce,ye){if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return ce=ng(""+ce,he.mode,ye),ce.return=he,ce;if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case y:return ye=th(ce.type,ce.key,ce.props,null,he.mode,ye),eu(ye,ce),ye.return=he,ye;case x:return ce=rg(ce,he.mode,ye),ce.return=he,ce;case j:return ce=vo(ce),De(he,ce,ye)}if(X(ce)||k(ce))return ce=go(ce,he.mode,ye,null),ce.return=he,ce;if(typeof ce.then=="function")return De(he,ch(ce),ye);if(ce.$$typeof===A)return De(he,ih(he,ce),ye);lh(he,ce)}return null}function be(he,ce,ye,Re){var He=ce!==null?ce.key:null;if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return He!==null?null:W(he,ce,""+ye,Re);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case y:return ye.key===He?ne(he,ce,ye,Re):null;case x:return ye.key===He?_e(he,ce,ye,Re):null;case j:return ye=vo(ye),be(he,ce,ye,Re)}if(X(ye)||k(ye))return He!==null?null:je(he,ce,ye,Re,null);if(typeof ye.then=="function")return be(he,ce,ch(ye),Re);if(ye.$$typeof===A)return be(he,ce,ih(he,ye),Re);lh(he,ye)}return null}function we(he,ce,ye,Re,He){if(typeof Re=="string"&&Re!==""||typeof Re=="number"||typeof Re=="bigint")return he=he.get(ye)||null,W(ce,he,""+Re,He);if(typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case y:return he=he.get(Re.key===null?ye:Re.key)||null,ne(ce,he,Re,He);case x:return he=he.get(Re.key===null?ye:Re.key)||null,_e(ce,he,Re,He);case j:return Re=vo(Re),we(he,ce,ye,Re,He)}if(X(Re)||k(Re))return he=he.get(ye)||null,je(ce,he,Re,He,null);if(typeof Re.then=="function")return we(he,ce,ye,ch(Re),He);if(Re.$$typeof===A)return we(he,ce,ye,ih(ce,Re),He);lh(ce,Re)}return null}function Ve(he,ce,ye,Re){for(var He=null,St=null,$e=ce,ct=ce=0,mt=null;$e!==null&&ct<ye.length;ct++){$e.index>ct?(mt=$e,$e=null):mt=$e.sibling;var Ct=be(he,$e,ye[ct],Re);if(Ct===null){$e===null&&($e=mt);break}i&&$e&&Ct.alternate===null&&a(he,$e),ce=C(Ct,ce,ct),St===null?He=Ct:St.sibling=Ct,St=Ct,$e=mt}if(ct===ye.length)return u(he,$e),_t&&ls(he,ct),He;if($e===null){for(;ct<ye.length;ct++)$e=De(he,ye[ct],Re),$e!==null&&(ce=C($e,ce,ct),St===null?He=$e:St.sibling=$e,St=$e);return _t&&ls(he,ct),He}for($e=m($e);ct<ye.length;ct++)mt=we($e,he,ct,ye[ct],Re),mt!==null&&(i&&mt.alternate!==null&&$e.delete(mt.key===null?ct:mt.key),ce=C(mt,ce,ct),St===null?He=mt:St.sibling=mt,St=mt);return i&&$e.forEach(function(va){return a(he,va)}),_t&&ls(he,ct),He}function Ke(he,ce,ye,Re){if(ye==null)throw Error(r(151));for(var He=null,St=null,$e=ce,ct=ce=0,mt=null,Ct=ye.next();$e!==null&&!Ct.done;ct++,Ct=ye.next()){$e.index>ct?(mt=$e,$e=null):mt=$e.sibling;var va=be(he,$e,Ct.value,Re);if(va===null){$e===null&&($e=mt);break}i&&$e&&va.alternate===null&&a(he,$e),ce=C(va,ce,ct),St===null?He=va:St.sibling=va,St=va,$e=mt}if(Ct.done)return u(he,$e),_t&&ls(he,ct),He;if($e===null){for(;!Ct.done;ct++,Ct=ye.next())Ct=De(he,Ct.value,Re),Ct!==null&&(ce=C(Ct,ce,ct),St===null?He=Ct:St.sibling=Ct,St=Ct);return _t&&ls(he,ct),He}for($e=m($e);!Ct.done;ct++,Ct=ye.next())Ct=we($e,he,ct,Ct.value,Re),Ct!==null&&(i&&Ct.alternate!==null&&$e.delete(Ct.key===null?ct:Ct.key),ce=C(Ct,ce,ct),St===null?He=Ct:St.sibling=Ct,St=Ct);return i&&$e.forEach(function(mR){return a(he,mR)}),_t&&ls(he,ct),He}function Bt(he,ce,ye,Re){if(typeof ye=="object"&&ye!==null&&ye.type===w&&ye.key===null&&(ye=ye.props.children),typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case y:e:{for(var He=ye.key;ce!==null;){if(ce.key===He){if(He=ye.type,He===w){if(ce.tag===7){u(he,ce.sibling),Re=v(ce,ye.props.children),Re.return=he,he=Re;break e}}else if(ce.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===j&&vo(He)===ce.type){u(he,ce.sibling),Re=v(ce,ye.props),eu(Re,ye),Re.return=he,he=Re;break e}u(he,ce);break}else a(he,ce);ce=ce.sibling}ye.type===w?(Re=go(ye.props.children,he.mode,Re,ye.key),Re.return=he,he=Re):(Re=th(ye.type,ye.key,ye.props,null,he.mode,Re),eu(Re,ye),Re.return=he,he=Re)}return z(he);case x:e:{for(He=ye.key;ce!==null;){if(ce.key===He)if(ce.tag===4&&ce.stateNode.containerInfo===ye.containerInfo&&ce.stateNode.implementation===ye.implementation){u(he,ce.sibling),Re=v(ce,ye.children||[]),Re.return=he,he=Re;break e}else{u(he,ce);break}else a(he,ce);ce=ce.sibling}Re=rg(ye,he.mode,Re),Re.return=he,he=Re}return z(he);case j:return ye=vo(ye),Bt(he,ce,ye,Re)}if(X(ye))return Ve(he,ce,ye,Re);if(k(ye)){if(He=k(ye),typeof He!="function")throw Error(r(150));return ye=He.call(ye),Ke(he,ce,ye,Re)}if(typeof ye.then=="function")return Bt(he,ce,ch(ye),Re);if(ye.$$typeof===A)return Bt(he,ce,ih(he,ye),Re);lh(he,ye)}return typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint"?(ye=""+ye,ce!==null&&ce.tag===6?(u(he,ce.sibling),Re=v(ce,ye),Re.return=he,he=Re):(u(he,ce),Re=ng(ye,he.mode,Re),Re.return=he,he=Re),z(he)):u(he,ce)}return function(he,ce,ye,Re){try{Jl=0;var He=Bt(he,ce,ye,Re);return Cc=null,He}catch($e){if($e===Sc||$e===ah)throw $e;var St=Ar(29,$e,null,he.mode);return St.lanes=Re,St.return=he,St}}}var wo=sb(!0),ab=sb(!1),ra=!1;function gg(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function pg(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function ia(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function sa(i,a,u){var m=i.updateQueue;if(m===null)return null;if(m=m.shared,(At&2)!==0){var v=m.pending;return v===null?a.next=a:(a.next=v.next,v.next=a),m.pending=a,a=eh(i),$0(i,null,u),a}return Jd(i,m,a,u),eh(i)}function tu(i,a,u){if(a=a.updateQueue,a!==null&&(a=a.shared,(u&4194048)!==0)){var m=a.lanes;m&=i.pendingLanes,u|=m,a.lanes=u,jl(i,u)}}function yg(i,a){var u=i.updateQueue,m=i.alternate;if(m!==null&&(m=m.updateQueue,u===m)){var v=null,C=null;if(u=u.firstBaseUpdate,u!==null){do{var z={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};C===null?v=C=z:C=C.next=z,u=u.next}while(u!==null);C===null?v=C=a:C=C.next=a}else v=C=a;u={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:C,shared:m.shared,callbacks:m.callbacks},i.updateQueue=u;return}i=u.lastBaseUpdate,i===null?u.firstBaseUpdate=a:i.next=a,u.lastBaseUpdate=a}var _g=!1;function nu(){if(_g){var i=wc;if(i!==null)throw i}}function ru(i,a,u,m){_g=!1;var v=i.updateQueue;ra=!1;var C=v.firstBaseUpdate,z=v.lastBaseUpdate,W=v.shared.pending;if(W!==null){v.shared.pending=null;var ne=W,_e=ne.next;ne.next=null,z===null?C=_e:z.next=_e,z=ne;var je=i.alternate;je!==null&&(je=je.updateQueue,W=je.lastBaseUpdate,W!==z&&(W===null?je.firstBaseUpdate=_e:W.next=_e,je.lastBaseUpdate=ne))}if(C!==null){var De=v.baseState;z=0,je=_e=ne=null,W=C;do{var be=W.lane&-536870913,we=be!==W.lane;if(we?(ft&be)===be:(m&be)===be){be!==0&&be===xc&&(_g=!0),je!==null&&(je=je.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var Ve=i,Ke=W;be=a;var Bt=u;switch(Ke.tag){case 1:if(Ve=Ke.payload,typeof Ve=="function"){De=Ve.call(Bt,De,be);break e}De=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=Ke.payload,be=typeof Ve=="function"?Ve.call(Bt,De,be):Ve,be==null)break e;De=g({},De,be);break e;case 2:ra=!0}}be=W.callback,be!==null&&(i.flags|=64,we&&(i.flags|=8192),we=v.callbacks,we===null?v.callbacks=[be]:we.push(be))}else we={lane:be,tag:W.tag,payload:W.payload,callback:W.callback,next:null},je===null?(_e=je=we,ne=De):je=je.next=we,z|=be;if(W=W.next,W===null){if(W=v.shared.pending,W===null)break;we=W,W=we.next,we.next=null,v.lastBaseUpdate=we,v.shared.pending=null}}while(!0);je===null&&(ne=De),v.baseState=ne,v.firstBaseUpdate=_e,v.lastBaseUpdate=je,C===null&&(v.shared.lanes=0),ua|=z,i.lanes=z,i.memoizedState=De}}function ob(i,a){if(typeof i!="function")throw Error(r(191,i));i.call(a)}function cb(i,a){var u=i.callbacks;if(u!==null)for(i.callbacks=null,i=0;i<u.length;i++)ob(u[i],a)}var Ec=P(null),uh=P(0);function lb(i,a){i=vs,ee(uh,i),ee(Ec,a),vs=i|a.baseLanes}function bg(){ee(uh,vs),ee(Ec,Ec.current)}function vg(){vs=uh.current,G(Ec),G(uh)}var jr=P(null),Wr=null;function aa(i){var a=i.alternate;ee(cn,cn.current&1),ee(jr,i),Wr===null&&(a===null||Ec.current!==null||a.memoizedState!==null)&&(Wr=i)}function xg(i){ee(cn,cn.current),ee(jr,i),Wr===null&&(Wr=i)}function ub(i){i.tag===22?(ee(cn,cn.current),ee(jr,i),Wr===null&&(Wr=i)):oa()}function oa(){ee(cn,cn.current),ee(jr,jr.current)}function Rr(i){G(jr),Wr===i&&(Wr=null),G(cn)}var cn=P(0);function dh(i){for(var a=i;a!==null;){if(a.tag===13){var u=a.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||Ap(u)||jp(u)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var hs=0,ot=null,Ot=null,yn=null,hh=!1,Tc=!1,So=!1,fh=0,iu=0,Ac=null,ij=0;function rn(){throw Error(r(321))}function wg(i,a){if(a===null)return!1;for(var u=0;u<a.length&&u<i.length;u++)if(!Tr(i[u],a[u]))return!1;return!0}function Sg(i,a,u,m,v,C){return hs=C,ot=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,K.H=i===null||i.memoizedState===null?Wb:zg,So=!1,C=u(m,v),So=!1,Tc&&(C=hb(a,u,m,v)),db(i),C}function db(i){K.H=ou;var a=Ot!==null&&Ot.next!==null;if(hs=0,yn=Ot=ot=null,hh=!1,iu=0,Ac=null,a)throw Error(r(300));i===null||_n||(i=i.dependencies,i!==null&&rh(i)&&(_n=!0))}function hb(i,a,u,m){ot=i;var v=0;do{if(Tc&&(Ac=null),iu=0,Tc=!1,25<=v)throw Error(r(301));if(v+=1,yn=Ot=null,i.updateQueue!=null){var C=i.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}K.H=Qb,C=a(u,m)}while(Tc);return C}function sj(){var i=K.H,a=i.useState()[0];return a=typeof a.then=="function"?su(a):a,i=i.useState()[0],(Ot!==null?Ot.memoizedState:null)!==i&&(ot.flags|=1024),a}function Cg(){var i=fh!==0;return fh=0,i}function Eg(i,a,u){a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~u}function Tg(i){if(hh){for(i=i.memoizedState;i!==null;){var a=i.queue;a!==null&&(a.pending=null),i=i.next}hh=!1}hs=0,yn=Ot=ot=null,Tc=!1,iu=fh=0,Ac=null}function or(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yn===null?ot.memoizedState=yn=i:yn=yn.next=i,yn}function ln(){if(Ot===null){var i=ot.alternate;i=i!==null?i.memoizedState:null}else i=Ot.next;var a=yn===null?ot.memoizedState:yn.next;if(a!==null)yn=a,Ot=i;else{if(i===null)throw ot.alternate===null?Error(r(467)):Error(r(310));Ot=i,i={memoizedState:Ot.memoizedState,baseState:Ot.baseState,baseQueue:Ot.baseQueue,queue:Ot.queue,next:null},yn===null?ot.memoizedState=yn=i:yn=yn.next=i}return yn}function mh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function su(i){var a=iu;return iu+=1,Ac===null&&(Ac=[]),i=nb(Ac,i,a),a=ot,(yn===null?a.memoizedState:yn.next)===null&&(a=a.alternate,K.H=a===null||a.memoizedState===null?Wb:zg),i}function gh(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return su(i);if(i.$$typeof===A)return Un(i)}throw Error(r(438,String(i)))}function Ag(i){var a=null,u=ot.updateQueue;if(u!==null&&(a=u.memoCache),a==null){var m=ot.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(a={data:m.data.map(function(v){return v.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),u===null&&(u=mh(),ot.updateQueue=u),u.memoCache=a,u=a.data[a.index],u===void 0)for(u=a.data[a.index]=Array(i),m=0;m<i;m++)u[m]=V;return a.index++,u}function fs(i,a){return typeof a=="function"?a(i):a}function ph(i){var a=ln();return jg(a,Ot,i)}function jg(i,a,u){var m=i.queue;if(m===null)throw Error(r(311));m.lastRenderedReducer=u;var v=i.baseQueue,C=m.pending;if(C!==null){if(v!==null){var z=v.next;v.next=C.next,C.next=z}a.baseQueue=v=C,m.pending=null}if(C=i.baseState,v===null)i.memoizedState=C;else{a=v.next;var W=z=null,ne=null,_e=a,je=!1;do{var De=_e.lane&-536870913;if(De!==_e.lane?(ft&De)===De:(hs&De)===De){var be=_e.revertLane;if(be===0)ne!==null&&(ne=ne.next={lane:0,revertLane:0,gesture:null,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null}),De===xc&&(je=!0);else if((hs&be)===be){_e=_e.next,be===xc&&(je=!0);continue}else De={lane:0,revertLane:_e.revertLane,gesture:null,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null},ne===null?(W=ne=De,z=C):ne=ne.next=De,ot.lanes|=be,ua|=be;De=_e.action,So&&u(C,De),C=_e.hasEagerState?_e.eagerState:u(C,De)}else be={lane:De,revertLane:_e.revertLane,gesture:_e.gesture,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null},ne===null?(W=ne=be,z=C):ne=ne.next=be,ot.lanes|=De,ua|=De;_e=_e.next}while(_e!==null&&_e!==a);if(ne===null?z=C:ne.next=W,!Tr(C,i.memoizedState)&&(_n=!0,je&&(u=wc,u!==null)))throw u;i.memoizedState=C,i.baseState=z,i.baseQueue=ne,m.lastRenderedState=C}return v===null&&(m.lanes=0),[i.memoizedState,m.dispatch]}function Rg(i){var a=ln(),u=a.queue;if(u===null)throw Error(r(311));u.lastRenderedReducer=i;var m=u.dispatch,v=u.pending,C=a.memoizedState;if(v!==null){u.pending=null;var z=v=v.next;do C=i(C,z.action),z=z.next;while(z!==v);Tr(C,a.memoizedState)||(_n=!0),a.memoizedState=C,a.baseQueue===null&&(a.baseState=C),u.lastRenderedState=C}return[C,m]}function fb(i,a,u){var m=ot,v=ln(),C=_t;if(C){if(u===void 0)throw Error(r(407));u=u()}else u=a();var z=!Tr((Ot||v).memoizedState,u);if(z&&(v.memoizedState=u,_n=!0),v=v.queue,Dg(pb.bind(null,m,v,i),[i]),v.getSnapshot!==a||z||yn!==null&&yn.memoizedState.tag&1){if(m.flags|=2048,jc(9,{destroy:void 0},gb.bind(null,m,v,u,a),null),Lt===null)throw Error(r(349));C||(hs&127)!==0||mb(m,a,u)}return u}function mb(i,a,u){i.flags|=16384,i={getSnapshot:a,value:u},a=ot.updateQueue,a===null?(a=mh(),ot.updateQueue=a,a.stores=[i]):(u=a.stores,u===null?a.stores=[i]:u.push(i))}function gb(i,a,u,m){a.value=u,a.getSnapshot=m,yb(a)&&_b(i)}function pb(i,a,u){return u(function(){yb(a)&&_b(i)})}function yb(i){var a=i.getSnapshot;i=i.value;try{var u=a();return!Tr(i,u)}catch{return!0}}function _b(i){var a=mo(i,2);a!==null&&_r(a,i,2)}function Ig(i){var a=or();if(typeof i=="function"){var u=i;if(i=u(),So){Kn(!0);try{u()}finally{Kn(!1)}}}return a.memoizedState=a.baseState=i,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fs,lastRenderedState:i},a}function bb(i,a,u,m){return i.baseState=u,jg(i,Ot,typeof m=="function"?m:fs)}function aj(i,a,u,m,v){if(bh(i))throw Error(r(485));if(i=a.action,i!==null){var C={payload:v,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(z){C.listeners.push(z)}};K.T!==null?u(!0):C.isTransition=!1,m(C),u=a.pending,u===null?(C.next=a.pending=C,vb(a,C)):(C.next=u.next,a.pending=u.next=C)}}function vb(i,a){var u=a.action,m=a.payload,v=i.state;if(a.isTransition){var C=K.T,z={};K.T=z;try{var W=u(v,m),ne=K.S;ne!==null&&ne(z,W),xb(i,a,W)}catch(_e){kg(i,a,_e)}finally{C!==null&&z.types!==null&&(C.types=z.types),K.T=C}}else try{C=u(v,m),xb(i,a,C)}catch(_e){kg(i,a,_e)}}function xb(i,a,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(m){wb(i,a,m)},function(m){return kg(i,a,m)}):wb(i,a,u)}function wb(i,a,u){a.status="fulfilled",a.value=u,Sb(a),i.state=u,a=i.pending,a!==null&&(u=a.next,u===a?i.pending=null:(u=u.next,a.next=u,vb(i,u)))}function kg(i,a,u){var m=i.pending;if(i.pending=null,m!==null){m=m.next;do a.status="rejected",a.reason=u,Sb(a),a=a.next;while(a!==m)}i.action=null}function Sb(i){i=i.listeners;for(var a=0;a<i.length;a++)(0,i[a])()}function Cb(i,a){return a}function Eb(i,a){if(_t){var u=Lt.formState;if(u!==null){e:{var m=ot;if(_t){if(Gt){t:{for(var v=Gt,C=Hr;v.nodeType!==8;){if(!C){v=null;break t}if(v=Qr(v.nextSibling),v===null){v=null;break t}}C=v.data,v=C==="F!"||C==="F"?v:null}if(v){Gt=Qr(v.nextSibling),m=v.data==="F!";break e}}ta(m)}m=!1}m&&(a=u[0])}}return u=or(),u.memoizedState=u.baseState=a,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Cb,lastRenderedState:a},u.queue=m,u=Gb.bind(null,ot,m),m.dispatch=u,m=Ig(!1),C=Pg.bind(null,ot,!1,m.queue),m=or(),v={state:a,dispatch:null,action:i,pending:null},m.queue=v,u=aj.bind(null,ot,v,C,u),v.dispatch=u,m.memoizedState=i,[a,u,!1]}function Tb(i){var a=ln();return Ab(a,Ot,i)}function Ab(i,a,u){if(a=jg(i,a,Cb)[0],i=ph(fs)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var m=su(a)}catch(z){throw z===Sc?ah:z}else m=a;a=ln();var v=a.queue,C=v.dispatch;return u!==a.memoizedState&&(ot.flags|=2048,jc(9,{destroy:void 0},oj.bind(null,v,u),null)),[m,C,i]}function oj(i,a){i.action=a}function jb(i){var a=ln(),u=Ot;if(u!==null)return Ab(a,u,i);ln(),a=a.memoizedState,u=ln();var m=u.queue.dispatch;return u.memoizedState=i,[a,m,!1]}function jc(i,a,u,m){return i={tag:i,create:u,deps:m,inst:a,next:null},a=ot.updateQueue,a===null&&(a=mh(),ot.updateQueue=a),u=a.lastEffect,u===null?a.lastEffect=i.next=i:(m=u.next,u.next=i,i.next=m,a.lastEffect=i),i}function Rb(){return ln().memoizedState}function yh(i,a,u,m){var v=or();ot.flags|=i,v.memoizedState=jc(1|a,{destroy:void 0},u,m===void 0?null:m)}function _h(i,a,u,m){var v=ln();m=m===void 0?null:m;var C=v.memoizedState.inst;Ot!==null&&m!==null&&wg(m,Ot.memoizedState.deps)?v.memoizedState=jc(a,C,u,m):(ot.flags|=i,v.memoizedState=jc(1|a,C,u,m))}function Ib(i,a){yh(8390656,8,i,a)}function Dg(i,a){_h(2048,8,i,a)}function cj(i){ot.flags|=4;var a=ot.updateQueue;if(a===null)a=mh(),ot.updateQueue=a,a.events=[i];else{var u=a.events;u===null?a.events=[i]:u.push(i)}}function kb(i){var a=ln().memoizedState;return cj({ref:a,nextImpl:i}),function(){if((At&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function Db(i,a){return _h(4,2,i,a)}function Mb(i,a){return _h(4,4,i,a)}function Ob(i,a){if(typeof a=="function"){i=i();var u=a(i);return function(){typeof u=="function"?u():a(null)}}if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function Nb(i,a,u){u=u!=null?u.concat([i]):null,_h(4,4,Ob.bind(null,a,i),u)}function Mg(){}function Bb(i,a){var u=ln();a=a===void 0?null:a;var m=u.memoizedState;return a!==null&&wg(a,m[1])?m[0]:(u.memoizedState=[i,a],i)}function Pb(i,a){var u=ln();a=a===void 0?null:a;var m=u.memoizedState;if(a!==null&&wg(a,m[1]))return m[0];if(m=i(),So){Kn(!0);try{i()}finally{Kn(!1)}}return u.memoizedState=[m,a],m}function Og(i,a,u){return u===void 0||(hs&1073741824)!==0&&(ft&261930)===0?i.memoizedState=a:(i.memoizedState=u,i=zv(),ot.lanes|=i,ua|=i,u)}function zb(i,a,u,m){return Tr(u,a)?u:Ec.current!==null?(i=Og(i,u,m),Tr(i,a)||(_n=!0),i):(hs&42)===0||(hs&1073741824)!==0&&(ft&261930)===0?(_n=!0,i.memoizedState=u):(i=zv(),ot.lanes|=i,ua|=i,a)}function Lb(i,a,u,m,v){var C=q.p;q.p=C!==0&&8>C?C:8;var z=K.T,W={};K.T=W,Pg(i,!1,a,u);try{var ne=v(),_e=K.S;if(_e!==null&&_e(W,ne),ne!==null&&typeof ne=="object"&&typeof ne.then=="function"){var je=rj(ne,m);au(i,a,je,Dr(i))}else au(i,a,m,Dr(i))}catch(De){au(i,a,{then:function(){},status:"rejected",reason:De},Dr())}finally{q.p=C,z!==null&&W.types!==null&&(z.types=W.types),K.T=z}}function lj(){}function Ng(i,a,u,m){if(i.tag!==5)throw Error(r(476));var v=Ub(i).queue;Lb(i,v,a,te,u===null?lj:function(){return Fb(i),u(m)})}function Ub(i){var a=i.memoizedState;if(a!==null)return a;a={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fs,lastRenderedState:te},next:null};var u={};return a.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fs,lastRenderedState:u},next:null},i.memoizedState=a,i=i.alternate,i!==null&&(i.memoizedState=a),a}function Fb(i){var a=Ub(i);a.next===null&&(a=i.alternate.memoizedState),au(i,a.next.queue,{},Dr())}function Bg(){return Un(Su)}function Vb(){return ln().memoizedState}function $b(){return ln().memoizedState}function uj(i){for(var a=i.return;a!==null;){switch(a.tag){case 24:case 3:var u=Dr();i=ia(u);var m=sa(a,i,u);m!==null&&(_r(m,a,u),tu(m,a,u)),a={cache:dg()},i.payload=a;return}a=a.return}}function dj(i,a,u){var m=Dr();u={lane:m,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},bh(i)?qb(a,u):(u=eg(i,a,u,m),u!==null&&(_r(u,i,m),Hb(u,a,m)))}function Gb(i,a,u){var m=Dr();au(i,a,u,m)}function au(i,a,u,m){var v={lane:m,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(bh(i))qb(a,v);else{var C=i.alternate;if(i.lanes===0&&(C===null||C.lanes===0)&&(C=a.lastRenderedReducer,C!==null))try{var z=a.lastRenderedState,W=C(z,u);if(v.hasEagerState=!0,v.eagerState=W,Tr(W,z))return Jd(i,a,v,0),Lt===null&&Zd(),!1}catch{}if(u=eg(i,a,v,m),u!==null)return _r(u,i,m),Hb(u,a,m),!0}return!1}function Pg(i,a,u,m){if(m={lane:2,revertLane:gp(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},bh(i)){if(a)throw Error(r(479))}else a=eg(i,u,m,2),a!==null&&_r(a,i,2)}function bh(i){var a=i.alternate;return i===ot||a!==null&&a===ot}function qb(i,a){Tc=hh=!0;var u=i.pending;u===null?a.next=a:(a.next=u.next,u.next=a),i.pending=a}function Hb(i,a,u){if((u&4194048)!==0){var m=a.lanes;m&=i.pendingLanes,u|=m,a.lanes=u,jl(i,u)}}var ou={readContext:Un,use:gh,useCallback:rn,useContext:rn,useEffect:rn,useImperativeHandle:rn,useLayoutEffect:rn,useInsertionEffect:rn,useMemo:rn,useReducer:rn,useRef:rn,useState:rn,useDebugValue:rn,useDeferredValue:rn,useTransition:rn,useSyncExternalStore:rn,useId:rn,useHostTransitionStatus:rn,useFormState:rn,useActionState:rn,useOptimistic:rn,useMemoCache:rn,useCacheRefresh:rn};ou.useEffectEvent=rn;var Wb={readContext:Un,use:gh,useCallback:function(i,a){return or().memoizedState=[i,a===void 0?null:a],i},useContext:Un,useEffect:Ib,useImperativeHandle:function(i,a,u){u=u!=null?u.concat([i]):null,yh(4194308,4,Ob.bind(null,a,i),u)},useLayoutEffect:function(i,a){return yh(4194308,4,i,a)},useInsertionEffect:function(i,a){yh(4,2,i,a)},useMemo:function(i,a){var u=or();a=a===void 0?null:a;var m=i();if(So){Kn(!0);try{i()}finally{Kn(!1)}}return u.memoizedState=[m,a],m},useReducer:function(i,a,u){var m=or();if(u!==void 0){var v=u(a);if(So){Kn(!0);try{u(a)}finally{Kn(!1)}}}else v=a;return m.memoizedState=m.baseState=v,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:v},m.queue=i,i=i.dispatch=dj.bind(null,ot,i),[m.memoizedState,i]},useRef:function(i){var a=or();return i={current:i},a.memoizedState=i},useState:function(i){i=Ig(i);var a=i.queue,u=Gb.bind(null,ot,a);return a.dispatch=u,[i.memoizedState,u]},useDebugValue:Mg,useDeferredValue:function(i,a){var u=or();return Og(u,i,a)},useTransition:function(){var i=Ig(!1);return i=Lb.bind(null,ot,i.queue,!0,!1),or().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,a,u){var m=ot,v=or();if(_t){if(u===void 0)throw Error(r(407));u=u()}else{if(u=a(),Lt===null)throw Error(r(349));(ft&127)!==0||mb(m,a,u)}v.memoizedState=u;var C={value:u,getSnapshot:a};return v.queue=C,Ib(pb.bind(null,m,C,i),[i]),m.flags|=2048,jc(9,{destroy:void 0},gb.bind(null,m,C,u,a),null),u},useId:function(){var i=or(),a=Lt.identifierPrefix;if(_t){var u=zi,m=Pi;u=(m&~(1<<32-Et(m)-1)).toString(32)+u,a="_"+a+"R_"+u,u=fh++,0<u&&(a+="H"+u.toString(32)),a+="_"}else u=ij++,a="_"+a+"r_"+u.toString(32)+"_";return i.memoizedState=a},useHostTransitionStatus:Bg,useFormState:Eb,useActionState:Eb,useOptimistic:function(i){var a=or();a.memoizedState=a.baseState=i;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=u,a=Pg.bind(null,ot,!0,u),u.dispatch=a,[i,a]},useMemoCache:Ag,useCacheRefresh:function(){return or().memoizedState=uj.bind(null,ot)},useEffectEvent:function(i){var a=or(),u={impl:i};return a.memoizedState=u,function(){if((At&2)!==0)throw Error(r(440));return u.impl.apply(void 0,arguments)}}},zg={readContext:Un,use:gh,useCallback:Bb,useContext:Un,useEffect:Dg,useImperativeHandle:Nb,useInsertionEffect:Db,useLayoutEffect:Mb,useMemo:Pb,useReducer:ph,useRef:Rb,useState:function(){return ph(fs)},useDebugValue:Mg,useDeferredValue:function(i,a){var u=ln();return zb(u,Ot.memoizedState,i,a)},useTransition:function(){var i=ph(fs)[0],a=ln().memoizedState;return[typeof i=="boolean"?i:su(i),a]},useSyncExternalStore:fb,useId:Vb,useHostTransitionStatus:Bg,useFormState:Tb,useActionState:Tb,useOptimistic:function(i,a){var u=ln();return bb(u,Ot,i,a)},useMemoCache:Ag,useCacheRefresh:$b};zg.useEffectEvent=kb;var Qb={readContext:Un,use:gh,useCallback:Bb,useContext:Un,useEffect:Dg,useImperativeHandle:Nb,useInsertionEffect:Db,useLayoutEffect:Mb,useMemo:Pb,useReducer:Rg,useRef:Rb,useState:function(){return Rg(fs)},useDebugValue:Mg,useDeferredValue:function(i,a){var u=ln();return Ot===null?Og(u,i,a):zb(u,Ot.memoizedState,i,a)},useTransition:function(){var i=Rg(fs)[0],a=ln().memoizedState;return[typeof i=="boolean"?i:su(i),a]},useSyncExternalStore:fb,useId:Vb,useHostTransitionStatus:Bg,useFormState:jb,useActionState:jb,useOptimistic:function(i,a){var u=ln();return Ot!==null?bb(u,Ot,i,a):(u.baseState=i,[i,u.queue.dispatch])},useMemoCache:Ag,useCacheRefresh:$b};Qb.useEffectEvent=kb;function Lg(i,a,u,m){a=i.memoizedState,u=u(m,a),u=u==null?a:g({},a,u),i.memoizedState=u,i.lanes===0&&(i.updateQueue.baseState=u)}var Ug={enqueueSetState:function(i,a,u){i=i._reactInternals;var m=Dr(),v=ia(m);v.payload=a,u!=null&&(v.callback=u),a=sa(i,v,m),a!==null&&(_r(a,i,m),tu(a,i,m))},enqueueReplaceState:function(i,a,u){i=i._reactInternals;var m=Dr(),v=ia(m);v.tag=1,v.payload=a,u!=null&&(v.callback=u),a=sa(i,v,m),a!==null&&(_r(a,i,m),tu(a,i,m))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var u=Dr(),m=ia(u);m.tag=2,a!=null&&(m.callback=a),a=sa(i,m,u),a!==null&&(_r(a,i,u),tu(a,i,u))}};function Kb(i,a,u,m,v,C,z){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(m,C,z):a.prototype&&a.prototype.isPureReactComponent?!Wl(u,m)||!Wl(v,C):!0}function Yb(i,a,u,m){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(u,m),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(u,m),a.state!==i&&Ug.enqueueReplaceState(a,a.state,null)}function Co(i,a){var u=a;if("ref"in a){u={};for(var m in a)m!=="ref"&&(u[m]=a[m])}if(i=i.defaultProps){u===a&&(u=g({},u));for(var v in i)u[v]===void 0&&(u[v]=i[v])}return u}function Xb(i){Xd(i)}function Zb(i){console.error(i)}function Jb(i){Xd(i)}function vh(i,a){try{var u=i.onUncaughtError;u(a.value,{componentStack:a.stack})}catch(m){setTimeout(function(){throw m})}}function ev(i,a,u){try{var m=i.onCaughtError;m(u.value,{componentStack:u.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function Fg(i,a,u){return u=ia(u),u.tag=3,u.payload={element:null},u.callback=function(){vh(i,a)},u}function tv(i){return i=ia(i),i.tag=3,i}function nv(i,a,u,m){var v=u.type.getDerivedStateFromError;if(typeof v=="function"){var C=m.value;i.payload=function(){return v(C)},i.callback=function(){ev(a,u,m)}}var z=u.stateNode;z!==null&&typeof z.componentDidCatch=="function"&&(i.callback=function(){ev(a,u,m),typeof v!="function"&&(da===null?da=new Set([this]):da.add(this));var W=m.stack;this.componentDidCatch(m.value,{componentStack:W!==null?W:""})})}function hj(i,a,u,m,v){if(u.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(a=u.alternate,a!==null&&vc(a,u,v,!0),u=jr.current,u!==null){switch(u.tag){case 31:case 13:return Wr===null?Dh():u.alternate===null&&sn===0&&(sn=3),u.flags&=-257,u.flags|=65536,u.lanes=v,m===oh?u.flags|=16384:(a=u.updateQueue,a===null?u.updateQueue=new Set([m]):a.add(m),hp(i,m,v)),!1;case 22:return u.flags|=65536,m===oh?u.flags|=16384:(a=u.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([m])},u.updateQueue=a):(u=a.retryQueue,u===null?a.retryQueue=new Set([m]):u.add(m)),hp(i,m,v)),!1}throw Error(r(435,u.tag))}return hp(i,m,v),Dh(),!1}if(_t)return a=jr.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=v,m!==ag&&(i=Error(r(422),{cause:m}),Yl($r(i,u)))):(m!==ag&&(a=Error(r(423),{cause:m}),Yl($r(a,u))),i=i.current.alternate,i.flags|=65536,v&=-v,i.lanes|=v,m=$r(m,u),v=Fg(i.stateNode,m,v),yg(i,v),sn!==4&&(sn=2)),!1;var C=Error(r(520),{cause:m});if(C=$r(C,u),gu===null?gu=[C]:gu.push(C),sn!==4&&(sn=2),a===null)return!0;m=$r(m,u),u=a;do{switch(u.tag){case 3:return u.flags|=65536,i=v&-v,u.lanes|=i,i=Fg(u.stateNode,m,i),yg(u,i),!1;case 1:if(a=u.type,C=u.stateNode,(u.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(da===null||!da.has(C))))return u.flags|=65536,v&=-v,u.lanes|=v,v=tv(v),nv(v,i,u,m),yg(u,v),!1}u=u.return}while(u!==null);return!1}var Vg=Error(r(461)),_n=!1;function Fn(i,a,u,m){a.child=i===null?ab(a,null,u,m):wo(a,i.child,u,m)}function rv(i,a,u,m,v){u=u.render;var C=a.ref;if("ref"in m){var z={};for(var W in m)W!=="ref"&&(z[W]=m[W])}else z=m;return _o(a),m=Sg(i,a,u,z,C,v),W=Cg(),i!==null&&!_n?(Eg(i,a,v),ms(i,a,v)):(_t&&W&&ig(a),a.flags|=1,Fn(i,a,m,v),a.child)}function iv(i,a,u,m,v){if(i===null){var C=u.type;return typeof C=="function"&&!tg(C)&&C.defaultProps===void 0&&u.compare===null?(a.tag=15,a.type=C,sv(i,a,C,m,v)):(i=th(u.type,null,m,a,a.mode,v),i.ref=a.ref,i.return=a,a.child=i)}if(C=i.child,!Yg(i,v)){var z=C.memoizedProps;if(u=u.compare,u=u!==null?u:Wl,u(z,m)&&i.ref===a.ref)return ms(i,a,v)}return a.flags|=1,i=cs(C,m),i.ref=a.ref,i.return=a,a.child=i}function sv(i,a,u,m,v){if(i!==null){var C=i.memoizedProps;if(Wl(C,m)&&i.ref===a.ref)if(_n=!1,a.pendingProps=m=C,Yg(i,v))(i.flags&131072)!==0&&(_n=!0);else return a.lanes=i.lanes,ms(i,a,v)}return $g(i,a,u,m,v)}function av(i,a,u,m){var v=m.children,C=i!==null?i.memoizedState:null;if(i===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((a.flags&128)!==0){if(C=C!==null?C.baseLanes|u:u,i!==null){for(m=a.child=i.child,v=0;m!==null;)v=v|m.lanes|m.childLanes,m=m.sibling;m=v&~C}else m=0,a.child=null;return ov(i,a,C,u,m)}if((u&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},i!==null&&sh(a,C!==null?C.cachePool:null),C!==null?lb(a,C):bg(),ub(a);else return m=a.lanes=536870912,ov(i,a,C!==null?C.baseLanes|u:u,u,m)}else C!==null?(sh(a,C.cachePool),lb(a,C),oa(),a.memoizedState=null):(i!==null&&sh(a,null),bg(),oa());return Fn(i,a,v,u),a.child}function cu(i,a){return i!==null&&i.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function ov(i,a,u,m,v){var C=fg();return C=C===null?null:{parent:pn._currentValue,pool:C},a.memoizedState={baseLanes:u,cachePool:C},i!==null&&sh(a,null),bg(),ub(a),i!==null&&vc(i,a,m,!0),a.childLanes=v,null}function xh(i,a){return a=Sh({mode:a.mode,children:a.children},i.mode),a.ref=i.ref,i.child=a,a.return=i,a}function cv(i,a,u){return wo(a,i.child,null,u),i=xh(a,a.pendingProps),i.flags|=2,Rr(a),a.memoizedState=null,i}function fj(i,a,u){var m=a.pendingProps,v=(a.flags&128)!==0;if(a.flags&=-129,i===null){if(_t){if(m.mode==="hidden")return i=xh(a,m),a.lanes=536870912,cu(null,i);if(xg(a),(i=Gt)?(i=vx(i,Hr),i=i!==null&&i.data==="&"?i:null,i!==null&&(a.memoizedState={dehydrated:i,treeContext:Js!==null?{id:Pi,overflow:zi}:null,retryLane:536870912,hydrationErrors:null},u=q0(i),u.return=a,a.child=u,Ln=a,Gt=null)):i=null,i===null)throw ta(a);return a.lanes=536870912,null}return xh(a,m)}var C=i.memoizedState;if(C!==null){var z=C.dehydrated;if(xg(a),v)if(a.flags&256)a.flags&=-257,a=cv(i,a,u);else if(a.memoizedState!==null)a.child=i.child,a.flags|=128,a=null;else throw Error(r(558));else if(_n||vc(i,a,u,!1),v=(u&i.childLanes)!==0,_n||v){if(m=Lt,m!==null&&(z=Rl(m,u),z!==0&&z!==C.retryLane))throw C.retryLane=z,mo(i,z),_r(m,i,z),Vg;Dh(),a=cv(i,a,u)}else i=C.treeContext,Gt=Qr(z.nextSibling),Ln=a,_t=!0,ea=null,Hr=!1,i!==null&&Q0(a,i),a=xh(a,m),a.flags|=4096;return a}return i=cs(i.child,{mode:m.mode,children:m.children}),i.ref=a.ref,a.child=i,i.return=a,i}function wh(i,a){var u=a.ref;if(u===null)i!==null&&i.ref!==null&&(a.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(r(284));(i===null||i.ref!==u)&&(a.flags|=4194816)}}function $g(i,a,u,m,v){return _o(a),u=Sg(i,a,u,m,void 0,v),m=Cg(),i!==null&&!_n?(Eg(i,a,v),ms(i,a,v)):(_t&&m&&ig(a),a.flags|=1,Fn(i,a,u,v),a.child)}function lv(i,a,u,m,v,C){return _o(a),a.updateQueue=null,u=hb(a,m,u,v),db(i),m=Cg(),i!==null&&!_n?(Eg(i,a,C),ms(i,a,C)):(_t&&m&&ig(a),a.flags|=1,Fn(i,a,u,C),a.child)}function uv(i,a,u,m,v){if(_o(a),a.stateNode===null){var C=pc,z=u.contextType;typeof z=="object"&&z!==null&&(C=Un(z)),C=new u(m,C),a.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=Ug,a.stateNode=C,C._reactInternals=a,C=a.stateNode,C.props=m,C.state=a.memoizedState,C.refs={},gg(a),z=u.contextType,C.context=typeof z=="object"&&z!==null?Un(z):pc,C.state=a.memoizedState,z=u.getDerivedStateFromProps,typeof z=="function"&&(Lg(a,u,z,m),C.state=a.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(z=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),z!==C.state&&Ug.enqueueReplaceState(C,C.state,null),ru(a,m,C,v),nu(),C.state=a.memoizedState),typeof C.componentDidMount=="function"&&(a.flags|=4194308),m=!0}else if(i===null){C=a.stateNode;var W=a.memoizedProps,ne=Co(u,W);C.props=ne;var _e=C.context,je=u.contextType;z=pc,typeof je=="object"&&je!==null&&(z=Un(je));var De=u.getDerivedStateFromProps;je=typeof De=="function"||typeof C.getSnapshotBeforeUpdate=="function",W=a.pendingProps!==W,je||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(W||_e!==z)&&Yb(a,C,m,z),ra=!1;var be=a.memoizedState;C.state=be,ru(a,m,C,v),nu(),_e=a.memoizedState,W||be!==_e||ra?(typeof De=="function"&&(Lg(a,u,De,m),_e=a.memoizedState),(ne=ra||Kb(a,u,ne,m,be,_e,z))?(je||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(a.flags|=4194308)):(typeof C.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=m,a.memoizedState=_e),C.props=m,C.state=_e,C.context=z,m=ne):(typeof C.componentDidMount=="function"&&(a.flags|=4194308),m=!1)}else{C=a.stateNode,pg(i,a),z=a.memoizedProps,je=Co(u,z),C.props=je,De=a.pendingProps,be=C.context,_e=u.contextType,ne=pc,typeof _e=="object"&&_e!==null&&(ne=Un(_e)),W=u.getDerivedStateFromProps,(_e=typeof W=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(z!==De||be!==ne)&&Yb(a,C,m,ne),ra=!1,be=a.memoizedState,C.state=be,ru(a,m,C,v),nu();var we=a.memoizedState;z!==De||be!==we||ra||i!==null&&i.dependencies!==null&&rh(i.dependencies)?(typeof W=="function"&&(Lg(a,u,W,m),we=a.memoizedState),(je=ra||Kb(a,u,je,m,be,we,ne)||i!==null&&i.dependencies!==null&&rh(i.dependencies))?(_e||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(m,we,ne),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(m,we,ne)),typeof C.componentDidUpdate=="function"&&(a.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof C.componentDidUpdate!="function"||z===i.memoizedProps&&be===i.memoizedState||(a.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||z===i.memoizedProps&&be===i.memoizedState||(a.flags|=1024),a.memoizedProps=m,a.memoizedState=we),C.props=m,C.state=we,C.context=ne,m=je):(typeof C.componentDidUpdate!="function"||z===i.memoizedProps&&be===i.memoizedState||(a.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||z===i.memoizedProps&&be===i.memoizedState||(a.flags|=1024),m=!1)}return C=m,wh(i,a),m=(a.flags&128)!==0,C||m?(C=a.stateNode,u=m&&typeof u.getDerivedStateFromError!="function"?null:C.render(),a.flags|=1,i!==null&&m?(a.child=wo(a,i.child,null,v),a.child=wo(a,null,u,v)):Fn(i,a,u,v),a.memoizedState=C.state,i=a.child):i=ms(i,a,v),i}function dv(i,a,u,m){return po(),a.flags|=256,Fn(i,a,u,m),a.child}var Gg={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function qg(i){return{baseLanes:i,cachePool:eb()}}function Hg(i,a,u){return i=i!==null?i.childLanes&~u:0,a&&(i|=kr),i}function hv(i,a,u){var m=a.pendingProps,v=!1,C=(a.flags&128)!==0,z;if((z=C)||(z=i!==null&&i.memoizedState===null?!1:(cn.current&2)!==0),z&&(v=!0,a.flags&=-129),z=(a.flags&32)!==0,a.flags&=-33,i===null){if(_t){if(v?aa(a):oa(),(i=Gt)?(i=vx(i,Hr),i=i!==null&&i.data!=="&"?i:null,i!==null&&(a.memoizedState={dehydrated:i,treeContext:Js!==null?{id:Pi,overflow:zi}:null,retryLane:536870912,hydrationErrors:null},u=q0(i),u.return=a,a.child=u,Ln=a,Gt=null)):i=null,i===null)throw ta(a);return jp(i)?a.lanes=32:a.lanes=536870912,null}var W=m.children;return m=m.fallback,v?(oa(),v=a.mode,W=Sh({mode:"hidden",children:W},v),m=go(m,v,u,null),W.return=a,m.return=a,W.sibling=m,a.child=W,m=a.child,m.memoizedState=qg(u),m.childLanes=Hg(i,z,u),a.memoizedState=Gg,cu(null,m)):(aa(a),Wg(a,W))}var ne=i.memoizedState;if(ne!==null&&(W=ne.dehydrated,W!==null)){if(C)a.flags&256?(aa(a),a.flags&=-257,a=Qg(i,a,u)):a.memoizedState!==null?(oa(),a.child=i.child,a.flags|=128,a=null):(oa(),W=m.fallback,v=a.mode,m=Sh({mode:"visible",children:m.children},v),W=go(W,v,u,null),W.flags|=2,m.return=a,W.return=a,m.sibling=W,a.child=m,wo(a,i.child,null,u),m=a.child,m.memoizedState=qg(u),m.childLanes=Hg(i,z,u),a.memoizedState=Gg,a=cu(null,m));else if(aa(a),jp(W)){if(z=W.nextSibling&&W.nextSibling.dataset,z)var _e=z.dgst;z=_e,m=Error(r(419)),m.stack="",m.digest=z,Yl({value:m,source:null,stack:null}),a=Qg(i,a,u)}else if(_n||vc(i,a,u,!1),z=(u&i.childLanes)!==0,_n||z){if(z=Lt,z!==null&&(m=Rl(z,u),m!==0&&m!==ne.retryLane))throw ne.retryLane=m,mo(i,m),_r(z,i,m),Vg;Ap(W)||Dh(),a=Qg(i,a,u)}else Ap(W)?(a.flags|=192,a.child=i.child,a=null):(i=ne.treeContext,Gt=Qr(W.nextSibling),Ln=a,_t=!0,ea=null,Hr=!1,i!==null&&Q0(a,i),a=Wg(a,m.children),a.flags|=4096);return a}return v?(oa(),W=m.fallback,v=a.mode,ne=i.child,_e=ne.sibling,m=cs(ne,{mode:"hidden",children:m.children}),m.subtreeFlags=ne.subtreeFlags&65011712,_e!==null?W=cs(_e,W):(W=go(W,v,u,null),W.flags|=2),W.return=a,m.return=a,m.sibling=W,a.child=m,cu(null,m),m=a.child,W=i.child.memoizedState,W===null?W=qg(u):(v=W.cachePool,v!==null?(ne=pn._currentValue,v=v.parent!==ne?{parent:ne,pool:ne}:v):v=eb(),W={baseLanes:W.baseLanes|u,cachePool:v}),m.memoizedState=W,m.childLanes=Hg(i,z,u),a.memoizedState=Gg,cu(i.child,m)):(aa(a),u=i.child,i=u.sibling,u=cs(u,{mode:"visible",children:m.children}),u.return=a,u.sibling=null,i!==null&&(z=a.deletions,z===null?(a.deletions=[i],a.flags|=16):z.push(i)),a.child=u,a.memoizedState=null,u)}function Wg(i,a){return a=Sh({mode:"visible",children:a},i.mode),a.return=i,i.child=a}function Sh(i,a){return i=Ar(22,i,null,a),i.lanes=0,i}function Qg(i,a,u){return wo(a,i.child,null,u),i=Wg(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function fv(i,a,u){i.lanes|=a;var m=i.alternate;m!==null&&(m.lanes|=a),lg(i.return,a,u)}function Kg(i,a,u,m,v,C){var z=i.memoizedState;z===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:m,tail:u,tailMode:v,treeForkCount:C}:(z.isBackwards=a,z.rendering=null,z.renderingStartTime=0,z.last=m,z.tail=u,z.tailMode=v,z.treeForkCount=C)}function mv(i,a,u){var m=a.pendingProps,v=m.revealOrder,C=m.tail;m=m.children;var z=cn.current,W=(z&2)!==0;if(W?(z=z&1|2,a.flags|=128):z&=1,ee(cn,z),Fn(i,a,m,u),m=_t?Kl:0,!W&&i!==null&&(i.flags&128)!==0)e:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&fv(i,u,a);else if(i.tag===19)fv(i,u,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break e;for(;i.sibling===null;){if(i.return===null||i.return===a)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(v){case"forwards":for(u=a.child,v=null;u!==null;)i=u.alternate,i!==null&&dh(i)===null&&(v=u),u=u.sibling;u=v,u===null?(v=a.child,a.child=null):(v=u.sibling,u.sibling=null),Kg(a,!1,v,u,C,m);break;case"backwards":case"unstable_legacy-backwards":for(u=null,v=a.child,a.child=null;v!==null;){if(i=v.alternate,i!==null&&dh(i)===null){a.child=v;break}i=v.sibling,v.sibling=u,u=v,v=i}Kg(a,!0,u,null,C,m);break;case"together":Kg(a,!1,null,null,void 0,m);break;default:a.memoizedState=null}return a.child}function ms(i,a,u){if(i!==null&&(a.dependencies=i.dependencies),ua|=a.lanes,(u&a.childLanes)===0)if(i!==null){if(vc(i,a,u,!1),(u&a.childLanes)===0)return null}else return null;if(i!==null&&a.child!==i.child)throw Error(r(153));if(a.child!==null){for(i=a.child,u=cs(i,i.pendingProps),a.child=u,u.return=a;i.sibling!==null;)i=i.sibling,u=u.sibling=cs(i,i.pendingProps),u.return=a;u.sibling=null}return a.child}function Yg(i,a){return(i.lanes&a)!==0?!0:(i=i.dependencies,!!(i!==null&&rh(i)))}function mj(i,a,u){switch(a.tag){case 3:ie(a,a.stateNode.containerInfo),na(a,pn,i.memoizedState.cache),po();break;case 27:case 5:Me(a);break;case 4:ie(a,a.stateNode.containerInfo);break;case 10:na(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,xg(a),null;break;case 13:var m=a.memoizedState;if(m!==null)return m.dehydrated!==null?(aa(a),a.flags|=128,null):(u&a.child.childLanes)!==0?hv(i,a,u):(aa(a),i=ms(i,a,u),i!==null?i.sibling:null);aa(a);break;case 19:var v=(i.flags&128)!==0;if(m=(u&a.childLanes)!==0,m||(vc(i,a,u,!1),m=(u&a.childLanes)!==0),v){if(m)return mv(i,a,u);a.flags|=128}if(v=a.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),ee(cn,cn.current),m)break;return null;case 22:return a.lanes=0,av(i,a,u,a.pendingProps);case 24:na(a,pn,i.memoizedState.cache)}return ms(i,a,u)}function gv(i,a,u){if(i!==null)if(i.memoizedProps!==a.pendingProps)_n=!0;else{if(!Yg(i,u)&&(a.flags&128)===0)return _n=!1,mj(i,a,u);_n=(i.flags&131072)!==0}else _n=!1,_t&&(a.flags&1048576)!==0&&W0(a,Kl,a.index);switch(a.lanes=0,a.tag){case 16:e:{var m=a.pendingProps;if(i=vo(a.elementType),a.type=i,typeof i=="function")tg(i)?(m=Co(i,m),a.tag=1,a=uv(null,a,i,m,u)):(a.tag=0,a=$g(null,a,i,m,u));else{if(i!=null){var v=i.$$typeof;if(v===M){a.tag=11,a=rv(null,a,i,m,u);break e}else if(v===O){a.tag=14,a=iv(null,a,i,m,u);break e}}throw a=D(i)||i,Error(r(306,a,""))}}return a;case 0:return $g(i,a,a.type,a.pendingProps,u);case 1:return m=a.type,v=Co(m,a.pendingProps),uv(i,a,m,v,u);case 3:e:{if(ie(a,a.stateNode.containerInfo),i===null)throw Error(r(387));m=a.pendingProps;var C=a.memoizedState;v=C.element,pg(i,a),ru(a,m,null,u);var z=a.memoizedState;if(m=z.cache,na(a,pn,m),m!==C.cache&&ug(a,[pn],u,!0),nu(),m=z.element,C.isDehydrated)if(C={element:m,isDehydrated:!1,cache:z.cache},a.updateQueue.baseState=C,a.memoizedState=C,a.flags&256){a=dv(i,a,m,u);break e}else if(m!==v){v=$r(Error(r(424)),a),Yl(v),a=dv(i,a,m,u);break e}else for(i=a.stateNode.containerInfo,i.nodeType===9?i=i.body:i=i.nodeName==="HTML"?i.ownerDocument.body:i,Gt=Qr(i.firstChild),Ln=a,_t=!0,ea=null,Hr=!0,u=ab(a,null,m,u),a.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(po(),m===v){a=ms(i,a,u);break e}Fn(i,a,m,u)}a=a.child}return a;case 26:return wh(i,a),i===null?(u=Tx(a.type,null,a.pendingProps,null))?a.memoizedState=u:_t||(u=a.type,i=a.pendingProps,m=Lh(ge.current).createElement(u),m[fn]=a,m[Mn]=i,Vn(m,u,i),mn(m),a.stateNode=m):a.memoizedState=Tx(a.type,i.memoizedProps,a.pendingProps,i.memoizedState),null;case 27:return Me(a),i===null&&_t&&(m=a.stateNode=Sx(a.type,a.pendingProps,ge.current),Ln=a,Hr=!0,v=Gt,ga(a.type)?(Rp=v,Gt=Qr(m.firstChild)):Gt=v),Fn(i,a,a.pendingProps.children,u),wh(i,a),i===null&&(a.flags|=4194304),a.child;case 5:return i===null&&_t&&((v=m=Gt)&&(m=Gj(m,a.type,a.pendingProps,Hr),m!==null?(a.stateNode=m,Ln=a,Gt=Qr(m.firstChild),Hr=!1,v=!0):v=!1),v||ta(a)),Me(a),v=a.type,C=a.pendingProps,z=i!==null?i.memoizedProps:null,m=C.children,Cp(v,C)?m=null:z!==null&&Cp(v,z)&&(a.flags|=32),a.memoizedState!==null&&(v=Sg(i,a,sj,null,null,u),Su._currentValue=v),wh(i,a),Fn(i,a,m,u),a.child;case 6:return i===null&&_t&&((i=u=Gt)&&(u=qj(u,a.pendingProps,Hr),u!==null?(a.stateNode=u,Ln=a,Gt=null,i=!0):i=!1),i||ta(a)),null;case 13:return hv(i,a,u);case 4:return ie(a,a.stateNode.containerInfo),m=a.pendingProps,i===null?a.child=wo(a,null,m,u):Fn(i,a,m,u),a.child;case 11:return rv(i,a,a.type,a.pendingProps,u);case 7:return Fn(i,a,a.pendingProps,u),a.child;case 8:return Fn(i,a,a.pendingProps.children,u),a.child;case 12:return Fn(i,a,a.pendingProps.children,u),a.child;case 10:return m=a.pendingProps,na(a,a.type,m.value),Fn(i,a,m.children,u),a.child;case 9:return v=a.type._context,m=a.pendingProps.children,_o(a),v=Un(v),m=m(v),a.flags|=1,Fn(i,a,m,u),a.child;case 14:return iv(i,a,a.type,a.pendingProps,u);case 15:return sv(i,a,a.type,a.pendingProps,u);case 19:return mv(i,a,u);case 31:return fj(i,a,u);case 22:return av(i,a,u,a.pendingProps);case 24:return _o(a),m=Un(pn),i===null?(v=fg(),v===null&&(v=Lt,C=dg(),v.pooledCache=C,C.refCount++,C!==null&&(v.pooledCacheLanes|=u),v=C),a.memoizedState={parent:m,cache:v},gg(a),na(a,pn,v)):((i.lanes&u)!==0&&(pg(i,a),ru(a,null,null,u),nu()),v=i.memoizedState,C=a.memoizedState,v.parent!==m?(v={parent:m,cache:m},a.memoizedState=v,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=v),na(a,pn,m)):(m=C.cache,na(a,pn,m),m!==v.cache&&ug(a,[pn],u,!0))),Fn(i,a,a.pendingProps.children,u),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function gs(i){i.flags|=4}function Xg(i,a,u,m,v){if((a=(i.mode&32)!==0)&&(a=!1),a){if(i.flags|=16777216,(v&335544128)===v)if(i.stateNode.complete)i.flags|=8192;else if(Vv())i.flags|=8192;else throw xo=oh,mg}else i.flags&=-16777217}function pv(i,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!kx(a))if(Vv())i.flags|=8192;else throw xo=oh,mg}function Ch(i,a){a!==null&&(i.flags|=4),i.flags&16384&&(a=i.tag!==22?Id():536870912,i.lanes|=a,Dc|=a)}function lu(i,a){if(!_t)switch(i.tailMode){case"hidden":a=i.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?i.tail=null:u.sibling=null;break;case"collapsed":u=i.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:m.sibling=null}}function qt(i){var a=i.alternate!==null&&i.alternate.child===i.child,u=0,m=0;if(a)for(var v=i.child;v!==null;)u|=v.lanes|v.childLanes,m|=v.subtreeFlags&65011712,m|=v.flags&65011712,v.return=i,v=v.sibling;else for(v=i.child;v!==null;)u|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=i,v=v.sibling;return i.subtreeFlags|=m,i.childLanes=u,a}function gj(i,a,u){var m=a.pendingProps;switch(sg(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(a),null;case 1:return qt(a),null;case 3:return u=a.stateNode,m=null,i!==null&&(m=i.memoizedState.cache),a.memoizedState.cache!==m&&(a.flags|=2048),ds(pn),le(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(i===null||i.child===null)&&(bc(a)?gs(a):i===null||i.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,og())),qt(a),null;case 26:var v=a.type,C=a.memoizedState;return i===null?(gs(a),C!==null?(qt(a),pv(a,C)):(qt(a),Xg(a,v,null,m,u))):C?C!==i.memoizedState?(gs(a),qt(a),pv(a,C)):(qt(a),a.flags&=-16777217):(i=i.memoizedProps,i!==m&&gs(a),qt(a),Xg(a,v,i,m,u)),null;case 27:if(Be(a),u=ge.current,v=a.type,i!==null&&a.stateNode!=null)i.memoizedProps!==m&&gs(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return qt(a),null}i=re.current,bc(a)?K0(a):(i=Sx(v,m,u),a.stateNode=i,gs(a))}return qt(a),null;case 5:if(Be(a),v=a.type,i!==null&&a.stateNode!=null)i.memoizedProps!==m&&gs(a);else{if(!m){if(a.stateNode===null)throw Error(r(166));return qt(a),null}if(C=re.current,bc(a))K0(a);else{var z=Lh(ge.current);switch(C){case 1:C=z.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:C=z.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":C=z.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":C=z.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":C=z.createElement("div"),C.innerHTML="<script><\/script>",C=C.removeChild(C.firstChild);break;case"select":C=typeof m.is=="string"?z.createElement("select",{is:m.is}):z.createElement("select"),m.multiple?C.multiple=!0:m.size&&(C.size=m.size);break;default:C=typeof m.is=="string"?z.createElement(v,{is:m.is}):z.createElement(v)}}C[fn]=a,C[Mn]=m;e:for(z=a.child;z!==null;){if(z.tag===5||z.tag===6)C.appendChild(z.stateNode);else if(z.tag!==4&&z.tag!==27&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===a)break e;for(;z.sibling===null;){if(z.return===null||z.return===a)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}a.stateNode=C;e:switch(Vn(C,v,m),v){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&gs(a)}}return qt(a),Xg(a,a.type,i===null?null:i.memoizedProps,a.pendingProps,u),null;case 6:if(i&&a.stateNode!=null)i.memoizedProps!==m&&gs(a);else{if(typeof m!="string"&&a.stateNode===null)throw Error(r(166));if(i=ge.current,bc(a)){if(i=a.stateNode,u=a.memoizedProps,m=null,v=Ln,v!==null)switch(v.tag){case 27:case 5:m=v.memoizedProps}i[fn]=a,i=!!(i.nodeValue===u||m!==null&&m.suppressHydrationWarning===!0||hx(i.nodeValue,u)),i||ta(a,!0)}else i=Lh(i).createTextNode(m),i[fn]=a,a.stateNode=i}return qt(a),null;case 31:if(u=a.memoizedState,i===null||i.memoizedState!==null){if(m=bc(a),u!==null){if(i===null){if(!m)throw Error(r(318));if(i=a.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(r(557));i[fn]=a}else po(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qt(a),i=!1}else u=og(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=u),i=!0;if(!i)return a.flags&256?(Rr(a),a):(Rr(a),null);if((a.flags&128)!==0)throw Error(r(558))}return qt(a),null;case 13:if(m=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(v=bc(a),m!==null&&m.dehydrated!==null){if(i===null){if(!v)throw Error(r(318));if(v=a.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[fn]=a}else po(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qt(a),v=!1}else v=og(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=v),v=!0;if(!v)return a.flags&256?(Rr(a),a):(Rr(a),null)}return Rr(a),(a.flags&128)!==0?(a.lanes=u,a):(u=m!==null,i=i!==null&&i.memoizedState!==null,u&&(m=a.child,v=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(v=m.alternate.memoizedState.cachePool.pool),C=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(C=m.memoizedState.cachePool.pool),C!==v&&(m.flags|=2048)),u!==i&&u&&(a.child.flags|=8192),Ch(a,a.updateQueue),qt(a),null);case 4:return le(),i===null&&bp(a.stateNode.containerInfo),qt(a),null;case 10:return ds(a.type),qt(a),null;case 19:if(G(cn),m=a.memoizedState,m===null)return qt(a),null;if(v=(a.flags&128)!==0,C=m.rendering,C===null)if(v)lu(m,!1);else{if(sn!==0||i!==null&&(i.flags&128)!==0)for(i=a.child;i!==null;){if(C=dh(i),C!==null){for(a.flags|=128,lu(m,!1),i=C.updateQueue,a.updateQueue=i,Ch(a,i),a.subtreeFlags=0,i=u,u=a.child;u!==null;)G0(u,i),u=u.sibling;return ee(cn,cn.current&1|2),_t&&ls(a,m.treeForkCount),a.child}i=i.sibling}m.tail!==null&&Ae()>Rh&&(a.flags|=128,v=!0,lu(m,!1),a.lanes=4194304)}else{if(!v)if(i=dh(C),i!==null){if(a.flags|=128,v=!0,i=i.updateQueue,a.updateQueue=i,Ch(a,i),lu(m,!0),m.tail===null&&m.tailMode==="hidden"&&!C.alternate&&!_t)return qt(a),null}else 2*Ae()-m.renderingStartTime>Rh&&u!==536870912&&(a.flags|=128,v=!0,lu(m,!1),a.lanes=4194304);m.isBackwards?(C.sibling=a.child,a.child=C):(i=m.last,i!==null?i.sibling=C:a.child=C,m.last=C)}return m.tail!==null?(i=m.tail,m.rendering=i,m.tail=i.sibling,m.renderingStartTime=Ae(),i.sibling=null,u=cn.current,ee(cn,v?u&1|2:u&1),_t&&ls(a,m.treeForkCount),i):(qt(a),null);case 22:case 23:return Rr(a),vg(),m=a.memoizedState!==null,i!==null?i.memoizedState!==null!==m&&(a.flags|=8192):m&&(a.flags|=8192),m?(u&536870912)!==0&&(a.flags&128)===0&&(qt(a),a.subtreeFlags&6&&(a.flags|=8192)):qt(a),u=a.updateQueue,u!==null&&Ch(a,u.retryQueue),u=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),m=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),m!==u&&(a.flags|=2048),i!==null&&G(bo),null;case 24:return u=null,i!==null&&(u=i.memoizedState.cache),a.memoizedState.cache!==u&&(a.flags|=2048),ds(pn),qt(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function pj(i,a){switch(sg(a),a.tag){case 1:return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return ds(pn),le(),i=a.flags,(i&65536)!==0&&(i&128)===0?(a.flags=i&-65537|128,a):null;case 26:case 27:case 5:return Be(a),null;case 31:if(a.memoizedState!==null){if(Rr(a),a.alternate===null)throw Error(r(340));po()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 13:if(Rr(a),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(r(340));po()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return G(cn),null;case 4:return le(),null;case 10:return ds(a.type),null;case 22:case 23:return Rr(a),vg(),i!==null&&G(bo),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 24:return ds(pn),null;case 25:return null;default:return null}}function yv(i,a){switch(sg(a),a.tag){case 3:ds(pn),le();break;case 26:case 27:case 5:Be(a);break;case 4:le();break;case 31:a.memoizedState!==null&&Rr(a);break;case 13:Rr(a);break;case 19:G(cn);break;case 10:ds(a.type);break;case 22:case 23:Rr(a),vg(),i!==null&&G(bo);break;case 24:ds(pn)}}function uu(i,a){try{var u=a.updateQueue,m=u!==null?u.lastEffect:null;if(m!==null){var v=m.next;u=v;do{if((u.tag&i)===i){m=void 0;var C=u.create,z=u.inst;m=C(),z.destroy=m}u=u.next}while(u!==v)}}catch(W){Dt(a,a.return,W)}}function ca(i,a,u){try{var m=a.updateQueue,v=m!==null?m.lastEffect:null;if(v!==null){var C=v.next;m=C;do{if((m.tag&i)===i){var z=m.inst,W=z.destroy;if(W!==void 0){z.destroy=void 0,v=a;var ne=u,_e=W;try{_e()}catch(je){Dt(v,ne,je)}}}m=m.next}while(m!==C)}}catch(je){Dt(a,a.return,je)}}function _v(i){var a=i.updateQueue;if(a!==null){var u=i.stateNode;try{cb(a,u)}catch(m){Dt(i,i.return,m)}}}function bv(i,a,u){u.props=Co(i.type,i.memoizedProps),u.state=i.memoizedState;try{u.componentWillUnmount()}catch(m){Dt(i,a,m)}}function du(i,a){try{var u=i.ref;if(u!==null){switch(i.tag){case 26:case 27:case 5:var m=i.stateNode;break;case 30:m=i.stateNode;break;default:m=i.stateNode}typeof u=="function"?i.refCleanup=u(m):u.current=m}}catch(v){Dt(i,a,v)}}function Li(i,a){var u=i.ref,m=i.refCleanup;if(u!==null)if(typeof m=="function")try{m()}catch(v){Dt(i,a,v)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(v){Dt(i,a,v)}else u.current=null}function vv(i){var a=i.type,u=i.memoizedProps,m=i.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":u.autoFocus&&m.focus();break e;case"img":u.src?m.src=u.src:u.srcSet&&(m.srcset=u.srcSet)}}catch(v){Dt(i,i.return,v)}}function Zg(i,a,u){try{var m=i.stateNode;zj(m,i.type,u,a),m[Mn]=a}catch(v){Dt(i,i.return,v)}}function xv(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&ga(i.type)||i.tag===4}function Jg(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||xv(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&ga(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function ep(i,a,u){var m=i.tag;if(m===5||m===6)i=i.stateNode,a?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(i,a):(a=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,a.appendChild(i),u=u._reactRootContainer,u!=null||a.onclick!==null||(a.onclick=ii));else if(m!==4&&(m===27&&ga(i.type)&&(u=i.stateNode,a=null),i=i.child,i!==null))for(ep(i,a,u),i=i.sibling;i!==null;)ep(i,a,u),i=i.sibling}function Eh(i,a,u){var m=i.tag;if(m===5||m===6)i=i.stateNode,a?u.insertBefore(i,a):u.appendChild(i);else if(m!==4&&(m===27&&ga(i.type)&&(u=i.stateNode),i=i.child,i!==null))for(Eh(i,a,u),i=i.sibling;i!==null;)Eh(i,a,u),i=i.sibling}function wv(i){var a=i.stateNode,u=i.memoizedProps;try{for(var m=i.type,v=a.attributes;v.length;)a.removeAttributeNode(v[0]);Vn(a,m,u),a[fn]=i,a[Mn]=u}catch(C){Dt(i,i.return,C)}}var ps=!1,bn=!1,tp=!1,Sv=typeof WeakSet=="function"?WeakSet:Set,Nn=null;function yj(i,a){if(i=i.containerInfo,wp=Hh,i=N0(i),Qm(i)){if("selectionStart"in i)var u={start:i.selectionStart,end:i.selectionEnd};else e:{u=(u=i.ownerDocument)&&u.defaultView||window;var m=u.getSelection&&u.getSelection();if(m&&m.rangeCount!==0){u=m.anchorNode;var v=m.anchorOffset,C=m.focusNode;m=m.focusOffset;try{u.nodeType,C.nodeType}catch{u=null;break e}var z=0,W=-1,ne=-1,_e=0,je=0,De=i,be=null;t:for(;;){for(var we;De!==u||v!==0&&De.nodeType!==3||(W=z+v),De!==C||m!==0&&De.nodeType!==3||(ne=z+m),De.nodeType===3&&(z+=De.nodeValue.length),(we=De.firstChild)!==null;)be=De,De=we;for(;;){if(De===i)break t;if(be===u&&++_e===v&&(W=z),be===C&&++je===m&&(ne=z),(we=De.nextSibling)!==null)break;De=be,be=De.parentNode}De=we}u=W===-1||ne===-1?null:{start:W,end:ne}}else u=null}u=u||{start:0,end:0}}else u=null;for(Sp={focusedElem:i,selectionRange:u},Hh=!1,Nn=a;Nn!==null;)if(a=Nn,i=a.child,(a.subtreeFlags&1028)!==0&&i!==null)i.return=a,Nn=i;else for(;Nn!==null;){switch(a=Nn,C=a.alternate,i=a.flags,a.tag){case 0:if((i&4)!==0&&(i=a.updateQueue,i=i!==null?i.events:null,i!==null))for(u=0;u<i.length;u++)v=i[u],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&C!==null){i=void 0,u=a,v=C.memoizedProps,C=C.memoizedState,m=u.stateNode;try{var Ve=Co(u.type,v);i=m.getSnapshotBeforeUpdate(Ve,C),m.__reactInternalSnapshotBeforeUpdate=i}catch(Ke){Dt(u,u.return,Ke)}}break;case 3:if((i&1024)!==0){if(i=a.stateNode.containerInfo,u=i.nodeType,u===9)Tp(i);else if(u===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Tp(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(r(163))}if(i=a.sibling,i!==null){i.return=a.return,Nn=i;break}Nn=a.return}}function Cv(i,a,u){var m=u.flags;switch(u.tag){case 0:case 11:case 15:_s(i,u),m&4&&uu(5,u);break;case 1:if(_s(i,u),m&4)if(i=u.stateNode,a===null)try{i.componentDidMount()}catch(z){Dt(u,u.return,z)}else{var v=Co(u.type,a.memoizedProps);a=a.memoizedState;try{i.componentDidUpdate(v,a,i.__reactInternalSnapshotBeforeUpdate)}catch(z){Dt(u,u.return,z)}}m&64&&_v(u),m&512&&du(u,u.return);break;case 3:if(_s(i,u),m&64&&(i=u.updateQueue,i!==null)){if(a=null,u.child!==null)switch(u.child.tag){case 27:case 5:a=u.child.stateNode;break;case 1:a=u.child.stateNode}try{cb(i,a)}catch(z){Dt(u,u.return,z)}}break;case 27:a===null&&m&4&&wv(u);case 26:case 5:_s(i,u),a===null&&m&4&&vv(u),m&512&&du(u,u.return);break;case 12:_s(i,u);break;case 31:_s(i,u),m&4&&Av(i,u);break;case 13:_s(i,u),m&4&&jv(i,u),m&64&&(i=u.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(u=Tj.bind(null,u),Hj(i,u))));break;case 22:if(m=u.memoizedState!==null||ps,!m){a=a!==null&&a.memoizedState!==null||bn,v=ps;var C=bn;ps=m,(bn=a)&&!C?bs(i,u,(u.subtreeFlags&8772)!==0):_s(i,u),ps=v,bn=C}break;case 30:break;default:_s(i,u)}}function Ev(i){var a=i.alternate;a!==null&&(i.alternate=null,Ev(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&nc(a)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Yt=null,mr=!1;function ys(i,a,u){for(u=u.child;u!==null;)Tv(i,a,u),u=u.sibling}function Tv(i,a,u){if(nn&&typeof nn.onCommitFiberUnmount=="function")try{nn.onCommitFiberUnmount(xt,u)}catch{}switch(u.tag){case 26:bn||Li(u,a),ys(i,a,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:bn||Li(u,a);var m=Yt,v=mr;ga(u.type)&&(Yt=u.stateNode,mr=!1),ys(i,a,u),vu(u.stateNode),Yt=m,mr=v;break;case 5:bn||Li(u,a);case 6:if(m=Yt,v=mr,Yt=null,ys(i,a,u),Yt=m,mr=v,Yt!==null)if(mr)try{(Yt.nodeType===9?Yt.body:Yt.nodeName==="HTML"?Yt.ownerDocument.body:Yt).removeChild(u.stateNode)}catch(C){Dt(u,a,C)}else try{Yt.removeChild(u.stateNode)}catch(C){Dt(u,a,C)}break;case 18:Yt!==null&&(mr?(i=Yt,_x(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,u.stateNode),Uc(i)):_x(Yt,u.stateNode));break;case 4:m=Yt,v=mr,Yt=u.stateNode.containerInfo,mr=!0,ys(i,a,u),Yt=m,mr=v;break;case 0:case 11:case 14:case 15:ca(2,u,a),bn||ca(4,u,a),ys(i,a,u);break;case 1:bn||(Li(u,a),m=u.stateNode,typeof m.componentWillUnmount=="function"&&bv(u,a,m)),ys(i,a,u);break;case 21:ys(i,a,u);break;case 22:bn=(m=bn)||u.memoizedState!==null,ys(i,a,u),bn=m;break;default:ys(i,a,u)}}function Av(i,a){if(a.memoizedState===null&&(i=a.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{Uc(i)}catch(u){Dt(a,a.return,u)}}}function jv(i,a){if(a.memoizedState===null&&(i=a.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Uc(i)}catch(u){Dt(a,a.return,u)}}function _j(i){switch(i.tag){case 31:case 13:case 19:var a=i.stateNode;return a===null&&(a=i.stateNode=new Sv),a;case 22:return i=i.stateNode,a=i._retryCache,a===null&&(a=i._retryCache=new Sv),a;default:throw Error(r(435,i.tag))}}function Th(i,a){var u=_j(i);a.forEach(function(m){if(!u.has(m)){u.add(m);var v=Aj.bind(null,i,m);m.then(v,v)}})}function gr(i,a){var u=a.deletions;if(u!==null)for(var m=0;m<u.length;m++){var v=u[m],C=i,z=a,W=z;e:for(;W!==null;){switch(W.tag){case 27:if(ga(W.type)){Yt=W.stateNode,mr=!1;break e}break;case 5:Yt=W.stateNode,mr=!1;break e;case 3:case 4:Yt=W.stateNode.containerInfo,mr=!0;break e}W=W.return}if(Yt===null)throw Error(r(160));Tv(C,z,v),Yt=null,mr=!1,C=v.alternate,C!==null&&(C.return=null),v.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)Rv(a,i),a=a.sibling}var ui=null;function Rv(i,a){var u=i.alternate,m=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:gr(a,i),pr(i),m&4&&(ca(3,i,i.return),uu(3,i),ca(5,i,i.return));break;case 1:gr(a,i),pr(i),m&512&&(bn||u===null||Li(u,u.return)),m&64&&ps&&(i=i.updateQueue,i!==null&&(m=i.callbacks,m!==null&&(u=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=u===null?m:u.concat(m))));break;case 26:var v=ui;if(gr(a,i),pr(i),m&512&&(bn||u===null||Li(u,u.return)),m&4){var C=u!==null?u.memoizedState:null;if(m=i.memoizedState,u===null)if(m===null)if(i.stateNode===null){e:{m=i.type,u=i.memoizedProps,v=v.ownerDocument||v;t:switch(m){case"title":C=v.getElementsByTagName("title")[0],(!C||C[Ei]||C[fn]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=v.createElement(m),v.head.insertBefore(C,v.querySelector("head > title"))),Vn(C,m,u),C[fn]=i,mn(C),m=C;break e;case"link":var z=Rx("link","href",v).get(m+(u.href||""));if(z){for(var W=0;W<z.length;W++)if(C=z[W],C.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&C.getAttribute("rel")===(u.rel==null?null:u.rel)&&C.getAttribute("title")===(u.title==null?null:u.title)&&C.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){z.splice(W,1);break t}}C=v.createElement(m),Vn(C,m,u),v.head.appendChild(C);break;case"meta":if(z=Rx("meta","content",v).get(m+(u.content||""))){for(W=0;W<z.length;W++)if(C=z[W],C.getAttribute("content")===(u.content==null?null:""+u.content)&&C.getAttribute("name")===(u.name==null?null:u.name)&&C.getAttribute("property")===(u.property==null?null:u.property)&&C.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&C.getAttribute("charset")===(u.charSet==null?null:u.charSet)){z.splice(W,1);break t}}C=v.createElement(m),Vn(C,m,u),v.head.appendChild(C);break;default:throw Error(r(468,m))}C[fn]=i,mn(C),m=C}i.stateNode=m}else Ix(v,i.type,i.stateNode);else i.stateNode=jx(v,m,i.memoizedProps);else C!==m?(C===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):C.count--,m===null?Ix(v,i.type,i.stateNode):jx(v,m,i.memoizedProps)):m===null&&i.stateNode!==null&&Zg(i,i.memoizedProps,u.memoizedProps)}break;case 27:gr(a,i),pr(i),m&512&&(bn||u===null||Li(u,u.return)),u!==null&&m&4&&Zg(i,i.memoizedProps,u.memoizedProps);break;case 5:if(gr(a,i),pr(i),m&512&&(bn||u===null||Li(u,u.return)),i.flags&32){v=i.stateNode;try{fr(v,"")}catch(Ve){Dt(i,i.return,Ve)}}m&4&&i.stateNode!=null&&(v=i.memoizedProps,Zg(i,v,u!==null?u.memoizedProps:v)),m&1024&&(tp=!0);break;case 6:if(gr(a,i),pr(i),m&4){if(i.stateNode===null)throw Error(r(162));m=i.memoizedProps,u=i.stateNode;try{u.nodeValue=m}catch(Ve){Dt(i,i.return,Ve)}}break;case 3:if(Vh=null,v=ui,ui=Uh(a.containerInfo),gr(a,i),ui=v,pr(i),m&4&&u!==null&&u.memoizedState.isDehydrated)try{Uc(a.containerInfo)}catch(Ve){Dt(i,i.return,Ve)}tp&&(tp=!1,Iv(i));break;case 4:m=ui,ui=Uh(i.stateNode.containerInfo),gr(a,i),pr(i),ui=m;break;case 12:gr(a,i),pr(i);break;case 31:gr(a,i),pr(i),m&4&&(m=i.updateQueue,m!==null&&(i.updateQueue=null,Th(i,m)));break;case 13:gr(a,i),pr(i),i.child.flags&8192&&i.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(jh=Ae()),m&4&&(m=i.updateQueue,m!==null&&(i.updateQueue=null,Th(i,m)));break;case 22:v=i.memoizedState!==null;var ne=u!==null&&u.memoizedState!==null,_e=ps,je=bn;if(ps=_e||v,bn=je||ne,gr(a,i),bn=je,ps=_e,pr(i),m&8192)e:for(a=i.stateNode,a._visibility=v?a._visibility&-2:a._visibility|1,v&&(u===null||ne||ps||bn||Eo(i)),u=null,a=i;;){if(a.tag===5||a.tag===26){if(u===null){ne=u=a;try{if(C=ne.stateNode,v)z=C.style,typeof z.setProperty=="function"?z.setProperty("display","none","important"):z.display="none";else{W=ne.stateNode;var De=ne.memoizedProps.style,be=De!=null&&De.hasOwnProperty("display")?De.display:null;W.style.display=be==null||typeof be=="boolean"?"":(""+be).trim()}}catch(Ve){Dt(ne,ne.return,Ve)}}}else if(a.tag===6){if(u===null){ne=a;try{ne.stateNode.nodeValue=v?"":ne.memoizedProps}catch(Ve){Dt(ne,ne.return,Ve)}}}else if(a.tag===18){if(u===null){ne=a;try{var we=ne.stateNode;v?bx(we,!0):bx(ne.stateNode,!1)}catch(Ve){Dt(ne,ne.return,Ve)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===i)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break e;for(;a.sibling===null;){if(a.return===null||a.return===i)break e;u===a&&(u=null),a=a.return}u===a&&(u=null),a.sibling.return=a.return,a=a.sibling}m&4&&(m=i.updateQueue,m!==null&&(u=m.retryQueue,u!==null&&(m.retryQueue=null,Th(i,u))));break;case 19:gr(a,i),pr(i),m&4&&(m=i.updateQueue,m!==null&&(i.updateQueue=null,Th(i,m)));break;case 30:break;case 21:break;default:gr(a,i),pr(i)}}function pr(i){var a=i.flags;if(a&2){try{for(var u,m=i.return;m!==null;){if(xv(m)){u=m;break}m=m.return}if(u==null)throw Error(r(160));switch(u.tag){case 27:var v=u.stateNode,C=Jg(i);Eh(i,C,v);break;case 5:var z=u.stateNode;u.flags&32&&(fr(z,""),u.flags&=-33);var W=Jg(i);Eh(i,W,z);break;case 3:case 4:var ne=u.stateNode.containerInfo,_e=Jg(i);ep(i,_e,ne);break;default:throw Error(r(161))}}catch(je){Dt(i,i.return,je)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function Iv(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var a=i;Iv(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),i=i.sibling}}function _s(i,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Cv(i,a.alternate,a),a=a.sibling}function Eo(i){for(i=i.child;i!==null;){var a=i;switch(a.tag){case 0:case 11:case 14:case 15:ca(4,a,a.return),Eo(a);break;case 1:Li(a,a.return);var u=a.stateNode;typeof u.componentWillUnmount=="function"&&bv(a,a.return,u),Eo(a);break;case 27:vu(a.stateNode);case 26:case 5:Li(a,a.return),Eo(a);break;case 22:a.memoizedState===null&&Eo(a);break;case 30:Eo(a);break;default:Eo(a)}i=i.sibling}}function bs(i,a,u){for(u=u&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var m=a.alternate,v=i,C=a,z=C.flags;switch(C.tag){case 0:case 11:case 15:bs(v,C,u),uu(4,C);break;case 1:if(bs(v,C,u),m=C,v=m.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(_e){Dt(m,m.return,_e)}if(m=C,v=m.updateQueue,v!==null){var W=m.stateNode;try{var ne=v.shared.hiddenCallbacks;if(ne!==null)for(v.shared.hiddenCallbacks=null,v=0;v<ne.length;v++)ob(ne[v],W)}catch(_e){Dt(m,m.return,_e)}}u&&z&64&&_v(C),du(C,C.return);break;case 27:wv(C);case 26:case 5:bs(v,C,u),u&&m===null&&z&4&&vv(C),du(C,C.return);break;case 12:bs(v,C,u);break;case 31:bs(v,C,u),u&&z&4&&Av(v,C);break;case 13:bs(v,C,u),u&&z&4&&jv(v,C);break;case 22:C.memoizedState===null&&bs(v,C,u),du(C,C.return);break;case 30:break;default:bs(v,C,u)}a=a.sibling}}function np(i,a){var u=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),i=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(i=a.memoizedState.cachePool.pool),i!==u&&(i!=null&&i.refCount++,u!=null&&Xl(u))}function rp(i,a){i=null,a.alternate!==null&&(i=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==i&&(a.refCount++,i!=null&&Xl(i))}function di(i,a,u,m){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)kv(i,a,u,m),a=a.sibling}function kv(i,a,u,m){var v=a.flags;switch(a.tag){case 0:case 11:case 15:di(i,a,u,m),v&2048&&uu(9,a);break;case 1:di(i,a,u,m);break;case 3:di(i,a,u,m),v&2048&&(i=null,a.alternate!==null&&(i=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==i&&(a.refCount++,i!=null&&Xl(i)));break;case 12:if(v&2048){di(i,a,u,m),i=a.stateNode;try{var C=a.memoizedProps,z=C.id,W=C.onPostCommit;typeof W=="function"&&W(z,a.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(ne){Dt(a,a.return,ne)}}else di(i,a,u,m);break;case 31:di(i,a,u,m);break;case 13:di(i,a,u,m);break;case 23:break;case 22:C=a.stateNode,z=a.alternate,a.memoizedState!==null?C._visibility&2?di(i,a,u,m):hu(i,a):C._visibility&2?di(i,a,u,m):(C._visibility|=2,Rc(i,a,u,m,(a.subtreeFlags&10256)!==0||!1)),v&2048&&np(z,a);break;case 24:di(i,a,u,m),v&2048&&rp(a.alternate,a);break;default:di(i,a,u,m)}}function Rc(i,a,u,m,v){for(v=v&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var C=i,z=a,W=u,ne=m,_e=z.flags;switch(z.tag){case 0:case 11:case 15:Rc(C,z,W,ne,v),uu(8,z);break;case 23:break;case 22:var je=z.stateNode;z.memoizedState!==null?je._visibility&2?Rc(C,z,W,ne,v):hu(C,z):(je._visibility|=2,Rc(C,z,W,ne,v)),v&&_e&2048&&np(z.alternate,z);break;case 24:Rc(C,z,W,ne,v),v&&_e&2048&&rp(z.alternate,z);break;default:Rc(C,z,W,ne,v)}a=a.sibling}}function hu(i,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var u=i,m=a,v=m.flags;switch(m.tag){case 22:hu(u,m),v&2048&&np(m.alternate,m);break;case 24:hu(u,m),v&2048&&rp(m.alternate,m);break;default:hu(u,m)}a=a.sibling}}var fu=8192;function Ic(i,a,u){if(i.subtreeFlags&fu)for(i=i.child;i!==null;)Dv(i,a,u),i=i.sibling}function Dv(i,a,u){switch(i.tag){case 26:Ic(i,a,u),i.flags&fu&&i.memoizedState!==null&&iR(u,ui,i.memoizedState,i.memoizedProps);break;case 5:Ic(i,a,u);break;case 3:case 4:var m=ui;ui=Uh(i.stateNode.containerInfo),Ic(i,a,u),ui=m;break;case 22:i.memoizedState===null&&(m=i.alternate,m!==null&&m.memoizedState!==null?(m=fu,fu=16777216,Ic(i,a,u),fu=m):Ic(i,a,u));break;default:Ic(i,a,u)}}function Mv(i){var a=i.alternate;if(a!==null&&(i=a.child,i!==null)){a.child=null;do a=i.sibling,i.sibling=null,i=a;while(i!==null)}}function mu(i){var a=i.deletions;if((i.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var m=a[u];Nn=m,Nv(m,i)}Mv(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Ov(i),i=i.sibling}function Ov(i){switch(i.tag){case 0:case 11:case 15:mu(i),i.flags&2048&&ca(9,i,i.return);break;case 3:mu(i);break;case 12:mu(i);break;case 22:var a=i.stateNode;i.memoizedState!==null&&a._visibility&2&&(i.return===null||i.return.tag!==13)?(a._visibility&=-3,Ah(i)):mu(i);break;default:mu(i)}}function Ah(i){var a=i.deletions;if((i.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var m=a[u];Nn=m,Nv(m,i)}Mv(i)}for(i=i.child;i!==null;){switch(a=i,a.tag){case 0:case 11:case 15:ca(8,a,a.return),Ah(a);break;case 22:u=a.stateNode,u._visibility&2&&(u._visibility&=-3,Ah(a));break;default:Ah(a)}i=i.sibling}}function Nv(i,a){for(;Nn!==null;){var u=Nn;switch(u.tag){case 0:case 11:case 15:ca(8,u,a);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var m=u.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Xl(u.memoizedState.cache)}if(m=u.child,m!==null)m.return=u,Nn=m;else e:for(u=i;Nn!==null;){m=Nn;var v=m.sibling,C=m.return;if(Ev(m),m===u){Nn=null;break e}if(v!==null){v.return=C,Nn=v;break e}Nn=C}}}var bj={getCacheForType:function(i){var a=Un(pn),u=a.data.get(i);return u===void 0&&(u=i(),a.data.set(i,u)),u},cacheSignal:function(){return Un(pn).controller.signal}},vj=typeof WeakMap=="function"?WeakMap:Map,At=0,Lt=null,ut=null,ft=0,kt=0,Ir=null,la=!1,kc=!1,ip=!1,vs=0,sn=0,ua=0,To=0,sp=0,kr=0,Dc=0,gu=null,yr=null,ap=!1,jh=0,Bv=0,Rh=1/0,Ih=null,da=null,An=0,ha=null,Mc=null,xs=0,op=0,cp=null,Pv=null,pu=0,lp=null;function Dr(){return(At&2)!==0&&ft!==0?ft&-ft:K.T!==null?gp():kd()}function zv(){if(kr===0)if((ft&536870912)===0||_t){var i=xi;xi<<=1,(xi&3932160)===0&&(xi=262144),kr=i}else kr=536870912;return i=jr.current,i!==null&&(i.flags|=32),kr}function _r(i,a,u){(i===Lt&&(kt===2||kt===9)||i.cancelPendingCommit!==null)&&(Oc(i,0),fa(i,ft,kr,!1)),Ja(i,u),((At&2)===0||i!==Lt)&&(i===Lt&&((At&2)===0&&(To|=u),sn===4&&fa(i,ft,kr,!1)),Ui(i))}function Lv(i,a,u){if((At&6)!==0)throw Error(r(327));var m=!u&&(a&127)===0&&(a&i.expiredLanes)===0||ti(i,a),v=m?Sj(i,a):dp(i,a,!0),C=m;do{if(v===0){kc&&!m&&fa(i,a,0,!1);break}else{if(u=i.current.alternate,C&&!xj(u)){v=dp(i,a,!1),C=!1;continue}if(v===2){if(C=a,i.errorRecoveryDisabledLanes&C)var z=0;else z=i.pendingLanes&-536870913,z=z!==0?z:z&536870912?536870912:0;if(z!==0){a=z;e:{var W=i;v=gu;var ne=W.current.memoizedState.isDehydrated;if(ne&&(Oc(W,z).flags|=256),z=dp(W,z,!1),z!==2){if(ip&&!ne){W.errorRecoveryDisabledLanes|=C,To|=C,v=4;break e}C=yr,yr=v,C!==null&&(yr===null?yr=C:yr.push.apply(yr,C))}v=z}if(C=!1,v!==2)continue}}if(v===1){Oc(i,0),fa(i,a,0,!0);break}e:{switch(m=i,C=v,C){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:fa(m,a,kr,!la);break e;case 2:yr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(v=jh+300-Ae(),10<v)){if(fa(m,a,kr,!la),wi(m,0,!0)!==0)break e;xs=a,m.timeoutHandle=px(Uv.bind(null,m,u,yr,Ih,ap,a,kr,To,Dc,la,C,"Throttled",-0,0),v);break e}Uv(m,u,yr,Ih,ap,a,kr,To,Dc,la,C,null,-0,0)}}break}while(!0);Ui(i)}function Uv(i,a,u,m,v,C,z,W,ne,_e,je,De,be,we){if(i.timeoutHandle=-1,De=a.subtreeFlags,De&8192||(De&16785408)===16785408){De={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ii},Dv(a,C,De);var Ve=(C&62914560)===C?jh-Ae():(C&4194048)===C?Bv-Ae():0;if(Ve=sR(De,Ve),Ve!==null){xs=C,i.cancelPendingCommit=Ve(Qv.bind(null,i,a,C,u,m,v,z,W,ne,je,De,null,be,we)),fa(i,C,z,!_e);return}}Qv(i,a,C,u,m,v,z,W,ne)}function xj(i){for(var a=i;;){var u=a.tag;if((u===0||u===11||u===15)&&a.flags&16384&&(u=a.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var m=0;m<u.length;m++){var v=u[m],C=v.getSnapshot;v=v.value;try{if(!Tr(C(),v))return!1}catch{return!1}}if(u=a.child,a.subtreeFlags&16384&&u!==null)u.return=a,a=u;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function fa(i,a,u,m){a&=~sp,a&=~To,i.suspendedLanes|=a,i.pingedLanes&=~a,m&&(i.warmLanes|=a),m=i.expirationTimes;for(var v=a;0<v;){var C=31-Et(v),z=1<<C;m[C]=-1,v&=~z}u!==0&&eo(i,u,a)}function kh(){return(At&6)===0?(yu(0),!1):!0}function up(){if(ut!==null){if(kt===0)var i=ut.return;else i=ut,us=yo=null,Tg(i),Cc=null,Jl=0,i=ut;for(;i!==null;)yv(i.alternate,i),i=i.return;ut=null}}function Oc(i,a){var u=i.timeoutHandle;u!==-1&&(i.timeoutHandle=-1,Fj(u)),u=i.cancelPendingCommit,u!==null&&(i.cancelPendingCommit=null,u()),xs=0,up(),Lt=i,ut=u=cs(i.current,null),ft=a,kt=0,Ir=null,la=!1,kc=ti(i,a),ip=!1,Dc=kr=sp=To=ua=sn=0,yr=gu=null,ap=!1,(a&8)!==0&&(a|=a&32);var m=i.entangledLanes;if(m!==0)for(i=i.entanglements,m&=a;0<m;){var v=31-Et(m),C=1<<v;a|=i[v],m&=~C}return vs=a,Zd(),u}function Fv(i,a){ot=null,K.H=ou,a===Sc||a===ah?(a=rb(),kt=3):a===mg?(a=rb(),kt=4):kt=a===Vg?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Ir=a,ut===null&&(sn=1,vh(i,$r(a,i.current)))}function Vv(){var i=jr.current;return i===null?!0:(ft&4194048)===ft?Wr===null:(ft&62914560)===ft||(ft&536870912)!==0?i===Wr:!1}function $v(){var i=K.H;return K.H=ou,i===null?ou:i}function Gv(){var i=K.A;return K.A=bj,i}function Dh(){sn=4,la||(ft&4194048)!==ft&&jr.current!==null||(kc=!0),(ua&134217727)===0&&(To&134217727)===0||Lt===null||fa(Lt,ft,kr,!1)}function dp(i,a,u){var m=At;At|=2;var v=$v(),C=Gv();(Lt!==i||ft!==a)&&(Ih=null,Oc(i,a)),a=!1;var z=sn;e:do try{if(kt!==0&&ut!==null){var W=ut,ne=Ir;switch(kt){case 8:up(),z=6;break e;case 3:case 2:case 9:case 6:jr.current===null&&(a=!0);var _e=kt;if(kt=0,Ir=null,Nc(i,W,ne,_e),u&&kc){z=0;break e}break;default:_e=kt,kt=0,Ir=null,Nc(i,W,ne,_e)}}wj(),z=sn;break}catch(je){Fv(i,je)}while(!0);return a&&i.shellSuspendCounter++,us=yo=null,At=m,K.H=v,K.A=C,ut===null&&(Lt=null,ft=0,Zd()),z}function wj(){for(;ut!==null;)qv(ut)}function Sj(i,a){var u=At;At|=2;var m=$v(),v=Gv();Lt!==i||ft!==a?(Ih=null,Rh=Ae()+500,Oc(i,a)):kc=ti(i,a);e:do try{if(kt!==0&&ut!==null){a=ut;var C=Ir;t:switch(kt){case 1:kt=0,Ir=null,Nc(i,a,C,1);break;case 2:case 9:if(tb(C)){kt=0,Ir=null,Hv(a);break}a=function(){kt!==2&&kt!==9||Lt!==i||(kt=7),Ui(i)},C.then(a,a);break e;case 3:kt=7;break e;case 4:kt=5;break e;case 7:tb(C)?(kt=0,Ir=null,Hv(a)):(kt=0,Ir=null,Nc(i,a,C,7));break;case 5:var z=null;switch(ut.tag){case 26:z=ut.memoizedState;case 5:case 27:var W=ut;if(z?kx(z):W.stateNode.complete){kt=0,Ir=null;var ne=W.sibling;if(ne!==null)ut=ne;else{var _e=W.return;_e!==null?(ut=_e,Mh(_e)):ut=null}break t}}kt=0,Ir=null,Nc(i,a,C,5);break;case 6:kt=0,Ir=null,Nc(i,a,C,6);break;case 8:up(),sn=6;break e;default:throw Error(r(462))}}Cj();break}catch(je){Fv(i,je)}while(!0);return us=yo=null,K.H=m,K.A=v,At=u,ut!==null?0:(Lt=null,ft=0,Zd(),sn)}function Cj(){for(;ut!==null&&!de();)qv(ut)}function qv(i){var a=gv(i.alternate,i,vs);i.memoizedProps=i.pendingProps,a===null?Mh(i):ut=a}function Hv(i){var a=i,u=a.alternate;switch(a.tag){case 15:case 0:a=lv(u,a,a.pendingProps,a.type,void 0,ft);break;case 11:a=lv(u,a,a.pendingProps,a.type.render,a.ref,ft);break;case 5:Tg(a);default:yv(u,a),a=ut=G0(a,vs),a=gv(u,a,vs)}i.memoizedProps=i.pendingProps,a===null?Mh(i):ut=a}function Nc(i,a,u,m){us=yo=null,Tg(a),Cc=null,Jl=0;var v=a.return;try{if(hj(i,v,a,u,ft)){sn=1,vh(i,$r(u,i.current)),ut=null;return}}catch(C){if(v!==null)throw ut=v,C;sn=1,vh(i,$r(u,i.current)),ut=null;return}a.flags&32768?(_t||m===1?i=!0:kc||(ft&536870912)!==0?i=!1:(la=i=!0,(m===2||m===9||m===3||m===6)&&(m=jr.current,m!==null&&m.tag===13&&(m.flags|=16384))),Wv(a,i)):Mh(a)}function Mh(i){var a=i;do{if((a.flags&32768)!==0){Wv(a,la);return}i=a.return;var u=gj(a.alternate,a,vs);if(u!==null){ut=u;return}if(a=a.sibling,a!==null){ut=a;return}ut=a=i}while(a!==null);sn===0&&(sn=5)}function Wv(i,a){do{var u=pj(i.alternate,i);if(u!==null){u.flags&=32767,ut=u;return}if(u=i.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!a&&(i=i.sibling,i!==null)){ut=i;return}ut=i=u}while(i!==null);sn=6,ut=null}function Qv(i,a,u,m,v,C,z,W,ne){i.cancelPendingCommit=null;do Oh();while(An!==0);if((At&6)!==0)throw Error(r(327));if(a!==null){if(a===i.current)throw Error(r(177));if(C=a.lanes|a.childLanes,C|=Jm,Gm(i,u,C,z,W,ne),i===Lt&&(ut=Lt=null,ft=0),Mc=a,ha=i,xs=u,op=C,cp=v,Pv=m,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,jj(it,function(){return Jv(),null})):(i.callbackNode=null,i.callbackPriority=0),m=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||m){m=K.T,K.T=null,v=q.p,q.p=2,z=At,At|=4;try{yj(i,a,u)}finally{At=z,q.p=v,K.T=m}}An=1,Kv(),Yv(),Xv()}}function Kv(){if(An===1){An=0;var i=ha,a=Mc,u=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||u){u=K.T,K.T=null;var m=q.p;q.p=2;var v=At;At|=4;try{Rv(a,i);var C=Sp,z=N0(i.containerInfo),W=C.focusedElem,ne=C.selectionRange;if(z!==W&&W&&W.ownerDocument&&O0(W.ownerDocument.documentElement,W)){if(ne!==null&&Qm(W)){var _e=ne.start,je=ne.end;if(je===void 0&&(je=_e),"selectionStart"in W)W.selectionStart=_e,W.selectionEnd=Math.min(je,W.value.length);else{var De=W.ownerDocument||document,be=De&&De.defaultView||window;if(be.getSelection){var we=be.getSelection(),Ve=W.textContent.length,Ke=Math.min(ne.start,Ve),Bt=ne.end===void 0?Ke:Math.min(ne.end,Ve);!we.extend&&Ke>Bt&&(z=Bt,Bt=Ke,Ke=z);var he=M0(W,Ke),ce=M0(W,Bt);if(he&&ce&&(we.rangeCount!==1||we.anchorNode!==he.node||we.anchorOffset!==he.offset||we.focusNode!==ce.node||we.focusOffset!==ce.offset)){var ye=De.createRange();ye.setStart(he.node,he.offset),we.removeAllRanges(),Ke>Bt?(we.addRange(ye),we.extend(ce.node,ce.offset)):(ye.setEnd(ce.node,ce.offset),we.addRange(ye))}}}}for(De=[],we=W;we=we.parentNode;)we.nodeType===1&&De.push({element:we,left:we.scrollLeft,top:we.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<De.length;W++){var Re=De[W];Re.element.scrollLeft=Re.left,Re.element.scrollTop=Re.top}}Hh=!!wp,Sp=wp=null}finally{At=v,q.p=m,K.T=u}}i.current=a,An=2}}function Yv(){if(An===2){An=0;var i=ha,a=Mc,u=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||u){u=K.T,K.T=null;var m=q.p;q.p=2;var v=At;At|=4;try{Cv(i,a.alternate,a)}finally{At=v,q.p=m,K.T=u}}An=3}}function Xv(){if(An===4||An===3){An=0,Ne();var i=ha,a=Mc,u=xs,m=Pv;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?An=5:(An=0,Mc=ha=null,Zv(i,i.pendingLanes));var v=i.pendingLanes;if(v===0&&(da=null),is(u),a=a.stateNode,nn&&typeof nn.onCommitFiberRoot=="function")try{nn.onCommitFiberRoot(xt,a,void 0,(a.current.flags&128)===128)}catch{}if(m!==null){a=K.T,v=q.p,q.p=2,K.T=null;try{for(var C=i.onRecoverableError,z=0;z<m.length;z++){var W=m[z];C(W.value,{componentStack:W.stack})}}finally{K.T=a,q.p=v}}(xs&3)!==0&&Oh(),Ui(i),v=i.pendingLanes,(u&261930)!==0&&(v&42)!==0?i===lp?pu++:(pu=0,lp=i):pu=0,yu(0)}}function Zv(i,a){(i.pooledCacheLanes&=a)===0&&(a=i.pooledCache,a!=null&&(i.pooledCache=null,Xl(a)))}function Oh(){return Kv(),Yv(),Xv(),Jv()}function Jv(){if(An!==5)return!1;var i=ha,a=op;op=0;var u=is(xs),m=K.T,v=q.p;try{q.p=32>u?32:u,K.T=null,u=cp,cp=null;var C=ha,z=xs;if(An=0,Mc=ha=null,xs=0,(At&6)!==0)throw Error(r(331));var W=At;if(At|=4,Ov(C.current),kv(C,C.current,z,u),At=W,yu(0,!1),nn&&typeof nn.onPostCommitFiberRoot=="function")try{nn.onPostCommitFiberRoot(xt,C)}catch{}return!0}finally{q.p=v,K.T=m,Zv(i,a)}}function ex(i,a,u){a=$r(u,a),a=Fg(i.stateNode,a,2),i=sa(i,a,2),i!==null&&(Ja(i,2),Ui(i))}function Dt(i,a,u){if(i.tag===3)ex(i,i,u);else for(;a!==null;){if(a.tag===3){ex(a,i,u);break}else if(a.tag===1){var m=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(da===null||!da.has(m))){i=$r(u,i),u=tv(2),m=sa(a,u,2),m!==null&&(nv(u,m,a,i),Ja(m,2),Ui(m));break}}a=a.return}}function hp(i,a,u){var m=i.pingCache;if(m===null){m=i.pingCache=new vj;var v=new Set;m.set(a,v)}else v=m.get(a),v===void 0&&(v=new Set,m.set(a,v));v.has(u)||(ip=!0,v.add(u),i=Ej.bind(null,i,a,u),a.then(i,i))}function Ej(i,a,u){var m=i.pingCache;m!==null&&m.delete(a),i.pingedLanes|=i.suspendedLanes&u,i.warmLanes&=~u,Lt===i&&(ft&u)===u&&(sn===4||sn===3&&(ft&62914560)===ft&&300>Ae()-jh?(At&2)===0&&Oc(i,0):sp|=u,Dc===ft&&(Dc=0)),Ui(i)}function tx(i,a){a===0&&(a=Id()),i=mo(i,a),i!==null&&(Ja(i,a),Ui(i))}function Tj(i){var a=i.memoizedState,u=0;a!==null&&(u=a.retryLane),tx(i,u)}function Aj(i,a){var u=0;switch(i.tag){case 31:case 13:var m=i.stateNode,v=i.memoizedState;v!==null&&(u=v.retryLane);break;case 19:m=i.stateNode;break;case 22:m=i.stateNode._retryCache;break;default:throw Error(r(314))}m!==null&&m.delete(a),tx(i,u)}function jj(i,a){return Se(i,a)}var Nh=null,Bc=null,fp=!1,Bh=!1,mp=!1,ma=0;function Ui(i){i!==Bc&&i.next===null&&(Bc===null?Nh=Bc=i:Bc=Bc.next=i),Bh=!0,fp||(fp=!0,Ij())}function yu(i,a){if(!mp&&Bh){mp=!0;do for(var u=!1,m=Nh;m!==null;){if(i!==0){var v=m.pendingLanes;if(v===0)var C=0;else{var z=m.suspendedLanes,W=m.pingedLanes;C=(1<<31-Et(42|i)+1)-1,C&=v&~(z&~W),C=C&201326741?C&201326741|1:C?C|2:0}C!==0&&(u=!0,sx(m,C))}else C=ft,C=wi(m,m===Lt?C:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(C&3)===0||ti(m,C)||(u=!0,sx(m,C));m=m.next}while(u);mp=!1}}function Rj(){nx()}function nx(){Bh=fp=!1;var i=0;ma!==0&&Uj()&&(i=ma);for(var a=Ae(),u=null,m=Nh;m!==null;){var v=m.next,C=rx(m,a);C===0?(m.next=null,u===null?Nh=v:u.next=v,v===null&&(Bc=u)):(u=m,(i!==0||(C&3)!==0)&&(Bh=!0)),m=v}An!==0&&An!==5||yu(i),ma!==0&&(ma=0)}function rx(i,a){for(var u=i.suspendedLanes,m=i.pingedLanes,v=i.expirationTimes,C=i.pendingLanes&-62914561;0<C;){var z=31-Et(C),W=1<<z,ne=v[z];ne===-1?((W&u)===0||(W&m)!==0)&&(v[z]=$m(W,a)):ne<=a&&(i.expiredLanes|=W),C&=~W}if(a=Lt,u=ft,u=wi(i,i===a?u:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),m=i.callbackNode,u===0||i===a&&(kt===2||kt===9)||i.cancelPendingCommit!==null)return m!==null&&m!==null&&xe(m),i.callbackNode=null,i.callbackPriority=0;if((u&3)===0||ti(i,u)){if(a=u&-u,a===i.callbackPriority)return a;switch(m!==null&&xe(m),is(u)){case 2:case 8:u=wt;break;case 32:u=it;break;case 268435456:u=bi;break;default:u=it}return m=ix.bind(null,i),u=Se(u,m),i.callbackPriority=a,i.callbackNode=u,a}return m!==null&&m!==null&&xe(m),i.callbackPriority=2,i.callbackNode=null,2}function ix(i,a){if(An!==0&&An!==5)return i.callbackNode=null,i.callbackPriority=0,null;var u=i.callbackNode;if(Oh()&&i.callbackNode!==u)return null;var m=ft;return m=wi(i,i===Lt?m:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),m===0?null:(Lv(i,m,a),rx(i,Ae()),i.callbackNode!=null&&i.callbackNode===u?ix.bind(null,i):null)}function sx(i,a){if(Oh())return null;Lv(i,a,!0)}function Ij(){Vj(function(){(At&6)!==0?Se(qe,Rj):nx()})}function gp(){if(ma===0){var i=xc;i===0&&(i=Pr,Pr<<=1,(Pr&261888)===0&&(Pr=256)),ma=i}return ma}function ax(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:ac(""+i)}function ox(i,a){var u=a.ownerDocument.createElement("input");return u.name=a.name,u.value=a.value,i.id&&u.setAttribute("form",i.id),a.parentNode.insertBefore(u,a),i=new FormData(i),u.parentNode.removeChild(u),i}function kj(i,a,u,m,v){if(a==="submit"&&u&&u.stateNode===v){var C=ax((v[Mn]||null).action),z=m.submitter;z&&(a=(a=z[Mn]||null)?ax(a.formAction):z.getAttribute("formAction"),a!==null&&(C=a,z=null));var W=new Mi("action","action",null,m,v);i.push({event:W,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(ma!==0){var ne=z?ox(v,z):new FormData(v);Ng(u,{pending:!0,data:ne,method:v.method,action:C},null,ne)}}else typeof C=="function"&&(W.preventDefault(),ne=z?ox(v,z):new FormData(v),Ng(u,{pending:!0,data:ne,method:v.method,action:C},C,ne))},currentTarget:v}]})}}for(var pp=0;pp<Zm.length;pp++){var yp=Zm[pp],Dj=yp.toLowerCase(),Mj=yp[0].toUpperCase()+yp.slice(1);li(Dj,"on"+Mj)}li(z0,"onAnimationEnd"),li(L0,"onAnimationIteration"),li(U0,"onAnimationStart"),li("dblclick","onDoubleClick"),li("focusin","onFocus"),li("focusout","onBlur"),li(KA,"onTransitionRun"),li(YA,"onTransitionStart"),li(XA,"onTransitionCancel"),li(F0,"onTransitionEnd"),Ri("onMouseEnter",["mouseout","mouseover"]),Ri("onMouseLeave",["mouseout","mouseover"]),Ri("onPointerEnter",["pointerout","pointerover"]),Ri("onPointerLeave",["pointerout","pointerover"]),ji("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ji("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ji("onBeforeInput",["compositionend","keypress","textInput","paste"]),ji("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ji("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ji("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _u="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oj=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(_u));function cx(i,a){a=(a&4)!==0;for(var u=0;u<i.length;u++){var m=i[u],v=m.event;m=m.listeners;e:{var C=void 0;if(a)for(var z=m.length-1;0<=z;z--){var W=m[z],ne=W.instance,_e=W.currentTarget;if(W=W.listener,ne!==C&&v.isPropagationStopped())break e;C=W,v.currentTarget=_e;try{C(v)}catch(je){Xd(je)}v.currentTarget=null,C=ne}else for(z=0;z<m.length;z++){if(W=m[z],ne=W.instance,_e=W.currentTarget,W=W.listener,ne!==C&&v.isPropagationStopped())break e;C=W,v.currentTarget=_e;try{C(v)}catch(je){Xd(je)}v.currentTarget=null,C=ne}}}}function dt(i,a){var u=a[tc];u===void 0&&(u=a[tc]=new Set);var m=i+"__bubble";u.has(m)||(lx(a,i,2,!1),u.add(m))}function _p(i,a,u){var m=0;a&&(m|=4),lx(u,i,m,a)}var Ph="_reactListening"+Math.random().toString(36).slice(2);function bp(i){if(!i[Ph]){i[Ph]=!0,Il.forEach(function(u){u!=="selectionchange"&&(Oj.has(u)||_p(u,!1,i),_p(u,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[Ph]||(a[Ph]=!0,_p("selectionchange",!1,a))}}function lx(i,a,u,m){switch(zx(a)){case 2:var v=cR;break;case 8:v=lR;break;default:v=Op}u=v.bind(null,a,u,i),v=void 0,!so||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(v=!0),m?v!==void 0?i.addEventListener(a,u,{capture:!0,passive:v}):i.addEventListener(a,u,!0):v!==void 0?i.addEventListener(a,u,{passive:v}):i.addEventListener(a,u,!1)}function vp(i,a,u,m,v){var C=m;if((a&1)===0&&(a&2)===0&&m!==null)e:for(;;){if(m===null)return;var z=m.tag;if(z===3||z===4){var W=m.stateNode.containerInfo;if(W===v)break;if(z===4)for(z=m.return;z!==null;){var ne=z.tag;if((ne===3||ne===4)&&z.stateNode.containerInfo===v)return;z=z.return}for(;W!==null;){if(z=Ti(W),z===null)return;if(ne=z.tag,ne===5||ne===6||ne===26||ne===27){m=C=z;continue e}W=W.parentNode}}m=m.return}Ks(function(){var _e=C,je=Lr(u),De=[];e:{var be=V0.get(i);if(be!==void 0){var we=Mi,Ve=i;switch(i){case"keypress":if(oo(u)===0)break e;case"keydown":case"keyup":we=Qd;break;case"focusin":Ve="focus",we=lo;break;case"focusout":Ve="blur",we=lo;break;case"beforeblur":case"afterblur":we=lo;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":we=$l;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":we=Ld;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":we=I;break;case z0:case L0:case U0:we=Fd;break;case F0:we=Y;break;case"scroll":case"scrollend":we=Vl;break;case"wheel":we=ve;break;case"copy":case"cut":case"paste":we=Vd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":we=os;break;case"toggle":case"beforetoggle":we=at}var Ke=(a&4)!==0,Bt=!Ke&&(i==="scroll"||i==="scrollend"),he=Ke?be!==null?be+"Capture":null:be;Ke=[];for(var ce=_e,ye;ce!==null;){var Re=ce;if(ye=Re.stateNode,Re=Re.tag,Re!==5&&Re!==26&&Re!==27||ye===null||he===null||(Re=si(ce,he),Re!=null&&Ke.push(bu(ce,Re,ye))),Bt)break;ce=ce.return}0<Ke.length&&(be=new we(be,Ve,null,u,je),De.push({event:be,listeners:Ke}))}}if((a&7)===0){e:{if(be=i==="mouseover"||i==="pointerover",we=i==="mouseout"||i==="pointerout",be&&u!==Ll&&(Ve=u.relatedTarget||u.fromElement)&&(Ti(Ve)||Ve[Ci]))break e;if((we||be)&&(be=je.window===je?je:(be=je.ownerDocument)?be.defaultView||be.parentWindow:window,we?(Ve=u.relatedTarget||u.toElement,we=_e,Ve=Ve?Ti(Ve):null,Ve!==null&&(Bt=o(Ve),Ke=Ve.tag,Ve!==Bt||Ke!==5&&Ke!==27&&Ke!==6)&&(Ve=null)):(we=null,Ve=_e),we!==Ve)){if(Ke=$l,Re="onMouseLeave",he="onMouseEnter",ce="mouse",(i==="pointerout"||i==="pointerover")&&(Ke=os,Re="onPointerLeave",he="onPointerEnter",ce="pointer"),Bt=we==null?be:Cr(we),ye=Ve==null?be:Cr(Ve),be=new Ke(Re,ce+"leave",we,u,je),be.target=Bt,be.relatedTarget=ye,Re=null,Ti(je)===_e&&(Ke=new Ke(he,ce+"enter",Ve,u,je),Ke.target=ye,Ke.relatedTarget=Bt,Re=Ke),Bt=Re,we&&Ve)t:{for(Ke=Nj,he=we,ce=Ve,ye=0,Re=he;Re;Re=Ke(Re))ye++;Re=0;for(var He=ce;He;He=Ke(He))Re++;for(;0<ye-Re;)he=Ke(he),ye--;for(;0<Re-ye;)ce=Ke(ce),Re--;for(;ye--;){if(he===ce||ce!==null&&he===ce.alternate){Ke=he;break t}he=Ke(he),ce=Ke(ce)}Ke=null}else Ke=null;we!==null&&ux(De,be,we,Ke,!1),Ve!==null&&Bt!==null&&ux(De,Bt,Ve,Ke,!0)}}e:{if(be=_e?Cr(_e):window,we=be.nodeName&&be.nodeName.toLowerCase(),we==="select"||we==="input"&&be.type==="file")var St=A0;else if(E0(be))if(j0)St=HA;else{St=GA;var $e=$A}else we=be.nodeName,!we||we.toLowerCase()!=="input"||be.type!=="checkbox"&&be.type!=="radio"?_e&&sc(_e.elementType)&&(St=A0):St=qA;if(St&&(St=St(i,_e))){T0(De,St,u,je);break e}$e&&$e(i,be,_e),i==="focusout"&&_e&&be.type==="number"&&_e.memoizedProps.value!=null&&Bl(be,"number",be.value)}switch($e=_e?Cr(_e):window,i){case"focusin":(E0($e)||$e.contentEditable==="true")&&(fc=$e,Km=_e,Ql=null);break;case"focusout":Ql=Km=fc=null;break;case"mousedown":Ym=!0;break;case"contextmenu":case"mouseup":case"dragend":Ym=!1,B0(De,u,je);break;case"selectionchange":if(QA)break;case"keydown":case"keyup":B0(De,u,je)}var ct;if(Tt)e:{switch(i){case"compositionstart":var mt="onCompositionStart";break e;case"compositionend":mt="onCompositionEnd";break e;case"compositionupdate":mt="onCompositionUpdate";break e}mt=void 0}else hc?uo(i,u)&&(mt="onCompositionEnd"):i==="keydown"&&u.keyCode===229&&(mt="onCompositionStart");mt&&(Bi&&u.locale!=="ko"&&(hc||mt!=="onCompositionStart"?mt==="onCompositionEnd"&&hc&&(ct=Fl()):(Di=je,Ul="value"in Di?Di.value:Di.textContent,hc=!0)),$e=zh(_e,mt),0<$e.length&&(mt=new Ni(mt,i,null,u,je),De.push({event:mt,listeners:$e}),ct?mt.data=ct:(ct=dc(u),ct!==null&&(mt.data=ct)))),(ct=Fr?LA(i,u):UA(i,u))&&(mt=zh(_e,"onBeforeInput"),0<mt.length&&($e=new Ni("onBeforeInput","beforeinput",null,u,je),De.push({event:$e,listeners:mt}),$e.data=ct)),kj(De,i,_e,u,je)}cx(De,a)})}function bu(i,a,u){return{instance:i,listener:a,currentTarget:u}}function zh(i,a){for(var u=a+"Capture",m=[];i!==null;){var v=i,C=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||C===null||(v=si(i,u),v!=null&&m.unshift(bu(i,v,C)),v=si(i,a),v!=null&&m.push(bu(i,v,C))),i.tag===3)return m;i=i.return}return[]}function Nj(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function ux(i,a,u,m,v){for(var C=a._reactName,z=[];u!==null&&u!==m;){var W=u,ne=W.alternate,_e=W.stateNode;if(W=W.tag,ne!==null&&ne===m)break;W!==5&&W!==26&&W!==27||_e===null||(ne=_e,v?(_e=si(u,C),_e!=null&&z.unshift(bu(u,_e,ne))):v||(_e=si(u,C),_e!=null&&z.push(bu(u,_e,ne)))),u=u.return}z.length!==0&&i.push({event:a,listeners:z})}var Bj=/\r\n?/g,Pj=/\u0000|\uFFFD/g;function dx(i){return(typeof i=="string"?i:""+i).replace(Bj,`
`).replace(Pj,"")}function hx(i,a){return a=dx(a),dx(i)===a}function Nt(i,a,u,m,v,C){switch(u){case"children":typeof m=="string"?a==="body"||a==="textarea"&&m===""||fr(i,m):(typeof m=="number"||typeof m=="bigint")&&a!=="body"&&fr(i,""+m);break;case"className":Er(i,"class",m);break;case"tabIndex":Er(i,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":Er(i,u,m);break;case"style":zl(i,m,C);break;case"data":if(a!=="object"){Er(i,"data",m);break}case"src":case"href":if(m===""&&(a!=="a"||u!=="href")){i.removeAttribute(u);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){i.removeAttribute(u);break}m=ac(""+m),i.setAttribute(u,m);break;case"action":case"formAction":if(typeof m=="function"){i.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(u==="formAction"?(a!=="input"&&Nt(i,a,"name",v.name,v,null),Nt(i,a,"formEncType",v.formEncType,v,null),Nt(i,a,"formMethod",v.formMethod,v,null),Nt(i,a,"formTarget",v.formTarget,v,null)):(Nt(i,a,"encType",v.encType,v,null),Nt(i,a,"method",v.method,v,null),Nt(i,a,"target",v.target,v,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){i.removeAttribute(u);break}m=ac(""+m),i.setAttribute(u,m);break;case"onClick":m!=null&&(i.onclick=ii);break;case"onScroll":m!=null&&dt("scroll",i);break;case"onScrollEnd":m!=null&&dt("scrollend",i);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(u=m.__html,u!=null){if(v.children!=null)throw Error(r(60));i.innerHTML=u}}break;case"multiple":i.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":i.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){i.removeAttribute("xlink:href");break}u=ac(""+m),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?i.setAttribute(u,""+m):i.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?i.setAttribute(u,""):i.removeAttribute(u);break;case"capture":case"download":m===!0?i.setAttribute(u,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?i.setAttribute(u,m):i.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?i.setAttribute(u,m):i.removeAttribute(u);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?i.removeAttribute(u):i.setAttribute(u,m);break;case"popover":dt("beforetoggle",i),dt("toggle",i),rc(i,"popover",m);break;case"xlinkActuate":gn(i,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":gn(i,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":gn(i,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":gn(i,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":gn(i,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":gn(i,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":gn(i,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":gn(i,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":gn(i,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":rc(i,"is",m);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=zd.get(u)||u,rc(i,u,m))}}function xp(i,a,u,m,v,C){switch(u){case"style":zl(i,m,C);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(u=m.__html,u!=null){if(v.children!=null)throw Error(r(60));i.innerHTML=u}}break;case"children":typeof m=="string"?fr(i,m):(typeof m=="number"||typeof m=="bigint")&&fr(i,""+m);break;case"onScroll":m!=null&&dt("scroll",i);break;case"onScrollEnd":m!=null&&dt("scrollend",i);break;case"onClick":m!=null&&(i.onclick=ii);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!kl.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(v=u.endsWith("Capture"),a=u.slice(2,v?u.length-7:void 0),C=i[Mn]||null,C=C!=null?C[u]:null,typeof C=="function"&&i.removeEventListener(a,C,v),typeof m=="function")){typeof C!="function"&&C!==null&&(u in i?i[u]=null:i.hasAttribute(u)&&i.removeAttribute(u)),i.addEventListener(a,m,v);break e}u in i?i[u]=m:m===!0?i.setAttribute(u,""):rc(i,u,m)}}}function Vn(i,a,u){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":dt("error",i),dt("load",i);var m=!1,v=!1,C;for(C in u)if(u.hasOwnProperty(C)){var z=u[C];if(z!=null)switch(C){case"src":m=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Nt(i,a,C,z,u,null)}}v&&Nt(i,a,"srcSet",u.srcSet,u,null),m&&Nt(i,a,"src",u.src,u,null);return;case"input":dt("invalid",i);var W=C=z=v=null,ne=null,_e=null;for(m in u)if(u.hasOwnProperty(m)){var je=u[m];if(je!=null)switch(m){case"name":v=je;break;case"type":z=je;break;case"checked":ne=je;break;case"defaultChecked":_e=je;break;case"value":C=je;break;case"defaultValue":W=je;break;case"children":case"dangerouslySetInnerHTML":if(je!=null)throw Error(r(137,a));break;default:Nt(i,a,m,je,u,null)}}Nd(i,C,W,ne,_e,z,v,!1);return;case"select":dt("invalid",i),m=z=C=null;for(v in u)if(u.hasOwnProperty(v)&&(W=u[v],W!=null))switch(v){case"value":C=W;break;case"defaultValue":z=W;break;case"multiple":m=W;default:Nt(i,a,v,W,u,null)}a=C,u=z,i.multiple=!!m,a!=null?qs(i,!!m,a,!1):u!=null&&qs(i,!!m,u,!0);return;case"textarea":dt("invalid",i),C=v=m=null;for(z in u)if(u.hasOwnProperty(z)&&(W=u[z],W!=null))switch(z){case"value":m=W;break;case"defaultValue":v=W;break;case"children":C=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(r(91));break;default:Nt(i,a,z,W,u,null)}Hs(i,m,v,C);return;case"option":for(ne in u)u.hasOwnProperty(ne)&&(m=u[ne],m!=null)&&(ne==="selected"?i.selected=m&&typeof m!="function"&&typeof m!="symbol":Nt(i,a,ne,m,u,null));return;case"dialog":dt("beforetoggle",i),dt("toggle",i),dt("cancel",i),dt("close",i);break;case"iframe":case"object":dt("load",i);break;case"video":case"audio":for(m=0;m<_u.length;m++)dt(_u[m],i);break;case"image":dt("error",i),dt("load",i);break;case"details":dt("toggle",i);break;case"embed":case"source":case"link":dt("error",i),dt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(_e in u)if(u.hasOwnProperty(_e)&&(m=u[_e],m!=null))switch(_e){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:Nt(i,a,_e,m,u,null)}return;default:if(sc(a)){for(je in u)u.hasOwnProperty(je)&&(m=u[je],m!==void 0&&xp(i,a,je,m,u,void 0));return}}for(W in u)u.hasOwnProperty(W)&&(m=u[W],m!=null&&Nt(i,a,W,m,u,null))}function zj(i,a,u,m){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,C=null,z=null,W=null,ne=null,_e=null,je=null;for(we in u){var De=u[we];if(u.hasOwnProperty(we)&&De!=null)switch(we){case"checked":break;case"value":break;case"defaultValue":ne=De;default:m.hasOwnProperty(we)||Nt(i,a,we,null,m,De)}}for(var be in m){var we=m[be];if(De=u[be],m.hasOwnProperty(be)&&(we!=null||De!=null))switch(be){case"type":C=we;break;case"name":v=we;break;case"checked":_e=we;break;case"defaultChecked":je=we;break;case"value":z=we;break;case"defaultValue":W=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(r(137,a));break;default:we!==De&&Nt(i,a,be,we,m,De)}}ic(i,z,W,ne,_e,je,C,v);return;case"select":we=z=W=be=null;for(C in u)if(ne=u[C],u.hasOwnProperty(C)&&ne!=null)switch(C){case"value":break;case"multiple":we=ne;default:m.hasOwnProperty(C)||Nt(i,a,C,null,m,ne)}for(v in m)if(C=m[v],ne=u[v],m.hasOwnProperty(v)&&(C!=null||ne!=null))switch(v){case"value":be=C;break;case"defaultValue":W=C;break;case"multiple":z=C;default:C!==ne&&Nt(i,a,v,C,m,ne)}a=W,u=z,m=we,be!=null?qs(i,!!u,be,!1):!!m!=!!u&&(a!=null?qs(i,!!u,a,!0):qs(i,!!u,u?[]:"",!1));return;case"textarea":we=be=null;for(W in u)if(v=u[W],u.hasOwnProperty(W)&&v!=null&&!m.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:Nt(i,a,W,null,m,v)}for(z in m)if(v=m[z],C=u[z],m.hasOwnProperty(z)&&(v!=null||C!=null))switch(z){case"value":be=v;break;case"defaultValue":we=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==C&&Nt(i,a,z,v,m,C)}Bd(i,be,we);return;case"option":for(var Ve in u)be=u[Ve],u.hasOwnProperty(Ve)&&be!=null&&!m.hasOwnProperty(Ve)&&(Ve==="selected"?i.selected=!1:Nt(i,a,Ve,null,m,be));for(ne in m)be=m[ne],we=u[ne],m.hasOwnProperty(ne)&&be!==we&&(be!=null||we!=null)&&(ne==="selected"?i.selected=be&&typeof be!="function"&&typeof be!="symbol":Nt(i,a,ne,be,m,we));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ke in u)be=u[Ke],u.hasOwnProperty(Ke)&&be!=null&&!m.hasOwnProperty(Ke)&&Nt(i,a,Ke,null,m,be);for(_e in m)if(be=m[_e],we=u[_e],m.hasOwnProperty(_e)&&be!==we&&(be!=null||we!=null))switch(_e){case"children":case"dangerouslySetInnerHTML":if(be!=null)throw Error(r(137,a));break;default:Nt(i,a,_e,be,m,we)}return;default:if(sc(a)){for(var Bt in u)be=u[Bt],u.hasOwnProperty(Bt)&&be!==void 0&&!m.hasOwnProperty(Bt)&&xp(i,a,Bt,void 0,m,be);for(je in m)be=m[je],we=u[je],!m.hasOwnProperty(je)||be===we||be===void 0&&we===void 0||xp(i,a,je,be,m,we);return}}for(var he in u)be=u[he],u.hasOwnProperty(he)&&be!=null&&!m.hasOwnProperty(he)&&Nt(i,a,he,null,m,be);for(De in m)be=m[De],we=u[De],!m.hasOwnProperty(De)||be===we||be==null&&we==null||Nt(i,a,De,be,m,we)}function fx(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Lj(){if(typeof performance.getEntriesByType=="function"){for(var i=0,a=0,u=performance.getEntriesByType("resource"),m=0;m<u.length;m++){var v=u[m],C=v.transferSize,z=v.initiatorType,W=v.duration;if(C&&W&&fx(z)){for(z=0,W=v.responseEnd,m+=1;m<u.length;m++){var ne=u[m],_e=ne.startTime;if(_e>W)break;var je=ne.transferSize,De=ne.initiatorType;je&&fx(De)&&(ne=ne.responseEnd,z+=je*(ne<W?1:(W-_e)/(ne-_e)))}if(--m,a+=8*(C+z)/(v.duration/1e3),i++,10<i)break}}if(0<i)return a/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var wp=null,Sp=null;function Lh(i){return i.nodeType===9?i:i.ownerDocument}function mx(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function gx(i,a){if(i===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&a==="foreignObject"?0:i}function Cp(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Ep=null;function Uj(){var i=window.event;return i&&i.type==="popstate"?i===Ep?!1:(Ep=i,!0):(Ep=null,!1)}var px=typeof setTimeout=="function"?setTimeout:void 0,Fj=typeof clearTimeout=="function"?clearTimeout:void 0,yx=typeof Promise=="function"?Promise:void 0,Vj=typeof queueMicrotask=="function"?queueMicrotask:typeof yx<"u"?function(i){return yx.resolve(null).then(i).catch($j)}:px;function $j(i){setTimeout(function(){throw i})}function ga(i){return i==="head"}function _x(i,a){var u=a,m=0;do{var v=u.nextSibling;if(i.removeChild(u),v&&v.nodeType===8)if(u=v.data,u==="/$"||u==="/&"){if(m===0){i.removeChild(v),Uc(a);return}m--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")m++;else if(u==="html")vu(i.ownerDocument.documentElement);else if(u==="head"){u=i.ownerDocument.head,vu(u);for(var C=u.firstChild;C;){var z=C.nextSibling,W=C.nodeName;C[Ei]||W==="SCRIPT"||W==="STYLE"||W==="LINK"&&C.rel.toLowerCase()==="stylesheet"||u.removeChild(C),C=z}}else u==="body"&&vu(i.ownerDocument.body);u=v}while(u);Uc(a)}function bx(i,a){var u=i;i=0;do{var m=u.nextSibling;if(u.nodeType===1?a?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(a?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),m&&m.nodeType===8)if(u=m.data,u==="/$"){if(i===0)break;i--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||i++;u=m}while(u)}function Tp(i){var a=i.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var u=a;switch(a=a.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Tp(u),nc(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}i.removeChild(u)}}function Gj(i,a,u,m){for(;i.nodeType===1;){var v=u;if(i.nodeName.toLowerCase()!==a.toLowerCase()){if(!m&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(m){if(!i[Ei])switch(a){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(C=i.getAttribute("rel"),C==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(C!==v.rel||i.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||i.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||i.getAttribute("title")!==(v.title==null?null:v.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(C=i.getAttribute("src"),(C!==(v.src==null?null:v.src)||i.getAttribute("type")!==(v.type==null?null:v.type)||i.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&C&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(a==="input"&&i.type==="hidden"){var C=v.name==null?null:""+v.name;if(v.type==="hidden"&&i.getAttribute("name")===C)return i}else return i;if(i=Qr(i.nextSibling),i===null)break}return null}function qj(i,a,u){if(a==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!u||(i=Qr(i.nextSibling),i===null))return null;return i}function vx(i,a){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!a||(i=Qr(i.nextSibling),i===null))return null;return i}function Ap(i){return i.data==="$?"||i.data==="$~"}function jp(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function Hj(i,a){var u=i.ownerDocument;if(i.data==="$~")i._reactRetry=a;else if(i.data!=="$?"||u.readyState!=="loading")a();else{var m=function(){a(),u.removeEventListener("DOMContentLoaded",m)};u.addEventListener("DOMContentLoaded",m),i._reactRetry=m}}function Qr(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return i}var Rp=null;function xx(i){i=i.nextSibling;for(var a=0;i;){if(i.nodeType===8){var u=i.data;if(u==="/$"||u==="/&"){if(a===0)return Qr(i.nextSibling);a--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||a++}i=i.nextSibling}return null}function wx(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var u=i.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(a===0)return i;a--}else u!=="/$"&&u!=="/&"||a++}i=i.previousSibling}return null}function Sx(i,a,u){switch(a=Lh(u),i){case"html":if(i=a.documentElement,!i)throw Error(r(452));return i;case"head":if(i=a.head,!i)throw Error(r(453));return i;case"body":if(i=a.body,!i)throw Error(r(454));return i;default:throw Error(r(451))}}function vu(i){for(var a=i.attributes;a.length;)i.removeAttributeNode(a[0]);nc(i)}var Kr=new Map,Cx=new Set;function Uh(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var ws=q.d;q.d={f:Wj,r:Qj,D:Kj,C:Yj,L:Xj,m:Zj,X:eR,S:Jj,M:tR};function Wj(){var i=ws.f(),a=kh();return i||a}function Qj(i){var a=zr(i);a!==null&&a.tag===5&&a.type==="form"?Fb(a):ws.r(i)}var Pc=typeof document>"u"?null:document;function Ex(i,a,u){var m=Pc;if(m&&typeof a=="string"&&a){var v=hr(a);v='link[rel="'+i+'"][href="'+v+'"]',typeof u=="string"&&(v+='[crossorigin="'+u+'"]'),Cx.has(v)||(Cx.add(v),i={rel:i,crossOrigin:u,href:a},m.querySelector(v)===null&&(a=m.createElement("link"),Vn(a,"link",i),mn(a),m.head.appendChild(a)))}}function Kj(i){ws.D(i),Ex("dns-prefetch",i,null)}function Yj(i,a){ws.C(i,a),Ex("preconnect",i,a)}function Xj(i,a,u){ws.L(i,a,u);var m=Pc;if(m&&i&&a){var v='link[rel="preload"][as="'+hr(a)+'"]';a==="image"&&u&&u.imageSrcSet?(v+='[imagesrcset="'+hr(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(v+='[imagesizes="'+hr(u.imageSizes)+'"]')):v+='[href="'+hr(i)+'"]';var C=v;switch(a){case"style":C=zc(i);break;case"script":C=Lc(i)}Kr.has(C)||(i=g({rel:"preload",href:a==="image"&&u&&u.imageSrcSet?void 0:i,as:a},u),Kr.set(C,i),m.querySelector(v)!==null||a==="style"&&m.querySelector(xu(C))||a==="script"&&m.querySelector(wu(C))||(a=m.createElement("link"),Vn(a,"link",i),mn(a),m.head.appendChild(a)))}}function Zj(i,a){ws.m(i,a);var u=Pc;if(u&&i){var m=a&&typeof a.as=="string"?a.as:"script",v='link[rel="modulepreload"][as="'+hr(m)+'"][href="'+hr(i)+'"]',C=v;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=Lc(i)}if(!Kr.has(C)&&(i=g({rel:"modulepreload",href:i},a),Kr.set(C,i),u.querySelector(v)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(wu(C)))return}m=u.createElement("link"),Vn(m,"link",i),mn(m),u.head.appendChild(m)}}}function Jj(i,a,u){ws.S(i,a,u);var m=Pc;if(m&&i){var v=Ai(m).hoistableStyles,C=zc(i);a=a||"default";var z=v.get(C);if(!z){var W={loading:0,preload:null};if(z=m.querySelector(xu(C)))W.loading=5;else{i=g({rel:"stylesheet",href:i,"data-precedence":a},u),(u=Kr.get(C))&&Ip(i,u);var ne=z=m.createElement("link");mn(ne),Vn(ne,"link",i),ne._p=new Promise(function(_e,je){ne.onload=_e,ne.onerror=je}),ne.addEventListener("load",function(){W.loading|=1}),ne.addEventListener("error",function(){W.loading|=2}),W.loading|=4,Fh(z,a,m)}z={type:"stylesheet",instance:z,count:1,state:W},v.set(C,z)}}}function eR(i,a){ws.X(i,a);var u=Pc;if(u&&i){var m=Ai(u).hoistableScripts,v=Lc(i),C=m.get(v);C||(C=u.querySelector(wu(v)),C||(i=g({src:i,async:!0},a),(a=Kr.get(v))&&kp(i,a),C=u.createElement("script"),mn(C),Vn(C,"link",i),u.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},m.set(v,C))}}function tR(i,a){ws.M(i,a);var u=Pc;if(u&&i){var m=Ai(u).hoistableScripts,v=Lc(i),C=m.get(v);C||(C=u.querySelector(wu(v)),C||(i=g({src:i,async:!0,type:"module"},a),(a=Kr.get(v))&&kp(i,a),C=u.createElement("script"),mn(C),Vn(C,"link",i),u.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},m.set(v,C))}}function Tx(i,a,u,m){var v=(v=ge.current)?Uh(v):null;if(!v)throw Error(r(446));switch(i){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(a=zc(u.href),u=Ai(v).hoistableStyles,m=u.get(a),m||(m={type:"style",instance:null,count:0,state:null},u.set(a,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){i=zc(u.href);var C=Ai(v).hoistableStyles,z=C.get(i);if(z||(v=v.ownerDocument||v,z={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(i,z),(C=v.querySelector(xu(i)))&&!C._p&&(z.instance=C,z.state.loading=5),Kr.has(i)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Kr.set(i,u),C||nR(v,i,u,z.state))),a&&m===null)throw Error(r(528,""));return z}if(a&&m!==null)throw Error(r(529,""));return null;case"script":return a=u.async,u=u.src,typeof u=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Lc(u),u=Ai(v).hoistableScripts,m=u.get(a),m||(m={type:"script",instance:null,count:0,state:null},u.set(a,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,i))}}function zc(i){return'href="'+hr(i)+'"'}function xu(i){return'link[rel="stylesheet"]['+i+"]"}function Ax(i){return g({},i,{"data-precedence":i.precedence,precedence:null})}function nR(i,a,u,m){i.querySelector('link[rel="preload"][as="style"]['+a+"]")?m.loading=1:(a=i.createElement("link"),m.preload=a,a.addEventListener("load",function(){return m.loading|=1}),a.addEventListener("error",function(){return m.loading|=2}),Vn(a,"link",u),mn(a),i.head.appendChild(a))}function Lc(i){return'[src="'+hr(i)+'"]'}function wu(i){return"script[async]"+i}function jx(i,a,u){if(a.count++,a.instance===null)switch(a.type){case"style":var m=i.querySelector('style[data-href~="'+hr(u.href)+'"]');if(m)return a.instance=m,mn(m),m;var v=g({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return m=(i.ownerDocument||i).createElement("style"),mn(m),Vn(m,"style",v),Fh(m,u.precedence,i),a.instance=m;case"stylesheet":v=zc(u.href);var C=i.querySelector(xu(v));if(C)return a.state.loading|=4,a.instance=C,mn(C),C;m=Ax(u),(v=Kr.get(v))&&Ip(m,v),C=(i.ownerDocument||i).createElement("link"),mn(C);var z=C;return z._p=new Promise(function(W,ne){z.onload=W,z.onerror=ne}),Vn(C,"link",m),a.state.loading|=4,Fh(C,u.precedence,i),a.instance=C;case"script":return C=Lc(u.src),(v=i.querySelector(wu(C)))?(a.instance=v,mn(v),v):(m=u,(v=Kr.get(C))&&(m=g({},u),kp(m,v)),i=i.ownerDocument||i,v=i.createElement("script"),mn(v),Vn(v,"link",m),i.head.appendChild(v),a.instance=v);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(m=a.instance,a.state.loading|=4,Fh(m,u.precedence,i));return a.instance}function Fh(i,a,u){for(var m=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=m.length?m[m.length-1]:null,C=v,z=0;z<m.length;z++){var W=m[z];if(W.dataset.precedence===a)C=W;else if(C!==v)break}C?C.parentNode.insertBefore(i,C.nextSibling):(a=u.nodeType===9?u.head:u,a.insertBefore(i,a.firstChild))}function Ip(i,a){i.crossOrigin==null&&(i.crossOrigin=a.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=a.referrerPolicy),i.title==null&&(i.title=a.title)}function kp(i,a){i.crossOrigin==null&&(i.crossOrigin=a.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=a.referrerPolicy),i.integrity==null&&(i.integrity=a.integrity)}var Vh=null;function Rx(i,a,u){if(Vh===null){var m=new Map,v=Vh=new Map;v.set(u,m)}else v=Vh,m=v.get(u),m||(m=new Map,v.set(u,m));if(m.has(i))return m;for(m.set(i,null),u=u.getElementsByTagName(i),v=0;v<u.length;v++){var C=u[v];if(!(C[Ei]||C[fn]||i==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var z=C.getAttribute(a)||"";z=i+z;var W=m.get(z);W?W.push(C):m.set(z,[C])}}return m}function Ix(i,a,u){i=i.ownerDocument||i,i.head.insertBefore(u,a==="title"?i.querySelector("head > title"):null)}function rR(i,a,u){if(u===1||a.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(i=a.disabled,typeof a.precedence=="string"&&i==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function kx(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function iR(i,a,u,m){if(u.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var v=zc(m.href),C=a.querySelector(xu(v));if(C){a=C._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(i.count++,i=$h.bind(i),a.then(i,i)),u.state.loading|=4,u.instance=C,mn(C);return}C=a.ownerDocument||a,m=Ax(m),(v=Kr.get(v))&&Ip(m,v),C=C.createElement("link"),mn(C);var z=C;z._p=new Promise(function(W,ne){z.onload=W,z.onerror=ne}),Vn(C,"link",m),u.instance=C}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(u,a),(a=u.state.preload)&&(u.state.loading&3)===0&&(i.count++,u=$h.bind(i),a.addEventListener("load",u),a.addEventListener("error",u))}}var Dp=0;function sR(i,a){return i.stylesheets&&i.count===0&&qh(i,i.stylesheets),0<i.count||0<i.imgCount?function(u){var m=setTimeout(function(){if(i.stylesheets&&qh(i,i.stylesheets),i.unsuspend){var C=i.unsuspend;i.unsuspend=null,C()}},6e4+a);0<i.imgBytes&&Dp===0&&(Dp=62500*Lj());var v=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&qh(i,i.stylesheets),i.unsuspend)){var C=i.unsuspend;i.unsuspend=null,C()}},(i.imgBytes>Dp?50:800)+a);return i.unsuspend=u,function(){i.unsuspend=null,clearTimeout(m),clearTimeout(v)}}:null}function $h(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)qh(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Gh=null;function qh(i,a){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Gh=new Map,a.forEach(aR,i),Gh=null,$h.call(i))}function aR(i,a){if(!(a.state.loading&4)){var u=Gh.get(i);if(u)var m=u.get(null);else{u=new Map,Gh.set(i,u);for(var v=i.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<v.length;C++){var z=v[C];(z.nodeName==="LINK"||z.getAttribute("media")!=="not all")&&(u.set(z.dataset.precedence,z),m=z)}m&&u.set(null,m)}v=a.instance,z=v.getAttribute("data-precedence"),C=u.get(z)||m,C===m&&u.set(null,v),u.set(z,v),this.count++,m=$h.bind(this),v.addEventListener("load",m),v.addEventListener("error",m),C?C.parentNode.insertBefore(v,C.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(v,i.firstChild)),a.state.loading|=4}}var Su={$$typeof:A,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function oR(i,a,u,m,v,C,z,W,ne){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Si(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Si(0),this.hiddenUpdates=Si(null),this.identifierPrefix=m,this.onUncaughtError=v,this.onCaughtError=C,this.onRecoverableError=z,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ne,this.incompleteTransitions=new Map}function Dx(i,a,u,m,v,C,z,W,ne,_e,je,De){return i=new oR(i,a,u,z,ne,_e,je,De,W),a=1,C===!0&&(a|=24),C=Ar(3,null,null,a),i.current=C,C.stateNode=i,a=dg(),a.refCount++,i.pooledCache=a,a.refCount++,C.memoizedState={element:m,isDehydrated:u,cache:a},gg(C),i}function Mx(i){return i?(i=pc,i):pc}function Ox(i,a,u,m,v,C){v=Mx(v),m.context===null?m.context=v:m.pendingContext=v,m=ia(a),m.payload={element:u},C=C===void 0?null:C,C!==null&&(m.callback=C),u=sa(i,m,a),u!==null&&(_r(u,i,a),tu(u,i,a))}function Nx(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var u=i.retryLane;i.retryLane=u!==0&&u<a?u:a}}function Mp(i,a){Nx(i,a),(i=i.alternate)&&Nx(i,a)}function Bx(i){if(i.tag===13||i.tag===31){var a=mo(i,67108864);a!==null&&_r(a,i,67108864),Mp(i,67108864)}}function Px(i){if(i.tag===13||i.tag===31){var a=Dr();a=to(a);var u=mo(i,a);u!==null&&_r(u,i,a),Mp(i,a)}}var Hh=!0;function cR(i,a,u,m){var v=K.T;K.T=null;var C=q.p;try{q.p=2,Op(i,a,u,m)}finally{q.p=C,K.T=v}}function lR(i,a,u,m){var v=K.T;K.T=null;var C=q.p;try{q.p=8,Op(i,a,u,m)}finally{q.p=C,K.T=v}}function Op(i,a,u,m){if(Hh){var v=Np(m);if(v===null)vp(i,a,m,Wh,u),Lx(i,m);else if(dR(v,i,a,u,m))m.stopPropagation();else if(Lx(i,m),a&4&&-1<uR.indexOf(i)){for(;v!==null;){var C=zr(v);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var z=sr(C.pendingLanes);if(z!==0){var W=C;for(W.pendingLanes|=2,W.entangledLanes|=2;z;){var ne=1<<31-Et(z);W.entanglements[1]|=ne,z&=~ne}Ui(C),(At&6)===0&&(Rh=Ae()+500,yu(0))}}break;case 31:case 13:W=mo(C,2),W!==null&&_r(W,C,2),kh(),Mp(C,2)}if(C=Np(m),C===null&&vp(i,a,m,Wh,u),C===v)break;v=C}v!==null&&m.stopPropagation()}else vp(i,a,m,null,u)}}function Np(i){return i=Lr(i),Bp(i)}var Wh=null;function Bp(i){if(Wh=null,i=Ti(i),i!==null){var a=o(i);if(a===null)i=null;else{var u=a.tag;if(u===13){if(i=c(a),i!==null)return i;i=null}else if(u===31){if(i=l(a),i!==null)return i;i=null}else if(u===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null)}}return Wh=i,null}function zx(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ie()){case qe:return 2;case wt:return 8;case it:case Qn:return 32;case bi:return 268435456;default:return 32}default:return 32}}var Pp=!1,pa=null,ya=null,_a=null,Cu=new Map,Eu=new Map,ba=[],uR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Lx(i,a){switch(i){case"focusin":case"focusout":pa=null;break;case"dragenter":case"dragleave":ya=null;break;case"mouseover":case"mouseout":_a=null;break;case"pointerover":case"pointerout":Cu.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Eu.delete(a.pointerId)}}function Tu(i,a,u,m,v,C){return i===null||i.nativeEvent!==C?(i={blockedOn:a,domEventName:u,eventSystemFlags:m,nativeEvent:C,targetContainers:[v]},a!==null&&(a=zr(a),a!==null&&Bx(a)),i):(i.eventSystemFlags|=m,a=i.targetContainers,v!==null&&a.indexOf(v)===-1&&a.push(v),i)}function dR(i,a,u,m,v){switch(a){case"focusin":return pa=Tu(pa,i,a,u,m,v),!0;case"dragenter":return ya=Tu(ya,i,a,u,m,v),!0;case"mouseover":return _a=Tu(_a,i,a,u,m,v),!0;case"pointerover":var C=v.pointerId;return Cu.set(C,Tu(Cu.get(C)||null,i,a,u,m,v)),!0;case"gotpointercapture":return C=v.pointerId,Eu.set(C,Tu(Eu.get(C)||null,i,a,u,m,v)),!0}return!1}function Ux(i){var a=Ti(i.target);if(a!==null){var u=o(a);if(u!==null){if(a=u.tag,a===13){if(a=c(u),a!==null){i.blockedOn=a,ni(i.priority,function(){Px(u)});return}}else if(a===31){if(a=l(u),a!==null){i.blockedOn=a,ni(i.priority,function(){Px(u)});return}}else if(a===3&&u.stateNode.current.memoizedState.isDehydrated){i.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Qh(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var u=Np(i.nativeEvent);if(u===null){u=i.nativeEvent;var m=new u.constructor(u.type,u);Ll=m,u.target.dispatchEvent(m),Ll=null}else return a=zr(u),a!==null&&Bx(a),i.blockedOn=u,!1;a.shift()}return!0}function Fx(i,a,u){Qh(i)&&u.delete(a)}function hR(){Pp=!1,pa!==null&&Qh(pa)&&(pa=null),ya!==null&&Qh(ya)&&(ya=null),_a!==null&&Qh(_a)&&(_a=null),Cu.forEach(Fx),Eu.forEach(Fx)}function Kh(i,a){i.blockedOn===a&&(i.blockedOn=null,Pp||(Pp=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,hR)))}var Yh=null;function Vx(i){Yh!==i&&(Yh=i,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Yh===i&&(Yh=null);for(var a=0;a<i.length;a+=3){var u=i[a],m=i[a+1],v=i[a+2];if(typeof m!="function"){if(Bp(m||u)===null)continue;break}var C=zr(u);C!==null&&(i.splice(a,3),a-=3,Ng(C,{pending:!0,data:v,method:u.method,action:m},m,v))}}))}function Uc(i){function a(ne){return Kh(ne,i)}pa!==null&&Kh(pa,i),ya!==null&&Kh(ya,i),_a!==null&&Kh(_a,i),Cu.forEach(a),Eu.forEach(a);for(var u=0;u<ba.length;u++){var m=ba[u];m.blockedOn===i&&(m.blockedOn=null)}for(;0<ba.length&&(u=ba[0],u.blockedOn===null);)Ux(u),u.blockedOn===null&&ba.shift();if(u=(i.ownerDocument||i).$$reactFormReplay,u!=null)for(m=0;m<u.length;m+=3){var v=u[m],C=u[m+1],z=v[Mn]||null;if(typeof C=="function")z||Vx(u);else if(z){var W=null;if(C&&C.hasAttribute("formAction")){if(v=C,z=C[Mn]||null)W=z.formAction;else if(Bp(v)!==null)continue}else W=z.action;typeof W=="function"?u[m+1]=W:(u.splice(m,3),m-=3),Vx(u)}}}function $x(){function i(C){C.canIntercept&&C.info==="react-transition"&&C.intercept({handler:function(){return new Promise(function(z){return v=z})},focusReset:"manual",scroll:"manual"})}function a(){v!==null&&(v(),v=null),m||setTimeout(u,20)}function u(){if(!m&&!navigation.transition){var C=navigation.currentEntry;C&&C.url!=null&&navigation.navigate(C.url,{state:C.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,v=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(u,100),function(){m=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),v!==null&&(v(),v=null)}}}function zp(i){this._internalRoot=i}Xh.prototype.render=zp.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(r(409));var u=a.current,m=Dr();Ox(u,m,i,a,null,null)},Xh.prototype.unmount=zp.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;Ox(i.current,2,null,i,null,null),kh(),a[Ci]=null}};function Xh(i){this._internalRoot=i}Xh.prototype.unstable_scheduleHydration=function(i){if(i){var a=kd();i={blockedOn:null,target:i,priority:a};for(var u=0;u<ba.length&&a!==0&&a<ba[u].priority;u++);ba.splice(u,0,i),u===0&&Ux(i)}};var Gx=e.version;if(Gx!=="19.2.3")throw Error(r(527,Gx,"19.2.3"));q.findDOMNode=function(i){var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(r(188)):(i=Object.keys(i).join(","),Error(r(268,i)));return i=f(a),i=i!==null?p(i):null,i=i===null?null:i.stateNode,i};var fR={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:K,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zh.isDisabled&&Zh.supportsFiber)try{xt=Zh.inject(fR),nn=Zh}catch{}}return ju.createRoot=function(i,a){if(!s(i))throw Error(r(299));var u=!1,m="",v=Xb,C=Zb,z=Jb;return a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onUncaughtError!==void 0&&(v=a.onUncaughtError),a.onCaughtError!==void 0&&(C=a.onCaughtError),a.onRecoverableError!==void 0&&(z=a.onRecoverableError)),a=Dx(i,1,!1,null,null,u,m,null,v,C,z,$x),i[Ci]=a.current,bp(i),new zp(a)},ju.hydrateRoot=function(i,a,u){if(!s(i))throw Error(r(299));var m=!1,v="",C=Xb,z=Zb,W=Jb,ne=null;return u!=null&&(u.unstable_strictMode===!0&&(m=!0),u.identifierPrefix!==void 0&&(v=u.identifierPrefix),u.onUncaughtError!==void 0&&(C=u.onUncaughtError),u.onCaughtError!==void 0&&(z=u.onCaughtError),u.onRecoverableError!==void 0&&(W=u.onRecoverableError),u.formState!==void 0&&(ne=u.formState)),a=Dx(i,1,!0,a,u??null,m,v,ne,C,z,W,$x),a.context=Mx(null),u=a.current,m=Dr(),m=to(m),v=ia(m),v.callback=null,sa(u,v,m),u=m,a.current.lanes=u,Ja(a,u),Ui(a),i[Ci]=a.current,bp(i),new Xh(a)},ju.version="19.2.3",ju}var ew;function CR(){if(ew)return Fp.exports;ew=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Fp.exports=SR(),Fp.exports}var ER=CR();var tw="popstate";function TR(t={}){function e(r,s){let{pathname:o,search:c,hash:l}=r.location;return py("",{pathname:o,search:c,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:qu(s)}return jR(e,n,null,t)}function en(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Nr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function AR(){return Math.random().toString(36).substring(2,10)}function nw(t,e){return{usr:t.state,key:t.key,idx:e}}function py(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?dl(e):e,state:n,key:e&&e.key||r||AR()}}function qu({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function dl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function jR(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:o=!1}=r,c=s.history,l="POP",h=null,f=p();f==null&&(f=0,c.replaceState({...c.state,idx:f},""));function p(){return(c.state||{idx:null}).idx}function g(){l="POP";let S=p(),E=S==null?null:S-f;f=S,h&&h({action:l,location:w.location,delta:E})}function _(S,E){l="PUSH";let T=py(w.location,S,E);f=p()+1;let A=nw(T,f),M=w.createHref(T);try{c.pushState(A,"",M)}catch(L){if(L instanceof DOMException&&L.name==="DataCloneError")throw L;s.location.assign(M)}o&&h&&h({action:l,location:w.location,delta:1})}function y(S,E){l="REPLACE";let T=py(w.location,S,E);f=p();let A=nw(T,f),M=w.createHref(T);c.replaceState(A,"",M),o&&h&&h({action:l,location:w.location,delta:0})}function x(S){return RR(S)}let w={get action(){return l},get location(){return t(s,c)},listen(S){if(h)throw new Error("A history only accepts one active listener");return s.addEventListener(tw,g),h=S,()=>{s.removeEventListener(tw,g),h=null}},createHref(S){return e(s,S)},createURL:x,encodeLocation(S){let E=x(S);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:_,replace:y,go(S){return c.go(S)}};return w}function RR(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),en(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:qu(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function D1(t,e,n="/"){return IR(t,e,n,!1)}function IR(t,e,n,r){let s=typeof e=="string"?dl(e):e,o=ks(s.pathname||"/",n);if(o==null)return null;let c=M1(t);kR(c);let l=null;for(let h=0;l==null&&h<c.length;++h){let f=VR(o);l=UR(c[h],f,r)}return l}function M1(t,e=[],n=[],r="",s=!1){let o=(c,l,h=s,f)=>{let p={relativePath:f===void 0?c.path||"":f,caseSensitive:c.caseSensitive===!0,childrenIndex:l,route:c};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(r)&&h)return;en(p.relativePath.startsWith(r),`Absolute route path "${p.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(r.length)}let g=Rs([r,p.relativePath]),_=n.concat(p);c.children&&c.children.length>0&&(en(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),M1(c.children,e,_,g,h)),!(c.path==null&&!c.index)&&e.push({path:g,score:zR(g,c.index),routesMeta:_})};return t.forEach((c,l)=>{if(c.path===""||!c.path?.includes("?"))o(c,l);else for(let h of O1(c.path))o(c,l,!0,h)}),e}function O1(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return s?[o,""]:[o];let c=O1(r.join("/")),l=[];return l.push(...c.map(h=>h===""?o:[o,h].join("/"))),s&&l.push(...c),l.map(h=>t.startsWith("/")&&h===""?"/":h)}function kR(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:LR(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var DR=/^:[\w-]+$/,MR=3,OR=2,NR=1,BR=10,PR=-2,rw=t=>t==="*";function zR(t,e){let n=t.split("/"),r=n.length;return n.some(rw)&&(r+=PR),e&&(r+=OR),n.filter(s=>!rw(s)).reduce((s,o)=>s+(DR.test(o)?MR:o===""?NR:BR),r)}function LR(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function UR(t,e,n=!1){let{routesMeta:r}=t,s={},o="/",c=[];for(let l=0;l<r.length;++l){let h=r[l],f=l===r.length-1,p=o==="/"?e:e.slice(o.length)||"/",g=Cf({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},p),_=h.route;if(!g&&f&&n&&!r[r.length-1].route.index&&(g=Cf({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!g)return null;Object.assign(s,g.params),c.push({params:s,pathname:Rs([o,g.pathname]),pathnameBase:HR(Rs([o,g.pathnameBase])),route:_}),g.pathnameBase!=="/"&&(o=Rs([o,g.pathnameBase]))}return c}function Cf(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=FR(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let o=s[0],c=o.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((f,{paramName:p,isOptional:g},_)=>{if(p==="*"){let x=l[_]||"";c=o.slice(0,o.length-x.length).replace(/(.)\/+$/,"$1")}const y=l[_];return g&&!y?f[p]=void 0:f[p]=(y||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:c,pattern:t}}function FR(t,e=!1,n=!0){Nr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,l,h)=>(r.push({paramName:l,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function VR(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Nr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function ks(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var N1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$R=t=>N1.test(t);function GR(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?dl(t):t,o;if(n)if($R(n))o=n;else{if(n.includes("//")){let c=n;n=n.replace(/\/\/+/g,"/"),Nr(!1,`Pathnames cannot have embedded double slashes - normalizing ${c} -> ${n}`)}n.startsWith("/")?o=iw(n.substring(1),"/"):o=iw(n,e)}else o=e;return{pathname:o,search:WR(r),hash:QR(s)}}function iw(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function qp(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function qR(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function t_(t){let e=qR(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function n_(t,e,n,r=!1){let s;typeof t=="string"?s=dl(t):(s={...t},en(!s.pathname||!s.pathname.includes("?"),qp("?","pathname","search",s)),en(!s.pathname||!s.pathname.includes("#"),qp("#","pathname","hash",s)),en(!s.search||!s.search.includes("#"),qp("#","search","hash",s)));let o=t===""||s.pathname==="",c=o?"/":s.pathname,l;if(c==null)l=n;else{let g=e.length-1;if(!r&&c.startsWith("..")){let _=c.split("/");for(;_[0]==="..";)_.shift(),g-=1;s.pathname=_.join("/")}l=g>=0?e[g]:"/"}let h=GR(s,l),f=c&&c!=="/"&&c.endsWith("/"),p=(o||c===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(f||p)&&(h.pathname+="/"),h}var Rs=t=>t.join("/").replace(/\/\/+/g,"/"),HR=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),WR=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,QR=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,KR=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function YR(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function XR(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var B1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function P1(t,e){let n=t;if(typeof n!="string"||!N1.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,s=!1;if(B1)try{let o=new URL(window.location.href),c=n.startsWith("//")?new URL(o.protocol+n):new URL(n),l=ks(c.pathname,e);c.origin===o.origin&&l!=null?n=l+c.search+c.hash:s=!0}catch{Nr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:s,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var z1=["POST","PUT","PATCH","DELETE"];new Set(z1);var ZR=["GET",...z1];new Set(ZR);var hl=R.createContext(null);hl.displayName="DataRouter";var tm=R.createContext(null);tm.displayName="DataRouterState";var JR=R.createContext(!1),L1=R.createContext({isTransitioning:!1});L1.displayName="ViewTransition";var e2=R.createContext(new Map);e2.displayName="Fetchers";var t2=R.createContext(null);t2.displayName="Await";var Br=R.createContext(null);Br.displayName="Navigation";var ld=R.createContext(null);ld.displayName="Location";var ei=R.createContext({outlet:null,matches:[],isDataRoute:!1});ei.displayName="Route";var r_=R.createContext(null);r_.displayName="RouteError";var U1="REACT_ROUTER_ERROR",n2="REDIRECT",r2="ROUTE_ERROR_RESPONSE";function i2(t){if(t.startsWith(`${U1}:${n2}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function s2(t){if(t.startsWith(`${U1}:${r2}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new KR(e.status,e.statusText,e.data)}catch{}}function a2(t,{relative:e}={}){en(fl(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=R.useContext(Br),{hash:s,pathname:o,search:c}=dd(t,{relative:e}),l=o;return n!=="/"&&(l=o==="/"?n:Rs([n,o])),r.createHref({pathname:l,search:c,hash:s})}function fl(){return R.useContext(ld)!=null}function nr(){return en(fl(),"useLocation() may be used only in the context of a <Router> component."),R.useContext(ld).location}var F1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function V1(t){R.useContext(Br).static||R.useLayoutEffect(t)}function ud(){let{isDataRoute:t}=R.useContext(ei);return t?w2():o2()}function o2(){en(fl(),"useNavigate() may be used only in the context of a <Router> component.");let t=R.useContext(hl),{basename:e,navigator:n}=R.useContext(Br),{matches:r}=R.useContext(ei),{pathname:s}=nr(),o=JSON.stringify(t_(r)),c=R.useRef(!1);return V1(()=>{c.current=!0}),R.useCallback((h,f={})=>{if(Nr(c.current,F1),!c.current)return;if(typeof h=="number"){n.go(h);return}let p=n_(h,JSON.parse(o),s,f.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:Rs([e,p.pathname])),(f.replace?n.replace:n.push)(p,f.state,f)},[e,n,o,s,t])}var c2=R.createContext(null);function l2(t){let e=R.useContext(ei).outlet;return R.useMemo(()=>e&&R.createElement(c2.Provider,{value:t},e),[e,t])}function u2(){let{matches:t}=R.useContext(ei),e=t[t.length-1];return e?e.params:{}}function dd(t,{relative:e}={}){let{matches:n}=R.useContext(ei),{pathname:r}=nr(),s=JSON.stringify(t_(n));return R.useMemo(()=>n_(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function d2(t,e){return $1(t,e)}function $1(t,e,n,r,s){en(fl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=R.useContext(Br),{matches:c}=R.useContext(ei),l=c[c.length-1],h=l?l.params:{},f=l?l.pathname:"/",p=l?l.pathnameBase:"/",g=l&&l.route;{let T=g&&g.path||"";q1(f,!g||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let _=nr(),y;if(e){let T=typeof e=="string"?dl(e):e;en(p==="/"||T.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${T.pathname}" was given in the \`location\` prop.`),y=T}else y=_;let x=y.pathname||"/",w=x;if(p!=="/"){let T=p.replace(/^\//,"").split("/");w="/"+x.replace(/^\//,"").split("/").slice(T.length).join("/")}let S=D1(t,{pathname:w});Nr(g||S!=null,`No routes matched location "${y.pathname}${y.search}${y.hash}" `),Nr(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${y.pathname}${y.search}${y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let E=p2(S&&S.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:Rs([p,o.encodeLocation?o.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?p:Rs([p,o.encodeLocation?o.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),c,n,r,s);return e&&E?R.createElement(ld.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...y},navigationType:"POP"}},E):E}function h2(){let t=x2(),e=YR(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},c=null;return console.error("Error handled by React Router default ErrorBoundary:",t),c=R.createElement(R.Fragment,null,R.createElement("p",null," Hey developer "),R.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",R.createElement("code",{style:o},"ErrorBoundary")," or"," ",R.createElement("code",{style:o},"errorElement")," prop on your route.")),R.createElement(R.Fragment,null,R.createElement("h2",null,"Unexpected Application Error!"),R.createElement("h3",{style:{fontStyle:"italic"}},e),n?R.createElement("pre",{style:s},n):null,c)}var f2=R.createElement(h2,null),G1=class extends R.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=s2(t.digest);n&&(t=n)}let e=t!==void 0?R.createElement(ei.Provider,{value:this.props.routeContext},R.createElement(r_.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?R.createElement(m2,{error:t},e):e}};G1.contextType=JR;var Hp=new WeakMap;function m2({children:t,error:e}){let{basename:n}=R.useContext(Br);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=i2(e.digest);if(r){let s=Hp.get(e);if(s)throw s;let o=P1(r.location,n);if(B1&&!Hp.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const c=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw Hp.set(e,c),c}return R.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return t}function g2({routeContext:t,match:e,children:n}){let r=R.useContext(hl);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),R.createElement(ei.Provider,{value:t},n)}function p2(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,c=n?.errors;if(c!=null){let p=o.findIndex(g=>g.route.id&&c?.[g.route.id]!==void 0);en(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),o=o.slice(0,Math.min(o.length,p+1))}let l=!1,h=-1;if(n)for(let p=0;p<o.length;p++){let g=o[p];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=p),g.route.id){let{loaderData:_,errors:y}=n,x=g.route.loader&&!_.hasOwnProperty(g.route.id)&&(!y||y[g.route.id]===void 0);if(g.route.lazy||x){l=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}let f=n&&r?(p,g)=>{r(p,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:XR(n.matches),errorInfo:g})}:void 0;return o.reduceRight((p,g,_)=>{let y,x=!1,w=null,S=null;n&&(y=c&&g.route.id?c[g.route.id]:void 0,w=g.route.errorElement||f2,l&&(h<0&&_===0?(q1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),x=!0,S=null):h===_&&(x=!0,S=g.route.hydrateFallbackElement||null)));let E=e.concat(o.slice(0,_+1)),T=()=>{let A;return y?A=w:x?A=S:g.route.Component?A=R.createElement(g.route.Component,null):g.route.element?A=g.route.element:A=p,R.createElement(g2,{match:g,routeContext:{outlet:p,matches:E,isDataRoute:n!=null},children:A})};return n&&(g.route.ErrorBoundary||g.route.errorElement||_===0)?R.createElement(G1,{location:n.location,revalidation:n.revalidation,component:w,error:y,children:T(),routeContext:{outlet:null,matches:E,isDataRoute:!0},onError:f}):T()},null)}function i_(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function y2(t){let e=R.useContext(hl);return en(e,i_(t)),e}function _2(t){let e=R.useContext(tm);return en(e,i_(t)),e}function b2(t){let e=R.useContext(ei);return en(e,i_(t)),e}function s_(t){let e=b2(t),n=e.matches[e.matches.length-1];return en(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function v2(){return s_("useRouteId")}function x2(){let t=R.useContext(r_),e=_2("useRouteError"),n=s_("useRouteError");return t!==void 0?t:e.errors?.[n]}function w2(){let{router:t}=y2("useNavigate"),e=s_("useNavigate"),n=R.useRef(!1);return V1(()=>{n.current=!0}),R.useCallback(async(s,o={})=>{Nr(n.current,F1),n.current&&(typeof s=="number"?await t.navigate(s):await t.navigate(s,{fromRouteId:e,...o}))},[t,e])}var sw={};function q1(t,e,n){!e&&!sw[t]&&(sw[t]=!0,Nr(!1,n))}R.memo(S2);function S2({routes:t,future:e,state:n,onError:r}){return $1(t,void 0,n,r,e)}function nm({to:t,replace:e,state:n,relative:r}){en(fl(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=R.useContext(Br);Nr(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=R.useContext(ei),{pathname:c}=nr(),l=ud(),h=n_(t,t_(o),c,r==="path"),f=JSON.stringify(h);return R.useEffect(()=>{l(JSON.parse(f),{replace:e,state:n,relative:r})},[l,f,r,e,n]),null}function rm(t){return l2(t.context)}function vn(t){en(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function C2({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:o=!1,unstable_useTransitions:c}){en(!fl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=t.replace(/^\/*/,"/"),h=R.useMemo(()=>({basename:l,navigator:s,static:o,unstable_useTransitions:c,future:{}}),[l,s,o,c]);typeof n=="string"&&(n=dl(n));let{pathname:f="/",search:p="",hash:g="",state:_=null,key:y="default"}=n,x=R.useMemo(()=>{let w=ks(f,l);return w==null?null:{location:{pathname:w,search:p,hash:g,state:_,key:y},navigationType:r}},[l,f,p,g,_,y,r]);return Nr(x!=null,`<Router basename="${l}"> is not able to match the URL "${f}${p}${g}" because it does not start with the basename, so the <Router> won't render anything.`),x==null?null:R.createElement(Br.Provider,{value:h},R.createElement(ld.Provider,{children:e,value:x}))}function E2({children:t,location:e}){return d2(yy(t),e)}function yy(t,e=[]){let n=[];return R.Children.forEach(t,(r,s)=>{if(!R.isValidElement(r))return;let o=[...e,s];if(r.type===R.Fragment){n.push.apply(n,yy(r.props.children,o));return}en(r.type===vn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),en(!r.props.index||!r.props.children,"An index route cannot have child routes.");let c={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(c.children=yy(r.props.children,o)),n.push(c)}),n}var hf="get",ff="application/x-www-form-urlencoded";function im(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function T2(t){return im(t)&&t.tagName.toLowerCase()==="button"}function A2(t){return im(t)&&t.tagName.toLowerCase()==="form"}function j2(t){return im(t)&&t.tagName.toLowerCase()==="input"}function R2(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function I2(t,e){return t.button===0&&(!e||e==="_self")&&!R2(t)}function _y(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(s=>[n,s]):[[n,r]])},[]))}function k2(t,e){let n=_y(t);return e&&e.forEach((r,s)=>{n.has(s)||e.getAll(s).forEach(o=>{n.append(s,o)})}),n}var ef=null;function D2(){if(ef===null)try{new FormData(document.createElement("form"),0),ef=!1}catch{ef=!0}return ef}var M2=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Wp(t){return t!=null&&!M2.has(t)?(Nr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ff}"`),null):t}function O2(t,e){let n,r,s,o,c;if(A2(t)){let l=t.getAttribute("action");r=l?ks(l,e):null,n=t.getAttribute("method")||hf,s=Wp(t.getAttribute("enctype"))||ff,o=new FormData(t)}else if(T2(t)||j2(t)&&(t.type==="submit"||t.type==="image")){let l=t.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=t.getAttribute("formaction")||l.getAttribute("action");if(r=h?ks(h,e):null,n=t.getAttribute("formmethod")||l.getAttribute("method")||hf,s=Wp(t.getAttribute("formenctype"))||Wp(l.getAttribute("enctype"))||ff,o=new FormData(l,t),!D2()){let{name:f,type:p,value:g}=t;if(p==="image"){let _=f?`${f}.`:"";o.append(`${_}x`,"0"),o.append(`${_}y`,"0")}else f&&o.append(f,g)}}else{if(im(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=hf,r=null,s=ff,c=t}return o&&s==="text/plain"&&(c=o,o=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:o,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function a_(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function N2(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&ks(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function B2(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function P2(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function z2(t,e,n){let r=await Promise.all(t.map(async s=>{let o=e.routes[s.route.id];if(o){let c=await B2(o,n);return c.links?c.links():[]}return[]}));return V2(r.flat(1).filter(P2).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function aw(t,e,n,r,s,o){let c=(h,f)=>n[f]?h.route.id!==n[f].route.id:!0,l=(h,f)=>n[f].pathname!==h.pathname||n[f].route.path?.endsWith("*")&&n[f].params["*"]!==h.params["*"];return o==="assets"?e.filter((h,f)=>c(h,f)||l(h,f)):o==="data"?e.filter((h,f)=>{let p=r.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(c(h,f)||l(h,f))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function L2(t,e,{includeHydrateFallback:n}={}){return U2(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let o=[s.module];return s.clientActionModule&&(o=o.concat(s.clientActionModule)),s.clientLoaderModule&&(o=o.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(o=o.concat(s.hydrateFallbackModule)),s.imports&&(o=o.concat(s.imports)),o}).flat(1))}function U2(t){return[...new Set(t)]}function F2(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function V2(t,e){let n=new Set;return new Set(e),t.reduce((r,s)=>{let o=JSON.stringify(F2(s));return n.has(o)||(n.add(o),r.push({key:o,link:s})),r},[])}function H1(){let t=R.useContext(hl);return a_(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function $2(){let t=R.useContext(tm);return a_(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var o_=R.createContext(void 0);o_.displayName="FrameworkContext";function W1(){let t=R.useContext(o_);return a_(t,"You must render this element inside a <HydratedRouter> element"),t}function G2(t,e){let n=R.useContext(o_),[r,s]=R.useState(!1),[o,c]=R.useState(!1),{onFocus:l,onBlur:h,onMouseEnter:f,onMouseLeave:p,onTouchStart:g}=e,_=R.useRef(null);R.useEffect(()=>{if(t==="render"&&c(!0),t==="viewport"){let w=E=>{E.forEach(T=>{c(T.isIntersecting)})},S=new IntersectionObserver(w,{threshold:.5});return _.current&&S.observe(_.current),()=>{S.disconnect()}}},[t]),R.useEffect(()=>{if(r){let w=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(w)}}},[r]);let y=()=>{s(!0)},x=()=>{s(!1),c(!1)};return n?t!=="intent"?[o,_,{}]:[o,_,{onFocus:Ru(l,y),onBlur:Ru(h,x),onMouseEnter:Ru(f,y),onMouseLeave:Ru(p,x),onTouchStart:Ru(g,y)}]:[!1,_,{}]}function Ru(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function q2({page:t,...e}){let{router:n}=H1(),r=R.useMemo(()=>D1(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?R.createElement(W2,{page:t,matches:r,...e}):null}function H2(t){let{manifest:e,routeModules:n}=W1(),[r,s]=R.useState([]);return R.useEffect(()=>{let o=!1;return z2(t,e,n).then(c=>{o||s(c)}),()=>{o=!0}},[t,e,n]),r}function W2({page:t,matches:e,...n}){let r=nr(),{manifest:s,routeModules:o}=W1(),{basename:c}=H1(),{loaderData:l,matches:h}=$2(),f=R.useMemo(()=>aw(t,e,h,s,r,"data"),[t,e,h,s,r]),p=R.useMemo(()=>aw(t,e,h,s,r,"assets"),[t,e,h,s,r]),g=R.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let x=new Set,w=!1;if(e.forEach(E=>{let T=s.routes[E.route.id];!T||!T.hasLoader||(!f.some(A=>A.route.id===E.route.id)&&E.route.id in l&&o[E.route.id]?.shouldRevalidate||T.hasClientLoader?w=!0:x.add(E.route.id))}),x.size===0)return[];let S=N2(t,c,"data");return w&&x.size>0&&S.searchParams.set("_routes",e.filter(E=>x.has(E.route.id)).map(E=>E.route.id).join(",")),[S.pathname+S.search]},[c,l,r,s,f,e,t,o]),_=R.useMemo(()=>L2(p,s),[p,s]),y=H2(p);return R.createElement(R.Fragment,null,g.map(x=>R.createElement("link",{key:x,rel:"prefetch",as:"fetch",href:x,...n})),_.map(x=>R.createElement("link",{key:x,rel:"modulepreload",href:x,...n})),y.map(({key:x,link:w})=>R.createElement("link",{key:x,nonce:n.nonce,...w})))}function Q2(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var K2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{K2&&(window.__reactRouterVersion="7.11.0")}catch{}function Y2({basename:t,children:e,unstable_useTransitions:n,window:r}){let s=R.useRef();s.current==null&&(s.current=TR({window:r,v5Compat:!0}));let o=s.current,[c,l]=R.useState({action:o.action,location:o.location}),h=R.useCallback(f=>{n===!1?l(f):R.startTransition(()=>l(f))},[n]);return R.useLayoutEffect(()=>o.listen(h),[o,h]),R.createElement(C2,{basename:t,children:e,location:c.location,navigationType:c.action,navigator:o,unstable_useTransitions:n})}var Q1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Rn=R.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:o,replace:c,state:l,target:h,to:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:_,...y},x){let{basename:w,unstable_useTransitions:S}=R.useContext(Br),E=typeof f=="string"&&Q1.test(f),T=P1(f,w);f=T.to;let A=a2(f,{relative:s}),[M,L,H]=G2(r,y),O=eI(f,{replace:c,state:l,target:h,preventScrollReset:p,relative:s,viewTransition:g,unstable_defaultShouldRevalidate:_,unstable_useTransitions:S});function j(V){e&&e(V),V.defaultPrevented||O(V)}let B=R.createElement("a",{...y,...H,href:T.absoluteURL||A,onClick:T.isExternal||o?e:j,ref:Q2(x,L),target:h,"data-discover":!E&&n==="render"?"true":void 0});return M&&!E?R.createElement(R.Fragment,null,B,R.createElement(q2,{page:A})):B});Rn.displayName="Link";var X2=R.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:o,to:c,viewTransition:l,children:h,...f},p){let g=dd(c,{relative:f.relative}),_=nr(),y=R.useContext(tm),{navigator:x,basename:w}=R.useContext(Br),S=y!=null&&sI(g)&&l===!0,E=x.encodeLocation?x.encodeLocation(g).pathname:g.pathname,T=_.pathname,A=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;n||(T=T.toLowerCase(),A=A?A.toLowerCase():null,E=E.toLowerCase()),A&&w&&(A=ks(A,w)||A);const M=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let L=T===E||!s&&T.startsWith(E)&&T.charAt(M)==="/",H=A!=null&&(A===E||!s&&A.startsWith(E)&&A.charAt(E.length)==="/"),O={isActive:L,isPending:H,isTransitioning:S},j=L?e:void 0,B;typeof r=="function"?B=r(O):B=[r,L?"active":null,H?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let V=typeof o=="function"?o(O):o;return R.createElement(Rn,{...f,"aria-current":j,className:B,ref:p,style:V,to:c,viewTransition:l},typeof h=="function"?h(O):h)});X2.displayName="NavLink";var Z2=R.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:o,method:c=hf,action:l,onSubmit:h,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:_,...y},x)=>{let{unstable_useTransitions:w}=R.useContext(Br),S=rI(),E=iI(l,{relative:f}),T=c.toLowerCase()==="get"?"get":"post",A=typeof l=="string"&&Q1.test(l),M=L=>{if(h&&h(L),L.defaultPrevented)return;L.preventDefault();let H=L.nativeEvent.submitter,O=H?.getAttribute("formmethod")||c,j=()=>S(H||L.currentTarget,{fetcherKey:e,method:O,navigate:n,replace:s,state:o,relative:f,preventScrollReset:p,viewTransition:g,unstable_defaultShouldRevalidate:_});w&&n!==!1?R.startTransition(()=>j()):j()};return R.createElement("form",{ref:x,method:T,action:E,onSubmit:r?h:M,...y,"data-discover":!A&&t==="render"?"true":void 0})});Z2.displayName="Form";function J2(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function K1(t){let e=R.useContext(hl);return en(e,J2(t)),e}function eI(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:o,viewTransition:c,unstable_defaultShouldRevalidate:l,unstable_useTransitions:h}={}){let f=ud(),p=nr(),g=dd(t,{relative:o});return R.useCallback(_=>{if(I2(_,e)){_.preventDefault();let y=n!==void 0?n:qu(p)===qu(g),x=()=>f(t,{replace:y,state:r,preventScrollReset:s,relative:o,viewTransition:c,unstable_defaultShouldRevalidate:l});h?R.startTransition(()=>x()):x()}},[p,f,g,n,r,e,t,s,o,c,l,h])}function Y1(t){Nr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=R.useRef(_y(t)),n=R.useRef(!1),r=nr(),s=R.useMemo(()=>k2(r.search,n.current?null:e.current),[r.search]),o=ud(),c=R.useCallback((l,h)=>{const f=_y(typeof l=="function"?l(new URLSearchParams(s)):l);n.current=!0,o("?"+f,h)},[o,s]);return[s,c]}var tI=0,nI=()=>`__${String(++tI)}__`;function rI(){let{router:t}=K1("useSubmit"),{basename:e}=R.useContext(Br),n=v2(),r=t.fetch,s=t.navigate;return R.useCallback(async(o,c={})=>{let{action:l,method:h,encType:f,formData:p,body:g}=O2(o,e);if(c.navigate===!1){let _=c.fetcherKey||nI();await r(_,n,c.action||l,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:p,body:g,formMethod:c.method||h,formEncType:c.encType||f,flushSync:c.flushSync})}else await s(c.action||l,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:p,body:g,formMethod:c.method||h,formEncType:c.encType||f,replace:c.replace,state:c.state,fromRouteId:n,flushSync:c.flushSync,viewTransition:c.viewTransition})},[r,s,e,n])}function iI(t,{relative:e}={}){let{basename:n}=R.useContext(Br),r=R.useContext(ei);en(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),o={...dd(t||".",{relative:e})},c=nr();if(t==null){o.search=c.search;let l=new URLSearchParams(o.search),h=l.getAll("index");if(h.some(p=>p==="")){l.delete("index"),h.filter(g=>g).forEach(g=>l.append("index",g));let p=l.toString();o.search=p?`?${p}`:""}}return(!t||t===".")&&s.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:Rs([n,o.pathname])),qu(o)}function sI(t,{relative:e}={}){let n=R.useContext(L1);en(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=K1("useViewTransitionState"),s=dd(t,{relative:e});if(!n.isTransitioning)return!1;let o=ks(n.currentLocation.pathname,r)||n.currentLocation.pathname,c=ks(n.nextLocation.pathname,r)||n.nextLocation.pathname;return Cf(s.pathname,c)!=null||Cf(s.pathname,o)!=null}const aI={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},X1=R.createContext(aI);function oI({children:t}){const[e,n]=R.useState(new Map),r=R.useCallback((h,f)=>{n(p=>new Map(p).set(h,f))},[]),s=R.useCallback(h=>{n(f=>{const p=new Map(f);return p.delete(h),p})},[]),o=e.size>0,c=e.size>0&&Array.from(e.values()).pop()||"Loading...",l={isLoading:o,loadingMessage:c,addLoadingHold:r,removeLoadingHold:s};return d.jsx(X1.Provider,{value:l,children:t})}function kn(){const t=R.useContext(X1);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const cI=()=>{};var ow={};const Z1=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},lI=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=t[n++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=t[n++],c=t[n++],l=t[n++],h=((s&7)<<18|(o&63)<<12|(c&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],c=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|c&63)}}return e.join("")},J1={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const o=t[s],c=s+1<t.length,l=c?t[s+1]:0,h=s+2<t.length,f=h?t[s+2]:0,p=o>>2,g=(o&3)<<4|l>>4;let _=(l&15)<<2|f>>6,y=f&63;h||(y=64,c||(_=64)),r.push(n[p],n[g],n[_],n[y])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Z1(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):lI(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const o=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const f=s<t.length?n[t.charAt(s)]:64;++s;const g=s<t.length?n[t.charAt(s)]:64;if(++s,o==null||l==null||f==null||g==null)throw new uI;const _=o<<2|l>>4;if(r.push(_),f!==64){const y=l<<4&240|f>>2;if(r.push(y),g!==64){const x=f<<6&192|g;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class uI extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const dI=function(t){const e=Z1(t);return J1.encodeByteArray(e,!0)},Ef=function(t){return dI(t).replace(/\./g,"")},eC=function(t){try{return J1.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function hI(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const fI=()=>hI().__FIREBASE_DEFAULTS__,mI=()=>{if(typeof process>"u"||typeof ow>"u")return;const t=ow.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},gI=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&eC(t[1]);return e&&JSON.parse(e)},sm=()=>{try{return cI()||fI()||mI()||gI()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},tC=t=>sm()?.emulatorHosts?.[t],pI=t=>{const e=tC(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},nC=()=>sm()?.config,rC=t=>sm()?.[`_${t}`];class yI{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function ml(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function iC(t){return(await fetch(t,{credentials:"include"})).ok}function _I(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Ef(JSON.stringify(n)),Ef(JSON.stringify(c)),""].join(".")}const zu={};function bI(){const t={prod:[],emulator:[]};for(const e of Object.keys(zu))zu[e]?t.emulator.push(e):t.prod.push(e);return t}function vI(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let cw=!1;function sC(t,e){if(typeof window>"u"||typeof document>"u"||!ml(window.location.host)||zu[t]===e||zu[t]||cw)return;zu[t]=e;function n(_){return`__firebase__banner__${_}`}const r="__firebase__banner",o=bI().prod.length>0;function c(){const _=document.getElementById(r);_&&_.remove()}function l(_){_.style.display="flex",_.style.background="#7faaf0",_.style.position="fixed",_.style.bottom="5px",_.style.left="5px",_.style.padding=".5em",_.style.borderRadius="5px",_.style.alignItems="center"}function h(_,y){_.setAttribute("width","24"),_.setAttribute("id",y),_.setAttribute("height","24"),_.setAttribute("viewBox","0 0 24 24"),_.setAttribute("fill","none"),_.style.marginLeft="-6px"}function f(){const _=document.createElement("span");return _.style.cursor="pointer",_.style.marginLeft="16px",_.style.fontSize="24px",_.innerHTML=" &times;",_.onclick=()=>{cw=!0,c()},_}function p(_,y){_.setAttribute("id",y),_.innerText="Learn more",_.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",_.setAttribute("target","__blank"),_.style.paddingLeft="5px",_.style.textDecoration="underline"}function g(){const _=vI(r),y=n("text"),x=document.getElementById(y)||document.createElement("span"),w=n("learnmore"),S=document.getElementById(w)||document.createElement("a"),E=n("preprendIcon"),T=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(_.created){const A=_.element;l(A),p(S,w);const M=f();h(T,E),A.append(T,x,S,M),document.body.appendChild(A)}o?(x.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function tr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function xI(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(tr())}function wI(){const t=sm()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function SI(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function CI(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function EI(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function TI(){const t=tr();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function AI(){return!wI()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function jI(){try{return typeof indexedDB=="object"}catch{return!1}}function RI(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(n){e(n)}})}const II="FirebaseError";class Ls extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=II,Object.setPrototypeOf(this,Ls.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,hd.prototype.create)}}class hd{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,o=this.errors[e],c=o?kI(o,r):"Error",l=`${this.serviceName}: ${c} (${s}).`;return new Ls(s,l,r)}}function kI(t,e){return t.replace(DI,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const DI=/\{\$([^}]+)}/g;function MI(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ds(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const o=t[s],c=e[s];if(lw(o)&&lw(c)){if(!Ds(o,c))return!1}else if(o!==c)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function lw(t){return t!==null&&typeof t=="object"}function fd(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ku(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,o]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(o)}}),e}function Du(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function OI(t,e){const n=new NI(t,e);return n.subscribe.bind(n)}class NI{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");BI(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Qp),s.error===void 0&&(s.error=Qp),s.complete===void 0&&(s.complete=Qp);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function BI(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Qp(){}function En(t){return t&&t._delegate?t._delegate:t}class Po{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ro="[DEFAULT]";class PI{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new yI;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(LI(e))try{this.getOrInitializeService({instanceIdentifier:Ro})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=Ro){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ro){return this.instances.has(e)}getOptions(e=Ro){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,c]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(o);r===l&&c.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:zI(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ro){return this.component?this.component.multipleInstances?e:Ro:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function zI(t){return t===Ro?void 0:t}function LI(t){return t.instantiationMode==="EAGER"}class UI{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new PI(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var gt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(gt||(gt={}));const FI={debug:gt.DEBUG,verbose:gt.VERBOSE,info:gt.INFO,warn:gt.WARN,error:gt.ERROR,silent:gt.SILENT},VI=gt.INFO,$I={[gt.DEBUG]:"log",[gt.VERBOSE]:"log",[gt.INFO]:"info",[gt.WARN]:"warn",[gt.ERROR]:"error"},GI=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=$I[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class c_{constructor(e){this.name=e,this._logLevel=VI,this._logHandler=GI,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in gt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?FI[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,gt.DEBUG,...e),this._logHandler(this,gt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,gt.VERBOSE,...e),this._logHandler(this,gt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,gt.INFO,...e),this._logHandler(this,gt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,gt.WARN,...e),this._logHandler(this,gt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,gt.ERROR,...e),this._logHandler(this,gt.ERROR,...e)}}const qI=(t,e)=>e.some(n=>t instanceof n);let uw,dw;function HI(){return uw||(uw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function WI(){return dw||(dw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const aC=new WeakMap,by=new WeakMap,oC=new WeakMap,Kp=new WeakMap,l_=new WeakMap;function QI(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",o),t.removeEventListener("error",c)},o=()=>{n(Ia(t.result)),s()},c=()=>{r(t.error),s()};t.addEventListener("success",o),t.addEventListener("error",c)});return e.then(n=>{n instanceof IDBCursor&&aC.set(n,t)}).catch(()=>{}),l_.set(e,t),e}function KI(t){if(by.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",c),t.removeEventListener("abort",c)},o=()=>{n(),s()},c=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",o),t.addEventListener("error",c),t.addEventListener("abort",c)});by.set(t,e)}let vy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return by.get(t);if(e==="objectStoreNames")return t.objectStoreNames||oC.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ia(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function YI(t){vy=t(vy)}function XI(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Yp(this),e,...n);return oC.set(r,e.sort?e.sort():[e]),Ia(r)}:WI().includes(t)?function(...e){return t.apply(Yp(this),e),Ia(aC.get(this))}:function(...e){return Ia(t.apply(Yp(this),e))}}function ZI(t){return typeof t=="function"?XI(t):(t instanceof IDBTransaction&&KI(t),qI(t,HI())?new Proxy(t,vy):t)}function Ia(t){if(t instanceof IDBRequest)return QI(t);if(Kp.has(t))return Kp.get(t);const e=ZI(t);return e!==t&&(Kp.set(t,e),l_.set(e,t)),e}const Yp=t=>l_.get(t);function JI(t,e,{blocked:n,upgrade:r,blocking:s,terminated:o}={}){const c=indexedDB.open(t,e),l=Ia(c);return r&&c.addEventListener("upgradeneeded",h=>{r(Ia(c.result),h.oldVersion,h.newVersion,Ia(c.transaction),h)}),n&&c.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),l.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",f=>s(f.oldVersion,f.newVersion,f))}).catch(()=>{}),l}const ek=["get","getKey","getAll","getAllKeys","count"],tk=["put","add","delete","clear"],Xp=new Map;function hw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Xp.get(e))return Xp.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=tk.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||ek.includes(n)))return;const o=async function(c,...l){const h=this.transaction(c,s?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(l.shift())),(await Promise.all([f[n](...l),s&&h.done]))[0]};return Xp.set(e,o),o}YI(t=>({...t,get:(e,n,r)=>hw(e,n)||t.get(e,n,r),has:(e,n)=>!!hw(e,n)||t.has(e,n)}));class nk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(rk(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function rk(t){return t.getComponent()?.type==="VERSION"}const xy="@firebase/app",fw="0.14.6";const Ms=new c_("@firebase/app"),ik="@firebase/app-compat",sk="@firebase/analytics-compat",ak="@firebase/analytics",ok="@firebase/app-check-compat",ck="@firebase/app-check",lk="@firebase/auth",uk="@firebase/auth-compat",dk="@firebase/database",hk="@firebase/data-connect",fk="@firebase/database-compat",mk="@firebase/functions",gk="@firebase/functions-compat",pk="@firebase/installations",yk="@firebase/installations-compat",_k="@firebase/messaging",bk="@firebase/messaging-compat",vk="@firebase/performance",xk="@firebase/performance-compat",wk="@firebase/remote-config",Sk="@firebase/remote-config-compat",Ck="@firebase/storage",Ek="@firebase/storage-compat",Tk="@firebase/firestore",Ak="@firebase/ai",jk="@firebase/firestore-compat",Rk="firebase",Ik="12.6.0";const wy="[DEFAULT]",kk={[xy]:"fire-core",[ik]:"fire-core-compat",[ak]:"fire-analytics",[sk]:"fire-analytics-compat",[ck]:"fire-app-check",[ok]:"fire-app-check-compat",[lk]:"fire-auth",[uk]:"fire-auth-compat",[dk]:"fire-rtdb",[hk]:"fire-data-connect",[fk]:"fire-rtdb-compat",[mk]:"fire-fn",[gk]:"fire-fn-compat",[pk]:"fire-iid",[yk]:"fire-iid-compat",[_k]:"fire-fcm",[bk]:"fire-fcm-compat",[vk]:"fire-perf",[xk]:"fire-perf-compat",[wk]:"fire-rc",[Sk]:"fire-rc-compat",[Ck]:"fire-gcs",[Ek]:"fire-gcs-compat",[Tk]:"fire-fst",[jk]:"fire-fst-compat",[Ak]:"fire-vertex","fire-js":"fire-js",[Rk]:"fire-js-all"};const Tf=new Map,Dk=new Map,Sy=new Map;function mw(t,e){try{t.container.addComponent(e)}catch(n){Ms.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function el(t){const e=t.name;if(Sy.has(e))return Ms.debug(`There were multiple attempts to register component ${e}.`),!1;Sy.set(e,t);for(const n of Tf.values())mw(n,t);for(const n of Dk.values())mw(n,t);return!0}function u_(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function hi(t){return t==null?!1:t.settings!==void 0}const Mk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ka=new hd("app","Firebase",Mk);class Ok{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Po("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ka.create("app-deleted",{appName:this._name})}}const gl=Ik;function cC(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:wy,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw ka.create("bad-app-name",{appName:String(s)});if(n||(n=nC()),!n)throw ka.create("no-options");const o=Tf.get(s);if(o){if(Ds(n,o.options)&&Ds(r,o.config))return o;throw ka.create("duplicate-app",{appName:s})}const c=new UI(s);for(const h of Sy.values())c.addComponent(h);const l=new Ok(n,r,c);return Tf.set(s,l),l}function lC(t=wy){const e=Tf.get(t);if(!e&&t===wy&&nC())return cC();if(!e)throw ka.create("no-app",{appName:t});return e}function Da(t,e,n){let r=kk[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const c=[`Unable to register library "${r}" with version "${e}":`];s&&c.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ms.warn(c.join(" "));return}el(new Po(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const Nk="firebase-heartbeat-database",Bk=1,Hu="firebase-heartbeat-store";let Zp=null;function uC(){return Zp||(Zp=JI(Nk,Bk,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Hu)}catch(n){console.warn(n)}}}}).catch(t=>{throw ka.create("idb-open",{originalErrorMessage:t.message})})),Zp}async function Pk(t){try{const n=(await uC()).transaction(Hu),r=await n.objectStore(Hu).get(dC(t));return await n.done,r}catch(e){if(e instanceof Ls)Ms.warn(e.message);else{const n=ka.create("idb-get",{originalErrorMessage:e?.message});Ms.warn(n.message)}}}async function gw(t,e){try{const r=(await uC()).transaction(Hu,"readwrite");await r.objectStore(Hu).put(e,dC(t)),await r.done}catch(n){if(n instanceof Ls)Ms.warn(n.message);else{const r=ka.create("idb-set",{originalErrorMessage:n?.message});Ms.warn(r.message)}}}function dC(t){return`${t.name}!${t.options.appId}`}const zk=1024,Lk=30;class Uk{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Vk(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=pw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>Lk){const s=$k(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ms.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=pw(),{heartbeatsToSend:n,unsentEntries:r}=Fk(this._heartbeatsCache.heartbeats),s=Ef(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Ms.warn(e),""}}}function pw(){return new Date().toISOString().substring(0,10)}function Fk(t,e=zk){const n=[];let r=t.slice();for(const s of t){const o=n.find(c=>c.agent===s.agent);if(o){if(o.dates.push(s.date),yw(n)>e){o.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),yw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class Vk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return jI()?RI().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await Pk(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return gw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return gw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function yw(t){return Ef(JSON.stringify({version:2,heartbeats:t})).length}function $k(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function Gk(t){el(new Po("platform-logger",e=>new nk(e),"PRIVATE")),el(new Po("heartbeat",e=>new Uk(e),"PRIVATE")),Da(xy,fw,t),Da(xy,fw,"esm2020"),Da("fire-js","")}Gk("");function hC(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const qk=hC,fC=new hd("auth","Firebase",hC());const Af=new c_("@firebase/auth");function Hk(t,...e){Af.logLevel<=gt.WARN&&Af.warn(`Auth (${gl}): ${t}`,...e)}function mf(t,...e){Af.logLevel<=gt.ERROR&&Af.error(`Auth (${gl}): ${t}`,...e)}function pi(t,...e){throw d_(t,...e)}function Hi(t,...e){return d_(t,...e)}function mC(t,e,n){const r={...qk(),[e]:n};return new hd("auth","Firebase",r).create(e,{appName:t.name})}function Ma(t){return mC(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function d_(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return fC.create(t,...e)}function Ye(t,e,...n){if(!t)throw d_(e,...n)}function As(t){const e="INTERNAL ASSERTION FAILED: "+t;throw mf(e),new Error(e)}function Os(t,e){t||As(e)}function Cy(){return typeof self<"u"&&self.location?.href||""}function Wk(){return _w()==="http:"||_w()==="https:"}function _w(){return typeof self<"u"&&self.location?.protocol||null}function Qk(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Wk()||CI()||"connection"in navigator)?navigator.onLine:!0}function Kk(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class md{constructor(e,n){this.shortDelay=e,this.longDelay=n,Os(n>e,"Short delay should be less than long delay!"),this.isMobile=xI()||EI()}get(){return Qk()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function h_(t,e){Os(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class gC{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;As("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;As("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;As("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Yk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Xk=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Zk=new md(3e4,6e4);function Go(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ha(t,e,n,r,s={}){return pC(t,s,async()=>{let o={},c={};r&&(e==="GET"?c=r:o={body:JSON.stringify(r)});const l=fd({key:t.config.apiKey,...c}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const f={method:e,headers:h,...o};return SI()||(f.referrerPolicy="no-referrer"),t.emulatorConfig&&ml(t.emulatorConfig.host)&&(f.credentials="include"),gC.fetch()(await yC(t,t.config.apiHost,n,l),f)})}async function pC(t,e,n){t._canInitEmulator=!1;const r={...Yk,...e};try{const s=new e5(t),o=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const c=await o.json();if("needConfirmation"in c)throw tf(t,"account-exists-with-different-credential",c);if(o.ok&&!("errorMessage"in c))return c;{const l=o.ok?c.errorMessage:c.error.message,[h,f]=l.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw tf(t,"credential-already-in-use",c);if(h==="EMAIL_EXISTS")throw tf(t,"email-already-in-use",c);if(h==="USER_DISABLED")throw tf(t,"user-disabled",c);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw mC(t,p,f);pi(t,p)}}catch(s){if(s instanceof Ls)throw s;pi(t,"network-request-failed",{message:String(s)})}}async function am(t,e,n,r,s={}){const o=await Ha(t,e,n,r,s);return"mfaPendingCredential"in o&&pi(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function yC(t,e,n,r){const s=`${e}${n}?${r}`,o=t,c=o.config.emulator?h_(t.config,s):`${t.config.apiScheme}://${s}`;return Xk.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(c).toString():c}function Jk(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class e5{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Hi(this.auth,"network-request-failed")),Zk.get())})}}function tf(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Hi(t,e,r);return s.customData._tokenResponse=n,s}function bw(t){return t!==void 0&&t.enterprise!==void 0}class t5{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return Jk(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function n5(t,e){return Ha(t,"GET","/v2/recaptchaConfig",Go(t,e))}async function r5(t,e){return Ha(t,"POST","/v1/accounts:delete",e)}async function jf(t,e){return Ha(t,"POST","/v1/accounts:lookup",e)}function Lu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function i5(t,e=!1){const n=En(t),r=await n.getIdToken(e),s=f_(r);Ye(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,c=o?.sign_in_provider;return{claims:s,token:r,authTime:Lu(Jp(s.auth_time)),issuedAtTime:Lu(Jp(s.iat)),expirationTime:Lu(Jp(s.exp)),signInProvider:c||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Jp(t){return Number(t)*1e3}function f_(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return mf("JWT malformed, contained fewer than 3 sections"),null;try{const s=eC(n);return s?JSON.parse(s):(mf("Failed to decode base64 JWT payload"),null)}catch(s){return mf("Caught error parsing JWT payload as JSON",s?.toString()),null}}function vw(t){const e=f_(t);return Ye(e,"internal-error"),Ye(typeof e.exp<"u","internal-error"),Ye(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Wu(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Ls&&s5(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function s5({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class a5{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Ey{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Lu(this.lastLoginAt),this.creationTime=Lu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Rf(t){const e=t.auth,n=await t.getIdToken(),r=await Wu(t,jf(e,{idToken:n}));Ye(r?.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const o=s.providerUserInfo?.length?_C(s.providerUserInfo):[],c=c5(t.providerData,o),l=t.isAnonymous,h=!(t.email&&s.passwordHash)&&!c?.length,f=l?h:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new Ey(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(t,p)}async function o5(t){const e=En(t);await Rf(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function c5(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function _C(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function l5(t,e){const n=await pC(t,{},async()=>{const r=fd({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=t.config,c=await yC(t,s,"/v1/token",`key=${o}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:l,body:r};return t.emulatorConfig&&ml(t.emulatorConfig.host)&&(h.credentials="include"),gC.fetch()(c,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function u5(t,e){return Ha(t,"POST","/v2/accounts:revokeToken",Go(t,e))}class Kc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ye(e.idToken,"internal-error"),Ye(typeof e.idToken<"u","internal-error"),Ye(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):vw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ye(e.length!==0,"internal-error");const n=vw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ye(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:o}=await l5(e,n);this.updateTokensAndExpiration(r,s,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:o}=n,c=new Kc;return r&&(Ye(typeof r=="string","internal-error",{appName:e}),c.refreshToken=r),s&&(Ye(typeof s=="string","internal-error",{appName:e}),c.accessToken=s),o&&(Ye(typeof o=="number","internal-error",{appName:e}),c.expirationTime=o),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Kc,this.toJSON())}_performRefresh(){return As("not implemented")}}function xa(t,e){Ye(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class fi{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new a5(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Ey(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Wu(this,this.stsTokenManager.getToken(this.auth,e));return Ye(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return i5(this,e)}reload(){return o5(this)}_assign(e){this!==e&&(Ye(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new fi({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ye(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Rf(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(hi(this.auth.app))return Promise.reject(Ma(this.auth));const e=await this.getIdToken();return await Wu(this,r5(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,o=n.phoneNumber??void 0,c=n.photoURL??void 0,l=n.tenantId??void 0,h=n._redirectEventId??void 0,f=n.createdAt??void 0,p=n.lastLoginAt??void 0,{uid:g,emailVerified:_,isAnonymous:y,providerData:x,stsTokenManager:w}=n;Ye(g&&w,e,"internal-error");const S=Kc.fromJSON(this.name,w);Ye(typeof g=="string",e,"internal-error"),xa(r,e.name),xa(s,e.name),Ye(typeof _=="boolean",e,"internal-error"),Ye(typeof y=="boolean",e,"internal-error"),xa(o,e.name),xa(c,e.name),xa(l,e.name),xa(h,e.name),xa(f,e.name),xa(p,e.name);const E=new fi({uid:g,auth:e,email:s,emailVerified:_,displayName:r,isAnonymous:y,photoURL:c,phoneNumber:o,tenantId:l,stsTokenManager:S,createdAt:f,lastLoginAt:p});return x&&Array.isArray(x)&&(E.providerData=x.map(T=>({...T}))),h&&(E._redirectEventId=h),E}static async _fromIdTokenResponse(e,n,r=!1){const s=new Kc;s.updateFromServerResponse(n);const o=new fi({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Rf(o),o}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Ye(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?_C(s.providerUserInfo):[],c=!(s.email&&s.passwordHash)&&!o?.length,l=new Kc;l.updateFromIdToken(r);const h=new fi({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:c}),f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Ey(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(h,f),h}}const xw=new Map;function js(t){Os(t instanceof Function,"Expected a class definition");let e=xw.get(t);return e?(Os(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,xw.set(t,e),e)}class bC{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}bC.type="NONE";const ww=bC;function gf(t,e,n){return`firebase:${t}:${e}:${n}`}class Yc{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:o}=this.auth;this.fullUserKey=gf(this.userKey,s.apiKey,o),this.fullPersistenceKey=gf("persistence",s.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await jf(this.auth,{idToken:e}).catch(()=>{});return n?fi._fromGetAccountInfoResponse(this.auth,n,e):null}return fi._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Yc(js(ww),e,r);const s=(await Promise.all(n.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let o=s[0]||js(ww);const c=gf(r,e.config.apiKey,e.name);let l=null;for(const f of n)try{const p=await f._get(c);if(p){let g;if(typeof p=="string"){const _=await jf(e,{idToken:p}).catch(()=>{});if(!_)break;g=await fi._fromGetAccountInfoResponse(e,_,p)}else g=fi._fromJSON(e,p);f!==o&&(l=g),o=f;break}}catch{}const h=s.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Yc(o,e,r):(o=h[0],l&&await o._set(c,l.toJSON()),await Promise.all(n.map(async f=>{if(f!==o)try{await f._remove(c)}catch{}})),new Yc(o,e,r))}}function Sw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(SC(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(vC(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(EC(e))return"Blackberry";if(TC(e))return"Webos";if(xC(e))return"Safari";if((e.includes("chrome/")||wC(e))&&!e.includes("edge/"))return"Chrome";if(CC(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function vC(t=tr()){return/firefox\//i.test(t)}function xC(t=tr()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function wC(t=tr()){return/crios\//i.test(t)}function SC(t=tr()){return/iemobile/i.test(t)}function CC(t=tr()){return/android/i.test(t)}function EC(t=tr()){return/blackberry/i.test(t)}function TC(t=tr()){return/webos/i.test(t)}function m_(t=tr()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function d5(t=tr()){return m_(t)&&!!window.navigator?.standalone}function h5(){return TI()&&document.documentMode===10}function AC(t=tr()){return m_(t)||CC(t)||TC(t)||EC(t)||/windows phone/i.test(t)||SC(t)}function jC(t,e=[]){let n;switch(t){case"Browser":n=Sw(tr());break;case"Worker":n=`${Sw(tr())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${gl}/${r}`}class f5{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((c,l)=>{try{const h=e(o);c(h)}catch(h){l(h)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function m5(t,e={}){return Ha(t,"GET","/v2/passwordPolicy",Go(t,e))}const g5=6;class p5{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??g5,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class y5{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Cw(this),this.idTokenSubscription=new Cw(this),this.beforeStateQueue=new f5(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=fC,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=js(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Yc.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await jf(this,{idToken:e}),r=await fi._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(hi(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,c=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===c)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ye(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Rf(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Kk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(hi(this.app))return Promise.reject(Ma(this));const n=e?En(e):null;return n&&Ye(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ye(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return hi(this.app)?Promise.reject(Ma(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return hi(this.app)?Promise.reject(Ma(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(js(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await m5(this),n=new p5(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new hd("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await u5(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&js(e)||this._popupRedirectResolver;Ye(n,this,"argument-error"),this.redirectPersistenceManager=await Yc.create(this,[js(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let c=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ye(l,this,"internal-error"),l.then(()=>{c||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,s);return()=>{c=!0,h()}}else{const h=e.addObserver(n);return()=>{c=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ye(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=jC(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(hi(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Hk(`Error while retrieving App Check token: ${e.error}`),e?.token}}function pl(t){return En(t)}class Cw{constructor(e){this.auth=e,this.observer=null,this.addObserver=OI(n=>this.observer=n)}get next(){return Ye(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let om={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _5(t){om=t}function RC(t){return om.loadJS(t)}function b5(){return om.recaptchaEnterpriseScript}function v5(){return om.gapiScript}function x5(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class w5{constructor(){this.enterprise=new S5}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class S5{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const C5="recaptcha-enterprise",IC="NO_RECAPTCHA";class E5{constructor(e){this.type=C5,this.auth=pl(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(c,l)=>{n5(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const f=new t5(h);return o.tenantId==null?o._agentRecaptchaConfig=f:o._tenantRecaptchaConfigs[o.tenantId]=f,c(f.siteKey)}}).catch(h=>{l(h)})})}function s(o,c,l){const h=window.grecaptcha;bw(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(f=>{c(f)}).catch(()=>{c(IC)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new w5().execute("siteKey",{action:"verify"}):new Promise((o,c)=>{r(this.auth).then(l=>{if(!n&&bw(window.grecaptcha))s(l,o,c);else{if(typeof window>"u"){c(new Error("RecaptchaVerifier is only supported in browser"));return}let h=b5();h.length!==0&&(h+=l),RC(h).then(()=>{s(l,o,c)}).catch(f=>{c(f)})}}).catch(l=>{c(l)})})}}async function Ew(t,e,n,r=!1,s=!1){const o=new E5(t);let c;if(s)c=IC;else try{c=await o.verify(n)}catch{c=await o.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const h=l.phoneEnrollmentInfo.phoneNumber,f=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:f,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const h=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:c}):Object.assign(l,{captchaResponse:c}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Tw(t,e,n,r,s){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Ew(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await Ew(t,e,n,n==="getOobCode");return r(t,c)}else return Promise.reject(o)})}function T5(t,e){const n=u_(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),o=n.getOptions();if(Ds(o,e??{}))return s;pi(s,"already-initialized")}return n.initialize({options:e})}function A5(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(js);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function j5(t,e,n){const r=pl(t);Ye(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,o=kC(e),{host:c,port:l}=R5(e),h=l===null?"":`:${l}`,f={url:`${o}//${c}${h}/`},p=Object.freeze({host:c,port:l,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Ye(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ye(Ds(f,r.config.emulator)&&Ds(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=f,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,ml(c)?(iC(`${o}//${c}${h}`),sC("Auth",!0)):I5()}function kC(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function R5(t){const e=kC(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const o=s[1];return{host:o,port:Aw(r.substr(o.length+1))}}else{const[o,c]=r.split(":");return{host:o,port:Aw(c)}}}function Aw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function I5(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class g_{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return As("not implemented")}_getIdTokenResponse(e){return As("not implemented")}_linkToIdToken(e,n){return As("not implemented")}_getReauthenticationResolver(e){return As("not implemented")}}async function k5(t,e){return Ha(t,"POST","/v1/accounts:signUp",e)}async function D5(t,e){return am(t,"POST","/v1/accounts:signInWithPassword",Go(t,e))}async function M5(t,e){return am(t,"POST","/v1/accounts:signInWithEmailLink",Go(t,e))}async function O5(t,e){return am(t,"POST","/v1/accounts:signInWithEmailLink",Go(t,e))}class Qu extends g_{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Qu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Qu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Tw(e,n,"signInWithPassword",D5);case"emailLink":return M5(e,{email:this._email,oobCode:this._password});default:pi(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Tw(e,r,"signUpPassword",k5);case"emailLink":return O5(e,{idToken:n,email:this._email,oobCode:this._password});default:pi(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Xc(t,e){return am(t,"POST","/v1/accounts:signInWithIdp",Go(t,e))}const N5="http://localhost";class zo extends g_{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new zo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):pi("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...o}=n;if(!r||!s)return null;const c=new zo(r,s);return c.idToken=o.idToken||void 0,c.accessToken=o.accessToken||void 0,c.secret=o.secret,c.nonce=o.nonce,c.pendingToken=o.pendingToken||null,c}_getIdTokenResponse(e){const n=this.buildRequest();return Xc(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Xc(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Xc(e,n)}buildRequest(){const e={requestUri:N5,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=fd(n)}return e}}function B5(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function P5(t){const e=ku(Du(t)).link,n=e?ku(Du(e)).deep_link_id:null,r=ku(Du(t)).deep_link_id;return(r?ku(Du(r)).link:null)||r||n||e||t}class p_{constructor(e){const n=ku(Du(e)),r=n.apiKey??null,s=n.oobCode??null,o=B5(n.mode??null);Ye(r&&s&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=P5(e);try{return new p_(n)}catch{return null}}}class yl{constructor(){this.providerId=yl.PROVIDER_ID}static credential(e,n){return Qu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=p_.parseLink(n);return Ye(r,"argument-error"),Qu._fromEmailAndCode(e,r.code,r.tenantId)}}yl.PROVIDER_ID="password";yl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";yl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class DC{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class gd extends DC{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Sa extends gd{constructor(){super("facebook.com")}static credential(e){return zo._fromParams({providerId:Sa.PROVIDER_ID,signInMethod:Sa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Sa.credentialFromTaggedObject(e)}static credentialFromError(e){return Sa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Sa.credential(e.oauthAccessToken)}catch{return null}}}Sa.FACEBOOK_SIGN_IN_METHOD="facebook.com";Sa.PROVIDER_ID="facebook.com";class Ca extends gd{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return zo._fromParams({providerId:Ca.PROVIDER_ID,signInMethod:Ca.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Ca.credentialFromTaggedObject(e)}static credentialFromError(e){return Ca.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Ca.credential(n,r)}catch{return null}}}Ca.GOOGLE_SIGN_IN_METHOD="google.com";Ca.PROVIDER_ID="google.com";class Ea extends gd{constructor(){super("github.com")}static credential(e){return zo._fromParams({providerId:Ea.PROVIDER_ID,signInMethod:Ea.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ea.credentialFromTaggedObject(e)}static credentialFromError(e){return Ea.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ea.credential(e.oauthAccessToken)}catch{return null}}}Ea.GITHUB_SIGN_IN_METHOD="github.com";Ea.PROVIDER_ID="github.com";class Ta extends gd{constructor(){super("twitter.com")}static credential(e,n){return zo._fromParams({providerId:Ta.PROVIDER_ID,signInMethod:Ta.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Ta.credentialFromTaggedObject(e)}static credentialFromError(e){return Ta.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Ta.credential(n,r)}catch{return null}}}Ta.TWITTER_SIGN_IN_METHOD="twitter.com";Ta.PROVIDER_ID="twitter.com";class tl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const o=await fi._fromIdTokenResponse(e,r,s),c=jw(r);return new tl({user:o,providerId:c,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=jw(r);return new tl({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function jw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class If extends Ls{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,If.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new If(e,n,r,s)}}function MC(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?If._fromErrorAndOperation(t,o,e,r):o})}async function z5(t,e,n=!1){const r=await Wu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return tl._forOperation(t,"link",r)}async function L5(t,e,n=!1){const{auth:r}=t;if(hi(r.app))return Promise.reject(Ma(r));const s="reauthenticate";try{const o=await Wu(t,MC(r,s,e,t),n);Ye(o.idToken,r,"internal-error");const c=f_(o.idToken);Ye(c,r,"internal-error");const{sub:l}=c;return Ye(t.uid===l,r,"user-mismatch"),tl._forOperation(t,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&pi(r,"user-mismatch"),o}}async function OC(t,e,n=!1){if(hi(t.app))return Promise.reject(Ma(t));const r="signIn",s=await MC(t,r,e),o=await tl._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(o.user),o}async function U5(t,e){return OC(pl(t),e)}async function F5(t){const e=pl(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function V5(t,e,n){return hi(t.app)?Promise.reject(Ma(t)):U5(En(t),yl.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&F5(t),r})}function $5(t,e,n,r){return En(t).onIdTokenChanged(e,n,r)}function G5(t,e,n){return En(t).beforeAuthStateChanged(e,n)}function q5(t,e,n,r){return En(t).onAuthStateChanged(e,n,r)}function H5(t){return En(t).signOut()}const kf="__sak";class NC{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(kf,"1"),this.storage.removeItem(kf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const W5=1e3,Q5=10;class BC extends NC{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=AC(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((c,l,h)=>{this.notifyListeners(c,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const c=this.storage.getItem(r);!n&&this.localCache[r]===c||this.notifyListeners(r,c)},o=this.storage.getItem(r);h5()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Q5):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},W5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}BC.type="LOCAL";const K5=BC;class PC extends NC{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}PC.type="SESSION";const zC=PC;function Y5(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class cm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new cm(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:o}=n.data,c=this.handlersMap[s];if(!c?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(c).map(async f=>f(n.origin,o)),h=await Y5(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}cm.receivers=[];function y_(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class X5{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,c;return new Promise((l,h)=>{const f=y_("",20);s.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);c={messageChannel:s,onMessage(g){const _=g;if(_.data.eventId===f)switch(_.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),l(_.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(c),s.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:f,data:n},[s.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}function Wi(){return window}function Z5(t){Wi().location.href=t}function LC(){return typeof Wi().WorkerGlobalScope<"u"&&typeof Wi().importScripts=="function"}async function J5(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function eD(){return navigator?.serviceWorker?.controller||null}function tD(){return LC()?self:null}const UC="firebaseLocalStorageDb",nD=1,Df="firebaseLocalStorage",FC="fbase_key";class pd{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function lm(t,e){return t.transaction([Df],e?"readwrite":"readonly").objectStore(Df)}function rD(){const t=indexedDB.deleteDatabase(UC);return new pd(t).toPromise()}function Ty(){const t=indexedDB.open(UC,nD);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Df,{keyPath:FC})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Df)?e(r):(r.close(),await rD(),e(await Ty()))})})}async function Rw(t,e,n){const r=lm(t,!0).put({[FC]:e,value:n});return new pd(r).toPromise()}async function iD(t,e){const n=lm(t,!1).get(e),r=await new pd(n).toPromise();return r===void 0?null:r.value}function Iw(t,e){const n=lm(t,!0).delete(e);return new pd(n).toPromise()}const sD=800,aD=3;class VC{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Ty(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>aD)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return LC()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=cm._getInstance(tD()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await J5(),!this.activeServiceWorker)return;this.sender=new X5(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||eD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ty();return await Rw(e,kf,"1"),await Iw(e,kf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Rw(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>iD(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Iw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=lm(s,!1).getAll();return new pd(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),sD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}VC.type="LOCAL";const oD=VC;new md(3e4,6e4);function cD(t,e){return e?js(e):(Ye(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class __ extends g_{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Xc(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Xc(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Xc(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function lD(t){return OC(t.auth,new __(t),t.bypassAuthState)}function uD(t){const{auth:e,user:n}=t;return Ye(n,e,"internal-error"),L5(n,new __(t),t.bypassAuthState)}async function dD(t){const{auth:e,user:n}=t;return Ye(n,e,"internal-error"),z5(n,new __(t),t.bypassAuthState)}class $C{constructor(e,n,r,s,o=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:o,error:c,type:l}=e;if(c){this.reject(c);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return lD;case"linkViaPopup":case"linkViaRedirect":return dD;case"reauthViaPopup":case"reauthViaRedirect":return uD;default:pi(this.auth,"internal-error")}}resolve(e){Os(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Os(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const hD=new md(2e3,1e4);class Qc extends $C{constructor(e,n,r,s,o){super(e,n,s,o),this.provider=r,this.authWindow=null,this.pollId=null,Qc.currentPopupAction&&Qc.currentPopupAction.cancel(),Qc.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ye(e,this.auth,"internal-error"),e}async onExecution(){Os(this.filter.length===1,"Popup operations only handle one event");const e=y_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Hi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Hi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Qc.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Hi(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,hD.get())};e()}}Qc.currentPopupAction=null;const fD="pendingRedirect",pf=new Map;class mD extends $C{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=pf.get(this.auth._key());if(!e){try{const r=await gD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}pf.set(this.auth._key(),e)}return this.bypassAuthState||pf.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function gD(t,e){const n=_D(e),r=yD(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function pD(t,e){pf.set(t._key(),e)}function yD(t){return js(t._redirectPersistence)}function _D(t){return gf(fD,t.config.apiKey,t.name)}async function bD(t,e,n=!1){if(hi(t.app))return Promise.reject(Ma(t));const r=pl(t),s=cD(r,e),c=await new mD(r,s,n).execute();return c&&!n&&(delete c.user._redirectEventId,await r._persistUserIfCurrent(c.user),await r._setRedirectUser(null,e)),c}const vD=600*1e3;class xD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!wD(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!GC(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Hi(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=vD&&this.cachedEventUids.clear(),this.cachedEventUids.has(kw(e))}saveEventToCache(e){this.cachedEventUids.add(kw(e)),this.lastProcessedEventTime=Date.now()}}function kw(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function GC({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function wD(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return GC(t);default:return!1}}async function SD(t,e={}){return Ha(t,"GET","/v1/projects",e)}const CD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ED=/^https?/;async function TD(t){if(t.config.emulator)return;const{authorizedDomains:e}=await SD(t);for(const n of e)try{if(AD(n))return}catch{}pi(t,"unauthorized-domain")}function AD(t){const e=Cy(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const c=new URL(t);return c.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&c.hostname===r}if(!ED.test(n))return!1;if(CD.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const jD=new md(3e4,6e4);function Dw(){const t=Wi().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function RD(t){return new Promise((e,n)=>{function r(){Dw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Dw(),n(Hi(t,"network-request-failed"))},timeout:jD.get()})}if(Wi().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Wi().gapi?.load)r();else{const s=x5("iframefcb");return Wi()[s]=()=>{gapi.load?r():n(Hi(t,"network-request-failed"))},RC(`${v5()}?onload=${s}`).catch(o=>n(o))}}).catch(e=>{throw yf=null,e})}let yf=null;function ID(t){return yf=yf||RD(t),yf}const kD=new md(5e3,15e3),DD="__/auth/iframe",MD="emulator/auth/iframe",OD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ND=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function BD(t){const e=t.config;Ye(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?h_(e,MD):`https://${t.config.authDomain}/${DD}`,r={apiKey:e.apiKey,appName:t.name,v:gl},s=ND.get(t.config.apiHost);s&&(r.eid=s);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${fd(r).slice(1)}`}async function PD(t){const e=await ID(t),n=Wi().gapi;return Ye(n,t,"internal-error"),e.open({where:document.body,url:BD(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:OD,dontclear:!0},r=>new Promise(async(s,o)=>{await r.restyle({setHideOnLeave:!1});const c=Hi(t,"network-request-failed"),l=Wi().setTimeout(()=>{o(c)},kD.get());function h(){Wi().clearTimeout(l),s(r)}r.ping(h).then(h,()=>{o(c)})}))}const zD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},LD=500,UD=600,FD="_blank",VD="http://localhost";class Mw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function $D(t,e,n,r=LD,s=UD){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),c=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const h={...zD,width:r.toString(),height:s.toString(),top:o,left:c},f=tr().toLowerCase();n&&(l=wC(f)?FD:n),vC(f)&&(e=e||VD,h.scrollbars="yes");const p=Object.entries(h).reduce((_,[y,x])=>`${_}${y}=${x},`,"");if(d5(f)&&l!=="_self")return GD(e||"",l),new Mw(null);const g=window.open(e||"",l,p);Ye(g,t,"popup-blocked");try{g.focus()}catch{}return new Mw(g)}function GD(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const qD="__/auth/handler",HD="emulator/auth/handler",WD=encodeURIComponent("fac");async function Ow(t,e,n,r,s,o){Ye(t.config.authDomain,t,"auth-domain-config-required"),Ye(t.config.apiKey,t,"invalid-api-key");const c={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:gl,eventId:s};if(e instanceof DC){e.setDefaultLanguage(t.languageCode),c.providerId=e.providerId||"",MI(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,g]of Object.entries({}))c[p]=g}if(e instanceof gd){const p=e.getScopes().filter(g=>g!=="");p.length>0&&(c.scopes=p.join(","))}t.tenantId&&(c.tid=t.tenantId);const l=c;for(const p of Object.keys(l))l[p]===void 0&&delete l[p];const h=await t._getAppCheckToken(),f=h?`#${WD}=${encodeURIComponent(h)}`:"";return`${QD(t)}?${fd(l).slice(1)}${f}`}function QD({config:t}){return t.emulator?h_(t,HD):`https://${t.authDomain}/${qD}`}const ey="webStorageSupport";class KD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=zC,this._completeRedirectFn=bD,this._overrideRedirectResult=pD}async _openPopup(e,n,r,s){Os(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Ow(e,n,r,Cy(),s);return $D(e,o,y_())}async _openRedirect(e,n,r,s){await this._originValidation(e);const o=await Ow(e,n,r,Cy(),s);return Z5(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:o}=this.eventManagers[n];return s?Promise.resolve(s):(Os(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await PD(e),r=new xD(e);return n.register("authEvent",s=>(Ye(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(ey,{type:ey},s=>{const o=s?.[0]?.[ey];o!==void 0&&n(!!o),pi(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=TD(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return AC()||xC()||m_()}}const YD=KD;var Nw="@firebase/auth",Bw="1.12.0";class XD{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ye(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function ZD(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function JD(t){el(new Po("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:c,authDomain:l}=r.options;Ye(c&&!c.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:c,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:jC(t)},f=new y5(r,s,o,h);return A5(f,n),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),el(new Po("auth-internal",e=>{const n=pl(e.getProvider("auth").getImmediate());return(r=>new XD(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Da(Nw,Bw,ZD(t)),Da(Nw,Bw,"esm2020")}const eM=300,tM=rC("authIdTokenMaxAge")||eM;let Pw=null;const nM=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>tM)return;const s=n?.token;Pw!==s&&(Pw=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function rM(t=lC()){const e=u_(t,"auth");if(e.isInitialized())return e.getImmediate();const n=T5(t,{popupRedirectResolver:YD,persistence:[oD,K5,zC]}),r=rC("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const c=nM(o.toString());G5(n,c,()=>c(n.currentUser)),$5(n,l=>c(l))}}const s=tC("auth");return s&&j5(n,`http://${s}`),n}function iM(){return document.getElementsByTagName("head")?.[0]??document}_5({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const o=Hi("internal-error");o.customData=s,n(o)},r.type="text/javascript",r.charset="UTF-8",iM().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});JD("Browser");var sM="firebase",aM="12.7.0";Da(sM,aM,"app");const oM={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},qC=cC(oM);function Us(){const t=rM(qC);async function e(){return!1}async function n(h,f){return V5(t,h,f)}function r(){return H5(t)}function s(h){q5(t,f=>{h(f)})}function o(){return t.currentUser}function c(){const h=t.currentUser;if(!h)throw new Error("Not authenticated");if(!h.email)throw new Error("Email is required but not available for this account");return h.email}return{set_user_listener:s,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:r,get_current_firebase_user:o,requireUserEmail:c}}var _l=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},cM={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},lM=class{#e=cM;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},Do=new lM;function uM(t){setTimeout(t,0)}var Lo=typeof window>"u"||"Deno"in globalThis;function ur(){}function dM(t,e){return typeof t=="function"?t(e):t}function Ay(t){return typeof t=="number"&&t>=0&&t!==1/0}function HC(t,e){return Math.max(t+(e||0)-Date.now(),0)}function Oa(t,e){return typeof t=="function"?t(e):t}function Yr(t,e){return typeof t=="function"?t(e):t}function zw(t,e){const{type:n="all",exact:r,fetchStatus:s,predicate:o,queryKey:c,stale:l}=t;if(c){if(r){if(e.queryHash!==b_(c,e.options))return!1}else if(!Ku(e.queryKey,c))return!1}if(n!=="all"){const h=e.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof l=="boolean"&&e.isStale()!==l||s&&s!==e.state.fetchStatus||o&&!o(e))}function Lw(t,e){const{exact:n,status:r,predicate:s,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(Uo(e.options.mutationKey)!==Uo(o))return!1}else if(!Ku(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||s&&!s(e))}function b_(t,e){return(e?.queryKeyHashFn||Uo)(t)}function Uo(t){return JSON.stringify(t,(e,n)=>jy(n)?Object.keys(n).sort().reduce((r,s)=>(r[s]=n[s],r),{}):n)}function Ku(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Ku(t[n],e[n])):!1}var hM=Object.prototype.hasOwnProperty;function WC(t,e){if(t===e)return t;const n=Uw(t)&&Uw(e);if(!n&&!(jy(t)&&jy(e)))return e;const s=(n?t:Object.keys(t)).length,o=n?e:Object.keys(e),c=o.length,l=n?new Array(c):{};let h=0;for(let f=0;f<c;f++){const p=n?f:o[f],g=t[p],_=e[p];if(g===_){l[p]=g,(n?f<s:hM.call(t,p))&&h++;continue}if(g===null||_===null||typeof g!="object"||typeof _!="object"){l[p]=_;continue}const y=WC(g,_);l[p]=y,y===g&&h++}return s===c&&h===s?t:l}function Mf(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Uw(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function jy(t){if(!Fw(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Fw(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Fw(t){return Object.prototype.toString.call(t)==="[object Object]"}function fM(t){return new Promise(e=>{Do.setTimeout(e,t)})}function Ry(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?WC(t,e):e}function mM(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function gM(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var v_=Symbol();function QC(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===v_?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function KC(t,e){return typeof t=="function"?t(...e):!!t}var pM=class extends _l{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!Lo&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},x_=new pM;function Iy(){let t,e;const n=new Promise((s,o)=>{t=s,e=o});n.status="pending",n.catch(()=>{});function r(s){Object.assign(n,s),delete n.resolve,delete n.reject}return n.resolve=s=>{r({status:"fulfilled",value:s}),t(s)},n.reject=s=>{r({status:"rejected",reason:s}),e(s)},n}var yM=uM;function _M(){let t=[],e=0,n=l=>{l()},r=l=>{l()},s=yM;const o=l=>{e?t.push(l):s(()=>{n(l)})},c=()=>{const l=t;t=[],l.length&&s(()=>{r(()=>{l.forEach(h=>{n(h)})})})};return{batch:l=>{let h;e++;try{h=l()}finally{e--,e||c()}return h},batchCalls:l=>(...h)=>{o(()=>{l(...h)})},schedule:o,setNotifyFunction:l=>{n=l},setBatchNotifyFunction:l=>{r=l},setScheduler:l=>{s=l}}}var jn=_M(),bM=class extends _l{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!Lo&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},Of=new bM;function vM(t){return Math.min(1e3*2**t,3e4)}function YC(t){return(t??"online")==="online"?Of.isOnline():!0}var ky=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function XC(t){let e=!1,n=0,r;const s=Iy(),o=()=>s.status!=="pending",c=w=>{if(!o()){const S=new ky(w);_(S),t.onCancel?.(S)}},l=()=>{e=!0},h=()=>{e=!1},f=()=>x_.isFocused()&&(t.networkMode==="always"||Of.isOnline())&&t.canRun(),p=()=>YC(t.networkMode)&&t.canRun(),g=w=>{o()||(r?.(),s.resolve(w))},_=w=>{o()||(r?.(),s.reject(w))},y=()=>new Promise(w=>{r=S=>{(o()||f())&&w(S)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),x=()=>{if(o())return;let w;const S=n===0?t.initialPromise:void 0;try{w=S??t.fn()}catch(E){w=Promise.reject(E)}Promise.resolve(w).then(g).catch(E=>{if(o())return;const T=t.retry??(Lo?0:3),A=t.retryDelay??vM,M=typeof A=="function"?A(n,E):A,L=T===!0||typeof T=="number"&&n<T||typeof T=="function"&&T(n,E);if(e||!L){_(E);return}n++,t.onFail?.(n,E),fM(M).then(()=>f()?void 0:y()).then(()=>{e?_(E):x()})})};return{promise:s,status:()=>s.status,cancel:c,continue:()=>(r?.(),s),cancelRetry:l,continueRetry:h,canStart:p,start:()=>(p()?x():y().then(x),s)}}var ZC=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Ay(this.gcTime)&&(this.#e=Do.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Lo?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Do.clearTimeout(this.#e),this.#e=void 0)}},xM=class extends ZC{#e;#t;#n;#i;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#i=e.client,this.#n=this.#i.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=$w(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=$w(this.options);n.data!==void 0&&(this.setState(Vw(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const r=Ry(this.state.data,e,this.options);return this.#s({data:r,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),r}setState(e,n){this.#s({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(ur).catch(ur):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Yr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===v_||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>Oa(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!HC(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(f=>f.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,s=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},o=()=>{const h=QC(this.options,n),p=(()=>{const g={client:this.#i,queryKey:this.queryKey,meta:this.meta};return s(g),g})();return this.#o=!1,this.options.persister?this.options.persister(h,p,this):h(p)},l=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:o};return s(h),h})();this.options.behavior?.onFetch(l,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==l.fetchOptions?.meta)&&this.#s({type:"fetch",meta:l.fetchOptions?.meta}),this.#r=XC({initialPromise:n?.initialPromise,fn:l.fetchFn,onCancel:h=>{h instanceof ky&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,f)=>{this.#s({type:"failed",failureCount:h,error:f})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode,canRun:()=>!0});try{const h=await this.#r.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof ky){if(h.silent)return this.#r.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#s({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#s(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...JC(r.data,this.options),fetchMeta:e.meta??null};case"success":const s={...r,...Vw(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?s:void 0,s;case"error":const o=e.error;return{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),jn.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function JC(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:YC(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Vw(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function $w(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var wM=class extends _l{constructor(t,e){super(),this.options=e,this.#e=t,this.#s=null,this.#o=Iy(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#i=void 0;#r;#a;#o;#s;#g;#h;#f;#l;#u;#c;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Gw(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Dy(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Dy(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Yr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!Mf(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&qw(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Yr(this.options.enabled,this.#t)!==Yr(e.enabled,this.#t)||Oa(this.options.staleTime,this.#t)!==Oa(e.staleTime,this.#t))&&this.#p();const s=this.#y();r&&(this.#t!==n||Yr(this.options.enabled,this.#t)!==Yr(e.enabled,this.#t)||s!==this.#c)&&this.#_(s)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return CM(this,n)&&(this.#i=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#i}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#i))}#d(t){this.#w();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(ur)),e}#p(){this.#v();const t=Oa(this.options.staleTime,this.#t);if(Lo||this.#i.isStale||!Ay(t))return;const n=HC(this.#i.dataUpdatedAt,t)+1;this.#l=Do.setTimeout(()=>{this.#i.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#c=t,!(Lo||Yr(this.options.enabled,this.#t)===!1||!Ay(this.#c)||this.#c===0)&&(this.#u=Do.setInterval(()=>{(this.options.refetchIntervalInBackground||x_.isFocused())&&this.#d()},this.#c))}#b(){this.#p(),this.#_(this.#y())}#v(){this.#l&&(Do.clearTimeout(this.#l),this.#l=void 0)}#x(){this.#u&&(Do.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,s=this.#i,o=this.#r,c=this.#a,h=t!==n?t.state:this.#n,{state:f}=t;let p={...f},g=!1,_;if(e._optimisticResults){const j=this.hasListeners(),B=!j&&Gw(t,e),V=j&&qw(t,n,e,r);(B||V)&&(p={...p,...JC(f.data,t.options)}),e._optimisticResults==="isRestoring"&&(p.fetchStatus="idle")}let{error:y,errorUpdatedAt:x,status:w}=p;_=p.data;let S=!1;if(e.placeholderData!==void 0&&_===void 0&&w==="pending"){let j;s?.isPlaceholderData&&e.placeholderData===c?.placeholderData?(j=s.data,S=!0):j=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,j!==void 0&&(w="success",_=Ry(s?.data,j,e),g=!0)}if(e.select&&_!==void 0&&!S)if(s&&_===o?.data&&e.select===this.#g)_=this.#h;else try{this.#g=e.select,_=e.select(_),_=Ry(s?.data,_,e),this.#h=_,this.#s=null}catch(j){this.#s=j}this.#s&&(y=this.#s,_=this.#h,x=Date.now(),w="error");const E=p.fetchStatus==="fetching",T=w==="pending",A=w==="error",M=T&&E,L=_!==void 0,O={status:w,fetchStatus:p.fetchStatus,isPending:T,isSuccess:w==="success",isError:A,isInitialLoading:M,isLoading:M,data:_,dataUpdatedAt:p.dataUpdatedAt,error:y,errorUpdatedAt:x,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>h.dataUpdateCount||p.errorUpdateCount>h.errorUpdateCount,isFetching:E,isRefetching:E&&!T,isLoadingError:A&&!L,isPaused:p.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:A&&L,isStale:w_(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Yr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const j=$=>{O.status==="error"?$.reject(O.error):O.data!==void 0&&$.resolve(O.data)},B=()=>{const $=this.#o=O.promise=Iy();j($)},V=this.#o;switch(V.status){case"pending":t.queryHash===n.queryHash&&j(V);break;case"fulfilled":(O.status==="error"||O.data!==V.value)&&B();break;case"rejected":(O.status!=="error"||O.error!==V.reason)&&B();break}}return O}updateResult(){const t=this.#i,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),Mf(e,t))return;this.#i=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,s=typeof r=="function"?r():r;if(s==="all"||!s&&!this.#m.size)return!0;const o=new Set(s??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#i).some(c=>{const l=c;return this.#i[l]!==t[l]&&o.has(l)})};this.#S({listeners:n()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#S(t){jn.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#i)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function SM(t,e){return Yr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Gw(t,e){return SM(t,e)||t.state.data!==void 0&&Dy(t,e,e.refetchOnMount)}function Dy(t,e,n){if(Yr(e.enabled,t)!==!1&&Oa(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&w_(t,e)}return!1}function qw(t,e,n,r){return(t!==e||Yr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&w_(t,n)}function w_(t,e){return Yr(e.enabled,t)!==!1&&t.isStaleByTime(Oa(e.staleTime,t))}function CM(t,e){return!Mf(t.getCurrentResult(),e)}function Hw(t){return{onFetch:(e,n)=>{const r=e.options,s=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],c=e.state.data?.pageParams||[];let l={pages:[],pageParams:[]},h=0;const f=async()=>{let p=!1;const g=x=>{Object.defineProperty(x,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},_=QC(e.options,e.fetchOptions),y=async(x,w,S)=>{if(p)return Promise.reject();if(w==null&&x.pages.length)return Promise.resolve(x);const T=(()=>{const H={client:e.client,queryKey:e.queryKey,pageParam:w,direction:S?"backward":"forward",meta:e.options.meta};return g(H),H})(),A=await _(T),{maxPages:M}=e.options,L=S?gM:mM;return{pages:L(x.pages,A,M),pageParams:L(x.pageParams,w,M)}};if(s&&o.length){const x=s==="backward",w=x?EM:Ww,S={pages:o,pageParams:c},E=w(r,S);l=await y(S,E,x)}else{const x=t??o.length;do{const w=h===0?c[0]??r.initialPageParam:Ww(r,l);if(h>0&&w==null)break;l=await y(l,w),h++}while(h<x)}return l};e.options.persister?e.fetchFn=()=>e.options.persister?.(f,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=f}}}function Ww(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function EM(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var TM=class extends ZC{#e;#t;#n;#i;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||eE(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#i?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#i=XC({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(c,l)=>{this.#r({type:"failed",failureCount:c,error:l})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const s=this.state.status==="pending",o=!this.#i.canStart();try{if(s)n();else{this.#r({type:"pending",variables:e,isPaused:o}),await this.#n.config.onMutate?.(e,this,r);const l=await this.options.onMutate?.(e,r);l!==this.state.context&&this.#r({type:"pending",context:l,variables:e,isPaused:o})}const c=await this.#i.start();return await this.#n.config.onSuccess?.(c,e,this.state.context,this,r),await this.options.onSuccess?.(c,e,this.state.context,r),await this.#n.config.onSettled?.(c,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(c,null,e,this.state.context,r),this.#r({type:"success",data:c}),c}catch(c){try{throw await this.#n.config.onError?.(c,e,this.state.context,this,r),await this.options.onError?.(c,e,this.state.context,r),await this.#n.config.onSettled?.(void 0,c,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,c,e,this.state.context,r),c}finally{this.#r({type:"error",error:c})}}finally{this.#n.runNext(this)}}#r(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),jn.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function eE(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var AM=class extends _l{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new TM({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=nf(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=nf(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=nf(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(s=>s.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=nf(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){jn.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Lw(e,n))}findAll(t={}){return this.getAll().filter(e=>Lw(t,e))}notify(t){jn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return jn.batch(()=>Promise.all(t.map(e=>e.continue().catch(ur))))}};function nf(t){return t.options.scope?.id}var jM=class extends _l{#e;#t=void 0;#n;#i;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),Mf(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&Uo(n.mutationKey)!==Uo(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#i=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??eE();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){jn.batch(()=>{if(this.#i&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#i.onSuccess?.(e.data,n,r,s),this.#i.onSettled?.(e.data,null,n,r,s)):e?.type==="error"&&(this.#i.onError?.(e.error,n,r,s),this.#i.onSettled?.(void 0,e.error,n,r,s))}this.listeners.forEach(n=>{n(this.#t)})})}},RM=class extends _l{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,s=e.queryHash??b_(r,e);let o=this.get(s);return o||(o=new xM({client:t,queryKey:r,queryHash:s,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){jn.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>zw(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>zw(t,n)):e}notify(t){jn.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){jn.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){jn.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},IM=class{#e;#t;#n;#i;#r;#a;#o;#s;constructor(t={}){this.#e=t.queryCache||new RM,this.#t=t.mutationCache||new AM,this.#n=t.defaultOptions||{},this.#i=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=x_.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=Of.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#s?.(),this.#s=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(Oa(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,c=dM(e,o);if(c!==void 0)return this.#e.build(this,r).setData(c,{...n,manual:!0})}setQueriesData(t,e,n){return jn.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;jn.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return jn.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=jn.batch(()=>this.#e.findAll(t).map(s=>s.cancel(n)));return Promise.all(r).then(ur).catch(ur)}invalidateQueries(t,e={}){return jn.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=jn.batch(()=>this.#e.findAll(t).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let o=s.fetch(void 0,n);return n.throwOnError||(o=o.catch(ur)),s.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(ur)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(Oa(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(ur).catch(ur)}fetchInfiniteQuery(t){return t.behavior=Hw(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(ur).catch(ur)}ensureInfiniteQueryData(t){return t.behavior=Hw(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return Of.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#i.set(Uo(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#i.values()],n={};return e.forEach(r=>{Ku(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(Uo(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{Ku(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=b_(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===v_&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},tE=R.createContext(void 0),Rt=t=>{const e=R.useContext(tE);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},kM=({client:t,children:e})=>(R.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),d.jsx(tE.Provider,{value:t,children:e})),nE=R.createContext(!1),DM=()=>R.useContext(nE);nE.Provider;function MM(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var OM=R.createContext(MM()),NM=()=>R.useContext(OM),BM=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},PM=t=>{R.useEffect(()=>{t.clearReset()},[t])},zM=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:s})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(s&&t.data===void 0||KC(n,[t.error,r])),LM=t=>{if(t.suspense){const n=s=>s==="static"?s:Math.max(s??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...s)=>n(r(...s)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},UM=(t,e)=>t.isLoading&&t.isFetching&&!e,FM=(t,e)=>t?.suspense&&e.isPending,Qw=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function VM(t,e,n){const r=DM(),s=NM(),o=Rt(),c=o.defaultQueryOptions(t);o.getDefaultOptions().queries?._experimental_beforeQuery?.(c),c._optimisticResults=r?"isRestoring":"optimistic",LM(c),BM(c,s),PM(s);const l=!o.getQueryCache().get(c.queryHash),[h]=R.useState(()=>new e(o,c)),f=h.getOptimisticResult(c),p=!r&&t.subscribed!==!1;if(R.useSyncExternalStore(R.useCallback(g=>{const _=p?h.subscribe(jn.batchCalls(g)):ur;return h.updateResult(),_},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),R.useEffect(()=>{h.setOptions(c)},[c,h]),FM(c,f))throw Qw(c,h,s);if(zM({result:f,errorResetBoundary:s,throwOnError:c.throwOnError,query:o.getQueryCache().get(c.queryHash),suspense:c.suspense}))throw f.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(c,f),c.experimental_prefetchInRender&&!Lo&&UM(f,r)&&(l?Qw(c,h,s):o.getQueryCache().get(c.queryHash)?.promise)?.catch(ur).finally(()=>{h.updateResult()}),c.notifyOnChangeProps?f:h.trackResult(f)}function qo(t,e){return VM(t,wM)}function Tn(t,e){const n=Rt(),[r]=R.useState(()=>new jM(n,t));R.useEffect(()=>{r.setOptions(t)},[r,t]);const s=R.useSyncExternalStore(R.useCallback(c=>r.subscribe(jn.batchCalls(c)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=R.useCallback((c,l)=>{r.mutate(c,l).catch(ur)},[r]);if(s.error&&KC(r.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:o,mutateAsync:s.mutate}}const gi=300*1e3,$M=1800*1e3,Pe=new IM({defaultOptions:{queries:{staleTime:gi,gcTime:$M,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!0},mutations:{retry:1}}});Pe.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const Te={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};function GM({children:t}){return d.jsx(kM,{client:Pe,children:t})}var Kw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Na,rE;(function(){var t;function e(O,j){function B(){}B.prototype=j.prototype,O.F=j.prototype,O.prototype=new B,O.prototype.constructor=O,O.D=function(V,$,k){for(var N=Array(arguments.length-2),D=2;D<arguments.length;D++)N[D-2]=arguments[D];return j.prototype[$].apply(V,N)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(O,j,B){B||(B=0);const V=Array(16);if(typeof j=="string")for(var $=0;$<16;++$)V[$]=j.charCodeAt(B++)|j.charCodeAt(B++)<<8|j.charCodeAt(B++)<<16|j.charCodeAt(B++)<<24;else for($=0;$<16;++$)V[$]=j[B++]|j[B++]<<8|j[B++]<<16|j[B++]<<24;j=O.g[0],B=O.g[1],$=O.g[2];let k=O.g[3],N;N=j+(k^B&($^k))+V[0]+3614090360&4294967295,j=B+(N<<7&4294967295|N>>>25),N=k+($^j&(B^$))+V[1]+3905402710&4294967295,k=j+(N<<12&4294967295|N>>>20),N=$+(B^k&(j^B))+V[2]+606105819&4294967295,$=k+(N<<17&4294967295|N>>>15),N=B+(j^$&(k^j))+V[3]+3250441966&4294967295,B=$+(N<<22&4294967295|N>>>10),N=j+(k^B&($^k))+V[4]+4118548399&4294967295,j=B+(N<<7&4294967295|N>>>25),N=k+($^j&(B^$))+V[5]+1200080426&4294967295,k=j+(N<<12&4294967295|N>>>20),N=$+(B^k&(j^B))+V[6]+2821735955&4294967295,$=k+(N<<17&4294967295|N>>>15),N=B+(j^$&(k^j))+V[7]+4249261313&4294967295,B=$+(N<<22&4294967295|N>>>10),N=j+(k^B&($^k))+V[8]+1770035416&4294967295,j=B+(N<<7&4294967295|N>>>25),N=k+($^j&(B^$))+V[9]+2336552879&4294967295,k=j+(N<<12&4294967295|N>>>20),N=$+(B^k&(j^B))+V[10]+4294925233&4294967295,$=k+(N<<17&4294967295|N>>>15),N=B+(j^$&(k^j))+V[11]+2304563134&4294967295,B=$+(N<<22&4294967295|N>>>10),N=j+(k^B&($^k))+V[12]+1804603682&4294967295,j=B+(N<<7&4294967295|N>>>25),N=k+($^j&(B^$))+V[13]+4254626195&4294967295,k=j+(N<<12&4294967295|N>>>20),N=$+(B^k&(j^B))+V[14]+2792965006&4294967295,$=k+(N<<17&4294967295|N>>>15),N=B+(j^$&(k^j))+V[15]+1236535329&4294967295,B=$+(N<<22&4294967295|N>>>10),N=j+($^k&(B^$))+V[1]+4129170786&4294967295,j=B+(N<<5&4294967295|N>>>27),N=k+(B^$&(j^B))+V[6]+3225465664&4294967295,k=j+(N<<9&4294967295|N>>>23),N=$+(j^B&(k^j))+V[11]+643717713&4294967295,$=k+(N<<14&4294967295|N>>>18),N=B+(k^j&($^k))+V[0]+3921069994&4294967295,B=$+(N<<20&4294967295|N>>>12),N=j+($^k&(B^$))+V[5]+3593408605&4294967295,j=B+(N<<5&4294967295|N>>>27),N=k+(B^$&(j^B))+V[10]+38016083&4294967295,k=j+(N<<9&4294967295|N>>>23),N=$+(j^B&(k^j))+V[15]+3634488961&4294967295,$=k+(N<<14&4294967295|N>>>18),N=B+(k^j&($^k))+V[4]+3889429448&4294967295,B=$+(N<<20&4294967295|N>>>12),N=j+($^k&(B^$))+V[9]+568446438&4294967295,j=B+(N<<5&4294967295|N>>>27),N=k+(B^$&(j^B))+V[14]+3275163606&4294967295,k=j+(N<<9&4294967295|N>>>23),N=$+(j^B&(k^j))+V[3]+4107603335&4294967295,$=k+(N<<14&4294967295|N>>>18),N=B+(k^j&($^k))+V[8]+1163531501&4294967295,B=$+(N<<20&4294967295|N>>>12),N=j+($^k&(B^$))+V[13]+2850285829&4294967295,j=B+(N<<5&4294967295|N>>>27),N=k+(B^$&(j^B))+V[2]+4243563512&4294967295,k=j+(N<<9&4294967295|N>>>23),N=$+(j^B&(k^j))+V[7]+1735328473&4294967295,$=k+(N<<14&4294967295|N>>>18),N=B+(k^j&($^k))+V[12]+2368359562&4294967295,B=$+(N<<20&4294967295|N>>>12),N=j+(B^$^k)+V[5]+4294588738&4294967295,j=B+(N<<4&4294967295|N>>>28),N=k+(j^B^$)+V[8]+2272392833&4294967295,k=j+(N<<11&4294967295|N>>>21),N=$+(k^j^B)+V[11]+1839030562&4294967295,$=k+(N<<16&4294967295|N>>>16),N=B+($^k^j)+V[14]+4259657740&4294967295,B=$+(N<<23&4294967295|N>>>9),N=j+(B^$^k)+V[1]+2763975236&4294967295,j=B+(N<<4&4294967295|N>>>28),N=k+(j^B^$)+V[4]+1272893353&4294967295,k=j+(N<<11&4294967295|N>>>21),N=$+(k^j^B)+V[7]+4139469664&4294967295,$=k+(N<<16&4294967295|N>>>16),N=B+($^k^j)+V[10]+3200236656&4294967295,B=$+(N<<23&4294967295|N>>>9),N=j+(B^$^k)+V[13]+681279174&4294967295,j=B+(N<<4&4294967295|N>>>28),N=k+(j^B^$)+V[0]+3936430074&4294967295,k=j+(N<<11&4294967295|N>>>21),N=$+(k^j^B)+V[3]+3572445317&4294967295,$=k+(N<<16&4294967295|N>>>16),N=B+($^k^j)+V[6]+76029189&4294967295,B=$+(N<<23&4294967295|N>>>9),N=j+(B^$^k)+V[9]+3654602809&4294967295,j=B+(N<<4&4294967295|N>>>28),N=k+(j^B^$)+V[12]+3873151461&4294967295,k=j+(N<<11&4294967295|N>>>21),N=$+(k^j^B)+V[15]+530742520&4294967295,$=k+(N<<16&4294967295|N>>>16),N=B+($^k^j)+V[2]+3299628645&4294967295,B=$+(N<<23&4294967295|N>>>9),N=j+($^(B|~k))+V[0]+4096336452&4294967295,j=B+(N<<6&4294967295|N>>>26),N=k+(B^(j|~$))+V[7]+1126891415&4294967295,k=j+(N<<10&4294967295|N>>>22),N=$+(j^(k|~B))+V[14]+2878612391&4294967295,$=k+(N<<15&4294967295|N>>>17),N=B+(k^($|~j))+V[5]+4237533241&4294967295,B=$+(N<<21&4294967295|N>>>11),N=j+($^(B|~k))+V[12]+1700485571&4294967295,j=B+(N<<6&4294967295|N>>>26),N=k+(B^(j|~$))+V[3]+2399980690&4294967295,k=j+(N<<10&4294967295|N>>>22),N=$+(j^(k|~B))+V[10]+4293915773&4294967295,$=k+(N<<15&4294967295|N>>>17),N=B+(k^($|~j))+V[1]+2240044497&4294967295,B=$+(N<<21&4294967295|N>>>11),N=j+($^(B|~k))+V[8]+1873313359&4294967295,j=B+(N<<6&4294967295|N>>>26),N=k+(B^(j|~$))+V[15]+4264355552&4294967295,k=j+(N<<10&4294967295|N>>>22),N=$+(j^(k|~B))+V[6]+2734768916&4294967295,$=k+(N<<15&4294967295|N>>>17),N=B+(k^($|~j))+V[13]+1309151649&4294967295,B=$+(N<<21&4294967295|N>>>11),N=j+($^(B|~k))+V[4]+4149444226&4294967295,j=B+(N<<6&4294967295|N>>>26),N=k+(B^(j|~$))+V[11]+3174756917&4294967295,k=j+(N<<10&4294967295|N>>>22),N=$+(j^(k|~B))+V[2]+718787259&4294967295,$=k+(N<<15&4294967295|N>>>17),N=B+(k^($|~j))+V[9]+3951481745&4294967295,O.g[0]=O.g[0]+j&4294967295,O.g[1]=O.g[1]+($+(N<<21&4294967295|N>>>11))&4294967295,O.g[2]=O.g[2]+$&4294967295,O.g[3]=O.g[3]+k&4294967295}r.prototype.v=function(O,j){j===void 0&&(j=O.length);const B=j-this.blockSize,V=this.C;let $=this.h,k=0;for(;k<j;){if($==0)for(;k<=B;)s(this,O,k),k+=this.blockSize;if(typeof O=="string"){for(;k<j;)if(V[$++]=O.charCodeAt(k++),$==this.blockSize){s(this,V),$=0;break}}else for(;k<j;)if(V[$++]=O[k++],$==this.blockSize){s(this,V),$=0;break}}this.h=$,this.o+=j},r.prototype.A=function(){var O=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);O[0]=128;for(var j=1;j<O.length-8;++j)O[j]=0;j=this.o*8;for(var B=O.length-8;B<O.length;++B)O[B]=j&255,j/=256;for(this.v(O),O=Array(16),j=0,B=0;B<4;++B)for(let V=0;V<32;V+=8)O[j++]=this.g[B]>>>V&255;return O};function o(O,j){var B=l;return Object.prototype.hasOwnProperty.call(B,O)?B[O]:B[O]=j(O)}function c(O,j){this.h=j;const B=[];let V=!0;for(let $=O.length-1;$>=0;$--){const k=O[$]|0;V&&k==j||(B[$]=k,V=!1)}this.g=B}var l={};function h(O){return-128<=O&&O<128?o(O,function(j){return new c([j|0],j<0?-1:0)}):new c([O|0],O<0?-1:0)}function f(O){if(isNaN(O)||!isFinite(O))return g;if(O<0)return S(f(-O));const j=[];let B=1;for(let V=0;O>=B;V++)j[V]=O/B|0,B*=4294967296;return new c(j,0)}function p(O,j){if(O.length==0)throw Error("number format error: empty string");if(j=j||10,j<2||36<j)throw Error("radix out of range: "+j);if(O.charAt(0)=="-")return S(p(O.substring(1),j));if(O.indexOf("-")>=0)throw Error('number format error: interior "-" character');const B=f(Math.pow(j,8));let V=g;for(let k=0;k<O.length;k+=8){var $=Math.min(8,O.length-k);const N=parseInt(O.substring(k,k+$),j);$<8?($=f(Math.pow(j,$)),V=V.j($).add(f(N))):(V=V.j(B),V=V.add(f(N)))}return V}var g=h(0),_=h(1),y=h(16777216);t=c.prototype,t.m=function(){if(w(this))return-S(this).m();let O=0,j=1;for(let B=0;B<this.g.length;B++){const V=this.i(B);O+=(V>=0?V:4294967296+V)*j,j*=4294967296}return O},t.toString=function(O){if(O=O||10,O<2||36<O)throw Error("radix out of range: "+O);if(x(this))return"0";if(w(this))return"-"+S(this).toString(O);const j=f(Math.pow(O,6));var B=this;let V="";for(;;){const $=M(B,j).g;B=E(B,$.j(j));let k=((B.g.length>0?B.g[0]:B.h)>>>0).toString(O);if(B=$,x(B))return k+V;for(;k.length<6;)k="0"+k;V=k+V}},t.i=function(O){return O<0?0:O<this.g.length?this.g[O]:this.h};function x(O){if(O.h!=0)return!1;for(let j=0;j<O.g.length;j++)if(O.g[j]!=0)return!1;return!0}function w(O){return O.h==-1}t.l=function(O){return O=E(this,O),w(O)?-1:x(O)?0:1};function S(O){const j=O.g.length,B=[];for(let V=0;V<j;V++)B[V]=~O.g[V];return new c(B,~O.h).add(_)}t.abs=function(){return w(this)?S(this):this},t.add=function(O){const j=Math.max(this.g.length,O.g.length),B=[];let V=0;for(let $=0;$<=j;$++){let k=V+(this.i($)&65535)+(O.i($)&65535),N=(k>>>16)+(this.i($)>>>16)+(O.i($)>>>16);V=N>>>16,k&=65535,N&=65535,B[$]=N<<16|k}return new c(B,B[B.length-1]&-2147483648?-1:0)};function E(O,j){return O.add(S(j))}t.j=function(O){if(x(this)||x(O))return g;if(w(this))return w(O)?S(this).j(S(O)):S(S(this).j(O));if(w(O))return S(this.j(S(O)));if(this.l(y)<0&&O.l(y)<0)return f(this.m()*O.m());const j=this.g.length+O.g.length,B=[];for(var V=0;V<2*j;V++)B[V]=0;for(V=0;V<this.g.length;V++)for(let $=0;$<O.g.length;$++){const k=this.i(V)>>>16,N=this.i(V)&65535,D=O.i($)>>>16,X=O.i($)&65535;B[2*V+2*$]+=N*X,T(B,2*V+2*$),B[2*V+2*$+1]+=k*X,T(B,2*V+2*$+1),B[2*V+2*$+1]+=N*D,T(B,2*V+2*$+1),B[2*V+2*$+2]+=k*D,T(B,2*V+2*$+2)}for(O=0;O<j;O++)B[O]=B[2*O+1]<<16|B[2*O];for(O=j;O<2*j;O++)B[O]=0;return new c(B,0)};function T(O,j){for(;(O[j]&65535)!=O[j];)O[j+1]+=O[j]>>>16,O[j]&=65535,j++}function A(O,j){this.g=O,this.h=j}function M(O,j){if(x(j))throw Error("division by zero");if(x(O))return new A(g,g);if(w(O))return j=M(S(O),j),new A(S(j.g),S(j.h));if(w(j))return j=M(O,S(j)),new A(S(j.g),j.h);if(O.g.length>30){if(w(O)||w(j))throw Error("slowDivide_ only works with positive integers.");for(var B=_,V=j;V.l(O)<=0;)B=L(B),V=L(V);var $=H(B,1),k=H(V,1);for(V=H(V,2),B=H(B,2);!x(V);){var N=k.add(V);N.l(O)<=0&&($=$.add(B),k=N),V=H(V,1),B=H(B,1)}return j=E(O,$.j(j)),new A($,j)}for($=g;O.l(j)>=0;){for(B=Math.max(1,Math.floor(O.m()/j.m())),V=Math.ceil(Math.log(B)/Math.LN2),V=V<=48?1:Math.pow(2,V-48),k=f(B),N=k.j(j);w(N)||N.l(O)>0;)B-=V,k=f(B),N=k.j(j);x(k)&&(k=_),$=$.add(k),O=E(O,N)}return new A($,O)}t.B=function(O){return M(this,O).h},t.and=function(O){const j=Math.max(this.g.length,O.g.length),B=[];for(let V=0;V<j;V++)B[V]=this.i(V)&O.i(V);return new c(B,this.h&O.h)},t.or=function(O){const j=Math.max(this.g.length,O.g.length),B=[];for(let V=0;V<j;V++)B[V]=this.i(V)|O.i(V);return new c(B,this.h|O.h)},t.xor=function(O){const j=Math.max(this.g.length,O.g.length),B=[];for(let V=0;V<j;V++)B[V]=this.i(V)^O.i(V);return new c(B,this.h^O.h)};function L(O){const j=O.g.length+1,B=[];for(let V=0;V<j;V++)B[V]=O.i(V)<<1|O.i(V-1)>>>31;return new c(B,O.h)}function H(O,j){const B=j>>5;j%=32;const V=O.g.length-B,$=[];for(let k=0;k<V;k++)$[k]=j>0?O.i(k+B)>>>j|O.i(k+B+1)<<32-j:O.i(k+B);return new c($,O.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,rE=r,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.B,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=f,c.fromString=p,Na=c}).apply(typeof Kw<"u"?Kw:typeof self<"u"?self:typeof window<"u"?window:{});var rf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var iE,Mu,sE,_f,My,aE,oE,cE;(function(){var t,e=Object.defineProperty;function n(b){b=[typeof globalThis=="object"&&globalThis,b,typeof window=="object"&&window,typeof self=="object"&&self,typeof rf=="object"&&rf];for(var I=0;I<b.length;++I){var F=b[I];if(F&&F.Math==Math)return F}throw Error("Cannot find global object")}var r=n(this);function s(b,I){if(I)e:{var F=r;b=b.split(".");for(var Y=0;Y<b.length-1;Y++){var pe=b[Y];if(!(pe in F))break e;F=F[pe]}b=b[b.length-1],Y=F[b],I=I(Y),I!=Y&&I!=null&&e(F,b,{configurable:!0,writable:!0,value:I})}}s("Symbol.dispose",function(b){return b||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(b){return b||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(b){return b||function(I){var F=[],Y;for(Y in I)Object.prototype.hasOwnProperty.call(I,Y)&&F.push([Y,I[Y]]);return F}});var o=o||{},c=this||self;function l(b){var I=typeof b;return I=="object"&&b!=null||I=="function"}function h(b,I,F){return b.call.apply(b.bind,arguments)}function f(b,I,F){return f=h,f.apply(null,arguments)}function p(b,I){var F=Array.prototype.slice.call(arguments,1);return function(){var Y=F.slice();return Y.push.apply(Y,arguments),b.apply(this,Y)}}function g(b,I){function F(){}F.prototype=I.prototype,b.Z=I.prototype,b.prototype=new F,b.prototype.constructor=b,b.Ob=function(Y,pe,ve){for(var ze=Array(arguments.length-2),at=2;at<arguments.length;at++)ze[at-2]=arguments[at];return I.prototype[pe].apply(Y,ze)}}var _=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?b=>b&&AsyncContext.Snapshot.wrap(b):b=>b;function y(b){const I=b.length;if(I>0){const F=Array(I);for(let Y=0;Y<I;Y++)F[Y]=b[Y];return F}return[]}function x(b,I){for(let Y=1;Y<arguments.length;Y++){const pe=arguments[Y];var F=typeof pe;if(F=F!="object"?F:pe?Array.isArray(pe)?"array":F:"null",F=="array"||F=="object"&&typeof pe.length=="number"){F=b.length||0;const ve=pe.length||0;b.length=F+ve;for(let ze=0;ze<ve;ze++)b[F+ze]=pe[ze]}else b.push(pe)}}class w{constructor(I,F){this.i=I,this.j=F,this.h=0,this.g=null}get(){let I;return this.h>0?(this.h--,I=this.g,this.g=I.next,I.next=null):I=this.i(),I}}function S(b){c.setTimeout(()=>{throw b},0)}function E(){var b=O;let I=null;return b.g&&(I=b.g,b.g=b.g.next,b.g||(b.h=null),I.next=null),I}class T{constructor(){this.h=this.g=null}add(I,F){const Y=A.get();Y.set(I,F),this.h?this.h.next=Y:this.g=Y,this.h=Y}}var A=new w(()=>new M,b=>b.reset());class M{constructor(){this.next=this.g=this.h=null}set(I,F){this.h=I,this.g=F,this.next=null}reset(){this.next=this.g=this.h=null}}let L,H=!1,O=new T,j=()=>{const b=Promise.resolve(void 0);L=()=>{b.then(B)}};function B(){for(var b;b=E();){try{b.h.call(b.g)}catch(F){S(F)}var I=A;I.j(b),I.h<100&&(I.h++,b.next=I.g,I.g=b)}H=!1}function V(){this.u=this.u,this.C=this.C}V.prototype.u=!1,V.prototype.dispose=function(){this.u||(this.u=!0,this.N())},V.prototype[Symbol.dispose]=function(){this.dispose()},V.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function $(b,I){this.type=b,this.g=this.target=I,this.defaultPrevented=!1}$.prototype.h=function(){this.defaultPrevented=!0};var k=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var b=!1,I=Object.defineProperty({},"passive",{get:function(){b=!0}});try{const F=()=>{};c.addEventListener("test",F,I),c.removeEventListener("test",F,I)}catch{}return b})();function N(b){return/^[\s\xa0]*$/.test(b)}function D(b,I){$.call(this,b?b.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,b&&this.init(b,I)}g(D,$),D.prototype.init=function(b,I){const F=this.type=b.type,Y=b.changedTouches&&b.changedTouches.length?b.changedTouches[0]:null;this.target=b.target||b.srcElement,this.g=I,I=b.relatedTarget,I||(F=="mouseover"?I=b.fromElement:F=="mouseout"&&(I=b.toElement)),this.relatedTarget=I,Y?(this.clientX=Y.clientX!==void 0?Y.clientX:Y.pageX,this.clientY=Y.clientY!==void 0?Y.clientY:Y.pageY,this.screenX=Y.screenX||0,this.screenY=Y.screenY||0):(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0),this.button=b.button,this.key=b.key||"",this.ctrlKey=b.ctrlKey,this.altKey=b.altKey,this.shiftKey=b.shiftKey,this.metaKey=b.metaKey,this.pointerId=b.pointerId||0,this.pointerType=b.pointerType,this.state=b.state,this.i=b,b.defaultPrevented&&D.Z.h.call(this)},D.prototype.h=function(){D.Z.h.call(this);const b=this.i;b.preventDefault?b.preventDefault():b.returnValue=!1};var X="closure_listenable_"+(Math.random()*1e6|0),K=0;function q(b,I,F,Y,pe){this.listener=b,this.proxy=null,this.src=I,this.type=F,this.capture=!!Y,this.ha=pe,this.key=++K,this.da=this.fa=!1}function te(b){b.da=!0,b.listener=null,b.proxy=null,b.src=null,b.ha=null}function Q(b,I,F){for(const Y in b)I.call(F,b[Y],Y,b)}function ae(b,I){for(const F in b)I.call(void 0,b[F],F,b)}function P(b){const I={};for(const F in b)I[F]=b[F];return I}const G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ee(b,I){let F,Y;for(let pe=1;pe<arguments.length;pe++){Y=arguments[pe];for(F in Y)b[F]=Y[F];for(let ve=0;ve<G.length;ve++)F=G[ve],Object.prototype.hasOwnProperty.call(Y,F)&&(b[F]=Y[F])}}function re(b){this.src=b,this.g={},this.h=0}re.prototype.add=function(b,I,F,Y,pe){const ve=b.toString();b=this.g[ve],b||(b=this.g[ve]=[],this.h++);const ze=ge(b,I,Y,pe);return ze>-1?(I=b[ze],F||(I.fa=!1)):(I=new q(I,this.src,ve,!!Y,pe),I.fa=F,b.push(I)),I};function se(b,I){const F=I.type;if(F in b.g){var Y=b.g[F],pe=Array.prototype.indexOf.call(Y,I,void 0),ve;(ve=pe>=0)&&Array.prototype.splice.call(Y,pe,1),ve&&(te(I),b.g[F].length==0&&(delete b.g[F],b.h--))}}function ge(b,I,F,Y){for(let pe=0;pe<b.length;++pe){const ve=b[pe];if(!ve.da&&ve.listener==I&&ve.capture==!!F&&ve.ha==Y)return pe}return-1}var Ce="closure_lm_"+(Math.random()*1e6|0),ie={};function le(b,I,F,Y,pe){if(Array.isArray(I)){for(let ve=0;ve<I.length;ve++)le(b,I[ve],F,Y,pe);return null}return F=Z(F),b&&b[X]?b.J(I,F,l(Y)?!!Y.capture:!1,pe):Me(b,I,F,!1,Y,pe)}function Me(b,I,F,Y,pe,ve){if(!I)throw Error("Invalid event type");const ze=l(pe)?!!pe.capture:!!pe;let at=ue(b);if(at||(b[Ce]=at=new re(b)),F=at.add(I,F,Y,ze,ve),F.proxy)return F;if(Y=Be(),F.proxy=Y,Y.src=b,Y.listener=F,b.addEventListener)k||(pe=ze),pe===void 0&&(pe=!1),b.addEventListener(I.toString(),Y,pe);else if(b.attachEvent)b.attachEvent(U(I.toString()),Y);else if(b.addListener&&b.removeListener)b.addListener(Y);else throw Error("addEventListener and attachEvent are unavailable.");return F}function Be(){function b(F){return I.call(b.src,b.listener,F)}const I=fe;return b}function Ze(b,I,F,Y,pe){if(Array.isArray(I))for(var ve=0;ve<I.length;ve++)Ze(b,I[ve],F,Y,pe);else Y=l(Y)?!!Y.capture:!!Y,F=Z(F),b&&b[X]?(b=b.i,ve=String(I).toString(),ve in b.g&&(I=b.g[ve],F=ge(I,F,Y,pe),F>-1&&(te(I[F]),Array.prototype.splice.call(I,F,1),I.length==0&&(delete b.g[ve],b.h--)))):b&&(b=ue(b))&&(I=b.g[I.toString()],b=-1,I&&(b=ge(I,F,Y,pe)),(F=b>-1?I[b]:null)&&st(F))}function st(b){if(typeof b!="number"&&b&&!b.da){var I=b.src;if(I&&I[X])se(I.i,b);else{var F=b.type,Y=b.proxy;I.removeEventListener?I.removeEventListener(F,Y,b.capture):I.detachEvent?I.detachEvent(U(F),Y):I.addListener&&I.removeListener&&I.removeListener(Y),(F=ue(I))?(se(F,b),F.h==0&&(F.src=null,I[Ce]=null)):te(b)}}}function U(b){return b in ie?ie[b]:ie[b]="on"+b}function fe(b,I){if(b.da)b=!0;else{I=new D(I,this);const F=b.listener,Y=b.ha||b.src;b.fa&&st(b),b=F.call(Y,I)}return b}function ue(b){return b=b[Ce],b instanceof re?b:null}var J="__closure_events_fn_"+(Math.random()*1e9>>>0);function Z(b){return typeof b=="function"?b:(b[J]||(b[J]=function(I){return b.handleEvent(I)}),b[J])}function oe(){V.call(this),this.i=new re(this),this.M=this,this.G=null}g(oe,V),oe.prototype[X]=!0,oe.prototype.removeEventListener=function(b,I,F,Y){Ze(this,b,I,F,Y)};function Se(b,I){var F,Y=b.G;if(Y)for(F=[];Y;Y=Y.G)F.push(Y);if(b=b.M,Y=I.type||I,typeof I=="string")I=new $(I,b);else if(I instanceof $)I.target=I.target||b;else{var pe=I;I=new $(Y,b),ee(I,pe)}pe=!0;let ve,ze;if(F)for(ze=F.length-1;ze>=0;ze--)ve=I.g=F[ze],pe=xe(ve,Y,!0,I)&&pe;if(ve=I.g=b,pe=xe(ve,Y,!0,I)&&pe,pe=xe(ve,Y,!1,I)&&pe,F)for(ze=0;ze<F.length;ze++)ve=I.g=F[ze],pe=xe(ve,Y,!1,I)&&pe}oe.prototype.N=function(){if(oe.Z.N.call(this),this.i){var b=this.i;for(const I in b.g){const F=b.g[I];for(let Y=0;Y<F.length;Y++)te(F[Y]);delete b.g[I],b.h--}}this.G=null},oe.prototype.J=function(b,I,F,Y){return this.i.add(String(b),I,!1,F,Y)},oe.prototype.K=function(b,I,F,Y){return this.i.add(String(b),I,!0,F,Y)};function xe(b,I,F,Y){if(I=b.i.g[String(I)],!I)return!0;I=I.concat();let pe=!0;for(let ve=0;ve<I.length;++ve){const ze=I[ve];if(ze&&!ze.da&&ze.capture==F){const at=ze.listener,on=ze.ha||ze.src;ze.fa&&se(b.i,ze),pe=at.call(on,Y)!==!1&&pe}}return pe&&!Y.defaultPrevented}function de(b,I){if(typeof b!="function")if(b&&typeof b.handleEvent=="function")b=f(b.handleEvent,b);else throw Error("Invalid listener argument");return Number(I)>2147483647?-1:c.setTimeout(b,I||0)}function Ne(b){b.g=de(()=>{b.g=null,b.i&&(b.i=!1,Ne(b))},b.l);const I=b.h;b.h=null,b.m.apply(null,I)}class Ae extends V{constructor(I,F){super(),this.m=I,this.l=F,this.h=null,this.i=!1,this.g=null}j(I){this.h=arguments,this.g?this.i=!0:Ne(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ie(b){V.call(this),this.h=b,this.g={}}g(Ie,V);var qe=[];function wt(b){Q(b.g,function(I,F){this.g.hasOwnProperty(F)&&st(I)},b),b.g={}}Ie.prototype.N=function(){Ie.Z.N.call(this),wt(this)},Ie.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var it=c.JSON.stringify,Qn=c.JSON.parse,bi=class{stringify(b){return c.JSON.stringify(b,void 0)}parse(b){return c.JSON.parse(b,void 0)}};function ir(){}function vi(){}var xt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function nn(){$.call(this,"d")}g(nn,$);function Kn(){$.call(this,"c")}g(Kn,$);var Et={},Za=null;function $s(){return Za=Za||new oe}Et.Ia="serverreachability";function ec(b){$.call(this,Et.Ia,b)}g(ec,$);function Pr(b){const I=$s();Se(I,new ec(I))}Et.STAT_EVENT="statevent";function xi(b,I){$.call(this,Et.STAT_EVENT,b),this.stat=I}g(xi,$);function Ut(b){const I=$s();Se(I,new xi(I,b))}Et.Ja="timingevent";function sr(b,I){$.call(this,Et.Ja,b),this.size=I}g(sr,$);function wi(b,I){if(typeof b!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){b()},I)}function ti(){this.g=!0}ti.prototype.ua=function(){this.g=!1};function $m(b,I,F,Y,pe,ve){b.info(function(){if(b.g)if(ve){var ze="",at=ve.split("&");for(let Tt=0;Tt<at.length;Tt++){var on=at[Tt].split("=");if(on.length>1){const Kt=on[0];on=on[1];const Fr=Kt.split("_");ze=Fr.length>=2&&Fr[1]=="type"?ze+(Kt+"="+on+"&"):ze+(Kt+"=redacted&")}}}else ze=null;else ze=ve;return"XMLHTTP REQ ("+Y+") [attempt "+pe+"]: "+I+`
`+F+`
`+ze})}function Id(b,I,F,Y,pe,ve,ze){b.info(function(){return"XMLHTTP RESP ("+Y+") [ attempt "+pe+"]: "+I+`
`+F+`
`+ve+" "+ze})}function Si(b,I,F,Y){b.info(function(){return"XMLHTTP TEXT ("+I+"): "+Gm(b,F)+(Y?" "+Y:"")})}function Ja(b,I){b.info(function(){return"TIMEOUT: "+I})}ti.prototype.info=function(){};function Gm(b,I){if(!b.g)return I;if(!I)return null;try{const ve=JSON.parse(I);if(ve){for(b=0;b<ve.length;b++)if(Array.isArray(ve[b])){var F=ve[b];if(!(F.length<2)){var Y=F[1];if(Array.isArray(Y)&&!(Y.length<1)){var pe=Y[0];if(pe!="noop"&&pe!="stop"&&pe!="close")for(let ze=1;ze<Y.length;ze++)Y[ze]=""}}}}return it(ve)}catch{return I}}var eo={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},jl={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Rl;function to(){}g(to,ir),to.prototype.g=function(){return new XMLHttpRequest},Rl=new to;function is(b){return encodeURIComponent(String(b))}function kd(b){var I=1;b=b.split(":");const F=[];for(;I>0&&b.length;)F.push(b.shift()),I--;return b.length&&F.push(b.join(":")),F}function ni(b,I,F,Y){this.j=b,this.i=I,this.l=F,this.S=Y||1,this.V=new Ie(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ri}function ri(){this.i=null,this.g="",this.h=!1}var fn={},Mn={};function Ci(b,I,F){b.M=1,b.A=no(gn(I)),b.u=F,b.R=!0,tc(b,null)}function tc(b,I){b.F=Date.now(),Ei(b),b.B=gn(b.A);var F=b.B,Y=b.S;Array.isArray(Y)||(Y=[String(Y)]),sc(F.i,"t",Y),b.C=0,F=b.j.L,b.h=new ri,b.g=Hd(b.j,F?I:null,!b.u),b.P>0&&(b.O=new Ae(f(b.Y,b,b.g),b.P)),I=b.V,F=b.g,Y=b.ba;var pe="readystatechange";Array.isArray(pe)||(pe&&(qe[0]=pe.toString()),pe=qe);for(let ve=0;ve<pe.length;ve++){const ze=le(F,pe[ve],Y||I.handleEvent,!1,I.h||I);if(!ze)break;I.g[ze.key]=ze}I=b.J?P(b.J):{},b.u?(b.v||(b.v="POST"),I["Content-Type"]="application/x-www-form-urlencoded",b.g.ea(b.B,b.v,b.u,I)):(b.v="GET",b.g.ea(b.B,b.v,null,I)),Pr(),$m(b.i,b.v,b.B,b.l,b.S,b.u)}ni.prototype.ba=function(b){b=b.target;const I=this.O;I&&ai(b)==3?I.j():this.Y(b)},ni.prototype.Y=function(b){try{if(b==this.g)e:{const at=ai(this.g),on=this.g.ya(),Tt=this.g.ca();if(!(at<3)&&(at!=3||this.g&&(this.h.h||this.g.la()||zn(this.g)))){this.K||at!=4||on==7||(on==8||Tt<=0?Pr(3):Pr(2)),Ti(this);var I=this.g.ca();this.X=I;var F=qm(this);if(this.o=I==200,Id(this.i,this.v,this.B,this.l,this.S,at,I),this.o){if(this.U&&!this.L){t:{if(this.g){var Y,pe=this.g;if((Y=pe.g?pe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(Y)){var ve=Y;break t}}ve=null}if(b=ve)Si(this.i,this.l,b,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ai(this,b);else{this.o=!1,this.m=3,Ut(12),Cr(this),zr(this);break e}}if(this.R){b=!0;let Kt;for(;!this.K&&this.C<F.length;)if(Kt=Md(this,F),Kt==Mn){at==4&&(this.m=4,Ut(14),b=!1),Si(this.i,this.l,null,"[Incomplete Response]");break}else if(Kt==fn){this.m=4,Ut(15),Si(this.i,this.l,F,"[Invalid Chunk]"),b=!1;break}else Si(this.i,this.l,Kt,null),Ai(this,Kt);if(Dd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),at!=4||F.length!=0||this.h.h||(this.m=1,Ut(16),b=!1),this.o=this.o&&b,!b)Si(this.i,this.l,F,"[Invalid Chunked Response]"),Cr(this),zr(this);else if(F.length>0&&!this.W){this.W=!0;var ze=this.j;ze.g==this&&ze.aa&&!ze.P&&(ze.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Gl(ze),ze.P=!0,Ut(11))}}else Si(this.i,this.l,F,null),Ai(this,F);at==4&&Cr(this),this.o&&!this.K&&(at==4?Vd(this.j,this):(this.o=!1,Ei(this)))}else as(this.g),I==400&&F.indexOf("Unknown SID")>0?(this.m=3,Ut(12)):(this.m=0,Ut(13)),Cr(this),zr(this)}}}catch{}};function qm(b){if(!Dd(b))return b.g.la();const I=zn(b.g);if(I==="")return"";let F="";const Y=I.length,pe=ai(b.g)==4;if(!b.h.i){if(typeof TextDecoder>"u")return Cr(b),zr(b),"";b.h.i=new c.TextDecoder}for(let ve=0;ve<Y;ve++)b.h.h=!0,F+=b.h.i.decode(I[ve],{stream:!(pe&&ve==Y-1)});return I.length=0,b.h.g+=F,b.C=0,b.h.g}function Dd(b){return b.g?b.v=="GET"&&b.M!=2&&b.j.Aa:!1}function Md(b,I){var F=b.C,Y=I.indexOf(`
`,F);return Y==-1?Mn:(F=Number(I.substring(F,Y)),isNaN(F)?fn:(Y+=1,Y+F>I.length?Mn:(I=I.slice(Y,Y+F),b.C=Y+F,I)))}ni.prototype.cancel=function(){this.K=!0,Cr(this)};function Ei(b){b.T=Date.now()+b.H,nc(b,b.H)}function nc(b,I){if(b.D!=null)throw Error("WatchDog timer not null");b.D=wi(f(b.aa,b),I)}function Ti(b){b.D&&(c.clearTimeout(b.D),b.D=null)}ni.prototype.aa=function(){this.D=null;const b=Date.now();b-this.T>=0?(Ja(this.i,this.B),this.M!=2&&(Pr(),Ut(17)),Cr(this),this.m=2,zr(this)):nc(this,this.T-b)};function zr(b){b.j.I==0||b.K||Vd(b.j,b)}function Cr(b){Ti(b);var I=b.O;I&&typeof I.dispose=="function"&&I.dispose(),b.O=null,wt(b.V),b.g&&(I=b.g,b.g=null,I.abort(),I.dispose())}function Ai(b,I){try{var F=b.j;if(F.I!=0&&(F.g==b||Ri(F.h,b))){if(!b.L&&Ri(F.h,b)&&F.I==3){try{var Y=F.Ba.g.parse(I)}catch{Y=null}if(Array.isArray(Y)&&Y.length==3){var pe=Y;if(pe[0]==0){e:if(!F.v){if(F.g)if(F.g.F+3e3<b.F)uc(F),Xs(F);else break e;lo(F),Ut(18)}}else F.xa=pe[1],0<F.xa-F.K&&pe[2]<37500&&F.F&&F.A==0&&!F.C&&(F.C=wi(f(F.Va,F),6e3));ji(F.h)<=1&&F.ta&&(F.ta=void 0)}else Ni(F,11)}else if((b.L||F.g==b)&&uc(F),!N(I))for(pe=F.Ba.g.parse(I),I=0;I<pe.length;I++){let Tt=pe[I];const Kt=Tt[0];if(!(Kt<=F.K))if(F.K=Kt,Tt=Tt[1],F.I==2)if(Tt[0]=="c"){F.M=Tt[1],F.ba=Tt[2];const Fr=Tt[3];Fr!=null&&(F.ka=Fr,F.j.info("VER="+F.ka));const Bi=Tt[4];Bi!=null&&(F.za=Bi,F.j.info("SVER="+F.za));const oi=Tt[5];oi!=null&&typeof oi=="number"&&oi>0&&(Y=1.5*oi,F.O=Y,F.j.info("backChannelRequestTimeoutMs_="+Y)),Y=F;const ci=b.g;if(ci){const uo=ci.g?ci.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(uo){var ve=Y.h;ve.g||uo.indexOf("spdy")==-1&&uo.indexOf("quic")==-1&&uo.indexOf("h2")==-1||(ve.j=ve.l,ve.g=new Set,ve.h&&(Dl(ve,ve.h),ve.h=null))}if(Y.G){const dc=ci.g?ci.g.getResponseHeader("X-HTTP-Session-Id"):null;dc&&(Y.wa=dc,It(Y.J,Y.G,dc))}}F.I=3,F.l&&F.l.ra(),F.aa&&(F.T=Date.now()-b.F,F.j.info("Handshake RTT: "+F.T+"ms")),Y=F;var ze=b;if(Y.na=qd(Y,Y.L?Y.ba:null,Y.W),ze.L){Ml(Y.h,ze);var at=ze,on=Y.O;on&&(at.H=on),at.D&&(Ti(at),Ei(at)),Y.g=ze}else Ud(Y);F.i.length>0&&Oi(F)}else Tt[0]!="stop"&&Tt[0]!="close"||Ni(F,7);else F.I==3&&(Tt[0]=="stop"||Tt[0]=="close"?Tt[0]=="stop"?Ni(F,7):Vl(F):Tt[0]!="noop"&&F.l&&F.l.qa(Tt),F.A=0)}}Pr(4)}catch{}}var mn=class{constructor(b,I){this.g=b,this.map=I}};function Il(b){this.l=b||10,c.PerformanceNavigationTiming?(b=c.performance.getEntriesByType("navigation"),b=b.length>0&&(b[0].nextHopProtocol=="hq"||b[0].nextHopProtocol=="h2")):b=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=b?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function kl(b){return b.h?!0:b.g?b.g.size>=b.j:!1}function ji(b){return b.h?1:b.g?b.g.size:0}function Ri(b,I){return b.h?b.h==I:b.g?b.g.has(I):!1}function Dl(b,I){b.g?b.g.add(I):b.h=I}function Ml(b,I){b.h&&b.h==I?b.h=null:b.g&&b.g.has(I)&&b.g.delete(I)}Il.prototype.cancel=function(){if(this.i=Ol(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const b of this.g.values())b.cancel();this.g.clear()}};function Ol(b){if(b.h!=null)return b.i.concat(b.h.G);if(b.g!=null&&b.g.size!==0){let I=b.i;for(const F of b.g.values())I=I.concat(F.G);return I}return y(b.i)}var Od=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function rc(b,I){if(b){b=b.split("&");for(let F=0;F<b.length;F++){const Y=b[F].indexOf("=");let pe,ve=null;Y>=0?(pe=b[F].substring(0,Y),ve=b[F].substring(Y+1)):pe=b[F],I(pe,ve?decodeURIComponent(ve.replace(/\+/g," ")):"")}}}function Er(b){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let I;b instanceof Er?(this.l=b.l,On(this,b.j),this.o=b.o,this.g=b.g,Gs(this,b.u),this.h=b.h,Nl(this,zd(b.i)),this.m=b.m):b&&(I=String(b).match(Od))?(this.l=!1,On(this,I[1]||"",!0),this.o=Ii(I[2]||""),this.g=Ii(I[3]||"",!0),Gs(this,I[4]),this.h=Ii(I[5]||"",!0),Nl(this,I[6]||"",!0),this.m=Ii(I[7]||"")):(this.l=!1,this.i=new Hs(null,this.l))}Er.prototype.toString=function(){const b=[];var I=this.j;I&&b.push(ro(I,ic,!0),":");var F=this.g;return(F||I=="file")&&(b.push("//"),(I=this.o)&&b.push(ro(I,ic,!0),"@"),b.push(is(F).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),F=this.u,F!=null&&b.push(":",String(F))),(F=this.h)&&(this.g&&F.charAt(0)!="/"&&b.push("/"),b.push(ro(F,F.charAt(0)=="/"?Bl:Nd,!0))),(F=this.i.toString())&&b.push("?",F),(F=this.m)&&b.push("#",ro(F,Bd)),b.join("")},Er.prototype.resolve=function(b){const I=gn(this);let F=!!b.j;F?On(I,b.j):F=!!b.o,F?I.o=b.o:F=!!b.g,F?I.g=b.g:F=b.u!=null;var Y=b.h;if(F)Gs(I,b.u);else if(F=!!b.h){if(Y.charAt(0)!="/")if(this.g&&!this.h)Y="/"+Y;else{var pe=I.h.lastIndexOf("/");pe!=-1&&(Y=I.h.slice(0,pe+1)+Y)}if(pe=Y,pe==".."||pe==".")Y="";else if(pe.indexOf("./")!=-1||pe.indexOf("/.")!=-1){Y=pe.lastIndexOf("/",0)==0,pe=pe.split("/");const ve=[];for(let ze=0;ze<pe.length;){const at=pe[ze++];at=="."?Y&&ze==pe.length&&ve.push(""):at==".."?((ve.length>1||ve.length==1&&ve[0]!="")&&ve.pop(),Y&&ze==pe.length&&ve.push("")):(ve.push(at),Y=!0)}Y=ve.join("/")}else Y=pe}return F?I.h=Y:F=b.i.toString()!=="",F?Nl(I,zd(b.i)):F=!!b.m,F&&(I.m=b.m),I};function gn(b){return new Er(b)}function On(b,I,F){b.j=F?Ii(I,!0):I,b.j&&(b.j=b.j.replace(/:$/,""))}function Gs(b,I){if(I){if(I=Number(I),isNaN(I)||I<0)throw Error("Bad port number "+I);b.u=I}else b.u=null}function Nl(b,I,F){I instanceof Hs?(b.i=I,ac(b.i,b.l)):(F||(I=ro(I,qs)),b.i=new Hs(I,b.l))}function It(b,I,F){b.i.set(I,F)}function no(b){return It(b,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),b}function Ii(b,I){return b?I?decodeURI(b.replace(/%25/g,"%2525")):decodeURIComponent(b):""}function ro(b,I,F){return typeof b=="string"?(b=encodeURI(b).replace(I,hr),F&&(b=b.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b):null}function hr(b){return b=b.charCodeAt(0),"%"+(b>>4&15).toString(16)+(b&15).toString(16)}var ic=/[#\/\?@]/g,Nd=/[#\?:]/g,Bl=/[#\?]/g,qs=/[#\?@]/g,Bd=/#/g;function Hs(b,I){this.h=this.g=null,this.i=b||null,this.j=!!I}function fr(b){b.g||(b.g=new Map,b.h=0,b.i&&rc(b.i,function(I,F){b.add(decodeURIComponent(I.replace(/\+/g," ")),F)}))}t=Hs.prototype,t.add=function(b,I){fr(this),this.i=null,b=Ws(this,b);let F=this.g.get(b);return F||this.g.set(b,F=[]),F.push(I),this.h+=1,this};function Pd(b,I){fr(b),I=Ws(b,I),b.g.has(I)&&(b.i=null,b.h-=b.g.get(I).length,b.g.delete(I))}function Pl(b,I){return fr(b),I=Ws(b,I),b.g.has(I)}t.forEach=function(b,I){fr(this),this.g.forEach(function(F,Y){F.forEach(function(pe){b.call(I,pe,Y,this)},this)},this)};function zl(b,I){fr(b);let F=[];if(typeof I=="string")Pl(b,I)&&(F=F.concat(b.g.get(Ws(b,I))));else for(b=Array.from(b.g.values()),I=0;I<b.length;I++)F=F.concat(b[I]);return F}t.set=function(b,I){return fr(this),this.i=null,b=Ws(this,b),Pl(this,b)&&(this.h-=this.g.get(b).length),this.g.set(b,[I]),this.h+=1,this},t.get=function(b,I){return b?(b=zl(this,b),b.length>0?String(b[0]):I):I};function sc(b,I,F){Pd(b,I),F.length>0&&(b.i=null,b.g.set(Ws(b,I),y(F)),b.h+=F.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const b=[],I=Array.from(this.g.keys());for(let Y=0;Y<I.length;Y++){var F=I[Y];const pe=is(F);F=zl(this,F);for(let ve=0;ve<F.length;ve++){let ze=pe;F[ve]!==""&&(ze+="="+is(F[ve])),b.push(ze)}}return this.i=b.join("&")};function zd(b){const I=new Hs;return I.i=b.i,b.g&&(I.g=new Map(b.g),I.h=b.h),I}function Ws(b,I){return I=String(I),b.j&&(I=I.toLowerCase()),I}function ac(b,I){I&&!b.j&&(fr(b),b.i=null,b.g.forEach(function(F,Y){const pe=Y.toLowerCase();Y!=pe&&(Pd(this,Y),sc(this,pe,F))},b)),b.j=I}function ii(b,I){const F=new ti;if(c.Image){const Y=new Image;Y.onload=p(Lr,F,"TestLoadImage: loaded",!0,I,Y),Y.onerror=p(Lr,F,"TestLoadImage: error",!1,I,Y),Y.onabort=p(Lr,F,"TestLoadImage: abort",!1,I,Y),Y.ontimeout=p(Lr,F,"TestLoadImage: timeout",!1,I,Y),c.setTimeout(function(){Y.ontimeout&&Y.ontimeout()},1e4),Y.src=b}else I(!1)}function Ll(b,I){const F=new ti,Y=new AbortController,pe=setTimeout(()=>{Y.abort(),Lr(F,"TestPingServer: timeout",!1,I)},1e4);fetch(b,{signal:Y.signal}).then(ve=>{clearTimeout(pe),ve.ok?Lr(F,"TestPingServer: ok",!0,I):Lr(F,"TestPingServer: server error",!1,I)}).catch(()=>{clearTimeout(pe),Lr(F,"TestPingServer: error",!1,I)})}function Lr(b,I,F,Y,pe){try{pe&&(pe.onload=null,pe.onerror=null,pe.onabort=null,pe.ontimeout=null),Y(F)}catch{}}function Qs(){this.g=new bi}function ki(b){this.i=b.Sb||null,this.h=b.ab||!1}g(ki,ir),ki.prototype.g=function(){return new io(this.i,this.h)};function io(b,I){oe.call(this),this.H=b,this.o=I,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(io,oe),t=io.prototype,t.open=function(b,I){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=b,this.D=I,this.readyState=1,si(this)},t.send=function(b){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const I={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};b&&(I.body=b),(this.H||c).fetch(new Request(this.D,I)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Ks(this)),this.readyState=0},t.Pa=function(b){if(this.g&&(this.l=b,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=b.headers,this.readyState=2,si(this)),this.g&&(this.readyState=3,si(this),this.g)))if(this.responseType==="arraybuffer")b.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in b){if(this.j=b.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;oc(this)}else b.text().then(this.Oa.bind(this),this.ga.bind(this))};function oc(b){b.j.read().then(b.Ma.bind(b)).catch(b.ga.bind(b))}t.Ma=function(b){if(this.g){if(this.o&&b.value)this.response.push(b.value);else if(!this.o){var I=b.value?b.value:new Uint8Array(0);(I=this.B.decode(I,{stream:!b.done}))&&(this.response=this.responseText+=I)}b.done?Ks(this):si(this),this.readyState==3&&oc(this)}},t.Oa=function(b){this.g&&(this.response=this.responseText=b,Ks(this))},t.Na=function(b){this.g&&(this.response=b,Ks(this))},t.ga=function(){this.g&&Ks(this)};function Ks(b){b.readyState=4,b.l=null,b.j=null,b.B=null,si(b)}t.setRequestHeader=function(b,I){this.A.append(b,I)},t.getResponseHeader=function(b){return this.h&&this.h.get(b.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const b=[],I=this.h.entries();for(var F=I.next();!F.done;)F=F.value,b.push(F[0]+": "+F[1]),F=I.next();return b.join(`\r
`)};function si(b){b.onreadystatechange&&b.onreadystatechange.call(b)}Object.defineProperty(io.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(b){this.m=b?"include":"same-origin"}});function Ur(b){let I="";return Q(b,function(F,Y){I+=Y,I+=":",I+=F,I+=`\r
`}),I}function so(b,I,F){e:{for(Y in F){var Y=!1;break e}Y=!0}Y||(F=Ur(F),typeof b=="string"?F!=null&&is(F):It(b,I,F))}function Mt(b){oe.call(this),this.headers=new Map,this.L=b||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Mt,oe);var Di=/^https?$/i,Ul=["POST","PUT"];t=Mt.prototype,t.Fa=function(b){this.H=b},t.ea=function(b,I,F,Y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+b);I=I?I.toUpperCase():"GET",this.D=b,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Rl.g(),this.g.onreadystatechange=_(f(this.Ca,this));try{this.B=!0,this.g.open(I,String(b),!0),this.B=!1}catch(ve){ao(this,ve);return}if(b=F||"",F=new Map(this.headers),Y)if(Object.getPrototypeOf(Y)===Object.prototype)for(var pe in Y)F.set(pe,Y[pe]);else if(typeof Y.keys=="function"&&typeof Y.get=="function")for(const ve of Y.keys())F.set(ve,Y.get(ve));else throw Error("Unknown input type for opt_headers: "+String(Y));Y=Array.from(F.keys()).find(ve=>ve.toLowerCase()=="content-type"),pe=c.FormData&&b instanceof c.FormData,!(Array.prototype.indexOf.call(Ul,I,void 0)>=0)||Y||pe||F.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ve,ze]of F)this.g.setRequestHeader(ve,ze);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(b),this.v=!1}catch(ve){ao(this,ve)}};function ao(b,I){b.h=!1,b.g&&(b.j=!0,b.g.abort(),b.j=!1),b.l=I,b.o=5,Fl(b),ss(b)}function Fl(b){b.A||(b.A=!0,Se(b,"complete"),Se(b,"error"))}t.abort=function(b){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=b||7,Se(this,"complete"),Se(this,"abort"),ss(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ss(this,!0)),Mt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?oo(this):this.Xa())},t.Xa=function(){oo(this)};function oo(b){if(b.h&&typeof o<"u"){if(b.v&&ai(b)==4)setTimeout(b.Ca.bind(b),0);else if(Se(b,"readystatechange"),ai(b)==4){b.h=!1;try{const ve=b.ca();e:switch(ve){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var I=!0;break e;default:I=!1}var F;if(!(F=I)){var Y;if(Y=ve===0){let ze=String(b.D).match(Od)[1]||null;!ze&&c.self&&c.self.location&&(ze=c.self.location.protocol.slice(0,-1)),Y=!Di.test(ze?ze.toLowerCase():"")}F=Y}if(F)Se(b,"complete"),Se(b,"success");else{b.o=6;try{var pe=ai(b)>2?b.g.statusText:""}catch{pe=""}b.l=pe+" ["+b.ca()+"]",Fl(b)}}finally{ss(b)}}}}function ss(b,I){if(b.g){b.m&&(clearTimeout(b.m),b.m=null);const F=b.g;b.g=null,I||Se(b,"ready");try{F.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function ai(b){return b.g?b.g.readyState:0}t.ca=function(){try{return ai(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(b){if(this.g){var I=this.g.responseText;return b&&I.indexOf(b)==0&&(I=I.substring(b.length)),Qn(I)}};function zn(b){try{if(!b.g)return null;if("response"in b.g)return b.g.response;switch(b.F){case"":case"text":return b.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in b.g)return b.g.mozResponseArrayBuffer}return null}catch{return null}}function as(b){const I={};b=(b.g&&ai(b)>=2&&b.g.getAllResponseHeaders()||"").split(`\r
`);for(let Y=0;Y<b.length;Y++){if(N(b[Y]))continue;var F=kd(b[Y]);const pe=F[0];if(F=F[1],typeof F!="string")continue;F=F.trim();const ve=I[pe]||[];I[pe]=ve,ve.push(F)}ae(I,function(Y){return Y.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Mi(b,I,F){return F&&F.internalChannelParams&&F.internalChannelParams[b]||I}function Ys(b){this.za=0,this.i=[],this.j=new ti,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Mi("failFast",!1,b),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Mi("baseRetryDelayMs",5e3,b),this.Za=Mi("retryDelaySeedMs",1e4,b),this.Ta=Mi("forwardChannelMaxRetries",2,b),this.va=Mi("forwardChannelRequestTimeoutMs",2e4,b),this.ma=b&&b.xmlHttpFactory||void 0,this.Ua=b&&b.Rb||void 0,this.Aa=b&&b.useFetchStreams||!1,this.O=void 0,this.L=b&&b.supportsCrossDomainXhr||!1,this.M="",this.h=new Il(b&&b.concurrentRequestLimit),this.Ba=new Qs,this.S=b&&b.fastHandshake||!1,this.R=b&&b.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=b&&b.Pb||!1,b&&b.ua&&this.j.ua(),b&&b.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&b&&b.detectBufferingProxy||!1,this.ia=void 0,b&&b.longPollingTimeout&&b.longPollingTimeout>0&&(this.ia=b.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Ys.prototype,t.ka=8,t.I=1,t.connect=function(b,I,F,Y){Ut(0),this.W=b,this.H=I||{},F&&Y!==void 0&&(this.H.OSID=F,this.H.OAID=Y),this.F=this.X,this.J=qd(this,null,this.W),Oi(this)};function Vl(b){if(cc(b),b.I==3){var I=b.V++,F=gn(b.J);if(It(F,"SID",b.M),It(F,"RID",I),It(F,"TYPE","terminate"),co(b,F),I=new ni(b,b.j,I),I.M=2,I.A=no(gn(F)),F=!1,c.navigator&&c.navigator.sendBeacon)try{F=c.navigator.sendBeacon(I.A.toString(),"")}catch{}!F&&c.Image&&(new Image().src=I.A,F=!0),F||(I.g=Hd(I.j,null),I.g.ea(I.A)),I.F=Date.now(),Ei(I)}Gd(b)}function Xs(b){b.g&&(Gl(b),b.g.cancel(),b.g=null)}function cc(b){Xs(b),b.v&&(c.clearTimeout(b.v),b.v=null),uc(b),b.h.cancel(),b.m&&(typeof b.m=="number"&&c.clearTimeout(b.m),b.m=null)}function Oi(b){if(!kl(b.h)&&!b.m){b.m=!0;var I=b.Ea;L||j(),H||(L(),H=!0),O.add(I,b),b.D=0}}function lc(b,I){return ji(b.h)>=b.h.j-(b.m?1:0)?!1:b.m?(b.i=I.G.concat(b.i),!0):b.I==1||b.I==2||b.D>=(b.Sa?0:b.Ta)?!1:(b.m=wi(f(b.Ea,b,I),$d(b,b.D)),b.D++,!0)}t.Ea=function(b){if(this.m)if(this.m=null,this.I==1){if(!b){this.V=Math.floor(Math.random()*1e5),b=this.V++;const pe=new ni(this,this.j,b);let ve=this.o;if(this.U&&(ve?(ve=P(ve),ee(ve,this.U)):ve=this.U),this.u!==null||this.R||(pe.J=ve,ve=null),this.S)e:{for(var I=0,F=0;F<this.i.length;F++){t:{var Y=this.i[F];if("__data__"in Y.map&&(Y=Y.map.__data__,typeof Y=="string")){Y=Y.length;break t}Y=void 0}if(Y===void 0)break;if(I+=Y,I>4096){I=F;break e}if(I===4096||F===this.i.length-1){I=F+1;break e}}I=1e3}else I=1e3;I=Ld(this,pe,I),F=gn(this.J),It(F,"RID",b),It(F,"CVER",22),this.G&&It(F,"X-HTTP-Session-Id",this.G),co(this,F),ve&&(this.R?I="headers="+is(Ur(ve))+"&"+I:this.u&&so(F,this.u,ve)),Dl(this.h,pe),this.Ra&&It(F,"TYPE","init"),this.S?(It(F,"$req",I),It(F,"SID","null"),pe.U=!0,Ci(pe,F,null)):Ci(pe,F,I),this.I=2}}else this.I==3&&(b?$l(this,b):this.i.length==0||kl(this.h)||$l(this))};function $l(b,I){var F;I?F=I.l:F=b.V++;const Y=gn(b.J);It(Y,"SID",b.M),It(Y,"RID",F),It(Y,"AID",b.K),co(b,Y),b.u&&b.o&&so(Y,b.u,b.o),F=new ni(b,b.j,F,b.D+1),b.u===null&&(F.J=b.o),I&&(b.i=I.G.concat(b.i)),I=Ld(b,F,1e3),F.H=Math.round(b.va*.5)+Math.round(b.va*.5*Math.random()),Dl(b.h,F),Ci(F,Y,I)}function co(b,I){b.H&&Q(b.H,function(F,Y){It(I,Y,F)}),b.l&&Q({},function(F,Y){It(I,Y,F)})}function Ld(b,I,F){F=Math.min(b.i.length,F);const Y=b.l?f(b.l.Ka,b.l,b):null;e:{var pe=b.i;let at=-1;for(;;){const on=["count="+F];at==-1?F>0?(at=pe[0].g,on.push("ofs="+at)):at=0:on.push("ofs="+at);let Tt=!0;for(let Kt=0;Kt<F;Kt++){var ve=pe[Kt].g;const Fr=pe[Kt].map;if(ve-=at,ve<0)at=Math.max(0,pe[Kt].g-100),Tt=!1;else try{ve="req"+ve+"_"||"";try{var ze=Fr instanceof Map?Fr:Object.entries(Fr);for(const[Bi,oi]of ze){let ci=oi;l(oi)&&(ci=it(oi)),on.push(ve+Bi+"="+encodeURIComponent(ci))}}catch(Bi){throw on.push(ve+"type="+encodeURIComponent("_badmap")),Bi}}catch{Y&&Y(Fr)}}if(Tt){ze=on.join("&");break e}}ze=void 0}return b=b.i.splice(0,F),I.G=b,ze}function Ud(b){if(!b.g&&!b.v){b.Y=1;var I=b.Da;L||j(),H||(L(),H=!0),O.add(I,b),b.A=0}}function lo(b){return b.g||b.v||b.A>=3?!1:(b.Y++,b.v=wi(f(b.Da,b),$d(b,b.A)),b.A++,!0)}t.Da=function(){if(this.v=null,Fd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var b=4*this.T;this.j.info("BP detection timer enabled: "+b),this.B=wi(f(this.Wa,this),b)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ut(10),Xs(this),Fd(this))};function Gl(b){b.B!=null&&(c.clearTimeout(b.B),b.B=null)}function Fd(b){b.g=new ni(b,b.j,"rpc",b.Y),b.u===null&&(b.g.J=b.o),b.g.P=0;var I=gn(b.na);It(I,"RID","rpc"),It(I,"SID",b.M),It(I,"AID",b.K),It(I,"CI",b.F?"0":"1"),!b.F&&b.ia&&It(I,"TO",b.ia),It(I,"TYPE","xmlhttp"),co(b,I),b.u&&b.o&&so(I,b.u,b.o),b.O&&(b.g.H=b.O);var F=b.g;b=b.ba,F.M=1,F.A=no(gn(I)),F.u=null,F.R=!0,tc(F,b)}t.Va=function(){this.C!=null&&(this.C=null,Xs(this),lo(this),Ut(19))};function uc(b){b.C!=null&&(c.clearTimeout(b.C),b.C=null)}function Vd(b,I){var F=null;if(b.g==I){uc(b),Gl(b),b.g=null;var Y=2}else if(Ri(b.h,I))F=I.G,Ml(b.h,I),Y=1;else return;if(b.I!=0){if(I.o)if(Y==1){F=I.u?I.u.length:0,I=Date.now()-I.F;var pe=b.D;Y=$s(),Se(Y,new sr(Y,F)),Oi(b)}else Ud(b);else if(pe=I.m,pe==3||pe==0&&I.X>0||!(Y==1&&lc(b,I)||Y==2&&lo(b)))switch(F&&F.length>0&&(I=b.h,I.i=I.i.concat(F)),pe){case 1:Ni(b,5);break;case 4:Ni(b,10);break;case 3:Ni(b,6);break;default:Ni(b,2)}}}function $d(b,I){let F=b.Qa+Math.floor(Math.random()*b.Za);return b.isActive()||(F*=2),F*I}function Ni(b,I){if(b.j.info("Error code "+I),I==2){var F=f(b.bb,b),Y=b.Ua;const pe=!Y;Y=new Er(Y||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||On(Y,"https"),no(Y),pe?ii(Y.toString(),F):Ll(Y.toString(),F)}else Ut(2);b.I=0,b.l&&b.l.pa(I),Gd(b),cc(b)}t.bb=function(b){b?(this.j.info("Successfully pinged google.com"),Ut(2)):(this.j.info("Failed to ping google.com"),Ut(1))};function Gd(b){if(b.I=0,b.ja=[],b.l){const I=Ol(b.h);(I.length!=0||b.i.length!=0)&&(x(b.ja,I),x(b.ja,b.i),b.h.i.length=0,y(b.i),b.i.length=0),b.l.oa()}}function qd(b,I,F){var Y=F instanceof Er?gn(F):new Er(F);if(Y.g!="")I&&(Y.g=I+"."+Y.g),Gs(Y,Y.u);else{var pe=c.location;Y=pe.protocol,I=I?I+"."+pe.hostname:pe.hostname,pe=+pe.port;const ve=new Er(null);Y&&On(ve,Y),I&&(ve.g=I),pe&&Gs(ve,pe),F&&(ve.h=F),Y=ve}return F=b.G,I=b.wa,F&&I&&It(Y,F,I),It(Y,"VER",b.ka),co(b,Y),Y}function Hd(b,I,F){if(I&&!b.L)throw Error("Can't create secondary domain capable XhrIo object.");return I=b.Aa&&!b.ma?new Mt(new ki({ab:F})):new Mt(b.ma),I.Fa(b.L),I}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Wd(){}t=Wd.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Zs(){}Zs.prototype.g=function(b,I){return new ar(b,I)};function ar(b,I){oe.call(this),this.g=new Ys(I),this.l=b,this.h=I&&I.messageUrlParams||null,b=I&&I.messageHeaders||null,I&&I.clientProtocolHeaderRequired&&(b?b["X-Client-Protocol"]="webchannel":b={"X-Client-Protocol":"webchannel"}),this.g.o=b,b=I&&I.initMessageHeaders||null,I&&I.messageContentType&&(b?b["X-WebChannel-Content-Type"]=I.messageContentType:b={"X-WebChannel-Content-Type":I.messageContentType}),I&&I.sa&&(b?b["X-WebChannel-Client-Profile"]=I.sa:b={"X-WebChannel-Client-Profile":I.sa}),this.g.U=b,(b=I&&I.Qb)&&!N(b)&&(this.g.u=b),this.A=I&&I.supportsCrossDomainXhr||!1,this.v=I&&I.sendRawJson||!1,(I=I&&I.httpSessionIdParam)&&!N(I)&&(this.g.G=I,b=this.h,b!==null&&I in b&&(b=this.h,I in b&&delete b[I])),this.j=new os(this)}g(ar,oe),ar.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ar.prototype.close=function(){Vl(this.g)},ar.prototype.o=function(b){var I=this.g;if(typeof b=="string"){var F={};F.__data__=b,b=F}else this.v&&(F={},F.__data__=it(b),b=F);I.i.push(new mn(I.Ya++,b)),I.I==3&&Oi(I)},ar.prototype.N=function(){this.g.l=null,delete this.j,Vl(this.g),delete this.g,ar.Z.N.call(this)};function Qd(b){nn.call(this),b.__headers__&&(this.headers=b.__headers__,this.statusCode=b.__status__,delete b.__headers__,delete b.__status__);var I=b.__sm__;if(I){e:{for(const F in I){b=F;break e}b=void 0}(this.i=b)&&(b=this.i,I=I!==null&&b in I?I[b]:void 0),this.data=I}else this.data=b}g(Qd,nn);function Kd(){Kn.call(this),this.status=1}g(Kd,Kn);function os(b){this.g=b}g(os,Wd),os.prototype.ra=function(){Se(this.g,"a")},os.prototype.qa=function(b){Se(this.g,new Qd(b))},os.prototype.pa=function(b){Se(this.g,new Kd)},os.prototype.oa=function(){Se(this.g,"b")},Zs.prototype.createWebChannel=Zs.prototype.g,ar.prototype.send=ar.prototype.o,ar.prototype.open=ar.prototype.m,ar.prototype.close=ar.prototype.close,cE=function(){return new Zs},oE=function(){return $s()},aE=Et,My={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eo.NO_ERROR=0,eo.TIMEOUT=8,eo.HTTP_ERROR=6,_f=eo,jl.COMPLETE="complete",sE=jl,vi.EventType=xt,xt.OPEN="a",xt.CLOSE="b",xt.ERROR="c",xt.MESSAGE="d",oe.prototype.listen=oe.prototype.J,Mu=vi,Mt.prototype.listenOnce=Mt.prototype.K,Mt.prototype.getLastError=Mt.prototype.Ha,Mt.prototype.getLastErrorCode=Mt.prototype.ya,Mt.prototype.getStatus=Mt.prototype.ca,Mt.prototype.getResponseJson=Mt.prototype.La,Mt.prototype.getResponseText=Mt.prototype.la,Mt.prototype.send=Mt.prototype.ea,Mt.prototype.setWithCredentials=Mt.prototype.Fa,iE=Mt}).apply(typeof rf<"u"?rf:typeof self<"u"?self:typeof window<"u"?window:{});const Yw="@firebase/firestore",Xw="4.9.3";class Jn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Jn.UNAUTHENTICATED=new Jn(null),Jn.GOOGLE_CREDENTIALS=new Jn("google-credentials-uid"),Jn.FIRST_PARTY=new Jn("first-party-uid"),Jn.MOCK_USER=new Jn("mock-user");let bl="12.7.0";const Fo=new c_("@firebase/firestore");function Gc(){return Fo.logLevel}function Ue(t,...e){if(Fo.logLevel<=gt.DEBUG){const n=e.map(S_);Fo.debug(`Firestore (${bl}): ${t}`,...n)}}function Ns(t,...e){if(Fo.logLevel<=gt.ERROR){const n=e.map(S_);Fo.error(`Firestore (${bl}): ${t}`,...n)}}function nl(t,...e){if(Fo.logLevel<=gt.WARN){const n=e.map(S_);Fo.warn(`Firestore (${bl}): ${t}`,...n)}}function S_(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Xe(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,lE(t,r,n)}function lE(t,e,n){let r=`FIRESTORE (${bl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Ns(r),new Error(r)}function jt(t,e,n,r){let s="Unexpected state";typeof n=="string"?s=n:r=n,t||lE(e,s,r)}function rt(t,e){return t}const ke={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Le extends Ls{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Is{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class uE{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qM{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Jn.UNAUTHENTICATED)))}shutdown(){}}class HM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class WM{constructor(e){this.t=e,this.currentUser=Jn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){jt(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new Is;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Is,e.enqueueRetryable((()=>s(this.currentUser)))};const c=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},l=h=>{Ue("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit((h=>l(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(Ue("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Is)}}),0),c()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Ue("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(jt(typeof r.accessToken=="string",31837,{l:r}),new uE(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return jt(e===null||typeof e=="string",2055,{h:e}),new Jn(e)}}class QM{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Jn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class KM{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new QM(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Jn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Zw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class YM{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,hi(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){jt(this.o===void 0,3512);const r=o=>{o.error!=null&&Ue("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const c=o.token!==this.m;return this.m=o.token,Ue("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{Ue("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):Ue("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Zw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(jt(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Zw(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function XM(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class C_{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=XM(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<n&&(r+=e.charAt(s[o]%62))}return r}}function pt(t,e){return t<e?-1:t>e?1:0}function Oy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const s=t.charAt(r),o=e.charAt(r);if(s!==o)return ty(s)===ty(o)?pt(s,o):ty(s)?1:-1}return pt(t.length,e.length)}const ZM=55296,JM=57343;function ty(t){const e=t.charCodeAt(0);return e>=ZM&&e<=JM}function rl(t,e,n){return t.length===e.length&&t.every(((r,s)=>n(r,e[s])))}const Jw="__name__";class Vi{constructor(e,n,r){n===void 0?n=0:n>e.length&&Xe(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Xe(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Vi.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Vi?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const o=Vi.compareSegments(e.get(s),n.get(s));if(o!==0)return o}return pt(e.length,n.length)}static compareSegments(e,n){const r=Vi.isNumericId(e),s=Vi.isNumericId(n);return r&&!s?-1:!r&&s?1:r&&s?Vi.extractNumericId(e).compare(Vi.extractNumericId(n)):Oy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Na.fromString(e.substring(4,e.length-2))}}class $t extends Vi{construct(e,n,r){return new $t(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Le(ke.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((s=>s.length>0)))}return new $t(n)}static emptyPath(){return new $t([])}}const eO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qn extends Vi{construct(e,n,r){return new qn(e,n,r)}static isValidIdentifier(e){return eO.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),qn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Jw}static keyField(){return new qn([Jw])}static fromServerFormat(e){const n=[];let r="",s=0;const o=()=>{if(r.length===0)throw new Le(ke.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let c=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new Le(ke.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Le(ke.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else l==="`"?(c=!c,s++):l!=="."||c?(r+=l,s++):(o(),s++)}if(o(),c)throw new Le(ke.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new qn(n)}static emptyPath(){return new qn([])}}class We{constructor(e){this.path=e}static fromPath(e){return new We($t.fromString(e))}static fromName(e){return new We($t.fromString(e).popFirst(5))}static empty(){return new We($t.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&$t.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return $t.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new We(new $t(e.slice()))}}function dE(t,e,n){if(!n)throw new Le(ke.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function tO(t,e,n,r){if(e===!0&&r===!0)throw new Le(ke.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function eS(t){if(!We.isDocumentKey(t))throw new Le(ke.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function tS(t){if(We.isDocumentKey(t))throw new Le(ke.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function hE(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function um(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Xe(12329,{type:typeof t})}function yi(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Le(ke.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=um(t);throw new Le(ke.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Sn(t,e){const n={typeString:t};return e&&(n.value=e),n}function yd(t,e){if(!hE(t))throw new Le(ke.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const c=t[r];if(s&&typeof c!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&c!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Le(ke.INVALID_ARGUMENT,n);return!0}const nS=-62135596800,rS=1e6;class Wt{static now(){return Wt.fromMillis(Date.now())}static fromDate(e){return Wt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*rS);return new Wt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Le(ke.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Le(ke.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<nS)throw new Le(ke.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Le(ke.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/rS}_compareTo(e){return this.seconds===e.seconds?pt(this.nanoseconds,e.nanoseconds):pt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Wt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(yd(e,Wt._jsonSchema))return new Wt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-nS;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Wt._jsonSchemaVersion="firestore/timestamp/1.0",Wt._jsonSchema={type:Sn("string",Wt._jsonSchemaVersion),seconds:Sn("number"),nanoseconds:Sn("number")};class Je{static fromTimestamp(e){return new Je(e)}static min(){return new Je(new Wt(0,0))}static max(){return new Je(new Wt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Yu=-1;function nO(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Je.fromTimestamp(r===1e9?new Wt(n+1,0):new Wt(n,r));return new za(s,We.empty(),e)}function rO(t){return new za(t.readTime,t.key,Yu)}class za{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new za(Je.min(),We.empty(),Yu)}static max(){return new za(Je.max(),We.empty(),Yu)}}function iO(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=We.comparator(t.documentKey,e.documentKey),n!==0?n:pt(t.largestBatchId,e.largestBatchId))}const sO="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class aO{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function vl(t){if(t.code!==ke.FAILED_PRECONDITION||t.message!==sO)throw t;Ue("LocalStore","Unexpectedly lost primary lease")}class Oe{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Xe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new Oe(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,s)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof Oe?n:Oe.resolve(n)}catch(n){return Oe.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):Oe.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):Oe.reject(n)}static resolve(e){return new Oe(((n,r)=>{n(e)}))}static reject(e){return new Oe(((n,r)=>{r(e)}))}static waitFor(e){return new Oe(((n,r)=>{let s=0,o=0,c=!1;e.forEach((l=>{++s,l.next((()=>{++o,c&&o===s&&n()}),(h=>r(h)))})),c=!0,o===s&&n()}))}static or(e){let n=Oe.resolve(!1);for(const r of e)n=n.next((s=>s?Oe.resolve(s):r()));return n}static forEach(e,n){const r=[];return e.forEach(((s,o)=>{r.push(n.call(this,s,o))})),this.waitFor(r)}static mapArray(e,n){return new Oe(((r,s)=>{const o=e.length,c=new Array(o);let l=0;for(let h=0;h<o;h++){const f=h;n(e[f]).next((p=>{c[f]=p,++l,l===o&&r(c)}),(p=>s(p)))}}))}static doWhile(e,n){return new Oe(((r,s)=>{const o=()=>{e()===!0?n().next((()=>{o()}),s):r()};o()}))}}function oO(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function xl(t){return t.name==="IndexedDbTransactionError"}class dm{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}dm.ce=-1;const E_=-1;function hm(t){return t==null}function Nf(t){return t===0&&1/t==-1/0}function cO(t){return typeof t=="number"&&Number.isInteger(t)&&!Nf(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const fE="";function lO(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=iS(e)),e=uO(t.get(n),e);return iS(e)}function uO(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const o=t.charAt(s);switch(o){case"\0":n+="";break;case fE:n+="";break;default:n+=o}}return n}function iS(t){return t+fE+""}function sS(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Wa(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function mE(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class tn{constructor(e,n){this.comparator=e,this.root=n||$n.EMPTY}insert(e,n){return new tn(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,$n.BLACK,null,null))}remove(e){return new tn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,$n.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sf(this.root,e,this.comparator,!1)}getReverseIterator(){return new sf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sf(this.root,e,this.comparator,!0)}}class sf{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class $n{constructor(e,n,r,s,o){this.key=e,this.value=n,this.color=r??$n.RED,this.left=s??$n.EMPTY,this.right=o??$n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,o){return new $n(e??this.key,n??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,n,r),null):o===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return $n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return $n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,$n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,$n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Xe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Xe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Xe(27949);return e+(this.isRed()?0:1)}}$n.EMPTY=null,$n.RED=!0,$n.BLACK=!1;$n.EMPTY=new class{constructor(){this.size=0}get key(){throw Xe(57766)}get value(){throw Xe(16141)}get color(){throw Xe(16727)}get left(){throw Xe(29726)}get right(){throw Xe(36894)}copy(e,n,r,s,o){return this}insert(e,n,r){return new $n(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class In{constructor(e){this.comparator=e,this.data=new tn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new aS(this.data.getIterator())}getIteratorFrom(e){return new aS(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof In)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new In(this.comparator);return n.data=e,n}}class aS{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Mr{constructor(e){this.fields=e,e.sort(qn.comparator)}static empty(){return new Mr([])}unionWith(e){let n=new In(qn.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Mr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return rl(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class gE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Wn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new gE("Invalid base64 string: "+o):o}})(e);return new Wn(n)}static fromUint8Array(e){const n=(function(s){let o="";for(let c=0;c<s.length;++c)o+=String.fromCharCode(s[c]);return o})(e);return new Wn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return pt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Wn.EMPTY_BYTE_STRING=new Wn("");const dO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function La(t){if(jt(!!t,39018),typeof t=="string"){let e=0;const n=dO.exec(t);if(jt(!!n,46558,{timestamp:t}),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:un(t.seconds),nanos:un(t.nanos)}}function un(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ua(t){return typeof t=="string"?Wn.fromBase64String(t):Wn.fromUint8Array(t)}const pE="server_timestamp",yE="__type__",_E="__previous_value__",bE="__local_write_time__";function T_(t){return(t?.mapValue?.fields||{})[yE]?.stringValue===pE}function fm(t){const e=t.mapValue.fields[_E];return T_(e)?fm(e):e}function Xu(t){const e=La(t.mapValue.fields[bE].timestampValue);return new Wt(e.seconds,e.nanos)}class hO{constructor(e,n,r,s,o,c,l,h,f,p){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=c,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=p}}const Bf="(default)";class Zu{constructor(e,n){this.projectId=e,this.database=n||Bf}static empty(){return new Zu("","")}get isDefaultDatabase(){return this.database===Bf}isEqual(e){return e instanceof Zu&&e.projectId===this.projectId&&e.database===this.database}}const vE="__type__",fO="__max__",af={mapValue:{}},xE="__vector__",Pf="value";function Fa(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?T_(t)?4:gO(t)?9007199254740991:mO(t)?10:11:Xe(28295,{value:t})}function es(t,e){if(t===e)return!0;const n=Fa(t);if(n!==Fa(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Xu(t).isEqual(Xu(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const c=La(s.timestampValue),l=La(o.timestampValue);return c.seconds===l.seconds&&c.nanos===l.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(s,o){return Ua(s.bytesValue).isEqual(Ua(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(s,o){return un(s.geoPointValue.latitude)===un(o.geoPointValue.latitude)&&un(s.geoPointValue.longitude)===un(o.geoPointValue.longitude)})(t,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return un(s.integerValue)===un(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const c=un(s.doubleValue),l=un(o.doubleValue);return c===l?Nf(c)===Nf(l):isNaN(c)&&isNaN(l)}return!1})(t,e);case 9:return rl(t.arrayValue.values||[],e.arrayValue.values||[],es);case 10:case 11:return(function(s,o){const c=s.mapValue.fields||{},l=o.mapValue.fields||{};if(sS(c)!==sS(l))return!1;for(const h in c)if(c.hasOwnProperty(h)&&(l[h]===void 0||!es(c[h],l[h])))return!1;return!0})(t,e);default:return Xe(52216,{left:t})}}function Ju(t,e){return(t.values||[]).find((n=>es(n,e)))!==void 0}function il(t,e){if(t===e)return 0;const n=Fa(t),r=Fa(e);if(n!==r)return pt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return pt(t.booleanValue,e.booleanValue);case 2:return(function(o,c){const l=un(o.integerValue||o.doubleValue),h=un(c.integerValue||c.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1})(t,e);case 3:return oS(t.timestampValue,e.timestampValue);case 4:return oS(Xu(t),Xu(e));case 5:return Oy(t.stringValue,e.stringValue);case 6:return(function(o,c){const l=Ua(o),h=Ua(c);return l.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,c){const l=o.split("/"),h=c.split("/");for(let f=0;f<l.length&&f<h.length;f++){const p=pt(l[f],h[f]);if(p!==0)return p}return pt(l.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,c){const l=pt(un(o.latitude),un(c.latitude));return l!==0?l:pt(un(o.longitude),un(c.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return cS(t.arrayValue,e.arrayValue);case 10:return(function(o,c){const l=o.fields||{},h=c.fields||{},f=l[Pf]?.arrayValue,p=h[Pf]?.arrayValue,g=pt(f?.values?.length||0,p?.values?.length||0);return g!==0?g:cS(f,p)})(t.mapValue,e.mapValue);case 11:return(function(o,c){if(o===af.mapValue&&c===af.mapValue)return 0;if(o===af.mapValue)return 1;if(c===af.mapValue)return-1;const l=o.fields||{},h=Object.keys(l),f=c.fields||{},p=Object.keys(f);h.sort(),p.sort();for(let g=0;g<h.length&&g<p.length;++g){const _=Oy(h[g],p[g]);if(_!==0)return _;const y=il(l[h[g]],f[p[g]]);if(y!==0)return y}return pt(h.length,p.length)})(t.mapValue,e.mapValue);default:throw Xe(23264,{he:n})}}function oS(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return pt(t,e);const n=La(t),r=La(e),s=pt(n.seconds,r.seconds);return s!==0?s:pt(n.nanos,r.nanos)}function cS(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const o=il(n[s],r[s]);if(o)return o}return pt(n.length,r.length)}function sl(t){return Ny(t)}function Ny(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=La(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return Ua(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return We.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",s=!0;for(const o of n.values||[])s?s=!1:r+=",",r+=Ny(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let s="{",o=!0;for(const c of r)o?o=!1:s+=",",s+=`${c}:${Ny(n.fields[c])}`;return s+"}"})(t.mapValue):Xe(61005,{value:t})}function bf(t){switch(Fa(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=fm(t);return e?16+bf(e):16;case 5:return 2*t.stringValue.length;case 6:return Ua(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+bf(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let s=0;return Wa(r.fields,((o,c)=>{s+=o.length+bf(c)})),s})(t.mapValue);default:throw Xe(13486,{value:t})}}function lS(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function By(t){return!!t&&"integerValue"in t}function A_(t){return!!t&&"arrayValue"in t}function uS(t){return!!t&&"nullValue"in t}function dS(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function vf(t){return!!t&&"mapValue"in t}function mO(t){return(t?.mapValue?.fields||{})[vE]?.stringValue===xE}function Uu(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Wa(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Uu(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Uu(t.arrayValue.values[n]);return e}return{...t}}function gO(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===fO}class vr{constructor(e){this.value=e}static empty(){return new vr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!vf(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Uu(n)}setAll(e){let n=qn.emptyPath(),r={},s=[];e.forEach(((c,l)=>{if(!n.isImmediateParentOf(l)){const h=this.getFieldsMap(n);this.applyChanges(h,r,s),r={},s=[],n=l.popLast()}c?r[l.lastSegment()]=Uu(c):s.push(l.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,s)}delete(e){const n=this.field(e.popLast());vf(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return es(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];vf(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Wa(n,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new vr(Uu(this.value))}}function wE(t){const e=[];return Wa(t.fields,((n,r)=>{const s=new qn([n]);if(vf(r)){const o=wE(r.mapValue).fields;if(o.length===0)e.push(s);else for(const c of o)e.push(s.child(c))}else e.push(s)})),new Mr(e)}class er{constructor(e,n,r,s,o,c,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=o,this.data=c,this.documentState=l}static newInvalidDocument(e){return new er(e,0,Je.min(),Je.min(),Je.min(),vr.empty(),0)}static newFoundDocument(e,n,r,s){return new er(e,1,n,Je.min(),r,s,0)}static newNoDocument(e,n){return new er(e,2,n,Je.min(),Je.min(),vr.empty(),0)}static newUnknownDocument(e,n){return new er(e,3,n,Je.min(),Je.min(),vr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Je.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=vr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=vr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Je.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof er&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new er(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class zf{constructor(e,n){this.position=e,this.inclusive=n}}function hS(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const o=e[s],c=t.position[s];if(o.field.isKeyField()?r=We.comparator(We.fromName(c.referenceValue),n.key):r=il(c,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function fS(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!es(t.position[n],e.position[n]))return!1;return!0}class Lf{constructor(e,n="asc"){this.field=e,this.dir=n}}function pO(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class SE{}class wn extends SE{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new _O(e,n,r):n==="array-contains"?new xO(e,r):n==="in"?new wO(e,r):n==="not-in"?new SO(e,r):n==="array-contains-any"?new CO(e,r):new wn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new bO(e,r):new vO(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(il(n,this.value)):n!==null&&Fa(this.value)===Fa(n)&&this.matchesComparison(il(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Xe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class _i extends SE{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new _i(e,n)}matches(e){return CE(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function CE(t){return t.op==="and"}function EE(t){return yO(t)&&CE(t)}function yO(t){for(const e of t.filters)if(e instanceof _i)return!1;return!0}function Py(t){if(t instanceof wn)return t.field.canonicalString()+t.op.toString()+sl(t.value);if(EE(t))return t.filters.map((e=>Py(e))).join(",");{const e=t.filters.map((n=>Py(n))).join(",");return`${t.op}(${e})`}}function TE(t,e){return t instanceof wn?(function(r,s){return s instanceof wn&&r.op===s.op&&r.field.isEqual(s.field)&&es(r.value,s.value)})(t,e):t instanceof _i?(function(r,s){return s instanceof _i&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,c,l)=>o&&TE(c,s.filters[l])),!0):!1})(t,e):void Xe(19439)}function AE(t){return t instanceof wn?(function(n){return`${n.field.canonicalString()} ${n.op} ${sl(n.value)}`})(t):t instanceof _i?(function(n){return n.op.toString()+" {"+n.getFilters().map(AE).join(" ,")+"}"})(t):"Filter"}class _O extends wn{constructor(e,n,r){super(e,n,r),this.key=We.fromName(r.referenceValue)}matches(e){const n=We.comparator(e.key,this.key);return this.matchesComparison(n)}}class bO extends wn{constructor(e,n){super(e,"in",n),this.keys=jE("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class vO extends wn{constructor(e,n){super(e,"not-in",n),this.keys=jE("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function jE(t,e){return(e.arrayValue?.values||[]).map((n=>We.fromName(n.referenceValue)))}class xO extends wn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return A_(n)&&Ju(n.arrayValue,this.value)}}class wO extends wn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Ju(this.value.arrayValue,n)}}class SO extends wn{constructor(e,n){super(e,"not-in",n)}matches(e){if(Ju(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Ju(this.value.arrayValue,n)}}class CO extends wn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!A_(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>Ju(this.value.arrayValue,r)))}}class EO{constructor(e,n=null,r=[],s=[],o=null,c=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=c,this.endAt=l,this.Te=null}}function mS(t,e=null,n=[],r=[],s=null,o=null,c=null){return new EO(t,e,n,r,s,o,c)}function j_(t){const e=rt(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>Py(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),hm(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>sl(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>sl(r))).join(",")),e.Te=n}return e.Te}function R_(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!pO(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!TE(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!fS(t.startAt,e.startAt)&&fS(t.endAt,e.endAt)}function zy(t){return We.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class _d{constructor(e,n=null,r=[],s=[],o=null,c="F",l=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=c,this.startAt=l,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function TO(t,e,n,r,s,o,c,l){return new _d(t,e,n,r,s,o,c,l)}function I_(t){return new _d(t)}function gS(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function RE(t){return t.collectionGroup!==null}function Fu(t){const e=rt(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let l=new In(qn.comparator);return c.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(l=l.add(f.field))}))})),l})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Lf(o,r))})),n.has(qn.keyField().canonicalString())||e.Ie.push(new Lf(qn.keyField(),r))}return e.Ie}function Qi(t){const e=rt(t);return e.Ee||(e.Ee=AO(e,Fu(t))),e.Ee}function AO(t,e){if(t.limitType==="F")return mS(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Lf(s.field,o)}));const n=t.endAt?new zf(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new zf(t.startAt.position,t.startAt.inclusive):null;return mS(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Ly(t,e){const n=t.filters.concat([e]);return new _d(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Uy(t,e,n){return new _d(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function mm(t,e){return R_(Qi(t),Qi(e))&&t.limitType===e.limitType}function IE(t){return`${j_(Qi(t))}|lt:${t.limitType}`}function qc(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((s=>AE(s))).join(", ")}]`),hm(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((s=>(function(c){return`${c.field.canonicalString()} (${c.dir})`})(s))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((s=>sl(s))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((s=>sl(s))).join(",")),`Target(${r})`})(Qi(t))}; limitType=${t.limitType})`}function gm(t,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):We.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,s){for(const o of Fu(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(t,e)&&(function(r,s){return!(r.startAt&&!(function(c,l,h){const f=hS(c,l,h);return c.inclusive?f<=0:f<0})(r.startAt,Fu(r),s)||r.endAt&&!(function(c,l,h){const f=hS(c,l,h);return c.inclusive?f>=0:f>0})(r.endAt,Fu(r),s))})(t,e)}function jO(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function kE(t){return(e,n)=>{let r=!1;for(const s of Fu(t)){const o=RO(s,e,n);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function RO(t,e,n){const r=t.field.isKeyField()?We.comparator(e.key,n.key):(function(o,c,l){const h=c.data.field(o),f=l.data.field(o);return h!==null&&f!==null?il(h,f):Xe(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Xe(19790,{direction:t.dir})}}class Ho{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Wa(this.inner,((n,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return mE(this.inner)}size(){return this.innerSize}}const IO=new tn(We.comparator);function Bs(){return IO}const DE=new tn(We.comparator);function Ou(...t){let e=DE;for(const n of t)e=e.insert(n.key,n);return e}function ME(t){let e=DE;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function Mo(){return Vu()}function OE(){return Vu()}function Vu(){return new Ho((t=>t.toString()),((t,e)=>t.isEqual(e)))}const kO=new tn(We.comparator),DO=new In(We.comparator);function yt(...t){let e=DO;for(const n of t)e=e.add(n);return e}const MO=new In(pt);function OO(){return MO}function k_(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Nf(e)?"-0":e}}function NE(t){return{integerValue:""+t}}function NO(t,e){return cO(e)?NE(e):k_(t,e)}class pm{constructor(){this._=void 0}}function BO(t,e,n){return t instanceof Uf?(function(s,o){const c={fields:{[yE]:{stringValue:pE},[bE]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&T_(o)&&(o=fm(o)),o&&(c.fields[_E]=o),{mapValue:c}})(n,e):t instanceof al?PE(t,e):t instanceof ol?zE(t,e):(function(s,o){const c=BE(s,o),l=pS(c)+pS(s.Ae);return By(c)&&By(s.Ae)?NE(l):k_(s.serializer,l)})(t,e)}function PO(t,e,n){return t instanceof al?PE(t,e):t instanceof ol?zE(t,e):n}function BE(t,e){return t instanceof Ff?(function(r){return By(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class Uf extends pm{}class al extends pm{constructor(e){super(),this.elements=e}}function PE(t,e){const n=LE(e);for(const r of t.elements)n.some((s=>es(s,r)))||n.push(r);return{arrayValue:{values:n}}}class ol extends pm{constructor(e){super(),this.elements=e}}function zE(t,e){let n=LE(e);for(const r of t.elements)n=n.filter((s=>!es(s,r)));return{arrayValue:{values:n}}}class Ff extends pm{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function pS(t){return un(t.integerValue||t.doubleValue)}function LE(t){return A_(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class UE{constructor(e,n){this.field=e,this.transform=n}}function zO(t,e){return t.field.isEqual(e.field)&&(function(r,s){return r instanceof al&&s instanceof al||r instanceof ol&&s instanceof ol?rl(r.elements,s.elements,es):r instanceof Ff&&s instanceof Ff?es(r.Ae,s.Ae):r instanceof Uf&&s instanceof Uf})(t.transform,e.transform)}class LO{constructor(e,n){this.version=e,this.transformResults=n}}class xr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new xr}static exists(e){return new xr(void 0,e)}static updateTime(e){return new xr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function xf(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class ym{}function FE(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new _m(t.key,xr.none()):new bd(t.key,t.data,xr.none());{const n=t.data,r=vr.empty();let s=new In(qn.comparator);for(let o of e.fields)if(!s.has(o)){let c=n.field(o);c===null&&o.length>1&&(o=o.popLast(),c=n.field(o)),c===null?r.delete(o):r.set(o,c),s=s.add(o)}return new Qa(t.key,r,new Mr(s.toArray()),xr.none())}}function UO(t,e,n){t instanceof bd?(function(s,o,c){const l=s.value.clone(),h=_S(s.fieldTransforms,o,c.transformResults);l.setAll(h),o.convertToFoundDocument(c.version,l).setHasCommittedMutations()})(t,e,n):t instanceof Qa?(function(s,o,c){if(!xf(s.precondition,o))return void o.convertToUnknownDocument(c.version);const l=_S(s.fieldTransforms,o,c.transformResults),h=o.data;h.setAll(VE(s)),h.setAll(l),o.convertToFoundDocument(c.version,h).setHasCommittedMutations()})(t,e,n):(function(s,o,c){o.convertToNoDocument(c.version).setHasCommittedMutations()})(0,e,n)}function $u(t,e,n,r){return t instanceof bd?(function(o,c,l,h){if(!xf(o.precondition,c))return l;const f=o.value.clone(),p=bS(o.fieldTransforms,h,c);return f.setAll(p),c.convertToFoundDocument(c.version,f).setHasLocalMutations(),null})(t,e,n,r):t instanceof Qa?(function(o,c,l,h){if(!xf(o.precondition,c))return l;const f=bS(o.fieldTransforms,h,c),p=c.data;return p.setAll(VE(o)),p.setAll(f),c.convertToFoundDocument(c.version,p).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((g=>g.field)))})(t,e,n,r):(function(o,c,l){return xf(o.precondition,c)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):l})(t,e,n)}function FO(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),o=BE(r.transform,s||null);o!=null&&(n===null&&(n=vr.empty()),n.set(r.field,o))}return n||null}function yS(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&rl(r,s,((o,c)=>zO(o,c)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class bd extends ym{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Qa extends ym{constructor(e,n,r,s,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function VE(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function _S(t,e,n){const r=new Map;jt(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const o=t[s],c=o.transform,l=e.data.field(o.field);r.set(o.field,PO(c,l,n[s]))}return r}function bS(t,e,n){const r=new Map;for(const s of t){const o=s.transform,c=n.data.field(s.field);r.set(s.field,BO(o,c,e))}return r}class _m extends ym{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class VO extends ym{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class $O{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&UO(o,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=$u(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=$u(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=OE();return this.mutations.forEach((s=>{const o=e.get(s.key),c=o.overlayedDocument;let l=this.applyToLocalView(c,o.mutatedFields);l=n.has(s.key)?null:l;const h=FE(c,l);h!==null&&r.set(s.key,h),c.isValidDocument()||c.convertToNoDocument(Je.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),yt())}isEqual(e){return this.batchId===e.batchId&&rl(this.mutations,e.mutations,((n,r)=>yS(n,r)))&&rl(this.baseMutations,e.baseMutations,((n,r)=>yS(n,r)))}}class D_{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){jt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return kO})();const o=e.mutations;for(let c=0;c<o.length;c++)s=s.insert(o[c].key,r[c].version);return new D_(e,n,r,s)}}class GO{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class qO{constructor(e,n){this.count=e,this.unchangedNames=n}}var xn,bt;function HO(t){switch(t){case ke.OK:return Xe(64938);case ke.CANCELLED:case ke.UNKNOWN:case ke.DEADLINE_EXCEEDED:case ke.RESOURCE_EXHAUSTED:case ke.INTERNAL:case ke.UNAVAILABLE:case ke.UNAUTHENTICATED:return!1;case ke.INVALID_ARGUMENT:case ke.NOT_FOUND:case ke.ALREADY_EXISTS:case ke.PERMISSION_DENIED:case ke.FAILED_PRECONDITION:case ke.ABORTED:case ke.OUT_OF_RANGE:case ke.UNIMPLEMENTED:case ke.DATA_LOSS:return!0;default:return Xe(15467,{code:t})}}function $E(t){if(t===void 0)return Ns("GRPC error has no .code"),ke.UNKNOWN;switch(t){case xn.OK:return ke.OK;case xn.CANCELLED:return ke.CANCELLED;case xn.UNKNOWN:return ke.UNKNOWN;case xn.DEADLINE_EXCEEDED:return ke.DEADLINE_EXCEEDED;case xn.RESOURCE_EXHAUSTED:return ke.RESOURCE_EXHAUSTED;case xn.INTERNAL:return ke.INTERNAL;case xn.UNAVAILABLE:return ke.UNAVAILABLE;case xn.UNAUTHENTICATED:return ke.UNAUTHENTICATED;case xn.INVALID_ARGUMENT:return ke.INVALID_ARGUMENT;case xn.NOT_FOUND:return ke.NOT_FOUND;case xn.ALREADY_EXISTS:return ke.ALREADY_EXISTS;case xn.PERMISSION_DENIED:return ke.PERMISSION_DENIED;case xn.FAILED_PRECONDITION:return ke.FAILED_PRECONDITION;case xn.ABORTED:return ke.ABORTED;case xn.OUT_OF_RANGE:return ke.OUT_OF_RANGE;case xn.UNIMPLEMENTED:return ke.UNIMPLEMENTED;case xn.DATA_LOSS:return ke.DATA_LOSS;default:return Xe(39323,{code:t})}}(bt=xn||(xn={}))[bt.OK=0]="OK",bt[bt.CANCELLED=1]="CANCELLED",bt[bt.UNKNOWN=2]="UNKNOWN",bt[bt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bt[bt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bt[bt.NOT_FOUND=5]="NOT_FOUND",bt[bt.ALREADY_EXISTS=6]="ALREADY_EXISTS",bt[bt.PERMISSION_DENIED=7]="PERMISSION_DENIED",bt[bt.UNAUTHENTICATED=16]="UNAUTHENTICATED",bt[bt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bt[bt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bt[bt.ABORTED=10]="ABORTED",bt[bt.OUT_OF_RANGE=11]="OUT_OF_RANGE",bt[bt.UNIMPLEMENTED=12]="UNIMPLEMENTED",bt[bt.INTERNAL=13]="INTERNAL",bt[bt.UNAVAILABLE=14]="UNAVAILABLE",bt[bt.DATA_LOSS=15]="DATA_LOSS";function WO(){return new TextEncoder}const QO=new Na([4294967295,4294967295],0);function vS(t){const e=WO().encode(t),n=new rE;return n.update(e),new Uint8Array(n.digest())}function xS(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Na([n,r],0),new Na([s,o],0)]}class M_{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Nu(`Invalid padding: ${n}`);if(r<0)throw new Nu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Nu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Nu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=Na.fromNumber(this.ge)}ye(e,n,r){let s=e.add(n.multiply(Na.fromNumber(r)));return s.compare(QO)===1&&(s=new Na([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=vS(e),[r,s]=xS(n);for(let o=0;o<this.hashCount;o++){const c=this.ye(r,s,o);if(!this.we(c))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),c=new M_(o,s,n);return r.forEach((l=>c.insert(l))),c}insert(e){if(this.ge===0)return;const n=vS(e),[r,s]=xS(n);for(let o=0;o<this.hashCount;o++){const c=this.ye(r,s,o);this.Se(c)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Nu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class bm{constructor(e,n,r,s,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,vd.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new bm(Je.min(),s,new tn(pt),Bs(),yt())}}class vd{constructor(e,n,r,s,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new vd(r,n,yt(),yt(),yt())}}class wf{constructor(e,n,r,s){this.be=e,this.removedTargetIds=n,this.key=r,this.De=s}}class GE{constructor(e,n){this.targetId=e,this.Ce=n}}class qE{constructor(e,n,r=Wn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class wS{constructor(){this.ve=0,this.Fe=SS(),this.Me=Wn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=yt(),n=yt(),r=yt();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:Xe(38017,{changeType:o})}})),new vd(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=SS()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,jt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class KO{constructor(e){this.Ge=e,this.ze=new Map,this.je=Bs(),this.Je=of(),this.He=of(),this.Ye=new tn(pt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Xe(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,s)=>{this.rt(s)&&n(s)}))}st(e){const n=e.targetId,r=e.Ce.count,s=this.ot(n);if(s){const o=s.target;if(zy(o))if(r===0){const c=new We(o.path);this.et(n,c,er.newNoDocument(c,Je.min()))}else jt(r===1,20013,{expectedCount:r});else{const c=this._t(n);if(c!==r){const l=this.ut(e),h=l?this.ct(l,e,c):1;if(h!==0){this.it(n);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,f)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=n;let c,l;try{c=Ua(r).toUint8Array()}catch(h){if(h instanceof gE)return nl("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new M_(c,s,o)}catch(h){return nl(h instanceof Nu?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.ge===0?null:l}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let s=0;return r.forEach((o=>{const c=this.Ge.ht(),l=`projects/${c.projectId}/databases/${c.database}/documents/${o.path.canonicalString()}`;e.mightContain(l)||(this.et(n,o,null),s++)})),s}Tt(e){const n=new Map;this.ze.forEach(((o,c)=>{const l=this.ot(c);if(l){if(o.current&&zy(l.target)){const h=new We(l.target.path);this.It(h).has(c)||this.Et(c,h)||this.et(c,h,er.newNoDocument(h,e))}o.Be&&(n.set(c,o.ke()),o.qe())}}));let r=yt();this.He.forEach(((o,c)=>{let l=!0;c.forEachWhile((h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(o))})),this.je.forEach(((o,c)=>c.setReadTime(e)));const s=new bm(e,n,this.Ye,this.je,r);return this.je=Bs(),this.Je=of(),this.He=of(),this.Ye=new tn(pt),s}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,n)?s.Qe(n,1):s.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new wS,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new In(pt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new In(pt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Ue("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new wS),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function of(){return new tn(We.comparator)}function SS(){return new tn(We.comparator)}const YO={asc:"ASCENDING",desc:"DESCENDING"},XO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ZO={and:"AND",or:"OR"};class JO{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Fy(t,e){return t.useProto3Json||hm(e)?e:{value:e}}function Vf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function HE(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function eN(t,e){return Vf(t,e.toTimestamp())}function Ki(t){return jt(!!t,49232),Je.fromTimestamp((function(n){const r=La(n);return new Wt(r.seconds,r.nanos)})(t))}function O_(t,e){return Vy(t,e).canonicalString()}function Vy(t,e){const n=(function(s){return new $t(["projects",s.projectId,"databases",s.database])})(t).child("documents");return e===void 0?n:n.child(e)}function WE(t){const e=$t.fromString(t);return jt(ZE(e),10190,{key:e.toString()}),e}function $y(t,e){return O_(t.databaseId,e.path)}function ny(t,e){const n=WE(e);if(n.get(1)!==t.databaseId.projectId)throw new Le(ke.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Le(ke.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new We(KE(n))}function QE(t,e){return O_(t.databaseId,e)}function tN(t){const e=WE(t);return e.length===4?$t.emptyPath():KE(e)}function Gy(t){return new $t(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function KE(t){return jt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function CS(t,e,n){return{name:$y(t,e),fields:n.value.mapValue.fields}}function nN(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:Xe(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(f,p){return f.useProto3Json?(jt(p===void 0||typeof p=="string",58123),Wn.fromBase64String(p||"")):(jt(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Wn.fromUint8Array(p||new Uint8Array))})(t,e.targetChange.resumeToken),c=e.targetChange.cause,l=c&&(function(f){const p=f.code===void 0?ke.UNKNOWN:$E(f.code);return new Le(p,f.message||"")})(c);n=new qE(r,s,o,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=ny(t,r.document.name),o=Ki(r.document.updateTime),c=r.document.createTime?Ki(r.document.createTime):Je.min(),l=new vr({mapValue:{fields:r.document.fields}}),h=er.newFoundDocument(s,o,c,l),f=r.targetIds||[],p=r.removedTargetIds||[];n=new wf(f,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=ny(t,r.document),o=r.readTime?Ki(r.readTime):Je.min(),c=er.newNoDocument(s,o),l=r.removedTargetIds||[];n=new wf([],l,c.key,c)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=ny(t,r.document),o=r.removedTargetIds||[];n=new wf([],o,s,null)}else{if(!("filter"in e))return Xe(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,c=new qO(s,o),l=r.targetId;n=new GE(l,c)}}return n}function rN(t,e){let n;if(e instanceof bd)n={update:CS(t,e.key,e.value)};else if(e instanceof _m)n={delete:$y(t,e.key)};else if(e instanceof Qa)n={update:CS(t,e.key,e.data),updateMask:hN(e.fieldMask)};else{if(!(e instanceof VO))return Xe(16599,{Vt:e.type});n={verify:$y(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,c){const l=c.transform;if(l instanceof Uf)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof al)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof ol)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ff)return{fieldPath:c.field.canonicalString(),increment:l.Ae};throw Xe(20930,{transform:c.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:eN(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Xe(27497)})(t,e.precondition)),n}function iN(t,e){return t&&t.length>0?(jt(e!==void 0,14353),t.map((n=>(function(s,o){let c=s.updateTime?Ki(s.updateTime):Ki(o);return c.isEqual(Je.min())&&(c=Ki(o)),new LO(c,s.transformResults||[])})(n,e)))):[]}function sN(t,e){return{documents:[QE(t,e.path)]}}function aN(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=QE(t,s);const o=(function(f){if(f.length!==0)return XE(_i.create(f,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const c=(function(f){if(f.length!==0)return f.map((p=>(function(_){return{field:Hc(_.field),direction:lN(_.dir)}})(p)))})(e.orderBy);c&&(n.structuredQuery.orderBy=c);const l=Fy(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:n,parent:s}}function oN(t){let e=tN(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){jt(r===1,65062);const p=n.from[0];p.allDescendants?s=p.collectionId:e=e.child(p.collectionId)}let o=[];n.where&&(o=(function(g){const _=YE(g);return _ instanceof _i&&EE(_)?_.getFilters():[_]})(n.where));let c=[];n.orderBy&&(c=(function(g){return g.map((_=>(function(x){return new Lf(Wc(x.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(x.direction))})(_)))})(n.orderBy));let l=null;n.limit&&(l=(function(g){let _;return _=typeof g=="object"?g.value:g,hm(_)?null:_})(n.limit));let h=null;n.startAt&&(h=(function(g){const _=!!g.before,y=g.values||[];return new zf(y,_)})(n.startAt));let f=null;return n.endAt&&(f=(function(g){const _=!g.before,y=g.values||[];return new zf(y,_)})(n.endAt)),TO(e,s,c,o,l,"F",h,f)}function cN(t,e){const n=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Xe(28987,{purpose:s})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function YE(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Wc(n.unaryFilter.field);return wn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Wc(n.unaryFilter.field);return wn.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Wc(n.unaryFilter.field);return wn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const c=Wc(n.unaryFilter.field);return wn.create(c,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Xe(61313);default:return Xe(60726)}})(t):t.fieldFilter!==void 0?(function(n){return wn.create(Wc(n.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Xe(58110);default:return Xe(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return _i.create(n.compositeFilter.filters.map((r=>YE(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Xe(1026)}})(n.compositeFilter.op))})(t):Xe(30097,{filter:t})}function lN(t){return YO[t]}function uN(t){return XO[t]}function dN(t){return ZO[t]}function Hc(t){return{fieldPath:t.canonicalString()}}function Wc(t){return qn.fromServerFormat(t.fieldPath)}function XE(t){return t instanceof wn?(function(n){if(n.op==="=="){if(dS(n.value))return{unaryFilter:{field:Hc(n.field),op:"IS_NAN"}};if(uS(n.value))return{unaryFilter:{field:Hc(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(dS(n.value))return{unaryFilter:{field:Hc(n.field),op:"IS_NOT_NAN"}};if(uS(n.value))return{unaryFilter:{field:Hc(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Hc(n.field),op:uN(n.op),value:n.value}}})(t):t instanceof _i?(function(n){const r=n.getFilters().map((s=>XE(s)));return r.length===1?r[0]:{compositeFilter:{op:dN(n.op),filters:r}}})(t):Xe(54877,{filter:t})}function hN(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function ZE(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class Aa{constructor(e,n,r,s,o=Je.min(),c=Je.min(),l=Wn.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(e){return new Aa(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Aa(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Aa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Aa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class fN{constructor(e){this.yt=e}}function mN(t){const e=oN({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Uy(e,e.limit,"L"):e}class gN{constructor(){this.Cn=new pN}addToCollectionParentIndex(e,n){return this.Cn.add(n),Oe.resolve()}getCollectionParents(e,n){return Oe.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return Oe.resolve()}deleteFieldIndex(e,n){return Oe.resolve()}deleteAllFieldIndexes(e){return Oe.resolve()}createTargetIndexes(e,n){return Oe.resolve()}getDocumentsMatchingTarget(e,n){return Oe.resolve(null)}getIndexType(e,n){return Oe.resolve(0)}getFieldIndexes(e,n){return Oe.resolve([])}getNextCollectionGroupToUpdate(e){return Oe.resolve(null)}getMinOffset(e,n){return Oe.resolve(za.min())}getMinOffsetFromCollectionGroup(e,n){return Oe.resolve(za.min())}updateCollectionGroup(e,n,r){return Oe.resolve()}updateIndexEntries(e,n){return Oe.resolve()}}class pN{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new In($t.comparator),o=!s.has(r);return this.index[n]=s.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new In($t.comparator)).toArray()}}const ES={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},JE=41943040;class br{static withCacheSize(e){return new br(e,br.DEFAULT_COLLECTION_PERCENTILE,br.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}br.DEFAULT_COLLECTION_PERCENTILE=10,br.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,br.DEFAULT=new br(JE,br.DEFAULT_COLLECTION_PERCENTILE,br.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),br.DISABLED=new br(-1,0,0);class cl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new cl(0)}static cr(){return new cl(-1)}}const TS="LruGarbageCollector",yN=1048576;function AS([t,e],[n,r]){const s=pt(t,n);return s===0?pt(e,r):s}class _N{constructor(e){this.Ir=e,this.buffer=new In(AS),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();AS(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class bN{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ue(TS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){xl(n)?Ue(TS,"Ignoring IndexedDB error during garbage collection: ",n):await vl(n)}await this.Vr(3e5)}))}}class vN{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return Oe.resolve(dm.ce);const r=new _N(n);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Ue("LruGarbageCollector","Garbage collection skipped; disabled"),Oe.resolve(ES)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Ue("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ES):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,s,o,c,l,h,f;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Ue("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,c=Date.now(),this.nthSequenceNumber(e,s)))).next((g=>(r=g,l=Date.now(),this.removeTargets(e,r,n)))).next((g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(f=Date.now(),Gc()<=gt.DEBUG&&Ue("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${c-p}ms
	Determined least recently used ${s} in `+(l-c)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${g} documents in `+(f-h)+`ms
Total Duration: ${f-p}ms`),Oe.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:g}))))}}function xN(t,e){return new vN(t,e)}class wN{constructor(){this.changes=new Ho((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,er.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?Oe.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class SN{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class CN{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,n)))).next((s=>(r!==null&&$u(r.mutation,s,Mr.empty(),Wt.now()),s)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,yt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=yt()){const s=Mo();return this.populateOverlays(e,s,n).next((()=>this.computeViews(e,n,s,r).next((o=>{let c=Ou();return o.forEach(((l,h)=>{c=c.insert(l,h.overlayedDocument)})),c}))))}getOverlayedDocuments(e,n){const r=Mo();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,yt())))}populateOverlays(e,n,r){const s=[];return r.forEach((o=>{n.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((c,l)=>{n.set(c,l)}))}))}computeViews(e,n,r,s){let o=Bs();const c=Vu(),l=(function(){return Vu()})();return n.forEach(((h,f)=>{const p=r.get(f.key);s.has(f.key)&&(p===void 0||p.mutation instanceof Qa)?o=o.insert(f.key,f):p!==void 0?(c.set(f.key,p.mutation.getFieldMask()),$u(p.mutation,f,p.mutation.getFieldMask(),Wt.now())):c.set(f.key,Mr.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((f,p)=>c.set(f,p))),n.forEach(((f,p)=>l.set(f,new SN(p,c.get(f)??null)))),l)))}recalculateAndSaveOverlays(e,n){const r=Vu();let s=new tn(((c,l)=>c-l)),o=yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((c=>{for(const l of c)l.keys().forEach((h=>{const f=n.get(h);if(f===null)return;let p=r.get(h)||Mr.empty();p=l.applyToLocalView(f,p),r.set(h,p);const g=(s.get(l.batchId)||yt()).add(h);s=s.insert(l.batchId,g)}))})).next((()=>{const c=[],l=s.getReverseIterator();for(;l.hasNext();){const h=l.getNext(),f=h.key,p=h.value,g=OE();p.forEach((_=>{if(!o.has(_)){const y=FE(n.get(_),r.get(_));y!==null&&g.set(_,y),o=o.add(_)}})),c.push(this.documentOverlayCache.saveOverlays(e,f,g))}return Oe.waitFor(c)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,s){return(function(c){return We.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):RE(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next((o=>{const c=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-o.size):Oe.resolve(Mo());let l=Yu,h=o;return c.next((f=>Oe.forEach(f,((p,g)=>(l<g.largestBatchId&&(l=g.largestBatchId),o.get(p)?Oe.resolve():this.remoteDocumentCache.getEntry(e,p).next((_=>{h=h.insert(p,_)}))))).next((()=>this.populateOverlays(e,f,o))).next((()=>this.computeViews(e,h,f,yt()))).next((p=>({batchId:l,changes:ME(p)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new We(n)).next((r=>{let s=Ou();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const o=n.collectionGroup;let c=Ou();return this.indexManager.getCollectionParents(e,o).next((l=>Oe.forEach(l,(h=>{const f=(function(g,_){return new _d(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,s).next((p=>{p.forEach(((g,_)=>{c=c.insert(g,_)}))}))})).next((()=>c))))}getDocumentsMatchingCollectionQuery(e,n,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((c=>(o=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,s)))).next((c=>{o.forEach(((h,f)=>{const p=f.getKey();c.get(p)===null&&(c=c.insert(p,er.newInvalidDocument(p)))}));let l=Ou();return c.forEach(((h,f)=>{const p=o.get(h);p!==void 0&&$u(p.mutation,f,Mr.empty(),Wt.now()),gm(n,f)&&(l=l.insert(h,f))})),l}))}}class EN{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return Oe.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(s){return{id:s.id,version:s.version,createTime:Ki(s.createTime)}})(n)),Oe.resolve()}getNamedQuery(e,n){return Oe.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(s){return{name:s.name,query:mN(s.bundledQuery),readTime:Ki(s.readTime)}})(n)),Oe.resolve()}}class TN{constructor(){this.overlays=new tn(We.comparator),this.qr=new Map}getOverlay(e,n){return Oe.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Mo();return Oe.forEach(n,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((s,o)=>{this.St(e,n,o)})),Oe.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),Oe.resolve()}getOverlaysForCollection(e,n,r){const s=Mo(),o=n.length+1,c=new We(n.child("")),l=this.overlays.getIteratorFrom(c);for(;l.hasNext();){const h=l.getNext().value,f=h.getKey();if(!n.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return Oe.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let o=new tn(((f,p)=>f-p));const c=this.overlays.getIterator();for(;c.hasNext();){const f=c.getNext().value;if(f.getKey().getCollectionGroup()===n&&f.largestBatchId>r){let p=o.get(f.largestBatchId);p===null&&(p=Mo(),o=o.insert(f.largestBatchId,p)),p.set(f.getKey(),f)}}const l=Mo(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,p)=>l.set(f,p))),!(l.size()>=s)););return Oe.resolve(l)}St(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const c=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,c)}this.overlays=this.overlays.insert(r.key,new GO(n,r));let o=this.qr.get(n);o===void 0&&(o=yt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class AN{constructor(){this.sessionToken=Wn.EMPTY_BYTE_STRING}getSessionToken(e){return Oe.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,Oe.resolve()}}class N_{constructor(){this.Qr=new In(Bn.$r),this.Ur=new In(Bn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Bn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new Bn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new We(new $t([])),r=new Bn(n,e),s=new Bn(n,e+1),o=[];return this.Ur.forEachInRange([r,s],(c=>{this.Gr(c),o.push(c.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new We(new $t([])),r=new Bn(n,e),s=new Bn(n,e+1);let o=yt();return this.Ur.forEachInRange([r,s],(c=>{o=o.add(c.key)})),o}containsKey(e){const n=new Bn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Bn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return We.comparator(e.key,n.key)||pt(e.Yr,n.Yr)}static Kr(e,n){return pt(e.Yr,n.Yr)||We.comparator(e.key,n.key)}}class jN{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new In(Bn.$r)}checkEmpty(e){return Oe.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const c=new $O(o,n,r,s);this.mutationQueue.push(c);for(const l of s)this.Zr=this.Zr.add(new Bn(l.key,o)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return Oe.resolve(c)}lookupMutationBatch(e,n){return Oe.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.ei(r),o=s<0?0:s;return Oe.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return Oe.resolve(this.mutationQueue.length===0?E_:this.tr-1)}getAllMutationBatches(e){return Oe.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Bn(n,0),s=new Bn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(c=>{const l=this.Xr(c.Yr);o.push(l)})),Oe.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new In(pt);return n.forEach((s=>{const o=new Bn(s,0),c=new Bn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,c],(l=>{r=r.add(l.Yr)}))})),Oe.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let o=r;We.isDocumentKey(o)||(o=o.child(""));const c=new Bn(new We(o),0);let l=new In(pt);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(l=l.add(h.Yr)),!0)}),c),Oe.resolve(this.ti(l))}ti(e){const n=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&n.push(s)})),n}removeMutationBatch(e,n){jt(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return Oe.forEach(n.mutations,(s=>{const o=new Bn(s.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new Bn(n,0),s=this.Zr.firstAfterOrEqual(r);return Oe.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,Oe.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class RN{constructor(e){this.ri=e,this.docs=(function(){return new tn(We.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),o=s?s.size:0,c=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:c}),this.size+=c-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return Oe.resolve(r?r.document.mutableCopy():er.newInvalidDocument(n))}getEntries(e,n){let r=Bs();return n.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():er.newInvalidDocument(s))})),Oe.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let o=Bs();const c=n.path,l=new We(c.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){const{key:f,value:{document:p}}=h.getNext();if(!c.isPrefixOf(f.path))break;f.path.length>c.length+1||iO(rO(p),r)<=0||(s.has(p.key)||gm(n,p))&&(o=o.insert(p.key,p.mutableCopy()))}return Oe.resolve(o)}getAllFromCollectionGroup(e,n,r,s){Xe(9500)}ii(e,n){return Oe.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new IN(this)}getSize(e){return Oe.resolve(this.size)}}class IN extends wN{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?n.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),Oe.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class kN{constructor(e){this.persistence=e,this.si=new Ho((n=>j_(n)),R_),this.lastRemoteSnapshotVersion=Je.min(),this.highestTargetId=0,this.oi=0,this._i=new N_,this.targetCount=0,this.ai=cl.ur()}forEachTarget(e,n){return this.si.forEach(((r,s)=>n(s))),Oe.resolve()}getLastRemoteSnapshotVersion(e){return Oe.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Oe.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Oe.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),Oe.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new cl(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,Oe.resolve()}updateTargetData(e,n){return this.Pr(n),Oe.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,Oe.resolve()}removeTargets(e,n,r){let s=0;const o=[];return this.si.forEach(((c,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.si.delete(c),o.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),Oe.waitFor(o).next((()=>s))}getTargetCount(e){return Oe.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return Oe.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),Oe.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const s=this.persistence.referenceDelegate,o=[];return s&&n.forEach((c=>{o.push(s.markPotentiallyOrphaned(e,c))})),Oe.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),Oe.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return Oe.resolve(r)}containsKey(e,n){return Oe.resolve(this._i.containsKey(n))}}class eT{constructor(e,n){this.ui={},this.overlays={},this.ci=new dm(0),this.li=!1,this.li=!0,this.hi=new AN,this.referenceDelegate=e(this),this.Pi=new kN(this),this.indexManager=new gN,this.remoteDocumentCache=(function(s){return new RN(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new fN(n),this.Ii=new EN(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new TN,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new jN(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Ue("MemoryPersistence","Starting transaction:",e);const s=new DN(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(e,n){return Oe.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class DN extends aO{constructor(e){super(),this.currentSequenceNumber=e}}class B_{constructor(e){this.persistence=e,this.Ri=new N_,this.Vi=null}static mi(e){return new B_(e)}get fi(){if(this.Vi)return this.Vi;throw Xe(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),Oe.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),Oe.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),Oe.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Oe.forEach(this.fi,(r=>{const s=We.fromPath(r);return this.gi(e,s).next((o=>{o||n.removeEntry(s,Je.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return Oe.or([()=>Oe.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class $f{constructor(e,n){this.persistence=e,this.pi=new Ho((r=>lO(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=xN(this,n)}static mi(e,n){return new $f(e,n)}Ei(){}di(e){return Oe.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((s=>r+s))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return Oe.forEach(this.pi,((r,s)=>this.br(e,r,s).next((o=>o?Oe.resolve():n(s)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(e,(c=>this.br(e,c,n).next((l=>{l||(r++,o.removeEntry(c,Je.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),Oe.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),Oe.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),Oe.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),Oe.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=bf(e.data.value)),n}br(e,n,r){return Oe.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.pi.get(n);return Oe.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class P_{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=s}static As(e,n){let r=yt(),s=yt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new P_(e,n.fromCache,r,s)}}class MN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ON{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return AI()?8:oO(tr())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,s){const o={result:null};return this.ys(e,n).next((c=>{o.result=c})).next((()=>{if(!o.result)return this.ws(e,n,s,r).next((c=>{o.result=c}))})).next((()=>{if(o.result)return;const c=new MN;return this.Ss(e,n,c).next((l=>{if(o.result=l,this.Vs)return this.bs(e,n,c,l.size)}))})).next((()=>o.result))}bs(e,n,r,s){return r.documentReadCount<this.fs?(Gc()<=gt.DEBUG&&Ue("QueryEngine","SDK will not create cache indexes for query:",qc(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Oe.resolve()):(Gc()<=gt.DEBUG&&Ue("QueryEngine","Query:",qc(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Gc()<=gt.DEBUG&&Ue("QueryEngine","The SDK decides to create cache indexes for query:",qc(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qi(n))):Oe.resolve())}ys(e,n){if(gS(n))return Oe.resolve(null);let r=Qi(n);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(n.limit!==null&&s===1&&(n=Uy(n,null,"F"),r=Qi(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const c=yt(...o);return this.ps.getDocuments(e,c).next((l=>this.indexManager.getMinOffset(e,r).next((h=>{const f=this.Ds(n,l);return this.Cs(n,f,c,h.readTime)?this.ys(e,Uy(n,null,"F")):this.vs(e,f,n,h)}))))})))))}ws(e,n,r,s){return gS(n)||s.isEqual(Je.min())?Oe.resolve(null):this.ps.getDocuments(e,r).next((o=>{const c=this.Ds(n,o);return this.Cs(n,c,r,s)?Oe.resolve(null):(Gc()<=gt.DEBUG&&Ue("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),qc(n)),this.vs(e,c,n,nO(s,Yu)).next((l=>l)))}))}Ds(e,n){let r=new In(kE(e));return n.forEach(((s,o)=>{gm(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(e,n,r){return Gc()<=gt.DEBUG&&Ue("QueryEngine","Using full collection scan to execute query:",qc(n)),this.ps.getDocumentsMatchingQuery(e,n,za.min(),r)}vs(e,n,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((o=>(n.forEach((c=>{o=o.insert(c.key,c)})),o)))}}const z_="LocalStore",NN=3e8;class BN{constructor(e,n,r,s){this.persistence=e,this.Fs=n,this.serializer=s,this.Ms=new tn(pt),this.xs=new Ho((o=>j_(o)),R_),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new CN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function PN(t,e,n,r){return new BN(t,e,n,r)}async function tT(t,e){const n=rt(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const c=[],l=[];let h=yt();for(const f of s){c.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}for(const f of o){l.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next((f=>({Ls:f,removedBatchIds:c,addedBatchIds:l})))}))}))}function zN(t,e){const n=rt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,h,f,p){const g=f.batch,_=g.keys();let y=Oe.resolve();return _.forEach((x=>{y=y.next((()=>p.getEntry(h,x))).next((w=>{const S=f.docVersions.get(x);jt(S!==null,48541),w.version.compareTo(S)<0&&(g.applyToRemoteDocument(w,f),w.isValidDocument()&&(w.setReadTime(f.commitVersion),p.addEntry(w)))}))})),y.next((()=>l.mutationQueue.removeMutationBatch(h,g)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let h=yt();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(h=h.add(l.batch.mutations[f].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,s)))}))}function nT(t){const e=rt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function LN(t,e){const n=rt(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const c=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const l=[];e.targetChanges.forEach(((p,g)=>{const _=s.get(g);if(!_)return;l.push(n.Pi.removeMatchingKeys(o,p.removedDocuments,g).next((()=>n.Pi.addMatchingKeys(o,p.addedDocuments,g))));let y=_.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?y=y.withResumeToken(Wn.EMPTY_BYTE_STRING,Je.min()).withLastLimboFreeSnapshotVersion(Je.min()):p.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(p.resumeToken,r)),s=s.insert(g,y),(function(w,S,E){return w.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=NN?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0})(_,y,p)&&l.push(n.Pi.updateTargetData(o,y))}));let h=Bs(),f=yt();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(o,p))})),l.push(UN(o,c,e.documentUpdates).next((p=>{h=p.ks,f=p.qs}))),!r.isEqual(Je.min())){const p=n.Pi.getLastRemoteSnapshotVersion(o).next((g=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));l.push(p)}return Oe.waitFor(l).next((()=>c.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,f))).next((()=>h))})).then((o=>(n.Ms=s,o)))}function UN(t,e,n){let r=yt(),s=yt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let c=Bs();return n.forEach(((l,h)=>{const f=o.get(l);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(Je.min())?(e.removeEntry(l,h.readTime),c=c.insert(l,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),c=c.insert(l,h)):Ue(z_,"Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",h.version)})),{ks:c,qs:s}}))}function FN(t,e){const n=rt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=E_),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function VN(t,e){const n=rt(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return n.Pi.getTargetData(r,e).next((o=>o?(s=o,Oe.resolve(s)):n.Pi.allocateTargetId(r).next((c=>(s=new Aa(e,c,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=n.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function qy(t,e,n){const r=rt(t),s=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(c=>r.persistence.referenceDelegate.removeTarget(c,s)))}catch(c){if(!xl(c))throw c;Ue(z_,`Failed to update sequence numbers for target ${e}: ${c}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function jS(t,e,n){const r=rt(t);let s=Je.min(),o=yt();return r.persistence.runTransaction("Execute query","readwrite",(c=>(function(h,f,p){const g=rt(h),_=g.xs.get(p);return _!==void 0?Oe.resolve(g.Ms.get(_)):g.Pi.getTargetData(f,p)})(r,c,Qi(e)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(c,l.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(c,e,n?s:Je.min(),n?o:yt()))).next((l=>($N(r,jO(e),l),{documents:l,Qs:o})))))}function $N(t,e,n){let r=t.Os.get(e)||Je.min();n.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class RS{constructor(){this.activeTargetIds=OO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class GN{constructor(){this.Mo=new RS,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new RS,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class qN{Oo(e){}shutdown(){}}const IS="ConnectivityMonitor";class kS{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ue(IS,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ue(IS,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let cf=null;function Hy(){return cf===null?cf=(function(){return 268435456+Math.round(2147483648*Math.random())})():cf++,"0x"+cf.toString(16)}const ry="RestConnection",HN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class WN{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Bf?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,n,r,s,o){const c=Hy(),l=this.zo(e,n.toUriEncodedString());Ue(ry,`Sending RPC '${e}' ${c}:`,l,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:f}=new URL(l),p=ml(f);return this.Jo(e,l,h,r,p).then((g=>(Ue(ry,`Received RPC '${e}' ${c}: `,g),g)),(g=>{throw nl(ry,`RPC '${e}' ${c} failed with error: `,g,"url: ",l,"request:",r),g}))}Ho(e,n,r,s,o,c){return this.Go(e,n,r,s,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+bl})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}zo(e,n){const r=HN[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class QN{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Xn="WebChannelConnection";class KN extends WN{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,s,o){const c=Hy();return new Promise(((l,h)=>{const f=new iE;f.setWithCredentials(!0),f.listenOnce(sE.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case _f.NO_ERROR:const g=f.getResponseJson();Ue(Xn,`XHR for RPC '${e}' ${c} received:`,JSON.stringify(g)),l(g);break;case _f.TIMEOUT:Ue(Xn,`RPC '${e}' ${c} timed out`),h(new Le(ke.DEADLINE_EXCEEDED,"Request time out"));break;case _f.HTTP_ERROR:const _=f.getStatus();if(Ue(Xn,`RPC '${e}' ${c} failed with status:`,_,"response text:",f.getResponseText()),_>0){let y=f.getResponseJson();Array.isArray(y)&&(y=y[0]);const x=y?.error;if(x&&x.status&&x.message){const w=(function(E){const T=E.toLowerCase().replace(/_/g,"-");return Object.values(ke).indexOf(T)>=0?T:ke.UNKNOWN})(x.status);h(new Le(w,x.message))}else h(new Le(ke.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new Le(ke.UNAVAILABLE,"Connection failed."));break;default:Xe(9055,{l_:e,streamId:c,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{Ue(Xn,`RPC '${e}' ${c} completed.`)}}));const p=JSON.stringify(s);Ue(Xn,`RPC '${e}' ${c} sending request:`,s),f.send(n,"POST",p,r,15)}))}T_(e,n,r){const s=Hy(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=cE(),l=oE(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=o.join("");Ue(Xn,`Creating RPC '${e}' stream ${s}: ${p}`,h);const g=c.createWebChannel(p,h);this.I_(g);let _=!1,y=!1;const x=new QN({Yo:S=>{y?Ue(Xn,`Not sending because RPC '${e}' stream ${s} is closed:`,S):(_||(Ue(Xn,`Opening RPC '${e}' stream ${s} transport.`),g.open(),_=!0),Ue(Xn,`RPC '${e}' stream ${s} sending:`,S),g.send(S))},Zo:()=>g.close()}),w=(S,E,T)=>{S.listen(E,(A=>{try{T(A)}catch(M){setTimeout((()=>{throw M}),0)}}))};return w(g,Mu.EventType.OPEN,(()=>{y||(Ue(Xn,`RPC '${e}' stream ${s} transport opened.`),x.o_())})),w(g,Mu.EventType.CLOSE,(()=>{y||(y=!0,Ue(Xn,`RPC '${e}' stream ${s} transport closed`),x.a_(),this.E_(g))})),w(g,Mu.EventType.ERROR,(S=>{y||(y=!0,nl(Xn,`RPC '${e}' stream ${s} transport errored. Name:`,S.name,"Message:",S.message),x.a_(new Le(ke.UNAVAILABLE,"The operation could not be completed")))})),w(g,Mu.EventType.MESSAGE,(S=>{if(!y){const E=S.data[0];jt(!!E,16349);const T=E,A=T?.error||T[0]?.error;if(A){Ue(Xn,`RPC '${e}' stream ${s} received error:`,A);const M=A.status;let L=(function(j){const B=xn[j];if(B!==void 0)return $E(B)})(M),H=A.message;L===void 0&&(L=ke.INTERNAL,H="Unknown error status: "+M+" with message "+A.message),y=!0,x.a_(new Le(L,H)),g.close()}else Ue(Xn,`RPC '${e}' stream ${s} received:`,E),x.u_(E)}})),w(l,aE.STAT_EVENT,(S=>{S.stat===My.PROXY?Ue(Xn,`RPC '${e}' stream ${s} detected buffering proxy`):S.stat===My.NOPROXY&&Ue(Xn,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{x.__()}),0),x}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function iy(){return typeof document<"u"?document:null}function vm(t){return new JO(t,!0)}class rT{constructor(e,n,r=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,n-r);s>0&&Ue("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const DS="PersistentStream";class iT{constructor(e,n,r,s,o,c,l,h){this.Mi=e,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new rT(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===ke.RESOURCE_EXHAUSTED?(Ns(n.toString()),Ns("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===ke.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===n&&this.G_(r,s)}),(r=>{e((()=>{const s=new Le(ke.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ue(DS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Ue(DS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class YN extends iT{constructor(e,n,r,s,o,c){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,c),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=nN(this.serializer,e),r=(function(o){if(!("targetChange"in o))return Je.min();const c=o.targetChange;return c.targetIds&&c.targetIds.length?Je.min():c.readTime?Ki(c.readTime):Je.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Gy(this.serializer),n.addTarget=(function(o,c){let l;const h=c.target;if(l=zy(h)?{documents:sN(o,h)}:{query:aN(o,h).ft},l.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){l.resumeToken=HE(o,c.resumeToken);const f=Fy(o,c.expectedCount);f!==null&&(l.expectedCount=f)}else if(c.snapshotVersion.compareTo(Je.min())>0){l.readTime=Vf(o,c.snapshotVersion.toTimestamp());const f=Fy(o,c.expectedCount);f!==null&&(l.expectedCount=f)}return l})(this.serializer,e);const r=cN(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Gy(this.serializer),n.removeTarget=e,this.q_(n)}}class XN extends iT{constructor(e,n,r,s,o,c){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,c),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return jt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,jt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){jt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=iN(e.writeResults,e.commitTime),r=Ki(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Gy(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>rN(this.serializer,r)))};this.q_(n)}}class ZN{}class JN extends ZN{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new Le(ke.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,c])=>this.connection.Go(e,Vy(n,r),s,o,c))).catch((o=>{throw o.name==="FirebaseError"?(o.code===ke.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Le(ke.UNKNOWN,o.toString())}))}Ho(e,n,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([c,l])=>this.connection.Ho(e,Vy(n,r),s,c,l,o))).catch((c=>{throw c.name==="FirebaseError"?(c.code===ke.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new Le(ke.UNKNOWN,c.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class e6{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ns(n),this.aa=!1):Ue("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Vo="RemoteStore";class t6{constructor(e,n,r,s,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((c=>{r.enqueueAndForget((async()=>{Wo(this)&&(Ue(Vo,"Restarting streams for network reachability change."),await(async function(h){const f=rt(h);f.Ea.add(4),await xd(f),f.Ra.set("Unknown"),f.Ea.delete(4),await xm(f)})(this))}))})),this.Ra=new e6(r,s)}}async function xm(t){if(Wo(t))for(const e of t.da)await e(!0)}async function xd(t){for(const e of t.da)await e(!1)}function sT(t,e){const n=rt(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),V_(n)?F_(n):wl(n).O_()&&U_(n,e))}function L_(t,e){const n=rt(t),r=wl(n);n.Ia.delete(e),r.O_()&&aT(n,e),n.Ia.size===0&&(r.O_()?r.L_():Wo(n)&&n.Ra.set("Unknown"))}function U_(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Je.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}wl(t).Y_(e)}function aT(t,e){t.Va.Ue(e),wl(t).Z_(e)}function F_(t){t.Va=new KO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),wl(t).start(),t.Ra.ua()}function V_(t){return Wo(t)&&!wl(t).x_()&&t.Ia.size>0}function Wo(t){return rt(t).Ea.size===0}function oT(t){t.Va=void 0}async function n6(t){t.Ra.set("Online")}async function r6(t){t.Ia.forEach(((e,n)=>{U_(t,e)}))}async function i6(t,e){oT(t),V_(t)?(t.Ra.ha(e),F_(t)):t.Ra.set("Unknown")}async function s6(t,e,n){if(t.Ra.set("Online"),e instanceof qE&&e.state===2&&e.cause)try{await(async function(s,o){const c=o.cause;for(const l of o.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,c),s.Ia.delete(l),s.Va.removeTarget(l))})(t,e)}catch(r){Ue(Vo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Gf(t,r)}else if(e instanceof wf?t.Va.Ze(e):e instanceof GE?t.Va.st(e):t.Va.tt(e),!n.isEqual(Je.min()))try{const r=await nT(t.localStore);n.compareTo(r)>=0&&await(function(o,c){const l=o.Va.Tt(c);return l.targetChanges.forEach(((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(f);p&&o.Ia.set(f,p.withResumeToken(h.resumeToken,c))}})),l.targetMismatches.forEach(((h,f)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Wn.EMPTY_BYTE_STRING,p.snapshotVersion)),aT(o,h);const g=new Aa(p.target,h,f,p.sequenceNumber);U_(o,g)})),o.remoteSyncer.applyRemoteEvent(l)})(t,n)}catch(r){Ue(Vo,"Failed to raise snapshot:",r),await Gf(t,r)}}async function Gf(t,e,n){if(!xl(e))throw e;t.Ea.add(1),await xd(t),t.Ra.set("Offline"),n||(n=()=>nT(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ue(Vo,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await xm(t)}))}function cT(t,e){return e().catch((n=>Gf(t,n,e)))}async function wm(t){const e=rt(t),n=Va(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:E_;for(;a6(e);)try{const s=await FN(e.localStore,r);if(s===null){e.Ta.length===0&&n.L_();break}r=s.batchId,o6(e,s)}catch(s){await Gf(e,s)}lT(e)&&uT(e)}function a6(t){return Wo(t)&&t.Ta.length<10}function o6(t,e){t.Ta.push(e);const n=Va(t);n.O_()&&n.X_&&n.ea(e.mutations)}function lT(t){return Wo(t)&&!Va(t).x_()&&t.Ta.length>0}function uT(t){Va(t).start()}async function c6(t){Va(t).ra()}async function l6(t){const e=Va(t);for(const n of t.Ta)e.ea(n.mutations)}async function u6(t,e,n){const r=t.Ta.shift(),s=D_.from(r,e,n);await cT(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await wm(t)}async function d6(t,e){e&&Va(t).X_&&await(async function(r,s){if((function(c){return HO(c)&&c!==ke.ABORTED})(s.code)){const o=r.Ta.shift();Va(r).B_(),await cT(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await wm(r)}})(t,e),lT(t)&&uT(t)}async function MS(t,e){const n=rt(t);n.asyncQueue.verifyOperationInProgress(),Ue(Vo,"RemoteStore received new credentials");const r=Wo(n);n.Ea.add(3),await xd(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await xm(n)}async function h6(t,e){const n=rt(t);e?(n.Ea.delete(2),await xm(n)):e||(n.Ea.add(2),await xd(n),n.Ra.set("Unknown"))}function wl(t){return t.ma||(t.ma=(function(n,r,s){const o=rt(n);return o.sa(),new YN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(t.datastore,t.asyncQueue,{Xo:n6.bind(null,t),t_:r6.bind(null,t),r_:i6.bind(null,t),H_:s6.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),V_(t)?F_(t):t.Ra.set("Unknown")):(await t.ma.stop(),oT(t))}))),t.ma}function Va(t){return t.fa||(t.fa=(function(n,r,s){const o=rt(n);return o.sa(),new XN(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:c6.bind(null,t),r_:d6.bind(null,t),ta:l6.bind(null,t),na:u6.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await wm(t)):(await t.fa.stop(),t.Ta.length>0&&(Ue(Vo,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class $_{constructor(e,n,r,s,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new Is,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((c=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,o){const c=Date.now()+r,l=new $_(e,n,c,s,o);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Le(ke.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function G_(t,e){if(Ns("AsyncQueue",`${e}: ${t}`),xl(t))return new Le(ke.UNAVAILABLE,`${e}: ${t}`);throw t}class Zc{static emptySet(e){return new Zc(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||We.comparator(n.key,r.key):(n,r)=>We.comparator(n.key,r.key),this.keyedMap=Ou(),this.sortedSet=new tn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Zc)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Zc;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class OS{constructor(){this.ga=new tn(We.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Xe(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class ll{constructor(e,n,r,s,o,c,l,h,f){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=c,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,n,r,s,o){const c=[];return n.forEach((l=>{c.push({type:0,doc:l})})),new ll(e,n,Zc.emptySet(n),c,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&mm(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}class f6{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class m6{constructor(){this.queries=NS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const s=rt(n),o=s.queries;s.queries=NS(),o.forEach(((c,l)=>{for(const h of l.Sa)h.onError(r)}))})(this,new Le(ke.ABORTED,"Firestore shutting down"))}}function NS(){return new Ho((t=>IE(t)),mm)}async function dT(t,e){const n=rt(t);let r=3;const s=e.query;let o=n.queries.get(s);o?!o.ba()&&e.Da()&&(r=2):(o=new f6,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(s,!0);break;case 1:o.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(c){const l=G_(c,`Initialization of query '${qc(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&q_(n)}async function hT(t,e){const n=rt(t),r=e.query;let s=3;const o=n.queries.get(r);if(o){const c=o.Sa.indexOf(e);c>=0&&(o.Sa.splice(c,1),o.Sa.length===0?s=e.Da()?0:1:!o.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function g6(t,e){const n=rt(t);let r=!1;for(const s of e){const o=s.query,c=n.queries.get(o);if(c){for(const l of c.Sa)l.Fa(s)&&(r=!0);c.wa=s}}r&&q_(n)}function p6(t,e,n){const r=rt(t),s=r.queries.get(e);if(s)for(const o of s.Sa)o.onError(n);r.queries.delete(e)}function q_(t){t.Ca.forEach((e=>{e.next()}))}var Wy,BS;(BS=Wy||(Wy={})).Ma="default",BS.Cache="cache";class fT{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new ll(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=ll.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Wy.Cache}}class mT{constructor(e){this.key=e}}class gT{constructor(e){this.key=e}}class y6{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=yt(),this.mutatedKeys=yt(),this.eu=kE(e),this.tu=new Zc(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new OS,s=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,c=s,l=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((p,g)=>{const _=s.get(p),y=gm(this.query,g)?g:null,x=!!_&&this.mutatedKeys.has(_.key),w=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let S=!1;_&&y?_.data.isEqual(y.data)?x!==w&&(r.track({type:3,doc:y}),S=!0):this.su(_,y)||(r.track({type:2,doc:y}),S=!0,(h&&this.eu(y,h)>0||f&&this.eu(y,f)<0)&&(l=!0)):!_&&y?(r.track({type:0,doc:y}),S=!0):_&&!y&&(r.track({type:1,doc:_}),S=!0,(h||f)&&(l=!0)),S&&(y?(c=c.add(y),o=w?o.add(p):o.delete(p)):(c=c.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;c.size>this.query.limit;){const p=this.query.limitType==="F"?c.last():c.first();c=c.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:c,iu:r,Cs:l,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const c=e.iu.ya();c.sort(((p,g)=>(function(y,x){const w=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xe(20277,{Rt:S})}};return w(y)-w(x)})(p.type,g.type)||this.eu(p.doc,g.doc))),this.ou(r),s=s??!1;const l=n&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,f=h!==this.Za;return this.Za=h,c.length!==0||f?{snapshot:new ll(this.query,e.tu,o,c,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new OS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=yt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new gT(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new mT(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=yt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return ll.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const H_="SyncEngine";class _6{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class b6{constructor(e){this.key=e,this.hu=!1}}class v6{constructor(e,n,r,s,o,c){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=c,this.Pu={},this.Tu=new Ho((l=>IE(l)),mm),this.Iu=new Map,this.Eu=new Set,this.du=new tn(We.comparator),this.Au=new Map,this.Ru=new N_,this.Vu={},this.mu=new Map,this.fu=cl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function x6(t,e,n=!0){const r=xT(t);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await pT(r,e,n,!0),s}async function w6(t,e){const n=xT(t);await pT(n,e,!0,!1)}async function pT(t,e,n,r){const s=await VN(t.localStore,Qi(e)),o=s.targetId,c=t.sharedClientState.addLocalQueryTarget(o,n);let l;return r&&(l=await S6(t,e,o,c==="current",s.resumeToken)),t.isPrimaryClient&&n&&sT(t.remoteStore,s),l}async function S6(t,e,n,r,s){t.pu=(g,_,y)=>(async function(w,S,E,T){let A=S.view.ru(E);A.Cs&&(A=await jS(w.localStore,S.query,!1).then((({documents:O})=>S.view.ru(O,A))));const M=T&&T.targetChanges.get(S.targetId),L=T&&T.targetMismatches.get(S.targetId)!=null,H=S.view.applyChanges(A,w.isPrimaryClient,M,L);return zS(w,S.targetId,H.au),H.snapshot})(t,g,_,y);const o=await jS(t.localStore,e,!0),c=new y6(e,o.Qs),l=c.ru(o.documents),h=vd.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),f=c.applyChanges(l,t.isPrimaryClient,h);zS(t,n,f.au);const p=new _6(e,n,c);return t.Tu.set(e,p),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),f.snapshot}async function C6(t,e,n){const r=rt(t),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((c=>!mm(c,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await qy(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),n&&L_(r.remoteStore,s.targetId),Qy(r,s.targetId)})).catch(vl)):(Qy(r,s.targetId),await qy(r.localStore,s.targetId,!0))}async function E6(t,e){const n=rt(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),L_(n.remoteStore,r.targetId))}async function T6(t,e,n){const r=M6(t);try{const s=await(function(c,l){const h=rt(c),f=Wt.now(),p=l.reduce(((y,x)=>y.add(x.key)),yt());let g,_;return h.persistence.runTransaction("Locally write mutations","readwrite",(y=>{let x=Bs(),w=yt();return h.Ns.getEntries(y,p).next((S=>{x=S,x.forEach(((E,T)=>{T.isValidDocument()||(w=w.add(E))}))})).next((()=>h.localDocuments.getOverlayedDocuments(y,x))).next((S=>{g=S;const E=[];for(const T of l){const A=FO(T,g.get(T.key).overlayedDocument);A!=null&&E.push(new Qa(T.key,A,wE(A.value.mapValue),xr.exists(!0)))}return h.mutationQueue.addMutationBatch(y,f,E,l)})).next((S=>{_=S;const E=S.applyToLocalDocumentSet(g,w);return h.documentOverlayCache.saveOverlays(y,S.batchId,E)}))})).then((()=>({batchId:_.batchId,changes:ME(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(c,l,h){let f=c.Vu[c.currentUser.toKey()];f||(f=new tn(pt)),f=f.insert(l,h),c.Vu[c.currentUser.toKey()]=f})(r,s.batchId,n),await wd(r,s.changes),await wm(r.remoteStore)}catch(s){const o=G_(s,"Failed to persist write");n.reject(o)}}async function yT(t,e){const n=rt(t);try{const r=await LN(n.localStore,e);e.targetChanges.forEach(((s,o)=>{const c=n.Au.get(o);c&&(jt(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?c.hu=!0:s.modifiedDocuments.size>0?jt(c.hu,14607):s.removedDocuments.size>0&&(jt(c.hu,42227),c.hu=!1))})),await wd(n,r,e)}catch(r){await vl(r)}}function PS(t,e,n){const r=rt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Tu.forEach(((o,c)=>{const l=c.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(c,l){const h=rt(c);h.onlineState=l;let f=!1;h.queries.forEach(((p,g)=>{for(const _ of g.Sa)_.va(l)&&(f=!0)})),f&&q_(h)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function A6(t,e,n){const r=rt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),o=s&&s.key;if(o){let c=new tn(We.comparator);c=c.insert(o,er.newNoDocument(o,Je.min()));const l=yt().add(o),h=new bm(Je.min(),new Map,new tn(pt),c,l);await yT(r,h),r.du=r.du.remove(o),r.Au.delete(e),W_(r)}else await qy(r.localStore,e,!1).then((()=>Qy(r,e,n))).catch(vl)}async function j6(t,e){const n=rt(t),r=e.batch.batchId;try{const s=await zN(n.localStore,e);bT(n,r,null),_T(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await wd(n,s)}catch(s){await vl(s)}}async function R6(t,e,n){const r=rt(t);try{const s=await(function(c,l){const h=rt(c);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let p;return h.mutationQueue.lookupMutationBatch(f,l).next((g=>(jt(g!==null,37113),p=g.keys(),h.mutationQueue.removeMutationBatch(f,g)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,p,l))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,p))).next((()=>h.localDocuments.getDocuments(f,p)))}))})(r.localStore,e);bT(r,e,n),_T(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await wd(r,s)}catch(s){await vl(s)}}function _T(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function bT(t,e,n){const r=rt(t);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(n?o.reject(n):o.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Qy(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||vT(t,r)}))}function vT(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(L_(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),W_(t))}function zS(t,e,n){for(const r of n)r instanceof mT?(t.Ru.addReference(r.key,e),I6(t,r)):r instanceof gT?(Ue(H_,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||vT(t,r.key)):Xe(19791,{wu:r})}function I6(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Ue(H_,"New document in limbo: "+n),t.Eu.add(r),W_(t))}function W_(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new We($t.fromString(e)),r=t.fu.next();t.Au.set(r,new b6(n)),t.du=t.du.insert(n,r),sT(t.remoteStore,new Aa(Qi(I_(n.path)),r,"TargetPurposeLimboResolution",dm.ce))}}async function wd(t,e,n){const r=rt(t),s=[],o=[],c=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,h)=>{c.push(r.pu(h,e,n).then((f=>{if((f||n)&&r.isPrimaryClient){const p=f?!f.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(f){s.push(f);const p=P_.As(h.targetId,f);o.push(p)}})))})),await Promise.all(c),r.Pu.H_(s),await(async function(h,f){const p=rt(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>Oe.forEach(f,(_=>Oe.forEach(_.Es,(y=>p.persistence.referenceDelegate.addReference(g,_.targetId,y))).next((()=>Oe.forEach(_.ds,(y=>p.persistence.referenceDelegate.removeReference(g,_.targetId,y)))))))))}catch(g){if(!xl(g))throw g;Ue(z_,"Failed to update sequence numbers: "+g)}for(const g of f){const _=g.targetId;if(!g.fromCache){const y=p.Ms.get(_),x=y.snapshotVersion,w=y.withLastLimboFreeSnapshotVersion(x);p.Ms=p.Ms.insert(_,w)}}})(r.localStore,o))}async function k6(t,e){const n=rt(t);if(!n.currentUser.isEqual(e)){Ue(H_,"User change. New user:",e.toKey());const r=await tT(n.localStore,e);n.currentUser=e,(function(o,c){o.mu.forEach((l=>{l.forEach((h=>{h.reject(new Le(ke.CANCELLED,c))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await wd(n,r.Ls)}}function D6(t,e){const n=rt(t),r=n.Au.get(e);if(r&&r.hu)return yt().add(r.key);{let s=yt();const o=n.Iu.get(e);if(!o)return s;for(const c of o){const l=n.Tu.get(c);s=s.unionWith(l.view.nu)}return s}}function xT(t){const e=rt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=yT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=D6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=A6.bind(null,e),e.Pu.H_=g6.bind(null,e.eventManager),e.Pu.yu=p6.bind(null,e.eventManager),e}function M6(t){const e=rt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=j6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=R6.bind(null,e),e}class qf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=vm(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return PN(this.persistence,new ON,e.initialUser,this.serializer)}Cu(e){return new eT(B_.mi,this.serializer)}Du(e){return new GN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}qf.provider={build:()=>new qf};class O6 extends qf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){jt(this.persistence.referenceDelegate instanceof $f,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new bN(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?br.withCacheSize(this.cacheSizeBytes):br.DEFAULT;return new eT((r=>$f.mi(r,n)),this.serializer)}}class Ky{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>PS(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=k6.bind(null,this.syncEngine),await h6(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new m6})()}createDatastore(e){const n=vm(e.databaseInfo.databaseId),r=(function(o){return new KN(o)})(e.databaseInfo);return(function(o,c,l,h){return new JN(o,c,l,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,s,o,c,l){return new t6(r,s,o,c,l)})(this.localStore,this.datastore,e.asyncQueue,(n=>PS(this.syncEngine,n,0)),(function(){return kS.v()?new kS:new qN})())}createSyncEngine(e,n){return(function(s,o,c,l,h,f,p){const g=new v6(s,o,c,l,h,f);return p&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=rt(n);Ue(Vo,"RemoteStore shutting down."),r.Ea.add(5),await xd(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ky.provider={build:()=>new Ky};class wT{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ns("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const $a="FirestoreClient";class N6{constructor(e,n,r,s,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=Jn.UNAUTHENTICATED,this.clientId=C_.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async c=>{Ue($a,"Received user=",c.uid),await this.authCredentialListener(c),this.user=c})),this.appCheckCredentials.start(r,(c=>(Ue($a,"Received new app check token=",c),this.appCheckCredentialListener(c,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Is;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=G_(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function sy(t,e){t.asyncQueue.verifyOperationInProgress(),Ue($a,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async s=>{r.isEqual(s)||(await tT(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function LS(t,e){t.asyncQueue.verifyOperationInProgress();const n=await B6(t);Ue($a,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>MS(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,s)=>MS(e.remoteStore,s))),t._onlineComponents=e}async function B6(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ue($a,"Using user provided OfflineComponentProvider");try{await sy(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(s){return s.name==="FirebaseError"?s.code===ke.FAILED_PRECONDITION||s.code===ke.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(n))throw n;nl("Error using user provided cache. Falling back to memory cache: "+n),await sy(t,new qf)}}else Ue($a,"Using default OfflineComponentProvider"),await sy(t,new O6(void 0));return t._offlineComponents}async function ST(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ue($a,"Using user provided OnlineComponentProvider"),await LS(t,t._uninitializedComponentsProvider._online)):(Ue($a,"Using default OnlineComponentProvider"),await LS(t,new Ky))),t._onlineComponents}function P6(t){return ST(t).then((e=>e.syncEngine))}async function CT(t){const e=await ST(t),n=e.eventManager;return n.onListen=x6.bind(null,e.syncEngine),n.onUnlisten=C6.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=w6.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=E6.bind(null,e.syncEngine),n}function z6(t,e,n={}){const r=new Is;return t.asyncQueue.enqueueAndForget((async()=>(function(o,c,l,h,f){const p=new wT({next:_=>{p.Nu(),c.enqueueAndForget((()=>hT(o,g)));const y=_.docs.has(l);!y&&_.fromCache?f.reject(new Le(ke.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&_.fromCache&&h&&h.source==="server"?f.reject(new Le(ke.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(_)},error:_=>f.reject(_)}),g=new fT(I_(l.path),p,{includeMetadataChanges:!0,qa:!0});return dT(o,g)})(await CT(t),t.asyncQueue,e,n,r))),r.promise}function L6(t,e,n={}){const r=new Is;return t.asyncQueue.enqueueAndForget((async()=>(function(o,c,l,h,f){const p=new wT({next:_=>{p.Nu(),c.enqueueAndForget((()=>hT(o,g))),_.fromCache&&h.source==="server"?f.reject(new Le(ke.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(_)},error:_=>f.reject(_)}),g=new fT(l,p,{includeMetadataChanges:!0,qa:!0});return dT(o,g)})(await CT(t),t.asyncQueue,e,n,r))),r.promise}function ET(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const US=new Map;const TT="firestore.googleapis.com",FS=!0;class VS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Le(ke.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=TT,this.ssl=FS}else this.host=e.host,this.ssl=e.ssl??FS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=JE;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<yN)throw new Le(ke.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}tO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ET(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Le(ke.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Le(ke.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Le(ke.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Sm{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new VS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Le(ke.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Le(ke.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new VS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new qM;switch(r.type){case"firstParty":return new KM(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Le(ke.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=US.get(n);r&&(Ue("ComponentProvider","Removing Datastore"),US.delete(n),r.terminate())})(this),Promise.resolve()}}function U6(t,e,n,r={}){t=yi(t,Sm);const s=ml(e),o=t._getSettings(),c={...o,emulatorOptions:t._getEmulatorOptions()},l=`${e}:${n}`;s&&(iC(`https://${l}`),sC("Firestore",!0)),o.host!==TT&&o.host!==l&&nl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:l,ssl:s,emulatorOptions:r};if(!Ds(h,c)&&(t._setSettings(h),r.mockUserToken)){let f,p;if(typeof r.mockUserToken=="string")f=r.mockUserToken,p=Jn.MOCK_USER;else{f=_I(r.mockUserToken,t._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Le(ke.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Jn(g)}t._authCredentials=new HM(new uE(f,p))}}class Sl{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Sl(this.firestore,e,this._query)}}class dn{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ba(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new dn(this.firestore,e,this._key)}toJSON(){return{type:dn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(yd(n,dn._jsonSchema))return new dn(e,r||null,new We($t.fromString(n.referencePath)))}}dn._jsonSchemaVersion="firestore/documentReference/1.0",dn._jsonSchema={type:Sn("string",dn._jsonSchemaVersion),referencePath:Sn("string")};class Ba extends Sl{constructor(e,n,r){super(e,n,I_(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new dn(this.firestore,null,new We(e))}withConverter(e){return new Ba(this.firestore,e,this._path)}}function F6(t,e,...n){if(t=En(t),dE("collection","path",e),t instanceof Sm){const r=$t.fromString(e,...n);return tS(r),new Ba(t,null,r)}{if(!(t instanceof dn||t instanceof Ba))throw new Le(ke.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child($t.fromString(e,...n));return tS(r),new Ba(t.firestore,null,r)}}function Cl(t,e,...n){if(t=En(t),arguments.length===1&&(e=C_.newId()),dE("doc","path",e),t instanceof Sm){const r=$t.fromString(e,...n);return eS(r),new dn(t,null,new We(r))}{if(!(t instanceof dn||t instanceof Ba))throw new Le(ke.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child($t.fromString(e,...n));return eS(r),new dn(t.firestore,t instanceof Ba?t.converter:null,new We(r))}}const $S="AsyncQueue";class GS{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new rT(this,"async_queue_retry"),this._c=()=>{const r=iy();r&&Ue($S,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=iy();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=iy();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new Is;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!xl(e))throw e;Ue($S,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Ns("INTERNAL UNHANDLED ERROR: ",qS(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const s=$_.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&Xe(47125,{Pc:qS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function qS(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Qo extends Sm{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new GS,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new GS(e),this._firestoreClient=void 0,await e}}}function V6(t,e){const n=typeof t=="object"?t:lC(),r=typeof t=="string"?t:Bf,s=u_(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=pI("firestore");o&&U6(s,...o)}return s}function Cm(t){if(t._terminated)throw new Le(ke.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||$6(t),t._firestoreClient}function $6(t){const e=t._freezeSettings(),n=(function(s,o,c,l){return new hO(s,o,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,ET(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new N6(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(t._componentsProvider))}class Zr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Zr(Wn.fromBase64String(e))}catch(n){throw new Le(ke.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Zr(Wn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Zr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(yd(e,Zr._jsonSchema))return Zr.fromBase64String(e.bytes)}}Zr._jsonSchemaVersion="firestore/bytes/1.0",Zr._jsonSchema={type:Sn("string",Zr._jsonSchemaVersion),bytes:Sn("string")};class Sd{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Le(ke.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Cd{constructor(e){this._methodName=e}}class Yi{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Le(ke.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Le(ke.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return pt(this._lat,e._lat)||pt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Yi._jsonSchemaVersion}}static fromJSON(e){if(yd(e,Yi._jsonSchema))return new Yi(e.latitude,e.longitude)}}Yi._jsonSchemaVersion="firestore/geoPoint/1.0",Yi._jsonSchema={type:Sn("string",Yi._jsonSchemaVersion),latitude:Sn("number"),longitude:Sn("number")};class Xi{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Xi._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(yd(e,Xi._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Xi(e.vectorValues);throw new Le(ke.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Xi._jsonSchemaVersion="firestore/vectorValue/1.0",Xi._jsonSchema={type:Sn("string",Xi._jsonSchemaVersion),vectorValues:Sn("object")};const G6=/^__.*__$/;class q6{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Qa(e,this.data,this.fieldMask,n,this.fieldTransforms):new bd(e,this.data,n,this.fieldTransforms)}}class AT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Qa(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function jT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xe(40011,{Ac:t})}}class Em{constructor(e,n,r,s,o,c){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=c||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Em({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Hf(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(jT(this.Ac)&&G6.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class H6{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||vm(e)}Cc(e,n,r,s=!1){return new Em({Ac:e,methodName:n,Dc:r,path:qn.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Tm(t){const e=t._freezeSettings(),n=vm(t._databaseId);return new H6(t._databaseId,!!e.ignoreUndefinedProperties,n)}function RT(t,e,n,r,s,o={}){const c=t.Cc(o.merge||o.mergeFields?2:0,e,n,s);Y_("Data must be an object, but it was:",c,r);const l=MT(r,c);let h,f;if(o.merge)h=new Mr(c.fieldMask),f=c.fieldTransforms;else if(o.mergeFields){const p=[];for(const g of o.mergeFields){const _=Yy(e,g,n);if(!c.contains(_))throw new Le(ke.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);NT(p,_)||p.push(_)}h=new Mr(p),f=c.fieldTransforms.filter((g=>h.covers(g.field)))}else h=null,f=c.fieldTransforms;return new q6(new vr(l),h,f)}class Ed extends Cd{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ed}}function IT(t,e,n){return new Em({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Q_ extends Cd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=IT(this,e,!0),r=this.vc.map((o=>Ko(o,n))),s=new al(r);return new UE(e.path,s)}isEqual(e){return e instanceof Q_&&Ds(this.vc,e.vc)}}class K_ extends Cd{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=IT(this,e,!0),r=this.vc.map((o=>Ko(o,n))),s=new ol(r);return new UE(e.path,s)}isEqual(e){return e instanceof K_&&Ds(this.vc,e.vc)}}function kT(t,e,n,r){const s=t.Cc(1,e,n);Y_("Data must be an object, but it was:",s,r);const o=[],c=vr.empty();Wa(r,((h,f)=>{const p=X_(e,h,n);f=En(f);const g=s.yc(p);if(f instanceof Ed)o.push(p);else{const _=Ko(f,g);_!=null&&(o.push(p),c.set(p,_))}}));const l=new Mr(o);return new AT(c,l,s.fieldTransforms)}function DT(t,e,n,r,s,o){const c=t.Cc(1,e,n),l=[Yy(e,r,n)],h=[s];if(o.length%2!=0)throw new Le(ke.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<o.length;_+=2)l.push(Yy(e,o[_])),h.push(o[_+1]);const f=[],p=vr.empty();for(let _=l.length-1;_>=0;--_)if(!NT(f,l[_])){const y=l[_];let x=h[_];x=En(x);const w=c.yc(y);if(x instanceof Ed)f.push(y);else{const S=Ko(x,w);S!=null&&(f.push(y),p.set(y,S))}}const g=new Mr(f);return new AT(p,g,c.fieldTransforms)}function W6(t,e,n,r=!1){return Ko(n,t.Cc(r?4:3,e))}function Ko(t,e){if(OT(t=En(t)))return Y_("Unsupported field value:",e,t),MT(t,e);if(t instanceof Cd)return(function(r,s){if(!jT(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let c=0;for(const l of r){let h=Ko(l,s.wc(c));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),c++}return{arrayValue:{values:o}}})(t,e)}return(function(r,s){if((r=En(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return NO(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Wt.fromDate(r);return{timestampValue:Vf(s.serializer,o)}}if(r instanceof Wt){const o=new Wt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Vf(s.serializer,o)}}if(r instanceof Yi)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Zr)return{bytesValue:HE(s.serializer,r._byteString)};if(r instanceof dn){const o=s.databaseId,c=r.firestore._databaseId;if(!c.isEqual(o))throw s.Sc(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:O_(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Xi)return(function(c,l){return{mapValue:{fields:{[vE]:{stringValue:xE},[Pf]:{arrayValue:{values:c.toArray().map((f=>{if(typeof f!="number")throw l.Sc("VectorValues must only contain numeric values.");return k_(l.serializer,f)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${um(r)}`)})(t,e)}function MT(t,e){const n={};return mE(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Wa(t,((r,s)=>{const o=Ko(s,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function OT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Wt||t instanceof Yi||t instanceof Zr||t instanceof dn||t instanceof Cd||t instanceof Xi)}function Y_(t,e,n){if(!OT(n)||!hE(n)){const r=um(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Yy(t,e,n){if((e=En(e))instanceof Sd)return e._internalPath;if(typeof e=="string")return X_(t,e);throw Hf("Field path arguments must be of type string or ",t,!1,void 0,n)}const Q6=new RegExp("[~\\*/\\[\\]]");function X_(t,e,n){if(e.search(Q6)>=0)throw Hf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Sd(...e.split("."))._internalPath}catch{throw Hf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Hf(t,e,n,r,s){const o=r&&!r.isEmpty(),c=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||c)&&(h+=" (found",o&&(h+=` in field ${r}`),c&&(h+=` in document ${s}`),h+=")"),new Le(ke.INVALID_ARGUMENT,l+t+h)}function NT(t,e){return t.some((n=>n.isEqual(e)))}class BT{constructor(e,n,r,s,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new dn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new K6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Z_("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class K6 extends BT{data(){return super.data()}}function Z_(t,e){return typeof e=="string"?X_(t,e):e instanceof Sd?e._internalPath:e._delegate._internalPath}function Y6(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Le(ke.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class J_{}class X6 extends J_{}function Z6(t,e,...n){let r=[];e instanceof J_&&r.push(e),r=r.concat(n),(function(o){const c=o.filter((h=>h instanceof e0)).length,l=o.filter((h=>h instanceof Am)).length;if(c>1||c>0&&l>0)throw new Le(ke.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)t=s._apply(t);return t}class Am extends X6{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Am(e,n,r)}_apply(e){const n=this._parse(e);return PT(e._query,n),new Sl(e.firestore,e.converter,Ly(e._query,n))}_parse(e){const n=Tm(e.firestore);return(function(o,c,l,h,f,p,g){let _;if(f.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new Le(ke.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){WS(g,p);const x=[];for(const w of g)x.push(HS(h,o,w));_={arrayValue:{values:x}}}else _=HS(h,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||WS(g,p),_=W6(l,c,g,p==="in"||p==="not-in");return wn.create(f,p,_)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function J6(t,e,n){const r=e,s=Z_("where",t);return Am._create(s,r,n)}class e0 extends J_{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new e0(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:_i.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(s,o){let c=s;const l=o.getFlattenedFilters();for(const h of l)PT(c,h),c=Ly(c,h)})(e._query,n),new Sl(e.firestore,e.converter,Ly(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function HS(t,e,n){if(typeof(n=En(n))=="string"){if(n==="")throw new Le(ke.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!RE(e)&&n.indexOf("/")!==-1)throw new Le(ke.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child($t.fromString(n));if(!We.isDocumentKey(r))throw new Le(ke.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return lS(t,new We(r))}if(n instanceof dn)return lS(t,n._key);throw new Le(ke.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${um(n)}.`)}function WS(t,e){if(!Array.isArray(t)||t.length===0)throw new Le(ke.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function PT(t,e){const n=(function(s,o){for(const c of s)for(const l of c.getFlattenedFilters())if(o.indexOf(l.op)>=0)return l.op;return null})(t.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Le(ke.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Le(ke.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class eB{convertValue(e,n="none"){switch(Fa(e)){case 0:return null;case 1:return e.booleanValue;case 2:return un(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ua(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Xe(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Wa(e,((s,o)=>{r[s]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[Pf].arrayValue?.values?.map((r=>un(r.doubleValue)));return new Xi(n)}convertGeoPoint(e){return new Yi(un(e.latitude),un(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=fm(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Xu(e));default:return null}}convertTimestamp(e){const n=La(e);return new Wt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=$t.fromString(e);jt(ZE(r),9688,{name:e});const s=new Zu(r.get(1),r.get(3)),o=new We(r.popFirst(5));return s.isEqual(n)||Ns(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function zT(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Bu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class No extends BT{constructor(e,n,r,s,o,c){super(e,n,r,s,c),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Sf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Z_("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(ke.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=No._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}No._jsonSchemaVersion="firestore/documentSnapshot/1.0",No._jsonSchema={type:Sn("string",No._jsonSchemaVersion),bundleSource:Sn("string","DocumentSnapshot"),bundleName:Sn("string"),bundle:Sn("string")};class Sf extends No{data(e={}){return super.data(e)}}class Jc{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Bu(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new Sf(this._firestore,this._userDataWriter,r.key,r,new Bu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Le(ke.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let c=0;return s._snapshot.docChanges.map((l=>{const h=new Sf(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Bu(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:c++}}))}{let c=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>o||l.type!==3)).map((l=>{const h=new Sf(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Bu(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,p=-1;return l.type!==0&&(f=c.indexOf(l.doc.key),c=c.delete(l.doc.key)),l.type!==1&&(c=c.add(l.doc),p=c.indexOf(l.doc.key)),{type:tB(l.type),doc:h,oldIndex:f,newIndex:p}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(ke.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Jc._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=C_.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function tB(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xe(61501,{type:t})}}function nB(t){t=yi(t,dn);const e=yi(t.firestore,Qo);return z6(Cm(e),t._key).then((n=>oB(e,t,n)))}Jc._jsonSchemaVersion="firestore/querySnapshot/1.0",Jc._jsonSchema={type:Sn("string",Jc._jsonSchemaVersion),bundleSource:Sn("string","QuerySnapshot"),bundleName:Sn("string"),bundle:Sn("string")};class LT extends eB{constructor(e){super(),this.firestore=e}convertBytes(e){return new Zr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new dn(this.firestore,null,n)}}function rB(t){t=yi(t,Sl);const e=yi(t.firestore,Qo),n=Cm(e),r=new LT(e);return Y6(t._query),L6(n,t._query).then((s=>new Jc(e,r,t,s)))}function iB(t,e,n){t=yi(t,dn);const r=yi(t.firestore,Qo),s=zT(t.converter,e,n);return jm(r,[RT(Tm(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,xr.none())])}function sB(t,e,n,...r){t=yi(t,dn);const s=yi(t.firestore,Qo),o=Tm(s);let c;return c=typeof(e=En(e))=="string"||e instanceof Sd?DT(o,"updateDoc",t._key,e,n,r):kT(o,"updateDoc",t._key,e),jm(s,[c.toMutation(t._key,xr.exists(!0))])}function aB(t){return jm(yi(t.firestore,Qo),[new _m(t._key,xr.none())])}function jm(t,e){return(function(r,s){const o=new Is;return r.asyncQueue.enqueueAndForget((async()=>T6(await P6(r),s,o))),o.promise})(Cm(t),e)}function oB(t,e,n){const r=n.docs.get(e._key),s=new LT(t);return new No(t,s,e._key,r,new Bu(n.hasPendingWrites,n.fromCache),e.converter)}class cB{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Tm(e)}set(e,n,r){this._verifyNotCommitted();const s=ay(e,this._firestore),o=zT(s.converter,n,r),c=RT(this._dataReader,"WriteBatch.set",s._key,o,s.converter!==null,r);return this._mutations.push(c.toMutation(s._key,xr.none())),this}update(e,n,r,...s){this._verifyNotCommitted();const o=ay(e,this._firestore);let c;return c=typeof(n=En(n))=="string"||n instanceof Sd?DT(this._dataReader,"WriteBatch.update",o._key,n,r,s):kT(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(c.toMutation(o._key,xr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=ay(e,this._firestore);return this._mutations=this._mutations.concat(new _m(n._key,xr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Le(ke.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ay(t,e){if((t=En(t)).firestore!==e)throw new Le(ke.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function ed(){return new Ed("deleteField")}function td(...t){return new Q_("arrayUnion",t)}function QS(...t){return new K_("arrayRemove",t)}function UT(t){return Cm(t=yi(t,Qo)),new cB(t,(e=>jm(t,e)))}(function(e,n=!0){(function(s){bl=s})(gl),el(new Po("firestore",((r,{instanceIdentifier:s,options:o})=>{const c=r.getProvider("app").getImmediate(),l=new Qo(new WM(r.getProvider("auth-internal")),new YM(c,r.getProvider("app-check-internal")),(function(f,p){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new Le(ke.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zu(f.options.projectId,p)})(c,s),c);return o={useFetchStreams:n,...o},l._setSettings(o),l}),"PUBLIC").setMultipleInstances(!0)),Da(Yw,Xw,e),Da(Yw,Xw,"esm2020")})();function Yo(){return V6(qC)}const an={showGroupTotals:!1};async function vt(t,e,n){const r=Cl(Yo(),t,e),s=await nB(r),o=s.exists(),c=o?s.data():null;return{exists:o,data:c,ref:r}}async function Gn(t,e,n){const r=Yo(),s=F6(r,t);let o;if(n&&n.length>0){const f=n.map(p=>J6(p.field,p.op,p.value));o=Z6(s,...f)}else o=s;const c=await rB(o),l=c.docs.map(f=>({id:f.id,data:f.data()}));let h=t;if(n&&n.length>0){const f=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${f}`}return c.docs.length,{docs:l}}async function dr(t,e,n,r,s){const o=Cl(Yo(),t,e);return iB(o,n,s??{})}async function Rm(t,e){const r=Yo();for(let s=0;s<t.length;s+=500){const o=t.slice(s,s+500),c=UT(r);for(const{collectionPath:l,docId:h,data:f}of o){const p=Cl(r,l,h);c.set(p,f)}`${o.length}`,o.length;try{await c.commit()}catch(l){throw console.error(`[Firebase] BATCH_WRITE ERROR in ${e}:`,l),console.error("[Firebase] Failed batch details:",{batchIndex:Math.floor(s/500)+1,totalBatches:Math.ceil(t.length/500),docsInBatch:o.length,firstDoc:o[0]?`${o[0].collectionPath}/${o[0].docId}`:"none"}),l}}}async function ts(t,e,n,r){const s=Cl(Yo(),t,e);return sB(s,n)}async function Wf(t,e,n){const r=Cl(Yo(),t,e);return aB(r)}async function FT(t,e,n){const s=Yo();for(let o=0;o<t.length;o+=500){const c=t.slice(o,o+500),l=UT(s);for(const{collectionPath:h,docId:f}of c){const p=Cl(s,h,f);l.delete(p)}`${c.length}`,c.length,await l.commit(),n?.(o+c.length)}}const Io={mobile:640,tablet:768,wide:1200},lB=Io.mobile,Ss={primary:"--color-primary",error:"--color-error",errorBg:"--color-error-bg",errorBorder:"--color-error-border",success:"--color-success",warning:"--color-warning",danger:"--color-danger",debt:"--color-debt",zero:"--color-zero"},Qf=["January","February","March","April","May","June","July","August","September","October","November","December"],nd=3,t0=3,Vt="ungrouped_accounts",Xt="ungrouped_categories";function uB(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={nickname:r.nickname??"",description:r.description??"",balance:0,account_group_id:r.account_group_id??Vt,sort_order:r.sort_order??0,is_income_account:r.is_income_account??!1,is_income_default:r.is_income_default??!1,is_outgo_account:r.is_outgo_account??!1,is_outgo_default:r.is_outgo_default??!1,on_budget:r.on_budget??!0,is_active:r.is_active??!0}}),e}function dB(t={}){const e={};return Array.isArray(t)?t.forEach(n=>{const r=n.id;e[r]={name:n.name,sort_order:n.sort_order??0,expected_balance:n.expected_balance??"positive",on_budget:n.on_budget!==void 0?n.on_budget:null,is_active:n.is_active!==void 0?n.is_active:null}}):Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,sort_order:r.sort_order??0,expected_balance:r.expected_balance??"positive",on_budget:r.on_budget!==void 0?r.on_budget:null,is_active:r.is_active!==void 0?r.is_active:null}}),e[Vt]||(e[Vt]={name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}),e}function hB(t={}){const e={};return Object.entries(t).forEach(([n,r])=>{e[n]={name:r.name,description:r.description,category_group_id:r.category_group_id??Xt,sort_order:r.sort_order??0,default_monthly_amount:r.default_monthly_amount,default_monthly_type:r.default_monthly_type,balance:0,is_hidden:r.is_hidden??!1}}),e}function fB(t=[]){const e=t.map(r=>({id:r.id,name:r.name,sort_order:r.sort_order??0}));if(!e.some(r=>r.id===Xt)){const r=e.length>0?Math.max(...e.map(s=>s.sort_order)):-1;e.push({id:Xt,name:"Uncategorized",sort_order:r+1})}return e.sort((r,s)=>r.sort_order-s.sort_order),e}function mB(t={}){const e={};return Object.keys(t).forEach(n=>{e[n]={}}),e}async function n0(t){const{exists:e,data:n}=await vt("budgets",t);if(!e||!n)throw new Error(`Budget ${t} not found`);const r=uB(n.accounts),s=dB(n.account_groups),o=hB(n.categories),c=fB(n.category_groups),l=mB(n.month_map);return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:r,account_groups:s,categories:o,category_groups:c,month_map:l,percentage_income_months_back:n.percentage_income_months_back},accounts:r,accountGroups:s,categories:o,categoryGroups:c,monthMap:l}}async function rd(t,e){return e.fetchQuery({queryKey:Te.budget(t),queryFn:()=>n0(t),staleTime:gi})}function gB(t,e){const{initialDataLoadComplete:n}=Qe(),r=!!t&&e?.enabled!==!1&&n;return qo({queryKey:t?Te.budget(t):["budget","none"],queryFn:()=>n0(t),enabled:r,staleTime:gi})}function Zi(t,e,n){const r=n.toString().padStart(2,"0");return`${t}_${e}_${r}`}function El(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function Td(t,e,n){if(n<1)return null;let r=t,s=e;for(let o=0;o<n;o++)s===1?(r-=1,s=12):s-=1;return{year:r,month:s}}function Kf(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function Fe(t,e){return`${t}${e.toString().padStart(2,"0")}`}function Xy(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function Im(t,e){const n=new Date,r=n.getFullYear(),s=n.getMonth()+1;if(t===r&&e===s){const o=n.getDate();return`${r}-${String(s).padStart(2,"0")}-${String(o).padStart(2,"0")}`}return`${t}-${String(e).padStart(2,"0")}-01`}function km(t){const[e,n]=t.split("-").map(Number);return{year:e,month:n}}class r0 extends Error{static __type="MonthNavigationError";__type="MonthNavigationError";shouldRedirectToValidMonth;year;month;constructor(e,n,r,s=!0){super(e),this.name="MonthNavigationError",this.year=n,this.month=r,this.shouldRedirectToValidMonth=s}static is(e){return e!==null&&typeof e=="object"&&"__type"in e&&e.__type==="MonthNavigationError"}}function Dm(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=Number(Fe(e,n));let s=e,o=n-3;o<=0&&(o+=12,s-=1);let c=e,l=n+3;return l>12&&(l-=12,c+=1),{currentOrdinal:r,minOrdinal:Number(Fe(s,o)),maxOrdinal:Number(Fe(c,l))}}function pB(t){const e=Math.floor(t/100),n=t%100;return n===12?(e+1)*100+1:e*100+(n+1)}function yB(t){const e=Math.floor(t/100),n=t%100;return n===1?(e-1)*100+12:e*100+(n-1)}function _B(t){if(!t||Object.keys(t).length===0)return{earliestOrdinal:null,latestOrdinal:null,ordinals:[]};const e=Object.keys(t).map(Number).sort((n,r)=>n-r);return{earliestOrdinal:e[0],latestOrdinal:e[e.length-1],ordinals:e}}function i0(t,e,n){return n?Fe(t,e)in n:!1}function s0(t,e,n){const r=Number(Fe(t,e)),s=Dm(),o=_B(n);if(i0(t,e,n))return{allowed:!0,reason:"exists",error:null};if(o.earliestOrdinal===null||o.latestOrdinal===null)return{allowed:!0,reason:"walk_forward",error:null};const c=pB(o.latestOrdinal);if(r===c)return r<=s.maxOrdinal?{allowed:!0,reason:"walk_forward",error:null}:{allowed:!1,reason:null,error:`Month ${t}/${e} is more than 3 months in the future.`};const h=yB(o.earliestOrdinal);return r===h?r>=s.minOrdinal?{allowed:!0,reason:"walk_back",error:null}:{allowed:!1,reason:null,error:`Month ${t}/${e} is more than 3 months in the past.`}:r>o.latestOrdinal?{allowed:!1,reason:null,error:`Month ${t}/${e} is not immediately after the latest month. You must walk forward one month at a time.`}:r<o.earliestOrdinal?{allowed:!1,reason:null,error:`Month ${t}/${e} is not immediately before the earliest month. You must walk back one month at a time.`}:{allowed:!1,reason:null,error:`Month ${t}/${e} does not exist in budget and cannot be created.`}}function bB(t,e,n){const r=e===1?t-1:t,s=e===1?12:e-1;if(i0(r,s,n))return{canNavigate:!0,canCreate:!1,disabledReason:null};if(s0(r,s,n).allowed)return{canNavigate:!0,canCreate:!0,disabledReason:null};const l=Dm();return Number(Fe(r,s))<l.minOrdinal?{canNavigate:!1,canCreate:!1,disabledReason:"Cannot create months more than 3 months in the past"}:{canNavigate:!1,canCreate:!1,disabledReason:"Can only create the month immediately before the earliest month"}}function vB(t,e,n){const r=e===12?t+1:t,s=e===12?1:e+1;if(i0(r,s,n))return{canNavigate:!0,canCreate:!1,disabledReason:null};if(s0(r,s,n).allowed)return{canNavigate:!0,canCreate:!0,disabledReason:null};const l=Dm();return Number(Fe(r,s))>l.maxOrdinal?{canNavigate:!1,canCreate:!1,disabledReason:"Cannot create months more than 3 months into the future"}:{canNavigate:!1,canCreate:!1,disabledReason:"Can only create the month immediately after the latest month"}}function Ee(t){return Math.round((t+Number.EPSILON)*100)/100}function ht(t){if(t==null||isNaN(t))return!1;const e=t*100;return Math.abs(e-Math.round(e))>1e-9}function Jr(t){if(t==null)return t;if(Array.isArray(t))return t.map(e=>Jr(e));if(typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=Jr(r));return e}return t}const mi="sample_budget",VT="Sample Budget";function KS(t){return t===mi}const Zt="__NO_CATEGORY__",$o="No Category";function lt(t){return t===Zt}const Ht="__NO_ACCOUNT__",Ga="No Account";function tt(t){return t===Ht}function $T(t,e){return Ee(e.filter(n=>n.category_id===t).reduce((n,r)=>n+r.amount,0))}function GT(t,e){let n=0;for(const r of e)r.from_category_id===t&&!lt(r.from_category_id)&&(n-=r.amount),r.to_category_id===t&&!lt(r.to_category_id)&&(n+=r.amount);return Ee(n)}function qT(t,e){return Ee(e.filter(n=>n.category_id===t&&!lt(n.category_id)).reduce((n,r)=>n+r.amount,0))}function HT(t,e,n){const r={},s={},o={};for(const c of t)lt(c.category_id)||(r[c.category_id]=(r[c.category_id]||0)+c.amount);for(const c of e)lt(c.from_category_id)||(s[c.from_category_id]=(s[c.from_category_id]||0)-c.amount),lt(c.to_category_id)||(s[c.to_category_id]=(s[c.to_category_id]||0)+c.amount);for(const c of n)lt(c.category_id)||(o[c.category_id]=(o[c.category_id]||0)+c.amount);for(const c of Object.keys(r))r[c]=Ee(r[c]);for(const c of Object.keys(s))s[c]=Ee(s[c]);for(const c of Object.keys(o))o[c]=Ee(o[c]);return{spentMap:r,transfersMap:s,adjustmentsMap:o}}function WT(t,e,n,r){const s=$T(t.category_id,e),o=GT(t.category_id,n),c=qT(t.category_id,r),l=Ee(t.start_balance+t.allocated+s+o+c);return{...t,spent:s,transfers:o,adjustments:c,end_balance:l}}function QT(t,e,n,r){return t.map(s=>WT(s,e,n,r))}const xB=Object.freeze(Object.defineProperty({__proto__:null,calculateCategoryBalance:WT,calculateCategoryBalances:QT},Symbol.toStringTag,{value:"Module"}));function wB(t,e){return Ee(e.filter(n=>n.account_id===t).reduce((n,r)=>n+r.amount,0))}function SB(t,e){return Ee(e.filter(n=>n.account_id===t).reduce((n,r)=>n+r.amount,0))}function CB(t,e){let n=0;for(const r of e)r.from_account_id===t&&!tt(r.from_account_id)&&(n-=r.amount),r.to_account_id===t&&!tt(r.to_account_id)&&(n+=r.amount);return Ee(n)}function EB(t,e){return Ee(e.filter(n=>n.account_id===t&&!tt(n.account_id)).reduce((n,r)=>n+r.amount,0))}function TB(t,e,n,r,s){const o=wB(t.account_id,e),c=SB(t.account_id,n),l=CB(t.account_id,r),h=EB(t.account_id,s),f=Ee(o+c+l+h),p=Ee(t.start_balance+f);return{...t,income:o,expenses:c,transfers:l,adjustments:h,net_change:f,end_balance:p}}function AB(t,e,n,r,s){return t.map(o=>TB(o,e,n,r,s))}function Mm(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1;let r=e,s=n-t0;for(;s<1;)s+=12,r-=1;return{year:r,month:s}}function a0(t,e){const n=Mm(),r=Fe(t,e),s=Fe(n.year,n.month);return r<=s}function jB(t,e,n,r){if("spent"in t&&"transfers"in t&&"adjustments"in t&&"end_balance"in t)return t;const[s]=QT([t],e,n,r);return s}function RB(t,e,n,r,s){if("income"in t&&"expenses"in t&&"transfers"in t&&"adjustments"in t&&"net_change"in t&&"end_balance"in t)return t;const[o]=AB([t],e,n,r,s);return o}function IB(t,e,n){const r=a0(e,n);return{category_id:t.category_id,start_balance:r?Ee(t.start_balance):0,allocated:Ee(t.allocated)}}function kB(t,e,n){const r=a0(e,n);return{account_id:t.account_id,start_balance:r?Ee(t.start_balance):0}}function Tl(t){const e=t.category_balances.map(r=>jB(r,t.expenses,t.transfers,t.adjustments)),n=t.account_balances.map(r=>RB(r,t.income,t.expenses,t.transfers,t.adjustments));return{...t,category_balances:e,account_balances:n}}function Om(t){const e=t.category_balances.map(l=>IB(l,t.year,t.month)),n=t.account_balances.map(l=>kB(l,t.year,t.month)),{total_income:r,total_expenses:s,previous_month_income:o,...c}=t;return{...c,category_balances:e,account_balances:n}}async function Nm(t,e,n,r,s=1){const o=Td(e,n,s);if(!o)return 0;const{year:c,month:l}=o,h=Te.month(t,c,l);if(r){const f=r.getQueryData(h);if(f?.month){const p=f.month.income||[];return Ee(p.reduce((_,y)=>_+(y.amount||0),0))}}try{const f=Zi(t,c,l),{exists:p,data:g}=await vt("months",f,`[calculatePreviousMonthIncome] income ${s} month(s) back for ${e}/${n}`);if(p&&g?.income){const _=g.income;return Ee(_.reduce((x,w)=>x+(w.amount||0),0))}}catch(f){console.warn(`[calculatePreviousMonthIncome] Could not read month ${c}/${l}:`,f)}return 0}async function DB(t,e,n,r,s,o=1){const c=t.income||[],l=t.expenses||[],h=c.reduce((y,x)=>y+(x.amount||0),0),f=l.reduce((y,x)=>y+(x.amount||0),0),g=t.are_allocations_finalized??!1?0:await Nm(e,n,r,s,o),_={budget_id:e,year_month_ordinal:t.year_month_ordinal??Fe(n,r),year:t.year??n,month:t.month??r,income:c,total_income:h,previous_month_income:g,expenses:l,total_expenses:f,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return Tl(_)}async function wr(t,e,n,r){const s=Zi(t,e,n),c=(await rd(t,Pe)).budget.percentage_income_months_back??1;return(await Pe.fetchQuery({queryKey:Te.month(t,e,n),queryFn:async()=>{const{exists:h,data:f}=await vt("months",s,r?.description??`reading month ${e}/${n}`);return!h||!f?null:{month:await DB(f,t,e,n,Pe,c)}},staleTime:gi}))?.month??null}async function MB(t,e,n,r){const s=t.income||[],o=t.expenses||[],c=s.reduce((_,y)=>_+(y.amount||0),0),l=o.reduce((_,y)=>_+(y.amount||0),0),f=(await rd(e,Pe)).budget.percentage_income_months_back??1,p=await Nm(e,n,r,Pe,f),g={budget_id:e,year_month_ordinal:t.year_month_ordinal??Fe(n,r),year:t.year??n,month:t.month??r,income:s,total_income:c,previous_month_income:p,expenses:o,total_expenses:l,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return Tl(g)}async function OB(t,e,n,r){const s=Zi(t,e,n),{exists:o,data:c}=await vt("months",s);if(!o||!c)throw new Error(`Month data not found for ${e}/${n}`);return await MB(c,t,e,n)}function NB(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(r=>{e[r.category_id]=r.end_balance}),t.account_balances&&t.account_balances.forEach(r=>{n[r.account_id]=r.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}function KT(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=[];for(let s=t0;s>0;s--){let o=e,c=n-s;for(;c<1;)c+=12,o-=1;r.push(Fe(o,c))}r.push(Fe(e,n));for(let s=1;s<=nd;s++){let o=e,c=n+s;for(;c>12;)c-=12,o+=1;r.push(Fe(o,c))}return r}function BB(t,e){const n=Te.budget(t),r=Pe.getQueryData(n);if(!r?.monthMap||!(e in r.monthMap))return!1;const s=KT();for(const o of s)if(o>=e&&!(o in r.monthMap))return!1;return!0}function PB(t,e,n){const r=Te.budget(t),s=Pe.getQueryData(r);s&&Pe.setQueryData(r,{...s,monthMap:n,budget:{...s.budget,month_map:n}})}function zB(t,e){const n=Te.budget(t),r=Pe.getQueryData(n);r&&Pe.setQueryData(n,{...r,monthMap:e,budget:{...r.budget,month_map:e}})}function LB(t,e){const n=Te.budget(t),r=Pe.getQueryData(n);r&&Pe.setQueryData(n,{...r,monthMap:e,budget:{...r.budget,month_map:e}})}function UB(t,e,n){const r=Fe(e,n),s=Te.budget(t),o=Pe.getQueryData(s);if(!o)return console.warn(`[removeMonthFromMap] Budget ${t} not found in cache`),{};const c=o.monthMap||{},{[r]:l,...h}=c;return Pe.setQueryData(s,{...o,monthMap:h,budget:{...o.budget,month_map:h}}),h}async function FB(t,e,n,r){const{bypassDateLimit:s=!1}={},o=new Date,c=o.getFullYear(),l=o.getMonth()+1,h=(e-c)*12+(n-l);if(!s&&h>nd){const B=`[createMonth] Refusing to create month ${e}/${n} - it's ${h} months in the future (max allowed: ${nd}). This likely indicates a bug in month navigation.`;throw console.error(B),new Error(B)}const{exists:f,data:p}=await vt("budgets",t);if(!f||!p){Pe.removeQueries({queryKey:Te.budget(t)});const B=`[createMonth] Budget ${t} does not exist. It may have been deleted. Please refresh the page.`;throw console.error(B),new Error(B)}const g=o.toISOString(),_=Zi(t,e,n),y=p.percentage_income_months_back??1;let x=0,w={},S={};if(n>1||e>new Date().getFullYear()-10){const{year:B,month:V}=El(e,n),$=Zi(t,B,V),k=Te.month(t,B,V),N=Pe.getQueryData(k);let D=null;if(N?.month){const X=N.month;D={budget_id:X.budget_id,year_month_ordinal:X.year_month_ordinal,year:X.year,month:X.month,income:X.income,expenses:X.expenses,transfers:X.transfers,adjustments:X.adjustments,account_balances:X.account_balances,category_balances:X.category_balances,are_allocations_finalized:X.are_allocations_finalized,created_at:X.created_at,updated_at:X.updated_at}}else try{const{exists:X,data:K}=await vt("months",$,"fetching previous month to create start balances for new month");X&&(D=K)}catch(X){if(X instanceof Error&&X.message.includes("Missing or insufficient permissions"))console.warn(`[createMonth] Permission error reading previous month ${B}/${V}, starting with zero balances`);else throw X}if(D){const X={budget_id:t,year_month_ordinal:D.year_month_ordinal??Fe(B,V),year:D.year??B,month:D.month??V,income:D.income||[],total_income:D.total_income??0,previous_month_income:D.previous_month_income??0,expenses:D.expenses||[],total_expenses:D.total_expenses??0,transfers:D.transfers||[],adjustments:D.adjustments||[],account_balances:D.account_balances||[],category_balances:D.category_balances||[],are_allocations_finalized:D.are_allocations_finalized??!1,created_at:D.created_at,updated_at:D.updated_at},K=Tl(X);if(y===1)x=K.total_income;else{const Q=Td(e,n,y);if(Q){const ae=Te.month(t,Q.year,Q.month),P=Pe.getQueryData(ae);if(P?.month)x=(P.month.income||[]).reduce((G,ee)=>G+(ee.amount||0),0);else try{const G=Zi(t,Q.year,Q.month),{exists:ee,data:re}=await vt("months",G,"fetching month for percentage income");ee&&re?.income&&(x=re.income.reduce((se,ge)=>se+(ge.amount||0),0))}catch{}}}const{categoryEndBalances:q,accountEndBalances:te}=NB(K);w=q,S=te}}const E=a0(e,n),T=Object.entries(w).map(([B,V])=>({category_id:B,start_balance:E?V:0,allocated:0,spent:0,transfers:0,adjustments:0,end_balance:V})),A=Object.entries(S).map(([B,V])=>({account_id:B,start_balance:E?V:0,income:0,expenses:0,transfers:0,adjustments:0,net_change:0,end_balance:V})),M={budget_id:t,year_month_ordinal:Fe(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:x,expenses:[],total_expenses:0,transfers:[],adjustments:[],account_balances:A,category_balances:T,are_allocations_finalized:!1,created_at:g,updated_at:g},L={budget_id:t,year_month_ordinal:Fe(e,n),year:e,month:n,income:[],expenses:[],transfers:[],adjustments:[],account_balances:A,category_balances:T,are_allocations_finalized:!1,created_at:g,updated_at:g};await dr("months",_,L),Pe.setQueryData(Te.month(t,e,n),{month:M});const H=Fe(e,n),j={...p.month_map||{},[H]:{}};return zB(t,j),await ts("budgets",t,{month_map:j,updated_at:g}),M}async function VB(t,e,n,r,s,o=1){const c=t.income||[],l=t.expenses||[],h=c.reduce((y,x)=>y+(x.amount||0),0),f=l.reduce((y,x)=>y+(x.amount||0),0),g=t.are_allocations_finalized??!1?0:await Nm(e,n,r,s,o),_={budget_id:e,year_month_ordinal:t.year_month_ordinal??Fe(n,r),year:t.year??n,month:t.month??r,income:c,total_income:h,previous_month_income:g,expenses:l,total_expenses:f,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return Tl(_)}async function o0(t,e,n,r,s=1){const o=Zi(t,e,n);try{const{exists:c,data:l}=await vt("months",o,`loading month ${e}/${n}`);return!c||!l?null:await VB(l,t,e,n,r,s)}catch(c){if(c instanceof Error&&c.message.includes("Missing or insufficient permissions"))return console.warn(`[readMonthDirect] Permission error reading month ${e}/${n}, treating as not found`),null;throw c}}async function $B(t,e,n,r){if(r){const f=Te.month(t,e,n),p=r.getQueryData(f);if(p?.month){if(!p.month.are_allocations_finalized){const _=(await rd(t,r)).budget.percentage_income_months_back??1,y=await Nm(t,e,n,r,_);return{...p.month,previous_month_income:y}}return p.month}}const s=r?await rd(t,r):null,o=s?.budget.percentage_income_months_back??1,c=await o0(t,e,n,r,o);if(c)return c;let l=null;if(r&&s&&s.monthMap)l=s.monthMap;else{const{exists:f,data:p}=await vt("budgets",t);f&&p?.month_map&&(l=p.month_map)}const h=s0(e,n,l);if(h.allowed)return FB(t,e,n);throw new r0(h.error||`Month ${e}/${n} cannot be created.`,e,n,!0)}function GB(t,e,n,r){const s=Rt(),{initialDataLoadComplete:o}=Qe(),c=t?Te.month(t,e,n):["month","none"],l=!!t&&r?.enabled!==!1&&o,h=s.getQueryData(c);return s.getQueryState(c)?.status==="success"&&!h&&s.resetQueries({queryKey:c,exact:!0}),qo({queryKey:c,queryFn:async()=>({month:await $B(t,e,n,s)}),enabled:l,staleTime:gi,retry:(p,g)=>r0.is(g)?!1:p<3})}async function YT(t){const{exists:e,data:n}=await vt("payees",t);return e&&n?n.payees||[]:[]}function c0(t,e){const{initialDataLoadComplete:n}=Qe(),r=!!t&&e?.enabled!==!1&&n;return qo({queryKey:t?Te.payees(t):["payees","none"],queryFn:()=>YT(t),enabled:r,staleTime:gi})}async function qB(t,e){const{exists:n,data:r}=await vt("users",t);if(n&&r)return r;const s={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await dr("users",t,s),s}function XT(t,e,n){return qo({queryKey:t?Te.user(t):["user","none"],queryFn:()=>qB(t,e),enabled:!!t&&n?.enabled!==!1})}async function HB(t,e){const n=e?.permission_flags?.is_admin===!0,r=await Gn("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),s=[],o=[];for(const c of r.docs){const l=c.data;l.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(c.id)?s.push({id:c.id,name:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null,isOwner:l.owner_id===t,isPending:!1}):o.push({budgetId:c.id,budgetName:l.name||"Unnamed Budget",ownerEmail:l.owner_email||null})}if(n&&!s.some(l=>l.id===mi))try{const l=await vt("budgets",mi,"loading sample budget for admin");l.exists&&l.data&&s.push({id:mi,name:l.data.name||VT,ownerEmail:null,isOwner:!1,isPending:!1,isSampleBudget:!0})}catch{}return{budgets:s,pendingInvites:o}}function WB(t,e,n){return qo({queryKey:t?Te.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?HB(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function QB(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function KB(){const t=await Gn("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const r=QB(n.data.items),s=n.data.user_email||n.id;r.forEach(o=>{e.push({...o,doc_id:n.id,user_email:s})})}return{items:e}}function YB(t){return qo({queryKey:Te.feedback(),queryFn:KB,enabled:t?.enabled!==!1})}const XB="modulepreload",ZB=function(t){return"/"+t},YS={},id=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){let f=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};var c=f;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),h=l?.nonce||l?.getAttribute("nonce");s=f(n.map(p=>{if(p=ZB(p),p in YS)return;YS[p]=!0;const g=p.endsWith(".css"),_=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${_}`))return;const y=document.createElement("link");if(y.rel=g?"stylesheet":XB,g||(y.as="script"),y.crossOrigin="",y.href=p,h&&y.setAttribute("nonce",h),document.head.appendChild(y),g)return new Promise((x,w)=>{y.addEventListener("load",x),y.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(l){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=l,window.dispatchEvent(h),!h.defaultPrevented)throw l}return s.then(l=>{for(const h of l||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})},Bo={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function Ad(t,e,n){const r=t.income||[],s=t.expenses||[],o=Ee(r.reduce((y,x)=>y+x.amount,0)),c=Ee(s.reduce((y,x)=>y+x.amount,0)),{spentMap:l,transfersMap:h,adjustmentsMap:f}=HT(s,t.transfers||[],t.adjustments||[]),p=JB(t.category_balances,e.categoryEndBalances,h,f,l),g=eP(t,e.accountEndBalances),_=n!==void 0?n:e.totalIncome;return{...t,total_income:o,total_expenses:c,previous_month_income:_,category_balances:p,account_balances:g,updated_at:new Date().toISOString()}}function JB(t,e,n,r,s){const o=new Map;for(const h of t)lt(h.category_id)||o.set(h.category_id,h);const c=new Set;for(const h of t)lt(h.category_id)||c.add(h.category_id);for(const h of Object.keys(e))lt(h)||c.add(h);for(const h of Object.keys(n))lt(h)||c.add(h);for(const h of Object.keys(r))lt(h)||c.add(h);const l=[];for(const h of c){const f=o.get(h),p=Ee(e[h]??0),g=Ee(f?.allocated??0),_=Ee(s[h]??0),y=Ee(n[h]??0),x=Ee(r[h]??0);l.push({category_id:h,start_balance:p,allocated:g,spent:_,transfers:y,adjustments:x,end_balance:Ee(p+g+_+y+x)})}return l}function eP(t,e){const n=new Set;for(const s of t.income||[])tt(s.account_id)||n.add(s.account_id);for(const s of t.expenses||[])tt(s.account_id)||n.add(s.account_id);for(const s of t.transfers||[])tt(s.from_account_id)||n.add(s.from_account_id),tt(s.to_account_id)||n.add(s.to_account_id);for(const s of t.adjustments||[])tt(s.account_id)||n.add(s.account_id);for(const s of Object.keys(e))tt(s)||n.add(s);for(const s of t.account_balances||[])tt(s.account_id)||n.add(s.account_id);const r=[];for(const s of n){const o=Ee(e[s]??0),c=Ee((t.income||[]).filter(y=>y.account_id===s).reduce((y,x)=>y+x.amount,0)),l=Ee((t.expenses||[]).filter(y=>y.account_id===s).reduce((y,x)=>y+x.amount,0)),h=Ee((t.transfers||[]).filter(y=>y.from_account_id===s).reduce((y,x)=>y-x.amount,0)),f=Ee((t.transfers||[]).filter(y=>y.to_account_id===s).reduce((y,x)=>y+x.amount,0)),p=Ee(f+h),g=Ee((t.adjustments||[]).filter(y=>y.account_id===s).reduce((y,x)=>y+x.amount,0)),_=Ee(c+l+p+g);r.push({account_id:s,start_balance:o,income:c,expenses:l,transfers:p,adjustments:g,net_change:_,end_balance:Ee(o+_)})}return r}function ul(t){const e={},n={};for(const r of t.category_balances||[])lt(r.category_id)||(e[r.category_id]=Ee(r.end_balance));for(const r of t.account_balances||[])tt(r.account_id)||(n[r.account_id]=Ee(r.end_balance));return{categoryEndBalances:e,accountEndBalances:n,totalIncome:Ee(t.total_income)}}async function tP(t,e){return Pe.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:r}=await vt("budgets",t);return!n||!r?null:{isInvited:r.user_ids?.includes(e)??!1,hasAccepted:r.accepted_user_ids?.includes(e)??!1,budgetName:r.name||"Unnamed Budget",ownerEmail:r.owner_email||null}},staleTime:60*1e3})}async function Zy(t,e,n){const r=await wr(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return r?{year:r.year,month:r.month,category_balances:r.category_balances,are_allocations_finalized:r.are_allocations_finalized,expenses:r.expenses}:null}async function nP(t,e,n,r){const s={};e.forEach(_=>{s[_]=0});const o=await Zy(t,n,r);if(o?.category_balances){for(const _ of o.category_balances)e.includes(_.category_id)&&(s[_.category_id]=_.end_balance);return s}const c={};e.forEach(_=>{c[_]=0});const l=[];o&&l.push(o);let h=n,f=r,p=!1;const g=120;for(let _=0;_<g&&!p;_++){const y=El(h,f);h=y.year,f=y.month;const x=await Zy(t,h,f);if(!x)p=!0;else if(x.category_balances){p=!0;for(const w of x.category_balances)e.includes(w.category_id)&&(c[w.category_id]=w.end_balance)}else l.push(x)}l.reverse(),Object.assign(s,c);for(const _ of l){if(_.are_allocations_finalized&&_.category_balances)for(const y of _.category_balances)e.includes(y.category_id)&&(s[y.category_id]=(s[y.category_id]||0)+y.allocated);if(_.expenses)for(const y of _.expenses)e.includes(y.category_id)&&(s[y.category_id]=(s[y.category_id]||0)-y.amount)}return s}async function rP(t,e,n,r,s){const o={...n},l=Pe.getQueryData(Te.budget(t))?.monthMap||{},h=new Date,f=h.getFullYear(),p=h.getMonth()+1;let g=f,_=p+nd;for(;_>12;)_-=12,g+=1;const y=Fe(g,_);let x=r,w=s;const S=nd*2;for(let E=0;E<S;E++){const T=Kf(x,w);x=T.year,w=T.month;const A=Fe(x,w);if(A>y||!(A in l))break;const M=await Zy(t,x,w);if(!M)break;if(M.are_allocations_finalized&&M.category_balances)for(const L of M.category_balances)e.includes(L.category_id)&&(o[L.category_id]=(o[L.category_id]||0)+L.allocated);if(M.expenses)for(const L of M.expenses)e.includes(L.category_id)&&(o[L.category_id]=(o[L.category_id]||0)-L.amount)}return o}async function XS(t,e,n,r){const s=await nP(t,e,n,r),o=await rP(t,e,s,n,r);return{current:s,total:o}}function Bm(t,e){const n=t.account_group_id?e[t.account_group_id]:void 0,r=n&&n.on_budget!==null?n.on_budget:t.on_budget!==!1,s=n&&n.is_active!==null?n.is_active:t.is_active!==!1;return r&&s}function ZT(t,e,n){const r=Object.entries(t).reduce((o,[,c])=>Bm(c,n)?o+(c.balance??0):o,0),s=Object.values(e).reduce((o,c)=>{const l=c.balance??0;return o+(l>0?l:0)},0);return Ee(r-s)}const iP=Object.freeze(Object.defineProperty({__proto__:null,calculateTotalAvailable:ZT,isAccountOnBudget:Bm},Symbol.toStringTag,{value:"Module"}));function sP(t={}){const e={};return Object.keys(t).forEach(n=>{e[n]={}}),e}async function aP(t,e,n,r){let s=null;const o=Pe.getQueryData(Te.budget(t));if(o?.budget)s=o.budget;else{const{exists:g,data:_}=await vt("budgets",t);if(!g||!_)return;s=_}if(!s)return;const c={...s.accounts};for(const[g,_]of Object.entries(e))c[g]&&(c[g]={...c[g],balance:Ee(_)});const l={...s.categories};for(const[g,_]of Object.entries(n))l[g]&&(l[g]={...l[g],balance:Ee(_)});const{calculateTotalAvailable:h}=await id(async()=>{const{calculateTotalAvailable:g}=await Promise.resolve().then(()=>iP);return{calculateTotalAvailable:g}},[]),f=h(c,l,s.account_groups||{}),{writeBudgetData:p}=await id(async()=>{const{writeBudgetData:g}=await Promise.resolve().then(()=>mA);return{writeBudgetData:g}},void 0);await p({budgetId:t,updates:{month_map:r},description:"[recalc] updating month_map"}),oP(t,c,l,f,r)}function oP(t,e,n,r,s){const o=Pe.getQueryData(Te.budget(t));if(o){const c={};for(const[h,f]of Object.entries(o.accounts)){const p=e[h];p&&p.balance!==void 0?c[h]={...f,balance:Ee(p.balance)}:c[h]=f}const l={};for(const[h,f]of Object.entries(o.categories)){const p=n[h];p&&p.balance!==void 0?l[h]={...f,balance:Ee(p.balance)}:l[h]=f}Pe.setQueryData(Te.budget(t),{...o,accounts:c,categories:l,accountGroups:o.accountGroups,categoryGroups:o.categoryGroups,monthMap:s,budget:{...o.budget,accounts:c,categories:l,account_groups:o.budget.account_groups,category_groups:o.budget.category_groups,month_map:s}})}}async function l0(t,e,n){const r=Fe(e,n);if(BB(t,r))return{addedCount:0,budgetUpdated:!1};const s=Te.budget(t),o=Pe.getQueryData(s);let c=null;if(o?.budget)c=o.budget;else{const{exists:g,data:_}=await vt("budgets",t);if(!g||!_)return console.warn(`[ensureMonthsInMap] Budget ${t} not found`),{addedCount:0,budgetUpdated:!1};c=_}const h={...c.month_map||{}},f=KT();let p=0;r in h||(h[r]={},p++);for(const g of f)g>=r&&!(g in h)&&(h[g]={},p++);return p===0?{addedCount:0,budgetUpdated:!1}:(PB(t,r,h),await ts("budgets",t,{month_map:h,updated_at:new Date().toISOString()}),{addedCount:p,budgetUpdated:!0})}async function cP(t,e){if(e.length===0)return{addedCount:0,budgetUpdated:!1};const n=Te.budget(t),r=Pe.getQueryData(n);let s=null;if(r?.budget)s=r.budget;else{const{exists:h,data:f}=await vt("budgets",t);if(!h||!f)return console.warn(`[ensureMonthsInMapBatch] Budget ${t} not found`),{addedCount:0,budgetUpdated:!1};s=f}const c={...s.month_map||{}};let l=0;for(const{year:h,month:f}of e){const p=Fe(h,f);p in c||(c[p]={},l++)}return l===0?{addedCount:0,budgetUpdated:!1}:(LB(t,c),await ts("budgets",t,{month_map:c,updated_at:new Date().toISOString()}),{addedCount:l,budgetUpdated:!0})}const lP=Object.freeze(Object.defineProperty({__proto__:null,ensureMonthsInMap:l0,ensureMonthsInMapBatch:cP},Symbol.toStringTag,{value:"Module"}));function uP(t){return{year:parseInt(t.substring(0,4),10),month:parseInt(t.substring(4,6),10)}}const ZS=t=>(t.category_balances||[]).some(e=>!lt(e.category_id)&&(e.start_balance??0)!==0)||(t.account_balances||[]).some(e=>!tt(e.account_id)&&(e.start_balance??0)!==0);async function dP(t,e){if(e.length===0)return Bo;const n=e[0];if(ZS(n)){const c={},l={};for(const h of n.category_balances||[])lt(h.category_id)||(c[h.category_id]=Ee(h.start_balance??0));for(const h of n.account_balances||[])tt(h.account_id)||(l[h.account_id]=Ee(h.start_balance??0));return{categoryEndBalances:c,accountEndBalances:l,totalIncome:Ee(n.previous_month_income??0)}}let r=n.year,s=n.month;const o=120;for(let c=0;c<o;c++){const l=El(r,s);r=l.year,s=l.month;const h=await wr(t,r,s,{description:"recalculateAllBalances: walking backward for start_balance"});if(!h)return Bo;if(ZS(h)){const f={},p={};for(const g of h.category_balances||[])lt(g.category_id)||(f[g.category_id]=Ee(g.end_balance??0));for(const g of h.account_balances||[])tt(g.account_id)||(p[g.account_id]=Ee(g.end_balance??0));return{categoryEndBalances:f,accountEndBalances:p,totalIncome:Ee(h.total_income??0)}}}return Bo}async function JT(t,e){const n=Pe.getQueryData(Te.budget(t));if(!n){console.warn("[recalculateAllBalancesFromCache] Budget not in cache");return}const{categories:r}=n,s=n.monthMap||{};let o;if(e?.months?.length)o=[...e.months].sort((g,_)=>g.year!==_.year?g.year-_.year:g.month-_.month);else{const g=Object.keys(s).sort();o=[];for(const _ of g){const{year:y,month:x}=uP(_),w=Pe.getQueryData(Te.month(t,y,x));w?.month&&o.push(w.month)}o.sort((_,y)=>_.year!==y.year?_.year-y.year:_.month-y.month)}const c=(()=>{for(let g=o.length-1;g>=0;g--){const _=o[g];if(_.are_allocations_finalized)return Fe(_.year,_.month)}return null})(),l=c!=null?o.filter(g=>Fe(g.year,g.month)<=c):o;if(l.length===0)return;let h=await dP(t,l);const f=new Map;let p=null;for(const g of l){const _=Ad(g,h,g.previous_month_income),y=Fe(_.year,_.month);f.set(y,_),h=ul(_),_.are_allocations_finalized&&(p=y)}for(const[,g]of f){const _=Te.month(t,g.year,g.month);Pe.setQueryData(_,{month:g})}for(const g of f.values())Pe.invalidateQueries({queryKey:Te.month(t,g.year,g.month)});if(p&&f.has(p)){const g=f.get(p),_={...r};for(const x of g.category_balances||[])!lt(x.category_id)&&_[x.category_id]&&(_[x.category_id]={..._[x.category_id],balance:Ee(x.end_balance??0)});const y={...n.accounts};for(const x of g.account_balances||[])!tt(x.account_id)&&y[x.account_id]&&(y[x.account_id]={...y[x.account_id],balance:Ee(x.end_balance??0)});Pe.setQueryData(Te.budget(t),{...n,categories:_,accounts:y})}}async function eA(t,e,n){const r=Zi(t,e.year,e.month),s=Om(e);await dr("months",r,s)}async function tA(t){const{budgetId:e,month:n,description:r,updateMonthMap:s=!0}=t;await eA(e,n,r||`${n.year}/${n.month}`),Pe.setQueryData(Te.month(e,n.year,n.month),{month:n}),s&&await l0(e,n.year,n.month)}function hP(){const t=Rt();return{writeData:Tn({mutationFn:async({budgetId:n,month:r,description:s,updateMonthMap:o=!0})=>(await eA(n,r,s||`${r.year}/${r.month}`),{budgetId:n,year:r.year,month:r.month,updateMonthMap:o}),onMutate:async({budgetId:n,month:r})=>{const s=Te.month(n,r.year,r.month);await t.cancelQueries({queryKey:s});const o=t.getQueryData(s);return t.setQueryData(s,{month:r}),{oldMonthQueryData:o,monthKey:s}},onSuccess:async({budgetId:n,year:r,month:s,updateMonthMap:o})=>{o&&await l0(n,r,s)},onError:(n,r,s)=>{s?.oldMonthQueryData&&t.setQueryData(s.monthKey,s.oldMonthQueryData)}})}}function fP(){const{writeData:t}=hP();return{saveDraftAllocations:async(n,r,s,o)=>{const c=await wr(n,r,s);if(!c)throw new Error(`Month not found: ${r}/${s}`);const{calculateCategoryBalances:l}=await id(async()=>{const{calculateCategoryBalances:g}=await Promise.resolve().then(()=>xB);return{calculateCategoryBalances:g}},void 0),h=c.category_balances.map(g=>({category_id:g.category_id,start_balance:g.start_balance,allocated:Ee(o[g.category_id]??g.allocated)})),f=l(h,c.expenses||[],c.transfers||[],c.adjustments||[]),p={...c,category_balances:f,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:p,updateMonthMap:!1}),{updatedMonth:p}},isPending:t.isPending,isError:t.isError,error:t.error}}const me={primary:`var(${Ss.primary})`,error:`var(${Ss.error})`,errorBg:`var(${Ss.errorBg})`,errorBorder:`var(${Ss.errorBorder})`,success:`var(${Ss.success})`,danger:`var(${Ss.danger})`,warning:`var(${Ss.warning})`,debt:`var(${Ss.debt})`,zero:`var(${Ss.zero})`},Or={textDecoration:"underline",textDecorationStyle:"dotted",textUnderlineOffset:"3px"},qa="1px solid color-mix(in srgb, currentColor 20%, transparent)",Yf={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},u0={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},mP={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},gP={display:"flex",flexDirection:"column",gap:"0.5rem"},pP={fontSize:"0.9rem",fontWeight:500},Ka={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},yP={...Ka,cursor:"pointer"},d0={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},nA={...d0,background:me.primary,color:"white",border:"none"},_P={...nA,padding:"0.75rem 1.5rem",borderRadius:"8px"},bP={...d0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},vP={...d0,background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error},xP={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s",whiteSpace:"nowrap"},ja={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},Xf={display:"flex",flexDirection:"column",gap:"2px"},wP={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},SP={opacity:.4,cursor:"grab"},CP={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:me.primary,borderRadius:"2px",transition:"opacity 0.15s"},EP={position:"relative",height:"2rem",marginTop:"-0.25rem"},TP={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:me.primary,borderRadius:"2px",transition:"opacity 0.15s"},AP={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--surface-base)",padding:"0 0.5rem",whiteSpace:"nowrap"},jP={background:me.errorBg,border:`1px solid ${me.errorBorder}`,color:me.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},RP={background:"transparent",border:"none",color:me.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},rA={opacity:.7,marginBottom:"1.5rem"},JS={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"};function h0({message:t,children:e,onDismiss:n,style:r}){return d.jsxs("div",{style:{...jP,...r},children:[d.jsx("span",{children:e??t}),n&&d.jsx("button",{onClick:n,style:RP,children:""})]})}const IP={primary:nA,"primary-large":_P,secondary:bP,danger:vP,small:xP},kP={position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:me.warning,color:"var(--text-primary)",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,whiteSpace:"nowrap",marginBottom:"0.5rem",zIndex:100,boxShadow:"0 2px 8px var(--shadow-overlay)",animation:"tooltipFadeIn 0.15s ease-out"},DP={position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`6px solid ${me.warning}`};function Ge({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:r,disabled:s,style:o,actionName:c,disabledReason:l,onClick:h,...f}){const p=IP[t],g=s||e,[_,y]=R.useState(!1);function x(E){h?.(E)}function w(E){g&&l&&(E.preventDefault(),E.stopPropagation(),y(!0),setTimeout(()=>y(!1),3e3))}const S=g?{cursor:"not-allowed",opacity:.35,filter:"grayscale(50%)"}:{};return d.jsxs("div",{style:{position:"relative",display:"inline-block"},onClick:w,children:[_&&l&&d.jsxs("div",{style:kP,children:[l,d.jsx("div",{style:DP})]}),d.jsx("button",{disabled:g,style:{...p,cursor:g?"not-allowed":"pointer",...S,...o},onClick:x,...f,children:e?n:r})]})}function iA(t,e){const n=t.toLowerCase(),r=e.toLowerCase();if(r.includes(n)){const l=r.indexOf(n);return{match:!0,score:l===0||/\s/.test(r[l-1])?100:90}}let s=0,o=0,c=0;for(let l=0;l<r.length&&s<n.length;l++)r[l]===n[s]?(s++,c++,o+=c*2):c=0;return s===n.length?{match:!0,score:o}:{match:!1,score:0}}function sA(t){return[...t].sort((e,n)=>!e.groupId&&n.groupId?1:e.groupId&&!n.groupId?-1:!e.groupId&&!n.groupId?e.sortOrder-n.sortOrder:e.groupSortOrder!==n.groupSortOrder?e.groupSortOrder-n.groupSortOrder:e.sortOrder-n.sortOrder)}function aA(t){const e=sA(t),n=[];let r="__initial__";return e.forEach(s=>{s.groupId!==r&&(r=s.groupId,n.push({groupId:s.groupId,groupName:s.groupName,groupSortOrder:s.groupSortOrder,items:[]})),n[n.length-1].items.push(s)}),n}function oA(t,e,n){return e.trim()?t.map(s=>{const o=n(s);let c=0,l=!1;for(const h of o){const f=iA(e,h);f.match&&(l=!0,c=Math.max(c,f.score))}return{item:s,score:c,hasMatch:l}}).filter(({hasMatch:s})=>s).sort((s,o)=>o.score!==s.score?o.score-s.score:!s.item.groupId&&o.item.groupId?1:s.item.groupId&&!o.item.groupId?-1:s.item.groupSortOrder!==o.item.groupSortOrder?s.item.groupSortOrder-o.item.groupSortOrder:s.item.sortOrder-o.item.sortOrder).map(({item:s})=>s):sA(t)}const f0={position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--surface-base)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px var(--shadow-overlay)",zIndex:1e3},sd={padding:"0.6rem 0.8rem",cursor:"pointer",transition:"background 0.1s"};function e1({id:t,value:e,onChange:n,payees:r,placeholder:s="Enter payee name",autoFocus:o}){const[c,l]=R.useState(!1),[h,f]=R.useState(-1),p=R.useRef(null),g=R.useRef(null),_=e.trim()?r.map(w=>({payee:w,...iA(e,w)})).filter(w=>w.match).sort((w,S)=>S.score-w.score).slice(0,8).map(w=>w.payee):[];R.useEffect(()=>{function w(S){p.current&&!p.current.contains(S.target)&&l(!1)}return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[]);function y(w){!c||_.length===0||(w.key==="ArrowDown"?(w.preventDefault(),f(S=>Math.min(S+1,_.length-1))):w.key==="ArrowUp"?(w.preventDefault(),f(S=>Math.max(S-1,-1))):w.key==="Enter"&&h>=0?(w.preventDefault(),n(_[h]),l(!1),f(-1)):w.key==="Escape"&&(l(!1),f(-1)))}function x(w){n(w),l(!1),f(-1),g.current?.focus()}return d.jsxs("div",{ref:p,style:{position:"relative"},children:[d.jsx("input",{ref:g,id:t,type:"text",value:e,onChange:w=>{n(w.target.value),l(!0),f(-1)},onFocus:()=>l(!0),onKeyDown:y,placeholder:s,autoComplete:"off",autoFocus:o,style:Ka}),c&&_.length>0&&d.jsx("div",{style:{...f0,maxHeight:"200px",overflowY:"auto"},children:_.map((w,S)=>d.jsx("div",{onClick:()=>x(w),style:{...sd,background:S===h?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:S<_.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none"},onMouseEnter:()=>f(S),children:w},w))})]})}function cA({id:t,value:e,onChange:n,categories:r,categoryGroups:s,placeholder:o="Search categories...",required:c,showNoCategoryOption:l=!1,showHiddenCategories:h=!1}){const f=Object.fromEntries(s.map(q=>[q.id,q.name])),p=Object.fromEntries(s.map(q=>[q.id,q.sort_order])),g=h?r:Object.fromEntries(Object.entries(r).filter(([,q])=>!q.is_hidden)),_=Object.entries(g).map(([q,te])=>({id:q,name:te.name,groupId:te.category_group_id,groupName:te.category_group_id&&f[te.category_group_id]||null,sortOrder:te.sort_order,groupSortOrder:te.category_group_id?p[te.category_group_id]??999:999})),y=e===Zt,x=y?null:e?r[e]:null,w=y?"":x?.name||"",[S,E]=R.useState(w),[T,A]=R.useState(!1),[M,L]=R.useState(-1),H=R.useRef(null),O=R.useRef(null);R.useEffect(()=>{if(e===Zt)E("");else if(e){const q=r[e];E(q?.name||"")}},[e,r]);const j=oA(_,S,q=>[q.name]),B=aA(j);R.useEffect(()=>{function q(te){if(H.current&&!H.current.contains(te.target))if(A(!1),e===Zt)E("");else{const Q=e?r[e]:null;E(Q?.name||"")}}return document.addEventListener("mousedown",q),()=>document.removeEventListener("mousedown",q)},[e,r]);function V(q){if(q.key==="ArrowDown")q.preventDefault(),T?L(te=>Math.min(te+1,j.length-1)):(A(!0),L(0));else if(q.key==="ArrowUp")q.preventDefault(),L(te=>Math.max(te-1,0));else if(q.key==="Enter")q.preventDefault(),T&&M>=0&&j[M]&&$(j[M]);else if(q.key==="Escape")if(A(!1),L(-1),e===Zt)E("");else{const te=e?r[e]:null;E(te?.name||"")}else if(q.key==="Tab")if(T&&M>=0&&j[M])$(j[M]);else if(A(!1),L(-1),e===Zt)E("");else{const te=e?r[e]:null;E(te?.name||"")}}function $(q){n(q.id),E(q.id===Zt?"":q.name),A(!1),L(-1)}function k(){n(Zt),E(""),A(!1),L(-1)}function N(q){const te=q.target.value;E(te),A(!0),L(te.trim()?0:-1),te!==w&&(l&&te.trim()===""?n(Zt):n(""))}function D(){A(!0),l&&(e===Zt||S.trim()==="")?L(-1):j.length>0&&L(0)}let X=-1;const K=()=>++X;return d.jsxs("div",{ref:H,style:{position:"relative"},children:[d.jsx("input",{ref:O,id:t,type:"text",value:S,onChange:N,onFocus:D,onKeyDown:V,placeholder:o,autoComplete:"off",required:c&&!l,style:{...Ka,borderColor:c&&!e?me.error:void 0}}),T&&d.jsxs("div",{style:{...f0,maxHeight:"250px",overflowY:"auto"},children:[l&&d.jsx("div",{onClick:k,onMouseEnter:()=>L(-1),style:{...sd,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:M===-1?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent"},children:$o}),B.map((q,te)=>d.jsxs("div",{children:[q.groupName&&d.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:q.groupName}),q.items.map(Q=>{const ae=K();return d.jsx("div",{onClick:()=>$(Q),style:{...sd,paddingLeft:q.groupName?"1.2rem":"0.8rem",background:ae===M?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>L(ae),children:Q.name},Q.id)})]},`group-${te}`)),j.length===0&&S.trim()&&!l&&d.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})]})}function lA({id:t,value:e,onChange:n,accounts:r,accountGroups:s,placeholder:o="Search accounts...",required:c,showNoAccountOption:l=!1,showHiddenAccounts:h=!1}){const p=(h?r:r.filter(([,X])=>!X.is_hidden)).map(([X,K])=>({id:X,name:K.nickname,groupId:K.account_group_id,groupName:K.account_group_id&&s[K.account_group_id]?.name||null,sortOrder:K.sort_order,groupSortOrder:K.account_group_id?s[K.account_group_id]?.sort_order??999:999})),g=e===Ht,_=g?null:r.find(([X])=>X===e)?.[1],y=g?"":_?.nickname||"",[x,w]=R.useState(y),[S,E]=R.useState(!1),[T,A]=R.useState(-1),M=R.useRef(null),L=R.useRef(null);R.useEffect(()=>{if(e===Ht)w("");else if(e){const X=r.find(([K])=>K===e)?.[1];w(X?.nickname||"")}},[e,r]);const H=oA(p,x,X=>[X.name]),O=aA(H);R.useEffect(()=>{function X(K){if(M.current&&!M.current.contains(K.target))if(E(!1),e===Ht)w("");else{const q=r.find(([te])=>te===e)?.[1];w(q?.nickname||"")}}return document.addEventListener("mousedown",X),()=>document.removeEventListener("mousedown",X)},[e,r]);function j(X){if(X.key==="ArrowDown")X.preventDefault(),S?A(K=>Math.min(K+1,H.length-1)):(E(!0),A(0));else if(X.key==="ArrowUp")X.preventDefault(),A(K=>Math.max(K-1,0));else if(X.key==="Enter")X.preventDefault(),S&&T>=0&&H[T]&&B(H[T]);else if(X.key==="Escape")if(E(!1),A(-1),e===Ht)w("");else{const K=r.find(([q])=>q===e)?.[1];w(K?.nickname||"")}else if(X.key==="Tab")if(S&&T>=0&&H[T])B(H[T]);else if(E(!1),A(-1),e===Ht)w("");else{const K=r.find(([q])=>q===e)?.[1];w(K?.nickname||"")}}function B(X){n(X.id),w(X.id===Ht?"":X.name),E(!1),A(-1)}function V(){n(Ht),w(""),E(!1),A(-1)}function $(X){const K=X.target.value;w(K),E(!0),A(K.trim()?0:-1),K!==y&&(l&&K.trim()===""?n(Ht):n(""))}function k(){E(!0),l&&(e===Ht||x.trim()==="")?A(-1):H.length>0&&A(0)}let N=-1;const D=()=>++N;return d.jsxs("div",{ref:M,style:{position:"relative"},children:[d.jsx("input",{ref:L,id:t,type:"text",value:x,onChange:$,onFocus:k,onKeyDown:j,placeholder:o,autoComplete:"off",required:c&&!l,style:{...Ka,borderColor:c&&!e?me.error:void 0}}),S&&d.jsxs("div",{style:{...f0,maxHeight:"250px",overflowY:"auto"},children:[l&&d.jsx("div",{onClick:V,onMouseEnter:()=>A(-1),style:{...sd,opacity:.7,fontStyle:"italic",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",background:T===-1?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent"},children:Ga}),O.map((X,K)=>d.jsxs("div",{children:[X.groupName&&d.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:X.groupName}),X.items.map(q=>{const te=D();return d.jsx("div",{onClick:()=>B(q),style:{...sd,paddingLeft:X.groupName?"1.2rem":"0.8rem",background:te===T?`color-mix(in srgb, ${me.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},onMouseEnter:()=>A(te),children:q.name},q.id)})]},`group-${K}`)),H.length===0&&x.trim()&&!l&&d.jsx("div",{style:{padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching accounts"})]})]})}function Ps({children:t,onSubmit:e,actionName:n}){function r(s){e(s)}return d.jsx("form",{onSubmit:r,style:mP,children:t})}function Pt({label:t,htmlFor:e,children:n,hint:r,style:s}){return d.jsxs("div",{style:{...gP,...s},children:[d.jsx("label",{htmlFor:e,style:pP,children:t}),n,r&&d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:r})]})}function zs(t){return d.jsx("input",{style:Ka,...t})}function MP(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function Zf({value:t,onChange:e,style:n,autoFocus:r,...s}){const o=R.useRef(null),c=R.useRef(null),l=MP(t);R.useEffect(()=>{r&&c.current?.focus()},[r]);function h(){o.current?.showPicker?.()}function f(p){p.key==="Enter"&&(p.preventDefault(),o.current?.showPicker?.())}return d.jsxs("div",{style:{position:"relative"},children:[d.jsx("input",{ref:o,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...s}),d.jsx("div",{ref:c,tabIndex:0,onClick:h,onKeyDown:f,style:{...Ka,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:l||"Select date"})]})}function ad({children:t,...e}){return d.jsx("select",{style:yP,...e,children:t})}function m0({minHeight:t="6rem",style:e,...n}){return d.jsx("textarea",{style:{...Ka,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function Ya({children:t}){return d.jsx("div",{style:wP,children:t})}function oy(t){const n=t.replace(/[^\d.]/g,"").split("."),r=n[0]||"",s=n[1],o=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return s!==void 0?`$${o}.${s.slice(0,2)}`:o?`$${o}`:""}function OP(t){return t.replace(/[$,]/g,"")}function Oo({id:t,value:e,onChange:n,placeholder:r="$0.00",required:s,autoFocus:o,style:c}){const[l,h]=R.useState(()=>oy(e)),f=R.useRef(null);R.useEffect(()=>{const g=oy(e);OP(l)!==e&&h(g)},[e]);function p(g){const _=g.target.value;if(!_||_==="$"){h(""),n("");return}const x=_.replace(/[^\d.]/g,"").split(".");let w=x[0];x.length>1&&(w+="."+x.slice(1).join("").slice(0,2));const S=oy(w);h(S),n(w)}return d.jsx("input",{ref:f,id:t,type:"text",inputMode:"decimal",value:l,onChange:p,placeholder:r,required:s,autoFocus:o,style:{...Ka,...c}})}function Fs(t=lB){const[e,n]=R.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return R.useEffect(()=>{const r=window.matchMedia(`(max-width: ${t-1}px)`);function s(c){n(c.matches)}s(r),r.addEventListener("change",s);function o(){n(window.innerWidth<t)}return window.addEventListener("resize",o),()=>{r.removeEventListener("change",s),window.removeEventListener("resize",o)}},[t]),e}function uA(){const[t,e]=R.useState(()=>typeof window>"u"?1200:window.innerWidth);return R.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=Io.wide,isMedium:t>=Io.tablet&&t<Io.wide,isNarrowMedium:t>=Io.mobile&&t<Io.tablet,isMobile:t<Io.mobile}}function Dn(){const{selectedBudgetId:t,currentUserId:e}=Qe(),n=gB(t),r=n.data,s=r?.budget||null,o=R.useMemo(()=>r?.accounts||{},[r?.accounts]),c=R.useMemo(()=>r?.accountGroups||{},[r?.accountGroups]),l=R.useMemo(()=>r?.categories||{},[r?.categories]),h=R.useMemo(()=>{const M=r?.categoryGroups||[];return M.length>0?[...M]:[]},[r?.categoryGroups]),f=s?.owner_id===e,p=R.useMemo(()=>s?.user_ids||[],[s?.user_ids]),g=R.useMemo(()=>s?.accepted_user_ids||[],[s?.accepted_user_ids]),_=R.useMemo(()=>s?ZT(o,l,c):0,[s,o,c,l]),y=R.useMemo(()=>r?.monthMap||{},[r?.monthMap]),x=R.useCallback(M=>{if(!t)return;const L=Pe.getQueryData(Te.budget(t));L&&Pe.setQueryData(Te.budget(t),{...L,accounts:M})},[t]),w=R.useCallback(M=>{if(!t)return;const L=Pe.getQueryData(Te.budget(t));L&&Pe.setQueryData(Te.budget(t),{...L,accountGroups:M})},[t]),S=R.useCallback(M=>{if(!t)return;const L=Pe.getQueryData(Te.budget(t));L&&Pe.setQueryData(Te.budget(t),{...L,categories:M,budget:{...L.budget,categories:M}})},[t]),E=R.useCallback(M=>{if(!t)return;const L=Pe.getQueryData(Te.budget(t));if(L){const H=[...M];Pe.setQueryData(Te.budget(t),{...L,categoryGroups:H,budget:{...L.budget,category_groups:H}})}},[t]),T=R.useCallback(async()=>{t&&await Pe.invalidateQueries({queryKey:Te.budget(t)})},[t]),A=R.useCallback(()=>Object.entries(o).filter(([,M])=>Bm(M,c)).reduce((M,[,L])=>M+L.balance,0),[o,c]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:s,accounts:o,accountGroups:c,categories:l,categoryGroups:h,isOwner:f,budgetUserIds:p,acceptedUserIds:g,totalAvailable:_,monthMap:y,setAccountsOptimistic:x,setAccountGroupsOptimistic:w,setCategoriesOptimistic:S,setCategoryGroupsOptimistic:E,refreshBudget:T,getOnBudgetTotal:A}}function rs(t,e,n){const{addLoadingHold:r,removeLoadingHold:s}=kn(),o=Rt(),c=GB(t,e,n,{enabled:!!t});R.useEffect(()=>{const T=t?Te.month(t,e,n):null;if(!T){s("month-query");return}const A=!!c.data,M=o.getQueryState(T),L=M?.dataUpdatedAt?Date.now()-M.dataUpdatedAt>gi:!1;return!A||L&&c.isFetching||c.isLoading?r("month-query","Loading month data..."):s("month-query"),()=>s("month-query")},[c.isLoading,c.isFetching,c.data,t,e,n,o,r,s]);const l=c.data?.month||null,h=R.useMemo(()=>l?.income||[],[l?.income]),f=R.useMemo(()=>l?.expenses||[],[l?.expenses]),p=R.useMemo(()=>l?.transfers||[],[l?.transfers]),g=R.useMemo(()=>l?.adjustments||[],[l?.adjustments]),_=R.useMemo(()=>l?.category_balances||[],[l?.category_balances]),y=R.useMemo(()=>l?.account_balances||[],[l?.account_balances]),x=l?.total_income||0,w=l?.total_expenses||0,S=l?.are_allocations_finalized||!1,E=l?.previous_month_income??0;return{isLoading:c.isLoading,isFetching:c.isFetching,error:c.error,month:l,income:h,expenses:f,transfers:p,adjustments:g,categoryBalances:_,accountBalances:y,totalIncome:x,totalExpenses:w,areAllocationsFinalized:S,previousMonthIncome:E}}function Xo(){return{updateBudgetCacheAndTrack:(e,n)=>{Pe.setQueryData(Te.budget(e),n)}}}function NP(){const t=Rt(),{currentViewingDocument:e}=Qe(),{saveCurrentDocument:n}=Pn(),{updateBudgetCacheAndTrack:r}=Xo(),s=Tn({onMutate:async c=>{const{budgetId:l,accounts:h}=c,f=Te.budget(l);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const _={...p,accounts:h};r(l,_)}if(e.type==="budget")try{await n(l,"budget")}catch(_){console.warn("[useUpdateAccounts] Failed to save current document immediately:",_)}return{previousData:p}},mutationFn:async c=>{const{accounts:l}=c;return{accounts:l}},onError:(c,l,h)=>{h?.previousData&&t.setQueryData(Te.budget(l.budgetId),h.previousData)}});return{updateAccounts:{mutate:c=>s.mutate(c),mutateAsync:c=>s.mutateAsync(c),isPending:s.isPending,isError:s.isError,error:s.error,reset:s.reset}}}function BP(){const t=Rt(),{currentViewingDocument:e}=Qe(),{saveCurrentDocument:n}=Pn(),{updateBudgetCacheAndTrack:r}=Xo(),s=Tn({onMutate:async c=>{const{budgetId:l,accountGroups:h}=c,f=Te.budget(l);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const _={...p,accountGroups:h};r(l,_)}if(e.type==="budget")try{await n(l,"budget")}catch(_){console.warn("[useUpdateAccountGroups] Failed to save current document immediately:",_)}return{previousData:p}},mutationFn:async c=>{const{accountGroups:l}=c;return{accountGroups:l}},onError:(c,l,h)=>{h?.previousData&&t.setQueryData(Te.budget(l.budgetId),h.previousData)}});return{updateAccountGroups:{mutate:c=>s.mutate(c),mutateAsync:c=>s.mutateAsync(c),isPending:s.isPending,isError:s.isError,error:s.error,reset:s.reset}}}async function dA(t,e,n){const r={[`categories.${e}`]:ed(),updated_at:new Date().toISOString()};await ts("budgets",t,r);const s=Pe.getQueryData(Te.budget(t));if(s?.categories&&e in s.categories){const{[e]:o,...c}=s.categories;Pe.setQueryData(Te.budget(t),{...s,categories:c,budget:{...s.budget,categories:c}})}}async function hA(t,e,n){const r={[`accounts.${e}`]:ed(),updated_at:new Date().toISOString()};await ts("budgets",t,r);const s=Pe.getQueryData(Te.budget(t));if(s?.accounts&&e in s.accounts){const{[e]:o,...c}=s.accounts;Pe.setQueryData(Te.budget(t),{...s,accounts:c,budget:{...s.budget,accounts:c}})}}async function fA(t,e,n,r){const s={[`account_groups.${e}`]:ed(),updated_at:new Date().toISOString()};for(const c of n)s[`accounts.${c}.account_group_id`]=Vt;await ts("budgets",t,s);const o=Pe.getQueryData(Te.budget(t));if(o?.accounts&&o?.accountGroups&&e in o.accountGroups){const{[e]:c,...l}=o.accountGroups,h={...o.accounts};for(const f of n)h[f]&&(h[f]={...h[f],account_group_id:Vt});Pe.setQueryData(Te.budget(t),{...o,accounts:h,accountGroups:l,budget:{...o.budget,accounts:h,account_groups:l}})}}async function Zo(t){const{budgetId:e,updates:n,description:r}=t,{total_available:s,is_needs_recalculation:o,...c}=n;let l={...c};if(l.accounts&&typeof l.accounts=="object"){const g=l.accounts;l={...l,accounts:Object.fromEntries(Object.entries(g).map(([_,y])=>{if(y&&typeof y=="object"){const{balance:x,...w}=y;return[_,w]}return[_,y]}))}}if(l.categories&&typeof l.categories=="object"){const g=l.categories;l={...l,categories:Object.fromEntries(Object.entries(g).map(([_,y])=>{if(y&&typeof y=="object"){const{balance:x,...w}=y;return[_,w]}return[_,y]}))}}const h={...l,updated_at:new Date().toISOString()},f=Jr(h);await ts("budgets",e,f);const p=Pe.getQueryData(Te.budget(e));p&&Pe.setQueryData(Te.budget(e),{...p,budget:{...p.budget,...n}})}const mA=Object.freeze(Object.defineProperty({__proto__:null,deleteBudgetAccountGroupKey:fA,deleteBudgetAccountKey:hA,deleteBudgetCategoryKey:dA,writeBudgetData:Zo},Symbol.toStringTag,{value:"Module"}));function PP(){const t=Rt(),{currentViewingDocument:e}=Qe(),{updateBudgetCacheAndTrack:n}=Xo(),r=Tn({onMutate:async o=>{const{budgetId:c,accountId:l}=o,h=Te.budget(c);await t.cancelQueries({queryKey:h});const f=t.getQueryData(h),p=e.type==="budget";if(f?.accounts&&l in f.accounts){const{[l]:g,..._}=f.accounts,y={...f,accounts:_,budget:{...f.budget,accounts:_}};t.setQueryData(h,y),p||n(c,y)}if(p)try{await hA(c,l,"accounts: delete (targeted key)")}catch(g){console.warn("[useDeleteAccount] Failed to delete account key:",g)}return{previousData:f}},mutationFn:async()=>{},onError:(o,c,l)=>{l?.previousData&&t.setQueryData(Te.budget(c.budgetId),l.previousData)}});return{deleteAccount:{mutate:o=>r.mutate(o),mutateAsync:o=>r.mutateAsync(o),isPending:r.isPending,isError:r.isError,error:r.error,reset:r.reset}}}function zP(){const t=Rt(),{currentViewingDocument:e}=Qe(),{updateBudgetCacheAndTrack:n}=Xo(),r=Tn({onMutate:async o=>{const{budgetId:c,groupId:l,accountIdsToUngroup:h}=o,f=Te.budget(c);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f),g=e.type==="budget";if(p?.accounts&&p?.accountGroups&&l in p.accountGroups){const{[l]:_,...y}=p.accountGroups,x={...p.accounts};for(const S of h)x[S]&&(x[S]={...x[S],account_group_id:Vt});const w={...p,accounts:x,accountGroups:y,budget:{...p.budget,accounts:x,account_groups:y}};t.setQueryData(f,w),g||n(c,w)}if(g)try{await fA(c,l,h,"account_groups: delete (targeted key)")}catch(_){console.warn("[useDeleteAccountGroup] Failed to delete account group key:",_)}return{previousData:p}},mutationFn:async()=>{},onError:(o,c,l)=>{l?.previousData&&t.setQueryData(Te.budget(c.budgetId),l.previousData)}});return{deleteAccountGroup:{mutate:o=>r.mutate(o),mutateAsync:o=>r.mutateAsync(o),isPending:r.isPending,isError:r.isError,error:r.error,reset:r.reset}}}function LP(){const t=Rt(),{currentViewingDocument:e}=Qe(),{updateBudgetCacheAndTrack:n}=Xo(),r=Tn({onMutate:async o=>{const{budgetId:c,categories:l}=o,h=Te.budget(c);await t.cancelQueries({queryKey:h});const f=t.getQueryData(h),p=e.type==="budget";if(f){const g={...f,categories:l,budget:{...f.budget,categories:l}};t.setQueryData(h,g),p||n(c,g)}if(p)try{await Zo({budgetId:c,updates:{categories:l},description:"categories: update (settings)"})}catch(g){console.warn("[useUpdateCategories] Failed to save categories immediately:",g)}return{previousData:f}},mutationFn:async o=>{const{categories:c}=o;return{categories:c}},onError:(o,c,l)=>{l?.previousData&&t.setQueryData(Te.budget(c.budgetId),l.previousData)}});return{updateCategories:{mutate:o=>r.mutate(o),mutateAsync:o=>r.mutateAsync(o),isPending:r.isPending,isError:r.isError,error:r.error,reset:r.reset}}}function UP(){const t=Rt(),{currentViewingDocument:e}=Qe(),{saveCurrentDocument:n}=Pn(),{updateBudgetCacheAndTrack:r}=Xo(),s=Tn({onMutate:async c=>{const{budgetId:l,categoryGroups:h}=c,f=Te.budget(l);await t.cancelQueries({queryKey:f});const p=t.getQueryData(f);if(p){const _={...p,categoryGroups:h,budget:{...p.budget,category_groups:h}};r(l,_)}if(e.type==="budget")try{await n(l,"budget")}catch(_){console.warn("[useUpdateCategoryGroups] Failed to save current document immediately:",_)}return{previousData:p}},mutationFn:async c=>{const{categoryGroups:l}=c;return{categoryGroups:l}},onError:(c,l,h)=>{h?.previousData&&t.setQueryData(Te.budget(l.budgetId),h.previousData)}});return{updateCategoryGroups:{mutate:c=>s.mutate(c),mutateAsync:c=>s.mutateAsync(c),isPending:s.isPending,isError:s.isError,error:s.error,reset:s.reset}}}function FP(){const t=Rt(),{currentViewingDocument:e}=Qe(),{updateBudgetCacheAndTrack:n}=Xo(),r=Tn({onMutate:async o=>{const{budgetId:c,categoryId:l}=o,h=Te.budget(c);await t.cancelQueries({queryKey:h});const f=t.getQueryData(h),p=e.type==="budget";if(f?.categories&&l in f.categories){const{[l]:g,..._}=f.categories,y={...f,categories:_,budget:{...f.budget,categories:_}};t.setQueryData(h,y),p||n(c,y)}if(p)try{await dA(c,l,"categories: delete (targeted key)")}catch(g){console.warn("[useDeleteCategory] Failed to delete category key:",g)}return{previousData:f}},mutationFn:async()=>{},onError:(o,c,l)=>{l?.previousData&&t.setQueryData(Te.budget(c.budgetId),l.previousData)}});return{deleteCategory:{mutate:o=>r.mutate(o),mutateAsync:o=>r.mutateAsync(o),isPending:r.isPending,isError:r.isError,error:r.error,reset:r.reset}}}function VP(){const t=Rt(),e=Tn({onMutate:async r=>{const{budgetId:s,newName:o}=r,c=Te.budget(s);await t.cancelQueries({queryKey:c});const l=t.getQueryData(c);return l&&t.setQueryData(c,{...l,budget:{...l.budget,name:o.trim()}}),{previousData:l}},mutationFn:async r=>{const{budgetId:s,newName:o}=r,c=o.trim();return await Zo({budgetId:s,updates:{name:c},description:`renaming budget to "${c}"`}),{newName:c}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Te.budget(s.budgetId),o.previousData)}});return{renameBudget:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function $P({currentBudget:t,accounts:e,accountGroups:n,setAccountsOptimistic:r,setAccountGroupsOptimistic:s,saveAccounts:o,saveAccountGroups:c,setError:l}){const h=R.useCallback(async(p,g,_)=>{const y=e[p];if(!y)return;const x=_==="ungrouped"?Vt:_,w=Object.entries(e).filter(([,T])=>(T.account_group_id||"ungrouped")===_),S={};Object.entries(e).forEach(([T,A])=>{T!==p&&(S[T]={...A})});let E;if(g==="__group_end__"||w.length===0||!w.find(([T])=>T===g))E=(w.length>0?Math.max(...w.filter(([A])=>A!==p).map(([,A])=>A.sort_order)):-1)+1;else{const T=w.find(([A])=>A===g);if(T){const[,A]=T;E=A.sort_order,Object.entries(S).forEach(([M,L])=>{(L.account_group_id||"ungrouped")===_&&L.sort_order>=E&&(S[M]={...L,sort_order:L.sort_order+1})})}else E=0}if(S[p]={...y,account_group_id:x,sort_order:E},r(S),!!t)try{await o(S)}catch(T){l(T instanceof Error?T.message:"Failed to save changes")}},[t,e,r,o,l]),f=R.useCallback(async(p,g)=>{if(p===g)return;const _=Object.entries(n).sort(([,E],[,T])=>E.sort_order-T.sort_order),y=_.findIndex(([E])=>E===p),x=[..._],[w]=x.splice(y,1);if(g==="__end__")x.push(w);else{const E=x.findIndex(([T])=>T===g);x.splice(E,0,w)}const S={};if(x.forEach(([E,T],A)=>{S[E]={...T,sort_order:A}}),s(S),!!t)try{await c(S)}catch(E){l(E instanceof Error?E.message:"Failed to save new order")}},[t,n,s,c,l]);return{reorderAccountsInGroup:h,reorderGroups:f}}function GP(){const{selectedBudgetId:t}=Qe(),{budget:e,accounts:n,accountGroups:r,setAccountsOptimistic:s,setAccountGroupsOptimistic:o}=Dn(),{updateAccounts:c}=NP(),{updateAccountGroups:l}=BP(),{deleteAccount:h}=PP(),{deleteAccountGroup:f}=zP(),[p,g]=R.useState(null),_=R.useCallback(async $=>{if(!t)throw new Error("No budget selected");await c.mutateAsync({budgetId:t,accounts:$})},[t,c]),y=R.useCallback(async $=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,accountGroups:$})},[t,l]),x=R.useMemo(()=>Object.entries(n).filter(([,$])=>!$.is_hidden).reduce(($,[k,N])=>{const D=N.account_group_id||Vt;return $[D]||($[D]=[]),$[D].push({...N,id:k}),$},{}),[n]),w=R.useMemo(()=>Object.entries(n).filter(([,$])=>$.is_hidden).map(([$,k])=>({...k,id:$})).sort(($,k)=>$.sort_order-k.sort_order),[n]),S=R.useMemo(()=>Object.entries(r).sort(([,$],[,k])=>$.sort_order-k.sort_order).map(([$,k])=>({...k,id:$})),[r]),E=R.useCallback(($,k)=>{if(!e)return;const N=k||Vt,D=Object.values(n).filter(Q=>Q.account_group_id===N),X=D.length>0?Math.max(...D.map(Q=>Q.sort_order)):-1,K=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,q={nickname:$.nickname,description:"",balance:0,account_group_id:N,sort_order:X+1,is_income_account:$.is_income_account??!1,is_income_default:$.is_income_default??!1,is_outgo_account:$.is_outgo_account??!1,is_outgo_default:$.is_outgo_default??!1,on_budget:$.on_budget!==!1,is_active:$.is_active!==!1,is_hidden:$.is_hidden??!1},te={...n};$.is_income_default&&Object.keys(te).forEach(Q=>{te[Q]={...te[Q],is_income_default:!1}}),$.is_outgo_default&&Object.keys(te).forEach(Q=>{te[Q]={...te[Q],is_outgo_default:!1}}),te[K]=q,s(te),_(te).catch(Q=>g(Q instanceof Error?Q.message:"Failed to create account."))},[e,n,s,_]),T=R.useCallback(($,k)=>{if(!e)return;const N=n[$];if(!N)return;const D=N.account_group_id||Vt,X=k.account_group_id||Vt;let K=N.sort_order;if(D!==X){const te=Object.values(n).filter(Q=>Q.account_group_id===X);K=te.length>0?Math.max(...te.map(Q=>Q.sort_order))+1:0}const q={};Object.entries(n).forEach(([te,Q])=>{te===$?q[te]={...Q,nickname:k.nickname,account_group_id:X,sort_order:K,is_income_account:k.is_income_account??!1,is_income_default:k.is_income_default??!1,is_outgo_account:k.is_outgo_account??!1,is_outgo_default:k.is_outgo_default??!1,on_budget:k.on_budget!==!1,is_active:k.is_active!==!1,is_hidden:k.is_hidden??!1}:(q[te]={...Q},k.is_income_default&&!N.is_income_default&&(q[te].is_income_default=!1),k.is_outgo_default&&!N.is_outgo_default&&(q[te].is_outgo_default=!1))}),s(q),_(q).catch(te=>g(te instanceof Error?te.message:"Failed to save account."))},[e,n,s,_]),A=R.useCallback($=>{confirm("Are you sure you want to delete this account?")&&(!e||!t||h.mutateAsync({budgetId:t,accountId:$}).catch(k=>g(k instanceof Error?k.message:"Failed to delete account.")))},[e,t,h]),M=R.useCallback(async($,k)=>{const N=n[$];if(!N)return;const D=N.account_group_id||Vt,X=Object.entries(n).filter(([,P])=>P.account_group_id===D).sort(([,P],[,G])=>P.sort_order-G.sort_order),K=X.findIndex(([P])=>P===$),q=k==="up"?K-1:K+1;if(q<0||q>=X.length)return;const[te,Q]=X[q],ae={};if(Object.entries(n).forEach(([P,G])=>{P===$?ae[P]={...G,sort_order:Q.sort_order}:P===te?ae[P]={...G,sort_order:N.sort_order}:ae[P]={...G}}),s(ae),!!e)try{await _(ae)}catch(P){s(n),g(P instanceof Error?P.message:"Failed to move account")}},[e,n,s,_]),L=R.useCallback($=>{if(!e)return;const k=Object.values(r).map(q=>q.sort_order),N=k.length>0?Math.max(...k):-1,D=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,X={name:$.name,sort_order:N+1,expected_balance:$.expected_balance,on_budget:$.on_budget??null,is_active:$.is_active??null},K={...r,[D]:X};o(K),y(K).catch(q=>g(q instanceof Error?q.message:"Failed to create account type."))},[e,r,o,y]),H=R.useCallback(($,k)=>{if(!e)return;const N={...r,[$]:{...r[$],name:k.name,expected_balance:k.expected_balance,on_budget:k.on_budget??null,is_active:k.is_active??null}};o(N),y(N).catch(D=>g(D instanceof Error?D.message:"Failed to update account type."))},[e,r,o,y]),O=R.useCallback($=>{if($===Vt){alert("Cannot delete the default Ungrouped account type.");return}if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!e||!t)return;const k=Object.entries(n).filter(([,N])=>(N.account_group_id||Vt)===$).map(([N])=>N);f.mutateAsync({budgetId:t,groupId:$,accountIdsToUngroup:k}).catch(N=>g(N instanceof Error?N.message:"Failed to delete account type."))},[e,t,n,f]),j=R.useCallback(async($,k)=>{const N=Object.entries(r).sort(([,te],[,Q])=>te.sort_order-Q.sort_order),D=N.findIndex(([te])=>te===$),X=k==="up"?D-1:D+1;if(X<0||X>=N.length)return;const[K]=N.splice(D,1);N.splice(X,0,K);const q={};if(N.forEach(([te,Q],ae)=>{q[te]={...Q,sort_order:ae}}),o(q),!!e)try{await y(q)}catch(te){o(r),g(te instanceof Error?te.message:"Failed to move account type")}},[e,r,o,y]),{reorderAccountsInGroup:B,reorderGroups:V}=$P({currentBudget:e,accounts:n,accountGroups:r,setAccountsOptimistic:s,setAccountGroupsOptimistic:o,saveAccounts:_,saveAccountGroups:y,setError:g});return{accounts:n,accountGroups:r,accountsByGroup:x,hiddenAccounts:w,sortedGroups:S,currentBudget:e,error:p,setError:g,handleCreateAccount:E,handleUpdateAccount:T,handleDeleteAccount:A,handleMoveAccount:M,handleCreateGroup:L,handleUpdateGroup:H,handleDeleteGroup:O,handleMoveGroup:j,reorderAccountsInGroup:B,reorderGroups:V}}function t1(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([r,s])=>{if(s.is_hidden){n[r]="";return}if(s.default_monthly_type==="percentage")return;const o=t.category_balances?.find(c=>c.category_id===r);o&&o.allocated>0?n[r]=o.allocated.toString():s.default_monthly_amount!==void 0&&s.default_monthly_amount>0?n[r]=s.default_monthly_amount.toString():n[r]=""}),n}function qP(){const t=Rt(),{addLoadingHold:e,removeLoadingHold:n}=kn(),{selectedBudgetId:r,currentYear:s,currentMonthNumber:o}=Qe(),{categories:c,getOnBudgetTotal:l,totalAvailable:h}=Dn(),{month:f,isLoading:p,previousMonthIncome:g,areAllocationsFinalized:_}=rs(r,s,o),y=R.useMemo(()=>f?.income?f.income.reduce((P,G)=>P+G.amount,0):0,[f]),{saveDraftAllocations:x}=fP(),{finalizeAllocations:w}=H4(),{deleteAllocations:S}=DA(),E=R.useMemo(()=>t1(f,c),[f,c]),[T,A]=R.useState(E),[M,L]=R.useState(!1),H=R.useRef(null);R.useMemo(()=>Object.values(c).reduce((P,G)=>P+(G.balance??0),0),[c]),R.useEffect(()=>{if(!f)return;const P=`${f.year}-${f.month}`;H.current!==P&&(L(!1),A(t1(f,c)),H.current=P)},[f,c]);const O=R.useCallback((P,G)=>{if(G.is_hidden)return 0;if(G.default_monthly_type==="percentage"&&G.default_monthly_amount!==void 0)return Ee(G.default_monthly_amount/100*g);const ee=T[P],re=parseFloat(ee||"0");return isNaN(re)?0:Ee(re)},[T,g]),j=R.useMemo(()=>Object.entries(c).reduce((P,[G,ee])=>{const re=O(G,ee),se=ee.balance??0;if(se<0){const ge=Math.abs(se),Ce=Math.max(0,re-ge);return P+Ce}return P+re},0),[c,O]),B=l(),V=_?(f?.category_balances||[]).reduce((P,G)=>{const ee=c[G.category_id]?.balance??0,re=G.allocated,se=ee-re;if(se<0){const ge=Math.abs(se);return P+Math.max(0,re-ge)}return P+re},0):0,$=M?h+V:h,k=R.useMemo(()=>M?$-j:$-j+V,[$,j,V,M]),N=R.useCallback((P,G)=>{A(ee=>({...ee,[P]:G}))},[]),D=R.useCallback(()=>{if(!f)return;const P={};Object.entries(c).forEach(([G,ee])=>{if(ee.is_hidden){P[G]="";return}if(ee.default_monthly_type==="percentage")return;const re=f.category_balances?.find(se=>se.category_id===G);re&&re.allocated>0?P[G]=re.allocated.toString():ee.default_monthly_amount!==void 0&&ee.default_monthly_amount>0?P[G]=ee.default_monthly_amount.toString():P[G]=""}),A(P),L(!1)},[f,c]),X=R.useCallback(async()=>{if(r){e("allocations-edit","Loading allocations...");try{const P=await OB(r,s,o,"Edit Allocations"),G=Te.month(r,s,o);t.setQueryData(G,{month:P}),L(!0)}catch(P){console.error("[useAllocationsPage] Edit Allocations failed:",P),Hn.add({type:"error",message:"Failed to load allocations. See console for details.",autoDismissMs:0})}finally{n("allocations-edit")}}},[r,s,o,t,e,n]),K=R.useCallback(()=>{const P={};return Object.entries(c).forEach(([G,ee])=>{const re=ee.is_hidden?0:O(G,ee);(re>0||ee.is_hidden)&&(P[G]=re)}),P},[c,O]),q=R.useCallback(async()=>{if(r){e("allocations-save","Saving allocations...");try{await x(r,s,o,K()),L(!1)}catch(P){console.error("[useAllocationsPage] Save allocations failed:",P),Hn.add({type:"error",message:"Failed to save allocations. See console for details.",autoDismissMs:0})}finally{n("allocations-save")}}},[r,s,o,x,K,e,n]),te=R.useCallback(async()=>{if(r){e("allocations-finalize","Applying allocations...");try{await w({budgetId:r,year:s,month:o,allocations:K(),onProgress:P=>{e("allocations-finalize",P.message)}}),L(!1)}catch(P){console.error("[useAllocationsPage] Finalize allocations failed:",P),Hn.add({type:"error",message:"Failed to apply allocations. See console for details.",autoDismissMs:0})}finally{n("allocations-finalize")}}},[r,s,o,w,K,e,n]),Q=R.useCallback(async()=>{if(r){e("allocations-delete","Deleting allocations...");try{await S({budgetId:r,year:s,month:o,onProgress:G=>{e("allocations-delete",G.message)}});const P={};Object.entries(c).forEach(([G,ee])=>{if(ee.is_hidden){P[G]="";return}ee.default_monthly_type!=="percentage"&&(ee.default_monthly_amount!==void 0&&ee.default_monthly_amount>0?P[G]=ee.default_monthly_amount.toString():P[G]="")}),A(P),L(!1)}catch(P){console.error("[useAllocationsPage] Delete allocations failed:",P),Hn.add({type:"error",message:"Failed to delete allocations. See console for details.",autoDismissMs:0})}finally{n("allocations-delete")}}},[r,s,o,S,c,e,n]),ae=j-V;return{localAllocations:T,isEditingAppliedAllocations:M,monthLoading:p,onBudgetTotal:B,totalAvailable:h,availableNow:$,currentDraftTotal:j,draftChangeAmount:ae,availableAfterApply:k,previousMonthIncome:g,currentMonthIncome:y,allocationsFinalized:_,getAllocationAmount:O,handleAllocationChange:N,resetAllocationsToSaved:D,handleSaveAllocations:q,handleFinalizeAllocations:te,handleDeleteAllocations:Q,handleEditAllocations:X,setIsEditingAppliedAllocations:L}}function HP({budgetId:t,categories:e,currentYear:n,currentMonth:r,updateCategoriesWithBalances:s}){const o=Object.keys(e),c=o.length>0,l=R.useMemo(()=>{const x={};return Object.entries(e).forEach(([w,S])=>{x[w]={current:S.balance??0,total:S.balance??0}}),x},[e]),[h,f]=R.useState(!1),[p,g]=R.useState(null),_=R.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const x=Object.keys(e),{total:w}=await XS(t,x,n,r),S={};Object.entries(e).forEach(([T,A])=>{const M=A.balance,L=w[T]??0;Math.abs(M-L)>.01&&(S[T]={stored:M,calculated:L})});const E=Object.keys(S).length>0?S:null;return g(E),E},[t,e,n,r]),y=R.useCallback(async()=>{if(!(!t||!c)){f(!0);try{const{total:x}=await XS(t,o,n,r),w={};Object.entries(e).forEach(([S,E])=>{w[S]={...E,balance:x[S]??0}}),await s(w),g(null)}finally{f(!1)}}},[t,e,s,n,r,o,c]);return{categoryBalances:l,loadingBalances:h,categoryBalanceMismatch:p,checkCategoryBalanceMismatch:_,recalculateAndSaveCategoryBalances:y}}function WP({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:r,setCategoryGroupsOptimistic:s,saveCategories:o,saveCategoryGroups:c,setError:l}){const[h,f]=R.useState(null),[p,g]=R.useState(null),[_,y]=R.useState(null),[x,w]=R.useState(null);function S(j,B){f("category"),g(B),j.dataTransfer.effectAllowed="move"}function E(j,B,V){j.preventDefault(),h==="category"&&(B!==p&&y(B),w(V))}function T(j,B){j.preventDefault(),h==="category"&&(w(B),y(null))}function A(){y(null)}function M(){w(null)}function L(){f(null),g(null),y(null),w(null)}async function H(j,B,V){if(j.preventDefault(),j.stopPropagation(),!p||h!=="category"){L();return}const $=t[p];if(!$)return;const k=V==="ungrouped"?Xt:V,N=Object.entries(t).filter(([,K])=>(K.category_group_id||"ungrouped")===V),D={};Object.entries(t).forEach(([K,q])=>{K!==p&&(D[K]=q)});let X;if(B==="__group_end__"||N.length===0||!N.find(([K])=>K===B))X=(N.length>0?Math.max(...N.filter(([q])=>q!==p).map(([,q])=>q.sort_order)):-1)+1;else{const K=N.find(([q])=>q===B);K?(X=K[1].sort_order,Object.entries(D).forEach(([q,te])=>{(te.category_group_id||"ungrouped")===V&&te.sort_order>=X&&(D[q]={...te,sort_order:te.sort_order+1})})):X=0}if(D[p]={...$,category_group_id:k,sort_order:X},r(D),L(),!!n)try{await o(D)}catch(K){l(K instanceof Error?K.message:"Failed to save changes")}}async function O(j,B){j.preventDefault(),h==="category"&&await H(j,"__group_end__",B)}return{dragType:h,draggedId:p,dragOverId:_,dragOverGroupId:x,setDragOverId:y,setDragOverGroupId:w,handleCategoryDragStart:S,handleCategoryDragOver:E,handleDragOverGroup:T,handleDragLeave:A,handleDragLeaveGroup:M,handleDragEnd:L,handleCategoryDrop:H,handleDropOnGroup:O}}function QP(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Qe(),{budget:r,categories:s,categoryGroups:o,isLoading:c,setCategoriesOptimistic:l,setCategoryGroupsOptimistic:h,getOnBudgetTotal:f}=Dn(),{updateCategories:p}=LP(),{updateCategoryGroups:g}=UP(),{deleteCategory:_}=FP(),[y,x]=R.useState(null),w=R.useCallback(async Q=>{if(!t)throw new Error("No budget selected");await p.mutateAsync({budgetId:t,categories:Q})},[t,p]),S=R.useCallback(async Q=>{if(!t)throw new Error("No budget selected");await g.mutateAsync({budgetId:t,categoryGroups:Q})},[t,g]),E=R.useCallback(async(Q,ae)=>{if(!t)throw new Error("No budget selected");await Promise.all([p.mutateAsync({budgetId:t,categories:Q}),g.mutateAsync({budgetId:t,categoryGroups:ae})])},[t,p,g]),{categoryBalances:T,loadingBalances:A,categoryBalanceMismatch:M,checkCategoryBalanceMismatch:L,recalculateAndSaveCategoryBalances:H}=HP({budgetId:t,categories:s,currentYear:e,currentMonth:n,updateCategoriesWithBalances:w}),O=WP({categories:s,categoryGroups:o,currentBudget:r,setCategoriesOptimistic:l,setCategoryGroupsOptimistic:h,saveCategories:w,saveCategoryGroups:S,setError:x});async function j(Q,ae){if(!r)return;const P=ae||Xt,G=Object.values(s).filter(Ce=>Ce.category_group_id===P),ee=G.length>0?Math.max(...G.map(Ce=>Ce.sort_order)):-1,re=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,se={name:Q.name,description:Q.description??"",category_group_id:P,sort_order:ee+1,default_monthly_amount:Q.default_monthly_amount??0,default_monthly_type:Q.default_monthly_type??"fixed",balance:0,is_hidden:Q.is_hidden??!1},ge={...s,[re]:se};l(ge);try{await w(ge)}catch(Ce){l(s);const ie=Ce instanceof Error?Ce.message:"Failed to create category";throw x(ie),Ce}}async function B(Q,ae){if(r)try{const P=s[Q];if(!P)return;const G=P.category_group_id||Xt,ee=ae.category_group_id||Xt;let re=P.sort_order;if(G!==ee){const ge=Object.values(s).filter(Ce=>Ce.category_group_id===ee&&Ce!==P);re=ge.length>0?Math.max(...ge.map(Ce=>Ce.sort_order))+1:0}const se={...s,[Q]:{...P,name:ae.name,description:ae.description??"",category_group_id:ee,sort_order:re,default_monthly_amount:ae.default_monthly_amount??0,default_monthly_type:ae.default_monthly_type??"fixed",is_hidden:ae.is_hidden??!1}};l(se),await w(se)}catch(P){x(P instanceof Error?P.message:"Failed to update category")}}async function V(Q){if(confirm("Are you sure you want to delete this category?")&&!(!r||!t))try{await _.mutateAsync({budgetId:t,categoryId:Q})}catch(ae){x(ae instanceof Error?ae.message:"Failed to delete category")}}async function $(Q,ae){const P=s[Q];if(!P)return;const G=P.category_group_id||Xt,ee=Object.entries(s).filter(([,le])=>le.category_group_id===G).sort((le,Me)=>le[1].sort_order-Me[1].sort_order),re=ee.findIndex(([le])=>le===Q),se=ae==="up"?re-1:re+1;if(se<0||se>=ee.length)return;const[ge,Ce]=ee[se],ie={};if(Object.entries(s).forEach(([le,Me])=>{le===Q?ie[le]={...Me,sort_order:Ce.sort_order}:le===ge?ie[le]={...Me,sort_order:P.sort_order}:ie[le]=Me}),l(ie),!!r)try{await w(ie)}catch(le){l(s),x(le instanceof Error?le.message:"Failed to move category")}}async function k(Q){if(r)try{const ae=o.length>0?Math.max(...o.map(ee=>ee.sort_order)):-1,P={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:Q.name,sort_order:ae+1},G=[...o,P];h(G),await S(G)}catch(ae){x(ae instanceof Error?ae.message:"Failed to create group")}}async function N(Q,ae){if(r)try{const P=o.map(G=>G.id===Q?{...G,name:ae.name}:G);h(P),await S(P)}catch(P){x(P instanceof Error?P.message:"Failed to update group")}}async function D(Q){if(Q===Xt){alert("Cannot delete the default Uncategorized category group.");return}if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&r)try{const ae={};Object.entries(s).forEach(([G,ee])=>{ae[G]=ee.category_group_id===Q?{...ee,category_group_id:Xt}:ee});const P=o.filter(G=>G.id!==Q);l(ae),h(P),await E(ae,P)}catch(ae){x(ae instanceof Error?ae.message:"Failed to delete group")}}async function X(Q,ae){const P=o.filter(ie=>ie.id!==Xt).sort((ie,le)=>ie.sort_order-le.sort_order),G=o.find(ie=>ie.id===Xt),ee=P.findIndex(ie=>ie.id===Q),re=ae==="up"?ee-1:ee+1;if(re<0||re>=P.length)return;const[se]=P.splice(ee,1);P.splice(re,0,se);const ge=P.map((ie,le)=>({...ie,sort_order:le})),Ce=[...ge,...G?[{...G,sort_order:ge.length}]:[]];if(h(Ce),!!r)try{await S(Ce)}catch(ie){h(o),x(ie instanceof Error?ie.message:"Failed to move group")}}const K=R.useMemo(()=>Object.entries(s).filter(([,Q])=>!Q.is_hidden).reduce((Q,[ae,P])=>{const G=P.category_group_id||Xt;return Q[G]||(Q[G]=[]),Q[G].push([ae,P]),Q},{}),[s]),q=R.useMemo(()=>Object.entries(s).filter(([,Q])=>Q.is_hidden).map(([Q,ae])=>[Q,ae]).sort((Q,ae)=>Q[1].sort_order-ae[1].sort_order),[s]),te=R.useMemo(()=>[...o].sort((Q,ae)=>Q.sort_order-ae.sort_order),[o]);return{currentBudget:r,categories:s,categoryGroups:o,categoriesByGroup:K,hiddenCategories:q,sortedGroups:te,categoryBalances:T,isLoading:c,loadingBalances:A,error:y,setError:x,getOnBudgetTotal:f,categoryBalanceMismatch:M,checkCategoryBalanceMismatch:L,recalculateAndSaveCategoryBalances:H,handleCreateCategory:j,handleUpdateCategory:B,handleDeleteCategory:V,handleMoveCategory:$,handleCreateGroup:k,handleUpdateGroup:N,handleDeleteGroup:D,handleMoveGroup:X,dragType:O.dragType,draggedId:O.draggedId,dragOverId:O.dragOverId,dragOverGroupId:O.dragOverGroupId,setDragOverId:O.setDragOverId,setDragOverGroupId:O.setDragOverGroupId,handleCategoryDragStart:O.handleCategoryDragStart,handleCategoryDragOver:O.handleCategoryDragOver,handleDragOverGroup:O.handleDragOverGroup,handleDragLeave:O.handleDragLeave,handleDragLeaveGroup:O.handleDragLeaveGroup,handleDragEnd:O.handleDragEnd,handleCategoryDrop:O.handleCategoryDrop,handleDropOnGroup:O.handleDropOnGroup}}function KP({categories:t,categoryBalances:e,totalAvailable:n,onBudgetTotal:r,isDataLoading:s,loadingBalances:o,currentBudget:c}){const l=R.useMemo(()=>Object.values(t).reduce((w,S)=>w+Math.max(0,S.balance??0),0),[t]),h=R.useMemo(()=>Object.values(e).reduce((w,S)=>w+Math.max(0,S.total),0),[e]),f=l,p=R.useMemo(()=>Object.values(t).reduce((w,S)=>w+Math.max(0,S.balance??0),0),[t]),g=n,_=R.useMemo(()=>Math.abs(l-h)>.01,[l,h]),y=R.useMemo(()=>Math.abs(r-(f+g))>.01,[r,f,g]),x=R.useMemo(()=>Math.abs(l-p)>.01,[l,p]);return R.useEffect(()=>{},[_,y,x,l,h,f,g,r,p,s,o,c]),{allocatedFromStored:l,allocatedFromCalculated:h,allocated:f,unallocated:g,monthViewAllTime:p,calculationMismatch:_,relationshipMismatch:y,monthViewMismatch:x}}function YP(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1;let r=e,s=n-3;for(;s<=0;)s+=12,r-=1;let o=e,c=n+3;for(;c>12;)c-=12,o+=1;return{minOrdinal:Fe(r,s),maxOrdinal:Fe(o,c)}}function n1(t,e){let n=t,r=e-1;r<=0&&(r+=12,n-=1);let s=t,o=e+1;return o>12&&(o-=12,s+=1),{minOrdinal:Fe(n,r),maxOrdinal:Fe(s,o)}}function XP(t,e){const n=Object.keys(t).sort();if(n.length===0)return null;if(e){const f=n1(e.year,e.month);if(n.filter(g=>g>=f.minOrdinal&&g<=f.maxOrdinal).length>0)return f}const{minOrdinal:r,maxOrdinal:s}=YP();if(n.filter(f=>f>=r&&f<=s).length>0)return{minOrdinal:r,maxOrdinal:s};const c=n[n.length-1],l=parseInt(c.substring(0,4),10),h=parseInt(c.substring(4,6),10);return n1(l,h)}function gA(t,e,n,r){const s={budget_id:e,year_month_ordinal:t.year_month_ordinal??Fe(n,r),year:t.year??n,month:t.month??r,income:t.income||[],total_income:t.total_income??0,previous_month_income:0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,transfers:t.transfers||[],adjustments:t.adjustments||[],account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at};return Tl(s)}async function ZP(t,e,n){if(e.length===0)return e;const r=Object.keys(n).sort();if(r.length===0)return e;const s=e.reduce((E,T)=>{const A=Fe(T.year,T.month),M=Fe(E.year,E.month);return A>M?T:E}),o=Fe(s.year,s.month),c=e.reduce((E,T)=>{const A=Fe(T.year,T.month),M=Fe(E.year,E.month);return A<M?T:E}),l=Fe(c.year,c.month);let h,f;if(s.are_allocations_finalized?(f="forward",h=r.filter(E=>E>o)):(f="backward",h=r.filter(E=>E<l).reverse()),h.length===0)return e;const p=h[0]<h[h.length-1]?h[0]:h[h.length-1],g=h[0]>h[h.length-1]?h[0]:h[h.length-1],y=(await Gn("months",`useInitialDataLoad: searching ${f} for finalized month`,[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:p},{field:"year_month_ordinal",op:"<=",value:g}])).docs.map(E=>{const T=E.data,A=T.year,M=T.month;return gA(T,t,A,M)});let x=null,w=[];if(f==="backward"){if(x=[...y].sort((T,A)=>T.year!==A.year?A.year-T.year:A.month-T.month).find(T=>T.are_allocations_finalized)||null,x){const T=Fe(x.year,x.month);w=y.filter(A=>{const M=Fe(A.year,A.month);return M>=T&&M<l})}}else{const E=[...y].sort((T,A)=>T.year!==A.year?T.year-A.year:T.month-A.month);for(const T of E)if(T.are_allocations_finalized)x=T;else break;if(x){const T=Fe(x.year,x.month);w=y.filter(A=>{const M=Fe(A.year,A.month);return M>o&&M<=T})}}return w.length===0?e:[...e,...w].sort((E,T)=>E.year!==T.year?E.year-T.year:E.month-T.month)}async function r1(t,e,n){const r=XP(e,n);return r?(await Gn("months","useInitialDataLoad: loading initial months",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">=",value:r.minOrdinal},{field:"year_month_ordinal",op:"<=",value:r.maxOrdinal}])).docs.map(c=>{const l=c.data,h=l.year,f=l.month;return gA(l,t,h,f)}).sort((c,l)=>c.year!==l.year?c.year-l.year:c.month-l.month):[]}function JP(t,e){if(e<1)return t;const n=new Map;for(const r of t)n.set(`${r.year}/${r.month}`,r);return t.map(r=>{const s=Td(r.year,r.month,e);if(!s)return r;const o=n.get(`${s.year}/${s.month}`);if(!o)return r;const c=o.income||[],l=Ee(c.reduce((h,f)=>h+(f.amount||0),0));return{...r,previous_month_income:l}})}async function e3(t,e){const[n,r]=await Promise.all([n0(t),YT(t)]);let s=await r1(t,n.monthMap||{},e);s=await ZP(t,s,n.monthMap||{});const o=n.budget.percentage_income_months_back??1;if(s.length>0&&o>0){const l=s.reduce((f,p)=>{const g=p.year*100+p.month,_=f.year*100+f.month;return g<_?p:f}),h=Td(l.year,l.month,o);if(h&&!s.some(p=>p.year===h.year&&p.month===h.month)){const p=Fe(h.year,h.month);if(n.monthMap&&p in n.monthMap){const g=await r1(t,{[p]:{}},{year:h.year,month:h.month});g.length>0&&(s=[...g,...s])}}}const c=JP(s,o);return{budget:n,payees:r,months:c}}function t3(t,e){const{enabled:n,referenceMonth:r}=e||{},s=R.useRef(r),o=R.useRef(null);return R.useLayoutEffect(()=>{t!==o.current&&(s.current=r,o.current=t)},[t,r]),qo({queryKey:t?["initialDataLoad",t]:["initialDataLoad","none"],queryFn:()=>e3(t,s.current),enabled:!!t&&n!==!1,staleTime:1/0})}async function n3(t,e,n,r){const s=Te.month(t,e,n),o=r.getQueryData(s);if(!o?.month)throw new Error(`Month ${e}/${n} not found in cache`);const c=o.month,l=await r3(t,e,n,r),h=Ad(c,l);return r.setQueryData(s,{month:h}),h}async function r3(t,e,n,r){const{year:s,month:o}=El(e,n),c=Te.month(t,s,o),l=r.getQueryData(c);if(l?.month)return ul(l.month);try{const h=await wr(t,s,o,{description:`fetching previous month ${s}/${o} for recalculation`});if(h)return ul(h)}catch(h){console.warn(`[useLocalRecalculation] Could not fetch previous month ${s}/${o}:`,h)}return Bo}async function i3(t,e,n){const s=n.getQueryCache().findAll({predicate:h=>h.queryKey[0]==="month"&&h.queryKey[1]===t&&h.state.status==="success"&&h.state.data!=null});if(s.length===0)return;const o=[];for(const h of s){const f=h.queryKey,p=f[2],g=f[3],_=n.getQueryData(h.queryKey);_?.month&&o.push({year:p,month:g,monthDoc:_.month})}o.sort((h,f)=>h.year!==f.year?h.year-f.year:h.month-f.month);const c=new Map;for(const{year:h,month:f,monthDoc:p}of o)c.set(`${h}/${f}`,p);let l=Bo;for(const{year:h,month:f,monthDoc:p}of o){const g=Td(h,f,e),_=g?(()=>{const w=c.get(`${g.year}/${g.month}`);if(!w)return 0;const S=w.income||[];return Ee(S.reduce((E,T)=>E+(T.amount||0),0))})():0,y=Ad(p,l,_),x=Te.month(t,h,f);n.setQueryData(x,{month:y}),l=ul(y)}}function s3(t,e,n){const r=Rt(),s=R.useRef(null),o=R.useRef(null),c=R.useRef(null),l=R.useCallback((h,f)=>{if(!t)return;const p=Te.month(t,h,f);if(r.getQueryData(p))return;const _=r.getQueryData(Te.budget(t)),y=Fe(h,f);_?.monthMap&&y in _.monthMap&&r.prefetchQuery({queryKey:p,queryFn:async()=>{const S=(await rd(t,r)).budget.percentage_income_months_back??1,E=await o0(t,h,f,r,S);return E?{month:E}:null},staleTime:gi}).catch(w=>{console.warn(`[useMonthPrefetch] Failed to prefetch month ${h}/${f}:`,w)})},[t,r]);R.useEffect(()=>{if(!t)return;const h=`${t}-${e}-${n}`;if(c.current===h)return;c.current=h;const f=Kf(e,n);l(f.year,f.month)},[t,e,n,l]),R.useEffect(()=>{if(s.current===null||o.current===null){s.current=e,o.current=n;return}if(s.current===e&&o.current===n)return;if(!t){s.current=e,o.current=n;return}const h=Fe(s.current,o.current),g=Fe(e,n)>h?Kf(e,n):El(e,n);l(g.year,g.month),s.current=e,o.current=n},[t,e,n,l])}async function pA(t,e,n=!0){if(!Pe.getQueryData(Te.budget(t))){console.warn("[ensureMonthsFreshAndRecalculateBalances] Budget not in cache");return}n&&await JT(t)}function g0(t=!0,e={}){const{alwaysRecalculate:n=!1}=e,{selectedBudgetId:r}=Qe(),{addLoadingHold:s,removeLoadingHold:o}=kn(),c=R.useRef(!1),l=R.useRef(null);R.useEffect(()=>{if(r!==l.current&&(c.current=!1,l.current=r),!t||!r||c.current)return;c.current=!0;let h=null;pA(r,(f,p)=>{f?(h="ensure-balances-fresh",s(h,p)):h&&(o(h),h=null)},n).catch(f=>{console.error("[useEnsureBalancesFresh] Failed to ensure balances fresh:",f),h&&o(h)})},[t,r,n,s,o])}function a3(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1;let r=e,s=n-3;for(;s<=0;)s+=12,r-=1;return Fe(r,s)}function o3(t,e){const n=Fe(t,e),r=a3();return n>=r}function c3({budgetId:t,viewingYear:e,viewingMonth:n,initialDataLoadComplete:r,enabled:s=!0}){const o=Rt(),c=R.useRef(!1),l=R.useRef(null),h=R.useCallback(()=>{if(!t||!s||!r)return;const f=["initialDataLoad",t],p=o.getQueryState(f);if(!p?.dataUpdatedAt)return;Date.now()-p.dataUpdatedAt>gi&&!c.current&&(c.current=!0,o.invalidateQueries({queryKey:f}))},[t,s,r,o]);R.useEffect(()=>{r&&h()},[r,h]),R.useEffect(()=>{if(!s||!r)return;const f=()=>{document.visibilityState==="visible"&&(c.current=!1,h())};return document.addEventListener("visibilitychange",f),()=>{document.removeEventListener("visibilitychange",f)}},[s,r,h]),R.useEffect(()=>{c.current=!1,l.current=null},[t]),R.useEffect(()=>{if(!t||!s||!r||o3(e,n))return;const p=`${t}-${e}-${n}`;if(l.current===p)return;l.current=p;const g=[{year:e,month:n},El(e,n),Kf(e,n)];for(const{year:_,month:y}of g){const x=Te.month(t,_,y);if(o.getQueryData(x)){const S=o.getQueryState(x);if(!(S?.dataUpdatedAt?Date.now()-S.dataUpdatedAt>gi:!1))continue}o.prefetchQuery({queryKey:x,queryFn:async()=>{const S=await o0(t,_,y);return S?{month:S}:null},staleTime:gi}).catch(S=>{console.warn(`[useStaleDataRefresh] Failed to prefetch month ${_}/${y}:`,S)})}},[t,s,r,e,n,o])}function ns(){Pe.removeQueries({queryKey:["budget"]}),Pe.removeQueries({queryKey:["month"]}),Pe.removeQueries({queryKey:["accessibleBudgets"]}),Pe.removeQueries({queryKey:["payees"]}),Pe.removeQueries({queryKey:["user"]}),console.log("[Migration] All caches cleared")}async function Pm(t){try{const e=await t();return ns(),e}catch(e){throw ns(),e}}const yA=R.createContext(null),i1={isOpen:!1,migrationName:"",stage:"",progress:null,currentItem:null,details:null,isComplete:!1,error:null};function l3({children:t}){const[e,n]=R.useState(i1),r=R.useCallback(()=>({setStage:l=>{n(h=>({...h,stage:l}))},setProgress:l=>{n(h=>({...h,progress:l}))},setCurrentItem:l=>{n(h=>({...h,currentItem:l}))},setDetails:l=>{n(h=>({...h,details:l}))},updateItemProgress:(l,h,f)=>{const p=h>0?Math.round(l/h*100):0;n(g=>({...g,progress:p,currentItem:f||`Item ${l} of ${h}`,details:`${l} / ${h} complete`}))}}),[]),s=R.useCallback(async(l,h)=>{n({isOpen:!0,migrationName:l,stage:"Starting migration...",progress:null,currentItem:null,details:null,isComplete:!1,error:null});const f=r();try{const p=await h(f);return ns(),n(g=>({...g,isComplete:!0,stage:"Migration complete",progress:100,details:p.errors.length>0?`Completed with ${p.errors.length} error(s)`:"All operations successful"})),p}catch(p){ns();const g=p instanceof Error?p.message:"Unknown error occurred";throw n(_=>({..._,isComplete:!0,error:g,stage:"Migration failed",progress:null})),p}},[r]),o=R.useCallback(()=>{n(l=>l.isComplete?i1:(console.warn("[MigrationProgress] Cannot close modal while migration is running"),l))},[]),c={state:e,runMigrationWithProgress:s,closeModal:o};return d.jsx(yA.Provider,{value:c,children:t})}function Jo(){const t=R.useContext(yA);if(!t)throw new Error("useMigrationProgress must be used within MigrationProgressProvider");return t}async function jd(t){return(await Gn("budgets",`${t}: batch reading all budgets`)).docs.map(n=>({id:n.id,data:n.data}))}async function _A(t,e){return(await Gn("months",`${e}: batch reading months for budget ${t}`,[{field:"budget_id",op:"==",value:t}])).docs.map(s=>({id:s.id,data:s.data,budgetId:s.data.budget_id,year:s.data.year,month:s.data.month})).sort((s,o)=>s.year!==o.year?s.year-o.year:s.month-o.month)}async function rr(t){const e=await jd(t),n=await Gn("months",`${t}: batch reading all months`),r=new Map;for(const s of n.docs){const o=s.data.budget_id,c={id:s.id,data:s.data,budgetId:o,year:s.data.year,month:s.data.month};r.has(o)||r.set(o,[]),r.get(o).push(c)}for(const s of r.values())s.sort((o,c)=>o.year!==c.year?o.year-c.year:o.month-c.month);return{budgets:e,monthsByBudget:r}}async function Xa(t,e){if(t.length===0)return;if(console.log(`[DEBUG] batchWriteMonths: Writing ${t.length} months from ${e}`),t.length>0){const o=t[0],c=o.data.category_balances?.[0],l=o.data.account_balances?.[0],h=o.data.category_balances?.reduce((f,p)=>f+(p.allocated||0),0)||0;console.log(`[DEBUG]   First month ${o.year}/${o.month} BEFORE convert: cat[0] start=${c?.start_balance} alloc=${c?.allocated}, totalAlloc=${h}, acc[0] start=${l?.start_balance}`)}const n=t.map(o=>{const c=Om(o.data);if(o===t[0]){const l=c.category_balances?.[0],h=c.account_balances?.[0];console.log(`[DEBUG]   First month AFTER convert: cat[0] start=${l?.start_balance} alloc=${l?.allocated}, acc[0] start=${h?.start_balance}`)}return{collectionPath:"months",docId:Zi(o.budgetId,o.year,o.month),data:Jr({...c,updated_at:new Date().toISOString()})}});await Rm(n,`${e}: batch writing ${t.length} months`);const r=new Map;for(const o of t)r.has(o.budgetId)||r.set(o.budgetId,[]),r.get(o.budgetId).push({year:o.year,month:o.month});const{ensureMonthsInMapBatch:s}=await id(async()=>{const{ensureMonthsInMapBatch:o}=await Promise.resolve().then(()=>lP);return{ensureMonthsInMapBatch:o}},void 0);for(const[o,c]of r)try{await s(o,c)}catch(l){console.warn(`[batchWriteMonths] Failed to update month_map for budget ${o}:`,l)}}async function zm(t,e){if(t.length===0)return;const n=t.map(r=>{const s={...r.data};if(s.accounts&&typeof s.accounts=="object"){const o=s.accounts;s.accounts=Object.fromEntries(Object.entries(o).map(([c,l])=>{if(l&&typeof l=="object"){const{balance:h,...f}=l;return[c,f]}return[c,l]}))}if(s.categories&&typeof s.categories=="object"){const o=s.categories;s.categories=Object.fromEntries(Object.entries(o).map(([c,l])=>{if(l&&typeof l=="object"){const{balance:h,...f}=l;return[c,f]}return[c,l]}))}return delete s.total_available,delete s.is_needs_recalculation,{collectionPath:"budgets",docId:r.budgetId,data:Jr({...s,updated_at:new Date().toISOString()})}});await Rm(n,`${e}: batch writing ${t.length} budgets`)}async function bA(t,e,n){if(e.length===0)return;console.log(`[DEBUG] recalculateAndWriteBudget: ${e.length} months for budget ${t}`);let r=Bo;const s=[];let o=!0;for(const _ of e){if(o){const S={},E={},T=(_.category_balances||[]).reduce((A,M)=>A+(M.allocated||0),0);console.log(`[DEBUG] First month ${_.year}/${_.month} raw category_balances (totalAlloc=${T}):`,(_.category_balances||[]).slice(0,3).map(A=>({id:A.category_id.slice(0,10),start:A.start_balance,alloc:A.allocated,end:A.end_balance}))),console.log(`[DEBUG] First month ${_.year}/${_.month} raw account_balances:`,(_.account_balances||[]).slice(0,3).map(A=>({id:A.account_id.slice(0,10),start:A.start_balance,end:A.end_balance})));for(const A of _.category_balances||[])A.start_balance!==0&&(S[A.category_id]=A.start_balance);for(const A of _.account_balances||[])A.start_balance!==0&&(E[A.account_id]=A.start_balance);console.log(`[DEBUG] Extracted initial balances: categories=${Object.keys(S).length}, accounts=${Object.keys(E).length}`),r={categoryEndBalances:S,accountEndBalances:E,totalIncome:0},o=!1}const y=Ad(_,r);s.push(y);const x=y.category_balances?.[0],w=y.category_balances?.reduce((S,E)=>S+(E.allocated||0),0)||0;console.log(`[DEBUG] After recalc ${_.year}/${_.month}: cat[0] start=${x?.start_balance} alloc=${x?.allocated} end=${x?.end_balance}, totalAlloc=${w}`),r=ul(y)}const c=s.map(_=>({budgetId:t,year:_.year,month:_.month,data:_}));await Xa(c,n);const l=[...s].reverse().find(_=>_.are_allocations_finalized);let h,f;if(l){f={};for(const _ of l.category_balances||[])f[_.category_id]=_.end_balance;h={};for(const _ of l.account_balances||[])h[_.account_id]=_.end_balance;console.log(`[DEBUG] recalculateAndWriteBudget: using last FINALIZED month ${l.year}/${l.month} for balances`)}else h=r.accountEndBalances,f=r.categoryEndBalances,console.log("[DEBUG] recalculateAndWriteBudget: no finalized months, using last month for balances");const{exists:p,data:g}=await vt("budgets",t);if(p&&g){const _=sP(g.month_map||{}),y={...f},x=g.categories||{};for(const w of Object.keys(x))w in y||(y[w]=0);await aP(t,h,y,_)}}async function vA(t,e){if(t.length===0)return;const n=new Map;for(const r of t)n.has(r.budgetId)||n.set(r.budgetId,[]),n.get(r.budgetId).push(r);for(const[r,s]of n){s.sort((l,h)=>l.year!==h.year?l.year-h.year:l.month-h.month),await Xa(s,e);const c=(await _A(r,e)).map(l=>l.data);await bA(r,c,e)}}async function u3(t){const{exists:e,data:n}=await vt("budgets",t);if(!e||!n)return;const r=Object.fromEntries(Object.entries(n.accounts||{}).map(([o,c])=>{if(c&&typeof c=="object"){const{balance:l,...h}=c;return[o,h]}return[o,c]})),s=Object.fromEntries(Object.entries(n.categories||{}).map(([o,c])=>{if(c&&typeof c=="object"){const{balance:l,...h}=c;return[o,h]}return[o,c]}));await dr("budgets",t,{...n,accounts:r,categories:s,month_map:{},updated_at:new Date().toISOString()})}function d3({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[s,o]=R.useState(!1),[c,l]=R.useState(null),[h,f]=R.useState(null),[p,g]=R.useState(null);async function _(){if(t){r(!0);try{const x=await Gn("months","delete all months: scanning for all months"),w=[],S=new Set;for(const E of x.docs){const{budget_id:T,year:A,month:M}=E.data;S.add(T),w.push({docId:E.id,budgetId:T,year:A,month:M})}w.sort((E,T)=>E.budgetId!==T.budgetId?E.budgetId.localeCompare(T.budgetId):E.year!==T.year?E.year-T.year:E.month-T.month),l({monthsToDelete:w,monthsCount:w.length,budgetCount:S.size})}catch{}finally{r(!1)}}}async function y(){if(!t||!c||c.monthsToDelete.length===0)return;o(!0),f(null);const x=c.monthsToDelete.length,w=new Set,S=[];for(const L of c.monthsToDelete)w.add(L.budgetId);g({phase:"deleting",deleted:0,total:x,currentMonth:null,budgetsRecalculated:0,totalBudgets:c.budgetCount,percentComplete:0});const E=c.monthsToDelete.map(L=>({collectionPath:"months",docId:L.docId}));let T=0;try{await FT(E,"delete all months: batch deleting all month documents",L=>{T=L,g({phase:"deleting",deleted:L,total:x,currentMonth:`Batch ${Math.ceil(L/500)} of ${Math.ceil(x/500)}`,budgetsRecalculated:0,totalBudgets:c.budgetCount,percentComplete:Math.round(L/x*70)})}),T=x}catch(L){S.push(`Batch delete failed: ${L instanceof Error?L.message:"Unknown error"}`)}const A=Array.from(w);let M=0;for(const L of A){g({phase:"resetting-budgets",deleted:T,total:x,currentMonth:`Budget ${M+1}/${A.length}`,budgetsRecalculated:M,totalBudgets:A.length,percentComplete:70+Math.round(M/A.length*25)});try{await u3(L),M++}catch{M++}}g({phase:"clearing-cache",deleted:T,total:x,currentMonth:null,budgetsRecalculated:M,totalBudgets:A.length,percentComplete:95}),ns(),g({phase:"complete",deleted:T,total:x,currentMonth:null,budgetsRecalculated:M,totalBudgets:A.length,percentComplete:100}),f({deleted:T,errors:S,budgetsRecalculated:M}),o(!1),g(null),S.length===0&&(l({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:c,isScanning:n,scanStatus:_,isDeleting:s,deleteResult:h,deleteProgress:p,deleteAllMonths:y}}const cy="sample@sample.com",Ao="budget_1767746876726_xuj7nzl4l";function h3({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[s,o]=R.useState(!1),[c,l]=R.useState(null),[h,f]=R.useState(null),[p,g]=R.useState(null);async function _(){if(t){r(!0);try{let w=(await Gn("budgets","delete sample user budget: scanning for sample user budgets",[{field:"owner_email",op:"==",value:cy}])).docs;if(w.length===0){console.log("delete sample user budget: no budgets found by owner_email, checking fallback budget ID");const L=await vt("budgets",Ao,"delete sample user budget: checking fallback budget ID");L.exists&&L.data&&(console.log("delete sample user budget: found fallback budget",Ao),w=[{id:Ao,data:L.data}])}const S=[];let E=0,T=!1;for(const L of w){const H=L.id,O=L.data.name,B=(await Gn("months",`delete sample user budget: counting months for budget ${H}`,[{field:"budget_id",op:"==",value:H}])).docs.length;E+=B,S.push({budgetId:H,budgetName:O,monthCount:B}),(await Gn("payees",`delete sample user budget: checking payees for budget ${H}`,[{field:"budget_id",op:"==",value:H}])).docs.length>0&&(T=!0)}const A=[],M=await Gn("users","delete sample user budget: finding sample user document",[{field:"email",op:"==",value:cy}]);M.docs.length>0&&M.docs[0].data.budget_ids?.includes(Ao)&&(S.some(j=>j.budgetId===Ao)||(console.log("delete sample user budget: found stale budget reference in sample user document",Ao),A.push(Ao))),l({budgets:S,totalBudgets:S.length,totalMonths:E,hasPayees:T,staleBudgetIds:A})}catch(x){console.error("Error scanning for sample user budgets:",x)}finally{r(!1)}}}async function y(){if(!t||!c||c.budgets.length===0&&c.staleBudgetIds.length===0)return;o(!0),f(null);const x=[];let w=0,S=0,E=0;const T=c.totalMonths,A=c.totalBudgets;g({phase:"deleting-months",monthsDeleted:0,totalMonths:T,budgetsDeleted:0,totalBudgets:A,percentComplete:0});for(const L of c.budgets)try{const O=(await Gn("months",`delete sample user budget: fetching month IDs for budget ${L.budgetId}`)).docs.filter(j=>j.data.budget_id===L.budgetId).map(j=>({collectionPath:"months",docId:j.id}));O.length>0&&(await FT(O,`delete sample user budget: deleting ${O.length} months for budget ${L.budgetId}`,j=>{w=j,g({phase:"deleting-months",monthsDeleted:w,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:Math.round(w/Math.max(T,1)*60)})}),w=O.length)}catch(H){x.push(`Failed to delete months for budget ${L.budgetId}: ${H instanceof Error?H.message:"Unknown error"}`)}g({phase:"deleting-payees",monthsDeleted:w,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:60});for(const L of c.budgets)try{await Wf("payees",L.budgetId,`delete sample user budget: deleting payees for budget ${L.budgetId}`),E++}catch{}g({phase:"deleting-budgets",monthsDeleted:w,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:70});for(const L of c.budgets)try{await Wf("budgets",L.budgetId,`delete sample user budget: deleting budget ${L.budgetId}`),S++,g({phase:"deleting-budgets",monthsDeleted:w,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:70+Math.round(S/A*10)})}catch(H){x.push(`Failed to delete budget ${L.budgetId}: ${H instanceof Error?H.message:"Unknown error"}`)}g({phase:"updating-user",monthsDeleted:w,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:80});const M=[...c.budgets.map(L=>L.budgetId),...c.staleBudgetIds];try{const L=await Gn("users","delete sample user budget: finding sample user document to remove budget references",[{field:"email",op:"==",value:cy}]);if(L.docs.length>0){const H=L.docs[0],O=H.id,j=H.data,B=(j.budget_ids||[]).filter(V=>!M.includes(V));await dr("users",O,{...j,budget_ids:B,updated_at:new Date().toISOString()},"delete sample user budget: removing deleted budget IDs from sample user document"),console.log(`delete sample user budget: removed ${M.length} budget IDs from sample user document`)}else console.log("delete sample user budget: no sample user document found, skipping user update")}catch(L){x.push(`Failed to update sample user document: ${L instanceof Error?L.message:"Unknown error"}`)}g({phase:"clearing-cache",monthsDeleted:w,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:95}),ns(),g({phase:"complete",monthsDeleted:w,totalMonths:T,budgetsDeleted:S,totalBudgets:A,percentComplete:100}),f({budgetsDeleted:S,monthsDeleted:w,payeesDeleted:E,errors:x}),o(!1),g(null),x.length===0&&(l({budgets:[],totalBudgets:0,totalMonths:0,hasPayees:!1,staleBudgetIds:[]}),e?.())}return{status:c,isScanning:n,scanStatus:_,isDeleting:s,deleteResult:h,deleteProgress:p,deleteSampleUserBudget:y}}function s1(t){if(!t)return 0;let e=0;for(const n of t)ht(n.start_balance??0)&&e++,ht(n.end_balance??0)&&e++,ht(n.allocated??0)&&e++,ht(n.spent??0)&&e++,ht(n.income??0)&&e++,ht(n.expenses??0)&&e++,ht(n.net_change??0)&&e++;return e}function a1(t){if(!t)return 0;let e=0;for(const n of t)ht(n.amount??0)&&e++;return e}async function o1(){const t=await Gn("budgets","precision cleanup: scanning all budgets");let e=0,n=0,r=0,s=0;for(const g of t.docs){const _=g.data;let y=!1;ht(_.total_available??0)&&(s++,y=!0);const x=_.accounts;if(x&&typeof x=="object")for(const S of Object.values(x))ht(S.balance??0)&&(n++,y=!0);const w=_.categories;if(w&&typeof w=="object")for(const S of Object.values(w))ht(S.balance??0)&&(r++,y=!0),ht(S.default_monthly_amount??0)&&(r++,y=!0);y&&e++}const o=await Gn("months","precision cleanup: scanning all months");let c=0,l=0,h=0,f=0,p=0;for(const g of o.docs){const _=g.data;let y=!1;(ht(_.total_income??0)||ht(_.total_expenses??0)||ht(_.previous_month_income??0))&&(y=!0);const x=a1(_.income);x>0&&(l+=x,y=!0);const w=a1(_.expenses);w>0&&(h+=w,y=!0);const S=s1(_.category_balances);S>0&&(f+=S,y=!0);const E=s1(_.account_balances);E>0&&(p+=E,y=!0),y&&c++}return{totalBudgets:t.docs.length,budgetsWithPrecisionIssues:e,accountsWithPrecisionIssues:n,categoriesWithPrecisionIssues:r,totalAvailableWithPrecisionIssues:s,totalMonths:o.docs.length,monthsWithPrecisionIssues:c,incomeValuesWithPrecisionIssues:l,expenseValuesWithPrecisionIssues:h,categoryBalancesWithPrecisionIssues:f,accountBalancesWithPrecisionIssues:p}}function c1(t){const e={...t};return e.start_balance!==void 0&&(e.start_balance=Ee(e.start_balance)),e.end_balance!==void 0&&(e.end_balance=Ee(e.end_balance)),e.allocated!==void 0&&(e.allocated=Ee(e.allocated)),e.spent!==void 0&&(e.spent=Ee(e.spent)),e.income!==void 0&&(e.income=Ee(e.income)),e.expenses!==void 0&&(e.expenses=Ee(e.expenses)),e.transfers!==void 0&&(e.transfers=Ee(e.transfers)),e.adjustments!==void 0&&(e.adjustments=Ee(e.adjustments)),e.net_change!==void 0&&(e.net_change=Ee(e.net_change)),e}function f3(t,e){let n=!1;ht(t.total_available??0)&&(t.total_available=Ee(t.total_available??0),e.totalAvailableFixed++,n=!0);const r=t.accounts;if(r&&typeof r=="object")for(const[o,c]of Object.entries(r)){const l=c;ht(l.balance??0)&&(r[o].balance=Ee(l.balance??0),e.accountsFixed++,n=!0)}const s=t.categories;if(s&&typeof s=="object")for(const[o,c]of Object.entries(s)){const l=c;ht(l.balance??0)&&(s[o].balance=Ee(l.balance??0),e.categoriesFixed++,n=!0),ht(l.default_monthly_amount??0)&&(s[o].default_monthly_amount=Ee(l.default_monthly_amount??0),e.categoriesFixed++,n=!0)}return{fixed:n,data:t}}function m3(t,e){let n=!1;if(ht(t.total_income??0)&&(t.total_income=Ee(t.total_income??0),n=!0),ht(t.total_expenses??0)&&(t.total_expenses=Ee(t.total_expenses??0),n=!0),ht(t.previous_month_income??0)&&(t.previous_month_income=Ee(t.previous_month_income??0),n=!0),t.income&&Array.isArray(t.income)){const r=[];for(const s of t.income)ht(s.amount??0)?(r.push({...s,amount:Ee(s.amount??0)}),e.incomeValuesFixed++,n=!0):r.push(s);t.income=r}if(t.expenses&&Array.isArray(t.expenses)){const r=[];for(const s of t.expenses)ht(s.amount??0)?(r.push({...s,amount:Ee(s.amount??0)}),e.expenseValuesFixed++,n=!0):r.push(s);t.expenses=r}if(t.category_balances&&Array.isArray(t.category_balances)){const r=[];for(const s of t.category_balances)ht(s.start_balance??0)||ht(s.end_balance??0)||ht(s.allocated??0)||ht(s.spent??0)||ht(s.transfers??0)||ht(s.adjustments??0)?(r.push(c1(s)),e.categoryBalancesFixed++,n=!0):r.push(s);t.category_balances=r}if(t.account_balances&&Array.isArray(t.account_balances)){const r=[];for(const s of t.account_balances)ht(s.start_balance??0)||ht(s.end_balance??0)||ht(s.income??0)||ht(s.expenses??0)||ht(s.transfers??0)||ht(s.adjustments??0)||ht(s.net_change??0)?(r.push(c1(s)),e.accountBalancesFixed++,n=!0):r.push(s);t.account_balances=r}return{fixed:n,data:t}}function g3(t,e,n){const r={...t.data},{fixed:s,data:o}=f3(r,n),c=s?{budgetId:t.id,data:o}:null;s&&n.budgetsProcessed++;const l=[];let h=!1;for(const f of e){const p={...f.data},{fixed:g,data:_}=m3(p,n);g&&(n.monthsProcessed++,h=!0),l.push(_)}return{budgetUpdate:c,fixedMonths:l,hasMonthFixes:h}}async function p3(){const t={budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,totalAvailableFixed:0,monthsProcessed:0,incomeValuesFixed:0,expenseValuesFixed:0,categoryBalancesFixed:0,accountBalancesFixed:0,errors:[]},{budgets:e,monthsByBudget:n}=await rr("precision cleanup"),r=[],s=[];for(const o of e)try{const c=n.get(o.id)||[],{budgetUpdate:l,fixedMonths:h,hasMonthFixes:f}=g3(o,c,t);l&&r.push(l),(f||h.length>0)&&s.push({budgetId:o.id,months:h})}catch(c){t.errors.push(`Budget ${o.id}: ${c instanceof Error?c.message:String(c)}`)}if(r.length>0)try{await zm(r,"precision cleanup")}catch(o){t.errors.push(`Budget batch write: ${o instanceof Error?o.message:String(o)}`)}for(const{budgetId:o,months:c}of s)try{await bA(o,c,"precision cleanup")}catch(l){t.errors.push(`Budget ${o} recalc: ${l instanceof Error?l.message:String(l)}`)}return t}function y3({currentUser:t,onComplete:e}){const[n,r]=R.useState(null),[s,o]=R.useState(!1),[c,l]=R.useState(!1),[h,f]=R.useState(null),[p,g]=R.useState(null),_=n?n.accountsWithPrecisionIssues+n.categoriesWithPrecisionIssues+n.totalAvailableWithPrecisionIssues+n.incomeValuesWithPrecisionIssues+n.expenseValuesWithPrecisionIssues+n.categoryBalancesWithPrecisionIssues+n.accountBalancesWithPrecisionIssues:0,y=_>0,x=R.useCallback(async()=>{if(t){o(!0),g(null);try{const S=await o1();r(S),f(null)}catch(S){g(S instanceof Error?S.message:"Failed to scan for precision issues")}finally{o(!1)}}},[t]),w=R.useCallback(async()=>{if(!(!t||!y)){l(!0),g(null);try{const S=await Pm(()=>p3());f(S);const E=await o1();r(E),e?.()}catch(S){g(S instanceof Error?S.message:"Failed to run precision cleanup")}finally{l(!1)}}},[t,y,e]);return{status:n,isScanning:s,isRunning:c,result:h,error:p,totalIssues:_,hasIssues:y,hasData:n!==null,scan:x,runCleanup:w}}function p0(t){const e=t.income||[],n=t.expenses||[],r=Ee(e.reduce((l,h)=>l+h.amount,0)),s=Ee(n.reduce((l,h)=>l+h.amount,0)),o=_3(t),c=b3(t);return{...t,total_income:r,total_expenses:s,account_balances:o,category_balances:c}}function _3(t){const e=t.income||[],n=t.expenses||[],r=t.transfers||[],s=t.adjustments||[],o=t.account_balances||[],c=new Map;for(const f of o)tt(f.account_id)||c.set(f.account_id,f);const l=new Set;for(const f of e)tt(f.account_id)||l.add(f.account_id);for(const f of n)tt(f.account_id)||l.add(f.account_id);for(const f of r)tt(f.from_account_id)||l.add(f.from_account_id),tt(f.to_account_id)||l.add(f.to_account_id);for(const f of s)tt(f.account_id)||l.add(f.account_id);for(const f of o)tt(f.account_id)||l.add(f.account_id);const h=[];for(const f of l){const p=c.get(f),g=Ee(p?.start_balance??0),_=Ee(e.filter(A=>A.account_id===f).reduce((A,M)=>A+M.amount,0)),y=Ee(n.filter(A=>A.account_id===f).reduce((A,M)=>A+M.amount,0)),x=Ee(r.filter(A=>A.from_account_id===f).reduce((A,M)=>A-M.amount,0)),w=Ee(r.filter(A=>A.to_account_id===f).reduce((A,M)=>A+M.amount,0)),S=Ee(w+x),E=Ee(s.filter(A=>A.account_id===f).reduce((A,M)=>A+M.amount,0)),T=Ee(_+y+S+E);h.push({account_id:f,start_balance:g,income:_,expenses:y,transfers:S,adjustments:E,net_change:T,end_balance:Ee(g+T)})}return h}function b3(t){const e=t.expenses||[],n=t.transfers||[],r=t.adjustments||[],s=t.category_balances||[],o=new Map;for(const g of s)lt(g.category_id)||o.set(g.category_id,g);const{spentMap:c,transfersMap:l,adjustmentsMap:h}=HT(e,n,r),f=new Set;for(const g of s)lt(g.category_id)||f.add(g.category_id);for(const g of e)lt(g.category_id)||f.add(g.category_id);for(const g of n)lt(g.from_category_id)||f.add(g.from_category_id),lt(g.to_category_id)||f.add(g.to_category_id);for(const g of r)lt(g.category_id)||f.add(g.category_id);const p=[];for(const g of f){const _=o.get(g),y=c[g]??0,x=l[g]??0,w=h[g]??0;if(_){const S=Ee(_.start_balance),E=Ee(_.allocated);p.push({category_id:g,start_balance:S,allocated:E,spent:y,transfers:x,adjustments:w,end_balance:Ee(S+E+y+x+w)})}else p.push({category_id:g,start_balance:0,allocated:0,spent:y,transfers:x,adjustments:w,end_balance:Ee(y+x+w)})}return p}const v3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"],x3=["unknown","Unknown","UNKNOWN","","null","undefined","N/A","n/a"];function Lm(t){return!t||tt(t)?!0:v3.includes(t)}function Um(t){return!t||lt(t)?!0:x3.includes(t)}function xA(t){return Lm(t.account_id)||Um(t.category_id)}function w3(t){return{id:t.id.replace("expense_","adjustment_"),amount:t.amount,account_id:Lm(t.account_id)?Ht:t.account_id,category_id:Um(t.category_id)?Zt:t.category_id,date:t.date,description:t.description||t.payee,cleared:t.cleared,created_at:t.created_at}}function S3(t){const e=t.data,n=e.expenses||[],r=e.adjustments||[],s=[],o=[];let c=0,l=0;for(const f of n)xA(f)?(Lm(f.account_id)&&!tt(f.account_id)&&c++,Um(f.category_id)&&!lt(f.category_id)&&l++,o.push(w3(f))):s.push(f);return o.length===0?{needsUpdate:!1,updatedMonth:null,stats:{expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0}}:{needsUpdate:!0,updatedMonth:p0({...e,expenses:s,adjustments:[...r,...o],transfers:e.transfers||[],updated_at:new Date().toISOString()}),stats:{expensesMigrated:o.length,invalidAccountsFixed:c,invalidCategoriesFixed:l}}}async function C3(){const{budgets:t,monthsByBudget:e}=await rr("expense-to-adjustment-scan");let n=0,r=0,s=0,o=0;for(const c of t){const l=e.get(c.id)||[];n+=l.length;for(const h of l){const p=h.data.expenses||[];for(const g of p)xA(g)&&(r++,Lm(g.account_id)&&!tt(g.account_id)&&s++,Um(g.category_id)&&!lt(g.category_id)&&o++)}}return{totalBudgets:t.length,totalMonths:n,expensesToMigrate:r,invalidAccountsToFix:s,invalidCategoriesToFix:o}}async function E3(){const{budgets:t,monthsByBudget:e}=await rr("expense-to-adjustment-migration"),n=[];let r=0,s=0,o=0;const c=[];for(const l of t){const h=e.get(l.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:_}=S3(f);p&&g&&(n.push({budgetId:l.id,year:f.year,month:f.month,data:g}),r+=_.expensesMigrated,s+=_.invalidAccountsFixed,o+=_.invalidCategoriesFixed)}catch(p){c.push(`Month ${f.year}/${f.month} in budget ${l.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await Xa(n,"expense-to-adjustment-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,expensesMigrated:r,invalidAccountsFixed:s,invalidCategoriesFixed:o,errors:c}}function T3({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[s,o]=R.useState(!1),[c,l]=R.useState(null),[h,f]=R.useState(null);async function p(){if(t){r(!0);try{const y=await C3();l(y)}catch(y){console.error("Failed to scan for expense to adjustment migration:",y)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const y=await Pm(()=>E3());f(y),e?.()}catch(y){f({budgetsProcessed:0,monthsProcessed:0,expensesMigrated:0,invalidAccountsFixed:0,invalidCategoriesFixed:0,errors:[y instanceof Error?y.message:"Unknown error"]})}finally{o(!1)}}}const _=c!==null&&c.expensesToMigrate>0;return{status:c,isScanning:n,scanStatus:p,hasItemsToMigrate:_,isRunning:s,result:h,runMigration:g}}function wA(t){const e=new Set,n=new Set,r=t.categories;if(r)for(const o of Object.keys(r))e.add(o);const s=t.accounts;if(s)for(const o of Object.keys(s))n.add(o);return{categoryIds:e,accountIds:n}}function Ra(t,e){return!t||lt(t)?!1:!e.has(t)}function qi(t,e){return!t||tt(t)?!1:!e.has(t)}function A3(t,e){const n=t.data;let r=0,s=0,o=0,c=0,l=0,h=0,f=!1;const p=(n.expenses||[]).map(w=>{const S={...w};let E=!1;return Ra(w.category_id,e.categoryIds)&&(S.category_id=Zt,r++,E=!0),qi(w.account_id,e.accountIds)&&(S.account_id=Ht,s++,E=!0),E&&(o++,f=!0),S}),g=(n.income||[]).map(w=>{const S={...w};let E=!1;return qi(w.account_id,e.accountIds)&&(S.account_id=Ht,s++,E=!0),E&&(c++,f=!0),S}),_=(n.transfers||[]).map(w=>{const S={...w};let E=!1;return Ra(w.from_category_id,e.categoryIds)&&(S.from_category_id=Zt,r++,E=!0),Ra(w.to_category_id,e.categoryIds)&&(S.to_category_id=Zt,r++,E=!0),qi(w.from_account_id,e.accountIds)&&(S.from_account_id=Ht,s++,E=!0),qi(w.to_account_id,e.accountIds)&&(S.to_account_id=Ht,s++,E=!0),E&&(l++,f=!0),S}),y=(n.adjustments||[]).map(w=>{const S={...w};let E=!1;return Ra(w.category_id,e.categoryIds)&&(S.category_id=Zt,r++,E=!0),qi(w.account_id,e.accountIds)&&(S.account_id=Ht,s++,E=!0),E&&(h++,f=!0),S});return f?{needsUpdate:!0,updatedMonth:{...n,expenses:p,income:g,transfers:_,adjustments:y,updated_at:new Date().toISOString()},stats:{categoryIdsFixed:r,accountIdsFixed:s,affectedExpenses:o,affectedIncome:c,affectedTransfers:l,affectedAdjustments:h}}:{needsUpdate:!1,updatedMonth:null,stats:{categoryIdsFixed:0,accountIdsFixed:0,affectedExpenses:0,affectedIncome:0,affectedTransfers:0,affectedAdjustments:0}}}async function j3(){const{budgets:t,monthsByBudget:e}=await rr("orphaned-id-scan");let n=0,r=0,s=0,o=0,c=0,l=0,h=0;for(const f of t){const p=wA(f.data),g=e.get(f.id)||[];n+=g.length;for(const _ of g){const y=_.data;for(const x of y.expenses||[]){let w=!1;Ra(x.category_id,p.categoryIds)&&(r++,w=!0),qi(x.account_id,p.accountIds)&&(s++,w=!0),w&&o++}for(const x of y.income||[])qi(x.account_id,p.accountIds)&&(s++,c++);for(const x of y.transfers||[]){let w=!1;Ra(x.from_category_id,p.categoryIds)&&(r++,w=!0),Ra(x.to_category_id,p.categoryIds)&&(r++,w=!0),qi(x.from_account_id,p.accountIds)&&(s++,w=!0),qi(x.to_account_id,p.accountIds)&&(s++,w=!0),w&&l++}for(const x of y.adjustments||[]){let w=!1;Ra(x.category_id,p.categoryIds)&&(r++,w=!0),qi(x.account_id,p.accountIds)&&(s++,w=!0),w&&h++}}}return{totalBudgets:t.length,totalMonths:n,orphanedCategoryIds:r,orphanedAccountIds:s,affectedExpenses:o,affectedIncome:c,affectedTransfers:l,affectedAdjustments:h}}async function R3(){const{budgets:t,monthsByBudget:e}=await rr("orphaned-id-cleanup"),n=[];let r=0,s=0;const o=[];for(const c of t){const l=wA(c.data),h=e.get(c.id)||[];for(const f of h)try{const{needsUpdate:p,updatedMonth:g,stats:_}=A3(f,l);p&&g&&(n.push({budgetId:c.id,year:f.year,month:f.month,data:g}),r+=_.categoryIdsFixed,s+=_.accountIdsFixed)}catch(p){o.push(`Month ${f.year}/${f.month} in budget ${c.id}: ${p instanceof Error?p.message:String(p)}`)}}return n.length>0&&await Xa(n,"orphaned-id-cleanup"),{budgetsProcessed:t.length,monthsProcessed:n.length,categoryIdsFixed:r,accountIdsFixed:s,errors:o}}function I3({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[s,o]=R.useState(!1),[c,l]=R.useState(null),[h,f]=R.useState(null);async function p(){if(t){r(!0);try{const y=await j3();l(y)}catch(y){console.error("Failed to scan for orphaned IDs:",y)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const y=await Pm(()=>R3());f(y),e?.()}catch(y){f({budgetsProcessed:0,monthsProcessed:0,categoryIdsFixed:0,accountIdsFixed:0,errors:[y instanceof Error?y.message:"Unknown error"]})}finally{o(!1)}}}const _=c!==null&&(c.orphanedCategoryIds>0||c.orphanedAccountIds>0);return{status:c,isScanning:n,scanStatus:p,hasItemsToFix:_,isRunning:s,result:h,runMigration:g}}function k3(t,e){if(t.date!==e.date||Math.abs(t.amount+e.amount)>.001)return null;const n=t.amount<0?t:e,r=t.amount<0?e:t,s=lt(t.category_id)&&lt(e.category_id),o=!tt(t.account_id)&&!tt(e.account_id),c=t.account_id!==e.account_id;if(s&&o&&c)return{negative:n,positive:r,type:"account"};const l=tt(t.account_id)&&tt(e.account_id),h=!lt(t.category_id)&&!lt(e.category_id),f=t.category_id!==e.category_id;return l&&h&&f?{negative:n,positive:r,type:"category"}:null}function SA(t){const e=[],n=new Set;for(let r=0;r<t.length;r++)if(!n.has(t[r].id))for(let s=r+1;s<t.length;s++){if(n.has(t[s].id))continue;const o=k3(t[r],t[s]);if(o){e.push(o),n.add(t[r].id),n.add(t[s].id);break}}return e}function D3(t){const{negative:e,positive:n,type:r}=t;return r==="account"?{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:e.account_id,to_account_id:n.account_id,from_category_id:Zt,to_category_id:Zt,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}:{id:`transfer_from_adj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:Math.abs(e.amount),from_account_id:Ht,to_account_id:Ht,from_category_id:e.category_id,to_category_id:n.category_id,date:e.date,description:e.description||n.description||"Transfer",cleared:e.cleared&&n.cleared,created_at:new Date().toISOString()}}function M3(t){const e=t.data,n=e.adjustments||[],r=e.transfers||[],s=SA(n);if(s.length===0)return{needsUpdate:!1,updatedMonth:null,stats:{pairsConverted:0,adjustmentsRemoved:0}};const o=s.map(D3),c=new Set;for(const f of s)c.add(f.negative.id),c.add(f.positive.id);const l=n.filter(f=>!c.has(f.id));return{needsUpdate:!0,updatedMonth:{...e,adjustments:l,transfers:[...r,...o],updated_at:new Date().toISOString()},stats:{pairsConverted:s.length,adjustmentsRemoved:c.size}}}async function O3(){const{budgets:t,monthsByBudget:e}=await rr("adjustments-to-transfers-scan");let n=0,r=0,s=0,o=0;for(const c of t){const l=e.get(c.id)||[];n+=l.length;for(const h of l){const p=h.data.adjustments||[],g=SA(p);r+=g.length;for(const _ of g)_.type==="account"?s++:o++}}return{totalBudgets:t.length,totalMonths:n,pairsFound:r,accountTransferPairs:s,categoryTransferPairs:o}}async function N3(){const{budgets:t,monthsByBudget:e}=await rr("adjustments-to-transfers-migration"),n=[];let r=0,s=0;const o=[];for(const c of t){const l=e.get(c.id)||[];for(const h of l)try{const{needsUpdate:f,updatedMonth:p,stats:g}=M3(h);f&&p&&(n.push({budgetId:c.id,year:h.year,month:h.month,data:p}),r+=g.pairsConverted,s+=g.adjustmentsRemoved)}catch(f){o.push(`Month ${h.year}/${h.month} in budget ${c.id}: ${f instanceof Error?f.message:String(f)}`)}}return n.length>0&&await Xa(n,"adjustments-to-transfers-migration"),{budgetsProcessed:t.length,monthsProcessed:n.length,transfersCreated:r,adjustmentsRemoved:s,errors:o}}function B3({currentUser:t,onComplete:e}){const[n,r]=R.useState(!1),[s,o]=R.useState(!1),[c,l]=R.useState(null),[h,f]=R.useState(null);async function p(){if(t){r(!0);try{const y=await O3();l(y)}catch(y){console.error("Failed to scan for adjustment pairs:",y)}finally{r(!1)}}}async function g(){if(t){o(!0),f(null);try{const y=await Pm(()=>N3());f(y),e?.()}catch(y){f({budgetsProcessed:0,monthsProcessed:0,transfersCreated:0,adjustmentsRemoved:0,errors:[y instanceof Error?y.message:"Unknown error"]})}finally{o(!1)}}}const _=c!==null&&c.pairsFound>0;return{status:c,isScanning:n,scanStatus:p,hasPairsToConvert:_,isRunning:s,result:h,runMigration:g}}function P3(t){const e=[];let n="",r=!1;for(let s=0;s<t.length;s++){const o=t[s];o==='"'?r=!r:o===","&&!r?(e.push(n.trim()),n=""):n+=o}return e.push(n.trim()),e}function z3(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const r=parseFloat(e);return isNaN(r)?0:n?-r:r}function L3(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),r=parseInt(e[1],10),s=parseInt(e[2],10);return isNaN(n)||isNaN(r)||isNaN(s)||n<1||n>12||r<1||r>31?null:{year:s,month:n,day:r}}function U3(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function F3(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function V3(t){const e=t.split(`
`).filter(r=>r.trim()),n=[];for(const r of e){const s=P3(r);if(s.length<5)continue;const[o,c,l,h,f,p,g]=s;if(o.toLowerCase()==="cash flow"||o.toLowerCase()==="date")continue;const _=L3(o);if(!_)continue;const y=F3(c,l),x=z3(f),w=U3(g||"");n.push({recordType:y,date:o,year:_.year,month:_.month,day:_.day,payee:c,category:l,account:h,amount:x,description:p||"",cleared:w,rawLine:r})}return n}function $3(t){return!t.account_id||t.account_id.trim()===""?"Missing account_id (empty or undefined)":null}function G3(t){const e=[];return(!t.account_id||t.account_id.trim()==="")&&e.push("missing account_id"),(!t.category_id||t.category_id.trim()==="")&&e.push("missing category_id"),e.length>0?e.join(", "):null}function q3(t){const e=tt(t.account_id)||!t.account_id||t.account_id.trim()==="",n=lt(t.category_id)||!t.category_id||t.category_id.trim()==="";return e&&n?"Both account_id and category_id are missing/NO_* (must have at least one real ID)":null}function H3(t){const e=[];if((!t.from_account_id||t.from_account_id.trim()==="")&&e.push("missing from_account_id"),(!t.to_account_id||t.to_account_id.trim()==="")&&e.push("missing to_account_id"),(!t.from_category_id||t.from_category_id.trim()==="")&&e.push("missing from_category_id"),(!t.to_category_id||t.to_category_id.trim()==="")&&e.push("missing to_category_id"),e.length>0)return e.join(", ");const n=t.from_account_id===t.to_account_id,r=t.from_category_id===t.to_category_id;if(n&&r)return"Transfer has same from/to on both account and category (nothing would transfer)";const s=tt(t.from_account_id),o=tt(t.to_account_id),c=lt(t.from_category_id),l=lt(t.to_category_id);return s&&o&&c&&l?"All from/to account and category IDs are NO_* (must involve at least one real entity)":s&&o&&r?"Both accounts are NO_ACCOUNT and categories are the same (nothing transfers)":c&&l&&n?"Both categories are NO_CATEGORY and accounts are the same (nothing transfers)":null}function lf(t,e,n,r,s){return t.filter(o=>{const[c,l,h]=e.split("-").map(Number);return o.year!==c||o.month!==l||o.day!==h||Math.abs(Math.abs(o.amount)-Math.abs(n))>.01?!1:(r&&o.payee&&o.payee.toLowerCase()===r.toLowerCase()||s&&o.description&&o.description.toLowerCase().includes(s.toLowerCase()),!0)})}async function W3(t){const e=[];let n=0,r=0,s=0,o=0;const c=t?V3(t):[],{budgets:l,monthsByBudget:h}=await rr("account-category-validation");for(const f of l){const p=h.get(f.id)||[];for(const g of p){const _=g.data,y=`${_.year}-${String(_.month).padStart(2,"0")}`,x=_.income||[];n+=x.length;for(const T of x){const A=$3(T);A&&e.push({budgetId:f.id,monthKey:y,transactionType:"income",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id},potentialSeedMatches:lf(c,T.date,T.amount,T.payee,T.description)})}const w=_.expenses||[];r+=w.length;for(const T of w){const A=G3(T);A&&e.push({budgetId:f.id,monthKey:y,transactionType:"expense",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,payee:T.payee,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:lf(c,T.date,T.amount,T.payee,T.description)})}const S=_.adjustments||[];s+=S.length;for(const T of S){const A=q3(T);A&&e.push({budgetId:f.id,monthKey:y,transactionType:"adjustment",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,description:T.description,accountId:T.account_id,categoryId:T.category_id},potentialSeedMatches:lf(c,T.date,T.amount,void 0,T.description)})}const E=_.transfers||[];o+=E.length;for(const T of E){const A=H3(T);A&&e.push({budgetId:f.id,monthKey:y,transactionType:"transfer",transactionId:T.id,violation:A,transactionDetails:{date:T.date,amount:T.amount,description:T.description,fromAccountId:T.from_account_id,toAccountId:T.to_account_id,fromCategoryId:T.from_category_id,toCategoryId:T.to_category_id},potentialSeedMatches:lf(c,T.date,T.amount,void 0,T.description)})}}}return e.sort((f,p)=>{const g=f.monthKey.localeCompare(p.monthKey);return g!==0?g:f.transactionType.localeCompare(p.transactionType)}),{totalBudgets:l.length,totalMonths:Array.from(h.values()).reduce((f,p)=>f+p.length,0),totalIncome:n,totalExpenses:r,totalAdjustments:s,totalTransfers:o,violations:e,scannedAt:new Date().toISOString()}}function Q3(t){const e=[];if(e.push("=".repeat(80),"ACCOUNT/CATEGORY VALIDATION REPORT",`Scanned at: ${t.scannedAt}`,"=".repeat(80),"","SUMMARY:"),e.push(`  Budgets scanned: ${t.totalBudgets}`,`  Months scanned: ${t.totalMonths}`,`  Income transactions: ${t.totalIncome}`,`  Expense transactions: ${t.totalExpenses}`,`  Adjustment transactions: ${t.totalAdjustments}`,`  Transfer transactions: ${t.totalTransfers}`,`  VIOLATIONS FOUND: ${t.violations.length}`,""),t.violations.length===0)return e.push(" No violations found!"),e.join(`
`);const n=new Map;for(const r of t.violations)n.has(r.transactionType)||n.set(r.transactionType,[]),n.get(r.transactionType).push(r);e.push("-".repeat(80),"VIOLATIONS BY TYPE:","-".repeat(80));for(const[r,s]of n){e.push("",`## ${r.toUpperCase()} (${s.length} violations)`,"");for(const o of s){if(e.push(`  [${o.monthKey}] ID: ${o.transactionId}`,`    Violation: ${o.violation}`,`    Date: ${o.transactionDetails.date}`,`    Amount: ${o.transactionDetails.amount}`),o.transactionDetails.payee&&e.push(`    Payee: ${o.transactionDetails.payee}`),o.transactionDetails.description&&e.push(`    Description: ${o.transactionDetails.description}`),o.transactionDetails.accountId!==void 0&&e.push(`    Account ID: ${o.transactionDetails.accountId||"(empty)"}`),o.transactionDetails.categoryId!==void 0&&e.push(`    Category ID: ${o.transactionDetails.categoryId||"(empty)"}`),o.transactionDetails.fromAccountId!==void 0&&e.push(`    From Account: ${o.transactionDetails.fromAccountId||"(empty)"}`,`    To Account: ${o.transactionDetails.toAccountId||"(empty)"}`,`    From Category: ${o.transactionDetails.fromCategoryId||"(empty)"}`,`    To Category: ${o.transactionDetails.toCategoryId||"(empty)"}`),o.potentialSeedMatches.length>0){e.push(`    POTENTIAL SEED MATCHES (${o.potentialSeedMatches.length}):`);for(const c of o.potentialSeedMatches.slice(0,5))e.push(`      - Line: ${c.rawLine}`,`        Type: ${c.recordType}, Date: ${c.date}, Payee: ${c.payee}`,`        Category: ${c.category}, Account: ${c.account}`);o.potentialSeedMatches.length>5&&e.push(`      ... and ${o.potentialSeedMatches.length-5} more matches`)}else e.push("    No seed matches found");e.push("")}}return e.join(`
`)}function K3({currentUser:t}){const[e,n]=R.useState(!1),[r,s]=R.useState(null),[o,c]=R.useState(null);async function l(h){if(t){n(!0),s(null),c(null);try{const f=await W3(h);s(f),c(Q3(f))}catch(f){console.error("Failed to scan transactions:",f),c(`Error scanning: ${f instanceof Error?f.message:"Unknown error"}`)}finally{n(!1)}}}return{isScanning:e,status:r,report:o,scan:l,hasViolations:r!==null&&r.violations.length>0,violationCount:r?.violations.length??0}}async function Y3(){const{budgets:t,monthsByBudget:e}=await rr("remove-total-fields-migration-scan");let n=0,r=0,s=0;for(const c of t){const l=e.get(c.id)||[];for(const h of l){const f=h.data,p="total_income"in f&&f.total_income!==void 0,g="total_expenses"in f&&f.total_expenses!==void 0;p&&r++,g&&s++,(p||g)&&n++}}const o=e.size>0?Array.from(e.values()).reduce((c,l)=>c+l.length,0):0;return{totalBudgets:t.length,totalMonths:o,monthsNeedingMigration:n,monthsWithTotalIncome:r,monthsWithTotalExpenses:s}}async function X3(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await rr("remove-total-fields-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const s=[];t.setStage("Processing months...");let o=0;for(const l of r.values())o+=l.length;let c=0;for(const l of n)try{const h=r.get(l.id)||[];for(const f of h){c++;const p=f.data;t.updateItemProgress(c,o,`Month ${p.year}/${p.month}`);const g="total_income"in p&&p.total_income!==void 0,_="total_expenses"in p&&p.total_expenses!==void 0;if(g||_){const{total_income:y,total_expenses:x,...w}=p;s.push({budgetId:l.id,year:p.year,month:p.month,data:{...w,updated_at:new Date().toISOString()}}),e.monthsUpdated++}e.monthsProcessed++}h.length>0&&e.budgetsProcessed++}catch(h){e.errors.push(`Budget ${l.id}: ${h instanceof Error?h.message:String(h)}`)}return s.length>0&&(t.setStage(`Writing ${s.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${s.length} month(s) to update`),await Xa(s,"remove-total-fields-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function Z3({currentUser:t}){const[e,n]=R.useState(!1),[r,s]=R.useState(!1),[o,c]=R.useState(null),[l,h]=R.useState(null),{runMigrationWithProgress:f}=Jo();async function p(){if(t){n(!0);try{const x=await Y3();c(x)}catch(x){console.error("Failed to scan remove total fields status:",x)}finally{n(!1)}}}async function g(){if(t){s(!0),h(null);try{const x=await f("Remove Total Fields Migration",w=>X3(w));h(x)}catch(x){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{s(!1)}}}const _=o!==null&&o.monthsNeedingMigration>0,y=o?.monthsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:l,scanStatus:p,runMigration:g,needsMigration:_,totalItemsToFix:y}}async function J3(){const{budgets:t,monthsByBudget:e}=await rr("remove-previous-month-income-migration-scan");let n=0;for(const s of t){const o=e.get(s.id)||[];for(const c of o){const l=c.data;"previous_month_income"in l&&l.previous_month_income!==void 0&&n++}}const r=e.size>0?Array.from(e.values()).reduce((s,o)=>s+o.length,0):0;return{totalBudgets:t.length,totalMonths:r,monthsNeedingMigration:n}}async function e4(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]},{budgets:n,monthsByBudget:r}=await rr("remove-previous-month-income-migration");t.setStage(`Processing ${n.length} budget(s)...`),t.setProgress(0);const s=[];for(let o=0;o<n.length;o++){const c=n[o];t.setProgress(o/n.length*100),t.setCurrentItem(`Budget ${o+1}/${n.length}: ${c.id}`);try{const l=r.get(c.id)||[];for(const h of l){const f=h.data;if("previous_month_income"in f&&f.previous_month_income!==void 0){const{previous_month_income:g,..._}=f;s.push({budgetId:c.id,year:f.year,month:f.month,data:{..._,updated_at:new Date().toISOString()}}),e.monthsUpdated++}e.monthsProcessed++}l.length>0&&e.budgetsProcessed++}catch(l){e.errors.push(`Budget ${c.id}: ${l instanceof Error?l.message:String(l)}`)}}return s.length>0&&(t.setStage(`Writing ${s.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${s.length} month(s) to update`),await Xa(s,"remove-previous-month-income-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function t4({currentUser:t}){const[e,n]=R.useState(!1),[r,s]=R.useState(!1),[o,c]=R.useState(null),[l,h]=R.useState(null),{runMigrationWithProgress:f}=Jo();async function p(){if(t){n(!0);try{const x=await J3();c(x)}catch(x){console.error("Failed to scan remove previous month income status:",x)}finally{n(!1)}}}async function g(){if(t){s(!0),h(null);try{const x=await f("Remove Previous Month Income Migration",w=>e4(w));h(x)}catch(x){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{s(!1)}}}const _=o!==null&&o.monthsNeedingMigration>0,y=o?.monthsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:l,scanStatus:p,runMigration:g,needsMigration:_,totalItemsToFix:y}}async function n4(){const t=await jd("percentage-income-months-back-migration-scan");let e=0;for(const n of t)n.data.percentage_income_months_back===void 0&&e++;return{totalBudgets:t.length,budgetsNeedingMigration:e}}async function r4(t){const e={budgetsProcessed:0,budgetsUpdated:0,errors:[]};t.setStage("Reading all budgets..."),t.setProgress(null);const n=await jd("percentage-income-months-back-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const r=[];for(let s=0;s<n.length;s++){const o=n[s];t.updateItemProgress(s+1,n.length,`Budget: ${o.data.name??o.id}`);try{const c=o.data;c.percentage_income_months_back===void 0&&(r.push({budgetId:o.id,data:{...c,percentage_income_months_back:1}}),e.budgetsProcessed++)}catch(c){e.errors.push(`Budget ${o.id}: ${c instanceof Error?c.message:String(c)}`)}}return r.length>0&&(t.setStage("Writing budget updates..."),t.setProgress(null),t.setCurrentItem(`${r.length} budget(s) to update`),await zm(r,"percentage-income-months-back-migration"),e.budgetsUpdated=r.length),t.setStage("Migration complete"),t.setProgress(100),e}function i4({currentUser:t}){const[e,n]=R.useState(!1),[r,s]=R.useState(!1),[o,c]=R.useState(null),[l,h]=R.useState(null),{runMigrationWithProgress:f}=Jo();async function p(){if(t){n(!0);try{const x=await n4();c(x)}catch(x){console.error("Failed to scan percentage income months back status:",x)}finally{n(!1)}}}async function g(){if(t){s(!0),h(null);try{const x=await f("Percentage Income Months Back",w=>r4(w));h(x)}catch(x){h({budgetsProcessed:0,budgetsUpdated:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{s(!1)}}}const _=o!==null&&o.budgetsNeedingMigration>0,y=o?.budgetsNeedingMigration??0;return{isScanning:e,isRunning:r,status:o,result:l,scanStatus:p,runMigration:g,needsMigration:_,totalItemsToFix:y}}async function s4(){const{budgets:t,monthsByBudget:e}=await rr("recalculate-start-balances-migration-scan"),n=Mm(),r=Fe(n.year,n.month);let s=0;for(const c of t){const h=(e.get(c.id)||[]).filter(f=>{const p=f.data;return Fe(p.year,p.month)<=r});s+=h.length}const o=e.size>0?Array.from(e.values()).reduce((c,l)=>c+l.length,0):0;return{totalBudgets:t.length,totalMonths:o,monthsNeedingRecalculation:s}}async function a4(t){const e={budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await rr("recalculate-start-balances-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const s=Mm(),o=Fe(s.year,s.month),c=[];t.setStage("Processing months...");let l=0;for(const f of n){const g=(r.get(f.id)||[]).filter(_=>{const y=_.data;return Fe(y.year,y.month)<=o});l+=g.length}let h=0;for(const f of n)try{const g=(r.get(f.id)||[]).filter(y=>{const x=y.data;return Fe(x.year,x.month)<=o}).sort((y,x)=>{const w=y.data,S=x.data,E=Fe(w.year,w.month),T=Fe(S.year,S.month);return E.localeCompare(T)});if(g.length===0){e.budgetsProcessed++;continue}let _=Bo;for(const y of g){h++;const x=y.data,w=x.year,S=x.month;t.updateItemProgress(h,l,`Budget ${f.id}: ${w}/${S}`);const E={budget_id:f.id,year_month_ordinal:x.year_month_ordinal,year:w,month:S,income:x.income||[],total_income:0,previous_month_income:0,expenses:x.expenses||[],total_expenses:0,transfers:x.transfers||[],adjustments:x.adjustments||[],account_balances:x.account_balances||[],category_balances:x.category_balances||[],are_allocations_finalized:x.are_allocations_finalized??!1,created_at:x.created_at,updated_at:x.updated_at},T=Tl(E),A=Ad(T,_);_=ul(A);const M=Om(A);c.push({budgetId:f.id,year:w,month:S,data:M}),e.monthsUpdated++,e.monthsProcessed++}e.budgetsProcessed++}catch(p){e.errors.push(`Budget ${f.id}: ${p instanceof Error?p.message:String(p)}`)}return c.length>0&&(t.setStage(`Writing ${c.length} month update(s)...`),t.setProgress(null),t.setCurrentItem(`${c.length} month(s) to update`),await Xa(c,"recalculate-start-balances-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function o4({currentUser:t}){const[e,n]=R.useState(!1),[r,s]=R.useState(!1),[o,c]=R.useState(null),[l,h]=R.useState(null),{runMigrationWithProgress:f}=Jo();async function p(){if(t){n(!0);try{const x=await s4();c(x)}catch(x){console.error("Failed to scan recalculate start balances status:",x)}finally{n(!1)}}}async function g(){if(t){s(!0),h(null);try{const x=await f("Recalculate Start Balances Migration",w=>a4(w));h(x)}catch(x){h({budgetsProcessed:0,monthsProcessed:0,monthsUpdated:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{s(!1)}}}const _=o!==null&&o.monthsNeedingRecalculation>0,y=o?.monthsNeedingRecalculation??0;return{isScanning:e,isRunning:r,status:o,result:l,scanStatus:p,runMigration:g,needsMigration:_,totalItemsToFix:y}}async function c4(){const{budgets:t,monthsByBudget:e}=await rr("repair-month-map-migration-scan");let n=0,r=0,s=0;for(const c of t){const l=e.get(c.id)||[],f=c.data.month_map||{},p=new Set;for(const y of l){const x=Fe(y.year,y.month);p.add(x)}let g=0;for(const y of p)y in f||g++;let _=0;for(const y of Object.keys(f))p.has(y)||_++;(g>0||_>0)&&(n++,r+=g,s+=_)}const o=e.size>0?Array.from(e.values()).reduce((c,l)=>c+l.length,0):0;return{totalBudgets:t.length,totalMonths:o,budgetsNeedingRepair:n,totalMissingMonths:r,totalOrphanedEntries:s}}async function l4(t){const e={budgetsProcessed:0,budgetsUpdated:0,monthsAdded:0,orphanedEntriesRemoved:0,errors:[]};t.setStage("Reading all budgets and months..."),t.setProgress(null);const{budgets:n,monthsByBudget:r}=await rr("repair-month-map-migration");t.setDetails(`Found ${n.length} budget(s) to process`);const s=[];t.setStage("Processing budgets...");let o=0;for(const c of n)try{o++;const l=r.get(c.id)||[],f=c.data.month_map||{};t.updateItemProgress(o,n.length,`Budget ${c.id}`);const p=new Set;for(const x of l){const w=Fe(x.year,x.month);p.add(w)}const g={...f};let _=0,y=0;for(const x of p)x in g||(g[x]={},_++);for(const x of Object.keys(g))p.has(x)||(delete g[x],y++);(_>0||y>0)&&(s.push({budgetId:c.id,data:{...c.data,month_map:g,updated_at:new Date().toISOString()}}),e.monthsAdded+=_,e.orphanedEntriesRemoved+=y,e.budgetsUpdated++),e.budgetsProcessed++}catch(l){e.errors.push(`Budget ${c.id}: ${l instanceof Error?l.message:String(l)}`)}return s.length>0&&(t.setStage(`Writing ${s.length} budget update(s)...`),t.setProgress(null),t.setCurrentItem(`${s.length} budget(s) to update`),await zm(s,"repair-month-map-migration")),t.setStage("Migration complete"),t.setProgress(100),e}function u4({currentUser:t}){const[e,n]=R.useState(!1),[r,s]=R.useState(!1),[o,c]=R.useState(null),[l,h]=R.useState(null),{runMigrationWithProgress:f}=Jo();async function p(){if(t){n(!0);try{const x=await c4();c(x)}catch(x){console.error("Failed to scan repair month map status:",x)}finally{n(!1)}}}async function g(){if(t){s(!0),h(null);try{const x=await f("Repair Month Map Migration",w=>l4(w));h(x)}catch(x){h({budgetsProcessed:0,budgetsUpdated:0,monthsAdded:0,orphanedEntriesRemoved:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{s(!1)}}}const _=o!==null&&(o.totalMissingMonths>0||o.totalOrphanedEntries>0),y=o?o.totalMissingMonths+o.totalOrphanedEntries:0;return{isScanning:e,isRunning:r,status:o,result:l,scanStatus:p,runMigration:g,needsMigration:_,totalItemsToFix:y}}function CA(t){return"category_balances_cache"in t||"category_balances_snapshot"in t}async function d4(){const t=await jd("remove-legacy-balance-fields-scan");let e=0;for(const n of t)CA(n.data)&&e++;return{totalBudgets:t.length,budgetsWithLegacyFields:e}}async function h4(t){const e={budgetsProcessed:0,budgetsUpdated:0,errors:[]};t.setStage("Reading all budgets..."),t.setProgress(null);const n=await jd("remove-legacy-balance-fields-migration");t.setDetails(`Found ${n.length} budget(s) to process`),t.setStage("Processing budgets...");for(let r=0;r<n.length;r++){const s=n[r];t.updateItemProgress(r+1,n.length,`Budget: ${s.id.slice(0,20)}`);try{const o=s.data;if(!CA(o)){e.budgetsProcessed++;continue}const c={category_balances_cache:ed(),category_balances_snapshot:ed(),updated_at:new Date().toISOString()};await ts("budgets",s.id,Jr(c),"remove-legacy-balance-fields-migration"),e.budgetsUpdated++,e.budgetsProcessed++}catch(o){e.errors.push(`Budget ${s.id}: ${o instanceof Error?o.message:String(o)}`),e.budgetsProcessed++}}return t.setStage("Migration complete"),t.setProgress(100),e}function f4({currentUser:t}){const[e,n]=R.useState(!1),[r,s]=R.useState(!1),[o,c]=R.useState(null),[l,h]=R.useState(null),{runMigrationWithProgress:f}=Jo();async function p(){if(t){n(!0);try{const x=await d4();c(x)}catch(x){console.error("Failed to scan legacy balance fields status:",x)}finally{n(!1)}}}async function g(){if(t){s(!0),h(null);try{const x=await f("Remove Legacy Balance Fields Migration",w=>h4(w));h(x)}catch(x){h({budgetsProcessed:0,budgetsUpdated:0,errors:[x instanceof Error?x.message:"Unknown error"]})}finally{s(!1)}}}const _=o!==null&&o.budgetsWithLegacyFields>0,y=o?.budgetsWithLegacyFields??0;return{isScanning:e,isRunning:r,status:o,result:l,scanStatus:p,runMigration:g,needsMigration:_,totalItemsToFix:y}}function m4(){const[t,e]=R.useState(!1),[n,r]=R.useState(null),[s,o]=R.useState(null);async function c(f){if(!f.trim())return o("Budget ID is required"),null;e(!0),o(null),r(null);try{const p=[],g=[];console.log(`[BudgetInspector] Reading budget: ${f}`);const{exists:_,data:y}=await vt("budgets",f,"budget-inspector: reading budget");if(!_||!y){const N={budgetId:f,exists:!1,rawData:null,analysis:{hasName:!1,hasAccounts:!1,hasCategories:!1,hasCategoryGroups:!1,hasAccountGroups:!1,hasMonthMap:!1,monthMapKeys:[],accountCount:0,categoryCount:0,categoryGroupCount:0,accountGroupCount:0,ownerUserId:null,sharedWith:[],totalAvailable:null,createdAt:null,updatedAt:null},monthDocuments:[],payeesDocument:null,issues:["Budget document does not exist in Firestore"],recommendations:["Delete this budget from user documents or restore from backup"]};return r(N),N}const x=y.accounts,w=y.categories,S=y.category_groups,E=y.account_groups,T=y.month_map,A=typeof y.name=="string"&&y.name.length>0,M=!!x&&Object.keys(x).length>0,L=!!w&&Object.keys(w).length>0,H=!!S&&Object.keys(S).length>0,O=!!E&&Object.keys(E).length>0,j=!!T&&Object.keys(T).length>0;A||p.push("Budget has no name"),M||p.push("Budget has no accounts defined"),L||p.push("Budget has no categories defined"),j||p.push("Budget has no month_map - cannot navigate to any months");const B=[],V=j?Object.keys(T).sort():[];for(const N of V){const D=parseInt(N.slice(0,4),10),X=parseInt(N.slice(4,6),10),K=`${f}_${D}_${X}`;try{const{exists:q,data:te}=await vt("months",K,`budget-inspector: reading month ${D}/${X}`);if(q&&te){const Q=te.income,ae=te.expenses,P=te.transfers,G=te.adjustments;B.push({monthId:K,exists:!0,year:D,month:X,hasIncome:!!Q&&Q.length>0,hasExpenses:!!ae&&ae.length>0,hasTransfers:!!P&&P.length>0,hasAdjustments:!!G&&G.length>0,incomeCount:Q?.length??0,expenseCount:ae?.length??0,transferCount:P?.length??0,adjustmentCount:G?.length??0,areAllocationsFinalized:te.are_allocations_finalized===!0})}else B.push({monthId:K,exists:!1,year:D,month:X,hasIncome:!1,hasExpenses:!1,hasTransfers:!1,hasAdjustments:!1,incomeCount:0,expenseCount:0,transferCount:0,adjustmentCount:0,areAllocationsFinalized:!1}),p.push(`Month ${D}/${X} is in month_map but document does not exist`)}catch(q){p.push(`Failed to read month ${D}/${X}: ${q instanceof Error?q.message:"Unknown error"}`)}}let $=null;try{const{exists:N,data:D}=await vt("payees",f,"budget-inspector: reading payees");N&&D?$={exists:!0,payeeCount:D.payees?.length??0}:$={exists:!1,payeeCount:0}}catch{$={exists:!1,payeeCount:0}}j||(g.push('Run "Repair Month Map" migration to rebuild month_map from existing month documents'),g.push("Or delete this budget and re-upload from backup")),B.some(N=>!N.exists)&&g.push("Some months in month_map do not have corresponding documents - consider running recalculation"),(!M||!L)&&g.push("Budget is missing essential data - consider restoring from backup or deleting");const k={budgetId:f,exists:!0,rawData:y,analysis:{hasName:A,hasAccounts:M,hasCategories:L,hasCategoryGroups:H,hasAccountGroups:O,hasMonthMap:j,monthMapKeys:V,accountCount:x?Object.keys(x).length:0,categoryCount:w?Object.keys(w).length:0,categoryGroupCount:S?Object.keys(S).length:0,accountGroupCount:E?Object.keys(E).length:0,ownerUserId:y.owner_user_id,sharedWith:y.shared_with??[],totalAvailable:y.total_available??null,createdAt:y.created_at??null,updatedAt:y.updated_at??null},monthDocuments:B,payeesDocument:$,issues:p,recommendations:g};return console.log("[BudgetInspector] Complete:",k),r(k),k}catch(p){const g=p instanceof Error?p.message:"Unknown error";return o(g),console.error("[BudgetInspector] Error:",g),null}finally{e(!1)}}function l(){if(!n)return;const f=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),p=URL.createObjectURL(f),g=document.createElement("a");g.href=p,g.download=`budget-inspection-${n.budgetId}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(p)}function h(){r(null),o(null)}return{isInspecting:t,result:n,error:s,inspectBudget:c,downloadResult:l,clearResult:h}}function uf(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ly={exports:{}};var l1;function g4(){return l1||(l1=1,(function(t,e){(function(n){t.exports=n()})(function(){return(function n(r,s,o){function c(f,p){if(!s[f]){if(!r[f]){var g=typeof uf=="function"&&uf;if(!p&&g)return g(f,!0);if(l)return l(f,!0);var _=new Error("Cannot find module '"+f+"'");throw _.code="MODULE_NOT_FOUND",_}var y=s[f]={exports:{}};r[f][0].call(y.exports,function(x){var w=r[f][1][x];return c(w||x)},y,y.exports,n,r,s,o)}return s[f].exports}for(var l=typeof uf=="function"&&uf,h=0;h<o.length;h++)c(o[h]);return c})({1:[function(n,r,s){var o=n("./utils"),c=n("./support"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(h){for(var f,p,g,_,y,x,w,S=[],E=0,T=h.length,A=T,M=o.getTypeOf(h)!=="string";E<h.length;)A=T-E,g=M?(f=h[E++],p=E<T?h[E++]:0,E<T?h[E++]:0):(f=h.charCodeAt(E++),p=E<T?h.charCodeAt(E++):0,E<T?h.charCodeAt(E++):0),_=f>>2,y=(3&f)<<4|p>>4,x=1<A?(15&p)<<2|g>>6:64,w=2<A?63&g:64,S.push(l.charAt(_)+l.charAt(y)+l.charAt(x)+l.charAt(w));return S.join("")},s.decode=function(h){var f,p,g,_,y,x,w=0,S=0,E="data:";if(h.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var T,A=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===l.charAt(64)&&A--,h.charAt(h.length-2)===l.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=c.uint8array?new Uint8Array(0|A):new Array(0|A);w<h.length;)f=l.indexOf(h.charAt(w++))<<2|(_=l.indexOf(h.charAt(w++)))>>4,p=(15&_)<<4|(y=l.indexOf(h.charAt(w++)))>>2,g=(3&y)<<6|(x=l.indexOf(h.charAt(w++))),T[S++]=f,y!==64&&(T[S++]=p),x!==64&&(T[S++]=g);return T}},{"./support":30,"./utils":32}],2:[function(n,r,s){var o=n("./external"),c=n("./stream/DataWorker"),l=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function f(p,g,_,y,x){this.compressedSize=p,this.uncompressedSize=g,this.crc32=_,this.compression=y,this.compressedContent=x}f.prototype={getContentWorker:function(){var p=new c(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new c(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},f.createWorkerFrom=function(p,g,_){return p.pipe(new l).pipe(new h("uncompressedSize")).pipe(g.compressWorker(_)).pipe(new h("compressedSize")).withStreamInfo("compression",g)},r.exports=f},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,s){var o=n("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},s.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,s){var o=n("./utils"),c=(function(){for(var l,h=[],f=0;f<256;f++){l=f;for(var p=0;p<8;p++)l=1&l?3988292384^l>>>1:l>>>1;h[f]=l}return h})();r.exports=function(l,h){return l!==void 0&&l.length?o.getTypeOf(l)!=="string"?(function(f,p,g,_){var y=c,x=_+g;f^=-1;for(var w=_;w<x;w++)f=f>>>8^y[255&(f^p[w])];return-1^f})(0|h,l,l.length,0):(function(f,p,g,_){var y=c,x=_+g;f^=-1;for(var w=_;w<x;w++)f=f>>>8^y[255&(f^p.charCodeAt(w))];return-1^f})(0|h,l,l.length,0):0}},{"./utils":32}],5:[function(n,r,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(n,r,s){var o=null;o=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:o}},{lie:37}],7:[function(n,r,s){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",c=n("pako"),l=n("./utils"),h=n("./stream/GenericWorker"),f=o?"uint8array":"array";function p(g,_){h.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=_,this.meta={}}s.magic="\b\0",l.inherits(p,h),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(l.transformTo(f,g.data),!1)},p.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new c[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(_){g.push({data:_,meta:g.meta})}},s.compressWorker=function(g){return new p("Deflate",g)},s.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,s){function o(y,x){var w,S="";for(w=0;w<x;w++)S+=String.fromCharCode(255&y),y>>>=8;return S}function c(y,x,w,S,E,T){var A,M,L=y.file,H=y.compression,O=T!==f.utf8encode,j=l.transformTo("string",T(L.name)),B=l.transformTo("string",f.utf8encode(L.name)),V=L.comment,$=l.transformTo("string",T(V)),k=l.transformTo("string",f.utf8encode(V)),N=B.length!==L.name.length,D=k.length!==V.length,X="",K="",q="",te=L.dir,Q=L.date,ae={crc32:0,compressedSize:0,uncompressedSize:0};x&&!w||(ae.crc32=y.crc32,ae.compressedSize=y.compressedSize,ae.uncompressedSize=y.uncompressedSize);var P=0;x&&(P|=8),O||!N&&!D||(P|=2048);var G=0,ee=0;te&&(G|=16),E==="UNIX"?(ee=798,G|=(function(se,ge){var Ce=se;return se||(Ce=ge?16893:33204),(65535&Ce)<<16})(L.unixPermissions,te)):(ee=20,G|=(function(se){return 63&(se||0)})(L.dosPermissions)),A=Q.getUTCHours(),A<<=6,A|=Q.getUTCMinutes(),A<<=5,A|=Q.getUTCSeconds()/2,M=Q.getUTCFullYear()-1980,M<<=4,M|=Q.getUTCMonth()+1,M<<=5,M|=Q.getUTCDate(),N&&(K=o(1,1)+o(p(j),4)+B,X+="up"+o(K.length,2)+K),D&&(q=o(1,1)+o(p($),4)+k,X+="uc"+o(q.length,2)+q);var re="";return re+=`
\0`,re+=o(P,2),re+=H.magic,re+=o(A,2),re+=o(M,2),re+=o(ae.crc32,4),re+=o(ae.compressedSize,4),re+=o(ae.uncompressedSize,4),re+=o(j.length,2),re+=o(X.length,2),{fileRecord:g.LOCAL_FILE_HEADER+re+j+X,dirRecord:g.CENTRAL_FILE_HEADER+o(ee,2)+re+o($.length,2)+"\0\0\0\0"+o(G,4)+o(S,4)+j+X+$}}var l=n("../utils"),h=n("../stream/GenericWorker"),f=n("../utf8"),p=n("../crc32"),g=n("../signature");function _(y,x,w,S){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=x,this.zipPlatform=w,this.encodeFileName=S,this.streamFiles=y,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}l.inherits(_,h),_.prototype.push=function(y){var x=y.meta.percent||0,w=this.entriesCount,S=this._sources.length;this.accumulate?this.contentBuffer.push(y):(this.bytesWritten+=y.data.length,h.prototype.push.call(this,{data:y.data,meta:{currentFile:this.currentFile,percent:w?(x+100*(w-S-1))/w:100}}))},_.prototype.openedSource=function(y){this.currentSourceOffset=this.bytesWritten,this.currentFile=y.file.name;var x=this.streamFiles&&!y.file.dir;if(x){var w=c(y,x,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:w.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(y){this.accumulate=!1;var x=this.streamFiles&&!y.file.dir,w=c(y,x,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(w.dirRecord),x)this.push({data:(function(S){return g.DATA_DESCRIPTOR+o(S.crc32,4)+o(S.compressedSize,4)+o(S.uncompressedSize,4)})(y),meta:{percent:100}});else for(this.push({data:w.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var y=this.bytesWritten,x=0;x<this.dirRecords.length;x++)this.push({data:this.dirRecords[x],meta:{percent:100}});var w=this.bytesWritten-y,S=(function(E,T,A,M,L){var H=l.transformTo("string",L(M));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(E,2)+o(E,2)+o(T,4)+o(A,4)+o(H.length,2)+H})(this.dirRecords.length,w,y,this.zipComment,this.encodeFileName);this.push({data:S,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(y){this._sources.push(y);var x=this;return y.on("data",function(w){x.processChunk(w)}),y.on("end",function(){x.closedSource(x.previous.streamInfo),x._sources.length?x.prepareNextSource():x.end()}),y.on("error",function(w){x.error(w)}),this},_.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(y){var x=this._sources;if(!h.prototype.error.call(this,y))return!1;for(var w=0;w<x.length;w++)try{x[w].error(y)}catch{}return!0},_.prototype.lock=function(){h.prototype.lock.call(this);for(var y=this._sources,x=0;x<y.length;x++)y[x].lock()},r.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,s){var o=n("../compressions"),c=n("./ZipFileWorker");s.generateWorker=function(l,h,f){var p=new c(h.streamFiles,f,h.platform,h.encodeFileName),g=0;try{l.forEach(function(_,y){g++;var x=(function(T,A){var M=T||A,L=o[M];if(!L)throw new Error(M+" is not a valid compression method !");return L})(y.options.compression,h.compression),w=y.options.compressionOptions||h.compressionOptions||{},S=y.dir,E=y.date;y._compressWorker(x,w).withStreamInfo("file",{name:_,dir:S,date:E,comment:y.comment||"",unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(_){p.error(_)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,s){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var c=new o;for(var l in this)typeof this[l]!="function"&&(c[l]=this[l]);return c}}(o.prototype=n("./object")).loadAsync=n("./load"),o.support=n("./support"),o.defaults=n("./defaults"),o.version="3.10.1",o.loadAsync=function(c,l){return new o().loadAsync(c,l)},o.external=n("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,s){var o=n("./utils"),c=n("./external"),l=n("./utf8"),h=n("./zipEntries"),f=n("./stream/Crc32Probe"),p=n("./nodejsUtils");function g(_){return new c.Promise(function(y,x){var w=_.decompressed.getContentWorker().pipe(new f);w.on("error",function(S){x(S)}).on("end",function(){w.streamInfo.crc32!==_.decompressed.crc32?x(new Error("Corrupted zip : CRC32 mismatch")):y()}).resume()})}r.exports=function(_,y){var x=this;return y=o.extend(y||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:l.utf8decode}),p.isNode&&p.isStream(_)?c.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",_,!0,y.optimizedBinaryString,y.base64).then(function(w){var S=new h(y);return S.load(w),S}).then(function(w){var S=[c.Promise.resolve(w)],E=w.files;if(y.checkCRC32)for(var T=0;T<E.length;T++)S.push(g(E[T]));return c.Promise.all(S)}).then(function(w){for(var S=w.shift(),E=S.files,T=0;T<E.length;T++){var A=E[T],M=A.fileNameStr,L=o.resolve(A.fileNameStr);x.file(L,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:y.createFolders}),A.dir||(x.file(L).unsafeOriginalName=M)}return S.zipComment.length&&(x.comment=S.zipComment),x})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,s){var o=n("../utils"),c=n("../stream/GenericWorker");function l(h,f){c.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(f)}o.inherits(l,c),l.prototype._bindStream=function(h){var f=this;(this._stream=h).pause(),h.on("data",function(p){f.push({data:p,meta:{percent:0}})}).on("error",function(p){f.isPaused?this.generatedError=p:f.error(p)}).on("end",function(){f.isPaused?f._upstreamEnded=!0:f.end()})},l.prototype.pause=function(){return!!c.prototype.pause.call(this)&&(this._stream.pause(),!0)},l.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=l},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,s){var o=n("readable-stream").Readable;function c(l,h,f){o.call(this,h),this._helper=l;var p=this;l.on("data",function(g,_){p.push(g)||p._helper.pause(),f&&f(_)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}n("../utils").inherits(c,o),c.prototype._read=function(){this._helper.resume()},r.exports=c},{"../utils":32,"readable-stream":16}],14:[function(n,r,s){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,c){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,c);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,c)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var c=new Buffer(o);return c.fill(0),c},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(n,r,s){function o(L,H,O){var j,B=l.getTypeOf(H),V=l.extend(O||{},p);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(L=E(L)),V.createFolders&&(j=S(L))&&T.call(this,j,!0);var $=B==="string"&&V.binary===!1&&V.base64===!1;O&&O.binary!==void 0||(V.binary=!$),(H instanceof g&&H.uncompressedSize===0||V.dir||!H||H.length===0)&&(V.base64=!1,V.binary=!0,H="",V.compression="STORE",B="string");var k=null;k=H instanceof g||H instanceof h?H:x.isNode&&x.isStream(H)?new w(L,H):l.prepareContent(L,H,V.binary,V.optimizedBinaryString,V.base64);var N=new _(L,k,V);this.files[L]=N}var c=n("./utf8"),l=n("./utils"),h=n("./stream/GenericWorker"),f=n("./stream/StreamHelper"),p=n("./defaults"),g=n("./compressedObject"),_=n("./zipObject"),y=n("./generate"),x=n("./nodejsUtils"),w=n("./nodejs/NodejsStreamInputAdapter"),S=function(L){L.slice(-1)==="/"&&(L=L.substring(0,L.length-1));var H=L.lastIndexOf("/");return 0<H?L.substring(0,H):""},E=function(L){return L.slice(-1)!=="/"&&(L+="/"),L},T=function(L,H){return H=H!==void 0?H:p.createFolders,L=E(L),this.files[L]||o.call(this,L,null,{dir:!0,createFolders:H}),this.files[L]};function A(L){return Object.prototype.toString.call(L)==="[object RegExp]"}var M={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(L){var H,O,j;for(H in this.files)j=this.files[H],(O=H.slice(this.root.length,H.length))&&H.slice(0,this.root.length)===this.root&&L(O,j)},filter:function(L){var H=[];return this.forEach(function(O,j){L(O,j)&&H.push(j)}),H},file:function(L,H,O){if(arguments.length!==1)return L=this.root+L,o.call(this,L,H,O),this;if(A(L)){var j=L;return this.filter(function(V,$){return!$.dir&&j.test(V)})}var B=this.files[this.root+L];return B&&!B.dir?B:null},folder:function(L){if(!L)return this;if(A(L))return this.filter(function(B,V){return V.dir&&L.test(B)});var H=this.root+L,O=T.call(this,H),j=this.clone();return j.root=O.name,j},remove:function(L){L=this.root+L;var H=this.files[L];if(H||(L.slice(-1)!=="/"&&(L+="/"),H=this.files[L]),H&&!H.dir)delete this.files[L];else for(var O=this.filter(function(B,V){return V.name.slice(0,L.length)===L}),j=0;j<O.length;j++)delete this.files[O[j].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(L){var H,O={};try{if((O=l.extend(L||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:c.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");l.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var j=O.comment||this.comment||"";H=y.generateWorker(this,O,j)}catch(B){(H=new h("error")).error(B)}return new f(H,O.type||"string",O.mimeType)},generateAsync:function(L,H){return this.generateInternalStream(L).accumulate(H)},generateNodeStream:function(L,H){return(L=L||{}).type||(L.type="nodebuffer"),this.generateInternalStream(L).toNodejsStream(H)}};r.exports=M},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,s){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,s){var o=n("./DataReader");function c(l){o.call(this,l);for(var h=0;h<this.data.length;h++)l[h]=255&l[h]}n("../utils").inherits(c,o),c.prototype.byteAt=function(l){return this.data[this.zero+l]},c.prototype.lastIndexOfSignature=function(l){for(var h=l.charCodeAt(0),f=l.charCodeAt(1),p=l.charCodeAt(2),g=l.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===h&&this.data[_+1]===f&&this.data[_+2]===p&&this.data[_+3]===g)return _-this.zero;return-1},c.prototype.readAndCheckSignature=function(l){var h=l.charCodeAt(0),f=l.charCodeAt(1),p=l.charCodeAt(2),g=l.charCodeAt(3),_=this.readData(4);return h===_[0]&&f===_[1]&&p===_[2]&&g===_[3]},c.prototype.readData=function(l){if(this.checkOffset(l),l===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,h},r.exports=c},{"../utils":32,"./DataReader":18}],18:[function(n,r,s){var o=n("../utils");function c(l){this.data=l,this.length=l.length,this.index=0,this.zero=0}c.prototype={checkOffset:function(l){this.checkIndex(this.index+l)},checkIndex:function(l){if(this.length<this.zero+l||l<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+l+"). Corrupted zip ?")},setIndex:function(l){this.checkIndex(l),this.index=l},skip:function(l){this.setIndex(this.index+l)},byteAt:function(){},readInt:function(l){var h,f=0;for(this.checkOffset(l),h=this.index+l-1;h>=this.index;h--)f=(f<<8)+this.byteAt(h);return this.index+=l,f},readString:function(l){return o.transformTo("string",this.readData(l))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var l=this.readInt(4);return new Date(Date.UTC(1980+(l>>25&127),(l>>21&15)-1,l>>16&31,l>>11&31,l>>5&63,(31&l)<<1))}},r.exports=c},{"../utils":32}],19:[function(n,r,s){var o=n("./Uint8ArrayReader");function c(l){o.call(this,l)}n("../utils").inherits(c,o),c.prototype.readData=function(l){this.checkOffset(l);var h=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,h},r.exports=c},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,s){var o=n("./DataReader");function c(l){o.call(this,l)}n("../utils").inherits(c,o),c.prototype.byteAt=function(l){return this.data.charCodeAt(this.zero+l)},c.prototype.lastIndexOfSignature=function(l){return this.data.lastIndexOf(l)-this.zero},c.prototype.readAndCheckSignature=function(l){return l===this.readData(4)},c.prototype.readData=function(l){this.checkOffset(l);var h=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,h},r.exports=c},{"../utils":32,"./DataReader":18}],21:[function(n,r,s){var o=n("./ArrayReader");function c(l){o.call(this,l)}n("../utils").inherits(c,o),c.prototype.readData=function(l){if(this.checkOffset(l),l===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+l);return this.index+=l,h},r.exports=c},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,s){var o=n("../utils"),c=n("../support"),l=n("./ArrayReader"),h=n("./StringReader"),f=n("./NodeBufferReader"),p=n("./Uint8ArrayReader");r.exports=function(g){var _=o.getTypeOf(g);return o.checkSupport(_),_!=="string"||c.uint8array?_==="nodebuffer"?new f(g):c.uint8array?new p(o.transformTo("uint8array",g)):new l(o.transformTo("array",g)):new h(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,s){var o=n("./GenericWorker"),c=n("../utils");function l(h){o.call(this,"ConvertWorker to "+h),this.destType=h}c.inherits(l,o),l.prototype.processChunk=function(h){this.push({data:c.transformTo(this.destType,h.data),meta:h.meta})},r.exports=l},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,s){var o=n("./GenericWorker"),c=n("../crc32");function l(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(l,o),l.prototype.processChunk=function(h){this.streamInfo.crc32=c(h.data,this.streamInfo.crc32||0),this.push(h)},r.exports=l},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,s){var o=n("../utils"),c=n("./GenericWorker");function l(h){c.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}o.inherits(l,c),l.prototype.processChunk=function(h){if(h){var f=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=f+h.data.length}c.prototype.processChunk.call(this,h)},r.exports=l},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,s){var o=n("../utils"),c=n("./GenericWorker");function l(h){c.call(this,"DataWorker");var f=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(p){f.dataIsReady=!0,f.data=p,f.max=p&&p.length||0,f.type=o.getTypeOf(p),f.isPaused||f._tickAndRepeat()},function(p){f.error(p)})}o.inherits(l,c),l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this.data=null},l.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},l.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},l.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,f=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,f);break;case"uint8array":h=this.data.subarray(this.index,f);break;case"array":case"nodebuffer":h=this.data.slice(this.index,f)}return this.index=f,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=l},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,s){function o(c){this.name=c||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(c){this.emit("data",c)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(c){this.emit("error",c)}return!0},error:function(c){return!this.isFinished&&(this.isPaused?this.generatedError=c:(this.isFinished=!0,this.emit("error",c),this.previous&&this.previous.error(c),this.cleanUp()),!0)},on:function(c,l){return this._listeners[c].push(l),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(c,l){if(this._listeners[c])for(var h=0;h<this._listeners[c].length;h++)this._listeners[c][h].call(this,l)},pipe:function(c){return c.registerPrevious(this)},registerPrevious:function(c){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=c.streamInfo,this.mergeStreamInfo(),this.previous=c;var l=this;return c.on("data",function(h){l.processChunk(h)}),c.on("end",function(){l.end()}),c.on("error",function(h){l.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var c=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),c=!0),this.previous&&this.previous.resume(),!c},flush:function(){},processChunk:function(c){this.push(c)},withStreamInfo:function(c,l){return this.extraStreamInfo[c]=l,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var c in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,c)&&(this.streamInfo[c]=this.extraStreamInfo[c])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var c="Worker "+this.name;return this.previous?this.previous+" -> "+c:c}},r.exports=o},{}],29:[function(n,r,s){var o=n("../utils"),c=n("./ConvertWorker"),l=n("./GenericWorker"),h=n("../base64"),f=n("../support"),p=n("../external"),g=null;if(f.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(x,w){return new p.Promise(function(S,E){var T=[],A=x._internalType,M=x._outputType,L=x._mimeType;x.on("data",function(H,O){T.push(H),w&&w(O)}).on("error",function(H){T=[],E(H)}).on("end",function(){try{var H=(function(O,j,B){switch(O){case"blob":return o.newBlob(o.transformTo("arraybuffer",j),B);case"base64":return h.encode(j);default:return o.transformTo(O,j)}})(M,(function(O,j){var B,V=0,$=null,k=0;for(B=0;B<j.length;B++)k+=j[B].length;switch(O){case"string":return j.join("");case"array":return Array.prototype.concat.apply([],j);case"uint8array":for($=new Uint8Array(k),B=0;B<j.length;B++)$.set(j[B],V),V+=j[B].length;return $;case"nodebuffer":return Buffer.concat(j);default:throw new Error("concat : unsupported type '"+O+"'")}})(A,T),L);S(H)}catch(O){E(O)}T=[]}).resume()})}function y(x,w,S){var E=w;switch(w){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=w,this._mimeType=S,o.checkSupport(E),this._worker=x.pipe(new c(E)),x.lock()}catch(T){this._worker=new l("error"),this._worker.error(T)}}y.prototype={accumulate:function(x){return _(this,x)},on:function(x,w){var S=this;return x==="data"?this._worker.on(x,function(E){w.call(S,E.data,E.meta)}):this._worker.on(x,function(){o.delay(w,arguments,S)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(x){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},x)}},r.exports=y},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var o=new ArrayBuffer(0);try{s.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var c=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);c.append(o),s.blob=c.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!n("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,s){for(var o=n("./utils"),c=n("./support"),l=n("./nodejsUtils"),h=n("./stream/GenericWorker"),f=new Array(256),p=0;p<256;p++)f[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;f[254]=f[254]=1;function g(){h.call(this,"utf-8 decode"),this.leftOver=null}function _(){h.call(this,"utf-8 encode")}s.utf8encode=function(y){return c.nodebuffer?l.newBufferFrom(y,"utf-8"):(function(x){var w,S,E,T,A,M=x.length,L=0;for(T=0;T<M;T++)(64512&(S=x.charCodeAt(T)))==55296&&T+1<M&&(64512&(E=x.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(E-56320),T++),L+=S<128?1:S<2048?2:S<65536?3:4;for(w=c.uint8array?new Uint8Array(L):new Array(L),T=A=0;A<L;T++)(64512&(S=x.charCodeAt(T)))==55296&&T+1<M&&(64512&(E=x.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(E-56320),T++),S<128?w[A++]=S:(S<2048?w[A++]=192|S>>>6:(S<65536?w[A++]=224|S>>>12:(w[A++]=240|S>>>18,w[A++]=128|S>>>12&63),w[A++]=128|S>>>6&63),w[A++]=128|63&S);return w})(y)},s.utf8decode=function(y){return c.nodebuffer?o.transformTo("nodebuffer",y).toString("utf-8"):(function(x){var w,S,E,T,A=x.length,M=new Array(2*A);for(w=S=0;w<A;)if((E=x[w++])<128)M[S++]=E;else if(4<(T=f[E]))M[S++]=65533,w+=T-1;else{for(E&=T===2?31:T===3?15:7;1<T&&w<A;)E=E<<6|63&x[w++],T--;1<T?M[S++]=65533:E<65536?M[S++]=E:(E-=65536,M[S++]=55296|E>>10&1023,M[S++]=56320|1023&E)}return M.length!==S&&(M.subarray?M=M.subarray(0,S):M.length=S),o.applyFromCharCode(M)})(y=o.transformTo(c.uint8array?"uint8array":"array",y))},o.inherits(g,h),g.prototype.processChunk=function(y){var x=o.transformTo(c.uint8array?"uint8array":"array",y.data);if(this.leftOver&&this.leftOver.length){if(c.uint8array){var w=x;(x=new Uint8Array(w.length+this.leftOver.length)).set(this.leftOver,0),x.set(w,this.leftOver.length)}else x=this.leftOver.concat(x);this.leftOver=null}var S=(function(T,A){var M;for((A=A||T.length)>T.length&&(A=T.length),M=A-1;0<=M&&(192&T[M])==128;)M--;return M<0||M===0?A:M+f[T[M]]>A?M:A})(x),E=x;S!==x.length&&(c.uint8array?(E=x.subarray(0,S),this.leftOver=x.subarray(S,x.length)):(E=x.slice(0,S),this.leftOver=x.slice(S,x.length))),this.push({data:s.utf8decode(E),meta:y.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=g,o.inherits(_,h),_.prototype.processChunk=function(y){this.push({data:s.utf8encode(y.data),meta:y.meta})},s.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,s){var o=n("./support"),c=n("./base64"),l=n("./nodejsUtils"),h=n("./external");function f(w){return w}function p(w,S){for(var E=0;E<w.length;++E)S[E]=255&w.charCodeAt(E);return S}n("setimmediate"),s.newBlob=function(w,S){s.checkSupport("blob");try{return new Blob([w],{type:S})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(w),E.getBlob(S)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(w,S,E){var T=[],A=0,M=w.length;if(M<=E)return String.fromCharCode.apply(null,w);for(;A<M;)S==="array"||S==="nodebuffer"?T.push(String.fromCharCode.apply(null,w.slice(A,Math.min(A+E,M)))):T.push(String.fromCharCode.apply(null,w.subarray(A,Math.min(A+E,M)))),A+=E;return T.join("")},stringifyByChar:function(w){for(var S="",E=0;E<w.length;E++)S+=String.fromCharCode(w[E]);return S},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,l.allocBuffer(1)).length===1}catch{return!1}})()}};function _(w){var S=65536,E=s.getTypeOf(w),T=!0;if(E==="uint8array"?T=g.applyCanBeUsed.uint8array:E==="nodebuffer"&&(T=g.applyCanBeUsed.nodebuffer),T)for(;1<S;)try{return g.stringifyByChunk(w,E,S)}catch{S=Math.floor(S/2)}return g.stringifyByChar(w)}function y(w,S){for(var E=0;E<w.length;E++)S[E]=w[E];return S}s.applyFromCharCode=_;var x={};x.string={string:f,array:function(w){return p(w,new Array(w.length))},arraybuffer:function(w){return x.string.uint8array(w).buffer},uint8array:function(w){return p(w,new Uint8Array(w.length))},nodebuffer:function(w){return p(w,l.allocBuffer(w.length))}},x.array={string:_,array:f,arraybuffer:function(w){return new Uint8Array(w).buffer},uint8array:function(w){return new Uint8Array(w)},nodebuffer:function(w){return l.newBufferFrom(w)}},x.arraybuffer={string:function(w){return _(new Uint8Array(w))},array:function(w){return y(new Uint8Array(w),new Array(w.byteLength))},arraybuffer:f,uint8array:function(w){return new Uint8Array(w)},nodebuffer:function(w){return l.newBufferFrom(new Uint8Array(w))}},x.uint8array={string:_,array:function(w){return y(w,new Array(w.length))},arraybuffer:function(w){return w.buffer},uint8array:f,nodebuffer:function(w){return l.newBufferFrom(w)}},x.nodebuffer={string:_,array:function(w){return y(w,new Array(w.length))},arraybuffer:function(w){return x.nodebuffer.uint8array(w).buffer},uint8array:function(w){return y(w,new Uint8Array(w.length))},nodebuffer:f},s.transformTo=function(w,S){if(S=S||"",!w)return S;s.checkSupport(w);var E=s.getTypeOf(S);return x[E][w](S)},s.resolve=function(w){for(var S=w.split("/"),E=[],T=0;T<S.length;T++){var A=S[T];A==="."||A===""&&T!==0&&T!==S.length-1||(A===".."?E.pop():E.push(A))}return E.join("/")},s.getTypeOf=function(w){return typeof w=="string"?"string":Object.prototype.toString.call(w)==="[object Array]"?"array":o.nodebuffer&&l.isBuffer(w)?"nodebuffer":o.uint8array&&w instanceof Uint8Array?"uint8array":o.arraybuffer&&w instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(w){if(!o[w.toLowerCase()])throw new Error(w+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(w){var S,E,T="";for(E=0;E<(w||"").length;E++)T+="\\x"+((S=w.charCodeAt(E))<16?"0":"")+S.toString(16).toUpperCase();return T},s.delay=function(w,S,E){setImmediate(function(){w.apply(E||null,S||[])})},s.inherits=function(w,S){function E(){}E.prototype=S.prototype,w.prototype=new E},s.extend=function(){var w,S,E={};for(w=0;w<arguments.length;w++)for(S in arguments[w])Object.prototype.hasOwnProperty.call(arguments[w],S)&&E[S]===void 0&&(E[S]=arguments[w][S]);return E},s.prepareContent=function(w,S,E,T,A){return h.Promise.resolve(S).then(function(M){return o.blob&&(M instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(M))!==-1)&&typeof FileReader<"u"?new h.Promise(function(L,H){var O=new FileReader;O.onload=function(j){L(j.target.result)},O.onerror=function(j){H(j.target.error)},O.readAsArrayBuffer(M)}):M}).then(function(M){var L=s.getTypeOf(M);return L?(L==="arraybuffer"?M=s.transformTo("uint8array",M):L==="string"&&(A?M=c.decode(M):E&&T!==!0&&(M=(function(H){return p(H,o.uint8array?new Uint8Array(H.length):new Array(H.length))})(M))),M):h.Promise.reject(new Error("Can't read the data of '"+w+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,s){var o=n("./reader/readerFor"),c=n("./utils"),l=n("./signature"),h=n("./zipEntry"),f=n("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+c.pretty(_)+", expected "+c.pretty(g)+")")}},isSignature:function(g,_){var y=this.reader.index;this.reader.setIndex(g);var x=this.reader.readString(4)===_;return this.reader.setIndex(y),x},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),_=f.uint8array?"uint8array":"array",y=c.transformTo(_,g);this.zipComment=this.loadOptions.decodeFileName(y)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,_,y,x=this.zip64EndOfCentralSize-44;0<x;)g=this.reader.readInt(2),_=this.reader.readInt(4),y=this.reader.readData(_),this.zip64ExtensibleData[g]={id:g,length:_,value:y}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,_;for(g=0;g<this.files.length;g++)_=this.files[g],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(l.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(l.CENTRAL_FILE_HEADER);)(g=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(l.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,l.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var _=g;if(this.checkSignature(l.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===c.MAX_VALUE_16BITS||this.diskWithCentralDirStart===c.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===c.MAX_VALUE_16BITS||this.centralDirRecords===c.MAX_VALUE_16BITS||this.centralDirSize===c.MAX_VALUE_32BITS||this.centralDirOffset===c.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,l.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var y=this.centralDirOffset+this.centralDirSize;this.zip64&&(y+=20,y+=12+this.zip64EndOfCentralSize);var x=_-y;if(0<x)this.isSignature(_,l.CENTRAL_FILE_HEADER)||(this.reader.zero=x);else if(x<0)throw new Error("Corrupted zip: missing "+Math.abs(x)+" bytes.")},prepareReader:function(g){this.reader=o(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,s){var o=n("./reader/readerFor"),c=n("./utils"),l=n("./compressedObject"),h=n("./crc32"),f=n("./utf8"),p=n("./compressions"),g=n("./support");function _(y,x){this.options=y,this.loadOptions=x}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(y){var x,w;if(y.skip(22),this.fileNameLength=y.readInt(2),w=y.readInt(2),this.fileName=y.readData(this.fileNameLength),y.skip(w),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((x=(function(S){for(var E in p)if(Object.prototype.hasOwnProperty.call(p,E)&&p[E].magic===S)return p[E];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+c.pretty(this.compressionMethod)+" unknown (inner file : "+c.transformTo("string",this.fileName)+")");this.decompressed=new l(this.compressedSize,this.uncompressedSize,this.crc32,x,y.readData(this.compressedSize))},readCentralPart:function(y){this.versionMadeBy=y.readInt(2),y.skip(2),this.bitFlag=y.readInt(2),this.compressionMethod=y.readString(2),this.date=y.readDate(),this.crc32=y.readInt(4),this.compressedSize=y.readInt(4),this.uncompressedSize=y.readInt(4);var x=y.readInt(2);if(this.extraFieldsLength=y.readInt(2),this.fileCommentLength=y.readInt(2),this.diskNumberStart=y.readInt(2),this.internalFileAttributes=y.readInt(2),this.externalFileAttributes=y.readInt(4),this.localHeaderOffset=y.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");y.skip(x),this.readExtraFields(y),this.parseZIP64ExtraField(y),this.fileComment=y.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var y=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),y==0&&(this.dosPermissions=63&this.externalFileAttributes),y==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var y=o(this.extraFields[1].value);this.uncompressedSize===c.MAX_VALUE_32BITS&&(this.uncompressedSize=y.readInt(8)),this.compressedSize===c.MAX_VALUE_32BITS&&(this.compressedSize=y.readInt(8)),this.localHeaderOffset===c.MAX_VALUE_32BITS&&(this.localHeaderOffset=y.readInt(8)),this.diskNumberStart===c.MAX_VALUE_32BITS&&(this.diskNumberStart=y.readInt(4))}},readExtraFields:function(y){var x,w,S,E=y.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});y.index+4<E;)x=y.readInt(2),w=y.readInt(2),S=y.readData(w),this.extraFields[x]={id:x,length:w,value:S};y.setIndex(E)},handleUTF8:function(){var y=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=f.utf8decode(this.fileName),this.fileCommentStr=f.utf8decode(this.fileComment);else{var x=this.findExtraFieldUnicodePath();if(x!==null)this.fileNameStr=x;else{var w=c.transformTo(y,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(w)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var E=c.transformTo(y,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},findExtraFieldUnicodePath:function(){var y=this.extraFields[28789];if(y){var x=o(y.value);return x.readInt(1)!==1||h(this.fileName)!==x.readInt(4)?null:f.utf8decode(x.readData(y.length-5))}return null},findExtraFieldUnicodeComment:function(){var y=this.extraFields[25461];if(y){var x=o(y.value);return x.readInt(1)!==1||h(this.fileComment)!==x.readInt(4)?null:f.utf8decode(x.readData(y.length-5))}return null}},r.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,s){function o(x,w,S){this.name=x,this.dir=S.dir,this.date=S.date,this.comment=S.comment,this.unixPermissions=S.unixPermissions,this.dosPermissions=S.dosPermissions,this._data=w,this._dataBinary=S.binary,this.options={compression:S.compression,compressionOptions:S.compressionOptions}}var c=n("./stream/StreamHelper"),l=n("./stream/DataWorker"),h=n("./utf8"),f=n("./compressedObject"),p=n("./stream/GenericWorker");o.prototype={internalStream:function(x){var w=null,S="string";try{if(!x)throw new Error("No output type specified.");var E=(S=x.toLowerCase())==="string"||S==="text";S!=="binarystring"&&S!=="text"||(S="string"),w=this._decompressWorker();var T=!this._dataBinary;T&&!E&&(w=w.pipe(new h.Utf8EncodeWorker)),!T&&E&&(w=w.pipe(new h.Utf8DecodeWorker))}catch(A){(w=new p("error")).error(A)}return new c(w,S,"")},async:function(x,w){return this.internalStream(x).accumulate(w)},nodeStream:function(x,w){return this.internalStream(x||"nodebuffer").toNodejsStream(w)},_compressWorker:function(x,w){if(this._data instanceof f&&this._data.compression.magic===x.magic)return this._data.getCompressedWorker();var S=this._decompressWorker();return this._dataBinary||(S=S.pipe(new h.Utf8EncodeWorker)),f.createWorkerFrom(S,x,w)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof p?this._data:new l(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},y=0;y<g.length;y++)o.prototype[g[y]]=_;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,s){(function(o){var c,l,h=o.MutationObserver||o.WebKitMutationObserver;if(h){var f=0,p=new h(x),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),c=function(){g.data=f=++f%2}}else if(o.setImmediate||o.MessageChannel===void 0)c="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var w=o.document.createElement("script");w.onreadystatechange=function(){x(),w.onreadystatechange=null,w.parentNode.removeChild(w),w=null},o.document.documentElement.appendChild(w)}:function(){setTimeout(x,0)};else{var _=new o.MessageChannel;_.port1.onmessage=x,c=function(){_.port2.postMessage(0)}}var y=[];function x(){var w,S;l=!0;for(var E=y.length;E;){for(S=y,y=[],w=-1;++w<E;)S[w]();E=y.length}l=!1}r.exports=function(w){y.push(w)!==1||l||c()}}).call(this,typeof Jh<"u"?Jh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,s){var o=n("immediate");function c(){}var l={},h=["REJECTED"],f=["FULFILLED"],p=["PENDING"];function g(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,E!==c&&w(this,E)}function _(E,T,A){this.promise=E,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function y(E,T,A){o(function(){var M;try{M=T(A)}catch(L){return l.reject(E,L)}M===E?l.reject(E,new TypeError("Cannot resolve promise with itself")):l.resolve(E,M)})}function x(E){var T=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof T=="function")return function(){T.apply(E,arguments)}}function w(E,T){var A=!1;function M(O){A||(A=!0,l.reject(E,O))}function L(O){A||(A=!0,l.resolve(E,O))}var H=S(function(){T(L,M)});H.status==="error"&&M(H.value)}function S(E,T){var A={};try{A.value=E(T),A.status="success"}catch(M){A.status="error",A.value=M}return A}(r.exports=g).prototype.finally=function(E){if(typeof E!="function")return this;var T=this.constructor;return this.then(function(A){return T.resolve(E()).then(function(){return A})},function(A){return T.resolve(E()).then(function(){throw A})})},g.prototype.catch=function(E){return this.then(null,E)},g.prototype.then=function(E,T){if(typeof E!="function"&&this.state===f||typeof T!="function"&&this.state===h)return this;var A=new this.constructor(c);return this.state!==p?y(A,this.state===f?E:T,this.outcome):this.queue.push(new _(A,E,T)),A},_.prototype.callFulfilled=function(E){l.resolve(this.promise,E)},_.prototype.otherCallFulfilled=function(E){y(this.promise,this.onFulfilled,E)},_.prototype.callRejected=function(E){l.reject(this.promise,E)},_.prototype.otherCallRejected=function(E){y(this.promise,this.onRejected,E)},l.resolve=function(E,T){var A=S(x,T);if(A.status==="error")return l.reject(E,A.value);var M=A.value;if(M)w(E,M);else{E.state=f,E.outcome=T;for(var L=-1,H=E.queue.length;++L<H;)E.queue[L].callFulfilled(T)}return E},l.reject=function(E,T){E.state=h,E.outcome=T;for(var A=-1,M=E.queue.length;++A<M;)E.queue[A].callRejected(T);return E},g.resolve=function(E){return E instanceof this?E:l.resolve(new this(c),E)},g.reject=function(E){var T=new this(c);return l.reject(T,E)},g.all=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=E.length,M=!1;if(!A)return this.resolve([]);for(var L=new Array(A),H=0,O=-1,j=new this(c);++O<A;)B(E[O],O);return j;function B(V,$){T.resolve(V).then(function(k){L[$]=k,++H!==A||M||(M=!0,l.resolve(j,L))},function(k){M||(M=!0,l.reject(j,k))})}},g.race=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=E.length,M=!1;if(!A)return this.resolve([]);for(var L=-1,H=new this(c);++L<A;)O=E[L],T.resolve(O).then(function(j){M||(M=!0,l.resolve(H,j))},function(j){M||(M=!0,l.reject(H,j))});var O;return H}},{immediate:36}],38:[function(n,r,s){var o={};(0,n("./lib/utils/common").assign)(o,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,s){var o=n("./zlib/deflate"),c=n("./utils/common"),l=n("./utils/strings"),h=n("./zlib/messages"),f=n("./zlib/zstream"),p=Object.prototype.toString,g=0,_=-1,y=0,x=8;function w(E){if(!(this instanceof w))return new w(E);this.options=c.assign({level:_,method:x,chunkSize:16384,windowBits:15,memLevel:8,strategy:y,to:""},E||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var A=o.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(A!==g)throw new Error(h[A]);if(T.header&&o.deflateSetHeader(this.strm,T.header),T.dictionary){var M;if(M=typeof T.dictionary=="string"?l.string2buf(T.dictionary):p.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(A=o.deflateSetDictionary(this.strm,M))!==g)throw new Error(h[A]);this._dict_set=!0}}function S(E,T){var A=new w(T);if(A.push(E,!0),A.err)throw A.msg||h[A.err];return A.result}w.prototype.push=function(E,T){var A,M,L=this.strm,H=this.options.chunkSize;if(this.ended)return!1;M=T===~~T?T:T===!0?4:0,typeof E=="string"?L.input=l.string2buf(E):p.call(E)==="[object ArrayBuffer]"?L.input=new Uint8Array(E):L.input=E,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new c.Buf8(H),L.next_out=0,L.avail_out=H),(A=o.deflate(L,M))!==1&&A!==g)return this.onEnd(A),!(this.ended=!0);L.avail_out!==0&&(L.avail_in!==0||M!==4&&M!==2)||(this.options.to==="string"?this.onData(l.buf2binstring(c.shrinkBuf(L.output,L.next_out))):this.onData(c.shrinkBuf(L.output,L.next_out)))}while((0<L.avail_in||L.avail_out===0)&&A!==1);return M===4?(A=o.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===g):M!==2||(this.onEnd(g),!(L.avail_out=0))},w.prototype.onData=function(E){this.chunks.push(E)},w.prototype.onEnd=function(E){E===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},s.Deflate=w,s.deflate=S,s.deflateRaw=function(E,T){return(T=T||{}).raw=!0,S(E,T)},s.gzip=function(E,T){return(T=T||{}).gzip=!0,S(E,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,s){var o=n("./zlib/inflate"),c=n("./utils/common"),l=n("./utils/strings"),h=n("./zlib/constants"),f=n("./zlib/messages"),p=n("./zlib/zstream"),g=n("./zlib/gzheader"),_=Object.prototype.toString;function y(w){if(!(this instanceof y))return new y(w);this.options=c.assign({chunkSize:16384,windowBits:0,to:""},w||{});var S=this.options;S.raw&&0<=S.windowBits&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),!(0<=S.windowBits&&S.windowBits<16)||w&&w.windowBits||(S.windowBits+=32),15<S.windowBits&&S.windowBits<48&&(15&S.windowBits)==0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var E=o.inflateInit2(this.strm,S.windowBits);if(E!==h.Z_OK)throw new Error(f[E]);this.header=new g,o.inflateGetHeader(this.strm,this.header)}function x(w,S){var E=new y(S);if(E.push(w,!0),E.err)throw E.msg||f[E.err];return E.result}y.prototype.push=function(w,S){var E,T,A,M,L,H,O=this.strm,j=this.options.chunkSize,B=this.options.dictionary,V=!1;if(this.ended)return!1;T=S===~~S?S:S===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof w=="string"?O.input=l.binstring2buf(w):_.call(w)==="[object ArrayBuffer]"?O.input=new Uint8Array(w):O.input=w,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new c.Buf8(j),O.next_out=0,O.avail_out=j),(E=o.inflate(O,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&B&&(H=typeof B=="string"?l.string2buf(B):_.call(B)==="[object ArrayBuffer]"?new Uint8Array(B):B,E=o.inflateSetDictionary(this.strm,H)),E===h.Z_BUF_ERROR&&V===!0&&(E=h.Z_OK,V=!1),E!==h.Z_STREAM_END&&E!==h.Z_OK)return this.onEnd(E),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&E!==h.Z_STREAM_END&&(O.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=l.utf8border(O.output,O.next_out),M=O.next_out-A,L=l.buf2string(O.output,A),O.next_out=M,O.avail_out=j-M,M&&c.arraySet(O.output,O.output,A,M,0),this.onData(L)):this.onData(c.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(V=!0)}while((0<O.avail_in||O.avail_out===0)&&E!==h.Z_STREAM_END);return E===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(E=o.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(O.avail_out=0))},y.prototype.onData=function(w){this.chunks.push(w)},y.prototype.onEnd=function(w){w===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},s.Inflate=y,s.inflate=x,s.inflateRaw=function(w,S){return(S=S||{}).raw=!0,x(w,S)},s.ungzip=x},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,s){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(h){for(var f=Array.prototype.slice.call(arguments,1);f.length;){var p=f.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])}}return h},s.shrinkBuf=function(h,f){return h.length===f?h:h.subarray?h.subarray(0,f):(h.length=f,h)};var c={arraySet:function(h,f,p,g,_){if(f.subarray&&h.subarray)h.set(f.subarray(p,p+g),_);else for(var y=0;y<g;y++)h[_+y]=f[p+y]},flattenChunks:function(h){var f,p,g,_,y,x;for(f=g=0,p=h.length;f<p;f++)g+=h[f].length;for(x=new Uint8Array(g),f=_=0,p=h.length;f<p;f++)y=h[f],x.set(y,_),_+=y.length;return x}},l={arraySet:function(h,f,p,g,_){for(var y=0;y<g;y++)h[_+y]=f[p+y]},flattenChunks:function(h){return[].concat.apply([],h)}};s.setTyped=function(h){h?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,c)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,l))},s.setTyped(o)},{}],42:[function(n,r,s){var o=n("./common"),c=!0,l=!0;try{String.fromCharCode.apply(null,[0])}catch{c=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l=!1}for(var h=new o.Buf8(256),f=0;f<256;f++)h[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;function p(g,_){if(_<65537&&(g.subarray&&l||!g.subarray&&c))return String.fromCharCode.apply(null,o.shrinkBuf(g,_));for(var y="",x=0;x<_;x++)y+=String.fromCharCode(g[x]);return y}h[254]=h[254]=1,s.string2buf=function(g){var _,y,x,w,S,E=g.length,T=0;for(w=0;w<E;w++)(64512&(y=g.charCodeAt(w)))==55296&&w+1<E&&(64512&(x=g.charCodeAt(w+1)))==56320&&(y=65536+(y-55296<<10)+(x-56320),w++),T+=y<128?1:y<2048?2:y<65536?3:4;for(_=new o.Buf8(T),w=S=0;S<T;w++)(64512&(y=g.charCodeAt(w)))==55296&&w+1<E&&(64512&(x=g.charCodeAt(w+1)))==56320&&(y=65536+(y-55296<<10)+(x-56320),w++),y<128?_[S++]=y:(y<2048?_[S++]=192|y>>>6:(y<65536?_[S++]=224|y>>>12:(_[S++]=240|y>>>18,_[S++]=128|y>>>12&63),_[S++]=128|y>>>6&63),_[S++]=128|63&y);return _},s.buf2binstring=function(g){return p(g,g.length)},s.binstring2buf=function(g){for(var _=new o.Buf8(g.length),y=0,x=_.length;y<x;y++)_[y]=g.charCodeAt(y);return _},s.buf2string=function(g,_){var y,x,w,S,E=_||g.length,T=new Array(2*E);for(y=x=0;y<E;)if((w=g[y++])<128)T[x++]=w;else if(4<(S=h[w]))T[x++]=65533,y+=S-1;else{for(w&=S===2?31:S===3?15:7;1<S&&y<E;)w=w<<6|63&g[y++],S--;1<S?T[x++]=65533:w<65536?T[x++]=w:(w-=65536,T[x++]=55296|w>>10&1023,T[x++]=56320|1023&w)}return p(T,x)},s.utf8border=function(g,_){var y;for((_=_||g.length)>g.length&&(_=g.length),y=_-1;0<=y&&(192&g[y])==128;)y--;return y<0||y===0?_:y+h[g[y]]>_?y:_}},{"./common":41}],43:[function(n,r,s){r.exports=function(o,c,l,h){for(var f=65535&o|0,p=o>>>16&65535|0,g=0;l!==0;){for(l-=g=2e3<l?2e3:l;p=p+(f=f+c[h++]|0)|0,--g;);f%=65521,p%=65521}return f|p<<16|0}},{}],44:[function(n,r,s){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,s){var o=(function(){for(var c,l=[],h=0;h<256;h++){c=h;for(var f=0;f<8;f++)c=1&c?3988292384^c>>>1:c>>>1;l[h]=c}return l})();r.exports=function(c,l,h,f){var p=o,g=f+h;c^=-1;for(var _=f;_<g;_++)c=c>>>8^p[255&(c^l[_])];return-1^c}},{}],46:[function(n,r,s){var o,c=n("../utils/common"),l=n("./trees"),h=n("./adler32"),f=n("./crc32"),p=n("./messages"),g=0,_=4,y=0,x=-2,w=-1,S=4,E=2,T=8,A=9,M=286,L=30,H=19,O=2*M+1,j=15,B=3,V=258,$=V+B+1,k=42,N=113,D=1,X=2,K=3,q=4;function te(U,fe){return U.msg=p[fe],fe}function Q(U){return(U<<1)-(4<U?9:0)}function ae(U){for(var fe=U.length;0<=--fe;)U[fe]=0}function P(U){var fe=U.state,ue=fe.pending;ue>U.avail_out&&(ue=U.avail_out),ue!==0&&(c.arraySet(U.output,fe.pending_buf,fe.pending_out,ue,U.next_out),U.next_out+=ue,fe.pending_out+=ue,U.total_out+=ue,U.avail_out-=ue,fe.pending-=ue,fe.pending===0&&(fe.pending_out=0))}function G(U,fe){l._tr_flush_block(U,0<=U.block_start?U.block_start:-1,U.strstart-U.block_start,fe),U.block_start=U.strstart,P(U.strm)}function ee(U,fe){U.pending_buf[U.pending++]=fe}function re(U,fe){U.pending_buf[U.pending++]=fe>>>8&255,U.pending_buf[U.pending++]=255&fe}function se(U,fe){var ue,J,Z=U.max_chain_length,oe=U.strstart,Se=U.prev_length,xe=U.nice_match,de=U.strstart>U.w_size-$?U.strstart-(U.w_size-$):0,Ne=U.window,Ae=U.w_mask,Ie=U.prev,qe=U.strstart+V,wt=Ne[oe+Se-1],it=Ne[oe+Se];U.prev_length>=U.good_match&&(Z>>=2),xe>U.lookahead&&(xe=U.lookahead);do if(Ne[(ue=fe)+Se]===it&&Ne[ue+Se-1]===wt&&Ne[ue]===Ne[oe]&&Ne[++ue]===Ne[oe+1]){oe+=2,ue++;do;while(Ne[++oe]===Ne[++ue]&&Ne[++oe]===Ne[++ue]&&Ne[++oe]===Ne[++ue]&&Ne[++oe]===Ne[++ue]&&Ne[++oe]===Ne[++ue]&&Ne[++oe]===Ne[++ue]&&Ne[++oe]===Ne[++ue]&&Ne[++oe]===Ne[++ue]&&oe<qe);if(J=V-(qe-oe),oe=qe-V,Se<J){if(U.match_start=fe,xe<=(Se=J))break;wt=Ne[oe+Se-1],it=Ne[oe+Se]}}while((fe=Ie[fe&Ae])>de&&--Z!=0);return Se<=U.lookahead?Se:U.lookahead}function ge(U){var fe,ue,J,Z,oe,Se,xe,de,Ne,Ae,Ie=U.w_size;do{if(Z=U.window_size-U.lookahead-U.strstart,U.strstart>=Ie+(Ie-$)){for(c.arraySet(U.window,U.window,Ie,Ie,0),U.match_start-=Ie,U.strstart-=Ie,U.block_start-=Ie,fe=ue=U.hash_size;J=U.head[--fe],U.head[fe]=Ie<=J?J-Ie:0,--ue;);for(fe=ue=Ie;J=U.prev[--fe],U.prev[fe]=Ie<=J?J-Ie:0,--ue;);Z+=Ie}if(U.strm.avail_in===0)break;if(Se=U.strm,xe=U.window,de=U.strstart+U.lookahead,Ne=Z,Ae=void 0,Ae=Se.avail_in,Ne<Ae&&(Ae=Ne),ue=Ae===0?0:(Se.avail_in-=Ae,c.arraySet(xe,Se.input,Se.next_in,Ae,de),Se.state.wrap===1?Se.adler=h(Se.adler,xe,Ae,de):Se.state.wrap===2&&(Se.adler=f(Se.adler,xe,Ae,de)),Se.next_in+=Ae,Se.total_in+=Ae,Ae),U.lookahead+=ue,U.lookahead+U.insert>=B)for(oe=U.strstart-U.insert,U.ins_h=U.window[oe],U.ins_h=(U.ins_h<<U.hash_shift^U.window[oe+1])&U.hash_mask;U.insert&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[oe+B-1])&U.hash_mask,U.prev[oe&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=oe,oe++,U.insert--,!(U.lookahead+U.insert<B)););}while(U.lookahead<$&&U.strm.avail_in!==0)}function Ce(U,fe){for(var ue,J;;){if(U.lookahead<$){if(ge(U),U.lookahead<$&&fe===g)return D;if(U.lookahead===0)break}if(ue=0,U.lookahead>=B&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+B-1])&U.hash_mask,ue=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),ue!==0&&U.strstart-ue<=U.w_size-$&&(U.match_length=se(U,ue)),U.match_length>=B)if(J=l._tr_tally(U,U.strstart-U.match_start,U.match_length-B),U.lookahead-=U.match_length,U.match_length<=U.max_lazy_match&&U.lookahead>=B){for(U.match_length--;U.strstart++,U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+B-1])&U.hash_mask,ue=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart,--U.match_length!=0;);U.strstart++}else U.strstart+=U.match_length,U.match_length=0,U.ins_h=U.window[U.strstart],U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+1])&U.hash_mask;else J=l._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++;if(J&&(G(U,!1),U.strm.avail_out===0))return D}return U.insert=U.strstart<B-1?U.strstart:B-1,fe===_?(G(U,!0),U.strm.avail_out===0?K:q):U.last_lit&&(G(U,!1),U.strm.avail_out===0)?D:X}function ie(U,fe){for(var ue,J,Z;;){if(U.lookahead<$){if(ge(U),U.lookahead<$&&fe===g)return D;if(U.lookahead===0)break}if(ue=0,U.lookahead>=B&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+B-1])&U.hash_mask,ue=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),U.prev_length=U.match_length,U.prev_match=U.match_start,U.match_length=B-1,ue!==0&&U.prev_length<U.max_lazy_match&&U.strstart-ue<=U.w_size-$&&(U.match_length=se(U,ue),U.match_length<=5&&(U.strategy===1||U.match_length===B&&4096<U.strstart-U.match_start)&&(U.match_length=B-1)),U.prev_length>=B&&U.match_length<=U.prev_length){for(Z=U.strstart+U.lookahead-B,J=l._tr_tally(U,U.strstart-1-U.prev_match,U.prev_length-B),U.lookahead-=U.prev_length-1,U.prev_length-=2;++U.strstart<=Z&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+B-1])&U.hash_mask,ue=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),--U.prev_length!=0;);if(U.match_available=0,U.match_length=B-1,U.strstart++,J&&(G(U,!1),U.strm.avail_out===0))return D}else if(U.match_available){if((J=l._tr_tally(U,0,U.window[U.strstart-1]))&&G(U,!1),U.strstart++,U.lookahead--,U.strm.avail_out===0)return D}else U.match_available=1,U.strstart++,U.lookahead--}return U.match_available&&(J=l._tr_tally(U,0,U.window[U.strstart-1]),U.match_available=0),U.insert=U.strstart<B-1?U.strstart:B-1,fe===_?(G(U,!0),U.strm.avail_out===0?K:q):U.last_lit&&(G(U,!1),U.strm.avail_out===0)?D:X}function le(U,fe,ue,J,Z){this.good_length=U,this.max_lazy=fe,this.nice_length=ue,this.max_chain=J,this.func=Z}function Me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new c.Buf16(2*O),this.dyn_dtree=new c.Buf16(2*(2*L+1)),this.bl_tree=new c.Buf16(2*(2*H+1)),ae(this.dyn_ltree),ae(this.dyn_dtree),ae(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new c.Buf16(j+1),this.heap=new c.Buf16(2*M+1),ae(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new c.Buf16(2*M+1),ae(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Be(U){var fe;return U&&U.state?(U.total_in=U.total_out=0,U.data_type=E,(fe=U.state).pending=0,fe.pending_out=0,fe.wrap<0&&(fe.wrap=-fe.wrap),fe.status=fe.wrap?k:N,U.adler=fe.wrap===2?0:1,fe.last_flush=g,l._tr_init(fe),y):te(U,x)}function Ze(U){var fe=Be(U);return fe===y&&(function(ue){ue.window_size=2*ue.w_size,ae(ue.head),ue.max_lazy_match=o[ue.level].max_lazy,ue.good_match=o[ue.level].good_length,ue.nice_match=o[ue.level].nice_length,ue.max_chain_length=o[ue.level].max_chain,ue.strstart=0,ue.block_start=0,ue.lookahead=0,ue.insert=0,ue.match_length=ue.prev_length=B-1,ue.match_available=0,ue.ins_h=0})(U.state),fe}function st(U,fe,ue,J,Z,oe){if(!U)return x;var Se=1;if(fe===w&&(fe=6),J<0?(Se=0,J=-J):15<J&&(Se=2,J-=16),Z<1||A<Z||ue!==T||J<8||15<J||fe<0||9<fe||oe<0||S<oe)return te(U,x);J===8&&(J=9);var xe=new Me;return(U.state=xe).strm=U,xe.wrap=Se,xe.gzhead=null,xe.w_bits=J,xe.w_size=1<<xe.w_bits,xe.w_mask=xe.w_size-1,xe.hash_bits=Z+7,xe.hash_size=1<<xe.hash_bits,xe.hash_mask=xe.hash_size-1,xe.hash_shift=~~((xe.hash_bits+B-1)/B),xe.window=new c.Buf8(2*xe.w_size),xe.head=new c.Buf16(xe.hash_size),xe.prev=new c.Buf16(xe.w_size),xe.lit_bufsize=1<<Z+6,xe.pending_buf_size=4*xe.lit_bufsize,xe.pending_buf=new c.Buf8(xe.pending_buf_size),xe.d_buf=1*xe.lit_bufsize,xe.l_buf=3*xe.lit_bufsize,xe.level=fe,xe.strategy=oe,xe.method=ue,Ze(U)}o=[new le(0,0,0,0,function(U,fe){var ue=65535;for(ue>U.pending_buf_size-5&&(ue=U.pending_buf_size-5);;){if(U.lookahead<=1){if(ge(U),U.lookahead===0&&fe===g)return D;if(U.lookahead===0)break}U.strstart+=U.lookahead,U.lookahead=0;var J=U.block_start+ue;if((U.strstart===0||U.strstart>=J)&&(U.lookahead=U.strstart-J,U.strstart=J,G(U,!1),U.strm.avail_out===0)||U.strstart-U.block_start>=U.w_size-$&&(G(U,!1),U.strm.avail_out===0))return D}return U.insert=0,fe===_?(G(U,!0),U.strm.avail_out===0?K:q):(U.strstart>U.block_start&&(G(U,!1),U.strm.avail_out),D)}),new le(4,4,8,4,Ce),new le(4,5,16,8,Ce),new le(4,6,32,32,Ce),new le(4,4,16,16,ie),new le(8,16,32,32,ie),new le(8,16,128,128,ie),new le(8,32,128,256,ie),new le(32,128,258,1024,ie),new le(32,258,258,4096,ie)],s.deflateInit=function(U,fe){return st(U,fe,T,15,8,0)},s.deflateInit2=st,s.deflateReset=Ze,s.deflateResetKeep=Be,s.deflateSetHeader=function(U,fe){return U&&U.state?U.state.wrap!==2?x:(U.state.gzhead=fe,y):x},s.deflate=function(U,fe){var ue,J,Z,oe;if(!U||!U.state||5<fe||fe<0)return U?te(U,x):x;if(J=U.state,!U.output||!U.input&&U.avail_in!==0||J.status===666&&fe!==_)return te(U,U.avail_out===0?-5:x);if(J.strm=U,ue=J.last_flush,J.last_flush=fe,J.status===k)if(J.wrap===2)U.adler=0,ee(J,31),ee(J,139),ee(J,8),J.gzhead?(ee(J,(J.gzhead.text?1:0)+(J.gzhead.hcrc?2:0)+(J.gzhead.extra?4:0)+(J.gzhead.name?8:0)+(J.gzhead.comment?16:0)),ee(J,255&J.gzhead.time),ee(J,J.gzhead.time>>8&255),ee(J,J.gzhead.time>>16&255),ee(J,J.gzhead.time>>24&255),ee(J,J.level===9?2:2<=J.strategy||J.level<2?4:0),ee(J,255&J.gzhead.os),J.gzhead.extra&&J.gzhead.extra.length&&(ee(J,255&J.gzhead.extra.length),ee(J,J.gzhead.extra.length>>8&255)),J.gzhead.hcrc&&(U.adler=f(U.adler,J.pending_buf,J.pending,0)),J.gzindex=0,J.status=69):(ee(J,0),ee(J,0),ee(J,0),ee(J,0),ee(J,0),ee(J,J.level===9?2:2<=J.strategy||J.level<2?4:0),ee(J,3),J.status=N);else{var Se=T+(J.w_bits-8<<4)<<8;Se|=(2<=J.strategy||J.level<2?0:J.level<6?1:J.level===6?2:3)<<6,J.strstart!==0&&(Se|=32),Se+=31-Se%31,J.status=N,re(J,Se),J.strstart!==0&&(re(J,U.adler>>>16),re(J,65535&U.adler)),U.adler=1}if(J.status===69)if(J.gzhead.extra){for(Z=J.pending;J.gzindex<(65535&J.gzhead.extra.length)&&(J.pending!==J.pending_buf_size||(J.gzhead.hcrc&&J.pending>Z&&(U.adler=f(U.adler,J.pending_buf,J.pending-Z,Z)),P(U),Z=J.pending,J.pending!==J.pending_buf_size));)ee(J,255&J.gzhead.extra[J.gzindex]),J.gzindex++;J.gzhead.hcrc&&J.pending>Z&&(U.adler=f(U.adler,J.pending_buf,J.pending-Z,Z)),J.gzindex===J.gzhead.extra.length&&(J.gzindex=0,J.status=73)}else J.status=73;if(J.status===73)if(J.gzhead.name){Z=J.pending;do{if(J.pending===J.pending_buf_size&&(J.gzhead.hcrc&&J.pending>Z&&(U.adler=f(U.adler,J.pending_buf,J.pending-Z,Z)),P(U),Z=J.pending,J.pending===J.pending_buf_size)){oe=1;break}oe=J.gzindex<J.gzhead.name.length?255&J.gzhead.name.charCodeAt(J.gzindex++):0,ee(J,oe)}while(oe!==0);J.gzhead.hcrc&&J.pending>Z&&(U.adler=f(U.adler,J.pending_buf,J.pending-Z,Z)),oe===0&&(J.gzindex=0,J.status=91)}else J.status=91;if(J.status===91)if(J.gzhead.comment){Z=J.pending;do{if(J.pending===J.pending_buf_size&&(J.gzhead.hcrc&&J.pending>Z&&(U.adler=f(U.adler,J.pending_buf,J.pending-Z,Z)),P(U),Z=J.pending,J.pending===J.pending_buf_size)){oe=1;break}oe=J.gzindex<J.gzhead.comment.length?255&J.gzhead.comment.charCodeAt(J.gzindex++):0,ee(J,oe)}while(oe!==0);J.gzhead.hcrc&&J.pending>Z&&(U.adler=f(U.adler,J.pending_buf,J.pending-Z,Z)),oe===0&&(J.status=103)}else J.status=103;if(J.status===103&&(J.gzhead.hcrc?(J.pending+2>J.pending_buf_size&&P(U),J.pending+2<=J.pending_buf_size&&(ee(J,255&U.adler),ee(J,U.adler>>8&255),U.adler=0,J.status=N)):J.status=N),J.pending!==0){if(P(U),U.avail_out===0)return J.last_flush=-1,y}else if(U.avail_in===0&&Q(fe)<=Q(ue)&&fe!==_)return te(U,-5);if(J.status===666&&U.avail_in!==0)return te(U,-5);if(U.avail_in!==0||J.lookahead!==0||fe!==g&&J.status!==666){var xe=J.strategy===2?(function(de,Ne){for(var Ae;;){if(de.lookahead===0&&(ge(de),de.lookahead===0)){if(Ne===g)return D;break}if(de.match_length=0,Ae=l._tr_tally(de,0,de.window[de.strstart]),de.lookahead--,de.strstart++,Ae&&(G(de,!1),de.strm.avail_out===0))return D}return de.insert=0,Ne===_?(G(de,!0),de.strm.avail_out===0?K:q):de.last_lit&&(G(de,!1),de.strm.avail_out===0)?D:X})(J,fe):J.strategy===3?(function(de,Ne){for(var Ae,Ie,qe,wt,it=de.window;;){if(de.lookahead<=V){if(ge(de),de.lookahead<=V&&Ne===g)return D;if(de.lookahead===0)break}if(de.match_length=0,de.lookahead>=B&&0<de.strstart&&(Ie=it[qe=de.strstart-1])===it[++qe]&&Ie===it[++qe]&&Ie===it[++qe]){wt=de.strstart+V;do;while(Ie===it[++qe]&&Ie===it[++qe]&&Ie===it[++qe]&&Ie===it[++qe]&&Ie===it[++qe]&&Ie===it[++qe]&&Ie===it[++qe]&&Ie===it[++qe]&&qe<wt);de.match_length=V-(wt-qe),de.match_length>de.lookahead&&(de.match_length=de.lookahead)}if(de.match_length>=B?(Ae=l._tr_tally(de,1,de.match_length-B),de.lookahead-=de.match_length,de.strstart+=de.match_length,de.match_length=0):(Ae=l._tr_tally(de,0,de.window[de.strstart]),de.lookahead--,de.strstart++),Ae&&(G(de,!1),de.strm.avail_out===0))return D}return de.insert=0,Ne===_?(G(de,!0),de.strm.avail_out===0?K:q):de.last_lit&&(G(de,!1),de.strm.avail_out===0)?D:X})(J,fe):o[J.level].func(J,fe);if(xe!==K&&xe!==q||(J.status=666),xe===D||xe===K)return U.avail_out===0&&(J.last_flush=-1),y;if(xe===X&&(fe===1?l._tr_align(J):fe!==5&&(l._tr_stored_block(J,0,0,!1),fe===3&&(ae(J.head),J.lookahead===0&&(J.strstart=0,J.block_start=0,J.insert=0))),P(U),U.avail_out===0))return J.last_flush=-1,y}return fe!==_?y:J.wrap<=0?1:(J.wrap===2?(ee(J,255&U.adler),ee(J,U.adler>>8&255),ee(J,U.adler>>16&255),ee(J,U.adler>>24&255),ee(J,255&U.total_in),ee(J,U.total_in>>8&255),ee(J,U.total_in>>16&255),ee(J,U.total_in>>24&255)):(re(J,U.adler>>>16),re(J,65535&U.adler)),P(U),0<J.wrap&&(J.wrap=-J.wrap),J.pending!==0?y:1)},s.deflateEnd=function(U){var fe;return U&&U.state?(fe=U.state.status)!==k&&fe!==69&&fe!==73&&fe!==91&&fe!==103&&fe!==N&&fe!==666?te(U,x):(U.state=null,fe===N?te(U,-3):y):x},s.deflateSetDictionary=function(U,fe){var ue,J,Z,oe,Se,xe,de,Ne,Ae=fe.length;if(!U||!U.state||(oe=(ue=U.state).wrap)===2||oe===1&&ue.status!==k||ue.lookahead)return x;for(oe===1&&(U.adler=h(U.adler,fe,Ae,0)),ue.wrap=0,Ae>=ue.w_size&&(oe===0&&(ae(ue.head),ue.strstart=0,ue.block_start=0,ue.insert=0),Ne=new c.Buf8(ue.w_size),c.arraySet(Ne,fe,Ae-ue.w_size,ue.w_size,0),fe=Ne,Ae=ue.w_size),Se=U.avail_in,xe=U.next_in,de=U.input,U.avail_in=Ae,U.next_in=0,U.input=fe,ge(ue);ue.lookahead>=B;){for(J=ue.strstart,Z=ue.lookahead-(B-1);ue.ins_h=(ue.ins_h<<ue.hash_shift^ue.window[J+B-1])&ue.hash_mask,ue.prev[J&ue.w_mask]=ue.head[ue.ins_h],ue.head[ue.ins_h]=J,J++,--Z;);ue.strstart=J,ue.lookahead=B-1,ge(ue)}return ue.strstart+=ue.lookahead,ue.block_start=ue.strstart,ue.insert=ue.lookahead,ue.lookahead=0,ue.match_length=ue.prev_length=B-1,ue.match_available=0,U.next_in=xe,U.input=de,U.avail_in=Se,ue.wrap=oe,y},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,s){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,s){r.exports=function(o,c){var l,h,f,p,g,_,y,x,w,S,E,T,A,M,L,H,O,j,B,V,$,k,N,D,X;l=o.state,h=o.next_in,D=o.input,f=h+(o.avail_in-5),p=o.next_out,X=o.output,g=p-(c-o.avail_out),_=p+(o.avail_out-257),y=l.dmax,x=l.wsize,w=l.whave,S=l.wnext,E=l.window,T=l.hold,A=l.bits,M=l.lencode,L=l.distcode,H=(1<<l.lenbits)-1,O=(1<<l.distbits)-1;e:do{A<15&&(T+=D[h++]<<A,A+=8,T+=D[h++]<<A,A+=8),j=M[T&H];t:for(;;){if(T>>>=B=j>>>24,A-=B,(B=j>>>16&255)===0)X[p++]=65535&j;else{if(!(16&B)){if((64&B)==0){j=M[(65535&j)+(T&(1<<B)-1)];continue t}if(32&B){l.mode=12;break e}o.msg="invalid literal/length code",l.mode=30;break e}V=65535&j,(B&=15)&&(A<B&&(T+=D[h++]<<A,A+=8),V+=T&(1<<B)-1,T>>>=B,A-=B),A<15&&(T+=D[h++]<<A,A+=8,T+=D[h++]<<A,A+=8),j=L[T&O];n:for(;;){if(T>>>=B=j>>>24,A-=B,!(16&(B=j>>>16&255))){if((64&B)==0){j=L[(65535&j)+(T&(1<<B)-1)];continue n}o.msg="invalid distance code",l.mode=30;break e}if($=65535&j,A<(B&=15)&&(T+=D[h++]<<A,(A+=8)<B&&(T+=D[h++]<<A,A+=8)),y<($+=T&(1<<B)-1)){o.msg="invalid distance too far back",l.mode=30;break e}if(T>>>=B,A-=B,(B=p-g)<$){if(w<(B=$-B)&&l.sane){o.msg="invalid distance too far back",l.mode=30;break e}if(N=E,(k=0)===S){if(k+=x-B,B<V){for(V-=B;X[p++]=E[k++],--B;);k=p-$,N=X}}else if(S<B){if(k+=x+S-B,(B-=S)<V){for(V-=B;X[p++]=E[k++],--B;);if(k=0,S<V){for(V-=B=S;X[p++]=E[k++],--B;);k=p-$,N=X}}}else if(k+=S-B,B<V){for(V-=B;X[p++]=E[k++],--B;);k=p-$,N=X}for(;2<V;)X[p++]=N[k++],X[p++]=N[k++],X[p++]=N[k++],V-=3;V&&(X[p++]=N[k++],1<V&&(X[p++]=N[k++]))}else{for(k=p-$;X[p++]=X[k++],X[p++]=X[k++],X[p++]=X[k++],2<(V-=3););V&&(X[p++]=X[k++],1<V&&(X[p++]=X[k++]))}break}}break}}while(h<f&&p<_);h-=V=A>>3,T&=(1<<(A-=V<<3))-1,o.next_in=h,o.next_out=p,o.avail_in=h<f?f-h+5:5-(h-f),o.avail_out=p<_?_-p+257:257-(p-_),l.hold=T,l.bits=A}},{}],49:[function(n,r,s){var o=n("../utils/common"),c=n("./adler32"),l=n("./crc32"),h=n("./inffast"),f=n("./inftrees"),p=1,g=2,_=0,y=-2,x=1,w=852,S=592;function E(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(k){var N;return k&&k.state?(N=k.state,k.total_in=k.total_out=N.total=0,k.msg="",N.wrap&&(k.adler=1&N.wrap),N.mode=x,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new o.Buf32(w),N.distcode=N.distdyn=new o.Buf32(S),N.sane=1,N.back=-1,_):y}function M(k){var N;return k&&k.state?((N=k.state).wsize=0,N.whave=0,N.wnext=0,A(k)):y}function L(k,N){var D,X;return k&&k.state?(X=k.state,N<0?(D=0,N=-N):(D=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?y:(X.window!==null&&X.wbits!==N&&(X.window=null),X.wrap=D,X.wbits=N,M(k))):y}function H(k,N){var D,X;return k?(X=new T,(k.state=X).window=null,(D=L(k,N))!==_&&(k.state=null),D):y}var O,j,B=!0;function V(k){if(B){var N;for(O=new o.Buf32(512),j=new o.Buf32(32),N=0;N<144;)k.lens[N++]=8;for(;N<256;)k.lens[N++]=9;for(;N<280;)k.lens[N++]=7;for(;N<288;)k.lens[N++]=8;for(f(p,k.lens,0,288,O,0,k.work,{bits:9}),N=0;N<32;)k.lens[N++]=5;f(g,k.lens,0,32,j,0,k.work,{bits:5}),B=!1}k.lencode=O,k.lenbits=9,k.distcode=j,k.distbits=5}function $(k,N,D,X){var K,q=k.state;return q.window===null&&(q.wsize=1<<q.wbits,q.wnext=0,q.whave=0,q.window=new o.Buf8(q.wsize)),X>=q.wsize?(o.arraySet(q.window,N,D-q.wsize,q.wsize,0),q.wnext=0,q.whave=q.wsize):(X<(K=q.wsize-q.wnext)&&(K=X),o.arraySet(q.window,N,D-X,K,q.wnext),(X-=K)?(o.arraySet(q.window,N,D-X,X,0),q.wnext=X,q.whave=q.wsize):(q.wnext+=K,q.wnext===q.wsize&&(q.wnext=0),q.whave<q.wsize&&(q.whave+=K))),0}s.inflateReset=M,s.inflateReset2=L,s.inflateResetKeep=A,s.inflateInit=function(k){return H(k,15)},s.inflateInit2=H,s.inflate=function(k,N){var D,X,K,q,te,Q,ae,P,G,ee,re,se,ge,Ce,ie,le,Me,Be,Ze,st,U,fe,ue,J,Z=0,oe=new o.Buf8(4),Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return y;(D=k.state).mode===12&&(D.mode=13),te=k.next_out,K=k.output,ae=k.avail_out,q=k.next_in,X=k.input,Q=k.avail_in,P=D.hold,G=D.bits,ee=Q,re=ae,fe=_;e:for(;;)switch(D.mode){case x:if(D.wrap===0){D.mode=13;break}for(;G<16;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}if(2&D.wrap&&P===35615){oe[D.check=0]=255&P,oe[1]=P>>>8&255,D.check=l(D.check,oe,2,0),G=P=0,D.mode=2;break}if(D.flags=0,D.head&&(D.head.done=!1),!(1&D.wrap)||(((255&P)<<8)+(P>>8))%31){k.msg="incorrect header check",D.mode=30;break}if((15&P)!=8){k.msg="unknown compression method",D.mode=30;break}if(G-=4,U=8+(15&(P>>>=4)),D.wbits===0)D.wbits=U;else if(U>D.wbits){k.msg="invalid window size",D.mode=30;break}D.dmax=1<<U,k.adler=D.check=1,D.mode=512&P?10:12,G=P=0;break;case 2:for(;G<16;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}if(D.flags=P,(255&D.flags)!=8){k.msg="unknown compression method",D.mode=30;break}if(57344&D.flags){k.msg="unknown header flags set",D.mode=30;break}D.head&&(D.head.text=P>>8&1),512&D.flags&&(oe[0]=255&P,oe[1]=P>>>8&255,D.check=l(D.check,oe,2,0)),G=P=0,D.mode=3;case 3:for(;G<32;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}D.head&&(D.head.time=P),512&D.flags&&(oe[0]=255&P,oe[1]=P>>>8&255,oe[2]=P>>>16&255,oe[3]=P>>>24&255,D.check=l(D.check,oe,4,0)),G=P=0,D.mode=4;case 4:for(;G<16;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}D.head&&(D.head.xflags=255&P,D.head.os=P>>8),512&D.flags&&(oe[0]=255&P,oe[1]=P>>>8&255,D.check=l(D.check,oe,2,0)),G=P=0,D.mode=5;case 5:if(1024&D.flags){for(;G<16;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}D.length=P,D.head&&(D.head.extra_len=P),512&D.flags&&(oe[0]=255&P,oe[1]=P>>>8&255,D.check=l(D.check,oe,2,0)),G=P=0}else D.head&&(D.head.extra=null);D.mode=6;case 6:if(1024&D.flags&&(Q<(se=D.length)&&(se=Q),se&&(D.head&&(U=D.head.extra_len-D.length,D.head.extra||(D.head.extra=new Array(D.head.extra_len)),o.arraySet(D.head.extra,X,q,se,U)),512&D.flags&&(D.check=l(D.check,X,se,q)),Q-=se,q+=se,D.length-=se),D.length))break e;D.length=0,D.mode=7;case 7:if(2048&D.flags){if(Q===0)break e;for(se=0;U=X[q+se++],D.head&&U&&D.length<65536&&(D.head.name+=String.fromCharCode(U)),U&&se<Q;);if(512&D.flags&&(D.check=l(D.check,X,se,q)),Q-=se,q+=se,U)break e}else D.head&&(D.head.name=null);D.length=0,D.mode=8;case 8:if(4096&D.flags){if(Q===0)break e;for(se=0;U=X[q+se++],D.head&&U&&D.length<65536&&(D.head.comment+=String.fromCharCode(U)),U&&se<Q;);if(512&D.flags&&(D.check=l(D.check,X,se,q)),Q-=se,q+=se,U)break e}else D.head&&(D.head.comment=null);D.mode=9;case 9:if(512&D.flags){for(;G<16;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}if(P!==(65535&D.check)){k.msg="header crc mismatch",D.mode=30;break}G=P=0}D.head&&(D.head.hcrc=D.flags>>9&1,D.head.done=!0),k.adler=D.check=0,D.mode=12;break;case 10:for(;G<32;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}k.adler=D.check=E(P),G=P=0,D.mode=11;case 11:if(D.havedict===0)return k.next_out=te,k.avail_out=ae,k.next_in=q,k.avail_in=Q,D.hold=P,D.bits=G,2;k.adler=D.check=1,D.mode=12;case 12:if(N===5||N===6)break e;case 13:if(D.last){P>>>=7&G,G-=7&G,D.mode=27;break}for(;G<3;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}switch(D.last=1&P,G-=1,3&(P>>>=1)){case 0:D.mode=14;break;case 1:if(V(D),D.mode=20,N!==6)break;P>>>=2,G-=2;break e;case 2:D.mode=17;break;case 3:k.msg="invalid block type",D.mode=30}P>>>=2,G-=2;break;case 14:for(P>>>=7&G,G-=7&G;G<32;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}if((65535&P)!=(P>>>16^65535)){k.msg="invalid stored block lengths",D.mode=30;break}if(D.length=65535&P,G=P=0,D.mode=15,N===6)break e;case 15:D.mode=16;case 16:if(se=D.length){if(Q<se&&(se=Q),ae<se&&(se=ae),se===0)break e;o.arraySet(K,X,q,se,te),Q-=se,q+=se,ae-=se,te+=se,D.length-=se;break}D.mode=12;break;case 17:for(;G<14;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}if(D.nlen=257+(31&P),P>>>=5,G-=5,D.ndist=1+(31&P),P>>>=5,G-=5,D.ncode=4+(15&P),P>>>=4,G-=4,286<D.nlen||30<D.ndist){k.msg="too many length or distance symbols",D.mode=30;break}D.have=0,D.mode=18;case 18:for(;D.have<D.ncode;){for(;G<3;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}D.lens[Se[D.have++]]=7&P,P>>>=3,G-=3}for(;D.have<19;)D.lens[Se[D.have++]]=0;if(D.lencode=D.lendyn,D.lenbits=7,ue={bits:D.lenbits},fe=f(0,D.lens,0,19,D.lencode,0,D.work,ue),D.lenbits=ue.bits,fe){k.msg="invalid code lengths set",D.mode=30;break}D.have=0,D.mode=19;case 19:for(;D.have<D.nlen+D.ndist;){for(;le=(Z=D.lencode[P&(1<<D.lenbits)-1])>>>16&255,Me=65535&Z,!((ie=Z>>>24)<=G);){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}if(Me<16)P>>>=ie,G-=ie,D.lens[D.have++]=Me;else{if(Me===16){for(J=ie+2;G<J;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}if(P>>>=ie,G-=ie,D.have===0){k.msg="invalid bit length repeat",D.mode=30;break}U=D.lens[D.have-1],se=3+(3&P),P>>>=2,G-=2}else if(Me===17){for(J=ie+3;G<J;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}G-=ie,U=0,se=3+(7&(P>>>=ie)),P>>>=3,G-=3}else{for(J=ie+7;G<J;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}G-=ie,U=0,se=11+(127&(P>>>=ie)),P>>>=7,G-=7}if(D.have+se>D.nlen+D.ndist){k.msg="invalid bit length repeat",D.mode=30;break}for(;se--;)D.lens[D.have++]=U}}if(D.mode===30)break;if(D.lens[256]===0){k.msg="invalid code -- missing end-of-block",D.mode=30;break}if(D.lenbits=9,ue={bits:D.lenbits},fe=f(p,D.lens,0,D.nlen,D.lencode,0,D.work,ue),D.lenbits=ue.bits,fe){k.msg="invalid literal/lengths set",D.mode=30;break}if(D.distbits=6,D.distcode=D.distdyn,ue={bits:D.distbits},fe=f(g,D.lens,D.nlen,D.ndist,D.distcode,0,D.work,ue),D.distbits=ue.bits,fe){k.msg="invalid distances set",D.mode=30;break}if(D.mode=20,N===6)break e;case 20:D.mode=21;case 21:if(6<=Q&&258<=ae){k.next_out=te,k.avail_out=ae,k.next_in=q,k.avail_in=Q,D.hold=P,D.bits=G,h(k,re),te=k.next_out,K=k.output,ae=k.avail_out,q=k.next_in,X=k.input,Q=k.avail_in,P=D.hold,G=D.bits,D.mode===12&&(D.back=-1);break}for(D.back=0;le=(Z=D.lencode[P&(1<<D.lenbits)-1])>>>16&255,Me=65535&Z,!((ie=Z>>>24)<=G);){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}if(le&&(240&le)==0){for(Be=ie,Ze=le,st=Me;le=(Z=D.lencode[st+((P&(1<<Be+Ze)-1)>>Be)])>>>16&255,Me=65535&Z,!(Be+(ie=Z>>>24)<=G);){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}P>>>=Be,G-=Be,D.back+=Be}if(P>>>=ie,G-=ie,D.back+=ie,D.length=Me,le===0){D.mode=26;break}if(32&le){D.back=-1,D.mode=12;break}if(64&le){k.msg="invalid literal/length code",D.mode=30;break}D.extra=15&le,D.mode=22;case 22:if(D.extra){for(J=D.extra;G<J;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}D.length+=P&(1<<D.extra)-1,P>>>=D.extra,G-=D.extra,D.back+=D.extra}D.was=D.length,D.mode=23;case 23:for(;le=(Z=D.distcode[P&(1<<D.distbits)-1])>>>16&255,Me=65535&Z,!((ie=Z>>>24)<=G);){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}if((240&le)==0){for(Be=ie,Ze=le,st=Me;le=(Z=D.distcode[st+((P&(1<<Be+Ze)-1)>>Be)])>>>16&255,Me=65535&Z,!(Be+(ie=Z>>>24)<=G);){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}P>>>=Be,G-=Be,D.back+=Be}if(P>>>=ie,G-=ie,D.back+=ie,64&le){k.msg="invalid distance code",D.mode=30;break}D.offset=Me,D.extra=15&le,D.mode=24;case 24:if(D.extra){for(J=D.extra;G<J;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}D.offset+=P&(1<<D.extra)-1,P>>>=D.extra,G-=D.extra,D.back+=D.extra}if(D.offset>D.dmax){k.msg="invalid distance too far back",D.mode=30;break}D.mode=25;case 25:if(ae===0)break e;if(se=re-ae,D.offset>se){if((se=D.offset-se)>D.whave&&D.sane){k.msg="invalid distance too far back",D.mode=30;break}ge=se>D.wnext?(se-=D.wnext,D.wsize-se):D.wnext-se,se>D.length&&(se=D.length),Ce=D.window}else Ce=K,ge=te-D.offset,se=D.length;for(ae<se&&(se=ae),ae-=se,D.length-=se;K[te++]=Ce[ge++],--se;);D.length===0&&(D.mode=21);break;case 26:if(ae===0)break e;K[te++]=D.length,ae--,D.mode=21;break;case 27:if(D.wrap){for(;G<32;){if(Q===0)break e;Q--,P|=X[q++]<<G,G+=8}if(re-=ae,k.total_out+=re,D.total+=re,re&&(k.adler=D.check=D.flags?l(D.check,K,re,te-re):c(D.check,K,re,te-re)),re=ae,(D.flags?P:E(P))!==D.check){k.msg="incorrect data check",D.mode=30;break}G=P=0}D.mode=28;case 28:if(D.wrap&&D.flags){for(;G<32;){if(Q===0)break e;Q--,P+=X[q++]<<G,G+=8}if(P!==(4294967295&D.total)){k.msg="incorrect length check",D.mode=30;break}G=P=0}D.mode=29;case 29:fe=1;break e;case 30:fe=-3;break e;case 31:return-4;default:return y}return k.next_out=te,k.avail_out=ae,k.next_in=q,k.avail_in=Q,D.hold=P,D.bits=G,(D.wsize||re!==k.avail_out&&D.mode<30&&(D.mode<27||N!==4))&&$(k,k.output,k.next_out,re-k.avail_out)?(D.mode=31,-4):(ee-=k.avail_in,re-=k.avail_out,k.total_in+=ee,k.total_out+=re,D.total+=re,D.wrap&&re&&(k.adler=D.check=D.flags?l(D.check,K,re,k.next_out-re):c(D.check,K,re,k.next_out-re)),k.data_type=D.bits+(D.last?64:0)+(D.mode===12?128:0)+(D.mode===20||D.mode===15?256:0),(ee==0&&re===0||N===4)&&fe===_&&(fe=-5),fe)},s.inflateEnd=function(k){if(!k||!k.state)return y;var N=k.state;return N.window&&(N.window=null),k.state=null,_},s.inflateGetHeader=function(k,N){var D;return k&&k.state?(2&(D=k.state).wrap)==0?y:((D.head=N).done=!1,_):y},s.inflateSetDictionary=function(k,N){var D,X=N.length;return k&&k.state?(D=k.state).wrap!==0&&D.mode!==11?y:D.mode===11&&c(1,N,X,0)!==D.check?-3:$(k,N,X,X)?(D.mode=31,-4):(D.havedict=1,_):y},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,s){var o=n("../utils/common"),c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(p,g,_,y,x,w,S,E){var T,A,M,L,H,O,j,B,V,$=E.bits,k=0,N=0,D=0,X=0,K=0,q=0,te=0,Q=0,ae=0,P=0,G=null,ee=0,re=new o.Buf16(16),se=new o.Buf16(16),ge=null,Ce=0;for(k=0;k<=15;k++)re[k]=0;for(N=0;N<y;N++)re[g[_+N]]++;for(K=$,X=15;1<=X&&re[X]===0;X--);if(X<K&&(K=X),X===0)return x[w++]=20971520,x[w++]=20971520,E.bits=1,0;for(D=1;D<X&&re[D]===0;D++);for(K<D&&(K=D),k=Q=1;k<=15;k++)if(Q<<=1,(Q-=re[k])<0)return-1;if(0<Q&&(p===0||X!==1))return-1;for(se[1]=0,k=1;k<15;k++)se[k+1]=se[k]+re[k];for(N=0;N<y;N++)g[_+N]!==0&&(S[se[g[_+N]]++]=N);if(O=p===0?(G=ge=S,19):p===1?(G=c,ee-=257,ge=l,Ce-=257,256):(G=h,ge=f,-1),k=D,H=w,te=N=P=0,M=-1,L=(ae=1<<(q=K))-1,p===1&&852<ae||p===2&&592<ae)return 1;for(;;){for(j=k-te,V=S[N]<O?(B=0,S[N]):S[N]>O?(B=ge[Ce+S[N]],G[ee+S[N]]):(B=96,0),T=1<<k-te,D=A=1<<q;x[H+(P>>te)+(A-=T)]=j<<24|B<<16|V|0,A!==0;);for(T=1<<k-1;P&T;)T>>=1;if(T!==0?(P&=T-1,P+=T):P=0,N++,--re[k]==0){if(k===X)break;k=g[_+S[N]]}if(K<k&&(P&L)!==M){for(te===0&&(te=K),H+=D,Q=1<<(q=k-te);q+te<X&&!((Q-=re[q+te])<=0);)q++,Q<<=1;if(ae+=1<<q,p===1&&852<ae||p===2&&592<ae)return 1;x[M=P&L]=K<<24|q<<16|H-w|0}}return P!==0&&(x[H+P]=k-te<<24|64<<16|0),E.bits=K,0}},{"../utils/common":41}],51:[function(n,r,s){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,s){var o=n("../utils/common"),c=0,l=1;function h(Z){for(var oe=Z.length;0<=--oe;)Z[oe]=0}var f=0,p=29,g=256,_=g+1+p,y=30,x=19,w=2*_+1,S=15,E=16,T=7,A=256,M=16,L=17,H=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(_+2));h($);var k=new Array(2*y);h(k);var N=new Array(512);h(N);var D=new Array(256);h(D);var X=new Array(p);h(X);var K,q,te,Q=new Array(y);function ae(Z,oe,Se,xe,de){this.static_tree=Z,this.extra_bits=oe,this.extra_base=Se,this.elems=xe,this.max_length=de,this.has_stree=Z&&Z.length}function P(Z,oe){this.dyn_tree=Z,this.max_code=0,this.stat_desc=oe}function G(Z){return Z<256?N[Z]:N[256+(Z>>>7)]}function ee(Z,oe){Z.pending_buf[Z.pending++]=255&oe,Z.pending_buf[Z.pending++]=oe>>>8&255}function re(Z,oe,Se){Z.bi_valid>E-Se?(Z.bi_buf|=oe<<Z.bi_valid&65535,ee(Z,Z.bi_buf),Z.bi_buf=oe>>E-Z.bi_valid,Z.bi_valid+=Se-E):(Z.bi_buf|=oe<<Z.bi_valid&65535,Z.bi_valid+=Se)}function se(Z,oe,Se){re(Z,Se[2*oe],Se[2*oe+1])}function ge(Z,oe){for(var Se=0;Se|=1&Z,Z>>>=1,Se<<=1,0<--oe;);return Se>>>1}function Ce(Z,oe,Se){var xe,de,Ne=new Array(S+1),Ae=0;for(xe=1;xe<=S;xe++)Ne[xe]=Ae=Ae+Se[xe-1]<<1;for(de=0;de<=oe;de++){var Ie=Z[2*de+1];Ie!==0&&(Z[2*de]=ge(Ne[Ie]++,Ie))}}function ie(Z){var oe;for(oe=0;oe<_;oe++)Z.dyn_ltree[2*oe]=0;for(oe=0;oe<y;oe++)Z.dyn_dtree[2*oe]=0;for(oe=0;oe<x;oe++)Z.bl_tree[2*oe]=0;Z.dyn_ltree[2*A]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0}function le(Z){8<Z.bi_valid?ee(Z,Z.bi_buf):0<Z.bi_valid&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0}function Me(Z,oe,Se,xe){var de=2*oe,Ne=2*Se;return Z[de]<Z[Ne]||Z[de]===Z[Ne]&&xe[oe]<=xe[Se]}function Be(Z,oe,Se){for(var xe=Z.heap[Se],de=Se<<1;de<=Z.heap_len&&(de<Z.heap_len&&Me(oe,Z.heap[de+1],Z.heap[de],Z.depth)&&de++,!Me(oe,xe,Z.heap[de],Z.depth));)Z.heap[Se]=Z.heap[de],Se=de,de<<=1;Z.heap[Se]=xe}function Ze(Z,oe,Se){var xe,de,Ne,Ae,Ie=0;if(Z.last_lit!==0)for(;xe=Z.pending_buf[Z.d_buf+2*Ie]<<8|Z.pending_buf[Z.d_buf+2*Ie+1],de=Z.pending_buf[Z.l_buf+Ie],Ie++,xe===0?se(Z,de,oe):(se(Z,(Ne=D[de])+g+1,oe),(Ae=O[Ne])!==0&&re(Z,de-=X[Ne],Ae),se(Z,Ne=G(--xe),Se),(Ae=j[Ne])!==0&&re(Z,xe-=Q[Ne],Ae)),Ie<Z.last_lit;);se(Z,A,oe)}function st(Z,oe){var Se,xe,de,Ne=oe.dyn_tree,Ae=oe.stat_desc.static_tree,Ie=oe.stat_desc.has_stree,qe=oe.stat_desc.elems,wt=-1;for(Z.heap_len=0,Z.heap_max=w,Se=0;Se<qe;Se++)Ne[2*Se]!==0?(Z.heap[++Z.heap_len]=wt=Se,Z.depth[Se]=0):Ne[2*Se+1]=0;for(;Z.heap_len<2;)Ne[2*(de=Z.heap[++Z.heap_len]=wt<2?++wt:0)]=1,Z.depth[de]=0,Z.opt_len--,Ie&&(Z.static_len-=Ae[2*de+1]);for(oe.max_code=wt,Se=Z.heap_len>>1;1<=Se;Se--)Be(Z,Ne,Se);for(de=qe;Se=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],Be(Z,Ne,1),xe=Z.heap[1],Z.heap[--Z.heap_max]=Se,Z.heap[--Z.heap_max]=xe,Ne[2*de]=Ne[2*Se]+Ne[2*xe],Z.depth[de]=(Z.depth[Se]>=Z.depth[xe]?Z.depth[Se]:Z.depth[xe])+1,Ne[2*Se+1]=Ne[2*xe+1]=de,Z.heap[1]=de++,Be(Z,Ne,1),2<=Z.heap_len;);Z.heap[--Z.heap_max]=Z.heap[1],(function(it,Qn){var bi,ir,vi,xt,nn,Kn,Et=Qn.dyn_tree,Za=Qn.max_code,$s=Qn.stat_desc.static_tree,ec=Qn.stat_desc.has_stree,Pr=Qn.stat_desc.extra_bits,xi=Qn.stat_desc.extra_base,Ut=Qn.stat_desc.max_length,sr=0;for(xt=0;xt<=S;xt++)it.bl_count[xt]=0;for(Et[2*it.heap[it.heap_max]+1]=0,bi=it.heap_max+1;bi<w;bi++)Ut<(xt=Et[2*Et[2*(ir=it.heap[bi])+1]+1]+1)&&(xt=Ut,sr++),Et[2*ir+1]=xt,Za<ir||(it.bl_count[xt]++,nn=0,xi<=ir&&(nn=Pr[ir-xi]),Kn=Et[2*ir],it.opt_len+=Kn*(xt+nn),ec&&(it.static_len+=Kn*($s[2*ir+1]+nn)));if(sr!==0){do{for(xt=Ut-1;it.bl_count[xt]===0;)xt--;it.bl_count[xt]--,it.bl_count[xt+1]+=2,it.bl_count[Ut]--,sr-=2}while(0<sr);for(xt=Ut;xt!==0;xt--)for(ir=it.bl_count[xt];ir!==0;)Za<(vi=it.heap[--bi])||(Et[2*vi+1]!==xt&&(it.opt_len+=(xt-Et[2*vi+1])*Et[2*vi],Et[2*vi+1]=xt),ir--)}})(Z,oe),Ce(Ne,wt,Z.bl_count)}function U(Z,oe,Se){var xe,de,Ne=-1,Ae=oe[1],Ie=0,qe=7,wt=4;for(Ae===0&&(qe=138,wt=3),oe[2*(Se+1)+1]=65535,xe=0;xe<=Se;xe++)de=Ae,Ae=oe[2*(xe+1)+1],++Ie<qe&&de===Ae||(Ie<wt?Z.bl_tree[2*de]+=Ie:de!==0?(de!==Ne&&Z.bl_tree[2*de]++,Z.bl_tree[2*M]++):Ie<=10?Z.bl_tree[2*L]++:Z.bl_tree[2*H]++,Ne=de,wt=(Ie=0)===Ae?(qe=138,3):de===Ae?(qe=6,3):(qe=7,4))}function fe(Z,oe,Se){var xe,de,Ne=-1,Ae=oe[1],Ie=0,qe=7,wt=4;for(Ae===0&&(qe=138,wt=3),xe=0;xe<=Se;xe++)if(de=Ae,Ae=oe[2*(xe+1)+1],!(++Ie<qe&&de===Ae)){if(Ie<wt)for(;se(Z,de,Z.bl_tree),--Ie!=0;);else de!==0?(de!==Ne&&(se(Z,de,Z.bl_tree),Ie--),se(Z,M,Z.bl_tree),re(Z,Ie-3,2)):Ie<=10?(se(Z,L,Z.bl_tree),re(Z,Ie-3,3)):(se(Z,H,Z.bl_tree),re(Z,Ie-11,7));Ne=de,wt=(Ie=0)===Ae?(qe=138,3):de===Ae?(qe=6,3):(qe=7,4)}}h(Q);var ue=!1;function J(Z,oe,Se,xe){re(Z,(f<<1)+(xe?1:0),3),(function(de,Ne,Ae,Ie){le(de),ee(de,Ae),ee(de,~Ae),o.arraySet(de.pending_buf,de.window,Ne,Ae,de.pending),de.pending+=Ae})(Z,oe,Se)}s._tr_init=function(Z){ue||((function(){var oe,Se,xe,de,Ne,Ae=new Array(S+1);for(de=xe=0;de<p-1;de++)for(X[de]=xe,oe=0;oe<1<<O[de];oe++)D[xe++]=de;for(D[xe-1]=de,de=Ne=0;de<16;de++)for(Q[de]=Ne,oe=0;oe<1<<j[de];oe++)N[Ne++]=de;for(Ne>>=7;de<y;de++)for(Q[de]=Ne<<7,oe=0;oe<1<<j[de]-7;oe++)N[256+Ne++]=de;for(Se=0;Se<=S;Se++)Ae[Se]=0;for(oe=0;oe<=143;)$[2*oe+1]=8,oe++,Ae[8]++;for(;oe<=255;)$[2*oe+1]=9,oe++,Ae[9]++;for(;oe<=279;)$[2*oe+1]=7,oe++,Ae[7]++;for(;oe<=287;)$[2*oe+1]=8,oe++,Ae[8]++;for(Ce($,_+1,Ae),oe=0;oe<y;oe++)k[2*oe+1]=5,k[2*oe]=ge(oe,5);K=new ae($,O,g+1,_,S),q=new ae(k,j,0,y,S),te=new ae(new Array(0),B,0,x,T)})(),ue=!0),Z.l_desc=new P(Z.dyn_ltree,K),Z.d_desc=new P(Z.dyn_dtree,q),Z.bl_desc=new P(Z.bl_tree,te),Z.bi_buf=0,Z.bi_valid=0,ie(Z)},s._tr_stored_block=J,s._tr_flush_block=function(Z,oe,Se,xe){var de,Ne,Ae=0;0<Z.level?(Z.strm.data_type===2&&(Z.strm.data_type=(function(Ie){var qe,wt=4093624447;for(qe=0;qe<=31;qe++,wt>>>=1)if(1&wt&&Ie.dyn_ltree[2*qe]!==0)return c;if(Ie.dyn_ltree[18]!==0||Ie.dyn_ltree[20]!==0||Ie.dyn_ltree[26]!==0)return l;for(qe=32;qe<g;qe++)if(Ie.dyn_ltree[2*qe]!==0)return l;return c})(Z)),st(Z,Z.l_desc),st(Z,Z.d_desc),Ae=(function(Ie){var qe;for(U(Ie,Ie.dyn_ltree,Ie.l_desc.max_code),U(Ie,Ie.dyn_dtree,Ie.d_desc.max_code),st(Ie,Ie.bl_desc),qe=x-1;3<=qe&&Ie.bl_tree[2*V[qe]+1]===0;qe--);return Ie.opt_len+=3*(qe+1)+5+5+4,qe})(Z),de=Z.opt_len+3+7>>>3,(Ne=Z.static_len+3+7>>>3)<=de&&(de=Ne)):de=Ne=Se+5,Se+4<=de&&oe!==-1?J(Z,oe,Se,xe):Z.strategy===4||Ne===de?(re(Z,2+(xe?1:0),3),Ze(Z,$,k)):(re(Z,4+(xe?1:0),3),(function(Ie,qe,wt,it){var Qn;for(re(Ie,qe-257,5),re(Ie,wt-1,5),re(Ie,it-4,4),Qn=0;Qn<it;Qn++)re(Ie,Ie.bl_tree[2*V[Qn]+1],3);fe(Ie,Ie.dyn_ltree,qe-1),fe(Ie,Ie.dyn_dtree,wt-1)})(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,Ae+1),Ze(Z,Z.dyn_ltree,Z.dyn_dtree)),ie(Z),xe&&le(Z)},s._tr_tally=function(Z,oe,Se){return Z.pending_buf[Z.d_buf+2*Z.last_lit]=oe>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&oe,Z.pending_buf[Z.l_buf+Z.last_lit]=255&Se,Z.last_lit++,oe===0?Z.dyn_ltree[2*Se]++:(Z.matches++,oe--,Z.dyn_ltree[2*(D[Se]+g+1)]++,Z.dyn_dtree[2*G(oe)]++),Z.last_lit===Z.lit_bufsize-1},s._tr_align=function(Z){re(Z,2,3),se(Z,A,$),(function(oe){oe.bi_valid===16?(ee(oe,oe.bi_buf),oe.bi_buf=0,oe.bi_valid=0):8<=oe.bi_valid&&(oe.pending_buf[oe.pending++]=255&oe.bi_buf,oe.bi_buf>>=8,oe.bi_valid-=8)})(Z)}},{"../utils/common":41}],53:[function(n,r,s){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,s){(function(o){(function(c,l){if(!c.setImmediate){var h,f,p,g,_=1,y={},x=!1,w=c.document,S=Object.getPrototypeOf&&Object.getPrototypeOf(c);S=S&&S.setTimeout?S:c,h={}.toString.call(c.process)==="[object process]"?function(M){process.nextTick(function(){T(M)})}:(function(){if(c.postMessage&&!c.importScripts){var M=!0,L=c.onmessage;return c.onmessage=function(){M=!1},c.postMessage("","*"),c.onmessage=L,M}})()?(g="setImmediate$"+Math.random()+"$",c.addEventListener?c.addEventListener("message",A,!1):c.attachEvent("onmessage",A),function(M){c.postMessage(g+M,"*")}):c.MessageChannel?((p=new MessageChannel).port1.onmessage=function(M){T(M.data)},function(M){p.port2.postMessage(M)}):w&&"onreadystatechange"in w.createElement("script")?(f=w.documentElement,function(M){var L=w.createElement("script");L.onreadystatechange=function(){T(M),L.onreadystatechange=null,f.removeChild(L),L=null},f.appendChild(L)}):function(M){setTimeout(T,0,M)},S.setImmediate=function(M){typeof M!="function"&&(M=new Function(""+M));for(var L=new Array(arguments.length-1),H=0;H<L.length;H++)L[H]=arguments[H+1];var O={callback:M,args:L};return y[_]=O,h(_),_++},S.clearImmediate=E}function E(M){delete y[M]}function T(M){if(x)setTimeout(T,0,M);else{var L=y[M];if(L){x=!0;try{(function(H){var O=H.callback,j=H.args;switch(j.length){case 0:O();break;case 1:O(j[0]);break;case 2:O(j[0],j[1]);break;case 3:O(j[0],j[1],j[2]);break;default:O.apply(l,j)}})(L)}finally{E(M),x=!1}}}}function A(M){M.source===c&&typeof M.data=="string"&&M.data.indexOf(g)===0&&T(+M.data.slice(g.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Jh<"u"?Jh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(ly)),ly.exports}var p4=g4();const Fm=gR(p4);function y4({currentUser:t,budgetId:e}){const[n,r]=R.useState(!1),[s,o]=R.useState(null),[c,l]=R.useState(null);async function h(){if(!t){l("Must be logged in to download budget");return}if(!e){l("No budget selected");return}r(!0),l(null),o({phase:"reading",current:0,total:1,percentComplete:0});try{o({phase:"reading",current:0,total:1,percentComplete:10});const{exists:f,data:p}=await vt("budgets",e,`downloading budget ${e}`);if(!f||!p){l(`Budget ${e} not found`);return}const g=await _A(e,"download-budget");let _=null;try{const{exists:k,data:N}=await vt("payees",e,`downloading payees for budget ${e}`);k&&N&&(_=N)}catch(k){console.warn(`Could not read payees for budget ${e}:`,k)}o({phase:"processing",current:0,total:g.length+1,percentComplete:20});const y=new Fm,x=new Date,w=x.toISOString().split("T")[0],S=`budget_${e}`,{accounts:E,account_groups:T,categories:A,category_groups:M,...L}=p;y.file(`${S}/budget.json`,JSON.stringify(L,null,2)),y.file(`${S}/accounts.json`,JSON.stringify(E||{},null,2)),y.file(`${S}/account_groups.json`,JSON.stringify(T||{},null,2)),y.file(`${S}/categories.json`,JSON.stringify(A||{},null,2)),y.file(`${S}/category_groups.json`,JSON.stringify(M||[],null,2)),_&&y.file(`${S}/payees.json`,JSON.stringify(_,null,2));let H=0;for(const k of g){const N=k.data,D=`${S}/months/month_${N.year}_${String(N.month).padStart(2,"0")}`,X={};if(N.are_allocations_finalized&&N.category_balances)for(const K of N.category_balances)K.allocated!==void 0&&(X[K.category_id]=K.allocated);y.file(`${D}/metadata.json`,JSON.stringify({budget_id:N.budget_id,year_month_ordinal:N.year_month_ordinal,year:N.year,month:N.month,total_income:N.total_income,previous_month_income:N.previous_month_income,total_expenses:N.total_expenses,are_allocations_finalized:N.are_allocations_finalized,created_at:N.created_at,updated_at:N.updated_at,...N.are_allocations_finalized&&{allocations:X},downloaded_at:x.toISOString()},null,2)),y.file(`${D}/income.json`,JSON.stringify(N.income||[],null,2)),y.file(`${D}/expenses.json`,JSON.stringify(N.expenses||[],null,2)),y.file(`${D}/transfers.json`,JSON.stringify(N.transfers||[],null,2)),y.file(`${D}/adjustments.json`,JSON.stringify(N.adjustments||[],null,2)),y.file(`${D}/account_balances.json`,JSON.stringify(N.account_balances||[],null,2)),y.file(`${D}/category_balances.json`,JSON.stringify(N.category_balances||[],null,2)),H++,o({phase:"processing",current:H,total:g.length,percentComplete:20+Math.round(H/g.length*60)})}o({phase:"zipping",current:0,total:1,percentComplete:80});const O=await y.generateAsync({type:"blob"});o({phase:"complete",current:1,total:1,percentComplete:100});const B=(p.name||"budget").replace(/[^a-z0-9]/gi,"_").toLowerCase(),V=URL.createObjectURL(O),$=document.createElement("a");$.href=V,$.download=`${w}_${B}_${e}.zip`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(V)}catch(f){l(f instanceof Error?f.message:"Unknown error during download")}finally{r(!1),o(null)}}return{isDownloading:n,progress:s,error:c,downloadBudget:h}}async function _4(t){const n=await new Fm().loadAsync(t),r=new Set,s=new Set;for(const[o]of Object.entries(n.files)){const c=o.match(/^budget_([^/]+)\//);if(c){const l=c[1];r.add(l),o.match(/^budget_([^/]+)\/months\/month_\d{4}_\d{2}\//)&&s.add(o.split("/months/")[1].split("/")[0])}}return{budgetsFound:r.size,monthsFound:s.size,payeesFound:r.size,budgetsToRestore:Array.from(r)}}async function b4(t,e,n){const s=`${`${e}/months/`}${n}/`,o=`${s}metadata.json`,c=t.files[o];if(!c)return null;const l=await c.async("string"),h=JSON.parse(l),{downloaded_at:f,allocations:p,...g}=h,_=async S=>{const E=`${s}${S}`,T=t.files[E];if(T){const A=await T.async("string");return JSON.parse(A)}return[]},y={budget_id:g.budget_id,year:g.year,month:g.month,year_month_ordinal:g.year_month_ordinal,total_income:0,previous_month_income:0,total_expenses:0,are_allocations_finalized:g.are_allocations_finalized??!1,created_at:g.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),income:await _("income.json"),expenses:await _("expenses.json"),transfers:await _("transfers.json"),adjustments:await _("adjustments.json"),account_balances:[],category_balances:[]},x=Jr(y);let w=p0(x);if(h.are_allocations_finalized&&p!==void 0){const S=new Map;for(const A of w.category_balances)S.set(A.category_id,A);const E=[],T=new Set;for(const A of w.category_balances){const M=p[A.category_id];if(M!==void 0){const L=Ee(M);E.push({...A,allocated:L,end_balance:Ee(A.start_balance+L+A.spent+A.transfers+A.adjustments)})}else E.push(A);T.add(A.category_id)}for(const[A,M]of Object.entries(p))if(!T.has(A)){const L=Ee(M);E.push({category_id:A,start_balance:0,allocated:L,spent:0,transfers:0,adjustments:0,end_balance:L})}w={...w,category_balances:E}}return{budgetId:g.budget_id,year:g.year,month:g.month,data:w}}async function v4(t,e){const n=`budget_${e}`,r=async H=>{const O=t.files[H];if(O){const j=await O.async("string");return JSON.parse(j)}return null},s=`${n}/budget.json`,o=`${n}/accounts.json`,c=`${n}/account_groups.json`,l=`${n}/categories.json`,h=`${n}/category_groups.json`,f=await r(s);if(!f)throw new Error("Missing required file budget.json");const p=await r(o)||{},g=await r(c)||{},_=await r(l)||{},y=await r(h)||[],x=Jr({...f,accounts:p,account_groups:g,categories:_,category_groups:y}),w={budgetId:e,data:x},S=`${n}/payees.json`,E=await r(S);let T=null;if(E){const H={...E,budget_id:e,updated_at:new Date().toISOString()};T={collectionPath:"payees",docId:e,data:Jr(H)}}const A=`${n}/months/`,M=new Set;for(const H of Object.keys(t.files))if(H.startsWith(A)&&H.includes("/metadata.json")){const O=H.split("/months/")[1].split("/")[0];M.add(O)}const L=[];for(const H of M){const O=await b4(t,n,H);O&&L.push(O)}return{budgetUpdate:w,monthUpdates:L,payeeWrite:T}}function x4({currentUser:t}){const[e,n]=R.useState(!1),[r,s]=R.useState(!1),[o,c]=R.useState(null),[l,h]=R.useState(null),[f,p]=R.useState(null),[g,_]=R.useState(null);async function y(w){if(!t){p("Must be logged in to upload budget");return}n(!0),p(null),c(null),_(null);try{const S=await _4(w);c(S)}catch(S){p(S instanceof Error?S.message:"Failed to parse zip file")}finally{n(!1)}}async function x(w){if(!t){p("Must be logged in to upload budget");return}if(!o){p("Must scan file first");return}s(!0),p(null),h({phase:"parsing",current:0,total:1,percentComplete:0});const S=[];let E=0,T=0,A=0;try{h({phase:"parsing",current:0,total:1,percentComplete:10});const L=await new Fm().loadAsync(w);h({phase:"validating",current:0,total:1,percentComplete:20}),h({phase:"uploading",current:0,total:o.budgetsToRestore.length,percentComplete:30});const H=[],O=[],j=[];for(let B=0;B<o.budgetsToRestore.length;B++){const V=o.budgetsToRestore[B];try{const{budgetUpdate:$,monthUpdates:k,payeeWrite:N}=await v4(L,V);H.push($),O.push(...k),N&&j.push(N),h({phase:"uploading",current:B+1,total:o.budgetsToRestore.length,percentComplete:30+Math.round((B+1)/o.budgetsToRestore.length*50)})}catch($){S.push(`Budget ${V}: ${$ instanceof Error?$.message:String($)}`)}}if(h({phase:"uploading",current:o.budgetsToRestore.length,total:o.budgetsToRestore.length,percentComplete:80}),H.length>0)try{console.log(`[Upload] Writing ${H.length} budget(s)...`),await zm(H,"upload-budget"),E=H.length,console.log(`[Upload] Successfully wrote ${E} budget(s)`)}catch(B){const V=`Failed to write budgets: ${B instanceof Error?B.message:String(B)}`;throw console.error(`[Upload] ${V}`,B),S.push(V),B}if(j.length>0)try{console.log(`[Upload] Writing ${j.length} payee doc(s)...`),await Rm(j,"upload-budget: writing payees"),A=j.length,console.log(`[Upload] Successfully wrote ${A} payee doc(s)`)}catch(B){const V=`Failed to write payees: ${B instanceof Error?B.message:String(B)}`;throw console.error(`[Upload] ${V}`,B),S.push(V),B}if(O.length>0)try{console.log(`[Upload] Writing ${O.length} month(s) and recalculating...`),await vA(O,"upload-budget"),T=O.length,console.log(`[Upload] Successfully wrote ${T} month(s)`)}catch(B){const V=`Failed to write months: ${B instanceof Error?B.message:String(B)}`;throw console.error(`[Upload] ${V}`,B),S.push(V),B}h({phase:"complete",current:1,total:1,percentComplete:100}),_({success:S.length===0,budgetsRestored:E,monthsRestored:T,payeesRestored:A,errors:S}),console.log("[Upload] Clearing all caches after upload..."),ns()}catch(M){const L=M instanceof Error?M.message:"Unknown error during upload";console.error("[Upload] Upload failed with error:",M),console.error("[Upload] Error details:",{errorMessage:L,budgetsRestored:E,monthsRestored:T,payeesRestored:A,errorsSoFar:S}),p(L),_({success:!1,budgetsRestored:E,monthsRestored:T,payeesRestored:A,errors:[...S,L]}),console.log("[Upload] Clearing all caches after failed upload (partial writes possible)..."),ns()}finally{s(!1),h(null)}}return{isScanning:e,isUploading:r,status:o,progress:l,error:f,result:g,scanZipFile:y,uploadBudget:x}}const Jf={account_main_checking:{nickname:"Main Checking",description:"Primary checking account for daily expenses",initialBalance:5e3,account_group_id:"account_group_checking",on_budget:!0,is_active:!0,is_income_account:!0,is_income_default:!0,is_outgo_account:!0,is_outgo_default:!1,sort_order:0},account_emergency_fund:{nickname:"Emergency Fund",description:"6-month emergency savings",initialBalance:1e4,account_group_id:"account_group_savings",on_budget:!0,is_active:!0,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,sort_order:0},account_vacation_fund:{nickname:"Vacation Fund",description:"Saving for trips and travel",initialBalance:2500,account_group_id:"account_group_savings",on_budget:!0,is_active:!0,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,sort_order:1},account_credit_card:{nickname:"Rewards Credit Card",description:"Primary credit card for purchases",initialBalance:-1200,account_group_id:"account_group_credit_cards",on_budget:!0,is_active:!0,is_income_account:!1,is_income_default:!1,is_outgo_account:!0,is_outgo_default:!0,sort_order:0},account_401k:{nickname:"401K Retirement",description:"Employer retirement account",initialBalance:45e3,account_group_id:"account_group_retirement",on_budget:!1,is_active:!0,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,sort_order:0}},EA={category_rent:{name:"Rent",category_group_id:"group_housing",is_hidden:!1,sort_order:0,default_monthly_amount:1500,default_monthly_type:"fixed"},category_utilities:{name:"Utilities",category_group_id:"group_housing",is_hidden:!1,sort_order:1,default_monthly_amount:150,default_monthly_type:"fixed"},category_groceries:{name:"Groceries",category_group_id:"group_essentials",is_hidden:!1,sort_order:0,default_monthly_amount:550,default_monthly_type:"fixed"},category_transportation:{name:"Transportation",category_group_id:"group_essentials",is_hidden:!1,sort_order:1,default_monthly_amount:120,default_monthly_type:"fixed"},category_subscriptions:{name:"Subscriptions",category_group_id:"group_essentials",is_hidden:!1,sort_order:2,default_monthly_amount:30,default_monthly_type:"fixed"},category_phone_internet:{name:"Phone & Internet",category_group_id:"group_essentials",is_hidden:!1,sort_order:3,default_monthly_amount:120,default_monthly_type:"fixed"},category_entertainment:{name:"Entertainment",category_group_id:"group_lifestyle",is_hidden:!1,sort_order:0,default_monthly_amount:1,default_monthly_type:"percentage"},category_dining_out:{name:"Dining Out",category_group_id:"group_lifestyle",is_hidden:!1,sort_order:1,default_monthly_amount:100,default_monthly_type:"fixed"},category_personal:{name:"Personal",category_group_id:"group_lifestyle",is_hidden:!1,sort_order:2,default_monthly_amount:75,default_monthly_type:"fixed"},category_clothing:{name:"Clothing",category_group_id:"group_lifestyle",is_hidden:!1,sort_order:3,default_monthly_amount:100,default_monthly_type:"fixed"}},w4={group_housing:{name:"Housing",is_hidden:!1,sort_order:0},group_essentials:{name:"Essentials",is_hidden:!1,sort_order:1},group_lifestyle:{name:"Lifestyle",is_hidden:!1,sort_order:2}},S4={account_group_checking:{name:"Checking",on_budget:null,is_active:null,sort_order:0},account_group_savings:{name:"Savings",on_budget:null,is_active:null,sort_order:1},account_group_credit_cards:{name:"Credit Cards",on_budget:null,is_active:null,sort_order:2},account_group_retirement:{name:"Retirement",on_budget:null,is_active:null,sort_order:3},ungrouped_accounts:{name:"Ungrouped",on_budget:null,is_active:null,sort_order:999}},C4=[{name:"ABC Corp",category_id:null},{name:"Side Gig Client",category_id:null},{name:"Interest",category_id:null},{name:"Landlord",category_id:"category_rent"},{name:"Electric Company",category_id:"category_utilities"},{name:"Water Utility",category_id:"category_utilities"},{name:"Grocery Mart",category_id:"category_groceries"},{name:"Costco",category_id:"category_groceries"},{name:"Shell Gas",category_id:"category_transportation"},{name:"Netflix",category_id:"category_subscriptions"},{name:"Spotify",category_id:"category_subscriptions"},{name:"AT&T",category_id:"category_phone_internet"},{name:"Comcast",category_id:"category_phone_internet"},{name:"Movie Theater",category_id:"category_entertainment"},{name:"Local Restaurant",category_id:"category_dining_out"},{name:"Coffee Shop",category_id:"category_dining_out"},{name:"Amazon",category_id:"category_personal"},{name:"Target",category_id:"category_clothing"}],E4=[{monthOffset:-5,areAllocationsFinalized:!0,income:[{idSuffix:"01",account_id:"account_main_checking",payee:"ABC Corp",description:"Paycheck",amount:2200,day:15,cleared:!0},{idSuffix:"02",account_id:"account_main_checking",payee:"ABC Corp",description:"Paycheck",amount:2200,day:28,cleared:!0},{idSuffix:"03",account_id:"account_main_checking",payee:"Side Gig Client",description:"Freelance work",amount:450,day:20,cleared:!0},{idSuffix:"04",account_id:"account_emergency_fund",payee:"Interest",description:"Savings interest",amount:12.5,day:28,cleared:!0}],expenses:[{idSuffix:"01",account_id:"account_main_checking",payee:"Landlord",description:"Rent",amount:-1500,category_id:"category_rent",day:1,cleared:!0},{idSuffix:"02",account_id:"account_credit_card",payee:"Electric Company",description:"",amount:-95.42,category_id:"category_utilities",day:5,cleared:!0},{idSuffix:"03",account_id:"account_credit_card",payee:"Water Utility",description:"",amount:-45.18,category_id:"category_utilities",day:8,cleared:!0},{idSuffix:"04",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-127.84,category_id:"category_groceries",day:3,cleared:!0},{idSuffix:"05",account_id:"account_credit_card",payee:"Costco",description:"Monthly stock up",amount:-189.45,category_id:"category_groceries",day:10,cleared:!0},{idSuffix:"06",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-98.32,category_id:"category_groceries",day:17,cleared:!0},{idSuffix:"07",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-112.67,category_id:"category_groceries",day:24,cleared:!0},{idSuffix:"08",account_id:"account_credit_card",payee:"Shell Gas",description:"",amount:-48.92,category_id:"category_transportation",day:6,cleared:!0},{idSuffix:"09",account_id:"account_credit_card",payee:"Shell Gas",description:"",amount:-52.15,category_id:"category_transportation",day:20,cleared:!0},{idSuffix:"10",account_id:"account_credit_card",payee:"Netflix",description:"",amount:-15.99,category_id:"category_subscriptions",day:1,cleared:!0},{idSuffix:"11",account_id:"account_credit_card",payee:"Spotify",description:"",amount:-11.99,category_id:"category_subscriptions",day:1,cleared:!0},{idSuffix:"12",account_id:"account_credit_card",payee:"AT&T",description:"Phone bill",amount:-65,category_id:"category_phone_internet",day:12,cleared:!0},{idSuffix:"13",account_id:"account_credit_card",payee:"Comcast",description:"Internet",amount:-55,category_id:"category_phone_internet",day:15,cleared:!0},{idSuffix:"14",account_id:"account_credit_card",payee:"Movie Theater",description:"Date night",amount:-32.5,category_id:"category_entertainment",day:18,cleared:!0},{idSuffix:"15",account_id:"account_credit_card",payee:"Local Restaurant",description:"Dinner out",amount:-67.89,category_id:"category_dining_out",day:11,cleared:!0},{idSuffix:"16",account_id:"account_credit_card",payee:"Coffee Shop",description:"",amount:-12.45,category_id:"category_dining_out",day:14,cleared:!0},{idSuffix:"17",account_id:"account_credit_card",payee:"Local Restaurant",description:"Lunch",amount:-24.3,category_id:"category_dining_out",day:22,cleared:!0},{idSuffix:"18",account_id:"account_credit_card",payee:"Amazon",description:"Books",amount:-34.99,category_id:"category_personal",day:9,cleared:!0},{idSuffix:"19",account_id:"account_credit_card",payee:"Target",description:"Winter jacket",amount:-79.99,category_id:"category_clothing",day:25,cleared:!0}],transfers:[{idSuffix:"01",from_account_id:"account_main_checking",to_account_id:"account_emergency_fund",from_category_id:"no_category",to_category_id:"no_category",amount:200,description:"Monthly savings",day:20},{idSuffix:"02",from_account_id:"account_main_checking",to_account_id:"account_vacation_fund",from_category_id:"no_category",to_category_id:"no_category",amount:100,description:"Vacation savings",day:20},{idSuffix:"03",from_account_id:"account_main_checking",to_account_id:"account_credit_card",from_category_id:"no_category",to_category_id:"no_category",amount:1200,description:"Credit card payment",day:25}],adjustments:[],allocations:[{category_id:"category_rent",amount:1500},{category_id:"category_utilities",amount:150},{category_id:"category_groceries",amount:550},{category_id:"category_transportation",amount:120},{category_id:"category_subscriptions",amount:30},{category_id:"category_phone_internet",amount:120},{category_id:"category_entertainment",amount:49},{category_id:"category_dining_out",amount:100},{category_id:"category_personal",amount:75},{category_id:"category_clothing",amount:100}]},{monthOffset:-4,areAllocationsFinalized:!0,income:[{idSuffix:"01",account_id:"account_main_checking",payee:"ABC Corp",description:"Paycheck",amount:2200,day:15,cleared:!0},{idSuffix:"02",account_id:"account_main_checking",payee:"ABC Corp",description:"Paycheck",amount:2200,day:28,cleared:!0},{idSuffix:"03",account_id:"account_emergency_fund",payee:"Interest",description:"Savings interest",amount:13.25,day:28,cleared:!0}],expenses:[{idSuffix:"01",account_id:"account_main_checking",payee:"Landlord",description:"Rent",amount:-1500,category_id:"category_rent",day:1,cleared:!0},{idSuffix:"02",account_id:"account_credit_card",payee:"Electric Company",description:"",amount:-102.18,category_id:"category_utilities",day:5,cleared:!0},{idSuffix:"03",account_id:"account_credit_card",payee:"Water Utility",description:"",amount:-43.92,category_id:"category_utilities",day:8,cleared:!0},{idSuffix:"04",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-134.56,category_id:"category_groceries",day:4,cleared:!0},{idSuffix:"05",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-108.23,category_id:"category_groceries",day:11,cleared:!0},{idSuffix:"06",account_id:"account_credit_card",payee:"Costco",description:"Monthly stock up",amount:-167.89,category_id:"category_groceries",day:15,cleared:!0},{idSuffix:"07",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-92.45,category_id:"category_groceries",day:25,cleared:!0},{idSuffix:"08",account_id:"account_credit_card",payee:"Shell Gas",description:"",amount:-45.67,category_id:"category_transportation",day:7,cleared:!0},{idSuffix:"09",account_id:"account_credit_card",payee:"Shell Gas",description:"",amount:-51.23,category_id:"category_transportation",day:21,cleared:!0},{idSuffix:"10",account_id:"account_credit_card",payee:"Netflix",description:"",amount:-15.99,category_id:"category_subscriptions",day:1,cleared:!0},{idSuffix:"11",account_id:"account_credit_card",payee:"Spotify",description:"",amount:-11.99,category_id:"category_subscriptions",day:1,cleared:!0},{idSuffix:"12",account_id:"account_credit_card",payee:"AT&T",description:"Phone bill",amount:-65,category_id:"category_phone_internet",day:12,cleared:!0},{idSuffix:"13",account_id:"account_credit_card",payee:"Comcast",description:"Internet",amount:-55,category_id:"category_phone_internet",day:15,cleared:!0},{idSuffix:"14",account_id:"account_credit_card",payee:"Local Restaurant",description:"Valentine dinner",amount:-89.5,category_id:"category_dining_out",day:14,cleared:!0},{idSuffix:"15",account_id:"account_credit_card",payee:"Coffee Shop",description:"",amount:-15.8,category_id:"category_dining_out",day:19,cleared:!0}],transfers:[{idSuffix:"01",from_account_id:"account_main_checking",to_account_id:"account_emergency_fund",from_category_id:"no_category",to_category_id:"no_category",amount:200,description:"Monthly savings",day:20},{idSuffix:"02",from_account_id:"account_main_checking",to_account_id:"account_vacation_fund",from_category_id:"no_category",to_category_id:"no_category",amount:150,description:"Vacation savings",day:20},{idSuffix:"03",from_account_id:"account_main_checking",to_account_id:"account_credit_card",from_category_id:"no_category",to_category_id:"no_category",amount:1100,description:"Credit card payment",day:25}],adjustments:[],allocations:[{category_id:"category_rent",amount:1500},{category_id:"category_utilities",amount:150},{category_id:"category_groceries",amount:550},{category_id:"category_transportation",amount:120},{category_id:"category_subscriptions",amount:30},{category_id:"category_phone_internet",amount:120},{category_id:"category_entertainment",amount:44},{category_id:"category_dining_out",amount:100},{category_id:"category_personal",amount:75},{category_id:"category_clothing",amount:100}]},{monthOffset:-3,areAllocationsFinalized:!0,income:[{idSuffix:"01",account_id:"account_main_checking",payee:"ABC Corp",description:"Paycheck",amount:2200,day:15,cleared:!0},{idSuffix:"02",account_id:"account_main_checking",payee:"ABC Corp",description:"Paycheck",amount:2200,day:28,cleared:!0},{idSuffix:"03",account_id:"account_main_checking",payee:"Side Gig Client",description:"Freelance project",amount:600,day:10,cleared:!0},{idSuffix:"04",account_id:"account_emergency_fund",payee:"Interest",description:"Savings interest",amount:13.75,day:28,cleared:!0}],expenses:[{idSuffix:"01",account_id:"account_main_checking",payee:"Landlord",description:"Rent",amount:-1500,category_id:"category_rent",day:1,cleared:!0},{idSuffix:"02",account_id:"account_credit_card",payee:"Electric Company",description:"",amount:-88.76,category_id:"category_utilities",day:5,cleared:!0},{idSuffix:"03",account_id:"account_credit_card",payee:"Water Utility",description:"",amount:-44.5,category_id:"category_utilities",day:8,cleared:!0},{idSuffix:"04",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-118.92,category_id:"category_groceries",day:2,cleared:!0},{idSuffix:"05",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-125.34,category_id:"category_groceries",day:9,cleared:!0},{idSuffix:"06",account_id:"account_credit_card",payee:"Costco",description:"Monthly stock up",amount:-198.67,category_id:"category_groceries",day:16,cleared:!0},{idSuffix:"07",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-87.21,category_id:"category_groceries",day:23,cleared:!0},{idSuffix:"08",account_id:"account_credit_card",payee:"Shell Gas",description:"",amount:-49.88,category_id:"category_transportation",day:5,cleared:!0},{idSuffix:"09",account_id:"account_credit_card",payee:"Shell Gas",description:"",amount:-53.42,category_id:"category_transportation",day:19,cleared:!0},{idSuffix:"10",account_id:"account_credit_card",payee:"Netflix",description:"",amount:-15.99,category_id:"category_subscriptions",day:1,cleared:!0},{idSuffix:"11",account_id:"account_credit_card",payee:"Spotify",description:"",amount:-11.99,category_id:"category_subscriptions",day:1,cleared:!0},{idSuffix:"12",account_id:"account_credit_card",payee:"AT&T",description:"Phone bill",amount:-65,category_id:"category_phone_internet",day:12,cleared:!0},{idSuffix:"13",account_id:"account_credit_card",payee:"Comcast",description:"Internet",amount:-55,category_id:"category_phone_internet",day:15,cleared:!0},{idSuffix:"14",account_id:"account_credit_card",payee:"Movie Theater",description:"Movies",amount:-28,category_id:"category_entertainment",day:22,cleared:!0},{idSuffix:"15",account_id:"account_credit_card",payee:"Local Restaurant",description:"Dinner",amount:-54.32,category_id:"category_dining_out",day:8,cleared:!0},{idSuffix:"16",account_id:"account_credit_card",payee:"Target",description:"Spring clothes",amount:-124.99,category_id:"category_clothing",day:12,cleared:!0}],transfers:[{idSuffix:"01",from_account_id:"account_main_checking",to_account_id:"account_emergency_fund",from_category_id:"no_category",to_category_id:"no_category",amount:250,description:"Monthly savings",day:20},{idSuffix:"02",from_account_id:"account_main_checking",to_account_id:"account_vacation_fund",from_category_id:"no_category",to_category_id:"no_category",amount:150,description:"Vacation savings",day:20},{idSuffix:"03",from_account_id:"account_main_checking",to_account_id:"account_credit_card",from_category_id:"no_category",to_category_id:"no_category",amount:2592,description:"Credit card payoff",day:25}],adjustments:[],allocations:[{category_id:"category_rent",amount:1500},{category_id:"category_utilities",amount:150},{category_id:"category_groceries",amount:550},{category_id:"category_transportation",amount:120},{category_id:"category_subscriptions",amount:30},{category_id:"category_phone_internet",amount:120},{category_id:"category_entertainment",amount:50},{category_id:"category_dining_out",amount:100},{category_id:"category_personal",amount:75},{category_id:"category_clothing",amount:150}]},{monthOffset:-2,areAllocationsFinalized:!0,income:[{idSuffix:"01",account_id:"account_main_checking",payee:"ABC Corp",description:"Paycheck",amount:2200,day:15,cleared:!0},{idSuffix:"02",account_id:"account_main_checking",payee:"ABC Corp",description:"Paycheck",amount:2200,day:28,cleared:!0},{idSuffix:"03",account_id:"account_emergency_fund",payee:"Interest",description:"Savings interest",amount:14,day:28,cleared:!0}],expenses:[{idSuffix:"01",account_id:"account_main_checking",payee:"Landlord",description:"Rent",amount:-1500,category_id:"category_rent",day:1,cleared:!0},{idSuffix:"02",account_id:"account_credit_card",payee:"Electric Company",description:"",amount:-78.45,category_id:"category_utilities",day:5,cleared:!0},{idSuffix:"03",account_id:"account_credit_card",payee:"Water Utility",description:"",amount:-42.3,category_id:"category_utilities",day:8,cleared:!0},{idSuffix:"04",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-132.45,category_id:"category_groceries",day:3,cleared:!0},{idSuffix:"05",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-98.76,category_id:"category_groceries",day:10,cleared:!0},{idSuffix:"06",account_id:"account_credit_card",payee:"Costco",description:"Monthly stock up",amount:-175.23,category_id:"category_groceries",day:17,cleared:!0},{idSuffix:"07",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-105.89,category_id:"category_groceries",day:24,cleared:!0},{idSuffix:"08",account_id:"account_credit_card",payee:"Shell Gas",description:"",amount:-47.56,category_id:"category_transportation",day:6,cleared:!0},{idSuffix:"09",account_id:"account_credit_card",payee:"Shell Gas",description:"",amount:-50.89,category_id:"category_transportation",day:20,cleared:!0},{idSuffix:"10",account_id:"account_credit_card",payee:"Netflix",description:"",amount:-15.99,category_id:"category_subscriptions",day:1,cleared:!0},{idSuffix:"11",account_id:"account_credit_card",payee:"Spotify",description:"",amount:-11.99,category_id:"category_subscriptions",day:1,cleared:!0},{idSuffix:"12",account_id:"account_credit_card",payee:"AT&T",description:"Phone bill",amount:-65,category_id:"category_phone_internet",day:12,cleared:!0},{idSuffix:"13",account_id:"account_credit_card",payee:"Comcast",description:"Internet",amount:-55,category_id:"category_phone_internet",day:15,cleared:!0},{idSuffix:"14",account_id:"account_credit_card",payee:"Local Restaurant",description:"Birthday dinner",amount:-78.9,category_id:"category_dining_out",day:18,cleared:!0},{idSuffix:"15",account_id:"account_credit_card",payee:"Coffee Shop",description:"",amount:-18.45,category_id:"category_dining_out",day:7,cleared:!0},{idSuffix:"16",account_id:"account_credit_card",payee:"Amazon",description:"Household items",amount:-45.67,category_id:"category_personal",day:14,cleared:!0}],transfers:[{idSuffix:"01",from_account_id:"account_main_checking",to_account_id:"account_emergency_fund",from_category_id:"no_category",to_category_id:"no_category",amount:200,description:"Monthly savings",day:20},{idSuffix:"02",from_account_id:"account_main_checking",to_account_id:"account_vacation_fund",from_category_id:"no_category",to_category_id:"no_category",amount:100,description:"Vacation savings",day:20}],adjustments:[{idSuffix:"01",account_id:"account_main_checking",category_id:"category_personal",amount:-25,description:"Cash withdrawal",day:22}],allocations:[{category_id:"category_rent",amount:1500},{category_id:"category_utilities",amount:150},{category_id:"category_groceries",amount:550},{category_id:"category_transportation",amount:120},{category_id:"category_subscriptions",amount:30},{category_id:"category_phone_internet",amount:120},{category_id:"category_entertainment",amount:44},{category_id:"category_dining_out",amount:100},{category_id:"category_personal",amount:100},{category_id:"category_clothing",amount:100}]},{monthOffset:-1,areAllocationsFinalized:!0,income:[{idSuffix:"01",account_id:"account_main_checking",payee:"ABC Corp",description:"Paycheck",amount:2200,day:15,cleared:!0},{idSuffix:"02",account_id:"account_main_checking",payee:"ABC Corp",description:"Paycheck",amount:2200,day:28,cleared:!0},{idSuffix:"03",account_id:"account_main_checking",payee:"Side Gig Client",description:"Freelance work",amount:350,day:12,cleared:!0},{idSuffix:"04",account_id:"account_emergency_fund",payee:"Interest",description:"Savings interest",amount:14.5,day:28,cleared:!0}],expenses:[{idSuffix:"01",account_id:"account_main_checking",payee:"Landlord",description:"Rent",amount:-1500,category_id:"category_rent",day:1,cleared:!0},{idSuffix:"02",account_id:"account_credit_card",payee:"Electric Company",description:"",amount:-85.32,category_id:"category_utilities",day:5,cleared:!0},{idSuffix:"03",account_id:"account_credit_card",payee:"Water Utility",description:"",amount:-46.78,category_id:"category_utilities",day:8,cleared:!0},{idSuffix:"04",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-115.67,category_id:"category_groceries",day:2,cleared:!0},{idSuffix:"05",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-128.34,category_id:"category_groceries",day:9,cleared:!0},{idSuffix:"06",account_id:"account_credit_card",payee:"Costco",description:"Monthly stock up",amount:-182.56,category_id:"category_groceries",day:16,cleared:!0},{idSuffix:"07",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-94.23,category_id:"category_groceries",day:23,cleared:!0},{idSuffix:"08",account_id:"account_credit_card",payee:"Shell Gas",description:"",amount:-52.34,category_id:"category_transportation",day:4,cleared:!0},{idSuffix:"09",account_id:"account_credit_card",payee:"Shell Gas",description:"",amount:-48.76,category_id:"category_transportation",day:18,cleared:!0},{idSuffix:"10",account_id:"account_credit_card",payee:"Netflix",description:"",amount:-15.99,category_id:"category_subscriptions",day:1,cleared:!0},{idSuffix:"11",account_id:"account_credit_card",payee:"Spotify",description:"",amount:-11.99,category_id:"category_subscriptions",day:1,cleared:!0},{idSuffix:"12",account_id:"account_credit_card",payee:"AT&T",description:"Phone bill",amount:-65,category_id:"category_phone_internet",day:12,cleared:!0},{idSuffix:"13",account_id:"account_credit_card",payee:"Comcast",description:"Internet",amount:-55,category_id:"category_phone_internet",day:15,cleared:!0},{idSuffix:"14",account_id:"account_credit_card",payee:"Movie Theater",description:"Movies",amount:-35.5,category_id:"category_entertainment",day:21,cleared:!0},{idSuffix:"15",account_id:"account_credit_card",payee:"Local Restaurant",description:"Dinner",amount:-62.45,category_id:"category_dining_out",day:10,cleared:!0},{idSuffix:"16",account_id:"account_credit_card",payee:"Coffee Shop",description:"",amount:-14.25,category_id:"category_dining_out",day:19,cleared:!0}],transfers:[{idSuffix:"01",from_account_id:"account_main_checking",to_account_id:"account_emergency_fund",from_category_id:"no_category",to_category_id:"no_category",amount:200,description:"Monthly savings",day:20},{idSuffix:"02",from_account_id:"account_main_checking",to_account_id:"account_vacation_fund",from_category_id:"no_category",to_category_id:"no_category",amount:150,description:"Vacation savings",day:20},{idSuffix:"03",from_account_id:"account_main_checking",to_account_id:"account_credit_card",from_category_id:"no_category",to_category_id:"no_category",amount:950,description:"Credit card payment",day:25}],adjustments:[],allocations:[{category_id:"category_rent",amount:1500},{category_id:"category_utilities",amount:150},{category_id:"category_groceries",amount:550},{category_id:"category_transportation",amount:120},{category_id:"category_subscriptions",amount:30},{category_id:"category_phone_internet",amount:120},{category_id:"category_entertainment",amount:48},{category_id:"category_dining_out",amount:100},{category_id:"category_personal",amount:75},{category_id:"category_clothing",amount:100}]},{monthOffset:0,areAllocationsFinalized:!0,income:[{idSuffix:"01",account_id:"account_main_checking",payee:"ABC Corp",description:"Paycheck",amount:2200,day:15,cleared:!0},{idSuffix:"02",account_id:"account_main_checking",payee:"ABC Corp",description:"Paycheck",amount:2200,day:28,cleared:!0}],expenses:[{idSuffix:"01",account_id:"account_main_checking",payee:"Landlord",description:"Rent",amount:-1500,category_id:"category_rent",day:1,cleared:!0},{idSuffix:"02",account_id:"account_credit_card",payee:"Electric Company",description:"",amount:-92.15,category_id:"category_utilities",day:5,cleared:!0},{idSuffix:"03",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-122.34,category_id:"category_groceries",day:3,cleared:!0},{idSuffix:"04",account_id:"account_credit_card",payee:"Grocery Mart",description:"Weekly groceries",amount:-108.56,category_id:"category_groceries",day:10,cleared:!0},{idSuffix:"05",account_id:"account_credit_card",payee:"Shell Gas",description:"",amount:-54.23,category_id:"category_transportation",day:7,cleared:!0},{idSuffix:"06",account_id:"account_credit_card",payee:"Netflix",description:"",amount:-15.99,category_id:"category_subscriptions",day:1,cleared:!0},{idSuffix:"07",account_id:"account_credit_card",payee:"Spotify",description:"",amount:-11.99,category_id:"category_subscriptions",day:1,cleared:!0},{idSuffix:"08",account_id:"account_credit_card",payee:"AT&T",description:"Phone bill",amount:-65,category_id:"category_phone_internet",day:12,cleared:!0},{idSuffix:"09",account_id:"account_credit_card",payee:"Coffee Shop",description:"",amount:-16.75,category_id:"category_dining_out",day:8,cleared:!0}],transfers:[],adjustments:[],allocations:[{category_id:"category_rent",amount:1500},{category_id:"category_utilities",amount:150},{category_id:"category_groceries",amount:550},{category_id:"category_transportation",amount:120},{category_id:"category_subscriptions",amount:30},{category_id:"category_phone_internet",amount:120},{category_id:"category_entertainment",amount:44},{category_id:"category_dining_out",amount:100},{category_id:"category_personal",amount:75},{category_id:"category_clothing",amount:100}]},{monthOffset:1,areAllocationsFinalized:!0,income:[],expenses:[],transfers:[],adjustments:[],allocations:[{category_id:"category_rent",amount:1500},{category_id:"category_utilities",amount:150},{category_id:"category_groceries",amount:550},{category_id:"category_transportation",amount:120},{category_id:"category_subscriptions",amount:30},{category_id:"category_phone_internet",amount:120},{category_id:"category_entertainment",amount:48},{category_id:"category_dining_out",amount:100},{category_id:"category_personal",amount:75},{category_id:"category_clothing",amount:50}]}];function T4(t){const e={},n={};for(const[s,o]of Object.entries(Jf))n[s]=o.initialBalance;let r=!0;return t.map(s=>{const o=s.data.category_balances.map(l=>{const h=e[l.category_id]||0,f=Ee(h+l.allocated+l.spent+l.transfers+l.adjustments);return e[l.category_id]=f,{...l,start_balance:h,end_balance:f}}),c=s.data.account_balances.map(l=>{const h=r?Jf[l.account_id]?.initialBalance||0:n[l.account_id]||0,f=Ee(h+l.net_change);return n[l.account_id]=f,{...l,start_balance:h,end_balance:f}});return r=!1,{...s,data:{...s.data,category_balances:o,account_balances:c}}})}function A4(t,e){const n={};for(const p of t){const g=`${p.year}${String(p.month).padStart(2,"0")}`;n[g]={}}const r={};for(const[p,g]of Object.entries(Jf))r[p]={nickname:g.nickname,description:g.description,account_group_id:g.account_group_id,on_budget:g.on_budget,is_active:g.is_active,is_income_account:g.is_income_account,is_income_default:g.is_income_default,is_outgo_account:g.is_outgo_account,is_outgo_default:g.is_outgo_default,sort_order:g.sort_order};const s=Object.entries(w4).map(([p,g])=>({id:p,name:g.name,is_hidden:g.is_hidden,sort_order:g.sort_order})),o=Object.entries(S4).map(([p,g])=>({id:p,name:g.name,on_budget:g.on_budget,is_active:g.is_active,sort_order:g.sort_order})),c={};for(const[p,g]of Object.entries(EA))c[p]={name:g.name,category_group_id:g.category_group_id,is_hidden:g.is_hidden,sort_order:g.sort_order,default_monthly_amount:g.default_monthly_amount??null,default_monthly_type:g.default_monthly_type??null};const l={name:VT,owner_id:"__SYSTEM__",owner_email:"system@sample.budget",user_ids:[],accepted_user_ids:[],percentage_income_months_back:2,month_map:n,accounts:r,account_groups:o,categories:c,category_groups:s,migrated_at:e,updated_at:e},h={};return C4.forEach((p,g)=>{const _=`payee_sample_${String(g+1).padStart(3,"0")}`;h[_]={name:p.name,category_id:p.category_id}}),{budgetDocument:l,payeesDocument:{budget_id:mi,payees:h,updated_at:e}}}function Pu(t,e,n){const r=Math.min(n,28);return`${t}-${String(e).padStart(2,"0")}-${String(r).padStart(2,"0")}`}function df(t,e,n){return`${Pu(t,e,n)}T12:00:00.000Z`}let TA,AA;function j4(t){const e=t||new Date;TA=e.getFullYear(),AA=e.getMonth()+1}function R4(t){let e=TA,n=AA+t;for(;n<1;)n+=12,e-=1;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function I4(t){const{year:e,month:n}=R4(t.monthOffset),r=`${e}${String(n).padStart(2,"0")}`,s=new Date().toISOString(),o=t.income.map(j=>({id:`income_${r}_${j.idSuffix}`,account_id:j.account_id,payee:j.payee,description:j.description,amount:j.amount,date:Pu(e,n,j.day),cleared:j.cleared,created_at:df(e,n,j.day)})),c=t.expenses.map(j=>({id:`expense_${r}_${j.idSuffix}`,account_id:j.account_id,payee:j.payee,description:j.description,amount:j.amount,category_id:j.category_id,date:Pu(e,n,j.day),cleared:j.cleared,created_at:df(e,n,j.day)})),l=t.transfers.map(j=>({id:`transfer_${r}_${j.idSuffix}`,from_account_id:j.from_account_id,to_account_id:j.to_account_id,from_category_id:j.from_category_id,to_category_id:j.to_category_id,amount:j.amount,description:j.description,date:Pu(e,n,j.day),created_at:df(e,n,j.day)})),h=t.adjustments.map(j=>({id:`adjustment_${r}_${j.idSuffix}`,account_id:j.account_id,category_id:j.category_id,amount:j.amount,description:j.description,date:Pu(e,n,j.day),created_at:df(e,n,j.day)})),f=Ee(o.reduce((j,B)=>j+B.amount,0)),p=Ee(c.reduce((j,B)=>j+B.amount,0)),g={},_={},y={};for(const j of c)j.category_id&&(g[j.category_id]=Ee((g[j.category_id]||0)+j.amount));for(const j of l)j.from_category_id!=="no_category"&&(_[j.from_category_id]=Ee((_[j.from_category_id]||0)-j.amount)),j.to_category_id!=="no_category"&&(_[j.to_category_id]=Ee((_[j.to_category_id]||0)+j.amount));for(const j of h)y[j.category_id]=Ee((y[j.category_id]||0)+j.amount);const x={};for(const j of t.allocations)x[j.category_id]=j.amount;const w=new Set([...Object.keys(g),...Object.keys(_),...Object.keys(y),...Object.keys(x),...Object.keys(EA)]),S=Array.from(w).map(j=>{const B=x[j]||0,V=g[j]||0,$=_[j]||0,k=y[j]||0;return{category_id:j,start_balance:0,allocated:B,spent:V,transfers:$,adjustments:k,end_balance:Ee(B+V+$+k)}}),E={},T={},A={},M={},L={};for(const j of o)E[j.account_id]=Ee((E[j.account_id]||0)+j.amount);for(const j of c)T[j.account_id]=Ee((T[j.account_id]||0)+j.amount);for(const j of l)M[j.from_account_id]=Ee((M[j.from_account_id]||0)-j.amount),A[j.to_account_id]=Ee((A[j.to_account_id]||0)+j.amount);for(const j of h)L[j.account_id]=Ee((L[j.account_id]||0)+j.amount);const H=new Set([...Object.keys(E),...Object.keys(T),...Object.keys(A),...Object.keys(M),...Object.keys(L),...Object.keys(Jf)]),O=Array.from(H).map(j=>{const B=E[j]||0,V=T[j]||0,$=A[j]||0,k=M[j]||0,N=L[j]||0,D=Ee(B+V+$+k+N);return{account_id:j,start_balance:0,income:B,expenses:V,transfers:Ee($+k),adjustments:N,net_change:D,end_balance:D}});return{budget_id:mi,year:e,month:n,year_month_ordinal:r,total_income:f,previous_month_income:0,total_expenses:p,are_allocations_finalized:t.areAllocationsFinalized,created_at:s,updated_at:s,income:o,expenses:c,transfers:l,adjustments:h,account_balances:O,category_balances:S}}function k4(t){j4(t?.referenceDate);const e=new Date().toISOString(),n=E4.map(c=>{const l=I4(c);return{budgetId:mi,year:l.year,month:l.month,data:l}});n.sort((c,l)=>c.year!==l.year?c.year-l.year:c.month-l.month);const r=T4(n),{budgetDocument:s,payeesDocument:o}=A4(r,e);return{budgetDocument:s,payeesDocument:o,months:r}}function D4({currentUser:t}){const{resetInitialLoadState:e,selectedBudgetId:n,setCurrentYear:r,setCurrentMonthNumber:s}=Qe(),[o,c]=R.useState(!1),[l,h]=R.useState(null),[f,p]=R.useState(null),[g,_]=R.useState(null);async function y(){if(!t){p("Must be logged in to update sample budget");return}c(!0),p(null),_(null);const w=[];try{h({phase:"generating",current:0,total:5,percentComplete:5,message:"Generating sample budget data..."});const S=k4({referenceDate:new Date});console.log("[UpdateSampleBudget] Generated sample budget with",S.months.length,"months"),h({phase:"writing_budget",current:1,total:4,percentComplete:20,message:"Writing budget document..."}),h({phase:"writing_budget",current:1,total:5,percentComplete:15,message:"Deleting old months..."});const E=await Gn("months","update-sample-budget: querying existing months",[{field:"budget_id",op:"==",value:mi}]);if(E.docs.length>0){console.log(`[UpdateSampleBudget] Deleting ${E.docs.length} existing months`);for(const $ of E.docs)await Wf("months",$.id,"update-sample-budget: deleting old month")}const T=Object.keys(S.budgetDocument.categories||{}).length,A=Object.keys(S.budgetDocument.categories||{})[0],M=S.budgetDocument.categories?.[A];console.log(`[DEBUG] useUpdateSampleBudget: writing budget with ${T} categories, sampleCat=${A?.slice(0,15)} balance=${M?.balance}`),await dr("budgets",mi,Jr(S.budgetDocument),"update-sample-budget: writing budget"),console.log("[UpdateSampleBudget] Wrote budget document"),h({phase:"writing_budget",current:2,total:5,percentComplete:35,message:"Writing payees document..."});const L={collectionPath:"payees",docId:mi,data:Jr(S.payeesDocument)};await Rm([L],"update-sample-budget: writing payees"),console.log("[UpdateSampleBudget] Wrote payees document"),h({phase:"writing_months",current:3,total:5,percentComplete:50,message:`Writing ${S.months.length} months...`});const H=S.months.map($=>({budgetId:$.budgetId,year:$.year,month:$.month,data:Jr($.data)}));h({phase:"recalculating",current:4,total:5,percentComplete:65,message:"Writing months and recalculating balances..."}),await vA(H,"update-sample-budget"),console.log("[UpdateSampleBudget] Wrote",H.length,"months"),h({phase:"complete",current:5,total:5,percentComplete:100,message:"Sample budget updated successfully!"});const O=[...S.months].sort(($,k)=>{const N=$.year*100+$.month,D=k.year*100+k.month;return N-D}),j=O[0],B=O[O.length-1],V=`${j.year}/${j.month} - ${B.year}/${B.month}`;if(_({success:w.length===0,monthsCreated:S.months.length,dateRange:V,errors:w}),console.log("[UpdateSampleBudget] Clearing all caches..."),ns(),e(),n===mi){const $=new Date;console.log(`[UpdateSampleBudget] Viewing sample budget - resetting to current calendar month ${$.getFullYear()}/${$.getMonth()+1}`),r($.getFullYear()),s($.getMonth()+1)}}catch(S){const E=S instanceof Error?S.message:"Unknown error during update";console.error("[UpdateSampleBudget] Update failed:",S),p(E),_({success:!1,monthsCreated:0,dateRange:"",errors:[...w,E]}),console.log("[UpdateSampleBudget] Clearing caches after failure..."),ns(),e()}finally{c(!1)}}function x(){h(null),p(null),_(null)}return{isUpdating:o,progress:l,error:f,result:g,updateSampleBudget:y,reset:x}}function M4({isActive:t,onDragOver:e,onDragLeave:n,onDrop:r,label:s="Move to end"}){return d.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:r,style:EP,children:[d.jsx("div",{style:{...TP,opacity:t?1:.3,boxShadow:t?"0 0 8px var(--shadow-primary)":"none"}}),t&&d.jsx("span",{style:AP,children:s})]})}function Jt(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function zt(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Ft(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function Zn(t){return t===0?"$0.00":`${t>0?"+":"-"}${Jt(t)}`}function Qt(t){return`${t>=0?"+":"-"}${Jt(t)}`}function et(t){return t===0?me.zero:t>0?me.success:me.danger}function hn(t){return t===0?me.zero:t>0?me.success:me.debt}function Al(t){return t===0?me.zero:t<0?me.error:me.success}function Pa(t){return t===0?me.zero:t>0?me.success:me.error}async function jA(t,e){const{exists:n,data:r}=await vt("feedback",t);if(!n||!r)throw new Error(`Feedback document not found: ${t}`);return{items:r.items||[],user_email:r.user_email,created_at:r.created_at,updated_at:r.updated_at}}async function y0(t){const{docId:e,items:n,description:r}=t;await dr("feedback",e,{items:n,updated_at:new Date().toISOString()},r,{merge:!0})}async function O4(t,e,n,r){const{exists:s}=await vt("feedback",t);s?await dr("feedback",t,{items:td(e),user_email:n,updated_at:new Date().toISOString()},r,{merge:!0}):await dr("feedback",t,{items:[e],user_email:n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})}function RA(){const t=Rt(),e=Tn({onMutate:async r=>{const{userId:s,userEmail:o,text:c,feedbackType:l,currentPath:h}=r,f=o||s,p=Te.feedback();await t.cancelQueries({queryKey:p});const g=t.getQueryData(p),_=`feedback_optimistic_${Date.now()}`,y={id:_,text:`${c}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:l,doc_id:f,user_email:o};return g&&t.setQueryData(p,{items:[...g.items,y]}),{previousData:g,optimisticId:_}},mutationFn:async r=>{const{userId:s,userEmail:o,text:c,feedbackType:l,currentPath:h}=r,f=o||s,p={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${c}

(Submitted from: ${h})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:l};return await O4(f,p,o,"submitting new feedback"),{feedbackItem:p,docId:f}},onSuccess:(r,s,o)=>{if(!o?.optimisticId)return;const c=t.getQueryData(Te.feedback());c&&t.setQueryData(Te.feedback(),{items:c.items.map(l=>l.id===o.optimisticId?{...r.feedbackItem,doc_id:r.docId,user_email:s.userEmail}:l)})},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Te.feedback(),o.previousData)}});return{submitFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function N4(){const t=Rt(),e=Tn({onMutate:async r=>{const{item:s}=r,o=Te.feedback(),c=!s.is_done,l=c?new Date().toISOString():null;await t.cancelQueries({queryKey:o});const h=t.getQueryData(o);return h&&t.setQueryData(o,{items:h.items.map(f=>f.id===s.id?{...f,is_done:c,completed_at:l}:f)}),{previousData:h}},mutationFn:async r=>{const{item:s}=r,o=!s.is_done,c=o?new Date().toISOString():null,l=await jA(s.doc_id);let h=!1;const f=l.items.map(p=>p.id===s.id?(h=!0,{...p,is_done:o,completed_at:c}):p);if(!h)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:s.id,inDocument:s.doc_id,availableIds:l.items.map(p=>p.id)}),new Error(`Feedback item not found in document. Item ID: ${s.id}, Doc ID: ${s.doc_id}`);return await y0({docId:s.doc_id,items:f,description:`marking feedback item as ${o?"done":"not done"}`}),{itemId:s.id,isDone:o,completedAt:c}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Te.feedback(),o.previousData)}});return{toggleFeedback:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function B4(){const t=Rt(),e=Tn({onMutate:async r=>{const{docId:s,items:o}=r,c=Te.feedback();await t.cancelQueries({queryKey:c});const l=t.getQueryData(c),h=new Map;return o.forEach(f=>{h.set(f.id,f.sort_order)}),l&&t.setQueryData(c,{items:l.items.map(f=>f.doc_id===s&&h.has(f.id)?{...f,sort_order:h.get(f.id)}:f)}),{previousData:l}},mutationFn:async r=>{const{docId:s,items:o}=r;return await y0({docId:s,items:o,description:"saving reordered feedback items"}),{docId:s,items:o}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Te.feedback(),o.previousData)}});return{updateSortOrder:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}const od={critical_bug:{label:"Critical Bug",color:"var(--color-error)",bgColor:"var(--color-error-bg)"},bug:{label:"Bug",color:"var(--color-warning)",bgColor:"var(--color-warning-bg)"},new_feature:{label:"New Feature",color:"var(--color-success)",bgColor:"var(--color-success-bg)"},core_feature:{label:"Core Feature",color:"var(--color-migration-blue)",bgColor:"var(--color-migration-blue-bg)"},qol:{label:"QOL",color:"var(--color-migration-purple)",bgColor:"var(--color-migration-purple-bg)"}};function Ji({isOpen:t,onClose:e,title:n,children:r,width:s="28rem"}){if(!t)return null;function o(){e()}return d.jsx("div",{style:{position:"fixed",inset:0,background:"var(--modal-backdrop)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:o,children:d.jsxs("div",{style:{background:"var(--surface-base)",color:"var(--text-primary)",borderRadius:"12px",padding:"1.5rem",width:s,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px var(--shadow-overlay)"},onClick:c=>c.stopPropagation(),children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[d.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),d.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),r]})})}const P4=2e3;function z4(){const[t,e]=R.useState(!1),[n,r]=R.useState(""),[s,o]=R.useState("bug"),[c,l]=R.useState(!1),h=R.useContext(Rd),p=Us().get_current_firebase_user(),g=nr(),{submitFeedback:_}=RA();if(R.useEffect(()=>{if(c){const w=setTimeout(()=>l(!1),P4);return()=>clearTimeout(w)}},[c]),g.pathname.includes("/admin/feedback")||!h.is_logged_in)return null;function x(w){w.preventDefault(),!(!n.trim()||!h.username||!p)&&(_.mutate({userId:p.uid,userEmail:h.username,text:n.trim(),feedbackType:s,currentPath:g.pathname}),r(""),o("bug"),e(!1),l(!0))}return d.jsxs(d.Fragment,{children:[c&&d.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"var(--banner-success)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px var(--shadow-overlay)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[d.jsx("span",{children:""}),d.jsx("span",{children:"Feedback submitted!"})]}),d.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:me.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px var(--shadow-overlay)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:w=>{w.currentTarget.style.transform="scale(1.1)",w.currentTarget.style.boxShadow="0 6px 16px var(--shadow-overlay)"},onMouseLeave:w=>{w.currentTarget.style.transform="scale(1)",w.currentTarget.style.boxShadow="0 4px 12px var(--shadow-overlay)"},children:""}),d.jsx(Ji,{isOpen:t,onClose:()=>{e(!1),o("bug")},title:"Send Feedback",children:d.jsxs("form",{onSubmit:x,children:[d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(w=>{const S=od[w],E=s===w;return d.jsxs("button",{type:"button",onClick:()=>{S.label,o(w)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${S.color}`,borderRadius:"0.5rem",background:E?S.bgColor:"transparent",color:E?S.color:"var(--text-muted)",cursor:"pointer",fontWeight:E?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:E?1:.5,boxShadow:E?`0 0 12px ${S.bgColor}`:"none",position:"relative"},children:[S.label,E&&d.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},w)})}),d.jsx(m0,{value:n,onChange:w=>r(w.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),d.jsxs(Ya,{children:[d.jsx(Ge,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),o("bug")},children:"Cancel"}),d.jsx(Ge,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function Xr({children:t,labelStyle:e,...n}){return d.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[d.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:me.primary},...n}),t]})}function _0({title:t,count:e,children:n,defaultExpanded:r=!1}){const[s,o]=R.useState(r);return d.jsxs("div",{style:{marginTop:"2rem"},children:[d.jsxs("button",{onClick:()=>o(!s),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[d.jsx("span",{style:{transition:"transform 0.2s",transform:s?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),s&&n]})}const L4=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},U4=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function em(t){const{tabs:e,activeTab:n,variant:r="primary"}=t,s=e.filter(S=>!S.hidden),o=s.length,c=L4(o),l=U4(o),h=Math.floor(100/l),f=`tab-nav-${o}-${r}`,p=r==="primary",g=r==="secondary",_=r==="segmented",y=S=>{const E="color-mix(in srgb, currentColor 10%, transparent)",T="color-mix(in srgb, currentColor 3%, transparent)";return _?{flex:"1 1 0",padding:"0.75rem 1rem",border:"none",borderRadius:0,background:S?E:T,cursor:"pointer",fontWeight:S?600:400,fontSize:"0.95rem",color:"inherit",opacity:S?1:.55,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",borderBottom:S?"2px solid currentColor":"2px solid transparent"}:g?{flex:"none",minWidth:"8.5rem",padding:"0.55rem 1rem 0.65rem",border:"none",borderRadius:"10px 10px 0 0",background:"transparent",cursor:"pointer",fontWeight:600,fontSize:"0.85rem",color:S?"inherit":"color-mix(in srgb, currentColor 55%, transparent)",transition:"color 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none",marginBottom:S?"-1px":"0"}:{flex:"1 1 0",padding:"0.7rem 0.75rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:S?600:400,fontSize:"1rem",letterSpacing:"0.01em",color:"inherit",opacity:S?1:.6,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}},x=(S,E)=>d.jsxs(d.Fragment,{children:[d.jsx("span",{children:S.label}),S.checkmark&&d.jsx("span",{style:{color:me.success,fontWeight:600},children:""}),p&&E&&d.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]}),w=()=>_?`
        .${f} {
          display: flex;
          margin-bottom: 0.75rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
      `:g?`
        .${f} {
          display: flex;
          flex-wrap: nowrap;
          margin-bottom: 1rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
          justify-content: flex-start;
          padding-left: 0.75rem;
          position: relative;
        }
        .${f} > button,
        .${f} > a {
          margin-right: -8px;
          isolation: isolate;
        }
        .${f} > button:last-child,
        .${f} > a:last-child {
          margin-right: 0;
        }
        .${f} > button::before,
        .${f} > a::before {
          content: '';
          position: absolute;
          inset: 0;
          background: var(--tab-bg);
          border-radius: 10px 10px 0 0;
          z-index: -1;
          transform: perspective(50px) rotateX(5deg);
          transform-origin: bottom center;
          transition: background 0.15s;
          box-shadow: -1px 0 0 var(--sticky-header-bg), 1px 0 0 var(--sticky-header-bg);
        }
        .${f} > button:nth-child(1),
        .${f} > a:nth-child(1) {
          z-index: 4;
        }
        .${f} > button:nth-child(2),
        .${f} > a:nth-child(2) {
          z-index: 3;
        }
        .${f} > button:nth-child(3),
        .${f} > a:nth-child(3) {
          z-index: 2;
        }
        .${f} > button:nth-child(4),
        .${f} > a:nth-child(4) {
          z-index: 1;
        }
        .${f} > button.tab-active,
        .${f} > a.tab-active {
          z-index: 10;
        }
        .${f} > button.tab-active::before,
        .${f} > a.tab-active::before {
          background: var(--tab-bg-active);
        }
        .${f} > button:not(.tab-active):hover,
        .${f} > a:not(.tab-active):hover {
          color: color-mix(in srgb, currentColor 80%, transparent);
        }
        .${f} > button:not(.tab-active):hover::before,
        .${f} > a:not(.tab-active):hover::before {
          background: var(--tab-bg-hover);
        }
        @media (max-width: 480px) {
          .${f} {
            padding-left: 0;
            padding-right: 0;
          }
          .${f} > button,
          .${f} > a {
            flex: 0 0 27% !important;
            min-width: 27% !important;
            padding: 0.55rem 0.5rem 0.65rem !important;
            font-size: 0.8rem !important;
          }
        }
      `:`
      .${f} {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 0;
        border-bottom: 1px solid color-mix(in srgb, currentColor 25%, transparent);
      }
      @media (max-width: ${c}px) {
        .${f} > * {
          flex: 1 1 ${h}% !important;
          min-width: ${h}% !important;
        }
      }
    `;return d.jsxs(d.Fragment,{children:[d.jsx("style",{children:`
        ${w()}
        .${f} > button,
        .${f} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${f} > button:hover,
        .${f} > button:focus,
        .${f} > a:hover,
        .${f} > a:focus {
          border: none !important;
          border-color: transparent !important;
          ${p?"opacity: 0.85;":""}
          ${_?"background: color-mix(in srgb, currentColor 7%, transparent);":""}
        }
      `}),d.jsx("div",{className:f,children:s.map(S=>{const E=n===S.id;return t.mode==="link"?d.jsx(Rn,{to:`${t.linkPrefix}/${S.id}`,onClick:()=>(`${S.label}`,void 0),style:y(E),className:E?"tab-active":"",children:x(S,E)},S.id):d.jsx("button",{onClick:()=>{`${S.label}`,t.onTabChange(S.id)},style:y(E),className:E?"tab-active":"",children:x(S,E)},S.id)})})]})}function IA({items:t}){const[e,n]=R.useState(!1),r=R.useRef(null),o=nr().pathname;R.useEffect(()=>{function l(h){r.current&&!r.current.contains(h.target)&&n(!1)}if(e)return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[e]),R.useEffect(()=>{function l(h){h.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[e]);const c=t.filter(l=>l.hidden?!1:l.to?l.to==="/budget"?!(o==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(o)):l.to==="/account"||l.to==="/"?o!==l.to:!o.startsWith(l.to):!0);return d.jsxs("div",{ref:r,style:{position:"relative"},children:[d.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&d.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"var(--overlay-panel-bg)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px var(--shadow-overlay)",zIndex:1e3,overflow:"hidden"},children:c.map((l,h)=>{if(l.divider)return d.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},h);const f=d.jsxs(d.Fragment,{children:[l.icon&&d.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:l.icon}),d.jsx("span",{children:l.label})]}),p={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},g={background:"color-mix(in srgb, currentColor 10%, transparent)"};return l.to?d.jsx(Rn,{to:l.to,style:p,onMouseEnter:_=>Object.assign(_.currentTarget.style,g),onMouseLeave:_=>_.currentTarget.style.background="transparent",onClick:()=>{`${l.label}`,n(!1)},children:f},h):d.jsx("button",{onClick:()=>{`${l.label}`,l.onClick?.(),n(!1)},style:p,onMouseEnter:_=>Object.assign(_.currentTarget.style,g),onMouseLeave:_=>_.currentTarget.style.background="transparent",children:f},h)})})]})}function F4({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:r}=Qe(),s=nr(),c=[...s.pathname==="/budget"||s.pathname.startsWith("/budget/")&&!s.pathname.startsWith("/budget/settings")&&!s.pathname.startsWith("/budget/admin")&&!s.pathname.startsWith("/budget/analytics")&&!s.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...r?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return d.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[d.jsx("div",{style:{flex:"0 0 auto"},children:e?d.jsx(Rn,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):d.jsx(Rn,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:d.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),d.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),d.jsx("div",{style:{flex:"0 0 auto"},children:n?d.jsx("div",{style:{width:"1.5rem"}}):d.jsx(IA,{items:c})})]})}function kA({children:t,style:e}){return d.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function cd({message:t,linkText:e,linkTo:n}){return d.jsx("div",{style:{gridColumn:"1 / -1",background:`color-mix(in srgb, ${me.warning} 12%, transparent)`,border:`2px solid ${me.warning}`,borderRadius:"8px",padding:"1rem 1.25rem",margin:"0.75rem 0",animation:"warningPulse 2s ease-in-out infinite"},children:d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flexWrap:"wrap"},children:[d.jsx("span",{style:{fontSize:"1.25rem",lineHeight:1.3},children:""}),d.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[d.jsx("p",{style:{margin:0,fontWeight:500,color:me.warning,fontSize:"0.95rem"},children:t}),d.jsxs(Rn,{to:n,style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",marginTop:"0.5rem",color:me.warning,fontWeight:600,fontSize:"0.9rem",textDecoration:"underline",textUnderlineOffset:"3px"},children:[e," "]})]})]})})}const V4={success:{bgColor:"var(--banner-success)",color:"white",icon:""},error:{bgColor:"var(--banner-error)",color:"white",icon:""},warning:{bgColor:"var(--banner-warning)",color:"white",icon:""},info:{bgColor:"var(--banner-info)",color:"white",icon:""}};function $4({item:t,onDismiss:e}){const[n,r]=R.useState(!1);if(R.useEffect(()=>{if(t){if(r(!0),t.autoDismissMs&&t.autoDismissMs>0){const o=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),200)},t.autoDismissMs);return()=>clearTimeout(o)}}else r(!1)},[t,e]),!t||!n)return null;const s=V4[t.type];return d.jsxs("div",{style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",left:"1.5rem",maxWidth:"600px",margin:"0 auto",background:s.bgColor,color:s.color,padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px var(--shadow-overlay)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:n?"fadeInUp 0.2s ease-out":"fadeOut 0.2s ease-out",cursor:"pointer"},onClick:()=>{r(!1),setTimeout(()=>e(t.id),200)},children:[d.jsx("span",{children:s.icon}),d.jsx("span",{style:{flex:1},children:t.message}),d.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:""})]})}class G4{items=[];listeners=new Set;nextId=1;add(e){const n=`banner-${this.nextId++}`,r={...e,id:n};return this.items.push(r),this.notify(),n}remove(e){this.items=this.items.filter(n=>n.id!==e),this.notify()}getCurrent(){return this.items[0]||null}subscribe(e){return this.listeners.add(e),e(this.getCurrent()),()=>{this.listeners.delete(e)}}notify(){const e=this.getCurrent();this.listeners.forEach(n=>n(e))}}const Hn=new G4;function Pn(){const t=R.useCallback(async(r,s,o,c)=>{const l=Te.month(r,s,o),h=Pe.getQueryData(l);if(!h?.month)throw new Error(`Month ${s}/${o} not found in cache`);await tA({budgetId:r,month:h.month,description:`${c}: ${s}/${o}`,updateMonthMap:!1})},[]),e=R.useCallback(async(r,s)=>{const o=Te.budget(r),c=Pe.getQueryData(o);if(!c)throw new Error(`Budget ${r} not found in cache`);const l=Object.fromEntries(Object.entries(c.budget.accounts||{}).map(([f,p])=>{const{balance:g,..._}=p;return[f,_]})),h=Object.fromEntries(Object.entries(c.budget.categories||{}).map(([f,p])=>{const{balance:g,..._}=p;return[f,_]}));await Zo({budgetId:r,updates:{name:c.budget.name,user_ids:c.budget.user_ids,accepted_user_ids:c.budget.accepted_user_ids,owner_id:c.budget.owner_id,owner_email:c.budget.owner_email,accounts:l,account_groups:c.budget.account_groups,categories:h,category_groups:c.budget.category_groups,month_map:c.budget.month_map},description:`${s}: budget`})},[]);return{saveCurrentDocument:R.useCallback(async(r,s,o,c)=>{try{s==="month"&&o!==void 0&&c!==void 0?await t(r,o,c,"immediate save (current viewing document)"):s==="budget"&&await e(r,"immediate save (current viewing document)")}catch(l){const h=l instanceof Error?l.message:String(l);throw Hn.add({type:"error",message:`Failed to save current document: ${h}`,autoDismissMs:0}),l}},[t,e])}}async function q4(t,e,n){const r=Pe.getQueryData(Te.budget(t));if(!r){console.warn("[mutationHelpers] Budget not in cache, skipping local recalculation");return}const s=r.budget.month_map,o=Fe(e,n),c=[];for(const[l]of Object.entries(s))if(l>=o){const h=parseInt(l.substring(0,4),10),f=parseInt(l.substring(4,6),10);c.push({year:h,month:f})}c.sort((l,h)=>l.year!==h.year?l.year-h.year:l.month-h.month);for(const{year:l,month:h}of c)try{await n3(t,l,h,Pe)}catch(f){console.warn(`[mutationHelpers] Failed to recalculate month ${l}/${h} locally:`,f)}}function Sr(){const{addLoadingHold:t,removeLoadingHold:e}=kn();return{updateMonthCacheAndTrack:(s,o,c,l)=>{Pe.setQueryData(Te.month(s,o,c),{month:l})},recalculateMonthAndCascade:async(s,o,c,l)=>{const h="recalculate-month-cascade",f=l||((S,E)=>{S?t(h,E):e(h)}),p=Te.month(s,o,c),g=Pe.getQueryData(p);if(g?.month){const S=p0(g.month);Pe.setQueryData(p,{month:S})}const _=Mm(),y=Fe(_.year,_.month),x=Fe(o,c),w=x<y;if(await q4(s,o,c),w){f(!0,"Saving start balances...");try{const S=Pe.getQueryData(Te.budget(s));if(!S){console.warn("[mutationHelpers] Budget not in cache, skipping start_balance save");return}const E=S.monthMap||{},T=[];for(const[A]of Object.entries(E))if(A>=x&&A<=y){const M=parseInt(A.substring(0,4),10),L=parseInt(A.substring(4,6),10);T.push({year:M,month:L})}T.sort((A,M)=>A.year!==M.year?A.year-M.year:A.month-M.month);for(const{year:A,month:M}of T){const L=Te.month(s,A,M),H=Pe.getQueryData(L);if(H?.month){const O=Om(H.month);await tA({budgetId:s,month:O,description:`recalculation: saving start_balance for ${A}/${M}`,updateMonthMap:!1})}}}catch(S){console.error("[mutationHelpers] Failed to save start_balance for months at/before window:",S)}finally{f(!1,"")}}try{await pA(s,f)}catch(S){console.warn("[mutationHelpers] Failed to ensure months fresh and recalculate balances:",S)}}}}function H4(){const{currentViewingDocument:t}=Qe(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=Sr();return{finalizeAllocations:async o=>{const{budgetId:c,year:l,month:h,allocations:f,onProgress:p}=o;p?.({phase:"saving",message:"Saving allocations..."});const g=await wr(c,l,h);if(!g)throw new Error(`Month not found: ${l}/${h}`);const _=g.category_balances?.map(S=>S.category_id)??[],y=g.category_balances.map(S=>{const E=Ee(f[S.category_id]??S.allocated);return{...S,allocated:E}});for(const[S,E]of Object.entries(f))_.includes(S)||y.push({category_id:S,start_balance:0,allocated:Ee(E),spent:0,transfers:0,adjustments:0,end_balance:0});const x={...g,category_balances:y,are_allocations_finalized:!0,updated_at:new Date().toISOString()};n(c,l,h,x),p?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(c,l,h)}catch(S){console.warn("[useFinalizeAllocations] Failed to recalculate month and cascade:",S)}if(t.type==="month"&&t.year===l&&t.month===h)try{await e(c,"month",l,h)}catch(S){console.warn("[useFinalizeAllocations] Failed to save current document immediately:",S)}return p?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:x}},isPending:!1,isError:!1,error:null}}function DA(){const{currentViewingDocument:t}=Qe(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=Sr();return{deleteAllocations:async o=>{const{budgetId:c,year:l,month:h,onProgress:f}=o;f?.({phase:"saving",message:"Deleting allocations..."});const p=await wr(c,l,h);if(!p)throw new Error(`Month not found: ${l}/${h}`);const g=p.category_balances.map(x=>({...x,allocated:0})),_={...p,category_balances:g,are_allocations_finalized:!1,updated_at:new Date().toISOString()};n(c,l,h,_),f?.({phase:"recalculating",message:"Recalculating month balances..."});try{await r(c,l,h)}catch(x){console.warn("[useDeleteAllocations] Failed to recalculate month and cascade:",x)}if(t.type==="month"&&t.year===l&&t.month===h)try{await e(c,"month",l,h)}catch(x){console.warn("[useDeleteAllocations] Failed to save current document immediately:",x)}return f?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:_}},isPending:!1,isError:!1,error:null}}async function Vm(t,e,n){const r=e.trim();if(!r||n.includes(r))return null;const s=[...n,r].sort((o,c)=>o.toLowerCase().localeCompare(c.toLowerCase()));return await dr("payees",t,{budget_id:t,payees:s,updated_at:new Date().toISOString()}),s}function W4(t,e){const n={id:e,amount:Ee(t.amount),account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),n}function Q4(){const t=Rt(),{currentViewingDocument:e}=Qe(),{saveCurrentDocument:n}=Pn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:s}=Sr(),o=Tn({onMutate:async l=>{const{budgetId:h,year:f,month:p}=l,g=Te.month(h,f,p);await t.cancelQueries({queryKey:g});const _=t.getQueryData(g),y=`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=W4(l,y);if(_?.month){const S={..._.month,income:[..._.month.income||[],x],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await s(h,f,p)}catch(S){console.warn("[useAddIncome] Failed to recalculate month and cascade:",S)}if(l.payee?.trim()){const S=t.getQueryData(Te.payees(h))||[],E=await Vm(h,l.payee,S);E&&t.setQueryData(Te.payees(h),E)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddIncome] Failed to save current document immediately:",S)}return{previousData:_,incomeId:y,newIncome:x}},mutationFn:async l=>{const{budgetId:h,year:f,month:p}=l,g=Te.month(h,f,p),_=t.getQueryData(g);if(!_?.month)throw new Error("No month data in cache after optimistic update");const y=_.month,x=y.income?.[y.income.length-1];if(!x)throw new Error("Could not find new income in updated month");return{updatedMonth:y,newIncome:x}},onError:(l,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:_}=h;t.setQueryData(Te.month(p,g,_),f.previousData)}}});return{addIncome:async(l,h,f,p,g,_,y,x)=>o.mutateAsync({budgetId:l,year:h,month:f,amount:p,accountId:g,date:_,payee:y,description:x}),isPending:o.isPending,isError:o.isError,error:o.error}}function K4(t,e,n,r,s,o){if(!t)return!0;const c=t.payee||void 0,l=s?.trim()||void 0,h=t.description||void 0,f=o||void 0;return e!==t.amount||n!==t.account_id||r!==t.date||l!==c||f!==h}function Y4(){const t=Rt(),{currentViewingDocument:e}=Qe(),{saveCurrentDocument:n}=Pn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:s}=Sr();return{updateIncome:async(c,l,h,f,p,g,_,y,x)=>{const w=await wr(c,l,h);if(!w)throw new Error(`Month not found: ${l}/${h}`);const S=(w.income||[]).find(L=>L.id===f);if(!K4(S,p,g,_,y,x))return{updatedMonth:w,noOp:!0};const E={id:f,amount:Ee(p),account_id:g,date:_,created_at:(w.income||[]).find(L=>L.id===f)?.created_at||new Date().toISOString()};y?.trim()&&(E.payee=y.trim()),x&&(E.description=x);const T=(w.income||[]).map(L=>L.id===f?E:L),A={...w,income:T,updated_at:new Date().toISOString()};r(c,l,h,A);try{await s(c,l,h)}catch(L){console.warn("[useUpdateIncome] Failed to recalculate month and cascade:",L)}if(y?.trim()){const L=t.getQueryData(Te.payees(c))||[],H=await Vm(c,y,L);H&&t.setQueryData(Te.payees(c),H)}if(e.type==="month"&&e.year===l&&e.month===h)try{await n(c,"month",l,h)}catch(L){console.warn("[useUpdateIncome] Failed to save current document immediately:",L)}return{updatedMonth:A}},isPending:!1,isError:!1,error:null}}function X4(){const{currentViewingDocument:t}=Qe(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=Sr();return{deleteIncome:async(o,c,l,h)=>{const f=await wr(o,c,l);if(!f)throw new Error(`Month not found: ${c}/${l}`);const p=(f.income||[]).filter(y=>y.id!==h),g={...f,income:p,updated_at:new Date().toISOString()};n(o,c,l,g);try{await r(o,c,l)}catch(y){console.warn("[useDeleteIncome] Failed to recalculate month and cascade:",y)}if(t.type==="month"&&t.year===c&&t.month===l)try{await e(o,"month",c,l)}catch(y){console.warn("[useDeleteIncome] Failed to save current document immediately:",y)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function Z4(t,e){const n={id:e,amount:Ee(t.amount),category_id:t.categoryId,account_id:t.accountId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function J4(){const t=Rt(),{currentViewingDocument:e}=Qe(),{saveCurrentDocument:n}=Pn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:s}=Sr(),o=Tn({onMutate:async l=>{const{budgetId:h,year:f,month:p}=l,g=Te.month(h,f,p);await t.cancelQueries({queryKey:g});const _=t.getQueryData(g),y=`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=Z4(l,y);if(_?.month){const S={..._.month,expenses:[..._.month.expenses||[],x],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await s(h,f,p)}catch(S){console.warn("[useAddExpense] Failed to recalculate month and cascade:",S)}if(l.payee?.trim()){const S=t.getQueryData(Te.payees(h))||[],E=await Vm(h,l.payee,S);E&&t.setQueryData(Te.payees(h),E)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddExpense] Failed to save current document immediately:",S)}return{previousData:_,expenseId:y,newExpense:x}},mutationFn:async l=>{const{budgetId:h,year:f,month:p}=l,g=Te.month(h,f,p),_=t.getQueryData(g);if(!_?.month)throw new Error("No month data in cache after optimistic update");const y=_.month,x=y.expenses?.[y.expenses.length-1];if(!x)throw new Error("Could not find new expense in updated month");return{updatedMonth:y,newExpense:x}},onError:(l,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:_}=h;t.setQueryData(Te.month(p,g,_),f.previousData)}}});return{addExpense:async(l,h,f,p,g,_,y,x,w,S)=>o.mutateAsync({budgetId:l,year:h,month:f,amount:p,categoryId:g,accountId:_,date:y,payee:x,description:w,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function ez(t,e,n,r,s,o,c,l){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=c||void 0;return e!==t.amount||n!==t.category_id||r!==t.account_id||s!==t.date||f!==h||g!==p||l!==t.cleared}function tz(){const t=Rt(),{currentViewingDocument:e}=Qe(),{saveCurrentDocument:n}=Pn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:s}=Sr();return{updateExpense:async(c,l,h,f,p,g,_,y,x,w,S)=>{const E=await wr(c,l,h);if(!E)throw new Error(`Month not found: ${l}/${h}`);const T=(E.expenses||[]).find(O=>O.id===f);if(!ez(T,p,g,_,y,x,w,S))return{updatedMonth:E,noOp:!0};const A={id:f,amount:Ee(p),category_id:g,account_id:_,date:y,created_at:E.expenses?.find(O=>O.id===f)?.created_at||new Date().toISOString()};x?.trim()&&(A.payee=x.trim()),w&&(A.description=w),S!==void 0&&(A.cleared=S);const M=(E.expenses||[]).map(O=>O.id===f?A:O),L={...E,expenses:M,updated_at:new Date().toISOString()};r(c,l,h,L);try{await s(c,l,h)}catch(O){console.warn("[useUpdateExpense] Failed to recalculate month and cascade:",O)}if(x?.trim()){const O=t.getQueryData(Te.payees(c))||[],j=await Vm(c,x,O);j&&t.setQueryData(Te.payees(c),j)}if(e.type==="month"&&e.year===l&&e.month===h)try{await n(c,"month",l,h)}catch(O){console.warn("[useUpdateExpense] Failed to save current document immediately:",O)}return{updatedMonth:L}},isPending:!1,isError:!1,error:null}}function nz(){const{currentViewingDocument:t}=Qe(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=Sr();return{deleteExpense:async(o,c,l,h)=>{const f=await wr(o,c,l);if(!f)throw new Error(`Month not found: ${c}/${l}`);const p=(f.expenses||[]).filter(y=>y.id!==h),g={...f,expenses:p,updated_at:new Date().toISOString()};n(o,c,l,g);try{await r(o,c,l)}catch(y){console.warn("[useDeleteExpense] Failed to recalculate month and cascade:",y)}if(t.type==="month"&&t.year===c&&t.month===l)try{await e(o,"month",c,l)}catch(y){console.warn("[useDeleteExpense] Failed to save current document immediately:",y)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function rz(t,e){const n={id:e,amount:Ee(t.amount),from_account_id:t.fromAccountId,to_account_id:t.toAccountId,from_category_id:t.fromCategoryId,to_category_id:t.toCategoryId,date:t.date,created_at:new Date().toISOString()};return t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function iz(){const t=Rt(),{currentViewingDocument:e}=Qe(),{saveCurrentDocument:n}=Pn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:s}=Sr(),o=Tn({onMutate:async l=>{const{budgetId:h,year:f,month:p}=l,g=Te.month(h,f,p);await t.cancelQueries({queryKey:g});const _=t.getQueryData(g),y=`transfer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=rz(l,y);if(_?.month){const S={..._.month,transfers:[..._.month.transfers||[],x],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await s(h,f,p)}catch(S){console.warn("[useAddTransfer] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddTransfer] Failed to save current document immediately:",S)}return{previousData:_,transferId:y,newTransfer:x}},mutationFn:async l=>{const{budgetId:h,year:f,month:p}=l,g=Te.month(h,f,p),_=t.getQueryData(g);if(!_?.month)throw new Error("No month data in cache after optimistic update");const y=_.month,x=y.transfers?.[y.transfers.length-1];if(!x)throw new Error("Could not find new transfer in updated month");return{updatedMonth:y,newTransfer:x}},onError:(l,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:_}=h;t.setQueryData(Te.month(p,g,_),f.previousData)}}});return{addTransfer:async(l,h,f,p,g,_,y,x,w,S,E)=>o.mutateAsync({budgetId:l,year:h,month:f,amount:p,fromAccountId:g,toAccountId:_,fromCategoryId:y,toCategoryId:x,date:w,description:S,cleared:E}),isPending:o.isPending,isError:o.isError,error:o.error}}function sz(t,e,n,r,s,o,c,l,h){if(!t)return!0;const f=t.description||void 0,p=l||void 0;return e!==t.amount||n!==t.from_account_id||r!==t.to_account_id||s!==t.from_category_id||o!==t.to_category_id||c!==t.date||p!==f||h!==t.cleared}function az(){const{currentViewingDocument:t}=Qe(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=Sr();return{updateTransfer:async(o,c,l,h,f,p,g,_,y,x,w,S)=>{const E=await wr(o,c,l);if(!E)throw new Error(`Month not found: ${c}/${l}`);const T=(E.transfers||[]).find(O=>O.id===h);if(!sz(T,f,p,g,_,y,x,w,S))return{updatedMonth:E,noOp:!0};const A={id:h,amount:Ee(f),from_account_id:p,to_account_id:g,from_category_id:_,to_category_id:y,date:x,created_at:E.transfers?.find(O=>O.id===h)?.created_at||new Date().toISOString()};w&&(A.description=w),S!==void 0&&(A.cleared=S);const M=(E.transfers||[]).map(O=>O.id===h?A:O),L={...E,transfers:M,updated_at:new Date().toISOString()};n(o,c,l,L);try{await r(o,c,l)}catch(O){console.warn("[useUpdateTransfer] Failed to recalculate month and cascade:",O)}if(t.type==="month"&&t.year===c&&t.month===l)try{await e(o,"month",c,l)}catch(O){console.warn("[useUpdateTransfer] Failed to save current document immediately:",O)}return{updatedMonth:L}},isPending:!1,isError:!1,error:null}}function oz(){const{currentViewingDocument:t}=Qe(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=Sr();return{deleteTransfer:async(o,c,l,h)=>{const f=await wr(o,c,l);if(!f)throw new Error(`Month not found: ${c}/${l}`);const p=(f.transfers||[]).filter(y=>y.id!==h),g={...f,transfers:p,updated_at:new Date().toISOString()};n(o,c,l,g);try{await r(o,c,l)}catch(y){console.warn("[useDeleteTransfer] Failed to recalculate month and cascade:",y)}if(t.type==="month"&&t.year===c&&t.month===l)try{await e(o,"month",c,l)}catch(y){console.warn("[useDeleteTransfer] Failed to save current document immediately:",y)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function cz(t,e){const n={id:e,amount:Ee(t.amount),account_id:t.accountId,category_id:t.categoryId,date:t.date,created_at:new Date().toISOString()};return t.payee?.trim()&&(n.payee=t.payee.trim()),t.description&&(n.description=t.description),t.cleared!==void 0&&(n.cleared=t.cleared),n}function lz(){const t=Rt(),{currentViewingDocument:e}=Qe(),{saveCurrentDocument:n}=Pn(),{updateMonthCacheAndTrack:r,recalculateMonthAndCascade:s}=Sr(),o=Tn({onMutate:async l=>{const{budgetId:h,year:f,month:p}=l,g=Te.month(h,f,p);await t.cancelQueries({queryKey:g});const _=t.getQueryData(g),y=`adjustment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x=cz(l,y);if(_?.month){const S={..._.month,adjustments:[..._.month.adjustments||[],x],updated_at:new Date().toISOString()};r(h,f,p,S)}try{await s(h,f,p)}catch(S){console.warn("[useAddAdjustment] Failed to recalculate month and cascade:",S)}if(e.type==="month"&&e.year===f&&e.month===p)try{await n(h,"month",f,p)}catch(S){console.warn("[useAddAdjustment] Failed to save current document immediately:",S)}return{previousData:_,adjustmentId:y,newAdjustment:x}},mutationFn:async l=>{const{budgetId:h,year:f,month:p}=l,g=Te.month(h,f,p),_=t.getQueryData(g);if(!_?.month)throw new Error("No month data in cache after optimistic update");const y=_.month,x=y.adjustments?.[y.adjustments.length-1];if(!x)throw new Error("Could not find new adjustment in updated month");return{updatedMonth:y,newAdjustment:x}},onError:(l,h,f)=>{if(f?.previousData){const{budgetId:p,year:g,month:_}=h;t.setQueryData(Te.month(p,g,_),f.previousData)}}});return{addAdjustment:async(l,h,f,p,g,_,y,x,w,S)=>o.mutateAsync({budgetId:l,year:h,month:f,amount:p,accountId:g,categoryId:_,date:y,payee:x,description:w,cleared:S}),isPending:o.isPending,isError:o.isError,error:o.error}}function uz(t,e,n,r,s,o,c,l){if(!t)return!0;const h=t.payee||void 0,f=o?.trim()||void 0,p=t.description||void 0,g=c||void 0;return e!==t.amount||n!==t.account_id||r!==t.category_id||s!==t.date||f!==h||g!==p||l!==t.cleared}function dz(){const{currentViewingDocument:t}=Qe(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=Sr();return{updateAdjustment:async(o,c,l,h,f,p,g,_,y,x,w)=>{const S=await wr(o,c,l);if(!S)throw new Error(`Month not found: ${c}/${l}`);const E=(S.adjustments||[]).find(H=>H.id===h);if(!uz(E,f,p,g,_,y,x,w))return{updatedMonth:S,noOp:!0};const T={id:h,amount:Ee(f),account_id:p,category_id:g,date:_,created_at:S.adjustments?.find(H=>H.id===h)?.created_at||new Date().toISOString()};y?.trim()&&(T.payee=y.trim()),x&&(T.description=x),w!==void 0&&(T.cleared=w);const A=(S.adjustments||[]).map(H=>H.id===h?T:H),M={...S,adjustments:A,updated_at:new Date().toISOString()};n(o,c,l,M);try{await r(o,c,l)}catch(H){console.warn("[useUpdateAdjustment] Failed to recalculate month and cascade:",H)}if(t.type==="month"&&t.year===c&&t.month===l)try{await e(o,"month",c,l)}catch(H){console.warn("[useUpdateAdjustment] Failed to save current document immediately:",H)}return{updatedMonth:M}},isPending:!1,isError:!1,error:null}}function hz(){const{currentViewingDocument:t}=Qe(),{saveCurrentDocument:e}=Pn(),{updateMonthCacheAndTrack:n,recalculateMonthAndCascade:r}=Sr();return{deleteAdjustment:async(o,c,l,h)=>{const f=await wr(o,c,l);if(!f)throw new Error(`Month not found: ${c}/${l}`);const p=(f.adjustments||[]).filter(y=>y.id!==h),g={...f,adjustments:p,updated_at:new Date().toISOString()};n(o,c,l,g);try{await r(o,c,l)}catch(y){console.warn("[useDeleteAdjustment] Failed to recalculate month and cascade:",y)}if(t.type==="month"&&t.year===c&&t.month===l)try{await e(o,"month",c,l)}catch(y){console.warn("[useDeleteAdjustment] Failed to save current document immediately:",y)}return{updatedMonth:g}},isPending:!1,isError:!1,error:null}}function fz({budgetId:t,enabled:e,initialDataLoadComplete:n,months:r,setInitialBalanceCalculationComplete:s}){const{addLoadingHold:o,removeLoadingHold:c}=kn(),l=R.useRef(!1),h=R.useRef(null),f=R.useRef(!1);R.useEffect(()=>{if(t!==h.current&&(l.current=!1,h.current=t),n&&!f.current&&(l.current=!1),f.current=n,!e||!t||!n||l.current)return;if(r.length===0){s(!0);return}l.current=!0,(async()=>{try{o("initial-balance-calculation","Calculating balances..."),await JT(t,{months:r});const g=Pe.getQueryData(Te.budget(t));if(!g){s(!0);return}const{budget:_}=g,y=_.month_map||{},x={...y};for(const S of r){const E=Fe(S.year,S.month);E in x||(x[E]={})}if(JSON.stringify(y)!==JSON.stringify(x)){c("initial-balance-calculation"),o("initial-balance-calculation","Saving month map...");const{writeBudgetData:S}=await id(async()=>{const{writeBudgetData:E}=await Promise.resolve().then(()=>mA);return{writeBudgetData:E}},void 0);await S({budgetId:t,updates:{month_map:x},description:"initial balance calculation: updating month_map"}),Pe.setQueryData(Te.budget(t),{...g,budget:{..._,month_map:x},monthMap:x})}}catch(g){console.error("[useInitialBalanceCalculation] Error:",g),Hn.add({type:"error",message:`Initial balance calculation failed: ${g instanceof Error?g.message:"Unknown error"}`,autoDismissMs:1e4})}finally{c("initial-balance-calculation"),s(!0)}})()},[e,t,n,r,o,c,s])}function mz({current_user:t,isInitialized:e,userQuery:n,accessibleBudgetsQuery:r,setSelectedBudgetId:s,setNeedsFirstBudget:o,setIsInitialized:c}){R.useEffect(()=>{if(!t||e||n.isLoading)return;const l=n.data;if(!l&&!n.isError)return;const h=l?.permission_flags?.is_admin===!0,f=l?.budget_ids||[],p=h?f.filter(y=>!KS(y)):f,g=l?.last_selected_budget_id,_=g&&(f.includes(g)||h&&KS(g));if(f.length>0){const y=_?g:f[0];s(y),o(h&&p.length===0),c(!0)}else{if(r.isLoading)return;const y=r.data;o(!(y?.pendingInvites&&y.pendingInvites.length>0)),c(!0)}},[t,e,n.data,n.isLoading,n.isError,r.data,r.isLoading,s,o,c])}function gz(){const t=Rt();return{createBudget:Tn({mutationFn:async({name:n,userId:r,userEmail:s})=>{const o=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,c=new Date().toISOString(),l={name:n.trim()||"My Budget",user_ids:[r],accepted_user_ids:[r],owner_id:r,owner_email:s,accounts:{},account_groups:{[Vt]:{name:"Ungrouped",sort_order:0,expected_balance:"positive",on_budget:null,is_active:null}},categories:{},category_groups:[{id:Xt,name:"Uncategorized",sort_order:0}],month_map:{},percentage_income_months_back:1,created_at:c,updated_at:c};return await dr("budgets",o,l),await dr("users",r,{uid:r,email:s,budget_ids:td(o),updated_at:c},"adding new budget to user's budget list",{merge:!0}),{budgetId:o,budget:{id:o,...l}}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Te.user(r)}),t.invalidateQueries({queryKey:Te.accessibleBudgets(r)})}})}}function pz(){const t=Rt();return{acceptInvite:Tn({mutationFn:async({budgetId:n,userId:r})=>{const s=new Date().toISOString(),{exists:o,data:c}=await vt("budgets",n);if(!o||!c)throw new Error("Budget not found");if(!c.user_ids?.includes(r))throw new Error("You have not been invited to this budget");if(c.accepted_user_ids?.includes(r))throw new Error("You have already accepted this invite");return await dr("users",r,{uid:r,budget_ids:td(n),updated_at:s},"adding accepted budget to user's budget list",{merge:!0}),await dr("budgets",n,{accepted_user_ids:td(r),updated_at:s},"marking user as accepted in budget's accepted_user_ids",{merge:!0}),{budgetId:n}},onSuccess:(n,{userId:r})=>{t.invalidateQueries({queryKey:Te.user(r)}),t.invalidateQueries({queryKey:Te.accessibleBudgets(r)}),t.invalidateQueries({queryKey:Te.budget(n.budgetId)})}})}}function yz(){const t=Rt(),e=Tn({onMutate:async r=>{const{budgetId:s,userId:o}=r,c=Te.budget(s);await t.cancelQueries({queryKey:c});const l=t.getQueryData(c);return l&&t.setQueryData(c,{...l,budget:{...l.budget,user_ids:[...l.budget.user_ids,o]}}),{previousData:l}},mutationFn:async r=>{const{budgetId:s,userId:o}=r,{exists:c,data:l}=await vt("budgets",s);if(!c||!l)throw new Error("Budget not found");if(l.user_ids?.includes(o))throw new Error("User is already invited");return await Zo({budgetId:s,updates:{user_ids:td(o)},description:"adding user to budget's invited users list"}),{budgetId:s}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Te.budget(s.budgetId),o.previousData)}});return{inviteUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}function _z(){const t=Rt(),e=Tn({onMutate:async r=>{const{budgetId:s,userId:o}=r,c=Te.budget(s);await t.cancelQueries({queryKey:c});const l=t.getQueryData(c);return l&&t.setQueryData(c,{...l,budget:{...l.budget,user_ids:l.budget.user_ids.filter(h=>h!==o),accepted_user_ids:l.budget.accepted_user_ids.filter(h=>h!==o)}}),{previousData:l}},mutationFn:async r=>{const{budgetId:s,userId:o}=r;return await Zo({budgetId:s,updates:{user_ids:QS(o),accepted_user_ids:QS(o)},description:"removing user from budget's access lists"}),{budgetId:s}},onError:(r,s,o)=>{o?.previousData&&t.setQueryData(Te.budget(s.budgetId),o.previousData)}});return{revokeUser:{mutate:r=>e.mutate(r),mutateAsync:r=>e.mutateAsync(r),isPending:e.isPending,isError:e.isError,error:e.error,reset:e.reset}}}async function bz(t){const{userId:e,updates:n,description:r}=t,s={...n,updated_at:new Date().toISOString()};await dr("users",e,s,r,{merge:!0});const o=Pe.getQueryData(Te.user(e));o&&Pe.setQueryData(Te.user(e),{...o,...n,updated_at:s.updated_at})}function vz({selectedBudgetId:t,current_user:e,accessibleBudgetsQuery:n,setInitialDataLoadComplete:r,setInitialBalanceCalculationComplete:s,setCurrentYear:o,setCurrentMonthNumber:c,setSelectedBudgetId:l,setNeedsFirstBudget:h}){const f=R.useCallback(async _=>{(_?.force||!n.data)&&await n.refetch()},[n]),p=R.useCallback(_=>{t&&t!==_&&(Pe.removeQueries({queryKey:Te.budget(t)}),Pe.removeQueries({queryKey:["month",t]}),Pe.removeQueries({queryKey:Te.payees(t)})),Pe.removeQueries({queryKey:["initialDataLoad",_]}),Pe.removeQueries({queryKey:Te.budget(_)}),Pe.removeQueries({queryKey:["month",_]}),Pe.removeQueries({queryKey:Te.payees(_)}),r(!1),s(!1);const y=new Date;o(y.getFullYear()),c(y.getMonth()+1),l(_),h(!1),e?.uid&&bz({userId:e.uid,updates:{last_selected_budget_id:_},description:"save last selected budget for reload"}).catch(x=>console.error("[BudgetContext] Failed to save last selected budget:",x))},[t,e,r,s,o,c,l,h]),g=R.useCallback(async _=>{if(!e)return null;try{const y=await tP(_,e.uid);return y&&y.isInvited&&!y.hasAccepted?{budgetId:_,budgetName:y.budgetName,ownerEmail:y.ownerEmail}:null}catch(y){return console.error("[BudgetContext] Error checking budget invite:",y),null}},[e]);return{loadAccessibleBudgets:f,switchToBudget:p,checkBudgetInvite:g}}const xz={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastBalancesTab:"categories",lastTransactionsTab:"income",lastSettingsTab:"categories",lastAdminTab:"budget",currentViewingDocument:{type:null},setCurrentViewingDocument:()=>{},setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,initialDataLoadComplete:!1,initialBalanceCalculationComplete:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isLoadingAccessibleBudgets:!1,isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{},resetInitialLoadState:()=>{}},MA=R.createContext(xz);function wz(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,s=(typeof window<"u"?window.location.pathname:"").match(/\/budget\/(\d{4})\/(\d{1,2})/);if(!s)return{year:e,month:n};const o=parseInt(s[1],10),c=parseInt(s[2],10);return o<2e3||o>2100?{year:e,month:n}:c<1||c>12?{year:e,month:n}:{year:o,month:c}}function Sz({children:t}){const n=Us().get_current_firebase_user(),[r,s]=R.useState(null),o=wz(),[c,l]=R.useState(o.year),[h,f]=R.useState(o.month),[p,g]=R.useState("categories"),[_,y]=R.useState("categories"),[x,w]=R.useState("income"),S=R.useCallback(ue=>{g(ue),ue==="categories"||ue==="accounts"?y(ue):w(ue)},[]),[E,T]=R.useState("categories"),[A,M]=R.useState("budget"),[L,H]=R.useState("Budget"),O=R.useCallback(ue=>{H(J=>J===ue?J:ue)},[]),[j,B]=R.useState({type:null}),[V,$]=R.useState(!1),[k,N]=R.useState(!1),D=XT(n?.uid||null,n?.email||null),X=D.data&&D.data.budget_ids.length===0,K=WB(n?.uid||null,D.data||null,{enabled:!!n?.uid&&!!D.data&&X}),q=t3(r,{enabled:!!r&&V,referenceMonth:{year:c,month:h}}),[te,Q]=R.useState(!1),[ae,P]=R.useState(!1);R.useEffect(()=>{if(!q.data||te)return;const{budget:ue,payees:J,months:Z}=q.data,oe=Date.now();Pe.setQueryData(Te.budget(r),ue,{updatedAt:oe}),Pe.setQueryData(Te.payees(r),J,{updatedAt:oe});for(const Se of Z)Pe.setQueryData(Te.month(r,Se.year,Se.month),{month:Se},{updatedAt:oe});if(Z.length>0&&!Z.some(xe=>xe.year===c&&xe.month===h)){const de=[...Z].sort((Ne,Ae)=>Ne.year!==Ae.year?Ae.year-Ne.year:Ae.month-Ne.month)[0];l(de.year),f(de.month)}Q(!0)},[q.data,r,c,h,te]),fz({budgetId:r,enabled:!!r&&V&&te,initialDataLoadComplete:te,months:q.data?.months||[],setInitialBalanceCalculationComplete:P}),R.useEffect(()=>{r||(Q(!1),P(!1))},[r]),mz({current_user:n,isInitialized:V,userQuery:D,accessibleBudgetsQuery:K,setSelectedBudgetId:s,setNeedsFirstBudget:N,setIsInitialized:$});const{loadAccessibleBudgets:G,switchToBudget:ee,checkBudgetInvite:re}=vz({selectedBudgetId:r,current_user:n,accessibleBudgetsQuery:K,setInitialDataLoadComplete:Q,setInitialBalanceCalculationComplete:P,setCurrentYear:l,setCurrentMonthNumber:f,setSelectedBudgetId:s,setNeedsFirstBudget:N}),se=D.data?.permission_flags?.is_admin===!0,ge=D.data?.permission_flags?.is_test===!0,Ce=K.data?.pendingInvites||[],ie=K.data?.budgets||[],le=Ce.length>0,Me=K.isLoading||K.isFetching,Be=R.useCallback(()=>{h===1?(l(ue=>ue-1),f(12)):f(ue=>ue-1)},[h]),Ze=R.useCallback(()=>{h===12?(l(ue=>ue+1),f(1)):f(ue=>ue+1)},[h]),st=R.useCallback(()=>Pe.clear(),[]),U=R.useCallback(()=>{Q(!1),P(!1)},[]),fe={currentUserId:n?.uid||null,selectedBudgetId:r,currentYear:c,currentMonthNumber:h,lastActiveTab:p,lastBalancesTab:_,lastTransactionsTab:x,lastSettingsTab:E,lastAdminTab:A,currentViewingDocument:j,setCurrentViewingDocument:B,setSelectedBudgetId:s,setCurrentYear:l,setCurrentMonthNumber:f,setLastActiveTab:S,setLastSettingsTab:T,setLastAdminTab:M,pageTitle:L,setPageTitle:O,isInitialized:V,needsFirstBudget:k,initialDataLoadComplete:te,initialBalanceCalculationComplete:ae,goToPreviousMonth:Be,goToNextMonth:Ze,pendingInvites:Ce,hasPendingInvites:le,accessibleBudgets:ie,isLoadingAccessibleBudgets:Me,isAdmin:se,isTest:ge,loadAccessibleBudgets:G,switchToBudget:ee,checkBudgetInvite:re,clearCache:st,resetInitialLoadState:U};return d.jsx(MA.Provider,{value:fe,children:t})}function Qe(){const t=R.useContext(MA);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const Cz=function(){},Ez={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:Cz},Rd=R.createContext(Ez);function u1({budget:t,isCurrent:e,isAccepting:n,isSwitching:r,isEditing:s,editName:o,isRenaming:c,onAccept:l,onSwitch:h,onStartEdit:f,onCancelEdit:p,onEditNameChange:g,onSaveEdit:_}){const y=e&&t.isOwner;return d.jsx("div",{style:{background:e?"color-mix(in srgb, var(--color-primary) 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, var(--color-primary) 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:s?d.jsxs("form",{onSubmit:_,children:[d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:d.jsx("input",{type:"text",value:o,onChange:x=>g(x.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[d.jsx("button",{type:"submit",disabled:c||!o.trim(),style:{background:"var(--color-success)",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:c||!o.trim()?"not-allowed":"pointer",fontWeight:500,opacity:c||!o.trim()?.7:1,fontSize:"0.8rem"},children:c?"Saving...":"Save"}),d.jsx("button",{type:"button",onClick:p,disabled:c,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:c?"not-allowed":"pointer",fontWeight:500,opacity:c?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[d.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[d.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&d.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-success) 20%, transparent)",color:"var(--color-success)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-warning) 20%, transparent)",color:"var(--color-warning)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),t.isSampleBudget&&d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-primary) 20%, transparent)",color:"var(--color-primary)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:" Sample"}),y&&d.jsx("button",{onClick:f,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),d.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`}),t.ownerEmail&&d.jsx("p",{style:{margin:"0.15rem 0 0 0",fontSize:"0.7rem",opacity:.4,fontFamily:"monospace"},children:t.id})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?d.jsx("button",{onClick:l,disabled:n,style:{background:"var(--color-success)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:d.jsx("button",{onClick:h,disabled:r,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:r?"not-allowed":"pointer",fontWeight:500,opacity:r?.7:1,fontSize:"0.85rem"},children:r?"Switching...":"Switch"})})]})})}function OA({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,r=n&&n in od?n:"bug",s=od[r];return d.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:s.bgColor,color:s.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:o=>{o.currentTarget.style.opacity="0.8",o.currentTarget.style.transform="scale(1.05)"},onMouseLeave:o=>{o.currentTarget.style.opacity="1",o.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:s.label})}function Tz({item:t,isDragging:e,isDragOver:n,onDragStart:r,onDragOver:s,onDragLeave:o,onDragEnd:c,onDrop:l,onToggleDone:h,onTypeClick:f}){return d.jsxs("div",{onDragOver:p=>{p.stopPropagation(),s(p)},onDragLeave:p=>{p.stopPropagation(),o()},onDrop:p=>{p.stopPropagation(),l(p)},style:{position:"relative"},children:[d.jsx("div",{style:{...CP,opacity:n?1:0,boxShadow:n?"0 0 8px var(--shadow-primary)":"none"}}),d.jsxs("div",{draggable:!0,onDragStart:r,onDragEnd:c,style:{...u0,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[d.jsx("span",{style:{...SP},children:""}),d.jsx("input",{type:"checkbox",checked:t.is_done,onChange:h,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:me.primary,flexShrink:0}}),d.jsx(OA,{type:t.feedback_type,onClick:f})]}),d.jsxs("div",{style:{marginLeft:"3.25rem"},children:[d.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),d.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",Xy(t.created_at)]})]})]})]})}function Az({item:t,onToggleDone:e,onTypeClick:n}){return d.jsxs("div",{style:{...u0,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[d.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:me.primary,flexShrink:0}}),d.jsx(OA,{type:t.feedback_type,onClick:n})]}),d.jsxs("div",{style:{marginLeft:"2rem"},children:[d.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),d.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",Xy(t.created_at)]}),t.completed_at&&d.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:me.success},children:[" Completed: ",Xy(t.completed_at)]})]})]})}function Cn({noMargin:t}={}){return d.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid var(--border-strong)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function NA(){const{state:t,closeModal:e}=Jo();if(!t.isOpen)return null;const n=t.isComplete;return d.jsx("div",{style:{position:"fixed",inset:0,background:"var(--modal-backdrop)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1002,padding:"1rem"},onClick:n?e:void 0,children:d.jsxs("div",{style:{background:"var(--surface-base)",color:"var(--text-primary)",borderRadius:"16px",padding:"2rem",width:"32rem",maxWidth:"calc(100vw - 2rem)",boxShadow:"0 8px 32px var(--shadow-overlay)"},onClick:r=>r.stopPropagation(),children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[d.jsxs("h2",{style:{margin:0,fontSize:"1.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[!t.isComplete&&d.jsx(Cn,{noMargin:!0}),t.migrationName]}),n&&d.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1,padding:"0.25rem"},title:"Close",children:""})]}),d.jsxs("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:"1rem",color:t.error?"var(--color-error)":t.isComplete?"var(--color-success)":"inherit"},children:[t.error?" ":t.isComplete?" ":"",t.stage]}),d.jsx("div",{style:{background:"var(--border-subtle)",borderRadius:"8px",height:"12px",overflow:"hidden",marginBottom:"1rem"},children:t.progress!==null?d.jsx("div",{style:{background:t.error?"var(--color-error)":t.isComplete?"var(--color-success)":"var(--color-primary)",height:"100%",width:`${t.progress}%`,transition:"width 0.3s ease-out",borderRadius:"8px"}}):d.jsx("div",{style:{background:t.error?"var(--color-error)":"var(--color-primary)",height:"100%",width:"30%",borderRadius:"8px",animation:"progressIndeterminate 1.5s ease-in-out infinite"}})}),t.currentItem&&d.jsx("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"0.5rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.currentItem}),t.details&&d.jsx("div",{style:{fontSize:"0.85rem",opacity:.6,marginBottom:t.error?"1rem":0},children:t.details}),t.error&&d.jsx("div",{style:{background:"var(--color-error-bg)",border:"1px solid var(--color-error-border)",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:"var(--color-error)"},children:t.error}),t.isComplete&&d.jsx("button",{onClick:e,style:{marginTop:"1.5rem",width:"100%",background:t.error?"var(--color-error-bg)":"var(--color-primary)",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:"pointer",fontWeight:500,fontSize:"1rem"},children:t.error?"Close":"Done"}),!t.isComplete&&d.jsx("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.5,textAlign:"center"},children:"Please wait  do not close this window"}),d.jsx("style",{children:`
            @keyframes progressIndeterminate {
              0% { transform: translateX(-100%); }
              100% { transform: translateX(400%); }
            }
          `})]})})}function $i({isOpen:t,onClose:e,onConfirm:n,migrationName:r,isDestructive:s=!1,onDownloadBackup:o,isDownloading:c=!1}){const[l,h]=R.useState(!1),f=R.useCallback(async()=>{o&&(await o(),h(!0))},[o]),p=R.useCallback(()=>{n(l?"downloaded":"already-have")},[l,n]),g=R.useCallback(()=>{n("cancelled"),e()},[n,e]);return d.jsxs(Ji,{isOpen:t,onClose:g,title:" Backup Recommended",children:[d.jsx("div",{style:{background:s?"color-mix(in srgb, var(--color-error) 15%, transparent)":"color-mix(in srgb, var(--color-warning) 15%, transparent)",border:`1px solid ${s?"color-mix(in srgb, var(--color-error) 40%, transparent)":"color-mix(in srgb, var(--color-warning) 40%, transparent)"}`,borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:s?"var(--color-error-light)":"var(--color-warning-light)",fontWeight:500,fontSize:"0.95rem"},children:s?" This migration modifies your data. A backup is strongly recommended!":" Before running migrations, we recommend having a recent backup."})}),d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["You are about to run: ",d.jsx("strong",{children:r})]}),d.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"Please ensure you have a recent backup of your data. You can download a diagnostic backup that includes all your budget and month data."}),o&&d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx(Ge,{variant:"secondary",onClick:f,disabled:c,actionName:"Download Backup Before Migration",style:{width:"100%"},children:c?d.jsxs(d.Fragment,{children:[d.jsx(Cn,{noMargin:!0})," Downloading Backup..."]}):l?" Backup Downloaded":" Download Backup Now"})}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ge,{variant:"secondary",actionName:"Cancel Migration",onClick:g,children:"Cancel"}),d.jsx(Ge,{variant:s?"danger":"primary",actionName:`Proceed with ${r}`,onClick:p,disabled:c,children:l?" Proceed with Migration":" I Have a Backup - Proceed"})]})]})}function Gi({migrationName:t,isDestructive:e=!1,onDownloadBackup:n}){const[r,s]=R.useState(!1),[o,c]=R.useState(!1),[l,h]=R.useState(null),f=R.useCallback(y=>{h(()=>y),s(!0)},[]),p=R.useCallback(y=>{y!=="cancelled"&&l&&l(),h(null),s(!1)},[l]),g=R.useCallback(()=>{h(null),s(!1)},[]),_=R.useCallback(async()=>{if(n){c(!0);try{await n()}finally{c(!1)}}},[n]);return{promptBeforeAction:f,promptProps:{isOpen:r,onClose:g,onConfirm:p,migrationName:t,isDestructive:e,onDownloadBackup:n?_:void 0,isDownloading:o}}}const jz={onetime:{borderColor:"color-mix(in srgb, var(--color-migration-purple) 30%, transparent)",iconBg:"color-mix(in srgb, var(--color-migration-purple) 15%, transparent)",headerBg:"color-mix(in srgb, var(--color-migration-purple) 8%, transparent)"},maintenance:{borderColor:"color-mix(in srgb, var(--color-migration-blue) 30%, transparent)",iconBg:"color-mix(in srgb, var(--color-migration-blue) 15%, transparent)",headerBg:"color-mix(in srgb, var(--color-migration-blue) 8%, transparent)"},utility:{borderColor:"color-mix(in srgb, var(--color-migration-green) 30%, transparent)",iconBg:"color-mix(in srgb, var(--color-migration-green) 15%, transparent)",headerBg:"color-mix(in srgb, var(--color-migration-green) 8%, transparent)"}};function b0({title:t,icon:e,description:n,type:r,children:s,onValidateAll:o,isValidating:c=!1,isAnyRunning:l=!1}){const h=jz[r],f=c||l,p=()=>{o&&!f&&o()};return d.jsxs("section",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",border:`1px solid ${h.borderColor}`,borderRadius:"12px",marginBottom:"1.5rem",overflow:"hidden"},children:[d.jsxs("div",{style:{background:h.headerBg,padding:"1.25rem 1.5rem",borderBottom:`2px solid ${h.borderColor}`,display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.875rem",flex:1},children:[d.jsx("span",{style:{fontSize:"1.75rem",background:h.iconBg,padding:"0.625rem",borderRadius:"10px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"48px",minHeight:"48px"},children:e}),d.jsxs("div",{children:[d.jsx("h3",{style:{margin:"0 0 0.375rem 0",fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em"},children:t}),d.jsx("p",{style:{margin:0,opacity:.75,fontSize:"0.9rem",lineHeight:1.4},children:n})]})]}),o&&d.jsx("button",{onClick:p,disabled:f,style:{background:"color-mix(in srgb, var(--color-migration-blue) 20%, transparent)",color:"var(--color-migration-blue-light)",border:"1px solid color-mix(in srgb, var(--color-migration-blue) 40%, transparent)",padding:"0.5rem 1rem",borderRadius:"6px",cursor:f?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:f?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:c?d.jsxs(d.Fragment,{children:[d.jsx(Cn,{noMargin:!0})," Validating..."]}):" Validate All"})]}),d.jsx("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 1%, transparent)"},children:s})]})}const Rz={unknown:{color:"var(--text-muted)",icon:"",text:"Unknown"},clean:{color:"var(--color-success)",icon:"",text:"Clean"},"needs-action":{color:"var(--color-warning)",icon:"",text:"Needs Action"},running:{color:"var(--color-migration-blue-light)",icon:"",text:"Running"},complete:{color:"var(--color-success)",icon:"",text:"Complete"},error:{color:"var(--color-error)",icon:"",text:"Error"}};function Vs({name:t,description:e,status:n,statusText:r,onCheck:s,isChecking:o,onRun:c,isRunning:l=!1,actionText:h="Run",disabled:f=!1,itemCount:p,details:g,isDestructive:_=!1}){const[y,x]=R.useState(!1),w=Rz[n],S=r||w.text,E=f||l||o,T=()=>{s()},A=()=>{c&&c()},M=()=>{g&&x(!y)};return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${w.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:l||o?d.jsx(Cn,{noMargin:!0}):w.icon}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]}),d.jsxs("div",{style:{color:w.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[S,p!==void 0&&p>0&&d.jsx("span",{style:{background:`color-mix(in srgb, ${w.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:p})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[d.jsx("button",{onClick:T,disabled:E,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:E?"not-allowed":"pointer",fontSize:"0.8rem",opacity:E?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check status",children:o?d.jsx(Cn,{noMargin:!0}):""}),c&&n==="needs-action"&&d.jsx("button",{onClick:A,disabled:E,style:{background:_?"var(--color-error)":"var(--color-primary)",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:E?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:E?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:l?d.jsx(Cn,{noMargin:!0}):h}),g&&d.jsx("button",{onClick:M,style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:y?"Collapse details":"Expand details",children:y?"":""})]})]}),y&&g&&d.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:g})]})}function Iz({name:t,description:e,onAction:n,actionText:r,actionIcon:s,isRunning:o=!1,disabled:c=!1,progress:l,error:h,isDestructive:f=!1}){const p=c||o,g=()=>{n()};return d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e}),h&&d.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-error)",marginTop:"0.25rem"},children:h})]}),l!==void 0&&o&&d.jsxs("div",{style:{width:"100px",flexShrink:0},children:[d.jsx("div",{style:{background:"var(--border-subtle)",borderRadius:"4px",height:"6px",overflow:"hidden"},children:d.jsx("div",{style:{background:f?"var(--color-error)":"var(--color-primary)",height:"100%",width:`${l}%`,transition:"width 0.3s"}})}),d.jsxs("div",{style:{fontSize:"0.7rem",opacity:.6,textAlign:"center",marginTop:"0.15rem"},children:[l,"%"]})]}),d.jsx("button",{onClick:g,disabled:p,style:{background:f?"var(--color-error)":"var(--color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontSize:"0.85rem",fontWeight:500,opacity:p?.6:1,display:"flex",alignItems:"center",gap:"0.4rem",flexShrink:0},children:o?d.jsxs(d.Fragment,{children:[d.jsx(Cn,{noMargin:!0})," Running..."]}):d.jsxs(d.Fragment,{children:[s&&d.jsx("span",{children:s}),r]})})]})})}function kz(t,e,n,r,s){return r?"running":s?s.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function Dz(t,e,n,r){return e?n?`${r} month(s) need migration`:"No data to migrate":"No data scanned"}function Mz(t,e,n,r,s){return t?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&d.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.monthsProcessed>0&&d.jsxs("li",{children:[t.monthsProcessed," month(s) processed"]}),t.monthsUpdated>0&&d.jsxs("li",{children:[t.monthsUpdated," month(s) updated"]}),t.monthsUpdated===0&&t.monthsProcessed>0&&d.jsx("li",{children:"No months needed updates"})]}),t.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,c)=>d.jsx("li",{children:o},c)),t.errors.length>3&&d.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",s," month(s) with total_income or total_expenses fields."]}),r&&d.jsxs("div",{style:{opacity:.6,fontSize:"0.8rem"},children:[r.monthsWithTotalIncome>0&&`${r.monthsWithTotalIncome} with total_income`,r.monthsWithTotalIncome>0&&r.monthsWithTotalExpenses>0&&", ",r.monthsWithTotalExpenses>0&&`${r.monthsWithTotalExpenses} with total_expenses`]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All months are clean.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalMonths," month(s) across ",r.totalBudgets," budget(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months with total_income or total_expenses fields."})}function Oz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:s,isRunning:o,result:c,onCheck:l,onRun:h,disabled:f}){return d.jsx(Vs,{name:"Remove Total Fields Migration",description:"Removes total_income and total_expenses from month documents. These are calculated from income/expenses arrays on-the-fly.",status:kz(t,e,n,o,c),statusText:Dz(t,e,n,r),isChecking:s,isRunning:o,onCheck:l,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:Mz(c,e,n,t,r)})}function Nz(t,e,n,r,s){return r?"running":s?s.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function Bz(t,e,n,r){return e?n?`${r} month(s) need migration`:"No data to migrate":"No data scanned"}function Pz(t,e,n,r,s){return t?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&d.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.monthsProcessed>0&&d.jsxs("li",{children:[t.monthsProcessed," month(s) processed"]}),t.monthsUpdated>0&&d.jsxs("li",{children:[t.monthsUpdated," month(s) updated"]}),t.monthsUpdated===0&&t.monthsProcessed>0&&d.jsx("li",{children:"No months needed updates"})]}),t.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,c)=>d.jsx("li",{children:o},c)),t.errors.length>3&&d.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",s," month(s) with previous_month_income field."]}),d.jsx("div",{style:{opacity:.6,fontSize:"0.8rem"},children:"This field is now calculated from the previous month's income array."})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All months are clean.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalMonths," month(s) across ",r.totalBudgets," budget(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months with previous_month_income field."})}function zz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:s,isRunning:o,result:c,onCheck:l,onRun:h,disabled:f}){return d.jsx(Vs,{name:"Remove Previous Month Income Migration",description:"Removes previous_month_income from month documents. This is calculated from the previous month's income array on-the-fly.",status:Nz(t,e,n,o,c),statusText:Bz(t,e,n,r),isChecking:s,isRunning:o,onCheck:l,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:Pz(c,e,n,t,r)})}function Lz(t,e,n,r,s){return r?"running":s?s.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function Uz(t,e,n,r){return e?n?`${r} budget(s) need migration`:"No data to migrate":"No data scanned"}function Fz(t,e,n,r,s){return t?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&d.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.budgetsUpdated>0&&d.jsxs("li",{children:[t.budgetsUpdated," budget(s) updated"]}),t.budgetsUpdated===0&&t.budgetsProcessed>0&&d.jsx("li",{children:"No budgets needed updates"})]}),t.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,c)=>d.jsx("li",{children:o},c)),t.errors.length>3&&d.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",s," budget(s) missing percentage_income_months_back."]}),d.jsx("div",{style:{opacity:.6,fontSize:"0.8rem"},children:"Adds percentage_income_months_back: 1 so percentage-based allocations use previous month income by default."})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All budgets have percentage_income_months_back set.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalBudgets," budget(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for budgets missing percentage_income_months_back."})}function Vz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:s,isRunning:o,result:c,onCheck:l,onRun:h,disabled:f}){return d.jsx(Vs,{name:"Percentage Income Months Back",description:"Adds percentage_income_months_back to all budgets (default 1). Use budget settings to change how many months back percentage-based allocation income is taken from.",status:Lz(t,e,n,o,c),statusText:Uz(t,e,n,r),isChecking:s,isRunning:o,onCheck:l,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:Fz(c,e,n,t,r)})}function $z(t,e,n,r,s){return r?"running":s?s.errors.length>0?"error":"complete":e?n?"needs-action":"clean":"unknown"}function Gz(t,e,n,r){return e?n?`${r} budget(s) need migration`:"No legacy fields found":"No data scanned"}function qz(t,e,n,r,s){return t?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.errors.length>0?" Completed with errors":" Migration complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsProcessed>0&&d.jsxs("li",{children:[t.budgetsProcessed," budget(s) processed"]}),t.budgetsUpdated>0&&d.jsxs("li",{children:[t.budgetsUpdated," budget(s) updated"]}),t.budgetsUpdated===0&&t.budgetsProcessed>0&&d.jsx("li",{children:"No budgets needed updates"})]}),t.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",t.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[t.errors.slice(0,3).map((o,c)=>d.jsx("li",{children:o},c)),t.errors.length>3&&d.jsxs("li",{children:["...and ",t.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:["Found ",s," budget(s) with legacy balance fields."]}),r&&d.jsxs("div",{style:{opacity:.6,fontSize:"0.8rem"},children:[r.budgetsWithLegacyFields," with legacy fields to remove"]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All budgets are clean.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",r.totalBudgets," budget(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for budgets with category_balances_cache or category_balances_snapshot fields."})}function Hz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:s,isRunning:o,result:c,onCheck:l,onRun:h,disabled:f}){return d.jsx(Vs,{name:"Remove Legacy Balance Fields",description:"Removes deprecated category_balances_cache and category_balances_snapshot fields from budgets.",status:$z(t,e,n,o,c),statusText:Gz(t,e,n,r),isChecking:s,isRunning:o,onCheck:l,onRun:n?h:void 0,actionText:n?`Migrate ${r}`:void 0,disabled:f,itemCount:r,details:qz(c,e,n,t,r)})}function Wz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,removeTotalFieldsMigration:r,removePreviousMonthIncomeMigration:s,percentageIncomeMonthsBackMigration:o,removeLegacyBalanceFieldsMigration:c}){const l=r.isRunning||s.isRunning||o.isRunning||c.isRunning;return d.jsx(d.Fragment,{children:d.jsxs(b0,{title:"One-Time Migrations",icon:"",description:"Migrations that typically only need to be run once. Check status first, then apply if needed.",type:"onetime",isAnyRunning:l,children:[d.jsx(Oz,{status:r.status,hasData:r.hasData,needsMigration:r.needsMigration,totalItemsToFix:r.totalItemsToFix,isChecking:r.isScanning,isRunning:r.isRunning,result:r.result,onCheck:r.scanStatus,onRun:r.runMigration,disabled:t}),d.jsx(zz,{status:s.status,hasData:s.hasData,needsMigration:s.needsMigration,totalItemsToFix:s.totalItemsToFix,isChecking:s.isScanning,isRunning:s.isRunning,result:s.result,onCheck:s.scanStatus,onRun:s.runMigration,disabled:t}),d.jsx(Vz,{status:o.status,hasData:!!o.status,needsMigration:o.needsMigration,totalItemsToFix:o.totalItemsToFix,isChecking:o.isScanning,isRunning:o.isRunning,result:o.result,onCheck:o.scanStatus,onRun:o.runMigration,disabled:t}),d.jsx(Hz,{status:c.status,hasData:c.hasData,needsMigration:c.needsMigration,totalItemsToFix:c.totalItemsToFix,isChecking:c.isScanning,isRunning:c.isRunning,result:c.result,onCheck:c.scanStatus,onRun:c.runMigration,disabled:t})]})})}const BA={unknown:{color:"var(--text-muted)",icon:""},clean:{color:"var(--color-success)",icon:""},"needs-action":{color:"var(--color-warning)",icon:""},running:{color:"var(--color-migration-blue-light)",icon:""},complete:{color:"var(--color-success)",icon:""},error:{color:"var(--color-error)",icon:""}};function Qz({check:t,disabled:e}){const n=BA[t.status],r=e||t.isRunning||t.isChecking;return d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.5rem 0.75rem",gap:"0.75rem",borderRadius:"6px",background:"color-mix(in srgb, currentColor 3%, transparent)",marginBottom:"0.25rem"},children:[d.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:`color-mix(in srgb, ${n.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",flexShrink:0},children:t.isRunning||t.isChecking?d.jsx(Cn,{noMargin:!0}):n.icon}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:[t.name,t.issueCount>0&&d.jsxs("span",{style:{marginLeft:"0.5rem",color:n.color,fontSize:"0.75rem"},children:["(",t.issueCount,")"]})]}),d.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description}),t.details]}),d.jsxs("div",{style:{display:"flex",gap:"0.35rem",flexShrink:0},children:[d.jsx("button",{onClick:()=>{`${t.name}`,t.onCheck()},disabled:r,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.25rem 0.4rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",opacity:r?.5:1},title:"Check",children:t.isChecking?d.jsx(Cn,{noMargin:!0}):""}),t.canFix&&t.onFix&&d.jsx("button",{onClick:()=>{`${t.name}`,t.onFix()},disabled:r,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.25rem 0.5rem",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontSize:"0.7rem",fontWeight:500,opacity:r?.6:1},children:t.isRunning?d.jsx(Cn,{noMargin:!0}):"Fix"})]})]})}function Kz({accountCategoryValidation:t,orphanedIdCleanup:e,expenseToAdjustment:n,adjustmentsToTransfers:r,needsAction:s,totalIssues:o,isScanning:c,isRunning:l,disabled:h,onRunOrphaned:f,onRunExpense:p,onRunTransfers:g}){const[_,y]=R.useState(!1),w=l?"running":t.hasData&&e.hasData&&n.hasData&&r.hasData?s?"needs-action":"clean":"unknown",S=BA[w],E=[{id:"validation",name:"Account/Category Validation",status:t.isScanning?"running":t.hasData?t.hasViolations?"needs-action":"clean":"unknown",issueCount:t.violationCount,description:"Validates all transactions have proper account/category combinations",canFix:!1,onCheck:()=>t.scan(),isChecking:t.isScanning,isRunning:!1,details:t.hasViolations&&t.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[t.status.violations.filter(M=>M.transactionType==="income").length>0&&d.jsxs("span",{children:["Income: ",t.status.violations.filter(M=>M.transactionType==="income").length," "]}),t.status.violations.filter(M=>M.transactionType==="expense").length>0&&d.jsxs("span",{children:["Expenses: ",t.status.violations.filter(M=>M.transactionType==="expense").length," "]}),t.status.violations.filter(M=>M.transactionType==="adjustment").length>0&&d.jsxs("span",{children:["Adjustments: ",t.status.violations.filter(M=>M.transactionType==="adjustment").length," "]}),t.status.violations.filter(M=>M.transactionType==="transfer").length>0&&d.jsxs("span",{children:["Transfers: ",t.status.violations.filter(M=>M.transactionType==="transfer").length]})]})},{id:"orphaned",name:"Orphaned ID Cleanup",status:uy(e),issueCount:e.totalOrphaned,description:"Finds transactions with deleted/invalid account/category IDs",canFix:e.hasItemsToFix,onCheck:e.scanStatus,onFix:f,isChecking:e.isScanning,isRunning:e.isRunning,details:e.hasItemsToFix&&e.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.status.orphanedCategoryIds>0&&d.jsxs("span",{children:["Categories: ",e.status.orphanedCategoryIds," "]}),e.status.orphanedAccountIds>0&&d.jsxs("span",{children:["Accounts: ",e.status.orphanedAccountIds]})]})},{id:"expense",name:"Expense  Adjustment",status:uy(n,"hasItemsToMigrate"),issueCount:n.totalToMigrate,description:"Moves expenses without account/category to adjustments",canFix:n.hasItemsToMigrate,onCheck:n.scanStatus,onFix:p,isChecking:n.isScanning,isRunning:n.isRunning,details:n.hasItemsToMigrate&&n.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[n.status.expensesToMigrate," expense(s) with No Account or No Category"]})},{id:"transfers",name:"Adjustment  Transfers",status:uy(r,"hasPairsToConvert"),issueCount:r.totalPairs,description:"Converts opposite adjustment pairs to transfers",canFix:r.hasPairsToConvert,onCheck:r.scanStatus,onFix:g,isChecking:r.isScanning,isRunning:r.isRunning,details:r.hasPairsToConvert&&r.status&&d.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[r.status.accountTransferPairs>0&&d.jsxs("span",{children:["Account transfers: ",r.status.accountTransferPairs," "]}),r.status.categoryTransferPairs>0&&d.jsxs("span",{children:["Category transfers: ",r.status.categoryTransferPairs]})]})}],T=h||l||c,A=()=>{E.forEach(M=>M.onCheck())};return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${S.color} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:l||c?d.jsx(Cn,{noMargin:!0}):S.icon}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Transaction Type Audit"}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Validates account/category assignments and fixes invalid transactions"})]}),d.jsxs("div",{style:{color:S.color,fontSize:"0.8rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.25rem",flexShrink:0},children:[w==="unknown"?"Unknown":w==="clean"?"Clean":w==="running"?"Running":"Needs Action",o>0&&d.jsx("span",{style:{background:`color-mix(in srgb, ${S.color} 20%, transparent)`,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.75rem"},children:o})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[d.jsx("button",{onClick:A,disabled:T,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:T?"not-allowed":"pointer",fontSize:"0.8rem",opacity:T?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Check all",children:c?d.jsx(Cn,{noMargin:!0}):""}),d.jsx("button",{onClick:()=>y(!_),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:_?"Collapse":"Expand",children:_?"":""})]})]}),_&&d.jsx("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"0.5rem",background:"color-mix(in srgb, currentColor 2%, transparent)"},children:E.map(M=>d.jsx(Qz,{check:M,disabled:h},M.id))})]})}function uy(t,e="hasItemsToFix"){return t.isRunning?"running":t.result&&t.result.errors.length===0?"complete":t.isScanning?"running":t.hasData?t[e]?"needs-action":"clean":"unknown"}function Yz({status:t,hasData:e,hasIssues:n,totalIssues:r,isChecking:s,isRunning:o,result:c,onCheck:l,onRun:h,disabled:f}){const p=()=>o?"running":e?c&&c.errors.length===0?"complete":c&&c.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(c&&c.errors.length===0){const y=c.accountsFixed+c.categoriesFixed+c.totalAvailableFixed+c.incomeValuesFixed+c.expenseValuesFixed+c.categoryBalancesFixed+c.accountBalancesFixed;return y>0?`Fixed ${y}`:"Complete"}},_=()=>{if(c){const y=c.accountsFixed+c.categoriesFixed+c.totalAvailableFixed+c.incomeValuesFixed+c.expenseValuesFixed+c.categoryBalancesFixed+c.accountBalancesFixed;return d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:c.errors.length>0?" Completed with errors":" Cleanup complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[c.budgetsProcessed>0&&d.jsxs("li",{children:[c.budgetsProcessed," budget(s) updated"]}),c.accountsFixed>0&&d.jsxs("li",{children:[c.accountsFixed," account balance(s) fixed"]}),c.categoriesFixed>0&&d.jsxs("li",{children:[c.categoriesFixed," category value(s) fixed"]}),c.totalAvailableFixed>0&&d.jsxs("li",{children:[c.totalAvailableFixed," total_available value(s) fixed"]}),c.monthsProcessed>0&&d.jsxs("li",{children:[c.monthsProcessed," month(s) updated"]}),c.incomeValuesFixed>0&&d.jsxs("li",{children:[c.incomeValuesFixed," income amount(s) fixed"]}),c.expenseValuesFixed>0&&d.jsxs("li",{children:[c.expenseValuesFixed," expense amount(s) fixed"]}),c.categoryBalancesFixed>0&&d.jsxs("li",{children:[c.categoryBalancesFixed," category balance(s) fixed"]}),c.accountBalancesFixed>0&&d.jsxs("li",{children:[c.accountBalancesFixed," account balance(s) fixed"]}),y===0&&d.jsx("li",{children:"No changes needed"})]}),c.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",c.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[c.errors.slice(0,3).map((x,w)=>d.jsx("li",{children:x},w)),c.errors.length>3&&d.jsxs("li",{children:["...and ",c.errors.length-3," more"]})]})]})]})}return e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:"Precision issues found:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.budgetsWithPrecisionIssues>0&&d.jsxs("li",{children:[t.budgetsWithPrecisionIssues," budget(s) with issues:",d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.accountsWithPrecisionIssues>0&&d.jsxs("li",{children:[t.accountsWithPrecisionIssues," account balance(s)"]}),t.categoriesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.categoriesWithPrecisionIssues," category value(s)"]}),t.totalAvailableWithPrecisionIssues>0&&d.jsxs("li",{children:[t.totalAvailableWithPrecisionIssues," total_available value(s)"]})]})]}),t.monthsWithPrecisionIssues>0&&d.jsxs("li",{children:[t.monthsWithPrecisionIssues," month(s) with issues:",d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",opacity:.8},children:[t.incomeValuesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.incomeValuesWithPrecisionIssues," income amount(s)"]}),t.expenseValuesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.expenseValuesWithPrecisionIssues," expense amount(s)"]}),t.categoryBalancesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.categoryBalancesWithPrecisionIssues," category balance(s)"]}),t.accountBalancesWithPrecisionIssues>0&&d.jsxs("li",{children:[t.accountBalancesWithPrecisionIssues," account balance(s)"]})]})]})]}),d.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All currency values have proper precision (2 decimal places).",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for precision issues."})};return d.jsx(Vs,{name:"Currency Precision",description:"Fixes floating-point precision by rounding all values to 2 decimal places",status:p(),statusText:g(),onCheck:l,isChecking:s,onRun:h,isRunning:o,actionText:`Fix ${r}`,disabled:f,itemCount:n?r:void 0,details:_(),isDestructive:!0})}function Xz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:s,isRunning:o,result:c,onCheck:l,onRun:h,disabled:f}){const p=()=>o?"running":e?c&&c.errors.length===0?"complete":c&&c.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(c&&c.errors.length===0)return c.monthsUpdated>0?`Updated ${c.monthsUpdated} month(s)`:"Complete"},_=()=>c?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:c.errors.length>0?" Completed with errors":" Recalculation complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[c.budgetsProcessed>0&&d.jsxs("li",{children:[c.budgetsProcessed," budget(s) processed"]}),c.monthsProcessed>0&&d.jsxs("li",{children:[c.monthsProcessed," month(s) processed"]}),c.monthsUpdated>0&&d.jsxs("li",{children:[c.monthsUpdated," month(s) updated"]}),c.monthsUpdated===0&&d.jsx("li",{children:"No changes needed"})]}),c.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",c.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[c.errors.slice(0,3).map((y,x)=>d.jsx("li",{children:y},x)),c.errors.length>3&&d.jsxs("li",{children:["...and ",c.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:"Months needing recalculation:"}),d.jsx("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:d.jsxs("li",{children:[t.monthsNeedingRecalculation," month(s) from first month up to earliest window month"]})}),d.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All start balances are up to date.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months needing recalculation."});return d.jsx(Vs,{name:"Recalculate Start Balances",description:"Recalculates and saves start_balance for all months from the first month up to the earliest month in the window",status:p(),statusText:g(),onCheck:l,isChecking:s,onRun:h,isRunning:o,actionText:n?`Recalculate ${r}`:void 0,disabled:f,itemCount:n?r:void 0,details:_(),isDestructive:!0})}function Zz({status:t,hasData:e,needsMigration:n,totalItemsToFix:r,isChecking:s,isRunning:o,result:c,onCheck:l,onRun:h,disabled:f}){const p=()=>o?"running":e?c&&c.errors.length===0?"complete":c&&c.errors.length>0?"error":n?"needs-action":"clean":"unknown",g=()=>{if(c&&c.errors.length===0){const y=c.monthsAdded+c.orphanedEntriesRemoved;return y>0?`Fixed ${y} issue(s)`:"Complete"}},_=()=>c?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:c.errors.length>0?" Completed with errors":" Repair complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[c.budgetsProcessed>0&&d.jsxs("li",{children:[c.budgetsProcessed," budget(s) processed"]}),c.budgetsUpdated>0&&d.jsxs("li",{children:[c.budgetsUpdated," budget(s) updated"]}),c.monthsAdded>0&&d.jsxs("li",{children:[c.monthsAdded," month(s) added to month_map"]}),c.orphanedEntriesRemoved>0&&d.jsxs("li",{children:[c.orphanedEntriesRemoved," orphaned entry(ies) removed"]}),c.monthsAdded===0&&c.orphanedEntriesRemoved===0&&d.jsx("li",{children:"No changes needed"})]}),c.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",c.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[c.errors.slice(0,3).map((y,x)=>d.jsx("li",{children:y},x)),c.errors.length>3&&d.jsxs("li",{children:["...and ",c.errors.length-3," more"]})]})]})]}):e?n?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:"Month_map issues found:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[t.totalMissingMonths>0&&d.jsxs("li",{children:[t.totalMissingMonths," month(s) missing from month_map"]}),t.totalOrphanedEntries>0&&d.jsxs("li",{children:[t.totalOrphanedEntries," orphaned entry(ies) in month_map"]}),t.budgetsNeedingRepair>0&&d.jsxs("li",{children:[t.budgetsNeedingRepair," budget(s) need repair"]})]}),d.jsxs("div",{style:{marginTop:"0.5rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[" All month_map entries are up to date.",d.jsxs("div",{style:{marginTop:"0.25rem",opacity:.6},children:["Scanned ",t.totalBudgets," budget(s) and ",t.totalMonths," month(s)."]})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for month_map issues."});return d.jsx(Vs,{name:"Repair Month Map",description:"Updates month_map for all budgets by adding missing months and removing orphaned entries",status:p(),statusText:g(),onCheck:l,isChecking:s,onRun:h,isRunning:o,actionText:n?`Repair ${r}`:void 0,disabled:f,itemCount:n?r:void 0,details:_(),isDestructive:!0})}function Jz({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,accountCategoryValidation:r,orphanedIdCleanup:s,expenseToAdjustment:o,adjustmentsToTransfers:c,precisionCleanup:l,recalculateStartBalances:h,repairMonthMap:f}){const p=r.isScanning||s.isScanning||o.isScanning||c.isScanning||l.isScanning||h.isScanning||f.isScanning,g=s.isRunning||o.isRunning||c.isRunning||l.isRunning||h.isRunning||f.isRunning,_=async()=>{await Promise.all([r.scan(),s.scanStatus(),o.scanStatus(),c.scanStatus(),l.scan(),h.scanStatus(),f.scanStatus()])},y=Gi({migrationName:"Orphaned ID Cleanup",isDestructive:!0,onDownloadBackup:e}),x=Gi({migrationName:"Expense to Adjustment Migration",isDestructive:!0,onDownloadBackup:e}),w=Gi({migrationName:"Adjustments to Transfers Migration",isDestructive:!0,onDownloadBackup:e}),S=Gi({migrationName:"Currency Precision Cleanup",isDestructive:!0,onDownloadBackup:e}),E=Gi({migrationName:"Recalculate Start Balances Migration",isDestructive:!0,onDownloadBackup:e}),T=Gi({migrationName:"Repair Month Map Migration",isDestructive:!0,onDownloadBackup:e}),A=r.hasViolations||s.hasItemsToFix||o.hasItemsToMigrate||c.hasPairsToConvert,M=(r.violationCount||0)+(s.totalOrphaned||0)+(o.totalToMigrate||0)+(c.totalPairs||0);return d.jsxs(d.Fragment,{children:[d.jsxs(b0,{title:"Maintenance",icon:"",description:"Re-runnable database validation scripts. Validate all to see which need resolution.",type:"maintenance",onValidateAll:_,isValidating:p,isAnyRunning:g,children:[d.jsx(Kz,{accountCategoryValidation:r,orphanedIdCleanup:s,expenseToAdjustment:o,adjustmentsToTransfers:c,needsAction:A,totalIssues:M,isScanning:r.isScanning||s.isScanning||o.isScanning||c.isScanning,isRunning:s.isRunning||o.isRunning||c.isRunning,disabled:t,onRunOrphaned:()=>y.promptBeforeAction(s.runMigration),onRunExpense:()=>x.promptBeforeAction(o.runMigration),onRunTransfers:()=>w.promptBeforeAction(c.runMigration)}),d.jsx(Yz,{status:l.status,hasData:l.hasData,hasIssues:l.hasIssues,totalIssues:l.totalIssues,isChecking:l.isScanning,isRunning:l.isRunning,result:l.result,onCheck:l.scan,onRun:()=>S.promptBeforeAction(l.runCleanup),disabled:t}),d.jsx(Xz,{status:h.status,hasData:h.hasData,needsMigration:h.needsMigration,totalItemsToFix:h.totalItemsToFix,isChecking:h.isScanning,isRunning:h.isRunning,result:h.result,onCheck:h.scanStatus,onRun:()=>E.promptBeforeAction(h.runMigration),disabled:t}),d.jsx(Zz,{status:f.status,hasData:f.hasData,needsMigration:f.needsMigration,totalItemsToFix:f.totalItemsToFix,isChecking:f.isScanning,isRunning:f.isRunning,result:f.result,onCheck:f.scanStatus,onRun:()=>T.promptBeforeAction(f.runMigration),disabled:t})]}),d.jsx($i,{...y.promptProps,isDownloading:n}),d.jsx($i,{...x.promptProps,isDownloading:n}),d.jsx($i,{...w.promptProps,isDownloading:n}),d.jsx($i,{...S.promptProps,isDownloading:n}),d.jsx($i,{...E.promptProps,isDownloading:n}),d.jsx($i,{...T.promptProps,isDownloading:n})]})}function eL({isDownloading:t,downloadProgress:e,downloadError:n,onDownload:r,isScanning:s,isUploading:o,uploadStatus:c,uploadProgress:l,uploadError:h,uploadResult:f,onScan:p,onUpload:g,disabled:_}){const y=R.useRef(null),[x,w]=R.useState(null),[S,E]=R.useState(!1),T=async $=>{const k=$.target.files?.[0];k&&(w(k),await p(k))},A=c!==null,M=A&&(c.budgetsFound>0||c.monthsFound>0),L=_||t||s||o,H=f?.success?"var(--color-success)":M?"var(--color-warning)":A?"var(--color-success)":"var(--text-muted)",O=f?.success?"":o||s||t?"":M?"":A?"":"",j=f?.success?"Uploaded":o?"Uploading":s?"Scanning":t?"Downloading":M?`${c.budgetsFound} budget(s), ${c.monthsFound} month(s) ready`:A?"Nothing to upload":"Select file",B=t?e?.percentComplete:l?.percentComplete,V=n||h;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${H} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:o||s||t?d.jsx(Cn,{noMargin:!0}):O}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Budget Backup & Restore"}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Download selected budget as zip or restore from zip file"})]}),d.jsx("div",{style:{color:H,fontSize:"0.8rem",fontWeight:500,flexShrink:0},children:j}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[d.jsx("button",{onClick:()=>{r()},disabled:L,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:L?"not-allowed":"pointer",fontSize:"0.8rem",opacity:L?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Download all budgets as zip",children:t?d.jsx(Cn,{noMargin:!0}):""}),d.jsx("input",{ref:y,type:"file",accept:".zip",onChange:T,style:{display:"none"}}),d.jsx("button",{onClick:()=>y.current?.click(),disabled:L,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:L?"not-allowed":"pointer",fontSize:"0.8rem",opacity:L?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},title:"Select zip file to restore",children:s?d.jsx(Cn,{noMargin:!0}):""}),M&&x&&d.jsx("button",{onClick:async()=>{await g(x)},disabled:L,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:L?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:L?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:o?d.jsx(Cn,{noMargin:!0}):"Upload"}),(A||f||V)&&d.jsx("button",{onClick:()=>E(!S),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:S?"Collapse":"Expand",children:S?"":""})]})]}),(t||o)&&B!==void 0&&d.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[d.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:d.jsx("div",{style:{width:`${B}%`,height:"100%",background:"var(--color-primary)",transition:"width 0.3s ease"}})}),d.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[t?e?.phase:l?.phase,": ",B,"%"]})]}),S&&(A||f||V)&&d.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[V&&d.jsxs("div",{style:{marginBottom:"0.75rem",color:"var(--color-error)"},children:[" Error: ",V]}),f&&d.jsx("div",{style:{marginBottom:c?"0.75rem":0,color:f.success?"var(--color-success)":"var(--color-error)"},children:f.success?d.jsxs(d.Fragment,{children:[" Restored ",f.budgetsRestored," budget(s), ",f.monthsRestored," month(s), ",f.payeesRestored," payee doc(s)"]}):d.jsxs(d.Fragment,{children:[" Upload failed: ",f.errors.join(", ")]})}),c&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{marginBottom:"0.25rem"},children:[d.jsx("strong",{children:"Found in zip:"})," ",c.budgetsFound," budget(s), ",c.monthsFound," month(s), ",c.payeesFound," payee doc(s)"]}),c.budgetsToRestore.length>0&&d.jsxs("div",{children:[d.jsx("strong",{children:"Budgets to restore:"})," ",c.budgetsToRestore.join(", ")]})]})]})]})}function tL({isUpdating:t,progress:e,error:n,result:r,onUpdate:s,onReset:o,disabled:c}){const[l,h]=R.useState(!1),f=c||t,p=r!==null,g=n!==null,_=r?.success?"var(--color-success)":g?"var(--color-error)":t?"var(--color-primary)":"var(--text-muted)",y=r?.success?"":t?"":g?"":"",x=r?.success?`Updated (${r.monthsCreated} months)`:t?e?.message||"Updating...":g?"Error":"Ready",w=e?.percentComplete;return d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-primary) 5%, transparent)",borderRadius:"8px",margin:"0.25rem 0",overflow:"hidden",border:"1px solid color-mix(in srgb, var(--color-primary) 20%, transparent)"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0.75rem 1rem",gap:"1rem"},children:[d.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:`color-mix(in srgb, ${_} 20%, transparent)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem",flexShrink:0},children:t?d.jsx(Cn,{noMargin:!0}):y}),d.jsxs("div",{style:{flex:1,minWidth:0},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:" Update Sample Budget"}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Regenerate sample budget with current dates (6 months of data ending this month)"})]}),d.jsx("div",{style:{color:_,fontSize:"0.8rem",fontWeight:500,flexShrink:0,maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis"},children:x}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[!r?.success&&d.jsx("button",{onClick:async()=>{await s()},disabled:f,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.35rem 0.75rem",borderRadius:"4px",cursor:f?"not-allowed":"pointer",fontSize:"0.8rem",fontWeight:500,opacity:f?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:t?d.jsx(Cn,{noMargin:!0}):"Update"}),r?.success&&d.jsx("button",{onClick:()=>{o()},style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.6rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.8rem"},title:"Reset to update again",children:"Reset"}),(p||g)&&d.jsx("button",{onClick:()=>h(!l),style:{background:"transparent",color:"inherit",border:"none",padding:"0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem",opacity:.6},title:l?"Collapse":"Expand",children:l?"":""})]})]}),t&&w!==void 0&&d.jsxs("div",{style:{padding:"0 1rem 0.5rem 1rem"},children:[d.jsx("div",{style:{width:"100%",height:"4px",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"2px",overflow:"hidden"},children:d.jsx("div",{style:{width:`${w}%`,height:"100%",background:"var(--color-primary)",transition:"width 0.3s ease"}})}),d.jsxs("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem",textAlign:"center"},children:[e?.phase,": ",w,"%"]})]}),l&&(p||g)&&d.jsxs("div",{style:{borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",padding:"1rem",background:"color-mix(in srgb, currentColor 2%, transparent)",fontSize:"0.85rem"},children:[g&&d.jsxs("div",{style:{marginBottom:"0.75rem",color:"var(--color-error)"},children:[" Error: ",n]}),r&&d.jsx("div",{style:{color:r.success?"var(--color-success)":"var(--color-error)"},children:r.success?d.jsxs(d.Fragment,{children:[" Created ",r.monthsCreated," month(s): ",r.dateRange]}):d.jsxs(d.Fragment,{children:[" Update failed: ",r.errors.join(", ")]})}),d.jsxs("div",{style:{marginTop:"0.75rem",fontSize:"0.8rem",opacity:.7},children:[d.jsx("strong",{children:"What this does:"})," Generates sample budget data with transactions for the past 5 months plus the current month. All dates are shifted to be relative to today's date."]})]})]})}function nL({isInspecting:t,result:e,error:n,onInspect:r,onDownload:s,onClear:o,disabled:c}){const[l,h]=R.useState(""),f=async()=>{l.trim()&&await r(l.trim())};return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",margin:"0.25rem 0",padding:"0.75rem 1rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"1.1rem"},children:""}),d.jsxs("div",{style:{flex:1},children:[d.jsx("div",{style:{fontWeight:500,fontSize:"0.95rem"},children:"Budget Inspector"}),d.jsx("div",{style:{fontSize:"0.8rem",opacity:.6},children:"Inspect a specific budget by ID for debugging"})]})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginLeft:"1.85rem"},children:[d.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[d.jsx("input",{type:"text",value:l,onChange:p=>h(p.target.value),placeholder:"Enter budget ID...",disabled:c||t,style:{flex:1,padding:"0.4rem 0.6rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.8rem",fontFamily:"monospace",color:"inherit"},onKeyDown:p=>{p.key==="Enter"&&!t&&l.trim()&&f()}}),d.jsx("button",{onClick:f,disabled:c||t||!l.trim(),style:{padding:"0.4rem 0.75rem",borderRadius:"4px",border:"none",background:"var(--color-primary)",color:"white",fontSize:"0.8rem",cursor:c||t||!l.trim()?"not-allowed":"pointer",opacity:c||t||!l.trim()?.5:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:t?d.jsxs(d.Fragment,{children:[d.jsx(Cn,{noMargin:!0})," Inspecting..."]}):"Inspect"})]}),n&&d.jsx("div",{style:{padding:"0.5rem",borderRadius:"4px",background:"color-mix(in srgb, var(--color-error) 15%, transparent)",color:"var(--color-error)",fontSize:"0.75rem"},children:n}),e&&d.jsxs("div",{style:{padding:"0.75rem",borderRadius:"4px",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.75rem"},children:[d.jsx("div",{style:{fontWeight:600,marginBottom:"0.5rem"},children:e.exists?" Budget Found":" Budget Not Found"}),e.exists&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"0.25rem 0.75rem",marginBottom:"0.5rem"},children:[d.jsx("span",{style:{opacity:.6},children:"Name:"}),d.jsx("span",{children:e.rawData?.name||"(no name)"}),d.jsx("span",{style:{opacity:.6},children:"Accounts:"}),d.jsx("span",{children:e.analysis.accountCount}),d.jsx("span",{style:{opacity:.6},children:"Categories:"}),d.jsx("span",{children:e.analysis.categoryCount}),d.jsx("span",{style:{opacity:.6},children:"Month Map:"}),d.jsx("span",{children:e.analysis.hasMonthMap?`${e.analysis.monthMapKeys.length} months`:" Missing"}),d.jsx("span",{style:{opacity:.6},children:"Month Docs:"}),d.jsxs("span",{children:[e.monthDocuments.filter(p=>p.exists).length," / ",e.monthDocuments.length]})]}),e.issues.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem"},children:[d.jsxs("div",{style:{fontWeight:600,color:"var(--color-warning)",marginBottom:"0.25rem"},children:[" Issues (",e.issues.length,"):"]}),d.jsx("ul",{style:{margin:0,paddingLeft:"1.25rem",color:"var(--color-warning)"},children:e.issues.map((p,g)=>d.jsx("li",{children:p},g))})]}),e.recommendations.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem"},children:[d.jsx("div",{style:{fontWeight:600,color:"var(--color-info)",marginBottom:"0.25rem"},children:" Recommendations:"}),d.jsx("ul",{style:{margin:0,paddingLeft:"1.25rem",opacity:.8},children:e.recommendations.map((p,g)=>d.jsx("li",{children:p},g))})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.75rem"},children:[d.jsx("button",{onClick:s,style:{padding:"0.3rem 0.6rem",borderRadius:"4px",border:"none",background:"var(--color-success)",color:"white",fontSize:"0.7rem",cursor:"pointer"},children:"Download Full Report"}),d.jsx("button",{onClick:o,style:{padding:"0.3rem 0.6rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"transparent",color:"inherit",fontSize:"0.7rem",cursor:"pointer",opacity:.7},children:"Clear"})]})]}),!e.exists&&d.jsx("div",{style:{opacity:.8},children:"The budget document does not exist in Firestore. It may have been deleted or the ID is incorrect."})]})]})]})}function rL({hasData:t,monthsCount:e,budgetCount:n,isChecking:r,isDeleting:s,deleteResult:o,onCheck:c,onDelete:l,disabled:h}){const[f,p]=R.useState(!1),g=()=>s?"running":t?o&&o.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",_=()=>o&&o.errors.length===0?`Deleted ${o.deleted}`:e===0?"No months":`${e} months`,y=()=>{p(!0)},x=()=>{p(!1),l()},w=()=>o?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:o.errors.length>0?" Completed with errors":" Deletion complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[d.jsxs("li",{children:[o.deleted," month(s) deleted"]}),o.budgetsRecalculated>0&&d.jsxs("li",{children:[o.budgetsRecalculated," budget(s) reset"]})]}),o.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",o.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[o.errors.slice(0,3).map((S,E)=>d.jsx("li",{children:S},E)),o.errors.length>3&&d.jsxs("li",{children:["...and ",o.errors.length-3," more"]})]})]})]}):t?e===0?d.jsx("div",{style:{fontSize:"0.85rem"},children:" No month documents found in Firebase."}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-error)"},children:" DESTRUCTIVE ACTION"}),d.jsxs("div",{children:["Found ",e," month(s) across ",n," budget(s)."]}),d.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"This will permanently delete ALL month documents and reset all budgets."})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for months."});return d.jsxs(d.Fragment,{children:[d.jsx(Vs,{name:"Delete ALL Months",description:"DESTRUCTIVE: Deletes all month documents from all budgets",status:g(),statusText:_(),onCheck:c,isChecking:r,onRun:e>0?y:void 0,isRunning:s,actionText:"Delete",disabled:h,itemCount:e>0?e:void 0,details:w(),isDestructive:!0}),d.jsxs(Ji,{isOpen:f,onClose:()=>p(!1),title:" Delete All Months?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, var(--color-error) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-error) 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:"var(--color-error-light)",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",d.jsxs("strong",{style:{color:"var(--color-error)"},children:[e," month(s)"]})," across"," ",d.jsxs("strong",{style:{color:"var(--color-error)"},children:[n," budget(s)"]}),"."]}),d.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[d.jsx("li",{children:"All account balances  $0"}),d.jsx("li",{children:"All category balances  $0"}),d.jsx("li",{children:"Month history cleared"})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ge,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>p(!1),children:"Cancel"}),d.jsxs(Ge,{variant:"danger",actionName:"Confirm Delete All Months",onClick:x,children:[" Delete All ",e," Months"]})]})]})]})}function iL({status:t,hasData:e,totalBudgets:n,totalMonths:r,isChecking:s,isDeleting:o,deleteResult:c,onCheck:l,onDelete:h,disabled:f}){const[p,g]=R.useState(!1),_=t?.staleBudgetIds??[],y=_.length>0,x=()=>o?"running":e?c&&c.errors.length===0?"complete":n===0&&!y?"clean":"needs-action":"unknown",w=()=>c&&c.errors.length===0?`Deleted ${c.budgetsDeleted}`:n===0&&!y?"Clean":y?`${_.length} stale ref(s)`:`${n} budget(s)`,S=()=>{g(!0)},E=()=>{g(!1),h()},T=()=>c?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:500},children:c.errors.length>0?" Completed with errors":" Deletion complete"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[c.budgetsDeleted>0&&d.jsxs("li",{children:[c.budgetsDeleted," budget(s) deleted"]}),c.monthsDeleted>0&&d.jsxs("li",{children:[c.monthsDeleted," month(s) deleted"]}),c.payeesDeleted>0&&d.jsxs("li",{children:[c.payeesDeleted," payee doc(s) deleted"]})]}),c.errors.length>0&&d.jsxs("div",{style:{marginTop:"0.5rem",color:"var(--color-error)"},children:[d.jsxs("div",{children:["Errors (",c.errors.length,"):"]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem"},children:[c.errors.slice(0,3).map((M,L)=>d.jsx("li",{children:M},L)),c.errors.length>3&&d.jsxs("li",{children:["...and ",c.errors.length-3," more"]})]})]})]}):e?n===0&&!y?d.jsx("div",{style:{fontSize:"0.85rem"},children:' No budget found for sample@sample.com  user is in "new user" state.'}):y?d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:" Found stale budget references:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[_.slice(0,3).map(M=>d.jsx("li",{style:{opacity:.8},children:M},M)),_.length>3&&d.jsxs("li",{style:{opacity:.6},children:["...and ",_.length-3," more"]})]})]}):d.jsxs("div",{style:{fontSize:"0.85rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem",color:"var(--color-warning)"},children:" Sample user budget found:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem"},children:[d.jsxs("li",{children:[n," budget(s)"]}),d.jsxs("li",{children:[r," month(s)"]})]}),d.jsx("div",{style:{marginTop:"0.5rem",opacity:.7},children:"Deleting will reset sample@sample.com to a new user state."})]}):d.jsx("div",{style:{fontSize:"0.85rem",opacity:.7},children:"Click check to scan for sample user budget."}),A=n>0||y;return d.jsxs(d.Fragment,{children:[d.jsx(Vs,{name:"Delete Sample User Budget",description:"Reset sample@sample.com to new user state",status:x(),statusText:w(),onCheck:l,isChecking:s,onRun:A?S:void 0,isRunning:o,actionText:"Delete",disabled:f,itemCount:A?n||_.length:void 0,details:T(),isDestructive:!0}),d.jsxs(Ji,{isOpen:p,onClose:()=>g(!1),title:" Delete Sample User Budget?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, var(--color-warning) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-warning) 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:"var(--color-warning-light)",fontWeight:500,fontSize:"0.95rem"},children:" This will delete all data for sample@sample.com!"})}),n>0&&d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",d.jsxs("strong",{style:{color:"var(--color-warning)"},children:[n," budget(s)"]})," and"," ",d.jsxs("strong",{style:{color:"var(--color-warning)"},children:[r," month(s)"]}),"."]}),y&&d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will remove ",d.jsxs("strong",{style:{color:"var(--color-warning)"},children:[_.length," stale reference(s)"]})," from the user document."]}),d.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[d.jsx("li",{children:"Budget document deleted"}),d.jsx("li",{children:"All month documents deleted"}),d.jsx("li",{children:"Payees document deleted"}),d.jsx("li",{children:"User will see onboarding flow"})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ge,{variant:"secondary",actionName:"Cancel Delete Sample User Budget",onClick:()=>g(!1),children:"Cancel"}),d.jsx(Ge,{variant:"danger",actionName:"Confirm Delete Sample User Budget",onClick:E,children:" Delete Sample User Data"})]})]})]})}function sL({onClearCache:t,disabled:e}){const[n,r]=R.useState(!1),s=()=>{r(!0)},o=()=>{r(!1),t()};return d.jsxs(d.Fragment,{children:[d.jsx(Iz,{name:"Clear All Caches",description:"Clear cached data and reload to fetch fresh data from Firestore",onAction:s,actionText:"Clear & Reload",actionIcon:"",disabled:e,isDestructive:!0}),d.jsxs(Ji,{isOpen:n,onClose:()=>r(!1),title:"Clear Caches & Reload?",children:[d.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data and reload the page. The app will fetch fresh data from Firestore for everything."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ge,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>r(!1),children:"Cancel"}),d.jsx(Ge,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:o,children:"Clear & Reload"})]})]})]})}function aL({disabled:t,onDownloadBackup:e,isDownloadingBackup:n,budgetDownloadUpload:r,updateSampleBudget:s,budgetInspector:o,deleteAllMonths:c,deleteSampleUserBudget:l,onClearCache:h}){const f=r.isDownloading||r.isUploading||s.isUpdating||c.isDeleting||l.isDeleting,p=Gi({migrationName:"Delete All Months",isDestructive:!0,onDownloadBackup:e}),g=Gi({migrationName:"Delete Sample User Budget",isDestructive:!0,onDownloadBackup:e}),_=Gi({migrationName:"Upload Budget",isDestructive:!0,onDownloadBackup:e}),y=Gi({migrationName:"Update Sample Budget",isDestructive:!0,onDownloadBackup:e});return d.jsxs(d.Fragment,{children:[d.jsxs(b0,{title:"Utilities",icon:"",description:"Administrative utilities for data management, downloads, and cache control.",type:"utility",isAnyRunning:f,children:[d.jsx(eL,{isDownloading:r.isDownloading,downloadProgress:r.downloadProgress,downloadError:r.downloadError,onDownload:r.downloadBudget,isScanning:r.isScanning,isUploading:r.isUploading,uploadStatus:r.uploadStatus,uploadProgress:r.uploadProgress,uploadError:r.uploadError,uploadResult:r.uploadResult,onScan:r.scanZipFile,onUpload:async x=>{_.promptBeforeAction(()=>{r.uploadBudget(x).catch(w=>console.error("Upload failed:",w))})},disabled:t}),d.jsx(tL,{isUpdating:s.isUpdating,progress:s.progress,error:s.error,result:s.result,onUpdate:async()=>{y.promptBeforeAction(()=>{s.updateSampleBudget().catch(x=>console.error("Update sample budget failed:",x))})},onReset:s.reset,disabled:t}),d.jsx(nL,{isInspecting:o.isInspecting,result:o.result,error:o.error,onInspect:o.inspectBudget,onDownload:o.downloadResult,onClear:o.clearResult,disabled:t}),d.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:[d.jsx("div",{style:{fontSize:"0.75rem",opacity:.5,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.5rem",paddingLeft:"0.5rem"},children:"Destructive Actions"}),d.jsx(rL,{status:c.status,hasData:c.hasData,monthsCount:c.monthsCount,budgetCount:c.budgetCount,isChecking:c.isScanning,isDeleting:c.isDeleting,deleteResult:c.deleteResult,deleteProgress:c.deleteProgress,onCheck:c.scanStatus,onDelete:()=>p.promptBeforeAction(c.deleteAllMonths),disabled:t}),d.jsx(iL,{status:l.status,hasData:l.hasData,totalBudgets:l.totalBudgets,totalMonths:l.totalMonths,isChecking:l.isScanning,isDeleting:l.isDeleting,deleteResult:l.deleteResult,deleteProgress:l.deleteProgress,onCheck:l.scanStatus,onDelete:()=>g.promptBeforeAction(l.deleteSampleUserBudget),disabled:t}),d.jsx(sL,{onClearCache:h,disabled:t})]})]}),d.jsx($i,{...p.promptProps,isDownloading:n}),d.jsx($i,{...g.promptProps,isDownloading:n}),d.jsx($i,{..._.promptProps,isDownloading:n}),d.jsx($i,{...y.promptProps,isDownloading:n})]})}function oL({message:t="Loading...",spinnerColor:e=me.primary,children:n,spinnerSize:r=4}){return d.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"var(--loading-overlay-bg)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[d.jsx("div",{style:{width:`${r}rem`,height:`${r}rem`,border:"3px solid var(--loading-overlay-content-border)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),d.jsx("p",{style:{color:"var(--loading-overlay-text)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,d.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function cL(){return d.jsxs("div",{style:Yf,children:[d.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:d.jsx(Rn,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:d.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),d.jsx("h1",{children:"Tarron Lane Homepage"}),d.jsx("nav",{children:d.jsxs("ul",{children:[d.jsx("li",{children:d.jsx(Rn,{to:"/sql-test",children:"SQL Test"})}),d.jsx("li",{children:d.jsx(Rn,{to:"/budget",children:"Budget"})}),d.jsx("li",{children:d.jsx(Rn,{to:"/account",children:"Account"})})]})})]})}function lL(){const t=R.useContext(Rd),e=Us(),[n,r]=R.useState(!1),s=nr(),o=ud(),c=s.state?.from||"/";R.useEffect(()=>{t.is_logged_in&&c!=="/"&&o(c,{replace:!0})},[t.is_logged_in,c,o]);function l(){r(!0),e.logout_firebase_user().then(function(){Pe.clear(),window.location.href="/"})}return d.jsxs("div",{style:Yf,children:[d.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsx(Rn,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),d.jsxs(Rn,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[d.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),d.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),d.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:d.jsx(IA,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),d.jsx("h1",{children:"Account"}),t.is_logged_in?n?d.jsx("p",{children:"Logging Out..."}):d.jsxs(d.Fragment,{children:[d.jsxs("p",{children:["You are logged in as ",t.username]}),d.jsx("button",{onClick:l,style:{marginTop:"1rem"},children:"Logout"})]}):d.jsx(uL,{})]})}function uL(){const t=Us(),[e,n]=R.useState(""),[r,s]=R.useState(""),[o,c]=R.useState(!1),[l,h]=R.useState(!1),[f,p]=R.useState("");function g(x){n(x.target.value)}function _(x){s(x.target.value)}function y(x){x.preventDefault(),h(!0),p(""),Pe.clear(),t.login_firebase_user(e,r).then(function(){}).catch(function(){p("Incorrect login credentials")}).finally(function(){h(!1)})}return d.jsxs("form",{onSubmit:y,children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"username",children:"Email: "}),d.jsx("input",{id:"username",type:"email",value:e,onChange:g})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"password",children:"Password: "}),d.jsxs("div",{style:{display:"inline-flex",alignItems:"center",position:"relative"},children:[d.jsx("input",{id:"password",type:o?"text":"password",value:r,onChange:_,style:{paddingRight:"2rem"}}),d.jsx("button",{type:"button",onClick:()=>c(!o),style:{position:"absolute",right:"0.25rem",background:"none",border:"none",cursor:"pointer",padding:"0.25rem",opacity:.6,fontSize:"1rem"},title:o?"Hide password":"Show password",children:o?"":""})]})]}),l?d.jsx("p",{children:"Logging in..."}):d.jsx("button",{children:"Login"}),f&&d.jsx("p",{style:{color:"red"},children:f})]})}const dL={categories:"balances",accounts:"balances",income:"transactions",spend:"transactions",transfers:"transactions",adjustments:"transactions"};function hL({activeTab:t,setActiveTab:e,lastBalancesTab:n,lastTransactionsTab:r,allocationsFinalized:s}){const o=dL[t],c=R.useMemo(()=>[{id:"balances",label:"Balances"},{id:"transactions",label:"Transactions"}],[]),l=R.useMemo(()=>[{id:"categories",label:"Categories",checkmark:s},{id:"accounts",label:"Accounts"}],[s]),h=R.useMemo(()=>[{id:"income",label:"Income"},{id:"spend",label:"Spend"},{id:"transfers",label:"Transfers"},{id:"adjustments",label:"Adjustments"}],[]),f=g=>{e(g==="balances"?n:r)},p=o==="balances"?l:h;return d.jsxs("div",{children:[d.jsx(em,{mode:"button",tabs:c,activeTab:o,onTabChange:f,variant:"segmented"}),d.jsx(em,{mode:"button",tabs:p,activeTab:t,onTabChange:g=>e(g),variant:"secondary"})]})}function d1({direction:t,isDisabled:e,isLoading:n,disabledReason:r,onNavigate:s}){const[o,c]=R.useState(!1),l=n||e,h=t==="prev"?"":"",f=t==="prev"?"Previous month":"Next month",p=()=>{n||(e?(c(!0),setTimeout(()=>c(!1),2e3)):s())};return d.jsxs("div",{style:{position:"relative"},children:[d.jsx("button",{onClick:p,onMouseEnter:()=>e&&c(!0),onMouseLeave:()=>c(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:l?"not-allowed":"pointer",fontSize:"1.25rem",opacity:l?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:f,children:h}),o&&e&&r&&d.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:me.warning,color:"var(--color-warning-on-warning)",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px var(--shadow-overlay)"},children:r})]})}function fL({pickerYear:t,pickerMonth:e,currentYear:n,currentMonthNumber:r,minOrdinal:s,maxOrdinal:o,minAllowed:c,maxAllowed:l,monthMap:h,onYearChange:f,onMonthChange:p,onGo:g}){const _=t>c.year,y=t<l.year,x=Number(Fe(t,e)),w=h?Fe(t,e)in h:!1,S=x<=o,E=(w||S)&&x>=s;return d.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[d.jsx("button",{onClick:()=>f(t-1),disabled:!_,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:_?"pointer":"not-allowed",fontSize:"0.8rem",opacity:_?1:.3},title:_?"Previous year":"Cannot go further back",children:""}),d.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:t}),d.jsx("button",{onClick:()=>f(t+1),disabled:!y,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:y?"pointer":"not-allowed",fontSize:"0.8rem",opacity:y?1:.3},title:y?"Next year":"Cannot go further ahead",children:""})]}),d.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:Qf.map((T,A)=>{const M=A+1,L=M===e,H=t===n&&M===r,O=Number(Fe(t,M)),j=Fe(t,M),B=O<s,V=O>o,$=O<Number(Fe(n,r)),k=h?j in h:!1,N=B||V||$&&!k;let D=T;return B?D="Too far in the past":V?D="Too far in the future":$&&!k&&(D="Month not in budget"),d.jsx("button",{onClick:()=>p(M),disabled:N,style:{background:L?me.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:H?`1px solid ${me.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:N?"not-allowed":"pointer",fontSize:"0.7rem",color:L?"var(--color-primary-on-primary)":"inherit",opacity:N?.3:1,transition:"background 0.15s"},title:D,children:T.slice(0,3)},M)})}),d.jsxs("button",{onClick:g,disabled:!E,style:{width:"100%",background:E?me.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:E?"pointer":"not-allowed",fontSize:"0.85rem",color:E?"var(--color-primary-on-primary)":"inherit",fontWeight:500,opacity:E?1:.5},children:["Go to ",Qf[e-1]," ",t]})]})}function mL({isOpen:t,onClose:e,year:n,month:r,isDeleting:s,onConfirm:o}){return d.jsxs(Ji,{isOpen:t,onClose:e,title:" Delete Month?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, var(--color-error) 15%, transparent)",border:"1px solid color-mix(in srgb, var(--color-error) 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsxs("p",{style:{margin:0,color:"var(--color-error-light)",fontWeight:500,fontSize:"0.95rem"},children:[" This will permanently delete ",Qf[r-1]," ",n,"!"]})}),d.jsx("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:"This month document and all its data (income, expenses, allocations) will be permanently deleted."}),d.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, you will be navigated to the previous month."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ge,{variant:"secondary",actionName:"Cancel Delete Month",onClick:e,disabled:s,children:"Cancel"}),d.jsx(Ge,{variant:"danger",actionName:"Confirm Delete Month",onClick:o,disabled:s,children:s?"Deleting...":" Delete Month"})]})]})}function gL(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-t0;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function pL(t){return Object.keys(t).sort()[0]}function yL(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function _L(t){const e=pL(t);return e?yL(e):gL()}function bL(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function vL({onPreviousMonth:t,onNextMonth:e,onDownloadCategories:n}){const{isLoading:r}=kn(),{currentYear:s,currentMonthNumber:o,isAdmin:c,selectedBudgetId:l,setCurrentYear:h,setCurrentMonthNumber:f}=Qe(),{budget:p,monthMap:g}=Dn(),{month:_}=rs(l,s,o),y=bB(s,o,g),x=vB(s,o,g),w=!y.canNavigate,S=y.disabledReason??"",E=!x.canNavigate,T=x.disabledReason??"",A=Dm(),M=A.maxOrdinal,L=Math.floor(A.maxOrdinal/100),H=A.maxOrdinal%100,O={year:L,month:H},j=_L(g||{}),B=Number(Fe(j.year,j.month)),[V,$]=R.useState(!1),[k,N]=R.useState(!1),[D,X]=R.useState(s),[K,q]=R.useState(o),[te,Q]=R.useState(!1),[ae,P]=R.useState(!1),G=R.useRef(null),ee=(()=>{if(!g||Object.keys(g).length===0)return!1;const ie=Fe(s,o),le=Math.max(...Object.keys(g).map(Number));return Number(ie)===le})();async function re(){if(l){P(!0);try{const ie=Zi(l,s,o);UB(l,s,o),await Wf("months",ie,`deleting month ${s}/${o}`),`${s}${o}`,Pe.removeQueries({queryKey:Te.month(l,s,o)});const le=bL(s,o);Q(!1),$(!1),window.location.href=`/budget/${le.year}/${le.month}/categories`}catch(ie){console.error("Failed to delete month:",ie),alert(`Failed to delete month: ${ie instanceof Error?ie.message:"Unknown error"}`)}finally{P(!1)}}}R.useEffect(()=>{if(!V)return;function ie(le){G.current&&!G.current.contains(le.target)&&($(!1),N(!1))}return document.addEventListener("mousedown",ie),()=>document.removeEventListener("mousedown",ie)},[V]);function se(){k||(X(s),q(o)),N(!k)}function ge(){h(D),f(K),N(!1),$(!1)}async function Ce(){if(!_||!p)return;const ie=new Date,Me=`${ie.toISOString().split("T")[0]}_month_${s}_${String(o).padStart(2,"0")}`,Be=new Fm,Ze=[{name:`${Me}_income.json`,data:_.income||[]},{name:`${Me}_expenses.json`,data:_.expenses||[]},{name:`${Me}_transfers.json`,data:_.transfers||[]},{name:`${Me}_adjustments.json`,data:_.adjustments||[]},{name:`${Me}_account_balances.json`,data:_.account_balances||[]},{name:`${Me}_category_balances.json`,data:_.category_balances||[]}],st={budget_id:p.id,budget_name:p.name,year_month_ordinal:_.year_month_ordinal,year:_.year,month:_.month,total_income:_.total_income,previous_month_income:_.previous_month_income,total_expenses:_.total_expenses,are_allocations_finalized:_.are_allocations_finalized,created_at:_.created_at,updated_at:_.updated_at,downloaded_at:ie.toISOString()};Ze.push({name:`${Me}_metadata.json`,data:st});for(const J of Ze)Be.file(J.name,JSON.stringify(J.data,null,2));const U=await Be.generateAsync({type:"blob"}),fe=URL.createObjectURL(U),ue=document.createElement("a");ue.href=fe,ue.download=`${Me}.zip`,document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(fe),$(!1)}return d.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[d.jsx(d1,{direction:"prev",isDisabled:w,isLoading:r,disabledReason:S,onNavigate:t}),d.jsxs("div",{ref:G,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[d.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[Qf[o-1]," ",s]}),d.jsx("button",{onClick:()=>$(!V),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:V?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),r&&d.jsxs(d.Fragment,{children:[d.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),d.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[d.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:me.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),d.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),V&&d.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--sticky-header-bg)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px var(--shadow-overlay)"},children:[d.jsx("button",{onClick:se,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),n&&d.jsx("button",{onClick:()=>{n(),$(!1)},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download category balances as Markdown",children:" Download data"}),k&&d.jsx(fL,{pickerYear:D,pickerMonth:K,currentYear:s,currentMonthNumber:o,minOrdinal:B,maxOrdinal:M,minAllowed:j,maxAllowed:O,monthMap:g,onYearChange:X,onMonthChange:q,onGo:ge}),c&&_&&d.jsx("button",{onClick:()=>{Ce()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"}),c&&_&&ee&&d.jsx("button",{onClick:()=>Q(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"var(--color-error)",textAlign:"left",transition:"background 0.15s"},title:"Delete this month (last month only)",children:" Delete Month"})]})]}),d.jsx(d1,{direction:"next",isDisabled:E,isLoading:r,disabledReason:T,onNavigate:e}),d.jsx(mL,{isOpen:te,onClose:()=>Q(!1),year:s,month:o,isDeleting:ae,onConfirm:re})]})}const v0={cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},xL={...v0,background:me.primary,border:"none",color:"white"},wL={...v0,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},SL={...v0,background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error},h1=t=>({display:"flex",alignItems:"center",justifyContent:"center",width:"2.25rem",height:"100%",minHeight:"2.25rem",background:t?`color-mix(in srgb, ${me.error} 15%, transparent)`:`color-mix(in srgb, ${me.success} 15%, transparent)`,border:`1px solid ${t?me.errorBorder:"var(--color-success-border)"}`,borderRadius:"4px 0 0 4px",cursor:"pointer",fontSize:"1rem",fontWeight:600,color:t?me.error:me.success,transition:"all 0.15s ease",flexShrink:0});function x0({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:s,initialData:o,defaultAccountId:c,defaultDate:l,config:h,onSubmit:f,onCancel:p,onDelete:g,extraContent:_}){const{isWide:y}=uA(),{showCategory:x=!1,showCleared:w=!1,showSignToggle:S=!1,accountLabel:E="Account",payeePlaceholder:T="Payee name",descriptionPlaceholder:A="Optional note",submitLabel:M}=h,L=new Date().toISOString().split("T")[0],[H,O]=R.useState(o?.date||l||L),[j,B]=R.useState(o?.payee||""),[V,$]=R.useState(o?.categoryId||(h.showNoCategoryOption?Zt:"")),[k,N]=R.useState(o?.accountId||c||(h.showNoAccountOption?Ht:t[0]?t[0][0]:"")),D=o?.amount!==void 0?Math.abs(o.amount):void 0,[X,K]=R.useState(D?.toString()||""),[q,te]=R.useState(o?.description||""),[Q,ae]=R.useState(o?.cleared||!1),[P,G]=R.useState(()=>S?o?.amount!==void 0?o.amount<0:!1:!0),[ee,re]=R.useState(!1),se={},ge=[];t.forEach(([xe,de])=>{de.account_group_id?(se[de.account_group_id]||(se[de.account_group_id]=[]),se[de.account_group_id].push([xe,de])):ge.push([xe,de])});function Ce(xe){xe.preventDefault();const de=parseFloat(X);if(isNaN(de)||de<=0||x&&!V||!k||!H)return;if(V===Zt&&k===Ht){re(!0);return}re(!1);const Ie=S&&P?-de:de;f({date:H,payee:j.trim()||void 0,categoryId:x?V:void 0,accountId:k,amount:Ie,description:q.trim()||void 0,cleared:w?Q:void 0})}!(V===Zt&&k===Ht)&&ee&&re(!1);const Be=h.showNoAccountOption?d.jsx(lA,{id:"txn-account",value:k,onChange:N,accounts:t,accountGroups:e,placeholder:Ga,required:!0,showNoAccountOption:!0}):d.jsxs(ad,{id:"txn-account",value:k,onChange:xe=>N(xe.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([xe,de])=>{const Ne=se[xe];return Ne?.length?d.jsx("optgroup",{label:de.name,children:Ne.map(([Ae,Ie])=>d.jsx("option",{value:Ae,children:Ie.nickname},Ae))},xe):null}),ge.length>0&&d.jsx("optgroup",{label:"Other",children:ge.map(([xe,de])=>d.jsx("option",{value:xe,children:de.nickname},xe))})]}),Ze=x&&n&&r?d.jsx(Pt,{label:"Category",htmlFor:"txn-category",children:d.jsx(cA,{id:"txn-category",value:V,onChange:$,categories:n,categoryGroups:r,placeholder:h.showNoCategoryOption?$o:"Search...",required:!0,showNoCategoryOption:h.showNoCategoryOption})}):null,st=w?d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[d.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),d.jsx(Xr,{id:"txn-cleared",checked:Q,onChange:xe=>ae(xe.target.checked)})]}):null,U=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),d.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[d.jsx("button",{type:"submit",title:M,style:xL,children:""}),d.jsx("button",{type:"button",onClick:()=>{p()},title:"Cancel",style:wL,children:""}),g&&d.jsx("button",{type:"button",onClick:()=>{g()},title:"Delete",style:SL,children:""})]})]}),fe=ee?d.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:me.error},children:'Cannot select both "No Category" and "No Account"  at least one must be a real category or account.'}):null,ue=d.jsxs(Ya,{children:[d.jsx(Ge,{type:"submit",actionName:M,children:M}),d.jsx(Ge,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:p,children:"Cancel"}),g&&d.jsx(Ge,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:g,children:" Delete"})]}),J=x&&n&&r,Z={fontSize:"0.85rem",padding:"0.5rem"};if(!y)return d.jsxs(Ps,{actionName:M,onSubmit:Ce,children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[d.jsx(Pt,{label:"Date",htmlFor:"txn-date",children:d.jsx(Zf,{id:"txn-date",value:H,onChange:xe=>O(xe.target.value),required:!0,autoFocus:!0})}),d.jsx(Pt,{label:S?P?"Amount (Expense)":"Amount (Refund)":"Amount",htmlFor:"txn-amount",children:S?d.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[d.jsx("button",{type:"button",onClick:()=>G(!P),style:h1(P),title:P?"Click to make this a refund (+)":"Click to make this an expense (-)",children:P?"":"+"}),d.jsx("div",{style:{flex:1},children:d.jsx(Oo,{id:"txn-amount",value:X,onChange:K,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:P?me.error:me.success}})})]}):d.jsx(Oo,{id:"txn-amount",value:X,onChange:K,placeholder:"$0.00",required:!0})})]}),d.jsx(Pt,{label:"Payee",htmlFor:"txn-payee",children:d.jsx(e1,{id:"txn-payee",value:j,onChange:B,payees:s,placeholder:T})}),Ze,d.jsx(Pt,{label:E,htmlFor:"txn-account",children:Be}),d.jsx(Pt,{label:"Description (optional)",htmlFor:"txn-description",children:d.jsx(zs,{id:"txn-description",value:q,onChange:xe=>te(xe.target.value),placeholder:A})}),w&&d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx(Xr,{id:"txn-cleared-stacked",checked:Q,onChange:xe=>ae(xe.target.checked)}),d.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),fe,_]}),ue]});const oe=S?"8.25rem":"6rem",Se=J?w?`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto auto`:`6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) ${oe} minmax(10rem, 2fr) auto`:w?`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto auto`:`6rem minmax(10rem, 1fr) minmax(10rem, 1fr) ${oe} minmax(12rem, 2fr) auto`;return d.jsxs(Ps,{actionName:M,onSubmit:Ce,children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:Se,gap:"1rem",alignItems:"end"},children:[d.jsx(Pt,{label:"Date",htmlFor:"txn-date",children:d.jsx(Zf,{id:"txn-date",value:H,onChange:xe=>O(xe.target.value),required:!0,style:Z,autoFocus:!0})}),d.jsx(Pt,{label:"Payee",htmlFor:"txn-payee",children:d.jsx(e1,{id:"txn-payee",value:j,onChange:B,payees:s,placeholder:T})}),Ze,d.jsx(Pt,{label:E,htmlFor:"txn-account",children:Be}),d.jsx(Pt,{label:S?P?"Amount ()":"Amount (+)":"Amount",htmlFor:"txn-amount",children:S?d.jsxs("div",{className:"currency-with-sign",style:{display:"flex",alignItems:"stretch"},children:[d.jsx("button",{type:"button",onClick:()=>G(!P),style:h1(P),title:P?"Click to make this a refund (+)":"Click to make this an expense (-)",children:P?"":"+"}),d.jsx("div",{style:{flex:1},children:d.jsx(Oo,{id:"txn-amount",value:X,onChange:K,placeholder:"$0.00",required:!0,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",color:P?me.error:me.success}})})]}):d.jsx(Oo,{id:"txn-amount",value:X,onChange:K,placeholder:"$0.00",required:!0})}),d.jsx(Pt,{label:"Description",htmlFor:"txn-description",children:d.jsx(zs,{id:"txn-description",value:q,onChange:xe=>te(xe.target.value),placeholder:A,style:Z})}),st,U]}),fe,_]})}function f1({accounts:t,accountGroups:e,payees:n,initialData:r,defaultAccountId:s,defaultDate:o,onSubmit:c,onCancel:l,onDelete:h,submitLabel:f}){function p(g){c(g.amount,g.accountId,g.date,g.payee,g.description)}return d.jsx(x0,{accounts:t,accountGroups:e,payees:n,initialData:r?{date:r.date,payee:r.payee,accountId:r.account_id,amount:r.amount,description:r.description}:void 0,defaultAccountId:s,defaultDate:o,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:f},onSubmit:p,onCancel:l,onDelete:h})}function CL({income:t,accountName:e,accountGroupName:n,onEdit:r,onDelete:s,isMobile:o,isEvenRow:c}){const l=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",h=n?`${n} / ${e}`:e,f=c?"transparent":"var(--row-alt-bg)";if(o)return d.jsxs("div",{onClick:r,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:f,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:l}),d.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),d.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",h]})]}),d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsxs("span",{style:{fontWeight:600,color:me.success,fontFamily:"monospace"},children:["+",Jt(t.amount)]})})]});const p={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:f,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsx("div",{style:{...p,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:l})}),d.jsx("div",{style:{...p,fontWeight:500,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),d.jsx("div",{style:{...p,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:h})}),d.jsxs("div",{style:{...p,justifyContent:"flex-end",fontWeight:600,color:me.success,fontFamily:"monospace"},children:["+",Jt(t.amount)]}),d.jsx("div",{style:{...p,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsxs("div",{style:{...p,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:r,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:s,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:g=>g.currentTarget.style.opacity="1",onMouseLeave:g=>g.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Fc={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function EL(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:s}=Qe(),{accounts:o,accountGroups:c}=Dn(),{month:l,isLoading:h}=rs(t,e,n),{addIncome:f}=Q4(),{updateIncome:p}=Y4(),{deleteIncome:g}=X4(),_=Fs(),[y,x]=R.useState(null),[w,S]=R.useState(!1),[E,T]=R.useState(null),L=c0(t,{enabled:w||E!==null}).data||[];function H(q){const te=q.account_group_id?c[q.account_group_id]:void 0;return te&&te.is_active!==null?te.is_active:q.is_active!==!1}function O(q){const te=q.account_group_id?c[q.account_group_id]:void 0;return te&&te.on_budget!==null?te.on_budget:q.on_budget!==!1}const j=Object.entries(o).filter(([,q])=>H(q)&&O(q)),B=j.filter(([,q])=>q.is_income_account),V=B.length>0?B:j,$=j.find(([,q])=>q.is_income_default),k=$?$[0]:void 0,N=l?.income.reduce((q,te)=>q+te.amount,0)||0;function D(q,te,Q,ae,P){if(!t)return;x(null),S(!1);const{year:G,month:ee}=km(Q);(G!==e||ee!==n)&&(r(G),s(ee)),f(t,G,ee,q,te,Q,ae,P).catch(re=>{x(re instanceof Error?re.message:"Failed to add income")})}function X(q,te,Q,ae,P,G){t&&(x(null),T(null),p(t,e,n,q,te,Q,ae,P,G).catch(ee=>{x(ee instanceof Error?ee.message:"Failed to update income")}))}function K(q){t&&confirm("Are you sure you want to delete this income entry?")&&(x(null),g(t,e,n,q).catch(te=>{x(te instanceof Error?te.message:"Failed to delete income")}))}return d.jsxs("div",{style:{opacity:h?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:h?"none":"auto"},children:[y&&d.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:y}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:_?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:_?"block":"grid",gridTemplateColumns:_?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Income:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming money that should be factored into income calculations"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:et(N),fontWeight:600},children:Jt(N)})]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!w&&d.jsx(Ge,{actionName:"Open Add Income Form",onClick:()=>S(!0),disabled:V.length===0,disabledReason:Object.keys(o).length===0?"Create an account first":"Set up an income account first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!_&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Fc,children:"Date"}),d.jsx("div",{style:Fc,children:"Payee"}),d.jsx("div",{style:Fc,children:"Account"}),d.jsx("div",{style:{...Fc,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:Fc,children:"Description"}),d.jsx("div",{style:Fc})]})]}),d.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),V.length===0&&d.jsx(cd,{message:Object.keys(o).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),w&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(f1,{accounts:V,accountGroups:c,payees:L,defaultAccountId:k,defaultDate:Im(e,n),onSubmit:D,onCancel:()=>S(!1),submitLabel:"Add Income",isMobile:_})}),l?.income.slice().sort((q,te)=>(q.date||"").localeCompare(te.date||"")).map((q,te)=>E===q.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(f1,{accounts:V,accountGroups:c,payees:L,initialData:q,onSubmit:(Q,ae,P,G,ee)=>X(q.id,Q,ae,P,G,ee),onCancel:()=>T(null),onDelete:()=>K(q.id),submitLabel:"Save",isMobile:_})},q.id):d.jsx(CL,{income:q,accountName:tt(q.account_id)?Ga:o[q.account_id]?.nickname||"Unknown Account",accountGroupName:tt(q.account_id)?void 0:o[q.account_id]?.account_group_id?c[o[q.account_id].account_group_id]?.name:void 0,onEdit:()=>{q.payee||`${q.amount}`,T(q.id)},onDelete:()=>K(q.id),isMobile:_,isEvenRow:te%2===0},q.id)),(!l?.income||l.income.length===0)&&!w&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function m1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:s,initialData:o,defaultAccountId:c,defaultDate:l,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function _(y){h(y.amount,y.categoryId,y.accountId,y.date,y.payee,y.description,y.cleared)}return d.jsx(x0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:s,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:c,defaultDate:l,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!1,showNoAccountOption:!1,showSignToggle:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:g},onSubmit:_,onCancel:f,onDelete:p})}function TL({expense:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:s,onDelete:o,isMobile:c,isEvenRow:l}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=l?"transparent":"var(--row-alt-bg)";if(c)return d.jsxs("div",{onClick:s,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),d.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),d.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",f]})]})]}),d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsx("span",{style:{fontWeight:600,color:et(t.amount),fontFamily:"monospace"},children:Qt(t.amount)})})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:h})}),d.jsx("div",{style:{...g,fontWeight:500,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),d.jsx("div",{style:{...g,justifyContent:"center"},children:d.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...g,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),d.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:et(t.amount),fontFamily:"monospace"},children:Qt(t.amount)}),d.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:s,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const wa={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function AL(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:s}=Qe(),{accounts:o,accountGroups:c,categories:l,categoryGroups:h}=Dn(),{month:f,isLoading:p}=rs(t,e,n),{addExpense:g}=J4(),{updateExpense:_}=tz(),{deleteExpense:y}=nz(),x=Fs(),[w,S]=R.useState(null),[E,T]=R.useState(!1),[A,M]=R.useState(null),O=c0(t,{enabled:E||A!==null}).data||[];function j(Q){const ae=Q.account_group_id?c[Q.account_group_id]:void 0;return ae&&ae.is_active!==null?ae.is_active:Q.is_active!==!1}function B(Q){const ae=Q.account_group_id?c[Q.account_group_id]:void 0;return ae&&ae.on_budget!==null?ae.on_budget:Q.on_budget!==!1}const V=Object.entries(o).filter(([,Q])=>j(Q)&&B(Q)),$=V.filter(([,Q])=>Q.is_outgo_account),k=$.length>0?$:V,N=V.find(([,Q])=>Q.is_outgo_default),D=N?N[0]:void 0,X=f?.expenses?.reduce((Q,ae)=>Q+ae.amount,0)||0;function K(Q,ae,P,G,ee,re,se){if(!t)return;S(null),T(!1);const{year:ge,month:Ce}=km(G);(ge!==e||Ce!==n)&&(r(ge),s(Ce)),g(t,ge,Ce,Q,ae,P,G,ee,re,se).catch(ie=>{S(ie instanceof Error?ie.message:"Failed to add expense")})}function q(Q,ae,P,G,ee,re,se,ge){t&&(S(null),M(null),_(t,e,n,Q,ae,P,G,ee,re,se,ge).catch(Ce=>{S(Ce instanceof Error?Ce.message:"Failed to update expense")}))}function te(Q){t&&confirm("Are you sure you want to delete this expense?")&&(S(null),y(t,e,n,Q).catch(ae=>{S(ae instanceof Error?ae.message:"Failed to delete expense")}))}return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[w&&d.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:w}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:x?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:x?"block":"grid",gridTemplateColumns:x?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Transactions that should be factored into spend calculations"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:et(X),fontWeight:600},children:Qt(X)})]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&d.jsx(Ge,{actionName:"Open Add Expense Form",onClick:()=>T(!0),disabled:k.length===0||Object.keys(l).length===0,disabledReason:k.length===0&&Object.keys(l).length===0?"Create accounts and categories first":k.length===0?"Create an expense account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!x&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:wa,children:"Date"}),d.jsx("div",{style:wa,children:"Payee"}),d.jsx("div",{style:{...wa,textAlign:"center"},children:"Category"}),d.jsx("div",{style:wa,children:"Account"}),d.jsx("div",{style:{...wa,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:wa,children:"Description"}),d.jsx("div",{style:{...wa,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:wa})]})]}),k.length===0&&d.jsx(cd,{message:Object.keys(o).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".',linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),Object.keys(l).length===0&&d.jsx(cd,{message:"You need to create at least one category before adding expenses.",linkText:"Create categories",linkTo:"/budget/settings/categories"}),E&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(m1,{accounts:k,accountGroups:c,categories:l,categoryGroups:h,payees:O,defaultAccountId:D,defaultDate:Im(e,n),onSubmit:K,onCancel:()=>T(!1),submitLabel:"Add Expense",isMobile:x})}),f?.expenses?.slice().sort((Q,ae)=>(Q.date||"").localeCompare(ae.date||"")).map((Q,ae)=>A===Q.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(m1,{accounts:k,accountGroups:c,categories:l,categoryGroups:h,payees:O,initialData:Q,onSubmit:(P,G,ee,re,se,ge,Ce)=>q(Q.id,P,G,ee,re,se,ge,Ce),onCancel:()=>M(null),onDelete:()=>te(Q.id),submitLabel:"Save",isMobile:x})},Q.id):d.jsx(TL,{expense:Q,categoryName:lt(Q.category_id)?$o:l[Q.category_id]?.name||"Unknown Category",accountName:tt(Q.account_id)?Ga:o[Q.account_id]?.nickname||"Unknown Account",accountGroupName:tt(Q.account_id)?void 0:o[Q.account_id]?.account_group_id?c[o[Q.account_id].account_group_id]?.name:void 0,onEdit:()=>{Q.payee||`${Q.amount}`,M(Q.id)},onDelete:()=>te(Q.id),isMobile:x,isEvenRow:ae%2===0},Q.id)),(!f?.expenses||f.expenses.length===0)&&!E&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const jL={background:me.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},RL={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},IL={background:"transparent",border:`1px solid ${me.errorBorder}`,color:me.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function g1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,initialData:s,defaultDate:o,onSubmit:c,onCancel:l,onDelete:h,submitLabel:f}){const{isWide:p}=uA(),g=new Date().toISOString().split("T")[0],[_,y]=R.useState(s?.date||o||g),[x,w]=R.useState(s?.amount?.toString()||""),[S,E]=R.useState(s?.from_account_id||Ht),[T,A]=R.useState(s?.to_account_id||Ht),[M,L]=R.useState(s?.from_category_id||Zt),[H,O]=R.useState(s?.to_category_id||Zt),[j,B]=R.useState(s?.description||""),[V,$]=R.useState(s?.cleared||!1),[k,N]=R.useState(null),D=M===Zt,X=H===Zt,K=S===Ht,q=T===Ht;function te(){return D&&X&&(K&&q)?'A transfer must move between real categories or real accounts  not all "No" options.':K!==q?'Both accounts must be real accounts, or both must be "No Account". Cannot transfer from a real account to nothing.':D!==X?'Both categories must be real categories, or both must be "No Category". Cannot transfer from a real category to nothing.':null}te()===null&&k!==null&&N(null);function ae(ie){ie.preventDefault();const le=parseFloat(x);if(isNaN(le)||le<=0||!S||!T||!M||!H||!_)return;const Me=te();if(Me){N(Me);return}N(null),c(le,S,T,M,H,_,j.trim()||void 0,V)}const P=k?d.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.errorBorder}`,borderRadius:"6px",padding:"0.5rem 0.75rem",fontSize:"0.85rem",color:me.error,marginTop:"0.5rem"},children:k}):null,G=(ie,le,Me,Be)=>d.jsx(Pt,{label:Be,htmlFor:ie,children:d.jsx(lA,{id:ie,value:le,onChange:Me,accounts:t,accountGroups:e,placeholder:Ga,required:!0,showNoAccountOption:!0})}),ee=(ie,le,Me,Be)=>d.jsx(Pt,{label:Be,htmlFor:ie,children:d.jsx(cA,{id:ie,value:le,onChange:Me,categories:n,categoryGroups:r,placeholder:$o,required:!0,showNoCategoryOption:!0})}),re=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[d.jsx("label",{htmlFor:"transfer-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),d.jsx(Xr,{id:"transfer-cleared",checked:V,onChange:ie=>$(ie.target.checked)})]}),se=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),d.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[d.jsx("button",{type:"submit",title:f,style:jL,children:""}),d.jsx("button",{type:"button",onClick:()=>{l()},title:"Cancel",style:RL,children:""}),h&&d.jsx("button",{type:"button",onClick:()=>{h()},title:"Delete",style:IL,children:""})]})]}),ge=d.jsxs(Ya,{children:[d.jsx(Ge,{type:"submit",actionName:f,children:f}),d.jsx(Ge,{type:"button",variant:"secondary",actionName:"Cancel Transfer Form",onClick:l,children:"Cancel"}),h&&d.jsx(Ge,{type:"button",variant:"danger",actionName:"Delete Transfer",onClick:h,children:" Delete"})]}),Ce={fontSize:"0.85rem",padding:"0.5rem"};return p?d.jsx(Ps,{actionName:f,onSubmit:ae,children:d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[d.jsx(Pt,{label:"Date",htmlFor:"transfer-date",children:d.jsx(Zf,{id:"transfer-date",value:_,onChange:ie=>y(ie.target.value),required:!0,style:Ce,autoFocus:!0})}),d.jsx(Pt,{label:"Amount",htmlFor:"transfer-amount",children:d.jsx(Oo,{id:"transfer-amount",value:x,onChange:w,placeholder:"$0.00",required:!0})}),ee("from-category",M,L,"From Category"),G("from-account",S,E,"From Account"),d.jsx(Pt,{label:"Description",htmlFor:"transfer-description",children:d.jsx(zs,{id:"transfer-description",value:j,onChange:ie=>B(ie.target.value),placeholder:"e.g., Transfer",style:Ce})})]}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"5.5rem 5.5rem 1fr 1fr 1.5fr",gap:"0.75rem",alignItems:"end"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",opacity:.5,paddingBottom:"0.5rem"},children:""}),d.jsx("div",{}),ee("to-category",H,O,"To Category"),G("to-account",T,A,"To Account"),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"end",paddingBottom:"0.25rem"},children:[re,se]})]}),P]})}):d.jsxs(Ps,{actionName:f,onSubmit:ae,children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[d.jsx(Pt,{label:"Date",htmlFor:"transfer-date",children:d.jsx(Zf,{id:"transfer-date",value:_,onChange:ie=>y(ie.target.value),required:!0,autoFocus:!0})}),d.jsx(Pt,{label:"Amount",htmlFor:"transfer-amount",children:d.jsx(Oo,{id:"transfer-amount",value:x,onChange:w,placeholder:"$0.00",required:!0})})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1rem",borderRadius:"8px"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[ee("from-category",M,L,"From Cat."),G("from-account",S,E,"From Acct.")]}),d.jsx("div",{style:{display:"flex",justifyContent:"center",fontSize:"1.5rem",opacity:.5},children:""}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",alignItems:"end"},children:[ee("to-category",H,O,"To Cat."),G("to-account",T,A,"To Acct.")]})]}),d.jsx(Pt,{label:"Description (optional)",htmlFor:"transfer-description",children:d.jsx(zs,{id:"transfer-description",value:j,onChange:ie=>B(ie.target.value),placeholder:"e.g., Transfer to savings"})}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx(Xr,{id:"transfer-cleared-stacked",checked:V,onChange:ie=>$(ie.target.checked)}),d.jsx("label",{htmlFor:"transfer-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),P]}),ge]})}function kL({transfer:t,fromCategoryName:e,toCategoryName:n,fromAccountName:r,toAccountName:s,fromAccountGroupName:o,toAccountGroupName:c,isFromCategoryNo:l,isToCategoryNo:h,isFromAccountNo:f,isToAccountNo:p,onEdit:g,onDelete:_,isMobile:y,isEvenRow:x}){const w=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",S=x?"transparent":"var(--row-alt-bg)";if(y)return d.jsxs("div",{onClick:g,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.75rem 1rem",background:S,cursor:"pointer",transition:"background 0.15s"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:w}),d.jsx("span",{style:{fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Jt(t.amount)}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"0.5rem",alignItems:"center"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx("span",{style:l?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:e}),f?d.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:r}):d.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[o&&d.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:o}),d.jsx("span",{children:r})]})]}),d.jsx("span",{style:{opacity:.5},children:""}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx("span",{style:h?{fontSize:"0.7rem",opacity:.4}:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-block",width:"fit-content"},children:n}),p?d.jsx("span",{style:{fontSize:"0.75rem",opacity:.4},children:s}):d.jsxs("div",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px",display:"inline-flex",flexDirection:"column",gap:"0.1rem",width:"fit-content"},children:[c&&d.jsx("span",{style:{fontSize:"0.65rem",opacity:.6},children:c}),d.jsx("span",{children:s})]})]})]}),t.description&&d.jsx("div",{style:{fontSize:"0.75rem",opacity:.6},children:t.description})]});const E={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[d.jsx("div",{style:{...E,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:w})}),d.jsx("div",{style:{...E,justifyContent:"flex-end",fontWeight:600,opacity:.8,fontFamily:"monospace"},children:Jt(t.amount)}),d.jsx("div",{style:{...E,justifyContent:"center"},children:d.jsx("span",{style:l?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...E,overflow:"hidden"},children:f?d.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:r}):d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[o&&d.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o}),d.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})]})}),d.jsx("div",{style:{...E,justifyContent:"center",fontSize:"1rem"},children:d.jsx("span",{style:{opacity:.5},children:""})}),d.jsx("div",{style:{...E,justifyContent:"center"},children:d.jsx("span",{style:h?{fontSize:"0.8rem",opacity:.4}:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),d.jsx("div",{style:{...E,overflow:"hidden"},children:p?d.jsx("span",{style:{opacity:.4,fontSize:"0.85rem"},children:s}):d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.1rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden"},children:[c&&d.jsx("span",{style:{fontSize:"0.7rem",opacity:.6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c}),d.jsx("span",{style:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s})]})}),d.jsx("div",{style:{...E,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsx("div",{style:{...E,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...E,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:g,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:_,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:T=>T.currentTarget.style.opacity="1",onMouseLeave:T=>T.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const Fi={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function DL(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:s}=Qe(),{accounts:o,accountGroups:c,categories:l,categoryGroups:h}=Dn(),{month:f,isLoading:p}=rs(t,e,n),{addTransfer:g}=iz(),{updateTransfer:_}=az(),{deleteTransfer:y}=oz(),x=Fs(),[w,S]=R.useState(null),[E,T]=R.useState(!1),[A,M]=R.useState(null);function L(k){const N=k.account_group_id?c[k.account_group_id]:void 0;return N&&N.is_active!==null?N.is_active:k.is_active!==!1}function H(k){const N=k.account_group_id?c[k.account_group_id]:void 0;return N&&N.on_budget!==null?N.on_budget:k.on_budget!==!1}const O=Object.entries(o).filter(([,k])=>L(k)&&H(k));function j(k,N,D,X,K,q,te,Q){if(!t)return;S(null),T(!1);const{year:ae,month:P}=km(q);(ae!==e||P!==n)&&(r(ae),s(P)),g(t,ae,P,k,N,D,X,K,q,te,Q).catch(G=>{S(G instanceof Error?G.message:"Failed to add transfer")})}function B(k,N,D,X,K,q,te,Q,ae){t&&(S(null),M(null),_(t,e,n,k,N,D,X,K,q,te,Q,ae).catch(P=>{S(P instanceof Error?P.message:"Failed to update transfer")}))}function V(k){t&&confirm("Are you sure you want to delete this transfer?")&&(S(null),y(t,e,n,k).catch(N=>{S(N instanceof Error?N.message:"Failed to delete transfer")}))}const $=O.length>=1&&Object.keys(l).length>=1;return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[w&&d.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:w}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:x?"1fr":"5rem 6rem 1fr 1fr 2rem 1fr 1fr 1fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:x?"block":"grid",gridTemplateColumns:x?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Transfers:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Moving money between accounts and categories within the budget"})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&d.jsx(Ge,{actionName:"Open Add Transfer Form",onClick:()=>T(!0),disabled:!$,disabledReason:O.length===0&&Object.keys(l).length===0?"Create accounts and categories first":O.length===0?"Create an account first":"Create a category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Transfer"})})]}),!x&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Fi,children:"Date"}),d.jsx("div",{style:{...Fi,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:{...Fi,textAlign:"center"},children:"From Cat"}),d.jsx("div",{style:Fi,children:"From Acct"}),d.jsx("div",{style:Fi}),d.jsx("div",{style:{...Fi,textAlign:"center"},children:"To Cat"}),d.jsx("div",{style:Fi,children:"To Acct"}),d.jsx("div",{style:Fi,children:"Description"}),d.jsx("div",{style:{...Fi,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:Fi})]})]}),!$&&d.jsx(cd,{message:"You need at least one account and one category before adding transfers.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),E&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(g1,{accounts:O,accountGroups:c,categories:l,categoryGroups:h,defaultDate:Im(e,n),onSubmit:j,onCancel:()=>T(!1),submitLabel:"Add Transfer"})}),f?.transfers?.slice().sort((k,N)=>(k.date||"").localeCompare(N.date||"")).map((k,N)=>A===k.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(g1,{accounts:O,accountGroups:c,categories:l,categoryGroups:h,initialData:k,onSubmit:(D,X,K,q,te,Q,ae,P)=>B(k.id,D,X,K,q,te,Q,ae,P),onCancel:()=>M(null),onDelete:()=>V(k.id),submitLabel:"Save"})},k.id):d.jsx(kL,{transfer:k,fromCategoryName:lt(k.from_category_id)?$o:l[k.from_category_id]?.name||"Unknown",toCategoryName:lt(k.to_category_id)?$o:l[k.to_category_id]?.name||"Unknown",fromAccountName:tt(k.from_account_id)?Ga:o[k.from_account_id]?.nickname||"Unknown",toAccountName:tt(k.to_account_id)?Ga:o[k.to_account_id]?.nickname||"Unknown",fromAccountGroupName:tt(k.from_account_id)?void 0:o[k.from_account_id]?.account_group_id?c[o[k.from_account_id].account_group_id]?.name:void 0,toAccountGroupName:tt(k.to_account_id)?void 0:o[k.to_account_id]?.account_group_id?c[o[k.to_account_id].account_group_id]?.name:void 0,isFromCategoryNo:lt(k.from_category_id),isToCategoryNo:lt(k.to_category_id),isFromAccountNo:tt(k.from_account_id),isToAccountNo:tt(k.to_account_id),onEdit:()=>{k.description||`${k.amount}`,M(k.id)},onDelete:()=>V(k.id),isMobile:x,isEvenRow:N%2===0},k.id)),(!f?.transfers||f.transfers.length===0)&&!E&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No transfers recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function p1({accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:s,initialData:o,defaultAccountId:c,defaultDate:l,onSubmit:h,onCancel:f,onDelete:p,submitLabel:g}){function _(y){h(y.amount,y.accountId,y.categoryId,y.date,y.payee,y.description,y.cleared)}return d.jsx(x0,{accounts:t,accountGroups:e,categories:n,categoryGroups:r,payees:s,initialData:o?{date:o.date,payee:o.payee,categoryId:o.category_id,accountId:o.account_id,amount:o.amount,description:o.description,cleared:o.cleared}:void 0,defaultAccountId:c,defaultDate:l,config:{showCategory:!0,showCleared:!0,showNoCategoryOption:!0,showNoAccountOption:!0,showSignToggle:!0,accountLabel:"Account",payeePlaceholder:"e.g., Bank, Interest source",descriptionPlaceholder:"e.g., Starting balance, Correction",submitLabel:g},onSubmit:_,onCancel:f,onDelete:p})}function ML({adjustment:t,categoryName:e,accountName:n,accountGroupName:r,onEdit:s,onDelete:o,isMobile:c,isEvenRow:l}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=r?`${r} / ${n}`:n,p=l?"transparent":"var(--row-alt-bg)";if(c)return d.jsxs("div",{onClick:s,style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",gap:"0.25rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:h}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:me.success},title:"Cleared",children:""})]}),d.jsx("span",{style:{fontWeight:600,color:et(t.amount),fontFamily:"monospace"},children:Qt(t.amount)})]}),d.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.description||"Adjustment"}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[d.jsx("span",{style:{fontSize:"0.7rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),d.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:f})]})]});const g={padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:p,display:"grid",gridTemplateColumns:"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsx("div",{style:{...g,fontSize:"0.85rem",fontFamily:"monospace"},children:d.jsx("span",{style:{opacity:.6},children:h})}),d.jsx("div",{style:{...g,justifyContent:"center"},children:d.jsx("span",{style:{fontSize:"0.8rem",background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...g,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem",opacity:.7},children:f})}),d.jsx("div",{style:{...g,justifyContent:"flex-end",fontWeight:600,color:et(t.amount),fontFamily:"monospace"},children:Qt(t.amount)}),d.jsx("div",{style:{...g,paddingLeft:"0.5rem",overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem",opacity:.6},children:t.description||""})}),d.jsx("div",{style:{...g,justifyContent:"center",color:t.cleared?me.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...g,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:s,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:o,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:_=>_.currentTarget.style.opacity="1",onMouseLeave:_=>_.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}const jo={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderTop:"1px solid var(--border-subtle)"};function OL(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n,setCurrentYear:r,setCurrentMonthNumber:s}=Qe(),{accounts:o,accountGroups:c,categories:l,categoryGroups:h}=Dn(),{month:f,isLoading:p}=rs(t,e,n),{addAdjustment:g}=lz(),{updateAdjustment:_}=dz(),{deleteAdjustment:y}=hz(),x=Fs(),[w,S]=R.useState(null),[E,T]=R.useState(!1),[A,M]=R.useState(null),O=c0(t,{enabled:E||A!==null}).data||[];function j(D){const X=D.account_group_id?c[D.account_group_id]:void 0;return X&&X.is_active!==null?X.is_active:D.is_active!==!1}function B(D){const X=D.account_group_id?c[D.account_group_id]:void 0;return X&&X.on_budget!==null?X.on_budget:D.on_budget!==!1}const V=Object.entries(o).filter(([,D])=>j(D)&&B(D));function $(D,X,K,q,te,Q,ae){if(!t)return;S(null),T(!1);const{year:P,month:G}=km(q);(P!==e||G!==n)&&(r(P),s(G)),g(t,P,G,D,X,K,q,te,Q,ae).catch(ee=>{S(ee instanceof Error?ee.message:"Failed to add adjustment")})}function k(D,X,K,q,te,Q,ae,P){t&&(S(null),M(null),_(t,e,n,D,X,K,q,te,Q,ae,P).catch(G=>{S(G instanceof Error?G.message:"Failed to update adjustment")}))}function N(D){t&&confirm("Are you sure you want to delete this adjustment?")&&(S(null),y(t,e,n,D).catch(X=>{S(X instanceof Error?X.message:"Failed to delete adjustment")}))}return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[w&&d.jsx("div",{style:{background:`color-mix(in srgb, ${me.error} 15%, transparent)`,border:`1px solid ${me.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:me.error},children:w}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:x?"1fr":"5rem 1fr 1fr 6rem 1.5fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",borderBottom:"1px solid var(--border-medium)",display:x?"block":"grid",gridTemplateColumns:x?void 0:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Adjustments:"}),d.jsx("span",{style:{opacity:.6,fontSize:"0.8rem"},children:"Incoming or outgoing transactions that should bypass income and spend calculations"})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!E&&d.jsx(Ge,{actionName:"Open Add Adjustment Form",onClick:()=>T(!0),disabled:Object.keys(l).length===0&&V.length===0,disabledReason:"Create an account or category first",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Adjustment"})})]}),!x&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:jo,children:"Date"}),d.jsx("div",{style:{...jo,textAlign:"center"},children:"Category"}),d.jsx("div",{style:jo,children:"Account"}),d.jsx("div",{style:{...jo,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:jo,children:"Description"}),d.jsx("div",{style:{...jo,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:jo})]})]}),V.length===0&&Object.keys(l).length===0&&d.jsx(cd,{message:"You need to create at least one account or category before adding adjustments.",linkText:"Manage accounts",linkTo:"/budget/settings/accounts"}),E&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(p1,{accounts:V,accountGroups:c,categories:l,categoryGroups:h,payees:O,defaultDate:Im(e,n),onSubmit:$,onCancel:()=>T(!1),submitLabel:"Add Adjustment"})}),f?.adjustments?.slice().sort((D,X)=>(D.date||"").localeCompare(X.date||"")).map((D,X)=>A===D.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(p1,{accounts:V,accountGroups:c,categories:l,categoryGroups:h,payees:O,initialData:D,onSubmit:(K,q,te,Q,ae,P,G)=>k(D.id,K,q,te,Q,ae,P,G),onCancel:()=>M(null),onDelete:()=>N(D.id),submitLabel:"Save"})},D.id):d.jsx(ML,{adjustment:D,categoryName:lt(D.category_id)?$o:l[D.category_id]?.name||"Unknown Category",accountName:tt(D.account_id)?Ga:o[D.account_id]?.nickname||"Unknown Account",accountGroupName:tt(D.account_id)?void 0:o[D.account_id]?.account_group_id?c[o[D.account_id].account_group_id]?.name:void 0,onEdit:()=>{D.description||`${D.amount}`,M(D.id)},onDelete:()=>N(D.id),isMobile:x,isEvenRow:X%2===0},D.id)),(!f?.adjustments||f.adjustments.length===0)&&!E&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No adjustments recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const Jy={minimumFractionDigits:2,maximumFractionDigits:2};function ko(t){return`$${Math.abs(t).toLocaleString("en-US",Jy)}`}function cr(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",Jy)}`:`$${t.toLocaleString("en-US",Jy)}`}function Iu(t){return t===0?"$0.00":`${t>0?"+":"-"}${ko(t)}`}function lr(t){return`${t>=0?"+":"-"}${ko(t)}`}const NL=["January","February","March","April","May","June","July","August","September","October","November","December"];function BL(t){const{year:e,monthNumber:n,categoryGroups:r,categoriesByGroup:s,liveCategoryBalances:o,getAllocationAmount:c,isDraftMode:l,balanceTotals:h,grandAllTime:f}=t,p=`${NL[n-1]} ${e}`,g=[];g.push(`# Category Balances  ${p}`),g.push(""),l&&(g.push("*Draft allocations (not yet applied).*"),g.push(""));const _="| Category | Start | Allocated | Spent | Transfers | Adjust | Net Change | End | All-Time |",y="| --- | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: |";g.push(_),g.push(y);const x=[...r].sort((T,A)=>T.sort_order-A.sort_order);function w(T,A){const M=A.balance??0;if(!l)return Math.max(0,M);const L=c(T,A),H=t.savedAllocations[T]??0,O=L-H;return Math.max(0,M+O)}for(const T of x){const A=s[T.id]||[];if(A.length===0)continue;let M=0,L=0,H=0,O=0,j=0,B=0,V=0;for(const[N,D]of A){const X=o[N];if(!X)continue;const K=X.allocated+X.spent+X.transfers+X.adjustments,q=w(N,D);M+=X.start_balance,L+=X.allocated,H+=X.spent,O+=X.transfers,j+=X.adjustments,B+=X.end_balance,V+=q;const te=D.name.replace(/\|/g,"\\|");g.push(`| ${te} | ${cr(X.start_balance)} | +${ko(X.allocated)} | ${Iu(X.spent)} | ${lr(X.transfers)} | ${lr(X.adjustments)} | ${lr(K)} | ${cr(X.end_balance)} | ${cr(q)} |`)}const $=L+H+O+j,k=T.name.replace(/\|/g,"\\|");g.push(`| **${k}** *(total)* | **${cr(M)}** | **+${ko(L)}** | **${Iu(H)}** | **${lr(O)}** | **${lr(j)}** | **${lr($)}** | **${cr(B)}** | **${cr(V)}** |`)}const S=s[Xt]||[];if(S.length>0){let T=0,A=0,M=0,L=0,H=0,O=0,j=0;for(const[V,$]of S){const k=o[V];if(!k)continue;const N=k.allocated+k.spent+k.transfers+k.adjustments,D=w(V,$);T+=k.start_balance,A+=k.allocated,M+=k.spent,L+=k.transfers,H+=k.adjustments,O+=k.end_balance,j+=D;const X=$.name.replace(/\|/g,"\\|");g.push(`| ${X} | ${cr(k.start_balance)} | +${ko(k.allocated)} | ${Iu(k.spent)} | ${lr(k.transfers)} | ${lr(k.adjustments)} | ${lr(N)} | ${cr(k.end_balance)} | ${cr(D)} |`)}const B=A+M+L+H;g.push(`| **Uncategorized** *(total)* | **${cr(T)}** | **+${ko(A)}** | **${Iu(M)}** | **${lr(L)}** | **${lr(H)}** | **${lr(B)}** | **${cr(O)}** | **${cr(j)}** |`)}const E=h.allocated+h.spent+h.transfers+h.adjustments;return g.push(`| **Grand Totals** | **${cr(h.start)}** | **+${ko(h.allocated)}** | **${Iu(h.spent)}** | **${lr(h.transfers)}** | **${lr(h.adjustments)}** | **${lr(E)}** | **${cr(h.end)}** | **${cr(f)}** |`),g.join(`
`)}function PL(t,e){const n=new Blob([t],{type:"text/markdown;charset=utf-8"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=e,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}function zL({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:r,removeLoadingHold:s}=kn(),{selectedBudgetId:o,currentYear:c,currentMonthNumber:l}=Qe(),{deleteAllocations:h}=DA(),[f,p]=R.useState(null),g=async()=>{if(o){p(null),r("allocations-delete","Deleting allocations...");try{await h({budgetId:o,year:c,month:l}),e(),n?.()}catch(_){p(_ instanceof Error?_.message:"Failed to delete allocations")}finally{s("allocations-delete")}}};return d.jsxs(Ji,{isOpen:t,onClose:e,title:"Delete Allocations",children:[f&&d.jsx(h0,{message:f,onDismiss:()=>p(null)}),d.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ge,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),d.jsx(Ge,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:g,children:"Delete Allocations"})]})]})}function PA({isDraftMode:t,isEditingAppliedAllocations:e,onBudgetTotal:n,availableNow:r,currentMonthIncome:s,balanceTotals:o,draftChangeAmount:c,availableAfterApply:l,currentDraftTotal:h}){const f=t&&h!==void 0?h:o.allocated,p=n!==void 0?n-r:void 0;return t||e?d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:"Allocations Worksheet:"}),n!==void 0&&p!==void 0&&h!==void 0?d.jsxs("span",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem 0.5rem",alignItems:"center"},children:[d.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),d.jsx("span",{style:{color:et(n),fontWeight:600},children:Ft(n)}),d.jsx("span",{style:{opacity:.6},children:" Allocated: "}),d.jsx("span",{style:{fontWeight:600},children:Ft(p)}),d.jsx("span",{style:{opacity:.6},children:"= Avail: "}),d.jsx("span",{style:{color:et(r),fontWeight:600},children:Ft(r)}),d.jsx("span",{style:{opacity:.6},children:" Draft: "}),d.jsx("span",{style:{color:Pa(f),fontWeight:600,...Or},children:Ft(f)}),d.jsx("span",{style:{opacity:.6},children:"= Remaining: "}),d.jsx("span",{style:{color:et(l),fontWeight:600,...Or},children:Ft(l)}),e&&c!==0&&d.jsxs("span",{style:{fontSize:"0.85em",color:c>0?me.warning:me.success},children:["(",Qt(c),")"]})]}):d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{opacity:.6},children:"Avail: "}),d.jsx("span",{style:{color:et(r),fontWeight:600},children:Ft(r)}),d.jsx("span",{style:{opacity:.6},children:" Draft: "}),d.jsx("span",{style:{color:Pa(f),fontWeight:600,...Or},children:Ft(f)}),d.jsx("span",{style:{opacity:.6},children:"= Remaining: "}),d.jsx("span",{style:{color:et(l),fontWeight:600,...Or},children:Ft(l)})]})]}):d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{fontWeight:600,marginRight:"0.25rem"},children:"Month Summary:"}),d.jsx("span",{style:{opacity:.6},children:"Inc: "}),d.jsx("span",{style:{color:me.success,fontWeight:600},children:Ft(s)}),d.jsx("span",{style:{opacity:.6},children:"Alloc: "}),d.jsx("span",{style:{color:Pa(o.allocated),fontWeight:600},children:Ft(o.allocated)}),d.jsx("span",{style:{opacity:.6},children:"Spent: "}),d.jsx("span",{style:{color:Al(o.spent),fontWeight:600},children:Ft(o.spent)}),d.jsx("span",{style:{opacity:.6},children:"Net: "}),d.jsx("span",{style:{color:et(o.allocated+o.spent),fontWeight:600},children:Ft(o.allocated+o.spent)})]})}function LL({totals:t}){return d.jsxs(d.Fragment,{children:[d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Start: "}),d.jsx("span",{style:{color:et(t.start),fontWeight:600},children:Ft(t.start)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Inc: "}),d.jsx("span",{style:{color:me.success,fontWeight:600},children:Ft(t.income)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Exp: "}),d.jsx("span",{style:{color:Al(t.expenses),fontWeight:600},children:Ft(t.expenses)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"End: "}),d.jsx("span",{style:{color:et(t.end),fontWeight:600},children:Ft(t.end)})]})]})}function w0({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:r,onApply:s,onEdit:o,onCancel:c,onDelete:l}){const h={fontSize:"0.8rem",padding:"0.4em 0.8em",height:32,minHeight:32,boxSizing:"border-box",lineHeight:1,display:"inline-flex",alignItems:"center",justifyContent:"center"};return d.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:"0.5rem",flexShrink:0},children:[t&&!e&&d.jsxs(d.Fragment,{children:[d.jsx(Ge,{actionName:"Save Draft Allocations",onClick:r,variant:"secondary",style:h,children:" Save"}),d.jsx(Ge,{actionName:"Apply Allocations",onClick:s,variant:"secondary",style:h,children:" Apply"})]}),!t&&n&&d.jsx(Ge,{actionName:"Edit Allocations",onClick:o,variant:"secondary",style:h,children:" Edit Allocations"}),e&&d.jsxs(d.Fragment,{children:[d.jsx(Ge,{actionName:"Apply Allocations",onClick:s,variant:"secondary",style:h,children:" Apply"}),d.jsx(Ge,{actionName:"Cancel Edit Allocations",onClick:c,variant:"secondary",style:h,children:""}),d.jsx(Ge,{actionName:"Open Delete Allocations Modal",onClick:l,variant:"secondary",style:{...h,color:me.error},children:""})]})]})}function y1(t){return t===0?me.zero:t>0?me.success:me.error}function UL({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:s,onAllocationChange:o,projectedAllTime:c}){const l=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,h=l?t.default_monthly_amount/100*r:0,f=l?h.toFixed(2):n,p=s&&!l,g=s?c:t.balance??0,_=t.balance??0,y=_<0,x=y?Math.abs(_):0,w=l?h:parseFloat(n)||0,S=y?Math.min(w,x):0,E=y?Math.max(0,w-x):0,T=y&&w>0&&E>0;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx("span",{style:{fontWeight:500},children:t.name})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),d.jsx("span",{style:{color:hn(e.start_balance)},children:zt(e.start_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),p?d.jsxs(d.Fragment,{children:[d.jsx("input",{type:"text",inputMode:"decimal",value:f?`$${f}`:"",onChange:A=>{const M=A.target.value.replace(/[^\d.]/g,"");o(M)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),y&&w>0&&d.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[d.jsxs("span",{style:{color:me.debt,display:"block"},children:[Jt(S),"  debt"]}),T&&d.jsxs("span",{style:{color:me.success,display:"block"},children:[Jt(E),"  balance"]})]})]}):d.jsx("span",{style:{color:Pa(e.allocated)},children:Qt(e.allocated)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),d.jsx("span",{style:{color:Al(e.spent)},children:Zn(e.spent)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),d.jsx("span",{style:{color:hn(e.end_balance),...s&&!l?Or:{}},children:zt(e.end_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:s?"Proj. All-Time":"All-Time"}),d.jsx("span",{style:{color:hn(g),...s&&!l?Or:{}},children:zt(g)})]})]}),(e.transfers!==0||e.adjustments!==0)&&d.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.transfers!==0&&d.jsxs("span",{style:{color:y1(e.transfers)},children:[Qt(e.transfers)," transfers"]}),e.adjustments!==0&&d.jsxs("span",{style:{color:y1(e.adjustments)},children:[Qt(e.adjustments)," adjust"]})]}),s&&l&&d.jsx("div",{style:{marginTop:"0.5rem"},children:d.jsxs("span",{style:{fontSize:"0.8rem"},children:[d.jsxs("span",{style:{opacity:.6},children:[Jt(r),"  "]}),d.jsxs("span",{style:{color:me.success},children:[t.default_monthly_amount,"%"]}),d.jsx("span",{style:{opacity:.6},children:" = "}),d.jsx("span",{style:{color:me.success},children:Jt(h)})]})})]})}function _1(t){return t===0?me.zero:t>0?me.success:me.error}function FL({category:t,balance:e,localAllocation:n,previousMonthIncome:r,isDraftMode:s,onAllocationChange:o,allTimeBalance:c,isEvenRow:l,gridTemplateColumns:h}){const f=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,p=f?t.default_monthly_amount/100*r:0,g=f?p.toFixed(2):n,_=t.balance??0,y=_<0,x=y?Math.abs(_):0,w=f?p:parseFloat(n)||0,S=y?Math.min(w,x):0,E=y?Math.max(0,w-x):0,T=y&&w>0&&E>0,A=l?"transparent":"var(--row-alt-bg)",M={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},L=e.allocated+e.spent+e.transfers+e.adjustments;return d.jsxs("div",{style:{gridColumn:"1 / -1",background:A,display:"grid",gridTemplateColumns:h},children:[d.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid var(--border-subtle)",minHeight:"2.4rem",boxSizing:"border-box"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:hn(e.start_balance)},children:zt(e.start_balance)}),s?d.jsx("div",{style:{...M,justifyContent:"center",flexDirection:"column",gap:"0.1rem"},children:f?d.jsxs("span",{style:{fontSize:"0.85rem"},children:[d.jsxs("span",{style:{color:me.success},children:[t.default_monthly_amount,"%"]}),d.jsx("span",{style:{opacity:.5},children:" = "}),d.jsx("span",{style:{color:me.success},children:Jt(p)})]}):d.jsxs(d.Fragment,{children:[d.jsx("input",{type:"text",inputMode:"decimal",value:g?`$${g}`:"",onChange:H=>{const O=H.target.value.replace(/[^\d.]/g,"");o(O)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),y&&w>0&&d.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[d.jsxs("span",{style:{color:me.debt},children:[Jt(S),"  debt"]}),T&&d.jsxs("span",{style:{color:me.success},children:[Jt(E),"  bal"]})]})]})}):(()=>{const H=e.start_balance<0,O=H?Math.abs(e.start_balance):0,j=H?Math.min(e.allocated,O):0,B=H?Math.max(0,e.allocated-O):0,V=H&&e.allocated>0;return d.jsxs("div",{style:{...M,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:Pa(e.allocated)},children:[d.jsxs("span",{children:["+",Jt(e.allocated)]}),V&&d.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsxs("span",{style:{color:me.debt},children:[Jt(j),"  debt"]}),B>0&&d.jsxs("span",{style:{color:me.success},children:[Jt(B),"  bal"]})]})]})})(),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:Al(e.spent)},children:Zn(e.spent)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:_1(e.transfers)},children:Qt(e.transfers)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:_1(e.adjustments)},children:Qt(e.adjustments)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:hn(L),...s&&!f?Or:{}},children:Qt(L)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",fontWeight:600,color:hn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid var(--border-muted)",...s&&!f?Or:{}},children:zt(e.end_balance)}),d.jsx("div",{style:{...M,justifyContent:"flex-end",color:hn(c),...s&&!f?Or:{}},children:zt(c)})]})}function b1(t){return t===0?me.zero:t>0?me.success:me.error}function v1({name:t,categories:e,groupTotals:n,getCategoryBalance:r,localAllocations:s,savedAllocations:o,previousMonthIncome:c,isDraftMode:l,allocationsFinalized:h,onAllocationChange:f,isMobile:p,isUngrouped:g,isFirstGroup:_=!1,getAllocationAmount:y,gridTemplateColumns:x}){const w={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:_?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},S=n.allocated+n.spent+n.transfers+n.adjustments,E=!h,T=e.reduce((A,[M,L])=>{const H=L.balance??0;let O;if(E){const j=l?y(M,L):o[M]??0;O=H+j}else if(O=H,l){const j=y(M,L),B=o[M]??0;O+=j-B}return A+Math.max(0,O)},0);return d.jsxs("div",{style:{display:"contents"},children:[!p&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...w,paddingLeft:"0.5rem",opacity:g?.7:1},children:[d.jsx("span",{children:t}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:hn(n.start)},children:an.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:l?"center":"flex-end",color:Pa(n.allocated)},children:an.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:Al(n.spent)},children:an.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:b1(n.transfers)},children:an.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:b1(n.adjustments)},children:an.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:hn(S)},children:an.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:hn(n.end),paddingRight:"1rem",borderRight:"2px solid var(--border-muted)"},children:an.showGroupTotals}),d.jsx("div",{style:{...w,justifyContent:"flex-end",color:hn(T)},children:an.showGroupTotals})]}),!l&&p&&d.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:_?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:g?.7:1},children:[t,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),an.showGroupTotals]}),e.map(([A,M],L)=>{const H=r(A);if(!H)return null;const O=M.balance??0;let j;if(E){const B=l?y(A,M):H.allocated??0,V=H.spent??0,$=H.transfers??0,k=H.adjustments??0;j=O+B+V+$+k}else if(j=O,l){const B=y(A,M),V=o[A]??0;j+=B-V}return p?d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(UL,{category:M,balance:H,localAllocation:s[A]||"",previousMonthIncome:c,isDraftMode:l,onAllocationChange:B=>f(A,B),projectedAllTime:j})},A):d.jsx(FL,{category:M,balance:H,localAllocation:s[A]||"",previousMonthIncome:c,isDraftMode:l,onAllocationChange:B=>f(A,B),allTimeBalance:j,isEvenRow:L%2===0,gridTemplateColumns:x},A)})]})}function VL(t,e){const{includeHidden:n=!1}={},r=Object.entries(t).filter(([,s])=>n||!s.is_hidden).reduce((s,[o,c])=>{const l=c.category_group_id||"ungrouped";return s[l]||(s[l]=[]),s[l].push([o,c]),s},{});return Object.keys(r).forEach(s=>{r[s].sort((o,c)=>o[1].sort_order-c[1].sort_order)}),r}function $L(t,e,n,r,s){const o={};t?.category_balances&&t.category_balances.forEach(l=>{o[l.category_id]=l});const c={};return Object.entries(e).forEach(([l,h])=>{const f=o[l],p=Ee(f?.start_balance??0);let g=0;n?g=Ee(s(l,h)):r&&f&&(g=Ee(f.allocated));const _=$T(l,t?.expenses||[]),y=GT(l,t?.transfers||[]),x=qT(l,t?.adjustments||[]);c[l]={category_id:l,start_balance:p,allocated:g,spent:_,transfers:y,adjustments:x,end_balance:Ee(p+g+_+y+x)}}),c}function GL(t,e){const n={};t?.account_balances&&t.account_balances.forEach(s=>{n[s.account_id]=s});const r={};return Object.entries(e).forEach(([s,o])=>{const c=n[s],l=Ee(c?.start_balance??o.balance);let h=0;t?.income&&(h=Ee(t.income.filter(y=>y.account_id===s).reduce((y,x)=>y+x.amount,0)));let f=0;t?.expenses&&(f=Ee(t.expenses.filter(y=>y.account_id===s).reduce((y,x)=>y+x.amount,0)));let p=0;if(t?.transfers){let y=0;t.transfers.forEach(x=>{x.to_account_id===s&&(y+=x.amount),x.from_account_id===s&&(y-=x.amount)}),p=Ee(y)}let g=0;t?.adjustments&&(g=Ee(t.adjustments.filter(y=>y.account_id===s).reduce((y,x)=>y+x.amount,0)));const _=Ee(h+f+p+g);r[s]={account_id:s,start_balance:l,income:h,expenses:f,transfers:p,adjustments:g,net_change:_,end_balance:Ee(l+_)}}),r}function qL(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0})}function HL(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,transfers:e.transfers+n.transfers,adjustments:e.adjustments+n.adjustments,end:e.end+n.end_balance}),{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0})}function zA(t,e){const n={},r={};return t?.account_balances&&t.account_balances.forEach(s=>{r[s.account_id]=s}),t?(Object.entries(e).forEach(([s,o])=>{const c=r[s],l=Ee(c?.start_balance??o.balance);let h=0,f=0;t?.income&&t.income.filter(T=>T.account_id===s).forEach(T=>{f+=T.amount,h+=T.amount});let p=0,g=0;t?.expenses&&t.expenses.filter(T=>T.account_id===s).forEach(T=>{g+=T.amount,T.cleared===!0&&(p+=T.amount)});let _=0,y=0;t?.transfers&&t.transfers.forEach(T=>{T.to_account_id===s&&(y+=T.amount,T.cleared===!0&&(_+=T.amount)),T.from_account_id===s&&(y-=T.amount,T.cleared===!0&&(_-=T.amount))});let x=0,w=0;t?.adjustments&&t.adjustments.filter(T=>T.account_id===s).forEach(T=>{w+=T.amount,T.cleared===!0&&(x+=T.amount)});const S=Ee(h+p+_+x),E=Ee(f+g+y+w);n[s]={account_id:s,cleared_balance:Ee(l+S),uncleared_balance:Ee(l+E)}}),n):(Object.entries(e).forEach(([s,o])=>{const c=Ee(o.balance??0);n[s]={account_id:s,cleared_balance:c,uncleared_balance:c}}),n)}function x1(t){return t===0?me.zero:t>0?me.success:me.error}function WL({isDraftMode:t,allocationsFinalized:e,balanceTotals:n,grandAllTime:r,onSave:s,onApply:o,onEdit:c,onCancel:l,onDelete:h}){const f={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},p=n.allocated+n.spent+n.transfers+n.adjustments;return d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...f,gap:"0.75rem"},children:["Grand Totals",!t&&d.jsx(w0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:e,onSave:s,onApply:o,onEdit:c,onCancel:l,onDelete:h})]}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:hn(n.start)},children:zt(n.start)}),d.jsxs("div",{style:{...f,justifyContent:t?"center":"flex-end",color:Pa(n.allocated),...t?Or:{}},children:["+",Jt(n.allocated)]}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:Al(n.spent)},children:Zn(n.spent)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:x1(n.transfers)},children:Qt(n.transfers)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:x1(n.adjustments)},children:Qt(n.adjustments)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:hn(p),...t?Or:{}},children:Qt(p)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:hn(n.end),paddingRight:"1rem",borderRight:"2px solid var(--border-muted)",...t?Or:{}},children:zt(n.end)}),d.jsx("div",{style:{...f,justifyContent:"flex-end",color:hn(r),...t?Or:{}},children:zt(r)})]})}function QL({allocationsFinalized:t,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:s,availableAfterApply:o,currentDraftTotal:c,onSave:l,onApply:h,onEdit:f,onCancel:p,onDelete:g}){return d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)"},children:[d.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),d.jsx(PA,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:e,currentMonthIncome:n,balanceTotals:r,draftChangeAmount:s,availableAfterApply:o,currentDraftTotal:c}),d.jsx(w0,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:t,onSave:l,onApply:h,onEdit:f,onCancel:p,onDelete:g})]})}const Cs={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem",borderBottom:"2px solid var(--border-medium)"};function KL({registerDownloadCategories:t}={}){const{selectedBudgetId:e,currentYear:n,currentMonthNumber:r}=Qe(),{categories:s,categoryGroups:o}=Dn(),{month:c}=rs(e,n,r),l=Fs(),[h,f]=R.useState(!1),{localAllocations:p,isEditingAppliedAllocations:g,availableNow:_,onBudgetTotal:y,currentDraftTotal:x,draftChangeAmount:w,availableAfterApply:S,previousMonthIncome:E,currentMonthIncome:T,allocationsFinalized:A,getAllocationAmount:M,handleAllocationChange:L,resetAllocationsToSaved:H,handleSaveAllocations:O,handleFinalizeAllocations:j,handleEditAllocations:B,setIsEditingAppliedAllocations:V}=qP(),$=[...o].sort((ee,re)=>ee.sort_order-re.sort_order),k=R.useMemo(()=>VL(s),[s]),N=!A||g,D=R.useMemo(()=>$L(c,s,N,A,M),[c,s,N,A,M]),X=R.useMemo(()=>{if(A)return D;const ee={};for(const[re,se]of Object.entries(s)){const ge=D[re];if(!ge)continue;const Ce=se.balance??0,ie=ge.allocated+ge.spent+ge.transfers+ge.adjustments;ee[re]={...ge,start_balance:Ce,end_balance:Ce+ie}}return ee},[D,s,A]),K=ee=>X[ee]??D[ee],q=R.useMemo(()=>{const ee={};for(const[re,se]of Object.entries(s)){if(se.is_hidden)continue;const ge=X[re]??D[re];ge&&(ee[re]=ge)}return HL(ee)},[X,D,s]),te=R.useMemo(()=>{const ee={};if(c?.category_balances)for(const re of c.category_balances)ee[re.category_id]=re.allocated;return ee},[c]),Q=R.useMemo(()=>{const ee=!A;return Object.entries(s).reduce((re,[se,ge])=>{if(ge.is_hidden)return re;const Ce=ge.balance??0;let ie;if(ee){const le=N?M(se,ge):te[se]??0,Me=D[se],Be=Me?.spent??0,Ze=Me?.transfers??0,st=Me?.adjustments??0;ie=Ce+le+Be+Ze+st}else if(ie=Ce,N){const le=M(se,ge),Me=te[se]??0;ie+=le-Me}return re+ie},0)},[s,N,A,M,te,D]),ae=R.useMemo(()=>Object.values(s).reduce((ee,re)=>re.is_hidden?ee:ee+(re.balance??0),0),[s]);R.useEffect(()=>{if(!e||N)return;const ee=Math.abs(Q-ae);ee>.02&&(console.error("[MonthCategories] Month View vs Settings Mismatch:",{grandAllTime:Q,settingsPageAllocated:ae,difference:ee}),Hn.add({type:"error",message:`Balance display mismatch: Month view "ALL-TIME" (${Jt(Q)})  Settings "Allocated" (${Jt(ae)}). Difference: ${Jt(ee)}.`,autoDismissMs:1e4}))},[Q,ae,N,e]);const P={onSave:O,onApply:j,onEdit:B,onCancel:H,onDelete:()=>f(!0)},G=R.useRef(()=>{});return R.useLayoutEffect(()=>(G.current=()=>{const ee=BL({year:n,monthNumber:r,categoryGroups:$,categoriesByGroup:k,liveCategoryBalances:D,getAllocationAmount:M,savedAllocations:te,isDraftMode:N,balanceTotals:q,grandAllTime:Q}),se=`categories-${n}-${(ge=>String(ge).padStart(2,"0"))(r)}.md`;PL(ee,se)},()=>{G.current=()=>{}}),[n,r,$,k,s,D,M,te,E,N,q,Q]),R.useEffect(()=>{if(t)return t(()=>G.current()),()=>t(null)},[t]),d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:l?"1fr":N?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",display:l?"block":"grid",gridTemplateColumns:l?void 0:"subgrid"},children:[N&&d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexDirection:l?"column":"row",flexWrap:"wrap",alignItems:l?"stretch":"center",gap:l?"0.5rem":"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:l?"0.5rem":"0.25rem"},children:[d.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:l?void 0:1,alignItems:"center"},children:d.jsx(PA,{isDraftMode:N,isEditingAppliedAllocations:g,onBudgetTotal:y,availableNow:_,currentMonthIncome:T,balanceTotals:q,draftChangeAmount:w,availableAfterApply:S,currentDraftTotal:x})}),d.jsx(w0,{isDraftMode:N,isEditingAppliedAllocations:g,allocationsFinalized:A,...P})]}),!l&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Cs,children:"Category"}),d.jsx("div",{style:{...Cs,textAlign:"right"},children:"Start"}),d.jsx("div",{style:{...Cs,textAlign:N?"center":"right"},children:"Allocated"}),d.jsx("div",{style:{...Cs,textAlign:"right"},children:"Spent"}),d.jsx("div",{style:{...Cs,textAlign:"right"},children:"Transfers"}),d.jsx("div",{style:{...Cs,textAlign:"right"},children:"Adjust"}),d.jsx("div",{style:{...Cs,textAlign:"right"},children:"Net Change"}),d.jsx("div",{style:{...Cs,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid var(--border-muted)"},children:"End"}),d.jsx("div",{style:{...Cs,textAlign:"right"},children:"All-Time"})]}),!l&&d.jsx(WL,{isDraftMode:N,allocationsFinalized:A,balanceTotals:q,grandAllTime:Q,...P}),!N&&l&&d.jsx(QL,{allocationsFinalized:A,availableNow:_,currentMonthIncome:T,balanceTotals:q,draftChangeAmount:w,availableAfterApply:S,currentDraftTotal:x,...P})]}),Object.keys(s).length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet. ",d.jsx(Rn,{to:"/budget/settings/categories",style:{opacity:1},children:"Create categories "})]}),$.map((ee,re)=>{const se=k[ee.id]||[];if(se.length===0)return null;const ge=se.reduce((Ce,[ie])=>{const le=K(ie);return le?{start:Ce.start+le.start_balance,allocated:Ce.allocated+le.allocated,spent:Ce.spent+le.spent,transfers:Ce.transfers+le.transfers,adjustments:Ce.adjustments+le.adjustments,end:Ce.end+le.end_balance}:Ce},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0});return d.jsx(v1,{name:ee.name,categories:se,groupTotals:ge,getCategoryBalance:K,localAllocations:p,savedAllocations:te,previousMonthIncome:E,isDraftMode:N,allocationsFinalized:A,onAllocationChange:L,isMobile:l,isFirstGroup:re===0,getAllocationAmount:M,gridTemplateColumns:N?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},ee.id)}),k[Xt]?.length>0&&(()=>{const ee=k[Xt],re=ee.reduce((ge,[Ce])=>{const ie=K(Ce);return ie?{start:ge.start+ie.start_balance,allocated:ge.allocated+ie.allocated,spent:ge.spent+ie.spent,transfers:ge.transfers+ie.transfers,adjustments:ge.adjustments+ie.adjustments,end:ge.end+ie.end_balance}:ge},{start:0,allocated:0,spent:0,transfers:0,adjustments:0,end:0}),se=$.length===0;return d.jsx(v1,{name:"Uncategorized",categories:ee,groupTotals:re,getCategoryBalance:K,localAllocations:p,savedAllocations:te,previousMonthIncome:E,isDraftMode:N,allocationsFinalized:A,onAllocationChange:L,isMobile:l,isUngrouped:!0,isFirstGroup:se,getAllocationAmount:M,gridTemplateColumns:N?"2fr 1fr 200px 1fr 1fr 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 120px"},Xt)})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),d.jsx(zL,{isOpen:h,onClose:()=>f(!1),onDeleted:()=>V(!1)})]})}function YL(t){return t===0?me.zero:t>0?me.success:me.error}function XL(t){return t===0?me.zero:t<0?me.error:me.success}function dy(t){return t===0?me.zero:t>0?me.success:me.error}const ZL="5rem",JL=`2fr repeat(8, minmax(${ZL}, 1fr))`,eU={fontVariantNumeric:"tabular-nums",whiteSpace:"nowrap",paddingLeft:"0.5rem",paddingRight:"0.5rem"};function tU({account:t,balance:e,clearedBalance:n,isEvenRow:r,hasUnclearedDetail:s,isExpanded:o,onToggleExpand:c}){const l=r?"transparent":"var(--row-alt-bg)",h={padding:"0.5rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},f={...h,...eU,justifyContent:"flex-end"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:l,display:"grid",gridTemplateColumns:JL},children:[d.jsx("div",{style:{...h,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid var(--border-subtle)"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),d.jsx("div",{style:{...f,color:et(e.start_balance)},children:zt(e.start_balance)}),d.jsxs("div",{style:{...f,color:YL(e.income)},children:["+",Jt(e.income)]}),d.jsx("div",{style:{...f,color:XL(e.expenses)},children:Zn(e.expenses)}),d.jsx("div",{style:{...f,color:dy(e.transfers)},children:Qt(e.transfers)}),d.jsx("div",{style:{...f,color:dy(e.adjustments)},children:Qt(e.adjustments)}),d.jsx("div",{style:{...f,color:dy(e.net_change)},children:Qt(e.net_change)}),d.jsx("div",{style:{...f,fontWeight:600,color:et(e.end_balance)},children:zt(e.end_balance)}),d.jsx("div",{style:{...f,gap:"0.25rem",color:n?et(n.uncleared_balance):void 0,fontWeight:600},children:n?d.jsxs(d.Fragment,{children:[d.jsx("span",{children:zt(n.uncleared_balance)}),s&&d.jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),c()},title:o?"Hide cleared/uncleared breakdown":"Show cleared/uncleared breakdown",style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.5,padding:"0.1rem",borderRadius:"2px",transition:"transform 0.15s",transform:o?"rotate(180deg)":"rotate(0deg)"},children:""})]}):d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})})]})}function nU(t){return t===0?me.zero:t>0?me.success:me.error}function rU(t){return t===0?me.zero:t<0?me.error:me.success}function Gu(t){return t===0?me.zero:t>0?me.success:me.error}const iU={fontVariantNumeric:"tabular-nums",whiteSpace:"nowrap",paddingLeft:"0.5rem",paddingRight:"0.5rem"};function w1({name:t,accounts:e,groupTotals:n,accountBalances:r,accountClearedBalances:s,isMobile:o,isUngrouped:c,isFirstGroup:l=!1}){const[h,f]=R.useState(null),p={padding:"0.6rem 0.5rem",marginTop:l?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},g={...iU,justifyContent:"flex-end"};return d.jsxs("div",{style:{display:"contents"},children:[!o&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...p,opacity:c?.7:1},children:[d.jsx("span",{children:t}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),d.jsx("div",{style:{...p,...g,color:et(n.start)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g,color:nU(n.income)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g,color:rU(n.expenses)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g,color:Gu(n.transfers)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g,color:Gu(n.adjustments)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g,color:Gu(n.netChange)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g,color:et(n.end)},children:an.showGroupTotals}),d.jsx("div",{style:{...p,...g},children:an.showGroupTotals})]}),o&&d.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:l?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:c?.7:1},children:[t,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),an.showGroupTotals]}),e.flatMap(([_,y],x)=>{const w=r[_];if(!w)return[];const S=s?.[_],E=!!S&&Math.abs(S.uncleared_balance-S.cleared_balance)>=.01,T=h===_;return o?[d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(aU,{account:y,balance:w,clearedBalance:S,hasUnclearedDetail:E})},_)]:[d.jsx(tU,{account:y,balance:w,clearedBalance:S,isEvenRow:x%2===0,hasUnclearedDetail:E,isExpanded:T,onToggleExpand:()=>f(T?null:_)},_),T&&E&&S&&d.jsx(sU,{clearedBalance:S},`${_}-exp`)].filter(Boolean)})]})}function sU({clearedBalance:t}){const e=t.uncleared_balance-t.cleared_balance,n="auto auto auto auto auto",r={fontSize:"0.7rem",fontWeight:600,opacity:.7,textTransform:"uppercase",letterSpacing:"0.03em",padding:"0.25rem 0.5rem",textAlign:"right"},s={fontSize:"0.85rem",opacity:.5,padding:"0.25rem 0.35rem",textAlign:"center"},o={fontSize:"0.85rem",fontVariantNumeric:"tabular-nums",padding:"0.35rem 0.5rem",textAlign:"right"};return d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem 1rem 0.75rem 2.5rem",background:"color-mix(in srgb, currentColor 4%, transparent)",borderBottom:"1px solid var(--border-subtle)"},children:d.jsxs("div",{style:{display:"grid",gridTemplateColumns:n,gap:0,alignContent:"start",width:"fit-content",border:"1px solid var(--border-subtle)",borderRadius:"6px",overflow:"hidden"},children:[d.jsx("div",{style:{...r,borderBottom:"1px solid var(--border-subtle)"},children:"Total"}),d.jsx("div",{style:{...s,borderBottom:"1px solid var(--border-subtle)"},children:"="}),d.jsx("div",{style:{...r,borderBottom:"1px solid var(--border-subtle)"},children:"Cleared"}),d.jsx("div",{style:{...s,borderBottom:"1px solid var(--border-subtle)"},children:"+"}),d.jsx("div",{style:{...r,borderBottom:"1px solid var(--border-subtle)"},children:"Uncleared"}),d.jsx("div",{style:{...o,borderTop:"1px solid var(--border-subtle)",color:et(t.uncleared_balance)},children:zt(t.uncleared_balance)}),d.jsx("div",{style:{...s,borderTop:"1px solid var(--border-subtle)"},children:"="}),d.jsx("div",{style:{...o,borderTop:"1px solid var(--border-subtle)",color:et(t.cleared_balance)},children:zt(t.cleared_balance)}),d.jsx("div",{style:{...s,borderTop:"1px solid var(--border-subtle)"},children:"+"}),d.jsx("div",{style:{...o,borderTop:"1px solid var(--border-subtle)",color:Gu(e)},children:zt(e)})]})})}function aU({account:t,balance:e,clearedBalance:n,hasUnclearedDetail:r}){const s=n?n.uncleared_balance-n.cleared_balance:0;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx("span",{style:{fontWeight:500},children:t.nickname})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),d.jsx("span",{children:zt(e.start_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),d.jsx("span",{style:{color:et(e.net_change)},children:Qt(e.net_change)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),d.jsx("span",{style:{color:et(e.end_balance)},children:zt(e.end_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Total"}),n?d.jsx("span",{style:{color:et(n.uncleared_balance),fontWeight:600},children:zt(n.uncleared_balance)}):d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]})]}),r&&n&&d.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.85},children:[d.jsxs("span",{children:["Cleared: ",d.jsx("span",{style:{color:et(n.cleared_balance)},children:zt(n.cleared_balance)})]}),d.jsxs("span",{children:["Uncleared: ",d.jsx("span",{style:{color:Gu(s)},children:zt(s)})]})]}),(e.income!==0||e.expenses!==0||e.transfers!==0||e.adjustments!==0)&&d.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&d.jsxs("span",{children:[Qt(e.income)," income"]}),e.expenses!==0&&d.jsxs("span",{children:[Zn(e.expenses)," expenses"]}),e.transfers!==0&&d.jsxs("span",{children:[Qt(e.transfers)," transfers"]}),e.adjustments!==0&&d.jsxs("span",{children:[Qt(e.adjustments)," adjust"]})]})]})}const oU="5rem",Es={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",padding:"0.5rem 0.5rem",borderBottom:"2px solid var(--border-medium)"},Ts={fontVariantNumeric:"tabular-nums",whiteSpace:"nowrap",paddingLeft:"0.5rem",paddingRight:"0.5rem"};function cU(t){return t===0?me.zero:t>0?me.success:me.error}function lU(t){return t===0?me.zero:t<0?me.error:me.success}function hy(t){return t===0?me.zero:t>0?me.success:me.error}function uU(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Qe(),{accounts:r,accountGroups:s}=Dn(),{month:o}=rs(t,e,n),c=Fs(),l=R.useMemo(()=>Object.entries(s).map(([E,T])=>({id:E,...T})).sort((E,T)=>E.sort_order-T.sort_order),[s]),h=R.useMemo(()=>{const E={};return Object.entries(r).filter(([,T])=>!T.is_hidden).forEach(([T,A])=>{const M=A.account_group_id||Vt;E[M]||(E[M]=[]),E[M].push([T,A])}),Object.keys(E).forEach(T=>{E[T].sort((A,M)=>A[1].sort_order-M[1].sort_order)}),E},[r]),f=R.useMemo(()=>GL(o,r),[o,r]),p=R.useMemo(()=>zA(o,r),[o,r]),g=R.useMemo(()=>qL(f),[f]),_=g.income+g.expenses,y=R.useMemo(()=>Object.keys(p).length===0?null:Object.values(p).reduce((E,T)=>E+T.uncleared_balance,0),[p]),w={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)",fontWeight:600},S={...Ts,justifyContent:"flex-end"};return d.jsx(d.Fragment,{children:d.jsxs("div",{style:{display:"grid",gridTemplateColumns:c?"1fr":`2fr repeat(8, minmax(${oU}, 1fr))`},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"var(--sticky-header-bg)",display:c?"block":"grid",gridTemplateColumns:c?void 0:"subgrid"},children:[!c&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{...Es,paddingLeft:"0.5rem",paddingRight:"0.5rem"},children:"Account"}),d.jsx("div",{style:{...Es,...Ts,textAlign:"right"},children:"Start"}),d.jsx("div",{style:{...Es,...Ts,textAlign:"right"},children:"Income"}),d.jsx("div",{style:{...Es,...Ts,textAlign:"right"},children:"Expenses"}),d.jsx("div",{style:{...Es,...Ts,textAlign:"right"},children:"Transfers"}),d.jsx("div",{style:{...Es,...Ts,textAlign:"right"},children:"Adjust"}),d.jsx("div",{style:{...Es,...Ts,textAlign:"right"},children:"Net Change"}),d.jsx("div",{style:{...Es,...Ts,textAlign:"right"},children:"End"}),d.jsx("div",{style:{...Es,...Ts,textAlign:"right"},children:"Total"})]}),c?d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid var(--border-strong)",borderBottom:"2px solid var(--border-strong)"},children:[d.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),d.jsx(LL,{totals:g})]}):d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{...w},children:"Grand Totals"}),d.jsx("div",{style:{...w,...S,color:et(g.start)},children:zt(g.start)}),d.jsxs("div",{style:{...w,...S,color:cU(g.income)},children:["+",Jt(g.income)]}),d.jsx("div",{style:{...w,...S,color:lU(g.expenses)},children:Zn(g.expenses)}),d.jsx("div",{style:{...w,...S,color:hy(g.transfers)},children:Qt(g.transfers)}),d.jsx("div",{style:{...w,...S,color:hy(g.adjustments)},children:Qt(g.adjustments)}),d.jsx("div",{style:{...w,...S,color:hy(_)},children:Qt(_)}),d.jsx("div",{style:{...w,...S,color:et(g.end)},children:zt(g.end)}),d.jsx("div",{style:{...w,...S,color:y!==null?et(y):void 0},children:y!==null?zt(y):d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})})]})]}),Object.keys(r).length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",d.jsx(Rn,{to:"/budget/settings/accounts",style:{opacity:1},children:"Add accounts "})]}),l.map((E,T)=>{const A=h[E.id]||[];if(A.length===0)return null;const M=A.reduce((L,[H])=>{const O=f[H];return O?{start:L.start+O.start_balance,income:L.income+O.income,expenses:L.expenses+O.expenses,transfers:L.transfers+O.transfers,adjustments:L.adjustments+O.adjustments,netChange:L.netChange+O.net_change,end:L.end+O.end_balance}:L},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0});return d.jsx(w1,{name:E.name,accounts:A,groupTotals:M,accountBalances:f,accountClearedBalances:p,isMobile:c,isFirstGroup:T===0},E.id)}),h[Vt]?.length>0&&(()=>{const E=h[Vt],T=E.reduce((M,[L])=>{const H=f[L];return H?{start:M.start+H.start_balance,income:M.income+H.income,expenses:M.expenses+H.expenses,transfers:M.transfers+H.transfers,adjustments:M.adjustments+H.adjustments,netChange:M.netChange+H.net_change,end:M.end+H.end_balance}:M},{start:0,income:0,expenses:0,transfers:0,adjustments:0,netChange:0,end:0}),A=l.length===0;return d.jsx(w1,{name:"Ungrouped",accounts:E,groupTotals:T,accountBalances:f,accountClearedBalances:p,isMobile:c,isUngrouped:!0,isFirstGroup:A},Vt)})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})})}const dU=["income","categories","accounts","spend","transfers","adjustments"];function fy(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,r=t.tab&&dU.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:r}}function S1(){const t=u2(),e=ud(),[n,r]=Y1(),{addLoadingHold:s,removeLoadingHold:o}=kn(),{selectedBudgetId:c,setSelectedBudgetId:l,currentYear:h,currentMonthNumber:f,lastActiveTab:p,lastBalancesTab:g,lastTransactionsTab:_,setCurrentYear:y,setCurrentMonthNumber:x,setLastActiveTab:w,setPageTitle:S,goToPreviousMonth:E,goToNextMonth:T,hasPendingInvites:A,needsFirstBudget:M,initialDataLoadComplete:L,initialBalanceCalculationComplete:H}=Qe(),{budget:O,isLoading:j}=Dn(),B=!j&&!!O;g0(B&&!!c&&H,{alwaysRecalculate:!0});const[V,$]=R.useState(!1);R.useEffect(()=>(!B||!L?s("budget-data","Loading budget data..."):o("budget-data"),()=>o("budget-data")),[B,L,s,o]);const k=R.useRef(!1),N=R.useRef(null),D=n.get("error"),[X,K]=R.useState(D);R.useEffect(()=>{D&&(n.delete("error"),r(n,{replace:!0}))},[D,n,r]);const q=R.useMemo(()=>{const{tab:se}=fy(t);return se??p},[t,p]),te=se=>{e(`/budget/${h}/${f}/${se}`),w(se)};R.useEffect(()=>{const{tab:se}=fy(t);se!=null&&w(q)},[q,t,w]),R.useEffect(()=>{if(k.current)return;const{year:se,month:ge}=fy(t);se&&y(se),ge&&x(ge),k.current=!0},[t,y,x]),R.useEffect(()=>{if(!k.current)return;const se=`/budget/${h}/${f}/${q}`,ge=`/budget/${t.year}/${t.month}/${t.tab}`;se!==ge&&e(se,{replace:!0})},[h,f,q,e,t]);const{month:Q,error:ae,isLoading:P}=rs(B&&L?c:null,h,f);R.useEffect(()=>{if(!ae||V)return;const se=ae.message||"";if(se.includes("Budget")&&se.includes("does not exist")){queueMicrotask(()=>{l(null),e("/budget/my-budgets?context=budget-not-found",{replace:!0})});return}if(r0.is(ae)&&ae.shouldRedirectToValidMonth){queueMicrotask(()=>{const Ce=O?.month_map;if(!Ce||Object.keys(Ce).length===0){K(`Cannot load month ${h}/${f} - budget has no months.`);return}const ie=Object.keys(Ce).sort(),le=ie[ie.length-1],Me=parseInt(le.slice(0,4),10),Be=parseInt(le.slice(4,6),10);s("month-redirect","Redirecting to available month..."),$(!0),K(`Month ${h}/${f} is outside budget range. Redirected to ${Me}/${Be}.`),y(Me),x(Be)});return}(se.includes("cannot be created")||se.includes("months in the past")||se.includes("months in the future")||se.includes("does not exist in budget")||se.includes("not immediately after")||se.includes("not immediately before")||se.includes("walk forward one month")||se.includes("walk back one month"))&&queueMicrotask(()=>{const Ce=O?.month_map;if(!Ce||Object.keys(Ce).length===0){K(`Cannot load month ${h}/${f} - budget has no months.`);return}const ie=Object.keys(Ce).sort(),le=ie[ie.length-1],Me=parseInt(le.slice(0,4),10),Be=parseInt(le.slice(4,6),10);s("month-redirect","Redirecting to available month..."),$(!0),K(`Month ${h}/${f} is outside budget range. Redirected to ${Me}/${Be}.`),y(Me),x(Be)})},[ae,V,h,f,O,y,x,s,l,e]),R.useEffect(()=>{V&&!P&&(Q||ae)&&queueMicrotask(()=>{$(!1),o("month-redirect")})},[V,Q,ae,P,o]),R.useLayoutEffect(()=>{S(O?.name||"Budget")},[O?.name,S]);const{setCurrentViewingDocument:G}=Qe();if(R.useEffect(()=>(O&&h&&f&&G({type:"month",year:h,month:f}),()=>{G({type:null})}),[O,h,f,G]),R.useEffect(()=>{if(B&&!V){if(!O&&!c){e("/budget/my-budgets",{replace:!0});return}if(!O&&A){e("/budget/my-budgets",{replace:!0});return}if(M){e("/budget/my-budgets",{replace:!0});return}}},[B,V,O,c,A,M,e]),s3(L?c:null,h,f),c3({budgetId:c,viewingYear:h,viewingMonth:f,initialDataLoadComplete:L,enabled:!!c&&L}),!B||!L||V||!O)return null;function ee(){K(null),E()}function re(){K(null),T()}return d.jsxs(d.Fragment,{children:[X&&d.jsx(h0,{message:X,onDismiss:()=>K(null)}),d.jsx(vL,{onPreviousMonth:ee,onNextMonth:re,onDownloadCategories:q==="categories"?()=>N.current?.():void 0}),d.jsx(hL,{activeTab:q,setActiveTab:te,lastBalancesTab:g,lastTransactionsTab:_,allocationsFinalized:Q?.are_allocations_finalized}),q==="income"&&d.jsx(EL,{},`${h}-${f}`),q==="categories"&&d.jsx(KL,{registerDownloadCategories:se=>{N.current=se}},`${h}-${f}`),q==="accounts"&&d.jsx(uU,{},`${h}-${f}`),q==="spend"&&d.jsx(AL,{},`${h}-${f}`),q==="transfers"&&d.jsx(DL,{},`${h}-${f}`),q==="adjustments"&&d.jsx(OL,{},`${h}-${f}`)]})}function hU(){const{setPageTitle:t}=Qe();return R.useLayoutEffect(()=>{t("Analytics")},[t]),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[d.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),d.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),d.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),d.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),d.jsx(Rn,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:me.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function fU({message:t,onDismiss:e}){return d.jsxs("div",{style:{background:"var(--color-error-bg)",border:"1px solid var(--color-error-border)",color:"var(--color-error)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:t}),d.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"var(--color-error)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function mU({message:t,onDismiss:e}){return d.jsxs("div",{style:{background:"var(--color-success-bg)",border:"1px solid var(--color-success-border)",color:"var(--color-success)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:t}),d.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"var(--color-success)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]})}function gU({budgetIdInput:t,setBudgetIdInput:e,isCheckingManual:n,manualInvite:r,isAccepting:s,onCheckInvite:o,onAcceptInvite:c,onCancel:l}){return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Join Budget by ID"]}),d.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),r?d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-success) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-success) 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[d.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[d.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:r.budgetName}),r.ownerEmail&&d.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",r.ownerEmail]})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[d.jsx("button",{onClick:c,disabled:s===r.budgetId,style:{background:"var(--color-success)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:s===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:s===r.budgetId?.7:1},children:s===r.budgetId?"Accepting...":"Accept Invitation"}),d.jsx("button",{onClick:l,disabled:s===r.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:s===r.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:s===r.budgetId?.7:.8},children:"Cancel"})]})]}):d.jsxs("form",{onSubmit:o,style:{display:"flex",gap:"0.75rem"},children:[d.jsx("input",{type:"text",value:t,onChange:h=>e(h.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),d.jsx("button",{type:"submit",disabled:n||!t.trim(),style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:n||!t.trim()?"not-allowed":"pointer",fontWeight:500,opacity:n||!t.trim()?.7:1,whiteSpace:"nowrap"},children:n?"Checking...":"Check Invite"})]})]})}function pU({currentUserId:t}){return d.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[d.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),d.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:t})]})}function yU(){const{addLoadingHold:t,removeLoadingHold:e,isLoading:n}=kn(),{selectedBudgetId:r,currentUserId:s,accessibleBudgets:o,isLoadingAccessibleBudgets:c,loadAccessibleBudgets:l,switchToBudget:h,checkBudgetInvite:f,isInitialized:p,setPageTitle:g,needsFirstBudget:_}=Qe(),{requireUserEmail:y}=Us(),x=R.useRef(!1),[w,S]=Y1(),E=w.get("context");R.useEffect(()=>{E&&(w.delete("context"),S(w,{replace:!0}))},[E,w,S]);const T=E==="budget-not-found",A=_&&o.length===0;R.useLayoutEffect(()=>{g("My Budgets")},[g]),R.useEffect(()=>{p&&!x.current&&(x.current=!0,l({force:!0}))},[p,l]);const{budget:M,isLoading:L}=Dn(),{renameBudget:H}=VP(),{acceptInvite:O}=pz(),{createBudget:j}=gz(),[B,V]=R.useState(null),[$,k]=R.useState(null),[N,D]=R.useState(null),[X,K]=R.useState(null),[q,te]=R.useState(null),[Q,ae]=R.useState(""),[P,G]=R.useState(!1),[ee,re]=R.useState(""),[se,ge]=R.useState(!1),[Ce,ie]=R.useState(null),[le,Me]=R.useState(""),[Be,Ze]=R.useState(!1);async function st(Ae){if(Ae!==M?.id){V(Ae),D(null),K(null);try{await h(Ae),K("Switched to budget successfully!"),await l({force:!0})}catch(Ie){D(Ie instanceof Error?Ie.message:"Failed to switch budget")}finally{V(null)}}}async function U(Ae){if(s){k(Ae),D(null),K(null);try{await O.mutateAsync({budgetId:Ae,userId:s}),K("Invitation accepted! You now have access to this budget."),await l({force:!0})}catch(Ie){D(Ie instanceof Error?Ie.message:"Failed to accept invitation")}finally{k(null)}}}async function fe(Ae){if(Ae.preventDefault(),!!ee.trim()){ge(!0),D(null),ie(null);try{const Ie=await f(ee.trim());Ie?ie(Ie):D("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Ie){D(Ie instanceof Error?Ie.message:"Failed to check invitation")}finally{ge(!1)}}}async function ue(){if(!(!Ce||!s)){Ce.budgetName,k(Ce.budgetId),D(null);try{await O.mutateAsync({budgetId:Ce.budgetId,userId:s}),K(`Successfully joined "${Ce.budgetName}"!`),ie(null),re(""),await l({force:!0})}catch(Ae){D(Ae instanceof Error?Ae.message:"Failed to accept invitation")}finally{k(null)}}}function J(Ae,Ie){ae(Ie),te(Ae)}async function Z(Ae){if(Ae.preventDefault(),!(!Q.trim()||!q||!r)){Q.trim(),G(!0),D(null),K(null);try{await H.mutateAsync({budgetId:r,newName:Q.trim()}),K("Budget renamed successfully!"),te(null),await l({force:!0})}catch(Ie){D(Ie instanceof Error?Ie.message:"Failed to rename budget")}finally{G(!1)}}}async function oe(Ae){if(Ae.preventDefault(),!!s){le.trim(),Ze(!0),D(null),K(null);try{const Ie=await j.mutateAsync({name:le.trim()||"My Budget",userId:s,userEmail:y()});await h(Ie.budgetId),K("Budget created successfully!"),Me(""),await l({force:!0})}catch(Ie){D(Ie instanceof Error?Ie.message:"Failed to create budget")}finally{Ze(!1)}}}const Se=o.filter(Ae=>!Ae.isPending),xe=o.filter(Ae=>Ae.isPending);if(R.useEffect(()=>(L||!p||c?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[L,p,c,t,e]),n)return null;let de="My Budgets",Ne="Switch between budgets, accept invitations, or create a new budget.";return T?(de="Budget Not Found",Ne="Your selected budget could not be found. It may have been deleted. Select another budget or create a new one."):A&&(de="Welcome!",Ne="Get started by creating your first budget or accepting an invitation."),d.jsxs("div",{children:[d.jsx("h1",{children:de}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:Ne}),N&&d.jsx(fU,{message:N,onDismiss:()=>D(null)}),X&&d.jsx(mU,{message:X,onDismiss:()=>K(null)}),xe.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-warning) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-warning) 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Pending Invitations (",xe.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:xe.map(Ae=>d.jsx(u1,{budget:Ae,isCurrent:!1,isAccepting:$===Ae.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>U(Ae.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},Ae.id))})]}),Se.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Your Budgets (",Se.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:Se.map(Ae=>d.jsx(u1,{budget:Ae,isCurrent:Ae.id===r,isAccepting:!1,isSwitching:B===Ae.id,isEditing:q===Ae.id,editName:q===Ae.id?Q:"",isRenaming:P,onAccept:()=>{},onSwitch:()=>st(Ae.id),onStartEdit:()=>J(Ae.id,Ae.name),onCancelEdit:()=>{te(null),ae("")},onEditNameChange:ae,onSaveEdit:Z},Ae.id))})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-primary) 8%, transparent)",border:"1px solid color-mix(in srgb, var(--color-primary) 25%, transparent)",padding:"1.5rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Create New Budget"]}),d.jsxs("form",{onSubmit:oe,children:[d.jsxs("div",{style:{marginBottom:"1rem"},children:[d.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),d.jsx("input",{type:"text",value:le,onChange:Ae=>Me(Ae.target.value),placeholder:"My Budget",style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}}),d.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),d.jsx("button",{type:"submit",disabled:Be,style:{background:me.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"6px",cursor:Be?"not-allowed":"pointer",fontWeight:500,opacity:Be?.7:1,fontSize:"0.9rem"},children:Be?"Creating...":"Create Budget"})]})]}),d.jsx(gU,{budgetIdInput:ee,setBudgetIdInput:re,isCheckingManual:se,manualInvite:Ce,isAccepting:$,onCheckInvite:fe,onAcceptInvite:ue,onCancel:()=>{ie(null),re("")}}),s&&d.jsx(pU,{currentUserId:s})]})}const _U=["general","accounts","categories","users"];function bU(){const{addLoadingHold:t,removeLoadingHold:e}=kn(),{lastSettingsTab:n,setLastSettingsTab:r,setPageTitle:s,selectedBudgetId:o,setCurrentViewingDocument:c}=Qe();R.useLayoutEffect(()=>{s("Budget Settings")},[s]),R.useEffect(()=>(o&&c({type:"budget"}),()=>{c({type:null})}),[o,c]);const{isOwner:l,isLoading:h,isFetching:f}=Dn();R.useEffect(()=>(h||f?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[h,f,t,e]);const p=nr(),g=p.pathname==="/budget/settings",_=R.useMemo(()=>{const E=p.pathname;return E.includes("/settings/general")?"general":E.includes("/settings/accounts")?"accounts":E.includes("/settings/categories")?"categories":E.includes("/settings/users")?"users":"general"},[p.pathname]),y=_==="users";R.useEffect(()=>{g||r(_)},[_,g,r]);function x(){return!_U.includes(n)||n==="users"&&!l?"general":n}const w=R.useMemo(()=>[{id:"general",label:"General",icon:""},{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!l}],[l]);return h||f?null:!l&&y?d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(Rn,{to:"/budget/settings/general",children:"Go to General "})})]}):d.jsxs("div",{children:[d.jsx(em,{mode:"link",linkPrefix:"/budget/settings",tabs:w,activeTab:g?x():_}),g?d.jsx(nm,{to:`/budget/settings/${x()}`,replace:!0}):d.jsx(kA,{children:d.jsx(rm,{})})]})}const my=1,gy=12;function vU(){const{selectedBudgetId:t}=Qe(),{budget:e,isLoading:n}=Dn(),r=e?.percentage_income_months_back??1,[s,o]=R.useState(r),[c,l]=R.useState(!1),[h,f]=R.useState(null);R.useEffect(()=>{o(e?.percentage_income_months_back??1)},[e?.percentage_income_months_back]);const p=Math.min(gy,Math.max(my,Math.round(Number(s))||1));async function g(){if(!t)return;const y=p;f(null),l(!0);try{await Zo({budgetId:t,updates:{percentage_income_months_back:y},description:"update percentage income months back"}),Pe.setQueryData(Te.budget(t),x=>x&&{...x,budget:{...x.budget,percentage_income_months_back:y}}),await i3(t,y,Pe),o(y),f(null)}catch(x){const w=x instanceof Error?x.message:"Failed to save";console.error("[Settings/General] Failed to save percentage income months back:",x),Hn.add({type:"error",message:"Failed to save setting. See console for details.",autoDismissMs:0}),f(w)}finally{l(!1)}}const _=p!==r;return n||!e?d.jsx("div",{style:{padding:"1rem"},children:d.jsx("p",{style:{opacity:.7},children:"Loading..."})}):d.jsxs("div",{style:{padding:"1rem",maxWidth:"32rem"},children:[d.jsx("h3",{style:{marginTop:0,marginBottom:"1rem"},children:"Budget behavior"}),d.jsxs("div",{style:{marginBottom:"1.5rem"},children:[d.jsx("label",{htmlFor:"percentage-income-months-back",style:{display:"block",marginBottom:"0.35rem",fontWeight:500},children:"Income reference for % allocations (months back)"}),d.jsx("p",{style:{fontSize:"0.85rem",opacity:.7,margin:"0 0 0.5rem 0"},children:"Percentage-based category allocations use income from this many months ago. Use 1 for previous month or 2 if you budget for the month after next."}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[d.jsx("input",{id:"percentage-income-months-back",type:"number",min:my,max:gy,value:s,onChange:y=>{const x=y.target.value;o(x===""?1:Math.min(gy,Math.max(my,Math.round(Number(x))||1)))},style:{width:"4rem",padding:"0.4rem 0.5rem",fontSize:"1rem",border:"1px solid var(--border-medium)",borderRadius:"6px"}}),d.jsx("span",{style:{opacity:.7},children:"month(s) back"}),_&&d.jsx("button",{type:"button",onClick:g,disabled:c,style:{padding:"0.4rem 0.75rem",background:"var(--color-primary)",color:"white",border:"none",borderRadius:"6px",cursor:c?"not-allowed":"pointer",opacity:c?.7:1},children:c?"Saving":"Save"})]}),h&&d.jsx("p",{style:{marginTop:"0.5rem",color:"var(--color-error)",fontSize:"0.9rem"},"aria-live":"polite",children:"Save failed. See banner for details."})]}),d.jsx("p",{style:{fontSize:"0.8rem",opacity:.6},children:"Changing this only affects non-finalized allocation calculations. Finalized months keep their existing amounts."})]})}function S0({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,accountGroups:s,showGroupSelector:o=!1,showIncomeSettings:c=!1,hasExistingIncomeDefault:l=!1,hasExistingOutgoDefault:h=!1,currentGroupId:f,onDelete:p}){const[g,_]=R.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0,is_hidden:!1}),y=g.account_group_id||f,x=y?s.find(M=>M.id===y):null,w=!!(x&&x.is_active!==null),S=!!(x&&x.on_budget!==null);function E(M){M.preventDefault(),g.nickname.trim()&&e(g)}function T(M){_({...g,is_income_account:M,is_income_default:M?g.is_income_default:!1})}function A(M){_({...g,is_outgo_account:M,is_outgo_default:M?g.is_outgo_default:!1})}return d.jsxs(Ps,{actionName:r==="Create Account"?"Create Account":"Update Account",onSubmit:E,children:[d.jsx(Pt,{label:"Account Nickname",htmlFor:"account-nickname",children:d.jsx(zs,{id:"account-nickname",type:"text",value:g.nickname,onChange:M=>_({...g,nickname:M.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),o&&d.jsx(Pt,{label:"Account Type",htmlFor:"account-group",children:d.jsxs(ad,{id:"account-group",value:g.account_group_id||Vt,onChange:M=>_({...g,account_group_id:M.target.value===Vt?null:M.target.value}),children:[d.jsx("option",{value:Vt,children:"Ungrouped"}),s.map(M=>d.jsx("option",{value:M.id,children:M.name},M.id))]})}),c&&d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Xr,{id:"is-active",checked:(()=>{if(w&&x){const M=x.is_active;return M===null||M===void 0?!1:M}return g.is_active??!0})(),onChange:M=>_({...g,is_active:M.target.checked}),disabled:w,children:d.jsx("span",{style:{opacity:w?.5:1},children:"Active account"})}),w&&x&&d.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:me.warning},children:['Set by account type "',x.name,'"']})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Xr,{id:"on-budget",checked:(()=>{if(S&&x){const M=x.on_budget;return M===null||M===void 0?!1:M}return g.on_budget??!0})(),onChange:M=>_({...g,on_budget:M.target.checked}),disabled:S,children:d.jsx("span",{style:{opacity:S?.5:1},children:"On budget (affects budget totals)"})}),S&&x&&d.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:me.warning},children:['Set by account type "',x.name,'"']})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Xr,{id:"is-hidden",checked:g.is_hidden||!1,onChange:M=>_({...g,is_hidden:M.target.checked}),children:"Hidden account"}),d.jsx("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem"},children:"Hidden accounts don't appear in dropdowns or balance displays. Use for historical accounts that aren't actively used."})]})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),d.jsx(Xr,{id:"is-income-account",checked:g.is_income_account||!1,onChange:M=>T(M.target.checked),children:"Show in income deposit list"}),g.is_income_account&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[d.jsx(Xr,{id:"is-income-default",checked:g.is_income_default||!1,onChange:M=>_({...g,is_income_default:M.target.checked}),disabled:l&&!t?.is_income_default,children:"Default account for new income"}),l&&!t?.is_income_default&&d.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),d.jsx(Xr,{id:"is-outgo-account",checked:g.is_outgo_account||!1,onChange:M=>A(M.target.checked),children:"Show in expense account list"}),g.is_outgo_account&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[d.jsx(Xr,{id:"is-outgo-default",checked:g.is_outgo_default||!1,onChange:M=>_({...g,is_outgo_default:M.target.checked}),disabled:h&&!t?.is_outgo_default,children:"Default account for new expenses"}),h&&!t?.is_outgo_default&&d.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),d.jsxs(Ya,{children:[d.jsx(Ge,{type:"submit",actionName:r,children:r}),d.jsx(Ge,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"}),p&&d.jsx(Ge,{type:"button",variant:"secondary",actionName:"Delete Account",onClick:M=>{M.preventDefault(),p()},style:{color:"var(--color-validation-error)",borderColor:"var(--color-validation-error)"},children:" Delete"})]})]})}function C1({label:t,value:e,onChange:n,trueLabel:r,falseLabel:s,undefinedLabel:o}){function c(){n(e===void 0?!0:e===!0?!1:void 0)}const l=e===!0?r:e===!1?s:o,h=e===!0?me.success:e===!1?me.warning:"inherit",f=e===!0?"":e===!1?"":"";return d.jsxs("button",{type:"button",onClick:c,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${h} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${h} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[d.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?h:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:f}),d.jsxs("span",{style:{flex:1},children:[d.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",d.jsx("span",{style:{fontWeight:500,color:h},children:l})]}),d.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function E1({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[s,o]=R.useState(t||{name:"",expected_balance:"positive"});function c(l){l.preventDefault(),s.name.trim()&&e(s)}return d.jsxs(Ps,{actionName:r==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:c,children:[d.jsx(Pt,{label:"Account Type Name",htmlFor:"group-name",children:d.jsx(zs,{id:"group-name",type:"text",value:s.name,onChange:l=>o({...s,name:l.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),d.jsx(Pt,{label:"Expected Balance",htmlFor:"expected-balance",children:d.jsxs(ad,{id:"expected-balance",value:s.expected_balance,onChange:l=>o({...s,expected_balance:l.target.value}),children:[d.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),d.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),d.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",d.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),d.jsx(C1,{label:"Active status",value:s.is_active,onChange:l=>o({...s,is_active:l}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),d.jsx(C1,{label:"Budget status",value:s.on_budget,onChange:l=>o({...s,on_budget:l}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),d.jsxs(Ya,{children:[d.jsx(Ge,{type:"submit",actionName:r,children:r}),d.jsx(Ge,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function Vc({icon:t,label:e,variant:n,title:r}){const o={success:{background:`color-mix(in srgb, ${me.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${me.success} 40%, transparent)`,color:me.success,opacity:1},warning:{background:`color-mix(in srgb, ${me.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${me.warning} 35%, transparent)`,color:me.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${me.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${me.success} 25%, transparent)`,color:me.success,opacity:.7},expense:{background:`color-mix(in srgb, ${me.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${me.warning} 25%, transparent)`,color:me.warning,opacity:.7}}[n];return d.jsxs("span",{title:r||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:o.background,border:o.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:o.color,opacity:o.opacity,whiteSpace:"nowrap"},children:[d.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function T1({account:t,accountGroups:e}){const n=[],r=t.account_group_id?e.find(c=>c.id===t.account_group_id):null,s=r&&r.is_active!==null?r.is_active:t.is_active!==!1,o=r&&r.on_budget!==null?r.on_budget:t.on_budget!==!1;if(!s){const c=r&&r.is_active!==null;n.push(d.jsx(Vc,{icon:"",label:"Inactive",variant:"warning",title:c?`Set by "${r.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!o){const c=r&&r.on_budget!==null;n.push(d.jsx(Vc,{icon:"",label:"Off Budget",variant:"warning",title:c?`Set by "${r.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(d.jsx(Vc,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(d.jsx(Vc,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(d.jsx(Vc,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(d.jsx(Vc,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:d.jsx(d.Fragment,{children:n})}function xU({account:t,accountIndex:e,allGroups:n,allAccounts:r,clearedBalance:s,onEdit:o,onDelete:c,onMoveUp:l,onMoveDown:h,canMoveUp:f,canMoveDown:p,editingAccountId:g,setEditingAccountId:_,onUpdateAccount:y,isMobile:x}){if(g===t.id)return d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:d.jsx(S0,{initialData:{nickname:t.nickname,account_group_id:t.account_group_id,is_income_account:t.is_income_account,is_income_default:t.is_income_default,is_outgo_account:t.is_outgo_account,is_outgo_default:t.is_outgo_default,on_budget:t.on_budget,is_active:t.is_active},onSubmit:T=>{y(t.id,T),_(null)},onCancel:()=>_(null),onDelete:()=>{t.nickname,c(t.id),_(null)},submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:t.account_group_id,hasExistingIncomeDefault:Object.entries(r).some(([T,A])=>A.is_income_default&&T!==t.id),hasExistingOutgoDefault:Object.entries(r).some(([T,A])=>A.is_outgo_default&&T!==t.id)})});if(x)return d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsx("span",{style:{fontWeight:500},children:t.nickname}),d.jsx("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:s?d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total"}),d.jsx("span",{style:{color:et(s.uncleared_balance),fontWeight:600},children:Zn(s.uncleared_balance)})]}),Math.abs(s.uncleared_balance-s.cleared_balance)>=.01?d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),d.jsx("span",{style:{color:et(s.cleared_balance)},children:Zn(s.cleared_balance)})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),d.jsx("span",{style:{color:et(s.uncleared_balance-s.cleared_balance)},children:Zn(s.uncleared_balance-s.cleared_balance)})]})]}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Cleared"}),d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Uncleared"}),d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""})]})]})]}):d.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:d.jsx("span",{style:{color:et(t.balance),fontWeight:600},children:Zn(t.balance)})})})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.5rem"},children:d.jsx(T1,{account:t,accountGroups:n})}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[d.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),d.jsx("button",{onClick:T=>{T.stopPropagation(),l()},disabled:!f,style:{background:"transparent",border:"none",cursor:f?"pointer":"default",opacity:f?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),d.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const S=e%2===0?"transparent":"var(--row-alt-bg)",E={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:S,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1.5fr 1fr"},children:[d.jsx("div",{style:{...E,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid var(--border-subtle)"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),s?d.jsx("div",{style:{...E,justifyContent:"flex-end",color:et(s.uncleared_balance),fontWeight:600},children:Zn(s.uncleared_balance)}):d.jsx("div",{style:{...E,justifyContent:"flex-end",color:et(t.balance),fontWeight:600},children:Zn(t.balance)}),s?d.jsx("div",{style:{...E,justifyContent:"flex-end",color:et(s.cleared_balance)},children:Math.abs(s.uncleared_balance-s.cleared_balance)<.01?d.jsx("span",{style:{opacity:.3,color:"var(--text-muted)"},children:""}):Zn(s.cleared_balance)}):d.jsx("div",{style:{...E,justifyContent:"flex-end",color:et(t.balance),fontWeight:600},children:Zn(t.balance)}),s&&Math.abs(s.uncleared_balance-s.cleared_balance)>=.01?d.jsx("div",{style:{...E,justifyContent:"flex-end",color:et(s.uncleared_balance-s.cleared_balance)},children:Zn(s.uncleared_balance-s.cleared_balance)}):d.jsx("div",{style:{...E,justifyContent:"flex-end",opacity:.3,color:"var(--text-muted)"},children:""}),d.jsx("div",{style:{...E,gap:"0.25rem",flexWrap:"wrap"},children:d.jsx(T1,{account:t,accountGroups:n})}),d.jsxs("div",{style:{...E,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:T=>{T.stopPropagation(),t.nickname,o(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),d.jsx("button",{onClick:T=>{T.stopPropagation(),l()},disabled:!f,style:{background:"transparent",border:"none",cursor:f?"pointer":"default",opacity:f?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),d.jsx("button",{onClick:T=>{T.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function A1({group:t,accounts:e,allGroups:n,allAccounts:r,accountClearedBalances:s,editingAccountId:o,createForGroupId:c,setEditingAccountId:l,setCreateForGroupId:h,onUpdateAccount:f,onDeleteAccount:p,onMoveAccount:g,onCreateAccount:_,isMobile:y,isUngrouped:x,canMoveGroupUp:w,canMoveGroupDown:S,onEditGroup:E,onDeleteGroup:T,onMoveGroupUp:A,onMoveGroupDown:M}){const L=[...e].sort((O,j)=>O.sort_order-j.sort_order);L.reduce((O,j)=>O+j.balance,0);const H={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return d.jsxs("div",{style:{display:"contents"},children:[!y&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...H,opacity:x?.7:1,justifyContent:"space-between"},children:[d.jsxs("span",{children:[d.jsx("span",{children:t.name}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",L.length,")"]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexShrink:0},children:!x&&d.jsxs(d.Fragment,{children:[d.jsx(Ge,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:c!==null,children:"+ Account"}),d.jsx("button",{onClick:()=>{t.name,E()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),d.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),d.jsxs("div",{style:Xf,children:[d.jsx("button",{onClick:A,disabled:!w,style:{...ja,opacity:w?.6:.2,cursor:w?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),d.jsx("button",{onClick:M,disabled:!S,style:{...ja,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})})]}),d.jsx("div",{style:H}),d.jsx("div",{style:H}),d.jsx("div",{style:H}),d.jsx("div",{style:H}),d.jsx("div",{style:H})]}),y&&d.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:x?.7:1},children:[t.name,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",L.length,")"]})]}),an.showGroupTotals]}),!x&&d.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[d.jsx(Ge,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>h(t.id),disabled:c!==null,children:"+ Account"}),d.jsx("button",{onClick:()=>{t.name,E()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),d.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),d.jsxs("div",{style:Xf,children:[d.jsx("button",{onClick:A,disabled:!w,style:{...ja,opacity:w?.6:.2,cursor:w?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),d.jsx("button",{onClick:M,disabled:!S,style:{...ja,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]}),L.map((O,j)=>d.jsx(xU,{account:O,accountIndex:j,totalAccounts:L.length,allGroups:n,allAccounts:r,clearedBalance:s?.[O.id],onEdit:l,onDelete:p,onMoveUp:()=>g(O.id,"up"),onMoveDown:()=>g(O.id,"down"),canMoveUp:j>0,canMoveDown:j<L.length-1,editingAccountId:o,setEditingAccountId:l,onUpdateAccount:f,isMobile:y},O.id)),c===t.id&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:d.jsx(S0,{initialData:{nickname:"",account_group_id:t.id},onSubmit:O=>_(O,t.id),onCancel:()=>h(null),submitLabel:"Create",accountGroups:n,showIncomeSettings:!0,currentGroupId:t.id})})]})}function wU({hiddenAccounts:t,accounts:e,sortedGroups:n,editingAccountId:r,setEditingAccountId:s,onUpdateAccount:o}){return t.length===0?null:d.jsx("div",{style:{marginBottom:"2rem"},children:d.jsxs(_0,{title:"Hidden Accounts",count:t.length,children:[d.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[d.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[d.jsx("strong",{children:" Hidden accounts"})," are excluded from dropdowns and balance displays. They're useful for historical accounts (like closed bank accounts or old 401Ks) that you want to keep for record-keeping but don't need in everyday use."]}),d.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide an account, click it to edit and uncheck "Hidden account".'})]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.map(c=>r===c.id?d.jsx(S0,{initialData:{nickname:c.nickname,account_group_id:c.account_group_id,is_income_account:c.is_income_account,is_income_default:c.is_income_default,is_outgo_account:c.is_outgo_account,is_outgo_default:c.is_outgo_default,on_budget:c.on_budget,is_active:c.is_active,is_hidden:c.is_hidden},onSubmit:l=>{o(c.id,l),s(null)},onCancel:()=>s(null),submitLabel:"Save",accountGroups:n,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:c.account_group_id,hasExistingIncomeDefault:Object.entries(e).some(([l,h])=>h.is_income_default&&l!==c.id),hasExistingOutgoDefault:Object.entries(e).some(([l,h])=>h.is_outgo_default&&l!==c.id)},c.id):d.jsxs("div",{onClick:()=>s(c.id),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[d.jsx("span",{children:c.nickname}),d.jsx("span",{style:{color:et(c.balance),fontWeight:500},children:Zn(c.balance)})]},c.id))})]})})}function SU(){const{selectedBudgetId:t,currentYear:e,currentMonthNumber:n}=Qe(),{isLoading:r,isFetching:s,accounts:o,getOnBudgetTotal:c,totalAvailable:l}=Dn(),{month:h}=rs(t,e,n),{accounts:f,accountsByGroup:p,hiddenAccounts:g,sortedGroups:_,currentBudget:y,error:x,setError:w,handleCreateAccount:S,handleUpdateAccount:E,handleDeleteAccount:T,handleMoveAccount:A,handleCreateGroup:M,handleUpdateGroup:L,handleDeleteGroup:H,handleMoveGroup:O}=GP(),j=Fs(),{addLoadingHold:B,removeLoadingHold:V}=kn(),$=r||s||!y;g0(!$&&!!y),R.useEffect(()=>($?B("accounts","Loading accounts..."):V("accounts"),()=>V("accounts")),[$,B,V]);const[k,N]=R.useState(null),[D,X]=R.useState(null),[K,q]=R.useState(null),[te,Q]=R.useState(!1),ae=R.useMemo(()=>{const ge=Object.values(f),Ce=ge.reduce((Be,Ze)=>Be+(Ze.balance??0),0);let ie=0,le=0;const Me=Object.fromEntries(_.map(Be=>[Be.id,Be]));for(const Be of ge)Bm(Be,Me)?ie+=Be.balance??0:le+=Be.balance??0;return{count:ge.length,groupCount:_.filter(Be=>Be.id!==Vt).length,totalBalance:Ce,onBudgetTotal:ie,offBudgetTotal:le}},[f,_]),P=R.useMemo(()=>_.filter(ge=>ge.id!==Vt),[_]),G=R.useMemo(()=>({id:Vt,name:"Ungrouped",sort_order:P.length,expected_balance:"any",on_budget:null,is_active:null}),[P.length]),ee=p[Vt]||[],re=R.useMemo(()=>h?zA(h,o):{},[h,o]),se={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid var(--border-medium)"};return R.useEffect(()=>{x&&(console.error("[Settings/Accounts] Error:",x),Hn.add({type:"error",message:"Failed to update accounts. See console for details.",autoDismissMs:0}),w(null))},[x,w]),$||!y?$?null:d.jsx("p",{children:"No budget found. Please log in."}):d.jsxs("div",{children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:j?"1fr":"2fr 1fr 1fr 1fr 1.5fr 1fr",marginBottom:"1.5rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"var(--sticky-header-bg)",display:j?"block":"grid",gridTemplateColumns:j?void 0:"subgrid"},children:[d.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:d.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid var(--border-medium)"},children:d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),d.jsx("span",{style:{color:et(ae.onBudgetTotal),fontWeight:600},children:Ft(ae.onBudgetTotal)})]}),ae.offBudgetTotal!==0&&d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),d.jsx("span",{style:{fontWeight:600,opacity:.7},children:Ft(ae.offBudgetTotal)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:et(ae.totalBalance),fontWeight:600},children:Ft(ae.totalBalance)})]}),d.jsxs("span",{style:{marginLeft:"0.5rem",paddingLeft:"0.5rem",borderLeft:"1px solid var(--border-medium)"},children:[d.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),d.jsx("span",{style:{color:et(c()),fontWeight:600},children:Ft(c())}),d.jsx("span",{style:{opacity:.6},children:"  Allocated: "}),d.jsx("span",{style:{fontWeight:600},children:Ft(c()-l)}),d.jsx("span",{style:{opacity:.6},children:" = Avail: "}),d.jsx("span",{style:{color:et(l),fontWeight:600},children:Ft(l)})]})]})})}),!j&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:se,children:"Account"}),d.jsx("div",{style:{...se,textAlign:"right"},children:"Total"}),d.jsx("div",{style:{...se,textAlign:"right"},children:"Cleared"}),d.jsx("div",{style:{...se,textAlign:"right"},children:"Uncleared"}),d.jsx("div",{style:se,children:"Flags"}),d.jsx("div",{style:{...se,textAlign:"right"},children:"Actions"})]})]}),Object.keys(f).length===0&&P.length===0&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No accounts yet. Create an account type first, then add accounts!"}),P.map((ge,Ce)=>{const ie=p[ge.id]||[];return ie.length===0&&K!==ge.id&&D!==ge.id?null:K===ge.id?d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(E1,{initialData:{name:ge.name,expected_balance:ge.expected_balance||"positive",on_budget:ge.on_budget??void 0,is_active:ge.is_active??void 0},onSubmit:le=>{L(ge.id,le),q(null)},onCancel:()=>q(null),submitLabel:"Save"})},ge.id):d.jsx(A1,{group:ge,accounts:ie,allGroups:P,allAccounts:f,accountClearedBalances:re,editingAccountId:k,createForGroupId:D,setEditingAccountId:N,setCreateForGroupId:X,onUpdateAccount:(le,Me)=>{E(le,Me),N(null)},onDeleteAccount:T,onMoveAccount:A,onCreateAccount:S,isMobile:j,canMoveGroupUp:Ce>0,canMoveGroupDown:Ce<P.length-1,onEditGroup:()=>q(ge.id),onDeleteGroup:()=>H(ge.id),onMoveGroupUp:()=>O(ge.id,"up"),onMoveGroupDown:()=>O(ge.id,"down")},ge.id)}),(ee.length>0||D==="ungrouped")&&d.jsx(A1,{group:G,accounts:ee,allGroups:P,allAccounts:f,accountClearedBalances:re,editingAccountId:k,createForGroupId:D,setEditingAccountId:N,setCreateForGroupId:X,onUpdateAccount:(ge,Ce)=>{E(ge,Ce),N(null)},onDeleteAccount:T,onMoveAccount:A,onCreateAccount:S,isMobile:j,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{}}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),d.jsx(wU,{hiddenAccounts:g,accounts:f,sortedGroups:P,editingAccountId:k,setEditingAccountId:N,onUpdateAccount:E}),te?d.jsx(E1,{onSubmit:ge=>{M(ge),Q(!1)},onCancel:()=>Q(!1),submitLabel:"Create Account Type"}):d.jsx(Ge,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>Q(!0),children:"+ Add Account Type"})]})}function C0({initialData:t,onSubmit:e,onCancel:n,submitLabel:r,categoryGroups:s=[],showGroupSelector:o=!1,onDelete:c}){const[l,h]=R.useState(t||{name:"",category_group_id:null,is_hidden:!1}),[f,p]=R.useState(t?.default_monthly_amount?.toString()||""),[g,_]=R.useState(t?.default_monthly_type||"fixed"),[y,x]=R.useState(!1);function w(S){if(S.preventDefault(),!l.name.trim())return;x(!0);const E=parseFloat(f),T=!isNaN(E)&&E>0;Promise.resolve(e({...l,description:l.description?.trim()||void 0,default_monthly_amount:T?E:void 0,default_monthly_type:T?g:void 0})).catch(A=>{console.error("[CategoryForm] Error submitting form:",A)}).finally(()=>{x(!1)}),n()}return d.jsxs(Ps,{actionName:r==="Create"?"Create Category":"Update Category",onSubmit:w,children:[d.jsx(Pt,{label:"Category Name",htmlFor:"category-name",children:d.jsx(zs,{id:"category-name",type:"text",value:l.name,onChange:S=>h({...l,name:S.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),d.jsx(Pt,{label:"Description (optional)",htmlFor:"category-description",children:d.jsx(m0,{id:"category-description",value:l.description||"",onChange:S=>h({...l,description:S.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),o&&d.jsx(Pt,{label:"Category Group",htmlFor:"category-group",children:d.jsxs(ad,{id:"category-group",value:l.category_group_id||Xt,onChange:S=>h({...l,category_group_id:S.target.value===Xt?null:S.target.value}),children:[d.jsx("option",{value:Xt,children:"Uncategorized"}),s.map(S=>d.jsx("option",{value:S.id,children:S.name},S.id))]})}),d.jsxs(Pt,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[d.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[d.jsxs(ad,{id:"default-type",value:g,onChange:S=>_(S.target.value),style:{width:"auto",flex:"0 0 auto"},children:[d.jsx("option",{value:"fixed",children:"Fixed $"}),d.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),g==="fixed"?d.jsx(Oo,{id:"default-amount",value:f,onChange:p,placeholder:"$0.00"}):d.jsx(zs,{id:"default-amount",type:"number",value:f,onChange:S=>p(S.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),g==="percentage"&&d.jsx("span",{style:{opacity:.6},children:"%"})]}),d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:g==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),o&&d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px"},children:[d.jsx(Xr,{id:"is-hidden",checked:l.is_hidden||!1,onChange:S=>h({...l,is_hidden:S.target.checked}),children:"Hidden category"}),d.jsx("p",{style:{margin:"0.25rem 0 0 2rem",fontSize:"0.7rem",opacity:.6},children:"Hidden categories don't appear in dropdowns or balance displays. Use for historical categories that aren't actively used."})]}),d.jsxs(Ya,{children:[d.jsx(Ge,{type:"submit",actionName:r==="Create"?"Create Category":"Save Category",isLoading:y,children:r}),d.jsx(Ge,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"}),c&&d.jsx(Ge,{type:"button",variant:"secondary",actionName:"Delete Category",onClick:S=>{S.preventDefault(),c()},style:{color:"var(--color-validation-error)",borderColor:"var(--color-validation-error)"},children:" Delete"})]})]})}function j1({initialData:t,onSubmit:e,onCancel:n,submitLabel:r}){const[s,o]=R.useState(t||{name:""}),[c,l]=R.useState(!1);function h(f){f.preventDefault(),s.name.trim()&&(l(!0),e(s))}return d.jsxs(Ps,{actionName:r==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:h,children:[d.jsx(Pt,{label:"Group Name",htmlFor:"group-name",children:d.jsx(zs,{id:"group-name",type:"text",value:s.name,onChange:f=>o({...s,name:f.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),d.jsxs(Ya,{children:[d.jsx(Ge,{type:"submit",actionName:r==="Create Group"?"Create Category Group":"Save Category Group",isLoading:c,children:r}),d.jsx(Ge,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function CU({category:t,catId:e,categoryIndex:n,categoryGroups:r,categoryBalances:s,loadingBalances:o,onEdit:c,onDelete:l,onMoveUp:h,onMoveDown:f,canMoveUp:p,canMoveDown:g,editingCategoryId:_,setEditingCategoryId:y,onUpdateCategory:x,isMobile:w}){const S=s[e]||{current:0,total:0};if(_===e)return d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:d.jsx(C0,{initialData:{name:t.name,description:t.description,category_group_id:t.category_group_id,default_monthly_amount:t.default_monthly_amount,default_monthly_type:t.default_monthly_type,is_hidden:t.is_hidden},onSubmit:M=>{x(e,M),y(null)},onCancel:()=>y(null),onDelete:()=>{t.name,l(e),y(null)},submitLabel:"Save",categoryGroups:r,showGroupSelector:!0})});if(w)return d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsx("span",{style:{fontWeight:500},children:t.name}),d.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.85rem"},children:[t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Default"}),d.jsx("span",{style:{opacity:.7},children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${Jt(t.default_monthly_amount)}/mo`})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Available Now"}),d.jsx("span",{style:{color:hn(S.current),fontWeight:600},children:o?"...":zt(S.current)})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsx("span",{style:{opacity:.6,fontSize:"0.7rem"},children:"Total Allocated"}),d.jsx("span",{style:{color:hn(S.total)},children:o?"...":zt(S.total)})]})]})]}),t.description&&d.jsx("p",{style:{fontSize:"0.8rem",opacity:.6,margin:"0 0 0.5rem 0"},children:t.description}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&d.jsxs("div",{style:{fontSize:"0.75rem",opacity:.8,marginBottom:"0.5rem"},children:["Default: ",t.default_monthly_type==="percentage"?d.jsxs(d.Fragment,{children:[d.jsxs("span",{style:{color:me.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{color:me.success,fontWeight:500},children:t.default_monthly_amount}),"/mo"]})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[d.jsx("button",{onClick:M=>{M.stopPropagation(),t.name,c(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),d.jsx("button",{onClick:M=>{M.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),d.jsx("button",{onClick:M=>{M.stopPropagation(),f()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})});const T=n%2===0?"transparent":"var(--row-alt-bg)",A={padding:"0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{gridColumn:"1 / -1",background:T,display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 2fr 1fr"},children:[d.jsx("div",{style:{...A,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid var(--border-subtle)"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),d.jsx("div",{style:{...A,justifyContent:"flex-end",opacity:.7,fontSize:"0.85rem"},children:t.default_monthly_amount!==void 0&&t.default_monthly_amount>0?d.jsx("span",{children:t.default_monthly_type==="percentage"?`${t.default_monthly_amount}%`:`${zt(t.default_monthly_amount)}/mo`}):d.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"var(--text-muted)"},children:""})}),d.jsx("div",{style:{...A,justifyContent:"flex-end",color:hn(S.current),fontWeight:600},children:o?"...":zt(S.current)}),d.jsx("div",{style:{...A,justifyContent:"flex-end",color:hn(S.total)},children:o?"...":zt(S.total)}),d.jsx("div",{style:{...A,opacity:.7,fontSize:"0.85rem"},children:t.description?d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description}):d.jsx("span",{style:{opacity:.3,fontStyle:"italic",color:"var(--text-muted)"},children:""})}),d.jsxs("div",{style:{...A,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:M=>{M.stopPropagation(),t.name,c(e)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit",children:""}),d.jsx("button",{onClick:M=>{M.stopPropagation(),h()},disabled:!p,style:{background:"transparent",border:"none",cursor:p?"pointer":"default",opacity:p?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move up",children:""}),d.jsx("button",{onClick:M=>{M.stopPropagation(),f()},disabled:!g,style:{background:"transparent",border:"none",cursor:g?"pointer":"default",opacity:g?.6:.2,fontSize:"0.9rem",padding:"0.25rem"},title:"Move down",children:""})]})]})}function R1({group:t,categories:e,categoryGroups:n,categoryBalances:r,loadingBalances:s,editingCategoryId:o,createForGroupId:c,setEditingCategoryId:l,setCreateForGroupId:h,handleUpdateCategory:f,handleDeleteCategory:p,handleMoveCategory:g,handleCreateCategory:_,isMobile:y,isUngrouped:x,startRowIndex:w=0,canMoveGroupUp:S,canMoveGroupDown:E,onEditGroup:T,onDeleteGroup:A,onMoveGroupUp:M,onMoveGroupDown:L}){const H=R.useMemo(()=>[...e].sort((V,$)=>V[1].sort_order-$[1].sort_order),[e]),O=H.reduce((V,[$])=>{const k=r[$];return V+(k?.current||0)},0),j=w===0,B={padding:"0.6rem 0.5rem",marginTop:j?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600,minWidth:0,overflow:"visible"};return d.jsxs("div",{style:{display:"contents"},children:[!y&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{...B,opacity:x?.7:1},children:d.jsxs("span",{style:{whiteSpace:"nowrap"},children:[d.jsx("span",{children:t.name}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",H.length,")"]})]})}),d.jsx("div",{style:B}),d.jsx("div",{style:{...B,justifyContent:"flex-end",color:hn(O)},children:an.showGroupTotals}),d.jsx("div",{style:{...B,justifyContent:"flex-end",color:hn(H.reduce((V,[$])=>{const k=r[$];return V+(k?.total||0)},0))},children:an.showGroupTotals}),d.jsx("div",{style:B}),d.jsx("div",{style:{...B,justifyContent:"flex-end",gap:"0.25rem"},children:!x&&d.jsxs(d.Fragment,{children:[d.jsx(Ge,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:c!==null,children:"+ Category"}),d.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),d.jsx("button",{onClick:()=>{t.name,A()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),d.jsxs("div",{style:Xf,children:[d.jsx("button",{onClick:M,disabled:!S,style:{...ja,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),d.jsx("button",{onClick:L,disabled:!E,style:{...ja,opacity:E?.6:.2,cursor:E?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})})]}),y&&d.jsxs("div",{style:{gridColumn:"1 / -1",padding:"0.6rem 0.5rem",marginTop:j?0:"1.25rem",borderTop:"1px solid var(--border-medium)",borderBottom:qa,background:"var(--row-alt-bg)"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:x?.7:1,whiteSpace:"nowrap"},children:[t.name,d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",H.length,")"]})]}),an.showGroupTotals]}),!x&&d.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[d.jsx(Ge,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>h(t.id),disabled:c!==null,children:"+ Category"}),d.jsx("button",{onClick:()=>{t.name,T()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),d.jsx("button",{onClick:()=>{t.name,A()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),d.jsxs("div",{style:Xf,children:[d.jsx("button",{onClick:M,disabled:!S,style:{...ja,opacity:S?.6:.2,cursor:S?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),d.jsx("button",{onClick:L,disabled:!E,style:{...ja,opacity:E?.6:.2,cursor:E?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]}),H.map(([V,$],k)=>{const N=w+k;return d.jsx(CU,{category:$,catId:V,categoryIndex:N,totalCategories:H.length,categoryGroups:n,categoryBalances:r,loadingBalances:s,onEdit:l,onDelete:p,onMoveUp:()=>g(V,"up"),onMoveDown:()=>g(V,"down"),canMoveUp:k>0,canMoveDown:k<H.length-1,editingCategoryId:o,setEditingCategoryId:l,onUpdateCategory:f,isMobile:y},V)}),c===t.id&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"0.5rem"},children:d.jsx(C0,{initialData:{name:"",category_group_id:t.id},onSubmit:V=>_(V,t.id),onCancel:()=>h(null),submitLabel:"Create",categoryGroups:n})})]})}function EU({onBudgetTotal:t,allocated:e,unallocated:n,relationshipMismatch:r,calculationMismatch:s}){return d.jsx("div",{style:{gridColumn:"1 / -1",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:d.jsx("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingBottom:"0.5rem",borderBottom:"1px solid var(--border-medium)"},children:d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Categories:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"On Budget: "}),d.jsx("span",{style:{color:et(t),fontWeight:600},children:Ft(t)})]}),d.jsx("span",{style:{opacity:r?1:.5,color:r?"var(--color-error)":void 0,fontWeight:r?700:void 0},children:r?"":"="}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Allocated: "}),d.jsx("span",{style:{color:Pa(e),fontWeight:600},children:Ft(e)})]}),d.jsx("span",{style:{opacity:r?1:.5,color:r?"var(--color-error)":void 0,fontWeight:r?700:void 0},children:"+"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Unallocated: "}),d.jsx("span",{style:{color:et(n),fontWeight:600},children:Ft(n)})]}),d.jsx("span",{style:{opacity:.6},children:"Use  buttons to reorder categories."})]})})})}function TU(){const{isLoading:t,isFetching:e,totalAvailable:n}=Dn(),{currentBudget:r,categories:s,categoryGroups:o,categoriesByGroup:c,hiddenCategories:l,sortedGroups:h,categoryBalances:f,isLoading:p,loadingBalances:g,error:_,setError:y,getOnBudgetTotal:x,handleCreateCategory:w,handleUpdateCategory:S,handleDeleteCategory:E,handleMoveCategory:T,handleCreateGroup:A,handleUpdateGroup:M,handleDeleteGroup:L,handleMoveGroup:H}=QP(),O=Fs(),{addLoadingHold:j,removeLoadingHold:B}=kn(),V=t||p||e||!r;g0(!V&&!!r),R.useEffect(()=>(V?j("categories","Loading categories..."):B("categories"),()=>B("categories")),[V,j,B]);const[$,k]=R.useState(null),[N,D]=R.useState(null),[X,K]=R.useState(null),[q,te]=R.useState(!1),Q=R.useMemo(()=>h.filter(ie=>ie.id!==Xt),[h]),ae=R.useMemo(()=>({id:Xt,name:"Uncategorized",sort_order:Q.length}),[Q.length]),P=(c[Xt]||[]).sort((ie,le)=>ie[1].sort_order-le[1].sort_order);R.useEffect(()=>{_&&(console.error("[Settings/Categories] Error:",_),Hn.add({type:"error",message:"Failed to update categories. See console for details.",autoDismissMs:0}),y(null))},[_,y]);const G=R.useMemo(()=>x(),[x]),{allocated:ee,unallocated:re,calculationMismatch:se,relationshipMismatch:ge}=KP({categories:s,categoryBalances:f,totalAvailable:n,onBudgetTotal:G,isDataLoading:V,loadingBalances:g,currentBudget:r});if(V||!r)return V?null:d.jsx("p",{children:"No budget found. Please log in."});const Ce={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.75rem",paddingBottom:"0.5rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderBottom:"2px solid var(--border-medium)"};return d.jsxs("div",{children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:O?"1fr":"2fr 1fr 1fr 1fr 2fr 1fr",marginBottom:"1.5rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:50,backgroundColor:"var(--sticky-header-bg)",display:O?"block":"grid",gridTemplateColumns:O?void 0:"subgrid"},children:[d.jsx(EU,{onBudgetTotal:G,allocated:ee,unallocated:re,relationshipMismatch:ge,calculationMismatch:se}),!O&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Ce,children:"Category"}),d.jsx("div",{style:{...Ce,textAlign:"right"},children:"Default"}),d.jsx("div",{style:{...Ce,textAlign:"right"},children:"Available Now"}),d.jsx("div",{style:{...Ce,textAlign:"right"},children:"Total Allocated"}),d.jsx("div",{style:Ce,children:"Description"}),d.jsx("div",{style:{...Ce,textAlign:"right"},children:"Actions"})]})]}),Object.keys(s).length===0&&o.length===0&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.7,textAlign:"center",padding:"2rem"},children:"No categories yet. Create a group first, then add categories!"}),(()=>{const ie={};let le=0;return Q.forEach(Me=>{const Be=(c[Me.id]||[]).sort((Ze,st)=>Ze[1].sort_order-st[1].sort_order);ie[Me.id]=le,le+=Be.length}),Q.map((Me,Be)=>{const Ze=(c[Me.id]||[]).sort((st,U)=>st[1].sort_order-U[1].sort_order);return Ze.length===0&&X!==Me.id&&N!==Me.id?null:X===Me.id?d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(j1,{initialData:{name:Me.name},onSubmit:st=>{M(Me.id,st),K(null)},onCancel:()=>K(null),submitLabel:"Save"})},Me.id):d.jsx(R1,{group:Me,categories:Ze,categoryGroups:o,categoryBalances:f,loadingBalances:g,editingCategoryId:$,createForGroupId:N,setEditingCategoryId:k,setCreateForGroupId:D,handleUpdateCategory:S,handleDeleteCategory:E,handleMoveCategory:T,handleCreateCategory:w,isMobile:O,canMoveGroupUp:Be>0,canMoveGroupDown:Be<Q.length-1,onEditGroup:()=>K(Me.id),onDeleteGroup:()=>L(Me.id),onMoveGroupUp:()=>H(Me.id,"up"),onMoveGroupDown:()=>H(Me.id,"down"),startRowIndex:ie[Me.id]??0},Me.id)})})(),(P.length>0||N==="ungrouped")&&(()=>{const ie=Q.reduce((le,Me)=>{const Be=(c[Me.id]||[]).sort((Ze,st)=>Ze[1].sort_order-st[1].sort_order);return le+Be.length},0);return d.jsx(R1,{group:ae,categories:P,categoryGroups:o,categoryBalances:f,loadingBalances:g,editingCategoryId:$,createForGroupId:N,setEditingCategoryId:k,setCreateForGroupId:D,handleUpdateCategory:S,handleDeleteCategory:E,handleMoveCategory:T,handleCreateCategory:w,isMobile:O,isUngrouped:!0,canMoveGroupUp:!1,canMoveGroupDown:!1,onEditGroup:()=>{},onDeleteGroup:()=>{},onMoveGroupUp:()=>{},onMoveGroupDown:()=>{},startRowIndex:ie})})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"1rem"}})]}),l.length>0&&d.jsx("div",{style:{marginBottom:"2rem"},children:d.jsxs(_0,{title:"Hidden Categories",count:l.length,children:[d.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",fontSize:"0.85rem"},children:[d.jsxs("p",{style:{margin:"0 0 0.5rem 0",opacity:.8},children:[d.jsx("strong",{children:" Hidden categories"})," are excluded from dropdowns and balance displays. They're useful for historical categories that you want to keep for record-keeping but don't need in everyday use."]}),d.jsx("p",{style:{margin:0,opacity:.6},children:'To unhide a category, click it to edit and uncheck "Hidden category".'})]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:l.map(([ie,le])=>$===ie?d.jsx(C0,{initialData:{name:le.name,description:le.description,category_group_id:le.category_group_id,default_monthly_amount:le.default_monthly_amount,default_monthly_type:le.default_monthly_type,is_hidden:le.is_hidden},onSubmit:Me=>{S(ie,Me),k(null)},onCancel:()=>k(null),submitLabel:"Save",categoryGroups:o,showGroupSelector:!0},ie):d.jsxs("div",{onClick:()=>k(ie),style:{padding:"0.75rem 1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"8px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",opacity:.7},children:[d.jsx("span",{children:le.name}),d.jsx("span",{style:{color:et(le.balance),fontWeight:500},children:Ft(le.balance)})]},ie))})]})}),q?d.jsx(j1,{onSubmit:ie=>{A(ie),te(!1)},onCancel:()=>te(!1),submitLabel:"Create Group"}):d.jsx(Ge,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>te(!0),children:"+ Add Category Group"})]})}function AU(){const{selectedBudgetId:t,currentUserId:e}=Qe(),{addLoadingHold:n,removeLoadingHold:r}=kn(),{budget:s,budgetUserIds:o,acceptedUserIds:c,isLoading:l}=Dn();R.useEffect(()=>(l||!s?n("users","Loading users..."):r("users"),()=>r("users")),[l,s,n,r]);const{inviteUser:h}=yz(),{revokeUser:f}=_z(),[p,g]=R.useState(""),[_,y]=R.useState(!1),[x,w]=R.useState(null),[S,E]=R.useState(null);if(l)return null;if(!s)return d.jsx("p",{children:"No budget found."});async function T(H){if(H.preventDefault(),!(!p.trim()||!s||!t)){y(!0),w(null),E(null);try{await h.mutateAsync({budgetId:t,userId:p.trim()}),g(""),E("Invite sent! The user can now accept the invitation from their account.")}catch(O){w(O instanceof Error?O.message:"Failed to invite user")}finally{y(!1)}}}async function A(H){if(!s||!t)return;if(H===s.owner_id){w("Cannot revoke the budget owner");return}if(H===e){w("Cannot revoke yourself from the budget");return}const O=c.includes(H);if(confirm(O?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){w(null),E(null);try{await f.mutateAsync({budgetId:t,userId:H}),E(O?"User access revoked.":"Invitation cancelled.")}catch(B){w(B instanceof Error?B.message:"Failed to revoke user")}}}const M=o.filter(H=>c.includes(H)),L=o.filter(H=>!c.includes(H));return d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),x&&d.jsxs("div",{style:{background:"var(--color-error-bg)",border:"1px solid var(--color-error-border)",color:"var(--color-error)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:x}),d.jsx("button",{onClick:()=>w(null),style:{background:"transparent",border:"none",color:"var(--color-error)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),S&&d.jsxs("div",{style:{background:"var(--color-success-bg)",border:"1px solid var(--color-success-border)",color:"var(--color-success)",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:S}),d.jsx("button",{onClick:()=>E(null),style:{background:"transparent",border:"none",color:"var(--color-success)",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",M.length,")"]}),M.length===0?d.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:M.map(H=>{const O=H===s.owner_id,j=H===e;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[d.jsx("div",{style:{flex:1,minWidth:0},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:H}),O&&d.jsx("span",{style:{background:"color-mix(in srgb, currentColor 15%, transparent)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),j&&d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-success) 20%, transparent)",color:"var(--color-success)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!O&&!j&&d.jsx("button",{onClick:()=>A(H),style:{background:"transparent",border:"1px solid var(--color-error-border)",color:"var(--color-error)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},H)})})]}),L.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",L.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:L.map(H=>d.jsxs("div",{style:{background:"color-mix(in srgb, var(--color-warning) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--color-warning) 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[d.jsx("div",{style:{flex:1,minWidth:0},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:H}),d.jsx("span",{style:{background:"color-mix(in srgb, var(--color-warning) 20%, transparent)",color:"var(--color-warning)",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),d.jsx("button",{onClick:()=>A(H),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},H))})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),d.jsxs("form",{onSubmit:T,style:{display:"flex",gap:"0.75rem"},children:[d.jsx("input",{type:"text",value:p,onChange:H=>g(H.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),d.jsx("button",{type:"submit",disabled:_||!p.trim(),style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:_||!p.trim()?"not-allowed":"pointer",fontWeight:500,opacity:_||!p.trim()?.7:1,whiteSpace:"nowrap"},children:_?"Inviting...":"Send Invite"})]}),d.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),d.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:s.id})]})]})}const jU=["budget","feedback","migration","tests"];function RU(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:r,setPageTitle:s}=Qe(),c=Us().get_current_firebase_user(),l=XT(c?.uid||null,c?.email||null);R.useLayoutEffect(()=>{s("Budget Admin")},[s]);const h=nr(),f=h.pathname==="/budget/admin",p=R.useMemo(()=>{const x=h.pathname;return x.includes("/admin/budget")?"budget":x.includes("/admin/feedback")?"feedback":x.includes("/admin/migration")?"migration":x.includes("/admin/tests")?"tests":"budget"},[h.pathname]),g=p==="tests";R.useEffect(()=>{f||r(p)},[p,f,r]);function _(){return!jU.includes(n)||n==="tests"&&!e?"budget":n}const y=R.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return l.isLoading||l.isFetching?null:t?!e&&g?d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(Rn,{to:"/budget/admin/budget",children:"Go to Admin "})})]}):d.jsxs("div",{children:[d.jsx(em,{mode:"link",linkPrefix:"/budget/admin",tabs:y,activeTab:p}),f?d.jsx(nm,{to:`/budget/admin/${_()}`,replace:!0}):d.jsx(rm,{})]}):d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(Rn,{to:"/budget",children:"Go to Budget "})})]})}function IU(){const{addLoadingHold:t,removeLoadingHold:e}=kn(),{isAdmin:n}=Qe(),{budget:r,accounts:s,accountGroups:o,categories:c,categoryGroups:l,isOwner:h,isLoading:f}=Dn();return R.useEffect(()=>(f?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[f,t,e]),f?null:r?d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),d.jsx("strong",{children:r.name})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),d.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:r.id})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),d.jsx("strong",{children:r.owner_email||r.owner_id})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),d.jsxs("span",{children:[r.user_ids.length," user",r.user_ids.length!==1?"s":"",d.jsxs("span",{style:{opacity:.7},children:["  ",h?"You are the owner":"Shared with you"]})]})]})]})}),n&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),d.jsx("button",{onClick:()=>{const p={...r,accounts:s,account_groups:o,categories:c,category_groups:l,_meta:{downloaded_at:new Date().toISOString()}},g=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),_=URL.createObjectURL(g),y=document.createElement("a");y.href=_,y.download=`budget_${r.id}.json`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(_)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):d.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function I1({selectedType:t,onSelect:e}){return d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const r=od[n],s=t==="feature"?"new_feature":t,o=s===n||!s&&n==="bug";return d.jsxs("button",{type:"button",onClick:()=>{r.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${r.color}`,borderRadius:"0.5rem",background:o?r.bgColor:"transparent",color:o?r.color:"var(--text-muted)",cursor:"pointer",fontWeight:o?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:o?1:.5,boxShadow:o?`0 0 12px ${r.bgColor}`:"none",position:"relative"},children:[r.label,o&&d.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function kU(){const[t,e]=R.useState(null),[n,r]=R.useState(null),[s,o]=R.useState(!1),[c,l]=R.useState(""),[h,f]=R.useState("bug"),[p,g]=R.useState(null),[_,y]=R.useState(!1),[x,w]=R.useState(null),S=R.useContext(Rd),T=Us().get_current_firebase_user(),A=Rt(),M=YB(),{submitFeedback:L}=RA(),{toggleFeedback:H}=N4(),{updateSortOrder:O}=B4(),j=M.data?.items||[],B=Fs(),{addLoadingHold:V,removeLoadingHold:$}=kn();R.useEffect(()=>(M.isLoading?V("settings-feedback","Loading feedback..."):$("settings-feedback"),()=>$("settings-feedback")),[M.isLoading,V,$]);function k(ie){ie.preventDefault(),!(!c.trim()||!S.username||!T)&&(L.mutate({userId:T.uid,userEmail:S.username,text:c.trim(),feedbackType:h,currentPath:"/settings/feedback"}),l(""),f("bug"),o(!1))}function N(ie){ie.is_done?D(ie):g(ie)}async function D(ie){try{await H.mutateAsync({item:ie})}catch(le){console.error("[Feedback] Error updating feedback:",le),Hn.add({type:"error",message:"Failed to update feedback",autoDismissMs:5e3})}}function X(){p&&(D(p),g(null))}async function K(){y(!1);const ie="mark-all-feedback-complete";V(ie,`Marking ${Q.length} item${Q.length!==1?"s":""} as complete...`);try{const le=new Date().toISOString(),Me=new Set(Q.map(fe=>fe.id)),Be=new Map;for(const fe of Q)Be.has(fe.doc_id)||Be.set(fe.doc_id,[]),Be.get(fe.doc_id).push(fe);const Ze=[];for(const[fe,ue]of Be){const J=(async()=>{const oe=(await jA(fe,"mark all feedback complete")).items.map(Se=>Me.has(Se.id)?{...Se,is_done:!0,completed_at:le}:Se);await y0({docId:fe,items:oe,description:`marking ${ue.length} feedback item${ue.length!==1?"s":""} as complete`})})();Ze.push(J)}await Promise.all(Ze);const st=Te.feedback(),U=A.getQueryData(st);U&&A.setQueryData(st,{items:U.items.map(fe=>Me.has(fe.id)?{...fe,is_done:!0,completed_at:le}:fe)}),await A.invalidateQueries({queryKey:st}),Hn.add({type:"success",message:`Marked ${Q.length} item${Q.length!==1?"s":""} as complete`,autoDismissMs:3e3})}catch(le){console.error("[Feedback] Error marking all as complete:",le),Hn.add({type:"error",message:"Failed to mark all items as complete",autoDismissMs:5e3}),await A.invalidateQueries({queryKey:Te.feedback()})}finally{$(ie)}}function q(){K()}async function te(ie){if(x){try{const Me=j.filter(Be=>Be.doc_id===x.doc_id).map(Be=>({id:Be.id,text:Be.text,created_at:Be.created_at,is_done:Be.is_done,completed_at:Be.completed_at,sort_order:Be.sort_order,feedback_type:Be.id===x.id?ie:Be.feedback_type}));await O.mutateAsync({docId:x.doc_id,items:Me})}catch(le){console.error("[Feedback] Error updating feedback type:",le),Hn.add({type:"error",message:"Failed to update feedback type",autoDismissMs:5e3})}w(null)}}const Q=j.filter(ie=>!ie.is_done).sort((ie,le)=>ie.sort_order-le.sort_order),ae=j.filter(ie=>ie.is_done).sort((ie,le)=>new Date(le.completed_at||0).getTime()-new Date(ie.completed_at||0).getTime());function P(ie,le){e(le),ie.dataTransfer.effectAllowed="move"}function G(ie,le){ie.preventDefault(),le!==t&&r(le)}function ee(){r(null)}function re(){e(null),r(null)}async function se(ie,le){if(ie.preventDefault(),!t||t===le){re();return}const Me=Q.findIndex(fe=>fe.id===t),Be=[...Q],[Ze]=Be.splice(Me,1);if(le==="__end__")Be.push(Ze);else{const fe=Be.findIndex(ue=>ue.id===le);Be.splice(fe,0,Ze)}const st=Be.map((fe,ue)=>({...fe,sort_order:ue}));re();const U=new Map;for(const fe of st)U.has(fe.doc_id)||U.set(fe.doc_id,[]),U.get(fe.doc_id).push({id:fe.id,text:fe.text,created_at:fe.created_at,is_done:fe.is_done,completed_at:fe.completed_at,sort_order:fe.sort_order,feedback_type:fe.feedback_type});for(const fe of ae)U.has(fe.doc_id)||U.set(fe.doc_id,[]),U.get(fe.doc_id).push({id:fe.id,text:fe.text,created_at:fe.created_at,is_done:fe.is_done,completed_at:fe.completed_at,sort_order:fe.sort_order,feedback_type:fe.feedback_type});try{for(const[fe,ue]of U)await O.mutateAsync({docId:fe,items:ue})}catch(fe){console.error("[Feedback] Error saving order:",fe),Hn.add({type:"error",message:"Failed to save order",autoDismissMs:5e3})}}function ge(){const ie=Ce(Q),le=new Blob([ie],{type:"text/markdown"}),Me=URL.createObjectURL(le),Be=document.createElement("a");Be.href=Me,Be.download=`feedback-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(Be),Be.click(),document.body.removeChild(Be),URL.revokeObjectURL(Me)}function Ce(ie){let le=`# Feedback Export

`;return le+=`Generated: ${new Date().toISOString()}

`,ie.length>0&&(le+=`## Pending

`,ie.forEach((Me,Be)=>{const Ze=Me.feedback_type?od[Me.feedback_type]?.label||Me.feedback_type:"Unknown";le+=`### ${Be+1}. [${Ze}] ${Me.text.split(`
`)[0].substring(0,60)}${Me.text.split(`
`)[0].length>60?"...":""}

`,le+=`- **Type:** ${Ze}
`,le+=`- **Created:** ${Me.created_at}
`,le+=`- **User:** ${Me.user_email||Me.doc_id}
`,le+=`- **ID:** ${Me.id}

`,le+=`${Me.text}

`,le+=`---

`})),le}return M.isLoading?null:d.jsxs("div",{children:[d.jsxs("div",{style:{display:"flex",flexDirection:B?"column":"row",justifyContent:"space-between",alignItems:B?"stretch":"flex-start",gap:B?"0.75rem":"1rem",marginTop:"1.5rem",marginBottom:"0.5rem"},children:[d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Feedback"}),d.jsx("p",{style:{...rA,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexDirection:B?"column":"row"},children:[d.jsx(Ge,{variant:"secondary",actionName:"Download Feedback as Markdown",onClick:ge,disabled:Q.length===0,style:B?{width:"100%"}:void 0,children:"Download Markdown"}),d.jsx(Ge,{variant:"secondary",actionName:"Mark All Complete",onClick:()=>y(!0),disabled:Q.length===0,style:B?{width:"100%"}:void 0,children:"Mark All Complete"})]})]}),d.jsxs("div",{style:JS,children:[Q.length===0&&!s&&d.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),Q.map(ie=>d.jsx(Tz,{item:ie,isDragging:t===ie.id,isDragOver:n===ie.id,onDragStart:le=>P(le,ie.id),onDragOver:le=>G(le,ie.id),onDragLeave:ee,onDragEnd:re,onDrop:le=>se(le,ie.id),onToggleDone:()=>N(ie),onTypeClick:()=>w(ie)},ie.id)),t&&Q.length>0&&d.jsx(M4,{isActive:n==="__end__",onDragOver:ie=>G(ie,"__end__"),onDragLeave:ee,onDrop:ie=>se(ie,"__end__")})]}),s?d.jsxs(Ps,{actionName:"Add Feedback",onSubmit:k,children:[d.jsx(I1,{selectedType:h,onSelect:f}),d.jsx(m0,{value:c,onChange:ie=>l(ie.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),d.jsxs(Ya,{children:[d.jsx(Ge,{type:"submit",actionName:"Add Feedback",disabled:!c.trim(),children:"Add Feedback"}),d.jsx(Ge,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{o(!1),l(""),f("bug")},children:"Cancel"})]})]}):d.jsx(Ge,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>o(!0),children:"+ Add Feedback"}),ae.length>0&&d.jsx(_0,{title:"Completed",count:ae.length,children:d.jsx("div",{style:{...JS,marginTop:"0.5rem"},children:ae.map(ie=>d.jsx(Az,{item:ie,onToggleDone:()=>N(ie),onTypeClick:()=>w(ie)},ie.id))})}),d.jsxs(Ji,{isOpen:p!==null,onClose:()=>g(null),title:"Mark as Complete",children:[d.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),p&&d.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"var(--row-alt-bg)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',p.text,'"']}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ge,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>g(null),children:"Cancel"}),d.jsx(Ge,{variant:"primary",actionName:"Confirm Mark Complete",onClick:X,children:"Mark Complete"})]})]}),d.jsxs(Ji,{isOpen:_,onClose:()=>y(!1),title:"Mark All as Complete",children:[d.jsxs("p",{style:{margin:"0 0 1.5rem 0"},children:["Are you sure you want to mark all ",Q.length," pending feedback item",Q.length!==1?"s":""," as complete?"]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ge,{variant:"secondary",actionName:"Cancel Mark All Complete",onClick:()=>y(!1),children:"Cancel"}),d.jsx(Ge,{variant:"primary",actionName:"Confirm Mark All Complete",onClick:q,children:"Mark All Complete"})]})]}),d.jsxs(Ji,{isOpen:x!==null,onClose:()=>w(null),title:"Change Feedback Type",children:[d.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),d.jsx(I1,{selectedType:x?.feedback_type||"bug",onSelect:te}),d.jsx(Ge,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>w(null),style:{width:"100%"},children:"Cancel"})]})]})}function DU(){Pe.clear(),window.location.reload()}function MU(){const e=Us().get_current_firebase_user(),{selectedBudgetId:n}=Qe(),r=Z3({currentUser:e}),s=t4({currentUser:e}),o=i4({currentUser:e}),c=f4({currentUser:e}),l=K3({currentUser:e}),h=I3({currentUser:e}),f=T3({currentUser:e}),p=B3({currentUser:e}),g=y3({currentUser:e}),_=o4({currentUser:e}),y=u4({currentUser:e}),x=y4({currentUser:e,budgetId:n}),w=x4({currentUser:e}),S=D4({currentUser:e}),E=m4(),T=d3({currentUser:e}),A=h3({currentUser:e}),M=r.isScanning||s.isScanning||o.isScanning||c.isScanning||l.isScanning||h.isScanning||f.isScanning||p.isScanning||g.isScanning||_.isScanning||y.isScanning||T.isScanning||A.isScanning,L=r.isRunning||s.isRunning||o.isRunning||c.isRunning||h.isRunning||f.isRunning||p.isRunning||g.isRunning||_.isRunning||y.isRunning||T.isDeleting||A.isDeleting||x.isDownloading||w.isUploading||S.isUpdating,H=async()=>{await Promise.all([r.scanStatus(),s.scanStatus(),o.scanStatus(),c.scanStatus(),l.scan(),h.scanStatus(),f.scanStatus(),p.scanStatus(),g.scan(),_.scanStatus(),y.scanStatus(),T.scanStatus(),A.scanStatus()])};return d.jsxs("div",{children:[d.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsx("h2",{style:{margin:0},children:"Data Migrations"}),d.jsxs("button",{onClick:H,disabled:M||L,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:M||L?"not-allowed":"pointer",fontWeight:500,opacity:M||L?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[d.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:M?d.jsx(Cn,{noMargin:!0}):""}),"Refresh All"]})]}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),d.jsx(Wz,{disabled:!e,onDownloadBackup:x.downloadBudget,isDownloadingBackup:x.isDownloading,removeTotalFieldsMigration:{status:r.status,hasData:!!r.status,needsMigration:r.needsMigration,totalItemsToFix:r.totalItemsToFix,isScanning:r.isScanning,isRunning:r.isRunning,result:r.result,scanStatus:r.scanStatus,runMigration:r.runMigration},removePreviousMonthIncomeMigration:{status:s.status,hasData:!!s.status,needsMigration:s.needsMigration,totalItemsToFix:s.totalItemsToFix,isScanning:s.isScanning,isRunning:s.isRunning,result:s.result,scanStatus:s.scanStatus,runMigration:s.runMigration},percentageIncomeMonthsBackMigration:{status:o.status,hasData:!!o.status,needsMigration:o.needsMigration,totalItemsToFix:o.totalItemsToFix,isScanning:o.isScanning,isRunning:o.isRunning,result:o.result,scanStatus:o.scanStatus,runMigration:o.runMigration},removeLegacyBalanceFieldsMigration:{status:c.status,hasData:!!c.status,needsMigration:c.needsMigration,totalItemsToFix:c.totalItemsToFix,isScanning:c.isScanning,isRunning:c.isRunning,result:c.result,scanStatus:c.scanStatus,runMigration:c.runMigration}}),d.jsx(Jz,{disabled:!e,onDownloadBackup:x.downloadBudget,isDownloadingBackup:x.isDownloading,accountCategoryValidation:{status:l.status,hasData:!!l.status,hasViolations:l.hasViolations,violationCount:l.violationCount,isScanning:l.isScanning,report:l.report,scan:l.scan},orphanedIdCleanup:{status:h.status,hasData:!!h.status,hasItemsToFix:h.hasItemsToFix,totalOrphaned:h.status?h.status.orphanedCategoryIds+h.status.orphanedAccountIds:0,isScanning:h.isScanning,isRunning:h.isRunning,result:h.result,scanStatus:h.scanStatus,runMigration:h.runMigration},expenseToAdjustment:{status:f.status,hasData:!!f.status,hasItemsToMigrate:f.hasItemsToMigrate,totalToMigrate:f.status?.expensesToMigrate??0,isScanning:f.isScanning,isRunning:f.isRunning,result:f.result,scanStatus:f.scanStatus,runMigration:f.runMigration},adjustmentsToTransfers:{status:p.status,hasData:!!p.status,hasPairsToConvert:p.hasPairsToConvert,totalPairs:p.status?.pairsFound??0,isScanning:p.isScanning,isRunning:p.isRunning,result:p.result,scanStatus:p.scanStatus,runMigration:p.runMigration},precisionCleanup:{status:g.status,hasData:g.hasData,hasIssues:g.hasIssues,totalIssues:g.totalIssues,isScanning:g.isScanning,isRunning:g.isRunning,result:g.result,scan:g.scan,runCleanup:g.runCleanup},recalculateStartBalances:{status:_.status,hasData:!!_.status,needsMigration:_.needsMigration,totalItemsToFix:_.totalItemsToFix,isScanning:_.isScanning,isRunning:_.isRunning,result:_.result,scanStatus:_.scanStatus,runMigration:_.runMigration},repairMonthMap:{status:y.status,hasData:!!y.status,needsMigration:y.needsMigration,totalItemsToFix:y.totalItemsToFix,isScanning:y.isScanning,isRunning:y.isRunning,result:y.result,scanStatus:y.scanStatus,runMigration:y.runMigration}}),d.jsx(aL,{disabled:!e,onDownloadBackup:x.downloadBudget,isDownloadingBackup:x.isDownloading,budgetDownloadUpload:{isDownloading:x.isDownloading,downloadProgress:x.progress,downloadError:x.error,downloadBudget:x.downloadBudget,isScanning:w.isScanning,isUploading:w.isUploading,uploadStatus:w.status,uploadProgress:w.progress,uploadError:w.error,uploadResult:w.result,scanZipFile:w.scanZipFile,uploadBudget:w.uploadBudget},updateSampleBudget:{isUpdating:S.isUpdating,progress:S.progress,error:S.error,result:S.result,updateSampleBudget:S.updateSampleBudget,reset:S.reset},budgetInspector:{isInspecting:E.isInspecting,result:E.result,error:E.error,inspectBudget:E.inspectBudget,downloadResult:E.downloadResult,clearResult:E.clearResult},deleteAllMonths:{status:T.status,hasData:!!T.status,monthsCount:T.status?.monthsCount??0,budgetCount:T.status?.budgetCount??0,isScanning:T.isScanning,isDeleting:T.isDeleting,deleteResult:T.deleteResult,deleteProgress:T.deleteProgress,scanStatus:T.scanStatus,deleteAllMonths:T.deleteAllMonths},deleteSampleUserBudget:{status:A.status,hasData:!!A.status,totalBudgets:A.status?.totalBudgets??0,totalMonths:A.status?.totalMonths??0,isScanning:A.isScanning,isDeleting:A.isDeleting,deleteResult:A.deleteResult,deleteProgress:A.deleteProgress,scanStatus:A.scanStatus,deleteSampleUserBudget:A.deleteSampleUserBudget},onClearCache:DU}),d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:d.jsxs("p",{style:{margin:0,opacity:.7},children:[d.jsx("strong",{children:"Note:"})," These migrations will process ",d.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),d.jsx(NA,{})]})}function $c({name:t,description:e,expectedBehavior:n,result:r,onRun:s,disabled:o,expectedToSucceed:c}){const l=r?.status==="passed"?me.success:r?.status==="failed"?me.danger:r?.status==="running"?me.warning:"inherit";return d.jsxs("div",{style:{...u0,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[d.jsxs("div",{style:{flex:1},children:[d.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),d.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),d.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:c?me.success:me.warning},children:["Expected: ",n]})]}),d.jsx(Ge,{onClick:s,disabled:o,variant:"secondary",style:{flexShrink:0},children:r?.status==="running"?"":"Run"})]}),r&&r.status!=="pending"&&d.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${l} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${l} 30%, transparent)`,fontSize:"0.85rem",color:l},children:r.message})]})}function OU({totalCount:t,passedCount:e,failedCount:n}){return d.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[d.jsxs("span",{children:["Total: ",d.jsx("strong",{children:t})]}),d.jsxs("span",{style:{color:me.success},children:["Passed: ",d.jsx("strong",{children:e})]}),d.jsxs("span",{style:{color:me.danger},children:["Failed: ",d.jsx("strong",{children:n})]})]})}const k1=[{name:"Read unauthorized budget",expectedToFail:!0},{name:"Read another user's document",expectedToFail:!0},{name:"Read unauthorized budget month",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",expectedToFail:!0},{name:"Read own user document",expectedToFail:!1}];function NU(){const{currentUserId:t}=Qe(),[e,n]=R.useState([]),[r,s]=R.useState(!1);function o(y,x){n(w=>w.map(S=>S.name===y?{...S,...x}:S))}async function c(y,x,w){o(y,{status:"running",message:"Running..."});try{const S=await x();w?o(y,{status:"failed",message:` ${S}`}):o(y,{status:"passed",message:` ${S}`})}catch(S){const E=S instanceof Error?S.message:"Unknown error";w?o(y,{status:"passed",message:` Blocked as expected: ${E}`}):o(y,{status:"failed",message:` ${E}`})}}async function l(){s(!0),n(k1.map(y=>({...y,status:"pending",message:""})));for(const y of k1)await h(y.name);s(!1)}async function h(y){switch(y){case"Read unauthorized budget":await c(y,async()=>(await vt("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await c(y,async()=>(await vt("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await c(y,async()=>(await vt("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await c(y,async()=>{if(!t)throw new Error("Not authenticated");const{data:x}=await vt("users",t,"security test: reading own user to get current is_admin value"),w=x?.permission_flags?.is_admin??!1;return await ts("users",t,{"permission_flags.is_admin":!w},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${w} to ${!w} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await c(y,async()=>{if(!t)throw new Error("Not authenticated");const{data:x}=await vt("users",t,"security test: reading own user to get current is_test value"),w=x?.permission_flags?.is_test??!1;return await ts("users",t,{"permission_flags.is_test":!w},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${w} to ${!w} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await c(y,async()=>{if(!t)throw new Error("Not authenticated");const{exists:x}=await vt("users",t,"security test: reading own user document (should succeed)");if(x)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}}async function f(y){e.find(w=>w.name===y)||n(w=>[...w,{name:y,status:"pending",message:"",expectedToFail:!0}]),s(!0),await h(y),s(!1)}const p=e.filter(y=>y.status==="passed").length,g=e.filter(y=>y.status==="failed").length,_=e.length;return d.jsxs("div",{children:[d.jsx("p",{style:rA,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),d.jsx("div",{style:{marginBottom:"1.5rem"},children:d.jsx(Ge,{onClick:l,disabled:r,variant:"primary",children:r?"Running Tests...":"Run All Tests"})}),e.length>0&&d.jsx(OU,{totalCount:_,passedCount:p,failedCount:g}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[d.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),d.jsx($c,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(y=>y.name==="Read unauthorized budget"),onRun:()=>f("Read unauthorized budget"),disabled:r}),d.jsx($c,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(y=>y.name==="Read another user's document"),onRun:()=>f("Read another user's document"),disabled:r}),d.jsx($c,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(y=>y.name==="Read unauthorized budget month"),onRun:()=>f("Read unauthorized budget month"),disabled:r}),d.jsx($c,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(y=>y.name==="Toggle is_admin in own permission_flags"),onRun:()=>f("Toggle is_admin in own permission_flags"),disabled:r}),d.jsx($c,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(y=>y.name==="Toggle is_test in own permission_flags"),onRun:()=>f("Toggle is_test in own permission_flags"),disabled:r}),d.jsx($c,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(y=>y.name==="Read own user document"),onRun:()=>f("Read own user document"),disabled:r,expectedToSucceed:!0})]}),g>0&&d.jsxs(h0,{style:{marginTop:"1.5rem"},children:[" ",g," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function BU({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=kn(),r=R.useContext(Rd),s=nr();return R.useEffect(()=>(r.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[r.is_auth_checked,e,n]),r.is_auth_checked?r.is_logged_in?t?d.jsx(d.Fragment,{children:t}):d.jsx(rm,{}):d.jsx(nm,{to:"/account",state:{from:s.pathname},replace:!0}):null}function PU(){const{addLoadingHold:t,removeLoadingHold:e}=kn(),{isInitialized:n,pageTitle:r}=Qe(),{isLoading:s,error:o}=Dn();return R.useEffect(()=>{n?e("budget-init"):t("budget-init",s?"Fetching data from server...":"Loading budget...")},[n,s,t,e]),R.useEffect(()=>()=>e("budget-init"),[e]),o?(console.error("[BudgetLayout] Error:",o),d.jsx("div",{style:Yf,children:d.jsxs("p",{style:{color:"var(--color-error)"},children:["Error: ",o.message]})})):d.jsx("div",{style:{...Yf,paddingBottom:"5rem"},children:d.jsxs(kA,{children:[d.jsx(F4,{title:r}),n&&d.jsx(rm,{})]})})}const zU={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function LU(){const{isLoading:t,loadingMessage:e}=kn();return t?d.jsx(oL,{message:e}):null}function UU(){const[t,e]=R.useState(null);return R.useEffect(()=>Hn.subscribe(e),[]),t?d.jsx($4,{item:t,onDismiss:n=>Hn.remove(n)}):null}function FU(){return Pn(),d.jsxs(d.Fragment,{children:[d.jsxs(E2,{children:[d.jsx(vn,{path:"/",element:d.jsx(cL,{})}),d.jsx(vn,{path:"/account",element:d.jsx(lL,{})}),d.jsx(vn,{path:"/budget",element:d.jsx(BU,{}),children:d.jsxs(vn,{element:d.jsx(PU,{}),children:[d.jsx(vn,{index:!0,element:d.jsx(S1,{})}),d.jsx(vn,{path:":year/:month/:tab/:view?",element:d.jsx(S1,{})}),d.jsx(vn,{path:"analytics",element:d.jsx(hU,{})}),d.jsx(vn,{path:"my-budgets",element:d.jsx(yU,{})}),d.jsxs(vn,{path:"settings",element:d.jsx(bU,{}),children:[d.jsx(vn,{index:!0,element:d.jsx(nm,{to:"general",replace:!0})}),d.jsx(vn,{path:"general",element:d.jsx(vU,{})}),d.jsx(vn,{path:"accounts",element:d.jsx(SU,{})}),d.jsx(vn,{path:"categories",element:d.jsx(TU,{})}),d.jsx(vn,{path:"users",element:d.jsx(AU,{})})]}),d.jsxs(vn,{path:"admin",element:d.jsx(RU,{}),children:[d.jsx(vn,{path:"budget",element:d.jsx(IU,{})}),d.jsx(vn,{path:"feedback",element:d.jsx(kU,{})}),d.jsx(vn,{path:"migration",element:d.jsx(MU,{})}),d.jsx(vn,{path:"tests",element:d.jsx(NU,{})})]})]})})]}),d.jsx(z4,{}),d.jsx(NA,{}),d.jsx(UU,{})]})}function VU(){const[t,e]=R.useState(zU),n=Us(),r=R.useRef(!1),{addLoadingHold:s,removeLoadingHold:o}=kn();return R.useEffect(function(){r.current||(r.current=!0,n.set_user_listener(c=>{e({is_logged_in:c!=null,is_auth_checked:!0,username:c?.email??"",set_user_context:e})}))},[n]),R.useEffect(()=>{t.is_auth_checked?o("auth"):s("auth","Authenticating...")},[t.is_auth_checked,s,o]),t.is_auth_checked?d.jsx(Rd.Provider,{value:t,children:d.jsx(GM,{children:d.jsx(Sz,{children:d.jsx(l3,{children:d.jsx(Y2,{children:d.jsx(FU,{})})})})})}):null}function $U(){return d.jsxs(oI,{children:[d.jsx(LU,{}),d.jsx(VU,{})]})}ER.createRoot(document.getElementById("root")).render(d.jsx(R.StrictMode,{children:d.jsx($U,{})}));
